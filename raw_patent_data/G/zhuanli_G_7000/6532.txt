标题title
一种RAIM构架SSD中故障eMMC定位方法
摘要abst
本发明公开了一种RAIM构架SSD中故障eMMC定位方法，包括S1，测试若干个SSD盘，选出故障盘，并记录故障RCA；S2，对故障盘中每一个eMMC进行编号，并格式化故障盘；S3，测试正常盘不同工作状态下的色温，作为故障检测对比标准；S4，选中S1中非故障的RCA，写入数据，获取红外成像图；S5，观测红外成像图，得到正常工作的eMMC对应的S4中RCA；S6，重复S4和S5，测试正常SSD盘上所有非故障的RCA对应的eMMC是否是正常颗粒。本发明利用红外技术定位故障颗粒，通过对比正常工作的eMMC和故障eMMC对外部温度环境的影响，利用红外成像图直接判断。
权利要求书clms
1.一种RAIM构架SSD中故障eMMC定位方法，其特征在于，包括通过红外热像仪对eMMC进行热成像图的拍摄，根据预设的颜色范围判断eMMC是否出现故障。2.根据权利要求1所述的RAIM构架SSD中故障eMMC定位方法，其特征在于，具体包括以下步骤：S1，测试若干个SSD盘，选出故障盘，并记录故障RCA；S2，对故障盘中每一个eMMC进行编号，并格式化故障盘；S3，测试正常盘不同工作状态下的色温，作为故障检测对比标准；S4，选中S1中非故障的RCA，写入数据，获取红外成像图；S5，观测红外成像图，得到正常工作的eMMC对应的S4中RCA；S6，重复S4和S5，测试故障SSD盘上所有非故障的RCA对应的eMMC是否是正常颗粒。3.根据权利要求2所述的RAIM构架SSD中故障eMMC定位方法，其特征在于，所述测试若干个SSD盘，选出故障盘，并记录故障RCA，具体为依次对盘上所有RCA的eMMC发送擦、写和读命令，通过查看擦除之后，数据反馈线上0bit位的数据判断擦除是否故障，如果0bit位是0，表示擦除成功，如果超出预设擦除时间后0bit位还是1，表示该RCA对应的eMMC擦除发生故障；再发送写读命令，写入特定的预设值，再读上来进行对比，如果不一致，则写读故障；发生擦写读其中任何一种故障，即认为该RCA对应的eMMC是故障的，反之正常，记录该盘所有RCA对应的eMMC的状态，即正常或故障。4.根据权利要求3所述的RAIM构架SSD中故障eMMC定位方法，其特征在于，所述对故障盘中每一个eMMC进行编号，并格式化故障盘，其中故障盘格式化，清除数据，避免在选中阵列中一个eMMC进行操作时，其他空闲eMMC发生垃圾回收的使芯片发热的情况，使发生误判。5.根据权利要求4所述的RAIM构架SSD中故障eMMC定位方法，其特征在于，所述测试正常盘不同工作状态下的色温，作为故障检测对比标准，具体为若干次使用红外成像仪获得温度和色温，记录空闲不工作状态下的eMMC所处区域的温度对应红外成像图中的颜色范围，记为低温色；记录写数据5分钟工作状态下的eMMC的所处区域的温度对应红外成像图中的颜色范围，记为高温色。6.根据权利要求5所述的RAIM构架SSD中故障eMMC定位方法，其特征在于，所述选中S1中非故障的RCA，写入数据，获取红外成像图，具体为选中S1中没有发生故障的一个RCA，写入数据5分钟，让该RCA对应的eMMC工作，温度升高且达到稳定状态，然后使用红外测温仪拍摄红外成像图。7.根据权利要求6所述的RAIM构架SSD中故障eMMC定位方法，其特征在于，所述观测红外成像图，得到正常工作的eMMC对应的S4中RCA，具体为观察成像图，如果有一颗eMMC所在区域色温范围符合S3中高温色范围，则说明该颗eMMC正在正常工作，该颗粒为正常颗粒，且对应S4下发的RCA。8.根据权利要求7所述的RAIM构架SSD中故障eMMC定位方法，其特征在于，所述重复S4和S5，测试正常SSD盘上所有非故障的RCA对应的eMMC是否是正常颗粒，具体为重复S4和S5，依次测试盘上所有正常RCA对应的eMMC是否为正常颗粒，检验出盘上所有正常颗粒，剩余的即为故障颗粒。
说明书desc
技术领域本发明属于数据存储技术领域，涉及一种RAIM构架SSD中故障eMMC定位方法。背景技术eMMC是目前主流存储器件之一。与单颗NAND Flash颗粒相比，eMMC将高密度NAND闪存和MCU集成在一颗BGA芯片中，在芯片内部完成了对NAND Flash的管理，并提供标准接口给用户。eMMC协议是由MMC协会所订立的内嵌式存储器标准，可以提供高容量，高稳定性和高读写速度。在单颗eMMC系统中，Controller和eMMC交互，主要有五种操作模式：Boot Mode、Device Identification Mode、Interrupt Mode、Data Transfer Mode和Inactive Mode。在DeviceIdentification Mode下，主要有3个阶段Idle State、Ready State和Identification State。在设备识别模式，主要通过给eMMC发三种命令：CMD1：命令1，用于检测eMMC是否完成初始化；CMD2：命令2，用于获取eMMC的CID；CMD3：命令3，用于设置RCA；Idle State下，eMMC内部初始化，Controller持续发送CMD1，查询eMMC是否完成初始化，完成后进入Ready State，接着Controller发送CMD2，获取eMMC的CID，eMMC接收到CMD2后，会将127Bits的CID的内容通过CMD线返回CID给Controller，eMMC发送完CID后，就进入Identification State。在该状态，Controller为eMMC分配16Bits的RCA，发送CMD3命令，将RCA设置到eMMC中的RCA寄存器中，设定完RCA后，eMMC就完成了Devcie Identification，进入Data Transfer Mode，可以用于正常数据传输了。随着存储数据增多，单颗eMMC已经无法满足存储需求，迫切需要大容量SSD，而基于Flash的SSD过于复杂，为了让SSD的设计变得简单，一种基于eMMC阵列的RAIM构架的SSD应运而生，参见图1。该架构由一个SSD Controller和多个通道channel构成，每个通道上有多颗eMMC，一个通道上多个eMMC的共享CMD线。参见图2为图1中channel0，即通道0上eMMC级联结构。该架构的SSD在初始化时，SSD Controller向channel0发送广播命令CMD2向该通道上所有设备请求CID，Channel0上处于Ready State的3个eMMC，开始连续发送它们128bit的CID号码到CMD线上，每一个bit周期，eMMC开漏输出它们的CID，在开漏输出时，低电平输出0，高电平时输出高阻态，而线上bit值是所有CID对应bit值相与的结果，同时eMMC逐位监控输出比特流，如果eMMC设备发送的CID在任何一个bit周期内与CMD线上CID不匹配，就停止发送CID，等待下一个请求识别周期。每一个CID的编号是唯一的，一个识别周期只有一个设备能成功将完整的CID发送给Controller，然后Controller发CMD3，给设备分配相对设备地址RCA。RCA设好之后，eMMC就不会对识别周期有反馈，同时，将开漏输出转为推挽输出。因此Controller接收的CID顺序肯定是从小到大的，但并不清楚是具体哪一颗eMMC回的CID，再分配的RCA也不知道对应具体哪一颗eMMC。那么在SSD发生故障时，SSD Controller可以清楚知道哪一个RCA的eMMC发生故障，而无法得知故障eMMC的具体空间位置。另外一种方案是在生产之前，先将所有eMMC的CID读出来，上生产线以前按照大小排列好，这样生产后的产品中，RCA就按照预先设想的规律放在对应的位置了。RCA就可以与实际版图上的eMMC一一对应，但该方案在生产实现中非常复杂，效率极低，一般生产中不采用。所以目前eMMC阵列故障定位是非常困难的。现有检测eMMC阵列中颗粒故障的方法有两种：一种是直接检测，另外一种是通过专用光学检验设备检测。第一种方案：该方案需要对eMMC芯片依次进行初始化、擦除、写入、读取时，监控不同操作的返回状态，分析发送不同命令时的返回状态来判断该颗eMMC具体发生了什么故障，然后输出该eMMC的CID编号或RCA。第二种方案：利用电子束故障检测。在电子束缺陷设备下，芯片内不同器件表现的亮暗程度是明显不一样的，可以通过比对芯片走线确定是否出现故障。对于上述的第一种方案，只能输出故障eMMC的CID编号或者RCA编号，无法确定故障eMMC的具体空间位置，无法检修。对于上述的第二种方案，该方案需要购买专业设备，价格昂贵，且操作复杂，需要专业人员操作，检测效率低下，不适合故障eMMC的定位。发明内容本发明为解决RAIM构架SSD的eMMC阵列中故障eMMC定位困难的问题，利用红外成像技术，测出eMMC阵列工作的红外成像热度图，通过热量分布快速分辨出正常和故障eMMC颗粒所在位置。具体提出了一种RAIM构架SSD中故障eMMC定位方法，包括通过红外热像仪对eMMC进行热成像图的拍摄，根据预设的颜色范围判断eMMC是否出现故障。优选地，具体包括以下步骤：S1，测试若干个SSD盘，选出故障盘，并记录故障RCA；S2，对故障盘中每一个eMMC进行编号，并格式化故障盘；S3，测试正常盘不同工作状态下的色温，作为故障检测对比标准；S4，选中S1中非故障的RCA，写入数据，获取红外成像图；S5，观测红外成像图，得到正常工作的eMMC对应的S4中RCA；S6，重复S4和S5，测试正常SSD盘上所有非故障的RCA对应的eMMC是否是正常颗粒。优选地，所述测试若干个SSD盘，选出故障盘，并记录故障RCA，具体为依次对盘上所有RCA对应的eMMC发送擦、写和读命令，通过查看擦除之后，数据反馈线上0bit位的数据判断擦除是否故障，如果0bit位是0，表示擦除成功，如果超出预设擦除时间后0bit位还是1，表示该RCA对应的eMMC擦除发生故障；再发送写读命令，写入特定的预设值，再读上来进行对比，如果不一致，则写读故障；发生擦写读其中任何一种故障，即认为该RCA对应的eMMC是故障的，反之正常，记录该盘所有RCA的状态，即正常或故障。优选地，所述对故障盘中每一个eMMC进行编号，并格式化故障盘，其中故障盘格式化，清除数据，避免在选中阵列中一个eMMC进行操作时，其他空闲eMMC发生垃圾回收的使芯片发热的情况，使发生误判。优选地，所述测试正常盘不同工作状态下的色温，作为故障检测对比标准，具体为若干次使用红外成像仪获得温度和色温，记录空闲不工作状态下的eMMC所处区域的温度对应红外成像图中的颜色范围，记为低温色；记录写数据5分钟工作状态下的eMMC的所处区域的温度对应红外成像图中的颜色范围，记为高温色。优选地，所述选中S1中非故障的RCA，写入数据，获取红外成像图，具体为选中S1中没有发生故障的一个RCA，写入数据5分钟。让该RCA寄存器对应的eMMC工作，温度升高且达到稳定状态，然后使用红外测温仪拍摄红外成像图。优选地，所述观测红外成像图，得到正常工作的eMMC对应的S4中RCA，具体为观察成像图，如果有一颗eMMC所在区域色温范围符合S3中高温色范围，则说明该颗eMMC正在正常工作，该颗粒为正常颗粒，且对应S4下发的RCA。优选地，所述重复S4和S5，测试正常SSD盘上所有中非故障的RCA对应的eMMC是否有正常颗粒，具体为重复S4和S5，依次测试盘上所有正常RCA对应的eMMC是否为正常颗粒，检验出盘上所有正常颗粒，剩余的即为故障颗粒。本发明有益效果至少包括：利用红外技术定位故障颗粒，通过对比正常工作的eMMC和故障eMMC对外部温度环境的影响，利用红外成像图直接判断。现有技术只能判断故障eMMC的RCA编号，而无法确定具体的空间位置。而生产之前绑定RCA地址和实际空间位置操作较为复杂，没有红外成像图直观，快捷，简易。本发明可以在eMMC阵列工作状态时，直接快速检测出故障颗粒，不用更换检测固件，不用将RCA与eMMC地址绑定，不用采用特殊芯片检测设备，降低了生产成本，减小了检测的复杂度。附图说明图1为现有技术中基于RAIM构架的固态硬盘eMMC阵列结构框图；图2为图1中channel0中eMMC级联结构示意图；图3为本发明实施例的RAIM构架SSD中故障eMMC定位方法的步骤流程图；图4为本发明实施例的RAIM构架SSD中故障eMMC定位方法的eMMC阵列红外成像示意图。具体实施方式为了使本发明的目的、技术方案及优点更加清楚明白，以下结合附图及实施例，对本发明进行进一步详细说明。应当理解，此处所描述的具体实施例仅仅用以解释本发明，并不用于限定本发明。相反，本发明涵盖任何由权利要求定义的在本发明的精髓和范围上做的替代、修改、等效方法以及方案。进一步，为了使公众对本发明有更好的了解，在下文对本发明的细节描述中，详尽描述了一些特定的细节部分。对本领域技术人员来说没有这些细节部分的描述也可以完全理解本发明。包括通过红外热像仪对eMMC进行热成像图的拍摄，根据预设的颜色范围判断eMMC是否出现故障。参见图3，包括以下步骤：S1，测试若干个SSD盘，选出故障盘，并记录故障RCA；S2，对故障盘中每一个eMMC进行编号，并格式化故障盘；S3，测试正常盘不同工作状态下的色温，作为故障检测对比标准；S4，选中S1中非故障的RCA，写入数据，获取红外成像图；S5，观测红外成像图，得到正常工作的eMMC对应的S4中RCA；S6，重复S4和S5，测试正常SSD盘上所有中非故障的RCA对应的eMMC是否有正常颗粒。具体实施里中，S1，测试若干个SSD盘，选出故障盘，并记录故障RCA，具体为依次对盘上所有RCA对应的eMMC发送擦、写和读命令，通过查看擦除之后，数据反馈线上0bit位的数据判断擦除是否故障，如果0bit位是0，表示擦除成功，如果超出预设擦除时间后0bit位还是1，表示该RCA擦除发生故障；再发送写读命令，写入特定的预设值，再读上来进行对比，如果不一致，则写读故障；发生擦写读其中任何一种故障，即认为该RCA对应的eMMC是故障的，反之正常，记录该盘所有RCA的状态，即正常或故障。S2，对故障盘中每一个eMMC进行编号，并格式化故障盘，其中故障盘格式化，清除数据，避免在选中阵列中一个eMMC进行操作时，其他空闲eMMC发生垃圾回收的使芯片发热的情况，使发生误判。S3，测试正常盘不同工作状态下的色温，作为故障检测对比标准，具体为若干次使用红外成像仪获得温度和色温，记录空闲不工作状态下的eMMC所处区域的温度对应红外成像图中的颜色范围，记为低温色；记录写数据5分钟工作状态下的eMMC的所处区域的温度对应红外成像图中的颜色范围，记为高温色。S4，选中S1中非故障的RCA，写入数据，获取红外成像图，具体为选中S1中没有发生故障的一个RCA，写入数据5分钟。让该RCA对应的eMMC工作，温度升高且达到稳定状态，然后使用红外测温仪拍摄红外成像图。S5，观测红外成像图，得到正常工作的eMMC对应的S4中RCA，具体为观察成像图，如果有一颗eMMC所在区域色温范围符合S3中高温色范围，则说明该颗eMMC正在正常工作，该颗粒为正常颗粒，且对应S4下发的RCA。S6，重复S4和S5，测试正常SSD盘上所有非故障的RCA对应的eMMC是否是正常颗粒，具体为重复S4和S5，依次测试盘上所有正常RCA对应的eMMC是否为正常颗粒，检验出盘上所有正常颗粒，剩余的即为故障颗粒。参见图4为正常工作状态下的eMMC阵列盘的对应的红外图，利用红外成像技术来定位eMMC颗粒故障。电流在通过导体或半导体，总是会有一部分电能转化为热能。芯片内部主要由晶体管构成，晶体管内部通过电流反转实现二进制0和1，在正常工作的eMMC颗粒中，有相当数量的晶体管每秒内翻转次数高达上亿次，每次都伴随着电流的消耗和热量的产生，由于散热速度远远小于其生产速度，形成高温区域。发生故障而不能工作的eMMC颗粒则不会因为比特翻转产生热量，相对温度较低。红外热像仪是把物体发出的不可见红外能量转变为可见热图像的仪器，它利用的是红外探测器以及光学成像物镜接受被测目标的红外辐射能量分布图形反映到红外探测器的光敏元件上，生成高质量的红外热像图，热像图与物体表面的热分布场相对应，热成像图的上面的不同颜色代表被测物体的不同温度。host端选定RCA0发送读写任务，eMMC2内部Controller接收到命令，开始存储数据，芯片内部开始运转发热，在红外测温仪中可以看到eMMC2所在区域的颜色对应的温度比处于空闲状态的eMMC的颜色对应的温度要高，即可知RCA0对应实际空间上的颗粒是eMMC2，且eMMC2为正常颗粒。以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的精神和原则之内所作的任何修改、等同替换和改进等，均应包含在本发明的保护范围之内。
