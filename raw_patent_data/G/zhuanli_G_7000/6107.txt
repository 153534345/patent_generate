标题title
一种车载设备通信参数更新存储方法、系统
摘要abst
本发明提出一种车载设备通信参数更新存储方法、系统，包括：建立并连接主存储区和辅助存储区，主存储区和辅助存储区通过相同的ID通信连接；根据更新地面设备的ID类型将更新的地面设备通信参数写入主存储区或辅助存储区；将更新后的主存储区和辅助存储区的地面设备通信参数更新到相应的内存中，将内存中的所有地面设备通信参数写入主存储区，完成车载设备通信参数更新存储。在面对通信参数实时在线更新需求时，不需要在硬件模块上增加其他可快速存取的非易失存储器，可在不修改硬件的情况下，很好的实现参数实时在线更新的需求；还能够极大的缩短存储器的操作时间，提高更新过程中车载设备的响应性能。
权利要求书clms
1.一种车载设备通信参数更新存储方法，其特征在于，所述方法包括：建立并连接主存储区和辅助存储区，所述主存储区和所述辅助存储区通过相同的ID通信连接；根据更新地面设备的ID类型将所述更新的地面设备通信参数写入主存储区或辅助存储区；将更新后的主存储区和辅助存储区的地面设备通信参数更新到相应的内存中，将内存中的所有地面设备通信参数写入主存储区，完成车载设备通信参数更新存储。2.根据权利要求1所述的车载设备通信参数更新存储方法，其特征在于，根据更新地面设备的ID类型将所述更新的地面设备通信参数写入主存储区或辅助存储区包括：遍历主存储区的地面设备ID；判断所述主存储区地面设备ID中是否存在与更新地面设备相同的ID；若存在与更新地面设备相同的ID，则将更新的地面设备通信参数写入辅助存储区；若不存在与更新地面设备相同的ID，则将更新的地面设备通信参数写入主存储区。3.根据权利要求1或2所述的车载设备通信参数更新存储方法，其特征在于，将更新后的主存储区和辅助存储区的地面设备通信参数更新到相应的内存中，将内存中的所有地面设备通信参数写入主存储区包括：读取更新后的主存储区地面设备通信参数，并将更新后的主存储区地面设备通信参数读取到内存中；根据所述相同的ID将辅助存储区数据与内存中主存储区数据进行匹配，将辅助存储区的地面设备通信参数更新到相应的内存中；擦除主存储区和辅助存储区的所有参数块，将内存中的所有地面设备通信参数写入主存储区，完成车载设备通信参数更新存储。4.根据权利要求2所述的车载设备通信参数更新存储方法，其特征在于，所述主存储区和所述辅助存储区为大小相同的两个区域。5.根据权利要求4所述的车载设备通信参数更新存储方法，其特征在于，所述主存储区内存储所有地面设备的通信参数，每个地面设备的ID都是独立且唯一的；所述辅助存储区内存储运行过程中需要更新的、其设备ID与主存储区的某一个地面设备ID相同的地面设备的通信参数。6.一种车载设备通信参数更新存储系统，其特征在于，所述系统包括：建立单元、写入单元和更新存储单元，其中，建立单元，用于建立并连接主存储区和辅助存储区，所述主存储区和所述辅助存储区通过相同的ID通信连接；写入单元，与建立单元相连接，用于根据更新地面设备的ID类型将所述更新的地面设备通信参数写入主存储区或辅助存储区；更新存储单元，与写入单元相连接，用于将更新后的主存储区和辅助存储区的地面设备通信参数更新到相应的内存中，将内存中的所有地面设备通信参数写入主存储区，完成车载设备通信参数更新存储。7.根据权利要求6所述的车载设备通信参数更新存储系统，其特征在于，所述写入单元包括判断模块、第一写入模块和第二写入模块，其中，判断模块，用于遍历主存储区的地面设备ID，判断所述主存储区地面设备ID中是否存在与更新地面设备相同的ID；第一写入模块，与判断模块相连接，用于存在与更新地面设备相同的ID时，则将更新的地面设备通信参数写入辅助存储区；第二写入模块，与判断模块相连接，用于不存在与更新地面设备相同的ID时，则将更新的地面设备通信参数写入主存储区。8.根据权利要求6或7所述的车载设备通信参数更新存储系统，其特征在于，所述更新存储单元包括读取模块、匹配模块、擦除模块和第三写入模块，其中，读取模块，用于读取更新后的主存储区地面设备通信参数，并将更新后的主存储区地面设备通信参数读取到内存中；匹配模块，用于根据所述相同的ID将辅助存储区数据与内存中主存储区数据进行匹配，将辅助存储区的地面设备通信参数更新到相应的内存中；擦除模块，用于擦除主存储区和辅助存储区的所有参数块；第三写入模块，用于将内存中的所有地面设备通信参数写入经擦除模块擦除干净的主存储区，完成车载设备通信参数更新存储。9.根据权利要求7所述的车载设备通信参数更新存储系统，其特征在于，所述主存储区和所述辅助存储区为大小相同的两个区域。10.根据权利要求9所述的车载设备通信参数更新存储系统，其特征在于，所述主存储区，用于存储所有地面设备的通信参数，每个地面设备的ID都是独立且唯一的；所述辅助存储区，用于存储运行过程中需要更新的、其设备ID与主存储区的某一个地面设备ID相同的地面设备的通信参数。11.一种计算机可读存储介质，其特征在于，所述存储介质中存储有程序，所述程序被执行时实现如权利要求1-5任一项所述的车载设备通信参数更新存储方法的步骤。
说明书desc
技术领域本发明属于通信技术领域，特别涉及一种车载设备通信参数更新存储方法、系统。背景技术在轨道交通车载设备和地面设备通信场景下，车载设备需要存储和地面设备通信的相关参数，由于早期通信参数都是长期固定不变的，故大部分车载设备的通信参数都存储在NAND FLASH存储器中，通过线下烧录进行参数的更新。NAND FLASH的操作分为：擦除、写入和读出，NAND FLASH的最小擦除单位为块，大小为128KB，写入和读出的最小单位为字节，但写入和读出操作比较耗时，如：我们测试擦除一个块将近3ms，写入6KB数据将近18ms，读出6KB数据将近8ms，且写入和读出的速度与数据量大小成正比，数据量越大，时间越长。由于FLASH存储器的写入操作只能针对擦除的区域进行，已写过的区域只能擦除后才能再次写入；故通常，为了更新NAND FLASH中的数据，需要将指定块中的全部数据读出到内存中，再将要更新的数据先写到内存的对应地址，然后擦除指定块的所有数据，最后将更新后内存中的全部数据写入指定块中。在忽略擦除时间的情况下，即使只更新一个块的数据，所耗时间也能达到将近500ms。在轨道交通车地通信场景下，由于车载设备通常对任务的实时性有较高的要求，如果采用常规的NAND FLASH数据更新解决方案，可能会影响整体任务的响应时间，最终影响车载设备的正常运行。但随着需求的变化，目前出现了通信参数随着列车运行位置的变化而变化的情况，且变化后的参数仍需要保存到非易失存储器中，方便下次重新上电后使用；在不改变硬件的情况下，我们提出了一种通信参数在NAND FLASH上存储管理的方法，用于应对通信参数实时在线更新的需求。发明内容针对上述问题，本发明提出一种车载设备通信参数更新存储方法，所述方法包括：建立并连接主存储区和辅助存储区，所述主存储区和所述辅助存储区通过相同的ID通信连接；根据更新地面设备的ID类型将所述更新的地面设备通信参数写入主存储区或辅助存储区；将更新后的主存储区和辅助存储区的地面设备通信参数更新到相应的内存中，将内存中的所有地面设备通信参数写入主存储区，完成车载设备通信参数更新存储。进一步的，根据更新地面设备的ID类型将所述更新的地面设备通信参数写入主存储区或辅助存储区包括：遍历主存储区的地面设备ID；判断所述主存储区地面设备ID中是否存在与更新地面设备相同的ID；若存在与更新地面设备相同的ID，则将更新的地面设备通信参数写入辅助存储区；若不存在与更新地面设备相同的ID，则将更新的地面设备通信参数写入主存储区。进一步的，将更新后的主存储区和辅助存储区的地面设备通信参数更新到相应的内存中，将内存中的所有地面设备通信参数写入主存储区包括：读取更新后的主存储区地面设备通信参数，并将更新后的主存储区地面设备通信参数读取到内存中；根据所述相同的ID将辅助存储区数据与内存中主存储区数据进行匹配，将辅助存储区的地面设备通信参数更新到相应的内存中；擦除主存储区和辅助存储区的所有参数块，将内存中的所有地面设备通信参数写入主存储区，完成车载设备通信参数更新存储。进一步的，所述主存储区和所述辅助存储区为大小相同的两个区域。进一步的，所述主存储区内存储所有地面设备的通信参数，每个地面设备的ID都是独立且唯一的；所述辅助存储区内存储运行过程中需要更新的、其设备ID与主存储区的某一个地面设备ID相同的地面设备的通信参数。本发明还提供一种车载设备通信参数更新存储系统，所述系统包括：建立单元、写入单元和更新存储单元，建立单元，用于建立并连接主存储区和辅助存储区，所述主存储区和所述辅助存储区通过相同的ID通信连接；写入单元，与建立单元相连接，用于根据更新地面设备的ID类型将所述更新的地面设备通信参数写入主存储区或辅助存储区；更新存储单元，与写入单元相连接，用于将更新后的主存储区和辅助存储区的地面设备通信参数更新到相应的内存中，将内存中的所有地面设备通信参数写入主存储区，完成车载设备通信参数更新存储。进一步的，所述写入单元包括判断模块、第一写入模块和第二写入模块，其中，判断模块，用于遍历主存储区的地面设备ID，判断所述主存储区地面设备ID中是否存在与更新地面设备相同的ID；第一写入模块，与判断模块相连接，用于存在与更新地面设备相同的ID时，则将更新的地面设备通信参数写入辅助存储区；第二写入模块，与判断模块相连接，用于不存在与更新地面设备相同的ID时，则将更新的地面设备通信参数写入主存储区。进一步的，所述更新存储单元包括读取模块、匹配模块、擦除模块和第三写入模块，其中，读取模块，用于读取更新后的主存储区地面设备通信参数，并将更新后的主存储区地面设备通信参数读取到内存中；匹配模块，用于根据所述相同的ID将辅助存储区数据与内存中主存储区数据进行匹配，将辅助存储区的地面设备通信参数更新到相应的内存中；擦除模块，用于擦除主存储区和辅助存储区的所有参数块；第三写入模块，用于将内存中的所有地面设备通信参数写入经擦除模块擦除干净的主存储区，完成车载设备通信参数更新存储。进一步的，所述主存储区和所述辅助存储区为大小相同的两个区域。进一步的，所述主存储区，用于存储所有地面设备的通信参数，每个地面设备的ID都是独立且唯一的；所述辅助存储区，用于存储运行过程中需要更新的、其设备ID与主存储区的某一个地面设备ID相同的地面设备的通信参数。本发明还提供一种计算机可读存储介质，所述存储介质中存储有程序，所述程序被执行时实现如上述所述的车载设备通信参数更新存储方法的步骤。本发明的车载设备通信参数更新存储方法、系统，在面对通信参数实时在线更新需求时，不需要在硬件模块上增加其他可快速存取的非易失存储器，降低成本的同时还能够避免对后续参数扩容的限制，可在不修改硬件的情况下，很好的实现参数实时在线更新的需求；同时还能够极大的缩短NAND FLASH存储器的操作时间，提高更新过程中车载设备的响应性能。本发明的其它特征和优点将在随后的说明书中阐述，并且，部分地从说明书中变得显而易见，或者通过实施本发明而了解。本发明的目的和其他优点可通过在说明书、权利要求书以及附图中所指出的结构来实现和获得。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作一简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1示出了本发明实施例中的存储通信参数的NAND FLASH区域示意图；图2示出了本发明实施例中的车载设备通信参数更新存储方法流程示意图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地说明，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。轨道交通车载设备和地面设备通信相关参数总体数据量不大，通信参数一般以设备为单位进行存储，车载设备要存储的通信参数是所有可能通信的地面设备的参数的集合。在面对通信参数实时在线更新需求时，若采用常规的NAND FLASH更新解决方案，虽然可以解决问题，但更新过程中车载设备的响应性能会存在明显下降，并且可能对设备的整体运行产生影响。若采用修改硬件的方式，在硬件模块上增加其他可快速存取的非易失存储器：一方面，根据目前的技术，其他可快速存取的非易失存储器在单片容量上最大只能达到1MB~2MB，这对于以后的参数扩容会造成一定的限制；另一方面，在既有车载设备较多的情况下，通过修改硬件的方式对现场的硬件模块进行更新替换，需要投入较大的成本。本发明可在不修改硬件的情况下，很好的实现参数实时在线更新的需求。本发明的目的在于避免在运行过程中对NAND FLASH执行擦除再重写的操作，每次更新修改参数时，只执行FLASH的写入操作，由于每次更新的设备数量有限，总体数据量不大，从而可以极大压缩FLASH操作时间。本发明将存储通信参数的NAND FLASH区域，分为两个大小相同的区域，一个称为主存储区，另一个称为辅助存储区，图1示出了本发明实施例中的存储通信参数的NANDFLASH区域示意图，图1中，主存储区存储所有地面设备的通信参数，每个地面设备的ID都是独立且唯一的，本发明实施例中，主存储区可以存储地面设备ID1的通信参数、地面设备ID2的通信参数、地面设备ID3的通信参数，本发明实施例中主存储区的地面设备可以设置有多个，辅助存储区进行参数更新前存储数据为0，在地面设备通信参数更新存储时，在辅助存储区存储运行过程中需要更新的、其设备ID与主存储区的某一个地面设备ID相同的地面设备的通信参数，例如，图1中，当需要更新的参数是一个既有的地面设备的通信参数，即当需要更新的参数是主存储区内的既有地面设备ID3时，在辅助存储区存储运行过程中需要更新的地面设备ID3的通信参数。本发明实施例中提供一种车载设备通信参数更新存储方法，所述方法包括：建立并连接主存储区和辅助存储区，所述主存储区和所述辅助存储区通过相同的ID通信连接；根据更新地面设备的ID类型将所述更新的地面设备通信参数写入主存储区或辅助存储区；将更新后的主存储区和辅助存储区的地面设备通信参数更新到相应的内存中，将内存中的所有地面设备通信参数写入主存储区，完成车载设备通信参数更新存储。具体的，根据更新地面设备的ID类型将所述更新的地面设备通信参数写入主存储区或辅助存储区包括：遍历主存储区的地面设备ID；判断所述主存储区地面设备ID中是否存在与更新地面设备相同的ID；若存在与更新地面设备相同的ID，则将更新的地面设备通信参数写入辅助存储区；若不存在与更新地面设备相同的ID，则将更新的地面设备通信参数写入主存储区。具体的，将更新后的主存储区和辅助存储区的地面设备通信参数更新到相应的内存中，将内存中的所有地面设备通信参数写入主存储区包括：读取更新后的主存储区地面设备通信参数，并将更新后的主存储区地面设备通信参数读取到内存中；根据所述相同的ID将辅助存储区数据与内存中主存储区数据进行匹配，将辅助存储区的地面设备通信参数更新到相应的内存中；擦除主存储区和辅助存储区的所有参数块，将内存中的所有地面设备通信参数写入主存储区，完成车载设备通信参数更新存储。本发明实施例中的车载设备通信参数更新存储方法包括两个步骤和一个前提，该前提为：车载设备上电初始化时，会将NAND FLASH中的通信参数读到内存中，便于运行过程中使用：步骤一：车载设备运行过程中，若需要更新参数时，首先判断当前更新的参数是一个新增的地面设备还是既有的地面设备，当为新增的地面设备时，则在内存中新增该设备参数，同时在主存储区将该新设备参数写入到一个新的设备索引下面；若要更新的参数是一个既有的设备的参数，则在内存中更新参数的同时，在辅助存储区域，写入到一个新的设备索引下面，图2示出了本发明实施例中的车载设备通信参数更新存储方法流程示意图，首先，遍历主存储区的地面设备ID；判断主存储区的地面设备中是否存在与要更新通信参数的地面设备相同的ID；若主存储区的地面设备中存在与要更新通信参数的地面设备相同的ID，则将该地面设备通信参数写入辅助存储区；若主存储区的地面设备中不存在与要更新通信参数的地面设备相同的ID，则将该地面设备通信参数写入主存储区；步骤二：车载设备重新上电初始化时，将首先读取主存储区的通信参数到内存中，其次再逐个设备读取辅助存储区的通信参数，根据ID与内存中主存储区数据进行匹配，将辅助存储区的通信参数更新到相应的内存中；最后，读完辅助存储区的所有设备参数后，擦除主存储区和辅助存储区的所有参数块，将内存中的所有参数写入主存储区，完成上次运行时变化的设备参数在NAND FLASH中的完整更新。本发明实施例中还提供一种车载设备通信参数更新存储系统，所述系统包括：建立单元、写入单元和更新存储单元，其中，建立单元，用于建立并连接主存储区和辅助存储区，所述主存储区和所述辅助存储区通过相同的ID通信连接；写入单元，与建立单元相连接，用于根据更新地面设备的ID类型将所述更新的地面设备通信参数写入主存储区或辅助存储区；更新存储单元，与写入单元相连接，用于将更新后的主存储区和辅助存储区的地面设备通信参数更新到相应的内存中，将内存中的所有地面设备通信参数写入主存储区，完成车载设备通信参数更新存储。具体的，所述写入单元包括判断模块、第一写入模块和第二写入模块，其中，判断模块，用于遍历主存储区的地面设备ID，判断所述主存储区地面设备ID中是否存在与更新地面设备相同的ID；第一写入模块，与判断模块相连接，用于存在与更新地面设备相同的ID时，则将更新的地面设备通信参数写入辅助存储区；第二写入模块，与判断模块相连接，用于不存在与更新地面设备相同的ID时，则将更新的地面设备通信参数写入主存储区。具体的，所述更新存储单元包括读取模块、匹配模块、擦除模块和第三写入模块，其中，读取模块，用于读取更新后的主存储区地面设备通信参数，并将更新后的主存储区地面设备通信参数读取到内存中；匹配模块，用于根据所述相同的ID将辅助存储区数据与内存中主存储区数据进行匹配，将辅助存储区的地面设备通信参数更新到相应的内存中；擦除模块，用于擦除主存储区和辅助存储区的所有参数块；第三写入模块，用于将内存中的所有地面设备通信参数写入经擦除模块擦除干净的主存储区，完成车载设备通信参数更新存储。具体的，所述主存储区，用于存储所有地面设备的通信参数，每个地面设备的ID都是独立且唯一的；所述辅助存储区，用于存储运行过程中需要更新的、其设备ID与主存储区的某一个地面设备ID相同的地面设备的通信参数。本发明实施例中还提供一种计算机可读存储介质，其可应用于各种通信设备中，所述存储介质中存储有一个或多个程序，该一个或多个程序被一个或多个处理器执行，以实现如上述各实施例所示的车载设备通信参数更新存储方法的步骤。本发明的车载设备通信参数存储方法、系统，在面对通信参数实时在线更新需求时，不需要在硬件模块上增加其他可快速存取的非易失存储器，降低成本的同时还能够避免对后续参数扩容的限制，可在不修改硬件的情况下，很好的实现参数实时在线更新的需求；同时还能够极大的缩短NAND FLASH存储器的操作时间，提高更新过程中车载设备的响应性能。尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的精神和范围。
