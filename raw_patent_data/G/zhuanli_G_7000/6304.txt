标题title
基于企业微信的安全访问的方法、系统、设备及存储介质
摘要abst
本申请提供一种基于企业微信的安全访问的方法、系统、设备及存储介质，包括：接收操作指令；其中，操作指令包括应用请求指令、注册请求指令、刷新指令、通讯录请求指令；根据操作指令至少执行以下之一：将解析得到的授权认证参数输入到应用授权认证接口中，显示第一数据内容；调用预设的会话处理接口以刷新当前显示页面的第二数据内容；调用注册接口进行对应功能的注册；调用预设的通讯录接口更新本地通讯录数据库。通过将涉及企业微信用户交互过程中需要保证其安全性的功能逐一封装为对应的统一接口，以保证企业微信用户访问应用过程是安全的。同时，由于接口具有通用性，因此可降低对开发人员的开发要求，提升开发该方法对应应用的效率。
权利要求书clms
1.一种基于企业微信的安全访问的方法，其特征在于，应用于前端服务器，包括：接收操作指令；其中，所述操作指令包括应用请求指令、注册请求指令、刷新指令、通讯录请求指令；根据所述操作指令至少执行包括以下步骤之一：根据应用请求指令，将解析所述应用请求指令得到的授权认证参数输入到应用授权认证接口中，显示重定向地址对应的第一数据内容；其中，所述重定向地址为所述授权认证参数的参数之一；根据刷新指令，调用预设的会话处理接口以刷新当前显示页面的第二数据内容；根据所述注册请求指令，调用注册接口进行对应功能的注册；其中，注册接口用于获取认证信息，并将所述认证信息发送到后端服务器，以得到签名信息；根据通讯录请求指令，调用预设的通讯录接口更新本地通讯录数据库。2.如权利要求1所述的基于企业微信的安全访问的方法，其特征在于，所述应用授权认证接口设置有默认参数列表，所述应用授权认证接口根据输入的所述授权认证参数执行如下步骤：根据所述授权认证参数、所述默认参数列表，向所述后端服务器请求OAuth2链接；将所述OAuth2链接发送给企业微信后台进行合法性校验，得到第一验证数据；其中，所述第一验证数据包括所述重定向地址、授权代码，所述授权代码被保存在远程字典服务器；获取授权认证数据、前端地址；其中，所述授权认证数据由所述重定向地址根据所述授权代码生成，所述前端地址由所述重定向地址提供；根据所述前端地址，请求所述重定向地址对应的第一数据内容；保存所述授权认证数据，并输出所述第一数据内容。3.如权利要求1所述的基于企业微信的安全访问的方法，其特征在于，所述预设的会话处理接口根据所述刷新指令执行如下步骤：将所述刷新指令中第二数据内容对应的待显示地址发送给所述后端服务器；根据所述后端服务器的响应数据，判断所述第二数据内容是否会话超期；若所述第二数据内容已会话超期，则判断所述第二数据内容是否可以会话续期；若所述第二数据内容无法会话续期，则对所述待显示地址重新授权认证，并输出授权后所述待显示地址对应的第二数据内容。4.如权利要求1所述的基于企业微信的安全访问的方法，其特征在于，所述通讯录接口执行如下步骤：获取授权认证数据；根据所述授权认证数据，调用企业微信后台获取用户信息；将所述用户信息发送给所述后端服务器，以使所述后端服务器将所述用户信息保存到本地通讯录数据库中。5.如权利要求4所述的基于企业微信的安全访问的方法，其特征在于，所述通讯录接口还执行如下步骤：更新数据库显示界面的显示数据。6.如权利要求1所述的基于企业微信的安全访问的方法，其特征在于，根据所述操作指令至少执行还包括以下步骤：根据所述应用请求，调用对应的功能接口，其中，所述功能接口包括企业微信图片管理、文件上传管理、素材管理、消息推送、应用管理、数据同步。7.如权利要求1至6任一所述的基于企业微信的安全访问的方法，其特征在于，所述会话处理接口、所述应用授权认证接口、所述注册接口、所述通讯录接口均通过预设的前端服务器模板加载；所述本地通讯录数据库通过预设的后端服务器模板创建。8.一种基于企业微信的安全访问的系统，其特征在于，包括：前端服务器，所述前端服务器用于执行如权利要求1至7任一所述的基于企业微信的安全访问的方法；企业微信后台，所述企业微信后台用于提供基础功能接口，所述前端服务器的会话处理接口、所述应用授权认证接口、所述注册接口、所述通讯录接口通过调用对应的所述基础功能接口完成对应的功能；后端服务器，所述后端服务器用于提供所述第一数据内容、所述第二数据内容、所述本地通讯录数据库、签名信息，以协助所述前端服务器完成如权利要求1至7任一所述的基于企业微信的安全访问的方法。9.一种基于企业微信的安全访问的设备，其特征在于，包括：至少一个处理器和用于与所述处理器通信连接的存储器；所述存储器存储可被所述至少一个处理器执行的指令，所述指令被所述至少一个处理器执行，以使所述处理器能够执行如权利要求1-7任一项所述的基于企业微信的安全访问的方法。10.一种存储介质，其特征在于，所述存储介质存储有计算机可执行指令，所述计算机可执行指令用于使计算机执行如权利要求1-7任一项所述的基于企业微信的安全访问的方法。
说明书desc
技术领域本申请属于互联网应用开发技术领域，尤其涉及一种基于企业微信的安全访问的方法、系统、设备及存储介质。背景技术企业微信广泛应用于办公领域，基于企业微信的应用的实现方案一般需要通过企业微信客户端与企业微信后台、企业微信应用的后端服务器进行授权认证，并基于授权认证的情况请求需要显示的内容，由于授权的过程比较复杂，因此，往往需要开发人员了解整个授权的机制，并且对调用的每一微信提供的接口进行熟悉、调测，否则容易引入安全问题。发明内容本申请旨在至少解决现有技术中存在的技术问题之一。为此，本申请提出一种基于企业微信的安全访问的方法、系统、设备及存储介质，可以使得快速开发出该方法对应的应用，保证安全的同时，提升开发效率。第一方面，本申请提供一种基于企业微信的安全访问的方法，应用于前端服务器，包括：接收操作指令；其中，所述操作指令包括应用请求指令、注册请求指令、刷新指令、通讯录请求指令；根据所述操作指令至少执行包括以下步骤之一：根据应用请求指令，将解析所述应用请求指令得到的授权认证参数输入到应用授权认证接口中，显示重定向地址对应的第一数据内容；其中，所述重定向地址为所述授权认证参数的参数之一；根据刷新指令，调用预设的会话处理接口以刷新当前显示页面的第二数据内容；根据所述注册请求指令，调用注册接口进行对应功能的注册；其中，注册接口用于获取认证信息，并将所述认证信息发送到后端服务器，以得到签名信息；根据通讯录请求指令，调用预设的通讯录接口更新本地通讯录数据库。第二方面，本申请提供一种基于企业微信的安全访问的系统，包括：前端服务器，所述前端服务器用于执行如第一方面任一所述的基于企业微信的安全访问的方法；企业微信后台，所述企业微信后台用于提供基础功能接口，所述前端服务器的会话处理接口、所述应用授权认证接口、所述注册接口、所述通讯录接口通过调用对应的所述基础功能接口完成对应的功能；后端服务器，所述后端服务器用于提供所述第一数据内容、所述第二数据内容、所述本地通讯录数据库、签名信息，以协助所述前端服务器完成第一方面任一所述的基于企业微信的安全访问的方法。第三方面，本申请提供一种基于企业微信的安全访问的设备，包括：至少一个处理器和用于与所述处理器通信连接的存储器；所述存储器存储可被所述至少一个处理器执行的指令，所述指令被所述至少一个处理器执行，以使所述处理器能够执行如第一方面任一所述的基于企业微信的安全访问的方法。第四方面，本申请提供一种存储介质，所述存储介质存储有计算机可执行指令，所述计算机可执行指令用于使计算机执行如第一方面任一项所述的基于企业微信的安全访问的方法。根据本申请上述实施例，至少具有如下有益效果：通过将涉及企业微信用户交互过程中需要保证其安全性的功能逐一封装为应用授权认证接口、会话处理接口、注册接口、通讯录接口，以保证企业微信用户分别进行应用访问、页面刷新、功能注册以及通讯录访问时，其过程是安全的。同时，提供统一封装接口，对于开发人员而言，提供了统一的框架，开发人员只需关注具体的业务功能，从而可以提升开发该方法对应应用的效率。因此，应用该方法的应用可以节约研发人员的研发效率，且可保证企业微信用户的访问安全。同理，承载该应用方法的系统、设备以及存储介质具有和方法相同的技术效果。本申请的附加方面和优点将在下面的描述中部分给出，部分将从下面的描述中变得明显，或通过本申请的实践了解到。附图说明本申请的上述和/或附加的方面和优点从结合下面附图对实施例的描述中将变得明显和容易理解，其中：图1为本申请实施例的基于企业微信的安全访问的方法的流程图。图2为本申请另一实施例的应用授权认证接口执行步骤流程图。图3为本申请另一实施例的会话处理接口执行步骤流程图。图4为本申请另一实施例的通讯录接口执行步骤流程图。图5为本申请实施例的基于企业微信的安全访问的系统结构示意图。具体实施方式下面详细描述本申请的实施例，所述实施例的示例在附图中示出，其中自始至终相同或类似的标号表示相同或类似的元件或具有相同或类似功能的元件。下面通过参考附图描述的实施例是示例性的，仅用于解释本申请，而不能理解为对本申请的限制。在本申请的描述中，需要理解的是，涉及到方位描述，例如上、下、前、后、外、内等指示的方位或位置关系为基于附图所示的方位或位置关系，仅是为了便于描述本申请和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本申请的限制。在本申请的描述中，若干的含义是一个或者多个，多个的含义是两个以上，大于、小于、超过等理解为不包括本数，以上、以下、以内等理解为包括本数。如果有描述到第一、第二只是用于区分技术特征为目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量或者隐含指明所指示的技术特征的先后关系。本申请的描述中，除非另有明确的限定，设置、安装、连接等词语应做广义理解，所属技术领域技术人员可以结合技术方案的具体内容合理确定上述词语在本申请中的具体含义。为了对本申请的技术特征、目的和效果有更加清晰的理解，先对照附图详细说明本申请的具体实施方式。企业微信在办公领域的广泛应用，因此，有诸多基于企业微信的H5应用实现方案，同时针对企业微信对外暴露的前端API和服务端API，亦各是不同，例如，jssdk签名、身份认证方式、通讯录和用户信息等。实际应用开发中，需要开发者熟悉各种API接口本身功能的同时，还需要了解其调用关系及其应用场景，对开发者有一定门槛要求。此时，对于相似功能应用的一些开发，如扫码订餐、口袋超市等同一类型的企业应用，会需要占用大量的时间去研究API的功能以保证访问应用过程的安全。为此，本申请提供了一种基于企业微信的安全访问的方法，应用于前端服务端。如图1所示，该方法包括：步骤S100，接收操作指令；其中，操作指令包括应用请求指令、注册请求指令、刷新指令、通讯录请求指令。根据所述操作指令至少执行包括以下步骤之一：步骤S210，根据应用请求指令，将解析应用请求指令得到的授权认证参数输入到应用授权认证接口中，显示重定向地址对应的第一数据内容；其中，重定向地址为授权认证参数的参数之一。需说明的是，对于任一通过企业微信新建访问的html5页面，均需要对其访问的地址进行授权，因此，提供统一的认证接口，即应用授权认证接口，在应用授权认证接口内部实现对访问地址授权认证的全过程，从而使得被调用者无需关心具体的认证过程，只需关注具体的应用功能。步骤S220，根据刷新指令，调用预设的会话处理接口以刷新当前显示页面的第二数据内容。需说明的是，当对已显示的企业微信html5页面进行刷新操作时，由于当前的页面存在超期，因此需要重新对该页面进行一次如步骤S121中的授权认证，或者对会话续期；否则在刷新场景下，由于安全认证机制存在漏洞引入安全问题。因此，通过设置会话处理接口，将安全机制在会话处理接口内部实现，使得开发应用者无需关心刷新的操作过程，从而可以提升应用该接口的开发效率。步骤S230，根据注册请求指令，调用注册接口进行对应功能的注册；其中，注册接口用于获取认证信息，并将认证信息发送到后端服务器200，以得到签名信息。需说明的是，注册接口将企业微信中应用模块的注册进行了封装，如企业微信中需要设置通讯录模块，则可以通过注册接口将通讯录模块加载，从而可以在后续对通讯录进行访问。认证信息包括前端服务器100随机生成的8位随机字符串、时间戳以及签名认证URL。后端服务器200接收到认证消息后，会调用微信接口jsapi_ticket获取临时票据，此时，将认证消息、临时票据通过sha1算法签名得到签名字符串，并保存。并获取预先储存的企业应用ID，将该企业应用ID、签名字符串作为签名信息反馈给前端服务器100。此时，前端服务器100可以根据签名信息进行功能模块的注册。步骤S240，根据通讯录请求指令，调用预设的通讯录接口更新本地通讯录数据库。需说明的是，企业微信对企业微信中的用户信息有访问次数的限制，因此，创建本地通讯录数据库。此时，将本地通讯录数据库中的用户信息与企业微信中的用户信息同步，可以更加便于对用户信息的管理。而通过企业微信的通讯接口读取用户信息进行同步，需要了解其访问安全机制，否则容易引入安全问题，因此，提供统一的通讯录接口，将安全机制封装入内，每次调用均可响应其预设的本地通讯录数据库的更新。因此，通过将涉及企业微信用户交互过程中需要保证其安全性的功能逐一封装为应用授权认证接口、会话处理接口、注册接口、通讯录接口，以保证企业微信用户分别进行应用访问、页面刷新、功能注册以及通讯录访问时，其过程是安全的。同时，提供统一侧封装接口，对于开发人员而言，提供了统一的框架，开发人员只需关注具体的业务功能，从而可以提升开发该方法对应应用的效率。因此，应用该方法的应用可以节约研发人员的研发效率，且可保证企业微信用户的方位安全。可理解为，应用授权认证接口设置有默认参数列表。如图2所示，步骤S210中的应用授权认证接口根据输入的授权认证参数执行如下步骤：步骤S211、根据授权认证参数、默认参数列表，向后端服务器200请求OAuth2链接。步骤S212、将OAuth2链接发送给企业微信后台300进行合法性校验，得到第一验证数据；其中，第一验证数据包括重定向地址、授权代码，授权代码被保存在远程字典服务器。需说明的是，OAuth2链接以http302方式返回，此时，当前端服务器100根据http302返回后内容跳转时，此时，企业微信webView自身会拦截该OAuth2链接，将其给企业微信后台300进行数据安全校验，当校验成功后，以302的方式携带授权代码code返回给前端服务器100，此时302的地址为步骤S1211的OAuth2链接的其中一个参数REDIRECT_URL，即第一验证数据包括code、重定向地址REDIRECT_URL。步骤S213、获取授权认证数据、前端地址；其中，授权认证数据由重定向地址根据授权代码生成，前端地址由重定向地址提供。需说明的是，根据步骤S1212的302中的重定向地址进行跳转到后端服务器200对应的重定向地址，并根据授权代码生成token或cockie，并以302方式返回，此时可以获取到授权认证数据以及302中携带的地址。步骤S214、根据前端地址，请求重定向地址对应的第一数据内容。步骤S215、保存授权认证数据，并输出第一数据内容。需说明的是，第一数据内容为界面上显示的内容，如该应用授权认证接口请求了某一菜品的说明，则第一数据内容可包括菜品图片、成分解说、评价等信息，并以页面的形式显示。需说明的是，在一些实施例中，授权认证参数如下：ELINK_CORP_ID；ELINK_AGENT_ID；ELINK_AGENT_SECRET；ELINK_REDIRECT_URI。默认参数列表中的参数如下：ELINK_BASE_DOMAIN；ELINK_QR_CODE_URL；ELINK_APP_OAUTH_URL；ELINK_SYN_TYPE＝0。需说明的是，授权认证数据可用于下次相同页面访问时的授权信息获取，当授权认证数据未过期时，可以直接通过该授权认证数据得到第一数据内容，否则需要重新认证获取授权认证数据。可理解为，如图3所示，步骤S220中预设的会话处理接口根据刷新指令执行如下步骤：步骤S221、将刷新指令中第二数据内容对应的待显示地址发送给后端服务器200。步骤S222、根据后端服务器200的响应数据，判断第二数据内容是否会话超期。步骤S223、若第二数据内容已会话超期，则判断第二数据内容是否可以会话续期。步骤S224、若第二数据内容无法会话续期，则对待显示地址重新授权认证，并输出授权后待显示地址对应的第二数据内容。需说明的是，对于企业微信而言，单独会话续期、单独的会话超期的认证流程是固定的，因此，此处不做一一详述。可理解为，如图4所示，步骤S240中通讯录接口执行如下：步骤S241、获取授权认证数据。步骤S242、根据授权认证数据，调用企业微信后台300获取用户信息。步骤S243、将用户信息发送给后端服务器200，以使后端服务器200将用户信息保存到本地通讯录数据库中。可理解为，如图4所示，步骤S240中通讯录接口还执行如下：步骤S244、更新数据库显示界面的显示数据。可理解为，在一些实施例中，根据操作指令至少还执行包括如下步骤：根据应用请求，调用对应的功能接口，其中，功能接口包括企业微信图片管理、文件上传管理、素材管理、消息推送、应用管理、数据同步。需说明的是，企业微信图片管理、文件上传管理、素材管理、消息推送、应用管理、数据同步为企业应用中常用的功能，通过对每一常用功能进行安全认证的封装，使得其可以在多个相似功能的应用开发时，可以更加高效，同时对后续研发类似的应用的开发者要求更低。可理解为，会话处理接口、应用授权认证接口、注册接口、通讯录接口均通过预设的前端服务器100模板加载；本地通讯录数据库通过预设的后端服务器200模板创建。需说明的是，通过设置前端服务器模板、后端服务器模板使得对系统架设不熟悉的人来说更容易搭建一个完整的应用。从而提升应用该方法的开发效率。其中，前端服务器模板部署于微信客户端，用于接收企业用户的请求并将其转发给后端服务器200，并将后端服务器200的反馈结果进行显示。后端服务器200部署在用户预设的服务器上，用于提供具体功能的实现。可理解为，如图5所示，本申请还提供一种基于企业微信的安全访问的系统，包括：前端服务器100，前端服务器100用于执行如第一方面任一所述的基于企业微信的安全访问的方法；企业微信后台300，企业微信后台300用于提供基础功能接口，前端服务器100的会话处理接口、应用授权认证接口、注册接口、通讯录接口通过调用对应的基础功能接口完成对应的功能；后端服务器200，后端服务器200用于提供第一数据内容、第二数据内容、本地通讯录数据库、签名信息，以协助前端服务器100完成如第一方面任一的基于企业微信的安全访问的方法。可理解为，本申请还提供一种基于企业微信的安全访问的设备，包括：至少一个处理器和用于与处理器通信连接的存储器；存储器存储可被至少一个处理器执行的指令，指令被至少一个处理器执行，以使处理器能够执行如第一方面任一项的基于企业微信的安全访问的方法。需说明的是，存储器作为一种非暂态存储介质，可用于存储非暂态软件程序以及非暂态性计算机可执行程序，如本申请实施例中的基于企业微信的安全访问的方法对应的程序指令。处理器通过运行存储在存储器中的非暂态软件程序以及指令，从而实现上述的基于企业微信的安全访问的方法。存储器可以包括存储程序区和存储数据区，其中，存储程序区可存储操作系统、至少一个功能所需要的应用程序；存储数据区可存储上述基于企业微信的安全访问的方法的相关数据等。此外，存储器可以包括高速随机存取存储器，还可以包括非暂态存储器，例如至少一个磁盘存储器件、闪存器件、或其他非暂态固态存储器件。在一些实施例中，存储器可选包括相对于处理器远程设置的存储器，这些远程存储器可以通过网络连接至该基于企业微信的应用程序安全认证的设备。上述网络的实例包括但不限于互联网、企业内部网、局域网、移动通信网及其组合。可理解为，本申请还提供一种可读存储介质，存储介质存储有计算机可执行指令，计算机可执行指令用于使计算机执行如第一方面任一项的基于企业微信的安全访问的方法。本领域普通技术人员可以理解，上文中所公开方法中的全部或某些步骤、系统可以被实施为软件、固件、硬件及其适当的组合。某些物理组件或所有物理组件可以被实施为由处理器，如中央处理器、数字信号处理器或微处理器执行的软件，或者被实施为硬件，或者被实施为集成电路，如专用集成电路。这样的软件可以分布在计算机可读介质上，计算机可读介质可以包括计算机存储介质和通信介质。如本领域普通技术人员公知的，术语计算机存储介质包括在用于存储信息的任何方法或技术中实施的易失性和非易失性、可移除和不可移除介质。计算机存储介质包括但不限于RAM、ROM、EEPROM、闪存或其他存储器技术、CD-ROM、数字多功能盘或其他光盘存储、磁盒、磁带、磁盘存储或其他磁存储装置、或者可以用于存储期望的信息并且可以被计算机访问的任何其他的介质。此外，本领域普通技术人员公知的是，通信介质通常包含计算机可读指令、数据结构、程序模块或者诸如载波或其他传输机制之类的调制数据信号中的其他数据，并且可包括任何信息递送介质。上面结合附图对本申请实施例作了详细说明，但是本申请不限于上述实施例，在所述技术领域普通技术人员所具备的知识范围内，还可以在不脱离本申请宗旨的前提下作出各种变化。
