标题title
实时日照检测方法及系统
摘要abst
本发明提供一种实时日照检测方法及系统。本发明首先计算每一时间间隙下目标建筑物的日照条件，以棒影光线集的形式进行记录。然后按照建筑物的日照测算点，分别将棒影光线集调用至各日照测算点位置，根据棒影光线集中光线是否被障碍物遮挡而实现对日照时间的标记。最后，按照规定的计算方式，对各日照测算点的有效日照时间进行统计，获得各日照测算点的日照时长。本申请所采用的棒影光线集中的光线，不仅匹配于目标建筑物的日照方位，还同时兼顾对不同日照时间间隙进行标记，能够直接通过光线是否被障碍物遮挡而获得不同日照时间间隙下日照测算点的实时光照情况，灵活按照日照时长计算方式的要求准确实现对有效日照时长的统计。
权利要求书clms
1.一种实时日照检测方法，其特征在于，步骤包括：第一步，根据目标建筑物所处经纬度及其高度，按照预定的时间间隙，分别计算每一时间间隙下目标建筑物所对应日照条件下的棒影光线集；第二步，分别为每一个目标建筑物确定其所对应的日照测算点，分别为每一目标建筑物启动一条日照光线遮挡算法线程，通过该日照光线遮挡算法线程对该目标建筑物的每一个日照测算点分别执行以下第三步至第七步的计算步骤；第三步，将该目标建筑物所对应的棒影光线集的二维投影范围与周围建筑物的经纬度位置进行比较，若周围建筑物处于棒影光线集的二维投影范围内，则记录该周围建筑物为障碍物并跳转至第四步，否则，跳转至第八步；第四步，按照障碍物与目标建筑物之间的距离，对各障碍物进行排序；第五步，调用所述棒影光线集至目标建筑物的各个日照测算点，按照太阳方位角的顺序分别对棒影光线集中的每一根光线标记序号；第六步，为目标建筑物的每一个日照测算点分别建立3个存储器，以其中的一号存储器存储第五步中的棒影光线集及其中每一根光线所标记的序号，以其中的二号存储器存储被障碍物遮挡的光线的序号，以其中的三号存储器存储未被障碍物遮挡的光线的序号；第七步，分别以每一个日照测算点为基点，依次对每一个障碍物进行以下判断：获取障碍物的边界与基点之间的方位角范围，从一号存储器中调取所有位于该方位角范围内的光线，判断调取所得光线是否与该障碍物相交，若相交则将该光线移动至二号存储器中，若不相交则将该光线移动至三号存储器中；第八步，按照规定的日照时长计算方式，分别调取每一日照测算点所对应的三号存储器中的光线，计算该日照测算点是否达到日照时长标准。2.如权利要求1所述的实时日照检测方法，其特征在于，还包括：第九步，若日照测算点达到日照时长标准，则以第一显示方式在该日照测算点位置标记对应的日照时长；否则，以第二显示方式在该日照测算点位置标记对应的日照时长；其中，第二显示方式下日照时长的标记字体、字号、粗细均大于第一显示方式，第二显示方式下日照时长的标记颜色区别于所述第一显示方式。3.如权利要求1或2所述的实时日照检测方法，其特征在于，还包括：第十步，每当移动或改变任一目标建筑物或周围建筑物时，均自动触发重新执行第二步至第九步。4.如权利要求1-3所述的实时日照检测方法，其特征在于，所述棒影光线集由以下步骤计算获得：步骤101，根据目标建筑物所处经纬度及对应时间间隙下的赤纬角δ和真太阳时角Ω，按照sinhs＝sinφsinδ+cosφcosδcosΩ计算获得目标建筑所对应的太阳高度角hs，并按照计算获得目标建筑所对应的太阳方位角As；步骤102，计算匹配于周围建筑物最大高度H的棒影母线终端坐标点P，其中，Xp＝H×sinAs×coths，Yp＝-1×H×cosAs×coths，Zp＝H；步骤103，连接坐标原点O与上述棒影母线终端坐标点P，获得对应时间间隙下目标建筑物所对应日照条件下的棒影光线OP，该棒影光线OP的二维投影为OP0，其中，P0坐标为；步骤104，按照预定的时间间隙，分别执行上述步骤101至102，将每一时间间隙下目标建筑物所对应日照条件下的棒影光线OP的集合存储为棒影光线集。5.如权利要求4所述的实时日照检测方法，其特征在于，所述第五步中，调用所述棒影光线集至目标建筑物的各个日照测算点的具体步骤为：分别将棒影光线集中各棒影光线OP的坐标原点移动至目标建筑物的各个日照测算点，获得匹配于该日照测算点的棒影光线O’P’，其中，P’坐标为，日照测算点的坐标为O’。6.如权利要求1-3所述的实时日照检测方法，其特征在于，目标建筑物的所述日照测算点由以下步骤确定：步骤201，以逆时针顺序用多段线建立的标准层平面为基准，获取目标建筑物的标准层户型平面图形，提取标准层户型平面图形中每一个端点的坐标，记其中位于最南端的端点为Pt，记其中位于最西端的端点为PtXmin，记其中位于最东端的端点PtXmax；步骤202，若位于最南端的端点数目超过1，则确定目标建筑物的偏转角度为0，否则，确定目标建筑物存在偏转；步骤203，当确定目标建筑物存在偏转时，提取标准层户型平面图形中起点坐标值Pts与位于最南端的端点Pt重叠的边缘线段L，记该边缘线段L的终点坐标为Pte，按照该边缘线段L的方向建立向量V；步骤204，计算向量V与轴向量Vx之间的夹角，获得目标建筑物所对应的偏转值RotAngle；步骤205，根据偏转值RotAngle计算目标建筑物所对应的偏转角：当时，确定所述偏角角度为Angle＝RotAngle-90°，当时，确定所述偏角角度为Angle＝RotAngle；步骤206，以标准层户型平面图形的中心为旋转点，将标准层户型平面图形偏转-1*Angle的角度，在该状态下，获取旋转后标准层户型平面图形中各极值坐标点分别为：X’max，X’min，Y’max，Y’min，Z’；步骤207，根据各极值坐标点构建旋转后标准层户型平面图形的外接矩形，在该外接矩形的南向边缘线上按照测算点数量或间距要求标记相应的虚拟测算点；步骤208，以虚拟测算点为底端沿目标建筑物的标准户型平面做垂线，按照测算点高度要求或户型层高标记该垂线上相应坐标为初始测算点，将各所述虚拟测算点和初始测算点以标准层户型平面图形的中心为旋转中心偏转回Angle的角度，获得目标建筑户型南面所对应的日照测算点。7.一种实时日照检测系统，其特征在于，包括：棒影光线集生成模块，其根据目标建筑物所处经纬度及其高度，按照预定的时间间隙，分别计算每一时间间隙下目标建筑物所对应日照条件下的棒影光线集；日照测算点生成模块，其分别为每一个目标建筑物确定其所对应的日照测算点；日照光线遮挡算法模块，其分别为每一目标建筑物启动一条日照光线遮挡算法线程，通过该日照光线遮挡算法线程对该目标建筑物的每一个日照测算点分别进行棒影光线集中光线是否被遮挡的判断，以获得每一个日照测算点的光线遮挡情况；日照时长计算模块，其根据日照光线遮挡算法模块所获得的每一个日照测算点的光线遮挡情况，按照规定的日照时长计算方式，分别计算每一日照测算点所对应的未被遮挡的光线是否达到日照时长标准，若达到则以第一显示方式在该日照测算点位置标记对应的日照时长；否则，以第二显示方式在该日照测算点位置标记对应的日照时长；其中，第二显示方式下日照时长的标记字体、字号、粗细均大于第一显示方式，第二显示方式下日照时长的标记颜色区别于所述第一显示方式。8.如权利要求7所述的实时日照检测系统，其特征在于，所述棒影光线集生成模块具体按照以下步骤计算每一时间间隙下目标建筑物所对应日照条件下的棒影光线集：步骤101，根据目标建筑物所处经纬度及对应时间间隙下的赤纬角δ和真太阳时角Ω，按照sinhs＝sinφsinδ+cosφcosδcosΩ计算获得目标建筑所对应的太阳高度角hs，并按照计算获得目标建筑所对应的太阳方位角As；步骤102，计算匹配于周围建筑物最大高度H的棒影母线终端坐标点P，其中，Xp＝H×sinAs×coths，Yp＝-1×H×cosAs×coths，Zp＝H；步骤103，连接坐标原点O与上述棒影母线终端坐标点P，获得对应时间间隙下目标建筑物所对应日照条件下的棒影光线OP，该棒影光线OP的二维投影为OP0，其中，P0坐标为；步骤104，按照预定的时间间隙，分别执行上述步骤101至102，将每一时间间隙下目标建筑物所对应日照条件下的棒影光线OP的集合存储为棒影光线集。9.如权利要求7-8所述的实时日照检测系统，其特征在于，所述日照测算点生成模块具体按照以下步骤确定目标建筑物的日照测算点：步骤201，以逆时针顺序用多段线建立的标准层平面为基准，获取目标建筑物的标准层户型平面图形，提取标准层户型平面图形中每一个端点的坐标，记其中位于最南端的端点为Pt，记其中位于最西端的端点为PtXmin，记其中位于最东端的端点PtXmax；步骤202，若位于最南端的端点数目超过1，则确定目标建筑物的偏转角度为0，否则，确定目标建筑物存在偏转；步骤203，当确定目标建筑物存在偏转时，提取标准层户型平面图形中起点坐标值Pts与位于最南端的端点Pt重叠的边缘线段L，记该边缘线段L的终点坐标为Pte，按照该边缘线段L的方向建立向量V；步骤204，计算向量V与轴向量Vx之间的夹角，获得目标建筑物所对应的偏转值RotAngle；步骤205，根据偏转值RotAngle计算目标建筑物所对应的偏转角：当时，确定所述偏角角度为Angle＝RotAngle-90°，当时，确定所述偏角角度为Angle＝RotAngle；步骤206，以标准层户型平面图形的中心为旋转点，将标准层户型平面图形偏转-1*Angle的角度，在该状态下，获取旋转后标准层户型平面图形中各极值坐标点分别为：X’max，X’min，Y’max，Y’min，Z’；步骤207，根据各极值坐标点构建旋转后标准层户型平面图形的外接矩形，在该外接矩形的南向边缘线上按照测算点数量或间距要求标记相应的虚拟测算点；步骤208，以虚拟测算点为底端沿目标建筑物的标准户型平面做垂线，按照测算点高度要求或户型层高标记该垂线上相应坐标为初始测算点，将各所述虚拟测算点和初始测算点以标准层户型平面图形的中心为旋转中心偏转回Angle的角度，获得目标建筑户型南面所对应的日照测算点。10.如权利要求7-9所述的实时日照检测系统，其特征在于，还包括：自动更新模块，其在接收到移动或改变任一目标建筑物或周围建筑物的指令时，均自动触发棒影光线集生成模块、日照测算点生成模块、日照光线遮挡算法模块、日照时长计算模块、重新计算以显示各照测算点所对应的新的日照时长。
说明书desc
技术领域本发明涉及建筑物日照检测技术领域，具体而言涉及一种实时日照检测方法及系统。背景技术根据《城市居住区规划设计规范》的要求，建筑物的日照标准日、有效日照时间带、日照时数等参数需要满足强制性条文指标要求。而按照标准规范计算获取建筑和场地的日照，才能测算出是否满足建筑日照标准。现有进行建筑日照测算的方式包括以下几种：1.日照棒影图。其根据太阳光线的射入高度和方位，计算棒的影子长度和方位以将有效时间段内的棒影同时绘制出，用于表征测算点的日照影响范围，测算点的日照时长，以及测算点与周边建筑的间距和朝向。但是日照棒影图标识建筑物日照状况时具有以下不足：首先，其无清晰的日照时长和遮挡关系，日照棒影图用于间距和方位判断时是扇面网状的形态，无法清晰地识别测算点与周边环境的关系；其次，其对日照时长的计算方式单一，只能累计所有日照时间，无法适应建筑日照规范的要求；此外，由于目前CAD的插件中，需要人为专门设定测算点才能显示日照棒影图，且该棒影图不会随三维建筑物调整而自动调整，需要再次人为设定，因此其还无法实现动态显示。2.日照沿线分析图。其在二维平面上，在建筑物轮廓线指定标高处，设定采样精度，获取需要计算的日照测算点，对测算点进行日照时长计算，并将计算完成后的日照时长标注在基点位置处。但是该技术用于查看建筑物轮廓线上日照时长时具有以下不足：首先，其计算了许多北向立面上的非必要日照测算点，而对于住宅建筑而言，必要的日照测算点仅为建筑南向立面上指定标高的点，该算法多计算了一些不必要的日照点会严重浪费计算机资源；其次，其无法清晰的显示日照时长和遮挡关系，无法直观显示与周边建筑的日照遮挡关系；此外，该方式对日照时长的计算方式单一，无法按照现有建筑日照规范累计日照时长，只能累计所有日照时间；进一步的，该方式所输出的日照数值仅在二维平面图显示日照时长，在三维建筑物模型上，不易查看，视觉可读性差；并且，当在CAD的插件中调整三维建筑物模型位置后，该方法无法随模型位置改变而随之更新日照状态，需要手工设置重新耗费大量计算自远进行重复计算。3.日照多点图。其在二维平面上，框选某一范围，设定日照测算点的分布间距和标高，以对每个测算点进行日照时长的计算，然后显示计算后的日照时长数字和对应的颜色。但是该技术用于查看多个建筑物之间的日照环境时具有以下不足：首先，其计算了众多的位于建筑物北向立面上的非必要日照测算点，浪费计算机资源，消耗计算时间；其次，其对日照时长的计算方式单一，无法按照现有建筑日照规范累计日照时长，而只能累计所有日照时间；此外，其日照数值视觉可读性差，只能在二维平面图中显示日照时长，而在三维建筑物模型上不易查看，并且，日照时长的显示仅通过数值和颜色区分，不易查看具体位置的时长大小；同时，其还无法动态显示日照，无法直接响应于三维建筑物模型位置的调整自动更新日照时长参数。4.日照圆锥图。其在三维空间中，设定若干时刻，取一基准线和基准点，围绕基准点将各时刻的太阳位置显示在空间中，并用基准线将基准点和各太阳位置连接起来，形成圆锥扇面。该技术于查看基准点与周围建筑空间的光线遮挡时具有以下不足：首先，其无法清晰的表示日照时长和遮挡的关系，无法清晰地判断圆锥面内，所有建筑物与测算点的遮挡和间距关系；其次，其对日照时长的计算方式单一，无法按照现有建筑日照规范累计日照时长，只能累计所有日照时间；同时，其所获得的日照数值的视觉可读性差，测算点处的日照时长显示不明显，显示时同时暂时未被遮挡的光线和遮挡光线容易干扰视觉判断；此外，其还无法进行动态日照显示，目前CAD的插件中，需要人为专门设定测算点才能显示日照圆锥图，且需要人为逐一检测和调整检测点与遮挡建筑物之间的距离。因此，如何提供一种合理、效率高、准确的建筑日照情况实时测算的方案是本领域技术人员亟待解决的技术问题。发明内容本发明针对现有技术的不足，提供一种实时日照检测方法及系统，本发明通过建立棒影光线集并选择必要的日照测算点，实现对日照光线遮挡的计算，本发明能够按照多种统计方式按照指标要求计算相应的日照时长，具有测算精准、可读性强，且便于根据建筑物模型实时更新调整的优势。本发明具体采用如下技术方案。首先，为实现上述目的，提出一种实时日照检测方法，其步骤包括：第一步，根据目标建筑物所处经纬度及其高度，按照预定的时间间隙，分别计算每一时间间隙下目标建筑物所对应日照条件下的棒影光线集；第二步，分别为每一个目标建筑物确定其所对应的日照测算点，分别为每一目标建筑物启动一条日照光线遮挡算法线程，通过该日照光线遮挡算法线程对该目标建筑物的每一个日照测算点分别执行以下第三步至第七步的计算步骤；第三步，将该目标建筑物所对应的棒影光线集的二维投影范围与周围建筑物的经纬度位置进行比较，若周围建筑物处于棒影光线集的二维投影范围内，则记录该周围建筑物为障碍物并跳转至第四步，否则，跳转至第八步；第四步，按照障碍物与目标建筑物之间的距离，对各障碍物进行排序；第五步，调用所述棒影光线集至目标建筑物的各个日照测算点，按照太阳方位角的顺序分别对棒影光线集中的每一根光线标记序号；第六步，为目标建筑物的每一个日照测算点分别建立3个存储器，以其中的一号存储器存储第五步中的棒影光线集及其中每一根光线所标记的序号，以其中的二号存储器存储被障碍物遮挡的光线的序号，以其中的三号存储器存储未被障碍物遮挡的光线的序号；第七步，分别以每一个日照测算点为基点，依次对每一个障碍物进行以下判断：获取障碍物的边界与基点之间的方位角范围，从一号存储器中调取所有位于该方位角范围内的光线，判断调取所得光线是否与该障碍物相交，若相交则将该光线移动至二号存储器中，若不相交则将该光线移动至三号存储器中；第八步，按照规定的日照时长计算方式，分别调取每一日照测算点所对应的三号存储器中的光线，计算该日照测算点是否达到日照时长标准。可选的，如上任一所述的实时日照检测方法，其中，还包括：第九步，若日照测算点达到日照时长标准，则以第一显示方式在该日照测算点位置标记对应的日照时长；否则，以第二显示方式在该日照测算点位置标记对应的日照时长；其中，第二显示方式下日照时长的标记字体、字号、粗细均大于第一显示方式，第二显示方式下日照时长的标记颜色区别于所述第一显示方式。可选的，如上任一所述的实时日照检测方法，其中，还包括：第十步，每当移动或改变任一目标建筑物或周围建筑物时，均自动触发重新执行第二步至第九步。可选的，如上任一所述的实时日照检测方法，其中，所述棒影光线集由以下步骤计算获得：步骤101，根据目标建筑物所处经纬度及对应时间间隙下的赤纬角δ和真太阳时角Ω，按照sinhs＝sinφsinδ+cosφcosδcosΩ计算获得目标建筑所对应的太阳高度角hs，并按照计算获得目标建筑所对应的太阳方位角As；步骤102，计算匹配于周围建筑物最大高度H的棒影母线终端坐标点P，其中，Xp＝H×sinAs×coths，Yp＝-1×H×cosAs×coths，Zp＝H；步骤103，连接坐标原点O与上述棒影母线终端坐标点P，获得对应时间间隙下目标建筑物所对应日照条件下的棒影光线OP，该棒影光线OP的二维投影为OP0，其中，P0坐标为；步骤104，按照预定的时间间隙，分别执行上述步骤101至102，将每一时间间隙下目标建筑物所对应日照条件下的棒影光线OP的集合存储为棒影光线集。可选的，如上任一所述的实时日照检测方法，其中，所述第五步中，调用所述棒影光线集至目标建筑物的各个日照测算点的具体步骤为：分别将棒影光线集中各棒影光线OP的坐标原点移动至目标建筑物的各个日照测算点，获得匹配于该日照测算点的棒影光线O’P’，其中，P’坐标为，日照测算点的坐标为O’。可选的，如上任一所述的实时日照检测方法，其中，目标建筑物的所述日照测算点由以下步骤确定：步骤201，以逆时针顺序用多段线建立的标准层平面为基准，获取目标建筑物的标准层户型平面图形，提取标准层户型平面图形中每一个端点的坐标，记其中位于最南端的端点为Pt，记其中位于最西端的端点为PtXmin，记其中位于最东端的端点PtXmax；步骤202，若位于最南端的端点数目超过1，则确定目标建筑物的偏转角度为0，否则，确定目标建筑物存在偏转；步骤203，当确定目标建筑物存在偏转时，提取标准层户型平面图形中起点坐标值Pts与位于最南端的端点Pt重叠的边缘线段L，记该边缘线段L的终点坐标为Pte，按照该边缘线段L的方向建立向量V；步骤204，计算向量V与轴向量Vx之间的夹角，获得目标建筑物所对应的偏转值RotAngle；步骤205，根据偏转值RotAngle计算目标建筑物所对应的偏转角：当时，确定所述偏角角度为Angle＝RotAngle-90°，当时，确定所述偏角角度为Angle＝RotAngle；步骤206，以标准层户型平面图形的中心为旋转点，将标准层户型平面图形偏转-1*Angle的角度，在该状态下，获取旋转后标准层户型平面图形中各极值坐标点分别为：X’max，X’min，Y’max，Y’min，Z’；步骤207，根据各极值坐标点构建旋转后标准层户型平面图形的外接矩形，在该外接矩形的南向边缘线上按照测算点数量或间距要求标记相应的虚拟测算点；步骤208，以虚拟测算点为底端沿目标建筑物的标准户型平面做垂线，按照测算点高度要求或户型层高标记该垂线上相应坐标为初始测算点，将各所述虚拟测算点和初始测算点以标准层户型平面图形的中心为旋转中心偏转回Angle的角度，获得目标建筑户型南面所对应的日照测算点。同时，为实现上述目的，本发明还提供一种实时日照检测系统，其包括：棒影光线集生成模块，其根据目标建筑物所处经纬度及其高度，按照预定的时间间隙，分别计算每一时间间隙下目标建筑物所对应日照条件下的棒影光线集；日照测算点生成模块，其分别为每一个目标建筑物确定其所对应的日照测算点；日照光线遮挡算法模块，其分别为每一目标建筑物启动一条日照光线遮挡算法线程，通过该日照光线遮挡算法线程对该目标建筑物的每一个日照测算点分别进行棒影光线集中光线是否被遮挡的判断，以获得每一个日照测算点的光线遮挡情况；日照时长计算模块，其根据日照光线遮挡算法模块所获得的每一个日照测算点的光线遮挡情况，按照规定的日照时长计算方式，分别计算每一日照测算点所对应的未被遮挡的光线是否达到日照时长标准，若达到则以第一显示方式在该日照测算点位置标记对应的日照时长；否则，以第二显示方式在该日照测算点位置标记对应的日照时长；其中，第二显示方式下日照时长的标记字体、字号、粗细均大于第一显示方式，第二显示方式下日照时长的标记颜色区别于所述第一显示方式。可选的，如上任一所述的实时日照检测系统，其中，所述棒影光线集生成模块具体按照以下步骤计算每一时间间隙下目标建筑物所对应日照条件下的棒影光线集：步骤101，根据目标建筑物所处经纬度及对应时间间隙下的赤纬角δ和真太阳时角Ω，按照sinhs＝sinφsinδ+cosφcosδcosΩ计算获得目标建筑所对应的太阳高度角hs，并按照计算获得目标建筑所对应的太阳方位角As；步骤102，计算匹配于周围建筑物最大高度H的棒影母线终端坐标点P，其中，Xp＝H×sinAs×coths，Yp＝-1×H×cosAs×coths，Zp＝H；步骤103，连接坐标原点O与上述棒影母线终端坐标点P，获得对应时间间隙下目标建筑物所对应日照条件下的棒影光线OP，该棒影光线OP的二维投影为OP0，其中，P0坐标为；步骤104，按照预定的时间间隙，分别执行上述步骤101至102，将每一时间间隙下目标建筑物所对应日照条件下的棒影光线OP的集合存储为棒影光线集。可选的，如上任一所述的实时日照检测系统，其中，所述日照测算点生成模块具体按照以下步骤确定目标建筑物的日照测算点：步骤201，以逆时针顺序用多段线建立的标准层平面为基准，获取目标建筑物的标准层户型平面图形，提取标准层户型平面图形中每一个端点的坐标，记其中位于最南端的端点为Pt，记其中位于最西端的端点为PtXmin，记其中位于最东端的端点PtXmax；步骤202，若位于最南端的端点数目超过1，则确定目标建筑物的偏转角度为0，否则，确定目标建筑物存在偏转；步骤203，当确定目标建筑物存在偏转时，提取标准层户型平面图形中起点坐标值Pts与位于最南端的端点Pt重叠的边缘线段L，记该边缘线段L的终点坐标为Pte，按照该边缘线段L的方向建立向量V；步骤204，计算向量V与轴向量Vx之间的夹角，获得目标建筑物所对应的偏转值RotAngle；步骤205，根据偏转值RotAngle计算目标建筑物所对应的偏转角：当时，确定所述偏角角度为Angle＝RotAngle-90°，当时，确定所述偏角角度为Angle＝RotAngle；步骤206，以标准层户型平面图形的中心为旋转点，将标准层户型平面图形偏转-1*Angle的角度，在该状态下，获取旋转后标准层户型平面图形中各极值坐标点分别为：X’max，X’min，Y’max，Y’min，Z’；步骤207，根据各极值坐标点构建旋转后标准层户型平面图形的外接矩形，在该外接矩形的南向边缘线上按照测算点数量或间距要求标记相应的虚拟测算点；步骤208，以虚拟测算点为底端沿目标建筑物的标准户型平面做垂线，按照测算点高度要求或户型层高标记该垂线上相应坐标为初始测算点，将各所述虚拟测算点和初始测算点以标准层户型平面图形的中心为旋转中心偏转回Angle的角度，获得目标建筑户型南面所对应的日照测算点。可选的，如上任一所述的实时日照检测系统，其中，还包括：自动更新模块，其在接收到移动或改变任一目标建筑物或周围建筑物的指令时，均自动触发棒影光线集生成模块、日照测算点生成模块、日照光线遮挡算法模块、日照时长计算模块、重新计算以显示各照测算点所对应的新的日照时长。有益效果本发明首先根据目标建筑物所处经纬度及其高度，按照预定的时间间隙计算每一时间间隙下目标建筑物所对应日照条件下的棒影光线集。然后按照建筑物的日照测算点，分别将棒影光线集调用到各日照测算点位置，根据棒影光线集中光线是否被障碍物遮挡而实现对该日照测算点日照时间的标记。最后，按照规定的日照时长计算方式，对目标建筑物各日照测算点的日照时间进行统计，相应标识出各日照测算点的日照时长。本申请所采用的棒影光线集中的光线，不仅匹配于目标建筑物的日照方位，还能同时兼顾对不同日照时间间隙进行标记，从而能够直接通过光线是否被障碍物遮挡而获得不同日照时间间隙下日照测算点的实时光照情况，从而灵活按照不同日照时长计算方式准确实现对有效日照时长的统计。本发明的其它特征和优点将在随后的说明书中阐述，并且，部分地从说明书中变得显而易见，或者通过实施本发明而了解。附图说明附图用来提供对本发明的进一步理解，并且构成说明书的一部分，并与本发明的实施例一起，用于解释本发明，并不构成对本发明的限制。在附图中：图1是本发明的实时日照检测方法及系统所基于的日照遮挡原理的示意图；图2是图1所对应的平面俯视图；图3是图1所对应的侧面视图；图4是本发明中计算棒影光线的示意图；图5是本发明所提供的实时日照检测方法的流程示意图；图6是本发明方法中详细计算步骤的流程图；图7是本发明所获得的未达标日照测算点的未遮挡光线集及日照时长平面图图8是本发明所获得的未达标日照测算点的未遮挡光线集及日照时长透视图；图9是图8中未达标点的局部放大示意图图10是本发明所获得的未达标日照测算点的未遮挡光线集及日照时长侧视局部放大图。具体实施方式为使本发明实施例的目的和技术方案更加清楚，下面将结合本发明实施例的附图，对本发明实施例的技术方案进行清楚、完整地描述。显然，所描述的实施例是本发明的一部分实施例，而不是全部的实施例。基于所描述的本发明的实施例，本领域普通技术人员在无需创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。本技术领域技术人员可以理解，除非另外定义，这里使用的所有术语具有与本发明所属领域中的普通技术人员的一般理解相同的意义。还应该理解的是，诸如通用字典中定义的那些术语应该被理解为具有与现有技术的上下文中的意义一致的意义，并且除非像这里一样定义，不会用理想化或过于正式的含义来解释。本发明中所述的“和/或”的含义指的是各自单独存在或两者同时存在的情况均包括在内。本发明中所述的“上、下”的含义指的是正对建筑物的视角下，由地面指向太阳的方向即为上，反之即为下，而非对本发明的装置机构的特定限定。蚱蜢是一款在犀牛建模软件上的参数化平台，该平台主要用于各类三维建模。本申请基于CAD这种通用的三维建模、制图软件以及Rhino建模软件上的Grasshopper参数化平台，实现对日照光线的模拟与计算，以获得目标建筑物不同日照测算点位置日照状况的数据，从而根据该数据按照规定的计算方式对目标建筑物的有效日照时长进行判断和统计，获得建筑物的日照情况。本发明的实时日照检测系统可设置为包括：棒影光线集生成模块，其根据目标建筑物所处经纬度及其高度，按照预定的时间间隙，分别计算每一时间间隙下目标建筑物所对应日照条件下的棒影光线集；日照测算点生成模块，其分别为每一个目标建筑物确定其所对应的日照测算点；日照光线遮挡算法模块，其分别为每一目标建筑物启动一条日照光线遮挡算法线程，通过该日照光线遮挡算法线程对该目标建筑物的每一个日照测算点分别进行棒影光线集中光线是否被遮挡的判断，以获得每一个日照测算点的光线遮挡情况；日照时长计算模块，其根据日照光线遮挡算法模块所获得的每一个日照测算点的光线遮挡情况，按照规定的日照时长计算方式，分别计算每一日照测算点所对应的未被遮挡的光线是否达到日照时长标准，若达到则以第一显示方式在该日照测算点位置标记对应的日照时长；否则，以第二显示方式在该日照测算点位置标记对应的日照时长；其中，第二显示方式下日照时长的标记字体、字号、粗细均大于第一显示方式，第二显示方式下日照时长的标记颜色区别于所述第一显示方式。该系统可具体按照图5所示的方式与步骤实现对每一日照测算点所对应的日照时长的统计与计算：首先，建立棒影光线集；然后，确定户型南面日照测算点；随后，通过并行对每一目标建筑物执行日照光线遮挡算法线程，获得各目标建筑物上每一日照测算点的日照时间的实时光照情况；最后，灵活按照日照时长计算方式的要求准确实现对有效日照时长的统计。在较为具体的实现方式下，上述棒影光线集可通过以下步骤建立：1.选择所有需要测算的建筑物的最大高度作为建筑物最大高度H；将“年、月、日、时刻、地理经度、地理纬度”作为参数，通过太阳高度角的计算公式sinhs＝sinφsinδ+cosφcosδcosΩ、太阳方位角的计算公式：及相关参数修正后，得到该时刻的太阳高度角hs和太阳方位角As，其中，hs表示太阳高度角，A表示棒影方位角，As表示太阳方位角，hs表示太阳高度角，φ表示地理纬度，δ表示赤纬角，Ω表示真太阳时角；2.通过图4可知，匹配于建筑物最大高度H的棒影光线母线端点坐标可表示为x＝H×sinAs×coths，y＝-1×H×cosAs×coths，z＝H，由此可计算得到该时刻的棒影母线终端坐标点P，其中，Xp＝H×sinAs×coths，Yp＝-1×H×cosAs×coths，Zp＝H，连接P点和图4所示的坐标原点O，得到该时刻以坐标原点为日照测算点的三维棒影光线OP，将P点的Z值改为0，可得到该坐标系下0.00标高平面的二维投影点P0；3.按“时间间隙精度”改变时刻的值，重复步骤2和步骤3，得到一系列的三维棒影光线和对应的二维投影点，前者的合集本发明命名为“棒影光线集”，将所有的二维投影点按时刻顺序连接起来，并与世界坐标原点O共同构成二维图形，本发明将其命名为棒影光线集的二维投影边界线，简称“投影边界线”。由太阳高度角的计算公式sinhs＝sinφsinδ+cosφcosδcosΩ、太阳方位角的计算公式：及P等相关修正参数可知，在指定的地理经纬下，可由具体时刻计算得到该地区的太阳高度角和太阳方位角，从而可以得到指定棒高的棒影光线。因此，可以在一段时间内将时间细分为相邻连续的时刻，细分的时刻越多，棒影光线也越多，越能准确模拟太阳光线的入射情况，反之则越不准确。本发明将各个连续时刻之间的时间差命名为“时间间隙精度”，如：当时间间隙精度为5分钟时，连续的时刻为8:05、8:10、8:15、8:20......每根棒影光线的间隔时长为5分钟；当时间间隙精度为1分钟时，连续的时刻为8:01、8:02、8:03、8:04......每根棒影光线的间隔时长为1分钟。但是时间每分每秒都在变化，不可能计算每时每刻的棒影光线，因此，本发明认为在设置了“时间间隙精度”的前提下，可将各个时刻的棒影光线视为代表了该时刻前后一小段时间，这小段时间的数值则等于“时间间隙精度”。具体为，当时间间隙精度为1分钟时，8:01时刻的棒影光线代表了8:00:30至8:01:30期间1分钟的时长。通过上述论证，本发明论述的每根棒影光线有两种属性，其一是具体时刻下棒影光线的空间位置，其二是代表了一段时长，且该时长的数值等于“时间间隙精度”。因此，在“时间间隙精度”的前提下，可用多根棒影光线来代表一大段时长，将时刻、时长和棒影光线集的数量三者结合起来，如下式所示：T＝t×N，；其中：T表示时长；t表示时间间隙精度；N表示棒影光线集的光线数量。4.确认户型南面显著影响日照时长数值的日照测算点。住宅楼的三模模型一般采用标准层平面Plan作为底面建立高度H的模型Brep，且整体形态类似矩形。因此本发明将标准层平面Plan作为获取测算点的目标，使用平面为默认建模平面Plane.WorldXY，具体步骤如下：共分为3步：步骤401：按逆时针顺序用多段线建立标准层户型平面，检测该户型平面相对于方向的偏转角度Angle，逆时针为正，顺时针为负；具体计算方式如下：4001.按照逆时针顺序，用多段线建立标准层平面Plan；4002.获取标准层平面Plan各个端点的坐标，找出Y值最小的端点Pt，X值最小的点PtXmin，X值最大的点PtXmax；4003.判Y值最小的点的数量，若不为1，则说明标准层平面Plan相对于平面PlaneXY无偏转，角度为0°，若为1，则说明有偏转；4004.当Y值最小的点的数量为1时，在标准层平面Plan的所有线段中，获取起点坐标值Pts等于坐标值Pt的线段L，L的终点坐标为Pte，并按照L的方向建立向量V；4005.用向量V与世界坐标正X轴向量VX做夹角分析，获得偏转角度RotAngle；4006.偏转方向适应世界坐标系，以Rhino/Grasshopper为例，顺时针为负，逆时针为正：当偏角角度为Angle＝RotAngle-90°；当偏角角度为Angle＝RotAngle；步骤402：将户型以户型平面的中心点为旋转点CenterPt，偏转-1*Angle的角度，旋转至无偏转状态，即偏转角度为0°，在该状态下，获取户型平面所有点的坐标的极值，以此构建户型外接矩形的南向的两个顶点，即、，从而建立南向线，并按照测算点数量或者间距在该线段建立虚拟的日照测算点；步骤403：用虚拟测算点与标准户型平面做垂线，垂点为该平面的原始测算点，调整Z值来构造不同标高处的测算点，再将这些测算点以CenterPt为中心点偏转Angle，使其回到初始状态，从而得到“户型南面日照测算点”5.将该目标建筑物所对应的棒影光线集的二维投影范围与周围建筑物的经纬度位置进行比较，若周围建筑物处于棒影光线集的二维投影范围内，则记录该周围建筑物为障碍物并跳转至第6步，否则，跳转至第10步；6.按照障碍物与目标建筑物之间的距离，对各障碍物进行排序；7.调用所述棒影光线集至目标建筑物的各个日照测算点，按照太阳方位角的顺序分别对棒影光线集中的每一根光线标记序号；8.为目标建筑物的每一个日照测算点分别建立3个存储器，以其中的一号存储器存储第五步中的棒影光线集及其中每一根光线所标记的序号，以其中的二号存储器存储被障碍物遮挡的光线的序号，以其中的三号存储器存储未被障碍物遮挡的光线的序号；9.分别以每一个日照测算点为基点，依次对每一个障碍物进行以下判断：获取障碍物的边界与基点之间的方位角范围，从一号存储器中调取所有位于该方位角范围内的光线，判断调取所得光线是否与该障碍物相交，若相交则将该光线移动至二号存储器中，若不相交则将该光线移动至三号存储器中；10.按照规定的日照时长计算方式的要求，分别调取每一日照测算点所对应的三号存储器中的光线，计算该日照测算点是否达到日照时长标准。下面对上述方案所采用的日照光线遮挡算法原理进行说明。参照图1、图2及图3所示。日照测算点无光线入射的条件需同时满足以下两式：minAs≤As≤maxAs；其中：minAs:测算点南面建筑物与测算点形成的关相对于正南向的最小夹角，即∠COS，图2中为OC与正南向的夹角；maxAs：测算点南面建筑物与测算点形成的关相对于正南向的最大夹角，即∠DOS，图2中为OD与正南向的夹角；As：该地该时刻都太阳方位角，图1中为∠BOS；H:测算点南面建筑物的高度，图1中为2#建筑的高度；Hp2:测算点南面建筑物底部至0.00标高处的相对标高，图1中为2#建筑底部标高；Hp1:测算点所在的建筑底部至0.00标高处的相对标高，图1中为1#建筑底部标高；ho:测算点至所在建筑底部的高度，图3中为O点至1#建筑底部所在平面的高度；LAs：该地该时刻的太阳方位角As的竖直平面内，测算点至南面建筑物的最短距离，图3中为OB的长度；hs：该地该时刻的太阳高度角，图3中为∠LOB。图1至3中各字母意义解释：1#、2#:编号为1、2的两栋建筑O：1#建筑南面的日照测算点；A：太阳光线OL穿过2#建筑后更靠近O点侧的交点；B：A点在O点所在平面的投影点；C：2#建筑边界和O点所连的线段，与正南向形成最小夹角的点；D：2#建筑边界和O点所连的线段，与正南向形成最大夹角的点；H：2#建筑的高度；L：虚拟的某地具体时刻的太阳位置；S：O点所在平面的正南方向EastWestSouthNorth：±0.00标准平面的东、西、南、北方向线；OL：该地该时刻的太阳光线；下面以图7、图8所示场景具体说明应用上述原理实现对日照光线遮挡情况的计算过程。参照图6所示：步骤一：录入日期信息、经纬度信息、日照标准时长、时间间隙精度、住宅建筑高度信息，建立该精度条件下当地的太阳方位角和太阳高度角数据集，根据方位角数据集、高度角数据集和建筑物参数计算获得该建筑的三维棒影光线集，以及三维棒影光线集的二维投影，以此建立二维投影边界线。步骤二：对每栋建筑启动并行线程。每线程均分别执行以下的步骤三至步骤八。每栋建筑各自的线程相互独立，线程能够按照步骤一种的棒影光线集对应为每栋建筑的每个日照测算点计算其没有被遮挡的光线。步骤三：对每栋楼设定测算点标高、间隙或数量，在栋楼南面生成必要的日照测算点。步骤四：用棒影光线集的二维投影边界线检测栋楼是否有障碍物，若没有任何障碍物，则将该楼栋的所有测算点及其日照时长数据输出，时长数值设定为当地要求的标准日照时长，跳转至步骤九；若有障碍物，则继续后续步骤。步骤五：对该栋楼的障碍物按照距离由近及远重新排序；步骤六：对每个栋楼的测算点，调用步骤一中相应高度的棒影光线集至测算点，并为该点的每根光线标记序号，该序号数据与步骤一中的太阳方位角数据集序号一一对应。步骤七：对每个测算点建立三个数据储存器，一号储存器用于储存步骤六中的棒影光线集及序号，二号储存器用于储存所有被遮挡光线的序号，三号储存器用于储存未被遮挡的光线及其序号；步骤八：以测算点为基点，获取步骤五中第一个障碍物边界与基点之间的方位角范围，在一号储存器中读取该范围内的所有棒影光线及序号，用这些光线与障碍物做相交判断，若相交则表明该光线被遮挡，将被遮挡光线的序号储存在二号储存器中，若不相交则表示该光线未被遮挡，将光线及序号储存在三号储存器中。对第二个及之后的障碍物进行同样的太阳方位角范围获取流程，并在一号储存器中获取每次方位角范围内的棒影光线及序号，判断这些光线的序号是否已在二号储存器中，若已在，则不需要再进行相交判断，若不在，则继续做相交判断，将判断结果分别储存在二号或三号储存器内。重复该步骤的流程直至判断完所有障碍物，最终获得该测算点三号储存器的数据，即未被遮挡的光线及序号。步骤九：按照当地要求的日照时长累计方式对每个测算点输出的日照数据做处理，得到符合要求的日照时长。示例：当地要求的日照时长累计方式为：大寒日2小时日照标准，累计不超过2段，且每段不小于30分钟。实际日照过程中，假设某测算点处的受到太阳光线照射的时间段为9:00-9:25，10:20-11:15，14:40-15:25，连续时间分别为25分钟、55分钟、45分钟，实际累计有3段时间共2.08小时。但是按照前述累计方式，应该取时长较大的前2段且≥30分钟的时间段计算，则符合规定的时间段为10:20-11:15和14:40-15:25，按照规范累计共1.67小时，此时则不满足规范要求的2小时日照标准。规范比实际情况更加严格。对时长T的具体计算方式为：901.获取步骤七结束后的三号储存器，该储存器储存了未被遮挡的光线及其序号；902.按照相邻两序号差值为1的标准对三号储存器进行分组，获得K0组数据；903.统计每组的光线数量Nk，按照T＝t×N计算方法对数据Nk进行时长计算Tk,若时长Tk不足30分钟则舍去，否则保留；其中，t表示时间间隙精度，N表示棒影光线集的光线数量；904.按照Tk的大小排序，取其前2组数据T1、T2，不足2组则取1组T1，累加T1、T2或T2的时长，得到最终时长。步骤十：判断步骤九中每个测算点的日照时长是否符合当地规范要求的日照标准，若符合，则仅在测算点处显示日照时长，显示属性为黑色、大小固定的数值；若不符合，则在该测算点处显示未被遮挡的光线集，日照数值显示属性为红色、字体大小随窗口大小同比例缩放，显示为图9或图10效果。步骤十一：在CAD平台上，可以通过设置程序获取鼠标或键盘信号来重启程序，并自动重复步骤一至十；而在Grasshopper平台上，通过检测任意建筑参数的改动或任意建筑模型的移动时重启程序，并自动重复步骤一至十。综上，本发明首先计算每一时间间隙下目标建筑物的日照条件，以棒影光线集的形式进行记录。然后按照建筑物的日照测算点，分别将棒影光线集调用至各日照测算点位置，根据棒影光线集中光线是否被障碍物遮挡而实现对日照时间的标记。最后，按照规定的计算方式，对各日照测算点的有效日照时间进行统计，获得各日照测算点的日照时长。本申请所采用的棒影光线集中的光线，不仅匹配于目标建筑物的日照方位，还同时兼顾对不同日照时间间隙进行标记，能够直接通过光线是否被障碍物遮挡而获得不同日照时间间隙下日照测算点的实时光照情况，灵活按照日照时长计算方式的要求准确实现对有效日照时长的统计。本申请的优势在于：1.仅计算必要日照测算点的日照光线遮挡情况，节省计算资源本发明建立了一套可在住宅户型南面的指定标高处生成指定数量或间距的日照测算点的算法，该算法不计算非必要的日照点，极大地节省了计算资源；并且采用多线程编码，充分利用计算机的CPU资源，加快运算速度。2.动态日照显示选择在CAD/Rhino三维建模平台上，加入特定指令，算法程序可以随建筑物模型调整同步更新计算，同步显示。可简化操作人员反复操作的流程和时间，使得操作更加流畅便捷。3.日照数值视觉可读性良好本发明建立了简洁的日照时长显示方式：只在必要的测算点出建立日照显示，排除非必要点的视觉干扰。每个测算点处都会按照“日照时长累计方式”计算并显示出该点的日照数值，数值有颜色和大小两种属性；当日照数值未达到标准日照时长时，该数值显示为红色，字体大小与操作窗口大小成固定比例，随窗口大小同比例缩放；当达标时，数值显示为黑色且字体大小为固定值，不随窗口大小变化而变化。可排除非必要点的视觉影响，排除已达标点的干扰，增强日照数据的可读性，避免因人为因素而造成的判断错误。4.多种日照时长计算方式建立了多种日照时长累计方式：方式1为累计有效时段内的所有日照时间，方式2为目前绝大部分地方住宅建筑日照规范的要求，即分段累计连续日照时长，如日照标准为大寒日2小时，连续日照时间段不超过2段，且每段不小于30分钟。其中“大寒日”、“2小时”、“2段”、“30分钟”为变量，不同地区可能不同。本发明可方便快捷地满足各地方日照规范和各类计算法则，大幅减少因算法不同导致的日照重新检测工作。5.清晰的日照时长和遮挡关系。本发明通过将光线遮挡情况和日照时长数值直观地联系起来，可清楚便捷地展示两者的关系，提高操作人员调整建筑布局的效率。5.1在日照棒影图和日照圆锥图的原理上，将日照圆锥图中的定值长度母线改良为基于测算建筑物中的最大高度而生成的非定值长度线，再以日照棒影图为基础，将扇面网状的形态改良为以各个时刻的非定值长度线组成的扇面光线集，本发明将这种光线集命名为“棒影光线集”，该光线集的精度由光线数量决定，光线数量越多，精度越高；5.2将棒影光线集应用在每个日照测算点上，获取该点的光线集与周边建筑精确的遮挡关系，同时按照“日照时长累计方式”计算得到测算点的日照时长，当时长不达标时，按照本发明建立的显示方式来显示日照数值；5.3仅当测算点日照时长未达到标准时，将显示该点处未被遮挡的棒影光线集，达标的则不显示，从而排除达标测算点的视觉干扰，清晰地展示遮挡关系。本发明融合了日照棒影图和日照圆锥图两者的优点。a.同传统的日照圆锥图一样，依旧能显示各个时刻太阳光线入射到测算点的空间位置和角度，不同的是每根不同长度的线，本质上展示的是不同时刻下，能影响测算点日照时长的区域范围，即若与某根线有交集，则遮挡该光线，反之，没有交集则不遮挡该光线；b.各个时刻的线构成了空间上的连续面，此时整体形态同传统的日照棒影图相似，区别形态是由线而不是曲面构成，因此可以清晰地计算并展示未被遮挡的光线，传统的日照棒影图是不能展示具体每根光线的遮挡关系以上仅为本发明的实施方式，其描述较为具体和详细，但并不能因此而理解为对本发明专利范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本发明构思的前提下，还可以做出若干变形和改进，这些均属于本发明的保护范围。
