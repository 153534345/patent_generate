标题title
基于FPGA的超声波管道测厚方法
摘要abst
本发明提供了一种基于FPGA的超声波管道测厚方法，能够实现管壁厚度的高精度测量。本发明通过FPGA对超声波回波信号的数字采样信号进行计算，得到所述超声波在被测管道中的飞行时间；其中，选取除第一回波外的包含两个回波的区间作为计算区域；通过选择震荡波少的正幅值部分或负幅值部分，可以更好的查找到有效回波；从选择部分的第一个回波中寻找幅度绝对值最大的点，在仪器的动态范围内，能准确的获取回波信号的最高值；将样本波形与多段待匹配波形分别做互相关运算，准确找到二次回波，然后通过寻找幅度绝对值最大的点得到目标点，能够避免波形畸变可能引起的误差，保证获取到准确的飞行时间，提高测量精度。
权利要求书clms
1.一种基于FPGA的超声波管道测厚方法，将收发一体的超声波探头贴在被测管道外壁上；向被测管道发射脉冲超声波信号；接收被测管道反射回的回波信号；对接收到的回波信号进行数字采样，得到数字采样信号；对所述数字采样信号进行计算，得到超声波在被测管道中的飞行时间T；将超声波在管壁材料中的传播声速乘以T/2得到被测管道壁厚；其特征在于，通过FPGA对所述数字采样信号进行计算，得到超声波在被测管道中的飞行时间，包括如下步骤：从所述数字采样信号中，选取除第一回波外的一段连续区间作为计算区域，所述计算区域包括两个回波；在计算区域中进行如下计算：针对计算区域中回波的正幅值部分或负幅值部分，选择震荡波少的一部分，从该部分的第一个回波中寻找幅度绝对值最大的点，以该点为中心，左右各取0.6-0.8个周期，得到样本波形及样本波形中的采样点总数N，所述周期为发射的脉冲超声波信号的周期；从样本波形之后的波形中依次选择N个点，直至计算区域最后N个点，得到多段待匹配波形，其中，第一段待匹配波形的起始点为样本波形末尾时刻，后续段待匹配波形的起始点均为各自前一段待匹配波形的起始点后移一个点；将样本波形与多段待匹配波形分别做互相关运算，找到相关值最大的一段待匹配波形，将该段待匹配波形中幅度绝对值最大的点作为目标点，得到样本波形的中心点和目标点之间的采样点数M；所述超声波在被测管道中的飞行时间T为：T=/F，其中F为所述数字采样的采样频率。2.如权利要求1所述的测厚方法，其特征在于，FPGA接收到数字采样信号后，先对数字采样信号进行16倍插值，再对插值后的信号进行后续计算。3.如权利要求1或2所述的测厚方法，其特征在于，超声波在管壁材料中的传播声速为：f=px+q，其中x代表当前温度值；f 代表当前传播声速值；系数p和q为常数值, 通过超声波测量厚度值与温度值之间关系获得。4.如权利要求3所述的测厚方法，其特征在于，超声波测量厚度值与温度值之间关系通过实验获得，所述实验包括如下步骤：先通过水中加冰调配冰水混合物，将温度降到0℃，将不同厚度的试块分别放入到冰水混合物中，然后通过电阻加热棒、温度热电偶以及磁力搅拌来实现升温加热，每升0.3℃采集一次温度与厚度数据并记录；其中，采用温度传感器进行温度采集，温度传感器量程为-55到 125℃，温度的测量精度为±0.1℃；所述超声波测厚设备的超声探头采用频率为5MHz的单晶直探头，探头通过夹具固定在试块上。5.如权利要求4所述的测厚方法，其特征在于，所述试块的材质是碳钢，厚度尺寸包括10mm、20mm和40mm。
说明书desc
技术领域本发明涉及超声波测厚技术领域，具体涉及一种基于FPGA的超声波管道测厚方法。背景技术在石油化工行业，油气输送管道腐蚀一直是最受关注的安全风险之一，管道因腐蚀而产生破损，具有一定的危险性，轻则产生油气泄漏而污染环境，重则产生爆炸而危害人们的生命财产安全，因此需要对易腐蚀部位进行定期的检测，根据管壁厚度的变化程度，判定油气输送管道的腐蚀程度。早期是由平台或设备巡检人员采用手持离线超声测厚仪，定期、定点获取管道的壁厚值，计算出管道的腐蚀速率，但是这种方式的测量非常不方便，并且有时部分管线人员难以及时到达。因此非人工接触的管道实时在线测厚技术置一直是国内外的关注的重点。近年来，在针对管道腐蚀问题通常采用超声波测厚技术对管壁厚度进行定期检测，超声波测厚技术是一种主动式无损检测技术，其中脉冲反射法是超声波测厚常用的方法之一，将超声波探头贴在被测管道外壁上，将管道内壁的一次回波信号与二次回波信号的传输时间差与超声波在管壁材料中的传播声速相乘，得到管壁的厚度，进而确定管壁腐蚀情况。其中，一次回波信号为管道内壁对超声波探测信号反射的回波信号，二次回波信号为管道内壁对经过管道外壁反射的超声波探测信号再反射的回波信号；一次回波信号与二次回波信号的传输时间差是接收一次回波信号时间参考点与接收二次回波信号的时间参考点之间的时间。因此在传播声速确定的情况下，准确获取一次回波信号与二次回波信号的时间参考点，是提高测厚精度的关键。目前，通常是在设定范围内找到一个或两个高于阈值的回波，将峰值点或过零点作为回波信号时间参考点，通过计算一次回波信号与二次回波信号时间参考点的差，得到传输时间差。但是，由于回波均有多个峰值，如果检测仪器灵敏度提高，峰值点就会前移，导致回波时间出现变化；过零点可能是有多个也可能恰好没有。这些都会导致最终测量结果的不准确。另外，由于储气井壁反射面可能附着油污或者检测设备摆放引起的角度变化等，会使波形出现畸变，探头接收到的回波信号波形并不是理想的振荡波形，采用现有的方法不能保证获取到准确的时间差，导致测量的厚度发生变化，使得测量精度下降。另外，超声波在管壁材料中的传播声速受温度影响严重，不考虑温度因素，直接利用理论传播声速进行厚度计算也会导致测量精度下降。发明内容有鉴于此，本发明提供了一种基于FPGA的超声波管道测厚方法，能够实现管壁厚度的高精度测量。为实现上述目的，本发明的技术方案如下：一种基于FPGA的超声波管道测厚方法，将收发一体的超声波探头贴在被测管道外壁上；向被测管道发射脉冲超声波信号；接收被测管道反射回的回波信号；对接收到的回波信号进行数字采样，得到数字采样信号；对所述数字采样信号进行计算，得到超声波在被测管道中的飞行时间T；将超声波在管壁材料中的传播声速乘以T/2得到被测管道壁厚；通过FPGA对所述数字采样信号进行计算，得到超声波在被测管道中的飞行时间，包括如下步骤：从所述数字采样信号中，选取除第一回波外的一段连续区间作为计算区域，所述计算区域包括两个回波；在计算区域中进行如下计算：针对计算区域中回波的正幅值部分或负幅值部分，选择震荡波少的一部分，从该部分的第一个回波中寻找幅度绝对值最大的点，以该点为中心，左右各取0.6-0.8个周期，得到样本波形及样本波形中的采样点总数N，所述周期为发射的脉冲超声波信号的周期；从样本波形之后的波形中依次选择N个点，直至计算区域最后N个点，得到多段待匹配波形，其中，第一段待匹配波形的起始点为样本波形末尾时刻，后续段待匹配波形的起始点均为各自前一段待匹配波形的起始点后移一个点；将样本波形与多段待匹配波形分别做互相关运算，找到相关值最大的一段待匹配波形，将该段待匹配波形中幅度绝对值最大的点作为目标点，得到样本波形的中心点和目标点之间的采样点数M；所述超声波在被测管道中的飞行时间T为：T=/F，其中F为所述数字采样的采样频率。其中，FPGA接收到数字采样信号后，先对数字采样信号进行16倍插值，再对插值后的信号进行后续计算。其中，超声波在管壁材料中的传播声速为：f=px+q，其中x代表当前温度值；f 代表当前传播声速值；系数p和q为常数值, 通过超声波测量厚度值与温度值之间关系获得。其中，超声波测量厚度值与温度值之间关系通过实验获得，所述实验包括如下步骤：先通过水中加冰调配冰水混合物，将温度降到0℃，将不同厚度的试块分别放入到冰水混合物中，然后通过电阻加热棒、温度热电偶以及磁力搅拌来实现升温加热，每升0.3℃采集一次温度与厚度数据并记录；其中，采用温度传感器进行温度采集，温度传感器量程为-55到 125℃，温度的测量精度为±0.1℃；所述超声波测厚设备的超声探头采用频率为5MHz的单晶直探头，探头通过夹具固定在试块上。其中，所述试块的材质是碳钢，厚度尺寸包括10mm、20mm和40mm。有益效果：本发明通过FPGA对超声波回波信号的数字采样信号进行计算，得到所述超声波在被测管道中的飞行时间；其中，选取除第一回波外的包含两个回波的区间作为计算区域，避免了波形误计算，提高精度的同时提高了计算效率；通过选择震荡波少的正幅值部分或负幅值部分，避免震荡波过多对相关性判断的影响，可以更好的查找到有效回波；从选择部分的第一个回波中寻找幅度绝对值最大的点，在仪器的动态范围内，能准确的获取回波信号的最高值，回波高度变化不会影响回波时间，精度可以得到保证；将样本波形与多段待匹配波形分别做互相关运算，准确找到二次回波，然后通过寻找幅度绝对值最大的点得到目标点，能够避免波形畸变可能引起的误差，保证获取到准确的飞行时间，提高测量精度。本发明中，还包括了先对超声波回波信号的数字采样信号进行插值的过程，对插值后的波形进行及后续计算，进一步提高了测量精度。本发明考虑了超声波在管壁材料中的传播声速受温度的影响，增加了对超声波在管壁材料中的传播声速进行温度补偿的步骤，利用温度补偿后的传播声速进行厚度计算，进一步提高测量了精度。附图说明图1为本发明方法流程图。图2为本发明中的计算区域示意图。图3为本发明从计算区域中选择的震荡波少的正幅值部分或负幅值部分示意图。图4为本发明温度补偿中10mm试块温度与厚度关系示意图。图5为本发明温度补偿中20mm试块温度与厚度关系示意图。图6为本发明温度补偿中40mm试块温度与厚度关系示意图。具体实施方式下面结合附图并举实施例，对本发明进行详细描述。本发明基于FPGA的超声波测厚方法，流程图如图1所示，包括如下步骤：将收发一体的超声波探头贴在被测管道外壁上；向被测管道发射脉冲超声波信号；接收被测管道反射回的回波信号；对接收到的回波信号进行数字采样，得到数字采样信号；通过FPGA对所述数字采样信号进行计算，得到超声波在被测管道中的飞行时间T；将超声波在管壁材料中的传播声速乘以T/2得到被测管道壁厚；其中，通过FPGA对所述数字采样信号进行计算的具体方式为:从所述数字采样信号中，选取除第一回波外的一段连续区间作为计算区域，所述计算区域包括两个回波，计算区域如图2所示；在计算区域中进行如下计算：针对计算区域中回波的正幅值部分或负幅值部分，选择震荡波少的一部分，从该部分的第一个回波中寻找幅度绝对值最大的点，以该点为中心，左右各取0.6-0.8个周期，得到样本波形及样本波形中的采样点总数N，所述周期为发射的脉冲超声波信号的周期，由探头频率决定；从样本波形之后的波形中依次选择N个点，直至计算区域最后N个点，得到多段待匹配波形，其中，第一段待匹配波形的起始点为样本波形末尾时刻，后续段待匹配波形的起始点均为各自前一段待匹配波形的起始点后移一个点；将样本波形与多段待匹配波形分别做互相关运算，找到相关值最大的一段待匹配波形，将该段待匹配波形中幅度绝对值最大的点作为目标点；得到样本波形的中心点和目标点之间的采样点数M；所述超声波在被测管道中的飞行时间T为：T=/F，其中F为所述数字采样的采样频率。本发明的样本波形是以中心点左右各取0.6-0.8个周期得到的，其中0.6-0.8个周期是经过分析得出的，样本波形的周期不能太大也不能太小。如图2所示计算区域的第一个回波中，若样本波形只为脉冲超声波信号的一半，则可能会将某段震荡波作为相关值最大的一段待匹配波形，计算出的飞行时间会严重与实际不符；若样本波形为脉冲超声波信号的2倍，则可能会找不到与其相关值最大的一段待匹配波形，导致计算不出飞行时间，考虑到上述因素，本发明的样本波形是以中心点左右各取0.6-0.8个周期得到的。进一步地，为提高测量精度，FPGA接收到数字采样信号后，先对数字采样信号进行16倍插值，再对插值后的信号进行后续计算。另外，超声波测厚方法中，测量厚度为传播声速与两个回波时间差的乘积，传播声速的变化会导致两个回波之间时间差的变化，由此，本发明通过实验测试得到超声波测量厚度值与温度值之间的关系，其中超声波测量厚度值计算时采用试块的校准传播声速进行计算，因此根据超声波测量厚度值与温度值之间的关系得到温度与两个回波之间时间差的关系，进而间接反应超声波在不同温度下不同的传播速度即传播声速。通过实验测试数据可以发现温度与超声波的传播声速成线性相关关系，由此建立线性回归模型f=px+q，其中x代表当前温度值，f 代表当前传播声速值，系数p和q为根据超声波测量厚度值与温度值之间的关系得到的常数值；将f作为超声波在管壁材料中的传播声速进行计算，考虑了超声波在管壁材料中传播声速的温度影响，进一步提高了测量精度。具体地，以碳钢为例，本发明搭建厚度和温度的实验平台进行温度厚度实验，包括如下步骤：先通过水中加冰调配冰水混合物，将温度降到0℃，将不同厚度的试块分别放入到冰水混合物中，然后通过电阻加热棒、温度热电偶以及磁力搅拌来实现升温加热，每升0.3℃采集一次温度与厚度数据并记录。其中，采用温度传感器进行温度采集，温度传感器量程为-55到 125℃，温度的测量精度为±0.1℃。采用超声波测厚设备进行厚度采集，超声探头采用的是频率为5MHz的单晶直探头，一个探头实现超声波的发射和接收，探头通过夹具固定在试块上。试块的材质是碳钢并符合国家的标准，分别有 10mm、20mm和40mm的厚度尺寸。为了测试实验的准确性，需尽可能多的进行数据采集，实验的温度范围是0到 70℃；10mm、20mm以及40mm试块厚度与温度测试数据分别如图4、图5和图6所示。图4为本发明温度补偿中10mm试块温度与厚度关系示意图；图5为本发明温度补偿中20mm试块温度与厚度关系示意图；图6为本发明温度补偿中40mm试块温度与厚度关系示意图。从测试数据形成的趋势图可以看出，测得的厚度值与温度值成正向关系，温度值增加测得的厚度值也增加，由此反映出温度值与传播声速之间为负相关关系，这是因为温度增加，测得的厚度增加，而计算是采用的传播声速是不变的，说明两个回波之间的时间差增加，传播声速减少。同时从图3-5中可以看出测得的厚度值与温度值成线性关系，间接的也反映出温度值与传播声速也成线性关系，但曲线不是很平稳，原因是由于传播声速过快，试块厚度较薄，所以测得的误差也相对较大。通过对20mm试块的数据测试，从形成的测得厚度与温度之间的关系图可以看出，曲线较10mm试块变的更加平滑，线性关系更加明显；40mm试块的测试结果温度与测得的厚度曲线显示两者基本成线性关系，这也间接反映出温度与传播声速之间的线性关系。综上所述，以上仅为本发明的较佳实施例而已，并非用于限定本发明的保护范围。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
