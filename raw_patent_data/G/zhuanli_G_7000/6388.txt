标题title
一种基于光单向传输的时钟同步方法及系统
摘要abst
本发明提出的一种基于光单向传输的时钟同步方法及系统，所述方法包括：判断当前传输通道内是否有待传输的数据；若是，通过数据发送端将待传输的数据转换为8b/10b编码数据后嵌入时钟信号，并发送到数据接收端；数据接收端收到数据后，从数据中抽取出时钟信号，进行与数据发送端的时钟同步；若否，通过数据发送端定时向数据接收端发起重连通道链路的请求，数据接收端接收到所述请求后重新建立通道链路，并进行时钟同步。本发明能够使数据发送端和数据接收端自动建立时钟同步，从而避免因同步问题导致的通信错误。
权利要求书clms
1.一种基于光单向传输的时钟同步方法，其特征在于，包括：判断当前传输通道内是否有待传输的数据；若是，通过数据发送端将待传输的数据转换为8b/10b编码数据后嵌入时钟信号，并发送到数据接收端；数据接收端收到数据后，从数据中抽取出时钟信号，进行与数据发送端的时钟同步；若否，通过数据发送端定时向数据接收端发起重连通道链路的请求，数据接收端接收到所述请求后重新建立通道链路，并进行时钟同步。2.根据权利要求1所述的基于光单向传输的时钟同步方法，其特征在于，所述通过数据发送端将待传输的数据转换为8b/10b编码数据后嵌入时钟信号，并发送到数据接收端，具体包括：在数据发送端，使用8b/10b编码器将待传输的数据转换成直流平衡的10bit的8b/10b编码数据，插入comma控制字符即嵌入同步信号，并通过并串转换将10位编码结果转为串行码，最后将串行码流转换成差分信号，经光纤数据传输通道发送到数据接收端。3.根据权利要求2所述的基于光单向传输的时钟同步方法，其特征在于，所述数据接收端收到数据后，从数据中抽取出时钟信号，进行与数据发送端的时钟同步，具体包括：在数据接收端，将接收的差分信号还原为串行信号，经时钟恢复电路从串行信号中抽取出时钟信号，并完成对串行数据的采样；进行8b/10b解码，将串行数据还原为8bit格式数据；通过comma检测器检测8bit格式数据中的comma字符，通过数据边界对齐，进行与数据发送端的时钟同步。4.根据权利要求1所述的基于光单向传输的时钟同步方法，其特征在于，所述通过数据发送端定时向数据接收端发起重连通道链路的请求，数据接收端接收到所述请求后重新建立通道链路，并进行时钟同步，具体包括：使用定时器设置请求发起时间；在数据发送端根据请求发起时间定时向数据接收端发起重连通道链路请求；数据接收端接收到请求后依次进行通道链路初始化、通道链路绑定和通道链路验证，验证通过即完成通道链路的重建和时钟同步；验证不通过则继续进行通道初始化。5.根据权利要求4所述的基于光单向传输的时钟同步方法，其特征在于，所述通道链路初始化具体为：初始化串行通道链路，确定通道宽度、通道链路的速率、通道通信模式、通道的分配和数据的大小端模式；激活通道链接，并对通道边界进行对齐。6.根据权利要求4所述的基于光单向传输的时钟同步方法，其特征在于，所述通道链路绑定具体为：将通道链路与对应的光纤通道进行绑定。7.根据权利要求4所述的基于光单向传输的时钟同步方法，其特征在于，所述通道链路验证包括：将需要映射到用户接口的数据，进行数据的对齐和时钟的同步；检查通道链路信号的完整性；判断当前通道链路传输数据能力是否达到预设传输能力；若是，则当前通道链路通过通道链路验证。8.一种基于光单向传输的时钟同步系统，其特征在于，包括：判定单元，用于判断当前传输通道内是否有待传输的数据；发送单元，用于通过数据发送端将待传输的数据转换为8b/10b编码数据后嵌入时钟信号，并发送到数据接收端；同步单元，用于数据接收端收到数据后，从数据中抽取出时钟信号，进行与数据发送端的时钟同步；通道链路重建单元，用于通过数据发送端定时向数据接收端发起重连通道链路的请求，数据接收端接收到所述请求后重新建立通道链路，并进行时钟同步。
说明书desc
技术领域本发明涉及数据传输技术领域，更具体的说是涉及一种基于光单向传输的时钟同步方法及系统。背景技术随着全球信息化的飞速发展，网络信息系统在各个行业发挥着越来越大的作用，网络信息的安全性问题日渐突出。出于网络安全和信息保密的要求，内外网办公成为一种趋势；为满足办公外网到办公内网数据单向传输的应用需求，基于光的单向传输原理提出了光单向传输方法：发送端数据经光模块转换为光信号，通过光纤单向传输到接收端，接收端再将光信号转换为相应的数据，由此，通过光单向传输方法实现了从外网设备到内网设备的单向数据传输。正常的数据传输需要有数据发送端与接收端之间的同步机制；但在单向传输模式下，不允许存在从接收端向发送端传输的反馈通道，也就是无法形成环回链路，因此发送端无法收到接收端的反馈信号，也就很难完成两者的同步。发送端也无法知道数据在传送过程中是否发生了差错，而单向传输一旦出现通信错误，必须要重启发送端和接收端才能恢复正常工作。发明内容针对现有技术中存在的问题，本发明的目的在于提供一种基于光单向传输的时钟同步方法及系统，能够使数据发送端和数据接收端自动建立时钟同步，从而避免因同步问题导致的通信错误。本发明为实现上述目的，通过以下技术方案实现：一种基于光单向传输的时钟同步方法，包括：判断当前传输通道内是否有待传输的数据；若是，通过数据发送端将待传输的数据转换为8b/10b编码数据后嵌入时钟信号，并发送到数据接收端；数据接收端收到数据后，从数据中抽取出时钟信号，进行与数据发送端的时钟同步；若否，通过数据发送端定时向数据接收端发起重连通道链路的请求，数据接收端接收到所述请求后重新建立通道链路，并进行时钟同步。进一步，所述通过数据发送端将待传输的数据转换为8b/10b编码数据后嵌入时钟信号，并发送到数据接收端，具体包括：在数据发送端，使用8b/10b编码器将待传输的数据转换成直流平衡的10bit的8b/10b编码数据，插入comma控制字符即嵌入同步信号，并通过并串转换将10位编码结果转为串行码，最后将串行码流转换成差分信号，经光纤数据传输通道发送到数据接收端。进一步，所述数据接收端收到数据后，从数据中抽取出时钟信号，进行与数据发送端的时钟同步，具体包括：在数据接收端，将接收的差分信号还原为串行信号，经时钟恢复电路从串行信号中抽取出时钟信号，并完成对串行数据的采样；进行8b/10b解码，将串行数据还原为8bit格式数据；通过comma检测器检测8bit格式数据中的comma字符，通过数据边界对齐，进行与数据发送端的时钟同步。进一步，所述通过数据发送端定时向数据接收端发起重连通道链路的请求，数据接收端接收到所述请求后重新建立通道链路，并进行时钟同步，具体包括：使用定时器设置请求发起时间；在数据发送端根据请求发起时间定时向数据接收端发起重连通道链路请求；数据接收端接收到请求后依次进行通道链路初始化、通道链路绑定和通道链路验证，验证通过即完成通道链路的重建和时钟同步；验证不通过则继续进行通道初始化。进一步，所述通道链路初始化具体为：初始化串行通道链路，确定通道宽度、通道链路的速率、通道通信模式、通道的分配和数据的大小端模式；激活通道链接，并对通道边界进行对齐。进一步，所述通道链路绑定具体为：将通道链路与对应的光纤通道进行绑定。进一步，所述通道链路验证包括：将需要映射到用户接口的数据，进行数据的对齐和时钟的同步；检查通道链路信号的完整性；判断当前通道链路传输数据能力是否达到预设传输能力；若是，则当前通道链路通过通道链路验证。相应的，本发明还公开了一种基于光单向传输的时钟同步系统，包括：判定单元，用于判断当前传输通道内是否有待传输的数据；发送单元，用于通过数据发送端将待传输的数据转换为8b/10b编码数据后嵌入时钟信号，并发送到数据接收端；同步单元，用于数据接收端收到数据后，从数据中抽取出时钟信号，进行与数据发送端的时钟同步；通道链路重建单元，用于通过数据发送端定时向数据接收端发起重连通道链路的请求，数据接收端接收到所述请求后重新建立通道链路，并进行时钟同步。对比现有技术，本发明有益效果在于：本发明提供了一种基于光单向传输的时钟同步方法及系统，具体采用将数据发送端到数据接收端的数据采用8b/10b编码，并将时钟信号嵌入到数据中，在有数据传输时，接收端从传输的数据中抽取出时钟信号，完成和发送端的时钟同步；在传输空闲时，由于没有数据传输，数据接收端无法抽取出时钟信号完成时钟同步，这种情况下设置定时器，使数据发送端定时发起重连通道链路的请求，接收端接收到请求后重新建立传输通道链接，完成时钟同步；在光单向传输设备中，利用本发明能够使发送端和接收端自动建立时钟同步，从而避免因同步问题导致的通信错误。由此可见，本发明与现有技术相比，具有突出的实质性特点和显著的进步，其实施的有益效果也是显而易见的。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据提供的附图获得其他的附图。附图1是本发明的方法流程图；附图2是本发明的系统结构图。图中，1为判定单元，2为发送单元，3为同步单元，4为通道链路重建单元，41为通道链路初始化模块，42为通道链路绑定模块，43为通道链路验证模块，44为定时器。具体实施方式下面结合附图对本发明的具体实施方式做出说明。如图1所示的一种基于光单向传输的时钟同步方法，包括如下步骤：S1：判断当前传输通道内是否有待传输的数据；若是，转到步骤S2，否则转到步骤S4。S2：通过数据发送端将待传输的数据转换为8b/10b编码数据后嵌入时钟信号，并发送到数据接收端。完成后，转至步骤S3。本步骤具体包括：在数据发送端，首先使用8b/10b编码器将待传输的数据转换成直流平衡的10bit的8b/10b编码数据，然后插入comma控制字符即嵌入同步信号，并通过并串转换将10位编码结果转为串行码。最后将串行码流转换成差分信号，经光纤数据传输通道发送到数据接收端。其中，8B/10B编码技术是高速通信中常用的编解码技术，它把8bit代码扩充成10bit代码，并插入同步信号，代码组合包含256个数据字符编码和12个控制字符编码，分别记为Dx.y和Kx.y。通过仔细选择编码方法可以获得不同的优化特性，这些特性确保“0”码元与“1”码元个数的相对平衡一致，又称为直流均衡；确保数据同步易于实现，简化了时钟恢复的难度。8B/10B编码中将K28.1、K28.5和K28.7作为K码的控制字符，称为“comma”。comma只作为控制字符出现，而在数据负荷部分不会出现，因此可以用comma字符指示帧的开始和结束标志，或数据流对齐的控制字符，便于抽取出时钟信号，完成时钟同步。S3：数据接收端收到数据后，从数据中抽取出时钟信号，进行与数据发送端的时钟同步。具体为，在数据接收端，将接收的差分信号还原为串行信号，经时钟恢复电路从串行信号中抽取出时钟信号，并完成对串行数据的采样；然后进行8b/10b解码，将串行数据还原为8bit格式数据。由于8B/10B解码中用comma字符作为数据流对齐的控制字符，因此最后通过comma检测器检测8bit格式数据中的comma字符，通过数据边界对齐，进行与数据发送端的时钟同步。S4：通过数据发送端定时向数据接收端发起重连通道链路的请求，数据接收端接收到所述请求后重新建立通道链路，并进行时钟同步。在传输空闲的情况下，由于没有数据传输，数据接收端无法通过数据抽取出时钟信号完成时钟同步，可能就会造成通道链路断开，这种情况下需要设置定时器，使数据发送端定时发起重连通道链路请求，数据接收端接收到请求后恢复通道链接，包括对通道链路进行初始化、通道链路边界对齐、通道链路绑定和通道链路验证，验证通过即完成通道链路重建和时钟同步，验证不通过则返回通道初始化重新开始。具体实现过程如下：1、通道链路初始化：初始化串行通道链路，确定通道链路宽度、通道链路的速率、通道链路通信模式、通道链路的分配和数据的大小端模式，激活通道链接，并对通道链路边界进行对齐。2、通道链路绑定：将通道链路绑定到对应的光纤通道，光纤通道可以看成是链路层的网络，并在整个网络中使用统一的地址空间，通道链路绑定有助于消除由走线长度和接口连接等因素带来的信号偏移。3、通道链路验证：对需要映射到用户接口的接收数据，这一过程要执行数据的对齐和时钟的同步，检查通道信号的完整性，最后还要验证通道链路传输有效数据的能力。一旦完成通道验证，意味着通道链路重建和时钟同步已完成，此时，通道链路便可用于传输数据。4、定时器的设计，需要考虑通道链路的特定条件，例如时钟速率，通道延迟，通道之间的偏移和噪声等参数；应平衡同步所需的平均时间与系统可以容忍通道不工作的最大时间，以确定最佳定时同步时间。本实施例提供了一种基于光单向传输的时钟同步方法，能够使数据发送端和数据接收端自动建立时钟同步，有效的避免了因同步问题导致的通信错误。相应的，如图2所示，本发明还公开了一种基于光单向传输的时钟同步系统，包括：判定单元1、发送单元2、同步单元3和通道链路重建单元4。判定单元1，用于判断当前传输通道内是否有待传输的数据；若是，则启动发送单元2；若否，则启动通道链路重建单元4。发送单元2，用于通过数据发送端将待传输的数据转换为8b/10b编码数据后嵌入时钟信号，并发送到数据接收端。同步单元3，用于数据接收端收到数据后，从数据中抽取出时钟信号，进行与数据发送端的时钟同步。通道链路重建单元4，用于通过数据发送端定时向数据接收端发起重连通道链路的请求，数据接收端接收到所述请求后重新建立通道链路，并进行时钟同步。其中，通道链路重建单元4具体包括：通道链路初始化模块41，用于初始化串行通道链路，确定通道宽度、通道链路的速率、通道通信模式、通道的分配和数据的大小端模式；激活通道链接，并对通道边界进行对齐。通道链路绑定模块42，用于将通道链路与对应的光纤通道进行绑定。通道链路验证模块43，用于将需要映射到用户接口的数据，进行数据的对齐和时钟的同步；检查通道链路信号的完整性，并判断当前通道链路传输数据能力是否达到预设传输能力。定时器44，用于设定重连通道链路请求的发起时间。本实施例提供了一种基于光单向传输的时钟同步系统，首先，将数据发送端到数据接收端的数据采用8b/10b编码，并将时钟信号嵌入到数据中，在有数据传输时，接收端从传输的数据中抽取出时钟信号，完成和发送端的时钟同步；在传输空闲时，由于没有数据传输，数据接收端无法抽取出时钟信号完成时钟同步，这种情况下通过定时器，使数据发送端定时发起重连通道链路的请求，接收端接收到请求后重新建立传输通道链接，完成时钟同步；在光单向传输设备中，利用本系统能够使发送端和接收端自动建立时钟同步，从而避免因同步问题导致的通信错误。本领域的技术人员可以清楚地了解到本发明实施例中的技术可借助软件加必需的通用硬件平台的方式来实现。基于这样的理解，本发明实施例中的技术方案本质上或者说对现有技术做出贡献的部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中如U盘、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质，包括若干指令用以使得一台计算机终端执行本发明各个实施例所述方法的全部或部分步骤。本说明书中各个实施例之间相同相似的部分互相参见即可。尤其，对于终端实施例而言，由于其基本相似于方法实施例，所以描述的比较简单，相关之处参见方法实施例中的说明即可。在本发明所提供的几个实施例中，应该理解到，所揭露的系统、系统和方法，可以通过其它的方式实现。例如，以上所描述的系统实施例仅仅是示意性的，例如，所述单元的划分，仅仅为一种逻辑功能划分，实际实现时可以有另外的划分方式，例如多个单元或组件可以结合或者可以集成到另一个系统，或一些特征可以忽略，或不执行。另一点，所显示或讨论的相互之间的耦合或直接耦合或通信连接可以是通过一些接口，系统或单元的间接耦合或通信连接，可以是电性，机械或其它的形式。所述作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部单元来实现本实施例方案的目的。另外，在本发明各个实施例中的各功能模块可以集成在一个处理单元中，也可以是各个模块单独物理存在，也可以两个或两个以上模块集成在一个单元中。同理，在本发明各个实施例中的各处理单元可以集成在一个功能模块中，也可以是各个处理单元物理存在，也可以两个或两个以上处理单元集成在一个功能模块中。结合附图和具体实施例，对本发明作进一步说明。应理解，这些实施例仅用于说明本发明而不用于限制本发明的范围。此外应理解，在阅读了本发明讲授的内容之后，本领域技术人员可以对本发明作各种改动或修改，这些等价形式同样落于本申请所限定的范围。
