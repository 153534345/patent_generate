标题title
一种基于超宽带技术的室内无源实时定位方法
摘要abst
一种基于超宽带技术的室内无源实时定位方法，涉及超宽带测距领域和室内定位技术领域，针对现有技术中不同设备的时间分辨率不同进而导致测距误差大的问题，本申请提出了一种基于超宽带技术的室内无源实时定位方法。测距方面，利用定位过程中动态估计的时间分辨率以及必要的时间戳来完成测距信息的获取，不仅能提高设备时间戳的利用率，还能为定位系统简化距离差或距离的求解方法以及其信号交流机制，从而以无源的方式准确的获取距离差；定位方面，利用CHAN‑最小二乘算法克服非线性迭代初值计算的问题。将两者结合从而形成一套完整的无源定位系统。
权利要求书clms
1.一种基于超宽带技术的室内无源实时定位方法，其特征在于包括以下步骤：步骤一：获取主基站和每个从基站的初始位置信息，所述从基站至少为三个；步骤二：将主基站分别与每个从基站进行询问与应答，询问与应答过程中标签仅接收主基站或从基站的信号，进而得到时间差信息，所述标签，即用户基站；步骤三：分别获得主基站与每个从基站及标签的系统时间计数器工作频率的倒数，即时间分辨率；步骤四：首先根据得到的时间分辨率和时间差信息得到主基站与每个从基站之间的距离，然后利用时间分辨率、时间差信息以及得到的主基站与每个从基站之间的距离得到标签到达主基站的距离与标签到达每个从基站的距离的差值；步骤五：根据得到的距离的差值，并利用CHAN-最小二乘算法得到粗略的标签初始位置信息，然后将粗略的标签初始位置信息作为非线性迭代定位算法中的标签初始位置信息，并结合距离的差值得到标签定位信息；步骤六：重复步骤一至步骤四，得到新的距离的差值，然后将标签定位信息作为非线性迭代定位算法中的标签初始位置信息，并结合新的距离的差值进行实时定位。2.根据权利要求1所述的一种基于超宽带技术的室内无源定位方法，其特征在于所述步骤三中时间分辨率表示为：其中，表示利用主基站与从基站x的时间分辨率比例关系得到的主基站的时间分辨率，kSSx表示利用主基站与从基站x的时间分辨率比例关系得到的从基站x的时间分辨率，表示主基站的系统时间计数器在连续两次发送信号给从基站x的这段时间内的计数器差值，TimeSlotSSx表示从基站x的系统时间计数器在连续两次接收主基站所发送信号的这段时间内的计数器差值，表示利用主基站与标签的时间分辨率比例关系得到的主基站的时间分辨率，kT表示利用主基站与标签的时间分辨率比例关系得到的标签的时间分辨率，表示主基站的系统时间计数器在连续两次发送信号给标签的这段时间内的计数器差值，TimeSlotT表示标签的系统时间计数器在连续两次接收主基站所发送信号的这段时间内的计数器差值，表示标称时间分辨率。3.根据权利要求2所述的一种基于超宽带技术的室内无源定位方法，其特征在于所述步骤四中主基站与每个从基站之间的距离表示为：其中，表示主基站与从基站x之间的距离，c表示光速，Tround表示主基站的系统时间计数器在向从基站x发出询问信号到接收从基站x的应答信号这段时间内所经过计数值，Treply表示从基站x的系统时间计数器在接收主基站发出询问信号到发出应答信号这段时间内所经过计数值。4.根据权利要求3所述的一种基于超宽带技术的室内无源定位方法，其特征在于所述标签到达主基站的距离与标签到达每个从基站的距离的差值表示为：其中，Treceive表示标签的系统时间计数器从接收到主基站发出的询问信号到接收到从基站x发出的应答信号经过计数值。5.根据权利要求4所述的一种基于超宽带技术的室内无源定位方法，其特征在于所述标签初始位置信息表示为：X＝invHTZ其中，H表示量测矩阵，Z表示系统测量值，X表示系统状态向量，其中，x和y表示标签的横纵坐标，xSS2和ySS2表示从基站2的横纵坐标、xSS3和SS3表示从基站3的横纵坐标、xSSn和ySSn表示从基站n的横纵坐标、xMS和yMS表示主基站的横纵坐标，WSS2表示从基站2的横纵坐标平方和，WSS3表示从基站3的横纵坐标平方和，WSSn表示从基站n的横纵坐标平方和，DMS表示主基站与标签的几何距离，DSS2表示从基站2与标签的几何距离，DSS2,MS表示标签到从基站2与到主基站之间的距离差，即DSS2,MS＝DSS2-DMS；DSS3表示从基站3与标签的几何距离，DSS3,MS表示标签到从基站3与到主基站之间的距离差，即DSS3,MS＝DSS3-DMS；DSSn表示从基站n与标签的几何距离，DSSn,MS表示标签到从基站n与到主基站之间的距离差，即DSSn,MS＝DSSn-DMS。6.根据权利要求5所述的一种基于超宽带技术的室内无源定位方法，其特征在于所述步骤六中非线性迭代定位算法表示为：其中与分别为状态向量Xnew的第k+1次迭代与第k次迭代，算子De表示误差对系统状态求雅克比矩阵，Vk表示第k次迭代的状态变化量。7.根据权利要求6所述的一种基于超宽带技术的室内无源定位方法，其特征在于所述非线性迭代定位算法的迭代方程的终止条件为迭代次数达到10次或迭代过程中相邻两个时刻误差的平方和小于10cm*cm。
说明书desc
技术领域本发明涉及超宽带测距领域和室内定位技术领域，具体为一种基于超宽带技术的室内无源实时定位方法。背景技术超宽带无线通讯技术凭借其时间分辨率高、抗多径干扰、低功耗等优势，被广泛应用于室内高精度定位。为了充分发挥超宽带技术的优势，定位系统在测距阶段通常利用信号在空中的飞行时间获得距离差或距离，测距方法可划分为两大类：信号到达时间差和信号到达时间。TDOA是一种直接获得标签到两个不同基站之间距离差的方法，但是需要基站设备之间有着较为严格的时钟同步去减小时间分辨率不同所造成的测距误差；虽然基于单向测距的TOA也需要有着严格的时间同步，但是基于双向测距的TOA通常可以通过增加通信次数以及改进计算方法减小不同设备之间时钟不同步的问题，例如：对称双向测距、非对称双向测距、可选双向测距等。上述测距方法中，由于AltDS-TWR算法具有较高的精度且相对简单，因而被广泛用于超宽带定位系统的测距当中。但是AltDS-TWR算法对于时间戳的利用率低下，且当多个基站测距时，信号发送的次数也会增加，从而导致定位系统给予标签定位信息的可靠性降低。近些年来，为了减小不同设备时间分辨率不同所造成的测距误差，一些改变测距交流机制或利用硬件设备本身功能的超宽带测距算法被研究和提出。文献Based on Ultra-WidebandCommunication//2018Eighth International Conference on Instrumentation&amp;Measurement,Computer,Communication and Control.2018.)提出利用CC-TWR算法计算两个设备的时钟误差比，从而对设备间的时钟误差进行补偿，但是它的缺点是每个设备需要进行两次收发，其中一次计算时钟误差比，另外一次测距，从而增加了测距时设备信号交流的复杂度，且时间戳的利用程度较低；文献:1-1.)首先分析了目前所有的基于TOA与TDOA的测距算法，它认为AltDS-TWR算法能够有效的抑制信号功率或者设备延迟，然后将AltDS-TWR算法从TOA推广至TDOA范围，它的缺点是虽然能够达到较高的精度，但是计算信号空中飞行时间的表达式较为繁琐；文献:75-79.)提出TDOA/SDS-TWR算法，这种算法的信号交流本质在于两个设备间完成一次TWR，另一个设备全程接收信息，论文仿真了应答时间与时钟偏移两个变量对测距误差的影响，从结果来看，当应答时间从0.02毫秒、0.1毫秒、0.2毫秒以及0.3毫秒递增时，误差随时钟偏移变化的斜率增加较快，考虑到实际使用延迟发送功能进行应答时，为了保证传送距离以及尽可能减少非视距影响，数据调制和解调速率通常选取110kbps，仅发送帧的Preamble、SFD部分就需要1.2毫秒以上，这可能使得算法在实际使用时，测距误差随时钟偏移变化的更快，从而对测距效果造成较大的影响；文献:66-73.)提出采用时钟漂移比例系数以及主基站与从基站间的电磁波传输时间来计算TDOA值，它的缺点在于标签在整个交流过程是需要发射信号的，这样就对于标签个数有了一定的限制，当标签增加时，整个定位系统的交流机制就需要更改。发明内容本发明的目的是：针对现有技术中不同设备的时间分辨率不同进而导致测距误差大的问题，提出一种基于超宽带技术的室内无源实时定位方法。本发明为了解决上述技术问题采取的技术方案是：一种基于超宽带技术的室内无源实时定位方法，包括以下步骤：步骤一：获取主基站和每个从基站的初始位置信息，所述从基站至少为三个；步骤二：将主基站分别与每个从基站进行询问与应答，询问与应答过程中标签仅接收主基站或从基站的信号，进而得到时间差信息，所述标签，即用户基站；步骤三：分别获得主基站与每个从基站及标签的系统时间计数器工作频率的倒数，即时间分辨率；步骤四：首先根据得到的时间分辨率和时间差信息得到主基站与每个从基站之间的距离，然后利用时间分辨率、时间差信息以及得到的主基站与每个从基站之间的距离得到标签到达主基站的距离与标签到达每个从基站的距离的差值；步骤五：根据得到的距离的差值，并利用CHAN-最小二乘算法得到粗略的标签初始位置信息，然后将粗略的标签初始位置信息作为非线性迭代定位算法中的标签初始位置信息，并结合距离的差值得到标签定位信息；步骤六：重复步骤一至步骤四，得到新的距离的差值，然后将标签定位信息作为非线性迭代定位算法中的标签初始位置信息，并结合新的距离的差值进行实时定位。进一步的，所述步骤三中时间分辨率表示为：其中，表示利用主基站与从基站x的时间分辨率比例关系得到的主基站的时间分辨率，kSSx表示利用主基站与从基站x的时间分辨率比例关系得到的从基站x的时间分辨率，表示主基站的系统时间计数器在连续两次发送信号给从基站x的这段时间内的计数器差值，TimeSlotSSx表示从基站x的系统时间计数器在连续两次接收主基站所发送信号的这段时间内的计数器差值，表示利用主基站与标签的时间分辨率比例关系得到的主基站的时间分辨率，kT表示利用主基站与标签的时间分辨率比例关系得到的标签的时间分辨率，表示主基站的系统时间计数器在连续两次发送信号给标签的这段时间内的计数器差值，TimeSlotT表示标签的系统时间计数器在连续两次接收主基站所发送信号的这段时间内的计数器差值，表示标称时间分辨率。进一步的，所述步骤四中主基站与每个从基站之间的距离表示为：其中，表示主基站与从基站x之间的距离，c表示光速，Tround表示主基站的系统时间计数器在向从基站x发出询问信号到接收从基站x的应答信号这段时间内所经过计数值，Treply表示从基站x的系统时间计数器在接收主基站发出询问信号到发出应答信号这段时间内所经过计数值。进一步的，所述标签到达主基站的距离与标签到达每个从基站的距离的差值表示为：其中，Treceive表示标签的系统时间计数器从接收到主基站发出的询问信号到接收到从基站x发出的应答信号经过计数值。进一步的，所述标签初始位置信息表示为：X＝invHTZ其中，H表示量测矩阵，Z表示系统测量值，X表示系统状态向量，其中，x和y表示标签的横纵坐标，xSS2和ySS2表示从基站2的横纵坐标、xSS3和SS3表示从基站3的横纵坐标、xSSn和ySSn表示从基站n的横纵坐标、xMS和yMS表示主基站的横纵坐标，WSS2表示从基站2的横纵坐标平方和，WSS3表示从基站3的横纵坐标平方和，WSSn表示从基站n的横纵坐标平方和，DMS表示主基站与标签的几何距离，DSS2表示从基站2与标签的几何距离，DSS2,MS表示标签到从基站2与到主基站之间的距离差，即DSS2,MS＝DSS2-DMS；DSS3表示从基站3与标签的几何距离，DSS3,MS表示标签到从基站3与到主基站之间的距离差，即DSS3,MS＝DSS3-DMS；DSSn表示从基站n与标签的几何距离，DSSn,MS表示标签到从基站n与到主基站之间的距离差，即DSSn,MS＝DSSn-DMS。进一步的，所述步骤六中非线性迭代定位算法表示为：其中与分别为状态向量Xnew的第k+1次迭代与第k次迭代，算子De表示误差对系统状态求雅克比矩阵，Vk表示第k次迭代的状态变化量。进一步的，所述非线性迭代定位算法的迭代方程的终止条件为迭代次数达到10次或迭代过程中相邻两个时刻误差的平方和小于10cm*cm。本发明的有益效果是：本申请提出了一种基于超宽带技术的室内无源实时定位方法。测距方面，利用定位过程中动态估计的时间分辨率以及必要的时间戳来完成测距信息的获取，不仅能提高设备时间戳的利用率，还能为定位系统简化距离差或距离的求解方法以及其信号交流机制，从而以无源的方式准确的获取距离差；定位方面，利用CHAN-最小二乘算法克服非线性迭代初值计算的问题。将两者结合从而形成一套完整的无源定位系统。附图说明图1是定位系统获得一次位置信息的信号交流机制；图2是AltDS-TWR测距算法与文中所提测距算法在相同情况下的测距误差分布图；图3是文中所提测距算法所测距离差的误差分布情况；图4是在11.46m×11.60m的房间内走圈图；图5是在11.46m×11.60m的房间内选取定点图；图6是图5中定点采样结果的误差分布情况。具体实施方式需要特别说明的是，在不冲突的情况下，本申请公开的各个实施方式之间可以相互组合。具体实施方式一：参照图1具体说明本实施方式，本实施方式所述的一种基于超宽带技术的室内无源实时定位方法，包括以下步骤：步骤一：标签获取主基站和每个从基站的初始位置信息，所述从基站至少为三个，所述标签，即用户基站；步骤二：主基站分别与每个从基站进行询问与应答，询问与应答过程中标签仅接收主基站或从基站的信号，进而得到时间差信息；步骤三：分别获得主基站与每个从基站及标签的系统时间计数器工作频率的倒数，即时间分辨率；步骤四：根据得到的时间分辨率和时间差信息，首先计算主基站与每个从基站之间的距离，然后利用时间分辨率、时间差信息以及计算出的主基站与每个从基站之间的距离得到标签到达主基站距离与标签到达每个从基站距离的差值；步骤五：根据得到的距离差值，利用CHAN-最小二乘算法得到粗略的标签初始位置信息，然后将粗略的标签初始位置信息作为非线性迭代定位算法中的标签初始位置信息，并结合距离的差值得到标签定位信息。步骤六：重复步骤一至步骤四，得到新的距离的差值，然后将标签定位信息作为非线性迭代定位算法中的标签初始位置信息，并结合新的距离的差值进行实时定位。步骤三中，时间分辨率的估计准则如下：假设设备A与设备B以AltDS-TWR协议所提供的交流机制进行信号交流。设备A发出询问信号给设备B，设备B接收到询问信号并在设备B的系统时间计数器经过计数值Treply1后，发送应答信号给设备A，设备A接收到应答信号并在设备A的系统时间计数器经过计数值Treply2后，发送结束信号给设备B。设备A的系统时间计数器从发出询问信号到接收应答信号经过计数值Tround1。设备B收到结束信号时，设备B的系统时间计数器从发出应答信号到接收结束信号经过计数值Tround2。依靠这些计数器差值估计出信号飞行时间所对应的设备计数器值的公式为：其中，下标表示该值为计数器值，“∧”表示估计值。为获得信号飞行时间，通常需要在前乘标称时间分辨率即1/，单位为秒。考虑到设备间的差异性，现假设，设备A的时间分辨率为kA，设备B的时间分辨率为kB，将两个时间分辨率带入AltDS-TWR估计信号飞行时间的公式：设备A与设备B两者的时间分辨率存在比例关系。当设备A发射两次信号给设备B时，即可建立关系。为描述该关系，现假设设备A在时间点T1、T3发射信号，设备B在时间点T2、T4接收信号，其中，时间点为真实时间，并非设备各自对应的参考时间。因此可建立如下等式：T3-T1＝T4-T2已知设备A的系统时间计数器在时间点T1至T3这段时间的计数器差值为TimeSlotA，设备B的系统时间计数器在时间点T2至T4这段时间的计数器差值为TimeSlotB，则根据设备A和B的时间分辨率可建立如下关系：kA×TimeSlotA＝kB×TimeSlotB在AltDS-TWR交流机制中类比有：kA×＝kB因此，综合之前的推导可得：kB同理。仔细观察上式可发现，AltDS-TWR方法在时间分辨率方面的估计准则是认为设备A与设备B的时间分辨率之和约等于两倍的标称时间分辨率：步骤三中，时间分辨率的计算方法如下：为简化描述，提取主基站与从基站x之间交流的某个典型片段作为举例。假设主基站在时间点T1时发送第一个信号，从基站x在时间点T2时接收信号，主基站在时间点T3时发送第二个信号，从基站x在时间点T4时接收到主基站发出的第二个信号。主基站的系统时间计数器在时间点T1至T3这段时间的计数器差值为TimeSlotMS。从基站x的系统时间计数器在时间点T2至T4这段时间的计数器差值为TimeSlotSSx。则利用这些时间戳可建立主基站与从基站x时间分辨率的关系如下：其中，表示利用主基站与从基站x这两个设备的时间分辨率关系计算出的主基站的时间分辨率，其物理意义为主基站硬件设备中DW1000芯片系统时间计数器增加一时所花费的时间，同理kSSx表示利用主基站与从基站x这两个设备的时间分辨率关系计算出的从基站x的时间分辨率。结合DW1000芯片用户手册中给出的标称时间分辨率与权利要求2中的估计准则，可得：需要注意的是，这种估计的方法是成对间的估计，反映的是两个设备间的时间分辨率关系，其根本原因是设备工作频率无法完全一致造成的，这种比例关系短时间内不会发生太大的变化，但为防止长时间使用设备所造成的时钟漂移，需要不断的估计两个设备频率间的时间分辨率。步骤四中，主基站与每个从基站之间距离的计算方法如下：为简化描述，提取主基站与从基站x之间交流的某个典型片段作为举例。已知主基站的时间分辨率为从基站x的时间分辨率为kSSx，当主基站在时间点为T1时发送询问信号，从基站x在时间点为T2时接收信号并在从基站x的系统时间计数器经过计数值Treply后，在时间点为T3时发出应答信号，主基站时间点为T4时接收此信号。主基站的系统时间计数器从发出询问信号到接收应答信号经过计数值Tround。那么主基站与从基站x之间的距离可表示为：其中，表示主基站与从基站x之间的距离，c表示光速。需要注意的是，主基站与从基站之间的距离理论上可通过主基站和从基站的初始位置获取，但通常情况下，基站天线位置不同方向的摆放会导致最终定位结果出现不同的偏差，此处用时间分辨率和时间差信息计算主基站和从基站之间的距离，更多的是检验基站天线位置是否摆放正确，保证不出现较大幅度的移动。步骤四中，标签与基站间的距离差计算方式如下：为简化描述，提取主基站与从基站x之间交流的某个典型片段作为举例。与4中举例过程相同，主基站发出询问信号，从基站x接收后发出应答信号。在此过程中，标签的系统时间计数器从接收到主基站发出的询问信号到接收到从基站x发出的应答信号经过计数值Treceive。标签通过步骤三已知主基站与该从基站的时间分辨率，则可得到三者之间的距离关系：其中，分别表示主基站与标签的距离、从基站x与标签的距离、主基站与从基站x的距离；kT分别利用主基站与标签这两个设备的时间分辨率关系计算出的为主基站、标签的时间分辨率；Tround和c与权利要求4中定义相同。结合4中计算出的主基站与从基站x之间的距离，即可得到最终的距离差表达式：注意，距离差表达式中还可以通过主基站和从基站的初始位置信息获取。步骤五中根据CHAN-最小二乘算法计算标签初始定位点的过程如下：首先，假设点A与点B之间的距离表达式如下：其中，xA，yA表示点A的横纵坐标，xB，yB表示点B的横纵坐标，此外设DMS表示主基站与标签的距离，DSSx表示从基站与标签的距离。则标签到从基站x与到主基站之间的距离差为DSSx，MS，即DSSx，MS＝DSSx-DMS，则有上式中，xSSx，ySSx表示从基站x的横纵坐标，xMS，yMS表示主基站的横纵坐标，x，y表示标签的横纵坐标，此外化简则有当从基站个数为n-1时，将其写作矩阵形式则有其中，xSS2，ySS2、xSS3，ySS3、xSSn，ySSn、xMS，yMS分别表示从基站2、从基站3、从基站n、主基站的横纵坐标；DSS2，MS为标签到从基站2与到主基站之间的距离差，DSS3，MS为标签从基站3与到主基站之间的距离差，DSSn，MS为标签到从基站n与到主基站之间的距离差；对于上述方程，利用最小二乘法即可获得初值如下：X＝invHTZ其中，H表示量测矩阵，Z表示系统测量值，X表示系统状态向量实施例：步骤1：获取主基站和每个从基站的初始位置信息，所述从基站至少为三个，所述标签，即用户基站；步骤2：主基站分别与每个从基站进行询问与应答，询问与应答过程中标签仅接收主基站或从基站的信号，进而得到时间差信息；步骤2.1：定位系统完成一次定位的交流过程如附图1。附图1中最左侧的实线为主基站设备时间线，中间的实线为从基站设备时间线，右侧虚线为标签设备时间线。其中两条实线左侧的符号表示主基站或从基站的设备系统时间计数器在发送事件或接收事件节点对应的计数器值，它的上标表示本轮交流的从基站对象，下标表示记录的事件序号。虚线右侧的符号表示标签的设备系统时间计数器在接收到主基站或从基站的发送信号时对应的计数器值，它的上标表示主基站正在交流的从基站序号，下标表示接收的是哪个事件序号。步骤3：分别获得主基站与每个从基站及标签的系统时间计数器工作频率的倒数，即时间分辨率；步骤3.1：根据计算主基站与从基站x时间分辨率的比例关系：其中表示下一轮定位中的即主基站向从基站x发送信号的发送事件，后的第二次发送事件，表示下一轮定位中的从基站x接收主基站发送信号的接收事件，后的第二次接收事件；表示利用主基站和从基站x之间的时间分辨率比例关系所计算的主基站时间分辨率，kSSx表示利用主基站和从基站x之间的时间分辨率比例关系所计算的从基站x的时间分辨率。对主基站与从基站x的时间分辨率进行限制：其中，为标称时间分辨率，因此可得：步骤3.2：根据计算主基站与标签的时间分辨率比例关系：其中上标中的x+1表示从基站x的下一个从基站，的上标同理。表示利用主基站和标签之间的比例关系所计算的主基站时间分辨率，kT表示利用主基站和标签之间的比例关系所计算的标签时间分辨率。对主基站与标签的时间分辨率进行限制：因此可得：步骤4：根据得到的时间分辨率和时间差信息，首先得到主基站与每个从基站之间的距离，然后利用时间分辨率、时间差信息以及主基站与每个从基站之间的距离得到标签到达主基站距离与标签到达每个从基站距离的差值；步骤4.1：根据步骤三计算出的时间分辨率，主基站与从基站x的距离可表示为：其中表示主基站与从基站x之间的距离，c表示光速。步骤4.2：根据步骤计算出的时间分辨率，则可得到如下关系：其中分别表示主基站与标签的距离、从基站x与标签的距离、主基站与从基站x的距离。根据步骤4.1中的表达式可知：步骤5：根据得到的距离差值，利用CHAN-最小二乘算法得到粗略的标签初始位置信息，然后将粗略的标签初始位置信息作为非线性迭代定位算法中的标签初始位置信息，并结合距离的差值得到标签定位信息；步骤5.1：根据CHAN算法将坐标求解线性化：其中上述表达式中xT，yT、xMS，yMS、xSSx，ySSx分别表示标签、主基站、从基站x的横纵坐标，DMS表示主基站与标签的距离，DSSx表示从基站x与标签的距离，DSSx，MS表示从基站x到标签的距离减去主基站到标签的距离，即DSSx，MS＝DSSx-DMS将线性化后的式子转化为矩阵形式：则完整的求解初始点矩阵为：上述方程可以利用最小二乘法求解：X＝-1HTZ其中，H表示量测矩阵，Z表示系统测量值，X表示系统状态向量DMS表示主基站与标签的几何距离，DSS2表示从基站2与标签的几何距离，DSS2，MS表示标签到从基站2与到主基站之间的距离差，即DSS2，MS＝DSS2-DMS；DSS3表示从基站3与标签的几何距离，DSS3，MS表示标签到从基站3与到主基站之间的距离差，即DSS3，MS＝DSS3-DMS；DSSn表示从基站n与标签的几何距离，DSSn，MS表示标签到从基站n与到主基站之间的距离差，即DSSn，MS＝DSSn-DMS。步骤5.2：将步骤5.1计算出的初值作为非线性迭代算法的初值。令非线性迭代算法定位系统的状态向量Xnew为标签的横纵坐标xT，yT，即Xnew＝T定位系统的测量输出为：Znew＝T其中zn为定位系统实际输出的标签到主基站的距离与到从基站n距离的差值系统的理论输出其中，f2、f3、fn分别为以标签的横纵坐标作为未知量，利用几何关系表示出的标签到主基站的距离与到从基站2距离之间的差值，标签到主基站的距离与到从基站3距离之间的差值、标签到主基站的距离与到从基站n距离之间的差值则定位系统实际输出与理论输出的误差为根据最小均方误差准则所得估计状态W为加权阵，可取单位阵。令上式梯度为零，并利用多元牛顿迭代法求解此非线性方程组可得非线性迭代算法的更新方程为：其中与分别为状态向量Xnew迭代的第k+1步与第k步，算子De表示误差对系统状态求雅克比矩阵。Vk表示第k次迭代的状态变化量；X0为步骤五中计算结果。迭代方程的终止条件设置两个，迭代次数和状态变化量的阈值，分别设置为10次与10。步骤6：重复步骤一至步骤四，得到新的距离的差值，然后将标签定位信息作为非线性迭代定位算法中的标签初始位置信息，并结合新的距离的差值进行实时定位。图1是定位系统获得一次位置信息的信号交流机制。图2是AltDS-TWR测距算法与文中所提测距算法在相同情况下的测距误差分布图，能够观察到，两种算法分布情况基本一致，可认为是正态分布。且所有样本的误差超过99％分布在0.06m内。图3是文中所提测距算法所测距离差的误差分布情况，从图中可以看到误差基本服从正态分布，且所有样本的误差超过99％分布在0.15m内。图4是在11.46m×11.60m的房间内走圈图，所走的圈为正方形，其边长为6个1.10m的瓷砖，即6.60m。图中的五角星为所走正方形的四个角，左下角的坐标为，右下角的坐标为，左上角的坐标为，右上角的坐标为。可以看到右上角的五角星点较其他点更为密集，此点也是走圈的出发点，然后沿着逆时针返回出发点。考虑到走动时手臂伸出的距离以及身体的抖动，下面对正方形四个边上的采样点进行图形绘制。图5是在11.46m×11.60m的房间内选取定点进行采样，考虑到采集过程较长，房间中人员走动会导致定位系统存在非视距的影响，因此对数据进行了去野值以及偏差消除的处理。图6是图5中定点采样结果的误差分布情况，可以看到，采样点与真实点的误差距离在20cm内分布。本发明的研究内容是基于超宽带技术的室内定位系统。定位信息的获取需要测距算法与定位算法两者结合完成。现有的测距算法通常以改进信号飞行时间的求解表达式，达到提高精度的目的，但造成测距误差的本质原因是硬件设备时钟误差所导致的不同设备系统时间计数器工作频率的不一致；现有的定位算法中非线性迭代法可以通过给定合适的初值，通过迭代方式来逼近全局最优解，但初始值写入芯片后无法变更，降低了该定位算法的灵活性。本申请为了解决本申请所要解决的技术问题，首先提出了一种间接估计时间分辨率的测距算法，该算法能够在定位过程中实时的更新设备系统时间计数器的工作频率，使得该算法在提高了测距精度的情况下简化信号飞行时间的求解表达式；然后，提出了利用CHAN-最小二乘算法解决非线性迭代定位算法初值选定的问题，基于此方法，用户在房间内任意位置启动标签也能够实时获取定位信息。基于所提出的这两种算法，本发明整合出一套无源实时定位方案，经验证，此方案能够提供有效的定位信息，且其定位误差小于20厘米。本文首先从造成测距误差的根本原因入手，利用估计出的设备时间分辨率，以及必要的时间戳信息，得到精度与AltDS-TWR算法基本一致的距离信息；然后，把利用CHAN-最小二乘解决非线性迭代算法初值选择问题的方法与测距方法结合，从而形成一整套无源定位方案。表1需要注意的是，具体实施方式仅仅是对本发明技术方案的解释和说明，不能以此限定权利保护范围。凡根据本发明权利要求书和说明书所做的仅仅是局部改变的，仍应落入本发明的保护范围内。
