标题title
一种基于产品缺陷的光学检测方法、系统和可读存储介质
摘要abst
本发明提供一种基于产品缺陷的光学检测方法、系统和可读存储介质，所述方法包括：对当前产品采集原始图像，经二值化处理得到当前产品的灰度图像；判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N；如果大于，则选定N个历史产品的灰度图像；将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算得到N个差值，如果某差值的绝对值大于第二预设阈值，则将该像素点标记为缺陷参考点一次，待N个差值的绝对值比对完后，记录该像素点标记为缺陷参考点的累计次数；如果累计次数大于第三预设阈值，则将当前产品的灰度图像中该像素点标记为缺陷点。本发明提升检测效率和准确度。
权利要求书clms
1.一种基于产品缺陷的光学检测方法，其特征在于，所述方法包括：通过图像采集器对当前待检测的产品采集获取对应的原始图像，并记录当前检测时间；对所述原始图像进行二值化处理，得到当前产品的灰度图像；判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N，且所述历史产品与当前产品为同类型的不同产品；如果大于，则从所述历史数据库中选定与当前检测时间临近的N个历史产品的灰度图像；将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N个差值，并将N个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将当前产品的灰度图像中该像素点标记为缺陷参考点一次，待N个差值的绝对值分别与第二预设阈值比对完成后，记录当前产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述累计次数是否大于第三预设阈值，如果大于，则将当前产品的灰度图像中该像素点标记为缺陷点。2.根据权利要求1所述的一种基于产品缺陷的光学检测方法，其特征在于，将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，具体包括：使用梅林-傅里叶算法分别对当前产品的灰度图像以及某历史产品的灰度图像中的Mark点进行定位，并获取Mark点在当前产品的灰度图像的第一位置信息，以及Mark点在该历史产品的灰度图像的第二位置信息；根据第一位置信息与第二位置信息计算得到当前产品与该历史产品在灰度图像中的偏移向量；取当前产品的灰度图像中像素点T1的坐标位置，将该像素点T1的坐标位置根据所述偏移向量进行移动，得到变换后的坐标位置；根据变换后的坐标位置在该历史产品D 灰度图像中确定出对应的像素点T2；计算当前产品的灰度图像中像素点T1的灰度值与该历史产品的灰度图像对应的像素点T2的灰度值的差值绝对值；判断差值绝对值是否大于第二预设阈值，如果是，则将当前产品的灰度图像中像素点T1标记为缺陷参考点。3.根据权利要求1所述的一种基于产品缺陷的光学检测方法，其特征在于，在判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N之后，所述方法还包括：如果不大于，则将当前产品的灰度图像录入所述历史数据库中；待所述历史数据库中的灰度图像总数累加到第一预设阈值N时，则启动N个历史产品的灰度图像的互相自检流程；从N个历史产品的灰度图像依次选定待检历史产品的灰度图像，将待检历史产品的灰度图像中某像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N-1个差值，并将N-1个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将待检历史产品的灰度图像中该像素点标记为缺陷参考点一次，待N-1个差值的绝对值分别与第二预设阈值比对完成后，记录待检历史产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述该像素点标记为缺陷参考点的累计次数是否大于第三预设阈值，如果大于，则将待检历史产品的灰度图像中该像素点标记为缺陷点；将待检历史产品的灰度图像中剩余像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取待检历史产品的灰度图像中所有的缺陷点。4.根据权利要求1所述的一种基于产品缺陷的光学检测方法，其特征在于，在判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N之后，所述方法还包括：如果不大于，预设产品包括多个阵列周期排布的小元件，基于多个小元件在当前产品的灰度图像中呈现的阵列周期排布状态，将当前产品的灰度图像划分为F个周期性的小图像块；通过N次随机调整F个周期性的小图像块之间的相对位置关系，以衍生当前产品的N个检测参考图像；将当前产品的灰度图像与N个检测参考图像分别基于对应像素点的灰度值作差分析，获取当前产品的灰度图像中的缺陷点。5.根据权利要求4所述的一种基于产品缺陷的光学检测方法，其特征在于，通过N次随机调整F个周期性的小图像块之间的相对位置关系，以衍生当前产品的N个检测参考图像，具体包括：预定一个用于检测参考图像的拼接框架，所述拼接框架的外框形状、尺寸与当前产品的灰度图像形状、尺寸一致，所述拼接框架包括F个相同的小框，F个小框互不重合且紧密排布，单个小框的形状、尺寸与单个小图像块的形状、尺寸一致；针对所述拼接框架中的第一个小框，从除了与第一个小框对应的小图像块之外的F-1个小图像块中随机选定一个进行填充；针对所述拼接框架中的第二个小框，从除了与第二个小框对应的小图像块以及第一个小框填充的小图像块之外的F-2个小图像块中随机选定一个进行填充；分别对所述拼接框架的F个小框随机填充对应的小图像块，以拼接形成当前产品的一个检测参考图像，通过N次随机拼接，以衍生当前产品的N个检测参考图像。6.根据权利要求1所述的一种基于产品缺陷的光学检测方法，其特征在于，在将当前产品的灰度图像中该像素点标记为缺陷点之后，所述方法还包括：将当前产品的灰度图像中所有像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取当前产品的灰度图像中缺陷点，并基于缺陷点在当前产品的灰度图像上进行标记，形成带有缺陷点标记的第一灰度图像；所述历史数据库中选定新一组N个历史产品的灰度图像，将当前产品的灰度图像中所有像素点的灰度值与新一组N个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取当前产品的灰度图像中缺陷点，并基于缺陷点在当前产品的灰度图像上进行标记，形成带有缺陷点标记的第二灰度图像；判断缺陷点标记的第一灰度图像与第二灰度图像之间相同像素点位置的缺陷点标记状态是否一致，如果一致，则认定对应像素点位置的缺陷点标记状态正确，如果不一致，则对该像素点位置的缺陷点标记状态进行修正。7.一种基于产品缺陷的光学检测系统，其特征在于，包括存储器和处理器，所述存储器中包括一种基于产品缺陷的光学检测方法程序，所述基于产品缺陷的光学检测方法程序被所述处理器执行时实现如下步骤：通过图像采集器对当前待检测的产品采集获取对应的原始图像，并记录当前检测时间；对所述原始图像进行二值化处理，得到当前产品的灰度图像；判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N，且所述历史产品与当前产品为同类型的不同产品；如果大于，则从所述历史数据库中选定与当前检测时间临近的N个历史产品的灰度图像；将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N个差值，并将N个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将当前产品的灰度图像中该像素点标记为缺陷参考点一次，待N个差值的绝对值分别与第二预设阈值比对完成后，记录当前产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述累计次数是否大于第三预设阈值，如果大于，则将当前产品的灰度图像中该像素点标记为缺陷点。8.根据权利要求7所述的一种基于产品缺陷的光学检测系统，其特征在于，将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，具体包括：使用梅林-傅里叶算法分别对当前产品的灰度图像以及某历史产品的灰度图像中的Mark点进行定位，并获取Mark点在当前产品的灰度图像的第一位置信息，以及Mark点在该历史产品的灰度图像的第二位置信息；根据第一位置信息与第二位置信息计算得到当前产品与该历史产品在灰度图像中的偏移向量；取当前产品的灰度图像中像素点T1的坐标位置，将该像素点T1的坐标位置根据所述偏移向量进行移动，得到变换后的坐标位置；根据变换后的坐标位置在该历史产品D 灰度图像中确定出对应的像素点T2；计算当前产品的灰度图像中像素点T1的灰度值与该历史产品的灰度图像对应的像素点T2的灰度值的差值绝对值；判断差值绝对值是否大于第二预设阈值，如果是，则将当前产品的灰度图像中像素点T1标记为缺陷参考点。9.根据权利要求7所述的一种基于产品缺陷的光学检测系统，其特征在于，在判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N之后，所述基于产品缺陷的光学检测方法程序被所述处理器执行时还实现如下步骤：如果不大于，则将当前产品的灰度图像录入所述历史数据库中；待所述历史数据库中的灰度图像总数累加到第一预设阈值N时，则启动N个历史产品的灰度图像的互相自检流程；从N个历史产品的灰度图像依次选定待检历史产品的灰度图像，将待检历史产品的灰度图像中某像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N-1个差值，并将N-1个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将待检历史产品的灰度图像中该像素点标记为缺陷参考点一次，待N-1个差值的绝对值分别与第二预设阈值比对完成后，记录待检历史产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述该像素点标记为缺陷参考点的累计次数是否大于第三预设阈值，如果大于，则将待检历史产品的灰度图像中该像素点标记为缺陷点；将待检历史产品的灰度图像中剩余像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取待检历史产品的灰度图像中所有的缺陷点。10.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质中包括一种基于产品缺陷的光学检测方法程序，所述基于产品缺陷的光学检测方法程序被处理器执行时，实现如权利要求1至6中任一项所述的一种基于产品缺陷的光学检测方法的步骤。
说明书desc
技术领域本发明涉及光学检测技术领域，尤其涉及一种基于产品缺陷的光学检测方法、系统和可读存储介质。背景技术随着显示器、触摸屏等电子器件的不断发展，电子器件制造日趋精密化，由于电子器件生产涉及到的工艺流程过多，工艺繁杂，任何环节都有可能出现缺陷问题，因此在生产制造过程中对缺陷检测也提出了更高的要求。传统对电子器件缺陷检测的方法多是人工视觉检测，例如在电子器件生产的各个阶段，对宏观缺陷通过肉眼进行观察，但检测精度有限。同时人工视觉检测法带有主观因素，不确定性大，容易误判漏判，缺陷检测准确度不高。另外，人工视觉检测方法自动化程度较低，进一步降低了检测效率。发明内容为了解决上述至少一个技术问题，本发明提出了一种基于产品缺陷的光学检测方法、系统和可读存储介质，能够替代人工视觉检测方式，节省了人力成本，并提升了检测效率和准确度。本发明第一方面提出了一种基于产品缺陷的光学检测方法，所述方法包括：通过图像采集器对当前待检测的产品采集获取对应的原始图像，并记录当前检测时间；对所述原始图像进行二值化处理，得到当前产品的灰度图像；判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N，且所述历史产品与当前产品为同类型的不同产品；如果大于，则从所述历史数据库中选定与当前检测时间临近的N个历史产品的灰度图像；将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N个差值，并将N个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将当前产品的灰度图像中该像素点标记为缺陷参考点一次，待N个差值的绝对值分别与第二预设阈值比对完成后，记录当前产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述累计次数是否大于第三预设阈值，如果大于，则将当前产品的灰度图像中该像素点标记为缺陷点。本方案中，将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，具体包括：使用梅林-傅里叶算法分别对当前产品的灰度图像以及某历史产品的灰度图像中的Mark点进行定位，并获取Mark点在当前产品的灰度图像的第一位置信息，以及Mark点在该历史产品的灰度图像的第二位置信息；根据第一位置信息与第二位置信息计算得到当前产品与该历史产品在灰度图像中的偏移向量；取当前产品的灰度图像中像素点T1的坐标位置，将该像素点T1的坐标位置根据所述偏移向量进行移动，得到变换后的坐标位置；根据变换后的坐标位置在该历史产品D 灰度图像中确定出对应的像素点T2；计算当前产品的灰度图像中像素点T1的灰度值与该历史产品的灰度图像对应的像素点T2的灰度值的差值绝对值；判断差值绝对值是否大于第二预设阈值，如果是，则将当前产品的灰度图像中像素点T1标记为缺陷参考点。本方案中，在判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N之后，所述方法还包括：如果不大于，则将当前产品的灰度图像录入所述历史数据库中；待所述历史数据库中的灰度图像总数累加到第一预设阈值N时，则启动N个历史产品的灰度图像的互相自检流程；从N个历史产品的灰度图像依次选定待检历史产品的灰度图像，将待检历史产品的灰度图像中某像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N-1个差值，并将N-1个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将待检历史产品的灰度图像中该像素点标记为缺陷参考点一次，待N-1个差值的绝对值分别与第二预设阈值比对完成后，记录待检历史产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述该像素点标记为缺陷参考点的累计次数是否大于第三预设阈值，如果大于，则将待检历史产品的灰度图像中该像素点标记为缺陷点；将待检历史产品的灰度图像中剩余像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取待检历史产品的灰度图像中所有的缺陷点。本方案中，在判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N之后，所述方法还包括：如果不大于，预设产品包括多个阵列周期排布的小元件，基于多个小元件在当前产品的灰度图像中呈现的阵列周期排布状态，将当前产品的灰度图像划分为F个周期性的小图像块；通过N次随机调整F个周期性的小图像块之间的相对位置关系，以衍生当前产品的N个检测参考图像；将当前产品的灰度图像与N个检测参考图像分别基于对应像素点的灰度值作差分析，获取当前产品的灰度图像中的缺陷点。本方案中，通过N次随机调整F个周期性的小图像块之间的相对位置关系，以衍生当前产品的N个检测参考图像，具体包括：预定一个用于检测参考图像的拼接框架，所述拼接框架的外框形状、尺寸与当前产品的灰度图像形状、尺寸一致，所述拼接框架包括F个相同的小框，F个小框互不重合且紧密排布，单个小框的形状、尺寸与单个小图像块的形状、尺寸一致；针对所述拼接框架中的第一个小框，从除了与第一个小框对应的小图像块之外的F-1个小图像块中随机选定一个进行填充；针对所述拼接框架中的第二个小框，从除了与第二个小框对应的小图像块以及第一个小框填充的小图像块之外的F-2个小图像块中随机选定一个进行填充；分别对所述拼接框架的F个小框随机填充对应的小图像块，以拼接形成当前产品的一个检测参考图像，通过N次随机拼接，以衍生当前产品的N个检测参考图像。本方案中，在将当前产品的灰度图像中该像素点标记为缺陷点之后，所述方法还包括：将当前产品的灰度图像中所有像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取当前产品的灰度图像中缺陷点，并基于缺陷点在当前产品的灰度图像上进行标记，形成带有缺陷点标记的第一灰度图像；所述历史数据库中选定新一组N个历史产品的灰度图像，将当前产品的灰度图像中所有像素点的灰度值与新一组N个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取当前产品的灰度图像中缺陷点，并基于缺陷点在当前产品的灰度图像上进行标记，形成带有缺陷点标记的第二灰度图像；判断缺陷点标记的第一灰度图像与第二灰度图像之间相同像素点位置的缺陷点标记状态是否一致，如果一致，则认定对应像素点位置的缺陷点标记状态正确，如果不一致，则对该像素点位置的缺陷点标记状态进行修正。本发明第二方面还提出一种基于产品缺陷的光学检测系统，包括存储器和处理器，所述存储器中包括一种基于产品缺陷的光学检测方法程序，所述基于产品缺陷的光学检测方法程序被所述处理器执行时实现如下步骤：通过图像采集器对当前待检测的产品采集获取对应的原始图像，并记录当前检测时间；对所述原始图像进行二值化处理，得到当前产品的灰度图像；判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N，且所述历史产品与当前产品为同类型的不同产品；如果大于，则从所述历史数据库中选定与当前检测时间临近的N个历史产品的灰度图像；将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N个差值，并将N个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将当前产品的灰度图像中该像素点标记为缺陷参考点一次，待N个差值的绝对值分别与第二预设阈值比对完成后，记录当前产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述累计次数是否大于第三预设阈值，如果大于，则将当前产品的灰度图像中该像素点标记为缺陷点。本方案中，将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，具体包括：使用梅林-傅里叶算法分别对当前产品的灰度图像以及某历史产品的灰度图像中的Mark点进行定位，并获取Mark点在当前产品的灰度图像的第一位置信息，以及Mark点在该历史产品的灰度图像的第二位置信息；根据第一位置信息与第二位置信息计算得到当前产品与该历史产品在灰度图像中的偏移向量；取当前产品的灰度图像中像素点T1的坐标位置，将该像素点T1的坐标位置根据所述偏移向量进行移动，得到变换后的坐标位置；根据变换后的坐标位置在该历史产品D 灰度图像中确定出对应的像素点T2；计算当前产品的灰度图像中像素点T1的灰度值与该历史产品的灰度图像对应的像素点T2的灰度值的差值绝对值；判断差值绝对值是否大于第二预设阈值，如果是，则将当前产品的灰度图像中像素点T1标记为缺陷参考点。本方案中，在判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N之后，所述基于产品缺陷的光学检测方法程序被所述处理器执行时还实现如下步骤：如果不大于，则将当前产品的灰度图像录入所述历史数据库中；待所述历史数据库中的灰度图像总数累加到第一预设阈值N时，则启动N个历史产品的灰度图像的互相自检流程；从N个历史产品的灰度图像依次选定待检历史产品的灰度图像，将待检历史产品的灰度图像中某像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N-1个差值，并将N-1个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将待检历史产品的灰度图像中该像素点标记为缺陷参考点一次，待N-1个差值的绝对值分别与第二预设阈值比对完成后，记录待检历史产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述该像素点标记为缺陷参考点的累计次数是否大于第三预设阈值，如果大于，则将待检历史产品的灰度图像中该像素点标记为缺陷点；将待检历史产品的灰度图像中剩余像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取待检历史产品的灰度图像中所有的缺陷点。本发明第三方面还提出一种计算机可读存储介质，所述计算机可读存储介质中包括一种基于产品缺陷的光学检测方法程序，所述基于产品缺陷的光学检测方法程序被处理器执行时，实现如上述的一种基于产品缺陷的光学检测方法的步骤。本发明提出的一种基于产品缺陷的光学检测方法、系统和可读存储介质，能够替代传统人工视觉缺陷检测方式，节省了人力成本，并提升了产品缺陷检测效率和准确率。本发明的附加方面和优点将在下面的描述部分中给出，部分将从下面的描述中变得明显，或通过本发明的实践了解到。附图说明图1示出了本发明一种基于产品缺陷的光学检测方法的流程图；图2示出了本发明一种基于产品缺陷的光学检测系统的框图。具体实施方式为了能够更清楚地理解本发明的上述目的、特征和优点，下面结合附图和具体实施方式对本发明进行进一步的详细描述。需要说明的是，在不冲突的情况下，本申请的实施例及实施例中的特征可以相互组合。在下面的描述中阐述了很多具体细节以便于充分理解本发明，但是，本发明还可以采用其他不同于在此描述的其他方式来实施，因此，本发明的保护范围并不受下面公开的具体实施例的限制。图1示出了本发明一种基于产品缺陷的光学检测方法的流程图。如图1所示，本发明第一方面提出一种基于产品缺陷的光学检测方法，其特征在于，所述方法包括：S102，通过图像采集器对当前待检测的产品采集获取对应的原始图像，并记录当前检测时间；S104，对所述原始图像进行二值化处理，得到当前产品的灰度图像；S106，判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N，且所述历史产品与当前产品为同类型的不同产品；S108，如果大于，则从所述历史数据库中选定与当前检测时间临近的N个历史产品的灰度图像；S110，将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N个差值，并将N个差值的绝对值分别与第二预设阈值进行比对；S112，如果某个差值的绝对值大于第二预设阈值，则将当前产品的灰度图像中该像素点标记为缺陷参考点一次，待N个差值的绝对值分别与第二预设阈值比对完成后，记录当前产品的灰度图像中该像素点标记为缺陷参考点的累计次数；S114，判断所述累计次数是否大于第三预设阈值，如果大于，则将当前产品的灰度图像中该像素点标记为缺陷点。需要说明的是，本发明在不提供合格样品作为参考模板的基础上，仅通过采集多个待检产品的灰度图像，并通过灰度图像各个像素点灰度值的比对分析，进而实现多个待检产品缺陷的相互自检，从而减少了对产品缺陷的检测条件限制，进一步降低了对产品缺陷检测的难度，节省检测成本。可以理解，本发明的历史数据库用于存储历史产品的灰度图像，在实际应用中，图像采集器将按照时间顺序依次对多个待检产品进行采集原始图像，原始图像经过二值化处理后得到灰度图像，稍后将各个灰度图像按照采集的时间依序存储在所述历史数据库。需要说明的是，由于采用相同的图像采集器来采集图像，则历史产品的灰度图像与当前产品的灰度图像的尺寸相同，且包括的像素点数相同，两个灰度图像之间在灰度值比对时，则是基于相同位置的像素点进行比对的。可以理解，各个产品分别固定在定位机构之后，图像采集器开始采集，由于图像采集器与定位机构之间的位置关系固定，则被定位机构定位的产品与图像采集器之前的位置关系也固定，因此各个灰度图像中产品的像素点位置也应相互对应。具体的，将当前产品的灰度图像某像素点分别与N个历史产品的灰度图像对应像素点比对N次，在N次比对过程，累计计算当前产品的灰度图像该像素点标记为参考缺陷点的次数，如果大于第三预设阈值，则说明该像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值之间的差异度较大，根据产品出现缺陷概率较小的事实，则可以认定该像素点为缺陷点。可以理解，在比对该像素点的灰度值的同时，也会同时对其它像素点的灰度值进行并行比对，以此方式，即可筛查出当前产品的灰度图像所有像素点中的缺陷点。根据本发明的实施例，将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，具体包括：使用梅林-傅里叶算法分别对当前产品的灰度图像以及某历史产品的灰度图像中的Mark点进行定位，并获取Mark点在当前产品的灰度图像的第一位置信息，以及Mark点在该历史产品的灰度图像的第二位置信息；根据第一位置信息与第二位置信息计算得到当前产品与该历史产品在灰度图像中的偏移向量；取当前产品的灰度图像中像素点T1的坐标位置，将该像素点T1的坐标位置根据所述偏移向量进行移动，得到变换后的坐标位置；根据变换后的坐标位置在该历史产品D 灰度图像中确定出对应的像素点T2；计算当前产品的灰度图像中像素点T1的灰度值与该历史产品的灰度图像对应的像素点T2的灰度值的差值绝对值；判断差值绝对值是否大于第二预设阈值，如果是，则将当前产品的灰度图像中像素点T1标记为缺陷参考点。可以理解，本发明所述的坐标位置，则是相对于灰度图像的四个边角点而言。所谓的Mark点可以为产品上的非检测区域的特殊点，例如Mark点可以为产品上具有标志性的小圆孔。但不限于此。可以理解，通常每个灰度图像尺寸受相同图像采集器的制约，则得到的各个产品的灰度图像形状、大小均一致，然而由于定位机构在产品定位过程中，各个产品与图像采集器之间的相对位置可能会有偏差，则最终产品在灰度图像的坐标位置也会有偏移。如果直接基于各个灰度图像进行相同坐标位置的像素点一对一灰度值作差比对分析，则可能会因为像素点不对应而导致产品缺陷点误判的现象。本发明在两个灰度图像进行灰度值作差比对分析之前，首先确定两个灰度图像的产品偏移向量，然后基于偏移向量将两个灰度图像的像素点进行对应，进而避免出现产品缺陷点误判的现象。根据本发明的具体实施例，判断所述累计次数是否大于第三预设阈值，具体包括：根据历史数据库中历史产品的灰度图像的缺陷检测数据计算出单个像素点为缺陷点的概率P；根据概率P计算得出第三预设阈值，则第三预设阈值的计算公式为N*，其中k为固定正整数，N为与当前产品的灰度图像作灰度值比对的历史产品的灰度图像总数。根据本发明的具体实施例，根据历史数据库中历史产品的灰度图像的缺陷检测数据计算出单个像素点为缺陷点的概率P，具体包括：从历史数据库中中选定M个灰度图像，预设每个灰度图像的像素点为J个，则M个灰度图像的总像素点为M*J个；统计M个灰度图像中的缺陷点的总数量为L个，则根据总像素点M*J，和缺陷点的总数量L计算出单个像素点的概率P=L/M*J；需要说明的是，通常单个像素点为缺陷点的概率较低，对于多个灰度图像相同位置的像素点为缺陷的数量也会非常少，因此，可以认定相同位置的大部分像素点大都是非缺陷的。假设当前产品的灰度图像某像素点为缺陷，则在灰度值作差分析时，N个历史产品的灰度图像相同位置的像素点为缺陷的概率很低，可以认定N个历史产品的灰度图像相同位置的像素点大部分为非缺陷，有历史检测数据可以分析出单个像素点为缺陷的概率为P，则N个历史产品的灰度图像相同位置的像素点为缺陷的概率数量为N*P，相应的N个历史产品的灰度图像相同位置的像素点不为缺陷的概率数量为N-N*P。然而概率仅仅是表征可能性较高的情况，在个别情况下，也会出现超概率的事件，例如N个历史产品的灰度图像相同位置的像素点有超过N*P个为缺陷，如果直接将第三预设阈值直接设定为N-N*P，则会出现对缺陷点漏检的现象，本发明为了消除该现象，在原有的概率P基础上，进一步扩大k倍，将第三预设阈值设定为N-N*k*P，进一步变形即可得到N*。可以理解，k*P应不大于1/2。可以理解，第三预设阈值与N成正比例关系，即N越大，则第三预设阈值也越大，基于此，该第三预设阈值是浮动的，则可以根据不同产品进行相应变化，为不同产品制定较为准确的阈值，进一步提升了产品缺陷检测准确率。根据本发明的实施例，在判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N之后，所述方法还包括：如果不大于，则将当前产品的灰度图像录入所述历史数据库中；待所述历史数据库中的灰度图像总数累加到第一预设阈值N时，则启动N个历史产品的灰度图像的互相自检流程；从N个历史产品的灰度图像依次选定待检历史产品的灰度图像，将待检历史产品的灰度图像中某像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N-1个差值，并将N-1个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将待检历史产品的灰度图像中该像素点标记为缺陷参考点一次，待N-1个差值的绝对值分别与第二预设阈值比对完成后，记录待检历史产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述该像素点标记为缺陷参考点的累计次数是否大于第三预设阈值，如果大于，则将待检历史产品的灰度图像中该像素点标记为缺陷点；将待检历史产品的灰度图像中剩余像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取待检历史产品的灰度图像中所有的缺陷点。需要说明的是，在初始检测阶段，由于历史产品的灰度图像数量较少，则用于辅助检测的参考灰度图像不足，如果利用数量不多的历史产品的灰度图像对当前产品的灰度图像进行缺陷检测，则检测的准确度不高。因此，本发明的实施例在历史数据库中的历史产品的灰度图像总数不足N个时，则只进行对产品采集图像，并将得到灰度图像存入历史数据库中，并不会在采集图像后，立即对产品缺陷进行检测；而是等待历史数据库中的灰度图像达到N个时，则使N个历史产品的灰度图像进行相互自检，最终可以得各个历史产品的灰度图像中的缺陷点，进而可以实现对检测初期阶段对前N个历史产品进行统一的缺陷检测。根据本发明的实施例，在判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N之后，所述方法还包括：如果不大于，预设产品包括多个阵列周期排布的小元件，基于多个小元件在当前产品的灰度图像中呈现的阵列周期排布状态，将当前产品的灰度图像划分为F个周期性的小图像块；通过N次随机调整F个周期性的小图像块之间的相对位置关系，以衍生当前产品的N个检测参考图像；将当前产品的灰度图像与N个检测参考图像分别基于对应像素点的灰度值作差分析，获取当前产品的灰度图像中的缺陷点。可以理解，如果产品为周期性产品，如阵列产品，则相应的灰度图像也应呈现一定的周期性。在对当前产品进行缺陷检测时，如果历史数据库中的历史产品的灰度图像不足，则可以基于当前产品的灰度图像进行衍生N个检测参考图像，并通过N个检测参考图像实现对当前产品的灰度图像进行缺陷点检测。从而便于对当前产品及时进行缺陷检测，而不必等待历史数据库有N个历史产品的灰度图像。根据本发明的具体实施例，将当前产品的灰度图像与N个检测参考图像分别基于对应像素点的灰度值作差分析，具体包括：将当前产品的灰度图像中某像素点的灰度值与N个检测参考图像对应像素点的灰度值逐一作差计算，得到N个差值，并将N个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将当前产品的灰度图像中该像素点标记为缺陷参考点一次，待N个差值的绝对值分别与第二预设阈值比对完成后，记录当前产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述累计次数是否大于第三预设阈值，如果大于，则将当前产品的灰度图像中该像素点标记为缺陷点。根据本发明的实施例，通过N次随机调整F个周期性的小图像块之间的相对位置关系，以衍生当前产品的N个检测参考图像，具体包括：预定一个用于检测参考图像的拼接框架，所述拼接框架的外框形状、尺寸与当前产品的灰度图像形状、尺寸一致，所述拼接框架包括F个相同的小框，F个小框互不重合且紧密排布，单个小框的形状、尺寸与单个小图像块的形状、尺寸一致；针对所述拼接框架中的第一个小框，从除了与第一个小框对应的小图像块之外的F-1个小图像块中随机选定一个进行填充；针对所述拼接框架中的第二个小框，从除了与第二个小框对应的小图像块以及第一个小框填充的小图像块之外的F-2个小图像块中随机选定一个进行填充；分别对所述拼接框架的F个小框随机填充对应的小图像块，以拼接形成当前产品的一个检测参考图像，通过N次随机拼接，以衍生当前产品的N个检测参考图像。可以理解，与第一个小框对应的小图像块实际是当前产品的灰度图像在第一个小框位置处的小图像块，本发明的具体实施例通过将对应的小图像块除外再进行随机选取，可以避免出现检测参考图像与当前产品的灰度图像完全一致，进而造成产品缺陷不准的影响。换言之，如果不将小框对应的小图像块除外，则假如每个小框都恰好选定对应的小图像块，则由拼接框架拼接的检测参考图像将与当前产品的灰度图像完全一致。需要说明的是，每个检测参考图像都是有F个小图像块进行拼接形成的，各个检测参考图像区别仅在于F个小图像块的相对位置关系不同。根据本发明的具体实施例，在预定一个用于检测参考图像的拼接框架之后，所述方法包括：针对所述拼接框架中的第一个小框，从除了与第一个小框对应的小图像块之外的F-1个小图像块中随机选定一个进行填充；针对所述拼接框架中的第二个小框，从除了与第二个小框对应的小图像块之外的F-1个小图像块中随机选定一个进行填充；分别对所述拼接框架的F个小框随机填充小图像块，以拼接形成当前产品的一个检测参考图像，通过N次随机拼接，以衍生当前产品的N个检测参考图像。可以理解，该具体实施例的单个检测参考图像可能并没有包括F个小图像块，换言之，单个检测参考图像中可能包括相同的小图像块。根据本发明的实施例，在将当前产品的灰度图像中该像素点标记为缺陷点之后，所述方法还包括：将当前产品的灰度图像中所有像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取当前产品的灰度图像中缺陷点，并基于缺陷点在当前产品的灰度图像上进行标记，形成带有缺陷点标记的第一灰度图像；所述历史数据库中选定新一组N个历史产品的灰度图像，将当前产品的灰度图像中所有像素点的灰度值与新一组N个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取当前产品的灰度图像中缺陷点，并基于缺陷点在当前产品的灰度图像上进行标记，形成带有缺陷点标记的第二灰度图像；判断缺陷点标记的第一灰度图像与第二灰度图像之间相同像素点位置的缺陷点标记状态是否一致，如果一致，则认定对应像素点位置的缺陷点标记状态正确，如果不一致，则对该像素点位置的缺陷点标记状态进行修正。可以理解，受到制造设备环境或人为因素的影响，某个相邻时间段的产品缺陷一致性较高，如果仅仅以一隔时间段的历史数据作为参考对当前产品的缺陷检测，则参考价值不大，且准确度不高。则本发明的具体实施例，通过选定多组N个历史产品的灰度图像，首先基于每一组的N个历史产品的灰度图像分别得到当前产品的灰度图像的缺陷点，然后对多组的结果进行一致性比对，如果不一致，则认定为争议点，稍后只针对争议点进行修正。可以理解，本发明并不限于采用两组N个历史产品的灰度图像，也可以为三组、四组或五组，但不限于此。根据本发明的具体实施例，对该像素点位置的缺陷点标记状态进行修正，具体包括：将当前产品的灰度图像中该像素点的灰度值与两组N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到2N个差值，并将2N个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将当前产品的灰度图像中该像素点标记为缺陷参考点一次，待2N个差值的绝对值分别与第二预设阈值比对完成后，记录当前产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述累计次数是否大于第三预设阈值，如果大于，则将该像素点位置的缺陷点标记状态修正为缺陷点，如果不大于，则将该像素点位置的缺陷点标记状态修正为非缺陷点。根据本发明的具体实施例，对该像素点位置的缺陷点标记状态进行修正，具体包括：预设产品包括多个阵列周期排布的小元件，基于多个小元件在当前产品的灰度图像中呈现的阵列周期排布状态；将第一灰度图像与第二灰度图像进行重叠设置，按照相同周期分割方式将第一灰度图像和第二灰度图像分别划分为F个周期性第一小图像块和F个周期性第二小图像块，其中F个第一小图像块和F个第二小图像块一一对应；预定出与单个第一小图像块或第二小图像块的形状、尺寸均相同的校正图像匹配窗口；将所述校正图像匹配窗口按照预设的周期步长依次遍历重叠设置的第一灰度图像与第二灰度图像，其中预设的周期步长为单个小元件在第一灰度图像或第二灰度图像中的尺寸；如果所述校正图像匹配窗口遍历移动到重叠设置的第一灰度图像与第二灰度图像对应的位置，且所述校正图像匹配窗口覆盖的第一灰度图像上的第一图像区域与第二灰度图像上的第二图像区域均没有缺陷点，则将该第一图像区域或第二图像区域选定为校正图像模板；如果某个第一小图像块与对应的第二小图像块有需要修正的缺陷点标记状态，则确定出需要修正的缺陷点标记状态的像素点位置，并获取该像素点位置对应的灰度值；从所述校正图像模板中找出与该像素点位置相对应的校正像素点，并获取该校正像素点位置处的灰度值，并将其与需要修正的缺陷点标记状态的像素点位置处的灰度值进行比对，并判断两者灰度值的差值绝对值是否大于第二预设阈值，如果是，则将需要修正的缺陷点标记状态判定为缺陷点，如果否，则将需要修正的缺陷点标记状态判定为非缺陷点。根据本发明的具体实施例，按照相同周期分割方式将第一灰度图像和第二灰度图像分别划分为F个周期性第一小图像块和F个周期性第二小图像块，具体包括：获取周期长度W和周期宽度E，按照周期长度W和周期宽度E分别对第一灰度图像和第二灰度图像划分为F个周期性第一小图像块和F个周期性第二小图像块。根据本发明的具体实施例，获取周期长度W和周期宽度E，具体包括：建立产品的二维惯性特征提取函数：；；为行方向的惯性特征提取函数，为列方向的惯性特征提取函数，为像素点的灰度值，为行像素总数，为列像素总数，为像素的周期步长；对惯性特征提取函数和分别进行一阶前向差分及二阶前向差分，分别得到一阶前向差分结果、及二阶前向差分结果、，表达式为：；根据二阶前向差分结果、分别计算得到行方向的全局最优周期距离，以及列方向的全局最优周期距离，计算公式为：；其中，是极大值函数，即在不同的周期步长取值下，当或获得最大值时，则对应的周期步长为全局最优周期步长；设定周期长度，设定周期宽度，其中和分别为正整数。图2示出了本发明一种基于产品缺陷的光学检测系统的框图。如图2所示，本发明第二方面还提出一种基于产品缺陷的光学检测系统2，包括存储器21和处理器22，所述存储器中包括一种基于产品缺陷的光学检测方法程序，所述基于产品缺陷的光学检测方法程序被所述处理器执行时实现如下步骤：通过图像采集器对当前待检测的产品采集获取对应的原始图像，并记录当前检测时间；对所述原始图像进行二值化处理，得到当前产品的灰度图像；判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N，且所述历史产品与当前产品为同类型的不同产品；如果大于，则从所述历史数据库中选定与当前检测时间临近的N个历史产品的灰度图像；将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N个差值，并将N个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将当前产品的灰度图像中该像素点标记为缺陷参考点一次，待N个差值的绝对值分别与第二预设阈值比对完成后，记录当前产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述累计次数是否大于第三预设阈值，如果大于，则将当前产品的灰度图像中该像素点标记为缺陷点。根据本发明的实施例，将当前产品的灰度图像中某像素点的灰度值与N个历史产品的灰度图像对应像素点的灰度值逐一作差计算，具体包括：使用梅林-傅里叶算法分别对当前产品的灰度图像以及某历史产品的灰度图像中的Mark点进行定位，并获取Mark点在当前产品的灰度图像的第一位置信息，以及Mark点在该历史产品的灰度图像的第二位置信息；根据第一位置信息与第二位置信息计算得到当前产品与该历史产品在灰度图像中的偏移向量；取当前产品的灰度图像中像素点T1的坐标位置，将该像素点T1的坐标位置根据所述偏移向量进行移动，得到变换后的坐标位置；根据变换后的坐标位置在该历史产品D 灰度图像中确定出对应的像素点T2；计算当前产品的灰度图像中像素点T1的灰度值与该历史产品的灰度图像对应的像素点T2的灰度值的差值绝对值；判断差值绝对值是否大于第二预设阈值，如果是，则将当前产品的灰度图像中像素点T1标记为缺陷参考点。根据本发明的实施例，在判断历史数据库中存储的历史产品的灰度图像数量是否大于第一预设阈值N之后，所述基于产品缺陷的光学检测方法程序被所述处理器执行时还实现如下步骤：如果不大于，则将当前产品的灰度图像录入所述历史数据库中；待所述历史数据库中的灰度图像总数累加到第一预设阈值N时，则启动N个历史产品的灰度图像的互相自检流程；从N个历史产品的灰度图像依次选定待检历史产品的灰度图像，将待检历史产品的灰度图像中某像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值逐一作差计算，得到N-1个差值，并将N-1个差值的绝对值分别与第二预设阈值进行比对；如果某个差值的绝对值大于第二预设阈值，则将待检历史产品的灰度图像中该像素点标记为缺陷参考点一次，待N-1个差值的绝对值分别与第二预设阈值比对完成后，记录待检历史产品的灰度图像中该像素点标记为缺陷参考点的累计次数；判断所述该像素点标记为缺陷参考点的累计次数是否大于第三预设阈值，如果大于，则将待检历史产品的灰度图像中该像素点标记为缺陷点；将待检历史产品的灰度图像中剩余像素点的灰度值与剩余N-1个历史产品的灰度图像对应像素点的灰度值进行逐一比对分析，从而获取待检历史产品的灰度图像中所有的缺陷点。本发明第三方面还提出一种计算机可读存储介质，所述计算机可读存储介质中包括一种基于产品缺陷的光学检测方法程序，所述基于产品缺陷的光学检测方法程序被处理器执行时，实现如上述的一种基于产品缺陷的光学检测方法的步骤。本发明提出的一种基于产品缺陷的光学检测方法、系统和可读存储介质，能够替代传统人工视觉缺陷检测方式，节省了人力成本，并提升了产品缺陷检测效率和准确率。在本申请所提供的几个实施例中，应该理解到，所揭露的设备和方法，可以通过其它的方式实现。以上所描述的设备实施例仅仅是示意性的，例如，所述单元的划分，仅仅为一种逻辑功能划分，实际实现时可以有另外的划分方式，如：多个单元或组件可以结合，或可以集成到另一个系统，或一些特征可以忽略，或不执行。另外，所显示或讨论的各组成部分相互之间的耦合、或直接耦合、或通信连接可以是通过一些接口，设备或单元的间接耦合或通信连接，可以是电性的、机械的或其它形式的。上述作为分离部件说明的单元可以是、或也可以不是物理上分开的，作为单元显示的部件可以是、或也可以不是物理单元；既可以位于一个地方，也可以分布到多个网络单元上；可以根据实际的需要选择其中的部分或全部单元来实现本实施例方案的目的。另外，在本发明各实施例中的各功能单元可以全部集成在一个处理单元中，也可以是各单元分别单独作为一个单元，也可以两个或两个以上单元集成在一个单元中；上述集成的单元既可以采用硬件的形式实现，也可以采用硬件加软件功能单元的形式实现。本领域普通技术人员可以理解：实现上述方法实施例的全部或部分步骤可以通过程序指令相关的硬件来完成，前述的程序可以存储于计算机可读取存储介质中，该程序在执行时，执行包括上述方法实施例的步骤；而前述的存储介质包括：移动存储设备、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质。或者，本发明上述集成的单元如果以软件功能模块的形式实现并作为独立的产品销售或使用时，也可以存储在一个计算机可读取存储介质中。基于这样的理解，本发明实施例的技术方案本质上或者说对现有技术做出贡献的部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台计算机设备执行本发明各个实施例所述方法的全部或部分。而前述的存储介质包括：移动存储设备、ROM、RAM、磁碟或者光盘等各种可以存储程序代码的介质。以上所述，仅为本发明的具体实施方式，但本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，可轻易想到变化或替换，都应涵盖在本发明的保护范围之内。因此，本发明的保护范围应以所述权利要求的保护范围为准。
