标题title
密码设备密钥销毁的实现方法及装置
摘要abst
本发明属于密码设备技术领域，具体涉及一种密码设备密钥销毁的实现方法及装置，密码设备包括主存储区和密钥存储区；主存储区，用于存储设备保护密钥MK、存在标识因子和存在标识EXIST_FLAG，所述存在标识EXIST_FLAG采用设备保护密钥MK对存在标识因子加密得到；密钥存储区，用于存储n个密钥，在每个密钥导入时会从主存储区读取存在标识EXIST_FLAG，将密钥和相应的存在标识一起存储，连续多个密钥以数组的形式在密钥存储区中依次存储，密钥索引作为下标；对单个密钥删除时，只需要删除单个密钥对应的密钥存储区；对所有密钥删除时，只需要删除主存储区中的设备保护密钥MK和存在标识EXIST_FLAG，能够实现快速删除所有密钥的目的，提高密钥删除的效率。
权利要求书clms
1.一种密码设备密钥销毁的实现方法，其特征在于，包括：设计密码设备的存储方式：密码设备包括主存储区和密钥存储区，所述主存储区用于存储设备保护密钥MK、存在标识因子和存在标识EXIST_FLAG，所述存在标识EXIST_FLAG采用设备保护密钥MK对存在标识因子加密得到；所述密钥存储区用于存储n个密钥，在每个密钥导入时会从主存储区读取存在标识EXIST_FLAG，将密钥和相应的存在标识一起存储，连续多个密钥以数组的形式在密钥存储区中依次存储，密钥索引作为下标；对单个密钥的删除：只需要删除单个密钥对应的密钥存储区；对所有密钥的删除：只需要删除主存储区中的设备保护密钥MK和存在标识EXIST_FLAG，能够实现快速删除所有密钥的目的。2.根据权利要求1所述的密码设备密钥销毁的实现方法，其特征在于，所述存在标识因子是一个固定的常量字符串；所述存在标识因子使用填充算法填充到16字节，再使用设备保护密钥MK作为密钥对其加密得到16字节密文，获取16字节密文的任意4字节作为存在标识EXIST_FLAG，保存在密码设备FLASH中的主存储区。3.根据权利要求1所述的密码设备密钥销毁的实现方法，其特征在于，所述密钥存储区的各个密钥均使用设备保护密钥MK进行加密。4.根据权利要求3所述的密码设备密钥销毁的实现方法，其特征在于，向密钥存储区导入密钥时：使用设备保护密钥MK加密得到密钥的密文C1；每个密钥的密文C1导入时会从主存储区读取存在标识EXIST_FLAG，然后把密钥密文C1和存在标识一起写入密钥存储区。5.根据权利要求4所述的密码设备密钥销毁的实现方法，其特征在于，从密钥存储区导出密钥时：根据密钥索引读出密钥存储区的存在标识，将其与主存储区保存的存在标识EXIST_FLAG进行比较，如果一致，表示密钥存在，如果不一致，表示密钥不存在；如果密钥存在，继续读取密钥的值并返回密钥的值；如果密钥不存在，直接返回密钥不存在的密钥错误码。6.根据权利要求4所述的密码设备密钥销毁的实现方法，其特征在于，获取密钥状态时：根据密钥索引读出密钥存储区的存在标识，将其与主存储区保存的存在标识EXIST_FLAG进行比较，如果一致，表示密钥存在，如果不一致，表示密钥不存在；返回密钥状态。7.一种密码设备密钥销毁的实现装置，其特征在于，包括密码设备，所述密码设备包括主存储区和密钥存储区；主存储区，用于存储设备保护密钥MK、存在标识因子和存在标识EXIST_FLAG，所述存在标识EXIST_FLAG采用设备保护密钥MK对存在标识因子加密得到；密钥存储区，用于存储n个密钥，在每个密钥导入时会从主存储区读取存在标识EXIST_FLAG，将密钥和相应的存在标识一起存储，连续多个密钥以数组的形式在密钥存储区中依次存储，密钥索引作为下标。
说明书desc
技术领域本发明属于密码设备技术领域，具体涉及一种密码设备密钥销毁的实现方法及装置。背景技术密码设备一般要求支持毁钥接口，毁钥功能需要在短时间内高效实现。如果密码设备存储的密钥数量较大，毁钥时间往往较长，需要设计一种高效的实现方式。密钥毁钥的目的是擦除密钥内容。现有的一种实现方式是每个密钥保存的时候带一个密钥存在标识，将密钥存在标识和密钥内容分开存放，毁钥时只擦除密钥存在标识，也能达到毁钥的目的，但有两个隐患：1、密钥存在标识统一存放在密钥标识区，密钥标识区反复擦写，影响芯片寿命。2、由于仅仅擦除密钥存在标识，密钥内容没有销毁，仍存在泄漏风险。发明内容针对现有技术中存在的问题，本发明提出一种密码设备密钥销毁的实现方法及装置，提高销毁密钥的效率，从而提高密码设备的安全性。为解决上述技术问题，本发明采用以下的技术方案：本发明提供了一种密码设备密钥销毁的实现方法，包括：设计密码设备的存储方式：密码设备包括主存储区和密钥存储区，所述主存储区用于存储设备保护密钥MK、存在标识因子和存在标识EXIST_FLAG，所述存在标识EXIST_FLAG采用设备保护密钥MK对存在标识因子加密得到；所述密钥存储区用于存储n个密钥，在每个密钥导入时会从主存储区读取存在标识EXIST_FLAG，将密钥和相应的存在标识一起存储，连续多个密钥以数组的形式在密钥存储区中依次存储，密钥索引作为下标；对单个密钥的删除：只需要删除单个密钥对应的密钥存储区；对所有密钥的删除：只需要删除主存储区中的设备保护密钥MK和存在标识EXIST_FLAG，能够实现快速删除所有密钥的目的。进一步地，所述存在标识因子是一个固定的常量字符串；所述存在标识因子使用填充算法填充到16字节，再使用设备保护密钥MK作为密钥对其加密得到16字节密文，获取16字节密文的任意4字节作为存在标识EXIST_FLAG，保存在密码设备FLASH中的主存储区。进一步地，所述密钥存储区的各个密钥均使用设备保护密钥MK进行加密。进一步地，向密钥存储区导入密钥时：使用设备保护密钥MK加密得到密钥的密文C1；每个密钥的密文C1导入时会从主存储区读取存在标识EXIST_FLAG，然后把密钥密文C1和存在标识一起写入密钥存储区。进一步地，从密钥存储区导出密钥时：根据密钥索引读出密钥存储区的存在标识，将其与主存储区保存的存在标识EXIST_FLAG进行比较，如果一致，表示密钥存在，如果不一致，表示密钥不存在；如果密钥存在，继续读取密钥的值并返回密钥的值；如果密钥不存在，直接返回密钥不存在的密钥错误码。进一步地，获取密钥状态时：根据密钥索引读出密钥存储区的存在标识，将其与主存储区保存的存在标识EXIST_FLAG进行比较，如果一致，表示密钥存在，如果不一致，表示密钥不存在；返回密钥状态。本发明还提供了一种密码设备密钥销毁的实现装置，包括密码设备，所述密码设备包括主存储区和密钥存储区；主存储区，用于存储设备保护密钥MK、存在标识因子和存在标识EXIST_FLAG，所述存在标识EXIST_FLAG采用设备保护密钥MK对存在标识因子加密得到；密钥存储区，用于存储n个密钥，在每个密钥导入时会从主存储区读取存在标识EXIST_FLAG，将密钥和相应的存在标识一起存储，连续多个密钥以数组的形式在密钥存储区中依次存储，密钥索引作为下标。与现有技术相比，本发明具有以下优点：1、密钥的存在标识和密钥保存在一起，分散存储密钥的存在标识，能够极大的延长密码设备的FLASH寿命；如果密钥的存在标识和密钥分开保存，密钥的存在标识通常占用FLASH存储比较少，集中在一个或几个扇区，频繁操作可能会影响该扇区的使用寿命。2、密钥的存在标识和密钥分别使用设备保护密钥MK加密并保存，在导出密钥时可以先读取密钥存储区的存在标识，与主存储区保存的存在标识EXIST_FLAG进行比较，判断密钥存在以后再读取密钥，如果密钥不存在直接返回，这样可以提高密码设备密钥导出接口的效率。3、密钥的存在标识和密钥单独使用设备保护密钥MK加密并保存，在导出密钥或者获取密钥状态的时候，只需要读取密钥存储区的存在标识就可以知道密钥是否存在，不需要读取完整的密钥；像RSA2048私钥将近1K左右，如果密钥的存在标识和密钥一起加密保存的话，需要读取1K的内容才能判断密钥是否存在，会降低接口效率。4、在设备初始化或者设备紧急销毁所有密钥的时候只需要删除MK和EXIST_FLAG即可；删除主存储区的MK，则无法解密密钥密文，也就无法读取出对应的密钥进行业务处理，同时删除EXIST_FLAG，使密钥存储区的存在标识无法与主存储区的EXIST_FLAG比对成功，也就读取不了密钥的值，从而达到快速“销毁”目的。尤其是对于密钥比较多而且FLASH擦除比较慢的设备，这样设计可以极大的提高销毁所有密钥的效率，从而提高密码设备的安全性。5、存在标识EXIST_FLAG采用设备保护密钥MK对存在标识因子加密得到，能够保证存在标识的安全性，不会轻易被篡改。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明实施例的密码设备密钥销毁的实现方法的流程示意图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例，基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。如图1所示，本实施例的密码设备密钥销毁的实现方法，包括：设计密码设备的存储方式：密码设备包括主存储区和密钥存储区，所述主存储区用于存储设备保护密钥MK、存在标识因子和存在标识EXIST_FLAG，所述存在标识EXIST_FLAG采用设备保护密钥MK对存在标识因子加密得到；所述密钥存储区用于存储n个密钥，在每个密钥导入时会从主存储区读取存在标识EXIST_FLAG，将密钥和相应的存在标识一起存储，连续多个密钥以数组的形式在密钥存储区中依次存储，密钥索引作为下标。具体的，所述存在标识因子是一个固定的常量字符串；所述存在标识因子使用填充算法填充到16字节，再使用设备保护密钥MK作为密钥对其加密得到16字节密文，获取16字节密文的任意4字节作为存在标识EXIST_FLAG，保存在密码设备FLASH中的主存储区。导入密钥时：使用设备保护密钥MK加密得到密钥的密文C1；每个密钥的密文C1导入时会从主存储区读取存在标识EXIST_FLAG，然后把密钥密文C1和存在标识一起写入密钥存储区。导出密钥时：根据密钥索引读出密钥存储区的存在标识，将其与主存储区保存的存在标识EXIST_FLAG进行比较，如果一致，表示密钥存在，如果不一致，表示密钥不存在；如果密钥存在，继续读取密钥的值并返回密钥的值；如果密钥不存在，直接返回密钥不存在的密钥错误码。获取密钥状态时：根据密钥索引读出密钥存储区的存在标识，将其与主存储区保存的存在标识EXIST_FLAG进行比较，如果一致，表示密钥存在，如果不一致，表示密钥不存在；返回密钥状态。密钥的存在标识和密钥分别使用设备保护密钥MK加密并保存，在导出密钥时可以先读取密钥存储区的存在标识，与主存储区保存的存在标识EXIST_FLAG进行比较，判断密钥存在以后再读取密钥，如果密钥不存在直接返回，这样可以提高密码设备密钥导出接口的效率。密钥的存在标识和密钥单独使用设备保护密钥MK加密并保存，在导出密钥或者获取密钥状态的时候，只需要读取密钥存储区的存在标识就可以知道密钥是否存在，不需要读取完整的密钥；像RSA2048私钥将近1K左右，如果密钥的存在标识和密钥一起加密保存的话，需要读取1K的内容才能判断密钥是否存在，会降低接口效率。对单个密钥的删除：只需要删除单个密钥对应的密钥存储区；当需要删除某一个或多个密钥时，可将该密钥和对应的存在标识一起删除，由于密钥的存在标识和密钥保存在一起，分散存储密钥的存在标识，能够极大的延长密码设备的FLASH寿命；如果密钥的存在标识和密钥分开保存，密钥的存在标识通常占用FLASH存储比较少，集中在一个或几个扇区，频繁操作可能会影响该扇区的使用寿命。对所有密钥的删除：只需要删除主存储区中的设备保护密钥MK和存在标识EXIST_FLAG，能够实现快速删除所有密钥的目的。原理是：删除主存储区的MK，则无法解密密钥密文，也就无法读取出对应的密钥进行业务处理，同时删除EXIST_FLAG，使密钥存储区的存在标识无法与主存储区的EXIST_FLAG比对成功，也就读取不了密钥的值，从而达到快速“销毁”目的。尤其是对于密钥比较多而且FLASH擦除比较慢的设备，这样设计可以极大的提高销毁所有密钥的效率，从而提高密码设备的安全性。本实施例还提出了一种密码设备密钥销毁的实现装置，包括密码设备，所述密码设备包括主存储区和密钥存储区；主存储区，用于存储设备保护密钥MK、存在标识因子和存在标识EXIST_FLAG，所述存在标识EXIST_FLAG采用设备保护密钥MK对存在标识因子加密得到；密钥存储区，用于存储n个密钥，在每个密钥导入时会从主存储区读取存在标识EXIST_FLAG，将密钥和相应的存在标识一起存储，连续多个密钥以数组的形式在密钥存储区中依次存储，密钥索引作为下标。需要说明的是，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。本领域普通技术人员可以理解：实现上述方法实施例的全部或部分步骤可以通过程序指令相关的硬件来完成，前述的程序可以存储在计算机可读取的存储介质中，该程序在执行时，执行包括上述方法实施例的步骤；而前述的存储介质包括：ROM、RAM、磁碟或者光盘等各种可以存储程序代码的介质中。最后需要说明的是：以上所述仅为本发明的较佳实施例，仅用于说明本发明的技术方案，并非用于限定本发明的保护范围。凡在本发明的精神和原则之内所做的任何修改、等同替换、改进等，均包含在本发明的保护范围内。
