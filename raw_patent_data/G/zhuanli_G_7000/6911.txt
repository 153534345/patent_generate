标题title
一种基于硬件辅助的虚拟可信平台及安全处理方法
摘要abst
本申请提供了一种基于硬件辅助的虚拟可信平台及安全处理方法，虚拟可信平台中应用程序使用TSS接口通过调用VirtIO前端驱动，将待处理请求写入环形队列，VirtIO后端驱动从环形队列中获取待处理请求，并将待处理请求发送给密码协处理器加密接口，密码协处理器加密接口通过调用密码协处理器驱动程序，将待处理请求发送给密码协处理器，以使密码协处理器对待处理请求进行安全运算处理，得到处理结果，实现基于硬件对数据进行安全运算，增强虚拟可信平台的安全性保护能力，提高数据的安全性。
权利要求书clms
1.一种安全处理方法，其特征在于，基于虚拟可信平台，所述虚拟可信平台包括：虚拟机用户空间、虚拟机内核空间、主机用户空间、主机内核空间和密码协处理器，所述虚拟机用户空间中部署有应用程序和TSS接口，所述虚拟机内核空间包含虚拟安全设备和VirtIO前端驱动，所述主机用户空间至少包含VirtIO后端驱动和密码协处理器加密接口，所述主机内核空间包含密码协处理器驱动程序，该方法包括：所述应用程序使用所述TSS接口调用所述VirtIO前端驱动，由所述VirtIO前端驱动将待处理请求写入环形队列；所述VirtIO后端驱动从所述环形队列中获取所述待处理请求，并将所述待处理请求发送给所述密码协处理器加密接口；所述密码协处理器加密接口通过调用所述密码协处理器驱动程序，将所述待处理请求发送给所述密码协处理器；所述密码协处理器对所述待处理请求进行安全运算处理，得到处理结果，并将所述处理结果返回给所述应用程序；所述应用程序获取所述处理结果。2.根据权利要求1所述的方法，其特征在于，所述将所述处理结果返回给所述应用程序，包括：通过所述密码协处理器驱动程序将所述处理结果返回给所述密码协处理器加密接口，以使所述密码协处理器加密接口将所述处理结果返回给所述VirtIO后端驱动；所述应用程序获取所述处理结果，包括：所述应用程序接受所述VirtIO后端驱动通过中断注入机制返回的所述处理结果。3.根据权利要求1所述的方法，其特征在于，所述密码协处理器与所述主机用户空间中的硬件安全设备具备绑定关系，所述绑定关系通过以下方式建立：所述硬件安全设备在向本地证书签发机构展示EK密钥证明其身份后，向所述本地证书签发机构申请硬件AIK证书；所述硬件安全设备利用所述硬件AIK证书为所述密码协处理器颁发AIK证书，以建立所述硬件安全设备与所述密码协处理器的绑定关系。4.根据权利要求3所述的方法，其特征在于，所述方法还包括：所述密码协处理器生成所述虚拟安全设备的EK密钥，并为所述虚拟安全设备的EK密钥颁发证书；所述虚拟安全设备在使用所述虚拟安全设备的EK密钥向所述本地证书签发机构证明其身份后，向所述本地证书签发机构申请虚拟AIK证书，以使所述本地证书签发机构向所述虚拟安全设备颁发虚拟AIK证书。5.根据权利要求4所述的方法，其特征在于，所述方法还包括：所述虚拟安全设备将所述主机用户空间中的硬件安全设备的寄存器中的度量值映射到所述虚拟安全设备的寄存器中；在对所述虚拟机用户空间及所述虚拟机内核空间进行远程证明的情况下，所述虚拟安全设备通过所述虚拟AIK证书对所述虚拟安全设备的寄存器中的度量值进行签名，得到度量值签名；所述虚拟安全设备将所述度量值签名及所述虚拟安全设备的寄存器中的度量值发送给远程证明设备，以使所述远程证明设备基于所述虚拟安全设备的寄存器中的度量值，对所述硬件安全设备进行可信证明，及基于所述度量值签名及所述虚拟安全设备的寄存器中的度量值，对所述虚拟安全设备进行可信证明。6.根据权利要求1所述的方法，其特征在于，所述方法还包括：所述主机用户空间中虚拟安全设备管理模块获取云计算迁移控制服务器的迁移命令，并锁定所述虚拟可信平台，对与所述虚拟安全设备关联的数据进行打包，得到数据包；所述虚拟安全设备管理模块获取所述云计算迁移控制服务器为所述虚拟可信平台分配的会话加密密钥，所述会话加密密钥通过以下方式分配：基于所述虚拟可信平台中硬件安全设备对所述虚拟可信平台进行可信证明，在证明所述虚拟可信平台可信后，为所述虚拟可信平台分配会话加密密钥；所述虚拟安全设备管理模块利用所述会话加密密钥对所述数据包进行加密，得到加密数据，并利用所述密码协处理器对所述加密数据包进行签名，得到数据签名；所述虚拟安全设备管理模块将所述加密数据及所述数据签名发送给另一个虚拟可信平台的主机用户空间，以使另一个虚拟可信平台的主机用户空间向所述云计算迁移控制服务器申请与所述会话加密密钥匹配的会话解密密钥，并利用所述会话解密密钥对所述加密数据进行解密，并对所述数据签名进行验签。7.一种基于硬件辅助的虚拟可信平台，其特征在于，包括：虚拟机用户空间、虚拟机内核空间、主机用户空间、主机内核空间和密码协处理器，所述虚拟机用户空间中部署有应用程序和TSS接口，所述虚拟机内核空间包含虚拟安全设备和VirtIO前端驱动，所述主机用户空间至少包含VirtIO后端驱动和密码协处理器加密接口，所述主机内核空间包含密码协处理器驱动程序；所述应用程序，用于使用所述TSS接口调用所述VirtIO前端驱动；所述VirtIO前端驱动，用于将待处理请求写入环形队列；所述VirtIO后端驱动，用于从所述环形队列中获取所述待处理请求，并将所述待处理请求发送给所述密码协处理器加密接口；所述密码协处理器加密接口，用于调用所述密码协处理器驱动程序；所述密码协处理器驱动程序，用于将所述待处理请求发送给密码协处理器；所述密码协处理器，用于对所述待处理请求进行安全运算处理，得到处理结果，并将所述处理结果返回给所述应用程序；所述应用程序，还用于获取所述处理结果。8.根据权利要求7所述的虚拟可信平台，其特征在于，所述密码协处理器加密接口，还用于接收所述密码协处理器通过所述密码协处理器驱动程序返回的所述处理结果，及将所述处理结果返回给所述VirtIO后端驱动；所述VirtIO后端驱动，还用于通过中断注入机制将所述处理结果返回给所述应用程序。9.根据权利要求7所述的虚拟可信平台，其特征在于，所述虚拟可信平台还包括：建立模块，用于所述硬件安全设备在向本地证书签发机构展示EK密钥证明其身份后，向所述本地证书签发机构申请硬件AIK证书；所述硬件安全设备利用所述硬件AIK证书为所述密码协处理器颁发AIK证书，以建立所述硬件安全设备与所述密码协处理器的绑定关系。10.根据权利要求9所述的虚拟可信平台，其特征在于，所述密码协处理器，还用于：生成所述虚拟安全设备的EK密钥，并为所述虚拟安全设备的EK密钥颁发证书；所述虚拟安全设备，用于在使用所述虚拟安全设备的EK密钥向所述本地证书签发机构证明其身份后，向所述本地证书签发机构申请虚拟AIK证书，以使所述本地证书签发机构向所述虚拟安全设备颁发虚拟AIK证书。11.根据权利要求10所述的虚拟可信平台，其特征在于，所述虚拟安全设备，还用于：将所述主机用户空间中的硬件安全设备的寄存器中的度量值映射到所述虚拟安全设备的寄存器中；在对所述虚拟机用户空间及所述虚拟机内核空间进行远程证明的情况下，所述虚拟安全设备，还用于通过所述虚拟AIK证书对所述虚拟安全设备的寄存器中的度量值进行签名，得到度量值签名；将所述度量值签名及所述虚拟安全设备的寄存器中的度量值发送给远程证明设备，以使所述远程证明设备基于所述虚拟安全设备的寄存器中的度量值，对所述硬件安全设备进行可信证明，及基于所述度量值签名及所述虚拟安全设备的寄存器中的度量值，对所述虚拟安全设备进行可信证明。12.根据权利要求7所述的虚拟可信平台，其特征在于，所述主机用户空间还包括：虚拟安全设备管理模块，用于：获取云计算迁移控制服务器的迁移命令，并锁定所述虚拟可信平台，对与所述虚拟安全设备关联的数据进行打包，得到数据包；获取所述云计算迁移控制服务器为所述虚拟可信平台分配的会话加密密钥，所述会话加密密钥通过以下方式分配：基于所述虚拟可信平台中硬件安全设备对所述虚拟可信平台进行可信证明，在证明所述虚拟可信平台可信后，为所述虚拟可信平台分配会话加密密钥；利用所述会话加密密钥对所述数据包进行加密，得到加密数据，并利用所述密码协处理器对所述加密数据包进行签名，得到数据签名；将所述加密数据及所述数据签名发送给另一个虚拟可信平台的主机用户空间，以使另一个虚拟可信平台的主机用户空间向所述云计算迁移控制服务器申请与所述会话加密密钥匹配的会话解密密钥，并利用所述会话解密密钥对所述加密数据进行解密，并对所述数据签名进行验签。
说明书desc
技术领域本申请涉及计算机技术领域，特别涉及一种基于硬件辅助的虚拟可信平台及安全处理方法。背景技术面向5G云化网络环境下安全性需求，往往采用在云化架构中部署灵活、扩展性高的虚拟可信平台来增强5G云化网络环境下的安全性。但是，现行的云环境下虚拟可信平台对数据的安全性保护能力不足，导致数据的安全性差。并且，虚拟可信平台对数据的隔离效果较差。发明内容本申请提供如下技术方案：一种安全处理方法，基于虚拟可信平台，所述虚拟可信平台包括：虚拟机用户空间、虚拟机内核空间、主机用户空间和主机内核空间，所述虚拟机用户空间中部署有应用程序和TSS接口，所述虚拟机内核空间包含虚拟安全设备和VirtIO前端驱动，所述主机用户空间至少包含VirtIO后端驱动和密码协处理器加密接口，所述主机内核空间包含密码协处理器驱动程序，该方法包括：所述应用程序使用所述TSS接口调用所述VirtIO前端驱动，由所述VirtIO前端驱动将待处理请求写入环形队列；所述VirtIO后端驱动从所述环形队列中获取所述待处理请求，并将所述待处理请求发送给所述密码协处理器加密接口；所述密码协处理器加密接口通过调用所述密码协处理器驱动程序，将所述待处理请求发送给密码协处理器，以使所述密码协处理器对所述待处理请求进行安全运算处理，得到处理结果，并将所述处理结果返回给所述应用程序；所述应用程序获取所述处理结果。可选的，所述将所述处理结果返回给所述应用程序，包括：通过所述密码协处理器驱动程序将所述处理结果返回给所述密码协处理器加密接口；所述密码协处理器加密接口将所述处理结果返回给所述VirtIO后端驱动；所述VirtIO后端驱动通过中断注入机制将所述处理结果返回给所述应用程序。可选的，所述密码协处理器与所述主机用户空间中的硬件安全设备具备绑定关系，所述绑定关系通过以下方式建立：所述硬件安全设备在向本地证书签发机构展示EK密钥证明其身份后，向所述本地证书签发机构申请硬件AIK证书；所述硬件安全设备利用所述硬件AIK证书为所述密码协处理器颁发AIK证书，以建立所述硬件安全设备与所述密码协处理器的绑定关系。可选的，所述方法还包括：基于所述密码协处理器生成所述虚拟安全设备的EK密钥，并利用所述密码协处理器AIK密钥为所述虚拟安全设备的EK密钥颁发证书；所述虚拟安全设备在使用所述虚拟安全设备的EK密钥向所述本地证书签发机构证明其身份后，向所述本地证书签发机构申请虚拟AIK证书，以使所述本地证书签发机构向所述虚拟安全设备颁发虚拟AIK证书。可选的，所述方法还包括：将所述主机用户空间中的硬件安全设备的寄存器中的度量值映射到所述虚拟安全设备的寄存器中；在对所述虚拟机用户空间及所述虚拟机内核空间进行远程证明的情况下，所述虚拟安全设备通过所述虚拟AIK证书对所述虚拟安全设备的寄存器中的度量值进行签名，得到度量值签名；所述虚拟安全设备将所述度量值签名及所述虚拟安全设备的寄存器中的度量值发送给远程证明设备，以使所述远程证明设备基于所述虚拟安全设备的寄存器中的度量值，对所述硬件安全设备进行可信证明，及基于所述度量值签名及所述虚拟安全设备的寄存器中的度量值，对所述虚拟安全设备进行可信证明。可选的，所述方法还包括：所述虚拟可信平台获取云计算迁移控制服务器的迁移命令，并锁定所述虚拟可信平台，对与所述虚拟安全设备关联的数据进行打包，得到数据包；所述虚拟可信平台获取所述云计算迁移控制服务器为所述虚拟可信平台分配的会话加密密钥，所述会话加密密钥通过以下方式分配：基于所述虚拟可信平台中硬件安全设备对所述虚拟可信平台进行可信证明，在证明所述虚拟可信平台可信后，为所述虚拟可信平台分配会话加密密钥；所述虚拟可信平台利用所述会话加密密钥对所述数据包进行加密，得到加密数据，并利用所述密码协处理器对所述加密数据包进行签名，得到数据签名；将所述加密数据及所述数据签名发送给另一个虚拟可信平台，以使另一个虚拟可信平台向所述云计算迁移控制服务器申请与所述会话加密密钥匹配的会话解密密钥，并利用所述会话解密密钥对所述加密数据进行解密，并对所述数据签名进行验签。一种基于硬件辅助的虚拟可信平台，包括：虚拟机用户空间、虚拟机内核空间、主机用户空间和主机内核空间，所述虚拟机用户空间中部署有应用程序和TSS接口，所述虚拟机内核空间包含虚拟安全设备和VirtIO前端驱动，所述主机用户空间至少包含VirtIO后端驱动和密码协处理器加密接口，所述主机内核空间包含密码协处理器驱动程序；所述应用程序，用于使用所述TSS接口调用所述VirtIO前端驱动；所述VirtIO前端驱动，用于将待处理请求写入环形队列；所述VirtIO后端驱动，用于从所述环形队列中获取所述待处理请求，并将所述待处理请求发送给所述密码协处理器加密接口；所述密码协处理器加密接口，用于调用所述密码协处理器驱动程序；所述密码协处理器驱动程序，用于将所述待处理请求发送给密码协处理器，以使所述密码协处理器对所述待处理请求进行安全运算处理，得到处理结果，并将所述处理结果返回给所述应用程序；所述应用程序，还用于获取所述处理结果。可选的，所述密码协处理器加密接口，还用于接收所述密码协处理器通过所述密码协处理器驱动程序返回的所述处理结果，及将所述处理结果返回给所述VirtIO后端驱动；所述VirtIO后端驱动，还用于通过中断注入机制将所述处理结果返回给所述应用程序。可选的，所述虚拟可信平台还包括：建立模块，用于所述硬件安全设备在向本地证书签发机构展示EK密钥证明其身份后，向所述本地证书签发机构申请硬件AIK证书；所述硬件安全设备利用所述硬件AIK证书为所述密码协处理器颁发AIK证书，以建立所述硬件安全设备与所述密码协处理器的绑定关系。可选的，基于所述密码协处理器生成所述虚拟安全设备的EK密钥，并利用所述密码协处理器AIK证书为所述虚拟安全设备的EK密钥颁发证书；所述虚拟安全设备，用于在使用所述虚拟安全设备的EK密钥向所述本地证书签发机构证明其身份后，向所述本地证书签发机构申请虚拟AIK证书，以使所述本地证书签发机构向所述虚拟安全设备颁发虚拟AIK证书。可选的，还包括：将所述主机用户空间中的硬件安全设备的寄存器中的度量值映射到所述虚拟安全设备的寄存器中；在对所述虚拟机用户空间及所述虚拟机内核空间进行远程证明的情况下，所述虚拟安全设备，还用于通过所述虚拟AIK证书对所述虚拟安全设备的寄存器中的度量值进行签名，得到度量值签名；所述虚拟安全设备，还用于将所述度量值签名及所述虚拟安全设备的寄存器中的度量值发送给远程证明设备，以使所述远程证明设备基于所述虚拟安全设备的寄存器中的度量值，对所述硬件安全设备进行可信证明，及基于所述度量值签名及所述虚拟安全设备的寄存器中的度量值，对所述虚拟安全设备进行可信证明。可选的，所述虚拟可信平台，具体用于：获取云计算迁移控制服务器的迁移命令，并锁定所述虚拟可信平台，对与所述虚拟安全设备关联的数据进行打包，得到数据包；获取所述云计算迁移控制服务器为所述虚拟可信平台分配的会话加密密钥，所述会话加密密钥通过以下方式分配：基于所述虚拟可信平台中硬件安全设备对所述虚拟可信平台进行可信证明，在证明所述虚拟可信平台可信后，为所述虚拟可信平台分配会话加密密钥；利用所述会话加密密钥对所述数据包进行加密，得到加密数据，并利用所述密码协处理器对所述加密数据包进行签名，得到数据签名；将所述加密数据及所述数据签名发送给另一个虚拟可信平台的主机用户空间，以使另一个虚拟可信平台的主机用户空间向所述云计算迁移控制服务器申请与所述会话加密密钥匹配的会话解密密钥，并利用所述会话解密密钥对所述加密数据进行解密，并对所述数据签名进行验签。与现有技术相比，本申请的有益效果为：在本申请中，提供一种虚拟可信平台，虚拟可信平台中虚拟机内核空间包含虚拟安全设备和VirtIO前端驱动，主机用户空间至少包含VirtIO后端驱动和密码协处理器加密接口，及主机内核空间包含密码协处理器驱动程序，其中，应用程序使用TSS接口通过调用所述VirtIO前端驱动，将待处理请求写入环形队列，VirtIO后端驱动从环形队列中获取待处理请求，并将待处理请求发送给密码协处理器加密接口，密码协处理器加密接口通过调用密码协处理器驱动程序，将待处理请求发送给密码协处理器，以使密码协处理器对待处理请求进行安全运算处理，得到处理结果，实现基于硬件对数据进行安全运算，增强虚拟可信平台的安全性保护能力，提高数据的安全性。并且，在虚拟可信平台部署了VirtIO前端驱动、VirtIO后端驱动、密码协处理器加密接口及密码协处理器驱动程序的基础上，由密码协处理器对不同虚拟可信平台的密钥进行隔离保存和使用，在多个虚拟机同时请求密码运算时，可以保障不同运算、密钥互不干扰，做到实例隔离，改善虚拟可信平台的隔离效果。附图说明为了更清楚地说明本申请实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本申请的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其他的附图。图1是本申请提供的一种基于硬件辅助的虚拟可信平台的架构示意图；图2是本申请实施例1提供的一种安全处理方法的流程示意图；图3是本申请实施例2提供的一种安全处理方法的流程示意图；图4是本申请提供的一种寄存器映射示意图；图5是本申请实施例3提供的一种安全处理方法的流程示意图。具体实施方式下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本申请一部分实施例，而不是全部的实施例。基于本申请中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本申请保护的范围。为了解决上述问题，本申请提供了一种安全处理方法，接下来对本申请提供的安全处理方法进行介绍。本申请提供的安全处理方法基于虚拟可信平台，虚拟可信平台可以理解为：基于硬件辅助的虚拟可信平台，如图1所示，基于硬件辅助的虚拟可信平台可以包括：虚拟机用户空间、虚拟机内核空间、主机用户空间、主机内核空间和密码协处理器。所述虚拟机用户空间中部署有应用程序和TSS接口；其中，虚拟机用户空间中的TSS接口是通过对主机用户空间中用于调用硬件安全设备的TSS接口进行复用得到的，因此，虚拟机用户空间中的TSS接口与主机用户空间中的TSS接口的功能一致。虚拟机用户空间中的TSS接口，可以用于为其他安全程序提供使用vtpm的标准接口，及向下调用VirtIO前端驱动。所述虚拟机内核空间可以包含虚拟安全设备和VirtIO前端驱动。VirtIO前端驱动可以用于注册vtpm，实现VirtQueue的创建、Feature的协商和vtpm的配置读取等。VirtQueue，可以理解为：VirtIO的前后端环形队列，用于实现虚拟机和主机数据交换。通过VirtQueue可以找到底层virtio-vring进而传输数据。Feature定义了客户端虚拟机和主机支持的功能。VirtIO是一种I/O半虚拟化解决方案，是一套通用I/O设备虚拟化的程序，是对半虚拟化Hypervisor中的一组通用I/O设备的抽象。VirtIO抽象了一套vring接口来完成虚拟机和宿主机之间的数据收发过程，提供了一套上层应用与vtpm之间的通信框架和编程接口，减少跨平台所带来的兼容性问题，大大提高驱动程序开发效率。在具体实施中，VirtIO包括位于虚拟机内核空间的VirtIO前端驱动和位于主机用户空间的VirtIO后端驱动，VirtIO前端驱动和VirtIO后端驱动之间通过vring机制来实现通信。其中，虚拟机用户空间和虚拟机内核空间组成虚拟网元。所述主机用户空间至少可以包含VirtIO后端驱动和密码协处理器加密接口。主机用户空间还可以包括硬件安全设备，硬件安全设备对主机的数据进行可信保护。主机用户空间中可以但不局限于部署虚拟安全设备管理模块。虚拟安全设备管理模块可以用于注册VirtIO后端驱动，及启动虚拟网元，及调用密码协处理器加密接口。虚拟安全设备管理模块可以为但不局限于：QEMU模拟器。密码协处理器加密接口，可以用于访问密码协处理器驱动程序。所述主机内核空间可以包含密码协处理器驱动程序。密码协处理器驱动程序可以用于访问密码协处理器。本实施例中，所述密码协处理器与所述主机用户空间中的硬件安全设备具备绑定关系，所述绑定关系可以通过以下方式建立：所述硬件安全设备在向本地证书签发机构展示EK密钥证明其身份后，向所述本地证书签发机构申请硬件AIK证书；所述硬件安全设备利用所述硬件AIK证书为所述密码协处理器颁发AIK证书，以建立所述硬件安全设备与所述密码协处理器的绑定关系。在建立所述硬件安全设备与所述密码协处理器的绑定关系之后，可以通过以下方式实现从硬件安全设备到虚拟安全设备的证书链接：基于所述密码协处理器生成所述虚拟安全设备的EK密钥，并利用所述密码协处理器AIK证书为所述虚拟安全设备的EK密钥颁发证书。在实现从硬件安全设备到虚拟安全设备的证书链接之后，可以通过以下方式完成虚拟安全设备证书链的扩展：所述虚拟安全设备在使用所述虚拟安全设备的EK密钥向所述本地证书签发机构证明其身份后，向所述本地证书签发机构申请虚拟AIK证书，以使所述本地证书签发机构向所述虚拟安全设备颁发虚拟AIK证书。基于上述虚拟可信平台，本申请提供的安全处理方法可以参见图1，该方法可以包括以下步骤：步骤S11、所述应用程序使用所述TSS接口调用所述VirtIO前端驱动，由所述VirtIO前端驱动将待处理请求写入环形队列。步骤S12、所述VirtIO后端驱动从所述环形队列中获取所述待处理请求，并将所述待处理请求发送给所述密码协处理器加密接口。步骤S13、所述密码协处理器加密接口通过调用所述密码协处理器驱动程序，将所述待处理请求发送给密码协处理器。步骤S14、所述密码协处理器对所述待处理请求进行安全运算处理，得到处理结果，并将所述处理结果返回给所述应用程序。本实施例中，将所述处理结果返回给所述应用程序的过程，可以包括：S141、通过所述密码协处理器驱动程序将所述处理结果返回给所述密码协处理器加密接口。步骤S15、所述应用程序获取所述处理结果。对应步骤S141，所述应用程序获取所述处理结果的过程，可以包括：S151、所述密码协处理器加密接口将所述处理结果返回给所述VirtIO后端驱动；S152、所述VirtIO后端驱动通过中断注入机制将所述处理结果返回给所述应用程序。所述VirtIO后端驱动通过中断注入机制将所述处理结果返回给所述应用程序，保证应用程序获取处理结果的及时性，提高效率。在本申请中，提供一种虚拟可信平台，虚拟可信平台中虚拟机内核空间包含虚拟安全设备和VirtIO前端驱动，主机用户空间至少包含VirtIO后端驱动和密码协处理器加密接口，及主机内核空间包含密码协处理器驱动程序，其中，应用程序使用TSS接口通过调用所述VirtIO前端驱动，将待处理请求写入环形队列，VirtIO后端驱动从环形队列中获取待处理请求，并将待处理请求发送给密码协处理器加密接口，密码协处理器加密接口通过调用密码协处理器驱动程序，将待处理请求发送给密码协处理器，以使密码协处理器对待处理请求进行安全运算处理，得到处理结果，实现基于硬件对数据进行安全运算，增强虚拟可信平台的安全性保护能力，提高数据的安全性。在虚拟可信平台部署了VirtIO前端驱动、VirtIO后端驱动、密码协处理器加密接口及密码协处理器驱动程序的基础上，由密码协处理器对不同虚拟可信平台的密钥进行隔离保存和使用，在多个虚拟机同时请求密码运算时，可以保障不同运算、密钥互不干扰，做到实例隔离，改善虚拟可信平台的隔离效果。作为本申请另一可选实施例，参照图3，为本申请实施例2提供的一种安全处理方法的流程示意图，本实施例主要是对上述实施例1描述的安全处理方法的扩展方案，如图3所示，该方法可以包括但并不局限于以下步骤：步骤S21、所述应用程序使用所述TSS接口调用所述VirtIO前端驱动，由所述VirtIO前端驱动将待处理请求写入环形队列。步骤S22、所述VirtIO后端驱动从所述环形队列中获取所述待处理请求，并将所述待处理请求发送给所述密码协处理器加密接口。步骤S23、所述密码协处理器加密接口通过调用所述密码协处理器驱动程序，将所述待处理请求发送给密码协处理器.步骤S24、所述密码协处理器对所述待处理请求进行安全运算处理，得到处理结果，并将所述处理结果返回给所述应用程序。步骤S25、所述应用程序获取所述处理结果。步骤S21-S25的详细过程可以参见步骤S11-S15的相关介绍，在此不再赘述。步骤S26、所述虚拟安全设备将所述主机用户空间中的硬件安全设备的寄存器中的度量值映射到所述虚拟安全设备的寄存器中。如图4所示，将所述主机用户空间中的硬件安全设备的寄存器中的度量值映射到所述虚拟安全设备的寄存器中，可以包括：将所述主机用户空间中的硬件安全设备的PCR 0-7寄存器中的度量值映射到所述虚拟安全设备的PCR0-7寄存器中。步骤S27、在对所述虚拟机用户空间及所述虚拟机内核空间进行远程证明的情况下，所述虚拟安全设备通过所述虚拟AIK证书对所述虚拟安全设备的寄存器中的度量值进行签名，得到度量值签名。步骤S28、所述虚拟安全设备将所述度量值签名及所述虚拟安全设备的寄存器中的度量值发送给远程证明设备，以使所述远程证明设备基于所述虚拟安全设备的寄存器中的度量值，对所述硬件安全设备进行可信证明，及基于所述度量值签名及所述虚拟安全设备的寄存器中的度量值，对所述虚拟安全设备进行可信证明。本实施例中，所述虚拟安全设备将所述度量值签名及所述虚拟安全设备的寄存器中的度量值发送给远程证明设备，以使所述远程证明设备基于所述虚拟安全设备的寄存器中的度量值，对所述硬件安全设备进行可信证明，及基于所述度量值签名及所述虚拟安全设备的寄存器中的度量值，对所述虚拟安全设备进行可信证明，实现了对虚拟网元的深度证明，满足5G云化网络中虚拟网元信任需求。作为本申请另一可选实施例，参照图5，为本申请实施例3提供的一种安全处理方法的流程示意图，本实施例主要是对上述实施例1描述的安全处理方法的扩展方案，如图5所示，该方法可以包括但并不局限于以下步骤：步骤S31、所述应用程序使用所述TSS接口调用所述VirtIO前端驱动，由所述VirtIO前端驱动将待处理请求写入环形队列。步骤S32、所述VirtIO后端驱动从所述环形队列中获取所述待处理请求，并将所述待处理请求发送给所述密码协处理器加密接口。步骤S33、所述密码协处理器加密接口通过调用所述密码协处理器驱动程序，将所述待处理请求发送给密码协处理器。步骤S34、所述密码协处理器对所述待处理请求进行安全运算处理，得到处理结果，并将所述处理结果返回给所述应用程序。步骤S35、所述应用程序获取所述处理结果。步骤S31-S35的详细过程可以参见步骤S11-S15的相关介绍，在此不再赘述。步骤S36、所述主机用户空间中虚拟安全设备管理模块获取云计算迁移控制服务器的迁移命令，并锁定所述虚拟可信平台，对与所述虚拟安全设备关联的数据进行打包，得到数据包。本实施例中，锁定所述虚拟可信平台，可以理解为：所述虚拟可信平台不再进行可信度量和运算处理。步骤S37、所述虚拟安全设备管理模块获取所述云计算迁移控制服务器为所述虚拟可信平台分配的会话加密密钥，所述会话加密密钥通过以下方式分配：基于所述虚拟可信平台中硬件安全设备对所述主机用户空间及所述主机内核空间进行可信证明，在证明所述主机用户空间及所述主机内核空间可信后，为所述虚拟可信平台分配会话加密密钥。步骤S38、所述虚拟安全设备管理模块利用所述会话加密密钥对所述数据包进行加密，得到加密数据，并利用所述密码协处理器对所述加密数据包进行签名，得到数据签名。步骤S39、所述虚拟安全设备管理模块将所述加密数据及所述数据签名发送给另一个虚拟可信平台的主机用户空间，以使另一个虚拟可信平台的主机用户空间向所述云计算迁移控制服务器申请与所述会话加密密钥匹配的会话解密密钥，并利用所述会话解密密钥对所述加密数据进行解密，并对所述数据签名进行验签。本实施例中，通过对所述数据签名进行验签，验证迁移过来的数据是否被篡改，确保数据的完整性。在另一个虚拟可信平台的主机用户空间向云计算迁移控制服务器发送迁移已完成信息后，云计算迁移控制服务器可以将迁移已完成信息发送给发送数据的虚拟可信平台，发送数据的虚拟可信平台将删除密码协处理器中已经迁移的vTPM数据，确保vTPM的唯一性。同时随着vTPM的迁移，导致了vTPM基础设施的变化。vEK和vAIK证书必须重新进行证书链的扩展，以确保vTPM与硬件设备的绑定关系。接下来对本申请提供的虚拟可信平台进行介绍，下文介绍的基于硬件辅助的虚拟可信平台与上文介绍的安全处理方法可相互对应参照。本实施例中，如图1所示，基于硬件辅助的虚拟可信平台包括：虚拟机用户空间、虚拟机内核空间、主机用户空间、主机内核空间和密码协处理器，所述虚拟机用户空间中部署有应用程序和TSS接口，所述虚拟机内核空间包含虚拟安全设备和VirtIO前端驱动，所述主机用户空间至少包含VirtIO后端驱动和密码协处理器加密接口，所述主机内核空间包含密码协处理器驱动程序。所述应用程序，用于使用所述TSS接口调用所述VirtIO前端驱动；所述VirtIO前端驱动，用于将待处理请求写入环形队列；所述VirtIO后端驱动，用于从所述环形队列中获取所述待处理请求，并将所述待处理请求发送给所述密码协处理器加密接口；所述密码协处理器加密接口，用于调用所述密码协处理器驱动程序；所述密码协处理器驱动程序，用于将所述待处理请求发送给密码协处理器；所述密码协处理器，用于对所述待处理请求进行安全运算处理，得到处理结果，并将所述处理结果返回给所述应用程序；所述应用程序，还用于获取所述处理结果。本实施例中，所述密码协处理器加密接口，还用于接收所述密码协处理器通过所述密码协处理器驱动程序返回的所述处理结果，及将所述处理结果返回给所述VirtIO后端驱动；所述VirtIO后端驱动，还用于通过中断注入机制将所述处理结果返回给所述应用程序。本实施例中，所述虚拟可信平台还包括：建立模块，用于所述硬件安全设备在向本地证书签发机构展示EK密钥证明其身份后，向所述本地证书签发机构申请硬件AIK证书；所述硬件安全设备利用所述硬件AIK证书为所述密码协处理器颁发AIK证书，以建立所述硬件安全设备与所述密码协处理器的绑定关系。本实施例中，所述密码协处理器，还用于：生成所述虚拟安全设备的EK密钥，并为所述虚拟安全设备的EK密钥颁发证书；所述虚拟安全设备，用于在使用所述虚拟安全设备的EK密钥向所述本地证书签发机构证明其身份后，向所述本地证书签发机构申请虚拟AIK证书，以使所述本地证书签发机构向所述虚拟安全设备颁发虚拟AIK证书。本实施例中，所述虚拟安全设备，还可以用于：将所述主机用户空间中的硬件安全设备的寄存器中的度量值映射到所述虚拟安全设备的寄存器中；在对所述虚拟机用户空间及所述虚拟机内核空间进行远程证明的情况下，通过所述虚拟AIK证书对所述虚拟安全设备的寄存器中的度量值进行签名，得到度量值签名；将所述度量值签名及所述虚拟安全设备的寄存器中的度量值发送给远程证明设备，以使所述远程证明设备基于所述虚拟安全设备的寄存器中的度量值，对所述硬件安全设备进行可信证明，及基于所述度量值签名及所述虚拟安全设备的寄存器中的度量值，对所述虚拟安全设备进行可信证明。本实施例中，所述主机用户空间还可以包括：虚拟安全设备管理模块，用于：获取云计算迁移控制服务器的迁移命令，并锁定所述虚拟可信平台，对与所述虚拟安全设备关联的数据进行打包，得到数据包；获取所述云计算迁移控制服务器为所述虚拟可信平台分配的会话加密密钥，所述会话加密密钥通过以下方式分配：基于所述虚拟可信平台中硬件安全设备对所述虚拟可信平台进行可信证明，在证明所述虚拟可信平台可信后，为所述虚拟可信平台分配会话加密密钥；利用所述会话加密密钥对所述数据包进行加密，得到加密数据，并利用所述密码协处理器对所述加密数据包进行签名，得到数据签名；将所述加密数据及所述数据签名发送给另一个虚拟可信平台的主机用户空间，以使另一个虚拟可信平台的主机用户空间向所述云计算迁移控制服务器申请与所述会话加密密钥匹配的会话解密密钥，并利用所述会话解密密钥对所述加密数据进行解密，并对所述数据签名进行验签。需要说明的是，每个实施例重点说明的都是与其他实施例的不同之处，各个实施例之间相同相似的部分互相参见即可。对于装置类实施例而言，由于其与方法实施例基本相似，所以描述的比较简单，相关之处参见方法实施例的部分说明即可。最后，还需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括所述要素的过程、方法、物品或者设备中还存在另外的相同要素。为了描述的方便，描述以上装置时以功能分为各种单元分别描述。当然，在实施本申请时可以把各单元的功能在同一个或多个软件和/或硬件中实现。通过以上的实施方式的描述可知，本领域的技术人员可以清楚地了解到本申请可借助软件加必需的通用硬件平台的方式来实现。基于这样的理解，本申请的技术方案本质上或者说对现有技术做出贡献的部分可以以软件产品的形式体现出来，该计算机软件产品可以存储在存储介质中，如ROM/RAM、磁碟、光盘等，包括若干指令用以使得一台计算机设备执行本申请各个实施例或者实施例的某些部分所述的方法。以上对本申请所提供的一种基于硬件辅助的虚拟可信平台及安全处理方法进行了详细介绍，本文中应用了具体个例对本申请的原理及实施方式进行了阐述，以上实施例的说明只是用于帮助理解本申请的方法及其核心思想；同时，对于本领域的一般技术人员，依据本申请的思想，在具体实施方式及应用范围上均会有改变之处，综上所述，本说明书内容不应理解为对本申请的限制。
