标题title
一种复谱的拉伸显示方法
摘要abst
本发明涉及一种复谱拉伸显示方法，包括：获取乐谱数据和拉伸指令，遍历复谱表中的所有单谱表；将拉伸指令中的宽度变量按照每个小节内容纳的音符个数平均分配后，取其与音符的原占位宽度的比值得到当前单谱表的线性拉伸比例；遍历当前单谱表中的所有小节，将当前小节的原宽度以线性拉伸比例修改并加上个小节的终点坐标，得到当前小节拉伸后的终点坐标；重新分配每个小节内的符号的坐标；将拉伸后的单谱表的每个小节和其中的符号显示在交互式窗口上。本发明能方便灵活地调整包括五线谱形式和简谱等形式的单谱、复谱的拉伸长度，最终显示的乐谱准确、整齐美观，十分适用于可交互智能音乐教学设备。
权利要求书clms
1.一种复谱的拉伸显示方法，其特征在于，包括以下步骤：获取乐谱数据和拉伸指令，所述乐谱数据包括复谱表；遍历所述复谱表中的所有单谱表，对于当前单谱表：获取所述当前单谱表的每个小节的初始宽度；将所述拉伸指令中的宽度变量按照每个小节内容纳的音符个数平均分配后，取其与所述音符的原占位宽度的比值得到所述当前单谱表的线性拉伸比例；遍历所述当前单谱表中的所有小节，对于当前小节：将所述当前小节的原宽度以所述线性拉伸比例修改并加上个小节的终点坐标，得到所述当前小节拉伸后的终点坐标；重新分配每个所述小节内的符号的坐标；将拉伸后的单谱表的每个小节和其中的符号显示在交互式窗口上。2.如权利要求1所述的方法，其特征在于，所述重新分配每个所述小节内的符号的坐标的步骤具体包括：遍历拉伸后的单谱表的所有小节，对于当前小节：获取所述当前小节中的第一个符号的x坐标和宽度，所述符号包括拍号、调号、音符；存储当前复谱表中小节的所有所述拍号的x坐标最大值Max1，如果所述当前小节与其在该复谱表的其他单谱表中对应的小节的调号不同，则将所有小节的所述拍号按照所述Max1对齐；存储当前复谱表中小节的第一个音符的x坐标最大值Max2，如果所述当前小节与其在所述当前复谱表的其他单谱表中对应的小节的所述调号不同，则将所有小节的所述第一个音符按照所述Max2对齐；根据所述当前小节的拉伸宽度和所述所述当前小节中的初始的符号的x坐标和宽度，对应地更新所述当前小节内的所有符号的x坐标和宽度值。3.如权利要求2所述的方法，其特征在于，还包括以下步骤：若所述当前小节包括副旋律，遍历副旋律小节，对于所述副旋律小节中与所述当前小节对应的小节：按照所述当前小节的x坐标与所述副旋律的起始位置的x坐标的差修正每个与所述当前小节对应的小节的x坐标。4.如权利要求3所述的方法，其特征在于，还包括以下步骤：若所述当前小节内包括若干声部，遍历所有声部：存储声部数和所述当前小节的声部中的符号的x坐标的最大值；根据所述性拉伸比例计算每个所述声部的拉伸宽度。5.如权利要求4所述的方法，其特征在于，还包括以下步骤：若所述当前小节中的所述第一个符号中存在倚音，在所述当前小节中的所有声部设置倚音宽度。6.如权利要求4所述的方法，其特征在于，还包括以下步骤：更新每个需要段落区分的小节的起始x坐标值。7.如权利要求4所述的方法，其特征在于，还包括以下步骤：对所述拉伸指令中的宽度变量按照显示的阈值、所述当前小节对应的副旋律的显示宽度阈值和其他常量值进行调整。8.如权利要求6所述的方法，其特征在于，还包括以下步骤：如果所述复谱表中不仅有一个需要拉伸处理的小节，则处理完所有所述需要拉伸处理小节的x坐标之后，再更新所述复谱表在所述交互式窗口中的显示。9.如权利要求6所述的方法，其特征在于，还包括以下步骤：如果所述复谱表中只有一个需要拉伸处理的小节，则处理完该小节就更新所述复谱表在所述交互式窗口中的显示。10.一种基于交互式窗口的音乐教学系统，其特征在于，被处理器执行时实现权利要求1-9所述方法的步骤。
说明书desc
技术领域本发明涉及音乐教学软件领域，具体涉及一种复谱的拉伸显示方法。背景技术传统教学模式下的音乐教学主要通过教师现场演示实现，不仅对于教师的素质要求较高，而且学生们往往缺乏实践学习的参与。而在信息技术的融合之下，市场上出现了一些具有交互功能的音乐教学软件和智能设备，让学生们更多地参与到音乐学习中，感受到不同的学习体验。中国专利CN 108847207 A提出了一种用于音乐教学的交互智能设备，当用户需要进行音乐制作时实现交互式的编曲体验。然而，现有技术只能将编曲完成的乐谱显示为一种相对固定的形式，用户不能根据实际使用时的显示屏幕大小来对乐谱的宽度进行定制。因此，需要对现有交互智能设备的乐谱显示技术进行改进，以实现可以通过用户的指令来控制特别是复调音乐的乐谱的拉伸显示效果。发明内容为解决以上技术问题，本发明第一方面提出一种复谱的拉伸显示方法，包括以下步骤：获取乐谱数据和拉伸指令，所述乐谱数据包括复谱表；遍历所述复谱表中的所有单谱表，对于当前单谱表：获取所述当前单谱表的每个小节的初始宽度；将所述拉伸指令中的宽度变量按照每个小节内容纳的音符个数平均分配后，取其与所述音符的原占位宽度的比值得到所述当前单谱表的线性拉伸比例；遍历所述当前单谱表中的所有小节，对于当前小节：将所述当前小节的原宽度以所述线性拉伸比例修改并加上个小节的终点坐标，得到所述当前小节拉伸后的终点坐标；重新分配每个所述小节内的符号的坐标；将拉伸后的单谱表的每个小节和其中的符号显示在交互式窗口上。本发明另一方面提出一种基于交互式窗口的音乐教学系统，该教学系统在被处理器执行时可以实现本发明提出的复谱的拉伸显示方法。本发明为用户解决了在现有交互智能设备中对乐谱尤其是复调音乐的乐谱实现定制化的显示效果，使得显示的复谱长度能够根据交互式窗口的大小适应性地进行调整，同时保证了同一复谱的的各单谱中相对应的小节和小节中所有的音符及其他符号按其固有顺序、固有规则对齐显示。附图说明图1、一些实施方式的复谱的拉伸显示方法的流程图；图2、一些实施方式的拉伸显示效果图；图3、一些实施方式的副旋律显示效果图；图4、一些具体实施方式的复谱的示意图。具体实施方式为了使本技术领域的人员更好地理解本发明方案，下面将结合附图对本发明涉及的多种实施方式中的技术方案进行清楚、完整地描述。基于本发明中的实施方式，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施方式，都应当属于本发明保护的范围。一些实施方式，涉及的复谱的拉伸显示方法的流程如图1所示，包括以下步骤：获取乐谱数据和拉伸指令，乐谱数据包括复谱表；遍历复谱表中的所有单谱表，对于当前单谱表：获取当前单谱表的每个小节的初始宽度；将拉伸指令中的宽度变量按照每个小节内容纳的音符个数平均分配后，取其与音符的原占位宽度的比值得到当前单谱表的线性拉伸比例；遍历当前单谱表中的所有小节，对于当前小节：将当前小节的原宽度以线性拉伸比例修改并加上个小节的终点坐标，得到当前小节拉伸后的终点坐标；重新分配每个小节内的符号的坐标；将拉伸后的单谱表的每个小节和其中的符号显示在交互式窗口上。需要进一步说明的是，宽度变量根据当前行内的小节数决定，当前行的宽度是固定的，行内的小节数越多，表示当前小节内音符可分配的宽度就越少。在计算线性拉伸比例时，需要把当前行的单谱表中的一些不能缩放的距离减掉或者补上，根据显示情况的要求加/减一些修正值，然后获得音符的占位宽度性拉伸比例，例如一些更具体的实施方式按照以下计算式得到性拉伸比例： Scale＝/YinFu.width 其中，Scale表示线性拉伸比例，Frame.width表示当前单谱表的宽度，也就是当前行的宽度；Const.width表示小节线后面的调号/拍号宽度；Fix.wdth表示副旋律从某一个小节的某一个音符开始的时候，前面有一个距离；Xiaojie.width.sum表示当前行内所有小节的宽度的加和；YinFu.width表示每个音符的原始占位宽度。术语“乐谱数据”包括全局乐谱数据和/或其中的一部分乐谱数据，该数据的表现形式包括五线谱和简谱。该“乐谱数据”包括 XML格式或JSON格式的对象。优选地，该数据保存为JSON格式，该 JSON对象包括全局乐谱类，每个全局乐谱类的数据中包括若干个复谱表类的数据组成的数组，每个复谱表类数据中包括若干个单谱表类的数据组成的数组，每个单谱表类数据中包括若干小节数据组成的数组，其中：有一些小节类数据包括若干声部，有一些小节类数据包括与小节对应的副旋律数据。以下是对一部分JSON数据的字段的具体描述的举例：乐谱XML文件已经被业界广泛的使用，乐谱JSON文件才刚刚开始，但是在Ajax这个特定的领域，未来的发展一定是乐谱XML文件让位于乐谱JSON文件。乐谱JSON文件相对乐谱XML文件，数据的体积小。乐谱JSON 文件与JavaScript的交互更加方便，读取和查找速度要远远快于乐谱 XML文件。涉及的实施方式的拉伸效果如图2所示，可以看到原来的较稠密的乐谱在进行等比拉伸显示之后被显示为稀疏的乐谱，每个音符的大小、顺序和相对位置等表征没有改变。显而易见地是，本发明的技术方案也可以实现拉伸的逆向操作，即可以实现将原乐谱的长度等比压缩后显示。术语“拉伸指令”主要指用户通过包括使用键盘、鼠标移动等设备实现的输入指令，包括对被拉伸的乐谱的显示对象的拖拽等动作完成；通过该指令程序可以获取包括对被拉伸乐谱的显示对象的移动宽度的数据。术语“复谱”为复调音乐的乐谱。一些实施方式，涉及的重新分配每个小节内的符号的坐标的步骤具体包括：获取所述当前小节中的第一个符号的x坐标和宽度，所述符号包括拍号、调号、音符；存储当前复谱表中小节的所有所述拍号的x坐标最大值Max1，如果所述当前小节与其在该复谱表的其他单谱表中对应的小节的调号不同，则将所有小节的所述拍号按照所述Max1对齐；存储当前复谱表中小节的第一个音符的x坐标最大值Max2，如果所述当前小节与其在所述当前复谱表的其他单谱表中对应的小节的所述调号不同，则将所有小节的所述第一个音符按照所述Max2对齐；根据所述当前小节的拉伸宽度和所述所述当前小节中的初始的符号的x坐标和宽度，对应地更新所述当前小节内的所有符号的x坐标和宽度值。一些实施方式涉及的方法还包括：若当前小节包括副旋律，遍历副旋律小节，对于副旋律小节中与当前小节对应的小节：按照当前小节的 x坐标与副旋律的起始位置的x坐标的差修正每个与当前小节对应的小节的x坐标。在需要显示对应的副旋律的小节时，通常要考虑对每个小节的拉伸宽度进行适应性调整，以确保对应的副旋律小节能正常显示。其中，带有副旋律的小节和其副旋律具有对应关系，在给小节的显示坐标值进行调整后，根据其内部的对应关系对该小节绑定的副旋律做出调整。一些实施方式涉及的方法还包括：若当前小节内包括若干声部，遍历所有声部：存储声部数和当前小节的声部中的符号的x坐标的最大值；根据性拉伸比例计算每个声部的拉伸宽度。一些实施方式涉及的方法还包括：若当前小节中的第一个符号中存在倚音，在当前小节中的所有声部设置倚音宽度。一些实施方式涉及的方法还包括：更新每个需要段落区分的小节的起始x坐标值。一些更具体的实施方式还包括：对乐谱拉伸指令中的宽度变量按照显示的阈值、乐谱当前小节对应的副旋律的显示宽度阈值和其他常量值进行调整。一些更具体的实施方式还包括；如果乐谱复谱表中不仅有一个需要拉伸处理的小节，则处理完所有乐谱需要拉伸处理小节的x坐标之后，再更新乐谱复谱表在交互式窗口中的显示；如果所述复谱表中只有一个需要拉伸处理的小节，则处理完该小节就更新所述复谱表在所述交互式窗口中的显示。一些更具体的实施例中涉及一种复谱，音符分为不同时值的音符，通常分为全音符、二分音符、四分音符、八分音符、十六分音符等以此类推；每首谱子都有拍号作为每个小节音符的播放时长，比如图4 中的五线谱，小节开头的内容依次为谱号、调号、拍号，其中3/4表示当前小节是四三拍谱子，所以当前小节内的音符时值加起来要达到四三拍的时长，比如第一小节，第一行的内容是一个全音符休止符，全音符表示当前一个音符要占满这一整个小节时长，第一小节的第二行，里面的音符是四分音符，每一个音符的时长是四分之一拍，所以四三拍的小节，放三个四分音符，三个四分音符总的时长加起来要和四三拍时长相等。每一行谱子用单谱表来表示，由花括号圈起来的谱子表示复谱表，当前例子中每一个复谱表内包含两个单谱表 ，每行单谱表内又分为四个小节，行内的竖线叫做小节线，来隔断每行内的小节，每个复谱表的内的小节数是相等的，比如例子中的第一行单谱表内的小节数要和第二行内的小节数对应好，而且小节的宽度也要对应好，只是当前复谱表内的对应就可以，不同的复谱表小节数不同，因此本实施例中不需要做统一的对应。一些实施方式将本发明应用于一种多功能数字音乐教学系统，该系统还可以实现：将多行展示的乐谱数据处理为播放数据；根据乐谱中音符的位置绘制连音线。其中，将多行展示的乐谱数据处理为播放数据的方法包括：获取乐谱数据；读取播放命令，播放命令包括播放的起点和终点信息；从起点至终点的区间内，遍历起点所标记的单谱的各行：遍历行内的各小节：记录每个小节在当前单谱中的序；遍历小节的各声部：计算每个声部中的音符在当前单谱中的序并将每个声部中的音符的数据按序保存在当前播放数据中；若当前音符和其上一个音符不在同一个复谱里，从头开始记录当前音符的序；若当前声部中存在符号，按照符号将其对应的音符的播放数据处理为带有符号状态的音符。本发明的技术方案能方便灵活地调整包括五线谱形式和简谱等形式的单谱、复谱的拉伸长度，最终显示的乐谱准确、整齐美观，十分适用于可交互智能音乐教学设备。本说明书中描述的主题的实施方式可以被实施为一个或多个计算机程序，即，一个或多个有形非暂时性程序载体上编码的计算机程序指令的一个或多个模块，用以被数据处理设备执行或者控制数据处理设备的操作。计算机程序可以以任意形式的编程语言而被写出，包括编译语言或者解释语言或者声明性语言或过程式语言，并且计算机程序可以以任意形式展开，包括作为独立程序或者作为模块、组件、子程序或者适于在计算环境中使用的其他单元。计算机程序可以但不必须对应于文件系统中的文件。程序可以被存储在保存其他程序或者数据的文件的一部分中，例如，存储在如下中的一个或多个脚本：在标记语言文档中；在专用于相关程序的单个文件中；或者在多个协同文件中，例如，存储一个或多个模块、子程序或者代码部分的文件。计算机程序可以被展开为执行在一个计算机或者多个计算机上，计算机位于一处，或者分布至多个场所并且通过通信网络而互相连接。在本说明书中描述的处理和逻辑流程可以由一个或多个可编程计算机执行，该计算机通过运算输入数据并且生成输出而执行一个或多个的计算机程序，以运行函数。处理和逻辑流程还可以由专用逻辑电路，例如，FPGA或者ASIC执行，并且设备也可以被实施为专用逻辑电路。适于实行计算机程序的计算机包括并且示例性地可以基于通用微处理器或者专用微处理器或者上述处理器两者，或者任意其他种类的中央处理单元。通常地，中央处理单元将接收来自只读存储器或者随机存取存储器或者这两者的指令和数据。计算机的主要元件是用于运行或者执行指令的中央处理单元以及用于存储指令和数据的一个或多个存储器装置。通常地，计算机还将包括或者是可操作性地耦合，以从用于存储数据的一个或多个大容量存储装置接收数据或者传递数据到大容量存储装置，或者接收和传递两者，该大容量存储器例如为磁盘、磁光盘或者光盘。适于存储计算机程序指令和数据的计算机可读介质包括所有形式的非易失存储器、介质和存储器装置。为了发送与用户的交互，本说明书中描述的主题的实施方式可以被实施在计算机上，该计算机具有：显示装置，例如，CRT 或者LCD监控器，用于向用户显示信息；以及键盘和例如鼠标或者追踪球这样的定位装置，用户利用它们可以将输入发送到计算机。其他种类的装置也可以用于发送与用户的交互；例如，提供给用户的反馈可以是任意形式的传感反馈，例如，视觉反馈、听觉反馈或者触觉反馈；以及来自用户的输入可以以任意形式接收到，包括声响输入、语音输入或者触觉输入。本说明书中描述的主题的实施方式可以在计算系统中实施，该计算系统包括例如数据服务器这样的后端组件，或者包括例如应用服务器这样的中间组件，或者包括例如客户端计算机这样的前端组件，该客户端计算机具有图形用户界面或者网络浏览器，用户可以通过图形用户界面或者网络浏览器而与本说明书中描述的主题的实施进行交互，或者该计算机系统包括一个或多个这种后端组件、中间组件或者前端组件的任意组合。系统中的组件可以通过例如通信网络的任意形式或介质的数字数据通信而互相连接。通信网络的实例包括局域网络和广域网络 ，例如，因特网。该计算机系统可以包括客户端和服务器。客户端和服务器通常彼此远离，并且通常通过通信网络而交互。客户端与服务器之间的关系利用在各自的计算机上运行并且具有彼此之间的客户端-服务器关系的计算机程序而产生。虽然本说明书包含很多具体的实施细节，但是这些不应当被解释为对任何发明的范围或者对可以要求保护的内容的范围的限制，而是作为可以使特定发明的特定实施方式具体化的特征的说明。在独立的实施方式的语境中的本说明书中描述的特定特征还可以与单个实施方式组合地实施。相反地，在单个实施方式的语境中描述的各种特征还可以独立地在多个实施方式中实施，或者在任何合适的子组合中实施。此外，虽然以上可以将特征描述为组合作用并且甚至最初这样要求，但是来自要求的组合的一个或多个特征在一些情况下可以从该组合去掉，并且要求的组合可以转向子组合或者子组合的变形。
