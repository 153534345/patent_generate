标题title
一种修改策略路由的方法及设备
摘要abst
本申请提供了一种修改策略路由的方法及设备。该方法包括：修改策略路由的方法，该方法包括：为每个节点信息修改类型定义对应的节点修改信息数据结构；每个节点修改信息数据结构至少包括策略路由标识、节点标识、节点修改内容；比较有效策略路由配置与记录的已配置策略路由以解析变化的有效策略路由；将变化的有效策略路由的节点修改信息，写入节点修改信息的节点信息修改类型对应的节点修改信息数据结构；为被写入节点修改信息数据结构的节点修改信息生成节点修改消息；识别节点修改消息中的策略路由标识指向的待修改策略路由，根据节点修改消息中的节点标识的优先级定位待修改节点，根据节点修改消息中的修改内容修改待修改节点。
权利要求书clms
1.一种修改策略路由的方法，其特征在于，所述方法包括：为每个节点信息修改类型定义对应的节点修改信息数据结构；每个所述节点修改信息数据结构至少包括策略路由标识、节点标识、节点修改内容；比较有效策略路由配置与记录的已配置策略路由以解析变化的有效策略路由；将所述变化的有效策略路由的节点修改信息，写入所述节点修改信息的节点信息修改类型对应的节点修改信息数据结构；为被写入节点修改信息数据结构的节点修改信息生成节点修改消息；识别所述节点修改消息中的策略路由标识指向的待修改策略路由，根据所述节点修改消息中的节点标识的优先级定位待修改节点，根据所述节点修改消息中的修改内容修改所述待修改节点。2.根据权利要求1所述的方法，其特征在于，所述变化的有效策略路由还包括多项节点修改信息，所述方法还包括：将所述多项节点信息分别写入各自节点信息修改类型对应的节点修改信息数据结构；为被写入的节点修改信息数据结构的每项节点信息生成节点修改消息；基于每个所述节点修改消息中的策略路由标识和节点标识的优先级定位每个待修改策略路由的待修改节点，根据每个所述节点修改消息的修改内容修改所述每个待修改节点。3.根据权利要求1所述的方法，其特征在于，所述方法还包括：为每个接入控制表项ACL修改类型定义对应的ACL修改信息数据结构；每个所述ACL修改信息数据结构至少包括策略路由标识、节点标识、表项索引、规则标识以及规则修改内容；基于所述变化的有效策略路由中ACL表项修改信息，写入所述ACL表项修改信息的ACL表项修改类型对应的ACL表项修改信息数据结构；被写入节点修改信息数据结构的节点修改信息生成节点修改消息；为写入ACL表项修改信息数据结构的ACL表项修改信息，生成对应的ACL表项修改消息；根据所述ACL表项修改消息中策略路由标识、节点标识、表项索引、规则标识指向的规则按照所述ACL表项修改消息中规则修改内容进行修改。4.根据权利要求1所述的方法，其特征在于，所述变化的有效策略路由还包括多项ACL表项修改信息，所述方法还包括：将所述多项ACL表项修改信息分别写入各自ACL表项修改类型对应的ACL表项修改信息数据结构；为被写入的各ACL表项修改信息数据结构的各项ACL表项修改信息生成ACL表项修改消息；根据所述各ACL表项修改消息中策略路由标识、节点标识、表项索引、规则标识指向的规则按照所述各ACL表项修改消息中规则修改内容进行修改。5.根据权利要求1所述的方法，其特征在于，所述方法还包括：将所述有效策略路由配置更新到所述记录的已配置策略路由。6.一种修改策略路由的设备，其特征在于，所述设备包括：设置模块，用于为每个节点信息修改类型定义对应的节点修改信息数据结构；每个所述节点修改信息数据结构至少包括策略路由标识、节点标识、节点修改内容；控制模块，解析配置信息中的有效策略路由配置；驱动转发模块，用于比较所述有效策略路由配置与记录的已配置策略路由以解析变化的有效策略路由；将所述变化的有效策略路由的节点修改信息，写入所述节点修改信息的节点信息修改类型对应的节点修改信息数据结构；为被写入节点修改信息数据结构的节点修改信息生成节点修改消息并发往策略路由修改模块；所述策略路由修改模块，用于识别所述节点修改消息中的策略路由标识指向的待修改策略路由，根据所述节点修改消息中的节点标识的优先级定位待修改节点，根据所述节点修改消息中的修改内容修改所述待修改节点。7.根据权利要求6所述的设备，其特征在于，所述驱动转发模块，还用于将所述变化的有效策略路由包括的多项节点修改信息分别写入各自节点信息修改类型对应的节点修改信息数据结构；为被写入的节点修改信息数据结构的每项节点信息生成节点修改消息；并发送到所述策略路由修改模块；所述策略路由修改模块，基于每个所述节点修改消息中的策略路由标识和节点标识的优先级定位每个待修改策略路由的待修改节点，根据每个所述节点修改消息的修改内容修改所述每个待修改节点。8.根据权利要求6所述的设备，其特征在于，所述设置模块还用于，为每个接入控制表项ACL修改类型定义对应的ACL修改信息数据结构；每个所述ACL修改信息数据结构至少包括策略路由标识、节点标识、表项索引、规则标识以及规则修改内容；所述驱动转发模块，还用于将所述变化的有效策略路由包括的ACL表项修改信息，写入所述ACL表项修改信息的ACL表项修改类型对应的ACL表项修改信息数据结构；为被写入节点修改信息数据结构的节点修改信息生成节点修改消息并发往策略路由修改模块；所述策略路由修改模块，还用于根据所述ACL表项修改消息中策略路由标识、节点标识、表项索引、规则标识指向的规则按照所述ACL表项修改消息中规则修改内容进行修改。9.根据权利要求6所述的设备，其特征在于，所述驱动转发模块，用于将所述变化的有效策略路由包括的多项ACL表项修改信息分别写入各自ACL表项修改类型对应的ACL表项修改信息数据结构；为被写入的各ACL表项修改信息数据结构的各项ACL表项修改信息生成ACL表项修改消息并分别发送到所述策略路由修改模块；所述策略路由修改模块，还用于根据所述各ACL表项修改消息中策略路由标识、节点标识、表项索引、规则标识指向的规则按照所述各ACL表项修改消息中规则修改内容进行修改。10.根据权利要求6所述的设备，其特征在于，所述驱动转发模块，还用于将所述有效策略路由配置更新到所述记录的已配置策略路由。
说明书desc
技术领域本申请涉及通信技术，特别涉及一种修改策略路由的方法及设备。背景技术策略路由是依据用户制定的策略执行路由转发，可配置于网络设备的路由口或VLAN接口等转发三层流量的报文接口。每个转发三层流量的报文接口配置一个策略路由，但是同一个策略路由能够配置在多个接口上。策略路由可以对于满足设定的条件，包括ACL表项、报文长度等的报文，执行指定的操作。每个策略路由可以由包含一个或者多个节点。每个节点由节点编号来标识。节点编号越小节点的优先级越高，优先级高的节点优先被执行。策略路由的各节点应用不同的接入控制表项，且每个ACL又包含多个规则。图1所示的典型的策略路由中，标识为PBR1的策略路由2048个节点组成，节点0引用的ACL 3000的表项由3002条规则组成。假设通信设备的配置的下一跳IP地址1.1.1.1由无效状态被改配置为有效状态，通信设备的软件控制平面虽然识别出该配置为有效配置，但是硬件转发平面无法将复杂的配置指令解析转换为对应的策略路由修改消息，因此通信设备需要将以IP地址1.1.1.1的PBR1的所有节点先删除后全增加的配置；而PBR1的node1和node2也要分别执行PBR1的所有节点的全删和后全增加的配置。如果node1引用的ACL3000需要新增、删除一个规则或者修改某个规则的内容，也需要将ACL3000的所有规则进行全删和后全增加的重新配置。通信设备是因为无法从新增有效配置的获取到需要修改的路由信息，因此对策略路由的全部节点或各节点引用的全部ACL表项的修改进行全删而后全增加的重新配置，导致策略路由信息的修改效率低下。发明内容本申请的目的提供一种修改策略路由的方法及设备，针对性修改需要配置的策略路由。为实现上述目的，本申请提供了一种修改策略路由的方法，该方法包括：为每个节点信息修改类型定义对应的节点修改信息数据结构；每个节点修改信息数据结构至少包括策略路由标识、节点标识、节点修改内容；比较有效策略路由配置与记录的已配置策略路由以解析变化的有效策略路由；将变化的有效策略路由的节点修改信息，写入节点修改信息的节点信息修改类型对应的节点修改信息数据结构；为被写入节点修改信息数据结构的节点修改信息生成节点修改消息；识别节点修改消息中的策略路由标识指向的待修改策略路由，根据节点修改消息中的节点标识的优先级定位待修改节点，根据节点修改消息中的修改内容修改待修改节点。为实现上述目的，本申请还提供了一种修改策略路由的设备，该设备包括：设置模块，用于为每个节点信息修改类型定义对应的节点修改信息数据结构；每个节点修改信息数据结构至少包括策略路由标识、节点标识、节点修改内容；控制模块，解析配置信息中的有效策略路由配置；驱动转发模块，用于比较有效策略路由配置与记录的已配置策略路由以解析变化的有效策略路由；将变化的有效策略路由的节点修改信息，写入节点修改信息的节点信息修改类型对应的节点修改信息数据结构；为被写入节点修改信息数据结构的节点修改信息生成节点修改消息并发往策略路由修改模块；策略路由修改模块，用于识别节点修改消息中的策略路由标识指向的待修改策略路由，根据节点修改消息中的节点标识的优先级定位待修改节点，根据节点修改消息中的修改内容修改待修改节点。本申请的有益效果在于，通过定义的每个节点信息修改类型定义对应的节点修改信息数据结构存储需要修改策略路由的信息，通信设备根据各节点修改信息数据结构发出的节点修改消息可直接获取某个节点需要修改的信息，无需再修改某个节点的信息时对策略路由的全部节点进行全删和全新增的操作，提高了策略路由的修改效率。附图说明图1为典型的策略路由的示意图；图2为本申请提供的修改策略路由的方法实施例的流程图；图3为修改策略路由的节点路由信息的实施例的流程图；图4为修改策略路由的ACL表项的实施例的流程图；图5为本申请提供的修改策略路由的设备实施例的示意图。具体实施方式将以多个附图所示的多个例子进行详细说明。在以下详细描述中，多个具体细节用于提供对本申请的全面理解。实例中没有详细地描述已知的方法、步骤、组件以及电路，以免使这些例子的难于理解。使用的术语中，术语“包括”表示包括但不限于；术语“含有”表示包括但不限于；术语“以上”、“以内”以及“以下”包含本数；术语“大于”、“小于”表示不包含本数。术语“基于”表示至少基于其中一部分。如图2的修改策略路由的方法实施例的流程图所示，该方法包括：步骤201，为每个节点信息修改类型定义对应的节点修改信息数据结构；每个节点修改信息数据结构至少包括策略路由标识、节点标识、节点修改内容；步骤202，比较有效策略路由配置与记录的已配置策略路由以解析变化的有效策略路由；步骤203，将变化的有效策略路由的节点修改信息，写入节点修改信息的节点信息修改类型对应的节点修改信息数据结构；步骤204，为被写入节点修改信息数据结构的节点修改信息生成节点修改消息；步骤205，识别节点修改消息中的策略路由标识指向的待修改策略路由，根据节点修改消息中的节点标识的优先级定位待修改节点，根据节点修改消息中的修改内容修改待修改节点。图2所示实施例的有益效果在于，无需在修改某个策略路由的节点信息时对策略路由的全部节点进行全删和全新增的操作，提高了策略路由的修改效率。图3为修改策略路由的节点路由信息的实施例的流程图；步骤301，解析有效策略路由配置；通信设备的软件控制平面解析配置信息中有效的路由配置信息方式与现有技术相同。步骤302，比较有效策略路由配置与记录的已配置策略路由以解析变化的有效策略路由；交换芯片的驱动转发模块根据软件控制平面解析的有效策略路由配置与之前的底层记录的命令字比较，解析出变化的有效策略路由，譬如增加某个节点、删除某个节点、改变某个节点的下一跳信息或者引用的ACL表项。步骤303，将多项节点信息分别写入各自节点信息修改类型对应的节点修改信息数据结构。本实施例中，驱动转发模块解析出多个节点的修改信息。以图1为例，需要删除节点2047，修改节点2046引用的ACL表项，修改节点1的下一跳信息。在删除节点的数据结构中记录策略路由标识PBR1、节点标识node2047、删除节点2047；在修改引用ACL表项的数据结构中记录策略路由标识PBR1、节点标识2046、节点2046新引用的ACL表项的索引；在修改下一跳信息的数据结构中记录节点1的策略路由标识PBR1、节点标识node1、节点1的新下一跳。步骤304，为被写入的节点修改信息数据结构的每项节点信息生成节点修改消息。驱动转发模块分别生成删除节点消息，修改节点引用ACL表项的消息、以及修改节点下一跳消息，并分别向策略路由修改模块发送。驱动转发模块发送的删除节点消息带有策略路由标识PBR1、节点标识node2047、删除节点2047的修改内容；发送的修改节点引用ACL表项的消息带有策略路由标识PBR1、节点标识2046、节点2046新引用的ACL表项的索引3002，发出的修改下一跳信息中带有策略路由标识PBR1、节点标识node1、节点1的新下一跳。步骤305，基于每个节点修改消息中的策略路由标识和节点标识的优先级定位每个待修改策略路由的待修改节点，根据每个节点修改消息的修改内容修改每个待修改节点。策略路由修改模块根据删除节点消息的策略路由标识PBR1识别出待修改的PBR策略，根据node节点标识2046的优先级排列位置，找到排列在最低优先级位置的节点2047，然后根据修改动作删除PBR1中的节点2047。策略路由修改模块根据修改下一跳信息的策略路由标识PBR1识别出待修改的PBR策略，根据node节点标识1的优先级排列位置，找到节点1，然后根据修改动作将PBR1中的节点1的下一跳修改为新的下一跳。图4为修改策略路由的ACL表项的实施例的流程图；步骤401，解析有效策略路由配置；步骤402，比较有效策略路由配置与记录的已配置策略路由以解析变化的有效策略路由；步骤403，将变化的有效策略路由中的多项ACL表项修改信息分别写入各自ACL表项修改类型对应的ACL表项修改信息数据结构；本实施例中，以图1为例，驱动转发模块解析出的多项ACL表项修改信息需要删除ACL表项3000的rule2，删除ACL表项3000的rule1，添加ACL表项3000的rule3017。驱动转发模块在删除ACL表项规则的数据结构中记录的策略路由标识PBR1、节点标识node1、ACL表项索引3000、规则标识2以及删除动作；记录策略路由标识PBR1、节点标识node1、ACL表项索引3000、规则标识1以及删除动作；记录策略路由标识PBR1、节点标识node1、ACL表项索引3000、规则标识3017以及待添加的rule3017的内容。步骤404，为被写入的各ACL表项修改信息数据结构的各项ACL表项修改信息生成ACL表项修改消息；驱动转发模块为被写入删除ACL表项规则的数据结构中的2项ACL表项修改信息分别发出删除ACL表项3000的rule2的消息、删除ACL表项3000的rule1的消息并发往策略路由修改模块。驱动转发模块为写入添加ACL表项规则的数据接口的ACL表项修改信息发出添加ACL表项3000的rule3017的消息，步骤405，根据各ACL表项修改消息中策略路由标识、节点标识、表项索引、规则标识指向的规则按照各ACL表项修改消息中规则修改内容进行修改。策略路由修改模块收到删除ACL表项3000的rule2的消息时，根据该消息中策略路由标识PBR1、节点标识node1、ACL表项索引3000、规则标识2识别需要修改的rule2，对rule2执行删除。策略路由修改模块收到删除ACL表项3000的rule1的消息时，根据该消息中策略路由标识PBR1、节点标识node1、ACL表项索引3000、规则标识1识别需要修改的rule1，对rule1执行删除。策略路由修改模块收到添加ACL表项3000的rule3017的消息时，根据该消息中策略路由标识PBR1、节点标识node1、ACL表项索引3000、规则标识3017识别需要修改的rule3017，添加的rule3017。ACL表项的各条规则不按照优先级决定存储位置，可基于根据规则标识查找、添加、删除、修改对应的规则。图3和图4有益效果在于，通过定义的每个节点信息修改类型定义对应的节点修改信息数据结构存储需要修改的路由信息，通信设备根据各节点修改信息数据结构发出的ACL表项修改消息可直接获取某个节点需要修改的路由信息，无需再修改某个节点的路由信息时对策略路由的全部节点进行全删和全新增的操作，提高了策略路由的修改效率。图5为本申请提供的修改策略路由的设备实施例的示意图，该设备50至少包括：输入接口，网络接口，交换芯片，CPU以及存储器。交换芯片至少包括驱动转发模块、策略路由修改模块。处理器通过运行存储器中的处理器可执行指令用以执行设置模块、控制模块。设置模块，用于为每个节点信息修改类型定义对应的节点修改信息数据结构；每个节点修改信息数据结构至少包括策略路由标识、节点标识、节点修改内容；控制模块，解析配置信息中的有效策略路由配置；驱动转发模块，用于比较有效策略路由配置与记录的已配置策略路由以解析变化的有效策略路由；将变化的有效策略路由的节点修改信息，写入节点修改信息的节点信息修改类型对应的节点修改信息数据结构；为被写入节点修改信息数据结构的节点修改信息生成节点修改消息并发往策略路由修改模块；策略路由修改模块，用于识别节点修改消息中的策略路由标识指向的待修改策略路由，根据节点修改消息中的节点标识的优先级定位待修改节点，根据节点修改消息中的修改内容修改待修改节点。驱动转发模块，还用于将变化的有效策略路由包括的多项节点修改信息分别写入各自节点信息修改类型对应的节点修改信息数据结构；为被写入的节点修改信息数据结构的每项节点信息生成节点修改消息；并发送到策略路由修改模块；策略路由修改模块，基于每个节点修改消息中的策略路由标识和节点标识的优先级定位每个待修改策略路由的待修改节点，根据每个节点修改消息的修改内容修改每个待修改节点。设置模块还用于，为每个接入控制表项ACL修改类型定义对应的ACL修改信息数据结构；每个ACL修改信息数据结构至少包括策略路由标识、节点标识、表项索引、规则标识以及规则修改内容；驱动转发模块，还用于将变化的有效策略路由包括的ACL表项修改信息，写入ACL表项修改信息的ACL表项修改类型对应的ACL表项修改信息数据结构；为被写入节点修改信息数据结构的节点修改信息生成节点修改消息并发往策略路由修改模块；策略路由修改模块，还用于根据ACL表项修改消息中策略路由标识、节点标识、表项索引、规则标识指向的规则按照ACL表项修改消息中规则修改内容进行修改。驱动转发模块，用于将变化的有效策略路由包括的多项ACL表项修改信息分别写入各自ACL表项修改类型对应的ACL表项修改信息数据结构；为被写入的各ACL表项修改信息数据结构的各项ACL表项修改信息生成ACL表项修改消息并分别发送到策略路由修改模块；策略路由修改模块，还用于根据各ACL表项修改消息中策略路由标识、节点标识、表项索引、规则标识指向的规则按照各ACL表项修改消息中规则修改内容进行修改。驱动转发模块，还用于将有效策略路由配置更新到记录的已配置策略路由。以上仅为本申请的较佳实施例而已，并不用以限制本申请，凡在本申请的精神和原则之内，所做的任何修改、等同替换、改进等，均应包含在本申请保护的范围之内。
