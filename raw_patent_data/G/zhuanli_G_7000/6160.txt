标题title
一种面向溯源图的多电力终端协同行为检测方法及装置
摘要abst
本发明公开了一种面向溯源图的多电力终端协同行为检测方法及装置，通过在电力终端设备上学习系统和应用软件的行为，构建行为事件图，由行为事件图组成电力终端设备的溯源图，并通过简化的表示，形成草图的向量表示，在云端采用多终端学习的方法，进行电力终端设备状态分析，通过端‑云协同，实现模型自动更新。本发明通过构建电力终端的进程行为向量，并采用多终端协同训练，能够极大的缩短模型的学习时间和成本，基于图和行为向量可有效的识别出电力设备异常行为，保证设备的安全性。
权利要求书clms
1.一种面向溯源图的多电力终端协同行为检测方法，其特征在于：包括如下步骤：步骤1：获取电力终端的事件，根据事件组成行为事件图，将电力终端所有行为事件图按边出现的时间的顺序进行排序，获得电力终端的溯源图；步骤2：对电力终端的溯源图采用改进图同构子树核方法进行简化和表示，得到电力终端的草图；步骤3：对电力终端的草图中所有的子树进行排序，选出最新变动的k个子树，计算排序后k个子树的散列值，将k个子树的散列值组成电力终端的当前状态的向量；步骤4：当电力终端每采集至k个事件，则根据电力终端的当前状态的向量，计算电力终端的更新后状态的向量，将n个电力终端的更新后状态的向量作为状态转移的变化描述的矩阵，记作状态量，并将状态量发送到云端；步骤5：云端在得到所有电力终端的状态量后，对所有电力终端的状态量进行聚类，根据簇的数量，得到所有电力终端的状态量的关键参数，云端将关键参数发送到各个电力终端上，并在电力终端保存；步骤6：电力终端继续采集事件，直到计算出新的状态量，计算新的状态量中当前状态的向量与簇中心点的距离，判断是否超过了对应半径，根据判断结果，获得电力终端当前状态。2.根据权利要求1所述的一种面向溯源图的多电力终端协同行为检测方法，其特征在于：还包括：步骤7：当电力终端发现异常上报到云端后，云端人工确认为正常行为，则云端向提交该异常的电力终端发送命令，采集本次误报对应的新的状态量，保存新的状态量，重新计算所有电力终端聚类的簇，以及关键参数，并将重新计算的关键参数向发现异常的电力终端下发。3.根据权利要求1或2所述的一种面向溯源图的多电力终端协同行为检测方法，其特征在于：所述行为事件图采用表示，表示节点的集合, 对于任意的节点,节点关键属性的取值，；其中，表示进程名称，表示文件的路径，表示端口，表示外联的IP地址；对于任意的边，表示边的集合，边包含的属性为，表示读、写、开放、连接、创建，表示边出现的时间，表示边出现最新更新的时间。4.根据权利要求3所述的一种面向溯源图的多电力终端协同行为检测方法，其特征在于：所述步骤2，包括：对电力终端的溯源图按时间优先遍历方法进行遍历，以每个节点为树的根，迭代r轮，生成高度为r的子树，迭代结束后，生成个子树，以及对应的个字符串，个子树，以及对应的个字符串组成电力终端的草图；所述字符串计算公式如下：)其中，表示使用字符串序列表示的子树核；函数表示将上一轮的子树核基础上，拼接新的邻居节点的边和节点信息，Sort方法表示根据边的两个时间属性排序，决定新的邻居节点的边和节点信息的拼接顺序；表示邻居节点，表示根节点的子树，表示边出现最新更新的时间，表示边出现的时间。5.根据权利要求4所述的一种面向溯源图的多电力终端协同行为检测方法，其特征在于：所述步骤3，包括：针对每个子树的，获取每个子树所有边的时间的最大值，代表子树的最近更新时间，用表示；根据逆序排序，选择个最新的子树，，根据使用HistoSketch算法，计算k个子树的散列值，并按照该顺序将k个子树的散列值组成电力终端的当前状态的向量。6.根据权利要求1或2所述的一种面向溯源图的多电力终端协同行为检测方法，其特征在于：所述关键参数如下：，其中，其中：表示第i个簇的参数，表示中心点的坐标，表示簇的半径，表示簇的数量。7.根据权利要求6所述的一种面向溯源图的多电力终端协同行为检测方法，其特征在于：所述步骤5，包括：如果关键参数中包含某个电力终端的任何一个状态向量，则的信息将发送到某个电力终端上，否则，的信息将不发送到某电力终端上。8.根据权利要求6所述的一种面向溯源图的多电力终端协同行为检测方法，其特征在于：所述步骤6，包括：根据新的状态量A与云端下发的z个簇中心点的距离，判断是否超过了对应半径；如果没有超过对应的半径，则认为当前状态的向量S包含在其中某个簇中，所以电力终端当前状态为正常状态，系统的行为属于正常行为；如果超过了对应的半径，则认为当前状态的向量S不在任何簇中，所以电力终端当前状态为恶意行为，电力终端需上报向量S对应的子树信息到云端，上报的内容包含对应子树的字符串表示；为个最新的子树，。9.一种面向溯源图的多电力终端协同行为检测装置，其特征在于：包括如下模块：溯源图构建模块，用于获取电力终端的事件，根据事件组成行为事件图，将电力终端所有行为事件图按边出现的时间的顺序进行排序，获得电力终端的溯源图；草图构建模块，用于对电力终端的溯源图采用改进图同构子树核方法进行简化和表示，得到电力终端的草图；散列值计算模块，用于对电力终端的草图中所有的子树进行排序，选出最新变动的k个子树，计算排序后k个子树的散列值，将k个子树的散列值组成电力终端的当前状态的向量；状态量计算模块，用于当电力终端每采集至k个事件，则根据电力终端的当前状态的向量，计算电力终端的更新后状态的向量，将n个电力终端的更新后状态的向量作为状态转移的变化描述的矩阵，记作状态量，并将状态量发送到云端；关键参数计算模块，用于云端在得到所有电力终端的状态量后，对所有电力终端的状态量进行聚类，根据簇的数量，得到所有电力终端的状态量的关键参数，云端将关键参数发送到各个电力终端上，并在电力终端保存；状态判断模块，用于电力终端继续采集事件，直到计算出新的状态量，计算新的状态量中当前状态的向量与簇中心点的距离，判断是否超过了对应半径，根据判断结果，获得电力终端当前状态。10.根据权利要求9所述的一种面向溯源图的多电力终端协同行为检测装置，其特征在于：还包括：异常检测模型更新模块，用于当电力终端发现异常上报到云端后，云端人工确认为正常行为，则云端向提交该异常的电力终端发送命令，采集本次误报对应的新的状态量，保存新的状态量，重新计算所有电力终端聚类的簇，以及关键参数，并将重新计算的关键参数向发现异常的电力终端下发。
说明书desc
技术领域本发明涉及一种面向溯源图的多电力终端协同行为检测方法及装置，属于信息安全技术领域。背景技术目前，网络攻击的特性为多样性、新颖性，导致电力系统终端设备面对网络攻击检测难度大、误报率高和成本高，这样就影响到电力系统终端设备的安全，同时也影响到电力系统的安全。对于电力终端设备的网络安全防护主要手段是将设备置于隔离网或者加强口令复杂度等方法来提升联网设备的网络安全，但这些方法会影响用户的使用体验，并不能很好地满足用户需求，同时放置于隔离环境中并不能真正保证安全，反而可能因为安全防护意识薄弱，造成本体防护手段不足。仅使用规则对电力终端设备进行安全监测的方法，通常因为规则设置严格而造成规则的误报率太多，或者由于规则设置宽松造成漏报。APPARMOR等安全软件可以学习电力终端中软件的行为，并将行为以规则的形式保存起来，但由于其学习的访问规则只有主体对客体的操作，无法将该操作的行为与前后行为关联起来，即只针对行为而不是行为序列进行学习，因此安全检测能力有限。另外，一些安全软件可以针对行为序列进行检测，但是由于行为序列比单个行为更为复杂，因此需要更长的学习时间才能保证模型可用。另一方面，由于多核CPU、并行计算、操作系统并发等技术的应用，往往基于行为序列的检测模型对系统真实的可变运行状态无法准确描述，造成误报率高。因此，本领域技术人员急需要解决针对电力终端中行为进行安全监测时，遇到的基于规则的单个行为检测误报率高、基于行为序列的异常检测模型训练时间、误报率较高的技术问题。发明内容目的：为了克服现有技术中存在的不足，本发明提供一种面向溯源图的多电力终端协同行为检测方法及装置。技术方案：为解决上述技术问题，本发明采用的技术方案为：第一方面，一种面向溯源图的多电力终端协同行为检测方法，包括如下步骤：步骤1：获取电力终端的事件，根据事件组成行为事件图，将电力终端所有行为事件图按边出现的时间的顺序进行排序，获得电力终端的溯源图。步骤2：对电力终端的溯源图采用改进图同构子树核方法进行简化和表示，得到电力终端的草图。步骤3：对电力终端的草图中所有的子树进行排序，选出最新变动的k个子树，计算排序后k个子树的散列值，将k个子树的散列值组成电力终端的当前状态的向量。步骤4：当电力终端每采集至k个事件，则根据电力终端的当前状态的向量，计算电力终端的更新后状态的向量，将n个电力终端的更新后状态的向量作为状态转移的变化描述的矩阵，记作状态量，并将状态量发送到云端。步骤5：云端在得到所有电力终端的状态量后，对所有电力终端的状态量进行聚类，根据簇的数量，得到所有电力终端的状态量的关键参数，云端将关键参数发送到各个电力终端上，并在电力终端保存。步骤6：电力终端继续采集事件，直到计算出新的状态量，计算新的状态量中当前状态的向量与簇中心点的距离，判断是否超过了对应半径，根据判断结果，获得电力终端当前状态。作为优选方案，还包括：步骤7：当电力终端发现异常上报到云端后，云端人工确认为正常行为，则云端向提交该异常的电力终端发送命令，采集本次误报对应的新的状态量，保存新的状态量，重新计算所有电力终端聚类的簇，以及关键参数，并将重新计算的关键参数向发现异常的电力终端下发。作为优选方案，所述行为事件图采用表示，表示节点的集合, 对于任意的节点,节点关键属性的取值；其中，表示进程名称，表示文件的路径,表示端口，表示外联的IP地址。对于任意的边表示边的集合，边包含的属性为表示读、写、开放、连接、创建，表示边出现的时间，表示边出现最新更新的时间。作为优选方案，所述步骤2，包括：对电力终端的溯源图按时间优先遍历方法进行遍历，以每个节点为树的根，迭代r轮，生成高度为r的子树，迭代结束后，生成个子树，以及对应的个字符串，个子树，以及对应的个字符串组成电力终端的草图，表示根节点的子树。作为优选方案，所述字符串计算公式如下：)其中，表示使用字符串序列表示的子树核；函数表示将上一轮的子树核基础上，拼接新的邻居节点的边和节点信息，Sort方法表示根据边的两个时间属性排序，决定新的邻居节点的边和节点信息的拼接顺序。表示邻居节点，表示根节点的子树，表示边出现最新更新的时间，表示边出现的时间。作为优选方案，所述步骤3，包括：针对每个子树的，获取每个子树所有边的时间的最大值，代表子树的最近更新时间，用表示。根据逆序排序，选择个最新的子树，，根据使用HistoSketch算法，计算k个子树的散列值，并按照该顺序将k个子树的散列值组成电力终端的当前状态的向量。作为优选方案，所述k=20，n=2000。作为优选方案，所述关键参数如下：，其中，其中：表示第i个簇的参数，表示中心点的坐标，表示簇的半径，表示簇的数量。作为优选方案，所述步骤5，包括：如果关键参数中包含某个电力终端的任何一个状态向量，则的信息将发送到某个电力终端上，否则，的信息将不发送到某电力终端上。作为优选方案，所述步骤6，包括：根据新的状态量A与云端下发的z个簇中心点的距离，判断是否超过了对应半径。如果没有超过对应的半径，则认为当前状态的向量S包含在其中某个簇中，所以电力终端当前状态为正常状态，系统的行为属于正常行为。如果超过了对应的半径，则认为当前状态的向量S不在任何簇中，所以电力终端当前状态为恶意行为，电力终端需上报向量S对应的子树信息到云端，上报的内容包含对应子树的字符串表示。第二方面，一种面向溯源图的多电力终端协同行为检测装置，包括如下模块：溯源图构建模块，用于获取电力终端的事件，根据事件组成行为事件图，将电力终端所有行为事件图按边出现的时间的顺序进行排序，获得电力终端的溯源图。草图构建模块，用于对电力终端的溯源图采用改进图同构子树核方法进行简化和表示，得到电力终端的草图。散列值计算模块，用于对电力终端的草图中所有的子树进行排序，选出最新变动的k个子树，计算排序后k个子树的散列值，将k个子树的散列值组成电力终端的当前状态的向量。状态量计算模块，用于当电力终端每采集至k个事件，则根据电力终端的当前状态的向量，计算电力终端的更新后状态的向量，将n个电力终端的更新后状态的向量作为状态转移的变化描述的矩阵，记作状态量，并将状态量发送到云端。关键参数计算模块，用于云端在得到所有电力终端的状态量后，对所有电力终端的状态量进行聚类，根据簇的数量，得到所有电力终端的状态量的关键参数，云端将关键参数发送到各个电力终端上，并在电力终端保存。状态判断模块，用于电力终端继续采集事件，直到计算出新的状态量，计算新的状态量中当前状态的向量与簇中心点的距离，判断是否超过了对应半径，根据判断结果，获得电力终端当前状态。作为优选方案，还包括：异常检测模型更新模块，用于当电力终端发现异常上报到云端后，云端人工确认为正常行为，则云端向提交该异常的电力终端发送命令，采集本次误报对应的新的状态量，保存新的状态量，重新计算所有电力终端聚类的簇，以及关键参数，并将重新计算的关键参数向发现异常的电力终端下发。作为优选方案，所述行为事件图采用表示，表示节点的集合, 对于任意的节点,节点关键属性的取值，；其中，表示进程名称，表示文件的路径,表示端口，表示外联的IP地址。对于任意的边，表示边的集合，边包含的属性为，表示读、写、开放、连接、创建，表示边出现的时间，表示边出现最新更新的时间。作为优选方案，所述草图构建模块，包括如下功能：对电力终端的溯源图按时间优先遍历方法进行遍历，以每个节点为树的根，迭代r轮，生成高度为r的子树，迭代结束后，生成个子树，以及对应的个字符串，个子树，以及对应的个字符串组成电力终端的草图，表示根节点的子树。作为优选方案，所述字符串计算公式如下：)其中，表示使用字符串序列表示的子树核；函数表示将上一轮的子树核基础上，拼接新的邻居节点的边和节点信息，Sort方法表示根据边的两个时间属性排序，决定新的邻居节点的边和节点信息的拼接顺序。表示邻居节点，表示根节点的子树，表示边出现最新更新的时间，表示边出现的时间。作为优选方案，所述散列值计算模块，包括如下功能：针对每个子树的，获取每个子树所有边的时间的最大值，代表子树的最近更新时间，用表示。根据逆序排序，选择个最新的子树，，根据使用HistoSketch算法，计算k个子树的散列值，并按照该顺序将k个子树的散列值组成电力终端的当前状态的向量。作为优选方案，所述k=20，n=2000。作为优选方案，所述关键参数如下：，其中，其中：表示第i个簇的参数，表示中心点的坐标，表示簇的半径，表示簇的数量。作为优选方案，所述关键参数计算模块，包括如下功能：如果关键参数中包含某个电力终端的任何一个状态向量，则的信息将发送到某个电力终端上，否则，的信息将不发送到某电力终端上。作为优选方案，所述状态判断模块，包括如下功能：根据新的状态量A与云端下发的z个簇中心点的距离，判断是否超过了对应半径。如果没有超过对应的半径，则认为当前状态的向量S包含在其中某个簇中，所以电力终端当前状态为正常状态，系统的行为属于正常行为。如果超过了对应的半径，则认为当前状态的向量S不在任何簇中，所以电力终端当前状态为恶意行为，电力终端需上报向量S对应的子树信息到云端，上报的内容包含对应子树的字符串表示。有益效果：本发明提供的一种面向溯源图的多电力终端协同行为检测方法及装置，通过在电力终端设备上学习系统和应用软件的行为，构建行为事件图，由行为事件图组成电力终端设备的溯源图，并通过简化的表示，形成草图的向量表示，随后在云端采用多终端学习的方法，极大降低单个终端学习的时长，解决因为学习不充分造成的误报率高的问题，其次通过端-云协同，实现模型自动更新，进一步提高电力终端异常检测的能力，从而有力保障了电力设备的终端安全性。本发明通过构建电力终端的进程行为向量，并采用多终端协同训练，能够极大的缩短模型的学习时间和成本，基于图和行为向量可有效的识别出电力设备异常行为，保证设备的安全性。附图说明图1为本发明的方法流程示意图。图2为典型的行为事件图。图3为本发明的装置结构示意图。具体实施方式下面结合具体实施例对本发明作更进一步的说明。如图1所示，第一种实施例一种面向溯源图的多电力终端协同行为检测方法，包括如下步骤：步骤一，部署在电力终端上的采集探针对电力终端的事件进行采集，然后根据各事件组成行为事件图。将电力终端对应的所有行为事件图按边出现的时间的顺序进行排序，获得电力终端的溯源图。如图2所示，事件具体采集内容包括：进程的创建，进程对文件的读、写等操作，进程的网络访问，进程开放端口和进程连接IP等。所述行为事件图采用表示，表示节点的集合, 对于任意的节点,节点关键属性的取值，；其中，表示进程名称，表示文件的路径,表示端口，表示外联的IP地址。对于任意的边，表示边的集合，边包含的属性为，表示读、写、开放、连接、创建，表示边出现的时间，表示边出现最新更新的时间，当某条边第一次出现时，，其中与的值不是事件发生的时间戳，而是事件发现的顺序，在事件采集过程中，将维护一个全局的事件计数器每当采集到新的事件，就增长1，将所有事件按边出现的时间的顺序进行排序，获得电力终端的溯源图。事件计数器设计保证了事件的先后关系，同时可以忽略掉系统不相关的时间细节。步骤二，对生成的电力终端的溯源图采用改进图同构子树核方法进行简化和表示，得到电力终端的草图，所述草图包括个子树，以及对应的个字符串。核心的目的是将一个大图的拓扑表示转化为内容相似的图局部结构的字符串序列表示。传统的图同构子树核算法是针对一张无向图，针对每个图中的节点，通过k次迭代遍历，生成一棵高为k的树，遍历方法可以是深度优先方法或者广度优先方法。本发明中对图同构子树核算法进行改进，确保图同构子树核算法可以保留图中更多的信息。具体的做法是，在传统的图同构子树核算法的基础上，把深度优先和广度优先的遍历方法改变为需要时间优先遍历方法，同时由于边存在两个时间戳，因此每个边可能被遍历两次。对电力终端的溯源图按时间优先遍历方法进行遍历，以每个节点为树的根，迭代r轮，生成高度为r的子树，迭代结束后，生成个子树，以及对应的个字符串，个子树，以及对应的个字符串组成电力终端的草图。遍历的结果是使用字符串拼接的方式，按序拼接成一个字符串,用如下公式表示：)其中，表示由改进的图同构子树核算法经过r轮迭代后，生成的使用字符串序列表示的子树核；函数表示将上一轮的子树核基础上，拼接新的邻居节点的边和节点信息，Sort方法表示根据边的两个时间属性排序，决定新的邻居节点的边和节点信息的拼接顺序。当以每个节点为树的根，基于改进的图同构子树核算法迭代r轮，生成高度为r的子树，本步骤后共生成个子树对应的个字符串。表示邻居节点，表示根节点的子树，表示边出现最新更新的时间，表示边出现的时间。步骤三，为了降低计算量，对电力终端的草图中所有的子树进行排序，选出最新变动的k个子树，计算排序后k个子树的散列值，由k个子树的散列值组成电力终端的当前状态的向量表示。针对每个子树的，获取每个子树所有边的时间的最大值，代表子树的最近更新时间，用表示。根据逆序排序，选择个最新的子树，然后使用HistoSketch算法，计算k个子树的散列值，并按照该顺序将k个子树的散列值组成电力终端的当前状态的向量。排序后子树的散列值计算公式如下：，其中表示经过排序后的第个子树的字符串，该子树以节点为根；表示经过排序后的第个子树的散列值，即节点在第轮的改进的图同构子树核算法后，以节点为根的子树的散列值，表示第个排序后子树的散列值，因此电力终端的当前时刻的状态是由k个的数值表示的，第个的量就是。由于HistoSketch算法可以保留字符串的相似度，因此子树的字符串表示越相似，则计算的散列值越接近。或者说，如果电力终端的行为类似，则k个的状态量应当很接近。步骤四，当电力终端每采集至k个事件，则根据电力终端的当前状态的向量，计算电力终端的更新后状态的向量，将n个电力终端的更新后状态的向量作为状态转移的变化描述的矩阵，记作状态量，并将状态量发送到云端。但由于前一次的状态的向量都是排好序的，每次采集仅会影响k个量中的1个，因此只需要对其中的1个子树进行更新，并重新计算该子树的HistoSketch的值，并将该子树的值调整为第1个即可。为了加快计算效率，本发明采用批量更新的方法，每采集到k个事件，才会更新状态的向量。同时设置k=20，即20次事件更新一次电力终端的状态。同时，本发明电力终端中保存n=2000个状态的向量作为状态转移的变化描述的矩阵，记作，其中，，n代表电力终端状态的向量的数量。当在电力终端采集事件并计算散列值得到一个完整的或者当训练时间到了预设值的时间，就将数据发送到云端。如果训练时间没有到预设值的时间，则得到完整的A后，电力终端继续进行采集、训练计算并得到新的状态序列A，继续发送到云端，直至达到训练时间。步骤五，云端在得到所有电力终端的状态量A后，对所有电力终端的状态量A进行聚类，其中簇的数量z，得到所有电力终端的状态量A的关键参数，，云端将z组关键参数发送到各个电力终端上，并在电力终端保存。z的取值由轮廓系数法确定，由于轮廓系数法为常用算法，本发明直接使用该方法即可。在确定了聚类的簇的数量并完成聚类后，云端将得到各个聚类的中心节点、簇的半径的值。就将z组参数发送到各个电力终端设备上，电力终端保存上述参数，并作为检测参数进行设置。在所有电力终端的状态量A聚合结束后，得到所有电力终端的状态量A的关键参数，计算公式如下：，其中，其中表示第i个簇的参数，表示中心点的坐标，是由k个状态表示的散列值数据，表示簇的半径，表示簇的数量。为了降低电力终端侧在异常检测的计算量，做以下优化。由于不同电力终端上运行的业务应用各有不同，因此并不需要将所有的簇信息都发送到所有的电力终端设备，而是进行筛选，如果关键参数mi中ci包含电力终端x的任何一个状态向量，则mi的信息将发送到电力终端x上，否则，mi的信息将不发送到电力终端x上。步骤六，电力终端继续采集事件，直到计算出新的状态量，计算新的状态量中当前状态的向量与z个簇中心点的距离，判断是否超过了对应半径，根据判断结果，获得电力终端当前状态。电力终端继续采集事件，计算电力终端的更新后状态的向量，并缓存在本地，以备后续使用，缓存的数据量最多不超过新的状态量的大小。根据计算新的状态量A与云端下发的z个簇中心点的距离，判断是否超过了对应半径，根据判断结果，获得电力终端当前状态。如果没有超过对应的半径，则认为在簇i中。当前状态的向量S包含在其中某个簇中，则认为电力终端当前状态为正常状态，系统的行为属于正常行为。如果超过了对应的半径，则认为不在簇i中。若当前状态的向量S不在任何簇中，则判定电力终端当前状态为恶意行为，电力终端需上报状态S对应的子树信息到云端，上报的内容包含对应子树的字符串表示。通过发送到云端进行聚类，由于多个电力终端同时进行训练，因此可以极大降低训练时间，提高因为训练时间不足造成的误报率高的问题。步骤七，当电力终端发现异常上报到云端后，云端人工确认为正常行为，则云端向提交该异常的电力终端发送命令，采集本次误报对应的新的状态量A，由于电力终端在步骤六缓存了新的状态量A，因此电力终端能够将异常行为对应的新的状态量A发送到云端。云端首先保存新的状态量A，随后重复步骤五的过程，重新基于轮廓系数法计算聚类的簇。经过重新计算的簇的数量z、每个簇的中心点和半径参数可能与上一轮有不同，因此云端向该电力终端重新下发关键参数，实现电力终端侧异常检测模型的更新。云端聚合后，将模型参数下发到各个电力终端上，从而对电力终端的检测。同时电力终端发现异常行为，则上报到服务端，如果云端认为是误报，则可以重新训练该模型，并向各个电力终端同步更新检测模型，从而实现检测模型的自动更新。如图3所示，第二种实施例一种面向溯源图的多电力终端协同行为检测装置，包括如下模块：溯源图构建模块，用于部署在电力终端上的采集探针对电力终端的事件进行采集，然后根据各事件组成行为事件图。将电力终端对应的所有行为事件图按边出现的时间的顺序进行排序，获得电力终端的溯源图。草图构建模块，用于对生成的电力终端的溯源图采用改进图同构子树核方法进行简化和表示，得到电力终端的草图，所述草图包括个子树，以及对应的个字符串。散列值计算模块，用于为了降低计算量，对电力终端的草图中所有的子树进行排序，选出最新变动的k个子树，计算排序后k个子树的散列值，由k个子树的散列值组成电力终端的当前状态的向量表示。状态量计算模块，用于当电力终端每采集至k个事件，则根据电力终端的当前状态的向量，计算电力终端的更新后状态的向量，将n个电力终端的更新后状态的向量作为状态转移的变化描述的矩阵，记作状态量，并将状态量发送到云端。关键参数计算模块，用于云端在得到所有电力终端的状态量A后，对所有电力终端的状态量A进行聚类，其中簇的数量z，得到所有电力终端的状态量A的关键参数，，云端将z组关键参数发送到各个电力终端上，并在电力终端保存。状态判断模块，用于电力终端继续采集事件，直到计算出新的状态量，计算新的状态量中当前状态的向量与z个簇中心点的距离，判断是否超过了对应半径，根据判断结果，获得电力终端当前状态。异常检测模型更新模块，用于当电力终端发现异常上报到云端后，云端人工确认为正常行为，则云端向提交该异常的电力终端发送命令，采集本次误报对应的新的状态量A，由于电力终端在步骤六缓存了新的状态量A，因此电力终端能够将异常行为对应的新的状态量A发送到云端。云端首先保存新的状态量A，随后重复步骤五的过程，重新基于轮廓系数法计算聚类的簇。经过重新计算的簇的数量z、每个簇的中心点和半径参数可能与上一轮有不同，因此云端向该电力终端重新下发关键参数，实现电力终端侧异常检测模型的更新。本领域内的技术人员应明白，本发明的实施例可提供为方法、系统、或计算机程序产品。因此，本发明可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本发明可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本发明是参照根据本发明实施例的方法、设备、和计算机程序产品的流程图和／或方框图来描述的。应理解可由计算机程序指令实现流程图和／或方框图中的每一流程和／或方框、以及流程图和／或方框图中的流程和／或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能的步骤。以上所述仅是本发明的优选实施方式，应当指出：对于本技术领域的普通技术人员来说，在不脱离本发明原理的前提下，还可以做出若干改进和润饰，这些改进和润饰也应视为本发明的保护范围。
