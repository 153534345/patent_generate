标题title
物联终端掉电下业务保护和恢复的方法、装置及设备
摘要abst
本申请涉及一种物联终端掉电下业务保护与恢复的方法、装置及设备，所述方法包括步骤：确认掉电后，基于所述物联终端下挂器件的用电属性和/或业务数据类型对业务模块进行差异化断电处理，并将掉电期间各器件的运行数据保存于掉电数据存储区以供上电恢复时使用；确认上电后，判断超级电容是否耗尽，并在超级电容尚未耗尽时针对所述差异化断电处理的结果进行恢复用电处理。本发明解决物联终端在异常掉电情况下的业务、数据的保存和恢复，可提高业务、数据的安全性和可靠性。
权利要求书clms
1.一种物联终端掉电下业务保护与恢复的方法，其特征在于，掉电后，所述物联终端的超级电容继续在预设时间内提供电量，所述方法包括步骤：确认掉电后，基于所述物联终端下挂器件的用电属性和/或业务数据类型对业务模块进行差异化断电处理，并将掉电期间各器件的运行数据保存于掉电数据存储区以供上电恢复时使用；确认上电后，判断超级电容是否耗尽，并在超级电容尚未耗尽时针对所述差异化断电处理的结果进行恢复用电处理。2.如权利要求1所述的一种物联终端掉电下业务保护与恢复的方法，其特征在于，基于所述物联终端下挂器件的用电属性和/或业务数据类型对业务模块进行差异化断电处理，包括步骤：判断器件是否满足预设的强用电需求列表，若是则停止器件对应的业务模块与器件IO接口之间的通信。3.如权利要求1所述的一种物联终端掉电下业务保护与恢复的方法，其特征在于，基于所述物联终端下挂器件的用电属性和/或业务数据类型对业务模块进行差异化断电处理，包括步骤：基于业务数据类型进行优先级排序以使级别高的业务被优先执行。4.如权利要求3所述的一种物联终端掉电下业务保护与恢复的方法，其特征在于，基于业务数据类型进行优先级排序以使级别高的业务被优先执行，包括步骤：根据业务数据类型对时效要求的高低进行优先级排序，使对时效要求高的业务优先处理。5.如权利要求3所述的一种物联终端掉电下业务保护与恢复的方法，其特征在于，基于业务数据类型进行优先级排序以使级别高的业务被优先执行，包括步骤：使对数据有完整性校验的业务数据类型的优先级高于对数据没有完整性校验的业务数据类型，按优先级从高到低的顺序执行各类业务。6.如权利要求1所述的一种物联终端掉电下业务保护与恢复的方法，其特征在于，基于所述物联终端下挂器件的用电属性和/或业务数据类型对业务模块进行差异化断电处理，包括步骤：在业务模块接口数据报文丢失或错误率达到预设错误阈值时，停止所述业务模块与对应器件IO接口之间的通信。7.如权利要求1所述的一种物联终端掉电下业务保护与恢复的方法，其特征在于，所述判断超级电容是否耗尽，在超级电容尚未耗尽时针对所述差异化断电处理的结果进行恢复用电处理，包括步骤：若超级电容尚未耗尽，则恢复被断电处理的业务模块，再从所述掉电数据存储区恢复所述掉电期间各器件的运行数据至指定数据中心进行业务恢复处理；若超级电容已耗尽，则从所述掉电数据存储区恢复所述掉电期间各器件的运行数据至指定数据中心进行业务恢复处理。8.如权利要求1所述的一种物联终端掉电下业务保护与恢复的方法，其特征在于，其包括步骤：确认掉电后且恢复上电之前，业务模块用初始无效值上报指定数据中心。9.一种物联终端掉电下业务保护与恢复的装置，其特征在于，掉电后，所述物联终端的超级电容继续在预设时间内提供电量，其包括：掉电保护模块，其用于基于所述物联终端下挂器件的用电属性对业务模块进行差异化断电处理，并将掉电期间各器件的运行数据保存于掉电数据存储区以供上电恢复时使用；上电恢复模块，其用于判断超级电容是否耗尽，并在超级电容尚未耗尽时针对所述差异化断电处理的结果进行恢复用电处理。10.一种物联终端设备，其特征在于，所述物联终端设备包括处理器、存储器、以及存储在所述存储器上并可被所述处理器执行的计算机程序，其中所述计算机程序被所述处理器执行时，实现如权利要求1至8中任一项所述的物联终端掉电下业务保护与恢复方法的步骤。
说明书desc
技术领域本发明涉及物联网通信技术领域，特别涉及一种物联终端掉电下业务保护与恢复的方法、装置及设备。背景技术随着物联网技术的逐步成熟，物联网发展速度惊人，一场万物互联时代即将到来，同时背后巨大的市场空间和经济效益日益显现，工业物联网部署落地已逐渐呈现井喷发展。工业物联终端是工业物联网的核心“大脑”，负责处理大量的采集、传感、工控设备的数据，数据一旦出现错误会造成不可预知的风险和经济损失。因此良好的数据保护和恢复措施尤为重要。工业物联终端在发生异常掉电情况下造成的业务、数据错误丢失的情况是最为常见的一种问题场景，如何解决工业物联终端在掉电情况下的业务、数据的保护以及恢复是工业物联网发展中所需要解决的现实问题。发明内容本发明实施例提供一种物联终端掉电下业务保护与恢复的方法、装置及设备，以解决物联终端在异常掉电情况下的业务、数据的保存和恢复，提高了业务、数据的安全性和可靠性。一方面，提出了一种物联终端掉电下业务保护与恢复的方法，其特征在于，掉电后，所述物联终端的超级电容继续在预设时间内提供电量，所述方法包括步骤：确认掉电后，基于所述物联终端下挂器件的用电属性和/或业务数据类型对业务模块进行差异化断电处理，并将掉电期间各器件的运行数据保存于掉电数据存储区以供上电恢复时使用；确认上电后，判断超级电容是否耗尽，并在超级电容尚未耗尽时针对所述差异化断电处理的结果进行恢复用电处理。一些实施例中，基于所述物联终端下挂器件的用电属性和/或业务数据类型对业务模块进行差异化断电处理，包括步骤：判断器件是否满足预设的强用电需求列表，若是则停止器件对应的业务模块与器件IO接口之间的通信。一些实施例中，基于所述物联终端下挂器件的用电属性和/或业务数据类型对业务模块进行差异化断电处理，包括步骤：基于业务数据类型进行优先级排序以使级别高的业务被优先执行。一些实施例中，基于业务数据类型进行优先级排序以使级别高的业务被优先执行，包括步骤：根据业务数据类型对时效要求的高低进行优先级排序，使对时效要求高的业务优先处理。一些实施例中，基于业务数据类型进行优先级排序以使级别高的业务被优先执行，包括步骤：使对数据有完整性校验的业务数据类型的优先级高于对数据没有完整性校验的业务数据类型，按优先级从高到低的顺序执行各类业务。一些实施例中，基于所述物联终端下挂器件的用电属性和/或业务数据类型对业务模块进行差异化断电处理，包括步骤：在业务模块接口数据报文丢失或错误率达到预设错误阈值时，停止所述业务模块与对应器件IO接口之间的通信。一些实施例中，判断超级电容是否耗尽，在超级电容尚未耗尽时针对所述差异化断电处理的结果进行恢复用电处理，包括步骤：若超级电容尚未耗尽，则恢复被断电处理的业务模块，再从所述掉电数据存储区恢复所述掉电期间各器件的运行数据至指定数据中心进行业务恢复处理；若超级电容已耗尽，则从所述掉电数据存储区恢复所述掉电期间各器件的运行数据至指定数据中心进行业务恢复处理。一些实施例中，所述一种物联终端掉电下业务保护与恢复的方法，包括步骤：确认掉电后且恢复上电之前，业务模块用初始无效值上报指定数据中心。第二方面，提出了一种物联终端掉电下业务保护与恢复装置，其特征在于，掉电后，所述物联终端的超级电容继续在预设时间内提供电量，其包括：掉电保护模块，其用于基于所述物联终端下挂器件的用电属性对业务模块进行差异化断电处理，并将掉电期间各器件的运行数据保存于掉电数据存储区以供上电恢复时使用；上电恢复模块，其用于判断超级电容是否耗尽，并在超级电容尚未耗尽时针对所述差异化断电处理的结果进行恢复用电处理。第三方面，提出了一种物联终端设备，其特征在于，所述物联终端设备包括处理器、存储器、以及存储在所述存储器上并可被所述处理器执行的计算机程序，其中所述计算机程序被所述处理器执行时，实现如权利要求1至8中任一项所述的物联终端掉电下业务保护与恢复方法的步骤。本实施例在物联终端掉电后，考虑到各器件对用电的不同运行要求和/或各项业务数据类型的不同，进行差异化的断电处理，并在上电后，根据超级电容是否耗尽以及差异化断电处理的结果进行针对性的恢复用电处理，可降低掉电后由于业务仍在运行导致相关数据没有及时存储所导致的风险和经济损失，并为上电后的恢复用电提供了更为细致的处理方式，以进一步保护业务数据的有效恢复。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例提供的一种物联终端掉电下业务保护与恢复的方法流程示意图；图2为本发明实施例提供的一种物联终端掉电下业务保护与恢复的装置结构示意图；图3为本发明实施例提供的一种物联终端掉电下进行业务保护处理的流程示意图；图4为本发明实施例提供的一种物联终端上电后进行业务恢复处理的流程示意图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明的一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。如图1所示，本发明实施例提供了一种物联终端掉电下业务保护与恢复的方法，包括步骤：S100:确认掉电后，基于所述物联终端下挂器件的用电属性和/或业务数据类型对业务模块进行差异化断电处理，并将掉电期间各器件的运行数据保存于掉电数据存储区以供上电恢复时使用；S200:确认上电后，判断超级电容是否耗尽，并在超级电容尚未耗尽时针对所述差异化断电处理的结果进行恢复用电处理。本实施例中，物联终端一般是指物联网中连接传感网络层和传输网络层实现采集数据及向网络层发送数据的设备，该设备包括具有感知、监控能力的采集/控制传感器，并融合了移动通信以及智能分析等技术。掉电后，物联终端上的超级电容可提供一定时间的电量。在物联终端上部署安装有虚拟的容器，容器内包含采集功能类和控制操作类的应用程序的代码及所有依赖关系，以使容器技术可以在任何物联网设备上实现可移植性，可以容易对于所有物联网设备进行开发软件和管理更新。需要说明的是，所述差异化的断电处理，是指根据不同的情况，对器件对应的业务模块是否继续运行进行控制，使不同运行要求的器件对应的业务模块有不同的掉电后处理模式，有些被立即停止执行，有些还允许继续执行等。所述的掉电期间各器件的运行数据，其包括业务类型、IO接口、MQTT属性、时间以及校验信息等接口数据，以及电压、电流、用电量、空气温度、用水量等采集类数据，同时还有水表/电能表的开关、温/湿度采集器的开关以及采样频率等控制类数据。所述掉电数据存储区可以是EEPROM，以保证数据掉电不会丢失，同时可以重复擦写数据。本实施例在物联终端掉电后，考虑到各器件对用电的不同运行要求和/或业务数据类型的不同，进行差异化的断电处理，并在上电后，根据超级电容是否耗尽以及差异化断电处理的结果进行针对性的恢复用电处理，可降低掉电后由于业务仍在运行导致相关数据没有及时存储所导致的风险和经济损失，并为上电后的恢复用电提供了更为细致的处理方式，以进一步保护业务数据的有效恢复。一些实施例中，当物联终端强电发生掉电后，容器A中的监控模块检测到硬件中断信号，向容器B中的交采程序发送MQTT消息来读取电源板A/B/C三相电压值，容器A的监控模块收到交采返回的结果后，进行判断，不符合三相电的电压的视为掉电。其中，交采程序是一种使用698协议的程序，能够读取电能表的电压电流等信息。一些实施例中，步骤S100包括：S110:判断器件是否满足预设的强用电需求列表，若是则停止器件对应的业务模块与器件IO接口之间的通信。示范性地，在强电掉电后，考虑到依赖强电的器件的模块无法完全满足运行条件，例如交采板、HPLC等这类器件涉及的接口和业务模块，如698采集系统面向对象通信协议等，针对依赖强电的器件，监控模块可通过MQTT的指定掉电TOPIC通知容器B中的业务模块和对应器件的IO接口模块关闭IO访问的数据通信业务，而对于满足电容供电运行要求的器件，相关的业务数据可以继续被处理。可优选地，将交采板、HPLC等这类器件涉及的接口和业务模块列入预设强用电器件列表，判断不在所述列表中的器件可继续执行相关业务数据。可优选地，设置判断器件运行对电量的需求是否超过预设电量阈值，若超过预设电量阈值则停止器件对应的业务模块与器件IO接口之间的通信，若未超过预设电量阈值则不停止器件对应的业务模块与器件IO接口之间的通信。在一些实施例中，步骤S100中的差异化断电处理，包括步骤：S120:基于业务数据类型进行优先级排序以使级别高的业务被优先执行。进一步地，S120包括步骤：S121:根据业务数据类型对时效要求的高低进行优先级排序，使对时效要求高的业务优先处理。示范性地，可基于不同业务数据类型以及应用层业务数据有无完整性校验两方面进行IO接口优先控制处理。考虑到控制类的开关量输出操作，其控制命令对时效性要求很高，可用较高的优先级进行处理；对于采集类的数据，其对时效性的要求不高，处理的优先级低。进一步地，S120还包括步骤：S122:使对数据有完整性校验的业务数据类型的优先级高于对数据没有完整性校验的业务数据类型，按优先级从高到低的顺序执行各类业务。步骤S122中，对于有数据的完整性校验的业务的数据，可进行高优先级的处理，保证业务数据的自身有效性和完整性检查；对于没有数据完整性校验要求的业务的数据，在掉电情况下无法确定数据可靠性，可按低优先级处理甚至直接丢弃。需要说明的是，针对S121和S122步骤中的优先级策略，IO接口的优先级处理可根据不同业务数据类型以及应用层数据是否有完整性校验生成表，监控模块会根据表内容结合linux默认IO调度器的CFQ算法为程序指定调度IO策略和优先级。在一些实施例中，步骤S100中的差异化断电处理，包括步骤：S130:在业务模块接口数据报文丢失或错误率达到预设错误阈值时，停止所述业务模块与对应器件IO接口之间的通信。示范性地，考虑到针对电容电量消耗，可能出现器件供电不足，可基于不同业务接口数据对长度和校验码匹配等校验手段进行错误率监测，数据转换模块会匹配不同业务报文的长度和校验码等校验内容，对于匹配达到数据报文预设错误阀值的业务类型和IO接口会通知监控模块，监控模块会通过MQTT通知业务模块和对应器件的IO接口模块关闭IO访问的数据通信业务。对于接口数据无法收发的情况，可通过监控模块通知该业务模块和对应器件的IO接口模块关闭IO访问数据通信。一些实施例中，步骤S100中将掉电期间的关键数据保存于掉电数据存储区以供上电恢复时使用，具体是由数据转换模块将业务数据的业务类型/IO接口/MQTT属性/时间以及校验等信息封装成指定存储格式，比如JSON字段，可以JSON SCHEMA检验完整性，将存储内容实时保存到掉电数据存储区中防止丢失以便后续数据恢复。一些实施例中，步骤S200包括：S210:判断超级电容是否耗尽，若超级电容尚未耗尽，则先使已停止与对应器件IO接口通信的业务模块恢复所述通信，再从所述掉电数据存储区恢复所述掉电期间各器件的运行数据至指定数据中心进行业务恢复处理。S220:若超级电容已耗尽，则从所述掉电数据存储区恢复所述掉电期间各器件的运行数据至指定数据中心进行业务恢复处理。示范性地，本实施例将上电分为在电容耗尽之前恢复供电和在电容耗尽之后恢复供电，针对在电容耗尽之前恢复供电的情况，步骤S210中包括：1)监控模块先通过MQTT上电TOPIC通知掉电关闭的接口模块重新RESET初始化外设芯片器件恢复正常IO数据通信状态；2)监控模块通过MQTT上电TOPIC通知容器B中的业务模块恢复IO访问的数据通信链路及业务；3)监控模块通知数据转换模块恢复掉电历史数据内容到指定数据中心，并在完成数据恢复后，删除临时存储的掉电历史数据，并进入线程睡眠。可优选地，在将数据恢复至指定数据中心之前，还可对待恢复数据进行二次的校验，以进一步保证数据的准确性。4)监控模块完成掉电处理后，存储掉电完成日志信息后进行业务休眠，等待掉电中断事件唤醒；5)业务模块根据业务需要可以使用掉电中的业务历史相关数据内容信息并上报。具体可通过业务模块通知数据转换模块，数据转换模块访问掉电数据存储区，可以读取特定业务的历史数据。针对在电容耗尽之后恢复供电的情况，S220还包括：1)监控模块检查掉电数据存储区，如果有掉电存储信息，则通知数据转换模块恢复掉电历史关键业务的相关数据内容到指定数据中心后，删除临时存储数据并进入线程睡眠以等待掉电后唤醒；如果没有掉电存储信息，监控模块进行业务休眠，等待掉电中断事件唤醒；2)业务模块根据业务需要可以使用掉电中的业务历史相关数据内容信息并上报。一些实施例中，物联终端上电后，监控模块检测到硬件上电中断信号则向容器B中的交采程序发送MQTT消息来读取A/B/C三相电的电压，容器A的监控模块收到交采返回的结果后，进行判断，A/B/C三相电的电压符合强电指标的情况下视为恢复供电。确认上电后，上报管理平台终端重新上电。其中，管理平台部署在云上，是物联终端与云端通信的数据通道，其用于提供网元管理服务，包括接收掉电、上电消息。本发明实施例，考虑到基于器件的用电属性基于数据及业务完整性基于接口和数据的错误校验和监测基于业务数据的防丢失封装存储保护和自恢复处理，提出了针对不同情况进行差异化掉电处理的策略，解决了在物联终端强电掉电时，业务仍在运行，相关数据没有及时存储，导致数据错误、丢失等问题，实现了物联终端在强电异常掉电情况下的业务、数据的保存和恢复，提高了业务、数据的安全性和可靠性。一些实施例中，所述一种物联终端掉电下业务保护与恢复的方法，包括步骤：确认掉电后且恢复上电之前，业务模块用初始无效值上报指定数据中心。具体地，考虑到一些不依赖强电的业务模块在终端掉电后可仍然工作但随着电容量的消耗，不能保证器件一直能正常工作，业务模块在此期间北向上报数据信息不使用当前值而用初始无效值上报，以防止错误数据的上报从而提高数据的准确性。如图2所示，本发明实施例还提供一种物联终端掉电下业务保护与恢复装置，其特征在于，掉电后，所述物联终端的超级电容继续在预设时间内提供电量，其包括：掉电保护模块，其用于基于所述物联终端下挂器件的用电属性对业务模块进行差异化断电处理，并将掉电期间各器件的运行数据保存于掉电数据存储区以供上电恢复时使用；上电恢复模块，其用于判断超级电容是否耗尽，并在超级电容尚未耗尽时针对所述差异化断电处理的结果进行恢复用电处理。一些实施例中，所述掉电保护模块还用于：判断器件是否满足预设的强用电需求列表，若是则停止器件对应的业务模块与器件IO接口之间的通信。一些实施例中，所述掉电保护模块还用于：根据业务数据类型对时效要求的高低进行优先级排序，使对时效要求高的业务优先处理；使对数据有完整性校验的业务数据类型的优先级高于对数据没有完整性校验的业务数据类型，按优先级从高到低的顺序执行各类业务。一些实施例中，所述上电恢复模块还用于：判断超级电容是否耗尽，若超级电容尚未耗尽，则使已停止与对应器件IO接口通信的业务模块恢复所述通信，并从所述掉电数据存储区恢复所述掉电期间各器件的运行数据至指定数据中心进行业务恢复处理。若超级电容已耗尽，则从所述掉电数据存储区恢复所述掉电期间各器件的运行数据至指定数据中心进行业务恢复处理。本发明实施例还提供了一种物联终端设备，其特征在于，所述物联终端设备包括处理器、存储器、以及存储在所述存储器上并可被所述处理器执行的计算机程序，其中所述计算机程序被所述处理器执行时，实现如权利要求1至7中任一项所述的物联终端掉电下业务保护与恢复方法的步骤。本发明实施例还提供了一种计算机可读存储介质，其特征在于，所述计算机可读存储介质上存储有计算机程序，其中所述计算机程序被处理器执行时，实现如权利要求1至7中任一项所述的物联终端掉电下业务保护与恢复方法的步骤。如图3、在一个具体的实施例中，当终端掉电后对业务进行保护的方法包括步骤：步骤1-1，监控模块监测达到硬件中断信号后确认是否掉电。具体地，物联终端强电发生掉电后，容器A中的监控模块检测到硬件中断信号，其中容器A中的监控模块会实时监控硬件中断信号；容器A中的监控模块向容器B中的交采程序发送MQTT消息来读取电源板A/B/C三相电压值；容器A中的监控模块在检测到硬件中断信号后，通过向容器B中的交采程序发送指定TOPIC的MQTT消息来请求读取电源板的A/B/C三相电压值，交采程序在收到该MQTT消息后，会将读取的A/B/C三相电压值通过MQTT消息发送给监控模块；容器A的监控模块收到交采返回的结果后，进行判断，不符合三相电的电压的视为掉电；容器A中的监控模块收到容器B中的交采程序返回的MQTT消息后，进行判断，不符合三相电电压的判定掉电，其中三相电电压正常值为220v/220v/220v；确认掉电后，周期上报管理平台终端出现掉电事故；容器A中的监控模块确认强电掉电后，会周期性向管理平台发送MQTT消息通知物联终端发生掉电事故。此后进入物联终端业务保护的处理流程，监控模块会进入物联终端的业务保护的处理流程，保护在掉电情况下的数据、业务的安全性、可靠性。步骤1-2，基于用电属性对业务模块进行差异化断电处理。具体地，当物联终端强电掉电后，依赖强电的器件模块无法完全满足运行条件，例如交采板、HPLC等这类器件涉及的接口和业务模块，如698协议等，针对依赖强电的器件监控模块会通过MQTT的指定掉电TOPIC通知容器B中的业务模块和对应器件的IO接口模块关闭IO访问的数据通信业务，而对于满足电容供电运行要求的器件，相关的业务数据可以继续被处理。考虑到一些不依赖强电的业务模块在终端掉电后可仍然工作但随着电容量的消耗，不能保证器件一直能正常工作，因此容器B中的业务模块在此期间北向上报数据信息不使用当前值而用初始无效值上报，以防止错误数据的上报从而提高数据的准确性。掉电期间的关键数据信息在掉电数据存储区存储，供上电恢复时使用。步骤1-3，基于业务数据类型进行优先级排序以使级别高的业务被优先执行。具体地，基于不同业务数据类型和应用层业务数据有无完整性校验两方面进行IO优先控制处理；其中，考虑到控制类的开关量输出操作，其控制命令对时效性要求很高，而采集类的数据，其对时效性的要求较低，因此对于控制类的开关量输出操作，以较高的优先级进行处理；对于采集类的数据，处理的优先级低。对于有数据的完整性校验的业务的数据，这些会进行高优先级的处理，保证业务数据的自身有效性和完整性检查；对于没有数据完整性校验的业务的数据，在掉电情况下无法确定数据可靠性，这些会按低优先级处理甚至直接丢弃。步骤1-4，基于业务模块接口数据报文丢失或错误率情况进行差异化断电处理。具体地，基于不同业务接口数据进行长度和校验码匹配等校验手段的错误率监测，针对电容电量消耗，可能出现器件供电不足，数据转换模块会匹配不同业务报文的长度和校验码等校验内容，对于匹配达到数据报文错误阀值的业务类型和IO接口会通知监控模块，监控模块会通过MQTT通知业务模块和对应器件的IO接口模块关闭IO访问的数据通信业务。而对于接口数据无法收发的情况，会通过监控模块通知该业务模块和对应器件的IO接口模块关闭IO访问数据通信。步骤1-5，基于接收的业务数据进行业务数据信息的防丢失封装存储转换处理，其中数据转换模块将业务数据的业务类型/IO接口/MQTT属性/时间以及校验等信息封装成指定存储格式，将存储内容实时保存到掉电数据存储区中防止丢失以便后续数据恢复。此后进入等待恢复供电状态。如图4所示，在一个具体的实施例中，终端恢复供电后进行业务恢复的处理过程包括步骤：步骤2-1，监控模块监测到硬件中断信号后判断是否上电。具体地，物联终端强电上电后，容器A中的监控模块检测到硬件中断信号；当物联终端恢复强电后，会产生硬件中断信号，容器A中的监控模块会实时监控硬件中断信号；容器A中的监控模块容器B中的交采程序发送MQTT消息来读取电源板A/B/C三相电压值；容器A中的监控模块在检测到硬件中断信号后，通过向容器B中的交采程序发送指定TOPIC的MQTT消息来请求读取电源板的A/B/C三相电压值，交采程序在收到该MQTT消息后，会将读取的A/B/C三相电压值通过MQTT消息发送给监控模块；容器A的监控模块收到交采返回的结果后，进行判断，符合三相电的电压的视为恢复供电；容器A中的监控模块收到容器B中的交采程序返回的MQTT消息后，进行判断，符合三相电电压的判定上电，其中三相电电压正常值为220v/220v/220v。容器A中的监控模块确认上电后，会向管理平台发送MQTT消息通知物联终端恢复供电。此后进入物联终端业务恢复的处理流程；监控模块会进入物联终端的业务恢复的处理流程，对于强电异常掉电情况下的业务、数据进行恢复等操作。步骤2-2，电容电量是否耗尽，物联终端设备的超级电容电量能提供大约3分钟的电量供终端上的接口模块、业务使用，电量耗尽后终端上电与电量耗尽前终端上电，这两种情况的处理流程有所不同；如果是，进入步骤2-7至2-8，否则进入步骤2-3至2-6；步骤2-3，监控模块通过MQTT上电TOPIC通知掉电关闭的接口模块重新RESET初始化外设芯片器件恢复正常IO数据通信状态；具体地，容器A中的监控模块向容器B中的掉电关闭的接口模块发送MQTT上电TOPIC消息，相关接口模块收到MQTT消息后，初始化外设芯片器件，使其恢复正常IO数据通信状态；比如重新初始化HPLC模块，使其能重新和电表组网并可以读取相关数据。步骤2-4，监控模块通过MQTT上电TOPIC通知容器B中的业务模块恢复IO访问的数据通信链路及业务；具体地，容器B中的业务模块在收到监控模块发出的MQTT上电TOPIC消息后，恢复IO访问的数据链路以及业务；比如重新启动698协议的业务，恢复698协议与主站之间的通信及数据链路。步骤2-5，监控模块通知数据转换模块恢复掉电历史数据内容到指定数据中心后进入线程睡眠并等待掉电后唤醒。具体地，监控模块通过指定TOPIC的MQTT消息通知数据转换模块恢复掉电期间的历史数据内容到指定数据中心，在恢复之前，还对历史数据内容进行二次校验，校验通过的数据内容才会存储到指定数据中心。完成恢复数据后，监控模块会删除临时的存储数据，存储掉电完成日志信息，之后进行线程睡眠，掉电会再次唤醒监控模块。步骤2-6，业务模块根据业务需要可以使用掉电中的业务历史相关数据内容信息并上报；业务模块比如一些不依赖强电运行环境的MODBUS等可以使用掉电存储的一些历史数据等内容上报到管理平台。若在超级电容耗尽电量之后恢复强电供电，进入以下步骤；步骤2-7，监控模块会检查掉电数据存储区，如果有掉电存储信息，会通知数据转换模块恢复掉电历史关键业务的相关数据内容到指定数据中心后，删除临时存储数据后线程睡眠并等待掉电后唤醒，如果没有掉电存储信息，监控模块会进行业务休眠，等待掉电中断事件唤醒；监控模块检查掉电数据存储区，如果检测到有掉电存储信息，则向数据转换模块发出指定TOPIC的MQTT消息使其恢复掉电历史关键业务的数据到指定数据中心，在这之后，监控模块会删除临时的存储数据，之后进行线程睡眠，掉电会再次唤醒监控模块；步骤2-8，业务模块根据业务需要使用掉电中的业务历史相关数据内容信息并上报；业务模块根据业务需要可以采集掉电中的业务历史相关数据内容信息，对一些不依赖强电运行环境的MODBUS等可以使用掉电存储的一些历史数据等内容上报到管理平台。
