标题title
一种球形金属标记的锥束CT金属伪影去除系统及去除方法
摘要abst
本发明提出了一种球形金属标记的锥束CT金属伪影去除系统及去除方法。属于锥束CT成像领域，包括二维投影图金属投影区域处理模块、金属投影筛选模块、三维重建模块及三维图像处理模块。其具体操作步骤如下：在投影图上搜索金属标记；根据金属坐标三维投影关系筛选金属标记点；处理投影图，通过利用投影周边信息填补获得无金属标记投影的二维投影图；利用处理后的投影图重建获得无金属标记与金属伪影的CT图；处理CT图添加金属标记部分获得完整的锥束CT图。本发明针对球形金属标记效率高，不易受噪声干扰。
权利要求书clms
1.一种球形金属标记的锥束CT金属伪影去除系统，其特征在于，包括二维投影图金属投影区域处理模块、金属投影筛选模块、三维重建模块及三维图像处理模块。2.根据权利要求1所述的一种球形金属标记的锥束CT金属伪影去除系统，其特征在于，所述的二维投影图金属投影区域处理模块是在二维投影图上获得分离的金属标记投影区域、区域中心和区域半径，并根据边缘像素值填充金属标记投影区域去除金属标记投影；该模块对外提供两个接口；所述金属投影筛选模块是根据多个投影图下的金属标记投影区域中心、半径以及投影角度对应的投影几何参数筛选出可行的金属标记投影区域；该模块对外提供一个接口；所述三维重建模块是基于投影图重建出三维CT图像；该模块对外提供一个接口；所述三维图像处理模块是基于金属标记坐标和半径在CT图像中增加金属标记的三维影像部分；该模块对外提供一个接口。3.如权利要求1-2所述的一种球形金属标记的锥束CT金属伪影去除系统的去除方法，其特征在于，具体操作步骤如下：、在投影图上初步筛选获得金属标记的投影区域；、根据各个投影图中金属投影区域的中心点、半径、结合投影图对应的投影几何信息筛选投影区域并获得金属标记物的三维坐标与三维半径；、针对每幅投影图，根据当前PI三维坐标，筛选出真金属投影区域之后利用区域边缘的像素信息填充到金属投影区域中，消除金属投影后进行反投影重建获得不含金属标记的锥束CT；、根据PS，在不含金属标记的锥束CT中，按照金属标记的参考CT值修改pi周围半径ri内的CT像素值，最终完成去除金属伪影的锥束CT重建过程。4.根据权利要求3所述的一种球形金属标记的锥束CT金属伪影去除系统的去除方法，其特征在于，在步骤中，所述在投影图上初步筛选获得金属标记的投影区域的具体操作步骤如下：、在不同角度得到的透视图上，通过阈值分割，获取像素值在整体图像像素值比例A内的像素位置，所述该比例A根据不同的应用不同，可根据金属标记的数量和金属标记的尺寸决定，该比例可通过式计算，其中，r表示金属标记的半径，R表示射野尺寸；、基于上述像素位置进行腐蚀膨胀计算获得互不连通的高透视密度区域，即金属标记投影区域的候选区域，、获得各透视图内各候选区域的中心点二维坐标集合PCS＝{PC1,PC2,…,PCn}，其中，pij表示第i个角度下投影图上第j个区域的中心点的二维坐标，rij表示第i个角度下投影图上第j个区域的半径。5.根据权利要求3所述的一种球形金属标记的锥束CT金属伪影去除系统的去除方法，其特征在于，在步骤中，所述根据各个投影图中金属投影区域的中心点、半径、结合投影图对应的投影几何信息筛选投影区域并获得金属标记物的三维坐标与三维半径的具体操作步骤如下：、取一幅已划分金属标记物的投影图i，已知该图中已预处理获得的金属标记区域是所有投影图中为最多；、取另一幅与i投影角度在30～60度之间的投影图j，对i中每个投影位置pik与X线源点形成的三维射线Rayi,k，遍历j中X线源点与候选金属投影点pil形成的射线Rayi,l，并计算获得各个交点Pi,k,m，其表示第m个与投影图i中第k个投影点射线的交点，将所有交点归并到一个集合PI＝{p1,p2,…,pn}＝{Pi,k,m}中；、对于每个pi∈PI，在各个投影图中测试是否有金属点投影射线Rayi,k与其相交，所述相交的判断通过pi与Rayi,k的最小距离小于误差ri来获得，假设Rayi,k的源点三维坐标是oi，投影点三维坐标是pi,k，则最小距离如超过阈值B的投影图中均有与pi相交的射线Rayi,k，则保留该金属点，否则从集合PI中删除该金属点位置，阈值B可作为参数在初始化时传入系统内；、遍历PI，根据投影区域的半径推算对应pk∈PI位置金属点的三维半径，该半径其中，poi表示源点在投影平面的垂直投影，sddi表示第i幅投影图的源图距，形成PS＝{,…,},pi∈PI。
说明书desc
技术领域本发明属于锥束CT成像领域，涉及一种球形金属标记的锥束CT金属伪影去除系统及其去除方法。背景技术锥束CT，即CBCT，指计算机根据锥形束投影图像重建获得三维断层影像的技术。传统扇形CT投影数据是一维的，二锥束CT投影数据是二维的，相比传统扇形CT，锥束CT可显著提高X线利用率，可加速数据的采集速度，并且具备更高的空间分辨力，已获得广泛的应用。常规X线透过金属等对X线具备较高阻挡能力的材料时会被吸收更多的低能X线光子，这种不成比例的吸收特性会形成条状金属伪影。金属伪影的存在会影像后续锥束CT影像的应用。目前针对锥束CT的金属伪影有双能扫描法、插值去除法、金属部分独立重建等方法。其中双能扫描法需要进行两次扫描，对于人体上的扫描应用会增加人体X线剂量；插值去除法和金属部分独立重建法是通用的金属伪影去除方法，其目标是完整重现不同形状的金属部分；本发明的金属伪影去除方法是根据无尺寸限制的球形金属标记的特点发展出来的，具有速度快，金属标记位置准确度高的特点，适用于需植入球形金标的场景中。发明内容发明目的：本发明的目的是提供了一种球形金属标记的锥束CT金属伪影去除系统及其去除方法。技术方案：本发明所述的一种球形金属标记的锥束CT金属伪影去除系统，包括二维投影图金属投影区域处理模块、金属投影筛选模块、三维重建模块及三维图像处理模块。进一步的，所述的二维投影图金属投影区域处理模块，是在二维投影图上获得分离的金属标记投影区域、区域中心和区域半径，并根据边缘像素值填充金属标记投影区域去除金属标记投影；该模块对外提供两个接口；所述金属投影筛选模块是根据多个投影图下的金属标记投影区域中心、半径以及投影角度对应的投影几何参数筛选出可行的金属标记投影区域；该模块对外提供一个接口；所述三维重建模块是基于投影图重建出三维CT图像；该模块对外提供一个接口；所述三维图像处理模块是基于金属标记坐标和半径在CT图像中增加金属标记的三维影像部分；该模块对外提供一个接口。进一步的，一种球形金属标记的锥束CT金属伪影去除系统的去除方法，其特征在于，具体操作步骤如下：、在投影图上初步筛选获得金属标记的投影区域；、根据各个投影图中金属投影区域的中心点、半径、结合投影图对应的投影几何信息筛选投影区域并获得金属标记物的三维坐标与三维半径；、针对每幅投影图，根据当前PI三维坐标，筛选出真金属投影区域之后利用区域边缘的像素信息填充到金属投影区域中，消除金属投影后进行反投影重建获得不含金属标记的锥束CT；、根据PS，在不含金属标记的锥束CT中，按照金属标记的参考CT值修改pi周围半径ri内的CT像素值，最终完成去除金属伪影的锥束CT重建过程。进一步的，在步骤中，所述在投影图上初步筛选获得金属标记的投影区域的具体操作步骤如下：、在不同角度得到的透视图上，通过阈值分割，获取像素值在整体图像像素值比例A以内的像素位置，像素值比例A根据不同的应用不同，可根据金属标记的数量和金属标记的尺寸决定，该比例可通过式计算，其中，r表示金属标记的半径，R表示射野尺寸；、基于上述像素位置进行腐蚀膨胀计算获得互不连通的高透视密度区域，即金属标记投影区域的候选区域，、获得各透视图内各候选区域的中心点二维坐标集合PCS＝{PC1,PC2,…,PCn}，其中，pij表示第i个角度下投影图上第j个区域的中心点的二维坐标，rij表示第i个角度下投影图上第j个区域的半径。进一步的，在步骤中，所述根据各个投影图中金属投影区域的中心点、半径、结合投影图对应的投影几何信息筛选投影区域并获得金属标记物的三维坐标与三维半径的具体操作步骤如下：、取一幅已划分金属标记物的投影图i，已知该图中已预处理获得的金属标记区域是所有投影图中为最多；、取另一幅与i投影角度在30～60度之间的投影图j，对i中每个投影位置pik与X线源点形成的三维射线Rayi,k，遍历j中X线源点与候选金属投影点pil形成的射线Rayi,l，并计算获得各个交点Pi,k,m，表示第m个与投影图i中第k个投影点射线的交点，将所有这些交点归并到一个集合PI＝{p1,p2,…,pn}＝{Pi，k，m}中；、对于每个pi∈PI，在各个投影图中测试是否有金属点投影射线Rayi,k与其相交，此处相交的判断通过pi与Rayi,k的最小距离小于误差ri来获得，假设Rayi，k的源点三维坐标是oi，投影点三维坐标是pi，k，则最小距离如超过阈值B的投影图中均有与pi相交的射线Rayi,k，则保留该金属点，否则从集合PI中删除该金属点位置，阈值B可作为参数在初始化时传入系统内；、遍历PI，根据投影区域的半径推算对应pk∈PI位置金属点的三维半径，该半径其中，poi是源点在投影平面的垂直投影，sddi表示第i幅投影图的源图距，形成PS＝{,…,},pi∈PI。有益效果：本发明与现有技术相比，本发明在投影图上搜索金属标记；根据金属坐标三维投影关系筛选金属标记点；处理投影图，通过利用投影周边信息填补获得无金属标记投影的二维投影图；利用处理后的投影图重建获得无金属标记与金属伪影的CT图；处理CT图添加金属标记部分获得完整的锥束CT图。本发明针对球形金属标记效率高，不易受噪声干扰。附图说明图1是本发明的操作流程图。具体实施方式下面结合附图对本发明作进一步描述。以下实施例仅用于更加清楚地说明本发明的技术方案，而不能以此来限制本发明的保护范围。如图1所述，本发明所述的一种球形金属标记的锥束CT金属伪影去除系统，包括二维投影图金属投影区域处理模块、金属投影筛选模块、三维重建模块及三维图像处理模块。进一步的，所述的二维投影图金属投影区域处理模块，是在二维投影图上获得分离的金属标记投影区域、区域中心和区域半径，并根据边缘像素值填充金属标记投影区域去除金属标记投影；该模块对外提供两个接口；接口1：提供金属标记投影区分离功能，输入为投影图，投影图包含图像素信息和这些像素在投影图二维坐标系下的几何信息，几何信息包括图中第一行第一列的二维坐标、图中像素的行列间距；输出为金属标记区域信息的列表，其中每一个金属标记区域包含区域中心二维坐标和区域半径；接口2：提供根据边缘像素值填充金属标记投影区域去除金属标记投影功能，输入为投影图和金属标记区域信息的列表，两者的详细信息参考接口1，输出为处理后的投影图；所述金属投影筛选模块；是根据多个投影图下的金属标记投影区域中心、半径以及投影角度对应的投影几何参数筛选出可行的金属标记投影区域；该模块对外提供一个接口；该接口输入为按投影图组织的金属标记区域几何双层列表，列表中每一项是一个投影图的金属标记区域信息的列表，每一个金属标记区域包含区域中心二维坐标和区域半径；输出三维金属标记列表和筛选后的按投影图组织的金属标记区域几何双层列表，其中三维金属标记列表中每一项包括金属标记中心三维坐标和金属标记半径；所述三维重建模块是基于投影图重建出三维CT图像；该模块对外提供一个接口；该接口输入为处理后的含几何信息的投影图列表，其中每一项为投影图本身和对应的投影几何信息，投影几何信息包括源在世界坐标系下的三维坐标、投影图平板的起点三维坐标，投影图平板的行、列三维方向向量；输出为重建后的三维图像；所述三维图像处理模块，是基于金属标记坐标和半径在CT图像中增加金属标记的三维影像部分；该模块提供1个接口，该接口的输入为三维金属标记列表、三维图像、金属标记CT值，输出为在金属标记位置更新了像素值为输入值的三维图像。进一步的，一种球形金属标记的锥束CT金属伪影去除系统的去除方法，其特征在于，具体操作步骤如下：、在投影图上初步筛选获得金属标记的投影区域；、根据各个投影图中金属投影区域的中心点、半径、结合投影图对应的投影几何信息筛选投影区域并获得金属标记物的三维坐标与三维半径；、其中，针对每幅投影图，根据当前PI三维坐标，筛选出真金属投影区域之后利用区域边缘的像素信息填充到金属投影区域中，消除金属投影后进行反投影重建获得不含金属标记的锥束CT，这里的反投影重建算法即通用的的反投影重建算法，如FDK反投影算法等；、根据PS，在不含金属标记的锥束CT中，按照金属标记的参考CT值修改pi周围半径ri内的CT像素值，最终完成去除金属伪影的锥束CT重建过程。进一步的，在步骤中，所述在投影图上初步筛选获得金属标记的投影区域的具体操作步骤如下：、在不同角度得到的一系列透视图上，通过阈值分割，获取像素值在一定比例A以内的像素位置，像素值比例A根据不同的应用不同，可根据金属标记的数量和金属标记的尺寸决定，该比例可通过式计算，其中，r表示金属标记的半径，R表示射野尺寸；在具体实施时可设置A为1％以下；、基于上述像素位置进行腐蚀膨胀计算获得互不连通的高透视密度区域，即金属标记投影区域的候选区域，腐蚀膨胀算子的停止条件是像素处像素值梯度大于一定阈值，该阈值可根据实际情况调整，使联通区域的尺寸不超过整体的2A比例；、获得各透视图内各候选区域的中心点二维坐标集合PCS＝{PC1，PC2，…，PCn}，其中，pij表示第i个角度下投影图上第j个区域的中心点的二维坐标，rij表示第i个角度下投影图上第j个区域的半径；该步骤下，可通过像素值加权和方式得到区域的中心，即其中，表示区域内像素坐标，P表示投射线经过物质阻止本领的像素值；根据像素数得到区域的面积s，通过获得区域半径；进一步的，在步骤中，所述根据各个投影图中金属投影区域的中心点、半径、结合投影图对应的投影几何信息筛选投影区域并获得金属标记物的三维坐标与三维半径的具体操作步骤如下：、取一幅已划分金属标记物的投影图i，已知该图中已预处理获得的金属标记区域是所有投影图中为最多；、取另一幅与i投影角度在30～60度之间的投影图j，对i中每个投影位置pik与X线源点形成的三维射线Rayi,k，遍历j中X线源点与候选金属投影点pil形成的射线Rayi,l，并计算获得各个交点Pi,k,m，表示第m个与投影图i中第k个投影点射线的交点，将所有这些交点归并到一个集合PI＝{p1,p2,…,pn}＝{Pi,k,m}中；、对于每个pi∈PI，在各个投影图中测试是否有金属点投影射线Rayi,k与其相交，此处相交的判断通过pi与Rayi,k的最小距离小于误差ri来获得，假设Rayi,k的源点三维坐标是oi，投影点三维坐标是pi,k，则最小距离如超过阈值B的投影图中均有与pi相交的射线Rayi,k，则保留该金属点，否则从集合PI中删除该金属点位置，阈值B可作为参数在初始化时传入系统内；、遍历PI，根据投影区域的半径推算对应pk∈PI位置金属点的三维半径，该半径其中，poi是源点在投影平面的垂直投影，sddi表示第i幅投影图的源图距，形成PS＝{,…,},pi∈PI。以上所述，仅为本发明的具体实施方式，但本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，可轻易想到变化或替换，都应涵盖在本发明的保护范围之内。因此，本发明的保护范围应以所述权利要求的保护范围为准。
