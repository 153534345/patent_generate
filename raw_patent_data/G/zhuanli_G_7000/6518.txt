标题title
一种虚拟屏互联界面控件的自动化测试方法及系统
摘要abst
本发明所涉及的一种互联互联虚拟屏界面控件的自动化测试方法，包括如下步骤：S100搭建自动化测试环境，计算机终端安装自动化测试框架、车载端模拟控制器；S200移动终端和计算机终端建立互联通道，移动终端创建虚拟屏，虚拟屏上的界面投屏至车载端模拟控制器显示；自动化测试框架与移动终端建立控制通道；S300通过递归循环算法，深度遍历查询并模拟点击界面所有可操作、但未操作的控件，将执行结果存入数据库中；S500记录测试结果，根据数据库中存储的执行结果，查询出测试未通过的流程，写入APP运行日志中。本发明可以自动遍历互联界面及界面上的控件，与具体业务无关，无须测试人员手工操作，有效提高了测试效率。
权利要求书clms
1.一种虚拟屏互联界面控件的自动化测试方法，其特征在于，包括如下步骤：S100 搭建自动化测试环境计算机终端安装自动化测试框架、车载端模拟控制器；S200 移动终端和计算机终端建立互联通道，移动终端创建虚拟屏，虚拟屏上的界面投屏至车载端模拟控制器显示；自动化测试框架与移动终端建立控制通道；S300通过递归循环算法，深度遍历查询并模拟操作界面上所有可见、可操作控件，将控件信息存入数据库中；S500 记录测试结果根据数据库中存储的执行结果，查询测试未通过的流程，写入APP运行日志中；所述步骤S300包括如下步骤：S301开始，进入当前界面S302遍历获取当前界面的控件列表，将控件信息保存到数据库中；S303 查询当前界面是否存在可见、可操作、但未操作的控件，若存在，则进入步骤S304，若不存在，则进入步骤S305；S304模拟操作，模拟操作其中一个可见、可操作、但未操作的控件，更新控件信息，进入子界面，进行下一层递归；S305 判断本层界面所有控件是否操作完毕，即判断本层界面是否存在可操作、但未操作的控件；若是则进入S306，若否，则返回S304；S306退出本层递归，返回至上一级界面继续操作执行，直至界面上的所有可见、可操作、未操作控件全部执行完毕；S307每层界面操作执行，直至顶层界面的所有可见、可操作、未操作控件全部执行完毕，则递归循环完成。2.一种如权利要求1所述的虚拟屏互联界面控件的自动化测试方法，其特征在于，所述步骤S300中，在每次进入新界面前，进行界面循环转跳识别，若识别为循环转跳，则跳出当前界面循环，若否，则继续进入新界面。3.一种如权利要求2所述的虚拟屏互联界面控件的自动化测试方法，其特征在于，所述界面循环转跳识别包括：在加入新的模拟点击事件路径时，判断此路径添加后，跟前面的某个步骤完全重复，若完全重复，则判断为界面循环转跳。4.一种如权利要求1所述的虚拟屏互联界面控件的自动化测试方法，其特征在于，在所述步骤S300之后还包括步骤S400补漏查询，所述步骤S400包括如下步骤：S401恢复初始化环境，S402判断数据库中是否存在可操作、但未操作的控件，若是则进入S403，若否则进入S404；S403根据当前界面操作步骤进入复现环境，依次对所有可操作、但未操作的控件进行模拟操作，更新数据库中的控件信息；S404跳出补漏环节。5.一种如权利要求1所述的虚拟屏互联界面控件的自动化测试方法，其特征在于，所述控件信息包括：控件ID、是否已点击、所属当前页面、二次进入是否可见、当前界面进入操作步骤。6.一种如权利要求5所述的虚拟屏互联界面控件的自动化测试方法，其特征在于，模拟操作后，控件信息中的“是否已操作”状态更新为“已操作”。7.一种如权利要求1所述的虚拟屏互联界面控件的自动化测试方法，其特征在于，在所述步骤S300中，所述模拟操作包括模拟点击、模拟滑动。8.一种虚拟屏互联界面控件的自动化测试系统，其特征在于，包括移动终端和计算机终端，移动终端和计算机终端之间建立互联通道；移动终端包括显示屏及虚拟屏，虚拟屏连接显示屏；计算机终端包括自动化测试框架、车载终端模拟器及存储模块，所述自动化测试框架连接虚拟屏、车载终端模拟器、自动化测试脚本模块，自动化测试脚本模块连接车载终端模拟器；自动化测试框架与虚拟屏之间建立控制通道；所述自动化测试框架查询车载终端模拟控制器界面上的所有可见、可操作的控件，搜索到的对应控件信息保存至存储模块的数据库中；自动化测试框架在存储模块的数据库中查询所有可操作、但未操作的控件，车载终端模拟控制器通过控制通道发送控制信号至虚拟屏，虚拟屏上的控件响应操作并通过互联通道传输操作更新后的控件信息保存至存储模块的数据库中。9.一种如权利要求6所述的虚拟屏互联界面控件的自动化测试系统，其特征在于，所述自动化测试框架在数据库中查询可操作、但未操作过的控件，自动化测试框架通过控制通道输出控制信号至车载终端模拟控制器，车载终端模拟控制器根据控制信号操作当前页面并通过互联通道传输模拟点击命令至移动终端的虚拟屏，虚拟屏执行模拟操作命令。10.一种如权利要求7所述的虚拟屏互联界面控件的自动化测试系统，其特征在于，所述虚拟屏执行模拟操作命令，自动化测试框架根据变化后页面的控件参数更新数据库中的控件信息。
说明书desc
技术领域本发明涉及手机互联技术领域，具体地指一种虚拟屏互联界面控件的自动化测试方法及系统。背景技术随着车联网行业的发展，手机互联正成为一种低成本高效的车联网解决方案，其中，以手机屏幕映射的方案应用最为广泛。屏幕映射，是指将手机的屏幕内容投射到车载导航仪屏幕，从而将本在手机屏幕上运行的功能展现在车载导航仪屏幕的一种技术。反控，是指在车载屏幕上操作界面，手机上界面发生对应变化的一种技术。由于虚拟屏互联界面没有显示在手机主屏，现有的自动化测试框架都是针对手机主屏，因此现有的互联自动化测试框架都需要测试人员提前编写好测试脚本，这就使得该测试对测试人员的依赖性比较大，测试效率低。发明内容本发明的目的就是要提供一种无需人工根据业务模块逐个编写自动化脚本，测试效率高的虚拟屏互联界面控件的自动化测试方法及系统。为实现此目的，本发明所涉及的一种虚拟屏互联界面控件的自动化测试方法，包括如下步骤：S100 搭建自动化测试环境计算机终端安装自动化测试框架、车载端模拟控制器；S200 移动终端和计算机终端建立互联通道，移动终端创建虚拟屏，虚拟屏上的界面投屏至车载端模拟控制器显示；自动化测试框架与移动终端建立控制通道；S300通过递归循环算法，深度遍历查询并模拟操作界面上所有可见、可操作控件，将控件信息存入数据库中；S500 记录测试结果根据数据库中存储的执行结果，查询测试未通过的流程，写入APP运行日志中；流程结束后，测试人员可以导出app运行日志、闪退等日志查看自动化测试结果。所述步骤S300包括如下步骤：S301开始，进入当前界面；S302遍历获取当前界面的控件列表，将控件信息保存到数据库中；S303 查询当前界面是否存在可见、可操作、但未操作的控件，若存在，则进入步骤S304，若不存在，则进入步骤S305；S304模拟操作，模拟操作其中一个可见、可操作、但未操作的控件，更新控件信息到数据库，进入子界面，进行下一层递归；S305 判断本层界面所有控件是否操作完毕，即判断本层界面是否存在可操作、但未操作的控件；若是则进入S306，若否，则返回S304；S306退出本层递归，返回至上一级界面继续操作执行，直至界面上的所有可见、可操作、未操作控件全部执行完毕；S307每层界面操作执行，直至顶层界面的所有可见、可操作、未操作控件全部执行完毕，则递归循环完成。进一步，所述步骤S300中，在每次进入新界面前，进行界面循环转跳识别，若识别为循环转跳，则跳出当前界面循环，若否，则继续进入新界面。进一步，所述界面循环转跳识别包括：在加入新的模拟操作事件路径时，判断此路径添加后，跟前面的某个步骤完全重复，若完全重复，则判断为界面循环转跳。进一步，在所述步骤S300之后还包括步骤S400补漏查询，所述步骤S400包括如下步骤：S401恢复初始化环境；S402判断数据库中是否存在可操作、但未操作的控件，若是则进入S403，若否则进入S404；S403根据当前界面操作步骤进入复现环境，依次对所有可操作、但未操作的控件进行模拟操作，更新数据库中的控件信息；S404跳出补漏环节。进一步，所述控件信息包括：控件ID、是否已操作、所属当前页面、二次进入是否可见、当前界面进入操作步骤。进一步，模拟操作后，控件信息中的“是否已操作”状态更新为“已操作”。进一步，所述模拟操作包括模拟点击、模拟滑动。一种虚拟屏互联界面控件的自动化测试系统，包括移动终端和计算机终端，移动终端和计算机终端之间建立互联通道；移动终端包括显示屏及虚拟屏，虚拟屏连接显示屏；计算机终端包括自动化测试框架、车载终端模拟器及存储模块，所述自动化测试框架连接虚拟屏、车载终端模拟器、自动化测试脚本模块，自动化测试脚本模块连接车载终端模拟器；自动化测试框架与虚拟屏之间建立控制通道；所述自动化测试框架查询车载终端模拟控制器界面上的所有可见、可操作的控件，搜索到的对应控件信息保存至存储模块的数据库中；自动化测试框架在存储模块的数据库中查询所有可操作、但未操作的控件，车载终端模拟控制器通过控制通道发送控制信号至虚拟屏，虚拟屏上的控件响应操作并通过互联通道传输操作更新后的控件信息保存至存储模块的数据库中。进一步，所述自动化测试框架在数据库中查询可操作、但未操作过的控件，自动化测试框架通过控制通道输出控制信号至车载终端模拟控制器，车载终端模拟控制器根据控制信号操作当前页面并通过互联通道传输模拟操作命令至移动终端的虚拟屏，虚拟屏执行模拟操作命令。进一步，所述虚拟屏执行模拟操作命令，自动化测试框架根据变化后页面的控件参数更新数据库中的控件信息。本发明虚拟屏互联界面控件的自动化测试方法及系统，深度遍历的自动化脚本编写完成后，可以自动遍历互联界面及界面上的控件，与具体业务无关，无须测试人员手工操作，有效提高了测试效率。移动终端和计算机终端建立互联通道，自动化测试框架与移动终端建立控制通道，无需移动终端和车载多媒体互联，不受硬件和测试场景的限制，不依靠人工测试虚拟屏，节约了测试的成本。附图说明图1为本发明虚拟屏互联界面控件的自动化测试方法的流程图；图2为本发明虚拟屏互联界面控件的自动化测试方法中步骤S300的流程图；图3为本发明虚拟屏互联界面控件的自动化测试方法中控件信息示意图；图4为本发明虚拟屏互联界面控件的自动化测试方法另一实施例的流程图；图5为本发明虚拟屏互联界面控件的自动化测试方法中步骤S400的流程图；图6为本发明虚拟屏互联界面控件的自动化测试系统的原理图。具体实施方式本发明一种虚拟屏互联界面控件的自动化测试方法与系统，可以自动遍历界面上的控件，并自动生成脚本进行测试。以下结合附图和具体实施例对本发明作进一步的详细说明：请参阅图1至图5，一种虚拟屏互联界面控件的自动化测试方法包括如下步骤：S100 搭建自动化测试环境计算机终端安装自动化测试框架、车载端模拟控制器；具体的，计算机终端安装的为Python测试框架，车载端模拟控制器为 ECTest模拟控制器，负责投射手机虚拟屏的界面显示及反控。S200移动终端和计算机终端建立互联通道，移动终端创建虚拟屏，虚拟屏上的界面投屏至车载端模拟控制器进行显示；自动化测试框架与移动终端建立控制通道。移动终端可以通过USB连接电脑，或者使用WiFi连接电脑，然后与计算机终端上的车载端模拟器建立互联通道，自动化测试框架与移动端的虚拟屏建立控制通道，当移动终端为安卓系统时，USB连接时，自动化测试框架通过ADB与虚拟屏建立控制通道。安卓系统中使用API调用CreateVirtualDisplay接口创建虚拟显示屏。IOS系统中使用API调用initWithFrame:.bounds]接口创建虚拟显示屏。移动终端的屏幕与虚拟屏独立显示。所述移动终端预先装有移动终端互联应用，所述计算机终端内预先装有车载互联应用。所述移动终端互联应用为市面上常见的互联客户端，如我司的亿连驾驶助手APP、驾驶伴侣APP等；所述车载互联应用为市面上常见的互联服务端。S300通过递归循环算法，深度遍历查询并模拟操作界面上所有可见、可操作的控件，将控件信息存入数据库中。S500 记录测试结果根据数据库中存储的执行结果，查询测试未通过的流程，写入APP运行日志中，方便后续导出查看。如图2所示，步骤S300包括如下步骤：S301开始，进入当前界面S302遍历获取当前界面的控件列表，将控件信息保存到数据库中；S303 查询当前界面是否存在可见、可操作、但未操作的控件，若存在，则进入步骤S304，若不存在，则进入步骤S305；S304模拟操作模拟操作其中一个可见、可操作、但未操作的控件，更新控件信息，进入子界面，进行下一层递归；所述模拟操作包括模拟点击、模拟滑动。S305 判断本层界面所有控件是否操作完毕，即判断本层界面是否存在可操作、但未操作的控件；若是则进入S306，若否，则返回S304；S306退出本层递归，返回至上一级界面继续操作执行，直至界面上的所有可见、可操作、未操作控件全部执行完毕；S307每层界面操作执行，直至顶层界面的所有可见、可操作、未操作控件全部执行完毕，则递归循环完成。具体的，在上述模拟操作中，若操作不成功，则在APP运行日志中记录不通过的流程。进一步，如图3所示，步骤S302中所述的控件信息包括：控件ID、是否已操作、所属当前页面、二次进入是否可见、当前界面进入操作步骤、控件用途等信息。为了更好的实现递归循环算法，所述页面的控件ID不重复， 即每个页面里面所有可操作控件的ID全局不重复。为了避免当界面存在循环转跳时，递归循环算法无法跳出结束，所属步骤S300中，还包括界面循环转跳识别步骤，即判断前页面的操作步骤是不是存在循环，循环转跳识别方法为：在加入新的模拟操作事件路径时，判断此路径添加后，跟前面的某个步骤完全重复，若完全重复，则判断为界面循环转跳，若判断为界面循环转跳，则跳出循环。每次进入新界面前，均会进行界面循环转跳识别。如图4及图5所示，为了防止漏检，在步骤S300之后还包括步骤S400补漏环节，步骤S400包括如下步骤：S401恢复初始化环境，即恢复至APP初次使用时的界面及状态；S402判断数据库中是否存在可操作、但未操作的控件，若是则进入S403，若否则进入S404；S403根据当前界面操作步骤进入复现环境，依次对所有可操作、但未操作的控件进行模拟操作，更新数据库中的控件信息；S404跳出补漏环节。在数据库中查询可操作、但未操作过的控件，车载端模拟控制器模拟操作本步骤中查询到的控件，模拟操作后更新控件信息。模拟操作后，控件信息中的“是否已操作”状态更新为“已操作”。请参阅图6，一种虚拟屏互联界面控件的自动化测试系统，包括移动终端1和计算机终端2，移动终端1和计算机终端2之间建立互联通道。所述移动终端1为智能手机或平板，所述计算机终端2为电脑。移动终端1包括显示屏11、虚拟屏12，虚拟屏12连接显示屏11，显示屏11与虚拟屏12独立显示。计算机终端2包括自动化测试框架21、车载终端模拟器22及存储模块23。所述自动化测试框架21连接虚拟屏12、车载终端模拟控制器22、存储模块23。自动化测试框架21与虚拟屏12之间建立控制通道。实现自动化测试框架21通过移动终端互联通讯协议pxClient，负责移动终端虚拟屏和车载多媒体终端之间的数据传输。车载终端模拟器22与移动终端1之间通过USB或Wifi建立互联通道。虚拟屏12通过互联通道将页面投屏至车载终端模拟控制器22上显示。自动化测试框架21查询车载终端模拟控制器22界面上的所有可见、可操作的控件，搜索到的对应控件信息保存至存储模块23的数据库中。所述自动化测试框架21在存储模块23数据库中查询可操作、但未操作过的控件，自动化测试框架21通过控制通道输出控制信号至车载终端模拟控制器22，车载终端模拟控制器22根据控制信号操作当前页面并通过互联通道传输模拟操作命令至移动终端1的虚拟屏12，虚拟屏12执行模拟操作命令，虚拟屏12上的控件响应操作并通过互联通道传输操作更新后的控件信息保存至存储模块23的数据库中。进一步，为了保证查询的准确率，自动化测试框架21对数据库中的控件进行补漏查询，具体为：自动化测试框架21恢复初始化环境，自动化测试框架21从存储模块23的数据库中查询第一个可操作、但未操作的控件，自动化测试框架21实现复现环境，车载终端模拟控制器22操作检索到的可操作、但未操作的控件，操作更新后的控件信息保存至存储模块23的数据库中。进一步，当移动终端1为安卓系统时，自动化测试框架21连接显示屏11，实现自动化测试框架21对显示屏11的控制。具体的，自动化测试框架21通过UI测试工具Uiautomator实现对显示屏11的控制。本发明虚拟屏互联界面控件的自动化测试方法与系统，深度遍历的自动化脚本编写完成后，可以自动遍历互联界面及界面上的控件，与具体业务无关，无须测试人员手工操作，完全可脱离人工，就能对车载端模拟控制器上投射的虚拟屏进行控件自动查询和根据坐标反控的自动化测试，有效提高了测试效率。同时，移动终端和计算机终端建立互联通道，自动化测试框架与移动终端建立控制通道，无需移动终端和车载多媒体互联，不受硬件和测试场景的限制，不依靠人工测试虚拟屏，节约了测试的成本。
