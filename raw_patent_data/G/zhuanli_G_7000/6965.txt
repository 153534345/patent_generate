标题title
检验程序稳定性的方法、装置、计算设备及存储介质
摘要abst
本发明提供了一种检验程序稳定性的方法、装置、计算设备及存储介质，其中方法包括：确定待检验的流量解析程序在指定周期的执行过程，该指定周期的执行过程至少包括：该流量解析程序读取网卡的接收环、该流量解析程序访问流量报文的协议数据地址；根据预设的检验逻辑判断该指定周期的执行过程，以确定该流量解析程序是否稳定。本方案，能够实现对流量解析程序是否稳定的检验。
权利要求书clms
1.一种检验程序稳定性的方法，其特征在于，包括：确定待检验的流量解析程序在指定周期的执行过程，所述指定周期的执行过程至少包括：所述流量解析程序读取网卡的接收环、所述流量解析程序访问流量报文的协议数据地址；根据预设的检验逻辑判断所述指定周期的执行过程，以确定所述流量解析程序是否稳定。2.根据权利要求1所述的方法，其特征在于，所述确定待检验的流量解析程序在指定周期的执行过程，包括：响应于检测到所述流量解析程序访问内存地址触发的页缺失错误，且响应于检测到所述网卡的接收环包括所述内存地址，确定所述流量解析程序读取所述网卡的接收环。3.根据权利要求2所述的方法，其特征在于，在所述确定所述流量解析程序读取所述网卡的接收环之前，还包括：确定所述网卡的接收环所对应的内存页；所述内存页中包括若干个内存地址；将所述内存页所对应访问属性的P flag参数值修改为第一设定值，基于该第一设定值控制所述流量解析程序在访问所述内存页中的任意一个内存地址时则触发页缺失错误。4.根据权利要求3所述的方法，其特征在于，在所述检测到所述流量解析程序访问内存地址触发的页缺失错误之前，还包括：确定触发页缺失错误的程序是否为所述流量解析程序，若是，则确定所述流量解析程序访问内存地址触发页缺失错误；和/或，在所述确定所述流量解析程序读取所述网卡的接收环之后，还包括：将所述内存页所对应访问属性的P flag参数值修改为第二设定值，以触发所述流量解析程序执行所述读取所述网卡的接收环。5.根据权利要求1所述的方法，其特征在于，所述确定待检验的流量解析程序在指定周期的执行过程，包括：在所述流量解析程序读取网卡的接收环之后，在所述流量解析程序访问所述流量报文的协议数据地址之前，响应于检测到所述流量解析程序触发的调试异常事件，确定所述调试异常事件对应的执行过程。6.根据权利要求5所述的方法，其特征在于，在检测到所述流量解析程序触发的调试异常事件之前，还包括：确定所述流量解析程序在所述指定周期的每个执行过程分别对应的陷阱标志位，将每个陷阱标志位的参数值均修改为第三设定值，以使所述流量解析程序能够触发调试异常事件。7.根据权利要求1-6中任一所述的方法，其特征在于，所述根据预设的检验逻辑判断所述指定周期的执行过程，以确定所述流量解析程序是否稳定，包括：检验所述流量解析程序从读取网卡的接收环至访问所述流量报文的协议数据地址之间是否执行与流量报文相关的比较操作，若是，则确定所述流量解析程序稳定。8.一种检验程序稳定性的装置，其特征在于，包括：执行过程确定单元，用于确定待检验的流量解析程序在指定周期的执行过程，所述指定周期的执行过程至少包括：所述流量解析程序读取网卡的接收环、所述流量解析程序访问流量报文的协议数据地址；稳定性判断单元，用于根据预设的检验逻辑判断所述指定周期的执行过程，以确定所述流量解析程序是否稳定。9.一种计算设备，包括存储器和处理器，所述存储器中存储有计算机程序，所述处理器执行所述计算机程序时，实现如权利要求1-7中任一项所述的方法。10.一种计算机可读存储介质，其上存储有计算机程序，当所述计算机程序在计算机中执行时，令计算机执行权利要求1-7中任一项所述的方法。
说明书desc
技术领域本发明实施例涉及软件技术领域，特别涉及一种检验程序稳定性的方法、 装置、计算设备及存储介质。背景技术在网络中传输的流量报文需要遵循一些协议，比如，IP协议、TCP协议 等。遵循这些协议的流量报文一般包括两个部分：协议头和协议数据。其中， 协议头中具有该协议头的长度字段。流量解析程序可以从流量报文的协议头 中解析得到协议头长度，然后根据该协议头长度确定出协议数据地址，并利 用该协议数据地址读取协议数据。发明内容基于流量解析程序由于未对流量报文执行越界判断而造成稳定性较差的 问题，本发明实施例提供了一种检验程序稳定性的方法、装置、计算设备及 存储介质，能够实现对流量解析程序是否稳定的检验。第一方面，本发明实施例提供了一种检验程序稳定性的方法，包括：确定待检验的流量解析程序在指定周期的执行过程，所述指定周期的执 行过程至少包括：所述流量解析程序读取网卡的接收环、所述流量解析程序 访问流量报文的协议数据地址；根据预设的检验逻辑判断所述指定周期的执行过程，以确定所述流量解 析程序是否稳定。优选地，所述确定待检验的流量解析程序在指定周期的执行过程，包括：响应于检测到所述流量解析程序访问内存地址触发的页缺失错误，且响 应于检测到所述网卡的接收环包括所述内存地址，确定所述流量解析程序读 取所述网卡的接收环。优选地，在所述确定所述流量解析程序读取所述网卡的接收环之前，还 包括：确定所述网卡的接收环所对应的内存页；所述内存页中包括若干个内存 地址；将所述内存页所对应访问属性的P flag参数值修改为第一设定值，基于 该第一设定值控制所述流量解析程序在访问所述内存页中的任意一个内存地 址时则触发页缺失错误。优选地，在所述检测到所述流量解析程序访问内存地址触发的页缺失错 误之前，还包括：确定触发页缺失错误的程序是否为所述流量解析程序，若 是，则确定所述流量解析程序访问内存地址触发页缺失错误；和/或，在所述确定所述流量解析程序读取所述网卡的接收环之后，还包括：将 所述内存页所对应访问属性的P flag参数值修改为第二设定值，以触发所述 流量解析程序执行所述读取所述网卡的接收环。优选地，所述确定待检验的流量解析程序在指定周期的执行过程，包括：在所述流量解析程序读取网卡的接收环之后，在所述流量解析程序访问 所述流量报文的协议数据地址之前，响应于检测到所述流量解析程序触发的 调试异常事件，确定所述调试异常事件对应的执行过程。优选地，在检测到所述流量解析程序触发的调试异常事件之前，还包括：确定所述流量解析程序在所述指定周期的每个执行过程分别对应的陷阱 标志位，将每个陷阱标志位的参数值均修改为第三设定值，以使所述流量解 析程序能够触发调试异常事件。优选地，所述根据预设的检验逻辑判断所述指定周期的执行过程，以确 定所述流量解析程序是否稳定，包括：检验所述流量解析程序从读取网卡的接收环至访问所述流量报文的协议 数据地址之间是否执行与流量报文相关的比较操作，若是，则确定所述流量 解析程序稳定。第二方面，本发明实施例还提供了一种检验程序稳定性的装置，包括：执行过程确定单元，用于确定待检验的流量解析程序在指定周期的执行 过程，所述指定周期的执行过程至少包括：所述流量解析程序读取网卡的接 收环、所述流量解析程序访问流量报文的协议数据地址；稳定性判断单元，用于根据预设的检验逻辑判断所述指定周期的执行过 程，以确定所述流量解析程序是否稳定。第三方面，本发明实施例还提供了一种计算设备，包括存储器和处理器， 所述存储器中存储有计算机程序，所述处理器执行所述计算机程序时，实现 本说明书任一实施例所述的方法。第四方面，本发明实施例还提供了一种计算机可读存储介质，其上存储 有计算机程序，当所述计算机程序在计算机中执行时，令计算机执行本说明 书任一实施例所述的方法。本发明实施例提供了一种检验程序稳定性的方法、装置、计算设备及存 储介质，流量解析程序是否稳定，需要判断流量解析程序在访问流量报文的 协议数据地址之前是否对流量报文进行越界判断，因此本实施例中通过预设 的检验逻辑对流量解析程序在指定周期的执行过程进行判断，以确定流量解 析程序是否稳定，可见本方案能够实现对流量解析程序是否稳定的检验。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实 施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面 描述中的附图是本发明的一些实施例，对于本领域普通技术人员来讲，在不 付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明一实施例提供的一种检验程序稳定性的方法流程图；图2是本发明一实施例提供的一种计算设备的硬件架构图；图3是本发明一实施例提供的一种检验程序稳定性的装置结构图；图4是本发明一实施例提供的另一种检验程序稳定性的装置结构图；图5是本发明一实施例提供的又一种检验程序稳定性的装置结构图；图6是本发明一实施例提供的再一种检验程序稳定性的装置结构图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发 明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述， 显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例，基于 本发明中的实施例，本领域普通技术人员在没有做出创造性劳动的前提下所 获得的所有其他实施例，都属于本发明保护的范围。如前所述，流量解析程序可以从流量报文的协议头中解析得到协议头长 度。但是，从该协议头中解析得到的协议头长度可能是错误的，若利用解析 得到的该协议头长度计算协议数据地址时，计算得到的该协议数据地址可能 超出了该流量报文的总长度。当该协议数据地址超出该流量报文的总长度， 且指向非法地址时，直接访问该协议数据地址，可能会造成流量解析程序的 崩溃。若流量解析程序访问该协议数据地址之前，对该流量报文执行越界判断， 即判断该协议头长度是否不大于该流量报文的总长度，只有当该协议头长度 不大于该流量报文的总长度时才访问该协议数据地址，那么可以大大提高流 量解析程序的稳定性。因此，流量解析程序中是否对流量报文执行越界判断， 对流量解析程序的稳定性至关重要。在相关技术中，流量解析程序中是否对流量报文执行越界判断，并没有 提前进行过检验，而是在流量解析程序实际执行过程中发生了程序崩溃，才 能够得知该流量解析程序中并没有对流量报文执行越界判断。因此，需要提 前对流量解析程序的稳定性进行检验。而越界判断的本质是执行与流量报文 相关的比较操作，因此可以通过预设的检验逻辑来判断流量解析程序在指定 周期的执行过程，来确定该流量解析程序是否稳定。下面描述以上构思的具体实现方式。请参考图1，本发明实施例提供了一种检验程序稳定性的方法，该方法 包括：步骤100，确定待检验的流量解析程序在指定周期的执行过程，该指定 周期的执行过程至少包括：该流量解析程序读取网卡的接收环、该流量解析 程序访问该流量报文的协议数据地址。步骤102，根据预设的检验逻辑判断该指定周期的执行过程，以确定该 流量解析程序是否稳定。本发明实施例中，流量解析程序是否稳定，需要判断流量解析程序在访 问流量报文的协议数据地址之前是否对流量报文进行越界判断，因此本实施 例中通过预设的检验逻辑对流量解析程序在指定周期的执行过程进行判断， 以确定流量解析程序是否稳定，可见本方案能够实现对流量解析程序是否稳 定的检验。下面描述图1所示的各个步骤的执行方式。首先，针对步骤100，确定待检验的流量解析程序在指定周期的执行过 程，该指定周期的执行过程至少包括：流量解析程序读取网卡的接收环、流 量解析程序访问该流量报文的协议数据地址。流量解析程序是由程序代码组成的，用于对读取的流量报文进行解析， 以得到该流量报文的协议数据地址，进而访问该协议数据地址以读取该流量 报文的协议数据。为判断流量解析程序的稳定性，需要确定流量解析程序的执行过程。由 于流量解析程序的稳定性在于在访问协议数据地址之前对流量报文进行越界 判断，因此可以仅确定流量解析程序在指定周期的执行过程，且该指定周期 的执行过程至少包括：流量解析程序访问该流量报文的协议数据地址。进一步地，考虑到对流量报文进行越界判断需要发生在获取流量报文之 后，因此，该指定周期的执行过程至少还需要包括流量解析程序获取流量报 文。在本发明一个实施例中，流量解析程序运行在Linux操作系统的不同体 系架构时，获取流量报文对应的执行过程不同。若流量解析程序运行在Linux 内核态，网卡通过DMA机制将流量 报文写入RX ring所指向的缓存区域，那么流量解 析程序获取流量报文的执行过程为读取网卡的接收环。相应地，该指定周期 的执行过程在包括流量解析程序获取流量报文时，该流量解析程序获取流量 报文为流量解析程序读取网卡的接收环。在本发明一个实施例中，为了实现本步骤100中确定该流量解析程序在 指定周期的执行过程，可以通过如下两个阶段进行确定：阶段一：确定流量解析程序读取网卡的接收环的执行过程。阶段二：确定流量解析程序读取网卡的接收环之后的执行过程。下面分别对上述两个阶段进行说明。针对阶段一，为了确定流量解析程序读取网卡的接收环这一执行过程， 先进行如下分析：若流量解析程序运行在内核态，那么Linux内核的虚拟内 存管理器是使用页表记录系统中所 有虚拟内存的访问属性。在这些访问属性中，有一个P flag参数，该P flag 参数值不同时，表示的含义不同。比如，当该Pflag参数值为1时，表示内 存页在物理内存中，程序可以直接访问；当该P flag参数值为0时，表示内 存页不在物理内存中，程序不可以直接访问。若程序访问的内存地址所对应 的内存页不在物理内存中，则会触发页缺失错误，需要调用页缺失处理器 来处理。基于此，在本发明一个实施例中，本步骤100中确定该流量解析程序在 指定周期的执行过程，具体包括：响应于检测到该流量解析程序访问内存地 址触发的页缺失错误，且响应于检测到该网卡的接收环包括该内存地址，确 定该流量解析程序读取该网卡的接收环。由于流量解析程序读取网卡的接收环的目的是访问接收环所对应内存页 中的内存地址，以获取流量报文。因此，为了能够确定流量解析程序读取网 卡的接收环这一执行过程，在本发明一个实施例中，在该确定该流量解析程 序读取该网卡的接收环之前，还包括：确定该网卡的接收环所对应的内存页； 该内存页中包括若干个内存地址；将该内存页所对应访问属性的P flag参数 值修改为第一设定值，基于该第一设定值控制该流量解析程序在访问该内存 页中的任意一个内存地址时则触发页缺失错误。比如，该第一设定值为0。流量解析程序在读取网卡的接收环时，需要访问该接收环对应内存页中 的内存地址，当确定该内存页的访问属性的P flag参数值为第一设定值时， 确定该内存页未在物理内存中，此时触发页缺失错误。在本发明一个实施例中，在将内存页访问属性的P flag参数值修改为第 一设定值之后，还需要将TLB清 空，防止TLB中缓存的修改前的P flag参数值对页缺失错误触发的影响，使 得流量解析程序在读取网卡的接收环时能够触发页缺失错误。其中，修改P flag参数值可以使用set_pte等内核函数，清空TLB可 以使用flush_tlb_all等内核函数。当检测到页缺失错误被触发时，该页缺失错误也可能是由其它程序访问 内存地址时触发的，因此，在本发明一个实施例中，在检测到流量解析程序 访问内存地址触发的页缺失错误之前，还包括：确定触发页缺失错误的程序 是否为流量解析程序，若是，则确定流量解析程序访问内存地址触发页缺失 错误。检测触发页缺失错误的程序是否为流量解析程序的方法可以使用进程号 来确定。比如，使用内核变量current-＞pid来确定。可以理解， 每一个程序都需要由一个进程实现程序的运行，每一个进程均对应一个进程 号，因此，可以判定触发页缺失错误的程序对应的进程号是否为流量解析程 序的进程，来确定触发页缺失错误的程序是否为流量解析程序。若触发页缺失错误的程序不是流量解析程序，则执行标准的页缺失处理 流程，无需特殊处理。若触发页缺失错误的程序为流量解析程序，考虑到页 缺失错误可能是由流量解析程序在访问其它内存地址时触发的情况，在本发 明一个实施例中，还需要进一步确定该页缺失错误的内存地址是否网卡的接 收环，若该内存地址不属于网卡的接收环，则执行标准的页缺失处理流程， 无需特殊处理；若该内存地址属于网卡的接收环，则可以确定流量解析程序 在读取网卡的接收环。其中，在确定内存地址是否属于网卡的接收环时，可以直接使用该内存 地址与网卡的接收环所对应内存页上的内存地址进行比较，以确定内存页上 是否包括该触发页缺失错误的内存地址。在本发明一个实施例中，当页缺失错误被触发后，需要调用页缺失处理 器来处理该页缺失错误，因此，需要预先在系统的中断描述表中注册自定义的页缺失处理器。其中注册页缺失处 理器可以使用write_idt_entry等内核函数。其中，注册的页缺失处理器至少可以包括两个，一个用于执行标准的页 缺失处理流程，另一个用于对流量解析程序读取网卡的接收环时触发的页缺 失错误进行处理。在本发明一个实施例中，当确定流量解析程序读取网卡的接收环之后， 调用对应的页缺失处理器，该页缺失处理器具体用于执行如下处理过程：将 内存页所对应访问属性的P flag参数值修改为第二设定值，以触发流量解析 程序执行该读取该网卡的接收环。比如该第二设定值为1。在将P flag参数 值修改为第二设定值之后，流量解析程序可以正常读取网卡的接收环，以获 取流量报文；另外，将P flag参数值修改为第二设定值之后，后续在读取网 卡的接收环时则不会触发页缺失错误，保证程序正常运行。当流量解析程序正常读取网卡的接收环之后，页缺失处理器可以获取到 该流量报文的总长度，记为len_msg，以及获取到流量解析程序该流量报文 的内存地址，记为p_src。以上对阶段一中流量解析程序的执行过程进行了确定，接下来对阶段二 中流量解析程序的执行过程进行确定。针对阶段二，由于对流量报文的越界判断发生在读取网卡的接收环之后， 为了避免漏掉越界判断的执行过程，可以控制流量解析程序单步执行，在单 步执行之后，流量解析程序会触发调试异常事件，利用调试异常事件确定该 流量解析程序的执行过程。在本发明一个实施例中，本步骤100中确定该流量解析程序在指定周期 的执行过程，具体包括：在该流量解析程序读取网卡的接收环之后，在该流 量解析程序访问该流量报文的协议数据地址之前，响应于检测到该流量解析 程序触发的调试异常事件，确定该调试异常事件对应的执行过程。为了能够使得流量解析程序单步执行，以及执行单步后触发调试异常事 件，可以通过设置流量解析程序对应的陷阱标志位来实现。 具体地，在本发明一个实施例中，在检测到流量解析程序触发的调试异常事 件之前，确定该流量解析程序在该指定周期的每个执行过程分别对应的陷阱 标志位，将每个陷阱标志位的参数值均修改为第三设定值，以使流量解析程 序能够触发调试异常事件。陷阱标志位存储在标志寄存器中，由CPU对标志 寄存器中的各参数进行维护。通过将陷阱标志位的参数值修改为第三设定值， 在内核线程执行流量解析程序时，根据该第三设定值在当前步骤执行完成后 则暂停执行，并触发调试异常事件。举例来说，将陷阱标志位的参数值修改 为第三设定值，流量解析程序执行第一个步骤，第一个步骤执行结束后暂停 并触发调试异常事件，调试异常事件的处理器对该第一个步骤的内容进行检 测，检测完成后继续将陷阱标志位的参数值修改为第三设定值，并触发流量 解析程序执行第二个步骤，第二个步骤执行结束后暂停并触发调试异常事 件……，如此实现控制流量解析程序的单步执行。如上，还需要预先在内核的通知链中注册调试异常 事件的处理器，用于检测该流量解析程序当前的执行过程。其中，注册调试 异常事件的处理器可以使用register_die_notifier等内核函数。利用调试异常事件的处理器可以确定流量解析程序在读取网卡的接收环 之后，流量解析程序访问流量报文的协议数据地址之前，每一个执行过程的 内容。在上述两个阶段完成后，可以确定该流量解析程序在指定周期的执行过 程。然后，针对步骤102，根据预设的检验逻辑判断该指定周期的执行过程， 以确定该流量解析程序是否稳定。在本发明一个实施例中，本步骤102具体可以包括：检验流量解析程序 从读取网卡的接收环至访问该流量报文的协议数据地址之间是否执行与流量 报文相关的比较操作，若是，则确定该流量解析程序稳定。由于越界判断的本质是进行流量报文相关的比较操作，因此，可以通过 判断是否执行与流量报文相关的比较操作，来确定流量解析程序是否稳定。为了提高流量解析程序执行越界判断的确定准确性，若本步骤102中执 行与流量报文相关的比较操作，在本发明一个实施例中，该检验逻辑可以进 一步包括：确定该比较操作是否为对该流量报文的总长度与该流量报文的协 议头长度进行比较，若是，则确定流量解析程序对流量报文执行越界判断。在确定该比较操作是否为对该流量报文的总长度与该流量报文的协议头 长度进行比较时，可以先将流量报文的总长度、流量报文的协议头长度均获 取到，然后对该比较操作进行判定，也可以只获取流量报文的总长度，利用 该流量报文的总长度对该比较操作进行判定。其中，流量报文的总长度在步骤100已由页缺失处理器获取 到。若需要同时获取流量报文的协议头长度，可以利用异常调试事件的处理 器获取。若不需要获取流量报文的协议头长度，那么可以判定该比较操作是 否为将流量报文的总长度与另一个值进行的比较，若是，则确定该比较操作 是对该流量报文的总长度与该流量报文的协议头长度进行比较，并将该另一 个值记录为协议头长度，记为len_hdr。在本发明一个实施例中，为了进一步提高流量解析程序执行越界判断的 确定准确性，在本发明一个实施例中，该检验逻辑可以包括：检验该指定周 期的执行过程中是否包括如下三个步骤：S1：流量解析程序将流量报文的总长度与协议头长度进行比较；S2：将流量报文的起始地址与协议头长度进行相加操作，计算得到流量 报文的协议数据地址；S3：访问S2中得到的流量报文的协议数据地址，以读取流量报文的协 议数据。若存在上述三个步骤，则确定流量解析程序执行越界判断，确定该流量 解析程序稳定，否则，确定该流量解析程序不稳定。在本发明一个实施例中，步骤S2中流量报文的起始地址通过如下方式 确定：在S1之前，流量解析程序的一个执行过程为：将流量报文由内存地 址复制到另一个内存地址。其中，该另一个内存地址即为流量报文 的起始地址，记为p_msg。以上实施例实现了程序稳定性的检验。下面以流量解析程序运行在内核态为例，对对本发明实施例的检验流程 进行说明。步骤a、启动检验程序线程。该检验程序线程控制整个检验流程，主要用于配置检测环境、控制流量 解析程序线程的暂停和执行。其中，在Linux内核中启动线程可以使用kthread_run，kthread_create，wake_up_process等函数。步骤b、配置检验环境。在检验程序线程启动后，需要对检验环境进行配置，以能够定位到流量 解析程序的一些关键执行过程，从而检验流量解析程序是否进行预期操作。 比如，注册页缺失处理、异常处理事件的处理器，修改P flag值等。步骤c、启动流量解析程序线程。步骤d、检验流量解析程序读取网卡的接收环。在流量解析程序线程启动后，流量解析程序会执行任意代码逻辑，比如 进行初始化，直到访问网卡的接收环之前，这些任意的代码逻辑都是检验程 序关心的。当流量解析程序读取网卡的接收环时，由于步骤b中的设置，会 触发页缺失错误，则调用页缺失处理器，当确定该页缺失错误是由流量解析 程序触发的，且流量解析程序访问的内存地址属于网卡的接收环时，将P flag 值由第一设定值修改为第二设定值以触发流量解析程序进行正常的读取网卡 的接收环，并获取返回的描述符对应的内存地址，该内存地址为流量报文的 内存地址，以及获取流量报文的总长度。接下来修改流量解析程序的陷阱标志位，以控制流量解析程序单步执行， 流量解析程序每执行一步则暂停，由检验程序检测流量解析程序在这一执行 过程对应的内容。步骤e、检验流量解析程序将从网卡的接收环读取到的流量报文复制到 某个内存地址处。在该步骤中，由于单步执行的配置，流量解析程序触发调试异常事件。调试异常事件的处理器判断该流量解析程序是否在复制流量报文至某一 个内存地址处。其中，复制流量报文的标志为：将内存地址为p_src的数据 复制到另一个内存地址处。因此，需要检验该执行过程是否满足如下条件：1、 当前指令为复制操作，比如x86中的mov指令；2、一个参数为p_src；3、 另一个参数为某个内存地址。若满足上述条件，则将该另一个参数对应的内 存地址确定为流量报文的起始地址，记为p_msg。步骤f、检验流量解析程序对流量报文进行越界判断。在确定了流量报文的起始地址之后，继续控制流量解析程序单步执行。调试异常事件的处理器判断该流量解析程序是否在对流量报文进行越界 判断。对流量报文进行越界判断的本质是将流量报文的总长度与协议头长度 进行比较。因此，需要检验该执行过程是否满足如下条件：1、当前指令为比 较操作，比如x86中的cmp指令；2、一个参数值为步骤d中记录的len_msg；3、另一个参数值为一个整数。若满足上述条件，则将该另一个参 数值确定为协议头长度，记为len_hdr。步骤g、检验流量解析程序计算流量报文的协议数据地址。在确定协议头长度之后，继续控制流量解析程序单步执行。调试异常事件的处理器判断该流量解析程序是否在计算流量报文的协议 数据地址。协议数据地址是对流量报文的起始地址与协议头长度进行相加操 作得到。因此，需要检验该执行过程是否满足如下条件：1、当前指令为地址 相加操作，比如x86中的add或leaq指令；2、一个参数值为步骤e中记 录的流量报文的起始地址p_msg；3、另一个参数值为步骤f中记录的协议 头长度len_hdr。若满足上述条件，则将计算结果确定为协议数据地址，记为 p_data。步骤h、检验流量解析程序访问流量报文的协议数据地址。在确定协议数据地址之后，继续控制流量解析程序单步执行。调试异常事件的处理器判断该流量解析程序是否在访问流量报文的协议 数据地址，即检验该执行过程是否为访问步骤g中记录的p_data地址。若是， 则确定流量解析程序访问流量报文的协议数据地址。若上述步骤f、g、h均检验到，则确定该流量解析程序对流量报文执行 越界判断，确定该流量解析程序稳定。否则，执行步骤i。步骤i、继续控制流量解析程序单步执行，调试异常事件的处理器判断 该流量解析程序再次读取网卡的接收环，则表明该流量解析程序已完成一条 流量报文的解析过程，但未对流量报文执行越界判断，因此，该流量解析程 序不稳定。步骤j、检验程序线程通知流量解析程序线程停止执行。其中可以使用 kthread_stop等内核函数来实现。流量解析程序线程接收到通知后停止执 行，可以通过检查kthread_should_stop的返回值来实现。步骤k、检验程序线程确定流量解析程序线程停止执行后，检验程序线 程停止。需要说明的是，在步骤d中，当将P flag值由第一设定值修改为第二设 定值以触发流量解析程序进行正常的读取网卡的接收环之后，可以将P flag 值由第二设定值修改回第一设定值，以使循环执行步骤d-h，当步骤d-h执行 次数达到设定次数后，执行步骤i。然后根据设定次数中检测到步骤f、g、h 的次数确定该流量解析程序是否稳定。本实施例在指令集层上进行校验，对待校验的流量解析程序的具体实现 方式的依赖较少，因此可以检测多种类型的流量解析程序。如图2、图3所示，本发明实施例提供了一种检验程序稳定性的装置。 装置实施例可以通过软件实现，也可以通过硬件或者软硬件结合的方式实现。 从硬件层面而言，如图2所示，为本发明实施例提供的一种检验程序稳定性 的装置所在计算设备的一种硬件架构图，除了图2所示的处理器、内存、网 络接口、以及非易失性存储器之外，实施例中装置所在的计算设备通常还可 以包括其他硬件，如负责处理报文的转发芯片等等。以软件实现为例，如图 3所示，作为一个逻辑意义上的装置，是通过其所在计算设备的CPU将非易 失性存储器中对应的计算机程序读取到内存中运行形成的。本实施例提供的 一种检验程序稳定性的装置，包括：执行过程确定单元301，用于确定待检验的流量解析程序在指定周期的 执行过程，所述指定周期的执行过程至少包括：所述流量解析程序读取网卡 的接收环、所述流量解析程序访问流量报文的协议数据地址；稳定性判断单元302，用于根据预设的检验逻辑判断所述指定周期的执 行过程，以确定所述流量解析程序是否稳定。在本发明一个实施例中，所述执行过程确定单元301，具体用于响应于 检测到所述流量解析程序访问内存地址触发的页缺失错误，且响应于检测到 所述网卡的接收环包括所述内存地址，确定所述流量解析程序读取所述网卡 的接收环。在本发明一个实施例中，请参考图4，该检验程序稳定性的装置还可以 包括：第一处理单元303，用于确定所述网卡的接收环所对应的内存页；所 述内存页中包括若干个内存地址；将所述内存页所对应访问属性的P flag参 数值修改为第一设定值，基于该第一设定值控制所述流量解析程序在访问所 述内存页中的任意一个内存地址时则触发页缺失错误。在本发明一个实施例中，请参考图5，该检验程序稳定性的装置还可以 包括：程序判断单元304，用于确定触发页缺失错误的程序是否为所述流量 解析程序，若是，则确定所述流量解析程序访问内存地址触发页缺失错误；和/或，第二处理单元305，用于将所述内存页所对应访问属性的P flag参数值 修改为第二设定值，以触发所述流量解析程序执行所述读取所述网卡的接收 环。在本发明一个实施例中，所述执行过程确定单元301，具体用于在所述 流量解析程序读取网卡的接收环之后，在所述流量解析程序访问所述流量报 文的协议数据地址之前，响应于检测到所述流量解析程序触发的调试异常事 件，确定所述调试异常事件对应的执行过程。在本发明一个实施例中，请参考图6，该检验程序稳定性的装置还可以 包括：第三处理单元306，用于确定所述流量解析程序在所述指定周期的每 个执行过程分别对应的陷阱标志位，将每个陷阱标志位的参数值均修改为第 三设定值，以使所述流量解析程序能够触发调试异常事件。在本发明一个实施例中，所述稳定性判断单元302，具体用于检验所述 流量解析程序从读取网卡的接收环至访问所述流量报文的协议数据地址之间 是否执行与流量报文相关的比较操作，若是，则确定所述流量解析程序稳定。可以理解的是，本发明实施例示意的结构并不构成对一种检验程序稳定 性的装置的具体限定。在本发明的另一些实施例中，一种检验程序稳定性的 装置可以包括比图示更多或者更少的部件，或者组合某些部件，或者拆分某 些部件，或者不同的部件布置。图示的部件可以以硬件、软件或者软件和硬 件的组合来实现。上述装置内的各模块之间的信息交互、执行过程等内容，由于与本发明 方法实施例基于同一构思，具体内容可参见本发明方法实施例中的叙述，此 处不再赘述。本发明实施例还提供了一种计算设备，包括存储器和处理器，所述存储 器中存储有计算机程序，所述处理器执行所述计算机程序时，实现本发明任 一实施例中的一种检验程序稳定性的方法。本发明实施例还提供了一种计算机可读存储介质，所述计算机可读存储 介质上存储有计算机程序，所述计算机程序在被处理器执行时，使所述处理 器执行本发明任一实施例中的一种检验程序稳定性的方法。具体地，可以提供配有存储介质的系统或者装置，在该存储介质上存储 着实现上述实施例中任一实施例的功能的软件程序代码，且使该系统或者装 置的计算机读出并执行存储在存储介质中的程序代码。在这种情况下，从存储介质读取的程序代码本身可实现上述实施例中任 何一项实施例的功能，因此程序代码和存储程序代码的存储介质构成了本发 明的一部分。用于提供程序代码的存储介质实施例包括软盘、硬盘、磁光盘、光盘、 磁带、非易失性存储卡和ROM。可选择地，可以由通信网络从服务器计算机 上下载程序代码。此外，应该清楚的是，不仅可以通过执行计算机所读出的程序代码，而 且可以通过基于程序代码的指令使计算机上操作的操作系统等来完成部分或 者全部的实际操作，从而实现上述实施例中任意一项实施例的功能。此外，可以理解的是，将由存储介质读出的程序代码写到插入计算机内 的扩展板中所设置的存储器中或者写到与计算机相连接的扩展模块中设置的 存储器中，随后基于程序代码的指令使安装在扩展板或者扩展模块上的CPU 等来执行部分和全部实际操作，从而实现上述实施例中任一实施例的功能。本发明各实施例至少具有如下有益效果：1、在本发明一个实施例中，流量解析程序是否稳定，需要判断流量解析 程序在访问流量报文的协议数据地址之前是否对流量报文进行越界判断，因 此本实施例中通过预设的检验逻辑对流量解析程序在指定周期的执行过程进 行判断，以确定流量解析程序是否稳定，可见本方案能够实现对流量解析程 序是否稳定的检验。2、在本发明一个实施例中，通过修改内存页访问属性的P flag参数，以 及注册页缺失处理器，使得流量解析程序在读取网卡的接收环时触发页缺失 错误，利用页缺失处理器对该页缺失错误进行处理，从而可以准确定位到流 量解析程序读取网卡的接收环这一执行过程。3、在本发明一个实施例中，在确定流量解析程序读取网卡的接收环之后， 控制流量解析程序单步执行，并利用注册的调试异常事件的处理器检验流量 解析程序在每一个执行过程的内容，从而避免漏掉越界判断的执行过程。4、在本发明一个实施例中，在利用预设的检验逻辑判断指定周期的执行 过程时，可以判断该执行过程中是否执行与流量报文相关的比较操作，以确 定流量解析程序是否稳定。进一步地，还可以确定该比较操作是否为对该流 量报文的总长度与该流量报文的协议头长度进行比较，以提高流量解析程序 执行越界判断的确定准确性。5、在本发明一个实施例中，在利用预设的检验逻辑判断指定周期的执行 过程时，还可以判断该执行过程中是否包括指定的三个步骤，来确定流量解 析程序是否稳定，从而可以提高流量解析程序执行越界判断的确定准确性。需要说明的是，在本文中，诸如第一和第二之类的关系术语仅仅用来将 一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这 些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包 含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素 的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出 的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。 在没有更多限制的情况下，由语句“包括一个…”限定的要素，并不排除在包 括所述要素的过程、方法、物品或者设备中还存在另外的相同因素。本领域普通技术人员可以理解：实现上述方法实施例的全部或部分步骤 可以通过程序指令相关的硬件来完成，前述的程序可以存储在计算机可读取 的存储介质中，该程序在执行时，执行包括上述方法实施例的步骤；而前述 的存储介质包括：ROM、RAM、磁碟或者光盘等各种可以存储程序代码的介 质中。最后应说明的是：以上实施例仅用以说明本发明的技术方案，而非对其 限制；尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术 人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或 者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技 术方案的本质脱离本发明各实施例技术方案的精神和范围。
