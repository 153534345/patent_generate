标题title
基于声波通讯和手机网络的停车场收费管理方法及系统
摘要abst
本发明公开了一种基于声波通讯和手机网络的停车场收费管理方法及系统，该方法为：入场相机识别到车辆入场，提取入场信息存储；根据停车场内的互联网情况，选择发送入场信息至云平台或出场相机，并在断网后，在出场相机与云平台内生成第一、第二开闸指令代码；出场相机识别到车辆离场时，再次根据互联网情况选择缴费方式，若仍然断网，则通过出口相机计算费用生成信息匹配验证码，手机扫码后发送验证信息在云平台验证缴费，之后通过声音编码的方式，将第二开闸指令代码通过智能手机播放给出场相机解码核对，开闸放行。本发明减小停车场对互联网的依赖，不仅能有效避免停车场因断网导致的经济损失，还能保证缴费金额的准确性，满足客户需求。
权利要求书clms
1.一种基于声波通讯和手机网络的停车场收费管理方法，应用于在入口和出口分别设有入场相机和出场相机的停车场，所述入场相机和出场相机均与云平台通过互联网通信，停车场内设有第一缴费码，用户通过智能手机扫第一缴费码向云平台发送缴费请求，其特征在于：包括以下步骤；入场相机识别到车辆入场，提取入场信息并存储，预设入场相机的存储时长T，且能循环存储该时长内的入场信息；侦测当前时刻停车场内的互联网网络；若网络正常：入场相机发送入场信息至云平台，并在入场相机内暂存该入场信息；若网络异常：入场相机与出场相机进行局域网组网，并通过局域网发送当前时刻起，时长T内的入场信息至出场相机暂存；出场相机与云平台在当前时刻分别生成相同的第一开闸指令代码和第二开闸指令代码；出场相机识别到有车辆离场，提取离场信息，侦测离场时刻的停车场内的互联网网络；若网络异常，按步骤-执行；出场相机调取该车辆的入场信息，按缴费规则计算停车费，生成信息匹配验证码，用户扫码后通过手机网络连接至云平台，将验证信息发送至云平台，所述验证信息包括车场编码、车道编码、入场信息、出场信息、停车费和费率编码；云平台根据验证信息，重新计算停车费，若金额与验证信息内停车费金额相同，引导用户在云平台完成缴费；缴费成功后，云平台用声音信号对第二开闸指令代码进行编码，形成声波数据，通过手机网络发送至用户智能手机；用户在出场相机处播放声波数据，出场相机拾取声波信号后解码回第二开闸指令代码；出场相机将解码得到的第二开闸指令代码与自己生成的第一开闸指令代码对比，若相同，则开闸放行；否则报送至出口处人工处理；若网络正常，且出场相机中未生成第一开闸指令代码，出场相机识别离场车辆的离场信息发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行；若网络正常，且出场相机中有生成的第一开闸指令代码，出场相机将时长T内的入场信息上传至云平台，再识别离场车辆的车牌发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行。2.根据权利要求1所述的基于声波通讯和手机网络的停车场收费管理方法，其特征在于：所述互联网网络正常为，入场相机能与云平台通信，否则为异常。3.根据权利要求1所述的基于声波通讯和手机网络的停车场收费管理方法，其特征在于：所述第一开闸指令代码至少由三部分按预设编码规则编排而成，所述三部分为车场编码、车道编号和断网时间特征码。4.根据权利要求1所述的基于声波通讯和手机网络的停车场收费管理方法，其特征在于：所述步骤中，云平台根据验证信息，重新计算停车费，具体为；根据入场信息、出场信息和费率编码，计算停车费。5.一种基于声波通讯和手机网络的停车场收费管理系统，应用于在入口和出口分别设有入场相机和出场相机的停车场，所述入场相机和出场相机均与云平台通过互联网通信，停车场内设有第一缴费码，用户通过智能手机扫第一缴费码向云平台发送缴费请求，该系统包括智能手机、云平台、入场相机和出场相机，其特征在于：所述智能手机用于扫第一缴费码或出场相机生成的信息匹配验证码后，通过手机网络与云平台通信；所述入场相机包括入场信息识别单元：用于识别到车辆入场，提取入场信息并存储，预设入场相机的存储时长T，且能循环存储该时长内的入场信息；第一网络侦测单元：用于识别车辆入场时刻，停车场内互联网网络是否正常；入场信息发送单元：用于根据互联网侦测单元的结果，发送入场信息，具体为，若网络正常：入场相机发送入场信息至云平台，并在入场相机内暂存该入场信息；若网络异常：入场相机与出场相机进行局域网组网，并通过局域网发送当前时刻起，时长T内的入场信息至出场相机暂存；所述出场相机包括信息暂存单元：用于暂存入场信息发送单元发来的时长T内的入场信息；离场信息识别单元：用于识别车辆离场，提取离场信息；第二网络侦测单元：识别车辆离场时刻，停车场内互联网网络是否正常；第一开闸指令代码生成单元：用于在第一网络侦测单元或第二网络侦测单元侦测到网络异常时，生成第一开闸指令代码；缴费流程选择单元，用于根据网络情况和/或第一开闸指令代码，选择第一缴费单元、第二缴费单元或第三缴费单元；若网络异常，选择第一缴费单元；若网络正常，且出场相机中未生成第一开闸指令代码，选择第二缴费单元；若网络正常，且出场相机中有生成的第一开闸指令代码，选择第三缴费单元；所述云平台包括第二开闸指令代码生成单元：用于在第一网络侦测单元或第二网络侦测单元侦测到网络异常时，生成第二开闸指令代码；所述第一缴费单元包括信息匹配验证码生成单元：用于根据离场车辆的入场信息、离场信息，按缴费规则计算停车费，生成信息匹配验证码，且能在用户扫信息匹配验证码后，通过手机网络连接至云平台，将验证信息发送至云平台，所述验证信息包括车场编码、车道编码、入场信息、出场信息、停车费和费率编码；验证单元：用于使云平台根据验证信息，重新计算停车费，若金额与验证信息内停车费金额相同，引导用户在云平台完成缴费；编码单元：用于在缴费成功后，使云平台用声音信号对第二开闸指令代码进行编码，形成声波数据，并能通过手机网络发送至用户智能手机；解码单元：用于使出场相机拾取智能手机播放的声波数据，解码回第二开闸指令代码；对比单元：用于使出场相机将解码得到的第二开闸指令代码与自己生成的第一开闸指令代码对比，若相同，则开闸放行，否则报送至出口处人工处理；所述第二缴费单元：用于出场相机识别离场车辆的车牌发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行；所述第三缴费单元：用于出场相机将时长T内的入场信息上传至云平台，再识别离场车辆的车牌发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行。6.根据权利要求5所述的基于声波通讯和手机网络的停车场收费管理系统，其特征在于：所述互联网网络正常为，入场相机能与云平台通信，否则为异常。7.根据权利要求5所述的基于声波通讯和手机网络的停车场收费管理系统，其特征在于：所述第一开闸指令代码至少由三部分按预设编码规则编排而成，所述三部分为车场编码、车道编号和断网时间特征码。
说明书desc
技术领域本发明涉及一种停车场收费管理方法及系统，尤其涉及一种基于声波通讯和手机网络的停车场收费管理方法及系统。背景技术目前室内停车场系统的一种主流架构为，停车场出入场通道设置道闸，道闸处设有入场车牌识别摄像机或出场车牌识别摄像机，入场车牌识别摄像机、出场车牌识别摄像机、道闸均通过互联网与云服务器进行连接，本地无服务器，相机间弱通讯或无通讯。入场车牌识别摄像机识别到车辆入场后，将其入场信息上传至云服务器，车辆离场时，通过手机扫码在云服务器完成支付，云服务器控制出口处的道闸开闸。这种架构方案优势非常明显，如现场维护量低，施工成本低，结构简单故障点少，绿色节能等等。但也有一个主要弊病，十分依赖互联网通讯。一旦互联网异常，车场只能免费放行所有车辆，车场要遭受经济损失。发明内容本发明的目的就在于提供一种解决上述问题，可减少停车场现场对互联网的依赖，在断网情况下也能正常完成缴费的，基于声波通讯和手机网络的停车场收费管理方法及系统。为了实现上述目的，本发明采用的技术方案是这样的：一种基于声波通讯和手机网络的停车场收费管理方法，应用于在入口和出口分别设有入场相机和出场相机的停车场，所述入场相机和出场相机均与云平台通过互联网通信，停车场内设有第一缴费码，用户通过智能手机扫第一缴费码向云平台发送缴费请求，包括以下步骤；入场相机识别到车辆入场，提取入场信息并存储，预设入场相机的存储时长T，且能循环存储该时长内的入场信息；侦测当前时刻停车场内的互联网网络；若网络正常：入场相机发送入场信息至云平台，并在入场相机内暂存该入场信息；若网络异常：入场相机与出场相机进行局域网组网，并通过局域网发送当前时刻起，时长T内的入场信息至出场相机暂存；出场相机与云平台在当前时刻分别生成相同的第一开闸指令代码和第二开闸指令代码；出场相机识别到有车辆离场，提取离场信息，侦测离场时刻的停车场内的互联网网络；若网络异常，按步骤-执行；出场相机调取该车辆的入场信息，按缴费规则计算停车费，生成信息匹配验证码，用户扫码后通过手机网络连接至云平台，将验证信息发送至云平台，所述验证信息包括车场编码、车道编码、入场信息、出场信息、停车费和费率编码；云平台根据验证信息，重新计算停车费，若金额与验证信息内停车费金额相同，引导用户在云平台完成缴费；缴费成功后，云平台用声音信号对第二开闸指令代码进行编码，形成声波数据，通过手机网络发送至用户智能手机；用户在出场相机处播放声波数据，出场相机拾取声波信号后解码回第二开闸指令代码；出场相机将解码得到的第二开闸指令代码与自己生成的第一开闸指令代码对比，若相同，则开闸放行；否则报送至出口处人工处理；若网络正常，且出场相机中未生成第一开闸指令代码，出场相机识别离场车辆的离场信息发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行；若网络正常，且出场相机中有生成的第一开闸指令代码，出场相机将时长T内的入场信息上传至云平台，再识别离场车辆的车牌发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行。作为优选：所述互联网网络正常为，入场相机能与云平台通信，否则为异常。作为优选：所述第一开闸指令代码至少由三部分按预设编码规则编排而成，所述三部分为车场编码、车道编号和断网时间特征码。作为优选：所述步骤中，云平台根据验证信息，重新计算停车费，具体为；根据入场信息、出场信息和费率编码，计算停车费。一种基于声波通讯和手机网络的停车场收费管理系统，应用于在入口和出口分别设有入场相机和出场相机的停车场，所述入场相机和出场相机均与云平台通过互联网通信，停车场内设有第一缴费码，用户通过智能手机扫第一缴费码向云平台发送缴费请求，该系统包括智能手机、云平台、入场相机和出场相机；所述智能手机用于扫第一缴费码或出场相机生成的信息匹配验证码后，通过手机网络与云平台通信；所述入场相机包括入场信息识别单元：用于识别到车辆入场，提取入场信息并存储，预设入场相机的存储时长T，且能循环存储该时长内的入场信息；第一网络侦测单元：用于识别车辆入场时刻，停车场内互联网网络是否正常；入场信息发送单元：用于根据互联网侦测单元的结果，发送入场信息，具体为，若网络正常：入场相机发送入场信息至云平台，并在入场相机内暂存该入场信息；若网络异常：入场相机与出场相机进行局域网组网，并通过局域网发送当前时刻起，时长T内的入场信息至出场相机暂存；所述出场相机包括信息暂存单元：用于暂存入场信息发送单元发来的时长T内的入场信息；离场信息识别单元：用于识别车辆离场，提取离场信息；第二网络侦测单元：识别车辆离场时刻，停车场内互联网网络是否正常；第一开闸指令代码生成单元：用于在第一网络侦测单元或第二网络侦测单元侦测到网络异常时，生成第一开闸指令代码；缴费流程选择单元，用于根据网络情况和/或第一开闸指令代码，选择第一缴费单元、第二缴费单元或第三缴费单元；若网络异常，选择第一缴费单元；若网络正常，且出场相机中未生成第一开闸指令代码，选择第二缴费单元；若网络正常，且出场相机中有生成的第一开闸指令代码，选择第三缴费单元；所述云平台包括第二开闸指令代码生成单元：用于在第一网络侦测单元或第二网络侦测单元侦测到网络异常时，生成第二开闸指令代码；所述第一缴费单元包括信息匹配验证码生成单元：用于根据离场车辆的入场信息、离场信息，按缴费规则计算停车费，生成信息匹配验证码，且能在用户扫信息匹配验证码后，通过手机网络连接至云平台，将验证信息发送至云平台，所述验证信息包括车场编码、车道编码、入场信息、出场信息、停车费和费率编码；验证单元：用于使云平台根据验证信息，重新计算停车费，若金额与验证信息内停车费金额相同，引导用户在云平台完成缴费；编码单元：用于在缴费成功后，使云平台用声音信号对第二开闸指令代码进行编码，形成声波数据，并能通过手机网络发送至用户智能手机；解码单元：用于使出场相机拾取智能手机播放的声波数据，解码回第二开闸指令代码；对比单元：用于使出场相机将解码得到的第二开闸指令代码与自己生成的第一开闸指令代码对比，若相同，则开闸放行，否则报送至出口处人工处理；所述第二缴费单元：用于出场相机识别离场车辆的车牌发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行；所述第三缴费单元：用于出场相机将时长T内的入场信息上传至云平台，再识别离场车辆的车牌发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行。作为优选：所述互联网网络正常为，入场相机能与云平台通信，否则为异常。作为优选：所述第一开闸指令代码至少由三部分按预设编码规则编排而成，所述三部分为车场编码、车道编号和断网时间特征码。本发明中，我们在车辆离场时，根据互联网的状态和第一开闸指令代码，分为三种情况讨论。情况一：若网络异常，表示此时出场相机无法与云平台通信，云平台无法直接从出场相机中获取车辆的离场信息，无法计算停车费，也无法引导用户缴费。情况二：若网络正常，且出场相机中未生成第一开闸指令代码，说明停车场在时长T内，均未断网，为正常情况。情况三：若网络正常，但出场相机中生成了第一开闸指令，说明停车场在时长T内，出现过断网的情况。对于情况一：此时无法直接通过云平台计算费用，故出场相机计算停车费，生成信息匹配验证码，该信息匹配验证码能在智能手机扫码后，通过手机网络链接到云平台，将验证信息发送至云平台；云平台接收到智能手机发来的验证信息后，重新按相同的缴费规则计算停车费，若金额与验证信息内停车费金额相同，引导用户在云平台完成缴费；缴费成功后，通过声音编码的方式，将第二开闸指令代码通过智能手机作为媒介，播放给出场相机，由出场相机解码核对，开闸放行。对于情况二：正常缴费离场即可。对于情况三：表示说明停车场在时长T内，出现过断网的情况，此时需要同步出场相机内的数据到云平台，然后车辆正常缴费离场即可。与现有技术相比，本发明的优点在于：本发明用入场相机和出场相机侦测互联网状态，在互联网断网情况下实现通过局域网自动组网，从而使车辆在离场时，出场相机能获取到车辆的入场信息，并根据离场时的互联网状态，选择合适的缴费流程，能有效避免车场因断网导致的经济损失。本发明提出了一种在停车场断网情况下解决停车场无法收费、或收费金额不正确的新方法，利用出场相机计算费用，生成包含验证信息的信息匹配验证码，用智能手机作为出场相机和云平台的中介，将验证信息发送给云平台验证，并在云平台完成缴费，缴费后，将第二开闸指令代码通过智能手机作为媒介，播放给出场相机，由出场相机解码后与第一开闸指令代码核对，开闸放行。综合利用局域网、手机网络、声音编码等方法，实现断网情况的收费管理。附图说明图1为本发明流程图；图2为本发明系统框图。具体实施方式下面将结合附图对本发明作进一步说明。实施例1：参见图1和图2，一种基于声波通讯和手机网络的停车场收费管理方法，应用于在入口和出口分别设有入场相机和出场相机的停车场，所述入场相机和出场相机均与云平台通过互联网通信，停车场内设有第一缴费码，用户通过智能手机扫第一缴费码向云平台发送缴费请求，包括以下步骤；入场相机识别到车辆入场，提取入场信息并存储，预设入场相机的存储时长T，且能循环存储该时长内的入场信息；侦测当前时刻停车场内的互联网网络；若网络正常：入场相机发送入场信息至云平台，并在入场相机内暂存该入场信息；若网络异常：入场相机与出场相机进行局域网组网，并通过局域网发送当前时刻起，时长T内的入场信息至出场相机暂存；出场相机与云平台在当前时刻分别生成相同的第一开闸指令代码和第二开闸指令代码；出场相机识别到有车辆离场，提取离场信息，侦测离场时刻的停车场内的互联网网络；若网络异常，按步骤-执行；出场相机调取该车辆的入场信息，按缴费规则计算停车费，生成信息匹配验证码，用户扫码后通过手机网络连接至云平台，将验证信息发送至云平台，所述验证信息包括车场编码、车道编码、入场信息、出场信息、停车费和费率编码；云平台根据验证信息，重新计算停车费，若金额与验证信息内停车费金额相同，引导用户在云平台完成缴费；缴费成功后，云平台用声音信号对第二开闸指令代码进行编码，形成声波数据，通过手机网络发送至用户智能手机；用户在出场相机处播放声波数据，出场相机拾取声波信号后解码回第二开闸指令代码；出场相机将解码得到的第二开闸指令代码与自己生成的第一开闸指令代码对比，若相同，则开闸放行；否则报送至出口处人工处理；若网络正常，且出场相机中未生成第一开闸指令代码，出场相机识别离场车辆的离场信息发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行；若网络正常，且出场相机中有生成的第一开闸指令代码，出场相机将时长T内的入场信息上传至云平台，再识别离场车辆的车牌发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行。本实施例中，所述互联网网络正常为，入场相机能与云平台通信，否则为异常。所述第一开闸指令代码至少由三部分按预设编码规则编排而成，所述三部分为车场编码、车道编号和断网时间特征码。所述步骤中，云平台根据验证信息，重新计算停车费，具体为；根据入场信息、出场信息和费率编码，计算停车费。一种基于声波通讯和手机网络的停车场收费管理系统，应用于在入口和出口分别设有入场相机和出场相机的停车场，所述入场相机和出场相机均与云平台通过互联网通信，停车场内设有第一缴费码，用户通过智能手机扫第一缴费码向云平台发送缴费请求，该系统包括智能手机、云平台、入场相机和出场相机，所述智能手机用于扫第一缴费码或出场相机生成的信息匹配验证码后，通过手机网络与云平台通信；所述入场相机包括入场信息识别单元：用于识别到车辆入场，提取入场信息并存储，预设入场相机的存储时长T，且能循环存储该时长内的入场信息；第一网络侦测单元：用于识别车辆入场时刻，停车场内互联网网络是否正常；入场信息发送单元：用于根据互联网侦测单元的结果，发送入场信息，具体为，若网络正常：入场相机发送入场信息至云平台，并在入场相机内暂存该入场信息；若网络异常：入场相机与出场相机进行局域网组网，并通过局域网发送当前时刻起，时长T内的入场信息至出场相机暂存；所述出场相机包括信息暂存单元：用于暂存入场信息发送单元发来的时长T内的入场信息；离场信息识别单元：用于识别车辆离场，提取离场信息；第二网络侦测单元：识别车辆离场时刻，停车场内互联网网络是否正常；第一开闸指令代码生成单元：用于在第一网络侦测单元或第二网络侦测单元侦测到网络异常时，生成第一开闸指令代码；缴费流程选择单元，用于根据网络情况和/或第一开闸指令代码，选择第一缴费单元、第二缴费单元或第三缴费单元；若网络异常，选择第一缴费单元；若网络正常，且出场相机中未生成第一开闸指令代码，选择第二缴费单元；若网络正常，且出场相机中有生成的第一开闸指令代码，选择第三缴费单元；所述云平台包括第二开闸指令代码生成单元：用于在第一网络侦测单元或第二网络侦测单元侦测到网络异常时，生成第二开闸指令代码；所述第一缴费单元包括信息匹配验证码生成单元：用于根据离场车辆的入场信息、离场信息，按缴费规则计算停车费，生成信息匹配验证码，且能在用户扫信息匹配验证码后，通过手机网络连接至云平台，将验证信息发送至云平台，所述验证信息包括车场编码、车道编码、入场信息、出场信息、停车费和费率编码；验证单元：用于使云平台根据验证信息，重新计算停车费，若金额与验证信息内停车费金额相同，引导用户在云平台完成缴费；编码单元：用于在缴费成功后，使云平台用声音信号对第二开闸指令代码进行编码，形成声波数据，并能通过手机网络发送至用户智能手机；解码单元：用于使出场相机拾取智能手机播放的声波数据，解码回第二开闸指令代码；对比单元：用于使出场相机将解码得到的第二开闸指令代码与自己生成的第一开闸指令代码对比，若相同，则开闸放行，否则报送至出口处人工处理；所述第二缴费单元：用于出场相机识别离场车辆的车牌发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行；所述第三缴费单元：用于出场相机将时长T内的入场信息上传至云平台，再识别离场车辆的车牌发送至云平台，由云平台计算停车费，智能手机扫第一缴费码与云平台通信，由云平台引导用户完成缴费，并控制出口放行。所述互联网网络正常为，入场相机能与云平台通信，否则为异常。所述第一开闸指令代码至少由三部分按预设编码规则编排而成，所述三部分为车场编码、车道编号和断网时间特征码。实施例2：参见图1和图2，在实施例1的基础上，我们进一步限定如下：关于步骤，其中，T=12小时，入场信息包括车辆的车牌号、入场时间等；关于步骤、中计算停车费时提到的缴费规则和费率编码；市场上存在多套不同的缴费规则，例如某小区前2小时5元，后面每小时2，30封顶，这是一种缴费规则。某核心区域前2小时15元，后面每小时5元，50封顶等，这也是一种缴费规则，缴费系统中，对应这些不同的缴费规则，均有对应的费率编码，出场相机和云平台都内置有多种缴费规则的程序，只要二者采用相同费率编码对应的缴费规则进行计算，则算出来出场车辆应缴纳的停车费，是相同的。所以在出场相机按某缴费规则计算停车费，会生成信息匹配验证码，信息匹配验证码的作用有两个，第一，使手机通过手机网络连接云平台，第二，包含有验证信息，使手机将验证信息发给云平台。当云平台接收到验证信息后，根据这些信息，会重新计算停车费，只有云平台计算的停车费与出场相机发来的停车费金额相同时，才能完成缴费，进行下一步开闸的操作。另外，关于第一开闸指令代码和第二开闸指令代码，第一开闸指令代码至少由三部分按预设编码规则编排而成，所述三部分为车场编码、车道编号和断网时间特征码。例如：车场编码230071、车道编号01、断网时间为2022-09-30 22：29：45断网时间特征码即为09302129；本次开闸指令码为230071-01-09302129。当然编码规则不仅限于此，只要包含三部分，且第一开闸指令代码、第二开闸指令代码遵循同样的编码规则即可。另外，断网时间特征码也没有固定格式，只要能反应断网时间即可。以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的精神和原则之内所作的任何修改、等同替换和改进等，均应包含在本发明的保护范围之内。
