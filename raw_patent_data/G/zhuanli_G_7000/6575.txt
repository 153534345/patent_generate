标题title
自动切换虚拟卡的方法、装置和设备
摘要abst
本发明涉及虚拟卡技术领域，具体涉及一种自动切换虚拟卡的方法、装置和设备，方法包括：读取刷卡终端的行为模式信息；在所有虚拟卡中，确定预先与行为模式信息关联的目标虚拟卡；使用目标虚拟卡与刷卡终端进行刷卡交易。采用本发明的技术方案，从刷卡终端的行为模式分析出发，确定默认卡，无需刷卡终端升级，节约了建设成本。此外，用户实际拥有的虚拟卡数量有限，使用场景也有限，本方案能够更有针对性地适应用户的日常使用场景，提高默认卡切换成功率。
权利要求书clms
1.一种自动切换虚拟卡的方法，其特征在于，应用于智能终端设备，所述方法包括：读取刷卡终端的行为模式信息；在所有所述虚拟卡中，确定预先与所述行为模式信息关联的目标虚拟卡；使用所述目标虚拟卡与所述刷卡终端进行刷卡交易。2.根据权利要求1所述的自动切换虚拟卡的方法，其特征在于，所述读取刷卡终端的行为模式信息之前，包括：在刷卡过程中，若检测到进入刷卡交易阶段后，读取所述刷卡过程中的刷卡终端的行为模式信息；将所述刷卡过程中的刷卡终端的行为模式信息与所述刷卡过程中的默认卡关联。3.根据权利要求1所述的自动切换虚拟卡的方法，其特征在于，所述刷卡终端的行为模式信息包括：通信前阶段的询卡模式信息、协议交互阶段的通信指令信息、应用交互阶段的初始应用指令信息以及相邻指令的间隔时间；所述在所有所述虚拟卡中，确定预先与所述行为模式信息关联的目标虚拟卡，包括：在所有所述虚拟卡中，确定预先与所述询卡模式信息、所述通信前阶段相邻指令的间隔时间关联的第一虚拟卡集；在所述第一虚拟卡集中确定第一虚拟卡，以使所述第一虚拟卡与所述刷卡终端进行协议交互；在所述第一虚拟卡与所述刷卡终端进行协议交互过程中，确定所述第一虚拟卡集中与所述通信指令信息、所述协议交互阶段相邻指令的间隔时间关联的第二虚拟卡集；在所述第二虚拟卡集中，确定与所述初始应用指令信息、所述应用交互阶段相邻指令的间隔时间关联的第三虚拟卡集；在所述第三虚拟卡集中，确定所述目标虚拟卡。4.根据权利要求3所述的自动切换虚拟卡的方法，其特征在于，所述在所述第一虚拟卡集中确定第一虚拟卡，以使所述第一虚拟卡与所述刷卡终端进行协议交互，包括：按照预设的优先级顺序，在所述第一虚拟卡集中确定第一虚拟卡；检测在所述第一虚拟卡与所述刷卡终端的协议交互过程中，所述刷卡终端是否出现异常；若在所述第一虚拟卡与所述刷卡终端的协议交互过程中，所述刷卡终端出现异常，则根据所述优先级顺序，在所述第一虚拟卡集剩余的虚拟卡中重新确定第一虚拟卡，以使重新确定的第一虚拟卡与所述刷卡终端进行协议交互，直至所述协议交互完成。5.根据权利要求4所述的自动切换虚拟卡的方法，其特征在于，所述方法还包括：将与所述刷卡终端完成协议交互的第一虚拟卡作为常用虚拟卡，并提升所述常用虚拟卡的优先级顺序。6.根据权利要求4所述的自动切换虚拟卡的方法，其特征在于，所述在所述第三虚拟卡集中，确定所述目标虚拟卡，包括：按照所述优先级顺序，在所述第三虚拟卡集中确定目标虚拟卡；在所述目标虚拟卡与所述刷卡终端的应用交互中，判断所述刷卡终端是否出现异常；若在所述目标虚拟卡与所述刷卡终端的应用交互中，所述刷卡终端出现异常，则根据所述优先级顺序，在所述第三虚拟卡集剩余的虚拟卡中重新确定目标虚拟卡，以使重新确定的目标虚拟卡与所述刷卡终端进行应用交互，直至所述应用交互成功。7.根据权利要求4所述的自动切换虚拟卡的方法，其特征在于，所述方法还包括：将与所述刷卡终端完成应用交互的目标虚拟卡作为常用虚拟卡，并提升所述常用虚拟卡的优先级顺序。8.根据权利要求4所述的自动切换虚拟卡的方法，其特征在于，所述通信指令信息包括：询卡指令内容。9.一种自动切换虚拟卡的装置，其特征在于，应用于智能终端设备，所述装置包括：读取模块，用于读取刷卡终端的行为模式信息；确定模块，用于在所有所述虚拟卡中，确定预先与所述行为模式信息关联的目标虚拟卡；卡切换模块，用于使用所述目标虚拟卡与所述刷卡终端进行刷卡交易。10.一种自动切换虚拟卡的设备，其特征在于，包括处理器和存储器，所述处理器与存储器相连：其中，所述处理器，用于调用并执行所述存储器中存储的程序；所述存储器，用于存储所述程序，所述程序至少用于执行权利要求1-8任一项所述的自动切换虚拟卡的方法。
说明书desc
技术领域本发明涉及虚拟卡技术领域，具体涉及一种自动切换虚拟卡的方法、装置和设备。背景技术目前人们的手机或者平板电脑等智能终端设备中，一般会开通多张虚拟卡，例如虚拟公交卡、虚拟门禁卡或者虚拟银行卡等。通过设置各种虚拟卡，用户只需要使用随身携带的智能终端设备进行“刷卡”即可，不必再随身携带各种实体卡片，为人们的生活提供了便捷。但是，用户的智能终端设备中可能会存在多张虚拟卡，不同的虚拟卡应用于不同的刷卡终端。人们在使用某一张虚拟卡前，需要将该张虚拟卡设置为默认卡，才能够顺利在对应的刷卡终端上完成交易。因此，提前设置默认卡这一过程依然影响刷卡过程的便捷性。现有技术中，为了进一步提高刷卡的便捷性，技术人员研发出了EnhancedContactless Polling。ECP在NFC Forum定义的基础上，增加了新的询卡指令。新的询卡指令携带刷卡终端属性信息，因此手机可以根据该属性信息切换相应的虚拟卡，完成交易。该方案虽然能够解决自动切换卡片的问题，但是该方案的实现依赖于将所有刷卡终端的软件或者硬件进行升级，使升级后的刷卡终端支持新增的询卡指令，并且遵循统一的刷卡终端属性编码规则，需要耗费的成本较高。此外，技术人员还研发出了智闪卡，智闪卡方案基于大数据技术，结合刷卡的地理位置确定刷卡终端的属性和类型，进而切换相对应的虚拟卡。这种方式有很大的概率造成误判，而且普通上班族的门禁刷卡点和公交卡刷卡点的位置可能比较接近，进一步的提高了误判率。因此，现有技术在多张虚拟卡中确认默认卡时，存在成本高、误判率高的问题，亟待本领域的技术人员解决。发明内容有鉴于此，本发明的目的在于提供一种自动切换虚拟卡的方法、装置和设备，以克服目前在多张虚拟卡中确认默认卡时，成本高、误判率高的问题。为实现以上目的，本发明采用如下技术方案：一方面，本发明提供了一种自动切换虚拟卡的方法，应用于智能终端设备，所述方法包括：读取刷卡终端的行为模式信息；在所有所述虚拟卡中，确定预先与所述行为模式信息关联的目标虚拟卡；使用所述目标虚拟卡与所述刷卡终端进行刷卡交易。进一步的，以上所述的自动切换虚拟卡的方法，所述读取刷卡终端的行为模式信息之前，包括：在刷卡过程中，若检测到进入刷卡交易阶段后，读取所述刷卡过程中的刷卡终端的行为模式信息；将所述刷卡过程中的刷卡终端的行为模式信息与所述刷卡过程中的默认卡关联。进一步的，以上所述的自动切换虚拟卡的方法，所述刷卡终端的行为模式信息包括：通信前阶段的询卡模式信息、协议交互阶段的通信指令信息、应用交互阶段的初始应用指令信息以及相邻指令的间隔时间；所述在所有所述虚拟卡中，确定预先与所述行为模式信息关联的目标虚拟卡，包括：在所有所述虚拟卡中，确定预先与所述询卡模式信息、所述通信前阶段相邻指令的间隔时间关联的第一虚拟卡集；在所述第一虚拟卡集中确定第一虚拟卡，以使所述第一虚拟卡与所述刷卡终端进行协议交互；在所述第一虚拟卡与所述刷卡终端进行协议交互过程中，确定所述第一虚拟卡集中与所述通信指令信息、所述协议交互阶段相邻指令的间隔时间关联的第二虚拟卡集；在所述第二虚拟卡集中，确定与所述初始应用指令信息、所述应用交互阶段相邻指令的间隔时间关联的第三虚拟卡集；在所述第三虚拟卡集中，确定所述目标虚拟卡。进一步的，以上所述的自动切换虚拟卡的方法，所述在所述第一虚拟卡集中确定第一虚拟卡，以使所述第一虚拟卡与所述刷卡终端进行协议交互，包括：按照预设的优先级顺序，在所述第一虚拟卡集中确定第一虚拟卡；检测在所述第一虚拟卡与所述刷卡终端的协议交互过程中，所述刷卡终端是否出现异常；若在所述第一虚拟卡与所述刷卡终端的协议交互过程中，所述刷卡终端出现异常，则根据所述优先级顺序，在所述第一虚拟卡集剩余的虚拟卡中重新确定第一虚拟卡，以使重新确定的第一虚拟卡与所述刷卡终端进行协议交互，直至所述协议交互完成。进一步的，以上所述的自动切换虚拟卡的方法，所述方法还包括：将与所述刷卡终端完成协议交互的第一虚拟卡作为常用虚拟卡，并提升所述常用虚拟卡的优先级顺序。进一步的，以上所述的自动切换虚拟卡的方法，所述在所述第三虚拟卡集中，确定所述目标虚拟卡，包括：按照所述优先级顺序，在所述第三虚拟卡集中确定目标虚拟卡；在所述目标虚拟卡与所述刷卡终端的应用交互中，判断所述刷卡终端是否出现异常；若在所述目标虚拟卡与所述刷卡终端的应用交互中，所述刷卡终端出现异常，则在所述第三虚拟卡集剩余的虚拟卡中重新确定目标虚拟卡，以使重新确定的目标虚拟卡与所述刷卡终端进行应用交互，直至所述应用交互成功。进一步的，以上所述的自动切换虚拟卡的方法，所述方法还包括：将与所述刷卡终端完成应用交互的目标虚拟卡作为常用虚拟卡，并提升所述常用虚拟卡的优先级顺序。进一步的，以上所述的自动切换虚拟卡的方法，所述通信指令信息包括：询卡指令内容。另一方面，本发明还提供了一种自动切换虚拟卡的装置，应用于智能终端设备，所述装置包括：读取模块，用于读取刷卡终端的行为模式信息；确定模块，用于在所有所述虚拟卡中，确定预先与所述行为模式信息关联的目标虚拟卡；卡切换模块，用于使用所述目标虚拟卡与所述刷卡终端进行刷卡交易。另一方面，本发明还提供了一种自动切换虚拟卡的设备，包括处理器和存储器，所述处理器与存储器相连：其中，所述处理器，用于调用并执行所述存储器中存储的程序；所述存储器，用于存储所述程序，所述程序至少用于执行以上任一项所述的自动切换虚拟卡的方法。本发明的自动切换虚拟卡的方法、装置和设备，方法包括：读取刷卡终端的行为模式信息；在所有虚拟卡中，确定预先与行为模式信息关联的目标虚拟卡；使用目标虚拟卡与刷卡终端进行刷卡交易。采用本发明的技术方案，从刷卡终端的行为模式分析出发，确定默认卡，无需刷卡终端升级，节约了建设成本。此外，用户实际拥有的虚拟卡数量有限，使用场景也有限。本方案能够更有针对性地适应用户的日常使用场景，提高默认卡切换成功率。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明自动切换虚拟卡的方法一种实施例提供的流程图；图2是本发明自动切换虚拟卡的装置一种实施例提供的结构示意图；图3是本发明自动切换虚拟卡的设备一种实施例提供的结构示意图；图4是自动切换虚拟卡的系统一种实施例提供的结构示意图。具体实施方式为使本发明的目的、技术方案和优点更加清楚，下面将对本发明的技术方案进行详细的描述。显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动的前提下所得到的所有其它实施方式，都属于本发明所保护的范围。图1是本发明自动切换虚拟卡的方法一种实施例提供的流程图。本实施例的自动切换虚拟卡的方法可以应用于手机、智能手环以及平板电脑等智能终端设备中。如图1所示，本实施例的可以包括以下步骤：S11、读取刷卡终端的行为模式信息。使用智能终端设备中的虚拟卡与刷卡终端进行信息交互的过程中，可以采集刷卡终端的行为模式信息。本实施例中，将智能终端设备中的虚拟卡与刷卡终端的交互分为四个过程，一是通信前的过程、二是开始阶段的协议交互过程，三是中间阶段的应用交互过程，四是最后阶段的交易过程。通信前的过程为刷卡终端发送请求信息进行询卡时，智能终端设备中的虚拟卡未进行答复的阶段，例如发送REQA信息或 REQB信息进行询卡；协议交互过程为智能终端设备中的虚拟卡答复刷卡终端发送的请求信息，并进行协商建立通讯的阶段；应用交互过程是刷卡终端发送第一条应用指令，智能终端设备中的虚拟卡答复的阶段；交易过程是最后进行刷卡扣费的阶段。一般前三个阶段作为询卡阶段。本实施例可以采集通信前的过程、开始阶段的协议交互过程和中间阶段的应用交互过程中刷卡终端的行为模式信息，以便于根据刷卡终端的行为模式信息确定符合要求的虚拟卡，使得符合要求的虚拟卡与刷卡终端完成最后的交易过程。其中，刷卡终端的行为模式信息包括：通信前阶段的询卡模式信息、协议交互阶段的通信指令信息、应用交互阶段的初始应用指令信息，以及，相邻指令的间隔时间。S12、在所有虚拟卡中，确定预先与行为模式信息关联的目标虚拟卡。本实施例中，在所有的虚拟卡中，确定预先与行为模式信息关联的目标虚拟卡，具体包括如下子步骤：子步骤一：在所有虚拟卡中，确定预先与询卡模式信息、通信前阶段相邻指令的间隔时间关联的第一虚拟卡集；子步骤二：在第一虚拟卡集中确定第一虚拟卡，以使第一虚拟卡与刷卡终端进行协议交互；子步骤三：在第一虚拟卡与刷卡终端进行协议交互过程中，确定第一虚拟卡集中与通信指令信息、协议交互阶段相邻指令的间隔时间关联的第二虚拟卡集；子步骤四：在第二虚拟卡集中，确定与初始应用指令信息、应用交互阶段相邻指令的间隔时间关联的第三虚拟卡集；子步骤五：在第三虚拟卡集中，确定目标虚拟卡。具体的，本实施例通过如下内容对上述子步骤进行说明：目前刷卡终端的询卡模式信息一般包括以下几种：第一种是，刷卡终端上电打开磁场，间隔发送REQA和REQB，如此反复；第二种是，刷卡终端上电打开磁场，间隔发送REQA和REQB，下电关闭磁场，再上电打开磁场，如此反复；第三种是，刷卡终端上电打开磁场，连续发送REQA；第四种是，刷卡终端上电打开磁场，连续发送REQA，下电关闭磁场。还有其他变种，比如刷卡终端不使用REQA，而是用WUPA替代；不使用REQB，而是用WUPB替代等。而且，不同类型的刷卡终端在通信前阶段相邻指令的间隔时间也不相同，例如REQA和REQB 或者REQA之间的时间间隔。本实施例中，可以预先将刷卡终端的询卡模式信息、通信前阶段相邻指令的间隔时间与对应的虚拟卡进行关联。当用户携带的智能终端设备靠近刷卡终端并达到刷卡终端的识别范围时，能够检测到刷卡终端的询卡模式信息与通信前阶段相邻指令的间隔时间，如上文，由于刷卡终端的询卡模式信息与通信前阶段相邻指令的间隔时间存在一定的区别，可以在所有虚拟卡中，确定预先与询卡模式信息、通信前阶段相邻指令的间隔时间关联的第一虚拟卡集。在第一虚拟卡集中确定第一虚拟卡，以使第一虚拟卡与刷卡终端进行协议交互。在一些可选的实施例中，可以通过如下步骤确定第一虚拟卡：子步骤一：按照预设的优先级顺序，在第一虚拟卡集中确定第一虚拟卡；子步骤二：检测在第一虚拟卡与刷卡终端的协议交互过程中，刷卡终端是否出现异常；子步骤三：若在第一虚拟卡与刷卡终端的协议交互过程中，刷卡终端出现异常，则根据优先级顺序，在第一虚拟卡集剩余的虚拟卡中重新确定第一虚拟卡，以使重新确定的第一虚拟卡与刷卡终端进行协议交互，直至协议交互完成。具体的，本实施例中预先给每张虚拟卡都设置有优先级顺序，例如可以将使用率高的虚拟卡的等级设置的较高，以便于减少询卡的时间。在第一虚拟卡集中确定优先级顺序最高的虚拟卡作为第一虚拟卡，将第一虚拟卡作为默认卡与刷卡终端进行协议交互。需要说明的是，特定类型的刷卡终端，只能接受相应的虚拟卡。当读取到类型不符的虚拟卡时，通讯中断刷卡终端停止交互，同时刷卡终端可能提示用户错误。因此，一旦发现刷卡终端在通讯过程中的异常，可以判断当前的第一虚拟卡并不是刷卡终端所能接受的卡片，从而可以自动切换其他虚拟卡继续尝试刷卡，尝试找到匹配的虚拟卡。具体的，本实施例采取的策略是，若在第一虚拟卡与刷卡终端的协议交互过程中，刷卡终端出现异常，则根据优先级顺序，在第一虚拟卡集剩余的虚拟卡中重新确定第一虚拟卡，即在第一虚拟卡集剩余的虚拟卡中确定优先级顺序最高的虚拟卡作为重新确定的第一虚拟卡，以使重新确定的第一虚拟卡作为默认卡与刷卡终端进行协议交互，在交互过程中检测刷卡终端是否出现异常，如果出现异常则继续重新确定第一虚拟卡，直至协议交互完成。在第一虚拟卡与刷卡终端进行协议交互过程中，确定第一虚拟卡集中与通信指令信息、协议交互阶段相邻指令的间隔时间关联的第二虚拟卡集。具体的， NFC领域在国内常用的通讯协议是ISO14443的Type A和Type B。Type A协议普遍应用于各行各业，而Type B协议目前仅用于身份证读取。因此，本实施例进一步说明Type A的协议交互过程。此外，Type B的原理相同，本实施例不做赘述。对于Type A协议，刷卡终端与虚拟卡通过协议交互过程建立通讯的具体交互如下：刷卡终端发送REQA，虚拟卡返回ATQA，表示有虚拟卡存在；刷卡终端发送Anticollision，虚拟卡按照防冲撞机制返回UID；刷卡终端发送SELECT，选择虚拟卡。虚拟卡返回SAK，表示被选中。若当前是Mifare卡读卡器，下一步刷卡终端发送Mifare指令，虚拟卡返回响应。若当前是CPU卡读卡器，下一步刷卡终端发送RATS，请求返回ATS。虚拟卡返回ATS。刷卡终端发送应用指令，卡片处理应用指令并返回响应数据。目前，Mifare卡常用于门禁领域，而公交领域都是CPU卡。具体的，刷卡终端发送REQA时，虚拟卡响应的ATQA数据各有不同。比如 Mifare卡常用0x0800作为ATQA值，而CPU卡常使用0x0400作为ATQA的值。因此，刷卡终端有可能在遇到非预期的ATQA的值的时候，不再继续建立通讯连接，而是发送其他命令终止交互或重新上电或重复发送REQA继续询卡。刷卡终端发送SELECT时，虚拟卡响应的SAK也可能有不同的值。比如Mifare卡常用 0x08作为SAK的值，而CPU卡常使用0x20作为SAK值。因此，刷卡终端有可能在遇到非预期的SAK的值的时候，不再继续建立通讯连接，而是发送其他命令终止交互或重新上电或重新发送REQA继续询卡。刷卡终端发送RATS时，虚拟卡响应的ATS也可能有不同的值。ATS中包含很多通讯参数，包括虚拟卡支持的通讯速率，帧大小，以及历史数据等。因此，刷卡终端有可能在遇到非预期的ATS的值的时候，不再继续建立通讯连接，而是发送其他命令终止交互或重新上电或重新发送REQA继续询卡。遇到此类通讯异常的情况，本实施例按照上述的优先级顺序切换下一张虚拟卡作为第一虚拟卡，从而更换ATQA，SAK以及ATS的值，让刷卡终端继续尝试询卡。如果发现某一个虚拟卡的参数能够让刷卡终端完成建立通讯连接，并且后续刷卡成功，则将该卡的优先级提高，以便下一次能够更快完成通讯建立和刷卡。此外，不同类型的刷卡终端，询卡指令间隔也不相同。例如REQA到 Anticollision的时间间隔，Anticollision到SELECT的时间间隔，SELECT到 RATS的时间间隔以及RATS到第一条应用指令的时间间隔。本实施例中，可以预先将刷卡终端的通信指令信息、协议交互阶段相邻指令的间隔时间与与对应的虚拟卡进行关联。如上文，由于刷卡终端的通信指令信息与协议交互阶段相邻指令的间隔时间存在一定的区别，可以进一步在第一虚拟卡集中，确定与通信指令信息、协议交互阶段相邻指令的间隔时间关联的第二虚拟卡集。在第二虚拟卡集中，确定与初始应用指令信息、应用交互阶段相邻指令的间隔时间关联的第三虚拟卡集。具体的，初始应用指令信息为刷卡终端发送的第一条应用命令。刷卡终端发送的第一条应用命令与刷卡终端的类型相关。比如符合交通部规范的刷卡终端，第一条应用命令是选择PPSE，而符合住建部规范的刷卡终端，第一条应用命令可能是选择PSE，或者是选择根目录等。不同刷卡终端在应用交互阶段的相邻指令的间隔时间也不相同，例如RATS 到第一条应用指令的时间间隔。本实施例中，可以预先将刷卡终端的初始应用指令信息、应用交互阶段相邻指令的间隔时间与对应的虚拟卡进行关联。如上文，由于刷卡终端的初始应用指令信息、应用交互阶段相邻指令的间隔时间存在一定区别，可以在第二虚拟卡集中，确定与初始应用指令信息、应用交互阶段相邻指令的间隔时间关联的第三虚拟卡集。进一步的，可以在第三虚拟卡集中，确定目标虚拟卡。具体可以包括如下子步骤：子步骤一：按照优先级顺序，在第三虚拟卡集中确定目标虚拟卡；子步骤二：在目标虚拟卡与刷卡终端的应用交互中，判断刷卡终端是否出现异常；子步骤三：若在目标虚拟卡与刷卡终端的应用交互中，刷卡终端出现异常，则根据优先级顺序，在第三虚拟卡集剩余的虚拟卡中重新确定目标虚拟卡，以使重新确定的目标虚拟卡与刷卡终端进行应用交互，直至应用交互成功。具体的，由于本实施例中预先给每张虚拟卡都设置有优先级顺序，因此可以在第三虚拟卡集中确定优先级顺序最高的虚拟卡作为目标虚拟卡，将目标虚拟卡作为默认卡与刷卡终端进行应用交互。需要说明的是，特定类型的刷卡终端，只能接受相应的虚拟卡。当读取到类型不符的虚拟卡时，通讯中断刷卡终端停止交互，同时刷卡终端可能提示用户错误。因此，发现刷卡终端在通讯过程中的异常，可以判断当前的目标虚拟卡并不是刷卡终端所能接受的虚拟卡，从而可以自动切换其他虚拟卡作为目标虚拟卡继续尝试刷卡，尝试找到匹配的虚拟卡。具体的，本实施例采取的策略是，若在目标虚拟卡与刷卡终端的应用交互中，刷卡终端出现异常，则根据优先级顺序，在第三虚拟卡集剩余的虚拟卡中重新确定目标虚拟卡，即在第三虚拟卡集剩余的虚拟卡中优先级最高的虚拟卡作为重新确定的目标虚拟卡，以使重新确定的目标虚拟卡与刷卡终端进行应用交互，直至应用交互成功。需要说明的是，由于刷卡终端读取到类型不符的虚拟卡时，通讯中断刷卡终端停止交互，因此在本步骤中，刷卡终端出现异常，需要目标虚拟卡重新与刷卡终端进行交互建立通讯，经过协议交互阶段再进入应用交互阶段。将与刷卡终端完成应用交互的目标虚拟卡作为常用虚拟卡，并提升常用虚拟卡的优先级顺序。以便于缩短下一次确定目标虚拟卡的时间。S13、使用目标虚拟卡与刷卡终端进行刷卡交易。确定目标虚拟卡后，可以使用目标虚拟卡作为默认卡与刷卡终端进行后续的刷卡交易。本发明的自动切换虚拟卡的方法、装置和设备，方法包括：读取刷卡终端的行为模式信息；在所有虚拟卡中，确定预先与行为模式信息关联的目标虚拟卡；使用目标虚拟卡与刷卡终端进行刷卡交易。采用本实施例的技术方案，从刷卡终端的行为模式分析出发，确定默认卡，无需刷卡终端升级，节约了建设成本。此外，用户实际拥有的虚拟卡数量有限，使用场景也有限。本方案能够更有针对性地适应用户的日常使用场景，提高默认卡切换成功率。在一些可选的实施例中，需要预先将刷卡终端的行为模式信息和虚拟卡关联。具体可以包括如下步骤：步骤一：在刷卡过程中，若检测到进入刷卡交易阶段后，读取刷卡过程中的刷卡终端的行为模式信息；步骤二：将刷卡过程中的刷卡终端的行为模式信息与刷卡过程中的默认卡关联。在刷卡过程中，若检测到进入刷卡交易阶段，即询卡成功后，可以读取刷卡过程中的刷卡终端的行为模式信息，然后将刷卡过程中的刷卡终端的行为模式信息与刷卡过程中的默认卡关联。具体的，刷卡终端询卡有几种可能的方式，第一种是，上电打开磁场，间隔发送REQA和REQB，如此反复；第二种是，上电打开磁场，间隔发送REQA和 REQB，下电关闭磁场，再上电打开磁场，如此反复；第三种是，上电打开磁场，连续发送REQA；第四种是，上电打开磁场，连续发送REQA，下电关闭磁场。还有其他变种，比如刷卡终端不使用REQA，而是用WUPA替代；不使用REQB，而是用WUPB替代。记录刷卡终端的询卡模式，并准备与当前默认的虚拟卡建立关联。如果后续刷卡成功，则将该询卡模式与当前默认卡建立关联，否则放弃该关联关系。进一步的，可以记录REQA和REQB或者REQA之间的时间间隔。询卡成功后，记录REQA到Anticollision的时间间隔，Anticollision到SELECT的时间间隔，SELECT到RATS的时间间隔以及RATS到第一条应用指令的时间间隔。记录时间间隔，并准备与当前默认的虚拟卡建立关联。如果后续刷卡成功，则将该时间间隔模式与当前默认卡建立关联，否则放弃该关联关系。进一步的，刷卡终端发送的第一条应用命令与刷卡终端的类型相关。比如符合交通部规范的刷卡终端，应用的第一条命令是选择PPSE，而符合住建部规范的刷卡终端，应用的第一条命令可能是选择PSE，或者是选择根目录等。记录第一条应用命令，并准备与当前默认的虚拟卡建立关联。如果后续刷卡成功，则将该时间间隔模式与当前默认卡建立关联，否则放弃该关联关系。基于一个总的发明构思，本发明还提供了一种自动切换虚拟卡的装置，用于实现上述方法实施例。图2是本发明自动切换虚拟卡的装置一种实施例提供的结构示意图。如图 2所示，本实施例的装置包括：读取模块21，用于读取刷卡终端的行为模式信息；确定模块22，用于在所有虚拟卡中，确定预先与行为模式信息关联的目标虚拟卡；卡切换模块23，用于使用目标虚拟卡与刷卡终端进行刷卡交易。进一步的，本实施例的装置还包括关联模块；读取模块21，还用于在刷卡过程中，若检测到进入刷卡交易阶段后，读取刷卡过程中的刷卡终端的行为模式信息；关联模块，用于将刷卡过程中的刷卡终端的行为模式信息与刷卡过程中的默认卡关联。进一步的，刷卡终端的行为模式信息包括：通信前阶段的询卡模式信息、协议交互阶段的通信指令信息、应用交互阶段的初始应用指令信息以及相邻指令的间隔时间；确定模块22，具体用于在所有虚拟卡中，确定预先与询卡模式信息、通信前阶段相邻指令的间隔时间关联的第一虚拟卡集；在第一虚拟卡集中确定第一虚拟卡，以使第一虚拟卡与刷卡终端进行协议交互；在第一虚拟卡与刷卡终端进行协议交互过程中，确定第一虚拟卡集中与通信指令信息、协议交互阶段相邻指令的间隔时间关联的第二虚拟卡集；在第二虚拟卡集中，确定与初始应用指令信息、应用交互阶段相邻指令的间隔时间关联的第三虚拟卡集；在第三虚拟卡集中，确定目标虚拟卡。进一步的，确定模块22，具体用于按照预设的优先级顺序，在第一虚拟卡集中确定第一虚拟卡；检测在第一虚拟卡与刷卡终端的协议交互过程中，刷卡终端是否出现异常；若在第一虚拟卡与刷卡终端的协议交互过程中，刷卡终端出现异常，则根据优先级顺序，在第一虚拟卡集剩余的虚拟卡中重新确定第一虚拟卡，以使重新确定的第一虚拟卡与刷卡终端进行协议交互，直至协议交互完成。进一步的，确定模块22，具体用于将与刷卡终端完成协议交互的第一虚拟卡作为常用虚拟卡，并提升常用虚拟卡的优先级顺序。进一步的，确定模块22，具体用于按照优先级顺序，在第三虚拟卡集中确定目标虚拟卡；在目标虚拟卡与刷卡终端的应用交互中，判断刷卡终端是否出现异常；若在目标虚拟卡与刷卡终端的应用交互中，刷卡终端出现异常，则根据优先级顺序，在第三虚拟卡集剩余的虚拟卡中重新确定目标虚拟卡，以使重新确定的目标虚拟卡与刷卡终端进行应用交互，直至应用交互成功。进一步的，确定模块22，具体用于将与刷卡终端完成应用交互的目标虚拟卡作为常用虚拟卡，并提升常用虚拟卡的优先级顺序。进一步的，通信指令信息包括：询卡指令内容。关于上述实施例中的装置，其中各个模块执行操作的具体方式已经在有关该方法的实施例中进行了详细描述，此处将不做详细阐述说明。基于一个总的发明构思，本发明还提供了一种自动切换虚拟卡的设备，用于实现上述方法实施例。图3是本发明自动切换虚拟卡的设备一种实施例提供的结构示意图。如图 3所示，本实施例的自动切换虚拟卡的设备包括处理器31和存储器32，处理器 31与存储器32相连。其中，处理器31用于调用并执行存储器32中存储的程序；存储器32用于存储程序，程序至少用于执行以上实施例中的自动切换虚拟卡的方法。基于一个总的发明构思，本实施例还提供了一种自动切换虚拟卡的系统。图4是自动切换虚拟卡的系统一种实施例提供的结构示意图。如图4所示，本实施例的自动切换虚拟卡的系统包括安全模块42、NFC天线模块43，以及以上实施例的自动切换虚拟卡的装置41。以上实施例的自动切换虚拟卡的装置41 在自动切换虚拟卡的系统中作为通讯前置模块。其中，通讯前置模块集成为一个嵌入式芯片，负责通过NFC天线模块43 与外部读卡器通讯，同时根据安全模块42中的默认卡的不同，应用不同的通讯参数。在通讯前置模块实现以上实施例的自动切换虚拟卡的方法，而虚拟卡的真实切换状态是在安全模块42中进行的，而刷卡交易是在安全模块42中对应的虚拟卡中实现的。可以理解的是，上述各实施例中相同或相似部分可以相互参考，在一些实施例中未详细说明的内容可以参见其他实施例中相同或相似的内容。需要说明的是，在本发明的描述中，术语“第一”、“第二”等仅用于描述目的，而不能理解为指示或暗示相对重要性。此外，在本发明的描述中，除非另有说明，“多个”的含义是指至少两个。流程图中或在此以其他方式描述的任何过程或方法描述可以被理解为，表示包括一个或更多个用于实现特定逻辑功能或过程的步骤的可执行指令的代码的模块、片段或部分，并且本发明的优选实施方式的范围包括另外的实现，其中可以不按所示出或讨论的顺序，包括根据所涉及的功能按基本同时的方式或按相反的顺序，来执行功能，这应被本发明的实施例所属技术领域的技术人员所理解。应当理解，本发明的各部分可以用硬件、软件、固件或它们的组合来实现。在上述实施方式中，多个步骤或方法可以用存储在存储器中且由合适的指令执行系统执行的软件或固件来实现。例如，如果用硬件来实现，和在另一实施方式中一样，可用本领域公知的下列技术中的任一项或他们的组合来实现：具有用于对数据信号实现逻辑功能的逻辑门电路的离散逻辑电路，具有合适的组合逻辑门电路的专用集成电路，可编程门阵列，现场可编程门阵列 等。本技术领域的普通技术人员可以理解实现上述实施例方法携带的全部或部分步骤是可以通过程序来指令相关的硬件完成，所述的程序可以存储于一种计算机可读存储介质中，该程序在执行时，包括方法实施例的步骤之一或其组合。此外，在本发明各个实施例中的各功能单元可以集成在一个处理模块中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个模块中。上述集成的模块既可以采用硬件的形式实现，也可以采用软件功能模块的形式实现。所述集成的模块如果以软件功能模块的形式实现并作为独立的产品销售或使用时，也可以存储在一个计算机可读取存储介质中。上述提到的存储介质可以是只读存储器，磁盘或光盘等。在本说明书的描述中，参考术语“一个实施例”、“一些实施例”、“示例”、“具体示例”、或“一些示例”等的描述意指结合该实施例或示例描述的具体特征、结构、材料或者特点包含于本发明的至少一个实施例或示例中。在本说明书中，对上述术语的示意性表述不一定指的是相同的实施例或示例。而且，描述的具体特征、结构、材料或者特点可以在任何的一个或多个实施例或示例中以合适的方式结合。尽管上面已经示出和描述了本发明的实施例，可以理解的是，上述实施例是示例性的，不能理解为对本发明的限制，本领域的普通技术人员在本发明的范围内可以对上述实施例进行变化、修改、替换和变型。
