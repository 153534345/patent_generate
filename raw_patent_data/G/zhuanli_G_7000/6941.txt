标题title
新型智能多点数工业互联网远程输入输出控制器及方法
摘要abst
本发明涉及新型智能多点数工业互联网远程输入输出控制方法，包括以下：为主模块以及与其关联的扩展模块分配唯一地址；对输入输出控制器上电，判断整个输入输出控制器中是否接入扩展模块，若是则进行扩展模块识别流程，确定扩展模块的总数量，若否，则控制主模块独立工作。主模块通过该协议发现并更新“扩展模块列表”的唯一地址，并分配给新的扩展模块，无需人为干预，智能终端阻抗匹配电路参与识别过程，能有效保证扩展模块识别当中不会丢失位于链路中间的扩展模块，提高系统运行的鲁棒性与完整性；扩展模块因故障更换，新换上的型号扩展模块不需要人为干预，主模块自动识别，并为其设定其为原模块的地址，保证控制系统的主站程序不需要修改。
权利要求书clms
1.新型智能多点数工业互联网远程输入输出控制方法，其特征在于，包括以下：为主模块以及与其关联的扩展模块分配唯一地址；对输入输出控制器上电，判断整个输入输出控制器中是否接入扩展模块，若是则进行扩展模块识别流程，确定扩展模块的总数量，若否，则控制主模块独立工作。2.根据权利要求1所述的新型智能多点数工业互联网远程输入输出控制方法，其特征在于，具体的，所述为主模块以及与其关联的扩展模块分配唯一地址包括以下，于主模块中创建扩展模块列表，并为主模块预定义第一地址；依照序号的先后顺序将扩展模块的地址、模块类型、输出口端以及输入口端进行相互关联，完成扩展模块列表的构建。3.根据权利要求2所述的新型智能多点数工业互联网远程输入输出控制方法，其特征在于，具体的，所述判断整个输入输出控制器中是否接入扩展模块包括以下，在主模块上电初始化后，获取其输出使能信号的电平属性，若电平属性为低电平，则表示接入有扩展模块，若电平属性为高电平，则表示未接入扩展模块。4.根据权利要求3所述的新型智能多点数工业互联网远程输入输出控制方法，其特征在于，具体的，所述扩展模块识别流程包括以下，于主模块处基于级联握手总线对扩展模块发出空地址查询命令；获取扩展模块地址以及类型信息，根据获取各个扩展模块反馈的信息的时间先后顺序，在扩展模块列表中依次查询并生成固定地址；根据反馈的信息总数获取扩展模块的总数量，结束扩展模块识别流程。5.根据权利要求4所述的新型智能多点数工业互联网远程输入输出控制方法，其特征在于，所述方法还包括，在扩展模块列表中依次查询并生成固定地址时，还会对扩展模块地址与列表生成地址进行核对，当出现扩展模块地址与列表生成地址不符的情况时，控制扩展模块地址与列表生成地址一致，具体的，在扩展模块从级联握手总线处获取空地址查询命令，判断自身存储的通讯地址是否已被设定：若是，则以所述通讯地址为源地址从高速通讯总线向主模块发出自身模块类型信息，然后再通过级联握手总线向下一级传递空地址查询命令；若否，则不向下一级传递空地址查询命令，设置自己的地址为特定临时地址，并以该特定临时地址为源地址从高速通讯总线上向主模块发出自身模块类型信息；主模块收到临时地址的扩展模块信息后，查询扩展模块列表中模块类型和地址信息，为其生成固定地址，并向特定临时地址的扩展模块发送地址设定命令；当特定临时地址的扩展模块收到地址设定命令后，将自身地址修改为主模块发送的新固定地址，并以新的地址为源地址向主模块发出地址修改成功信息；新地址设置完成后，才通过级联握手总线下一级扩展模块传递空地址查询命令，自身则准备进入高速总线通讯的工作流程。6.新型智能多点数工业互联网远程输入输出控制器，其特征在于，包括以下：主模块以及多个扩展模块，所述主模块包括扩展接口-输出，所述扩展模块包括扩展接口-输出以及扩展接口-输入，所述主模块通过扩展接口-输出与所述扩展模块的扩展接口-输入通过级联握手总线连接，扩展模块之间通过扩展接口-输出与扩展接口-输入基于级联握手总线连接连接，所述主模块以及扩展模块还分别接入高速通讯总线。7.根据权利要求6所述的新型智能多点数工业互联网远程输入输出控制器，其特征在于，具体的，所述主模块包括如下，多路输入/输出控制电路，用于信号的输入/输出；高速隔离电路，一端与所述多路输入/输出控制电路连接，用于加快信号的传输速度；主控MCU，与所述高速隔离电路的另一端连接；高速通讯电路，一端与所述主控MCU连接，用于加快信号的传输速度；扩展接口-输出，与所述高速通讯电路的另一端连接，用于将所述主控MCU产生的使能信号输出；电源管理模块，与所述扩展接口-输出连接，用于为整个主模块进行供电；加密电路，与所述主控MCU连接，用于进行IP加密处理。8.根据权利要求7所述的新型智能多点数工业互联网远程输入输出控制器，其特征在于，具体的，所述扩展模块包括如下，多路输入/输出控制电路，用于信号的输入/输出；高速隔离电路，一端与所述多路输入/输出控制电路连接，用于加快信号的传输速度；主控MCU，与所述高速隔离电路的另一端连接；高速通讯电路，一端与所述主控MCU连接，用于加快信号的传输速度；扩展接口-输入，与所述高速通讯电路的另一端连接，用于接入Ext_Con’信号；扩展接口-输出，与所述主控MCU连接，用于输出所述MCU产生的Ext_Con信号电源模块，与所述扩展接口-输出连接，用于对所述扩展模块进行供电。9.根据权利要求8所述的新型智能多点数工业互联网远程输入输出控制器，其特征在于，所述输入输出控制器还包括智能终端电阻匹配电路，所述智能终端阻抗匹配电路设置于主模块以及扩展模块的主MCU与高速通讯总线之间，所述智能终端电阻匹配电路包括终端匹配电阻Rd，所述终端匹配电阻Rd一端接入X通讯信号线，另一端与光电开关U4的3号接口连接，所述光电开关U4的4号接口连接Y通讯信号线；所述光电开关U4的2号接口连接MOS管Q1的3号引脚，所述MOS管Q1的2号引脚分别连接电容C20的一端以及接地，所述电容C20的另一端分别连接所述MOS管Q1的1号引脚以及电阻R19的一端，所述电阻R19的另一端分别连接电阻R4的一端以及电源，所述电阻R4的另一端连接所述光电开关U4的1号接口。10.根据权利要求8所述的新型智能多点数工业互联网远程输入输出控制器，其特征在于，所述主模块以及扩展模块还包括，CAN/SPI接口，设置于所述主模块以及扩展模块的主控MCU处，用于进行CAN或SPI通信。
说明书desc
技术领域本发明涉及工业自动化技术领域，尤其涉及新型智能多点数工业互联网远程输入输出控 制器及方法。背景技术智能多点数工业互联网远程输入输出控制器产品可以广泛应用于工业自动化系统中，配 合主站或者PLC可以实现各种自动控制、运动控制功能。例如：自动化设备、机器人、机械 臂、大型工程车、楼宇自动化，等等。传统的输入输出控制器产品传输速度较低，且扩展模块在识别时容易出现问题导致系统 的鲁棒性与完整性不高，诸如扩展模块因故障更换，需要进行人为干预更新地址以使能继续 使用以及链路中间的扩展模块容易丢失。发明内容本发明的目的是为了至少解决现有技术的不足之一，提供新型智能多点数工业互联网远 程输入输出控制器及方法。为了实现上述目的，本发明采用以下的技术方案：具体的，提出新型智能多点数工业互联网远程输入输出控制方法，包括以下：为主模块以及与其关联的扩展模块分配唯一地址；对输入输出控制器上电，判断整个输入输出控制器中是否接入扩展模块，若是则进行扩 展模块识别流程，确定扩展模块的总数量，若否，则控制主模块独立工作。进一步，具体的，所述为主模块以及与其关联的扩展模块分配唯一地址包括以下，于主模块中创建扩展模块列表，并为主模块预定义第一地址；依照序号的先后顺序将扩展模块的地址、模块类型、输出口端以及输入口端进行相互关 联，完成扩展模块列表的构建。进一步，具体的，所述判断整个输入输出控制器中是否接入扩展模块包括以下，在主模块上电初始化后，获取其输出使能信号的电平属性，若电平属性为低电平，则表 示接入有扩展模块，若电平属性为高电平，则表示未接入扩展模块。进一步，具体的，所述扩展模块识别流程包括以下，于主模块处基于级联握手总线对扩展模块发出空地址查询命令；获取扩展模块地址以及类型信息，根据获取各个扩展模块反馈的信息的时间先后顺序， 在扩展模块列表中依次查询并生成固定地址；根据反馈的信息总数获取扩展模块的总数量，结束扩展模块识别流程。进一步，所述方法还包括，在扩展模块列表中依次查询并生成固定地址时，还会对扩展 模块地址与列表生成地址进行核对，当出现扩展模块地址与列表生成地址不符的情况时，控制扩展模块地址与列表生成地址 一致，具体的，在扩展模块从级联握手总线处获取空地址查询命令，判断自身存储的通讯地址是否已被 设定：若是，则以所述通讯地址为源地址从高速通讯总线向主模块发出自身模块类型信息，然 后再通过级联握手总线向下一级传递空地址查询命令；若否，则不向下一级传递空地址查询命令，设置自己的地址为特定临时地址，并以该特 定临时地址为源地址从高速通讯总线上向主模块发出自身模块类型信息；主模块收到临时地址的扩展模块信息后，查询扩展模块列表中模块类型和地址信息，为 其生成固定地址，并向特定临时地址的扩展模块发送地址设定命令；当特定临时地址的扩展模块收到地址设定命令后，将自身地址修改为主模块发送的新固 定地址，并以新的地址为源地址向主模块发出地址修改成功信息；新地址设置完成后，才通过级联握手总线下一级扩展模块传递空地址查询命令，自身则 准备进入高速总线通讯的工作流程。本发明还提出新型智能多点数工业互联网远程输入输出控制器，包括以下：主模块以及多个扩展模块，所述主模块包括扩展接口-输出，所述扩展模块包括扩展接口 -输出以及扩展接口-输入，所述主模块通过扩展接口-输出与所述扩展模块的扩展接口-输入 通过级联握手总线连接，扩展模块之间通过扩展接口-输出与扩展接口-输入基于级联握手总 线连接连接，所述主模块以及扩展模块还分别接入高速通讯总线。进一步，具体的，所述主模块包括如下，多路输入/输出控制电路，用于信号的输入/输出；高速隔离电路，一端与所述多路输入/输出控制电路连接，用于加快信号的传输速度；主控MCU，与所述高速隔离电路的另一端连接；高速通讯电路，一端与所述主控MCU连接，用于加快信号的传输速度；扩展接口-输出，与所述高速通讯电路的另一端连接，用于将所述主控MCU产生的使能信 号输出；电源管理模块，与所述扩展接口-输出连接，用于为整个主模块进行供电；加密电路，与所述主控MCU连接，用于进行I P加密处理。进一步，具体的，所述扩展模块包括如下，多路输入/输出控制电路，用于信号的输入/输出；高速隔离电路，一端与所述多路输入/输出控制电路连接，用于加快信号的传输速度；主控MCU，与所述高速隔离电路的另一端连接；高速通讯电路，一端与所述主控MCU连接，用于加快信号的传输速度；扩展接口-输入，与所述高速通讯电路的另一端连接，用于接入Ext_Con’信号；扩展接口-输出，与所述主控MCU连接，用于输出所述MCU产生的Ext_Con信号电源模块，与所述扩展接口-输出连接，用于对所述扩展模块进行供电。进一步，所述输入输出控制器还包括智能终端电阻匹配电路，所述智能终端阻抗匹配电 路设置于主模块以及扩展模块的主MCU与高速通讯总线之间，所述智能终端电阻匹配电路包括终端匹配电阻Rd，所述终端匹配电阻Rd一端接入X通 讯信号线，另一端与光电开关U4的3号接口连接，所述光电开关U4的4号接口连接Y通讯信号线；所述光电开关U4的2号接口连接MOS管Q1的3号引脚，所述MOS管Q1的2号引脚 分别连接电容C20的一端以及接地，所述电容C20的另一端分别连接所述MOS管Q1的1号引 脚以及电阻R19的一端，所述电阻R19的另一端分别连接电阻R4的一端以及电源，所述电阻 R4的另一端连接所述光电开关U4的1号接口。进一步，所述主模块以及扩展模块还包括，CAN/SPI接口，设置于所述主模块以及扩展模块的主控MCU处，用于进行CAN或SPI通 信。本发明的有益效果为：本发明提出新型智能多点数工业互联网远程输入输出控制方法，本发明通过将空地址查 询命令在低速级联握手总线上通讯，其余的通讯，包括地址修改、确认等所有交互信息均在 高速通讯总线上完成，耗时极少，本发明可以依模块类型定义扩展模块地址，从实现扩展模 块地址分类，这样可以实现一个命令操作所有同类型扩展模块的效果，实时性大大提高；主 模块均可以通过该协议发现并更新“扩展模块列表”的唯一地址，并分配给新的扩展模块， 无需人为干预，智能终端阻抗匹配电路参与识别过程，能有效保证扩展模块识别当中不会丢 失位于链路中间的扩展模块，提高系统运行的鲁棒性与完整性；如果扩展模块因故障更换， 新换上的型号扩展模块不需要人为干预，主模块自动识别，并为其设定其为原模块的地址， 这样保证了控制系统的主站程序不需要修改。附图说明通过对结合附图所示出的实施方式进行详细说明，本公开的上述以及其他特征将更加明 显，本公开附图中相同的参考标号表示相同或相似的元素，显而易见地，下面描述中的附图 仅仅是本公开的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下， 还可以根据这些附图获得其他的附图，在附图中：图1所示为本发明新型智能多点数工业互联网远程输入输出控制方法的流程图；图2所示为本发明新型智能多点数工业互联网远程输入输出控制器的主模块的结构框 图；图3所示为本发明新型智能多点数工业互联网远程输入输出控制器的扩展模块的结构框 图；图4所示为本发明新型智能多点数工业互联网远程输入输出控制器的智能终端阻抗匹配 扩展连接示意图；图5所示为本发明新型智能多点数工业互联网远程输入输出控制器的智能终端阻抗匹配 电路示意图；图6所示为本发明新型智能多点数工业互联网远程输入输出控制器的高速通讯电路框 图；图7所示为本发明新型智能多点数工业互联网远程输入输出控制器的串行输入/并行输 出的结构原理图；图8所示为本发明新型智能多点数工业互联网远程输入输出控制器的并行输入/串行输 出的结构原理图；图9所示为本发明新型智能多点数工业互联网远程输入输出控制器的扩展模块数量识别 电路的主模块与扩展模块之间的连接关系示意图；图10所示为本发明新型智能多点数工业互联网远程输入输出控制器的扩展模块之间的 连接关系示意图。具体实施方式以下将结合实施例和附图对本发明的构思、具体结构及产生的技术效果进行清楚、完整 的描述，以充分地理解本发明的目的、方案和效果。需要说明的是，在不冲突的情况下，本 申请中的实施例及实施例中的特征可以相互组合。附图中各处使用的相同的附图标记指示相 同或相似的部分。参照图1、图4、图5以及图6，实施例1，本发明提出新型智能多点数工业互联网远程输入输出控制方法，包括以下：为主模块以及与其关联的扩展模块分配唯一地址；对输入输出控制器上电，判断整个输入输出控制器中是否接入扩展模块，若是则进行扩 展模块识别流程，确定扩展模块的总数量，若否，则控制主模块独立工作。作为本发明的优选实施方式，具体的，所述为主模块以及与其关联的扩展模块分配唯一 地址包括以下，于主模块中创建扩展模块列表，并为主模块预定义第一地址；依照序号的先后顺序将扩展模块的地址、模块类型、输出口端以及输入口端进行相互关 联，完成扩展模块列表的构建。在本优选实施方式中，扩展模块识别协议工作原理如下：主模块与扩展模块采取一对多的高速通讯模式，所以该系统里面所有模块的地址都必须 唯一。例如，主模块的地址，可以提前设置为0x0001；扩展模块默认都只用往这个目的地址 发送信息，主模块就可以收到。主模块中程序需要创建一个“扩展模块列表”，用来记录扩展模块的相关信息：例如： 序号、地址、模块类型、输出端口、输入端口。。。等等。在保证唯一性的前提下，扩展模块地址的生成规则，可以根据应用场景，灵活设置，多种多样。这里仅列举两个例子：可以采用“模块类型+列表序号”的方式，如下可取的地址生成规则表：扩展模块列表可取的地址生成规则也可采用“模块类型+模块在列表中同类型的次序”的方式，如下可取的地址生 成规则表：扩展模块列表可取的地址生成规则作为本发明的优选实施方式，具体的，所述判断整个输入输出控制器中是否接入扩展模 块包括以下，在主模块上电初始化后，获取其输出使能信号的电平属性，若电平属性为低电平，则表 示接入有扩展模块，若电平属性为高电平，则表示未接入扩展模块。作为本发明的优选实施方式，具体的，所述扩展模块识别流程包括以下，于主模块处基于级联握手总线对扩展模块发出空地址查询命令；获取扩展模块地址以及类型信息，根据获取各个扩展模块反馈的信息的时间先后顺序， 在扩展模块列表中依次查询并生成固定地址；根据反馈的信息总数获取扩展模块的总数量，结束扩展模块识别流程。作为本发明的优选实施方式，所述方法还包括，在扩展模块列表中依次查询并生成固定 地址时，还会对扩展模块地址与列表生成地址进行核对，当出现扩展模块地址与列表生成地址不符的情况时，控制扩展模块地址与列表生成地址 一致，具体的，在扩展模块从级联握手总线处获取空地址查询命令，判断自身存储的通讯地址是否已被 设定：若是，则以所述通讯地址为源地址从高速通讯总线向主模块发出自身模块类型信息，然 后再通过级联握手总线向下一级传递空地址查询命令；若否，则不向下一级传递空地址查询命令，设置自己的地址为特定临时地址，并以该特 定临时地址为源地址从高速通讯总线上向主模块发出自身模块类型信息；主模块收到临时地址的扩展模块信息后，查询扩展模块列表中模块类型和地址信息，为 其生成固定地址，并向特定临时地址的扩展模块发送地址设定命令；当特定临时地址的扩展模块收到地址设定命令后，将自身地址修改为主模块发送的新固 定地址，并以新的地址为源地址向主模块发出地址修改成功信息；新地址设置完成后，才通过级联握手总线下一级扩展模块传递空地址查询命令，自身则 准备进入高速总线通讯的工作流程。具体的，本发明的优选实施方式的详细流程描述如下：主模块上电初始化以后，首先判断其Ext_Con为高电平，还是低电平，如果是低电平， 说明有扩展模块，需要识别扩展模块数量及类型；否则，独立工作。如果主模块检测出有扩展模块：首先，主模块把高速通讯总线接收寄存器清空，准备接收。同时把“扩展模块列表”的数据指针指向序号为1的首条记录，pRecord-＞1；然后主模块在级联握手总线上向扩展模块1发出“空地址查询命令”，扩展模块1从级联握手总线通讯口A收到命令，然后根据自身EEPROM的通讯地址是否为空/无效，决 定是否向下一级传递“空地址查询命令”。如果扩展模块1本身存储的通讯地址不是空/无效地址，则以该存储通讯地址为源地址在高速通讯总线上，向主模块发送自身模块类型信息。主模块收到“存储通讯地址”的扩展模块信息后，就查询“扩展模块列表”中 序号1记录的模块类型和地址信息，根据收到扩展模块回应报文的模块类型，以既定的规则 为其生成固定的唯一地址。如果列表原来的信息与新收到的信息及生成的地址不一致，则更 新“扩展模块列表”中序号1的记录。如果“存储通讯地址”与“扩展模块列表”中序号1的记录地址一致，则 主模块立即将列表数据指针指向下一条数据，并以“存储通讯地址”为 目标地址，向扩展模块1发出确认信息。在扩展模块1收到主模块确认地址OK信息后，再 通过级联握手总线通讯口B向下一级传递“空地址查询命令”；如果“存储通讯地址”与“扩展模块列表”中序号1的记录地址不一致， 则在高速通讯总线上向“存储通讯地址”扩展模块发出地址设定命令及列表序号1的唯一地 址；当扩展模块1收到主模块地址设定命令及唯一地址后，就把本身地址 修改为主模块发送的唯一地址，并覆盖EEPROM保存的旧地址，完成地址更新。然后，扩展模块1以新地址为源地址在高速通讯总线上向主模块发回 地址修改成功信息；主模块收到扩展模块1发回的地址修改成功信息后，以新地址为目标 地址，向扩展模块1发出确认信息，并立即将“扩展模块列表”列表数据指针指向下一条数 据；在扩展模块1收到主模块确认地址OK信息后，确认新地址设置完成。 再通过级联握手总线通讯口B向下一级传递“空地址查询命令”；如果本身存储的通讯地址为空/无效地址，则暂时不向下一级传递“空地址查询命令”。而是在RAM里面设置自己的地址为“特定临时地址”，并以该临时地址为源地址 在高速通讯总线上向主模块发出自身模块类型信息；主模块收到“特定临时地址”的扩展模块信息后，就查询“扩展模块列表”中序号 1记录的模块类型和地址信息，根据收到扩展模块回应报文的模块类型，以既定的规则为其生成固定的唯一地址，并更新“扩展模块列表”中序号1的记录及列表数据指针指向下一条数据。再在高速通讯总线上向“特定临时地址”扩展模块发出地址设定 命令及列表生成的唯一地址；当扩展模块1收到主模块地址设定命令及唯一地址后，就把本身地址修改为主模块 发送的唯一地址，并写入EEPROM保存。然后，扩展模块1以新地址为源地址在高速通讯总线上向主模块发回地址修改成功 信息；当扩展模块收到主模块回应的确认地址OK信息后，确认新地址设置完成。最后，扩展模块1才通过级联握手总线通讯口B向下一级传递“空地址查询命令”。然后，扩展模块2重复上述流程；……一直到最末端的第n个扩展模块n，由于只有最末端的扩展模块中智能终端阻抗匹配电 路给出的Ext_Con信号为高电平，所以扩展模块n知道自己为最末端一个扩展模块。扩展模块n从级联握手总线通讯口A收到“空地址查询命令”，然后判断自身EEPROM的通讯地址是否为空/无效。如果扩展模块n本身存储的通讯地址不是空/无效地址，则以该“存储通讯地址”为源地址在高速通讯总线上，向主模块发送“自身模块类型信息+扩展模块识别结束命令”。主模块收到上述模块信息后，就知道扩展模块n是最后一个扩展模块，从而知 道扩展模块的总数量为n。进一步查询“扩展模块列表”中序号n记录的模块类型和地址信 息，根据收到扩展模块回应报文的模块类型，以既定的规则为其生成固定的唯一地址。如果 列表原来的信息与新收到的信息及生成的地址不一致，则更新“扩展模块列表”中序号n的 记录。如果“存储通讯地址”与“扩展模块列表”中序号n的记录地址一致，则 主模块以“存储通讯地址”为目标地址，向扩展模块n发出确认信息，并结束扩展模块数量 识别流程。在扩展模块n收到主模块确认地址OK信息后，结束地址识别流程，进入主工作 流程，等待主模块从高速通讯总线发出的工作命令。如果“存储通讯地址”与“扩展模块列表”中序号n的记录地址不一致， 则在高速通讯总线上向“存储通讯地址”扩展模块发出地址设定命令及列表序号n的唯一地 址；当扩展模块n收到主模块地址设定命令及唯一地址后，就把本身地址 修改为主模块发送的唯一地址，并覆盖EEPROM保存的旧地址，完成地址更新。然后，扩展模块n以新地址为源地址在高速通讯总线上向主模块发回 地址修改成功信息；主模块收到扩展模块n发回的地址修改成功信息后，以新地址为目标 地址，向扩展模块n发出确认信息，并结束扩展模块数量识别流程；在扩展模块n收到主模块确认地址OK信息后，确认新地址设置完成。 结束地址识别流程，进入主工作流程，等待主模块从高速通讯总线发出的工作命令。如果本身存储的通讯地址为空/无效地址，就在RAM里面设置自己的地址为“特定临时地址”，并以该临时地址为源地址在 高速通讯总线上向主模块发出“自身模块类型信息+扩展模块识别结束命令”。主模块收到上述模块信息后，就知道扩展模块n是最后一个扩展模块，从而知道扩展模块的总数量为n。进一步查询“扩展模块列表”中序号n记录的模块类型和地址信息， 根据收到扩展模块回应报文的模块类型，以既定的规则为其生成固定的唯一地址，并更新“扩展模块列表”中序号n的记录。再在高速通讯总线上向“特定临时地址”扩展模块发出地址设定命令及列表生成的唯一地址；当扩展模块n收到主模块地址设定命令及唯一地址后，就把本身地址修改为主模块 发送的唯一地址，并写入EEPROM保存。然后，扩展模块n以新地址为源地址在高速通讯总线上向主模块发回地址修改成功 信息；主模块收到该新地址发回的地址修改成功信息后，以该新地址为目标地址，向扩展 模块n发出确认信息，并结束扩展模块数量识别流程。当扩展模块收到主模块回应的确认地址OK信息后，确认新地址设置完成，结束地址识别流程，进入主工作流程，等待主模块从高速通讯总线发出的工作命令。这个扩展模块识别协议的优势在于：除了“空地址查询命令”在低速级联握手总线上通讯，其余的通讯，包括地址修改、确 认等所有交互信息均在高速通讯总线上完成，耗时极少；由主模块按既定规则，为扩展模块生成唯一地址，记录在“扩展模块列表”。该地址生 成方式可以根据应用场景灵活多样。主模块将“扩展模块列表”的唯一地址，一对一分配给级联的扩展模块。这样在扩展模 块识别过程当中，就验证了扩展模块和主模块间高速通讯是否畅通。从而确保后面的正常工 作流程中，每一个地址都可以以跟主模块正常通讯；可以依模块类型定义扩展模块地址，从实现扩展模块地址分类，这样可以实现一个命令 操作所有同类型扩展模块的效果，实时性大大提高；只在系统初始化后，短暂的准备时间工作，正常工作时不起作用，不占资源；如果扩展模块因故障更换，新换上的型号扩展模块不需要人为干预，主模块自动识别， 并为其设定其为原模块的地址，这样保证了控制系统的主站程序不需要修改。如果设计变更，需要增加或者更换新的模块，每次系统上电，主模块均可以通过该协议 发现并更新“扩展模块列表”的唯一地址，并分配给新的扩展模块，无需认为干预。智能终端阻抗匹配电路参与识别过程，能有效保证扩展模块识别当中不会丢失位于链路 中间的扩展模块，提高系统运行的鲁棒性与完整性。本发明还提出新型智能多点数工业互联网远程输入输出控制器，包括以下：主模块以及多个扩展模块，所述主模块包括扩展接口-输出，所述扩展模块包括扩展接口 -输出以及扩展接口-输入，所述主模块通过扩展接口-输出与所述扩展模块的扩展接口-输入 通过级联握手总线连接，扩展模块之间通过扩展接口-输出与扩展接口-输入基于级联握手总 线连接连接，所述主模块以及扩展模块还分别接入高速通讯总线。参照图2，作为本发明的优选实施方式，具体的，所述主模块包括如下，多路输入/输出控制电路，用于信号的输入/输出；高速隔离电路，一端与所述多路输入/输出控制电路连接，用于加快信号的传输速度；具 体的，高速隔离电路包括基于CA-IS3720HS、CBMuD1200LAS8或ADUM120N0芯片构成的隔离 IC。主控MCU，与所述高速隔离电路的另一端连接；高速通讯电路，一端与所述主控MCU连接，用于加快信号的传输速度；扩展接口-输出，与所述高速通讯电路的另一端连接，用于将所述主控MCU产生的使能信 号输出；电源管理模块，与所述扩展接口-输出连接，用于为整个主模块进行供电；加密电路，与所述主控MCU连接，用于进行I P加密处理。加密电路包括基于ATSHA204 或ATECC508芯片的相关电路。在本优选实施方式中，采用基于ATSHA204或ATECC508芯片的 相关电路所形成的加密电路，当然其他能够支撑本方案的电路也是可以的。参照图3，作为本发明的优选实施方式，具体的，所述扩展模块包括如下，多路输入/输出控制电路，用于信号的输入/输出；高速隔离电路，一端与所述多路输入/输出控制电路连接，用于加快信号的传输速度；主控MCU，与所述高速隔离电路的另一端连接；高速通讯电路，一端与所述主控MCU连接，用于加快信号的传输速度；扩展接口-输入，与所述高速通讯电路的另一端连接，用于接入Ext_Con’信号；扩展接口-输出，与所述主控MCU连接，用于输出所述MCU产生的Ext_Con信号电源模块，与所述扩展接口-输出连接，用于对所述扩展模块进行供电。电源模块用于为扩展模块提供优质的的隔离电源，输入12～36Vdc，输出5V/1200mA。主 体模块能独立供给5个扩展模块所需的电力能源，超过这个数量，就需要增加电源模块。电 源模块的扩展接口与扩展模块完全一致，除了供给电源，不影响系统的通讯与扩展。参照图7其中，多路输出：串行输入/并行输出DIN----串行数据输入RL-----使能输入数据装载到并行输出口CLK----时钟SQ-----串行输出Qn-----并行输出端n采用的芯片如下：74HC595或者类似功能ic参照图8，多路输入：并行输入/串行输出DOUT----串行数据输出RL-----使能并行输入数据装载到串行寄存器CLK----时钟SQ-----串行输入Qn-----并行输入端n采用的芯片如下：74HC165或者类似功能ic作为本发明的优选实施方式，所述输入输出控制器还包括智能终端电阻匹配电路，所述 智能终端阻抗匹配电路设置于主模块以及扩展模块的主MCU与高速通讯总线之间，高速通讯采用全双工4线制通讯机制，起始端终端匹配电阻Ra、Ra’位于主模块上，有 效终端匹配电阻Rb、Rb’位于最末端扩展模块n上。因其他扩展模块上的终端匹配电阻无效，故没有画出。根据实际实时性要求也可以采取半双工2线制通讯机制，可以省掉两个匹配电阻和两根通讯线。驱动芯片可以采用200M～100Mbps的M-LVDS驱动芯片，例如SN65MLVD203B/SN65MLVD206B；也可以采用20M～16Mbps的RS-485驱动芯片例如 TPT481/SP3077E/SP3078E等。以简化高速通讯方式为半双工2线制方式，以达到简明说明模块数量识别及协议流程的 目的。如图所示：Ra为起始端终端匹配电阻，位于主模块上；Rbi为末端终端匹配电阻，位于每一个扩展模块上，最有最末端扩展模块上的 Rbn起作用；图9中下面通讯链路为：为级联握手总线示意图，通讯收发驱动电路可以采用低速的RS-485驱动芯片。从上文中描述的智能终端阻抗匹配电路工作原理，知道：每一个扩展模块有两个扩展接 口，左边的扩展接口叫做输入扩展口，连接主模块或者上一级扩展模块，右边的叫做输出扩 展口，用来连接下一级扩展模块。输入口的Ext_Con’信号接地，其物理位置恰好与输出扩 展口的Ext_Con信号镜像相同，Ext_Con信号默认为高电平，同时接入MCU的一个输入引脚。 当扩展模块i右侧输出口与外接扩展模块i+1的左侧输入口对接时，由于i模块输出口Ext_Coni 信号与i+1模块输入口Ext_Con’i+1信号连接器位置刚好镜像相同，两个信号引脚连接起来， 所以i模块的Ext_Coni被Ext_Con’i+1拉低，均为低电平。其匹配电阻Rdi不起作用。程序中通过判断MCU输入引脚上Ext_Con为高电平，还是低电平，从而可以确认自身 是否位于扩展连接中的最末端。智能终端阻抗匹配电路设计原理决定了：只有位于最末端扩 展模块的Ext_Con信号才会为高电平，其匹配电阻Rdi才起作用。所以，程序中检测到Ext_Con 为高电平时，就表示其为扩展模块的最末端。。所述智能终端电阻匹配电路包括终端匹配电阻Rd，所述终端匹配电阻Rd一端接入X通 讯信号线，另一端与光电开关U4的3号接口连接，所述光电开关U4的4号接口连接Y通讯信号线；所述光电开关U4的2号接口连接MOS管Q1的3号引脚，所述MOS管Q1的2号引脚 分别连接电容C20的一端以及接地，所述电容C20的另一端分别连接所述MOS管Q1的1号引 脚以及电阻R19的一端，所述电阻R19的另一端分别连接电阻R4的一端以及电源，所述电阻 R4的另一端连接所述光电开关U4的1号接口。参照图9以及图10，在本优选实施方式中，该电路的作用是：保证仅使位于通讯链路最 末端的那个扩展模块上的终端阻抗匹配电路起作用。该功能自动实现，不需要人为干预。从 而，为模块数量的智能扩展做好了技术铺垫。图2中，X/Y为高速通讯信号线，Rd为终端匹 配电阻，U4为光电开关，Q1为mosfet，Ext_Con为使能信号。如果扩展模块为最末端一个， 如图3所示，即为扩展模块N+1，由于其右侧没有扩展模块，因此，右边输出口中的Ext_Con N+1信号为高电平，故而U4 N+1光电开关导通，RdN+1匹配电阻接入X/Y高速通讯信号线， 且位于信号线最末端。如果模块不是位于最末端位置，如图3中的扩展模块N，则其右边输 出口中的Ext_Con N使能信号，被其右侧的N+1模块左侧输入口的Ext_Con’N+1信号拉低， 故其U4 N光电开关断开，Rd N不接入X/Y高速通讯信号线，不起作用。其他的扩展模块N-i， 当中的Ext_Con N-i使能信号均被右侧模块输入口的Ext_Con’N-i+1信 号拉低，故其Rd N-i电阻均不接入X/Y高速通讯信号线，均不起作用。作为本发明的优选实施方式，所述主模块以及扩展模块还包括，CAN/SPI接口，设置于所述主模块以及扩展模块的主控MCU处，用于进行CAN或SPI通 信。所述作为分离部件说明的模块可以是或者也可以不是物理上分开的，作为模块显示的部 件可以是或者也可以不是物理模块，即可以位于一个地方，或者也可以分布到多个网络模块 上。可以根据实际的需要选择其中的部分或者全部模块来实现本实施例中的方案的目的。另外，在本发明各个实施例中的各功能模块可以集成在一个处理模块中，也可以是各个 模块单独物理存在，也可以两个或两个以上模块集成在一个模块中。上述集成的模块既可以 采用硬件的形式实现，也可以采用软件功能模块的形式实现。所述集成的模块如果以软件功能模块的形式实现并作为独立的产品销售或使用时，可以 存储在一个计算机可读取存储介质中。基于这样的理解，本发明实现上述实施例方法中的全 部或部分流程，也可以通过计算机程序来指令相关的硬件来完成，所述的计算机程序可存储 于一计算机可读存储的介质中，该计算机程序在被处理器执行时，可实现上述各个方法实施 例的步骤。其中，所述计算机程序包括计算机程序代码，所述计算机程序代码可以为源代码 形式、对象代码形式、可执行文件或某些中间形式等。所述计算机可读介质可以包括：能够 携带所述计算机程序代码的任何实体或系统、记录介质、U盘、移动硬盘、磁碟、光盘、计 算机存储器、只读存储器、随机存取存储器、电载波信号、电信信号以及软件分发介质等。需要说明的是，所述 计算机可读介质包括的内容可以根据司法管辖区内立法和专利实践的要求进行适当的增减， 例如在某些司法管辖区，根据立法和专利实践，计算机可读介质不包括是电载波信号和电信 信号。尽管本发明的描述已经相当详尽且特别对几个所述实施例进行了描述，但其并非旨在局 限于任何这些细节或实施例或任何特殊实施例，而是应当将其视作是通过参考所附权利要求 考虑到现有技术为这些权利要求提供广义的可能性解释，从而有效地涵盖本发明的预定范围。 此外，上文以发明人可预见的实施例对本发明进行描述，其目的是为了提供有用的描述，而 那些目前尚未预见的对本发明的非实质性改动仍可代表本发明的等效改动。以上所述，只是本发明的较佳实施例而已，本发明并不局限于上述实施方式，只要其以 相同的手段达到本发明的技术效果，都应属于本发明的保护范围。在本发明的保护范围内其 技术方案和/或实施方式可以有各种不同的修改和变化。
