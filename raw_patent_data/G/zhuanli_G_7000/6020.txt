标题title
肠体病灶深度数据获取方法、装置、电子设备及存储介质
摘要abst
本申请提供一种肠体病灶深度数据获取方法、装置、电子设备及存储介质，该方法通过对真实肠体和真实病灶进行组合建模，并通过模拟摄像头采集得到第一病灶平面图和第一病灶深度图，然后将二者作为训练数据来训练深度估计模型，则后续仅需要通过真实摄像头对目标案例的真实肠体进行拍摄得到第二病灶平面图，然后调用训练后的深度估计模型得到第二病灶深度图，即可从第二病灶深度图中得到准确的病灶深度数据，整个过程仅需要普通内镜摄像头进行平面图的采集，而不需要借助辅助的深度摄像头来伸入真实肠体，实现了用较为简单的方式来得到准确的病灶深度数据，有利于后续病灶真实尺寸的计算。
权利要求书clms
1.一种肠体病灶深度数据获取方法，其特征在于，包括：根据真实肠体的第一建模信息，生成与所述真实肠体环境相同的肠体模型，根据真实病灶的第二建模信息，在所述肠体模型的内壁生成病灶模型；根据预设运镜方式和预设摄像头参数，控制模拟摄像头在所述肠体模型内运镜并对所述病灶模型进行拍摄，得到多个第一病灶平面图，根据所述预设运镜方式和所述肠体模型，得到各第一病灶平面图对应的第一病灶深度图；基于各第一病灶平面图和对应的第一病灶深度图对深度估计模型进行训练；获取真实摄像头在目标案例的真实肠体内部拍摄到的第二病灶平面图，并将所述第二病灶平面图输入训练后的深度估计模型，得到所述目标案例的第二病灶深度图；根据所述第二病灶深度图，得到所述目标案例的病灶深度数据。2.根据权利要求1所述的肠体病灶深度数据获取方法，其特征在于，所述第一建模信息包括K个建模信息组，所述K个建模信息组分别对应K个不同案例群体，每个建模信息组包括同一案例群体真实肠体的肠体建模信息和真实内壁图像，K为正整数，根据真实肠体的第一建模信息，生成与所述真实肠体环境相同的肠体模型的步骤，包括：根据每个建模信息组的肠体建模信息，分别生成K个不同案例群体的真实肠体的K个初始肠体模型；根据每个建模信息组的真实内壁图像，分别对K个初始肠体模型的内壁进行渲染，得到与K个不同案例群体的真实肠体内壁环境相同的K个肠体模型。3.根据权利要求2所述的肠体病灶深度数据获取方法，其特征在于，所述第一建模信息还包括光照建模信息，在得到与K个不同案例群体的真实肠体内壁环境相同的K个肠体模型的步骤之后，包括：根据所述光照建模信息，生成每一肠体模型中的不同位置的模拟光照，得到与K个不同案例群体的真实肠体光照环境相同的K个肠体模型。4.根据权利要求3所述的肠体病灶深度数据获取方法，其特征在于，所述第二建模信息包括M个病灶形态建模信息和N个病灶位置建模信息，M和N均为正整数，根据真实病灶的第二建模信息，在所述肠体模型的内壁生成病灶模型的步骤，包括：分别对所述M个病灶形态建模信息、所述N个病灶位置建模信息以及所述K个肠体模型进行遍历取值，并将每次取得的病灶形态建模信息、病灶位置建模信息和肠体模型组合，得到M*N*K个组合建模信息组；根据所述M*N*K个组合建模信息组，生成M*N*K个内壁有病灶模型的肠体模型。5.根据权利要求4所述的肠体病灶深度数据获取方法，其特征在于，在根据真实病灶的第二建模信息，在所述肠体模型的内壁生成病灶模型的步骤之前，还包括：获取病灶形态信息集，所述病灶形态信息集包括a个病灶颜色信息、b个病灶尺寸信息和c个病灶形状信息，a、b、c均为正整数，且a*b*c等于M；分别对所述a个病灶颜色信息、所述b个病灶尺寸信息和所述c个病灶形状信息进行遍历取值，并将每次取得的病灶颜色信息、病灶尺寸信息和病灶形态信息组合，得到a*b*c个病灶形态信息；根据所述a*b*c个病灶形态信息，得到所述M个病灶形态建模信息。6.根据权利要求1所述的肠体病灶深度数据获取方法，其特征在于，根据预设运镜方式和预设摄像头参数，控制模拟摄像头在所述肠体模型内运镜并对所述病灶模型进行拍摄，得到多个第一病灶平面图的步骤，包括：获取P种预设运镜方式和Q种预设摄像头参数，P和Q均为正整数；分别对所述P种预设运镜方式和所述Q种预设摄像头参数进行遍历取值，并将每次取得的预设运镜方式和预设摄像头参数组合，得到P*Q种预设拍摄方式；对每个肠体模型，均根据所述P*Q种预设拍摄方式分别控制模拟摄像头对病灶模型进行拍摄，得到多个第一病灶平面图。7.根据权利要求1所述的肠体病灶深度数据获取方法，其特征在于，在根据所述第二病灶深度图，得到所述目标案例的病灶深度数据的步骤之后，还包括：根据所述第二病灶平面图，得到所述目标案例的病灶测量尺寸；根据所述病灶测量尺寸、所述病灶深度数据和所述真实摄像头的真实摄像头参数，得到所述目标案例的病灶真实尺寸。8.一种肠体病灶深度数据获取装置，其特征在于，包括：生成模块，用于根据真实肠体的第一建模信息，生成与所述真实肠体环境相同的肠体模型，根据真实病灶的第二建模信息，在所述肠体模型的内壁生成病灶模型；第一得到模块，用于根据预设运镜方式和预设摄像头参数，控制模拟摄像头在所述肠体模型内运镜并对所述病灶模型进行拍摄，得到多个第一病灶平面图，根据所述预设运镜方式和所述肠体模型，得到各第一病灶平面图对应的第一病灶深度图；训练模块，用于基于各第一病灶平面图和对应的第一病灶深度图对深度估计模型进行训练；第二得到模块，用于获取真实摄像头在目标案例的真实肠体内部拍摄到的第二病灶平面图，并将所述第二病灶平面图输入训练后的深度估计模型，得到所述目标案例的第二病灶深度图；第三得到模块，用于根据所述第二病灶深度图，得到所述目标案例的病灶深度数据。9.一种电子设备，其特征在于，包括存储器和处理器；所述存储器存储有应用程序，所述处理器用于运行所述存储器内的应用程序，以执行权利要求1至7任一项所述的肠体病灶深度数据获取方法中的步骤。10.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质上存储有计算机程序，所述计算机程序被处理器执行以实现权利要求1至7任一项所述的肠体病灶深度数据获取方法中的步骤。
说明书desc
技术领域本申请涉及医疗辅助技术领域，尤其涉及一种肠体病灶深度数据获取方法、装置、电子设备及存储介质。背景技术在消化道内镜检查过程中常需要对肠体内病灶大小进行测量，并针对不同大小的病灶给出不同的治疗方案。病灶的真实尺寸与RGB图像中的测量尺寸以及病灶的深度数据相关，当前在获取深度数据时主要采用两种方法，一是使用辅助的深度摄像头深入到患者肠腔内获取，二是采用无监督方法来得到深度图，然而，前者会增加患者的痛苦，并不适合在内镜环境下进行，后者得到的深度图为相对深度图，而计算病灶的真实尺寸需要绝对深度，即使将相对深度图通过放大因子计算得到绝对深度，误差也会非常大，会使得病灶的真实尺寸计算不准确。因此，当前在计算肠体病灶真实尺寸的过程存在准确病灶深度数据难以获取的技术问题，需要改进。发明内容本申请实施例提供一种肠体病灶深度数据获取方法、装置、电子设备及存储介质，用以缓解当前在计算肠体病灶真实尺寸的过程中准确病灶深度数据难以获取的技术问题。为解决上述技术问题，本申请实施例提供以下技术方案：本申请提供一种肠体病灶深度数据获取方法，包括：根据真实肠体的第一建模信息，生成与所述真实肠体环境相同的肠体模型，根据真实病灶的第二建模信息，在所述肠体模型的内壁生成病灶模型；根据预设运镜方式和预设摄像头参数，控制模拟摄像头在所述肠体模型内运镜并对所述病灶模型进行拍摄，得到多个第一病灶平面图，根据所述预设运镜方式和所述肠体模型，得到各第一病灶平面图对应的第一病灶深度图；基于各第一病灶平面图和对应的第一病灶深度图对深度估计模型进行训练；获取真实摄像头在目标案例的真实肠体内部拍摄到的第二病灶平面图，并将所述第二病灶平面图输入训练后的深度估计模型，得到所述目标案例的第二病灶深度图；根据所述第二病灶深度图，得到所述目标案例的病灶深度数据。同时，本申请实施例还提供了一种肠体病灶深度数据获取装置，包括：生成模块，用于根据真实肠体的第一建模信息，生成与所述真实肠体环境相同的肠体模型，根据真实病灶的第二建模信息，在所述肠体模型的内壁生成病灶模型；第一得到模块，用于根据预设运镜方式和预设摄像头参数，控制模拟摄像头在所述肠体模型内运镜并对所述病灶模型进行拍摄，得到多个第一病灶平面图，根据所述预设运镜方式和所述肠体模型，得到各第一病灶平面图对应的第一病灶深度图；训练模块，用于基于各第一病灶平面图和对应的第一病灶深度图对深度估计模型进行训练；第二得到模块，用于获取真实摄像头在目标案例的真实肠体内部拍摄到的第二病灶平面图，并将所述第二病灶平面图输入训练后的深度估计模型，得到所述目标案例的第二病灶深度图；第三得到模块，用于根据所述第二病灶深度图，得到所述目标案例的病灶深度数据。本申请还提供一种电子设备，包括存储器和处理器；所述存储器存储有应用程序，所述处理器用于运行所述存储器内的应用程序，以执行上述任一项所述的肠体病灶深度数据获取方法中的步骤。本申请实施例提供一种计算机可读存储介质，计算机可读存储介质存储有多条指令，指令适于处理器进行加载，以执行上述肠体病灶深度数据获取方法中的步骤。有益效果：本申请提供一种肠体病灶深度数据获取方法、装置、电子设备及存储介质，该方法先根据真实肠体的第一建模信息生成与真实肠体环境相同的肠体模型，根据真实病灶的第二建模信息在肠体模型的内壁生成病灶模型，然后根据预设运镜方式和预设摄像头参数，控制模拟摄像头在肠体模型内运镜并对病灶模型进行拍摄，得到多个第一病灶平面图，根据预设运镜方式和肠体模型得到各第一病灶平面图对应的第一病灶深度图，再基于各第一病灶平面图和对应的第一病灶深度图对深度估计模型进行训练；获取真实摄像头在目标案例的真实肠体内部拍摄到的第二病灶平面图，并将第二病灶平面图输入训练后的深度估计模型，得到目标案例的第二病灶深度图，最后根据第二病灶深度图得到目标案例的病灶深度数据。本申请通过对真实肠体和真实病灶进行组合建模，并通过模拟摄像头采集得到第一病灶平面图和第一病灶深度图，然后将二者作为训练数据来训练深度估计模型，则后续仅需要通过真实摄像头对目标案例的真实肠体进行拍摄得到第二病灶平面图，然后调用训练后的深度估计模型得到第二病灶深度图，即可从第二病灶深度图中得到准确的病灶深度数据，整个过程仅需要普通内镜摄像头进行平面图的采集，而不需要借助辅助的深度摄像头来伸入真实肠体，实现了用较为简单的方式来得到准确的病灶深度数据，有利于后续病灶真实尺寸的计算。附图说明下面结合附图，通过对本申请的具体实施方式详细描述，将使本申请的技术方案及其它有益效果显而易见。图1是本申请实施例提供的肠体病灶深度数据获取方法的应用场景示意图。图2为本申请实施例提供的肠体病灶深度数据获取方法的流程示意图。图3为本申请实施例中肠体模型的示意图。图4为本申请实施例中的真实内壁图像和渲染后的肠体模型内壁图像。图5为本申请实施例中病灶的不同形状示意图。图6为本申请实施例中的第一病灶平面图和第一病灶深度图。图7为本申请实施例提供的肠体病灶深度数据获取装置的结构示意图。图8为本申请实施例提供的电子设备的结构示意图。具体实施方式下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述。显然，所描述的实施例仅仅是本申请一部分实施例，而不是全部的实施例。基于本申请中的实施例，本领域技术人员在没有作出创造性劳动前提下所获得的所有其他实施例，都属于本申请保护的范围。本申请实施例提供一种肠体病灶深度数据获取方法、装置、电子设备和计算机可读存储介质，其中，该肠体病灶深度数据获取装置可以集成在电子设备中，该电子设备可以是服务器，也可以是终端等设备。请参阅图1，图1为本申请实施例所提供的肠体病灶深度数据获取方法应用的场景示意图，该场景可以包括终端以及服务器，终端之间、服务器之间、以及终端与服务器之间通过各种网关组成的互联网等方式连接通信，该应用场景中包括建模设备11和服务器12；其中，建模设备11是指安装有建模软件且具有人机交互功能的设备，服务器12包括本地服务器和/或远程服务器等。建模设备11和服务器12位于无线网络或有线网络中，以实现两者之间的数据交互，其中：服务器12先根据真实肠体的第一建模信息，通过建模设备11中的建模软件生成与真实肠体环境相同的肠体模型，根据真实病灶的第二建模信息，通过建模设备11中的建模软件在肠体模型的内壁生成病灶模型。然后，服务器12根据预设运镜方式和摄像头参数控制模拟摄像头在肠体模型内运镜并对病灶模型进行拍摄，得到多个第一病灶平面图，根据预设运镜方式和肠体模型得到各第一病灶平面图对应的第一病灶深度图，并基于各第一病灶平面图和对应的第一病灶深度图对深度估计模型进行训练。最后，服务器12获取真实摄像头在目标案例的真实肠体内部拍摄到的第二病灶平面图，并将第二病灶平面图输入训练后的深度估计模型，得到目标案例的第二病灶深度图，根据第二病灶深度图得到目标案例的病灶深度数据。需要说明的是，图1所示的系统场景示意图仅仅是一个示例，本申请实施例描述的服务器以及场景是为了更加清楚地说明本申请实施例的技术方案，并不构成对于本申请实施例提供的技术方案的限定，本领域普通技术人员可知，随着系统的演变和新业务场景的出现，本申请实施例提供的技术方案对于类似的技术问题，同样适用。以下分别进行详细说明。需说明的是，以下实施例的描述顺序不作为对实施例优选顺序的限定。请参阅图2，图2是本申请实施例提供的肠体病灶深度数据获取方法的流程示意图，该方法具体包括：S1：根据真实肠体的第一建模信息，生成与真实肠体环境相同的肠体模型，根据真实病灶的第二建模信息，在肠体模型的内壁生成病灶模型。真实肠体可以是结肠、直肠等各类真实存在于人体内部的肠体，肠体内部形成肠腔，第一建模信息是指以真实肠体为依据为建模所需的形状、尺寸等提供参考的信息，其反映了真实肠体的环境信息，环境信息包括肠体本身的结构和肠体内部的环境，则基于第一建模信息可以在建模软件中生成与真实肠体环境相同的肠体模型，建模软件可以是blender软件，肠体模型为3D模型，具体结构如图3所示。需要说明的是，由于肠体模型不可能完全还原出真实肠体的环境，本申请所指的环境相同是指环境的相似度大于某个较高的数值如99%等，该数值可根据所需的精度来设定，当相似度大于该数值，则认为是环境相同。真实病灶可以是息肉、溃疡、出血等各类真实存在于真实肠体内壁的病灶，第二建模信息是指以真实病灶为依据为建模所需的形状、尺寸等提供参考的信息，则基于第二建模信息可以在建模软件中肠体模型的内壁上生成病灶模型。在一种实施例中，第一建模信息包括K个建模信息组，K个建模信息组分别对应K个不同案例群体，每个建模信息组包括同一案例群体真实肠体的肠体建模信息和真实内壁图像，K为正整数，S1具体包括：根据每个建模信息组的肠体建模信息，分别生成K个不同案例群体的真实肠体的K个初始肠体模型；根据每个建模信息组的真实内壁图像，分别对K个初始肠体模型的内壁进行渲染，得到与K个不同案例群体的真实肠体内壁环境相同的K个肠体模型。案例是指真实的人，案例群体是指具有某些相同或相似属性的人形成的群体，不同人的真实肠体会存在个体化差异，为使得肠体模型可以覆盖更多的案例，同时又考虑建模成本，可以预先将所有案例分为K个案例群体，如根据年龄、性别等属性构建分类条件，某个相同年龄段和相同性别的若干个案例可作为一个案例群体，另一个相同年龄段和相同性别的若干个案例可作为另一个案例群体，同一案例群体的人的真实肠体差异通常处于一个较小的范围内，则可以综合一个案例群体的所有真实肠体的构造，得到该案例群体的肠体建模信息。同时，由于建模后肠体模型的内壁是没有纹理的，而真实肠体内壁具有各种颜色、褶皱等，为使得肠体模型与真实肠体的环境相同，还需要对该案例群体真实肠体的内壁进行图像采集，得到该案例群体的真实内壁图像，并以此作为内壁环境的建模参考，同一案例群体的肠体建模信息和真实内壁图像形成了该案例群体的建模信息组。最后，对每个案例群体，均采用该案例群体的肠体建模信息生成初始肠体模型，且均采用该案例群体的真实内壁图像对初始肠体模型内壁进行渲染，得到肠体模型，则肠体模型与真实肠体的内壁环境相同，如图4所示，左图为真实内壁图像，右图为渲染后的肠体模型内壁图像。同样地，受精度的限制，内壁环境相同也是指两者内壁环境相似度大于某个较高的数值。通过上述过程，得到了与K个不同案例群体的真实肠体内壁环境相同的K个肠体模型。在一种实施例中，第一建模信息还包括干扰颜色建模信息，对于建立的每个肠体模型，可以通过仿真软件来设置不同的肠腔颜色，使之与真实肠体存在一定的颜色差异，增加颜色扰动，则后续可以使得训练后的深度估计模型算法具有较高的鲁棒性。在一种实施例中，第一建模信息还包括光照建模信息，在得到与K个不同案例群体的真实肠体内壁环境相同的K个肠体模型的步骤之后，包括：根据光照建模信息，生成每一肠体模型中的不同位置的模拟光照，得到与K个不同案例群体的真实肠体光照环境相同的K个肠体模型。光照建模信息是指以真实肠体的肠腔内部光照环境为依据为生成模拟光照所需的数据提供参考的信息，具体包括肠体模型内部每个位置应该具备什么样的光强。由于肠体的环境除了内壁环境外，还包括肠腔内的光照环境，在真实肠腔的不同位置，光强存在差异，则如果病灶分布在不同位置，拍摄得到的病灶平面图也会有差异，因此还需要根据光照建模信息在肠体模型内部的各位置生成模拟光照，使其更接近真实肠体的光照环境。在生成模拟光照时，可以先获取真实肠体中某几个关键位置的光照作为光照建模信息，然后根据光照建模信息在肠体模型内部对应的这几个关键位置分别生成模拟光照，也可以先获取真实肠体的光照-位置曲线并将其作为光照建模信息，然后根据该曲线在肠体模型内部的所有位置生成连续且较为平滑的模拟光照。当然，本申请对生成模拟光照的方式不做限制，还可以采用其他可行的方式生成模拟光照，只要能使得肠体模型与真实肠体的光照环境相同即可。同样地，受模拟精度的限制，光照环境相同也是指两者光照环境相似度大于某个较高的数值。在一种实施例中，第二建模信息包括M个病灶形态建模信息和N个病灶位置建模信息，M和N均为正整数，S1具体包括：分别对M个病灶形态建模信息、N个病灶位置建模信息以及K个肠体模型进行遍历取值，并将每次取得的病灶形态建模信息、病灶位置建模信息和肠体模型组合，得到M*N*K个组合建模信息组；根据M*N*K个组合建模信息组，生成M*N*K个内壁有病灶模型的肠体模型。病灶形态建模信息是指以真实病灶的形态为依据为建模所需的病灶形态提供参考的信息，病灶位置建模信息是指以真实病灶在肠腔中的分布位置为依据为建模所需的病灶位置提供参考的信息。由于真实病灶具有各种不同的形态，且可能分布在肠腔的各种不同位置，为保证训练数据的多样性，可以真实病灶的M个病灶形态为依据得到M个病灶形态建模信息，以真实病灶的N个病灶位置为依据得到N个病灶位置建模信息，将两者视为两个集合，并对每个集合中的元素进行遍历取值和取值元素组合，则可以形成M*N个病灶模型建模信息组。在上述步骤中，针对K个不同案例群体可以建立K个肠体模型，将M*N个病灶模型建模信息组和K个肠体模型分别视为两个集合，并对每个集合中的元素进行遍历取值和取值元素组合，则可以形成M*N*K个组合建模信息组。上述过程可以先得到M*N个病灶模型建模信息组，再将其与K个肠体模型建模信息组进行组合，也可以直接将M个病灶形态建模信息、N个病灶位置建模信息以及K个肠体模型视为三个集合，并分别遍历取值和组合得到M*N*K个模型组合建模信息组。最后，基于M*N*K个模型组合建模信息组，生成M*N*K个内壁有病灶模型的肠体模型。需要说明的是，在生成肠体模型和病灶模型的组合模型时，可以不需要真的建立M*N*K个组合模型，可以只建立K个肠体模型，然后在每个肠体模型中，依次生成M*N个病灶模型并依次进行数据采集，在每次采集完成后，可以将当前病灶模型隐藏或者去除，然后生成下一病灶模型并对其进行数据采集。在一种实施例中，在S1之前还包括：获取病灶形态信息集，病灶形态信息集包括a个病灶颜色信息、b个病灶尺寸信息和c个病灶形状信息，a、b、c均为正整数，且a*b*c等于M；分别对a个病灶颜色信息、b个病灶尺寸信息和c个病灶形状信息进行遍历取值，并将每次取得的病灶颜色信息、病灶尺寸信息和病灶形态信息组合，得到a*b*c个病灶形态信息；根据a*b*c个病灶形态信息，得到M个病灶形态建模信息。病灶形态由病灶颜色、病灶尺寸和病灶形状组合形成，当其中任意一者发生变化时，病灶形态均会发生变化，则可以获取真实病灶的a个病灶颜色信息，颜色可以是深红色、浅红色、暗红色、亮红色等，获取真实病灶的b个病灶尺寸信息，尺寸可以是1mm-15mm等，获取真实病灶的c个病灶形状信息，形状可以是圆形、椭圆形、偏平形、无蒂、有蒂等，组合这三者形成病灶形态信息集，然后将这三者视为三个集合，对每个集合中的元素进行遍历取值，并进行取值元素组合，可以得到a*b*c个病灶形态信息，则以此为依据，可以生成M个病灶形态建模信息。后续基于这些病灶形态建模信息，可以在肠体模型内壁生成各种不同形态的病灶模型，如图5所示，左图中虚线框内为椭圆形病灶模型，右图中虚线框内为偏平型病灶模型。S2：根据预设运镜方式和预设摄像头参数，控制模拟摄像头在肠体模型内运镜并对病灶模型进行拍摄，得到多个第一病灶平面图，根据预设运镜方式和肠体模型，得到各第一病灶平面图对应的第一病灶深度图。模拟摄像头是指在肠体模型内由相关逻辑的控制下进行移动和转动，并执行拍摄任务的模拟工具，而非真实存在的摄像头，模拟摄像头的模拟对象为真实场景下使用的肠道内镜。预设运镜方式包括模拟摄像头的预设运镜轨迹和运镜轨迹中模拟摄像头在各轨迹点的预设朝向，预设摄像头参数主要包括模拟摄像头的镜头焦距F1、成像传感器的横向孔径Sw1和纵向孔径Sh1等，在这两个控制参数确定后，可以控制模拟摄像头在肠体模型内以特定的运镜轨迹移动到某个轨迹点，在该轨迹点以特定的朝向对病灶模型所在的区域进行拍摄，拍摄后得到第一病灶平面图，也即病灶的RGB图，其反映了拍摄区域内肠体模型和病灶模型的形状、纹理、位置、尺寸等信息，具体如图6中左图所示，其中虚线框内为病灶模型，其他区域为肠体模型。由于模拟摄像头是基于预设运镜方式进行的拍摄，也即其在运镜过程中与肠体的距离是预先设定的，与病灶模型的拍摄角度也是预先设定的，当模拟摄像头在某个轨迹点对病灶模型拍摄得到第一病灶平面图后，第一病灶平面图中每个位置点对应的实体与模拟摄像头的深度均是确定的，该深度具体是指每个位置点对应的实体与模拟摄像头成像平面之间的距离，将这些距离用不同的颜色来进行表示，则可以得到如图6中右图所示的第一病灶深度图，其中虚线框内为病灶模型，其他区域为肠体模型。在实际场景中，根据主流的内镜镜头视野范围以及内镜医师使用镜头的习惯，内镜镜头与病灶的距离通常在2mm-120mm之间，则预设运镜方式中可以定义模拟摄像头与病灶模型之间的距离也在2mm-120mm之间，使其与真实使用场景更贴近。在一种实施例中，S2具体包括：获取P种预设运镜方式和Q种预设摄像头参数，P和Q均为正整数；分别对P种预设运镜方式和Q种预设摄像头参数进行遍历取值，并将每次取得的预设运镜方式和预设摄像头参数组合，得到P*Q种预设拍摄方式；对每个肠体模型，均根据P*Q种预设拍摄方式分别控制模拟摄像头对病灶模型进行拍摄，得到多个第一病灶平面图。在真实的场景中，对病灶的拍摄通常会有不同的拍摄角度和不同的深度，拍摄时摄像头也会有各种型号，不同型号的摄像头参数存在差异。为保证训练数据的多样性，可定义P种预设运镜方式来满足不同拍摄角度和深度的需求，定义Q种预设摄像头参数来满足不同型号摄像头的拍摄需求，将两者视为两个集合，并对每个集合中的元素进行遍历取值和取值元素组合，则可以形成P*Q种预设拍摄方式。然后，对每个肠体模型，仅可以模拟至少P*Q次拍摄得到对应的第一病灶平面图，使得训练数据可以覆盖各种拍摄角色、深度和摄像头型号。S3：基于各第一病灶平面图和对应的第一病灶深度图对深度估计模型进行训练。深度估计模型是用来预测图像中各位置点深度的模型，即输入一张平面图，可以对图像中各位置点的深度进行估计，输出一张深度图。在上述步骤中，通过对各类肠体模型和病灶模型进行组合得到多种组合模型方案，并在每种组合模型方案中均按照多种拍摄方式对病灶模型进行拍摄，得到了多个第一病灶平面图，每个第一病灶平面图均有对应的第一病灶深度图。则每个第一病灶平面图和对应的第一病灶深度图可分别作为训练输入数据和训练输出数据，所有的第一病灶平面图和对应的第一病灶深度图形成训练数据集，基于该训练数据集对深度估计模型进行训练，直至深度估计模型对深度的估计正确率达到预期为止。S4：获取真实摄像头在目标案例的真实肠体内部拍摄到的第二病灶平面图，并将第二病灶平面图输入训练后的深度估计模型，得到目标案例的第二病灶深度图。目标案例是指当前需要进行病灶诊断的患者，通过真实摄像头在目标案例的真实肠体内部进行对真实病灶进行拍摄，可以得到第二病灶平面图，真实摄像头是指真实的肠道内镜。同样地，第二病灶平面图包含了真实病灶以及真实病灶所在区域的一部位真实肠体。将第二病灶平面图输入训练后的深度估计模型中，可以输出得到目标案例的第二病灶深度图，第二病灶深度图中的不同颜色表示了肠体和病灶的不同位置点与真实摄像头的深度。在本申请实施例中，由于训练数据集对真实场景的覆盖率较高，则模型训练完成后，将第二病灶平面图输入该模型，得到的第二病灶深度图的深度准确率较高，则后续计算的准确率也得到提升。S5：根据第二病灶深度图，得到目标案例的病灶深度数据。在第二病灶深度图中对真实病灶的每个位置点的颜色进行分析，可以得到各位置点与真实摄像头的成像平面的深度，综合这些深度可得到目标案例的病灶深度数据。在一种实施例中，在S5之后还包括：根据第二病灶平面图，得到目标案例的病灶测量尺寸；根据病灶测量尺寸、病灶深度数据和真实摄像头的真实摄像头参数，得到目标案例的病灶真实尺寸。真实摄像头在对病灶进行拍摄时，先通过镜头进行光学图像采集，然后将光学图像投射到传感器上，光学图像依次被转换为电信号和数字信号，并最终被处理为第二病灶平面图。对第二病灶平面图进行测量，可以得到病灶测量尺寸，具体可包括第二病灶平面图的图片宽W0和高H0、以及真实病灶的第一外接矩形的宽W1和高H1，其中外接矩形是指能完整覆盖第二病灶平面图中病灶外轮廓的最小矩形。病灶测试尺寸仅能反映病灶在第二病灶平面图中的尺寸，医生诊断时最终需要获取的是病灶真实尺寸，则还需要对病灶测试尺寸进行换算。基于摄像头的成像原理可知，病灶真实尺寸与病灶测试尺寸、病灶深度数据以及真实摄像头参数相关。具体地，真实摄像头参数包括真实摄像头的镜头焦距F2、成像传感器的横向孔径Sw2和纵向孔径Sh2，病灶深度数据中真实病灶与真实摄像头成像平面的深度为d，先计算得到真实摄像头的横向像素焦距fx和纵向像素焦距fy，其满足下列公式：。。通过此方式计算得到像素焦距的方式，相对于直接通过拍摄棋盘图片提取像素焦距的方式更为准确。然后，设病灶真实尺寸中第二外接矩形的宽为W2，高为H2，则其满足下列公式：。。通过上述步骤，可以得到病灶真实尺寸，医师可基于该尺寸判断病灶的严重程度，再结合其他相关数据对目标案例的病情进行进一步诊断。根据上述实施例可知，本申请的肠体病灶深度数据获取方法，通过对真实肠体和真实病灶进行组合建模，并通过模拟摄像头采集得到第一病灶平面图和第一病灶深度图，然后将二者作为训练数据来训练深度估计模型，则后续仅需要通过真实摄像头对目标案例的真实肠体进行拍摄得到第二病灶平面图，然后调用训练后的深度估计模型得到第二病灶深度图，即可从第二病灶深度图中得到准确的病灶深度数据，整个过程仅需要普通内镜摄像头进行平面图的采集，而不需要借助辅助的深度摄像头来伸入真实肠体，实现了用较为简单的方式来得到准确的病灶深度数据，有利于后续病灶真实尺寸的计算。在上述实施例所述方法的基础上，本实施例将从肠体病灶深度数据获取装置的角度进一步进行描述，请参阅图7，肠体病灶深度数据获取装置可以包括：生成模块10，用于根据真实肠体的第一建模信息，生成与所述真实肠体环境相同的肠体模型，根据真实病灶的第二建模信息，在所述肠体模型的内壁生成病灶模型；第一得到模块20，用于根据预设运镜方式和预设摄像头参数，控制模拟摄像头在所述肠体模型内运镜并对所述病灶模型进行拍摄，得到多个第一病灶平面图，根据所述预设运镜方式和所述肠体模型，得到各第一病灶平面图对应的第一病灶深度图；训练模块30，用于基于各第一病灶平面图和对应的第一病灶深度图对深度估计模型进行训练；第二得到模块40，用于获取真实摄像头在目标案例的真实肠体内部拍摄到的第二病灶平面图，并将所述第二病灶平面图输入训练后的深度估计模型，得到所述目标案例的第二病灶深度图；第三得到模块50，用于根据所述第二病灶深度图，得到所述目标案例的病灶深度数据。在一种实施例中，所述第一建模信息包括K个建模信息组，所述K个建模信息组分别对应K个不同案例群体，每个建模信息组包括同一案例群体真实肠体的肠体建模信息和真实内壁图像，K为正整数，生成模块10包括：第一生成子模块，用于根据每个建模信息组的肠体建模信息，分别生成K个不同案例群体的真实肠体的K个初始肠体模型；第一得到子模块，用于根据每个建模信息组的真实内壁图像，分别对K个初始肠体模型的内壁进行渲染，得到与K个不同案例群体的真实肠体内壁环境相同的K个肠体模型。在一种实施例中，所述第一建模信息还包括光照建模信息，生成模块10还包括：第二生成子模块，用于根据所述光照建模信息，生成每一肠体模型中的不同位置的模拟光照，得到与K个不同案例群体的真实肠体光照环境相同的K个肠体模型。在一种实施例中，所述第二建模信息包括M个病灶形态建模信息和N个病灶位置建模信息，M和N均为正整数，生成模块10包括：第二得到子模块，用于分别对所述M个病灶形态建模信息、所述N个病灶位置建模信息以及所述K个肠体模型进行遍历取值，并将每次取得的病灶形态建模信息、病灶位置建模信息和肠体模型组合，得到M*N*K个组合建模信息组；第三生成子模块，用于根据所述M*N*K个组合建模信息组，生成M*N*K个内壁有病灶模型的肠体模型。在一种实施例中，肠体病灶深度数据获取装置还包括：获取模块，用于获取病灶形态信息集，所述病灶形态信息集包括a个病灶颜色信息、b个病灶尺寸信息和c个病灶形状信息，a、b、c均为正整数，且a*b*c等于M；第四得到模块，用于分别对所述a个病灶颜色信息、所述b个病灶尺寸信息和所述c个病灶形状信息进行遍历取值，并将每次取得的病灶颜色信息、病灶尺寸信息和病灶形态信息组合，得到a*b*c个病灶形态信息；第五得到模块，用于根据所述a*b*c个病灶形态信息，得到所述M个病灶形态建模信息。在一种实施例中，第一得到模块20包括：第一获取子模块，用于获取P种预设运镜方式和Q种预设摄像头参数，P和Q均为正整数；第三得到子模块，用于分别对所述P种预设运镜方式和所述Q种预设摄像头参数进行遍历取值，并将每次取得的预设运镜方式和预设摄像头参数组合，得到P*Q种预设拍摄方式；第四得到子模块，用于对每个肠体模型，均根据所述P*Q种预设拍摄方式分别控制模拟摄像头对病灶模型进行拍摄，得到多个第一病灶平面图。在一种实施例中，肠体病灶深度数据获取装置还包括：第六得到模块，用于根据所述第二病灶平面图，得到所述目标案例的病灶测量尺寸；第七得到模块，用于根据所述病灶测量尺寸、所述病灶深度数据和所述真实摄像头的真实摄像头参数，得到所述目标案例的病灶真实尺寸。区别于现有技术，本申请提供的肠体病灶深度数据获取装置，通过对真实肠体和真实病灶进行组合建模，并通过模拟摄像头采集得到第一病灶平面图和第一病灶深度图，然后将二者作为训练数据来训练深度估计模型，则后续仅需要通过真实摄像头对目标案例的真实肠体进行拍摄得到第二病灶平面图，然后调用训练后的深度估计模型得到第二病灶深度图，即可从第二病灶深度图中得到准确的病灶深度数据，整个过程仅需要普通内镜摄像头进行平面图的采集，而不需要借助辅助的深度摄像头来伸入真实肠体，实现了用较为简单的方式来得到准确的病灶深度数据，有利于后续病灶真实尺寸的计算。相应的，本申请实施例还提供一种电子设备，如图8所示，该电子设备可以包括射频电路1001、包括有一个或一个以上计算机可读存储介质的存储器1002、输入单元1003、显示单元1004、传感器1005、音频电路1006、WiFi模块1007、包括有一个或者一个以上处理核心的处理器1008、以及电源1009等部件。本领域技术人员可以理解，图8中示出的电子设备结构并不构成对电子设备的限定，可以包括比图示更多或更少的部件，或者组合某些部件，或者不同的部件布置。其中：射频电路1001可用于收发信息或通话过程中，信号的接收和发送，特别地，将基站的下行信息接收后，交由一个或者一个以上处理器1008处理；另外，将涉及上行的数据发送给基站。存储器1002可用于存储软件程序以及模块，处理器1008通过运行存储在存储器1002的软件程序以及模块，从而执行各种功能应用以及病灶深度数据。输入单元1003可用于接收输入的数字或字符信息，以及产生与客户设置以及功能控制有关的键盘、鼠标、操作杆、光学或者轨迹球信号输入。显示单元1004可用于显示由客户输入的信息或提供给客户的信息以及服务器的各种图形客户接口，这些图形客户接口可以由图形、文本、图标、视频和其任意组合来构成。电子设备还可包括至少一种传感器1005，比如光传感器、运动传感器以及其他传感器。音频电路1006包括扬声器，扬声器可提供客户与电子设备之间的音频接口。WiFi属于短距离无线传输技术，电子设备通过WiFi模块1007可以帮助客户收发电子邮件、浏览网页和随访流式媒体等，它为客户提供了无线的宽带互联网随访。虽然图8示出了WiFi模块1007，但是可以理解的是，其并不属于电子设备的必须构成，完全可以根据需要在不改变申请的本质的范围内而省略。处理器1008是电子设备的控制中心，利用各种接口和线路连接整个手机的各个部分，通过运行或执行存储在存储器1002内的软件程序和/或模块，以及调用存储在存储器1002内的数据，执行电子设备的各种功能和处理数据，从而对手机进行整体监控。电子设备还包括给各个部件供电的电源1009，优选的，电源可以通过电源管理系统与处理器1008逻辑相连，从而通过电源管理系统实现管理充电、放电、以及功耗管理等功能。尽管未示出，电子设备还可以包括摄像头、蓝牙模块等，在此不再赘述。具体在本实施例中，服务器中的处理器1008会按照如下的指令，将一个或一个以上的应用程序的进程对应的可执行文件加载到存储器1002中，并由处理器1008来运行存储在存储器1002中的应用程序，从而实现以下功能：根据真实肠体的第一建模信息，生成与所述真实肠体环境相同的肠体模型，根据真实病灶的第二建模信息，在所述肠体模型的内壁生成病灶模型；根据预设运镜方式和预设摄像头参数，控制模拟摄像头在所述肠体模型内运镜并对所述病灶模型进行拍摄，得到多个第一病灶平面图，根据所述预设运镜方式和所述肠体模型，得到各第一病灶平面图对应的第一病灶深度图；基于各第一病灶平面图和对应的第一病灶深度图对深度估计模型进行训练；获取真实摄像头在目标案例的真实肠体内部拍摄到的第二病灶平面图，并将所述第二病灶平面图输入训练后的深度估计模型，得到所述目标案例的第二病灶深度图；根据所述第二病灶深度图，得到所述目标案例的病灶深度数据。在上述实施例中，对各个实施例的描述都各有侧重，某个实施例中没有详述的部分，可以参见上文的详细描述，此处不再赘述。本领域普通技术人员可以理解，上述实施例的各种方法中的全部或部分步骤可以通过指令来完成，或通过指令控制相关的硬件来完成，该指令可以存储于一计算机可读存储介质中，并由处理器进行加载和执行。为此，本申请实施例提供一种计算机可读存储介质，其中存储有多条指令，该指令能够被处理器进行加载，以实现以下功能：根据真实肠体的第一建模信息，生成与所述真实肠体环境相同的肠体模型，根据真实病灶的第二建模信息，在所述肠体模型的内壁生成病灶模型；根据预设运镜方式和预设摄像头参数，控制模拟摄像头在所述肠体模型内运镜并对所述病灶模型进行拍摄，得到多个第一病灶平面图，根据所述预设运镜方式和所述肠体模型，得到各第一病灶平面图对应的第一病灶深度图；基于各第一病灶平面图和对应的第一病灶深度图对深度估计模型进行训练；获取真实摄像头在目标案例的真实肠体内部拍摄到的第二病灶平面图，并将所述第二病灶平面图输入训练后的深度估计模型，得到所述目标案例的第二病灶深度图；根据所述第二病灶深度图，得到所述目标案例的病灶深度数据。以上对本申请实施例所提供的一种肠体病灶深度数据获取方法、装置、电子设备和计算机可读存储介质进行了详细介绍，本文中应用了具体个例对本申请的原理及实施方式进行了阐述，以上实施例的说明只是用于帮助理解本申请的技术方案及其核心思想；本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本申请各实施例的技术方案的范围。
