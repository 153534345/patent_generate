标题title
基于气管树搜索与最近邻分配的肺段分割方法和装置
摘要abst
本发明提供一种基于气管树搜索与最近邻分配的肺段分割方法和装置，其中方法包括：获取待分割肺部影像的肺叶分割结果和肺气管分割结果；基于细化算法对所述肺气管分割结果进行气管细化，得到所述肺气管分割结果对应的细化气管树；基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管；基于所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离，将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果。本发明提升了肺段分割的精度和效率，可解释性也更强。
权利要求书clms
1.一种基于气管树搜索与最近邻分配的肺段分割方法，其特征在于，包括：获取待分割肺部影像的肺叶分割结果和肺气管分割结果；基于细化算法对所述肺气管分割结果进行气管细化，得到所述肺气管分割结果对应的细化气管树；基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管；其中，所述分支节点为所述细化气管树中除根节点和叶节点以外的节点；基于所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离，将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果。2.根据权利要求1所述的基于气管树搜索与最近邻分配的肺段分割方法，其特征在于，所述基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管，具体包括：对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别和最大深度；其中，所述分支级别是基于对应分支节点与所述根节点之间的分支节点数确定的，所述最大深度是基于对应分支节点与各个叶节点之间的最大分支节点数确定的；基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树后，基于所述各个肺叶对应的气管子树中的分支节点及其对应的分支级别和最大深度，确定所述各个肺叶对应的目标分支节点；其中，任一肺叶对应的目标分支节点是所述任一肺叶对应的气管子树中连接不同段支气管的分支节点；基于所述各个肺叶对应的目标分支节点，确定所述各个肺叶对应的气管子树中的段支气管。3.根据权利要求2所述的基于气管树搜索与最近邻分配的肺段分割方法，其特征在于，所述基于所述各个肺叶对应的气管子树中的分支节点及其对应的分支级别和最大深度，确定所述各个肺叶对应的目标分支节点，具体包括：将任一肺叶对应的气管子树中的分支节点按照分支级别进行归类，得到各个分支级别对应的分支节点组；基于所述任一肺叶中段支气管的结构先验信息，以及所述任一肺叶对应的气管子树中的分支节点及其对应的最大深度，按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量；其中，所述任一肺叶对应的目标节点数量是基于所述任一肺叶中段支气管的数量确定的。4.根据权利要求3所述的基于气管树搜索与最近邻分配的肺段分割方法，其特征在于，所述基于所述任一肺叶中段支气管的结构先验信息，以及所述任一肺叶对应的气管子树中的分支节点及其对应的最大深度，按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量，具体包括：若所述任一肺叶为左上肺叶，则从最低分支级别对应的分支节点组中选取一个最大深度最高的分支节点，并从次低分支级别对应的分支节点组中选取最大深度最高和次高的分支节点，作为所述任一肺叶对应的目标分支节点；若所述任一肺叶为左上肺叶以外的其他肺叶，则按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取最大深度最高的分支节点作为所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量。5.根据权利要求2所述的基于气管树搜索与最近邻分配的肺段分割方法，其特征在于，所述基于所述各个肺叶对应的目标分支节点，确定所述各个肺叶对应的气管子树中的段支气管，具体包括：从任一肺叶对应的气管子树中去除所述任一肺叶对应的目标分支节点，得到所述任一肺叶对应的多个气管段；从所述任一肺叶对应的多个气管段中筛选出包含叶节点的气管段，作为所述任一肺叶对应的气管子树中的段支气管。6.根据权利要求2所述的基于气管树搜索与最近邻分配的肺段分割方法，其特征在于，所述对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别和最大深度，具体包括：对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别、最大深度和最小深度；其中，所述最小深度是基于对应分支节点与各个叶节点之间的最小分支节点数确定的；将最小深度小于预设阈值的分支节点对应的分支级别、最大深度和最小深度筛除后，更新所述最小深度小于预设阈值的分支节点所在子分支中的各个分支节点对应的分支级别。7.根据权利要求1所述的基于气管树搜索与最近邻分配的肺段分割方法，其特征在于，所述肺气管分割结果是基于气管分割网络对所述待分割肺部影像进行气管分割，得到初始气管分割结果后，对所述初始气管分割结果进行下采样得到的；所述初始气管分割结果与所述肺叶分割结果的分辨率一致；所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离是基于如下步骤确定的：基于所述各个肺叶对应的气管子树中的段支气管对所述肺气管分割结果进行段支气管标记后，将标记后的肺气管分割结果上采样，得到与所述初始气管分割结果分辨率一致的段支气管分割结果；基于所述任一肺叶对应的气管子树中的段支气管在所述段支气管分割结果中的位置，计算所述任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离。8.根据权利要求1所述的基于气管树搜索与最近邻分配的肺段分割方法，其特征在于，所述将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果，具体包括：将所述任一肺叶内的像素分配至距离最近的段支气管，并基于所述距离最近的段支气管的气管类型对相应像素进行标记，得到所述任一肺叶对应的肺段分割结果；其中，任一肺叶对应的气管子树中任一段支气管的气管类型是基于所述任一肺叶中段支气管的位置先验信息确定的。9.一种基于气管树搜索与最近邻分配的肺段分割装置，其特征在于，包括：分割单元，用于获取待分割肺部影像的肺叶分割结果和肺气管分割结果；细化单元，用于基于细化算法对所述肺气管分割结果进行气管细化，得到所述肺气管分割结果对应的细化气管树；段支气管获取单元，用于基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管；其中，所述分支节点为所述细化气管树中除根节点和叶节点以外的节点；肺段分割单元，用于基于所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离，将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果。10.一种非暂态计算机可读存储介质，其上存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现如权利要求1至8任一项所述基于气管树搜索与最近邻分配的肺段分割方法。
说明书desc
技术领域本发明涉及图像分割技术领域，尤其涉及一种基于气管树搜索与最近邻分配的肺段分割方法和装置。背景技术肺段分割在肺结节辅助诊断系统的结节定位模块中是一个比较关键的任务，但由于肺段无清晰边界，肺段分割的任务较为困难，目前学术界针对肺段分割的研究相对较少，现有的肺段分割工作通常使用了深度学习的方法进行肺段分割。然而，深度学习在肺段分割中的应用比较受限，原因主要有两点：第一，深度学习需要基于较大量的样例，而肺段的样例标注过程非常困难，获取大量样例所需的时间和人力成本非常高昂；第二，由于各肺段之间没有清晰的边界，而深度学习网络在许多任务中均被证明在分割边界不清晰的物体时表现较差，故深度学习网络对于肺段分割的学习效果难以保证。因此，需要一种精确度和效率均更高的肺段分割方法，以适应肺段分割的产业化需求。发明内容本发明提供一种基于气管树搜索与最近邻分配的肺段分割方法和装置，用以解决现有技术中效率和精确度均欠佳的缺陷。本发明提供一种基于气管树搜索与最近邻分配的肺段分割方法，包括：获取待分割肺部影像的肺叶分割结果和肺气管分割结果；基于细化算法对所述肺气管分割结果进行气管细化，得到所述肺气管分割结果对应的细化气管树；基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管；其中，所述分支节点为所述细化气管树中除根节点和叶节点以外的节点；基于所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离，将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果。根据本发明提供的一种基于气管树搜索与最近邻分配的肺段分割方法，所述基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管，具体包括：对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别和最大深度；其中，所述分支级别是基于对应分支节点与所述根节点之间的分支节点数确定的，所述最大深度是基于对应分支节点与各个叶节点之间的最大分支节点数确定的；基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树后，基于所述各个肺叶对应的气管子树中的分支节点及其对应的分支级别和最大深度，确定所述各个肺叶对应的目标分支节点；其中，任一肺叶对应的目标分支节点是所述任一肺叶对应的气管子树中连接不同段支气管的分支节点；基于所述各个肺叶对应的目标分支节点，确定所述各个肺叶对应的气管子树中的段支气管。根据本发明提供的一种基于气管树搜索与最近邻分配的肺段分割方法，所述基于所述各个肺叶对应的气管子树中的分支节点及其对应的分支级别和最大深度，确定所述各个肺叶对应的目标分支节点，具体包括：将任一肺叶对应的气管子树中的分支节点按照分支级别进行归类，得到各个分支级别对应的分支节点组；基于所述任一肺叶中段支气管的结构先验信息，以及所述任一肺叶对应的气管子树中的分支节点及其对应的最大深度，按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量；其中，所述任一肺叶对应的目标节点数量是基于所述任一肺叶中段支气管的数量确定的。根据本发明提供的一种基于气管树搜索与最近邻分配的肺段分割方法，所述基于所述任一肺叶中段支气管的结构先验信息，以及所述任一肺叶对应的气管子树中的分支节点及其对应的最大深度，按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量，具体包括：若所述任一肺叶为左上肺叶，则从最低分支级别对应的分支节点组中选取一个最大深度最高的分支节点，并从次低分支级别对应的分支节点组中选取最大深度最高和次高的分支节点，作为所述任一肺叶对应的目标分支节点；若所述任一肺叶为左上肺叶以外的其他肺叶，则按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取最大深度最高的分支节点作为所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量。根据本发明提供的一种基于气管树搜索与最近邻分配的肺段分割方法，所述基于所述各个肺叶对应的目标分支节点，确定所述各个肺叶对应的气管子树中的段支气管，具体包括：从任一肺叶对应的气管子树中去除所述任一肺叶对应的目标分支节点，得到所述任一肺叶对应的多个气管段；从所述任一肺叶对应的多个气管段中筛选出包含叶节点的气管段，作为所述任一肺叶对应的气管子树中的段支气管。根据本发明提供的一种基于气管树搜索与最近邻分配的肺段分割方法，所述对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别和最大深度，具体包括：对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别、最大深度和最小深度；其中，所述最小深度是基于对应分支节点与各个叶节点之间的最小分支节点数确定的；将最小深度小于预设阈值的分支节点对应的分支级别、最大深度和最小深度筛除后，更新所述最小深度小于预设阈值的分支节点所在子分支中的各个分支节点对应的分支级别。根据本发明提供的一种基于气管树搜索与最近邻分配的肺段分割方法，所述肺气管分割结果是基于气管分割网络对所述待分割肺部影像进行气管分割，得到初始气管分割结果后，对所述初始气管分割结果进行下采样得到的；所述初始气管分割结果与所述肺叶分割结果的分辨率一致；所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离是基于如下步骤确定的：基于所述各个肺叶对应的气管子树中的段支气管对所述肺气管分割结果进行段支气管标记后，将标记后的肺气管分割结果上采样，得到与所述初始气管分割结果分辨率一致的段支气管分割结果；基于所述任一肺叶对应的气管子树中的段支气管在所述段支气管分割结果中的位置，计算所述任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离。根据本发明提供的一种基于气管树搜索与最近邻分配的肺段分割方法，所述将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果，具体包括：将所述任一肺叶内的像素分配至距离最近的段支气管，并基于所述距离最近的段支气管的气管类型对相应像素进行标记，得到所述任一肺叶对应的肺段分割结果；其中，任一肺叶对应的气管子树中任一段支气管的气管类型是基于所述任一肺叶中段支气管的位置先验信息确定的。本发明还提供一种基于气管树搜索与最近邻分配的肺段分割装置，包括：分割单元，用于获取待分割肺部影像的肺叶分割结果和肺气管分割结果；细化单元，用于基于细化算法对所述肺气管分割结果进行气管细化，得到所述肺气管分割结果对应的细化气管树；段支气管获取单元，用于基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管；其中，所述分支节点为所述细化气管树中除根节点和叶节点以外的节点；肺段分割单元，用于基于所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离，将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果。本发明还提供一种电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，所述处理器执行所述程序时实现如上述任一种所述基于气管树搜索与最近邻分配的肺段分割方法。本发明还提供一种非暂态计算机可读存储介质，其上存储有计算机程序，该计算机程序被处理器执行时实现如上述任一种所述基于气管树搜索与最近邻分配的肺段分割方法。本发明还提供一种计算机程序产品，包括计算机程序，所述计算机程序被处理器执行时实现如上述任一种所述基于气管树搜索与最近邻分配的肺段分割方法。本发明提供的基于气管树搜索与最近邻分配的肺段分割方法和装置，通过深度学习算法对待分割肺部影像进行分割，得到较为精确的肺叶分割结果和肺气管分割结果后，再利用细化算法得到细化气管树，对细化气管树中对应各个肺叶的气管子树的分支节点进行搜索，从而找到各个肺叶中每个肺段对应的段支气管，最终利用最近邻的方法将肺叶中的像素分配到距离其最近的段支气管中实现肺段分割，可见整个肺段方法不需要肺段数据标注以用于深度学习模块的训练，节约了大量的时间成本和人力成本，更重要的是利用段支气管定位以及将各个肺叶内的像素按照段支气管分割的方式，可以快速且精确地将相应肺叶分割为不同的肺段，提升了肺段分割的精度和效率，并且相对于深度学习的方式，上述根据段支气管分割肺段的方式的可解释性也更强。附图说明为了更清楚地说明本发明或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作一简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明提供的基于气管树搜索与最近邻分配的肺段分割方法的流程示意图；图2是本发明提供的段支气管识别方法的流程示意图；图3是本发明提供的分支节点的分支级别的示意图；图4是本发明提供的肺叶像素与段支气管距离计算方法的流程示意图；图5是本发明提供的基于气管树搜索与最近邻分配的肺段分割装置的结构示意图；图6是本发明提供的电子设备的结构示意图。具体实施方式为使本发明的目的、技术方案和优点更加清楚，下面将结合本发明中的附图，对本发明中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有作出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。图1是本发明提供的基于气管树搜索与最近邻分配的肺段分割方法的流程示意图，如图1所示，该方法包括：步骤110，获取待分割肺部影像的肺叶分割结果和肺气管分割结果；步骤120，基于细化算法对所述肺气管分割结果进行气管细化，得到所述肺气管分割结果对应的细化气管树；步骤130，基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管；其中，所述分支节点为所述细化气管树中除根节点和叶节点以外的节点；步骤140，基于所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离，将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果。具体地，可以利用深度学习算法获取待分割肺部影像的肺叶分割结果和肺气管分割结果。由于肺叶和肺气管的边界相较于肺段更清晰且标注难度更低，因此利用深度学习算法可以较快速地获取较准确的肺叶分割结果和肺气管分割结果。其中，可以选用训练好的肺叶分割模型对待分割肺部影像进行肺叶分割，得到该待分割肺部影像的肺叶分割结果，肺叶分割结果可以为包含该待分割肺部影像中各个肺叶的掩膜图，从而可以快速地区分各个肺叶区域。肺叶分割模型可以基于样本肺部影像以及对应的肺叶标注结果训练得到。此外，可以选用训练好的气管分割模型对待分割肺部影像进行气管分割，得到该待分割肺部影像的肺气管分割结果，肺气管分割结果可以为包含该待分割肺部影像中肺气管的掩膜图，从而可以快速地定位该影像中的气管区域。需要说明的是，肺叶分割模型和气管分割模型可以基于现有目标分割网络构建得到，例如可以基于unet构建，本发明实施例对此不作具体限制。随后，基于细化算法对肺气管分割结果进行气管细化，将具备一定面积的肺气管细化为单体素的骨架线条，从而可以得到肺气管分割结果对应的细化气管树。其中，通过细化算法提取到肺气管分割结果的气管骨架后，可以利用特征点识别等方式标记出气管骨架中的根节点、分叉点和叶节点，从而生成正式的树形结构，得到细化气管树。基于肺叶分割结果中指示的各个肺叶区域，可以从细化气管树中划分出各个肺叶对应的气管子树，以对各个肺叶对应的气管子树分别独立进行处理。搜索各个肺叶对应的气管子树中的分支节点，以确定各个肺叶对应的气管子树中的段支气管。其中，分支节点为细化气管树中除根节点和叶节点以外的节点。通过搜索某一肺叶对应的气管子树中的分支节点，并基于该肺叶对应的气管子树中各个分支节点之间的空间结构关系，可以定位到该肺叶对应的气管子树中的段支气管。此处，任一段支气管对应该肺叶中的一个肺段，段支气管与肺段在空间位置上存在紧密的关联关系，因此通过上述段支气管的定位方式，可以快速地将相应肺叶分割为不同的肺段。具体而言，在获取到各个肺叶对应的气管子树中的段支气管之后，考虑到任一段支气管对应该肺叶中的一个肺段，因此任一肺段内的像素与该肺段内的段支气管之间的距离相对于其它段支气管更近，故可以通过计算该肺叶内的像素与该肺叶对应的气管子树中的各个段支气管的距离，将该肺叶内的各个像素分配至与对应像素距离最近的段支气管，从而将该肺叶内的像素按照段支气管分割开，得到该肺叶对应的肺段分割结果。其中，分配至同一段支气管的像素属于同一肺段，因此可以为该肺叶中的各像素添加肺段标签，从而得到该肺叶对应的肺段分割结果。各个肺叶对应的肺段分割结果合并后，可以得到待分割肺部影像对应的肺段分割结果。此外，在计算任一肺叶内的像素与该肺叶对应的气管子树中的各个段支气管的距离时，可以首先定位肺叶内像素和各个段支气管在待分割肺部影像中的位置，从而将两者置于同一坐标系内以准确计算两者间的距离。本发明实施例提供的方法，通过深度学习算法对待分割肺部影像进行分割，得到较为精确的肺叶分割结果和肺气管分割结果后，再利用细化算法得到细化气管树，对细化气管树中对应各个肺叶的气管子树的分支节点进行搜索，从而找到各个肺叶中每个肺段对应的段支气管，最终利用最近邻的方法将肺叶中的像素分配到距离其最近的段支气管中实现肺段分割，可见整个肺段方法不需要肺段数据标注以用于深度学习模块的训练，节约了大量的时间成本和人力成本，更重要的是利用段支气管定位以及将各个肺叶内的像素按照段支气管分割的方式，可以快速且精确地将相应肺叶分割为不同的肺段，提升了肺段分割的精度和效率，并且相对于深度学习的方式，上述根据段支气管分割肺段的方式的可解释性也更强。基于上述实施例，如图2所示，所述基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管，具体包括：步骤210，对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别和最大深度；其中，所述分支级别是基于对应分支节点与所述根节点之间的分支节点数确定的，所述最大深度是基于对应分支节点与各个叶节点之间的最大分支节点数确定的；步骤220，基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树后，基于所述各个肺叶对应的气管子树中的分支节点及其对应的分支级别和最大深度，确定所述各个肺叶对应的目标分支节点；其中，任一肺叶对应的目标分支节点是所述任一肺叶对应的气管子树中连接不同段支气管的分支节点；步骤230，基于所述各个肺叶对应的目标分支节点，确定所述各个肺叶对应的气管子树中的段支气管。具体地，从细化气管树的根节点开始对细化气管树的节点进行深度优先搜索，从而获取该细化气管树中的各个分支节点以及各个分支节点对应的分支级别和最大深度。其中，任一分支节点对应的分支级别是基于该分支节点与根节点之间的分支节点数确定的，如图3所示，其分支级别可以为该分支节点与根节点之间的分支节点数加1；任一分支节点对应的最大深度则是基于对应分支节点与各个叶节点之间的最大分支节点数确定的，其可以通过计算该分支节点与属于同一条遍历路径的叶节点之间的距离的最大值得到。基于肺叶分割结果，从上述细化气管树中划分出各个肺叶对应的气管子树后，可以基于各个肺叶对应的气管子树中的分支节点及其对应的分支级别和最大深度，确定各个肺叶对应的目标分支节点。其中，任一肺叶对应的目标分支节点是该肺叶对应的气管子树中连接不同段支气管的分支节点。通过寻找到各个肺叶对应的目标分支节点，即可准确地从各个肺叶对应的气管子树中划分出相应的段支气管。此处，由于任一肺叶对应的目标分支节点为划分不同段支气管的分支节点，因此目标分支节点通常位于该肺叶对应的气管子树中的主干分支上，其最大深度通常较高，且各个目标分支节点之间的分支级别也存在一定的规律性。因此，可以基于各个肺叶对应的气管子树中的分支节点及其对应的分支级别和最大深度，结合各个肺叶内段支气管的结构信息，确定各个肺叶对应的目标分支节点。随后，基于各个肺叶对应的目标分支节点，可以确定各个肺叶对应的气管子树中的段支气管。基于上述任一实施例，所述基于所述各个肺叶对应的气管子树中的分支节点及其对应的分支级别和最大深度，确定所述各个肺叶对应的目标分支节点，具体包括：将任一肺叶对应的气管子树中的分支节点按照分支级别进行归类，得到各个分支级别对应的分支节点组；基于所述任一肺叶中段支气管的结构先验信息，以及所述任一肺叶对应的气管子树中的分支节点及其对应的最大深度，按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量；其中，所述任一肺叶对应的目标节点数量是基于所述任一肺叶中段支气管的数量确定的。具体地，将任一肺叶对应的气管子树中的分支节点按照分支级别进行归类，可以得到各个分支级别对应的分支节点组，其中任一分支级别对应的分支节点组中的分支节点的分支级别均相同。由于不同肺叶中段支气管的分布不同，因此选取目标分支节点的策略也相应有所差异。对此，可以基于该肺叶中段支气管的结构先验信息，以及该肺叶对应的气管子树中的分支节点及其对应的最大深度，按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取该肺叶对应的目标分支节点，直至选取的目标分支节点达到该肺叶对应的目标节点数量。其中，该肺叶对应的目标节点数量是基于该肺叶中段支气管的数量确定的，目标节点数量可以为该肺叶中段支气管的数量－1。此处，任一肺叶中段支气管的结构先验信息包括该肺叶中各个段支气管在气管子树中的空间结构信息。以左上肺叶为例，该肺叶中段支气管的结构先验信息中可以包括从该肺叶对应的气管子树的主干分支出发划分出的两个分支，上支分裂为两个段支气管，舌支也分裂为两个段支气管。根据该肺叶中段支气管的结构先验信息，可以获知该肺叶对应的目标分支节点的空间结构信息。此外，分支节点的分支级别和最大深度也反映了该分支节点在气管子树中的空间位置，因此结合该肺叶中段支气管的结构先验信息以及分支节点的分支级别和最大深度信息，按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中进行节点选取，可以准确选取出目标分支节点。基于上述任一实施例，所述基于所述任一肺叶中段支气管的结构先验信息，以及所述任一肺叶对应的气管子树中的分支节点及其对应的最大深度，按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量，具体包括：若所述任一肺叶为左上肺叶，则从最低分支级别对应的分支节点组中选取一个最大深度最高的分支节点，并从次低分支级别对应的分支节点组中选取最大深度最高和次高的分支节点，作为所述任一肺叶对应的目标分支节点；若所述任一肺叶为左上肺叶以外的其他肺叶，则按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取最大深度最高的分支节点作为所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量。具体地，若该肺叶为左上肺叶，根据该肺叶的结构先验信息得知其主干分支上有一个目标分支节点，随后在两个分支上还各有一个目标分支节点，因此，针对左上肺叶，可以从最低分支级别对应的分支节点组中选取一个最大深度最高的分支节点，并从次低分支级别对应的分支节点组中选取最大深度最高和次高的分支节点，作为该肺叶对应的目标分支节点。若该肺叶为左上肺叶以外的其他肺叶，则按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取最大深度最高的分支节点作为该肺叶对应的目标分支节点，直至选取的目标分支节点的数量达到该肺叶对应的目标节点数量。基于上述任一实施例，所述基于所述各个肺叶对应的目标分支节点，确定所述各个肺叶对应的气管子树中的段支气管，具体包括：从任一肺叶对应的气管子树中去除所述任一肺叶对应的目标分支节点，得到所述任一肺叶对应的多个气管段；从所述任一肺叶对应的多个气管段中筛选出包含叶节点的气管段，作为所述任一肺叶对应的气管子树中的段支气管。具体地，由于肺叶的气管子树中除段支气管外还有若干其他气管段，例如气管子树主干分支的起始段、舌支上分裂为上舌段支气管和下舌段支气管之前的气管段等等。因此，为了从各个肺叶对应的气管子树中准确地定位到其中的段支气管，可以基于上述得到的目标分支节点，将该肺叶对应的目标分支节点从该肺叶对应的气管子树中删除，删除了目标分支节点的气管子树被分割为了多个气管段。随后，从该肺叶对应的多个气管段中筛选出包含叶节点的气管段，该包含叶节点的气管段即为该肺叶对应的气管子树中的段支气管。基于上述任一实施例，所述对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别和最大深度，具体包括：对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别、最大深度和最小深度；其中，所述最小深度是基于对应分支节点与各个叶节点之间的最小分支节点数确定的；将最小深度小于预设阈值的分支节点对应的分支级别、最大深度和最小深度筛除后，更新所述最小深度小于预设阈值的分支节点所在子分支中的各个分支节点对应的分支级别。具体地，为了进一步提升后续段支气管的识别精度，可以对细化气管树中的毛刺进行消除，以避免细化气管树中的毛刺影响段支气管的识别。对此，可以在对细化气管树进行深度优先搜索时，同时获取各个分支节点及其对应的分支级别、最大深度和最小深度。其中，任一分支节点对应的最小深度是基于该分支节点与各个叶节点之间的最小分支节点数确定的，其可以通过计算该分支节点与属于同一条遍历路径的叶节点之间的距离的最小值得到，该最小深度将用于去除细化气管树中的毛刺。具体而言，可以将最小深度小于预设阈值的分支节点视为毛刺节点，并筛除其对应的分支级别、最大深度和最小深度等信息，使得在后续搜索分支节点以确定段支气管时忽略该毛刺节点。随后，更新上述最小深度小于预设阈值的分支节点所在子分支中的各个分支节点对应的分支级别。此处，可以获取上述毛刺节点发出的所有子分支，并将该子分支中的所有分支节点的分支级别－1。基于上述任一实施例，所述肺气管分割结果是基于气管分割网络对所述待分割肺部影像进行气管分割，得到初始气管分割结果后，对所述初始气管分割结果进行下采样得到的；所述初始气管分割结果与所述肺叶分割结果的分辨率一致；如图4所示，所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离是基于如下步骤确定的：步骤410，基于所述各个肺叶对应的气管子树中的段支气管对所述肺气管分割结果进行段支气管标记后，将标记后的肺气管分割结果上采样，得到与所述初始气管分割结果分辨率一致的段支气管分割结果；步骤420，基于所述任一肺叶对应的气管子树中的段支气管在所述段支气管分割结果中的位置，计算所述任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离。具体地，为了进一步提升肺段分割的效率使其满足产业化需求，可以基于气管分割网络对待分割肺部影像进行气管分割，得到初始气管分割结果，再对初始气管分割结果进行下采样，得到肺气管分割结果。其中，初始气管分割结果与肺叶分割结果的分辨率一致。由于肺气管分割结果是经过下采样后分辨率更低的图像，因此在对其进行细化时的速度能够得到有效提升。需要说明的是，在基于肺叶分割结果，从细化气管树中划分出各个肺叶对应的气管子树时，需要对肺叶分割结果也进行下采样，使其分辨率与细化气管树一致，但在后续计算肺叶分割结果中任一肺叶内的像素与该肺叶对应的气管子树中的段支气管的距离时，采用的仍是原始的未下采样的肺叶分割结果。具体在计算肺叶分割结果中任一肺叶内的像素与该肺叶对应的气管子树中的段支气管的距离时，基于各个肺叶对应的气管子树中的段支气管对肺气管分割结果进行段支气管标记后，将标记后的肺气管分割结果上采样，得到与初始气管分割结果分辨率一致的段支气管分割结果。可见，段支气管分割结果的分辨率也与肺叶分割结果的分辨率一致。随后，基于该肺叶对应的气管子树中的段支气管在段支气管分割结果中的位置，以及该肺叶内各个像素在肺叶分割结果中的位置，计算该肺叶内的像素与该肺叶对应的气管子树中的段支气管的距离。基于上述任一实施例，所述将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果，具体包括：将所述任一肺叶内的像素分配至距离最近的段支气管，并基于所述距离最近的段支气管的气管类型对相应像素进行标记，得到所述任一肺叶对应的肺段分割结果；其中，任一肺叶对应的气管子树中任一段支气管的气管类型是基于所述任一肺叶中段支气管的位置先验信息确定的。具体地，将该肺叶内的像素分配至与相应像素距离最近的段支气管后，可以基于距离最近的段支气管的气管类型对相应像素进行标记，使得将同一肺叶内不同肺段的像素可以相互区分。其中，任一肺叶对应的气管子树中任一段支气管的气管类型是基于该肺叶中段支气管的位置先验信息确定的。例如，右上肺分出三个段支气管，则根据该肺叶的位置先验信息，靠上的是尖段支气管，故取三个段支气管中重心在z方向最大的段支气管为尖段对应的段支气管；剩余两个段支气管中靠前胸方向的是前段支气管，故取剩余两个气管段中重心在y方向最小的气管段为前段对应的段支气管。下面对本发明提供的基于气管树搜索与最近邻分配的肺段分割装置进行描述，下文描述的基于气管树搜索与最近邻分配的肺段分割装置与上文描述的基于气管树搜索与最近邻分配的肺段分割方法可相互对应参照。基于上述任一实施例，图5是本发明提供的基于气管树搜索与最近邻分配的肺段分割装置的结构示意图，如图5所示，该装置包括：分割单元510、细化单元520、段支气管获取单元530和肺段分割单元540。其中，分割单元510用于获取待分割肺部影像的肺叶分割结果和肺气管分割结果；细化单元520用于基于细化算法对所述肺气管分割结果进行气管细化，得到所述肺气管分割结果对应的细化气管树；段支气管获取单元530用于基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管；其中，所述分支节点为所述细化气管树中除根节点和叶节点以外的节点；肺段分割单元540用于基于所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离，将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果。本发明实施例提供的装置，通过深度学习算法对待分割肺部影像进行分割，得到较为精确的肺叶分割结果和肺气管分割结果后，再利用细化算法得到细化气管树，对细化气管树中对应各个肺叶的气管子树的分支节点进行搜索，从而找到各个肺叶中每个肺段对应的段支气管，最终利用最近邻的方法将肺叶中的像素分配到距离其最近的段支气管中实现肺段分割，可见整个肺段方法不需要肺段数据标注以用于深度学习模块的训练，节约了大量的时间成本和人力成本，更重要的是利用段支气管定位以及将各个肺叶内的像素按照段支气管分割的方式，可以快速且精确地将相应肺叶分割为不同的肺段，提升了肺段分割的精度和效率，并且相对于深度学习的方式，上述根据段支气管分割肺段的方式的可解释性也更强。基于上述任一实施例，所述基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管，具体包括：对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别和最大深度；其中，所述分支级别是基于对应分支节点与所述根节点之间的分支节点数确定的，所述最大深度是基于对应分支节点与各个叶节点之间的最大分支节点数确定的；基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树后，基于所述各个肺叶对应的气管子树中的分支节点及其对应的分支级别和最大深度，确定所述各个肺叶对应的目标分支节点；其中，任一肺叶对应的目标分支节点是所述任一肺叶对应的气管子树中连接不同段支气管的分支节点；基于所述各个肺叶对应的目标分支节点，确定所述各个肺叶对应的气管子树中的段支气管。基于上述任一实施例，所述基于所述各个肺叶对应的气管子树中的分支节点及其对应的分支级别和最大深度，确定所述各个肺叶对应的目标分支节点，具体包括：将任一肺叶对应的气管子树中的分支节点按照分支级别进行归类，得到各个分支级别对应的分支节点组；基于所述任一肺叶中段支气管的结构先验信息，以及所述任一肺叶对应的气管子树中的分支节点及其对应的最大深度，按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量；其中，所述任一肺叶对应的目标节点数量是基于所述任一肺叶中段支气管的数量确定的。基于上述任一实施例，所述基于所述任一肺叶中段支气管的结构先验信息，以及所述任一肺叶对应的气管子树中的分支节点及其对应的最大深度，按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量，具体包括：若所述任一肺叶为左上肺叶，则从最低分支级别对应的分支节点组中选取一个最大深度最高的分支节点，并从次低分支级别对应的分支节点组中选取最大深度最高和次高的分支节点，作为所述任一肺叶对应的目标分支节点；若所述任一肺叶为左上肺叶以外的其他肺叶，则按照分支级别由小到大的顺序从各个分支级别对应的分支节点组中选取最大深度最高的分支节点作为所述任一肺叶对应的目标分支节点，直至选取的目标分支节点达到所述任一肺叶对应的目标节点数量。基于上述任一实施例，所述基于所述各个肺叶对应的目标分支节点，确定所述各个肺叶对应的气管子树中的段支气管，具体包括：从任一肺叶对应的气管子树中去除所述任一肺叶对应的目标分支节点，得到所述任一肺叶对应的多个气管段；从所述任一肺叶对应的多个气管段中筛选出包含叶节点的气管段，作为所述任一肺叶对应的气管子树中的段支气管。基于上述任一实施例，所述对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别和最大深度，具体包括：对所述细化气管树进行深度优先搜索，得到所述细化气管树中的各个分支节点及其对应的分支级别、最大深度和最小深度；其中，所述最小深度是基于对应分支节点与各个叶节点之间的最小分支节点数确定的；将最小深度小于预设阈值的分支节点对应的分支级别、最大深度和最小深度筛除后，更新所述最小深度小于预设阈值的分支节点所在子分支中的各个分支节点对应的分支级别。基于上述任一实施例，所述肺气管分割结果是基于气管分割网络对所述待分割肺部影像进行气管分割，得到初始气管分割结果后，对所述初始气管分割结果进行下采样得到的；所述初始气管分割结果与所述肺叶分割结果的分辨率一致；所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离是基于如下步骤确定的：基于所述各个肺叶对应的气管子树中的段支气管对所述肺气管分割结果进行段支气管标记后，将标记后的肺气管分割结果上采样，得到与所述初始气管分割结果分辨率一致的段支气管分割结果；基于所述任一肺叶对应的气管子树中的段支气管在所述段支气管分割结果中的位置，计算所述任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离。基于上述任一实施例，所述将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果，具体包括：将所述任一肺叶内的像素分配至距离最近的段支气管，并基于所述距离最近的段支气管的气管类型对相应像素进行标记，得到所述任一肺叶对应的肺段分割结果；其中，任一肺叶对应的气管子树中任一段支气管的气管类型是基于所述任一肺叶中段支气管的位置先验信息确定的。图6是本发明提供的电子设备的结构示意图，如图6所示，该电子设备可以包括：处理器610、存储器620、通信接口630和通信总线640，其中，处理器610，存储器620，通信接口630通过通信总线640完成相互间的通信。处理器610可以调用存储器620中的逻辑指令，以执行基于气管树搜索与最近邻分配的肺段分割方法，该方法包括：获取待分割肺部影像的肺叶分割结果和肺气管分割结果；基于细化算法对所述肺气管分割结果进行气管细化，得到所述肺气管分割结果对应的细化气管树；基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管；其中，所述分支节点为所述细化气管树中除根节点和叶节点以外的节点；基于所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离，将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果。此外，上述的存储器620中的逻辑指令可以通过软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本发明的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台计算机设备执行本发明各个实施例所述方法的全部或部分步骤。而前述的存储介质包括：U盘、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质。另一方面，本发明还提供一种计算机程序产品，所述计算机程序产品包括存储在非暂态计算机可读存储介质上的计算机程序，所述计算机程序包括程序指令，当所述程序指令被计算机执行时，计算机能够执行上述各方法所提供的基于气管树搜索与最近邻分配的肺段分割方法，该方法包括：获取待分割肺部影像的肺叶分割结果和肺气管分割结果；基于细化算法对所述肺气管分割结果进行气管细化，得到所述肺气管分割结果对应的细化气管树；基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管；其中，所述分支节点为所述细化气管树中除根节点和叶节点以外的节点；基于所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离，将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果。又一方面，本发明还提供一种非暂态计算机可读存储介质，其上存储有计算机程序，该计算机程序被处理器执行时实现以执行上述各提供的基于气管树搜索与最近邻分配的肺段分割方法，该方法包括：获取待分割肺部影像的肺叶分割结果和肺气管分割结果；基于细化算法对所述肺气管分割结果进行气管细化，得到所述肺气管分割结果对应的细化气管树；基于所述肺叶分割结果，从所述细化气管树中划分出各个肺叶对应的气管子树，并搜索所述各个肺叶对应的气管子树中的分支节点，确定所述各个肺叶对应的气管子树中的段支气管；其中，所述分支节点为所述细化气管树中除根节点和叶节点以外的节点；基于所述肺叶分割结果中任一肺叶内的像素与所述任一肺叶对应的气管子树中的段支气管的距离，将所述任一肺叶内的像素分配至距离最近的段支气管，得到所述任一肺叶对应的肺段分割结果。以上所描述的装置实施例仅仅是示意性的，其中所述作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部模块来实现本实施例方案的目的。本领域普通技术人员在不付出创造性的劳动的情况下，即可以理解并实施。通过以上的实施方式的描述，本领域的技术人员可以清楚地了解到各实施方式可借助软件加必需的通用硬件平台的方式来实现，当然也可以通过硬件。基于这样的理解，上述技术方案本质上或者说对现有技术做出贡献的部分可以以软件产品的形式体现出来，该计算机软件产品可以存储在计算机可读存储介质中，如ROM/RAM、磁碟、光盘等，包括若干指令用以使得一台计算机设备执行各个实施例或者实施例的某些部分所述的方法。最后应说明的是：以上实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的精神和范围。
