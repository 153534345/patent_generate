标题title
基于量质耦合预报的水资源水环境调控方法和系统
摘要abst
本发明公开了一种基于量质耦合预报的水资源水环境调控方法和系统，包括：获取研究区域的基础数据；读取数字高程数据，提取河网和集水区信息，将研究区域划分为若干个子区域；针对各个子区域分别构建河网拓扑单元，并形成研究区域的整体河网拓扑；按照时间顺序，读取每个河网拓扑单元各个时期的径流量、水质数据和用水量数据，形成若干个水文数据空间；构建SWAT‑GNN模型，以各个河网拓扑单元的水文数据空间为输入数据，对SWAT‑GNN模型进行训练，通过验证数据进行验证，直至符合预期要求；将训练好的SWAT‑GNN模型部署至调控平台，对研究区域的水资源进行调控。本申请大大提高了预测的质量，并提高模型的泛化能力。
权利要求书clms
1.基于量质耦合预报的水资源水环境调控方法，其特征在于，包括如下步骤：步骤S1、获取研究区域的基础数据，所述基础数据包括数字高程数据、径流量数据、水质数据和用水量数据；读取数字高程数据，提取河网和集水区信息，将研究区域划分为若干个子区域，步骤S2、针对各个子区域分别构建河网拓扑单元，并形成研究区域的整体河网拓扑；按照时间顺序，读取每个河网拓扑单元各个时期的径流量、水质数据和用水量数据，形成若干个水文数据空间；步骤S3、构建SWAT-GNN模型，并以各个河网拓扑单元的水文数据空间为输入数据，对SWAT-GNN模型进行训练，并通过验证数据进行验证，直至符合预期要求；步骤S4、将训练好的SWAT-GNN模型部署至调控平台，对研究区域的水资源进行调控。2.如权利要求1所述的基于量质耦合预报的水资源水环境调控方法，其特征在于，所述步骤S1进一步为：步骤S11、读取至少两个数据源的基础数据，获取研究区域的栅格化的晕渲图；步骤S12、采用ArcGIS分析工具进行流向分析和流量统计，并基于预存储的最小径流量数值提取河段并链接成河流，形成矢量河网，保存在数字高程数据中；步骤S13、采用ArcGIS分析工具提取集水区，建立河段与集水区的关联关系，并基于集水区将研究区域划分为若干个子区域；步骤S14、采用图卷积神经网络对晕渲图中各个集水区进行识别，将基于识别结果将相似度大于阈值的集水区标记为一类，形成若干类集水区组成的集水区集合。3.如权利要求2所述的基于量质耦合预报的水资源水环境调控方法，其特征在于，所述步骤S14进一步为：步骤S14a、构建集水区数据集，并分为训练集和验证集；步骤S14b、构建图卷积神经网络和损失函数，所述损失函数为交叉熵损失函数；采用训练集对图卷积神经网络进行训练；步骤S14c、依序选择集水区，通过图卷积神经网络计算其他各个集水区的相似度，获得交叉熵集合，并升序排列；步骤S14d、依序选择各个集水区对应的前N项交叉熵对应的集水区，作为相似集水区，作为该集水区的相似区域集合，为该集合分配标签，N为正整数。4.如权利要求3所述的基于量质耦合预报的水资源水环境调控方法，其特征在于，所述步骤S2进一步为：步骤S21、顺次读取研究区域的各个子区域并构建该子区域的河网拓扑单元，获取该子区域对应的河段与集水区数据，形成该子区域对应的局部数据集；步骤S22、基于不同子区域之间拓扑关系，构建研究区域的整体河网拓扑；并基于整体河网拓扑构建各个子区域之间的局部数据集的映射关系；步骤S23、将研究区域的基础数据分为若干个时间段，读取每个时间段的基础数据，并对应至该研究区域的各个子区域，形成针对每个时间段的水文数据集；步骤S24、基于各个时间段的水文数据集构建水文数据空间。5.如权利要求4所述的基于量质耦合预报的水资源水环境调控方法，其特征在于，所述步骤S3进一步为：步骤S31、针对研究区域，构建SWAT模型，并以各个子区域的基础数据作为输入数据，通过SWAT模型对研究区域进行模拟，输出每一子区域的M组水质水量计算值，M为大于等于3的正整数；所述水质水量计算值至少包括氮含量值、磷含量值和耗氧量值；步骤S32、针对每组水质水量计算值，从基础数据中查找对应的观测值，形成M组神经网络输入数组；步骤S33、构建GNN模型，并以每个子区域的M组神经网络输入数组作为输入，对GNN模型进行训练，直至损失函数值达到预期值。6.如权利要求5所述的基于量质耦合预报的水资源水环境调控方法，其特征在于，所述步骤S31还包括：步骤S311、在研究区域的整体河网拓扑中设置预定数量个区域水质水量数据点，形成水质水量数据点矩阵，初始化水质水量数据点矩阵中的参数值；步骤S312、按照预定顺序针对每一子区域，选择至少K个时间段的基础数据，逐一构建该时间段内的基础数据与水质水量数据点矩阵的映射关系；K为大于等于2的正整数；步骤S313、逐一计算水质水量数据点矩阵中各个参数值与不同时间段内基础数据的均方误差，求取整体均方误差最小的H个时间段，将各个时间段中的基础数据作为神经网络输入参数集合储备数据。7.如权利要求6所述的基于量质耦合预报的水资源水环境调控方法，其特征在于，还包括：步骤S314、采用主成分分析法计算H个时间段内基础数据的占比，并降序排列，将前A个时间段内的数据作为关键时间段数据；H、A为正整数；步骤S315、针对水质水量数据点矩阵的任一数据点参数，基于整体河网拓扑，查找每一数据点与相邻数据点之间的关联关系，形成从集水区至最终汇水区的关联关系有向图；步骤S316、逐一计算关联关系有向图中各个有向线段的综合关联关系系数，并降序排列。8.如权利要求7所述的基于量质耦合预报的水资源水环境调控方法，其特征在于，还包括：步骤S34、顺次读取GNN模型输出的每一子区域各个时间段的预测数值，计算该子区域对应的水质水量数据点矩阵中每一数据点的实测值与预测数值的方差之和；步骤S35、按照方差之和升序排列的方式，选取前若干个时间段的数据，作为所述GNN模型的参考训练集。9.如权利要求8所述的基于量质耦合预报的水资源水环境调控方法，其特征在于，所述步骤S315还包括：基于所述整体河网拓扑，提取相邻数据点之间的局部交互特征，构建局部特征交互单元。10.一种基于量质耦合预报的水资源水环境调控系统，其特征在于，包括：至少一个处理器；以及与至少一个所述处理器通信连接的存储器；其中，所述存储器存储有可被所述处理器执行的指令，所述指令用于被所述处理器执行以实现权利要求1-9任一项所述的基于量质耦合预报的水资源水环境调控方法。
说明书desc
技术领域本发明涉及水量预测技术，尤其是一种基于量质耦合预报的水资源水环境调控方法和系统。背景技术随着社会经济的发展，水质监测对于生态保护和引水安全越发重要。如果采用布设水质监测系统的方式，其时间成本和生产安装成本是非常高的，这种方式一般用于水源地等区域。为了克服这些缺陷，技术人员开发了多种水质模型，通过这些水质模型提高水质参数的预测精度，这种技术在过去几十年得到的大力的发展，获得了比较好的效果。随着气候变化和人类活动对环境的影响，这些模型出现了新的问题；同时，采用上述模型在参数估计、率定、校准和验证过程中需要较长的时间。近年来，随着人工神经网络技术的发展，水文模型得到了新的发展，人工神经网络无需获取物理过程的参数，只需要大量的训练和验证数据即可。但是目前的人工神经网络还存在诸如需要对网络结构和训练数据进行优选，一旦超出原始的训练数据和变换使用场景，这些模型的预测质量可能会受到较大影响，预测效果降低，换句话说，模型的泛化能力还需要提高。当然，还存在一些其他技术问题。因此，需要进行进一步的技术研究和创新。发明内容发明目的：一方面，提供一种基于量质耦合预报的水资源水环境调控方法，以解决现有技术存在的上述问题。另一方面，提供一种实现上述方法的系统。技术方案：基于量质耦合预报的水资源水环境调控方法，包括如下步骤：步骤S1、获取研究区域的基础数据，所述基础数据包括数字高程数据、径流量数据、水质数据和用水量数据；读取数字高程数据，提取河网和集水区信息，将研究区域划分为若干个子区域，步骤S2、针对各个子区域分别构建河网拓扑单元，并形成研究区域的整体河网拓扑；按照时间顺序，读取每个河网拓扑单元各个时期的径流量、水质数据和用水量数据，形成若干个水文数据空间；步骤S3、构建SWAT-GNN模型，并以各个河网拓扑单元的水文数据空间为输入数据，对SWAT-GNN模型进行训练，并通过验证数据进行验证，直至符合预期要求；步骤S4、将训练好的SWAT-GNN模型部署至调控平台，对研究区域的水资源进行调控。根据本申请的一个方面，所述步骤S1进一步为：步骤S11、读取至少两个数据源的基础数据，获取研究区域的栅格化的晕渲图；步骤S12、采用ArcGIS分析工具进行流向分析和流量统计，并基于预存储的最小径流量数值提取河段并链接成河流，形成矢量河网，保存在数字高程数据中；步骤S13、采用ArcGIS分析工具提取集水区，建立河段与集水区的关联关系，并基于集水区将研究区域划分为若干个子区域；步骤S14、采用图卷积神经网络对晕渲图中各个集水区进行识别，将基于识别结果将相似度大于阈值的集水区标记为一类，形成若干类集水区组成的集水区集合。根据本申请的一个方面，所述步骤S14进一步为：步骤S14a、构建集水区数据集，并分为训练集和验证集；步骤S14b、构建图卷积神经网络和损失函数，所述损失函数为交叉熵损失函数；采用训练集对图卷积神经网络进行训练；步骤S14c、依序选择集水区，通过图卷积神经网络计算其他各个集水区的相似度，获得交叉熵集合，并升序排列；步骤S14d、依序选择各个集水区对应的前N项交叉熵对应的集水区，作为相似集水区，作为该集水区的相似区域集合，为该集合分配标签，N为正整数。根据本申请的一个方面，所述步骤S2进一步为：步骤S21、顺次读取研究区域的各个子区域并构建该子区域的河网拓扑单元，获取该子区域对应的河段与集水区数据，形成该子区域对应的局部数据集；步骤S22、基于不同子区域之间拓扑关系，构建研究区域的整体河网拓扑；并基于整体河网拓扑构建各个子区域之间的局部数据集的映射关系；步骤S23、将研究区域的基础数据分为若干个时间段，读取每个时间段的基础数据，并对应至该研究区域的各个子区域，形成针对每个时间段的水文数据集；步骤S24、基于各个时间段的水文数据集构建水文数据空间。根据本申请的一个方面，所述步骤S3进一步为：步骤S31、针对研究区域，构建SWAT模型，并以各个子区域的基础数据作为输入数据，通过SWAT模型对研究区域进行模拟，输出每一子区域的M组水质水量计算值，M为大于等于3的正整数；所述水质水量计算值至少包括氮含量值、磷含量值和耗氧量值；步骤S32、针对每组水质水量计算值，从基础数据中查找对应的观测值，形成M组神经网络输入数组；步骤S33、构建GNN模型，并以每个子区域的M组神经网络输入数组作为输入，对GNN模型进行训练，直至损失函数值达到预期值。根据本申请的一个方面，所述步骤S31还包括：步骤S311、在研究区域的整体河网拓扑中设置预定数量个区域水质水量数据点，形成水质水量数据点矩阵，初始化水质水量数据点矩阵中的参数值；步骤S312、按照预定顺序针对每一子区域，选择至少K个时间段的基础数据，逐一构建该时间段内的基础数据与水质水量数据点矩阵的映射关系；K为大于等于2的正整数；步骤S313、逐一计算水质水量数据点矩阵中各个参数值与不同时间段内基础数据的均方误差，求取整体均方误差最小的H个时间段，将各个时间段中的基础数据作为神经网络输入参数集合储备数据。根据本申请的一个方面，还包括：步骤S314、采用主成分分析法计算H个时间段内基础数据的占比，并降序排列，将前A个时间段内的数据作为关键时间段数据；H、A为正整数；步骤S315、针对水质水量数据点矩阵的任一数据点参数，基于整体河网拓扑，查找每一数据点与相邻数据点之间的关联关系，形成从集水区至最终汇水区的关联关系有向图；步骤S316、逐一计算关联关系有向图中各个有向线段的综合关联关系系数，并降序排列。根据本申请的一个方面，还包括：步骤S34、顺次读取GNN模型输出的每一子区域各个时间段的预测数值，计算该子区域对应的水质水量数据点矩阵中每一数据点的实测值与预测数值的方差之和；步骤S35、按照方差之和升序排列的方式，选取前若干个时间段的数据，作为所述GNN模型的参考训练集。根据本申请的一个方面，所述步骤S315还包括：基于所述整体河网拓扑，提取相邻数据点之间的局部交互特征，构建局部特征交互单元。根据本申请的另一个方面，还提供一种基于量质耦合预报的水资源水环境调控系统，包括：至少一个处理器；以及与至少一个所述处理器通信连接的存储器；其中，所述存储器存储有可被所述处理器执行的指令，所述指令用于被所述处理器执行以实现上述任一项技术方案所述的基于量质耦合预报的水资源水环境调控方法。有益效果：本发明通过SWAT-GNN模型，大大提高了预测的质量，并提高模型的泛化能力。相关技术优势，将在具体实施方式部分做进一步描述。附图说明图1是本发明的流程图。图2是本发明步骤S1的流程图。图3是本发明步骤S14的流程图。图4是本发明步骤S2的流程图。图5是本发明步骤S3的流程图。图6是本发明步骤S31的流程图。具体实施方式现有的水文模型，包括用于水量水质耦合调度在内的模型，基本采用现有的软件搭建区域网格计算模型，设置各项参数、初始条件和边界条件。然后搭建水质模型、水质水动力模型等，再对模型的参数进行率定，最后采用模型进行调度分析，在模型率定过程，不仅周期长，而且率定参数可能会影响预测的准确度。也有现有技术采用粒子群和神经网络耦合模型对模型进行耦合修正，但是仍然存在一些诸如泛化能力差的问题。为此，提供了如下的技术方案。如图1所示，基于量质耦合预报的水资源水环境调控方法，包括如下步骤：步骤S1、获取研究区域的基础数据，所述基础数据包括数字高程数据、径流量数据、水质数据和用水量数据；读取数字高程数据，提取河网和集水区信息，将研究区域划分为若干个子区域，步骤S2、针对各个子区域分别构建河网拓扑单元，并形成研究区域的整体河网拓扑；按照时间顺序，读取每个河网拓扑单元各个时期的径流量、水质数据和用水量数据，形成若干个水文数据空间；步骤S3、构建SWAT-GNN模型，并以各个河网拓扑单元的水文数据空间为输入数据，对SWAT-GNN模型进行训练，并通过验证数据进行验证，直至符合预期要求；步骤S4、将训练好的SWAT-GNN模型部署至调控平台，对研究区域的水资源进行调控。在本申请中，首先通过基础数据将研究区域进行分区，然后分别建立河网拓扑单元，即对研究区域的物理机制进行建模，在通过将研究区域的数据分成若干个时间段，形成不同时间段的时间数据，用于后续的模型训练。通过上述基础准备工作后，通过构建的SWAT-GNN模型进行训练，并通过测试集进行测试，直至模型精度符合要求。经过训练后的模型，即可用于水资源水环境的模拟仿真，获得水量和水质耦合的仿真参数，为决策提供指导。在本实施例中，通过对研究区域的物理过程进行抽取、建模，然后在这个物理模型的基础上进行构建SWAT和GNN耦合的模型，实际上是对现有研究流域的概化，能够从中抽出核心的特征，从而有利于耦合模型在其他场景的使用，提高泛化能力。如图2所示，根据本申请的一个方面，所述步骤S1进一步为：步骤S11、读取至少两个数据源的基础数据，获取研究区域的栅格化的晕渲图；步骤S12、采用ArcGIS分析工具进行流向分析和流量统计，并基于预存储的最小径流量数值提取河段并链接成河流，形成矢量河网，保存在数字高程数据中；步骤S13、采用ArcGIS分析工具提取集水区，建立河段与集水区的关联关系，并基于集水区将研究区域划分为若干个子区域；步骤S14、采用图卷积神经网络对晕渲图中各个集水区进行识别，将基于识别结果将相似度大于阈值的集水区标记为一类，形成若干类集水区组成的集水区集合。在本实施例中，与现有技术不同之处至少包括：从数字高程数据中提取矢量河网信息，并作为一个独立的部分进行保存，在后续模型使用河网及河网中各个节点或检测点的时候，可以直接从保存的信息中进行调用，大大提高模型的计算速度，同时无需多次提取河网及节点信息，保证了节点或检测点数据的准确度。再者，通过将集水区与河段建立关联关系，把集水区概化成与河段具有物理关联的模块，能够大大增加汇流过程的计算速度和准确度，具有更加清晰的物理过程，有利于在检查预测精度时，对部分节点或河段进行反查，从而提高模型整体的预测精度，另外有利于抽象出该研究区域的核心特征，从而有利于对模型进行特征化，有利于对其他研究区域的仿真，便于模型的推广应用。最后，通过图像识别的方式对集水区域进行相似度识别，将多个集水区域分成少量的几个类型，针对不同的类型，给出仿真参数，从而降低参数量，降低模型计算的维度，也有利于提高对集水区的概化程度，抽取集水区的主要参数特征，在后续其他研究区域的集水区的仿真预测过程中，可以采用将集水区分类概化的方式，建立新研究区域与旧研究区域之间集水区的相似程度，然后通过模型进行调整与仿真，从而对新研究区域的仿真程度和准确度也会提高。具体而言，对于集水区的分类概化，主要过程如下，需要说明的是，本实施例给出的仅为最优方案，本领域的技术人员可以采用其他图像相似度计算方法，获得等同的技术效果。如图3所示，根据本申请的一个方面，所述步骤S14进一步为：步骤S14a、构建集水区数据集，并分为训练集和验证集；步骤S14b、构建图卷积神经网络和损失函数，所述损失函数为交叉熵损失函数；采用训练集对图卷积神经网络进行训练；步骤S14c、依序选择集水区，通过图卷积神经网络计算其他各个集水区的相似度，获得交叉熵集合，并升序排列；步骤S14d、依序选择各个集水区对应的前N项交叉熵对应的集水区，作为相似集水区，作为该集水区的相似区域集合，为该集合分配标签，N为正整数。在本实施例中，首先对晕渲图进行图像切割和识别，获取集水区数据集，比如将一个研究区域的晕渲图切割成80个集水区，分别保存成集水区的图像。然后，选择一部分集水区，即人工可以识别较为相似的集水区作为验证集。可以将全部的集水区图像作为训练集或测试集，在训练完成后，采用人工选择的验证集或测试集进行验证。需要说明的是，在其他实施例中，可以采用其他损失函数，例如均方误差作为损失函数。在本实施例中，与其他损失函数相比，采用交叉熵损失函数能够有效避免过拟合等现象，从而提高集水区域相似度识别的准确度。如图4所示，根据本申请的一个方面，所述步骤S2进一步为：步骤S21、顺次读取研究区域的各个子区域并构建该子区域的河网拓扑单元，获取该子区域对应的河段与集水区数据，形成该子区域对应的局部数据集；步骤S22、基于不同子区域之间拓扑关系，构建研究区域的整体河网拓扑；并基于整体河网拓扑构建各个子区域之间的局部数据集的映射关系；步骤S23、将研究区域的基础数据分为若干个时间段，读取每个时间段的基础数据，并对应至该研究区域的各个子区域，形成针对每个时间段的水文数据集；步骤S24、基于各个时间段的水文数据集构建水文数据空间。在本实施例中，通过对时间和空间的分类，分别从空间的角度构建物理层拓扑关系，从时间的角度划分数据的时序进行划分，避免某一时间段内，气候异常或人类社会活动导致水文水质等数据发生变化，对整体的准确度造成影响，避免物理拓扑中的参数受到某一时间段内参数的影响，从而导致参数失真。通过对不同时间段的水文数据集进行仿真和训练，能够查找出是否某一时间段内的水文参数是否存在异常，从而将其剔除，避免该段时间的异常数据对模型参数造成影响。换句话说，在本实施例中，首先通过子区域的河网拓扑单元，建立河段与集水区的映射关系，然后形成该子区域对应的局部数据集。然后基于子区域之间的拓扑关系，形成研究区域的整体河网拓扑关系，并建立各个子区域之间的局部数据集的关系。即，在物理拓扑的基础上，建立数据层面的关系，然后针对数据层的关系，划分为若干个时间段的数据，形成物理-数据-时间三层关系组成的水文数据空间。为后续的仿真训练提供更加精准的数据集。上述三个层面的数据关系，实际上形成了水文数据有向图，因此在后续的图神经网络中，可以采用图神经网络进行计算模拟。如图5所示，根据本申请的一个方面，所述步骤S3进一步为：步骤S31、针对研究区域，构建SWAT模型，并以各个子区域的基础数据作为输入数据，通过SWAT模型对研究区域进行模拟，输出每一子区域的M组水质水量计算值，M为大于等于3的正整数；所述水质水量计算值至少包括氮含量值、磷含量值和耗氧量值；步骤S32、针对每组水质水量计算值，从基础数据中查找对应的观测值，形成M组神经网络输入数组；步骤S33、构建GNN模型，并以每个子区域的M组神经网络输入数组作为输入，对GNN模型进行训练，直至损失函数值达到预期值。在该实施例中，首先通过构建区域的SWAT模型，将诸如水位、径流量、水量等水量参数，以及氮含量、磷含量和耗氧量，以及排污系数等水质参数作为输入，还可以加入生态参数、经济参数和技术参数等相关参数作为输入，例如SWAT模型计算出模拟数值，然后从基础数据中调取对应的观测值，比如针对氮含量，SWAT模型会给出模拟数值，然后基础参数中会有实际的观测值，诸如此类，其他参数也类似。不同时间段和不同场景下，具有不同的模拟数值，因此会形成一个数组，通过建立模拟数值和观测值之间的数据对，可以构建GNN模型的输入参数，即神经网络每个节点的参数值，通过图神经网络对各个数值进行模拟计算，然后给出最终预测值。在本实施中，图神经网络通过对节点和监测点，以及河段组成的结构化的数据进行计算，寻找系统之间各节点之间的关系，对系统新的状态进行计算，从而该处新的预测结果。在本实施例中，可以采用全连接层、卷积层和池化层的架构，也可以采用其他架构，在使用时，本领域的技术人员可以根据需要选择适合该研究区域结构化数据的网络架构。在进一步的实施例中，为了提高不同时间段内数据的训练模拟仿真结果，给出如下实施例。如图6所示，根据本申请的一个方面，所述步骤S31还包括：步骤S311、在研究区域的整体河网拓扑中设置预定数量个区域水质水量数据点，形成水质水量数据点矩阵，初始化水质水量数据点矩阵中的参数值；步骤S312、按照预定顺序针对每一子区域，选择至少K个时间段的基础数据，逐一构建该时间段内的基础数据与水质水量数据点矩阵的映射关系；K为大于等于2的正整数；步骤S313、逐一计算水质水量数据点矩阵中各个参数值与不同时间段内基础数据的均方误差，求取整体均方误差最小的H个时间段，将各个时间段中的基础数据作为神经网络输入参数集合储备数据。在该实施例中，通过建立河段节点或检测点的数据拓扑层关系，给出了一种新的解决方案，即通过建立水质水量数据点矩阵的方式，形成一个理想化模型，然后计算各个时间段内的数据与该理想化模型上各点之间的欧式距离，从而选择出相对最优的水文参数作为训练参数，提高模型训练的准确率和泛化能力。换句话说，如果是二维数据，可以采用类似于最小二乘法的方式计算各个时间段内的数据相似关系，如果是高维数据，可以采用聚类的方式计算各个时间段内的数据相似关系，从而优选出最佳的输入数据，避免气候异常或人类活动等情况对数据造成的不利影响，进而影响了物理层面和模型层面的参数拟合精度。通过这一方法，在模型训练好后，也可以通这一模块对数据进行预处理，从而剔除异常数据，获得更合适的输入数据，对于不同场景，不同区域，不同时间段内的数据，均可以采用这一方案进行数据预处理，减少异常数据对于模型仿真和计算的影响，抓住主要因素，去除异常因素，从而提高模型在不同场景下的预测精度。根据本申请的一个方面，还包括：步骤S314、采用主成分分析法计算H个时间段内基础数据的占比，并降序排列，将前A个时间段内的数据作为关键时间段数据；H、A为正整数；步骤S315、针对水质水量数据点矩阵的任一数据点参数，基于整体河网拓扑，查找每一数据点与相邻数据点之间的关联关系，形成从集水区至最终汇水区的关联关系有向图；步骤S316、逐一计算关联关系有向图中各个有向线段的综合关联关系系数，并降序排列。在上述实施例的基础上，还给出了新的实施例，即除了对于数据点的综合相似程度进行相似度计算，还应该考虑数据点之间的关联，例如一个河流有三条支流，那么位于支流上的节点或检测点的水文数据，与该河流上的节点或检测点的水文数据是存在关联的。如果从集水区到最终的汇流区，构建若干个水流的汇流有向图，则可以对节点之间的关系进行计算，从而对于数据的相似性的计算更加准确。因此，在准确度要求比较高的情况下，可以采用本实施例的方式，通过构建关联关系有向图的方式，提取出各个节点之间的数据关系，计算出综合关联系数，然后采用这些关联系数对不同时间段内的水文数据相似度进行计算。可以采用欧式距离法或其他方法计算相似度，也可以采用图神经网络给出相似度。在这种情况下，可以获得不同时间段内数据之间的关系，通过这种关系判断该时间段的监测点的数据是否存在异常，并给出修正参数。因此，通过本实施例的方案，能够对物理-数据-时间层的逻辑关系进一步梳理和概化，将不同节点在不同时间段内的关联关系进行抽取，对数据关系的提取更加准确。通过这种方式，还可以对节点或检测点的布设进行优化，去除不必要的重复的节点，因此可以降低数据采集工作量和计算数据量，降低输入数据维度。根据本申请的一个方面，还包括：步骤S34、顺次读取GNN模型输出的每一子区域各个时间段的预测数值，计算该子区域对应的水质水量数据点矩阵中每一数据点的实测值与预测数值的方差之和；步骤S35、按照方差之和升序排列的方式，选取前若干个时间段的数据，作为所述GNN模型的参考训练集。在进一步的实施例中，给出了另外一种方式，及通过计算投影距离的方式，计算预测值与实测值之间的距离，并将各个节点之间的距离进行累加，获得整体的距离，根据这个整体的距离，判断数据的偏差。换句话说，不同节点之间的差别是不同的，通过整体节点的总差距，可以判断数据之间的整体差距，即通过整体方差矩阵来判断相似度，从而对模型的准确程度做一个大致的判断。在进一步的实施例中，还可以给出每一数据点的权重，形成权重矩阵，权重矩阵与方差矩阵相乘，获得综合方差数值，从而能够区分出不同的节点的重要性的差异。根据本申请的一个方面，所述步骤S315还包括：基于所述整体河网拓扑，提取相邻数据点之间的局部交互特征，构建局部特征交互单元。在实际物理场景中，还存在河流、水流交汇的情况，因此在河网拓扑中，几个节点之间的方向有可能是可逆的，比如某个河流与湖泊之间的流向在不同的时间段是可逆的，两个河段之间在不同的时间段内也是可逆的，因此，通过提取相邻数据点之间的局部交互特征，构建局部特征交互单元，对这些可逆的局部进行重点布设检测点，对水质数量等参数进行模拟仿真，不仅可以提高局部的预测精度，还可以提高整体的预测精度。根据本申请的另一个方面，还提供一种基于量质耦合预报的水资源水环境调控系统，包括：至少一个处理器；以及与至少一个所述处理器通信连接的存储器；其中，所述存储器存储有可被所述处理器执行的指令，所述指令用于被所述处理器执行以实现上述任一项技术方案所述的基于量质耦合预报的水资源水环境调控方法。将上述方法配置成软件模块，将其安装或嵌入在现有的计算机模块中，即可实现上述过程，这一过程可以采用现有技术实现，在此不再详述。需要说明的是，本文出现的H、A、K等均为预定的常数。以上详细描述了本发明的优选实施方式，但是，本发明并不限于上述实施方式中的具体细节，在本发明的技术构思范围内，可以对本发明的技术方案进行多种等同变换，这些等同变换均属于本发明的保护范围。
