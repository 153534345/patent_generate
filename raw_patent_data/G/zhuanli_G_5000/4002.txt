标题title
调整三自由度外骨骼运动状态的多模态控制方法及外骨骼
摘要abst
本发明公开了调整三自由度外骨骼运动状态的多模态控制方法及外骨骼，包括：构建三自由度外骨骼多模态动力学模型，得到各自由度的质量、重力、离心力和哥氏力矢量；将角度差与比例系数相乘，速度差与微分系数相乘，结合外骨骼多模态动力学模型，得到外骨骼控制律，构建PD控制器；通过RBF神经网络构建自适应控制器，对PD控制器进行扭矩补偿输出，控制外骨骼运动。使用自适应径向基神经网络结合多模态动力学状态方程，可以快速调整动力学模型，达到精确控制，快速收敛的目的。
权利要求书clms
1.一种调整三自由度外骨骼运动状态的多模态控制方法，其特征在于，包括以下步骤：S01：构建三自由度外骨骼多模态动力学模型，得到各自由度的质量、重力、离心力和哥氏力矢量；S02：将角度差与比例系数相乘，速度差与微分系数相乘，结合外骨骼多模态动力学模型，得到外骨骼控制律，构建PD控制器；S03：通过RBF神经网络构建自适应控制器，对PD控制器进行扭矩补偿输出，控制外骨骼运动。2.根据权利要求1所述的调整三自由度外骨骼运动状态的多模态控制方法，其特征在于，所述步骤S01之前还包括：S11：使用改进的DH模型构建外骨骼运动学模型；S12：在笛卡尔空间中确定出发点和截止点坐标，然后采用三次多项式的形式对轨迹进行平滑处理，并将规划路径分割成多个离散点，出发点选择为外骨骼的初始位置，也就是让骨架处于悬垂状态，截至点为外骨骼各关节屈曲或内旋到极限位置；S13：使用机器人逆运动学解算出各离散点对应的关节角后对其进行微分运算，得到角速度和角加速度。3.根据权利要求1所述的调整三自由度外骨骼运动状态的多模态控制方法，其特征在于，所述步骤S01中使用牛顿-欧拉迭代法对外骨骼进行建模，多模态动力学模型为：其中，为关节力矩，为质量矩阵，为哥氏力矩阵，为离心力矩阵，为重力矢量，速度积矢量，，位置矢量，关节角速度，关节角加速度。4.根据权利要求2所述的调整三自由度外骨骼运动状态的多模态控制方法，其特征在于，考虑系统扰动，多模态动力学模型为：其中，为质心向量，为转动惯量；将式用名义模型表达：其中，为已知模型，；左右移项整理得：。5.根据权利要求1所述的调整三自由度外骨骼运动状态的多模态控制方法，其特征在于，所述步骤S02中外骨骼控制律为：其中，为干扰项；得误差方程：其中，为实际角加速度与期望角加速度的误差，即，其中为期望角加速度，下标表示期望，为实际角速度与期望角速度的误差，即，其中为期望角速度，下标表示期望，为实际角度与期望角度的误差，即，其中为期望角度，下标表示期望，分别为比例和微分系数。6.根据权利要求1所述的调整三自由度外骨骼运动状态的多模态控制方法，其特征在于，所述步骤S03中通过RBF神经网络构建自适应控制器的方法包括：S31：RBF神经网络包括输入层、隐含层和输出层，在输入层读取各关节角度误差及速度误差后，分成三个子神经网络分别对应肩关节两个自由度和肘关节一个自由度；高斯基函数作为隐含层神经元，接收输入层信息后输出权重：其中，表示第个高斯基函数的第个径向基神经元的权重，表示第个高斯基函数的第个元素，表示隐含层中第层第个径向基神经元的中心坐标向量，表示第个径向基神经元的宽度；S32：神经网络的补偿输出为：S33：当给定一个极小正值作为逼近误差时，存在一个理想权重，使得系统输出逼近，其满足以下不等式：式中，为理想估计干扰，系统逼近补偿误差，假设收敛，则存在：S34：当补偿项等于干扰项时，跟踪误差为0，此时系统工作在最佳状态，神经网络理想补偿等于理想估计干扰，此时权重为理想权重：S35：多模态动力学模型表达式第行公因式与第关节有关，且RBF神经网络对外骨骼三关节单独控制，控制律式中质量项为：其中，指关节的新型控制律的质量项，为除第关节以外的名义质量模型，指第关节的期望角加速度，则基于多模态动力学模型的新型控制律：S36：将各关节控制律的力矩输出分成两个部分，表示为，其中为比例微分控制项，为基于RBF的自适应补偿项；针对逼近过程中的未知干扰，需要对其进行自适应补偿控制，即；S37：将式带入式整理得系统补偿误差方程：对求导得，则上式写成以下形式：S38：PD控制矩阵，各关节误差系数矩阵，根据式，由于，为系统逼近补偿误差，是估计权重和理想权重之间的误差，则上式写成以下形式：。7.根据权利要求1-6任一项所述的调整三自由度外骨骼运动状态的多模态控制方法，其特征在于，所述步骤S03之后还包括使用李雅普诺夫稳定性判据判断系统稳定性，包括以下步骤：S41：建立李雅普诺夫方程：其中，自适应学习速度，为矩阵的迹，是对称正定矩阵且满足李雅普诺夫方程：，为正定实对称矩阵，且；S42：沿着方程轨迹对式等式两边进行求导得：由于，则式整理成：S43：将上式中的迹置0，即自适应律为：由于权重误差的导数的权重估计值的导数相等，则将式代入式得：S44：根据式已知是的上确界，则，根据式可知，为矩阵的最小特征值，为矩阵的最大特征值，则：S45：使，即：通过减小、增大的最大特征值或减小的最小特征值提高系统的自适应收敛效果。8.一种计算机存储介质，其上存储有计算机程序，其特征在于，所述计算机程序被执行时实现权利要求7所述的调整三自由度外骨骼运动状态的多模态控制方法。9.一种调整三自由度外骨骼运动状态的多模态控制系统，其特征在于，包括：多模态动力学模型构建模块，构建三自由度外骨骼多模态动力学模型，得到各自由度的质量、重力、离心力和哥氏力矢量；PD控制器构建模块，将角度差与比例系数相乘，速度差与微分系数相乘，结合外骨骼多模态动力学模型，得到外骨骼控制律，构建PD控制器；自适应控制模块，通过RBF神经网络构建自适应控制器，对PD控制器进行扭矩补偿输出，控制外骨骼运动。10.一种三自由度外骨骼，其特征在于，包括外骨骼结构，所述外骨骼结构上挂载有至少一种功能性模块，采用权利要求7所述的调整三自由度外骨骼运动状态的多模态控制方法对外骨骼的运动状态进行调整，控制外骨骼运动。
说明书desc
技术领域本发明属于三自由度轻量化外骨骼控制技术领域，本发明涉及一种调整三自由度外骨骼运动状态的多模态控制方法及外骨骼。背景技术现在机器人技术开始广泛应用于医疗领域，在上肢康复方面主要分为末端牵引式和外骨骼式，末端牵引式由于其无法对人体关节进行精确控制而慢慢被外骨骼所取代。外骨骼可以对中风患者偏瘫的肢体进行准确、重复、平滑的康复治疗活动。外骨骼作为一种与人体直接接触的康复器械，必须具备良好的轨迹跟踪性能来保障使用者的安全性，良好的轨迹跟踪也能带来比较好的康复效果。PD算法因有无需构建动力学模型，简单易于实现的特点广泛应用于各型外骨骼控制上。但是PD控制器无法根据实际情况调节增益以及对误差进行补偿，对非线性系统的适应性较弱，现有的代替PD控制器的控制策略有自适应控制、预测控制以及模糊控制。由于外骨骼机器人外部使用环境干扰强，关节摩擦阻力大，难以进行精确的轨迹跟踪控制。居家型外骨骼作为一种辅助康复装置，在实现康复这一基础能力的同时还具备一定的负载能力，可以在结构外侧挂载一些功能模块，例如音箱、血压测量仪、血氧心率检测仪甚至机械手，这样可以实时监测使用者的健康状态，提高使用者的参与度及心情愉悦度，刺激恢复，提高生活质量。这样可以脱离传统固定式的康复方式，给予使用者更大的自由空间，但这会改变外骨骼本体的状态，因此有必要设计一种在控制之初能够快速修正状态的控制器。申请号2021110805505公开了一种上肢外骨骼康复机器人控制系统及控制方法，根据运动意图进行运动规划，驱动上肢外骨骼康复机器人机械臂本体进行相应动作，并通过机械臂本体各关节的位移实时修正控制力矩，以闭环控制；进行以上过程设定时间后，建立阻抗控制模型，将模型中阻尼系数和刚度系数作为新的运动意图，并设置目标阻抗；底层控制器对目标阻抗进行实时调整，获得目标阻抗力，然后消除力误差，从而获得最终控制力矩，驱动上肢外骨骼康复机器人机械臂本体进行相应动作。该方法没有考虑结构质心、转动惯量的偏移，由于外骨骼机器人外部使用环境干扰强，关节摩擦阻力大，难以进行精确的轨迹跟踪控制。发明内容本发明的目的在于提供一种调整三自由度外骨骼运动状态的多模态控制方法及外骨骼，使用自适应径向基神经网络结合多模态动力学状态方程，可以快速调整动力学模型，达到精确控制，快速收敛的目的。实现本发明目的的技术解决方案为：一种调整三自由度外骨骼运动状态的多模态控制方法，包括以下步骤：S01：构建三自由度外骨骼多模态动力学模型，得到各自由度的质量、重力、离心力和哥氏力矢量；S02：将角度差与比例系数相乘，速度差与微分系数相乘，结合外骨骼多模态动力学模型，得到外骨骼控制律，构建PD控制器；S03：通过RBF神经网络构建自适应控制器，对PD控制器进行扭矩补偿输出，控制外骨骼运动。优选的技术方案中，所述步骤S01之前还包括：S11：使用改进的DH模型构建外骨骼运动学模型；S12：在笛卡尔空间中确定出发点和截止点坐标，然后采用三次多项式的形式对轨迹进行平滑处理，并将规划路径分割成多个离散点，出发点选择为外骨骼的初始位置，也就是让骨架处于悬垂状态，截至点为外骨骼各关节屈曲或内旋到极限位置；S13：使用机器人逆运动学解算出各离散点对应的关节角后对其进行微分运算，得到角速度和角加速度。优选的技术方案中，所述步骤S01中使用牛顿-欧拉迭代法对外骨骼进行建模，多模态动力学模型为：其中，为关节力矩，为质量矩阵，为哥氏力矩阵，为离心力矩阵，为重力矢量，速度积矢量，，位置矢量，关节角速度，关节角加速度。优选的技术方案中，考虑系统扰动，多模态动力学模型为：其中，为质心向量，为转动惯量；将式用名义模型表达：其中，为已知模型，；左右移项整理得：。优选的技术方案中，所述步骤S02中外骨骼控制律为：其中，为干扰项；得误差方程：其中，为实际角加速度与期望角加速度的误差，即，其中为期望角加速度，下标表示期望，为实际角速度与期望角速度的误差，即，其中为期望角速度，下标表示期望，为实际角度与期望角度的误差，即，其中为期望角度，下标表示期望，分别为比例和微分系数。优选的技术方案中，所述步骤S03中通过RBF神经网络构建自适应控制器的方法包括：S31：RBF神经网络包括输入层、隐含层和输出层，在输入层读取各关节角度误差及速度误差后，分成三个子神经网络分别对应肩关节两个自由度和肘关节一个自由度；高斯基函数作为隐含层神经元，接收输入层信息后输出权重：其中，表示第个高斯基函数的第个径向基神经元的权重，表示第个高斯基函数的第个元素，表示隐含层中第层第个径向基神经元的中心坐标向量，表示第个径向基神经元的宽度；S32：神经网络的补偿输出为：S33：当给定一个极小正值作为逼近误差时，存在一个理想权重，使得系统输出逼近，其满足以下不等式：式中，为理想估计干扰，系统逼近补偿误差，假设收敛，则存在：S34：当补偿项等于干扰项时，跟踪误差为0，此时系统工作在最佳状态，神经网络理想补偿等于理想估计干扰，此时权重为理想权重：S35：多模态动力学模型表达式第行公因式与第关节有关，且RBF神经网络对外骨骼三关节单独控制，控制律式中质量项为：其中，指关节的新型控制律的质量项，为除第关节以外的名义质量模型，指第关节的期望角加速度，则基于多模态动力学模型的新型控制律：S36：将各关节控制律的力矩输出分成两个部分，表示为，其中为比例微分控制项，为基于RBF的自适应补偿项；针对逼近过程中的未知干扰，需要对其进行自适应补偿控制，即；S37：将式带入式整理得系统补偿误差方程：对求导得，则上式写成以下形式：S38：PD控制矩阵，各关节误差系数矩阵，根据式，由于，为系统逼近补偿误差，是估计权重和理想权重之间的误差，则上式写成以下形式：优选的技术方案中，所述步骤S03之后还包括使用李雅普诺夫稳定性判据判断系统稳定性，包括以下步骤：S41：建立李雅普诺夫方程：其中，自适应学习速度，为矩阵的迹，是对称正定矩阵且满足李雅普诺夫方程：，为正定实对称矩阵，且；S42：沿着方程轨迹对式等式两边进行求导得：由于，则式整理成：S43：将上式中的迹置0，即自适应律为：由于权重误差的导数的权重估计值的导数相等，则将式代入式得：S44：根据式已知是的上确界，则，根据式可知，为矩阵的最小特征值，为矩阵的最大特征值，则：S45：使，即：通过减小、增大的最大特征值或减小的最小特征值提高系统的自适应收敛效果。本发明还公开了一种计算机存储介质，其上存储有计算机程序，所述计算机程序被执行时实现上述的调整三自由度外骨骼运动状态的多模态控制方法。本发明又公开了一种调整三自由度外骨骼运动状态的多模态控制系统，包括：多模态动力学模型构建模块，构建三自由度外骨骼多模态动力学模型，得到各自由度的质量、重力、离心力和哥氏力矢量；PD控制器构建模块，将角度差与比例系数相乘，速度差与微分系数相乘，结合外骨骼多模态动力学模型，得到外骨骼控制律，构建PD控制器；自适应控制模块，通过RBF神经网络构建自适应控制器，对PD控制器进行扭矩补偿输出，控制外骨骼运动。本发明又公开了一种三自由度外骨骼，包括外骨骼结构，所述外骨骼结构上挂载有至少一种功能性模块，采用上述的调整三自由度外骨骼运动状态的多模态控制方法对外骨骼的运动状态进行调整，控制外骨骼运动。本发明与现有技术相比，其显著优点为：1、该方法使用自适应径向基神经网络结合多模态动力学状态方程，利用MDEOS计算关节力矩，并用RBF神经网络对误差进行补偿。将神经网络作为补偿量与PD控制结合能够很好的对轨迹进行跟踪，可以快速调整动力学模型，达到精确控制，快速收敛的目的。使用李雅普诺夫稳定性判据判断系统稳定性，提高系统鲁棒性和适应性。2、本发明提出的多模态动力学状态方程的自适应控制器设计，用于解决外骨骼挂载功能模块后的状态变化问题，提高重新精确建模的效率对使用者和研发人员均有很大的帮助。经过仿真实验证明，本文提出的模型能够更好的跟踪预设轨迹，相较于传统控制器，控制精度最高提升了，能耗最高降低了。附图说明图1为实施例的调整三自由度外骨骼运动状态的多模态控制方法的流程图；图2为实施例的调整三自由度外骨骼运动状态的多模态控制系统的原理框图；图3为实施例的外骨骼挂载功能性模块的结构示意图；图4为实施例构建的MDEOS的ARBFNN算法流程图；图5为外骨骼左臂的运动学结构，外骨骼的连杆尺寸做了标记；图6为使用MDEOS的RBF神经网络结构；图7为PD控制外骨骼在空载状态下各关节的规划轨迹和跟踪轨迹示意图；图8为PD控制外骨骼在空载状态下显示了各关节的跟踪误差示意图；图9为人体穿戴外骨骼在无干扰的情况下使用MDEOS+ARBFNN控制下各关节的规划轨迹与跟踪轨迹示意图；图10为人体穿戴外骨骼在无干扰的情况下使用MDEOS+ARBFNN控制下各关节的跟踪误差示意图；图11为使用MDEOS与EOS两种方法后各关节速度与扭矩的稀疏性；图12为使用MDEOS与EOS两种方法后各关节的误差对比；图13为使用MDEOS与EOS两种方法后各关节的误差分布直方图。具体实施方式本发明的原理是：作为一种轻量化可居家长时间使用的康复器具，在执行康复训练的过程中可以挂载一些功能性模块比如机械手，使用者通过控制外骨骼实现一些抓取物体之类的简单动作，这样可以使患者在康复中逐渐具备一定的生活能力，加快康复速度，或者加装一些健康监测设备例如血氧心率监测仪，血压测量仪等，这样可以实时监测使用者的健康状态。但是这样会导致外骨骼本体质心位置、转动惯量等参数的偏移，对需要精确动力学模型的控制算法来说是较为不利的，由于重新推导状态方程会消耗大量时间，因此我们构建了一种使用MDEOS的ARBFNN算法控制。实施例1：如图1所示，一种调整三自由度外骨骼运动状态的多模态控制方法，包括以下步骤：S01：构建三自由度外骨骼多模态动力学模型，得到各自由度的质量、重力、离心力和哥氏力矢量；S02：将角度差与比例系数相乘，速度差与微分系数相乘，结合外骨骼多模态动力学模型，得到外骨骼控制律，构建PD控制器；S03：通过RBF神经网络构建自适应控制器，对PD控制器进行扭矩补偿输出，控制外骨骼运动。较佳的实现中，步骤S01之前还包括：S11：使用改进的DH模型构建外骨骼运动学模型；S12：在笛卡尔空间中确定出发点和截止点坐标，然后采用三次多项式的形式对轨迹进行平滑处理，并将规划路径分割成多个离散点，出发点选择为外骨骼的初始位置，也就是让骨架处于悬垂状态，截至点为外骨骼各关节屈曲或内旋到极限位置；S13：使用机器人逆运动学解算出各离散点对应的关节角后对其进行微分运算，得到角速度和角加速度。较佳的实现中，步骤S01中使用牛顿-欧拉迭代法对外骨骼进行建模，多模态动力学模型为：其中，为关节力矩，为质量矩阵，为哥氏力矩阵，为离心力矩阵，为重力矢量，速度积矢量，，位置矢量，关节角速度，关节角加速度。较佳的实现中，考虑系统扰动，多模态动力学模型为：其中，为质心向量，为转动惯量；将式用名义模型表达：其中，为已知模型，；左右移项整理得：。较佳的实现中，步骤S02中外骨骼控制律为：其中，为干扰项；得误差方程：其中，为实际角加速度与期望角加速度的误差，即，其中为期望角加速度，下标表示期望，为实际角速度与期望角速度的误差，即，其中为期望角速度，下标表示期望，为实际角度与期望角度的误差，即，其中为期望角度，下标表示期望，分别为比例和微分系数。较佳的实现中，步骤S03中通过RBF神经网络构建自适应控制器的方法包括：S31：RBF神经网络包括输入层、隐含层和输出层，在输入层读取各关节角度误差及速度误差后，分成三个子神经网络分别对应肩关节两个自由度和肘关节一个自由度；高斯基函数作为隐含层神经元，接收输入层信息后输出权重：其中，表示第个高斯基函数的第个径向基神经元的权重，表示第个高斯基函数的第个元素，表示隐含层中第层第个径向基神经元的中心坐标向量，表示第个径向基神经元的宽度；S32：神经网络的补偿输出为：S33：当给定一个极小正值作为逼近误差时，存在一个理想权重，使得系统输出逼近，其满足以下不等式：式中，为理想估计干扰，系统逼近补偿误差，假设收敛，则存在：S34：当补偿项等于干扰项时，跟踪误差为0，此时系统工作在最佳状态，神经网络理想补偿等于理想估计干扰，此时权重为理想权重：S35：多模态动力学模型表达式第行公因式与第关节有关，且RBF神经网络对外骨骼三关节单独控制，控制律式中质量项为：其中，指关节的新型控制律的质量项，为除第关节以外的名义质量模型，指第关节的期望角加速度，则基于多模态动力学模型的新型控制律：S36：将各关节控制律的力矩输出分成两个部分，表示为，其中为比例微分控制项，为基于RBF的自适应补偿项；针对逼近过程中的未知干扰，需要对其进行自适应补偿控制，即；S37：将式带入式整理得系统补偿误差方程：对求导得，则上式写成以下形式：S38：PD控制矩阵，各关节误差系数矩阵，根据式，由于，为系统逼近补偿误差是估计权重和理想权重之间的误差，则上式写成以下形式：较佳的实现中，步骤S03之后还包括使用李雅普诺夫稳定性判据判断系统稳定性，包括以下步骤：S41：建立李雅普诺夫方程：其中，自适应学习速度，为矩阵的迹，是对称正定矩阵且满足李雅普诺夫方程：，为正定实对称矩阵，且；S42：沿着方程轨迹对式等式两边进行求导得：由于，则式整理成：S43：将上式中的迹置0，即自适应律为：由于权重误差的导数的权重估计值的导数相等，则将式代入式得：S44：根据式已知是的上确界，则，根据式可知，为矩阵的最小特征值，为矩阵的最大特征值，则：S45：使，即：通过减小、增大的最大特征值或减小的最小特征值提高系统的自适应收敛效果。另一实施例中，一种计算机存储介质，其上存储有计算机程序，所述计算机程序被执行时实现上述的调整三自由度外骨骼运动状态的多模态控制方法。另一实施例中，如图2所示，一种调整三自由度外骨骼运动状态的多模态控制系统，包括：多模态动力学模型构建模块100，构建三自由度外骨骼多模态动力学模型，得到各自由度的质量、重力、离心力和哥氏力矢量；PD控制器构建模块200，将角度差与比例系数相乘，速度差与微分系数相乘，结合外骨骼多模态动力学模型，得到外骨骼控制律，构建PD控制器；自适应控制模块300，通过RBF神经网络构建自适应控制器，对PD控制器进行扭矩补偿输出，控制外骨骼运动。另一实施例中，如图3所示，一种三自由度外骨骼，包括外骨骼结构10，外骨骼结构10上挂载有至少一种功能性模块20，采用上述的调整三自由度外骨骼运动状态的多模态控制方法对外骨骼的运动状态进行调整，控制外骨骼运动。功能性模块比如机械手，使用者通过控制外骨骼实现一些抓取物体之类的简单动作，这样可以使患者在康复中逐渐具备一定的生活能力，加快康复速度，或者加装一些健康监测设备例如血氧心率监测仪，血压测量仪等，这样可以实时监测使用者的健康状态。但是这样会导致外骨骼本体质心位置、转动惯量等参数的偏移，对需要精确动力学模型的控制算法来说是较为不利的，由于重新推导状态方程会消耗大量时间，因此我们构建了一种使用MDEOS的ARBFNN算法控制。下面以一较佳的实施例为例进行说明使用MDEOS的ARBFNN算法控制：如图4所示，具体包括以下步骤：步骤1、设计外骨骼运动学模型；上肢外骨骼的左右肢体呈对称结构，控制算法几乎一致，因此本文以左臂为例着重介绍。由图5可知关于外骨骼的运动学结构，其中显示了各关节旋转轴之间的相对距离和旋转量，图中展示的尺寸数据仅作参考，运行过程中可以根据实际需求进行调整；为了方便完成外骨骼的轨迹规划任务，有必要建立精确的运动学模型，这里使用改进的DH表示法建立模型，其中表示沿着轴从移动到的距离；表示绕着轴从旋转到的角度；表示沿着轴，从移动到的距离；表示绕轴，从旋转到的角度。具体参数如表1所示，结合图5可得，，，，；根据设计的运动学模型，设置起始坐标和终止坐标后，利用多项式插补可得到期望运动轨迹；表1上肢外骨骼D-H参数步骤 2、设计多模态动力学；步骤2.1使用牛顿-欧拉迭代法对外骨骼的左臂进行建模。设外骨骼底座的坐标系原点的初始角速度、初始角加速度、初始线速度均为0，初始线加速度在Z轴方向受重力影响为，Z轴单位向量，表示关节的角位移，表示关节的角速度，表示关节的角加速度，相邻关节的姿态变换矩阵为：步骤2.2为方便后续控制，通过解算，关节力矩表达式可写成以下形式：步骤2.3其中位置矢量，为外骨骼33的质量矩阵，关节角速度，关节角加速度，为31的重力矢量，为31的离心力和哥氏力矢量，离心力与外骨骼关节的速度平方有关，哥氏力与不同关节的速度积有关，因此动力学方程可写成以下形式：其中为33哥氏力矩阵，为33离心力矩阵，速度积矢量，。步骤2.4定义为矩阵第行第列的元素，为向量第行元素。由于状态空间方程解算结果过于复杂，这里以第三关节举例，设为外骨骼小臂连杆3×1质心向量，为外骨骼小臂连杆3×3转动惯量矩阵，则小臂质量元素为：更进一步，外骨骼小臂哥氏力元素为：更进一步，外骨骼小臂离心力元素为：更进一步，式、、中参数含义如下：：外骨骼小臂连杆质量；外骨骼小臂连杆质心向量的第一个元素；外骨骼小臂连杆质心向量的第二个元素；外骨骼小臂连杆质心向量的第三个元素；外骨骼小臂连杆转动惯量矩阵第一行第一列的元素；外骨骼小臂连杆转动惯量矩阵第一行第二列的元素；外骨骼小臂连杆转动惯量矩阵第一行第三列的元素；外骨骼小臂连杆转动惯量矩阵第二行第一列的元素；外骨骼小臂连杆转动惯量矩阵第二行第二列的元素；外骨骼小臂连杆转动惯量矩阵第二行第三列的元素；外骨骼小臂连杆转动惯量矩阵第三行第一列的元素；外骨骼小臂连杆转动惯量矩阵第三行第二列的元素；外骨骼小臂连杆转动惯量矩阵第三行第三列的元素；步骤2.7 外骨骼小臂重力矢量元素为：更进一步，根据式、、，考虑到系统扰动，式可写成以下形式：更进一步，考虑到实际工程，一些电缆线束及外界干扰极难测量，将式用名义模型表达，即设为已知模型，：更进一步，左右移项整理可得：。步骤3、设计外骨骼PD控制器；步骤3.1 假设干扰项已知，借助传统PD控制，将角度差与比例系数相乘，速度差与微分系数相乘，外骨骼控制律可设计成以下形式：步骤3.2 将式带入式，通过左右移项化简可得误差方程：步骤3.3式中，为实际角加速度与期望角加速度的误差，即，其中为期望角加速度，下标表示期望，为实际角速度与期望角速度的误差，即，其中为期望角速度，下标表示期望，为实际角度与期望角度的误差，即，其中为期望角度，下标表示期望，为比例和微分系数，取一半的平方，即。然而在实际工程应用中，极难测量且未知，需要对其进行估计及补偿；步骤4、设计使用MDEOS的ARBFNN控制器；运动过程中的扰动和建模时的误差会降低外骨骼的跟踪性能，神经网络因其具备弹性拓扑，高度冗余和非线性运算且学习线性广泛应用于机器人控制领域；利用MDEOS计算关节力矩，并用RBF神经网络对误差进行补偿。RBF神经网络可以在线实时学习并辨识模型误差，以此保证闭环系统的稳定性。如图6所示，RBF神经网络作为外置的补偿控制器仅拥有三层结构，分别为输入层，隐含层和输出层，因结构简单，RBF较其他神经网络实时性更好，运算速度更快。步骤4.1每个关节连杆由于状态方程不同，运动性质也有所不同，为提高控制精度，在输入层是一个6×1的列向量，在读取各关节角度误差及速度误差后，分成三个子神经网络分别对应肩关节两个自由度和肘关节一个自由度；高斯基函数作为隐含层神经元，在子RBF网络中是一个5×1的列向量，接收输入层信息后输出5×1的权重；上式表示第个高斯基函数的第个径向基神经元的权重，表示第个高斯基函数的第个元素，表示的是隐含层中第层第个径向基神经元的中心坐标向量，表示的是第个径向基神经元的宽度。由于在统一读取外骨骼运动信息后将各关节单独控制，因此输入层细化为三个独立结构，元素为第个关节的角位移误差和角速度误差；步骤4.2根据式我们可知神经网络的补偿输出为：步骤4.3当给定一个极小正值作为逼近误差时，存在一个理想权重，使得系统输出可以逼近，其满足以下不等式：步骤4.4式中为理想估计干扰，设系统逼近补偿误差，假设收敛，则干扰项与干扰项估计值趋近一致，即存在：步骤4.5当补偿项等于干扰项时，跟踪误差为0，此时系统工作在最佳状态，神经网络理想补偿等于理想估计干扰，此时权重为理想权重：步骤4.6考虑到MDEOS表达式第行公因式与第关节有关，且RBF神经网络对外骨骼三关节单独控制，控制律式中质量项可写成以下形式：步骤4.7其中，指关节的新型控制律的质量项，为除第关节以外的名义质量模型，指第关节的期望角加速度。则可设计基于MDEOS的新型控制律：步骤4.8为提高系统的稳定性和鲁棒性，各关节控制律的力矩输出需要分成两个部分，表示为，其中为比例微分控制项，为基于RBF的自适应补偿项；由式可知，系统逼近值用于补偿理想估计干扰，当补偿项等于干扰项时，系统状态最稳定；针对逼近过程中的未知干扰，需要对其进行自适应补偿控制，即。步骤4.9将式带入式整理可得系统补偿误差方程：步骤4.10结合式可知，对其求导可得，则上式可写成以下形式：更进一步，其中PD控制矩阵，各关节误差系数矩阵。根据式，由于，为系统逼近补偿误差，是估计权重和理想权重之间的误差，则上式可写成以下形式：步骤5、使用李雅普诺夫稳定性判据判断系统稳定性，同时设计自适应律。步骤5.1需要针对上述的闭环控制系统做稳定性分析，首先需要建立李雅普诺夫方程，设：步骤5.2其中自适应学习速度，为矩阵的迹，是对称正定矩阵且满足李雅普诺夫方程：，为正定实对称矩阵，且。沿着方程轨迹对式等式两边进行求导可得：步骤5.3由于，则式可整理成：步骤5.4为确保系统能够保持渐近稳定，需要将上式中的迹置0，即可设自适应律为：步骤5.5由于权重误差的导数的权重估计值的导数相等，则将式代入式可得：步骤5.6根据式已知是的上确界，则。根据式可知，设为矩阵的最小特征值，为矩阵的最大特征值，则：步骤5.7为提高系统保持渐近稳定的性能，需使，也可让其等于0，即：步骤5.8结合式可知，可以通过减小、增大的最大特征值或减小的最小特征值提高系统的自适应收敛效果。步骤6、使用PD控制加RBF神经网络补偿后的最终输出扭矩控制外骨骼，同时反馈角位移、角速度、角加速度至步骤3和步骤4；步骤7、若康复外骨骼需要挂载或更换功能性模块，则更改步骤2中的质心向量、转动惯量、连杆质量即可完成状态方程的更新，无需重新推导。具体的，在笛卡尔空间中确定出发点和截止点坐标，然后采用三次多项式的形式对轨迹进行平滑处理，并将规划路径分割成1000个离散点。出发点选择为外骨骼的初始位置，也就是让骨架处于悬垂状态，笛卡尔空间坐标为，截至点为外骨骼各关节屈曲或内旋到极限位置，笛卡尔空间坐标为。使用机器人逆运动学解算出各离散点对应的关节角后对其进行微分运算，得到角速度和角加速度，然后代入MDEOS模型输出控制力矩。使用正动力学模拟机器人本体及外部环境，在得到控制力矩后反馈机器人的实际关节运动信息。由图7-图8可知，在点对点多项式轨迹规划后，将P设置成14000，D设置成74，外骨骼可以有效的对目标轨迹进行跟踪，肩关节内外旋跟踪均方根误差为，稳态误差绝对值为，肩关节屈伸跟踪均方根误差为，稳态误差绝对值为，肘关节屈伸跟踪均方根误差为，稳态误差绝对值为，可以看到随着转动关节距离原点的位置越远，收到的干扰因素就越多，导致误差幅度增大。由于三个关节都收敛于上界和下界，所以系统稳定，验证了MDEOS模型在空载时的正确性。外骨骼作为一种高度依赖人机交互的器具，仿真过程中必须考虑人体这一最大的环境变量。考虑到成年男性平均体重为80公斤，其中大臂重约3.2公斤，小臂重约2.8公斤，这两个质量作为干扰项引入控制系统中，且方向始终指向地面。和上一节采用同样的路径规划方案，在此基础上加入使用了MDEOS的ARBFNN控制算法。经过调试，ARBFNN控制参数选择为：初始权重设为：为测试控制器的逼近性和稳定性，将出发点偏离初始位置，即将出发点设置成，最终外骨骼的实际跟踪轨迹如图9-图10所示，在控制的零时刻外骨骼初始位置与预设轨迹有一定偏差时，控制器能够快速地矫正和弥补误差，直到跟踪路径收敛于规划轨迹附近，过程平滑。根据误差信号波动幅度，可以看出在逼近过程中抖动相对较大，但是逼近后joint1的稳态误差的绝对值，joint2的稳态误差的绝对值，joint3的稳态误差的绝对值，相对于传统PD控制，跟踪的准确性和收敛逼近预设轨迹的能力有一个质的提升。关节电机的输出扭矩和外骨骼本体的重心位置密切相关，由于joint1旋转轴与外骨骼重力均指向地面，外骨骼肢体运动导致的重心偏移对joint1没有影响，所以joint1最终的力矩输出较为稳定。joint2、joint3作为两个屈曲关节，旋转轴和外骨骼重力方向正交，随着外骨骼肩关节与肘关节屈曲角度的增大，重心位置发生偏移，关节会受到一个变化的扭矩。外骨骼作为一种刚性器械，不仅能直接参与使用者的康复治疗活动中，还能在其上挂载功能性模块监测使用者的健康状况，例如血压测量仪、血氧心率检测仪等，甚至可以安装音响，机械手来提高使用者的愉悦度和参与度，在居家康复的过程中让使用者拥有一定的生活能力，加速康复进程。如图3所示，在外骨骼单侧左大臂外侧挂载了连同固定件重960g的血氧/血压测量仪，将其作为实验对象，使用MDEOS的ARBFNN算法对其进行控制，并与传统PID算法以及使用传统EOS的ARBFNN算法进行比较。由于传统PID误差范围过大，下面仅将使用EOS的ARBFNN作为对照组进行实验。如图11中所示使用MDEOS的ARBFNN的速度扭矩分布要比使用EOS的ARBFNN的速度扭矩分布更加集中，表2将两种方法在稳态环境工作时的最大速度与扭矩进行分析，设扭矩为，速度为，功率为，由可知功率和扭矩与速度的乘积成正比关系，Joint1在转动过程中最大扭矩从1.195降至0.8787，最高转速从3.5244降至3.0414，运行过程中的消耗的功率由0.0702降至0.0445，减少了36.6%的能量消耗，此外Joint2，Joint3分别减少了6.4%和10.9%的能量消耗，达到了节能的目的，延长了外骨骼的工作时间。表2稳态最大速度与扭矩对比为进一步观察使用MDEOS的ARBFNN的准确性和稳定性，我们将两种算法的输出误差显示在同一张图表上，如图12所示，可以看到其震荡幅度明显低于使用EOS的ARBFNN震荡幅度，并且更快收敛至稳定状态，通过观察误差分布直方图，如图13所示，可以看到趋于0的频数相较于EOS＋ARBFNN在各关节均有明显增加，结合上述MSE值的对比，可以知道使用MDEOS的ARBFNN的控制跟踪精度、稳定性均优于使用EOS的ARBFNN。上述实施例为本发明优选地实施方式，但本发明的实施方式并不受上述实施例的限制，其他的任何未背离本发明的精神实质与原理下所作的改变、修饰、替代、组合、简化，均应为等效的置换方式，都包含在本发明的保护范围之内。
