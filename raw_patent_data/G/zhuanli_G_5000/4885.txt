标题title
基于Openlayer实现地图背景图的比例和位置切换的方法
摘要abst
本发明公开了一种基于Openlayer实现地图背景图的比例和位置切换的方法，包括如下步骤：S1、创建地图盒子；S2、引入所需的地图组件；S3、设置投影坐标；S4、创建视图；S5、添加控件；S6、创建图层；S7、上传背景图；S8、设置背景图的左下角位置；S9、设置背景图的缩放比例；S10、计算背景图的投影范围；S11、设置背景图的投影坐标；S12、创建背景图的图层并添加到地图上。
权利要求书clms
1.基于Openlayer实现地图背景图的比例和位置切换的方法，其特征在于：S1、创建地图盒子S2、引入所需的地图组件S3、设置投影坐标利用投影坐标系EPSG:3857创建一个投影坐标系，设置属性code为EPSG:3857，同时设置一个投影的范围extent，extent的值是一个数组，数组的参数分别是minx，miny，maxx，maxy，即地图上的最大最小坐标的x、y值的范围；S4、创建视图创建一个全局变量map，创建地图对象，属性target设置为id名称为map的盒子，创建的地图基于地图容器；S5、添加控件在地图上创建一个默认控件，然后在默认控件的基础上继续添加控件，使用默认控件的extend方法继续传入全屏控件；S6、创建图层创建一个图层对象并赋值给全局变量，创建一个数据源对象并赋值给全局变量，将数据源对象设置到图层对象中，然后将此图层添加到map对象中，完整的地图对象创建好；S7、上传背景图在地图容器上添加一个设置背景图的入口，使用原生的input标签来上传以方便获取背景图的原始宽高； S8、设置背景图的左下角位置添加两个input框，用来编辑背景图左下角的x，y坐标，用户在地图上先拾取一个点，通过监听地图的单击点击事件得到这个点的位置，回显到x，y的输入框中或自行编辑输入框的值来调整位置；S9、设置背景图的缩放比例添加一个input输入框，初始值设置为100%，用以用户调整比例的数值；S10、计算背景图的投影范围投影范围extent数组的前两项即是用户初始拾取的x，y值，设为x1，y1，数组后两项是背景图右上角的x，y坐标，设置为x2，y2，上传图片时获取的宽高设置为width，height；结合图片的原始宽高、缩放比例大小scale，以及x1，y1的值计算x2，y2的值，背景图缩放之后的宽高的计算方式分别为：width2=/100，height2=/100，地图是一个向上为正，向右为正，中心点为的坐标系，因此x2，y2的计算方式分别为x2=width2+x1，y2=height2+y1；S11、设置背景图的投影坐标创建一个投影坐标系对象，图片的投影坐标类型必须设置为图片类型，设置投影范围为实时计算出的extent值；S12、创建背景图的图层并添加到地图上创建背景图层对象，设置数据源为静态图片对象，url属性即为上传的图片地址，将所述背景图层添加到地图map对象中，此时背景图即无失真的添加到地图上用户所设置的位置上。2.根据权利要求1所述的基于Openlayer实现地图背景图的比例和位置切换的方法，其特征在于，所述步骤S4还包括：创建view视图，设置坐标系中心点center为，设置地图的初始缩放比例zoom为2，最大和最小缩放比例分别为26和2，将创建的投影坐标赋值给属性projection。3.根据权利要求1所述的基于Openlayer实现地图背景图的比例和位置切换的方法，其特征在于，所述步骤S7还包括：设置input的type属性为file，限制上传图片的格式为jpg，jpeg或png，限制上传文件的大小为5M，调取上传图片接口，成功执行之后在文件的onload事件中获取此图片的原始宽度以及图片的原始高度。
说明书desc
技术领域本发明涉及机器人巡检技术领域，尤其涉及一种基于Openlayer实现地图背景图的比例和位置切换的方法。背景技术机器人在巡检过程中需要实时动态的展示位置信息和巡检背景如设备和厂房、道路等图片，并根据巡检路线动态的展示实景地图的大小。目前通常采用Openlayer添加图片的方式来实现上述功能，主要有两种方法：第一种是在地图上面添加一个图层，首先要构建要素，然后构建数据源，再构建一个图层，最后将图层添加到地图图层上。第二种是创建一个图片图层，引入一张静态图片来当作背景图。但本申请发明人在实现本申请实施例中发明技术方案的过程中，发现上述技术至少存在如下技术问题：第一种方式添加的图片由于添加的是覆盖物，和地图本身不是同一个层级，无法跟随地图放大、缩小、拖拽，只能对图片单独进行操作。第二种方式的缺陷是图片无法单独移动在地图上的位置，也不能设置图片的大小比例。因此，两种常规的方式，都无法实现动态巡检时需要的实景地图和背景图的位置、比例大小的无失真变化。发明内容本申请实施例通过提供一种基于Openlayer实现地图背景图的比例和位置切换的方法，解决了现有技术中实现动态巡检时需要的背景图无法跟随实景地图的位置变化及比例大小失真的技术难题。本申请提供了S1、创建地图盒子S2、引入所需的地图组件S3、设置投影坐标利用投影坐标系EPSG:3857创建一个投影坐标系，设置属性code为EPSG:3857，同时设置一个投影的范围extent，extent的值是一个数组，数组的参数分别是minx，miny，maxx，maxy，即地图上的最大最小坐标的x、y值的范围；S4、创建视图创建一个全局变量map，创建地图对象，属性target设置为id名称为map的盒子，创建的地图基于所述的地图容器；S5、添加控件在地图上创建一个默认控件，然后在默认控件的基础上继续添加控件，使用默认控件的extend方法继续传入全屏控件；S6、创建图层创建一个图层对象并赋值给全局变量，创建一个数据源对象并赋值给全局变量，将数据源对象设置到图层对象中，然后将此图层添加到map对象中，完整的地图对象创建好；S7、上传背景图在地图容器上添加一个设置背景图的入口，使用原生的input标签来上传以方便获取背景图的原始宽高； S8、设置背景图的左下角位置添加两个input框，用来编辑背景图左下角的x，y坐标，用户在地图上先拾取一个点，通过监听地图的单击点击事件得到这个点的位置，回显到x，y的输入框中或自行编辑输入框的值来调整位置；S9、设置背景图的缩放比例添加一个input输入框，初始值设置为100%，用以用户调整比例的数值；S10、计算背景图的投影范围投影范围extent数组的前两项即是用户初始拾取的x，y值，设为x1，y1，数组后两项是背景图右上角的x，y坐标，设置为x2，y2，上传图片时获取的宽高设置为width，height；结合图片的原始宽高、缩放比例大小scale，以及x1，y1的值计算x2，y2的值，背景图缩放之后的宽高的计算方式分别为：width2=/100，height2=/100，地图是一个向上为正，向右为正，中心点为的坐标系，因此x2，y2的计算方式分别为x2=width2+x1，y2=height2+y1；S11、设置背景图的投影坐标创建一个投影坐标系对象，图片的投影坐标类型必须设置为图片类型，设置投影范围为实时计算出的extent值；S12、创建背景图的图层并添加到地图上创建背景图层对象，设置数据源为静态图片对象，url属性即为上传的图片地址，将所述背景图层添加到地图map对象中，此时背景图即无失真的添加到地图上用户所设置的位置上。优选地，所述步骤S4还包括：创建view视图，设置坐标系中心点center为，设置地图的初始缩放比例zoom为2，最大和最小缩放比例分别为26和2，将创建的投影坐标赋值给属性projection。优选地，所述步骤S7还包括：设置input的type属性为file，限制上传图片的格式为jpg，jpeg或png，限制上传文件的大小为5M，调取上传图片接口，成功执行之后在文件的onload事件中获取此图片的原始宽度以及图片的原始高度。本申请提供的技术方案，至少具有如下技术效果或优点：1）本专利基于Openlayer添加图片图层的方法，实现给地图添加背景图。2）本专利通过设置背景图的原点位置，计算出图片在地图上投影的坐标，来实现背景图可以跟随地图一起放大、缩小、拖拽，在地图上进行位置的调整，用户可设置缩小或放大的比例对图片进行等比缩放，设置完成后可导入到地图相对应的位置的功能。在图片不产生变形的情况下可以准确的投影到地图上面。3）本发明通过投影范围来变换背景图位置的方法也通用于其它地图组件，代码量精简，适用范围广泛。附图说明图1为本申请实施例OpenLayer地图组成示意图；图2为本申请实施例页面展示的地图坐标示意图。具体实施方式本申请实施例的技术方案为解决上述背景技术中的问题，总体思路如下：通过创建一个图片图层，通过限制图片的显示范围来达到变化图片位置的效果。整个地图是一个以中心点为原点的二维坐标系，图片的显示范围extent是一个数组，此数组的前两项表示图片的左下角坐标，后两项表示图片的右上角坐标。用户可以设置前两项的x，y值，再设置图片的缩放比例，导入图片时，根据这两个值来计算出extent后面两个值即图片右上角坐标的数据，以此来达到变化图片位置的效果。工作过程和原理：npm安装OpenLayers，引入OpenLayers完整的依赖包；在页面按需引入本项目所需内容，比如地图图层Map，图片图层ImageLayer。初始化地图之后，在地图上添加一个图片图层，设置一个投影坐标数组，图片的左下角经纬度是用户可设置，图片的右上角坐标是通过用户设置的图片比例，和地图的原始宽高来计算得出。为了更好的理解上述技术方案，下面将结合说明书附图以及具体的实施方式对上述技术方案进行详细的说明。实施例一本实施例提供一种基于Openlayer实现地图背景图的比例和位置切换的方法，OpenLayer地图主要由五个部分组成，分别是视图，图层，覆盖物，地图交互，控件。其中：视图主要控制地图显示的中心位置，范围，层级等；地图上可以添加多个图层，相互之间并不干扰，用于图形的显示和管理，可以处理地图数据来源的多样性和复杂性；地图上可以放置一些覆盖物，比如点标记、图片等，通过Overlay属性添加的元素，在平移所当的时候元素也会随着地图的移动而移动；地图交互定义了用户与地图进行交互的基本要素和事件，比如地图双击放大，鼠标滚轮缩放，矢量要素点选，地图上绘制图形等，在地图上直观是看不到的；区别于地图交互，地图控件是地图上可以直观看到的用户操控地图的方式，比如地图上的放大缩小按钮、全屏按钮等。本发明给地图添加背景图的方式是在Map图层上添加ImageLayer图层，引入图片地址完成背景图的渲染。基于上述构架，实现地图背景图的比例和位置切换的具体方法包括：S1、创建地图盒子首先创建一个高度为500px，宽度为100%的地图盒子，设置id为map；S2、引入所需的地图组件按需引入Map、View、Overlay等组件。S3、设置投影坐标Openlayers中常用两种坐标：EPSG:3857和EPSG:4326，使用EPSG:4326加载地图时会导致平面地图发生变形，因此为了保证页面的正常显示，这里使用投影坐标系EPSG:3857。在创建一个投影坐标系时，设置属性code为EPSG:3857，同时设置一个投影的范围extent，extent的值是一个数组，数组的参数分别是minx，miny，maxx，maxy，即地图上的最大最小坐标的x,y值的范围。S4、创建视图创建一个全局变量map，创建地图对象，属性target设置为id名称为map的盒子，这样创建的地图就会基于这个地图容器。创建view视图，设置坐标系中心点center为，此时页面展示的地图类似于一个以中心点为原点的二维坐标系，如图2示例，设置地图的初始缩放比例zoom为2，最大和最小缩放比例分别为26和2，将创建的投影坐标赋值给属性projection。这样地图的一个视图就创建好了。S5、添加控件为了方便用户对地图的操作，在地图上创建一个默认控件，然后在默认控件的基础上继续添加控件，使用ol.control.defaults.extend的方法继续传入全屏控件。S6、创建图层创建一个图层对象并赋值给全局变量vectorLayer，创建一个数据源对象并赋值给全局变量vectorSource ，将数据源对象设置到图层对象中，然后将此图层添加到map对象中。这样一个完整的地图对象就创建好了。S7、上传背景图在地图容器上添加一个设置背景图的入口，这样可以更方便的调整背景图并且实时查看效果。为了获取背景图的原始宽高方便后续回显，这里使用原生的input标签来上传，设置input的type属性为file，限制上传图片的格式为jpg，jpeg，png，限制上传文件的大小为5M。调取上传图片接口，成功执行之后在文件的onload事件中获取此图片的原始宽度以及图片的原始高度。S8、设置背景图的左下角位置添加两个input框，用来编辑背景图左下角的x，y坐标，用户可以在地图上先拾取一个点，通过监听地图的单击点击事件得到这个点的位置，回显到x，y的输入框中。也可自行编辑输入框的值来调整位置。S9、设置背景图的缩放比例为了实现背景图的大小调整，添加一个input输入框，初始值设置为100%，用户可以调整比例的数值。S10、计算背景图的投影范围投影范围extent数组的前两项即是用户初始拾取的x，y值，设为x1，y1，数组后两项是背景图右上角的x，y坐标，设置为x2，y2，上传图片时获取的宽高设置为width，height。计算x2，y2的值需要结合图片的原始宽高、缩放比例大小scale，以及x1，y1的值，背景图缩放之后的宽高的计算方式分别为：width2=/100，height2=/100，地图是一个向上为正，向右为正，中心点为的坐标系，因此x2，y2的计算方式分别为x2=width2+x1，y2=height2+y1。S11、设置背景图的投影坐标创建一个投影坐标系对象，图片的投影坐标类型必须设置为图片类型，设置投影范围为实时计算出的extent值。S12、创建背景图的图层并添加到地图上创建背景图层对象，设置数据源为静态图片对象，url属性即为上传的图片地址，将此图层添加到地图map对象中，此时背景图可以无失真的添加到地图上用户所设置的位置上。以上所述仅是本发明的优选实施方式，应当指出，对于本技术领域的普通技术人员来说，在不脱离本发明原理的前提下，还可以作出若干改进，这些改进也应视为本发明的保护范围。
