标题title
可处理电学和几何约束的模拟电路布线自动化方法及系统
摘要abst
本发明公布了一种可处理电学和几何约束的模拟电路布线自动化方法及系统，对于模拟电路电学约束，使用斯坦纳树建模关键线网的布线拓扑，计算线网线段的布线线宽；对于模拟电路几何约束，使用优化的A星算法作为寻路算法寻找布线路径；系统包括：构建树状布线拓扑模块、线宽计算模块和寻路布线模块；根据模拟电路版图的电学约束、几何约束和模拟电路版图设计要求，使用寻路算法获取可行的模拟电路版图布线结果，由此实现可处理电学和几何约束的模拟电路自动化布线。本发明可实现高效的模拟电路自动布线，且自动布线完成的版图具有与人工布线结果接近的电路性能。
权利要求书clms
1.一种可处理电学和几何约束的模拟电路布线自动化方法，其特征是，对于模拟电路电学约束，使用斯坦纳树建模关键线网的布线拓扑，计算线网线段的布线线宽；对于模拟电路几何约束，使用优化的A星算法作为寻路算法寻找布线路径；从而实现可处理电学和几何约束的模拟电路自动化布线；包括以下步骤：1）对关键线网建立布线拓扑：基于布局完成的模拟电路版图和电流信息，构造关键线网的布线拓扑；包括：11）输入模拟电路的网表文件和布局完成的模拟电路版图，对网表文件进行前仿真，得到关键线网每个管脚流入流出的电流信息；自底向上地构建线网的斯坦纳树形式的布线拓扑：12）定义电流加权线长的计算方式为线段通过的电流数值乘线段的长度之和；13）建立布线拓扑；方法包括：131）每个回合选取拥有最小电流加权线长的三个管脚，其中任意三个管脚之间的电流加权线长的估计方式是三个管脚到三个管脚的质心的曼哈顿距离分别乘上管脚流出电流的绝对值，然后求和；132）在最小电流加权线长的三个管脚的质心插入一个新的斯坦纳点，将新插入的斯坦纳点替换原有的三个管脚进行下一个回合的管脚选取；133）如此重复每个回合对三个管脚的选取及插入新斯坦纳点，直到只剩下一个斯坦纳点；134）将剩下的斯坦纳点作为斯坦纳树的根节点，其它的斯坦纳点按照插入顺序依次连接，即得到斯坦纳树形式的线网布线拓扑；2）为线网的线段计算线宽：针对模拟电路的电学约束，在斯坦纳树形式的线网布线拓扑上确定线网的每个线段的线宽；电学约束包括：电阻约束，电压降约束，电迁移约束；其中，将电阻约束和电迁移约束均表示为线网每个线段的电阻上下限约束；电压降约束表示为多段线网的电阻的线性组合的上限约束；采取方块电阻近似方式，使用步骤1）中构建得到的斯坦纳树形式的线网布线拓扑和线长的估计，将电阻约束、电压降约束、电迁移约束表示为关于线段线宽的倒数的线性不等式组；求解关于线宽倒数的线性不等式组，即得出线网线段的线宽；3）基于步骤1）生成的斯坦纳树形式的线网布线拓扑和步骤2）得到的线网线段的线宽，使用寻路算法，针对模拟电路的电学约束和几何约束，以及模拟电路版图的布线设计规则要求，完成布线；寻路算法采用改进A星寻路算法，包括：31）基于步骤1）生成的斯坦纳树形式的线网布线拓扑，将线网拆分成为多个二管脚线网，同时将模拟电路版图划分为虚拟的格点图；32）对每个二管脚线网使用A星寻路算法，避开器件和已布线区域的障碍，使得布线宽度与步骤2）得到的线宽计算结果一致；33）对于几何约束和布线设计规则，在A星寻路算法的目标函数中加入对几何约束和布线设计规则的违例惩罚项：在出现违反上述约束和规则的违例时，在目标函数中减去一个大数，在搜索中避免出现违例，得到可行的布线结果；34）电学约束还可包括对称约束；对于对称约束，选取对称约束对应的两个线网中的一个线网，先进行布线，再将布线完成的线网的布线拓扑进行对称处理，包括轴对称或中心对称；将对称处理后得到的区域作为另一个线网布线的指导区域，采用寻路算法优先在指导区域内布线；通过上述步骤，实现可处理电学和几何约束的模拟电路自动化布线。2.如权利要求1所述的可处理电学和几何约束的模拟电路布线自动化方法，其特征是，步骤3）计算线网线段的线宽，具体是使用开源线性规划求解器lpsolve55求解关于线宽倒数的线性不等式组，得出线网线段合适的线宽。3.如权利要求1所述的可处理电学和几何约束的模拟电路布线自动化方法，其特征是，几何约束包括：减少弯折约束。4.如权利要求1所述的可处理电学和几何约束的模拟电路布线自动化方法，其特征是，模拟电路版图的布线设计规则包括：平行线间距规则和线终点间距规则。5.如权利要求1所述的可处理电学和几何约束的模拟电路布线自动化方法，其特征是，步骤1）具体是通过仿真工具virtuoso对输入的网表文件进行前仿真，得到关键线网每个管脚流入流出的电流信息。6.一种实现如权利要求1所述的可处理电学和几何约束的模拟电路布线自动化方法的系统，其特征是，包括：构建树状布线拓扑模块、线宽计算模块和寻路布线模块；其中，构建树状布线拓扑模块用于根据布局完成的版图以及电流信息，构造关键线网的布线拓扑；线宽计算模块用于定义电流加权的线长，并根据模拟电路版图的电学约束求解得到线宽；寻路布线模块用于根据模拟电路版图的几何约束和模拟电路版图设计规则，使用寻路算法获取可行的模拟电路版图布线结果。
说明书desc
技术领域本发明属于模拟电路版图自动化技术领域，涉及自动化模拟电路线网布线技术，具体涉及一种可通过模拟电路电学约束推演合适线宽的布线方法与系统，是一种利用模拟电路版图性能要求给定的电学指标的阈值，通过生成线网的布线拓扑树以确定合适的线宽，并遵循复杂的布线规则以及布线的电学、几何约束的要求，完成自动化线网布线的技术。背景技术目前在实践中，模拟电路版图的布线主要依赖于人工手动完成。随着电路版图布线工艺节点的演进，模拟电路版图的设计要求日趋复杂。并且，模拟集成电路的电路规模也出现了巨大的增长。原有的人工手动布线的方式已经无法适应复杂的设计规则以及增长的规模，因此自动化的模拟电路版图布线方法得到研究。目前，现有模拟电路版图的布线工具包括明尼苏达大学ALIGN工具的布线器，德克萨斯大学奥斯汀分校MAGICAL工具的布线器，里斯本大学基于LAYGENII的布线器。已有的模拟电路版图布线器设计流程和工具存在以下不足之处：只能处理少部分设计规则，无法在统一框架中实现对多种复杂的布线规则的处理，并且，面对更为复杂的电学和几何约束，布线器无法综合考虑；对于关键线网的线宽的确定没有合适的方法，无法满足先进工艺下模拟电路的性能要求；相比与人工版图，布线器生成的版图的性能有一定的衰减，不一定能满足特定的设计需求。综上所述，现有传统的模拟电路版图布线方法不完全适应于当前布线设计的需求，难以处理模拟电路版图自动化线网布线复杂的设计规则以及线网布线性能的要求。发明内容为了克服上述现有技术的不足，本发明提供了一种模拟电路版图布线自动化方法及系统，建立了统一处理各种复杂设计规则的自动化布线模型框架，并可以自动为关键线网计算合适的线宽，得到高性能的布线完成的版图结果。该方法可以完备处理人工设计模拟电路版图布线过程中不易于处理的复杂设计规则，大幅提高模拟电路版图设计的效率，得到与人工设计版图性能接近的版图结果，性能超过其他的自动化布线工具。本发明具体实施过程包括：构建树状的布线拓扑、定义电流加权的线长、根据模拟电路的电学约束求解模拟电路布线的线宽、处理复杂的几何约束、处理复杂的设计规则、使用寻路算法给出可行解。在本发明中，以已经布局完成的模拟电路版图作为输入，首先对于模拟电路关键的线网建立斯坦纳树形式的布线拓扑，布线拓扑可用于估计线网的布线线长，并且使用前仿真衡量线网上通过的电流的数值，然后基于布线拓扑和电流信息，将布线的电学约束条件转换为线性规划问题求解，得到线网每个线段的线宽，最后基于布线拓扑和线宽以及电学、几何约束条件 ，使用A星算法完成线网的完整布线。本发明提供一种可处理电学和几何约束的模拟电路布线自动化方法，对于电学约束，使用斯坦纳树建模关键线网的布线拓扑，计算线网线段的布线线宽；对于几何约束，使用优化的A星算法作为寻路算法寻找布线路径；从而实现可处理电学和几何约束的模拟电路自动化布线；包括以下步骤：1）对关键线网建立布线拓扑：基于布局完成的模拟电路版图和电流信息，构造关键线网的布线拓扑；包括：11）输入模拟电路的网表文件和布局完成的模拟电路版图，对网表文件进行前仿真，得到关键线网每个管脚流入流出的电流信息；自底向上地构建线网的斯坦纳树形式的布线拓扑：12）定义电流加权线长的计算方式为线段通过的电流数值乘线段的长度之和；13）建立布线拓扑；方法包括：131）每个回合选取拥有最小电流加权线长的三个管脚，其中任意三个管脚之间的电流加权线长的估计方式是三个管脚到三个管脚的质心的曼哈顿距离分别乘上管脚流出电流的绝对值，然后求和；132）在最小电流加权线长的三个管脚的质心插入一个新的斯坦纳点，将新插入的斯坦纳点替换原有的三个管脚进行下一个回合的管脚选取；133）如此重复每个回合对三个管脚的选取及插入新斯坦纳点，直到只剩下一个斯坦纳点；134）将剩下的斯坦纳点作为斯坦纳树的根节点，其它的斯坦纳点按照插入顺序依次连接，即得到斯坦纳树形式的线网布线拓扑；2）为线网的线段计算线宽：针对模拟电路的电学约束，在斯坦纳树形式的线网布线拓扑上确定线网的每个线段的线宽；电学约束包括：电阻约束，电压降约束，电迁移约束；其中，将电阻约束和电迁移约束均表示为线网每个线段的电阻上下限约束；电压降约束表示为多段线网的电阻的线性组合的上限约束；采取方块电阻近似方式，使用步骤1）中构建得到的斯坦纳树形式的线网布线拓扑和线长的估计，将电阻约束、电压降约束、电迁移约束表示为关于线段线宽的倒数的线性不等式组；求解关于线宽倒数的线性不等式组，即得出线网线段的线宽；3）基于步骤1）生成的斯坦纳树形式的线网布线拓扑和步骤2）得到的线网线段的线宽，使用寻路算法，针对模拟电路的电学约束和几何约束，以及模拟电路版图的布线设计要求，完成布线；寻路算法采用改进A星寻路算法，包括：31）基于步骤1）生成的斯坦纳树形式的线网布线拓扑，将线网拆分成为多个二管脚线网，同时将模拟电路版图划分为虚拟的格点图；32）对每个二管脚线网使用A星寻路算法，避开器件和已布线区域的障碍，使得布线宽度与步骤2）得到的线宽计算结果一致；33）对于几何约束和布线设计要求，在A星寻路算法的目标函数中加入对几何约束和布线设计要求的违例惩罚项：在出现违反上述约束和要求的违例时，在目标函数中减去一个大数，在搜索中避免出现违例，得到可行的布线结果；34）电学约束还可包括对称约束；对于对称约束，选取对称约束对应的两个线网中的一个线网，先进行布线，再将布线完成的线网的布线拓扑进行对称处理，包括轴对称或中心对称；将对称处理后得到的区域作为另一个线网布线的指导区域，采用寻路算法优先在指导区域内布线；通过上述步骤，实现可处理电学和几何约束的模拟电路自动化布线。步骤3）计算线网线段的线宽，具体是使用开源线性规划求解器lpsolve55求解关于线宽倒数的线性不等式组，得出线网线段合适的线宽。几何约束包括：减少弯折约束。模拟电路版图的布线设计要求包括：平行线间距规则和线终点间距规则。步骤1）具体是通过仿真工具virtuoso对输入的网表文件进行前仿真，得到关键线网每个管脚流入流出的电流信息。本发明还提供一种实现上述可处理电学和几何约束的模拟电路布线自动化方法的系统，系统包括：构建树状布线拓扑模块、线宽计算模块和寻路布线模块；其中，构建树状布线拓扑模块用于根据布局完成的版图以及电流信息，构造关键线网的布线拓扑；线宽计算模块用于定义电流加权的线长，并根据模拟电路版图的电学约束求解得到线宽；寻路布线模块用于根据模拟电路版图的几何约束和模拟电路版图设计要求，使用寻路算法获取可行的模拟电路版图布线结果。与现有技术相比，本发明的有益效果是：本发明提供了一种可处理模拟电路电学约束、几何约束及复杂的设计规则的布线方法，利用本发明的技术方案，可以实现高效的模拟电路自动布线，用户可以通过设置电学约束和几何约束得到优化过线宽以及布线拓扑的版图，自动布线完成的版图将具有与人工布线结果接近的电路性能。附图说明图1为本发明提供的可处理复杂电学约束和几何约束的模拟电路版图布线方法的流程框图。图2为本发明提出的为关键线网建立布线拓扑的算法流程示意图。图3为本发明提出的处理对称约束的布线搜索算法的一个示例，其中对称约束出现在两个对称的线网之间。具体实施方式下面结合附图，通过实施例进一步描述本发明，但不以任何方式限制本发明的范围。本发明提供了一种模拟电路版图布线自动化方法及系统，建立了统一处理各种复杂设计规则的自动化布线模型框架，并可以自动为关键线网计算合适的线宽，得到高性能的布线完成的版图结果。本发明提供一种可确定线宽及处理复杂设计规则的模拟电路布线方法，是一种支持将各种复杂的电学和几何约束转换为线宽和走线形状的要求的布线方法；本发明基于布局的版图以及电路前仿真的电流信息；对于模拟电路电学约束，考虑关键线网，使用斯坦纳树建模关键线网的布线拓扑，计算线网线段的布线线宽；对于几何约束，使用优化的A星算法作为寻路算法寻找合适的布线路径；图1所示为本发明提供的可处理模拟电路复杂电学约束和几何约束的模拟电路版图布线方法的流程。包括以下步骤：A. 对关键线网建立布线拓扑：基于布局完成的版图以及电流信息，构造关键线网的布线拓扑，服务于后续的线宽计算及寻路；输入模拟电路的网表文件以及布局完成的版图，调用仿真工具virtuoso对输入的网表文件进行前仿真，得到关键线网每个管脚流入流出的电流信息。基于大电流的线网线段需要较短的布线线长的原则，自底向上地构建线网的斯坦纳树形式的布线拓扑：定义电流加权的线长，计算方式为线段通过的电流数值乘线段的长度之和。本发明首创地提出的建立布线拓扑的方法具体是：每个回合选取拥有最小电流加权线长的三个管脚，其中任意三个管脚之间的电流加权线长的估计方式是三个管脚到三个管脚的质心的曼哈顿距离分别乘上管脚流出电流的绝对值然后求和，在最小电流加权线长的三个管脚的质心插入一个新的斯坦纳点，将这个新插入的斯坦纳点替换原有的三个管脚进行下一个回合的管脚选取，如此重复每个回合对三个管脚的选取及插入新斯坦纳点，直到只剩下一个斯坦纳点，将这个唯一余留的斯坦纳点作为斯坦纳树的根节点，对其他的斯坦纳点则按照插入的顺序依次连接，即得到斯坦纳树形式的线网的布线拓扑。本发明具体实施时，为关键线网建立布线拓扑的算法步骤如图2所示。图2所示关键线网有5个管脚，A、B、C、D、E是需要布线的关键线网的管脚，、、、、为流出对应管脚的电流；每个回合的左图为版图上管脚的示意，右图为左图对应时刻构建的斯坦纳树。第一个回合，在5个管脚中寻找具有最小电流加权线长的3个管脚，为管脚A、B、C，计算A、B、C的质心并在质心处插入新的斯坦纳点，对应在斯坦纳树上插入一个电流为的树的节点；第二个回合，第一个回合插入的斯坦纳点和剩下的2个管脚D、E形成最小电流加权线长并在它们的质心插入新的斯坦纳点，对应斯坦纳树上插入一个电流为的树的节点，此时到达树的根结点，算法结束，布线拓扑为右下图所示的斯坦纳树。B. 为线网的线段计算线宽：依据模拟电路电学约束，在斯坦纳树形式的布线拓扑上，综合确定线网的每个线段的线宽；模拟电路的电学约束包括：电阻约束，电压降约束，电迁移约束，还可以包括对称约束。模拟电路电学约束中，电阻约束、电迁移约束直接表示为线网每个线段的电阻上下限约束，电压降约束表示为多段线网的电阻的线性组合的上限约束。采取方块电阻的近似，线段的电阻反比于线段的线宽，正比于线段的线长，使用步骤A中构建的线网的斯坦纳树形式的拓扑及线长的估计，将电阻约束、电压降约束、电迁移约束表示为关于线段线宽的倒数的线性不等式组。使用开源线性规划求解器lpsolve55求解关于线宽倒数的线性不等式组，得出线网线段合适的线宽。C. 使用寻路算法完成布线：基于生成的布线拓扑及线宽，本发明改进已有的A星寻路算法，考虑电学约束和几何约束，以及复杂的设计规则，完成布线；几何约束包括：减少弯折约束；复杂的设计规则包括：平行线间距规则和线终点间距规则。基于步骤A生成的斯坦纳树形式的线网的布线拓扑，将线网拆分成为多个二管脚线网，同时将版图划分为虚拟的格点图，对每个二管脚线网使用A星寻路算法，避开器件和已布线区域的障碍，保证布线宽度与步骤B的计算结果一致。对于几何约束和复杂的布线规则，已有的A星寻路算法的目标函数只关注连通性，本发明在A星寻路算法的目标函数中加入对约束和规则的违例的惩罚项，在出现违反上述约束和规则的违例时在目标函数中减去一个大数，在搜索中避免出现违例，得到可行的布线结果。对于对称约束，选取对称约束中指明的两个线网中的一个线网，先进行布线，再将布线完成的线网的布线拓扑做轴对称或中心对称，对称处理得到的区域作为另一个线网布线的指导区域，寻路算法优先在指导区域内布线。图3所示为本发明处理对称线网的布线搜索算法过程。图3所示、、为线网1的3个管脚，、、、为线网2的4个管脚。如图3所示，线网1已经通过A星寻路算法得到了布线结果；如图3所示，线网1与线网2有基本的中心对称关系，即与对称，与对称，与对称，线网1的布线可以按照同样的中心对称规则映射到线网2上；如图3所示，从线网1映射到线网2的布线可能会跨过布线障碍，且有可能没有连通所有的管脚，因此在布线障碍垂直于映射的布线线段的方向寻找不在布线障碍范围内的目标点，将目标点和映射的布线作为线网2的布线指导，即在A星寻路算法中增加对远离布线指导的惩罚项；如图3，最终使用A星寻路算法完成线网2布线。通过上述步骤，即实现了可确定线宽的自动化模拟电路版图布线。本发明具体实施了一种综合考虑电学约束和几何约束的布线自动化系统，包括：构建树状布线拓扑模块、线宽计算模块和寻路布线模块；其中，构建树状布线拓扑模块用于根据布局完成的版图以及电流信息，构造关键线网的布线拓扑；线宽计算模块用于定义电流加权的线长、根据电学约束求解线宽；寻路布线模块用于处理复杂的几何约束、处理复杂的设计规则、并使用寻路算法给出可行的版图布线结果。需要注意的是，公布实施例的目的在于帮助进一步理解本发明，但是本领域的技术人员可以理解：在不脱离本发明及所附权利要求的范围内，各种替换和修改都是可能的。因此，本发明不应局限于实施例所公开的内容，本发明要求保护的范围以权利要求书界定的范围为准。
