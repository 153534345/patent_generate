标题title
面向多源数据库的区块链海量数据存证系统及存证方法
摘要abst
本发明公开了一种面向多源数据库的区块链海量数据存证系统及存证方法，涉及区块链领域，包括数据预处理子系统、数据上传子系统、区块链交互子系统、凭证回传子系统，数据预处理子系统筛选数据库中可上链的表信息，数据上传子系统批量读取并上传表中的数据，区块链交互子系统提供链上用户管理、数据表管理及存证数据管理的功能，凭证回传子系统在数据写入区块链后，将区块链产生的数据上链凭证回传至数据库。本发明用少量智能合约，将任意一种数据库中含主键的数据上链存证，动态扩展存证数据的形式，链式查询数据变动记录，解决了中心化存证系统权力集中、数据易被篡改、可存证数据形式单一、扩展存证数据形式繁琐、智能合约数量增长的问题。
权利要求书clms
1.一种面向多源数据库的区块链海量数据存证系统，其特征在于：包括数据预处理子系统、数据上传子系统、区块链交互子系统、凭证回传子系统，所述数据预处理子系统负责筛选数据库内的可上链的表信息，所述数据上传子系统负责读取数据库中的数据，并将数据推送至区块链交互子系统，所述区块链交互子系统提供链上用户管理、数据表管理及存证数据管理的功能，所述凭证回传子系统在数据写入区块链后，负责将区块链产生的数据上链凭证回传至数据库；所述区块链交互子系统包括区块链用户模块、链上表管理模块、链上数据管理模块，所述区块链用户模块提供区块链用户注册、区块链用户登陆功能，所述链上表管理模块提供链上数据表新建、链上数据表名清单、链上数据表配置查询、链上数据表字段修改、链上数据表名修改的功能，所述链上数据管理模块提供链上数据新增、链上数据删除、链上数据修改、链上数据查询的功能。2.根据权利要求1所述的一种面向多源数据库的区块链海量数据存证系统，其特征在于，所述数据预处理子系统包括数据库连接模块和表筛选模块，所述数据库连接模块用于根据用户输入的数据库连接信息，加载对应的数据库连接驱动，将可以连接的数据库连接信息推送至数据上传子系统和凭证回传子系统；所述表筛选模块用于筛选符合区块链建表标准的数据表，推送符合标准的表名至数据上传子系统，推送符合标准的建表信息至区块链交互子系统的建表模块。3.根据权利要求1所述的一种面向多源数据库的区块链海量数据存证系统，其特征在于，所述数据上传子系统包括数据读取模块和数据推送模块，所述数据读取模块用于在接收到数据库连接信息和符合建表标准的表名后，自动读取表中每条数据的所有字段名及其对应的字段值；所述数据推送模块用于将读取出的数据，推送到区块链交互子系统的链上数据管理模块。4.根据权利要求1所述的一种面向多源数据库的区块链海量数据存证系统，其特征在于，所述链上数据管理模块在进行链上数据新增操作时，会自动记录当前时间、新增数据的用户地址、当前数据存证的Hash值，并将三条信息添加分隔符，拼接为一个字段值写入数据操作信息字段；所述链上数据管理模块在进行链上数据修改操作时，链上数据管理模块会自动判断用户地址是否与新增时写入的用户地址一致，若不一致则不允许修改数据，若一致则根据提供的表名、主键名和对应的主键值定位数据，并根据提供的字段名和字段值修改数据，其它未提供的字段会默认继承原内容，不做修改，不会发生变化；修改时，链上数据管理模块会自动记录当前时间、修改数据的用户地址、当前数据存证的Hash值、该数据上次记录的Hash值，并将四条信息添加分隔符，拼接为一个字段值写入数据操作信息字段；对于已上传至区块链的数据，用户只能修改它存在区块链上的普通字段值，无法修改其主键值和数据操作信息的值。5.根据权利要求1所述的一种面向多源数据库的区块链海量数据存证系统，其特征在于，所述链上数据管理模块的链上数据查询功能同时支持主键查询、Hash查询两种查询方式。6.根据权利要求1所述的一种面向多源数据库的区块链海量数据存证系统，其特征在于，所述凭证回传子系统包括字段新增模块和凭证记录模块，所述字段新增模块用于在数据库中，为当前上传数据的表新建一个字段，该字段用于保存数据写入区块链时生成的Hash值；所述凭证记录模块用于将Hash值写入它对应的数据新增的字段中，将Hash值与数据保存在一起。7.根据权利要求1所述的一种面向多源数据库的区块链海量数据存证系统，其特征在于，所述区块链交互子系统的链上表管理模块和链上数据管理模块，是由一种分层的智能合约实现功能，包括数据操作层、功能实现层、对外交互层；其中数据操作层包含的是由区块链自身提供的，直接对链上数据进行增删改查的基础合约；功能实现层包括功能扩展合约与工具库合约，功能扩展合约是对数据操作层的合约进行功能扩展，以实现对区块链表和对区块链数据的模块化区分管理，工具库合约负责提供功能扩展合约中多次复用的功能代码；对外交互层则仅有一个智能合约，用于调用功能实现层的合约，对外提供区块链链上表管理模块和区块链链上数据管理模块的所有功能。8.一种面向多源数据库的区块链海量数据存证方法，其特征在于，所述方法基于权利要求1-7任一项所述的一种面向多源数据库的区块链海量数据存证系统，包括自动全量存证模式、手动存证模式，所述自动全量存证模式指用户可以指定目标数据库，本存证系统会自动将目标数据库中含主键的表在区块链上创建出来，并将表中数据自动上传至区块链进行存证，后续可以对上链数据进行删除、修改、查询的操作；所述手动存证模式指用户可以自行在区块链上创建数据表，后续可以在创建的数据表上进行新增、删除、修改、查询数据的操作。9.根据权利要求8所述的一种面向多源数据库的区块链海量数据存证方法，其特征在于，所述自动全量存证模式包括如下步骤：步骤1，用户向数据预处理子系统发送数据库类型、名称及数据库连接地址、端口、用户名、密码；步骤2，数据预处理子系统筛选出具有主键的表，向区块链交互子系统推送其建表信息；步骤3，链上数据表新建模块检验区块链上是否已经存在同名的表，若存在则不予创建该表，若不存在，则根据表名、主键名和普通字段名在区块链上创建出一张表；步骤4，建表成功后，数据上传子系统向区块链交互子系统的链上数据新增模块，发送存证数据所属的表名、存证数据的字段名及字段名对应的数据；步骤5，链上数据新增模块检测待存证数据是否符合规范，规范包括字段名和字段值的数量一致、字段名中包含主键名、主键值没有重复、所有字段名都在表中，当待存证数据符合规范时，链上数据新增模块才会将数据提交，待区块链上的节点共识成功后将数据写入区块链中，持久保存该数据，否则不存证该数据；步骤6，每条数据存证成功后，区块链都会返回一条Hash值作为数据上链的凭证，凭证回传子系统在源数据库的表中新增一个字段，并将Hash值写入对应数据的该字段中；步骤7，数据存证成功后，可以对区块链上的数据进行查找、修改、删除的操作。10.根据权利要求8所述的一种面向多源数据库的区块链海量数据存证方法，其特征在于，所述手动存证模式包括如下步骤：步骤1，用户向区块链交互子系统推送建表信息；步骤2，链上数据表新建模块检验区块链上是否已经存在同名的表，若存在则不予创建该表，若不存在，则根据表名、主键名和普通字段名在区块链上创建出一张表；步骤3，建表成功后，由用户调用区块链交互子系统的链上数据新增功能，推送存证数据所属的表名、存证数据的字段名及字段名对应的数据；步骤4，链上数据新增模块检测待存证数据是否符合规范，规范包括字段名和字段值的数量一致、字段名中包含主键名、主键值没有重复、所有字段名都在表中，当待存证数据符合规范时，链上数据新增模块才会将数据提交，待区块链上的节点共识成功后将数据写入区块链中，持久保存该数据，否则不存证该数据；步骤5，每条数据存证成功后，区块链都会返回一条Hash值作为数据上链的凭证，用户需自行保存该凭证；步骤6，数据存证成功后，可以对区块链上的数据进行查找、修改、删除的操作。
说明书desc
技术领域本发明涉及区块链技术领域，尤其是一种面向多源数据库的区块链海量数据存证系统及存证方法。背景技术区块链技术一开始是以数字货币的形式出现在大众的视野中，随着对区块链技术深入的研究，区块链技术已被发掘出具有去中心化、公开透明、链上数据不可篡改等特点，在供应链金融、数据存证、产品溯源等许多场景下都具有很好的适用性和应用价值。传统的存证系统都是用户向存证机构提交存证数据，存证数据由存证机构代为保存，属于中心化存储数据，如机构的存储系统被攻击，极易导致存证数据被篡改。而现有的区块链存证系统大多是针对单一业务场景定制开发了智能合约，只能存证固定格式的电子发票或交易记录的信息，存证数据格式单一。扩展可存证内容则需要在原智能合约的基础上不断更新、维护，或针对新的需要存证的内容再次开发新的存证智能合约，功能扩展较为繁琐，可能会不断增加智能合约的数量，增加区块链运行负担，影响区块链运行效率。如果有将现有数据库中的数据存证上链，必须将数据读取后，按照智能合约接收的规范，对数据进行处理后再上传至区块链。若数据库中某个字段在该业务系统中存储的数据内容较为关键，但智能合约中并未事先定义该字段，那么则需要对数据进行拼接重组的操作，以达到符合智能合约接收规范的要求。但此时数据已被修改，区块链只能保证链上数据无法篡改，无法监管此类在链下已被修改过的数据，其间可能会存在数据被篡改的风险。针对相关存证系统在使用中，中心化存证系统权力集中、数据易被篡改，而现有区块链存证系统可存证数据形式单一、扩展存证数据形式繁琐、智能合约数量增长的问题，尚未提出有效的解决方案。发明内容为了克服现有技术中存在的上述问题，本发明提出一种面向多源数据库的区块链海量数据存证系统及存证方法。本发明解决其技术问题所采用的技术方案是：一种面向多源数据库的区块链海量数据存证系统，包括数据预处理子系统、数据上传子系统、区块链交互子系统、凭证回传子系统，所述数据预处理子系统负责筛选数据库内的可上链的表信息，所述数据上传子系统负责读取数据库中的数据，并将数据推送至区块链交互子系统，所述区块链交互子系统提供链上用户管理、数据表管理及存证数据管理的功能，所述凭证回传子系统在数据写入区块链后，负责将区块链产生的数据上链凭证回传至数据库；所述区块链交互子系统包括区块链用户模块、链上表管理模块、链上数据管理模块，所述区块链用户模块提供区块链用户注册、区块链用户登陆功能，所述链上表管理模块提供链上数据表新建、链上数据表名清单、链上数据表配置查询、链上数据表字段修改、链上数据表名修改的功能，所述链上数据管理模块提供链上数据新增、链上数据删除、链上数据修改、链上数据查询的功能。上述的一种面向多源数据库的区块链海量数据存证系统，所述数据预处理子系统包括数据库连接模块和表筛选模块，所述数据库连接模块用于根据用户输入的数据库连接信息，加载对应的数据库连接驱动，将可以连接的数据库连接信息推送至数据上传子系统和凭证回传子系统；所述表筛选模块用于筛选符合区块链建表标准的数据表，推送符合标准的表名至数据上传子系统，推送符合标准的建表信息至区块链交互子系统的建表模块。上述的一种面向多源数据库的区块链海量数据存证系统，所述数据上传子系统包括数据读取模块和数据推送模块，所述数据读取模块用于在接收到数据库连接信息和符合建表标准的表名后，自动读取表中每条数据的所有字段名及其对应的字段值；所述数据推送模块用于将读取出的数据，推送到区块链交互子系统的链上数据管理模块。上述的一种面向多源数据库的区块链海量数据存证系统，所述链上数据管理模块在进行链上数据新增操作时，会自动记录当前时间、新增数据的用户地址、当前数据存证的Hash值，并将三条信息添加分隔符，拼接为一个字段值写入数据操作信息字段；所述链上数据管理模块在进行链上数据修改操作时，链上数据管理模块会自动判断用户地址是否与新增时写入的用户地址一致，若不一致则不允许修改数据，若一致则根据提供的表名、主键名和对应的主键值定位数据，并根据提供的字段名和字段值修改数据，其它未提供的字段会默认继承原内容，不做修改，不会发生变化；修改时，链上数据管理模块会自动记录当前时间、修改数据的用户地址、当前数据存证的Hash值、该数据上次记录的Hash值，并将四条信息添加分隔符，拼接为一个字段值写入数据操作信息字段；对于已上传至区块链的数据，用户只能修改它存在区块链上的普通字段值，无法修改其主键值和数据操作信息的值。上述的一种面向多源数据库的区块链海量数据存证系统，所述链上数据管理模块的链上数据查询功能同时支持主键查询、Hash查询两种查询方式。上述的一种面向多源数据库的区块链海量数据存证系统，所述凭证回传子系统包括字段新增模块和凭证记录模块，所述字段新增模块用于在数据库中，为当前上传数据的表新建一个字段，该字段用于保存数据写入区块链时生成的Hash值；所述凭证记录模块用于将Hash值写入它对应的数据新增的字段中，将Hash值与数据保存在一起。上述的一种面向多源数据库的区块链海量数据存证系统，所述区块链交互子系统的链上表管理模块和链上数据管理模块，是由一种分层的智能合约实现功能，包括数据操作层、功能实现层、对外交互层；其中数据操作层包含的是由区块链自身提供的，直接对链上数据进行增删改查的基础合约；功能实现层包括功能扩展合约与工具库合约，功能扩展合约是对数据操作层的合约进行功能扩展，以实现对区块链表和对区块链数据的模块化区分管理，工具库合约负责提供功能扩展合约中多次复用的功能代码，减少合约代码重复性，提高执行效率；对外交互层则仅有一个智能合约，用于调用功能实现层的合约，对外提供区块链链上表管理模块和区块链链上数据管理模块的所有功能。上述的一种面向多源数据库的区块链海量数据存证系统的存证方法，包括自动全量存证模式、手动存证模式，所述自动全量存证模式指用户可以指定目标数据库，本存证系统会自动将目标数据库中含主键的表在区块链上创建出来，并将表中数据自动上传至区块链进行存证，后续可以对上链数据进行删除、修改、查询的操作；所述手动存证模式指用户可以自行在区块链上创建数据表，后续可以在该表上进行新增、删除、修改、查询数据的操作。上述的一种面向多源数据库的区块链海量数据存证方法，所述自动全量存证模式包括如下步骤：步骤1，用户向数据预处理子系统发送数据库类型、名称及数据库连接地址、端口、用户名、密码；步骤2，数据预处理子系统筛选出具有主键的表，向区块链交互子系统推送其建表信息；步骤3，链上数据表新建模块检验区块链上是否已经存在同名的表，若存在则不予创建该表，若不存在，则根据表名、主键名和普通字段名在区块链上创建出一张表；步骤4，建表成功后，数据上传子系统向区块链交互子系统的链上数据新增模块，发送存证数据所属的表名、存证数据的字段名及字段名对应的数据；步骤5，链上数据新增模块检测待存证数据是否符合规范，规范包括字段名和字段值的数量一致、字段名中包含主键名、主键值没有重复、所有字段名都在表中，当上述条件均符合时，链上数据新增模块才会将数据提交，待区块链上的节点共识成功后将数据写入区块链中，持久保存该数据，否则不存证该数据；步骤6，每条数据存证成功后，区块链都会返回一条Hash值作为数据上链的凭证，凭证回传子系统在源数据库的表中新增一个字段，并将Hash值写入对应数据的该字段中；步骤7，数据存证成功后，可以对区块链上的数据进行查找、修改、删除的操作。上述的一种面向多源数据库的区块链海量数据存证方法，所述手动存证模式包括如下步骤：步骤1，用户向区块链交互子系统推送建表信息；步骤2，链上数据表新建模块检验区块链上是否已经存在同名的表，若存在则不予创建该表，若不存在，则根据表名、主键名和普通字段名在区块链上创建出一张表；步骤3，建表成功后，由用户调用区块链交互子系统的链上数据新增功能，推送存证数据所属的表名、存证数据的字段名及字段名对应的数据；步骤4，链上数据新增模块检测待存证数据是否符合规范，规范包括字段名和字段值的数量一致、字段名中包含主键名、主键值没有重复、所有字段名都在表中，当上述条件均符合时，链上数据新增模块才会将数据提交，待区块链上的节点共识成功后将数据写入区块链中，持久保存该数据，否则不存证该数据；步骤5，每条数据存证成功后，区块链都会返回一条Hash值作为数据上链的凭证，用户需自行保存该凭证；步骤6，数据存证成功后，可以对区块链上的数据进行查找、修改、删除的操作。本发明的有益效果是，可以仅用少量的智能合约，将任意一种关系型数据库中的含主键的数据上链存证，同时支持自动和手动两种存证模式，可以自定义数据存证的形式，支持自动批量同步数据库中的数据至区块链，可以链式查询数据变动记录，可以动态扩展存证数据的形式，链式查询数据变动记录，解决了中心化存证系统权力集中、数据易被篡改，现有区块链存证系统可存证数据形式单一、扩展存证数据形式繁琐、智能合约数量增长的问题。附图说明下面结合附图和实施例对本发明进一步说明。图1为本发明的功能模块图；图2为本发明的系统架构图；图3为本发明数据预处理流程图；图4为本发明区块链建表流程图；图5为本发明数据上传流程图；图6为本发明数据新增流程图；图7为本发明凭证回传流程图；图8为本发明数据删除程图；图9为本发明数据修改流程图；图10为本发明数据查询流程图；图11为本发明智能合约架构图。具体实施方式为使本领域技术人员更好的理解本发明的技术方案，下面结合附图和具体实施方式对本发明作详细说明。如图1所示，本实施例公开了一种面向多源数据库的区块链海量数据存证系统，包括数据预处理子系统、数据上传子系统、凭证回传子系统、区块链交互子系统。图2为本发明的系统架构图，展示了将数据库中数据存证到区块链上的各个大致流程及各功能模块的作用。数据预处理子系统筛选数据库中可上链的表信息，数据上传子系统批量读取并上传表中的数据，并将数据推送至区块链交互子系统，区块链交互子系统提供链上用户管理、数据表管理及存证数据管理的功能。凭证回传子系统在数据写入区块链后，将区块链产生的数据上链凭证回传至数据库。区块链交互子系统包括区块链用户模块、链上表管理模块、链上数据管理模块。区块链用户模块提供区块链用户注册、区块链用户登陆功能，用户只有通过注册，才能从区块链获取到随机生成的公钥、私钥和地址，凭私钥登陆之后对链上的信息进行操作。用户所有使链上数据发生变动的操作都会被区块链记录，永久存储在区块链上。链上表管理模块包含链上数据表新建、链上数据表名清单、链上数据表配置查询、链上数据表字段修改、链上数据表名修改的功能。其中链上数据表名清单功能可以查询链上所有的数据表名。链上表管理模块在区块链上创建表的时候，会自动添加一个数据操作信息字段。若待创建的表主键只有一个字段时，链上表管理模块会直接将该字段作为主键并创建表；若待创建的表有多个字段作为联合主键，链上表管理模块会对这几个字段添加分隔符，拼接成一个字段，以拼接后的字段作为主键在区块链上创建出表。链上数据管理模块包含链上数据新增、链上数据删除、链上数据修改、链上数据查询的功能。链上数据管理模块在接收到多主键的数据时，会自动将主键的数据添加分隔符，拼接为一个完整的主键数据进行操作。在新增数据时，会自动记录当前时间、新增数据的用户地址、当前数据存证的Hash值，并将三条信息添加分隔符，拼接为一个字段值写入数据操作信息字段。新增功能在写入数据时，待写入的数据字段必须包含所在表的所有主键，主键值相同的数据不能写入到同一张表中。除主键外，如有字段未上传，则该字段的值默认会以空字符串的形式写入区块链的表中。每条数据的字段名顺序在上传时可以不一致，但该条数据字段名的顺序要和字段值的顺序保持一致，能够一一对应。在修改数据时，链上数据管理模块会自动判断用户地址是否与新增时写入的用户地址一致，若不一致则不允许修改数据，若一致则根据提供的表名、主键名和对应的主键值定位数据，并根据提供的字段名和字段值修改数据，其它未提供的字段会默认继承原内容，不做修改，不会发生变化。修改时，链上数据管理模块会自动记录当前时间、修改数据的用户地址、当前数据存证的Hash值、该数据上次记录的Hash值，并将四条信息添加分隔符，拼接为一个字段值写入数据操作信息字段。对于已上传至区块链的数据，用户只能修改它存在区块链上的普通字段值，无法修改其主键值和数据操作信息的值。链上数据管理模块数据查询功能同时支持两种查询上链数据的方式。一种是主键查询方式；另一种是Hash查询方式。主键查询方式是根据表名、主键名和主键字段调用智能合约查询上链数据，该方式可以查询到链上正在存储的完整数据内容和数据操作信息字段的内容。Hash查询方式是根据数据上链时产生的Hash值直接在区块链上查询，该方式可以查询到产生Hash时的数据内容、数据操作者、该条Hash产生时的时间戳、该数据所在的区块。当区块链上的数据被删除后，凭借主键查询方式无法再查询到该条数据，但由于区块链的所有操作都会在链上留痕、全程可追溯的特性，凭该条数据上链时产生的Hash值，仍可以在区块链上解析出当时上链的数据。在查询数据时，用户可以获取到完整数据信息，此时可以根据数据操作字段内的上次变动时产生的Hash值，再通过Hash查询方式实现链式查询，可以追溯到该条数据以往的所有变动时的数据。区块链交互子系统的区块链链上表管理模块和区块链链上数据管理模块，是由一种分层的智能合约实现功能，包括数据操作层、功能实现层、对外交互层。其中数据操作层包含的是由区块链自身提供的，直接对链上数据进行增删改查的基础合约。功能实现层包括功能扩展合约与工具库合约，功能扩展合约是对数据操作层的合约进行功能扩展，以实现对区块链表和对区块链数据的模块化区分管理；工具库合约负责提供功能扩展合约中多次复用的功能代码，减少合约代码重复性，提高执行效率。对外交互层则仅有一个智能合约，用于调用功能实现层的合约，对外提供区块链链上表管理模块和区块链链上数据管理模块的所有功能。功能扩展合约划分为两个方法区，一个方法区专门处理链上的表，调用数据操作层的合约对链上表信息进行增删改查，在建表时会判断用户输入的主键数组是否为空，对用户输入进行规范化判断；另一个方法区专门处理链上的数据，根据接收到的增删改查操作指令，调用数据操作层的方法，再根据指令中的表名和数据内容，对具体的数据进行操作，并自动添加数据操作信息数据，执行期间会调用工具库合约判断用户输入是否包含主键内容，以及在查询数据时，会将链上拼接形成的数据解析后返回。工具库合约中的复用功能包括三个功能，其一、字符串自动拼接与分割功能，在写入、查找联合主键数据及记录数据操作信息数据时，两者内容都是由多个信息项拼接而成，因此在写入时，检测到多个信息项，合约自动在其中添加分隔符，将多个信息项合并为一个完整的字符串。在查找数据时，当合约检测到数据内容包含分隔符时，会提取分割符前后的数据，还原为最初的多个信息项。其二、字段对应功能，在新增和修改数据时，合约会读取建表时的字段信息，将其作为一个信息数组，并遍历该数组与用户输入的字段名一一对比，提取表中的字段数据，防止用户输入的字段不是表中的字段。其三、主键检测功能，在新增、修改、查找、删除数据时都需要判断用户是否输入主键字段。合约读取建表时的字段信息，将其作为一个主键数组，并遍历该数组判断是否有主键字段未在用户的输入中出现。对外交互层将功能实现层的扩展合约两个方法区中，所有提供区块链链上表管理模块和链上数据管理模块增删改查功能的方法，都提取到该合约中，提供给用户一个统一的合约使用入口，通过调用该合约即可实现链上表和链上数据的管理。凭证回传子系统包括字段新增模块和凭证记录模块。字段新增模块用于在数据库中，为当前上传数据的表新建一个字段，该字段用于保存数据写入区块链时生成的Hash值。凭证记录模块用于将Hash值写入它对应的数据新增的字段中，将Hash值与数据保存在一起。本实施示例区块链海量数据存证系统时，假设存在多个待存证的数据库，数据库所在网络环境下可与区块链节点保持通讯。本实施例存证系统具有两种使用模式，一种是全量自动存证模式，另一种是手动存证模式。手动存证与全量自动存证不同之处在于，在全量自动存证模式下，会自动将源数据库中所有数据都上传，且会对原表添加一个字段用于保存数据上链的Hash值。在使用手动存证模式时，上传数据之前需要人工提交建表信息，区块链交互子系统的链上表管理模块接收到建表的信息后，首先会在区块链上查询是否存在同名的表，如果链上已经存在一个同样名称的表，那么就无法继续创建。当链上没有同名的表存在时，建表模块会在根据接受到的数据库表名、主键名及字段名，在区块链上创建出一个表，之后便可以在这张表上对数据进行增删改查操作，并且数据上链的Hash值返回后，需由数据存证发起者自行保存。其中自动全量存证模式包括如下步骤：步骤1，用户向数据预处理子系统发送数据库类型、名称及数据库连接地址、端口、用户名、密码；步骤2，数据预处理子系统筛选出具有主键的表，向区块链交互子系统推送其建表信息；步骤3，链上数据表新建功能检验区块链上是否已经存在同名的表，若存在则不予创建该表，若不存在，则根据表名、主键名和普通字段名在区块链上创建出一张表；步骤4，建表成功后，数据上传子系统向区块链交互子系统的数据新增模块，发送存证数据所属的表名、存证数据的字段名及字段名对应的数据；步骤5，数据新增模块检测待存证数据是否符合规范，规范包括字段名和字段值的数量一致、字段名中包含主键名、主键值没有重复、所有字段名都在表中，当上述条件均符合时，数据新增模块才会将数据提交，待区块链上的节点共识成功后将数据写入区块链中，持久保存该数据。否则不存证该数据；步骤6，每条数据存证成功后，区块链都会返回一条Hash值作为数据上链的凭证，凭证回传子系统在源数据库的表中新增一个字段，并将Hash值写入对应数据的该字段中；步骤7，数据存证成功后，可以对区块链上的数据进行查找、修改、删除的操作。其中手动存证模式包括如下步骤：步骤1，用户向区块链交互子系统推送建表信息；步骤2，建表模块检验区块链上是否已经存在同名的表，若存在则不予创建该表，若不存在，则根据表名、主键名和普通字段名在区块链上创建出一张表；步骤3，建表成功后，由用户向区块链交互子系统的数据新增模块，推送存证数据所属的表名、存证数据的字段名及字段名对应的数据；步骤4，数据新增模块检测待存证数据是否符合规范，规范包括字段名和字段值的数量一致、字段名中包含主键名、主键值没有重复、所有字段名都在表中，当上述条件均符合时，数据新增模块才会将数据提交，待区块链上的节点共识成功后将数据写入区块链中，持久保存该数据。否则不存证该数据；步骤5，每条数据存证成功后，区块链都会返回一条Hash值作为数据上链的凭证，用户需自行保存该凭证；步骤6，数据存证成功后，可以对区块链上的数据进行查找、修改、删除的操作。图3所示为本发明数据预处理流程图，数据预处理子系统包括数据库连接模块和表筛选模块，数据库连接模块用于根据用户输入的数据库连接信息，加载对应的数据库连接驱动，判断目标数据库是否可以连接，若能够连接成功，数据库连接模块会将数据库连接信息推送至数据上传子系统和凭证回传子系统。数据库连接信息包括数据库类型、数据库地址、数据库端口、数据库连接用户名、数据库连接密码、数据库名称。表筛选模块用于筛选符合区块链建表标准的数据表，推送符合标准的表名至数据上传子系统，推送符合标准的建表信息至区块链交互子系统的建表模块。符合区块链建表标准，指数据库中的表具有主键。建表信息，包括表名、该表的主键名、该表的所有字段名。在使用自动全量存证模式时，用户需在数据预处理子系统的数据库连接模块中选择数据库连接类型并输入连接数据库的用户名、密码、数据库名称。此时数据库连接模块会尝试连接数据库，连接成功后，会将上述数据库连接信息同步给数据上传子系统和回传子系统。表筛选模块会自动查找出该库中所有的表名，然后依次读取每张表的所有字段，并根据数据库中对表设定的信息，区分出主键字段和普通字段。若该表有主键，表筛选模块会提取出该表的表名、主键名和字段名作为建表信息，并推送到区块链交互子系统的建表模块；若该表没有主键，则不推送该表的建表信息。图4为本发明区块链建表流程图，区块链交互子系统的建表模块接收到建表的信息后，首先会判断表名是否为空，表名不为空时，会在区块链上查询是否存在同名的表，如果链上已经存在一个同样名称的表，那么就无法继续创建。当链上没有同名的表存在时，会继续判断是否接收到该表的主键名，接收到主键名后，建表模块会在根据接收到的数据库表名、主键名及字段名，并添加一个数据操作信息字段，在区块链上创建出一个表，可以在这张表上对数据进行增删改查操作。图5为本发明数据上传流程图，数据上传子系统包括数据读取模块和数据推送模块。数据读取模块用于，在接收到数据库连接信息和符合建表标准的表名后，自动读取表中每条数据的所有字段名及其对应的字段值。数据推送模块用于将读取出的数据，推送到区块链交互子系统的链上数据新增模块。区块链交互子系统创建表成功后，数据上传子系统根据数据预处理子系统推送的数据库信息，连接数据库并逐条将表中数据读取出来，然后逐条提交到区块链交互子系统的数据新增模块，提交的一条数据内容包括该数据所在的表名、所有的字段名、每个字段对应的数据内容。图6为本发明数据新增流程图，区块链交互子系统的链上数据管理模块接收到待上链的数据之后，首先会在区块链上查询待上传的数据所属的表是否已经存在，如果表不存在则无法上传数据。当表存在时，数据新增模块会检测待上传的数据是否符合规范，检测内容包括字段名和字段值的数量是否一致、字段名中是否包含主键名、主键值是否没有重复、是否所有字段名都在表中。上述规范必须全部满足，链上数据管理模块才会将数据提交，并自动记录当前时间、新增数据的用户地址、当前数据存证的Hash值，并将三条信息添加分隔符，拼接为一个字段值写入数据操作信息字段。待区块链上的节点共识成功后将数据写入区块链中，持久保存该数据。图7为本发明凭证回传流程图，节点共识结束之后会产生一个Hash值，回传子系统根据数据预处理模块推送到的数据库连接信息，连接数据库并在上传数据的这张表中新增一个字段，用于保存数据上链的凭证。回传子系统根据上传完成的这条数据的主键信息，更新它的数据上链凭证，即把共识产生的Hash值写在这条数据新增的字段中。当回传子系统将所有上链数据的Hash值都写入完成，全量自动存证结束。图8为本发明数据删除功能的流程图，区块链交互子系统的链上数据管理模块接收到待删除的数据之后，首先会在区块链上查询待删除的数据所属的表是否已经存在。当表名存在时，继续确认接收到的主键名是否与建表时的主键名一致。当主键名符合无误时，开始查找该数据，若查询到该数据，则判断数据删除者的地址是否与数据新增时数据操作信息字段中记录的用户地址一致，若不一致则不予删除，若一致，则将其删除；若查询不到则结束本次删除过程。图9为本发明数据修改流程图，区块链交互子系统的链上数据管理模块接收到待修改的数据之后，首先会在区块链上查询待修改的数据所属的表是否已经存在。当表名存在时，继续确认字段名与字段数量是否一致；当数量一致时，继续确认接收到的字段名中是否包含主键名；当包含主键名时，继续确认字段名是否均与建表时的字段名一致。当字段名一致时，开始查找该数据，若查询到该数据，则判断数据修改者的地址是否与数据新增时数据操作信息字段中记录的用户地址一致，若不一致则不予修改，若一致，则根据接收的字段值内容进行修改，其它未接收到的字段内容保持不变，修改时，链上数据管理模块会自动记录当前时间、修改数据的用户地址、当前数据存证的Hash值、该数据上次记录的Hash值，并将四条信息添加分隔符，拼接为一个字段值写入数据操作信息字段。若查询不到则结束本次修改过程。图10为本发明数据查询流程图，区块链交互子系统的链上数据管理模块接收到待查询的数据之后，首先会区分是根据Hash值查询还是根据主键查询。当根据Hash值查询时，直接将Hash值提交给区块链，并返回查询的结果。当根据主键查询时，首先会确认待查询的表名是否存在，当表名存在时，继续确认接收到的主键名是否与建表时的主键名一致。当主键名符合无误时，开始查找并返回查找结果。再查询时，可以获取到数据的完整内容，此时用户可以根据数据操作字段内的上次变动时产生的Hash值，继续通过Hash查询方式实现链式查询，可以追溯到该条数据以往的所有变动时的数据。图11为本发明智能合约架构图，包括数据操作层、功能实现层、对外交互层。其中数据操作层包含的是由区块链自身提供的，直接对链上数据进行增删改查的基础合约。功能实现层包括功能扩展合约与工具库合约，功能扩展合约是对数据操作层的合约进行功能扩展，以实现对区块链表和对区块链数据的模块化区分管理；工具库合约负责提供功能扩展合约中多次复用的功能代码，减少合约代码重复性，提高执行效率。对外交互层则仅有一个智能合约，用于调用功能实现层的合约，对外提供区块链链上表管理模块和区块链链上数据管理模块的所有功能。通过该分层智能合约架构的设计，后续可以不再新增或改动智能合约，只需调用其链上建表功能，在区块链上建表，即可实现存储多种形式的数据，提高了系统使用便捷性。由于分层设计，也降低了合约之间的耦合度，利于后续合约的功能扩展，提高了系统的可扩展性。以上实施例仅为本发明的示例性实施例，不用于限制本发明，本发明的保护范围由权利要求书限定。本领域技术人员可以在本发明的实质和保护范围内，对本发明做出各种修改或等同替换，这种修改或等同替换也应视为落在本发明的保护范围内。
