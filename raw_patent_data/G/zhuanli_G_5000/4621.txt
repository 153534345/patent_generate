标题title
一种基于分布式数据库的物理备份方法
摘要abst
本发明提供了一种基于分布式数据库的物理备份方法，包括：获取用户的预备份计划；根据用户码和读写码判断用户行为是否正常；若正常，判断预备份计划是否异常，根据判断结果，修正预备份计划，得到备份计划；确定与备份计划对应的分布式数据库历史快照和创建与备份计划对应备份进程；根据备份进程对分布式数据库历史快照进行扫描，得到备份信息；根据备份信息和备份计划完成备份。
权利要求书clms
1.一种基于分布式数据库的物理备份方法，其特征在于，包括：获取用户的预备份计划；根据用户码和读写码判断用户行为是否正常；若正常，判断预备份计划是否异常，根据判断结果，修正预备份计划，得到备份计划；确定与备份计划对应的分布式数据库历史快照和创建与备份计划对应备份进程；根据备份进程对分布式数据库历史快照进行扫描，得到备份信息；根据备份信息和备份计划完成备份。2.根据权利要求1所述的一种基于分布式数据库的物理备份方法，其特征在于，获取用户的预备份计划，包括：获取用户指定的待被备份的文件信息和第一路径信息，以及获取用户指定的待被备份的文件信息被备份的第二路径信息；根据文件信息、第一路径信息和第二路径信息，生成对应的SQL语句；整理SQL语句生成对应的SQL语法树；根据对应的SQL语法树生成用户的初步备份计划；分别采集获取文件信息、第一路径信息和第二路径信息的获取时间，根据所有获取时间生成用户码；根据用户码对初步备份计划进行标记，生成预备份计划。3.根据权利要求1所述的一种基于分布式数据库的物理备份方法，其特征在于，根据用户码和读写码判断用户行为是否正常，生成判断结果，包括：当接收到用户发送的预备份计划时，判断预备份计划中是否携带有用户码，若没有携带，判定用户行为不正常，生成判断结果；若携带有用户码，获取预备份计划中SQL语法树对应的SQL语句；根据SQL语句确定文件信息、第一路径信息和第二路径信息；根据文件信息、第一路径信息和第二路径信息确定对应存储单元；根据对应存储单元查找读写日志中是否存在与文件信息、第一路径信息和第二路径信息相关的读写记录；若不存在，判定用户行为不正常，生成判断结果；若存在，获取相关的读写记录的读写时间生成读写码，并判断用户码和读写码是否匹配，若不匹配，判定用户行为不正常，生成判断结果。4.根据权利要求3所述的一种基于分布式数据库的物理备份方法，其特征在于，还包括：若判断结果为不正常，根据不正常的预备份计划对应的文件信息、第一路径信息和第二路径信息，生成隔离虚拟机；确定与不正常的预备份计划对应的分布式数据库历史快照和创建与不正常的预备份计划对应第二备份进程；根据第二备份进程对与不正常的预备份计划对应的分布式数据库历史快照进行扫描，得到不正常备份信息；通过隔离虚拟机，完成不正常备份信息和不正常的预备份计划的备份操作；同时，反馈给预备份计划指令发出方备份完成信息，以及，发出提醒弹窗对用户进行提醒。5.根据权利要求1所述的一种基于分布式数据库的物理备份方法，其特征在于，判断预备份计划是否异常，生成判断结果，包括：获取预备份计划中对应的文件信息和第二路径信息；根据第二路径信息获取对应存储单元的存储能力信息；根据文件信息确定待被备份文件的存储量信息；判断存储能力信息与存储量信息是否匹配，生成匹配结果；若无法获取对应存储单元的存储能力信息，或，匹配结果为不匹配，判定预备份计划异常，否则预备份计划正常，生成判断结果。6.根据权利要求1所述的一种基于分布式数据库的物理备份方法，其特征在于，根据判断结果，修正预备份计划，得到备份计划，包括：若判断结果为预备份计划正常，将预备份计划作为备份计划；若判断结果为预备份计划异常，获取存储单元读写日志，根据预备份计划中文件信息的对应的存储量信息在存储单元读写日志查找存储能力信息与对应的存储量信息匹配的第二存储单元；根据第二存储单元的第二路径信息替换预备份计划中原有的第二路径信息，生成备份计划。7.根据权利要求6所述的一种基于分布式数据库的物理备份方法，其特征在于，还包括：若备份计划与预备份计划不一致时，反馈备份计划的第二路径信息至用户。8.根据权利要求1所述的一种基于分布式数据库的物理备份方法，其特征在于，确定与备份计划对应的分布式数据库历史快照，包括：根据用户的备份计划中指定的待备份的文件信息，创建并存储与备份计划对应的分布式数据库历史快照。9.根据权利要求1所述的一种基于分布式数据库的物理备份方法，其特征在于，根据备份进程对分布式数据库历史快照进行扫描，得到备份信息，包括：根据备份进程扫描分布式数据库历史快照的元数据，得到备份文件的描述信息；根据描述信息生成内存镜像文件；根据备份进程扫描分布式数据库历史快照的除元数据外的其他数据部分，得到备份文件的数据信息；根据数据信息、开始键和结束键生成SST扩展文件；根据内存镜像文件和SST扩展文件确定备份信息。10.根据权利要求1所述的一种基于分布式数据库的物理备份方法，其特征在于，还包括：根据备份信息和备份计划完成备份后删除相应的分布式数据库历史快照。
说明书desc
技术领域本发明涉及数据库备份技术领域，尤其涉及一种基于分布式数据库的物理备份方法。背景技术分布式数据库的物理备份是指通过物理文件拷贝的方式对数据库进行备份，其中物理文件包括数据库的物理数据文件，日志文件及配置文件等组成，现有的分布式数据库物理备份方法仅考虑了根据用户指令进行物理备份，以及对备份文件进行病毒查杀防止备份病毒，但并未涉及防止恶意程序对正常文件通过无限重复备份挤压内存、隐藏备份后恢复备份破坏现有文件内容等方式的入侵，为了防止恶意程序通过模拟用户操作进行恶意备份的行为，亟需一种基于分布式数据库的物理备份方法，用于解决恶意程序通过模拟用户操作进行恶意备份的行为的问题。发明内容针对现有技术的不足，本发明提供一种基于分布式数据库的物理备份方法，用于解决恶意程序通过模拟用户操作进行恶意备份的行为的问题。一种基于分布式数据库的物理备份方法，包括：获取用户的预备份计划；根据用户码和读写码判断用户行为是否正常；若正常，判断预备份计划是否异常，根据判断结果，修正预备份计划，得到备份计划；确定与备份计划对应的分布式数据库历史快照和创建与备份计划对应备份进程；根据备份进程对分布式数据库历史快照进行扫描，得到备份信息；根据备份信息和备份计划完成备份。作为本发明的一种实施例，获取用户的预备份计划，包括：获取用户指定的待被备份的文件信息和第一路径信息，以及获取用户指定的待被备份的文件信息被备份的第二路径信息；根据文件信息、第一路径信息和第二路径信息，生成对应的SQL语句；整理SQL语句生成对应的SQL语法树；根据对应的SQL语法树生成用户的初步备份计划；分别采集获取文件信息、第一路径信息和第二路径信息的获取时间，根据所有获取时间生成用户码；根据用户码对初步备份计划进行标记，生成预备份计划。作为本发明的一种实施例，根据用户码和读写码判断用户行为是否正常，生成判断结果，包括：当接收到用户发送的预备份计划时，判断预备份计划中是否携带有用户码，若没有携带，判定用户行为不正常，生成判断结果；若携带有用户码，获取预备份计划中SQL语法树对应的SQL语句；根据SQL语句确定文件信息、第一路径信息和第二路径信息；根据文件信息、第一路径信息和第二路径信息确定对应存储单元；根据对应存储单元查找读写日志中是否存在与文件信息、第一路径信息和第二路径信息相关的读写记录；若不存在，判定用户行为不正常，生成判断结果；若存在，获取相关的读写记录的读写时间生成读写码，并判断用户码和读写码是否匹配，若不匹配，判定用户行为不正常，生成判断结果。作为本发明的一种实施例，一种基于分布式数据库的物理备份方法还包括：若判断结果为不正常，根据不正常的预备份计划对应的文件信息、第一路径信息和第二路径信息，生成隔离虚拟机；确定与不正常的预备份计划对应的分布式数据库历史快照和创建与不正常的预备份计划对应第二备份进程；根据第二备份进程对与不正常的预备份计划对应的分布式数据库历史快照进行扫描，得到不正常备份信息；通过隔离虚拟机，完成不正常备份信息和不正常的预备份计划的备份操作；同时，反馈给预备份计划指令发出方备份完成信息，以及，发出提醒弹窗对用户进行提醒。作为本发明的一种实施例，判断预备份计划是否异常，生成判断结果，包括：获取预备份计划中对应的文件信息和第二路径信息；根据第二路径信息获取对应存储单元的存储能力信息；根据文件信息确定待被备份文件的存储量信息；判断存储能力信息与存储量信息是否匹配，生成匹配结果；若无法获取对应存储单元的存储能力信息，或，匹配结果为不匹配，判定预备份计划异常，否则预备份计划正常，生成判断结果。作为本发明的一种实施例，根据判断结果，修正预备份计划，得到备份计划，包括：若判断结果为预备份计划正常，将预备份计划作为备份计划；若判断结果为预备份计划异常，获取存储单元读写日志，根据预备份计划中文件信息的对应的存储量信息在存储单元读写日志查找存储能力信息与对应的存储量信息匹配的第二存储单元；根据第二存储单元的第二路径信息替换预备份计划中原有的第二路径信息，生成备份计划。作为本发明的一种实施例，一种基于分布式数据库的物理备份方法还包括：若备份计划与预备份计划不一致时，反馈备份计划的第二路径信息至用户。作为本发明的一种实施例，确定与备份计划对应的分布式数据库历史快照，包括：根据用户的备份计划中指定的待备份的文件信息，创建并存储与备份计划对应的分布式数据库历史快照。作为本发明的一种实施例，根据备份进程对分布式数据库历史快照进行扫描，得到备份信息，包括：根据备份进程扫描分布式数据库历史快照的元数据，得到备份文件的描述信息；根据描述信息生成内存镜像文件；根据备份进程扫描分布式数据库历史快照的除元数据外的其他数据部分，得到备份文件的数据信息；根据数据信息、开始键和结束键生成SST扩展文件；根据内存镜像文件和SST扩展文件确定备份信息。作为本发明的一种实施例，一种基于分布式数据库的物理备份方法还包括：根据备份信息和备份计划完成备份后删除相应的分布式数据库历史快照。本发明的有益效果为：本发明提供一种基于分布式数据库的物理备份方法，用于解决恶意程序通过模拟用户操作进行恶意备份的行为的问题。本发明的其它特征和优点将在随后的说明书中阐述，并且，部分地从说明书中变得显而易见，或者通过实施本发明而了解。本发明的目的和其他优点可通过在所写的说明书以及附图中所特别指出的结构来实现和获得。下面通过附图和实施例，对本发明的技术方案做进一步的详细描述。附图说明附图用来提供对本发明的进一步理解，并且构成说明书的一部分，与本发明的实施例一起用于解释本发明，并不构成对本发明的限制。在附图中：图1为本发明实施例中一种基于分布式数据库的物理备份方法的方法流程图；图2为本发明实施例中一种基于分布式数据库的物理备份方法中S101的具体流程图；图3为本发明实施例中一种基于分布式数据库的物理备份方法中S102的具体流程图；图4为本发明实施例中一种基于分布式数据库的物理备份方法中S102为不正常时的备份方法流程图。具体实施方式以下结合附图对本发明的优选实施例进行说明，应当理解，此处所描述的优选实施例仅用于说明和解释本发明，并不用于限定本发明。请参阅图1，本发明实施例提供了一种基于分布式数据库的物理备份方法，包括：S101、获取用户的预备份计划；S102、根据用户码和读写码判断用户行为是否正常，若正常转至S103；S103、判断预备份计划是否异常，得到判断结果；S104、根据判断结果，修正预备份计划，得到备份计划；S105、确定与备份计划对应的分布式数据库历史快照和创建与备份计划对应备份进程；S106、根据备份进程对分布式数据库历史快照进行扫描，得到备份信息；S107、根据备份信息和备份计划完成备份；上述技术方案的工作原理为：开始备份前，获取用户发出的指令信息生成用户的预备份计划，其中，指令信息通常由SQL语句的形式呈现；当备份系统接收到用户的预备份计划后，为防止存在恶意程序模拟用户行为，对用户行为进行检测，检测方式为通过用户码和读写码判断用户行为是否正常，当判断结果为正常时，为防止用户在人工判断阶段存在误差，导致后续备份无法完成，从而浪费中途备份过程损耗的情况发生，对用户的预备份计划进行异常校验，异常校验过程为对待备份文件的存储信息与指定备份区域的存储信息进行比较，判断后者的存储信息是否能满足前者的存储信息，得到判断结果，再根据判断结果，对应修正预备份计划，从而得到正式的备份计划，得到备份计划后，确定与备份计划对应的分布式数据库历史快照和创建与备份计划对应备份进程，再根据备份进程对分布式数据库历史快照进行扫描，得到备份信息，即通过备份进程根据备份信息和备份计划完成备份；上述技术方案的有益效果为：有益于防止恶意程序对正常文件通过无限重复备份挤压内存、隐藏备份后恢复备份破坏现有文件内容等方式的入侵行为。请参阅图2，在一个实施例中，获取用户的预备份计划，包括：S1011、获取用户指定的待被备份的文件信息和第一路径信息，以及获取用户指定的待被备份的文件信息被备份的第二路径信息；S1012、根据文件信息、第一路径信息和第二路径信息，生成对应的SQL语句；S1013、整理SQL语句生成对应的SQL语法树；S1014、根据对应的SQL语法树生成用户的初步备份计划；S1015、分别采集获取文件信息、第一路径信息和第二路径信息的获取时间，根据所有获取时间生成用户码；S1016、根据用户码对初步备份计划进行标记，生成预备份计划；上述技术方案的工作原理为：获取用户指定的待被备份的文件信息和第一路径信息，以及获取用户指定的待被备份的文件信息被备份的第二路径信息，然后根据文件信息、第一路径信息和第二路径信息，生成对应的SQL语句，也可直接获取用户输入的用于备份的SQL语句；然后通过解析器对SQL语句进行词法解析、句法解析和语义解析，从而生成对应的SQL语法树，然后通过优化器由对应的SQL语法树生成备份的逻辑计划，再通过逻辑计划生成用于物理备份的用户的初步备份计划，生成初步备份计划后，分别采集获取文件信息、第一路径信息和第二路径信息的三个获取时间，根据所有获取时间生成用户码，最后根据用户码对初步备份计划进行标记，生成预备份计划；上述技术方案的有益效果为：仅需要用户指定待被备份的文件信息和第一路径信息，以及指定的待被备份的文件信息被备份的第二路径信息，便可自动生成初步备份计划，有益于提高用户使用体验和降低备份门槛，并且通过生成用户码对初步备份计划进行标记，生成预备份计划，用于后续对用户行为进行判断，有益于提高备份的可靠性。请参阅图3，在一个实施例中，根据用户码和读写码判断用户行为是否正常，生成判断结果，包括：S1021、当接收到用户发送的预备份计划时，判断预备份计划中是否携带有用户码，若没有携带，转至S1027，若携带有用户码，顺序执行下列步骤；S1022、获取预备份计划中SQL语法树对应的SQL语句；根据SQL语句确定文件信息、第一路径信息和第二路径信息；S1023、根据文件信息、第一路径信息和第二路径信息确定对应存储单元；S1024、根据对应存储单元查找读写日志中是否存在与文件信息、第一路径信息和第二路径信息相关的读写记录；若不存在，转至S1027，若存在，顺序执行下列步骤；S1025、获取相关的读写记录的读写时间生成读写码，并判断用户码和读写码是否匹配，若不匹配，转至S1027，若匹配，顺序执行下列步骤；S1026、判断结果为用户行为正常；S1027、判定用户行为不正常，生成判断结果；上述技术方案的工作原理为：通常情况下，恶意程序为隐藏自身的恶意操作，会对日志记录进行修改，以便隐藏自身的恶意行为，因此，当恶意程序模拟用户进行备份操作时，若恶意程序对日志记录修改的速度大于预备份计划生成的顺序执行速度，则会导致恶意程序模拟的预备份计划无法在日志记录中获取对应的获取时间进行用户码的生成，那么当接收到用户发送的预备份计划时，判断预备份计划中是否携带有用户码，若没有携带，则可以判定当前的备份行为属于异常行为，从而防止备份系统对此次备份计划进备份操作；若恶意程序对日志记录修改的速度不大于预备份计划生成的顺序执行速度，则恶意程序模拟的预备份计划能在恶意程序对日志记录进行修改前完成用户码的生成，此时，第一道关卡失效，进入第二道判断进程，首先获取预备份计划中SQL语法树对应的SQL语句；根据SQL语句确定文件信息、第一路径信息和第二路径信息；根据文件信息、第一路径信息和第二路径信息确定对应存储单元；根据对应存储单元查找读写日志中是否存在与文件信息、第一路径信息和第二路径信息相关的读写记录，当第一道关卡失效后，由于恶意程序为隐藏自身的恶意操作，会对日志记录进行修改，若此前第一道关卡失效的原因是恶意程序对日志记录修改的速度不大于预备份计划生成的顺序执行速度时，第二道关卡的二次检验就能够对恶意程序进行有效防护；若恶意程序对日志记录修改的速度不大于预备份计划生成的顺序执行速度，且第二道关卡失效是由于恶意程序的修改进度刚好卡在了对日志进行修改但并未修改完成时，进入第三道判断进程，获取相关的读写记录的读写时间生成读写码，并判断用户码和读写码是否匹配，由于用户码和读写码的生成方式相同，匹配优选为判断用户码和读写码是否相同，通过第三道判断进程，有效防止了因恶意程序对日志记录的修改速度过慢导致正常通过异常检测行为；上述技术方案的有益效果为：为防止存在恶意程序对正常文件通过无限重复备份挤压内存、隐藏备份后恢复备份破坏现有文件内容等方式的入侵行为，通过用户码和读写码对用户行为进行三重检测，提高备份的可靠性。请参阅图4，在一个实施例中，一种基于分布式数据库的物理备份方法还包括：S102、根据用户码和读写码判断用户行为是否正常，若判断结果为不正常，转至S102A；S102A、根据不正常的预备份计划对应的文件信息、第一路径信息和第二路径信息，生成隔离虚拟机；S102B、确定与不正常的预备份计划对应的分布式数据库历史快照和创建与不正常的预备份计划对应第二备份进程；S102C、根据第二备份进程对与不正常的预备份计划对应的分布式数据库历史快照进行扫描，得到不正常备份信息；S102D、通过隔离虚拟机，完成不正常备份信息和不正常的预备份计划的备份操作；S102E、反馈给预备份计划指令发出方备份完成信息，以及，发出提醒弹窗对用户进行提醒；上述技术方案的工作原理为：当判定用户行为异常时，即判定当前备份计划的发出者为恶意程序时，根据恶意程序发出的不正常的预备份计划对应的文件信息、第一路径信息和第二路径信息，生成用于隔离备份文件的虚拟机，同时根据正常备份流程对当前恶意程序的不正常的预备份计划进行备份操作，包括有确定与不正常的预备份计划对应的分布式数据库历史快照和创建与不正常的预备份计划对应第二备份进程，并根据第二备份进程对与不正常的预备份计划对应的分布式数据库历史快照进行扫描，得到不正常备份信息，最后通过隔离虚拟机，完成不正常备份信息和不正常的预备份计划的备份操作，即将备份内容转移至隔离虚拟机中，同时为防止恶意程序发现当前恶意进程被阻止，还需要反馈给预备份计划指令发出方备份完成信息，完成备份操作的过程中，发出提醒弹窗对用户进行提醒，也可包含语音提醒等提醒方式；上述技术方案的有益效果为：为防止恶意程序发现当前恶意进程被阻止时，进入潜伏状态或无差别攻击状态，通过建立虚拟机的方式在虚拟机中完成恶意程序的恶意备份操作，同时在备份过程中通过弹窗等方式提醒用户当前计算机设备存在风险，提高数据备份的可靠性。在一个实施例中，判断预备份计划是否异常，生成判断结果，包括：获取预备份计划中对应的文件信息和第二路径信息；根据第二路径信息获取对应存储单元的存储能力信息；根据文件信息确定待被备份文件的存储量信息；判断存储能力信息与存储量信息是否匹配，生成匹配结果；若无法获取对应存储单元的存储能力信息，或，匹配结果为不匹配，判定预备份计划异常，否则预备份计划正常，生成判断结果；匹配方法优选通过下述计算公式确定：其中，P为匹配值，MB为存储能力信息，MF为存储量信息，若匹配值P大于等于1，则匹配结果为匹配，否则为不匹配；其中，存储能力信息即当前存储单元的剩余存储容量信息；存储量信息即当前待被备份文件的文件大小；上述技术方案的有益效果为：通过上述方案，及时判断用户的预备份计划是否合理，有益于减少备份出错的可能性，提高备份可靠性。在一个实施例中，根据判断结果，修正预备份计划，得到备份计划，包括：若判断结果为预备份计划正常，将预备份计划作为备份计划；若判断结果为预备份计划异常，获取存储单元读写日志，根据预备份计划中文件信息的对应的存储量信息在存储单元读写日志查找存储能力信息与对应的存储量信息匹配的第二存储单元；即通过存储单元读写日志的分区记录和各种读取记录中查找到对应存储能力信息的存储量信息匹配的第二存储单元；根据第二存储单元的第二路径信息替换预备份计划中原有的第二路径信息，生成备份计划；上述技术方案的有益效果为：通过上述方案，降低用户使用数据库备份门槛，同时及时修正备份计划，有益于减少因异常备份计划造成的不必要损耗。在一个实施例中，一种基于分布式数据库的物理备份方法还包括：若备份计划与预备份计划不一致时，反馈备份计划的第二路径信息至用户；上述技术方案的有益效果为：通过上述方案，及时将实时备份计划反馈给用户，提高用户使用体验。在一个实施例中，确定与备份计划对应的分布式数据库历史快照，包括：根据用户的备份计划中指定的待备份的文件信息，创建并存储与备份计划对应的分布式数据库历史快照；上述技术方案的有益效果为：通过上述方案，获取备份的只读视图。在一个实施例中，根据备份进程对分布式数据库历史快照进行扫描，得到备份信息，包括：根据备份进程扫描分布式数据库历史快照的元数据，得到备份文件的描述信息；根据描述信息生成内存镜像文件；根据备份进程扫描分布式数据库历史快照的除元数据外的其他数据部分，得到备份文件的数据信息；根据数据信息、开始键和结束键生成SST扩展文件；根据内存镜像文件和SST扩展文件确定备份信息；上述技术方案的有益效果为：通过上述方案完成对分布式数据库历史快照中的信息获取。在一个实施例中，一种基于分布式数据库的物理备份方法还包括：根据备份信息和备份计划完成备份后删除相应的分布式数据库历史快照；上述技术方案的有益效果为：通过上述方案防止分布式数据库历史快照堆积。显然，本领域的技术人员可以对本发明进行各种改动和变型而不脱离本发明的精神和范围。这样，倘若本发明的这些修改和变型属于本发明权利要求及其等同技术的范围之内，则本发明也意图包含这些改动和变型在内。
