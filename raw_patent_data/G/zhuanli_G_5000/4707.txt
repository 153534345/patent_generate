标题title
一种LED灯芯缺陷检测方法
摘要abst
本发明涉及图像处理技术领域，具体涉及一种LED灯芯缺陷检测方法，该方法通过采集有多个LED灯的LED灯芯图像，对获取的LED灯芯图像基于灰度值进行聚类，获取LED灯芯图像中的高亮区域；根据高亮区域确定单个LED灯芯的子区域；获取每个子区域对应的初始分割阈值，根据初始分割阈值获得初始二值图像，基于初始二值图像获取边缘像素点的梯度值和LED灯芯的分割面积，构建调整目标函数；基于调整目标函数，利用模拟退火算法获取每个子区域的最终分割阈值；通过最终分割阈值，得到最终二值图像；将最终二值图像与标准二值图像进行模板图像匹配，以完成LED灯芯的缺陷检测。本发明通过局部阈值分割提高了缺陷检测的精度。
权利要求书clms
1.一种LED灯芯缺陷检测方法，其特征在于，该方法包括以下步骤：采集至少存在两个LED灯的LED灯芯图像，获取所述LED灯芯图像对应的灰度图像，基于每个像素点的灰度值对所述灰度图像进行聚类，得到至少两个类别，根据每个类别对应的灰度值的平均值获取高亮区域，根据高亮区域确定单个LED灯芯的子区域；分别获取每个子区域的初始分割阈值，基于初始分割阈值获取每个子区域对应的初始二值图像，初始二值图像中背景对应的像素点的灰度值为0，LED灯芯对应的像素点的灰度值为1，根据初始二值图像中灰度值为1的像素点的数量得到LED灯芯的分割面积；对当前子区域的初始二值图像进行边缘检测得到当前子区域的边缘像素点，根据每个边缘像素点周围其他像素点的灰度值获取对应边缘像素点的梯度值，根据所述梯度值获取每个所述边缘像素点的不良分割率，将每个边缘像素点的所述不良分割率进行相加得到当前子区域的整体不良分割率；结合所述整体不良分割率和当前子区域的LED灯芯的分割面积构建当前子区域的初始分割阈值的调整目标函数；基于调整目标函数，利用模拟退火算法获取当前子区域的最终分割阈值；根据最终分割阈值对相对应的子区域进行分割，得到最终二值图像，将所述最终二值图像与标准二值图像进行模板图像匹配，得到匹配度，基于匹配度完成LED灯芯的缺陷检测。2.如权利要求1所述的一种LED灯芯缺陷检测方法，其特征在于，所述单个LED灯芯的子区域的获取方法，包括：获取灰度值的平均值最大所对应的类别作为高亮区域对应的目标类别，基于目标类别对所述LED灯芯图像进行二值化，对二值化后的所述LED灯芯图像利用形态学得到所述高亮区域，对高亮区域进行连通域分析以得到每个连通域的质心，获取任意两个所述质心的距离值，当距离值与标准距离值相等时，确认对应的这两个连通域属于同一个LED灯芯的，进而根据这两个连通域得到对应单个LED灯芯的子区域；其中标准距离值是指标准模板中的单个LED灯芯的两个高亮区域之间的距离值。3.如权利要求1所述的一种LED灯芯缺陷检测方法，其特征在于，所述根据每个边缘像素点周围其他像素点的灰度值获取对应边缘像素点的梯度值的方法，包括：对当前子区域的初始二值图像进行边缘检测得到当前子区域的边缘像素点，以每个边缘像素点为中心获取设定尺寸的窗口区域，窗口区域中的最大灰度值与最小灰度值的差值作为边缘像素点的梯度值。4.如权利要求1所述的一种LED灯芯缺陷检测方法，其特征在于，所述根据所述梯度值获取每个所述边缘像素点的不良分割率的方法，包括：根据当前子区域中每个边缘像素点的梯度值得到当前子区域的平均梯度值，获取第i个边缘像素点的梯度值与第i个边缘像素点所在的子区域的平均梯度值的差值的绝对值，获取第i个边缘像素点的梯度值的相反数代入以常数e为底数的指数函数所对应的值，将所述差值的绝对值与所述指数函数所对应的值相乘，所得到的结果作为第i个边缘像素点的不良分割率。5.如权利要求1所述的一种LED灯芯缺陷检测方法，其特征在于，所述结合所述整体不良分割率和当前子区域的LED灯芯的分割面积构建当前子区域的初始分割阈值的调整目标函数的方法，包括：所述调整目标函数的计算公式为：其中，t为当前解所对应的分割阈值；为当前解所对应的分割阈值下当前子区域的整体不良分割率；M为当前子区域的初始分割阈值下对应的LED灯芯的分割面积；为当前解所对应的分割阈值下当前子区域的LED灯芯的分割面积；为绝对值函数。6.如权利要求1所述的LED灯芯缺陷检测方法，其特征在于，所述基于匹配度完成LED灯芯的缺陷检测的方法，包括：设置匹配度值阈值，当匹配度低于匹配度值阈值时，确认LED灯芯图像对应的LED灯有缺陷。
说明书desc
技术领域本发明涉及图像处理技术领域，具体涉及一种LED灯芯缺陷检测方法。背景技术LED灯芯具有节能、长寿命、免维护、易控制、环保等优点，可以应用照明、装饰街道、标志性建筑物和指示灯等多个场合。LED灯芯缺陷检测一直是灯芯生产过程中必不可少的一环，要对LED灯芯进行光电性能、外观等检查，剔除有缺陷的瑕疵品。目前LED灯芯缺陷检测是通过计算机视觉算法进行的，即对采集的一张LED灯芯图像用传统的阈值分割方法进行缺陷分割，但是一张LED灯芯图像上有多个灯芯，不同的灯芯，缺陷程度不同，而传统的阈值分割方法中只有一个分割阈值，采用同一个分割阈值进行缺陷检测时，会导致部分灯芯出现缺陷扩大、缺陷不明显等情况，从而无法对LED灯芯缺陷做到准确的检测。发明内容为了解决上述技术问题，本发明的目的在于提供一种LED灯芯缺陷检测方法，所采用的技术方案具体如下：本发明实施例中提供了一种LED灯芯缺陷检测方法，该方法包括以下步骤：采集至少存在两个LED灯的LED灯芯图像，获取所述LED灯芯图像对应的灰度图像，基于每个像素点的灰度值对所述灰度图像进行聚类，得到至少两个类别，根据每个类别对应的灰度值的平均值获取高亮区域，根据高亮区域确定单个LED灯芯的子区域；分别获取每个子区域的初始分割阈值，基于初始分割阈值获取每个子区域对应的初始二值图像，初始二值图像中背景对应的像素点的灰度值为0，LED灯芯对应的像素点的灰度值为1，根据初始二值图像中灰度值为1的像素点的数量得到LED灯芯的分割面积；对当前子区域的初始二值图像进行边缘检测得到当前子区域的边缘像素点，根据每个边缘像素点周围其他像素点的灰度值获取对应边缘像素点的梯度值，根据所述梯度值获取每个所述边缘像素点的不良分割率，将每个边缘像素点的所述不良分割率进行相加得到当前子区域的整体不良分割率；结合所述整体不良分割率和当前子区域的LED灯芯的分割面积构建当前子区域的初始分割阈值的调整目标函数；基于调整目标函数，利用模拟退火算法获取当前子区域的最终分割阈值；根据最终分割阈值对相对应的子区域进行分割，得到最终二值图像，将所述最终二值图像与标准二值图像进行模板图像匹配，得到匹配度，基于匹配度完成LED灯芯的缺陷检测。进一步的，所述单个LED灯芯的子区域的获取方法，包括：获取灰度值的平均值最大所对应的类别作为高亮区域对应的目标类别，基于目标类别对所述LED灯芯图像进行二值化，对二值化后的所述LED灯芯图像利用形态学得到所述高亮区域，对高亮区域进行连通域分析以得到每个连通域的质心，获取任意两个所述质心的距离值，当距离值与标准距离值相等时，确认对应的这两个连通域属于同一个LED灯芯的，进而根据这两个连通域得到对应单个LED灯芯的子区域；其中标准距离值是指标准模板中的单个LED灯芯的两个高亮区域之间的距离值。进一步的，所述根据每个边缘像素点周围其他像素点的灰度值获取对应边缘像素点的梯度值的方法，包括：对当前子区域的初始二值图像进行边缘检测得到当前子区域的边缘像素点，以每个边缘像素点为中心获取设定尺寸的窗口区域，窗口区域中的最大灰度值与最小灰度值的差值作为边缘像素点的梯度值。进一步的，所述根据所述梯度值获取每个所述边缘像素点的不良分割率的方法，包括：根据当前子区域中每个边缘像素点的梯度值得到当前子区域的平均梯度值，获取第i个边缘像素点的梯度值与第i个边缘像素点所在的子区域的平均梯度值的差值的绝对值，获取第i个边缘像素点的梯度值的相反数代入以常数e为底数的指数函数所对应的值，将所述差值的绝对值与所述指数函数所对应的值相乘，所得到的结果作为第i个边缘像素点的不良分割率。进一步的，所述结合所述整体不良分割率和当前子区域的LED灯芯的分割面积构建当前子区域的初始分割阈值的调整目标函数的方法，包括：所述调整目标函数的计算公式为：其中，t为当前解所对应的分割阈值；为当前解所对应的分割阈值下当前子区域的整体不良分割率；M为当前子区域的初始分割阈值下对应的LED灯芯的分割面积；为当前解所对应的分割阈值下当前子区域的LED灯芯的分割面积；为绝对值函数。进一步的，所述基于匹配度完成LED灯芯的缺陷检测的方法，包括：设置匹配度值阈值，当匹配度低于匹配度值阈值时，确认LED灯芯图像对应的LED灯有缺陷。本发明具有如下有益效果：本发明采集多个LED灯对应的LED灯芯图像，基于LED灯芯产生的高亮特点，对LED灯芯图像中的像素点进行聚类得到高亮区域，基于单个LED灯对应的两个高亮区域之间的标准距离，对高亮区域分析确定LED灯芯图像中单个LED灯芯的子区域，使得单个LED灯芯对应子区域的划分更加准确；基于每个子区域的初始分割阈值构建分割阈值的调整目标函数，利用调整目标函数自适应获取每个子区域的最终分割阈值，也即是每个子区域的最优分割阈值；根据最终分割阈值对LED灯芯图像中相对应的子区域进行分割，得到最终二值图像，提高了阈值分割的效果，使得通过最终二值图像与标准二值图像进行模板图像匹配来确认的缺陷检测效果更好，提高了缺陷检测结果的精度。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案和优点，下面将对实施例或现有技术描述中所需要使用的附图作简单的介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其它附图。图1为本发明一个实施例所提供的一种LED灯芯缺陷检测方法的步骤流程图；图2为本发明一个实施例所提供的基于目标类别对灰度图像进行二值化的结果示意图；图3为本发明一个实施例所提供的利用形态学对二值化后的灰度图像预处理的结果示意图。具体实施方式为了更进一步阐述本发明为达成预定发明目的所采取的技术手段及功效，以下结合附图及较佳实施例，对依据本发明提出的一种LED灯芯缺陷检测方法，其具体实施方式、结构、特征及其功效，详细说明如下。在下述说明中，不同的“一个实施例”或“另一个实施例”指的不一定是同一实施例。此外，一或多个实施例中的特定特征、结构或特点可由任何合适形式组合。除非另有定义，本文所使用的所有的技术和科学术语与属于本发明的技术领域的技术人员通常理解的含义相同。下面结合附图具体的说明本发明所提供的一种LED灯芯缺陷检测方法的具体方案。请参阅图1，其示出了本发明一个实施例提供的一种LED灯芯缺陷检测方法的步骤流程图，该方法包括以下步骤：步骤S1，采集至少存在两个LED灯的LED灯芯图像，获取所述LED灯芯图像对应的灰度图像，基于每个像素点的灰度值对所述灰度图像进行聚类，得到至少两个类别，根据每个类别对应的灰度值的平均值获取高亮区域，根据高亮区域确定单个LED灯芯的子区域。具体的，通过LED灯芯检测设备采集存在多个LED灯的LED灯芯图像。采集LED灯芯图像后，常规方法可以通过大津阈值分割方法，得到分割后的灯芯部分用于LED灯芯缺陷检测，但是大津阈值就是一个阈值，会导致分割效果对于所有灯芯而言并不一定都好，如阈值过大情况下，虽然分割效果明显但是会出现过分割现象，因此需要对LED灯芯图像的局部灰度阈值进行局部调整，以得到更优的图像分割结果。获取局部灰度阈值的前提是先对LED灯芯图像进行区域划分，以得到单个LED灯芯的子区域，其具体划分过程为：对LED灯芯图像进行灰度化处理得到对应的灰度图像，根据灰度图像中每个像素点的灰度值对所有像素点进行聚类，本方案中通过k-mean算法进行聚类，且k=10，进而将灰度图像中的所有像素点分为了10个类别，选取这10个类别中灰度值的平均值最大的类别作为目标类别，目标类别对应的区域就是LED灯芯图像中的高亮区域。如图2所示，基于目标类别对灰度图像进行二值化，其中目标类别中的像素点的灰度值设为1，非目标类别对应的其它像素点的灰度值设为0；利用形态学对二值化后的灰度图像预处理，得到如图3所示的图像，然后为获取LED灯芯图像中更准确的高亮区域对应的连通域，通过连通域提取算法获取二值化后的灰度图像中的高亮区域的连通域，对每个连通域的质心进行提取，从而获取质心坐标，根据质心坐标得出任意两个连通域之间的距离，将计算得到的任意两个连通域之间的距离与标准LED灯芯的上下两个正负极对应的连通域之间的标准距离进行比较，若距离相等，则说明这两个连通域在同一个LED灯芯中，进而根据灰度图像中确认的属于同一个LED灯芯的两个连通域，对灰度图像进行划分得到单个LED灯芯对应的子区域。其中灰度化处理，k-mean算法以及连通域分析都是公知技术，本方案中不再赘述。需要说明的是，通过标准的LED灯芯图像大小，可以准确得到单个灯芯在拍摄图像上的图像区域大小，即单个LED灯芯的完整的子区域。步骤S2，分别获取每个子区域的初始分割阈值，基于初始分割阈值获取每个子区域对应的初始二值图像，初始二值图像中背景对应的像素点的灰度值为0，LED灯芯对应的像素点的灰度值为1，根据初始二值图像中灰度值为1的像素点的数量得到LED灯芯的分割面积；对当前子区域的初始二值图像进行边缘检测得到当前子区域的边缘像素点，根据每个边缘像素点周围其他像素点的灰度值获取对应边缘像素点的梯度值，根据所述梯度值获取每个所述边缘像素点的不良分割率，将每个边缘像素点的所述不良分割率进行相加得到当前子区域的整体不良分割率；结合所述整体不良分割率和当前子区域的LED灯芯的分割面积构建当前子区域的初始分割阈值的调整目标函数；基于调整目标函数，利用模拟退火算法获取当前子区域的最终分割阈值。具体的，由于LED灯芯的缺陷是由梯度差异得到的，如果是完整较好的灯芯，则在进行初始分割阈值分割时，分割后的灯芯边缘与灯芯的背景具有较为明显的差异信息，且分割后的灯芯边缘与灯芯的背景之间的差异信息较为统一，如果LED灯芯产生缺陷后，会使得LED灯芯的局部图像出现模糊，导致LED灯芯的局部图像梯度值较小，但是并不能说明梯度减小多少就一定是LED灯芯的缺陷，有可能是采集图像时的噪点造成的，而分割阈值在进行分割时，仅依据灰度分布的差异进行分割，并不能符合LED灯芯缺陷的分割要求，存在不能作为有缺陷的LED灯芯，仍会在分割后，出现灯芯缺陷，导致LED灯芯的缺陷扩大，造成能源的浪费，为避免这种情况，进行了如下做法：通过大津法获取每个子区域的初始分割阈值，利用初始分割阈值对相对应的子区域进行分割，得到分割后的每个子区域对应的初始二值图像，初始二值图像中背景对应的像素点的灰度值为0，LED灯芯对应的像素点的灰度值为1；对每个子区域对应的初始二值图像利用canny算子进行边缘检测，得到LED灯芯的边缘像素点，以每个边缘像素点为中心获取3*3窗口内最大灰度值与最小灰度值的差值，作为边缘像素点的梯度值，通过每个边缘像素点的梯度值可以获得每个子区域的平均梯度值。其中大津法以及canny算子是公知的技术，本方案不做过多的赘述。如果子区域的边缘像素点的梯度值较小，且与平均梯度值差异较大，则表示当前子区域的边缘像素点的分割效果很可能出现了不良分割，需要对初始分割阈值进行调整，则初始分割阈值的调整过程如下：以一个子区域为例，分别获得各边缘像素点的梯度值T与子区域对应的平均梯度值的差值Cz，利用差值得到子区域的第i个边缘像素点的不良分割率：其中，为第i个边缘像素点与平均梯度值之间的差值；为绝对值函数；为以常数e为底数的指数函数；为第i个边缘像素点的梯度值。需要说明的是，不良分割率表示子区域的第i个边缘像素点的不良分割程度，子区域的第i个边缘像素点的梯度值越小即越小，则表示灰度变化越不明显，分割效果越不良，不良分割率越大，所以对进行负相关映射，使得越小，越大；其中越小表示分割时的效果越统一，则可以认为当前分割效果优良；反之，则认为对LED灯芯的分割效果不良。的值越大，表示LED灯芯的第i个边缘像素点的不良分割可能性越大，所以在进行初始灰度阈值的调整时，其参考的必要性越大。对初始分割阈值的调整，是将子区域所对应的边缘像素点的不良分割率整体降至最低，进而可以获取子区域所对应的边缘像素点的整体不良分割率，即将子区域所对应的边缘像素点的不良分割率进行累加得到整体不良分割率，则整体不良分割率的计算公式如下：其中，n为边缘像素点的数量。随着分割阈值的不断调整变化，则会导致LED灯芯的分割结果不断变化，如果LED灯芯的分割结果变化过大，则可能会使LED灯芯部分受到干扰，导致分割结果不良，而且这种调整分割阈值的方式，效率很低，结果也不准确，所以基于整体不良分割率的基础上构建了调整目标函数，通过调整目标函数，求得最优分割阈值，也即子区域的最终分割阈值，构建调整目标函数的过程为：获取初始分割阈值下子区域的分割面积M，就是对应单个LED灯芯对应初始二值图像中像素点的灰度值为1的区域，结合子区域的整体不良分割率和分割面积构建子区域的初始分割阈值的调整目标函数，所述调整目标函数的计算公式为：其中，t为当前解所对应的分割阈值，为当前解所对应的分割阈值下当前子区域的整体不良分割率，为当前解所对应的分割阈值下当前子区域的LED灯芯的分割面积。整体不良分割率越小，说明边缘像素点的不良分割可能性越小；越小，说明LED灯芯的分割结果变化越小，越能避免因分割结果变化过大导致的分割不良；因此越小，所对应的解就越适合为最终分割阈值，所以找到的最小值所对应的t值就是最终分割阈值。本发明中，基于初始分割阈值的调整目标函数采用模拟退火算法来求最终分割阈值。在进行模拟退火时，初始解往往是随机解，但是本发明是将初始分割阈值作为初始解，由于获取最优分割阈值的目的是为了得到更好的分割效果，因此本发明优选设置初始温度T=100，衰减参数K=0.9，衰减参数也即是退火速率，停止迭代温度为0.01，进而使得初始分割阈值与最终分割阈值之间不会有太大的差值，能够减少迭代的次数，提高效率。通过设置好参数的模拟退火算法，自适应得到子区域的最终分割阈值，进而基于上述最终分割阈值的获取发法，根据每个子区域的初始分割阈值构建每个子区域对应的调整目标函数，基于调整目标函数利用模拟退火算法得到每个子区域的最终分割阈值。其中模拟退火算法是公知的技术，这里不再做过多的赘述。步骤S3，根据最终分割阈值对相对应的子区域进行分割，得到最终二值图像，将所述最终二值图像与标准二值图像进行模板图像匹配，得到匹配度，基于匹配度完成LED灯芯的缺陷检测。具体的，通过获取的最终分割阈值对LED灯芯图像中的相对应子区域进行分割，得到LED灯芯图像的最终分割结果，也即最终二值图像，对最终二值图像进行骨架化提取，将提取后的最终二值图像和标准二值图像进行模板图像匹配，得到匹配度，其中标准二值图像是不存在任何缺陷的LED灯芯图像的二值图像。设置匹配度阈值，当匹配度小于或等于匹配度阈值时，表示当前灯芯具有缺陷，当匹配度大于匹配度阈值时，表示当前灯芯合格。优选的，本发明实施例中匹配度阈值取经验值0.95，且匹配度阈值可根据具体实施场景进行调整。需要说明的是，先进行骨架化提取再进行图像模板匹配是因为可以在保留缺陷特征同时，减少LED灯芯分割结果的面积，使得在图像匹配结果中能够都较小缺陷的情况下也会拉开较为明显的匹配度。需要说明的是：上述本发明实施例先后顺序仅仅为了描述，不代表实施例的优劣。在附图中描绘的过程不一定要求示出的特定顺序或者连续顺序才能实现期望的结果。在某些实施方式中，多任务处理和并行处理也是可以的或者可能是有利的。本说明书中的各个实施例均采用递进的方式描述，各个实施例之间相同相似的部分互相参见即可，每个实施例重点说明的都是与其他实施例的不同之处。以上所述仅为本发明的较佳实施例，并不用以限制本发明，凡在本发明的原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
