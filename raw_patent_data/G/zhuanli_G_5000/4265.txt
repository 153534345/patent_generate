标题title
一种基于磁栅尺的位移测量方法及装置
摘要abst
本发明公开了一种基于磁栅尺的位移测量方法及装置，本发明可通过采集的两路正交正弦信号来准确确定出读头在磁极间经过的间隔数；同时，本发明在传统的角度位置的基础上，再结合读头在不同时刻时所经过的磁极个数，来进行位移的计算，基于此，即可避免传统磁栅尺在测量时因受到计算速度的限制，读头在高速运动时，其在磁极间运动所产生的正弦信号无法被全部采集得，从而导致无法准确得出读头在磁极间经过的间隔数的问题，由此，则可大幅提高位移测量的准确性和精度；另外，本发明所提供的装置可实现磁栅尺读头的国产化，从而避免传统技术需要使用国外专用的测量芯片才能实现磁栅尺位移测量的问题，由此，可减少位移测量成本。
权利要求书clms
1.一种基于磁栅尺的位移测量方法，其特征在于，包括：获取磁栅尺在进行位移测量时产生的两路正交正弦信号，并对两路正交正弦信号进行波形转换，以得到两正交方波信号；基于两正交方波信号，计算出磁栅尺上的读头在第一时刻时所经过的磁极个数，以及在第二时刻时所经过的磁极个数，以分别作为第一磁极个数以及第二磁极个数，其中，所述第二时刻处于所述第一时刻之后；获取第一角度位置以及第二角度位置，其中，所述第一角度位置是基于两路正交正弦信号在所述第一时刻时的幅值得到的，所述第二角度位置是基于两路正交正弦信号在所述第二时刻时的幅值得到的；基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，计算得到所述磁栅尺的位移测量结果。2.根据权利要求1所述的方法，其特征在于，基于两正交方波信号，计算出磁栅尺上的读头在第一时刻时所经过的磁极个数，包括：获取两正交方波信号中处于第一时刻前的信号波形，以得到两采样方波信号；以两采样方波信号中的一采样方波信号内的高电平和低电平作为计数标准，对两采样方波信号中的另一采样方波信号内的上升沿和下降沿进行计数处理，以在计数处理后，得到所述另一采样方波信号内上升沿和下降沿的计数次数；求和上升沿和下降沿的计数次数，以将求和结果作为所述磁栅尺上的读头在第一时刻时所经过的磁极个数。3.根据权利要求1所述的方法，其特征在于，基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，计算得到所述磁栅尺的位移测量结果，包括：判断所述第二磁极个数与所述第一磁极个数之间的差值是否等于0；若是，则判断所述第二角度位置是否大于所述第一角度位置；若是，则使用所述第二角度位置减去所述第一角度位置，得到所述磁栅尺的位移测量结果，否则，则使用所述第一角度位置减去所述第二角度位置，得到所述磁栅尺的位移测量结果。4.根据权利要求3所述的方法，其特征在于，若所述第二磁极个数与所述第一磁极个数之间的差值大于0，则所述方法还包括：判断所述第一角度位置是否大于预设阈值，且所述第二角度位置是否小于预设阈值；若是，则按照如下公式计算得到所述磁栅尺的位移测量结果，否则，则按照如下公式计算得到所述磁栅尺的位移测量结果；上述式和式中，pos表示所述磁栅尺的位移测量结果，Scale表示位移系数，CNT2表示第二磁极个数，CNT1表示第一磁极个数，AP2表示第二角度位置，AP1表示第一角度位置，表示取整运算。5.根据权利要求3所述的方法，其特征在于，若所述第二磁极个数与所述第一磁极个数之间的差值小于0，则所述方法还包括：判断所述第一角度位置是否小于预设阈值，且所述第二角度位置是否大于预设阈值；若是，则按照如下公式计算得到所述磁栅尺的位移测量结果，否则，则按照如下公式计算得到所述磁栅尺的位移测量结果；上述式中，pos表示所述磁栅尺的位移测量结果，Scale表示位移系数，CNT2表示第二磁极个数，CNT1表示第一磁极个数，AP2表示第二角度位置，AP1表示第一角度位置，表示取整运算。6.根据权利要求1所述的方法，其特征在于，在得到所述磁栅尺的位移测量结果后，所述方法还包括：基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，得到位移方向；根据所述位移方向以及所述位移测量结果，生成位移脉冲信号。7.一种基于磁栅尺的位移测量装置，其特征在于，包括：信号采集单元，用于获取磁栅尺在进行位移测量时产生的两路正交正弦信号；位移测量单元，用于对两路正交正弦信号进行波形转换，以得到两正交方波信号；位移测量单元，用于基于两正交方波信号，计算出磁栅尺上的读头在第一时刻时所经过的磁极个数，以及在第二时刻时所经过的磁极个数，以分别作为第一磁极个数以及第二磁极个数，其中，所述第二时刻处于所述第一时刻之后；位移测量单元，用于获取第一角度位置以及第二角度位置，其中，所述第一角度位置是基于两路正交正弦信号在所述第一时刻时的幅值得到的，所述第二角度位置是基于两路正交正弦信号在所述第二时刻时的幅值得到的；位移测量单元，还用于基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，计算得到所述磁栅尺的位移测量结果。8.根据权利要求7所述的装置，其特征在于，所述信号采集单元包括：第一运算放大电路以及第二运算放大电路，其中，所述第一运算放大电路和所述第二运算放大电路均包括LTC6087型运算放大器；对于所述第一运算放大电路，所述LTC6087型运算放大器的正相输入端和反相输入端分别通过一第一电阻电连接所述磁栅尺的第一路信号输出端，用于获取磁栅尺输出的一路正交正弦初始信号，所述LTC6087型运算放大器的输出端电连接所述位移测量单元，用于将所述一路正交正弦初始信号进行信号放大，得到一路正交正弦信号，并输出至所述位移测量单元；对于所述第二运算放大电路，所述LTC6087型运算放大器的正相输入端和反相输入端分别通过一第二电阻电连接所述磁栅尺的第二路信号输出端，用于获取磁栅尺输出的另一路正交正弦初始信号，所述LTC6087型运算放大器的输出端电连接所述位移测量单元，用于将所述另一路正交正弦初始信号进行信号放大，得到另一路正交正弦信号，并输出至所述位移测量单元。9.根据权利要求8所述的装置，其特征在于，所述位移测量单元采用CW32F030F8型处理芯片及其外围电路，其中，所述CW32F030F8型处理芯片电连接两LTC6087型运算放大器的输出端，用于对两路正交正弦信号进行波形转换，以得到两正交方波信号；所述CW32F030F8型处理芯片用于基于两正交方波信号，计算出磁栅尺上的读头在第一时刻时所经过的磁极个数，以及在第二时刻时所经过的磁极个数，以分别作为第一磁极个数以及第二磁极个数；所述CW32F030F8型处理芯片还用于获取所述第一角度位置以及所述第二角度位置，并基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，计算得到所述磁栅尺的位移测量结果。10.根据权利要求8所述的装置，其特征在于，所述CW32F030F8型处理芯片，还用于基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，得到位移方向，且所述装置还包括：电源单元以及差分输出单元；所述差分输出单元采用AM26C31型差分驱动芯片，其中，所述AM26C31型差分驱动芯片电连接所述CW32F030F8型处理芯片，用于根据CW32F030F8型处理芯片输出的位移测量结果和位移方向，生成位移脉冲信号；所述电源单元采用MPM3506A同步整流降压芯片，其中，所述MPM3506A同步整流降压芯片的输入端电连接供电电源，所述MPM3506A同步整流降压芯片的输出端分别电连接所述CW32F030F8型处理芯片的供电端、所述AM26C31型差分驱动芯片的供电端以及两LTC6087型运算放大器的供电端。
说明书desc
技术领域本发明属于位移测量技术领域，具体涉及一种基于磁栅尺的位移测量方法及装置。背景技术磁性尺测量系统是专为线性位移测量而设计的，其具有经济性好和效率高的优点，特别适用于长距离的测量，以及适用于如油污，切削屑，震动等恶劣环境下的位移测量；磁栅尺的工作原理为：在读头经过尺上的每个磁极时，其磁传感器上会产生正交正弦信号，此时，则可通过AD转换器读取正弦信号的幅值，以基于幅值计算出角度位置从而获得位移值；但是，前述基于磁栅尺的位移测量存在以下不足：由于计算速度的限制，在读头高速运动时，读头在磁极间运动所产生的正弦信号，无法被全部采集得到，如此，则会丢失读头在磁极间运动所产生的正弦信号，从而无法完整得出读头在磁极间所经过的间隔数，最终导致基于正弦信号计算出的位移存在较大误差；因此，在磁栅尺测量领域，如何提供一种测量精度高的位移测量方法，已成为当前的研究热点。发明内容本发明的目的是提供一种基于磁栅尺的位移测量方法及装置，用以解决现有技术中由于计算速度的限制，在读头高速运动时，读头在磁极间运动所产生的正弦信号，无法被全部采集得到，从而无法完整得出读头在磁极间所经过的间隔数，进而导致基于正弦信号计算出的位移存在较大误差的问题。为了实现上述目的，本发明采用以下技术方案：第一方面，提供了一种基于磁栅尺的位移测量方法，包括：获取磁栅尺在进行位移测量时产生的两路正交正弦信号，并对两路正交正弦信号进行波形转换，以得到两正交方波信号；基于两正交方波信号，计算出磁栅尺上的读头在第一时刻时所经过的磁极个数，以及在第二时刻时所经过的磁极个数，以分别作为第一磁极个数以及第二磁极个数，其中，所述第二时刻处于所述第一时刻之后；获取第一角度位置以及第二角度位置，其中，所述第一角度位置是基于两路正交正弦信号在所述第一时刻时的幅值得到的，所述第二角度位置是基于两路正交正弦信号在所述第二时刻时的幅值得到的；基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，计算得到所述磁栅尺的位移测量结果。基于上述公开的内容，本发明通过将磁栅尺上产生的两路正交正弦信号进行波形变换，从而得到两正交方波信号，而后，本发明再基于两正交方波信号，计算出在两不同时刻时，读头所经过的磁极个数，其中，磁栅尺上两磁极间所划分的间隔数是确定的，因此，当确定了读头在某一时刻所经过的磁极个数后，相当于就确定了该读头在两磁极间经过的间隔步数，如两磁极间设置有10个间隔，而读头在第一时刻经历的磁极个数为4个，那么读头则在两磁极间完整运动了两次，其所经过的间隔步数则是20个；最后，本发明即可根据不同时刻时读头所经过的磁极个数以及不同时刻时的角度位置，来计算出磁栅尺的位移测量结果。通过上述设计，本发明利用磁栅尺上的两正交正弦信号，来确定出读头在不同时刻时所经过的磁极个数，如此，则可通过采集的两路正交正弦信号来准确确定出读头在磁极间经过的间隔数；同时，本发明在传统的角度位置的基础上，再结合读头在不同时刻时所经过的磁极个数，来进行位移的计算，基于此，即可避免传统磁栅尺在测量时因受到计算速度的限制，读头在高速运动时，其在磁极间运动所产生的正弦信号无法被全部采集得，从而导致无法准确得出读头在磁极间经过的间隔数的问题，由此，则可大幅提高位移测量的准确性和精度。在一个可能的设计中，计算出磁栅尺上的读头在第一时刻时所经过的磁极个数，包括：获取两正交方波信号中处于第一时刻前的信号波形，以得到两采样方波信号；以两采样方波信号中的一采样方波信号内的高电平和低电平作为计数标准，对两采样方波信号中的另一采样方波信号内的上升沿和下降沿进行计数处理，以在计数处理后，得到所述另一采样方波信号内上升沿和下降沿的计数次数；求和上升沿和下降沿的计数次数，以将求和结果作为所述磁栅尺上的读头在第一时刻时所经过的磁极个数。基于上述公开的内容，本发明以读头在第一时刻时所经过的磁极个数为例，来阐述读头所经过的磁极个数的统计方法，即先从两正交方波信号中，截取出第一时刻前的信号，以作为两采样方波信号，而后，以采样方波信号中的一信号的高低电平为计数基准，去统计另一信号中上升沿和下降沿的次数，最后，将上升沿和下降沿的总次数相加，即可作为读头在第一时刻时所经过的磁极个数；在本实施例中，以高电平和低电平作为计数标准，则是在每一次统计上升沿和下降沿的次数时，决定此次上升沿的次数在前述统计出的次数上是相加还是相减，同理，下降沿也是如此；由此通过前述设计，即可确定出读头在第一时刻时所经过的磁极个数，从而准确得出其在第一时刻时在两磁极间所经过的间隔数。在一个可能的设计中，基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，计算得到所述磁栅尺的位移测量结果，包括：判断所述第二磁极个数与所述第一磁极个数之间的差值是否等于0；若是，则判断所述第二角度位置是否大于所述第一角度位置；若是，则使用所述第二角度位置减去所述第一角度位置，得到所述磁栅尺的位移测量结果，否则，则使用所述第一角度位置减去所述第二角度位置，得到所述磁栅尺的位移测量结果。在一个可能的设计中，若所述第二磁极个数与所述第一磁极个数之间的差值大于0，则所述方法还包括：判断所述第一角度位置是否大于预设阈值，且所述第二角度位置是否小于预设阈值；若是，则按照如下公式计算得到所述磁栅尺的位移测量结果，否则，则按照如下公式计算得到所述磁栅尺的位移测量结果；上述式和式中，pos表示所述磁栅尺的位移测量结果，Scale表示位移系数，CNT2表示第二磁极个数，CNT1表示第一磁极个数，AP2表示第二角度位置，AP1表示第一角度位置，表示取整运算。在一个可能的设计中，若所述第二磁极个数与所述第一磁极个数之间的差值小于0，则所述方法还包括：判断所述第一角度位置是否小于预设阈值，且所述第二角度位置是否大于预设阈值；若是，则按照如下公式计算得到所述磁栅尺的位移测量结果，否则，则按照如下公式计算得到所述磁栅尺的位移测量结果；上述式中，pos表示所述磁栅尺的位移测量结果，Scale表示位移系数，CNT2表示第二磁极个数，CNT1表示第一磁极个数，AP2表示第二角度位置，AP1表示第一角度位置，表示取整运算。在一个可能的设计中，在得到所述磁栅尺的位移测量结果后，所述方法还包括：基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，得到位移方向；根据所述位移方向以及所述位移测量结果，生成位移脉冲信号。第二方面，提供了一种基于磁栅尺的位移测量装置，包括：信号采集单元，用于获取磁栅尺在进行位移测量时产生的两路正交正弦信号；位移测量单元，用于对两路正交正弦信号进行波形转换，以得到两正交方波信号；位移测量单元，用于基于两正交方波信号，计算出磁栅尺上的读头在第一时刻时所经过的磁极个数，以及在第二时刻时所经过的磁极个数，以分别作为第一磁极个数以及第二磁极个数，其中，所述第二时刻处于所述第一时刻之后；位移测量单元，用于获取第一角度位置以及第二角度位置，其中，所述第一角度位置是基于两路正交正弦信号在所述第一时刻时的幅值得到的，所述第二角度位置是基于两路正交正弦信号在所述第二时刻时的幅值得到的；位移测量单元，还用于基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，计算得到所述磁栅尺的位移测量结果。在一个可能的设计中，所述信号采集单元包括：第一运算放大电路以及第二运算放大电路，其中，所述第一运算放大电路和所述第二运算放大电路均包括LTC6087型运算放大器；对于所述第一运算放大电路，所述LTC6087型运算放大器的正相输入端和反相输入端分别通过一第一电阻电连接所述磁栅尺的第一路信号输出端，用于获取磁栅尺输出的一路正交正弦初始信号，所述LTC6087型运算放大器的输出端电连接所述位移测量单元，用于将所述一路正交正弦初始信号进行信号放大，得到一路正交正弦信号，并输出至所述位移测量单元；对于所述第二运算放大电路，所述LTC6087型运算放大器的正相输入端和反相输入端分别通过一第二电阻电连接所述磁栅尺的第二路信号输出端，用于获取磁栅尺输出的另一路正交正弦初始信号，所述LTC6087型运算放大器的输出端电连接所述位移测量单元，用于将所述另一路正交正弦初始信号进行信号放大，得到另一路正交正弦信号，并输出至所述位移测量单元。在一个可能的设计中，所述位移测量单元采用CW32F030F8型处理芯片及其外围电路，其中，所述CW32F030F8型处理芯片电连接两LTC6087型运算放大器的输出端，用于对两路正交正弦信号进行波形转换，以得到两正交方波信号；所述CW32F030F8型处理芯片用于基于两正交方波信号，计算出磁栅尺上的读头在第一时刻时所经过的磁极个数，以及在第二时刻时所经过的磁极个数，以分别作为第一磁极个数以及第二磁极个数；所述CW32F030F8型处理芯片还用于获取所述第一角度位置以及所述第二角度位置，并基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，计算得到所述磁栅尺的位移测量结果。在一个可能的设计中，所述CW32F030F8型处理芯片，还用于基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，得到位移方向，且所述装置还包括：电源单元以及差分输出单元；所述差分输出单元采用AM26C31型差分驱动芯片，其中，所述AM26C31型差分驱动芯片电连接所述CW32F030F8型处理芯片，用于根据CW32F030F8型处理芯片输出的位移测量结果和位移方向，生成位移脉冲信号；所述电源单元采用MPM3506A同步整流降压芯片，其中，所述MPM3506A同步整流降压芯片的输入端电连接供电电源，所述MPM3506A同步整流降压芯片的输出端分别电连接所述CW32F030F8型处理芯片的供电端、所述AM26C31型差分驱动芯片的供电端以及两LTC6087型运算放大器的供电端。基于前述公开的内容，本发明所公开的位移测量装置，全部由国产的芯片组成，如此，可实现磁栅尺读头的国产化，从而避免传统技术需要使用国外专用的测量芯片才能实现磁栅尺位移测量的问题，由此，可大幅降低整个硬件装置的成本，从而减少位移测量成本，适用于大规模应用与推广。第三方面，提供了另一种基于磁栅尺的位移测量装置，以装置为电子设备为例，包括依次通信相连的存储器、处理器和收发器，其中，所述存储器用于存储计算机程序，所述收发器用于收发消息，所述处理器用于读取所述计算机程序，执行如第一方面或第一方面中任意一种可能设计的所述基于磁栅尺的位移测量方法。第四方面，提供了一种存储介质，存储介质上存储有指令，当所述指令在计算机上运行时，执行如第一方面或第一方面中任意一种可能设计的所述基于磁栅尺的位移测量方法。第五方面，提供了一种包含指令的计算机程序产品，当指令在计算机上运行时，使计算机执行如第一方面或第一方面中任意一种可能设计的所述基于磁栅尺的位移测量方法。有益效果：本发明利用磁栅尺上的两正交正弦信号，来确定出读头在不同时刻时所经过的磁极个数，如此，则可通过采集的两路正交正弦信号来准确确定出读头在磁极间经过的间隔数；同时，本发明在传统的角度位置的基础上，再结合读头在不同时刻时所经过的磁极个数，来进行位移的计算，基于此，即可避免传统磁栅尺在测量时因受到计算速度的限制，读头在高速运动时，其在磁极间运动所产生的正弦信号无法被全部采集得，从而导致无法准确得出读头在磁极间经过的间隔数的问题，由此，则可大幅提高位移测量的准确性和精度。本发明所公开的位移测量装置，全部由国产的芯片组成，如此，可实现磁栅尺读头的国产化，从而避免传统技术需要使用国外专用的测量芯片才能实现磁栅尺位移测量的问题，由此，可大幅降低整个硬件装置的成本，从而减少位移测量成本，适用于大规模应用与推广。附图说明图1为本发明实施例提供的基于磁栅尺的位移测量方法的步骤流程示意图；图2为本发明实施例提供的两正交正弦信号的示意图；图3为本发明实施例提供的两正交方波信号的示意图；图4为本发明实施例提供的正向脉冲信号的示意图；图5为本发明实施例提供的反向脉冲信号的示意图；图6为本发明实施例提供的基于磁栅尺的位移测量装置的结构示意图；图7为本发明实施例提供的信号采集单元的具体电路结构示意图；图8为本发明实施例提供的CW32F030F8型处理芯片的具体电路图；图9为本发明实施例提供的CW32F030F8型处理芯片的第一部分的外围电路图；图10为本发明实施例提供的CW32F030F8型处理芯片的第二部分的外围电路图；图11为本发明实施例提供的AM26C31型差分驱动芯片的具体电路图；图12为本发明实施例提供的MPM3506A同步整流降压芯片的具体电路图；图13为本发明实施例提供的电子设备的结构示意图。具体实施方式为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将结合附图和实施例或现有技术的描述对本发明作简单地介绍，显而易见地，下面关于附图结构的描述仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。在此需要说明的是，对于这些实施例方式的说明用于帮助理解本发明，但并不构成对本发明的限定。应当理解，尽管本文可能使用术语第一、第二等等来描述各种单元，但是这些单元不应当受到这些术语的限制。这些术语仅用于区分一个单元和另一个单元。例如可以将第一单元称作第二单元,并且类似地可以将第二单元称作第一单元，同时不脱离本发明的示例实施例的范围。应当理解，对于本文中可能出现的术语“和/或”，其仅仅是一种描述关联对象的关联关系，表示可以存在三种关系，例如，A和/或B，可以表示：单独存在A，单独存在B，同时存在A和B三种情况；对于本文中可能出现的术语“/和”，其是描述另一种关联对象关系，表示可以存在两种关系，例如，A/和B，可以表示：单独存在A，单独存在A和B两种情况；另外，对于本文中可能出现的字符“/”，一般表示前后关联对象是一种“或”关系。实施例：参见图1～5所示，本实施例所提供的基于磁栅尺的位移测量方法，利用磁栅尺产生的两正交正弦信号，来统计出不同时刻时，读头所经过的磁极个数，而后，则在传统的角度位置的基础上，再结合读头在不同时刻时所经过的磁极个数，来进行位移的计算，如此，本方法即可避免传统磁栅尺在测量时无法准确得出读头在磁极间经过的间隔数的问题，从而提高位移测量的准确性和精度；在本实施例中，举例该方法可以但不限于在磁栅尺的位移测量端侧运行，可以理解的是，前述执行主体并不构成对本申请实施例的限定，相应的，本方法的运行步骤可以但不限于如下述步骤S1～S4所示。S1.获取磁栅尺在进行位移测量时产生的两路正交正弦信号，并对两路正交正弦信号进行波形转换，以得到两正交方波信号；具体应用时，磁栅尺在工作时，磁栅尺上的读头在两个磁极间进行运动的过程中，其内部的磁传感器上会产生两路正交正弦初始信号，此时，即可采集该两路正交正弦初始信号，并经过信号放大后，则可得到两路正交正弦信号；参见图2所示，图2中的Vo1为第一路正交正弦信号，Vo2则为第二路正交正弦信号，且从图2可得知，其横坐标为时间，纵坐标为电压值；而后，则可基于两正交正弦信号进行角度位置的计算以及磁极个数的统计；在本实施例中，举例可以但不限于采用比较器将两路正交正弦信号整形处理为正交的方波信号，其转换后的方波信号图可参见图3所示；当然，也可采用具备比较器功能的处理芯片，来实现信号的转换，其具体使用部件可根据实际使用而具体设定，在此不限定于前述举例。在得到两正交方波信号后，即可基于两正交方波信号，来统计出读头在不同时刻时，所经过的磁极个数，其中，磁极个数的统计过程如下述步骤S2所示。S2.基于两正交方波信号，计算出磁栅尺上的读头在第一时刻时所经过的磁极个数，以及在第二时刻时所经过的磁极个数，以分别作为第一磁极个数以及第二磁极个数，其中，所述第二时刻处于所述第一时刻之后；在本实施例中，由于磁栅尺上两磁极间所划分的间隔数是确定的，因此，当确定了读头在某一时刻所经过的磁极个数后，相当于就确定了读头在该时刻时，在两磁极间所经过的间隔步数；如两磁极间设置有10个间隔，且读头在第一时刻时经历的磁极个数为2个，那么读头则在两磁极间完整运动了一次，其所经过的间隔步数则是10个；同理，当读头在第一时刻时经历的磁极个数为4个，那么读头则在两磁极间完整运动了2次，此时，其经过的间隔步数则是20个，当然，其余不同磁极个数所对应的含义也是如此，于此不再赘述。在本实施例中，由于不同时刻时，读头所经过的磁极个数的计算方法原理相同，下述以第一时刻为例，来进行磁极个数统计的详细阐述，如下述步骤S21～S23所示。S21.获取两正交方波信号中处于第一时刻前的信号波形，以得到两采样方波信号；具体应用时，相当于是在两正交方波信号中，截取出处于第一时刻前的信号波形，从而作为采样方波信号，当然，采样时刻可根据实际使用而具体设定，在此不作具体限定。在截取出处于第一时间前的信号波形后，则可利用截取出的信号，来统计出读头在第一时刻时所经过的磁极个数，如下述步骤S22和步骤S23所示。S22.以两采样方波信号中的一采样方波信号内的高电平和低电平作为计数标准，对两采样方波信号中的另一采样方波信号内的上升沿和下降沿进行计数处理，以在计数处理后，得到所述另一采样方波信号内上升沿和下降沿的计数次数；在本实施例中，以一采样方波信号的高低电平作为计数标准，对另一采样方波信号内的上升沿和下降沿的次数进行计数的原理为：高低电平用于确定上升沿和下降沿次数的计数符号，即当一采样方波信号为高电平时，此时，若另一采样方波信号对应为上升沿，那么上升沿次数则在之前统计的总次数上加1；而当一采样方波信号为低电平时，若另一采样方波信号对应为上升沿，那么上升沿次数则在之前统计的总次数上减1；同理，对于低电平时，其原理也是于此，于此不再赘述。在基于前述步骤S22所提供的计数方法统计出另一采样方波信号中上升沿和下降沿的总次数后，将二者计数得到的总次数相加，即可得到读头在第一时刻时所经过的磁极个数，如下述步骤S23所示。S23.求和上升沿和下降沿的计数次数，以将求和结果作为所述磁栅尺上的读头在第一时刻时所经过的磁极个数；在本实施例中，读头在第二时刻时所经过的磁极个数的统计方法与第一时刻时的统计方法原理相同，于此不再赘述。由此通过前述设计，本发明只需计数读头所经过的磁极个数，即可确定出其在磁极间所经过的间隔数，由此，即可避免传统技术受限于计算速度的限制，读头在高速运动时，其在磁极间运动所产生的正弦信号无法被全部采集得到，从而导致无法完整得出读头在磁极间所经过的间隔数的问题。在得出读头在两不同时刻时所经过的磁极个数后，即可结合读头在两不同时刻时的角度位置，来计算得出第一时刻与第二时刻之间，磁栅尺的位移测量结果，其中，计算过程如下述步骤S3和步骤S4所示。S3.获取第一角度位置以及第二角度位置，其中，所述第一角度位置是基于两路正交正弦信号在所述第一时刻时的幅值得到的，所述第二角度位置是基于两路正交正弦信号在所述第二时刻时的幅值得到的；在本实施例中，对于不同时刻时，读头的角度位置，可以但不限于根据两正交正弦信号在两不同时刻时对应的幅值计算得到，其具体计算过程为：以第一角度位置为例，首先，获取两正交正弦信号在第一时刻时的幅值，然后，利用CORDIC算法计算出角度值Angle；在本实施例中，CORDIC算法是J.Volder于1959年提出了一种快速算法，这个算法只利用移位和加减运算，就能计算常用三角函数值，在缺乏硬件乘法器的简单设备上很容易实现三角函数的计算，其是磁栅尺位移测量领域中，角度值计算的常用算法；在得到第一时刻时对应的角度值后，则可依据如下公式计算得到第一角度位置：上述式中，AP1表示第一角度位置，Angle1表示第一时刻时对应的角度值，Scale表示位移系数，为预设值，可根据磁极间距及读头精度确定。如此，即可前述公式则可计算得到读头在第一时刻时的角度位置；当然，读头在第二时刻时的角度位置，则是将第二时刻对应的值代入前述公式即可，其计算原理与前述举例相同，于此不再赘述。在得到读头在两不同时刻时对应的角度位置后，即可结合其在两不同时刻时所经过的磁极个数，来计算得到磁栅尺的位移测量结果，如下述步骤S4所示。S4.基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，计算得到所述磁栅尺的位移测量结果；具体应用时，根据第二磁极个数与第一磁极个数之间的差值大小，确定有不同的位移计算公式，分别如下步骤S41～S47所示。S41.判断所述第二磁极个数与所述第一磁极个数之间的差值是否等于0；具体应用时，则是判断CNT2-CNT1是否等于0，若是，则需进行两角度位置的判断，如下述步骤S42所示。S42.若是，则判断所述第二角度位置是否大于所述第一角度位置。S43.若是，则使用所述第二角度位置减去所述第一角度位置，得到所述磁栅尺的位移测量结果，否则，则使用所述第一角度位置减去所述第二角度位置，得到所述磁栅尺的位移测量结果；在本实施例中，若第二角度位置大于第一角度位置，则说明位移方向为正向方向，也就是正向移动，此时，则使用第二角度位置减去第一角度位置，即可得到位移测量结果；反之，若第二角度位置小于第一角度位置，则说明位移方向为反向方向，也就是反向移动，此时，则使用第一角度位置减去第二角度位置，即可得到位移测量结果。在本实施例中，若所述第二磁极个数与所述第一磁极个数之间的差值大于0，那么则说明位移方向为正向方向，此时，则采用如下步骤S44和步骤S45，来计算得到位移测量结果。S44.判断所述第一角度位置是否大于预设阈值，且所述第二角度位置是否小于预设阈值；在具体应用时，举例预设阈值可以但不限于为：如此，基于前述判断条件，本实施例则公开了满足前述条件，以及不满足前述条件时各自对应的位置计算方法，如下述步骤S45所示。S45.若是，则按照如下公式计算得到所述磁栅尺的位移测量结果，否则，则按照如下公式计算得到所述磁栅尺的位移测量结果。/＞上述式和式中，pos表示所述磁栅尺的位移测量结果，Scale表示位移系数，CNT2表示第二磁极个数，CNT1表示第一磁极个数，AP2表示第二角度位置，AP1表示第一角度位置，表示取整运算。同理，若所述第二磁极个数与所述第一磁极个数之间的差值小于0时，那么则说明位移方向为反向方向，此时，则需采用如下步骤S46和步骤S47来计算得到位移测量结果。S46.判断所述第一角度位置是否小于预设阈值，且所述第二角度位置是否大于预设阈值。S47.若是，则按照如下公式计算得到所述磁栅尺的位移测量结果，否则，则按照如下公式计算得到所述磁栅尺的位移测量结果。由此通过前述设计，即可基于前述步骤S41～S47，来计算出磁栅尺的位移测量结果。另外，在本实施例中，在计算出位移测量结果后，还可基于位移方向，来生成位移脉冲信号，如下述步骤S5和步骤S6所示。S5.基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，得到位移方向；具体应用时，位移方向的确定过程可参见前述步骤S41～S47，于此不再赘述。S6.根据所述位移方向以及所述位移测量结果，生成位移脉冲信号；具体应用时，可以但不限于将位移测量结果和位移方向输入至正交编码器，从而输出相应的数据至数据寄存器，以基于数据寄存器输出相应的脉冲波形；在本实施例中，输出的脉冲波形分为正向脉冲和反向脉冲，且每个脉冲信号分为A相、B相和Z相，其中，两脉冲信号的波形图可参见图4和图5所示。由此通过前述步骤S1～S6所详细描述的基于磁栅尺的位移测量方法，本发明可通过采集的两路正交正弦信号来准确确定出读头在磁极间经过的间隔数；同时，在传统的角度位置的基础上，再结合读头在不同时刻时所经过的磁极个数，来进行位移的计算，基于此，即可避免传统磁栅尺在测量时无法准确得出读头在磁极间经过的间隔数的问题，从而大幅提高位移测量的准确性和精度。参见图6～图12所示，本实施例第二方面提供了一种实现实施例第一方面所述的基于磁栅尺的位移测量方法的硬件装置，包括：信号采集单元，用于获取磁栅尺在进行位移测量时产生的两路正交正弦信号。位移测量单元，用于对两路正交正弦信号进行波形转换，以得到两正交方波信号。位移测量单元，用于基于两正交方波信号，计算出磁栅尺上的读头在第一时刻时所经过的磁极个数，以及在第二时刻时所经过的磁极个数，以分别作为第一磁极个数以及第二磁极个数，其中，所述第二时刻处于所述第一时刻之后。位移测量单元，用于获取第一角度位置以及第二角度位置，其中，所述第一角度位置是基于两路正交正弦信号在所述第一时刻时的幅值得到的，所述第二角度位置是基于两路正交正弦信号在所述第二时刻时的幅值得到的。位移测量单元，还用于基于所述第一磁极个数、所述第二磁极个数、所述第一角度位置以及所述第二角度位置，计算得到所述磁栅尺的位移测量结果。在本实施例中，举例位移测量单元可以但不限于包括比较器和处理器，其中，比较器则用于对两路正交正弦信号进行波形转换，以得到两正交方波信号，而处理单元则根据两正交方波信号，来得到磁栅尺上的读头在第一时刻和第二时刻时所经过的磁极个数，以及基于两不同时刻时的角度位置以及磁极个数，来计算得出位移值。在具体应用时，由于现有的磁栅尺读头基本都要采用专用芯片才能实现位移测量，其中，采用的芯片以国外的汉斯芯片为主，因此，会导致测量成本较高，由此，本实施例还在前述硬件装置上进行了改进，采用国产化的芯片，并结合前述实施例第一方面所提供的测量方法，来实现整个读头的国产化，以打破技术限制，降低磁栅尺位移测量成本。可选的，举例信号采集单元可以但不限于包括：第一运算放大电路以及第二运算放大电路，而位移测量单元则可以但不限于采用CW32F030F8型处理芯片及其外围电路，其中，CW32F030F8型处理芯片集成有数据处理和比较器的功能，因此，可同时实现波形转换和位移计算功能；在本实施例中，第一运算放大电路和第二运算放大电路的输入端电连接磁栅尺，分别获取一路正交正弦初始信号，并对获取的正交正弦信号进行信号放大处理，得到正交正弦信号；而第一运算放大电路和第二运算放大电路的输出端则电连接CW32F030F8型处理芯片，用于将各自对应的正交正弦信号输入至CW32F030F8型处理芯片中，并按照实施例第一方面所提供的方法进行数据处理，以最终得到位移测量结果。采用参见图7所示，举例第一运算放大电路和所述第二运算放大电路均包括LTC6087型运算放大器，更进一步的，前述两运算放大器的具体电路结构为：如图7所示，对于所述第一运算放大电路，所述LTC6087型运算放大器U4A的正相输入端和反相输入端分别通过一第一电阻电连接所述磁栅尺的第一路信号输出端；在本实施例中，可以但不限于采用VCP1615型磁栅尺，因此，LTC6087型运算放大器U4A的正相输入端通过第一电阻R7电连接VCP1615型磁栅尺的第6管脚，LTC6087型运算放大器U4A的反相输入端通过第一电阻R9电连接VCP1615型磁栅尺的第3管脚，从而获取VCP1615型磁栅尺输出的一路正交正弦初始信号；而后，所述LTC6087型运算放大器的U4A的输出端电连接所述位移测量单元，用于将所述一路正交正弦初始信号进行信号放大，得到一路正交正弦信号，并输出至所述位移测量单元；具体的，LTC6087型运算放大器的U4A的输出端则电连接CW32F030F8型处理芯片的第3管脚，可参见图8所示。同理，对于所述第二运算放大电路，所述LTC6087型运算放大器U4B的正相输入端和反相输入端分别通过一第二电阻电连接所述磁栅尺的第二路信号输出端，同理，LTC6087型运算放大器U4B的正相输入端电连接VCP1615型磁栅尺的第7管脚，反向输入端电连接VCP1615型磁栅尺的第2管脚，从而获取VCP1615型磁栅尺输出的另一路正交正弦初始信号，而所述LTC6087型运算放大器的输出端则电连接所述位移测量单元，用于将所述另一路正交正弦初始信号进行信号放大，得到另一路正交正弦信号，并输出至所述位移测量单元；具体的，则是电连接CW32F030F8型处理芯片的第4管脚。在本实施例中，两运算放大器也具有各自的外围电路，且外围电路相同，以第一运算放大器U4A为例，其输出端还分别电连接电阻R8和电容C7的一端，而电阻R8和电容C7的另一端则电连接第一运算放大器U4A的反相输入端，同时，第一运算放大器U4A的输出端还通过电阻R6电连接CW32F030F8型处理芯片的电压比较引脚；当然，第二运算放大器U4B的外围电路也是如此，可参见图7所示，于此不再赘述。在具体实施时，所述CW32F030F8型处理芯片用于对两LTC6087型运算放大器输出正交正弦信号进行波形转换，以得到两正交方波信号，并按照实施例第一方面所述的方法，来基于两正交方波信号得出不同时刻读头所经过的磁极个数，并结合不同时刻时读头的角度位置，来计算得到位移测量值，其中，计算原理可参见实施例第一方面，于此不再赘述。可选的，CW32F030F8型处理芯片采用ARM Cortex-M0+内核，最高主频64MHz，其计算性能强，可满足在位移测量的计算性能需求；在具体应用时，参见图8所示，芯片的引脚3和4配置为ADC输入引脚，采样从两运算放大器输出经放大后的模拟信号，转换后用于计算角度位置值，引脚5和引脚11配置为电压比较器的输入引脚，接收正交正弦信号后转换成正交方波信号，分别从引脚14和15输出到编码计数器的输入引脚8和10，用于记录经过的磁极个数；最后，芯片则基于记录的磁极个数和角度位置，来计算得到位移测量值。在本实施例中，举例CW32F030F8型处理芯片的外围电路可以但不限于包括MCU电源电路、复位、BOOT电路、调试接口SCLK、SWDIO和工作指示电路，可参见图9和图10所示。另外，在本实施例中，举例所述装置还可以但不限于包括差分输出单元，可选的，举例差分输出单元可以但不限于采用AM26C31型差分驱动芯片，其中，所述AM26C31型差分驱动芯片电连接所述CW32F030F8型处理芯片，用于根据CW32F030F8型处理芯片输出的位移测量结果和位移方向，生成位移脉冲信号；参见图11所示；在具体实施时，AM26C31芯片是具有互补输出的差分线路驱动器，将来自CW32F030F8型处理芯片的三相输出信号转换成三路差分信号输出，以最终得到位移脉冲信号。在本实施例中，该装置还设置有电源单元，可选的，举例所述电源单元采用MPM3506A同步整流降压芯片，其中，所述MPM3506A同步整流降压芯片的输入端电连接供电电源，所述MPM3506A同步整流降压芯片的输出端分别电连接所述CW32F030F8型处理芯片的供电端、所述AM26C31型差分驱动芯片的供电端以及两LTC6087型运算放大器的供电端，以便为前述各个器件供电，保证装置的正常工作。参见图12所示，MPM3506A同步整流降压变换器正常功能工作范围Vin介于4.5V～36V之间，输出电压Vout介于0.81V～33V之间，外部电阻分压器用于设置输出电压，反馈电阻R4也通过内部补偿电容设置反馈环路带宽；该芯片可通过配置反馈电阻R4和R5的电阻阻值比来调整输出电压，当输出电压大于1V时，反馈电阻的电阻值为75k，而反馈电阻R5则由以下公式计算得出：上述式中，R5′为反馈电阻R5的阻值，R4′为反馈电阻R4的阻值。由此通过对基于磁栅尺的位移测量装置的详细阐述，本发明所提供的装置全部由国产的芯片组成，如此，可实现磁栅尺读头的国产化，从而避免传统技术需要使用国外专用的测量芯片才能实现磁栅尺位移测量的问题，由此，可打破技术限制，并大幅降低整个硬件装置的成本，从而减少位移测量成本，适用于大规模应用与推广。本实施例提供的装置的工作过程、工作细节和技术效果，可以参见实施例第一方面，于此不再赘述。如图13所示，本实施例第三方面提供了另一种基于磁栅尺的位移测量装置，以装置为电子设备为例，包括：依次通信相连的存储器、处理器和收发器，其中，所述存储器用于存储计算机程序，所述收发器用于收发消息，所述处理器用于读取所述计算机程序，执行如实施例第一方面所述的基于磁栅尺的位移测量方法。具体举例的，所述存储器可以但不限于包括随机存取存储器、只读存储器、闪存、先进先出存储器和/或先进后出存储器等等；具体地，处理器可以包括一个或多个处理核心，比如4核心处理器、8核心处理器等。处理器可以采用DSP、FPGA、PLA中的至少一种硬件形式来实现，同时，处理器也可以包括主处理器和协处理器，主处理器是用于对在唤醒状态下的数据进行处理的处理器，也称CPU；协处理器是用于对在待机状态下的数据进行处理的低功耗处理器。在一些实施例中，处理器可以在集成有GPU，GPU用于负责显示屏所需要显示的内容的渲染和绘制，例如，所述处理器可以不限于采用型号为STM32F105系列的微处理器、精简指令集计算机微处理器、X86等架构处理器或集成嵌入式神经网络处理器的处理器；所述收发器可以但不限于为无线保真无线收发器、蓝牙无线收发器、通用分组无线服务技术无线收发器、紫蜂协议无线收发器、3G收发器、4G收发器和/或5G收发器等。此外，所述装置还可以但不限于包括有电源模块、显示屏和其它必要的部件。本实施例提供的电子设备的工作过程、工作细节和技术效果，可以参见实施例第一方面，于此不再赘述。本实施例第四方面提供了一种存储包含有实施例第一方面所述的基于磁栅尺的位移测量方法的指令的存储介质，即所述存储介质上存储有指令，当所述指令在计算机上运行时，执行如第一方面所述的基于磁栅尺的位移测量方法。其中，所述存储介质是指存储数据的载体，可以但不限于包括软盘、光盘、硬盘、闪存、优盘和/或记忆棒等，所述计算机可以是通用计算机、专用计算机、计算机网络、或者其他可编程装置。本实施例提供的存储介质的工作过程、工作细节和技术效果，可以参见实施例第一方面，于此不再赘述。本实施例第五方面提供了一种包含指令的计算机程序产品，当所述指令在计算机上运行时，使所述计算机执行如实施例第一方面所述的基于磁栅尺的位移测量方法，其中，所述计算机可以是通用计算机、专用计算机、计算机网络、或者其他可编程装置。最后应说明的是：以上所述仅为本发明的优选实施例而已，并不用于限制本发明的保护范围。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
