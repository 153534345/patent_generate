标题title
一种集合变分自编码器与动态规整的锂电池异常检测方法
摘要abst
本发明提供了一种集合变分自编码器与动态规整的锂电池异常检测方法，包括获取锂电池生产过程中正常和异常的电池恒流充电电压时序数据；对数据进行预处理；将预处理后的数据划分为模型训练集、阈值训练集和测试集；将模型训练集输入至构建的VAE‑LSTM‑DTW模型中进行训练；所述VAE‑LSTM‑DTW模型包括经LSTM改进后的VAE网络构成的重构模型和DTW评价模型；将测试集输入至训练好的VAE‑LSTM‑DTW模型中，先经过重构模型得到测试集对应的理论正常重构数据集，后将测试集数据与对应的理论正常重构数据输入DTW评价模型，得到两者之间的重构误差，将重构误差与最优阈值进行比较，得到锂电池异常检测结果。
权利要求书clms
1.一种集合变分自编码器与动态规整的锂电池异常检测方法，其特征在于，包括以下步骤：获取锂电池生产过程中正常和异常的电池恒流充电电压时序数据；对所述电池恒流充电电压时序数据进行数据预处理；将预处理后的数据划分为模型训练集、阈值训练集和测试集；其中，所述模型训练集中的数据均为正常电池数据，所述阈值训练集和所述测试集中包含正常电池数据和异常电池数据，且正常电池数据和异常电池数据的数量相等；将所述模型训练集输入至构建的VAE-LSTM-DTW模型中进行训练；所述的VAE-LSTM-DTW模型包括经LSTM改进后的VAE网络构成的重构模型和DTW评价模型；将所述模型训练集先输入至经LSTM改进后的VAE网络构成的重构模型中进行训练，确定各层模型参数，从而确定重构模型；重构模型构建完成后，将所述阈值训练集输入所述重构模型中获得理论正常重构数据集，将阈值训练集与对应的理论正常重构数据集输入到DTW评价模型中，得到阈值训练集与其对应的理论正常重构数据集之间的重构误差，根据所述重构误差确定最优阈值，从而确定DTW评价模型；将所述测试集输入至训练好的VAE-LSTM-DTW模型中，先经过重构模型得到测试集对应的理论正常重构数据集，后将测试集数据与对应的理论正常重构数据输入DTW评价模型，得到两者之间的重构误差，将重构误差与最优阈值进行比较，得到锂电池异常检测结果。2.根据权利要求1所述的一种集合变分自编码器与动态规整的锂电池异常检测方法，其特征在于，当计算得到的重构误差大于最优阈值时，则该单体电池判定为异常电池；当计算得到的重构误差小于最优阈值时，则该单体电池判定为正常电池。3.根据权利要求1所述的一种集合变分自编码器与动态规整的锂电池异常检测方法，其特征在于，获取锂电池生产过程中正常和异常的电池恒流充电电压时序数据，具体为：采集锂电池生产过程中，分选段中第一次充电过程的有人工标注的正常和异常电池恒流充电电压时序数据；其中，采集的数据中任意单条时序数据长度未经预处理前，长度分布在之间，即记录分选段电池充电过程中85-95分钟的数据，电压范围为0-4.0V。4.根据权利要求3所述的一种集合变分自编码器与动态规整的锂电池异常检测方法，其特征在于，对所述电池恒流充电电压时序数据进行数据预处理，具体为：首先，对采集到的数据中纯空数据集进行剔除；其次，通过数据清洗与直线插补的方法，将原始数据处理为各点对齐且每条曲线长度均为170的实验数据集，单条曲线记录分选段电池恒流充电结束前85分钟数据。5.根据权利要求1所述的一种集合变分自编码器与动态规整的锂电池异常检测方法，其特征在于，经LSTM改进后的VAE网络构成的重构模型依次包括输入层、第一长短时间记忆网络层、两个全连接层、lambda层、扩展层、第二长短时记忆网络层和输出层。6.根据权利要求5所述的一种集合变分自编码器与动态规整的锂电池异常检测方法，其特征在于，将所述模型训练集先输入至经LSTM改进后的VAE网络构成的重构模型中进行训练，确定模型中的超参数，从而确定重构模型；具体为：模型输入Xin为多组时间定长的电池分选段充电电压动态数据组成的高维张量，输入向量Xin＝其中xi，i∈为任一单体电池充电电压曲线向量；xi＝，uj为任一时刻的电池电压值,j∈；Xin输入输入层后，得到维度为的单时间序列张量Xbatch＝，其中，b为训练过程中的数据批次大小，t为单个时间序列长度；维度为的单时间序列张量经过第一长短时间记忆网络层编码处理后，对输入时序数据进行特征提取，将其降维为的向量；m为中间层维度；再经过全连接层变换，从上一层输入特征向量中得到输入批次中各时序数据分布的高斯混合模型分解参数矩阵，即均值矩阵μx与方差矩阵σx，其维度均为；h为隐层维度；之后输入至lambda层，引入标准正态分布中采样的随机变量ε，利用重参数化技巧公式整合两个参数矩阵，得到与输入向量一一对应的隐变量Z；再输入至扩展层，重复t次将隐层变量展开为的张量；再通过第二长短时记忆网络层，对时序数据特征进行复原，将扩展层张量复原为维度为的张量，实现解码完成对隐变量的重建，最后经过输出层对输出向量进一步处理，将m条张量拼接成维度为的张量输出，从而得到理论正常重构数据集Xbatch'＝；通过多批次训练确定模型中的超参数，从而确定重构模型。7.根据权利要求1所述的一种集合变分自编码器与动态规整的锂电池异常检测方法，其特征在于，重构模型构建完成后，将所述阈值训练集输入所述重构模型中获得理论正常重构数据集，将阈值训练集与对应的理论正常重构数据集输入到DTW评价模型中，得到阈值训练集与其对应的理论正常重构数据集之间的重构误差，根据所述重构误差确定最优阈值，从而确定DTW评价模型，具体为：将所述阈值训练集输入所述重构模型中，得到阈值训练集对应的理论正常重构数据集；将阈值训练集与对应的理论正常重构数据集输入到DTW评价模型中，利用动态时间规整算法得到阈值训练集与其对应的理论正常重构数据集之间的重构误差；分析所述阈值训练集中正常电池数据和异常电池数据对应的重构误差分布，利用数学规划找到能使异常电池数据分辨率最大的重构误差值，将其定义为最优阈值，从而确定DTW评价模型。
说明书desc
技术领域本发明涉及锂电池检测方法技术领域，特别地，涉及一种集合变分自编码器与动态规整的锂电池异常检测方法。背景技术在锂电池生产过程中，保证同一批次的电池具有较好的充放电时序稳定性是生产环节的重要任务。但由于生产工艺波动，不可避免会出现指标不符合设计要求的异常电池，这些异常电池如果在生产过程中不能及时筛除，将降低出厂电池预期寿命，甚至会有一定安全隐患。因此，建立一套能精确有效的异常电池检测技术具有重要意义。电池异常检测工作一般会放在化成工序激活后，此时电池的电化学性能基本稳定。在该工序结束后，为筛除未正常激活的电池，通常会对每个单体电池进行充放电实验，模拟检测电池充放电运行状态。故为了分析锂电池电池充放电稳定性，可选择从化成工序后的首次充电电压数据着手，对单体电池充电时序特征进行特征提取与异常分析。因此，针对异常电池检测的任务可以看作对电池充放电时序数据的异常检测任务。目前，常见的锂电池异常检测方法分为两类，一种是以局部离群因子、聚类算法为代表的基于密度的异常检测方法，如肖健夫等利用LOF异常算法分析电池充电电压曲线不一致性，实现了对储能电池组的异常检测与故障分类；贾俊等人则提出了基于多维特征和混合聚类算法的健康状态综合评分体系，利用无监督算法实现了对储能电站的故障电池筛选，综合考量了多维电池特性；马速良等人利用一种基于聚类分析架构的遗传优化异常检测新方法实现了对储能电池的个性化异常检测。第二种是基于经典机器学习算法的异常检测方法，如Ruochen Jin等人提出了结合灰色关联度分析与孤立森林算法的异常电池数据检测方法，并利用基于众包策略与区块链的数据采集与处理方法收集了大量电动汽车电池充放电数据予以使用；Saxena等提出了一种利用一类支持向量机模型检测电池容量异常衰减趋势的新方法，实现了对电池衰退早期的异常状态检测。但是，传统异常检测方法多应用于固定电池组的状态检测，不考虑对陌生的单体电池或电池组的数据适配与检测，不能直接用于生产现场在线检测。其次，上述算法多利用电池瞬时静态特征，因而在处理时序数据时不能把握各个时刻间的关联，在涉及对时间序列的异常检测任务中，表现较差。为此一种可以实现在线检测，且具有较强时序数据处理能力的异常检测方法亟需提出。发明内容为解决现有技术中锂电池异常检测方法多应用于固定电池组的状态检测，不考虑对陌生的单体电池或电池组的数据适配与检测，不能直接用于生产现场在线检测，以及在处理时序数据时不能把握各个时刻间的关联，且在涉及对时间序列的异常检测任务中，表现较差的问题，本发明提供了一种集合变分自编码器与动态规整的锂电池异常检测方法，该方法可以实现在线检测，且具有较强时序数据处理能力。为实现上述目的，本发明提供了一种集合变分自编码器与动态规整的锂电池异常检测方法，包括以下步骤：获取锂电池生产过程中正常和异常的电池恒流充电电压时序数据；对所述电池恒流充电电压时序数据进行数据预处理；将预处理后的数据划分为模型训练集、阈值训练集和测试集；其中，所述模型训练集中的数据均为正常电池数据，所述阈值训练集和所述测试集中包含正常电池数据和异常电池数据，且正常电池数据和异常电池数据的数量相等；将所述模型训练集输入至构建的VAE-LSTM-DTW模型中进行训练；所述的VAE-LSTM-DTW模型包括经LSTM改进后的VAE网络构成的重构模型和DTW评价模型；将所述模型训练集先输入至经LSTM改进后的VAE网络构成的重构模型中进行训练，确定各层模型参数，从而确定重构模型；重构模型构建完成后，将所述阈值训练集输入所述重构模型中获得理论正常重构数据集，将阈值训练集与对应的理论正常重构数据集输入到DTW评价模型中，得到阈值训练集与其对应的理论正常重构数据集之间的重构误差，根据所述重构误差确定最优阈值，从而确定DTW评价模型；将所述测试集输入至训练好的VAE-LSTM-DTW模型中，先经过重构模型得到测试集对应的理论正常重构数据集，后将测试集数据与对应的理论正常重构数据输入DTW评价模型，得到两者之间的重构误差，将重构误差与最优阈值进行比较，得到锂电池异常检测结果。进一步的，当计算得到的重构误差大于最优阈值时，则该单体电池判定为异常电池；当计算得到的重构误差小于最优阈值时，则该单体电池判定为正常电池。进一步的，获取锂电池生产过程中正常和异常的电池恒流充电电压时序数据，具体为：采集锂电池生产过程中，分选段中第一次充电过程的有人工标注的正常和异常电池恒流充电电压时序数据；其中，采集的数据中任意单条时序数据长度未经预处理前，长度分布在之间，即记录分选段电池充电过程中85-95分钟的数据，电压范围为0-4.0V。进一步的，对所述电池恒流充电电压时序数据进行数据预处理，具体为：首先，对采集到的数据中纯空数据集进行剔除；其次，通过数据清洗与直线插补的方法，将原始数据处理为各点对齐且每条曲线长度均为170的实验数据集，单条曲线记录分选段电池恒流充电结束前85分钟数据。进一步的，经LSTM改进后的VAE网络构成的重构模型依次包括输入层、第一长短时间记忆网络层、两个全连接层、lambda层、扩展层、第二长短时记忆网络层和输出层。进一步的，将所述模型训练集先输入至经LSTM改进后的VAE网络构成的重构模型中进行训练，确定模型中的超参数，从而确定重构模型；具体为：模型输入Xin为多组时间定长的电池分选段充电电压动态数据组成的高维张量，输入向量Xin＝其中xi，i∈为任一单体电池充电电压曲线向量；xi＝，uj为任一时刻的电池电压值,j∈；Xin输入输入层后，得到维度为的单时间序列张量Xbatch＝，其中，b为训练过程中的数据批次大小，t为单个时间序列长度；维度为的单时间序列张量经过第一长短时间记忆网络层编码处理后，对输入时序数据进行特征提取，将其降维为的向量；m为中间层维度；再经过全连接层变换，从上一层输入特征向量中得到输入批次中各时序数据分布的高斯混合模型分解参数矩阵，即均值矩阵μx与方差矩阵σx，其维度均为；h为隐层维度；之后输入至lambda层，引入标准正态分布中采样的随机变量ε，利用重参数化技巧公式整合两个参数矩阵，得到与输入向量一一对应的隐变量Z；再输入至扩展层，重复t次将隐层变量展开为的张量；再通过第二长短时记忆网络层，对时序数据特征进行复原，将扩展层张量复原为维度为的张量，实现解码完成对隐变量的重建，最后经过输出层对输出向量进一步处理，将m条张量拼接成维度为的张量输出，从而得到理论正常重构数据集Xbatch'＝；通过多批次训练确定模型中的超参数，从而确定重构模型。进一步的，重构模型构建完成后，将所述阈值训练集输入所述重构模型中获得理论正常重构数据集，将阈值训练集与对应的理论正常重构数据集输入到DTW评价模型中，得到阈值训练集与其对应的理论正常重构数据集之间的重构误差，根据所述重构误差确定最优阈值，从而确定DTW评价模型，具体为：将所述阈值训练集输入所述重构模型中，得到阈值训练集对应的理论正常重构数据集；将阈值训练集与对应的理论正常重构数据集输入到DTW评价模型中，利用动态时间规整算法得到阈值训练集与其对应的理论正常重构数据集之间的重构误差；分析所述阈值训练集中正常电池数据和异常电池数据对应的重构误差分布，利用数学规划找到能使异常电池数据分辨率最大的重构误差值，将其定义为最优阈值，从而确定DTW评价模型.本发明具有以下有益效果：本发明提供了一种集合变分自编码器与动态规整的锂电池异常检测方法，使用长短期记忆网络编解码器优化变分自编码器重构模型，保留时间序列特征的全局相关性，提高模型对时序数据的特征提取与重构能力。因为传统VAE模型利用普通人工神经网络搭建，在处理输入数据时，不会考虑输入时序数据的各时间点数据间的前后联系，而会将输入数据的每个时间点的数据作为同一权重不同特征的特征点进行处理。这样就会丧失时间序列数据本身数据间的全局相关性，使得网络对时序数据的特征提取过程中会出现特征损失。而且传统人工神经网络不存在遗忘门设置，将时序数据处理为高维向量，训练时保留高维向量每一维度的信息处理，效率低，处理速度慢。而LSTM是一种常用于处理时序数据的改进循环神经网络，其结构由输入门、输出门、遗忘门、记忆门组成，对输入时序数据各个时刻的长期记忆以及单个时刻的短期记忆信息的合理调控，实现了对输入数据的序列建模。故将LSTM引入VAE模型，一方面改善了对时序数据的特征提取能力，另一方面引入遗忘门/记忆门设置，提高了训练效率。本发明提供了一种集合变分自编码器与动态规整的锂电池异常检测方法，重构误差采用动态时间弯曲算法，使得重构误差在反映原始数据xi与生成数据xi'的距离的同时，考虑两组曲线在形态趋势上的相似性，提高模型对异常曲线的检测精度，并实现异常程度判定和异常缘由归因两大任务。动态时间弯曲算法是一种用于度量两时间序列间相似性的算法，它用满足一定条件的时间规整函数W描述两序列间的对应关系，并利用动态规划实现求解两序列匹配累计最小距离的任务。为提高异常检测方法对时序特征形态特征的敏感度，将引入动态时间弯曲算法来评价模型输入与重构数据间的重构误差，并由此分辨曲线异常。DTW可以综合考量序列间的趋势与距离变化，可以利用该特性实现异常序列的检测与评估。传统方法中基于重构模型的异常检测方法多利用均方根误差进行重构误差评价，但MSE不能反映曲线间形态特征的相似度。而使用DTW可以在电池电压曲线对象上有较高的异常分辨率。相较传统机器学习异常检测方法，采用本发明VAE-LSTM-DTW模型性能优越，综合指标F1值达到93％，较其中表现最优的单类支持向量机算法F1值提升21％；同时相较于传统VAE模型及VAE-DTW模型，准确率和F1值都得到了大幅提升。除了上面所描述的目的、特征和优点之外，本发明还有其它的目的、特征和优点。下面将参照图，对本发明作进一步详细的说明。附图说明构成本申请的一部分的附图用来提供对本发明的进一步理解，本发明的示意性实施例及其说明用于解释本发明，并不构成对本发明的不当限定。在附图中：图1是本发明提供的锂电池异常检测方法的步骤图；图2是本发明的锂电池异常检测模型的结构图；图3是本发明锂电池异常检测模型的具体执行流程图；图4是本发明提供的LSTM-VAE重构模型的结构图；图5是本发明中变分自编码器VAE模型的结构图；图6是本发明中LSTM模型的结构图；图7是锂电池充电过程第一类异常曲线图；图8是锂电池充电过程第二类异常曲线图；图9是锂电池充电过程第三类异常曲线图；图10传统VAE异常检测的效果分布图；图11为VAE-DTW异常检测的效果分布图；图12是本发明VAE-LSTM-DTW异常检测的效果分布图。具体实施方式以下结合附图对本发明的实施例进行详细说明，但是本发明可以根据权利要求限定和覆盖的多种不同方式实施。目前，深度学习作为一种强大的新型数据挖掘工具，在电池异常检测领域有很大的应用潜力。而其中，变分自编码器模型作为新兴的无监督深度学习方法最适应任务需求。VAE模型的模型结构图如图5所示。但传统的VAE模型在进行时序异常检测任务时，由于其网络结构限制，无法很好的保留时序全局相关性特征，因此面对充电电压时序数据这类变化较多时序较长的对象时检测结果往往不太理想。为更好实现锂电池生产工况异常检测，我们在传统VAE模型基础上改进，提出了VAE-LSTM-DTW模型。基于此，如图1所示，本发明提供了一种集合变分自编码器与动态规整的锂电池异常检测方法，包括以下步骤：步骤1、获取锂电池生产过程中正常和异常的电池恒流充电电压时序数据，具体为：采集锂电池生产过程中，分选段中第一次充电过程的有人工标注的正常和异常电池恒流充电电压时序数据。其中，由于不同电池原始性能不同，充电到指定容量的时间不等，故采集的数据集中任意单条时序数据长度未经预处理前，长度在之间，即记录分选段电池充电过程中85-95分钟的数据，电压范围为0-4.0V。在一个具体实施方式中，共采集12000条人工标注的正常电池充电时序数据，以及8000条人工标注的异常电池充电时序数据。实验采集数据中的正常数据对应的电池均经过企业检验合格后出厂，而异常电池均在后面的检测中出现容量损失，充电异常等问题。步骤2、对所述电池恒流充电电压时序数据进行数据预处理。因为受数据采集环境和现场操作影响，原始数据中存在着数据缺失，数据重复，数据不对齐等问题。故在使用数据前，我们需要对原始数据集进行预处理。首先，对采集到的数据中纯空数据集进行剔除；其次，通过数据清洗与直线插补的方法，将原始数据处理为各点对齐且每条曲线长度均为170的实验数据集。其中，单条曲线记录分选段电池恒流充电结束前85分钟数据，电压范围为0-4.0V。步骤3、将预处理后的数据划分为模型训练集、阈值训练集和测试集。其中，所述模型训练集中的数据均为正常电池数据，用于VAE-LSTM重构模型的训练；所述阈值训练集和所述测试集中包含正常电池数据和异常电池数据，且正常电池数据和异常电池数据的数量相等，所述阈值训练集用于确定异常检测分辨率最高的最优阈值，所述测试集用于测试异常检测效果。步骤4、利用python搭建VAE-LSTM-DTW模型结构。VAE-LSTM-DTW模型的结构如图2所示，其主要由两部分组成，经LSTM改进后的VAE网络构成的重构模型和DTW评价模型。其中，VAE-LSTM重构模型用于生成与输入数据集对应的理论正常重构数据集；DTW评价模型用于比对输入数据与生成样本间的相似度，并通过重构误差Ddtw指标评价筛选异常电池。步骤5、利用上述模型训练集进行模型训练，VAE-LSTM-DTW模型具体执行流程图如图3所示。首先，将所述模型训练集先输入至经LSTM改进后的VAE网络构成的重构模型中进行训练，确定各层模型参数，从而确定VAE-LSTM重构模型；VAE-LSTM模型框架图如图4所示。设定数据批次大小b，使用模型训练集对VAE-LSTM模型进行训练，训练损失函数为其中σj为单个隐变量z对应方差向量，μj为单个隐变量z对应均值向量。MSE中，x为每一批次输入时序数据，x'为重构后对应每一批次输出时序数据，MSE为输入输出的均方差，公式如下训练过程中使用经RMSProp优化的梯度下降算法寻找最小化损失函数的超参数，通过多批次数据输入迭代训练，找到最优超参数，从而确定重构模型。具体训练过程如下：模型输入Xin为多组时间定长的电池分选段充电电压动态数据组成的高维张量，输入向量Xin＝其中xi，i∈为任一单体电池充电电压曲线向量；xi＝，uj为任一时刻的电池电压值,j∈；Xin输入输入层后，得到维度为的单时间序列张量Xbatch＝，其中，b为训练过程中的数据批次大小，t为单个时间序列长度；维度为的单时间序列张量经过第一长短时间记忆网络层编码处理后，对输入时序数据进行特征提取，将其降维为的向量；m为中间层维度；再经过全连接层变换，从上一层输入特征向量中得到输入批次中各时序数据分布的高斯混合模型分解参数矩阵，即均值矩阵μx与方差矩阵σx，其维度均为；h为隐层维度；之后输入至lambda层，引入标准正态分布中采样的随机变量ε，利用重参数化技巧公式整合两个参数矩阵，得到与输入向量一一对应的隐变量Z；再输入至扩展层，重复t次将隐层变量展开为的张量；再通过第二长短时记忆网络层，对时序数据特征进行复原，将扩展层张量复原为维度为的张量，实现解码完成对隐变量的重建，最后经过输出层对输出向量进一步处理，将m条张量拼接成维度为的张量输出，从而得到理论正常重构数据集Xbatch'＝；通过多批次训练确定模型中的超参数，从而确定重构模型。步骤6、重构模型构建完成后，将所述阈值训练集输入所述重构模型中获得理论正常重构数据集，将阈值训练集与对应的理论正常重构数据集输入到DTW评价模型中，得到阈值训练集与其对应的理论正常重构数据集之间的重构误差Ddtw，根据所述重构误差确定最优阈值λ，从而确定DTW评价模型，具体为：首先准备阈值训练集，为减少因数据不平衡造成的阈值选择偏差，阈值训练集中将包含4000条正常充电时序数据与4000条异常充电时序数据；将所述阈值训练集输入所述重构模型中，得到阈值训练集对应的理论正常重构数据集；将阈值训练集与对应的理论正常重构数据集输入到DTW评价模型中，利用动态时间规整算法得到阈值训练集与其对应的理论正常重构数据集之间的重构误差Ddtw；分析所述阈值训练集中正常电池数据和异常电池数据对应的重构误差Ddtw分布，利用数学规划找到能使异常电池数据分辨率最大的重构误差值，将其定义为最优阈值λ，从而确定DTW评价模型。确定最优阈值后，评价模型构建完成。之后运行过程中，评价模型将通过比较输入数据集与其重构数据集间的重构误差Ddtw与阈值间的大小关系来判定输入数据是否存在异常。步骤7、所述测试集输入至训练好的VAE-LSTM-DTW模型中，首先经过重构模型得到测试集对应的理论正常重构数据集，后将测试集数据与对应的理论正常重构数据输入DTW评价模型，得到两者间的重构误差Ddtw，将重构误差Ddtw与最优阈值λ进行比较，得到锂电池异常检测结果。首先经过重构模型得到测试集对应的理论正常重构数据集，具体步骤如下：重构模型输入层为的单时间序列张量，其中b为训练过程中的数据批次大小，t为单个时间序列长度，h为隐层维度,m为中间层维度。模型输入Xin为多组时间定长的电池分选段充电电压动态数据组成的高维张量，输入向量Xin＝，其中xi，i∈为任一单体电池充电电压曲线向量。xi＝，uj为任一时刻的电池电压值,j∈。输入Xin在输入时将按批次大小规定，划分为多个批次输入，每次输入b个xi，组成维度为的输入张量Xbatch＝。建立长短时间记忆网络层，对输入时序数据进行特征提取，将其降维为的向量。分别建立两全连接层，经过全连接层变换，从上一层输入特征向量中得到输入批次中各时序数据分布的高斯混合模型分解参数矩阵，即均值矩阵μx与方差矩阵σx，其维度均为。建立lambda层，引入标准正态分布中采样的随机变量ε，利用重参数化技巧公式，由此整合两个参数矩阵可以得到与输入向量一一对应的维度为的隐变量Z。建立扩展层，重复t次将隐层变量展开为的张量。建立另一个长短时记忆网络层，对时序数据特征进行复原，将扩展层张量复原为维度为的张量。建立基于长短时记忆网络的输出层，对输出向量进一步处理，将m条张量拼接成维度为的张量输出,输出为Xbatch'＝，其中xi'，i∈为Xbatch＝中对应输入向量的重构向量。经过多批次训练后，可以得到输入的测试数据集Xin的理论正常重构数据集。将测试数据集与其对应的理论正常重构数据集输入评价模型，评价模型内部利用DTW对两者之间的重构误差Ddtw进行计算，并与最优阈值λ进行比较，得到锂电池异常检测结果。当计算得到的重构误差Ddtw大于最优阈值λ时，则该单体电池判定为异常电池；当计算得到的重构误差Ddtw小于最优阈值λ时，则该单体电池判定为正常电池。本发明提供了一种集合变分自编码器与动态规整的锂电池异常检测方法，使用LSTM编解码器优化VAE重构模型，使得模型可以充分提取时间序列特征，保留时间序列特征的全局相关性，提高模型对时序数据的特征提取与重构能力。因为传统VAE网络处理时序数据时，无法考量各时刻间的关联，故对时序数据的特征提取与重构能力效果较差。为更好完成对异常时间序列的检测任务，本算法中将引入长短期记忆网络替换传统VAE中的BP层来优化模型结构，借此提升VAE对时序数据的处理能力。如图6所示，LSTM是一种常用于处理时序数据的改进循环神经网络，其结构由输入门、输出门、遗忘门、记忆门组成。由图6中结构所示，Ct是t时刻的状态单元，为候选状态信息；ht是t时刻的隐藏状态信息；ft，it及ot依次为t时刻的遗忘门、输入门和输出门；Wc，Wf，Wi，Wo与bc，bf，bi，bo分别为其对应的权值矩阵和偏置项；σ和tanh为非线性激活函数。LSTM更新公式如公式和所示：利用状态单元Ct的储存与传递，以及门控单元对历史状态信息Ct-1和候选态信息的控制，完成了对输入时序数据各个时刻的长期记忆以及单个时刻的短期记忆信息的合理调控，实现了对输入数据的序列建模。综上，重构模型中，使用LSTM优化VAE模型，可以帮助模型充分提取时间序列特征，提升模型的特征提取与重构精度。将LSTM引入VAE模型，一方面改善了对时序数据的特征提取能力，另一方面引入遗忘门/记忆门设置，提高了训练效率。本发明提供了一种集合变分自编码器与动态规整的锂电池异常检测方法，重构误差采用动态时间弯曲算法，使得重构误差在反映原始数据xi与生成数据xi'的距离的同时，考虑两组曲线在形态趋势上的相似性，提高模型对异常曲线的检测精度，并实现异常程度判定，异常缘由归因两大任务。因为传统的VAE异常检测方法多利用均方根误差进行重构误差评价，但MSE不能反映曲线间形态特征的相似度。DTW是一种用于度量两时间序列间相似性的算法，它用满足一定条件的时间规整函数W描述两序列间的对应关系，并利用动态规划实现求解两序列匹配累计最小距离的任务。为提高异常检测方法对时序特征形态特征的敏感度，将引入动态时间弯曲算法来评价模型输入与重构数据间的重构误差，并由此分辨曲线异常。DTW原理如下：给定两条时间序列a＝和b＝，长度分别为m与n。为计算两序列DTW距离，首先需要构造距离矩阵Dn×m，如公式。其中，d为两时间序列中各点间的欧式距离。DTW算法规定在三条约束条件约束下寻找距离矩阵Dn×m中从起始点到终止点的最优路径W＝w1,w2,…wk≤k＜m+n-1)，三条约束条件如下：边界条件：该路径从w1＝开始，到wk＝结束，序列先后次序不能改变。连续性约束：两序列在匹配路径上的点与点的连线只能与其相邻点连接，保证路径有连续性。单调性约束：路径上某一点下一起始点一定是,或中的一个，保证路径单调。由上述条件约束下，在Dn×m中可以找到很多条规整路线，但为了得到最短最优的规整路线，可以利用迭代公式：E＝d+min{E,E,E} 由此公式进行迭代即可得到最短规整距离与最短路径。理论上，两条时间序列相似程度越高，序列间的DTW值会越小，且DTW可以综合考量序列间的趋势与距离变化，可以利用该特性实现异常序列的检测与评估。而传统方法中基于重构模型的异常检测方法多利用均方根误差进行重构误差评价，但MSE不能反映曲线间形态特征的相似度。而使用DTW可以在电池电压曲线对象上有较高的异常分辨率。为验证本发明的所提出的方法性能的优越性，在4000条包含正常与异常标签的锂电池充电数据集上，比较单类支持向量机、离群点检测，孤立森林三类常用机器学习异常检测方法以及基于LSTM的自编码器异常检测方法与本发明VAE-LSTM-DTW方法的异常检测效果进行对比分析，实验结果如表1所示。其中，对比指标我们选择常用的精度，准确率，召回率，F1值，其公式如下：式中TP为真正例，即将正常电池正确检测为正常的次数；FP为假正例，即将异常电池检测为正常的次数；FN为假负例，即将正常电池检测测为异常的次数；TN为真负例，即将异常电池正确预测为异常的次数。表1多种模型的对比结果由表1易见，前三类算法都是传统的机器学习算法，后两类为基于神经网络架构的深度学习算法。综合评价几种算法，F1值均在75％以下，其中表现最好的OCSVM在分类准确率上仅有67.2％，故传统的机器学习算法均无法满足该类数据异常检测的任务要求。深度学习算法在此类问题上的表现效果明显较佳，AE-LSTM除准确率仅有76％，相较表现较差外，精度和召回率均在85％以上，可以实现基本的异常检测任务，但综合指标F1值仅有84.3％表现不佳。本发明提出的异常检测方法VAE-LSTM-DTW在该测试集上对异常电池分选精度A与准确率P均在94％以上，且综合表现F1值达到93％。综上，VAE-LSTM-DTW方法在测试集上有很好的表现效果，比起传统异常检测方法以及部分深度学习算法而言，可以更好地完成异常电池检测任务。相较传统机器学习异常检测方法，VAE-LSTM-DTW模型性能优越，综合指标F1值达到93％，较其中表现最优的单类支持向量机算法F1值提升21％；同时相较于传统的VAE模型及VAE-DTW模型，准确率和F1值都得到了大幅提升。锂电池异常曲线由波动大小差异，利用DTW指标可将曲线分为三类异常曲线，将阈值训练集中的异常数据集带入对比实验训练后的VAE-LSTM-DTW模型后，可以得到所有曲线的重构误差Ddtw。从Ddtw分布易知，异常电池的Ddtw主要分布在三个区间即，，，我们把这三个区间的充电电压曲线分别视为第一类异常曲线、第二类异常曲线和第三类异常曲线。由实验可知，第一类异常曲线其曲线趋势与正常曲线相近，均能使曲线电压升至该段截止电压4V。第二类异常曲线虽然也有正常曲线一样的趋势，基本可达截止电压，但其曲线内波动很大，可能为电池内部存在缺陷或内部电化学性能未稳定导致的充电波动。第三类异常曲线基本不随时间变化，且充电曲线无法达到截止电压，说明电池内部或存在微短路，使得电池无法正常充放电使用。通过统计分析生产过程中产生的异常数据可得，在所有异常曲线集合中有83％的异常电池曲线分布在Ddtw≤2的范围内，属于第一类异常曲线；3％的异常电池曲线属于第二类异常曲线，13％的电池曲线属于第三类异常曲线。为更好表现VAE-LSTM-DTW算法在异常检测工作上的优越性能，我们在三类异常曲线上分别进行异常检测，检测指标指标我们选择常用的精度，准确率，召回率，F1值。实验结果如表2所示。表2实验结果对比从表2中三类异常数据的分类表现上来看，VAE及其改进算法在后两组异常数据上均表现较佳，可以很好的将异常曲线与正常曲线检测区分出来。故改进算法在后两组异常数据检测任务上无比较优势，但后两组数据在实际工况中占比较小，仅有16％。为更好比较各个模型在异常电池检测效果上的区别，需要对实际占比83％的第一类异常数据进行异常检测效果分析。传统VAE模型里利用均方根误差做重构误差筛选异常电池，其筛选结果如图10所示。可见其正常曲线分布与异常曲线分布重叠很深，异常检测分类效果较差。如表2所示，该模型在第一组异常数据精度仅有69％，综合指标F1值也仅有79％。从三组异常数据上来看，传统VAE算法各项指标表现很差，精度、准确率仅有70％左右，综合指标F1值也仅有79％，不能很好的完成异常检测任务。可见仅通过MSE无法将异常电池与正常曲线区分开，与传统机器学习算法比较也无明显优势。利用DTW改进后重构评价指标的VAE-DTW模型在异常检测效果上效果有很大的提升，正常数据与异常数据区分度比改进前高，如图11所示。由表2也可见，准确率、召回率等指标均达到了90％，以上，综合指标F1值达到91％。对比传统VAE模型，说明在该数据集上使用DTW作为重构评价指标的效果更好，更能全面反映正常曲线与异常曲线间的特征差异。最后，在上述改进基础上利用LSTM进行VAE内部模型改进，建立VAE-LSTM-DTW模型进行异常检测效果比对。效果如图12所示，可见在继承了VAE-DTW模型的检测效果基础上，VAE-LSTM-DTW模型更进一步，减小了正常数据与异常数据分布的方差，增大了两类数据均值间的距离从而进一步提高了模型的分辨率。表2所示的各类指标均比VAE-DTW模型有1％-3％的提升。综合三类异常数据的整体表现上，F1值也达到了93％，效果最佳，可见利用LSTM改进VAE模型可以提高其对时序数据的特征提取能力。综上，发明提出的VAE-LSTM-DTW模型不论在整体表现，还是在三类异常数据的独立检测处理上均有较优表现，且模型各部分组成均可以达到加强模型特征提取能力、提高模型异常检测能力的效果。相较传统机器学习异常检测方法，采用本发明VAE-LSTM-DTW模型性能优越，综合指标F1值达到93％，较其中表现最优的单类支持向量机算法F1值提升21％；同时相较于传统VAE模型及VAE-DTW模型，准确率和F1值都得到了大幅提升。以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
