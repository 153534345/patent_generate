标题title
一种基于双目视觉的激光定位与标注方法及产品和应用
摘要abst
本发明公开了一种基于双目视觉的激光定位与标注方法及产品和应用，先预设被投影实物与需要投影的内容，通过双目相机实时录制视频，从视频流中找到需要被投影的物体，得到投影目标在双目相机下的图片像素坐标；通过双目相机模型进行三维重建，得到特征点的深度信息，随后计算被投影物体在世界坐标系下的全局坐标；依据平面假设，将被投影的物体的世界坐标投影至标定平面上，计算需要被投影的物体在标定平面下的二维坐标并转换成所需振镜坐标，最后进行激光投影。本发明将AR视觉定位于标注系统，将激光线精确、无接触式的投射到各种曲面表面或异形物体上，无需操作人员佩戴额外设备，能快速、精确、充满自信地定位部件，填补我国相关技术的空白。
权利要求书clms
1.一种基于双目视觉的激光定位与标注方法，其特征在于，先预设被投影实物与需要投影的内容，通过双目相机实时录制视频，从视频流中找到需要被投影的物体，得到投影目标在双目相机的每个相机下的图片像素坐标；随后通过双目相机模型进行三维重建，得到特征点的深度信息，再计算被投影物体在以激光发射口为坐标原点建立的世界坐标系下的全局坐标；随后依据平面假设，将被投影的物体的世界坐标投影至标定平面上，计算需要被投影的物体在标定平面下的二维坐标并转换成所需振镜坐标，最后进行激光投影。2.根据权利要求1所述的一种基于双目视觉的激光定位与标注方法，其特征在于，包括以下步骤：步骤一、预设被投影实物与需要投影的内容步骤二、视频流目标检测双目相机的内参与畸变参数预先标定好；投影设备启动后，通过双目相机实时收录视频流，通过对每一帧视频流的分析，判断当前视野中是否存在需要被投影的物体，待从视频流中找到需要被投影的物体，得到投影目标在双目相机的每个相机下的图片像素坐标，再计算得到需要被投影的物体在双目相机中的位置与特征点的坐标；步骤三、双目相机深度估计通过双目视觉技术确定需要被投影的物体的空间位置；通过双目相机模型进行三维重建，得到特征点的深度信息，结合双目相机的标定参数，即可得到需要被投影的物体的特征点在以激光发射口为坐标原点建立的世界坐标系下的全局坐标；步骤四、标定与投影平面构建在投影范围中选定一个基准面，并进行标定，通过双目相机的标定参数及双目相机模型计算得到标定平面上的特征点以激光发射口为坐标原点建立的世界坐标系下的三维坐标，最终获取在标定平面上，三维坐标至二维标定平面坐标的换算关系；步骤五、根据标定信息计算投影坐标对需要被投影的物体的本体，建立本体坐标系，需要投影的图案通过离散点的形式定义在本体坐标系下，通过需要被投影的物体本体的特征点在本体坐标系下的坐标与世界坐标系下的坐标的换算，得到本体坐标系与世界坐标系的转换关系，获取需要投影的图案的离散点在世界坐标系下的坐标值，随后通过视锥投影将离散点投影至标定平面中，随后将投影在标定平面的坐标变换为标定平面下的二维坐标，再变换为所需振镜坐标；步骤六、激光投影激光束入射到两个反射镜上，控制反射镜的反射角度，达到激光束的偏转，使激光聚焦点在打标材料上按所需的要求运动。3.根据权利要求2所述的一种基于双目视觉的激光定位与标注方法，其特征在于，步骤二中，双目相机中左相机和右相机标定内参分别为kL、kR，投影设备启动后，分别通过双目相机实时收录视频流，通过对每一帧视频流的分析，判断当前视野中是否存在需要被投影的物体的本体，当检测到需要被投影的物体的本体后，获取需要被投影的物体的图片像素二维坐标，左相机得到一组特征点：右相机得到一组特征点：进而，得到相机坐标系下需要被投影的物体的特征点在双目相机的左相机和右相机中的坐标：左相机：右相机：。4.根据权利要求2所述的一种基于双目视觉的激光定位与标注方法，其特征在于，步骤三中，双目相机外参矩阵为，需要被投影的物体的特征点在世界坐标系下的全局坐标为：其中，为世界坐标系，为相机坐标系，；进而得到下列公式：其中，Z为通过双目相机模型获得的深度信息。5.根据权利要求2所述的一种基于双目视觉的激光定位与标注方法，其特征在于，步骤四中，使用一个以左上角为原点的一个满是圆圈的Halcon标定板作为标定板进行标定，将Halcon标定板放置在投影范围内，标定板圆点全局坐标与标定板坐标的变换关系Pcal；假设标定板圆点全局坐标为，标定板坐标，得到：Halcon标定板上任意不共线的三点的全局坐标分别为、，则，则平面法线为：通过平面法线与该平面上的任意一点P0即可表述一个平面：。6.根据权利要求2所述的一种基于双目视觉的激光定位与标注方法，其特征在于，步骤五中，需要被投影的物体的本体坐标系，特征点在本体坐标系下的坐标为，得到本体坐标系与世界坐标系的变换关系为：预先定义的需要被投影的物体的本体坐标为，则其在世界坐标系下的坐标为：平面中的直线的表达式为：其中，为直线的方向向量，为直线上任意一点，此处取原点，为实数空间，d为实数范围的标量；由于世界坐标系以激光发射口为坐标原点，激光线从坐标原点发出，故将平面中的直线的表达式简化为：带入平面方程后得到：直线的方向向量为：将投影点从齐次坐标转为普通坐标，得到激光线与标定面的交点为：随后，得到在标定平面下的二维坐标为：最后，变换为所需振镜坐标：其中，为软件中定义的投影图案的齐次坐标。7.一种基于双目视觉的激光定位与标注装置，其特征在于，采用权利要求1-6任一所述的一种基于双目视觉的激光定位与标注方法进行激光定位与标注。8.一种根据权利要求1-6任一所述的基于双目视觉的激光定位与标注方法在机械、精密设备制造、建筑、装修、艺术创作领域中的应用。
说明书desc
技术领域本发明属于激光定位与标注技术领域，具体涉及一种基于双目视觉的激光定位与标注方法及产品和应用。背景技术近年来，中国产业国际竞争力大幅提升，产业基础更加牢固，但总体上仍处于工业化中期，制造业主要还是靠人力堆叠为主。大型复杂工程的实施与设备的生产，往往对于人员的实施精度与配合有着严格的要求。对于大型设备或装置制造过程中的定位问题往往存在效率过低、精度不足的问题。如何利用增强现实技术解决上述问题成为人们的研究热点。在此之前，业界曾经做过相关尝试，如以谷歌为主导的AR眼镜，但由于技术不成熟，且需要较大的培训与应用成本等问题，此类AR眼镜并没有大规模商用过。目前国内尚未有相关产品，国外以WERKLICHT®PRO、ProDirector XS2为主，价格不低于60万元，WERKLICHT®PRO产品价格高达180万元之多，对于中小企业来说使用成本高昂，而ProDirector XS2产品对齐需靶标，且不可自动跟踪投影对象，实用性和功能性有待改进。发明内容为解决现有技术中的问题，本发明的目的在于提供一种基于双目视觉的激光定位与标注方法及产品和应用。为实现上述目的，达到上述技术效果，本发明采用的技术方案为：一种基于双目视觉的激光定位与标注方法，先预设被投影实物与需要投影的内容，通过双目相机实时录制视频，从视频流中找到需要被投影的物体，得到投影目标在双目相机的每个相机下的图片像素坐标；随后通过双目相机模型进行三维重建，得到特征点的深度信息，再计算被投影物体在以激光发射口为坐标原点建立的世界坐标系下的全局坐标；随后依据平面假设，将被投影的物体的世界坐标投影至标定平面上，计算需要被投影的物体在标定平面下的二维坐标并转换成所需振镜坐标，最后进行激光投影。进一步的，包括以下步骤：步骤一、预设被投影实物与需要投影的内容步骤二、视频流目标检测双目相机的内参与畸变参数预先标定好；投影设备启动后，通过双目相机实时收录视频流，通过对每一帧视频流的分析，判断当前视野中是否存在需要被投影的物体，待从视频流中找到需要被投影的物体，得到投影目标在双目相机的每个相机下的图片像素坐标，再计算得到需要被投影的物体在双目相机中的位置与特征点的坐标；步骤三、双目相机深度估计通过双目视觉技术确定需要被投影的物体的空间位置；通过双目相机模型进行三维重建，得到特征点的深度信息，结合双目相机的标定参数，即可得到需要被投影的物体的特征点在以激光发射口为坐标原点建立的世界坐标系下的全局坐标；步骤四、标定与投影平面构建在投影范围中选定一个基准面，并进行标定，通过双目相机的标定参数及双目相机模型计算得到标定平面上的特征点以激光发射口为坐标原点建立的世界坐标系下的三维坐标，将被投影的物体的世界坐标投影至标定平面上，最终获取在标定平面上，三维坐标至二维标定平面坐标的换算关系；步骤五、根据标定信息计算投影坐标对需要被投影的物体的本体，建立本体坐标系，需要投影的图案通过离散点的形式定义在本体坐标系下，通过需要被投影的物体本体的特征点在本体坐标系下的坐标与世界坐标系下的坐标的换算，得到本体坐标系与世界坐标系的转换关系，获取需要投影的图案的离散点在世界坐标系下的坐标值，随后通过视锥投影将离散点投影至标定平面中，随后将投影在标定平面的坐标变换为标定平面下的二维坐标，再变换为所需振镜坐标；步骤六、激光投影激光束入射到两个反射镜上，控制反射镜的反射角度，达到激光束的偏转，使激光聚焦点在打标材料上按所需的要求运动。进一步的，步骤二中，双目相机中左相机和右相机标定内参分别为kL、kR，投影设备启动后，分别通过双目相机实时收录视频流，通过对每一帧视频流的分析，判断当前视野中是否存在需要被投影的物体的本体，当检测到需要被投影的物体的本体后，获取需要被投影的物体的图片像素二维坐标，左相机得到一组特征点：右相机得到一组特征点：进而，得到相机坐标系下需要被投影的物体的特征点在双目相机的左相机和右相机中的坐标：左相机：右相机：。进一步的，步骤三中，双目相机外参矩阵为，需要被投影的物体的特征点在世界坐标系下的全局坐标为：其中，为世界坐标系，为相机坐标系，；进而得到下列公式：其中，Z为通过双目相机模型获得的深度信息。进一步的，步骤四中，使用一个以左上角为原点的一个满是圆圈的Halcon标定板作为标定板进行标定，将Halcon标定板放置在投影范围内，标定板圆点全局坐标与标定板坐标的变换关系Pcal；假设标定板圆点全局坐标为，标定板坐标，得到：Halcon标定板上任意不共线的三点的全局坐标分别为、，则，则平面法线为：通过平面法线与该平面上的任意一点P0即可表述一个平面：。进一步的，步骤五中，需要被投影的物体的本体坐标系，特征点在本体坐标系下的坐标为，得到本体坐标系与世界坐标系的变换关系为：预先定义的需要被投影的物体的本体坐标为，则其在世界坐标系下的坐标为：平面中的直线的表达式为：其中，为直线的方向向量，为直线上任意一点，此处取原点，为实数空间，d为实数范围的标量；由于世界坐标系以激光发射口为坐标原点，激光线从坐标原点发出，故将平面中的直线的表达式简化为：带入平面方程后得到：直线的方向向量为：将投影点从齐次坐标转为普通坐标，得到激光线与标定面的交点为：随后，得到在标定平面下的二维坐标为：最后，变换为所需振镜坐标：其中，为软件中定义的投影图案的齐次坐标。本发明公开了一种基于双目视觉的激光定位与标注装置，采用基于双目视觉的激光定位与标注方法进行激光定位与标注。本发明公开了一种基于双目视觉的激光定位与标注方法在机械、精密设备制造、建筑、装修、艺术创作领域中的应用。与现有技术相比，本发明的有益效果为：本发明公开了一种基于双目视觉的激光定位与标注方法及产品和应用，先预设被投影实物与需要投影的内容，通过双目相机实时录制视频，从视频流中找到需要被投影的物体，得到投影目标在双目相机的每个相机下的图片像素坐标；随后通过双目相机模型进行三维重建，得到特征点的深度信息，再计算被投影物体在以激光发射口为坐标原点建立的世界坐标系下的全局坐标；随后依据平面假设，将被投影的物体的世界坐标投影至标定平面上，计算需要被投影的物体在标定平面下的二维坐标并转换成所需振镜坐标，最后进行激光投影。本发明提供的一种基于双目视觉的激光定位与标注方法及产品和应用，将AR视觉定位于标注系统，将激光线精确、无接触式的投射到各种曲面表面或异形物体上，无需操作人员佩戴额外设备，无需任何培训，能够让相关人员快速、精确、充满自信地定位部件；此外，基于投影技术，也能为工业培训、工业巡检与远程协助提供巨大的便利；虽然国外存在类似产品，但其售价过于高昂，且功能单一，并没有普遍应用于我国的工业市场中，本发明填补了我国相关技术产品的空白；本发明所得产品支持CAD、SVG等多种建档方式，支持关键点设定的定位方式，简化建档流程，支持无靶标对齐，每米间距可达0.1毫米，可自动识别投影对象，且跟踪投影对象位置，在机械、精密设备制造、建筑、装修、艺术创作等领域应用广泛，具有广阔的发展前景。附图说明图1为本发明的流程图；图2为本发明的基于双目视觉的激光定位与标注装置的前视图；图3为本发明的基于双目视觉的激光定位与标注装置的电路连接框图。具体实施方式下面结合附图对本发明进行详细阐述，以使本发明的优点和特征能更易于被本领域技术人员理解，从而对本发明的保护范围做出更为清楚明确的界定。以下给出一个或多个方面的简要概述以提供对这些方面的基本理解。此概述不是所有构想到的方面的详尽综览，并且既非旨在指认出所有方面的关键性或决定性要素亦非试图界定任何或所有方面的范围。其唯一的目的是要以简化形式给出一个或多个方面的一些概念以为稍后给出的更加详细的描述之序。在本发明的描述中，需要说明的是，术语“顶部”、“底部”、“左”、“右”、“上”、“下”、“竖直”、“水平”、“内”、“外”等指示的方位或位置关系为基于附图所示的方位或位置关系，或者是该发明产品使用时惯常摆放的方位或位置关系，仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本发明的限制。如图1-3所示，一种基于双目视觉的激光定位与标注方法，先预设被投影实物与需要投影的内容，通过双目相机实时录制视频，从视频流中找到需要被投影的物体，得到投影目标在双目相机的每个相机下的图片像素坐标；随后通过双目相机模型进行三维重建，得到特征点的深度信息，再计算被投影物体在以激光发射口为坐标原点建立的世界坐标系下的全局坐标；随后依据平面假设，将被投影的物体的世界坐标投影至标定平面上，计算需要被投影的物体在标定平面下的二维坐标并转换成所需振镜坐标，最后进行激光投影，利用投影设备投射已经提取好线条的预设模版到实物上。简言之，输入的是需要投影的图案的xyz坐标，也即需要转换成二维的振镜坐标才能进行投影。而输入图案的xyz坐标是被投影物体的本体坐标系下的坐标。被投影物体本体在双目相机的左、右相机的视频流中被检测到以后，通过标定好的相机的内、外参数与双目相机模型，计算出被投影物体本体的特征点在世界坐标系下的坐标。在相应软件中定义被投影物体特征点在本体坐标系下的坐标，得到本体坐标系与世界坐标系对应的转换关系。需要输入的坐标是二维的，使用的标定板是一个以左上角为原点的一个满是圆圈的Halcon标定板，于是就可以得到振镜坐标与空间中的一个确定的平面的坐标转换关系。而标定平面上的每一个圆圈的中心点，又可通过相机的内外参数与双目相机模型计算出在世界坐标系下的三维坐标，便可通过这两组坐标求得在该平面上，三维坐标至二维标定平面坐标的换算关系。由于发出的激光是一条直线，要计算投影的图案上的某一点的坐标，只要计算该点在世界坐标系下与原点形成的直线，与标定平面的交点，并且将该交点转换至标定坐标系下，再由标定坐标系至振镜坐标系变换，即可得到最终需要输入给振镜控制器的坐标，具体包括以下步骤：步骤一、预设被投影实物与需要投影的内容步骤二、视频流目标检测双目相机的内参与畸变参数预先标定好；投影设备启动后，通过双目相机分别开始实时收录视频流并传送至CPU单元，通过对每一帧视频流的分析，判断当前视野中是否存在需要被投影的物体的本体，待从视频流中找到需要被投影的物体，得到投影目标在双目相机的每个相机下的图片像素坐标，再计算得到需要被投影的物体在双目相机中的位置与特征点的坐标；在用户提供CAD图档的情况下，可使用Canny算子对每一帧的图像进行边缘提取、角点提取、拟合等，再与CAD图档中的信息进行匹配，从而得到被投影物体的坐标信息；在用户无法提供CAD图档或对实时性有较高要求，或传统方法检测效果不佳时，使用深度学习卷积神经网络的方法对目标进行追踪。这一步后可以得到被投影物体在左、右两个相机中的位置与特征点的坐标；设标定板坐标振镜坐标振镜输入的坐标是二维坐标，使用的标定板是一个以左上角为原点的一个满是圆圈的Halcon标定板，Halcon标定板本身也存在一个坐标系，左上角的圆点为“原点”，每个圆点间距为1，往右为X轴正方向，往下为Y轴正方向，如第一行第二列的圆点的坐标为。标定板坐标与振镜坐标的变换矩阵为H1，逆变换矩阵为H1-1。相机坐标系世界坐标图片像素坐标左、右相机标定后可得内参kL、kR；需要被投影的物体的本体坐标目标检测后得到一组特征点：左相机：右相机：随后，即可得到相机坐标系下对应特征点的坐标：左相机：右相机：。步骤三、双目相机深度估计由于相机在投影设备中的位置固定，相机的内参与畸变参数都在前期标定好，之后通过双目视觉技术确定物体的空间位置。通过双目相机模型进行三维重建，得到特征点的深度信息，结合双目相机的标定参数，即可得到需要被投影的物体本体的特征点在以激光发射口为坐标原点建立的世界坐标系下的全局坐标；通过双目相机模型获得深度信息Z：其中，f为焦距，b为双目相机之间的距离，UL、UR分别为左、右相机成像平面下特征点至中心的距离。设相机外参，双目相机外参矩阵为，则通过相机外参获得的特征点的全局坐标为：进而，得到下列公式：。步骤四、标定与投影平面构建在投影范围中选定一个基准面，并进行标定，通过双目相机的标定参数及双目相机模型计算得到标定平面上的特征点以激光发射口为坐标原点建立的世界坐标系下的三维坐标，最终获取在标定平面上，三维坐标至二维标定平面坐标的换算关系；将标定板放置在投影范围内，得到：左相机内参kL、右相机内参kR；左相机外参、右相机外参；标定板坐标与振镜坐标的变换矩阵H1；标定板圆点全局坐标与标定板坐标的变换关系Pcal。设标定板圆点全局坐标为，标定板坐标，得到：设标定板上任意不共线的三点的全局坐标为、，则，进而得到平面法线：P0为平面上的一个点，该平面法线与平面上的任意一点P0即可表述一个平面:，不需要求出具体表达式，P0可选为X0。步骤五、根据标定信息计算投影坐标对需要被投影的物体的本体，建立本体坐标系，需要投影的图案通过离散点的形式定义在本体坐标系下，通过需要被投影的物体本体的特征点在本体坐标系下的坐标与世界坐标系下的坐标的换算，得到本体坐标系与世界坐标系的转换关系，获取需要投影的图案的离散点在世界坐标系下的坐标值，随后通过视锥投影将离散点投影至标定平面中，随后将投影在标定平面的坐标变换为标定平面下的二维坐标，再变换为所需振镜坐标；需要被投影的物体的本体坐标系，特征点在本体坐标系下的坐标为，得到本体坐标系与世界坐标系的变换关系为。预先定义的需要被投影的物体的本体坐标为，则其在世界坐标系下的坐标为：平面中的直线的表达式为：其中，为直线的方向向量，为直线上任意一点，此处取原点。为实数空间，d为实数范围的标量。由于世界坐标系以激光发射口为坐标原点，而激光线从坐标原点发出，所以平面中的直线的表达式可简化为：将直线带入平面方程，得将投影点从齐次坐标转为普通坐标，得到激光线与标定面的交点为：随后，得到在标定平面下的二维坐标为：最后，变换为所需振镜坐标：其中，为软件中定义的投影图案的齐次坐标。步骤六、激光投影激光束入射到两个反射镜上，控制反射镜的反射角度，达到激光束的偏转，使激光聚焦点在打标材料上按所需的要求运动。本发明公开了一种基于双目视觉的激光定位与标注装置，采用双目视觉对需要标记的物体进行三维重建，之后投射激光将需要标记的图案投射至需要标记的物体上进行标记，该装置包括电源、左相机、右相机、振镜、振镜驱动与保护单元、计算与控制单元和激光发射器，左相机和右相机分别与计算与控制单元连接，通过左、右双目相机进行视频采集并传送至计算与控制单元进行分析和处理，便于检测到需要的被投影物体，计算与控制单元连接振镜驱动与保护单元再连接振镜，通过计算与控制单元控制振镜改变出射角度，激光发射器发出的激光束通过振镜和反射镜再入射至物体上，如图2-3所示。本发明公开的一种基于双目视觉的激光定位与标注方法，在机械、精密设备制造、建筑、装修、艺术创作领域中的应用广泛，弥补了国内相关技术的空白。本发明未具体描述的部分采用现有技术即可，在此不做赘述。以上所述仅为本发明的实施例，并非因此限制本发明的专利范围，凡是利用本发明说明书内容所作的等效结构或等效流程变换，或直接或间接运用在其他相关的技术领域，均同理包括在本发明的专利保护范围内。
