标题title
主设备与子设备通信方法及系统
摘要abst
本发明公开了一种主设备与子设备通信方法及系统。方法包括：S1、子设备开始计时，等待接收主设备发送的指令；S2、若子设备接收到指令，则判断子设备的指令表中是否存在该指令；S3、若指令表中存在该指令，则指令频数值增加一位，并从该指令的缓存区获取应答指令数据，将应答指令数据发送至主设备；S4、若指令表中不存在该指令，则将该指令加入指令表中，并将该指令的频数值赋值1以及该指令的权值赋值1，转发该指令给机器，并将机器的应答指令数据发送至主设备；S5、子设备计时结束，将每个指令的频数值赋值给对应的指令权值，再重新开始计时。本发明减少子设备转发指令给机器的时间和机器应答指令到子设备时间，提高响应指令速度。
权利要求书clms
1.主设备与子设备通信方法，其特征在于，包括以下步骤：S1、子设备开始计时，等待接收主设备发送的指令；S2、若子设备接收到指令，则判断子设备的指令表中是否存在该指令；S3、若指令表中存在该指令，则指令频数值增加一位，并从该指令的缓存区获取应答指令数据，将应答指令数据发送至主设备；S4、若指令表中不存在该指令，则将该指令加入指令表中，并将该指令的频数值赋值1以及该指令的权值赋值1，转发该指令给机器，并将机器的应答指令数据发送至主设备；S5、子设备计时结束，将每个指令的频数值赋值给对应的指令权值，再重新开始计时。2.根据权利要求1所述的主设备与子设备通信方法，其特征在于，所述步骤S2中判断子设备的指令表中是否存在该指令的步骤为：赋值基数值为0；开始第一次遍历指令表，获取指令表的第一个指令，若该指令的权值大于该基数值，则发送该指令到机器，然后等待接收机器的应答指令报文，在接收到机器的应答指令报文后，保存到指令表中对应的应答数据区；再获取指令表的第二指令，直到遍历整个指令表结束。3.根据权利要求2所述的主设备与子设备通信方法，其特征在于，在第一次遍历指令表结束后，基数值变为1，开始二次遍历指令表，获取指令表的第一个指令，若该指令的权值大于该基数值，那么发送该指令到机器，等待接收机器的应答指令报文，在接收到机器的应答指令报文后，保存到指令表中对应的应答数据区；再获取指令表的第二指令，直到遍历整个指令表结束。4.一种根据权利要求1-3任意一项所述主设备与子设备通信方法的系统，其特征在于，计时模块，用于子设备开始计时，等待接收主设备发送的指令，以及子设备计时结束，将每个指令的频数值赋值给对应的指令权值，再重新开始计时；判断模块，用于若子设备接收到指令，则判断子设备的指令表中是否存在该指令；获取模块，用于若指令表中存在该指令，则指令频数值增加一位，并从该指令的缓存区获取应答指令数据，将应答指令数据发送至主设备；发送模块，用于若指令表中不存在该指令，则将该指令加入指令表中，并将该指令的频数值赋值1以及该指令的权值赋值1，转发该指令给机器，并将机器的应答指令数据发送至主设备。
说明书desc
技术领域本发明涉及通信技术领域，更具体地说，特别涉及主设备与子设备通信方法及系统。背景技术通常物联网设备间通信系统拓扑如图1所示，主要包含主设备101，一个或多个子设备102，与子设备配套的一个或多个机器103，及其指令。其中机器复杂度越高，指令就越多。主设备101与子设备102的通信介质可以是zigbee、WiFi或RS485，而子设备与机器的通信介质有RS232、TTL或RS485。其中子设备102实现不同通信介质的转发功能，主设备101获取机器的数据时，需要先发送机器指令到子设备102，子设备102再转发该指令给机器，机器响应该指令后，发送应答指令给子设备102，子设备102收到机器的应答指令后，再转发应答指令给网关。现有物联网设备间通信系统中，子设备采用转发功能，可以满足机器的多样化。然而当机器的数据量比较大时，主设备获取到机器数据的时间延时比较大；主设备获取机器数据的时间=发送指令到子设备时间t1+子设备转发指令给机器时间t2+机器应答指令到子设备时间t3+子设备转发应答指令给主主设备的时间t4。基于以上通信方式的不足，确有必要提供一种主设备与子设备通信方法及系统。发明内容本发明的目的在于提供一种主设备与子设备通信方法及系统，以克服现有技术所存在的缺陷。为了达到上述目的，本发明采用的技术方案如下：主设备与子设备通信方法，包括以下步骤：S1、子设备开始计时，等待接收主设备发送的指令；S2、若子设备接收到指令，则判断子设备的指令表中是否存在该指令；S3、若指令表中存在该指令，则指令频数值增加一位，并从该指令的缓存区获取应答指令数据，将应答指令数据发送至主设备；S4、若指令表中不存在该指令，则将该指令加入指令表中，并将该指令的频数值赋值1以及该指令的权值赋值1，转发该指令给机器，并将机器的应答指令数据发送至主设备；S5、子设备计时结束，将每个指令的频数值赋值给对应的指令权值，再重新开始计时。进一步地，所述步骤S2中判断子设备的指令表中是否存在该指令的步骤为：赋值基数值为0；开始第一次遍历指令表，获取指令表的第一个指令，若该指令的权值大于该基数值，则发送该指令到机器，然后等待接收机器的应答指令报文，在接收到机器的应答指令报文后，保存到指令表中对应的应答数据区；再获取指令表的第二指令，直到遍历整个指令表结束。进一步地，在第一次遍历指令表结束后，基数值变为1，开始二次遍历指令表，获取指令表的第一个指令，若该指令的权值大于该基数值，那么发送该指令到机器，等待接收机器的应答指令报文，在接收到机器的应答指令报文后，保存到指令表中对应的应答数据区；再获取指令表的第二指令，直到遍历整个指令表结束。本发明还提供一种根据上述主设备与子设备通信方法的系统，包括：计时模块，用于子设备开始计时，等待接收主设备发送的指令，以及子设备计时结束，将每个指令的频数值赋值给对应的指令权值，再重新开始计时；判断模块，用于若子设备接收到指令，则判断子设备的指令表中是否存在该指令；获取模块，用于若指令表中存在该指令，则指令频数值增加一位，并从该指令的缓存区获取应答指令数据，将应答指令数据发送至主设备；发送模块，用于若指令表中不存在该指令，则将该指令加入指令表中，并将该指令的频数值赋值1以及该指令的权值赋值1，转发该指令给机器，并将机器的应答指令数据发送至主设备。与现有技术相比，本发明的优点在于：本发明通过对子设备增加频率算法，预判接收到机器指令，提前获取机器指令的应答指令数据，待接收到主设备发送的机器指令，直接返回该指令的应答指令数据，减少子设备转发指令给机器的时间t2和机器应答指令到子设备时间t3，提高响应指令速度。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是通常物联网设备间通信系统拓扑图。图2是本发明的实现流程图。图3是本发明中判断子设备的指令表中是否存在指令的流程图。图4是本发明的主设备与子设备通信系统原理图。具体实施方式下面结合附图对本发明的优选实施例进行详细阐述，以使本发明的优点和特征能更易于被本领域技术人员理解，从而对本发明的保护范围做出更为清楚明确的界定。参阅图1-图3所示，本发明提供一种主设备与子设备通信方法，包括以下步骤：步骤S1、子设备开始计时，等待接收主设备发送的指令；步骤S2、若子设备接收到指令，则判断子设备的指令表中是否存在该指令。其中，判断子设备的指令表中是否存在该指令：是每次遍历一次指令表，则基数值+1，通过指令的权值与基数值做比较，决定发送该指令到机器的周期，具体包括：赋值基数值为0；开始第一次遍历指令表，获取指令表的第一个指令，若该指令的权值大于该基数值，则发送该指令到机器，然后等待接收机器的应答指令报文，在接收到机器的应答指令报文后，保存到指令表中对应的应答数据区；再获取指令表的第二指令，直到遍历整个指令表结束。在第一次遍历指令表结束后，基数值变为+1，开始二次遍历指令表，获取指令表的第一个指令，若该指令的权值大于该基数值，那么发送该指令到机器，等待接收机器的应答指令报文，在接收到机器的应答指令报文后，保存到指令表中对应的应答数据区；再获取指令表的第二指令，直到遍历整个指令表结束。如此循环，直到所有的指令权值都小于基数值时，则赋值基数值为0，重复第一次遍历指令表的步骤重新开始遍历指令表。步骤S3、若指令表中存在该指令，则指令频数值增加一位，并从该指令的缓存区获取应答指令数据，将应答指令数据发送至主设备；步骤S4、若指令表中不存在该指令，则将该指令加入指令表中，并将该指令的频数值赋值1以及该指令的权值赋值1，转发该指令给机器，并将机器的应答指令数据发送至主设备；步骤S5、子设备计时结束，将每个指令的频数值赋值给对应的指令权值，再重新开始计时。子设备的应答流程包括：子设备处理接收到主设备发送的指令后，根据指令表是否有该指令，决定是否使用该指令表的应答数据区的应答数据返回给主设备。参阅图4所示，本发明还提供一种根据上述主设备与子设备通信方法的系统，包括：计时模块1，用于子设备开始计时，等待接收主设备发送的指令，以及子设备计时结束，将每个指令的频数值赋值给对应的指令权值，再重新开始计时；判断模块2，用于若子设备接收到指令，则判断子设备的指令表中是否存在该指令；获取模块3，用于若指令表中存在该指令，则指令频数值增加一位，并从该指令的缓存区获取应答指令数据，将应答指令数据发送至主设备；发送模块4，用于若指令表中不存在该指令，则将该指令加入指令表中，并将该指令的频数值赋值1以及该指令的权值赋值1，转发该指令给机器，并将机器的应答指令数据发送至主设备。本发明通过对子设备增加频率算法，预判接收到机器指令，提前获取机器指令的应答指令数据，待接收到主设备发送的机器指令，直接返回该指令的应答指令数据，减少子设备转发指令给机器的时间t2和机器应答指令到子设备时间t3，提高响应指令速度。虽然结合附图描述了本发明的实施方式，但是专利所有者可以在所附权利要求的范围之内做出各种变形或修改，只要不超过本发明的权利要求所描述的保护范围，都应当在本发明的保护范围之内。
