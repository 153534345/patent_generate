标题title
一种多模式公交出行路径规划方法
摘要abst
本发明公开了一种多模式公交出行路径的规划方法，基于公交和地铁站点及线路数据分别构建公交及地铁的无权有向网络；运用空间连接方法以及智能地图API搜索地铁站点一定范围内的公交站点，建立地铁‑公交复合无权有向网络；基于公交地铁历史进出站数据以及发车间隔数据，计算各站段边以及各换乘边的平均行驶时间和平均换乘时间作为网络权重，构建建立地铁‑公交复合加权有向网络。以乘客的出行时间、出行OD以及出行偏好作为输入，建立出行路径规划模型，并运用改进的Dijkstra算法求解乘客的最优出行路径。本发明基于乘客的偏好特性，快速的规划出行者的多模式出行路径，缩短出行时间，提高乘客的整体公交出行体验。
权利要求书clms
1.一种多模式公交出行路径规划方法，其特征在于：包括以下步骤：步骤1：获取公交和地铁站点及线路数据，考虑公交、地铁线路上下行线路的差异性，分别构建公交及地铁的无权有向网络；步骤2：运用空间连接方法以及智能地图API搜索地铁站点一定范围内的公交站点，基于实际路网条件下的步行距离，筛选地铁站点一定范围内的公交站点，建立地铁-公交复合无权有向网络；步骤3：基于公交、地铁历史进出站数据，考虑各线路在各时段运行速度的时变特性，提取公交、地铁站段间的不同时间区间的平均行驶时间，作为地铁-公交复合无权有向网络中站段边的行驶时间权重；步骤4：基于公交、地铁各时段的历史发车间隔数据，考虑各线路在各时段发车间隔的时变特性，计算各线路之间的平均换乘时间，作为地铁-公交复合无权有向网络相同交通方式换乘边的换乘时间权重；步骤5：基于公交、地铁各时段的历史发车间隔数据以及公交与地铁站点之间的步行距离，计算公交、地铁站点之间的平均换乘时间，作为地铁-公交复合无权有向网络中不同交通方式间换乘边的换乘时间的权重；步骤6：为地铁-公交复合无权有向网络中各连边赋值，建立地铁-公交复合加权有向网络；步骤7：基于所构建的地铁-公交复合加权有向网络，以乘客的出行时间、出发站点、目的地站点作为输入，综合考虑乘客在出行时间、换乘次数、步行时间以及出行费用方面的偏好，建立出行路径规划模型；步骤8：采用改进的Dijkstra算法求解出行路径规划模型，输出多模式公交出行路径。2.根据权利要求1所述的一种多模式公交出行路径规划方法，其特征在于：所述的步骤1中建立的公交以及地铁的无权有向网络可表示为以及 ；表示公交无权有向网络；表示所有公交站集合，其中对于同一线路上下行具有相同名称的站点视为同一站点，对于不同线路具有相同名称的站点视为不同站点；表示所有公交线路的站段边集合；表示公交线路的换乘边集合；表示地铁无权有向网络，表示所有地铁站集合，表示所有地铁线路的站段边集合；表示所有地铁线路的换乘边集合。3.根据权利要求2所述的一种多模式公交出行路径规划方法，其特征在于：所述步骤2搜索地铁站点一定范围内的公交站点，具体方法为：步骤2.1：将包含经纬度信息以及所属线路信息的地铁站点和公交站点数据集导入到python中，文件格式为GeoDataFrame；步骤2.2：对两个数据集的坐标系进行转换，由原先由经纬度坐标表示的WGS84坐标系转化为墨卡托坐标系；步骤2.3：以地铁站点为圆心建立半径为r的缓冲区，采用空间连接的方法识别地铁站点缓冲区范围内的公交站点，建立地铁站点与缓冲区范围内公交站点集合的空间映射关系；步骤2.4：对两个数据集的坐标系进行转换，由墨卡托坐标系示转化为智能地图坐标系；步骤2.5：调用智能地图API计算与中每一个公交站点的实际步行距离，若智能地图API计算的站点间步行距离大于半径r，则将相应的公交站点剔除集合；最后仅保留实际站点间步行距离小于r的空间映射关系；从实际站点间步行距离小于r的空间映射关系中获得地铁站点与公交站点的换乘边集合。4.根据权利要求3所述的一种多模式公交出行路径规划方法，其特征在于：所述步骤2的地铁-公交复合无权有向网络可表示为，其中，表示地铁-公交复合无权有向网络，表示地铁站点与公交站点的换乘边集合。5.根据权利要求1所述的一种多模式公交出行路径规划方法，其特征在于：所述步骤3中公交及地铁站段间的不同时间区间的平均行驶时间提取方法表示为：对于公交网络，获取各线路历史进出站数据，该数据包含公交车辆在线路上到达每一站点的时间；按线路提取公交车辆在线路上到达每一站点的到站时间，计算各站点间的行程时间；建立与公交线路的站段边集合一一对应的平均行程时间数据集合；用于表征公交网络中各站段之间的时间权重，包含每个时间区间的站点行程时间的平均值, t为划分时间区间的标号；对地铁网络执行同样的操作，得到与地铁线路站段边集合所对应的各时段的平均行程时间数据集合；用于表征地铁网络中各站段之间的时间权重，包含每个时间区间的站点行程时间的平均值。6.根据权利要求1所述的一种多模式公交出行路径规划方法，其特征在于：所述步骤4计算相同交通方式换乘边的换乘时间的计算方式表示为：对于公交网络，获取各线路的历史发车时间数据，针对公交网络中的换乘边集合，构建对应的平均换乘时间权重集合；用于表征公交网络中具有相同站名的不同线路之间的换乘时间权重；包含每个时间区间的站点换乘时间的平均值，t为划分时间区间的标号；针对t时间区间内任意一条边的平均换乘时间数据，表示换乘前的站点，表示换乘后的站点，计算公式如下： 式中，表示所属的公交线路；表示在t时间区间内公交线路发车时间间隔实测数据的平均值；为t时间区间内公交线路发车时间间隔的标准偏差系数，等于在t时间区间内公交线路发车时间间隔实测数据的标准差除以发车时间间隔实测数据的平均值；对地铁网络执行同样的操作，得到与地铁线路换乘边集合所对应的各时段的平均换乘时间数据集合；包含每个时间区间的站点换乘时间的平均值；针对t时间区间内任意一条边的平均换乘时间数据，表示换乘前的站点，表示换乘后的站点，计算公式如下： 式中，表示所属的地铁线路；表示在t时间区间内地铁线路发车时间间隔实测数据的平均值；为t时间区间内地铁线路发车时间间隔的标准偏差系数，等于在t时间区间内地铁线路发车时间间隔实测数据的标准差除以发车时间间隔实测数据的平均值。7.根据权利要求1所述的一种多模式公交出行路径规划方法，其特征在于：所述步骤5中不同交通方式间换乘边的换乘时间计算方式表示为：针对地铁站点与公交站点的换乘边集合，构建对应的平均换乘时间权重集合；用于表征地铁-公交复合网络中公交站点换乘步行半径范围内地铁站点或者地铁站点换乘步行半径范围内公交站点的换乘时间权重；包含每个时间区间的站点换乘时间的平均值, t为划分时间区间的标号；针对t时间区间内任意一条边的平均换乘时间数据，表示换乘前的公交站点，表示换乘后地铁站点，计算公式如下：式中，表示在t时间区间内地铁线路发车时间间隔实测数据的平均值；为t时间区间内地铁线路发车时间间隔的标准偏差系数；为通过智能地图API计算得到的站点间的实际步行距离；为乘客的平均步行速度；同理，对于地铁站点换乘公交站点的时间的平均值, 通过下式进行求解：式中，表示在t时间区间内公交线路发车时间间隔实测数据的平均值；为t时间区间内公交线路发车时间间隔的标准偏差系数；为通过智能地图API计算得到的站点间的实际步行距离。8.根据权利要求1所述的一种多模式公交出行路径规划方法，其特征在于：所述步骤6地铁-公交复合加权有向网络表示为：,其中，表征所有的公交和地铁站点集合；，表征所有的公交及地铁的站段边集合以及换乘边集合； ，表征边集E中每条边的时间权重；表示所有公交站集合，表示所有地铁站集合，表示所有公交线路的站段边集合，表示公交线路的换乘边集合，表示所有地铁线路的站段边集合，表示所有地铁线路的换乘边集合，表示地铁站点与公交站点的换乘边集合，表示公交网络中各站段之间的时间权重，表示地铁网络中各站段之间的时间权重，表示公交网络中具有相同站名的不同线路之间的换乘时间权重，表示地铁网络中具有相同站名的不同线路之间的换乘时间权重，用于表征地铁-公交复合网络中公交站点换乘步行半径范围内地铁站点或者地铁站点换乘步行半径范围内公交站点的换乘时间权重。9.根据权利要求8所述的一种多模式公交出行路径规划方法，其特征在于：所述步骤7出行路径规划模型可以表示为： s.t.在式中，优化目标为出行效用最低，出行效用由四部分构成，包括：乘客的总出行时间、乘客的换乘成本、乘客的步行时间成本、以及乘客的出行费用成本；、、分别对应换乘成本权重、步行时间权重、出行费用权重；表示最优出行路径中是否包含边，若包含边，则的值为1，否则的值为0；表示边在t时间区间内时间权重；表示公交与地铁换乘过程中的步行距离；为步行速度；为地铁的票价计算函数；为公交的票价计算函数；式表示出行路径的首站必须是乘客的出发站点；式表示出行路径的末站必须是乘客的出目的地站点；式表示，若出行路径包含站点j，则其入度和出度均为1，否则，均为0；式表示的取值范围为0或者1。10.根据权利要求9所述的一种多模式公交出行路径规划方法，其特征在于：所述步骤8采用改进的Dijkstra 算法对出行路径规划模型进行求解，包括如下步骤：步骤8.1：算法初始，将乘客的出发站点放进集合S中；步骤8.2：对于，计算出发站点到所有站点的出行效用，的计算与出行路径规划模型中的出行效用计算方式相同；若出发站点无法直接到达站点，；步骤8.3：选择，并将这个放入集合S中，更新到中的站点的值；步骤8.4：重复步骤3，直到；步骤8.5：输出乘客的出发站点和目的地站点的最优出行路径。
说明书desc
技术领域本发明涉及一种多模式公交出行路径规划方法，属于公共交通出行路径规划技术领域。背景技术随着我国大中型城市的土地开发强度以及人口密度的日益增高，以私人交通为主导的交通模式所带来的交通拥堵以及环境污染问题已无法支撑城市未来的健康可持续发展。降低小汽车使用强度，引导公众出行选择集约化运输方式是我国当前推进绿色出行发展的首要任务。在此背景下，如何打造多模式的公交出行系统，构建相互配合、分工合理的公共交通网络，保证各类公共出行方式之间的快速换乘、无缝衔接对于提升公共交通系统的整体服务水平以及公交分担率至关重要。在多模式公交系统中，地铁具有速度快、运量大、准点率高等特性，可以作为城市公共交通的骨架网络服务于居民中长线路的出行；常规公交具有覆盖面广、通达性高、出行成本低等特点，可以作为城市公共交通的主干网络服务于居民的中短距离出行；两者在运行模式上都采用定点定线的服务模式，功能上相辅相成，在实际运营中占据了公共交通出行的绝大部分比例。因此，对这两种出行模式下的复合网络构建以及出行路径组合规划对实际出行者而言具有十分重要的实际应用价值。现有的多模式公交出行路径规划方法主要存在两点问题：一是在多模式复合网络构建的过程中往往做出的较多不符合实际的假设，包括：不考虑复合网络上下行线路的差异将网络抽象为无向网络；不考虑各线路在实际运行过程中运行速度的时变特性而将网络中边的权重设为恒定值；不考虑实际的步行换乘距离以及车辆发车间隔而假设换乘时间恒定。以上不合理的假设导致在实际路径规划过程中规划结果偏离实际，并且无法及时地针对实际运行过程中发生的变化做出及时的路径方案调整。二是现有的路径规划模型往往只针对单个目标的优化，如：总出行距离最短、总出行时间最少等，无法结合出行者点当前的出行时间和出行偏好给出更加个性化出行方案组合。因此，本领域技术人员亟需解决当前多模式公交出行路径规划中的技术问题。发明内容目的：为了克服现有技术中存在的不足，本发明提供一种多模式公交出行路径规划方法，辅助出行者进行多模式出行路径规划，缩短出行时间，提升公交出行体验。技术方案：为解决上述技术问题，本发明采用的技术方案为：一种多模式公交出行路径的规划方法，包括以下步骤：步骤1：获取公交和地铁站点及线路数据，考虑公交、地铁线路上下行线路的差异性，分别构建公交及地铁的无权有向网络。步骤2：运用空间连接方法以及智能地图API搜索地铁站点一定范围内的公交站点，基于实际路网条件下的步行距离，筛选地铁站点一定范围内的公交站点，建立地铁-公交复合无权有向网络。步骤3：基于公交、地铁历史进出站数据，考虑各线路在各时段运行速度的时变特性，提取公交、地铁站段间的不同时间区间的平均行驶时间，作为地铁-公交复合无权有向网络中站段边的行驶时间权重。步骤4：基于公交、地铁各时段的历史发车间隔数据，考虑各线路在各时段发车间隔的时变特性，计算各线路之间的平均换乘时间，作为地铁-公交复合无权有向网络相同交通方式换乘边的换乘时间权重。步骤5：基于公交、地铁各时段的历史发车间隔数据以及公交与地铁站点之间的步行距离，计算公交、地铁站点之间的平均换乘时间，作为地铁-公交复合无权有向网络中不同交通方式间换乘边的换乘时间的权重。步骤6：为地铁-公交复合无权有向网络中各连边赋值，建立地铁-公交复合加权有向网络。步骤7：基于所构建的地铁-公交复合加权有向网络，以乘客的出行时间、出发站点、目的地站点作为输入，综合考虑乘客在出行时间、换乘次数、步行时间以及出行费用方面的偏好，建立出行路径规划模型。步骤8：采用改进的Dijkstra算法求解出行路径规划模型，输出多模式公交出行路径。作为优选方案，所述的步骤1中建立的公交以及地铁的无权有向网络可表示为以及 。表示公交无权有向网络；表示所有公交站集合，其中对于同一线路上下行具有相同名称的站点视为同一站点，对于不同线路具有相同名称的站点视为不同站点；表示所有公交线路的站段边集合；表示公交线路的换乘边集合。表示地铁无权有向网络，表示所有地铁站集合，表示所有地铁线路的站段边集合；表示所有地铁线路的换乘边集合。作为优选方案，所述步骤2搜索地铁站点一定范围内的公交站点，具体方法为：步骤2.1：将包含经纬度信息以及所属线路信息的地铁站点和公交站点数据集导入到python中，文件格式为GeoDataFrame。步骤2.2：对两个数据集的坐标系进行转换，由原先由经纬度坐标表示的WGS84坐标系转化为墨卡托坐标系。步骤2.3：以地铁站点为圆心建立半径为r的缓冲区，采用空间连接的方法识别地铁站点缓冲区范围内的公交站点，建立地铁站点与缓冲区范围内公交站点集合的空间映射关系。步骤2.4：对两个数据集的坐标系进行转换，由墨卡托坐标系示转化为智能地图坐标系。步骤2.5：调用智能地图API计算与中每一个公交站点的实际步行距离，若智能地图API计算的站点间步行距离大于半径r，则将相应的公交站点剔除集合。最后仅保留实际站点间步行距离小于r的空间映射关系。从实际站点间步行距离小于r的空间映射关系中获得地铁站点与公交站点的换乘边集合。作为优选方案，所述步骤2的地铁-公交复合无权有向网络可表示为，其中，表示地铁-公交复合无权有向网络，表示地铁站点与公交站点的换乘边集合。作为优选方案，所述步骤3中公交及地铁站段间的不同时间区间的平均行驶时间提取方法表示为：对于公交网络，获取各线路历史进出站数据，该数据包含公交车辆在线路上到达每一站点的时间。按线路提取公交车辆在线路上到达每一站点的到站时间，计算各站点间的行程时间；建立与公交线路的站段边集合一一对应的平均行程时间数据集合；用于表征公交网络中各站段之间的时间权重，包含每个时间区间的站点行程时间的平均值, t为划分时间区间的标号。对地铁网络执行同样的操作，得到与地铁线路站段边集合所对应的各时段的平均行程时间数据集合；用于表征地铁网络中各站段之间的时间权重，包含每个时间区间的站点行程时间的平均值。作为优选方案，所述步骤4计算相同交通方式换乘边的换乘时间的计算方式表示为：对于公交网络，获取各线路的历史发车时间数据，针对公交网络中的换乘边集合，构建对应的平均换乘时间权重集合；用于表征公交网络中具有相同站名的不同线路之间的换乘时间权重；包含每个时间区间的站点换乘时间的平均值，t为划分时间区间的标号；针对t时间区间内任意一条边的平均换乘时间数据，表示换乘前的站点，表示换乘后的站点，计算公式如下： 式中，表示所属的公交线路；表示在t时间区间内公交线路发车时间间隔实测数据的平均值；为t时间区间内公交线路发车时间间隔的标准偏差系数，等于在t时间区间内公交线路发车时间间隔实测数据的标准差除以发车时间间隔实测数据的平均值。对地铁网络执行同样的操作，得到与地铁线路换乘边集合所对应的各时段的平均换乘时间数据集合；包含每个时间区间的站点换乘时间的平均值；针对t时间区间内任意一条边的平均换乘时间数据，表示换乘前的站点，表示换乘后的站点，计算公式如下： 式中，表示所属的地铁线路；表示在t时间区间内地铁线路发车时间间隔实测数据的平均值；为t时间区间内地铁线路发车时间间隔的标准偏差系数，等于在t时间区间内地铁线路发车时间间隔实测数据的标准差除以发车时间间隔实测数据的平均值。作为优选方案，所述步骤5中不同交通方式间换乘边的换乘时间计算方式表示为：针对地铁站点与公交站点的换乘边集合，构建对应的平均换乘时间权重集合；用于表征地铁-公交复合网络中公交站点换乘步行半径范围内地铁站点或者地铁站点换乘步行半径范围内公交站点的换乘时间权重；包含每个时间区间的站点换乘时间的平均值, t为划分时间区间的标号；针对t时间区间内任意一条边的平均换乘时间数据，表示换乘前的公交站点，表示换乘后地铁站点，计算公式如下：式中，表示在t时间区间内地铁线路发车时间间隔实测数据的平均值；为t时间区间内地铁线路发车时间间隔的标准偏差系数；为通过智能地图API计算得到的站点间的实际步行距离；为乘客的平均步行速度。同理，对于地铁站点换乘公交站点的时间的平均值, 通过下式进行求解：式中，表示在t时间区间内公交线路发车时间间隔实测数据的平均值；为t时间区间内公交线路发车时间间隔的标准偏差系数；为通过智能地图API计算得到的站点间的实际步行距离。作为优选方案，所述步骤6地铁-公交复合加权有向网络表示为：,其中，表征所有的公交和地铁站点集合；，表征所有的公交及地铁的站段边集合以及换乘边集合； ，表征边集E中每条边的时间权重；表示所有公交站集合，表示所有地铁站集合，表示所有公交线路的站段边集合，表示公交线路的换乘边集合，表示所有地铁线路的站段边集合，表示所有地铁线路的换乘边集合，表示地铁站点与公交站点的换乘边集合，表示公交网络中各站段之间的时间权重，表示地铁网络中各站段之间的时间权重，表示公交网络中具有相同站名的不同线路之间的换乘时间权重，表示地铁网络中具有相同站名的不同线路之间的换乘时间权重，用于表征地铁-公交复合网络中公交站点换乘步行半径范围内地铁站点或者地铁站点换乘步行半径范围内公交站点的换乘时间权重。所述步骤7出行路径规划模型可以表示为： s.t.在式中，优化目标为出行效用最低，出行效用由四部分构成，包括：乘客的总出行时间、乘客的换乘成本、乘客的步行时间成本、以及乘客的出行费用成本。、、分别对应换乘成本权重、步行时间权重、出行费用权重；表示最优出行路径中是否包含边，若包含边，则的值为1，否则的值为0；表示边在t时间区间内时间权重；表示公交与地铁换乘过程中的步行距离；为步行速度；为地铁的票价计算函数；为公交的票价计算函数；式表示出行路径的首站必须是乘客的出发站点；式表示出行路径的末站必须是乘客的出目的地站点；式表示，若出行路径包含站点j，则其入度和出度均为1，否则，均为0；式表示的取值范围为0或者1。作为优选方案，所述步骤8采用改进的Dijkstra 算法对出行路径规划模型进行求解，包括如下步骤：步骤8.1：算法初始，将乘客的出发站点放进集合S中。步骤8.2：对于，计算出发站点到所有站点的出行效用，的计算与出行路径规划模型中的出行效用计算方式相同；若出发站点无法直接到达站点，。步骤8.3：选择，并将这个放入集合S中，更新到中的站点的值。步骤8.4：重复步骤3，直到。步骤8.5：输出乘客的出发站点和目的地站点的最优出行路径。有益效果：本发明提供的一种多模式公交出行路径规划方法，本发明针对当前路径规划方法对出行时间时变特性以及出行者个性化需求考虑的不足，通过对公共交通历史数据的深入挖掘，基于超级网络理论构建了地铁-公交复合加权有向网络，并在此基础上建立了多模式公交出行路径的规模模型和求解算法。本发明可以基于出行者当前的出行时间和个性化需求给出最优公交出行路径，从而快速的规划出行者的多模式公交出行路径，提高乘客的整体公交出行体验并使得整体网络出行分布更加均衡。这种基于历史数据的路径规划方法的相比于当前基于实时数据的地图软件服务所需要的数据资源更少，无需车辆的实时定位数据以及路况数据，可作为一种离线的出行导航方式对实际出行导航进行补充，也可用于与公交出行路径规划相关软件与仿真系统当中，同时也可以用于验证新线路开设、原有线路调整以及公交时刻表调整等对乘客出行选择以及整体多模式公交出行客流分布的影响。附图说明图1是本发明方法流程图。图2是本发明实施例中的公交及地铁无权有向网络示意图。图3是本发明中的地铁站点一定范围内的公交站点识别方法图。图4是本发明实施例中的地铁-公交复合无权有向网络示意图。图5是本发明实施例中模型输入输出示意图。具体实施方式下面结合具体实施例对本发明作更进一步的说明。一种多模式公交出行路径的规划方法，包括以下步骤：步骤1：获取公交和地铁站点及线路数据，考虑公交、地铁线路上下行线路的差异性，分别构建公交及地铁的无权有向网络。步骤2：运用空间连接方法以及智能地图API搜索地铁站点一定范围内的公交站点，基于实际路网条件下的步行距离，筛选地铁站点一定范围内的公交站点，建立地铁-公交复合无权有向网络。步骤3：基于公交、地铁历史进出站数据，考虑各线路在各时段运行速度的时变特性，提取公交、地铁站段间的不同时间区间的平均行驶时间，作为地铁-公交复合无权有向网络中站段边的行驶时间权重。步骤4：基于公交、地铁各时段的历史发车间隔数据，考虑各线路在各时段发车间隔的时变特性，计算各线路之间的平均换乘时间，作为地铁-公交复合无权有向网络相同交通方式换乘边的换乘时间权重。步骤5：基于公交、地铁各时段的历史发车间隔数据以及公交与地铁站点之间的步行距离，计算公交、地铁站点之间的平均换乘时间，作为地铁-公交复合无权有向网络中不同交通方式间换乘边的换乘时间的权重。步骤6：为地铁-公交复合无权有向网络中各连边赋值，建立地铁-公交复合加权有向网络。步骤7：基于所构建的地铁-公交复合加权有向网络，以乘客的出行时间、出发站点、目的地站点作为输入，综合考虑乘客在出行时间、换乘次数、步行时间以及出行费用方面的偏好，建立出行路径规划模型。步骤8：采用改进的Dijkstra算法求解出行路径规划模型，输出多模式公交出行路径。所述的步骤1中建立的公交以及地铁的无权有向网络可表示为以及 。表示公交无权有向网络；表示所有公交站集合，其中对于同一线路上下行具有相同名称的站点视为同一站点，对于不同线路具有相同名称的站点视为不同站点；表示所有公交线路的站段边集合，站段边集合考虑了各线路上下行站段之间的差异性，用于表征各条线路相邻站点的联系；表示公交线路的换乘边集合，表征不同线路具有相同名称站点的换乘关系。同理，表示地铁无权有向网络，表示所有地铁站集合，表示所有地铁线路的站段边集合；表示所有地铁线路的换乘边集合。所述步骤2搜索地铁站点一定范围内的公交站点，具体方法为：步骤2.1：将包含经纬度信息以及所属线路信息的地铁站点和公交站点数据集导入到python中，文件格式为GeoDataFrame。步骤2.2：对两个数据集的坐标系进行转换，由原先由经纬度坐标表示的WGS84坐标系转化为墨卡托坐标系。步骤2.3：以地铁站点为圆心建立半径为r的缓冲区，采用空间连接的方法识别地铁站点缓冲区范围内的公交站点，建立地铁站点与缓冲区范围内公交站点集合的空间映射关系。步骤2.4：对两个数据集的坐标系进行转换，由墨卡托坐标系示转化为bd09ll坐标系。步骤2.5：调用智能地图API计算与中每一个公交站点的实际步行距离，若智能地图API计算的站点间步行距离大于半径r，则将相应的公交站点剔除集合。最后仅保留实际站点间步行距离小于r的空间映射关系。从实际站点间步行距离小于r的空间映射关系中获得地铁站点与公交站点的换乘边集合。所述步骤2的地铁-公交复合无权有向网络可表示为，其中，表示地铁-公交复合无权有向网络，表示地铁站点与公交站点的换乘边集合。所述步骤3中公交及地铁站段间的不同时间区间的平均行驶时间提取方法可以表示为：对于公交网络，获取各线路历史进出站数据，该数据包含公交车辆在线路上到达每一站点的时间。按线路提取公交车辆在线路上到达每一站点的到站时间，计算各站点间的行程时间；建立与公交线路的站段边集合一一对应的平均行程时间数据集合；用于表征公交网络中各站段之间的时间权重，包含每个时间区间的站点行程时间的平均值, t为划分时间区间的标号；针对t时间区间内任意一条边的平均行程时间数据，，表示该站段的起始站点和终点站点，其值可根据据t时间区间内站段行程时间所有实测数据求取平均值获得。同理，对地铁网络执行同样的操作，得到与地铁线路站段边集合所对应的各时段的平均行程时间数据集合。用于表征地铁网络中各站段之间的时间权重，包含每个时间区间的站点行程时间的平均值。针对t时间区间内任意一条边的平均行程时间数据，，表示该站段的起始站点和终点站点，其值可根据据t时间区间内站段行程时间所有实测数据求取平均值获得。所述步骤4计算相同交通方式换乘边的换乘时间的计算方式可以表示为：对于公交网络，获取各线路的历史发车时间数据，针对公交网络中的换乘边集合，构建对应的平均换乘时间权重集合；用于表征公交网络中具有相同站名的不同线路之间的换乘时间权重，该权重与换乘边中换乘后站点所属的线路的发车时间间隔相关；包含每个时间区间的站点换乘时间的平均值，t为划分时间区间的标号；针对t时间区间内任意一条边的平均换乘时间数据，表示换乘前的站点，表示换乘后的站点，和具有相同的站名，但分属不同线路。可根据据t时间区间内换乘后站点所属公交线路的发车时间间隔实测数据计算得出，计算公式如下：式中，表示在t时间区间内公交线路发车时间间隔实测数据的平均值；为t时间区间内公交线路发车时间间隔的标准偏差系数，等于在t时间区间内公交线路发车时间间隔实测数据的标准差除以发车时间间隔实测数据的平均值。同理，对地铁网络执行同样的操作，得到与地铁线路换乘边集合所对应的各时段的平均换乘时间数据集合。包含每个时间区间的站点换乘时间的平均值。针对t时间区间内任意一条边的平均换乘时间数据，表示换乘前的站点，表示换乘后的站点，和具有相同的站名，但分属不同线路。可根据据t时间区间内换乘后站点所属地铁线路的发车时间间隔实测数据计算得出，计算公式如下：式中，表示在t时间区间内地铁线路发车时间间隔实测数据的平均值；为t时间区间内地铁线路发车时间间隔的标准偏差系数，等于在t时间区间内地铁线路发车时间间隔实测数据的标准差除以发车时间间隔实测数据的平均值。所述步骤5中不同交通方式间换乘边的换乘时间计算方式可以表示为：针对地铁站点与公交站点的换乘边集合，构建对应的平均换乘时间权重集合。用于表征地铁-公交复合网络中公交站点换乘步行半径范围内地铁站点的换乘时间权重，该权重与两个站点之间的步行距离以及换乘后站点所属的线路的发车时间间隔相关；包含每个时间区间的站点换乘时间的平均值, t为划分时间区间的标号；针对t时间区间内任意一条边的平均换乘时间数据，表示换乘前的公交站点，表示换乘后地铁站点。可根据据站点之间的步行距离以及t时间区间内换乘后站点所属线路的发车时间间隔实测数据计算得出，计算公式如下：式中，表示在t时间区间内地铁线路发车时间间隔实测数据的平均值；为t时间区间内地铁线路发车时间间隔的标准偏差系数；为通过智能地图API计算得到的站点间的实际步行距离；为乘客的平均步行速度。同理，对于地铁站点换乘公交站点的情形, 可以通过下式进行求解：式中，表示在t时间区间内公交线路发车时间间隔实测数据的平均值；为t时间区间内公交线路发车时间间隔的标准偏差系数；为通过智能地图API计算得到的站点间的实际步行距离。所述步骤6地铁-公交复合加权有向网络可以表示为：,其中，表征所有的公交和地铁站点集合；，表征所有的公交及地铁的站段边集合以及换乘边集合；，表征边集E中每条边的时间权重。所述步骤7出行路径规划模型可以表示为： s.t.  在式中，优化目标为出行效用最低，出行效用由四部分构成，包括：乘客的总出行时间、乘客的换乘成本、乘客的步行时间成本、以及乘客的出行费用成本。、、分别对应换乘成本权重、步行时间权重、出行费用权重，其取值与乘客的出行选择偏好相关；表示最优出行路径中是否包含边，若包含边，则的值为1，否则的值为0；表示边在t时间区间内时间权重，t的取值与乘客出行规划的时间相关；表示公交与地铁换乘过程中的步行距离；为步行速度；为地铁的票价计算函数，与乘客乘坐的站数相关；为公交的票价计算函数，与乘客公交乘坐线路次数相关；式表示出行路径的首站必须是乘客的出发站点；式表示出行路径的末站必须是乘客的出目的地站点；式表示，若出行路径包含站点j，则其入度和出度均为1，否则，均为0；式表示的取值范围为0或者1。所述步骤8采用改进的Dijkstra 算法对出行路径规划模型进行求解，包括如下步骤：步骤8.1：算法初始，将乘客的出发站点放进集合S中。步骤8.2：对于，计算出发站点到所有站点的出行效用，的计算与出行路径规划模型中的出行效用计算方式相同；若出发站点无法直接到达站点，。步骤8.3：选择，并将这个放入集合S中，更新到中的站点的值。步骤8.4：重复步骤3，直到。步骤8.5：输出乘客的出发站点和目的地站点的最优出行路径。实施例：以下将结合南京的多模型公交具体实施例与说明书附图，对本发明方法做进一步详细说明。1：获取公交和地铁站点及线路数据，考虑公交地铁线路上下行线路的差异性，分别构建公交及地铁的无权有向网络。其中，公交/地铁站点及线路数据包括如下属性：站点编号、站点名称、线路名称、站点经度、站点纬度、线路名称、几何属性等七项，具体数据形式如表1、表2所示。表1 公交站点及线路数据示例表2 地铁站点及线路数据示例基于上述数据，如图2所示，建立公交无权有向网络以及地铁无权有向网络、。其中，，表示公交及地铁站点集合；，表示公交及地铁所有线路的站段边集合，表征各条线路相邻站点的联系；，表示公交及地铁所有线路的换乘边集合，表征不同线路具有相同名称站点的换乘关系2：运用空间连接方法以及智能地图API搜索地铁站点一定范围内的公交站点，基于实际路网条件下的步行距离，筛选地铁站点一定范围内的公交站点，建立地铁-公交复合无权有向网络。如图3所示，建立地铁站点的周边半径为r的缓冲区，运用空间连接方法识别缓冲区范围内公交站点，建立地铁站点与公交站点的映射关系。由于识别站点的实际步行距离可能超过r，因此通过调用智能地图API计算范围内公交站点到地铁站点的实际步行距离，此时的步行距离考虑了实际的道路网络结构，结果更加贴合实际。更新地铁站点与公交站点之间的实际步行距离，若步行距离小于r，则保留该映射关系，若步行距离大于r，则删除该映射关系。最终输出所有的地铁站点与公交站点的映射关系表。基于上述周边站点识别方法，建立如图4所示的地铁-公交复合无权有向网络，其中，表示地铁站点与公交站点的换乘边集合，可通过图3中输出的映射关系表获得。3：基于公交、地铁历史进出站数据，考虑各线路在各时段运行速度的时变特性，提取公交、地铁站段间的不同时间区间的平均行驶时间，作为地铁-公交复合无权有向网络中站段边的行驶时间权重。其中，历史进出站数据示例如表3所示，相邻站点进站时间差即为站点间的行程时间。考虑到公交站段间的行驶时间与实际路网状况以及客流量紧密相关，因此将全天的运行时间分为四个时间区间,分别为：早高峰：6：00-8：30；早平峰：8：30-14：30；晚高峰：16：30-18：30；晚平峰：18：30-23：00。基于公交及地铁一个月的历史进出站数据求取不同时间区间各站段间的平均行程时间，示例结果如表4所示。其中，公交各站段在不同时间区间的平均行驶时间数据集合记为，与边集合一一对应；地铁各站段在不同时间区间的平均行驶时间数据集合记为，与边集合一一对应。表3 历史进出站数据示例表4 公交各站段不同时间区间的平均行驶时间示例4：基于公交、地铁各时段的历史发车间隔数据，考虑各线路在各时段发车间隔的时变特性，计算各线路间的平均换乘时间，作为地铁-公交复合无权有向网络同交通方式之间换乘时间的权重。其中，历史发车时间数据示例如表5所示，发车间隔为同一线路同一方向的发车时间差。基于公交及地铁一个月的历史发车时间数据，通过公式、式求取不同时间区段各换乘边的平均换乘时间，示例结果如表6所示。其中，公交换乘边在不同时间区间的平均换乘时间数据集合记为，与边集合一一对应；地铁换乘边在不同时间区间的平均换乘时间数据集合记为，与边集合一一对应。表5 历史发车时间示例表6 公交各换乘边不同时间区间的平均换乘时间示例5：基于公交、地铁各时段的发车间隔数据以及公交与地铁之间的步行距离，计算公交、地铁站点之间的平均换乘时间，作为地铁-公交复合无权有向网络不同交通方式之间换乘时间的权重。其中，各时段的发车间隔数据可由表5所示历史发车时间计算得到，公交地铁之间的步行距离可由图3最终的输出结果得到。在此基础上，通过式、式 求取不同时间区段公交与地铁换乘边的平均换乘时间，步行速度取5公里/小时，得到的示例结果如表7所示。公交与地铁换乘边在不同时间区间的平均换乘时间数据集合记为，与边集合一一对应。表7 公交与地铁各换乘边不同时间区间的平均换乘时间示例6：基于上述边权的计算，为地铁-公交复合无权有向网络中各连边赋值，建立地铁-公交复合加权有向网络。地铁-公交复合加权有向网络可以表示为：,其中，表征所有的公交和站点集合；表征所有的公交及地铁的站段边集合以及换乘边集合；，表征边集E中每条边的时间权重。7：基于所构建的地铁-公交复合加权有向网络以及乘客的出行输入，建立出行路径规划模型。其中，乘客的出行输入包括乘客出行的起点站点、终点站点、当前的出行时间、以及出行的偏好。基于乘客的出行输入，对模型的参数进行设置。首先，根据乘客当前的出行时间，判断所属的时间区间，基于时间区间设置各边的权重值。其次，基于乘客的出行偏好，设置模型目标函数的权重值，权重值与出行偏好的关系如表8所示。最后，根据公式-，构建出行路径规划模型。表8 模型权重与出行偏好对应关系8：采用改进的Dijkstra 算法求解路径规划模型，输出多模式出行路径。其中，改进的Dijkstra 算法的伪代码如下。如图5所示，以乘客出发站站点为水关桥公交站，目的地站点为北外滩水城总站公交站，出行时间为11:45，出行偏好为时间最短为例，运用所提出模型及求解算法，最终输出的最优出行路径为：307路水关桥→307路金陵村→307路金陵小区→307路燕江路南→307路上元门→三号线上元门→三号线柳洲东路→635路北外滩水城五街区西→635路北外滩水城五街区北→635路北外滩水城九街区北→635路北外滩水城十二街区西→635路北外滩水城十六街区西→635路北外滩水城二十街区西→635路北外滩水城总站，出行总时长为34.87分钟，换乘次数为2次，步行距离为245米，出行费用为6元。本发明公开了一种多模式公交出行路径的规划方法，首先基于公交和地铁站点及线路数据分别构建公交及地铁的无权有向网络；其次，运用空间连接方法以及智能地图API搜索地铁站点一定范围内的公交站点，建立地铁-公交复合无权有向网络；然后基于公交地铁历史进出站数据以及发车间隔数据，计算各站段边以及各换乘边的平均行驶时间和平均换乘时间作为网络权重，构建建立地铁-公交复合加权有向网络。最后，以乘客的出行时间、出行OD以及出行偏好作为输入，建立出行路径规划模型，并运用改进的Dijkstra 算法求解乘客的最优出行路径。本发明可以基于乘客的偏好特性，快速的规划出行者的多模式出行路径，缩短出行时间，提高乘客的整体公交出行体验。以上所述仅是本发明的优选实施方式，应当指出：对于本技术领域的普通技术人员来说，在不脱离本发明原理的前提下，还可以做出若干改进和润饰，这些改进和润饰也应视为本发明的保护范围。
