标题title
落水检测装置及融合检测游泳划数的方法
摘要abst
本发明涉及一种落水检测装置及融合检测游泳划数的方法，属于运动监测技术领域，还公开了一种智能运动手表，其中，落水检测装置可根据出入水电信号判断装置出入水状态，并根据加速度传感器和陀螺仪数据确定泳姿和计算游泳的划数，融合检测游泳划数的方法对加速度传感器和陀螺仪数据对应的波形图进行峰谷判断，并读取出入水状态和时间，根据峰谷判断结果以及读取的出入水状态和时间获取一个周期内的峰谷数和入水时间占一个周期内总时间的百分比，以及根据峰谷数和百分比匹配泳姿模板对应的峰谷数所在范围和百分比所在范围，从而确定泳姿和计算游泳的划数，可解决游泳动作不标准导致判断不准确的问题。本申请所述的方法能准确判断游泳的划数和泳姿。
权利要求书clms
1.一种落水检测装置，其特征在于，所述装置包括：外壳，所述外壳具有注塑在其上的第一入水金属探针和第二入水金属探针；所述外壳内部具有加速度传感器、陀螺仪和电路板，所述第一入水金属探针、所述第二入水金属探针、所述加速度传感器和所述陀螺仪均与所述电路板电连接，所述电路板包括主控制器和入水检测电路；所述入水检测电路包括第一信号监测点和第二信号监测点，所述第一信号监测点与所述第一入水金属探针电连接，所述第二信号监测点与所述第二入水金属探针电连接；所述入水检测电路采集所述落水检测装置的入水电信号以及出水电信号，并发送至所述主控制器，所述主控制器根据获取的入水电信号和出水电信号判断所述落水检测装置处于入水状态或出水状态。2.根据权利要求1所述的落水检测装置，其特征在于，所述第一信号监测点和所述第二信号监测点作为所述入水检测电路的信号输入端，所述入水检测电路的信号输出端与所述主控制器的EIRQ信号脚电连接。3.根据权利要求2所述的落水检测装置，其特征在于，所述入水检测电路包括电阻R14、双向稳压管T7、双向稳压管T8、电阻R70、电阻R22、NMOS管Q8和电阻R71。4.根据权利要求3所述的落水检测装置，其特征在于，所述电阻R14的第一端连接至所述主控制器的MCU_3V3引脚，所述电阻R14的第二端与所述第一信号监测点电连接，所述双向稳压管T8的第一端与所述电阻R14的第二端电连接，所述双向稳压管T8的第二端接至地，所述双向稳压管T7的第一端与所述第二信号监测点电连接，所述双向稳压管T7的第二端接至地，所述电阻R70的第一端与所述双向稳压管T7的第一端电连接，所述电阻R22的第一端与所述电阻R70的第二端电连接，所述电阻R22的第二端接至地，所述NMOS管Q8的栅极与所述电阻R22的第一端电连接，所述NMOS管Q8的源极接至地，所述电阻R71的第一端连接至所述主控制器的MCU_3V3引脚，所述电阻R71的第二端与所述NMOS管Q8的漏极电连接，所述主控制器的MCU_3V3引脚连接至3.3V电压供电端，所述NMOS管Q8的漏极连接至所述主控制器的EIRQ信号脚，所述NMOS管Q8的源极连接至所述主控制器的GND引脚。5.一种智能运动手表，其特征在于，所述智能运动手表包括：表带，所述表带上设置如权利要求1-4任一所述的落水检测装置。6.一种采用如权利要求1-4任一所述的落水检测装置的融合检测游泳划数的方法，其特征在于，所述方法包括：获取落水检测装置中的加速度传感器数据和陀螺仪数据；通过划窗均值滤波算法对加速度传感器数据和陀螺仪数据进行滤波处理；对经过滤波处理获取的波形图进行峰谷判断；读取落水检测装置获取的出入水状态和时间；根据峰谷判断结果以及读取的出入水状态和时间将前后两个状态一致的峰谷作为一个周期计算在一个周期内的峰谷数和入水时间占一个周期内总时间的百分比；将计算得到的峰谷数和百分比与存储的泳姿模板对应的峰谷数所在范围和百分比所在范围进行匹配，获取峰谷数与出入水状态变化对应的泳姿模板；根据匹配的泳姿模板确定泳姿，并计算游泳的划数。7.根据权利要求6所述的融合检测游泳划数的方法，其特征在于，所述对经过滤波处理获取的波形图进行峰谷判断包括：定义t时刻波形图上的数据点O、t-1时刻波形图上的数据点A以及t+1时刻波形图上的数据点B；获取数据点O与数据点A和数据点B的位置关系，根据数据点O作为波峰波谷可能出现的状态以及数据点O作为非峰谷可能出现的状态定义数据点O的趋势Otrend；根据数据点O的趋势Otrend的数值判断数据点O是否处于峰谷状态。8.根据权利要求7所述的融合检测游泳划数的方法，其特征在于，所述峰谷状态包括全波峰状态、半波峰状态、全波谷状态和半波谷状态。9.根据权利要求6所述的融合检测游泳划数的方法，其特征在于，所述存储的泳姿模板包括自由泳模板、蛙泳模板、仰泳模板、蝶泳模板和非标准泳姿。10.根据权利要求6所述的融合检测游泳划数的方法，其特征在于，所述计算游泳的划数包括：定义0时刻游泳的划数为0；在根据匹配的泳姿模板确定泳姿后，在上一时刻计算的游泳划数上加一。
说明书desc
技术领域本发明涉及运动监测技术领域，尤其涉及一种落水检测装置及融合检测游泳划数的方法。背景技术目前，随着参与游泳运动的人数越来越多，许多的智能运动手表都增加了游泳模式的数据检测功能，通过手表内的加速度传感器及陀螺仪等传感器数据的变化特征来判断游泳的姿势及划数等数据，但是由于每个人的动作并不标准，千差万别，导致判断的时候误差较大。有的厂商提出增加气压计数据判断入水和出水来辅助判断，但是气压计的数据由于残留水滴和手部动作对气压数据影响较大，有很大几率误判，同样不够精确。发明内容本发明意在提供一种落水检测装置及融合检测游泳划数的方法，以解决现有技术中存在的不足，本发明要解决的技术问题通过以下技术方案来实现。第一方面，本申请提出一种落水检测装置，所述装置包括：外壳，所述外壳具有注塑在其上的第一入水金属探针和第二入水金属探针；所述外壳内部具有加速度传感器、陀螺仪和电路板，所述第一入水金属探针、所述第二入水金属探针、所述加速度传感器和所述陀螺仪均与所述电路板电连接，所述电路板包括主控制器和入水检测电路；所述入水检测电路包括第一信号监测点和第二信号监测点，所述第一信号监测点与所述第一入水金属探针电连接，所述第二信号监测点与所述第二入水金属探针电连接；所述入水检测电路采集所述落水检测装置的入水电信号以及出水电信号，并发送至所述主控制器，所述主控制器根据获取的入水电信号和出水电信号判断所述落水检测装置处于入水状态或出水状态。在上述的方案中，所述第一信号监测点和所述第二信号监测点作为所述入水检测电路的信号输入端，所述入水检测电路的信号输出端与所述主控制器的EIRQ信号脚电连接。在上述的方案中，所述入水检测电路包括电阻R14、双向稳压管T7、双向稳压管T8、电阻R70、电阻R22、NMOS管Q8和电阻R71。在上述的方案中，所述电阻R14的第一端连接至所述主控制器的MCU_3V3引脚，所述电阻R14的第二端与所述第一信号监测点电连接，所述双向稳压管T8的第一端与所述电阻R14的第二端电连接，所述双向稳压管T8的第二端接至地，所述双向稳压管T7的第一端与所述第二信号监测点电连接，所述双向稳压管T7的第二端接至地，所述电阻R70的第一端与所述双向稳压管T7的第一端电连接，所述电阻R22的第一端与所述电阻R70的第二端电连接，所述电阻R22的第二端接至地，所述NMOS管Q8的栅极与所述电阻R22的第一端电连接，所述NMOS管Q8的源极接至地，所述电阻R71的第一端连接至所述主控制器的MCU_3V3引脚，所述电阻R71的第二端与所述NMOS管Q8的漏极电连接，所述主控制器的MCU_3V3引脚连接至3.3V电压供电端，所述NMOS管Q8的漏极连接至所述主控制器的EIRQ信号脚，所述NMOS管Q8的源极连接至所述主控制器的GND引脚。本发明还提供一种智能运动手表，所述智能运动手表包括表带，所述表带上设置如上所述的落水检测装置。第二方面，本申请提供了一种采用如上所述的落水检测装置的融合检测游泳划数的方法，所述方法包括：获取落水检测装置中的加速度传感器数据和陀螺仪数据；通过划窗均值滤波算法对加速度传感器数据和陀螺仪数据进行滤波处理；对经过滤波处理获取的波形图进行峰谷判断；读取落水检测装置获取的出入水状态和时间；根据峰谷判断结果以及读取的出入水状态和时间将前后两个状态一致的峰谷作为一个周期计算在一个周期内的峰谷数和入水时间占一个周期内总时间的百分比；将计算得到的峰谷数和百分比与存储的泳姿模板对应的峰谷数所在范围和百分比所在范围进行匹配，获取峰谷数与出入水状态变化对应的泳姿模板；根据匹配的泳姿模板确定泳姿，并计算游泳的划数。在上述的方案中，所述对经过滤波处理获取的波形图进行峰谷判断包括：定义t时刻波形图上的数据点O、t-1时刻波形图上的数据点A以及t+1时刻波形图上的数据点B；获取数据点O与数据点A和数据点B的位置关系，根据数据点O作为波峰波谷可能出现的状态以及数据点O作为非峰谷可能出现的状态定义数据点O的趋势Otrend；根据数据点O的趋势Otrend的数值判断数据点O是否处于峰谷状态。在上述的方案中，所述峰谷状态包括全波峰状态、半波峰状态、全波谷状态和半波谷状态。在上述的方案中，所述存储的泳姿模板包括自由泳模板、蛙泳模板、仰泳模板、蝶泳模板和非标准泳姿。在上述的方案中，所述计算游泳的划数包括：定义0时刻游泳的划数为0；在根据匹配的泳姿模板确定泳姿后，在上一时刻计算的游泳划数上加一。本发明实施例包括以下优点：本发明实施例提供的落水检测装置利用水的导电性质，在装置外壳上注塑两根入水检测探针，在入水的瞬间入水检测探针瞬间导通，出水瞬间立即断开，检测结果准确且灵敏度高，能准确及时的跟踪手部入水和出水状态，本发明实施例提供的融合检测游泳划数的方法，通过将融合手部出入水状态与加速度传感器数据和陀螺仪数据，计算得到一个周期内数据对应的波形图中的峰谷数和入水百分比，将峰谷数和入水百分比与存储的泳姿模板对应的峰谷数所在范围和百分比所在范围进行匹配，能准确的判断游泳的划数和泳姿，解决了目前只用传感器检测的方式判断游泳数据时因为业余爱好者游泳的姿势并不标准造成的判断误差较大的问题，使得游泳的划数和泳姿判断的准确度大幅提升。附图说明图1是本发明的一种落水检测装置的结构示意图。图2是本发明的入水检测电路的电路图。图3是本发明的一种融合检测游泳划数的方法实施例的步骤流程图。图4是本发明的对波形图进行峰谷判断的步骤流程图。图5是本发明的峰谷状态对应的波形图。图6是本发明的非峰谷状态对应的波形图。图7是本发明的自由泳模板对应的波形图。图8是本发明的蛙泳模板对应的波形图。图9是本发明的仰泳模板对应的波形图。图10是本发明的蝶泳模板对应的波形图。图11是本发明的计算游泳的划数的步骤流程图。具体实施方式需要说明的是，在不冲突的情况下，本申请中的实施例及实施例中的特征可以相互组合。下面将参考附图并结合实施例来详细说明本发明。如图1所示，本发明提供了一种落水检测装置，所述装置包括：外壳1，所述外壳具有注塑在其上的第一入水金属探针2和第二入水金属探针3；所述外壳1内部具有加速度传感器、陀螺仪和电路板，所述第一入水金属探针2、所述第二入水金属探针3、所述加速度传感器和所述陀螺仪均与所述电路板电连接，所述电路板包括主控制器和入水检测电路；所述入水检测电路包括第一信号监测点和第二信号监测点，所述第一信号监测点与所述第一入水金属探针2电连接，所述第二信号监测点与所述第二入水金属探针3电连接；所述入水检测电路采集所述落水检测装置的入水电信号以及出水电信号，并发送至所述主控制器，所述主控制器根据获取的入水电信号和出水电信号判断所述落水检测装置处于入水状态或出水状态。在本实施例中，第一信号监测点上拉，第二信号监测点下拉到地，当落水检测装置处于出水状态时，第一信号监测点与第二信号监测点处于断路状态；当落水检测装置处于入水状态时，水介质将第一入水金属探针2和二入水检测探针3导通，第一信号监测点与第二信号监测点处于导通状态。进一步地，所述第一信号监测点和所述第二信号监测点作为所述入水检测电路的信号输入端，所述入水检测电路的信号输出端与所述主控制器的EIRQ信号脚电连接。如图2所示，所述入水检测电路包括电阻R14、双向稳压管T7、双向稳压管T8、电阻R70、电阻R22、NMOS管Q8和电阻R71，所述电阻R14的第一端连接至所述主控制器的MCU_3V3引脚，所述电阻R14的第二端与第一信号监测点电连接，所述双向稳压管T8的第一端与所述电阻R14的第二端电连接，所述双向稳压管T8的第二端接至地，所述双向稳压管T7的第一端与第二信号监测点电连接，所述双向稳压管T7的第二端接至地，所述电阻R70的第一端与所述双向稳压管T7的第一端电连接，所述电阻R22的第一端与所述电阻R70的第二端电连接，所述电阻R22的第二端接至地，所述NMOS管Q8的栅极与所述电阻R22的第一端电连接，所述NMOS管Q8的源极接至地，所述电阻R71的第一端连接至所述主控制器的MCU_3V3引脚，所述电阻R71的第二端与所述NMOS管Q8的漏极电连接，所述主控制器的MCU_3V3引脚连接至3.3V电压供电端，所述NMOS管Q8的漏极连接至所述主控制器的EIRQ信号脚，所述NMOS管Q8的源极连接至所述主控制器的GND引脚。在本实施例中，电阻R14为0Ω电阻，电阻R70、电阻R22和电阻R71均为100KΩ电阻，当戴有落水检测装置的用户手部处于出水状态时，第一信号监测点与第二信号监测点处于断路状态，NMOS管Q8的栅源电压为0，NMOS管Q8不导通，主控制器的EIRQ信号脚处于高电平，主控制器判定用户手部处于出水状态；当戴有落水检测装置的用户手部处于入水状态时，第一信号监测点与第二信号监测点处于导通状态，NMOS管Q8的栅源电压被拉高，NMOS管Q8导通，主控制器的EIRQ信号脚处于低电平，主控制器判定用户手部处于入水状态。本发明还提供一种智能运动手表，所述智能运动手表包括表带，所述表带上设置如上所述的落水检测装置，用户游泳时将智能运动手表戴在手上，从而可通过落水检测装置获取用户手部的出入水状态。如图3所示，本发明提供了一种采用如上所述的落水检测装置的融合检测游泳划数的方法，所述方法包括：步骤S1：获取落水检测装置中的加速度传感器数据和陀螺仪数据；步骤S2：通过划窗均值滤波算法对加速度传感器数据和陀螺仪数据进行滤波处理；步骤S3：对经过滤波处理获取的波形图进行峰谷判断；步骤S4：读取落水检测装置获取的出入水状态和时间；步骤S5：根据峰谷判断结果以及读取的出入水状态和时间将前后两个状态一致的峰谷作为一个周期计算在一个周期内的峰谷数和入水时间占一个周期内总时间的百分比；步骤S6：计算得到的峰谷数和百分比与存储的泳姿模板对应的峰谷数所在范围和百分比所在范围进行匹配，获取峰谷数与出入水状态变化对应的泳姿模板；步骤S7：根据匹配的泳姿模板确定泳姿，并计算游泳的划数。如图4所示，所述对经过滤波处理获取的波形图进行峰谷判断包括：步骤S31：定义t时刻波形图上的数据点O、t-1时刻波形图上的数据点A以及t+1时刻波形图上的数据点B；步骤S32：获取数据点O与数据点A和数据点B的位置关系，根据数据点O作为波峰波谷可能出现的状态以及数据点O作为非峰谷可能出现的状态定义数据点O的趋势Otrend；步骤S33：根据数据点O的趋势Otrend的数值判断数据点O是否处于峰谷状态。进一步地，所述峰谷状态包括全波峰状态、半波峰状态、全波谷状态和半波谷状态。如图5所示，全波峰状态、半波峰状态、全波谷状态和半波谷状态分别对应不同的波形图，图5中的描述了全波峰状态对应的波形图，在全波峰状态下，数据点O的趋势Otrend= 2；图5中的描述了第一种类型的半波峰状态对应的波形图，在第一种类型的半波峰状态下，数据点O与位于最高位置处的t+1时刻的数据点B的高度值相等，此时，数据点O的趋势Otrend= 1；图5中的描述了第二种类型的半波峰状态对应的波形图，在第二种类型的半波峰状态下，数据点O与位于最高位置处的t-1时刻的数据点A的高度值相等，此时，数据点O的趋势Otrend= 1；图5中的描述了全波谷状态对应的波形图，在全波谷状态下，数据点O的趋势Otrend= -2；图5中的描述了第一种类型的半波谷状态对应的波形图，在第一种类型的半波谷状态下，数据点O与位于最低位置处的t+1时刻的数据点B的高度值相等，此时，数据点O的趋势Otrend= -1；图5中的描述了第二种类型的半波谷状态对应的波形图，在第二种类型的半波谷状态下，数据点O与位于最低位置处的t-1时刻的数据点A的高度值相等，此时，数据点O的趋势Otrend= -1。如图6所示，数据点O处于非峰谷状态时，Otrend= 0，图6中的描述了第一种类型的非峰谷状态对应的波形图，此时，数据点O与t-1时刻的数据点A和t+1时刻的数据点B的高度值均相等；图6中的描述了第二种类型的非峰谷状态对应的波形图，此时，数据点O处于t-1时刻的数据点A与t+1时刻的数据点B的之间，波形图处于下降趋势；图6中的描述了第三种类型的非峰谷状态对应的波形图，此时，数据点O处于t-1时刻的数据点A与t+1时刻的数据点B的之间，波形图处于上升趋势。在本实施例中，当数据点O的趋势Otrend的数值为2，1，-1，-2时，判定数据点O处于峰谷状态；当数据点O的趋势Otrend的数值为0，判定数据点O处于非峰谷状态。进一步地，所述存储的泳姿模板包括自由泳模板、蛙泳模板、仰泳模板、蝶泳模板和非标准泳姿。如图7所示，自由泳模板对应的波形图包含y轴方向自由泳模板对应的波形图和z轴方向自由泳模板对应的波形图，图7中的描述了y轴方向自由泳模板对应的波形图，图7中的描述了z轴方向自由泳模板对应的波形图，自由泳对应的入水时间占一个周期内总时间的百分比所在的范围为50%-80%，当计算得到的一个周期内的峰谷数处于自由泳模板对应的一个周期内峰谷数的范围之内，且计算得到的入水时间占一个周期内总时间的百分比处于自由泳模板对应的入水时间占一个周期内总时间百分比的范围之内时，判定当前泳姿为自由泳。如图8所示，蛙泳模板对应的波形图包含x轴方向蛙泳模板对应的波形图和y轴方向蛙泳模板对应的波形图，图8中的描述了x轴方向蛙泳模板对应的波形图，图8中的描述了y轴方向蛙泳模板对应的波形图，蛙泳对应的入水时间占一个周期内总时间的百分比所在的范围为70%-100%，当计算得到的一个周期内的峰谷数处于蛙泳模板对应的一个周期内峰谷数的范围之内，且计算得到的入水时间占一个周期内总时间的百分比处于蛙泳模板对应的入水时间占一个周期内总时间百分比的范围之内时，判定当前泳姿为蛙泳，蛙泳的时候，入水时间占一个周期内总时间的百分比为100%时，落水检测装置一直处于水下，此时划数判断只靠加速度传感器数据和陀螺仪数据，偶尔短暂的出水状态只用于参考。如图9所示，仰泳模板对应的波形图包含y轴方向仰泳模板对应的波形图和z轴方向仰泳模板对应的波形图，图9中的描述了y轴方向仰泳模板对应的波形图，图9中的描述了z轴方向仰泳模板对应的波形图，仰泳对应的入水时间占一个周期内总时间的百分比所在的范围为60%-90%，当计算得到的一个周期内的峰谷数处于仰泳模板对应的一个周期内峰谷数的范围之内，且计算得到的入水时间占一个周期内总时间的百分比处于仰泳模板对应的入水时间占一个周期内总时间百分比的范围之内时，判定当前泳姿为仰泳。如图10所示，蝶泳模板对应的波形图包含y轴方向蝶泳模板对应的波形图和z轴方向蝶泳模板对应的波形图，其中,z轴方向蝶泳模板对应的波形图包括第一种类型z轴方向蝶泳模板对应的波形图和第二种类型z轴方向蝶泳模板对应的波形图，图10中的描述了y轴方向蝶泳模板对应的波形图，图10中的描述了第一种类型z轴方向蝶泳模板对应的波形图，图10中的描述了第二种类型z轴方向蝶泳模板对应的波形图，蝶泳对应的入水时间占一个周期内总时间的百分比所在的范围为70%-95%，当计算得到的一个周期内的峰谷数处于蝶泳模板对应的一个周期内峰谷数的范围之内，且计算得到的入水时间占一个周期内总时间的百分比处于蝶泳模板对应的入水时间占一个周期内总时间百分比的范围之内时，判定当前泳姿为蝶泳。如图11所示，所述计算游泳的划数包括：步骤S61：定义0时刻游泳的划数为0；步骤S62：在根据匹配的泳姿模板确定泳姿后，在上一时刻计算的游泳划数上加一。应该指出，上述详细说明都是示例性的，旨在对本申请提供进一步的说明。除非另有指明，本文使用的所有技术和科学术语均具有与本申请所属技术领域的普通技术人员的通常理解所相同的含义。需要注意的是，这里所使用的术语仅是为了描述具体实施方式，而非意图限制根据本申请的示例性实施方式。如在这里所使用的，除非上下文另外明确指出，否则单数形式也意图包括复数形式。此外，还应当理解的是，当在本说明书中使用术语“包含”和/或“包括”时，其指明存在特征、步骤、操作、器件、组件和/或它们的组合。需要说明的是，本申请的说明书和权利要求书及上述附图中的术语“第一”、“第二”等是用于区别类似的对象，而不必用于描述特定的顺序或先后次序。应该理解这样使用的术语在适当情况下可以互换，以便这里描述的本申请的实施方式能够以除了在这里图示或描述的那些以外的顺序实施。此外，术语“包括”和“具有”以及他们的任何变形，意图在于覆盖不排他的包含。例如，包含了一系列步骤或单元的过程、方法、系统、产品或设备不必限于清楚地列出的那些步骤或单元，而是可包括没有清楚地列出的或对于这些过程、方法、产品或设备固有的其它步骤或单元。为了便于描述，在这里可以使用空间相对术语，如“在……之上”、“在……上方”、“在……上表面”、“上面的”等，用来描述如在图中所示的一个器件或特征与其他器件或特征的空间位置关系。应当理解的是，空间相对术语旨在包含除了器件在图中所描述的方位之外的在使用或操作中的不同方位。例如，如果附图中的器件被倒置，则描述为“在其他器件或构造上方”或“在其他器件或构造之上”的器件之后将被定位为“在其他器件或构造下方”或“在其他器件或构造之下”。因而，示例性术语“在……上方”可以包括“在……上方”和“在……下方”两种方位。该器件也可以其他不同方式定位，如旋转90度或处于其他方位，并且对这里所使用的空间相对描述作出相应解释。在上面详细的说明中，参考了附图，附图形成本文的一部分。在附图中，类似的符号典型地确定类似的部件，除非上下文以其他方式指明。在详细的说明书、附图及权利要求书中所描述的图示说明的实施方案不意味是限制性的。在不脱离本文所呈现的主题的精神或范围下，其他实施方案可以被使用，并且可以作其他改变。以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
