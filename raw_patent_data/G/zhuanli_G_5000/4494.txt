标题title
一种高速多路LVDS采集系统及存储介质
摘要abst
本发明的一种高速多路LVDS采集系统及存储介质，包括LVDS转接板、PCIE‑7821R采集卡和上位机软件；其中，星载高速相机的串行LVDS数传接口通过线缆连接到LVDS转接板；LVDS转接板内部的缓冲区会对接口数据进行串行转并行的处理；处理完成后，LVDS转接板通过线缆链接PCIE‑7821R采集卡，将转为128路并口的数据发送到PCIE采集卡；PCIE‑7821R采集卡通过工控机的PCIE接口和工控机相连，上位机软件通过DMA的方式从PCIE‑7821R中获取数据，进行后续的解析、分析、存储操作。本发明解决的问题是：某星载高速相机研制过程中，高速LVDS数据的地面采集问题。具体的，某星载高速相机，其数据采用多路高速串行LVDS信号的形式传输，在高速相机的研制过程中，其产生的科学数据需要地面设备进行采集，以验证其功能和性能。
权利要求书clms
1.一种高速多路LVDS采集系统，其特征在于，包括LVDS转接板、PCIE-7821R采集卡和上位机软件；其中，星载高速相机的串行LVDS数传接口通过线缆连接到LVDS转接板；LVDS转接板内部的缓冲区会对接口数据进行串行转并行的处理；处理完成后，LVDS转接板通过线缆链接PCIE-7821R采集卡，将转为128路并口的数据发送到PCIE采集卡；PCIE-7821R采集卡通过工控机的PCIE接口和工控机相连，上位机软件通过DMA的方式从PCIE-7821R中获取数据，进行后续的解析、分析、存储操作。2.根据权利要求1所述的高速多路LVDS采集系统，其特征在于：星载高速相机将10路600Mbps的串行LVDS数据，通过串行LVDS数传接口，发送到LVDS转接板。3.根据权利要求1所述的高速多路LVDS采集系统，其特征在于：所述采集卡使用4路VHDCI接口采集128路单端并行数据。4.根据权利要求1所述的高速多路LVDS采集系统，其特征在于：所述LVDS转接板包括LVDS接口芯片和FPGA，其中FPGA实现缓冲区功能，在电路内部，LVDS数传接口将输入的LVDS信号转化为板内信号，板内信号通过PCB板内走线和FPGA连接，FPGA同时利用缓冲区将串行LVDS数据缓存，再转化为满足PCIE-7821R接口协议的50M时钟频率的128路单端并行信号，通过PCB的4路VHDCI对外接口，发送到PCIE-7821R并行采集卡。5.根据权利要求4所述的高速多路LVDS采集系统，其特征在于：每个缓冲区的结构包括移位寄存器、缓存A和B、读出寄存器；移位寄存器通过移位存储的方式，将1位LVDS数据转化为128位的并行数据，再写入缓存A，当缓存A写满后，将满标志位置1；硬件内线程会轮询缓冲区中满标志位，标志位为1时缓冲区内的数据会被读出；读缓存A的同时，缓存B被写入数据，在缓存B写满前，缓存A的内容会被读出清空，当缓存B也写满后，将满标志位置1，以此类推；并行数据以50M，128位并行数据的形式读出。6.根据权利要求1所述的高速多路LVDS采集系统，其特征在于：所述单路串行LVDS数传接口的数据格式总长度为2196字节，分为成像帧头和图像数据，其中成像帧头为8字节，其余2188字节为图像数据。7.根据权利要求1所述的高速多路LVDS采集系统，其特征在于：LVDS转接板帧头为8字节，转接板帧头包含数据的长度、通道号，之后为数据部分。8.根据权利要求1所述的高速多路LVDS采集系统，其特征在于：所述上位机软件采用双层的生产者-消费者模型，接收线程是生产者，向解码线程1提供数据；解码线程1既是生产者，也是消费者，其消费接收线程提供的数据，同时向解码线程2提供数据；解码线程2是消费者，接收由生产者解码线程1提供的数据。9.根据权利要求8所述的高速多路LVDS采集系统，其特征在于：所述上位机软件的接收线程通过DMA方式，以数据流的形式读取PCIE-7821R采集到的数据，之后将数据放入解码队列1；同时，解码线程1不断访问解码队列1，当解码队列1不为空时，执行出队列操作，解码线程1将数据解包，即识别LVDS转接板帧头，将其去除，再根据包头中通道号，将解包后的数据分别放入解码队列2。解码线程2不断访问队列2，当队列2非空时，执行出队列操作，解码线程2识别其中成像帧头，将其解析为图像数据，供后续的图像显示、图像存储这些线程调用。10.一种计算机可读存储介质，存储有计算机程序，所述计算机程序被处理器执行时，使得所述处理器执行如权利要求1至9中任一项所述方法的解析、分析、存储操作。
说明书desc
技术领域本发明涉及采集系统技术领域，具体涉及一种高速多路LVDS采集系统及存储介质。背景技术某型号星载高速相机，如下图1所示，有0～9共10路串行LVDS数传接口，接口按位传输图像数据，每路接口传输速率为600Mbps，总速率约为6Gbps。串行LVDS数传接口主要用于将星载高速相机输出的科学数据发送到数传模块，经数传模块处理后，再发送到地面。在星载高速相机的研制过程中，先在地面进行测试，需要先行研制相应的地面检测系统，如图2所示，地面检测系统的主要作用是代替图1中数传模块，在地面测试过程中，对下传的科学数据进行采集、保存、显示、分析等操作。现有的一般为：工控机加装采集卡的方式：因为LVDS无法通过计算机直接采集，通常会采用“工控机+采集卡”的形式采集LVDS数据，进行地检平台的搭建，如下图3所示：使用LVDS转USB3.0通讯适配器的方式：《Design of an LVDS to USB3.0adapter and application》、《一种LVDS转USB3.0多功能适配器》和《一种LVDS转USB3.0多通道适配器》中提出了一种使用USB3.0通讯适配器的设计，其通讯适配器的结构及连接如图4所示：采用USB3.0接口是实现地面检测系统的另一种方式，能够将高速相机输出的LVDS接口数据转换为USB3.0接口格式的数据，再发送给上位机进行后续处理。如上图3中所示，使用“工控机+采集卡”的形式设计地检系统的主要缺点在于：使用软件进行串行解码，耗费上位机机时，采集数据效率相对较低。如上图4所示，使用USB3.0形式设计地检系统的主要缺点在于：USB3.0的标称速率为5Gbps，实际使用速率大约为3Gbps，总速率无法满足新一代高速相机传输速率需求。发明内容本发明提出的一种高速多路LVDS采集系统，可解决上述技术问题。为实现上述目的，本发明采用了以下技术方案：一种高速多路LVDS采集系统，包括LVDS转接板、PCIE-7821R采集卡和上位机软件；其中，星载高速相机的串行LVDS数传接口通过线缆连接到LVDS转接板；LVDS转接板内部的缓冲区会对接口数据进行串行转并行的处理；处理完成后，LVDS转接板通过线缆链接PCIE-7821R采集卡，将转为128路并口的数据发送到PCIE采集卡；PCIE-7821R采集卡通过工控机的PCIE接口和工控机相连，上位机软件通过DMA的方式从PCIE-7821R中获取数据，进行后续的解析、分析、存储操作。进一步的，星载高速相机将10路600Mbps的串行LVDS数据，通过串行LVDS数传接口，发送到LVDS转接板。进一步的，所述采集卡使用4路VHDCI接口采集128路单端并行数据。进一步的，所述LVDS转接板包括LVDS接口芯片和FPGA，其中FPGA实现缓冲区功能，在电路内部，LVDS数传接口将输入的LVDS信号转化为板内信号，板内信号通过PCB板内走线和FPGA连接，FPGA同时利用缓冲区将串行LVDS数据缓存，再转化为满足PCIE-7821R接口协议的50M时钟频率的128路单端并行信号，通过PCB的对外接口，发送到PCIE-7821R并行采集卡。进一步的，每个缓冲区的结构包括移位寄存器、缓存A和B、读出寄存器；移位寄存器通过移位存储的方式，将1位LVDS数据转化为128位的并行数据，再写入缓存A，当缓存A写满后，将满标志位置1；硬件内线程会轮询缓冲区中满标志位，满标志位为1时缓冲区内的数据会被读出；读缓存A的同时，缓存B可以被写入，在缓存B写满前，缓存A的内容会被读出清空，当缓存B也写满后，将满标志位置1，以此类推；并行数据以50M，128位并行数据的形式读出。进一步的，所述单路串行LVDS数传接口的数据格式总长度为2196字节，分为成像帧头和图像数据，其中成像帧头为8字节，其余2188字节为图像数据。进一步的，LVDS转接板帧头为8字节，转接板帧头包含数据的长度、通道号，之后为数据部分。进一步的，所述上位机软件采用双层的生产者-消费者模型，接收线程是生产者，向解码线程1提供数据；解码线程1既是生产者，也是消费者，其消费接收线程提供的数据，同时向解码线程2提供数据；解码线程2是消费者，接收由生产者解码线程1提供的数据。进一步的，所述上位机软件的接收线程通过DMA方式，以数据流的形式读取PCIE-7821R采集到的数据，之后将数据放入解码队列1；同时，解码线程1不断访问解码队列1，当解码队列1不为空时，执行出队列操作，解码线程1将数据解包，即识别LVDS转接板帧头，将其去除，再根据包头中通道号，将解包后的数据分别放入解码队列2。解码线程2不断访问队列2，当队列2非空时，执行出队列操作，解码线程2识别其中成像帧头，将其解析为图像数据，供后续的图像显示、图像存储等线程调用。另一方面，本发明还公开一种计算机可读存储介质，存储有计算机程序，所述计算机程序被处理器执行时，使得所述处理器执行如权利要求1至9中任一项所述方法的解析、分析、存储操作。由上述技术方案可知，本发明的高速多路LVDS采集系统，采集系统主要由一块LVDS转接板、一款采集卡PCIE-7821R、以及一款上位机软件组成。主要解决的问题是：某星载高速相机研制过程中，高速LVDS数据的地面采集问题。具体的，某星载高速相机，其数据采用多路高速串行LVDS信号的形式传输。在高速相机的研制过程中，其产生的科学数据需要地面设备进行采集，以验证其功能和性能。总得来说，本发明使用“LVDS转接板+并口采集卡”的形式，实现多路串行高速LVDS数据的采集，使用硬件对串行数据进行采集缓冲，以及串行数据转并行数据的操作，最高速度能够达到6.4Gbps。本发明通过串行转并行的方式，实现了数据的高速传输。使用硬件解码串行数据，相对软件解码更加简单高效，稳定性较高。附图说明图1是现有的某型号星载高速相机内部原理图；图2是高速相机与地面检测系统连接图；图3是地面检测系统常用搭建方式图；图4是使用USB3.0接口搭建地面检测系统图；图5是高速多路LVDS采集系统示意图；图6是并口数据采集卡采集时序图；图7是LVDS转接板内部结构图；图8是LVDS转接板内部缓冲区结构图；图9是传输过程中数据格式图；图10是采集系统上位机软件结构图；图11是采集系统上位机软件界面图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。如图5所示，本实施例所述的高速多路LVDS采集系统，包括由LVDS转接板、PCIE-7821R采集卡和上位机软件组成。其中，星载高速相机的串行LVDS数传接口通过线缆连接到LVDS转接板；LVDS转接板内部的缓冲区会对接口数据进行串行转并行的处理；处理完成后，LVDS转接板通过线缆链接PCIE-7821R采集卡，将转为128路并口的数据发送到PCIE采集卡；PCIE-7821R采集卡通过工控机的PCIE接口和工控机相连，上位机软件通过DMA的方式从PCIE-7821R中获取数据，进行后续的解析、分析、存储等操作。以下具体说明：本实施例的一种高速多路LVDS采集系统的整体结构如图5所示，其整体的工作方式如下：1.星载高速相机将10路600Mbps的串行LVDS数据，通过串行LVDS数传接口，发送到LVDS转接板。LVDS转接板在缓冲区进行数据缓冲，同时将串行数据转为并行数据后，再将并行数据以1路时钟和128路单端的形式发送到PCIE-7821R采集卡，其中时钟频率为50M，即总体传输速率能够达到6.4Gbps。2.工控机内装有PCIE-7821R采集卡，采集卡使用4路VHDCI接口采集128路单端并行数据。如下图6所示，LVDS转接板在时钟下降沿发送一个128比特的并行数据，而采集卡在每个时钟的上升沿采集一个128比特的并行数据。3.如图5所示，上位机通过DMA的方式从PCIE-7821R中以数据流的形式获取数据，再进行解码、显示、存储、分析等操作。LVDS转接板设计：LVDS转接板是高速多路LVDS采集系统中的重要组成部分，主要负责将串行LVDS数据转为并行，其设计将在下文详述。电路设计：LVDS转接板的整体电路结构如下图7所示，由LVDS接口芯片和FPGA组成，其中FPGA实现缓冲区功能。外部连接如图5所示，不再赘述。在电路内部，LVDS数传接口将输入的LVDS信号转化为板内信号，板内信号通过PCB板内走线和FPGA连接，FPGA同时利用缓冲区将串行LVDS数据缓存，再转化为满足如图6中PCIE-7821R接口协议的50M时钟频率的128路单端并行信号，通过PCB的对外接口，发送到PCIE-7821R并行采集卡。每个缓冲区的结构如下图8所示，由移位寄存器、缓存A和B、读出寄存器组成。移位寄存器通过移位存储的方式，将1位LVDS数据转化为128位的并行数据，再写入缓存A，当缓存A写满后，将满标志位置1。硬件内线程会轮询缓冲区中满标志位，为1时缓冲区内的数据会被读出。读缓存A的同时，缓冲区写缓存B，在缓存B写满前，缓存A的内容会被读出清空，当缓存B也写满后，将满标志位置1，以此类推。并行数据以50M，128位并行数据的形式读出。上述利用硬件方式，即移位寄存器和缓冲区实现串行数据到并行数据的转换，在传统方法中使用软件完成，但软件进行比特操作耗费机时，使用硬件操作能够更有效率；PCIE-7821R采集卡可以接收128位并行，50M的数据，实际速度能够达到6.4Gbps，优于目前已有的方案。具体的，缓冲区的作用主要有以下几点：1)实现串行数据到并行数据的转换。2)缓冲数据，避免数据丢失。3)增加帧头，方便上层软件解码。4)实际使用中，通过轮询的方式，依次读出各缓冲区内容。通信协议设计上文中所述单路串行LVDS数传接口的数据格式如图9中所示，数据格式总长度为2196字节，分为成像帧头和图像数据，其中成像帧头为8字节，其余2188字节为图像数据。128路单端并行数据格式如图9中所示，一包128路单端并行数据有4096个字节，其中LVDS转接板帧头为8字节，转接板帧头包含数据的长度、通道号等，之后为数据部分。图9中数据部分为图9中数据的拼接，如图9中所示，第一包序号为0的数据填充后，未凑足4096字节，于是继续拼接第二包序号为1的数据，两包相加超过了4096字节，于是序号为1的包的剩余图像数据拼接到第二包的起始部分。若两包序号为1、2的数据时间间隔过大，则会引发超时机制，如图9所示，此时转接板会先以短包的形式发送序号为1的图像数据剩余部分。在上位机解码的过程中，需要先解码LVDS转接板帧头，将数据拼接为图9中所示结构，再解码成像帧头，提取其中图像数据，在上位机进行进行显示、存储等操作。上位机设计上位机软件结构如下图10所示，采用双层的生产者-消费者模型，接收线程是生产者，向解码线程1提供数据；解码线程1既是生产者，也是消费者，其消费接收线程提供的数据，同时向解码线程2提供数据；解码线程2是消费者，接收由生产者解码线程1提供的数据。具体的，软件的接收线程通过DMA方式，以数据流的形式读取PCIE-7821R采集到的数据，即接收图9中所示格式的数据，之后将数据放入解码队列1。同时，解码线程1不断访问解码队列1，当解码队列1不为空时，执行出队列操作，解码线程1将数据解包，即识别图9中所示格式中的LVDS转接板帧头，将其去除，再根据包头中通道号，将解包后的数据分别放入解码队列2。解码线程2完全相同，在使用时声明10个实例，分别对应10个不同的解码队列。解码线程2不断访问队列2，当队列2非空时，执行出队列操作，此时的数据是图9中格式的数据，是高速相机直接发出的科学数据，解码线程2识别其中成像帧头，将其解析为图像数据，供后续的图像显示、图像存储等线程调用。上位机软件如图11所示。高速相机正常工作时，系统能够正常采集数据并进行图像的显示、数据分析等功能，图中为采集了一幅平场图像。总得来说，本发明使用“LVDS转接板+并口采集卡”的形式，实现多路串行高速LVDS数据的采集，使用硬件对串行数据进行采集缓冲，以及串行数据转并行数据的操作，最高速度能够达到6.4Gbps。本发明通过串行转并行的方式，实现了数据的高速传输。使用硬件解码串行数据，相对软件解码更加简单高效，稳定性较高。又一方面，本发明还公开一种计算机可读存储介质，存储有计算机程序，所述计算机程序被处理器执行时，使得所述处理器执行如上述任一方法的步骤。再一方面，本发明还公开一种计算机设备，包括存储器和处理器，所述存储器存储有计算机程序，所述计算机程序被所述处理器执行时，使得所述处理器执行如上述任一方法的步骤。在本申请提供的又一实施例中，还提供了一种包含指令的计算机程序产品，当其在计算机上运行时，使得计算机执行上述实施例中任一方法的步骤。可理解的是，本发明实施例提供的系统与本发明实施例提供的方法相对应，相关内容的解释、举例和有益效果可以参考上述方法中的相应部分。本领域普通技术人员可以理解实现上述实施例方法中的全部或部分流程，是可以通过计算机程序来指令相关的硬件来完成，所述的程序可存储于一非易失性计算机可读取存储介质中，该程序在执行时，可包括如上述各方法的实施例的流程。其中，本申请所提供的各实施例中所使用的对存储器、存储、数据库或其它介质的任何引用，均可包括非易失性和/或易失性存储器。非易失性存储器可包括只读存储器、可编程ROM、电可编程ROM、电可擦除可编程ROM或闪存。易失性存储器可包括随机存取存储器或者外部高速缓冲存储器。作为说明而非局限，RAM以多种形式可得，诸如静态RAM、动态RAM、同步DRAM、双数据率SDRAM、增强型SDRAM、同步链路DRAM、存储器总线直接RAM、直接存储器总线动态RAM、以及存储器总线动态RAM等。以上实施例的各技术特征可以进行任意的组合，为使描述简洁，未对上述实施例中的各个技术特征所有可能的组合都进行描述，然而，只要这些技术特征的组合不存在矛盾，都应当认为是本说明书记载的范围。以上实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的精神和范围。
