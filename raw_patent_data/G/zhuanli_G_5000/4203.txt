标题title
基于在线噪声抑制策略的弱监督病理图像组织分割方法
摘要abst
本发明涉及基于在线噪声抑制策略的弱监督病理图像组织分割方法，包括：获取H&amp;E染色图，对所述H&amp;E染色图进行处理，获得数据集，对所述数据集进行划分，基于划分后的所述数据集训练分类网络，生成伪标签；基于在线噪声抑制策略抑制所述伪标签中存在的噪声，通过抑制噪声后的所述伪标签以及所述伪标签对应的训练集训练语义分割网络，获得训练后的所述语义分割网络的预测结果，将所述预测结果作为最终分割结果。本发明利用数字病理学和深度学习的分类算法及分割算法，可实现仅使用patch级标签实现肺癌/乳腺癌H&amp;E染色图像的组织分割，生成像素级分割结果，直观地展示肿瘤内部组织结构的空间分布情况。
权利要求书clms
1.基于在线噪声抑制策略的弱监督病理图像组织分割方法，其特征在于，包括：获取H&amp;E染色图，对所述H&amp;E染色图进行处理，获得数据集，对所述数据集进行划分，基于划分后的所述数据集训练分类网络，生成伪标签；基于在线噪声抑制策略抑制所述伪标签中存在的噪声，通过抑制噪声后的伪标签以及所述伪标签对应的训练集训练语义分割网络，获得训练后的所述语义分割网络的预测结果，将所述预测结果作为最终分割结果。2.根据权利要求1所述的基于在线噪声抑制策略的弱监督病理图像组织分割方法，其特征在于，获取H&amp;E染色图包括：收集肺癌/乳腺癌患者癌变区域组织的病理切片图像，对所述病理切片图像进行染色处理，得到肺癌/乳腺癌H&amp;E染色病理切片，再对所述肺癌/乳腺癌H&amp;E染色病理切片进行数字化处理，得到所述H&amp;E染色图。3.根据权利要求2所述的基于在线噪声抑制策略的弱监督病理图像组织分割方法，其特征在于，对所述H&amp;E染色图进行处理包括：划定所述H&amp;E染色图的感兴趣区域，将所述感兴趣区域无重叠地切分成相同系列的子图像块，为每个所述子图像块添加patch级标签，并指定所述patch级标签中存在的组织类别。4.根据权利要求1所述的基于在线噪声抑制策略的弱监督病理图像组织分割方法，其特征在于，对所述数据集进行划分，基于划分后的所述数据集训练分类网络，生成伪标签包括：根据所述数据集划分出训练集、验证集和测试集，使用深度学习模型构建所述分类网络，对所述训练集进行数据增强处理，基于数据增强处理后的所述训练集训练所述分类网络，通过所述验证集进行内部验证所述分类网络的分类性能，并通过所述测试集进行外部验证分类网络的分类性能，获得训练好的分类网络，基于所述训练好的分类网络，使用Grad-CAM++生成所述伪标签。5.根据权利要求4所述的基于在线噪声抑制策略的弱监督病理图像组织分割方法，其特征在于，基于数据增强处理后的所述训练集训练所述分类网络包括：基于大型公共图像数据库对所述分类网络进行预训练，获得分类网络初始模型，并设置所述分类网络初始模型的训练方案和超参数，基于数据增强处理后的所述训练集训练所述分类网络初始模型，引入渐进式丢弃注意力机制，迭代地擦除最具有判别性区域，迫使所述分类网络初始模型学习非判别性区域；其中，所述分类网络初始模型的每一层权重均设置为可更新模式。6.根据权利要求1所述的基于在线噪声抑制策略的弱监督病理图像组织分割方法，其特征在于，基于在线噪声抑制策略抑制所述伪标签中存在的噪声包括：基于标准的交叉熵对所述伪标签与预测置信度进行逐像素计算，获得损失图，通过改进加权交叉熵损失挑选所述损失图的损失，根据所述损失图的损失为不同的像素点赋予不同的权重，抑制所述伪标签中存在的噪声。7.根据权利要求6所述的基于在线噪声抑制策略的弱监督病理图像组织分割方法，其特征在于，改进所述加权交叉熵损失的方法为：其中，为分割网络的损失，/＞为损失权重，H和W分别表示维度，i和j分别表示坐标，P为可分割网络的预测，/＞为伪标签，/＞为，C为类别。8.根据权利要求6所述的基于在线噪声抑制策略的弱监督病理图像组织分割方法，其特征在于，为所述不同的像素点赋予不同的权重的方法为：其中，为将高损失值赋予一个较低的值，sm为在HW维度上使用softmax函数，为将高损失值赋予一个较低的值的平均值，sm为softmax函数，上的损失来作为表示学习困难程度的指标，W为权重。9.根据权利要求1所述的基于在线噪声抑制策略的弱监督病理图像组织分割方法，其特征在于，通过抑制噪声后的所述伪标签以及所述伪标签对应的训练集，训练所述语义分割网络包括：对所述伪标签对应的训练集进行数据增强处理，并设置所述分类网络的训练方案和超参数，通过抑制噪声后的所述伪标签以及数据增强处理后的所述训练集训练语义分割网络。10.根据权利要求1所述的基于在线噪声抑制策略的弱监督病理图像组织分割方法，其特征在于，将训练后的所述语义分割网络的预测结果作为最终分割结果包括：在所述H&amp;E染色图的预设倍率下使用重叠滑动窗口预测操作，截取相同像素大小的图像块，并获取所述图像块的重叠率，将所述图像块送入训练好的所述语义分割网络中，获得若干通道的概率图，将所述若干通道的概率图缝合为WSI级，对于重叠区域，计算每个像素位置的各个类别预测概率的平均值，并通过argmax操作来获取WSI分割结果；在对背景区域进行分割时，对缝合为WSI级的所述若干通道的概率图使用阈值分割方法进行分割，将灰度像素值大于预设值的点设置为固定数值，得到灰度图；将所述灰度图加入到所述WSI分割结果，得到所述最终分割结果。
说明书desc
技术领域本发明涉及数字病理学和深度学习的技术领域，特别是涉及一种基于在线噪声抑制策略的弱监督病理图像组织分割方法。背景技术肿瘤微环境是肿瘤细胞赖以生存的复杂环境，对肿瘤的发展、转移以及预后起着重要的作用。在组织层面，TME包括肿瘤上皮、肿瘤相关间质和肿瘤浸润性淋巴细胞等。肿瘤上皮与肿瘤相关间质之间的相互作用与肿瘤的发展相关。TILs的密度和空间分布已被证明是许多肿瘤预后的生物标志物，如肺癌，乳腺癌和结直肠癌。因此，组织分割对于精确定量TME至关重要。近年来，随着数字扫描仪技术的发展，大量的病理玻片生成全幅扫描病理图像，给基于人工智能的病理图像分析提供了充足的“燃料”。然而，大多数现存的方法需要密集的像素级标注用于训练，对于病理图像来说，获取这种像素级标注是非常昂贵且耗时的。由于病理图像的多样性及复杂性，只能由专业的病理学家或具有临床背景的医生才能标注。目前，人工智能技术特别是深度学习技术已经在生物医学图像处理领域取得大量成果。在仅使用patch级标签来完成病理图像组织分割的目的，能够极大地减小费时费力的像素级标注代价。病理医生只需要判断patch中是否存在某一组织类别，而无需在病理图像上仔细绘制组织的边界，从而能够大大减少数据标注的工作量。发明内容本发明的目的是提供了基于在线噪声抑制策略的弱监督病理图像组织分割方法，利用数字病理学和深度学习的分类算法及分割算法，可实现仅使用patch级标签实现肺癌/乳腺癌H&amp;E染色图像的组织分割，生成像素级分割结果，直观地展示肿瘤内部组织结构的空间分布情况。为实现上述目的，本发明提供了如下方案：基于在线噪声抑制策略的弱监督病理图像组织分割方法，包括：获取H&amp;E染色图，对所述H&amp;E染色图进行处理，获得数据集，对所述数据集进行划分，基于划分后的所述数据集训练分类网络，生成伪标签；基于在线噪声抑制策略抑制所述伪标签中存在的噪声，通过抑制噪声后的伪标签以及所述伪标签对应的训练集训练语义分割网络，获得训练后的所述语义分割网络的预测结果，将所述预测结果作为最终分割结果。优选地，获取H&amp;E染色图包括：收集肺癌/乳腺癌患者癌变区域组织的病理切片图像，对所述病理切片图像进行染色处理，得到肺癌/乳腺癌H&amp;E染色病理切片，再对所述肺癌/乳腺癌H&amp;E染色病理切片进行数字化处理，得到所述H&amp;E染色图。优选地，对所述H&amp;E染色图进行处理包括：划定所述H&amp;E染色图的感兴趣区域，将所述感兴趣区域无重叠地切分成相同系列的子图像块，为每个所述子图像块添加patch级标签，并指定所述patch级标签中存在的组织类别。优选地，对所述数据集进行划分，基于划分后的所述数据集训练分类网络，生成伪标签包括：根据所述数据集划分出训练集、验证集和测试集，使用深度学习模型构建所述分类网络，对所述训练集进行数据增强处理，基于数据增强处理后的所述训练集训练所述分类网络，通过所述验证集进行内部验证所述分类网络的分类性能，并通过所述测试集进行外部验证分类网络的分类性能，获得训练好的分类网络，基于所述训练好的分类网络，使用Grad-CAM++生成所述伪标签。优选地，基于数据增强处理后的所述训练集训练所述分类网络包括：基于大型公共图像数据库对所述分类网络进行预训练，获得分类网络初始模型，并设置所述分类网络初始模型的训练方案和超参数，基于数据增强处理后的所述训练集训练所述分类网络初始模型，引入渐进式丢弃注意力机制，迭代地擦除最具有判别性区域，迫使所述分类网络初始模型学习非判别性区域；其中，所述分类网络初始模型的每一层权重均设置为可更新模式。优选地，基于在线噪声抑制策略抑制所述伪标签中存在的噪声包括：基于标准的交叉熵对所述伪标签与预测置信度进行逐像素计算，获得损失图，通过改进加权交叉熵损失挑选所述损失图的损失，根据所述损失图的损失为不同的像素点赋予不同的权重，抑制所述伪标签中存在的噪声。优选地，改进所述加权交叉熵损失的方法为：其中，为分割网络的损失，/＞为损失权重，H和W分别表示维度，i和j分别表示坐标，P为可分割网络的预测，/＞为伪标签，/＞为，C为类别。优选地，为所述不同的像素点赋予不同的权重的方法为：其中，为将高损失值赋予一个较低的值，sm为在HW维度上使用softmax函数，/＞为将高损失值赋予一个较低的值的平均值，sm为softmax函数，上的损失来作为表示学习困难程度的指标，W为权重。优选地，通过抑制噪声后的所述伪标签以及所述伪标签对应的训练集，训练所述语义分割网络包括：对所述伪标签对应的训练集进行数据增强处理，并设置所述分类网络的训练方案和超参数，通过抑制噪声后的所述伪标签以及数据增强处理后的所述训练集训练语义分割网络。优选地，将训练后的所述语义分割网络的预测结果作为最终分割结果包括：在所述H&amp;E染色图的预设倍率下使用重叠滑动窗口预测操作，截取相同像素大小的图像块，并获取所述图像块的重叠率，将所述图像块送入训练好的所述语义分割网络中，获得若干通道的概率图，将所述若干通道的概率图缝合为WSI级，对于重叠区域，计算每个像素位置的各个类别预测概率的平均值，并通过argmax操作来获取WSI分割结果；在对背景区域进行分割时，对缝合为WSI级的所述若干通道的概率图使用阈值分割方法进行分割，将灰度像素值大于预设值的点设置为固定数值，得到灰度图；将所述灰度图加入到所述WSI分割结果，得到所述最终分割结果。本发明的有益效果为：本发明提出一种基于在线噪声抑制策略的弱监督病理图像组织分割方法，使用深度学习的方法构建模型来帮助分割病理图像中的组织，并进行直观展示，原则上可以分割任意类别数的组织类型，帮助医生对肿瘤内部不同组织结构的空间异质性进行分析，从而有助于对肺癌/乳腺癌患者进行预后分析，制定更加合适的治疗方案，有重大的临床意义。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例的基于在线噪声抑制策略的弱监督病理图像组织分割方法流程图；图2为本发明实施例的肺癌H&amp;E染色图切分为图像块并添加标签示意图；图3为本发明实施例的分类网络生成伪标签过程示意图；图4为本发明实施例的分割网络进行组织分割过程示意图；图5为本发明实施例的整张WSI分割过程示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。如图1所示，基于在线噪声抑制策略的弱监督病理图像组织分割方法，包括：获取H&amp;E染色图，对所述H&amp;E染色图进行处理，获得数据集，对所述数据集进行划分，基于划分后的所述数据集训练分类网络，生成伪标签；基于在线噪声抑制策略抑制所述伪标签中存在的噪声，通过抑制噪声后的所述伪标签以及所述伪标签对应的训练集训练语义分割网络，获得训练后的所述语义分割网络的预测结果，将所述预测结果作为最终分割结果。进一步地，获取H&amp;E染色图包括：收集肺癌/乳腺癌患者癌变区域组织的病理切片图像，对所述病理切片图像进行染色处理，得到肺癌/乳腺癌H&amp;E染色病理切片，再对所述肺癌/乳腺癌H&amp;E染色病理切片进行数字化处理，得到所述H&amp;E染色图。进一步地，对所述H&amp;E染色图进行处理包括：划定所述H&amp;E染色图的感兴趣区域，将所述感兴趣区域无重叠地切分成相同系列的子图像块，为每个所述子图像块添加patch级标签，并指定所述patch级标签中存在的组织类别。进一步地，对所述数据集进行划分，基于划分后的所述数据集训练分类网络，生成伪标签包括：根据所述数据集划分出训练集、验证集和测试集，使用深度学习模型构建所述分类网络，对所述训练集进行数据增强处理，基于数据增强处理后的所述训练集训练所述分类网络，通过所述验证集进行内部验证所述分类网络的分类性能，并通过所述测试集进行外部验证分类网络的分类性能，获得训练好的分类网络，基于所述训练好的分类网络，使用Grad-CAM++生成所述伪标签。进一步地，基于数据增强处理后的所述训练集训练所述分类网络包括：基于大型公共图像数据库对所述分类网络进行预训练，获得分类网络初始模型，并设置所述分类网络初始模型的训练方案和超参数，基于数据增强处理后的所述训练集训练所述分类网络初始模型，引入渐进式丢弃注意力机制，迭代地擦除最具有判别性区域，迫使所述分类网络初始模型学习非判别性区域；其中，所述分类网络初始模型的每一层权重均设置为可更新模式。进一步地，基于在线噪声抑制策略抑制所述伪标签中存在的噪声包括：基于标准的交叉熵对所述伪标签与预测置信度进行逐像素计算，获得损失图，通过改进加权交叉熵损失挑选所述损失图的损失，根据所述损失图的损失为不同的像素点赋予不同的权重，抑制所述伪标签中存在的噪声。进一步地，改进所述加权交叉熵损失的方法为：其中，为分割网络的损失，/＞为损失权重，H和W分别表示维度，i和j分别表示坐标，P为可分割网络的预测，/＞为伪标签，/＞为，C为类别。进一步地，为所述不同的像素点赋予不同的权重的方法为：其中，为将高损失值赋予一个较低的值，sm为在HW维度上使用softmax函数，/＞为将高损失值赋予一个较低的值的平均值，sm为softmax函数，上的损失来作为表示学习困难程度的指标，W为权重。进一步地，通过抑制噪声后的所述伪标签以及所述伪标签对应的训练集，训练所述语义分割网络包括：对所述伪标签对应的训练集进行数据增强处理，并设置所述分类网络的训练方案和超参数，通过抑制噪声后的所述伪标签以及数据增强处理后的所述训练集训练语义分割网络。进一步地，将训练后的所述语义分割网络的预测结果作为最终分割结果包括：在所述H&amp;E染色图的预设倍率下使用重叠滑动窗口预测操作，截取相同像素大小的图像块，并获取所述图像块的重叠率，将所述图像块送入训练好的所述语义分割网络中，获得若干通道的概率图，将所述概率图缝合为WSI级，对于重叠区域，计算每个像素位置的各个类别预测概率的平均值，并通过argmax操作来获取WSI分割结果；在对背景区域进行分割时，对缝合为WSI级的所述概率图使用阈值分割方法进行分割，将灰度像素值大于预设值的点设置为固定数值，得到背景的灰度图；将所述灰度图加入到所述WSI分割结果，得到所述最终分割结果。为使本发明的上述目的、特征和优点能够更加明显易懂，下面结合附图和具体实施方式对本发明作进一步详细的说明。本实施例为基于在线噪声抑制策略的弱监督病理图像组织分割方法，包括下述步骤：收集肺癌/乳腺癌患者癌变区域组织的病理切片图像，染色处理得到肺癌/乳腺癌H&amp;E染色病理切片，再对所述肺癌/乳腺癌H&amp;E染色病理切片进行数字化得到H&amp;E染色图；本实施例采用的染色处理是使用苏木精染液对细胞核内的染色质与细胞质内的核酸着紫蓝色，使用伊红染液对细胞质和细胞外基质中的成分着红色。如图2所示，在所述H&amp;E染色图中划定感兴趣区域，并将所述感兴趣区域切分成224*224大小的patch，由病理医生使用独热编码的形式对patch进行标注，医生只需指定某一patch中存在哪些组织类别，其中，在肺癌病理图像中包含四个组织类别：肿瘤上皮、肿瘤相关间质、坏死和淋巴细胞；在乳腺癌病理图像中包含四个组织类别：肿瘤，间质，淋巴浸润和坏死；其中，所述感兴趣区域包含不同的组织类别，得到数据集，具体为：将所述感兴趣区域通过无重叠地切分为一系列的子图像块得到，并且根据划分结果，为每个子图像块添加一个patch级标签，用于指示某一patch中存在哪些组织类别，从而得到数据集，在肺腺癌数据集中，所述标签有肿瘤上皮、肿瘤相关间质、坏死和淋巴细胞，所述子图像块的大小设定为10x倍率下的相应像素；在乳腺癌数据集中，所述标签有肿瘤，间质，淋巴浸润和坏死，所述子图像块的大小设定为40x倍率下的相应像素；肺腺癌所述训练集来自29张H&amp;E染色的WSIs，所述验证集和测试集来自25张H&amp;E染色的WSIs，切分patch后的数据分布为：训练集，验证集以及测试集；乳腺癌所述数据集来自151张H&amp;E染色的WSIs，切分patch后的数据划分为：训练集为23422张patch，验证集和测试集分别为3418、4986张patch。两个数据的验证集均用于深度神经网络性能的内部验证，测试集均用于深度学习网络性能的外部验证。根据所述数据集，划分出训练集、验证集和测试集。使用patch级标签的训练集训练一个分类网络，并对训练集进行数据增强处理，所述验证集用于内部验证神经网络分类器的分类性能。得到训练好的分类网络后，使用Grad-CAM++来生成训练集的伪标签；在分类阶段，使用所述patch级标签训练集训练所述卷积神经网络分类器包括：使用机器学习技术领域的深度学习模型构建卷积神经网络分类器，采用在大型公共图像数据库ILSVRC2012上进行过预训练的卷积神经网络ResNet38作为初始模型，设置训练方案和超参数，随后使用所述训练集对初始模型进行训练，训练时卷积神经网络的每一层的权重都被设置为可更新的。为了产生更加精确的伪标签，缓解传统CAM存在的区域收缩问题——即随着卷积网络训练次数的迭代，分类器往往会聚焦在目标对象最具有判别性的区域，本实施例引入了渐进式丢弃注意力机制，迭代的“擦除”那些最具有判别性区域，从而迫使分类网络学习非判别性但属于对象的其它区域。此外，分类网络使用多标签软边缘损失来训练，最终在训练完成的分类网络模型上，使用Grad-CAM++来生成伪标签，具体为：根据得到的数据集，切分为训练集、验证集和测试集。其中，在分类阶段所述训练集用于训练卷积神经网络分类器，所述验证集用于内部验证卷积神经网络分类器的分类性能，所述测试集用于进一步外部测试卷积神经网络分类器的分类性能，在分割阶段，使用上一阶段的训练集以及生成的伪标签训练语义分割网络，所述验证集用于内部验证语义分割网络的性能，所述测试集用于进一步外部测试语义分割网络的性能；为了达到数据增强进而提高网络泛化性的目的，在分类阶段，将已得到的训练集中的每一张图像块以0.5的概率进行随机水平和翻转变换；在分割阶段，使用随机翻转、裁剪和变形数据增强方式，并在推理阶段，使用多尺度测试，包括。在分类阶段，使用机器学习技术领域的深度学习模型构建卷积神经网络分类器，采用在大型公共图像数据库ILSVRC2012上进行过预训练的卷积神级网络ResNet38作为初始模型，选择的训练方案和超参数设置具体为：1)使用SGD算法作为更新模型参数时的优化函数；2)使用小批量梯度下降法MBGD作为训练方案；3)将超参数mini-batch大小设置为16；4)epoch的大小设置为20；5)学习率设为0.01；6)使用多标签软边缘损失函数；随后使用所述的训练集对初始模型进行训练，训练时卷积神经网络的每一层的权重都被设置为可更新的。为了产生更加精确的伪标签，缓解传统CAM存在的区域收缩问题——即随着卷积网络训练次数的迭代，分类器往往会聚焦在目标对象最具有判别性的区域，本实施例引入了渐进式丢弃注意力机制，迭代的“擦除”那些最具有判别性区域，从而迫使分类网络学习非判别性但属于对象的其它区域。最终在训练完成的分类网络模型上，使用Grad-CAM++来生成伪标签，如图3所示。使用分类网络生成的伪标签以及对应的训练集训练语义分割网络，使用在线噪声抑制策略来抑制伪标签中存在的噪声对分割模型的影响，从而提高分割的准确率，在训练过程中，使用所述验证集对语义分割网络的性能进行内部验证，然后在所述测试集上对语义分割网络的性能进行最终验证，语义分割网络的预测结果作为最终分割结果；在分割阶段，本实施例使用所述训练集以及分类网络生成的伪标签训练了一个语义分割网络。本实施例使用了backbone为ResNet38的PSPNet，使用SGD优化器，数据增强包括随机翻转、随机裁剪和变形等。由于分类网络生成的伪标签不可避免的存在着噪声，为了缓解这种噪声对分割模型的影响，本实施例提出了一种在线噪声抑制策略，具体为：如图4所示，在分割阶段，本实施例使用所述训练集以及分类网络生成的伪标签训练了一个语义分割网络，本实施例采用backbone为ResNet38的PSPNet，选择的训练方案和超参数设置具体为：1)使用SGD算法作为更新模型参数时的优化函数；2)使用小批量梯度下降法MBGD作为训练方案；3)将超参数mini-batch大小设置为16；4)迭代次数为10000次；5)学习率设为5e-3；6)使用改进的交叉熵损失函数。本实施例可以分割网络的预测为P，其伪标签为M，本实施例改进了加权交叉熵损失，可以表示为：其中，表示分割网络的损失，/＞表示损失权重，i和j分别表示坐标，H与W分别表示维度和权重，C用于表示类别。为了获取损失权重，我们挑选损失图上的损失来作为表示学习困难程度的指标，其中损失图是通过标准的交叉熵来进行逐像素计算的。这种损失图是基于伪标签与预测置信度来计算的，含有丰富的信息。基于这种指标，本实施例提出了一种利用损失图来抑制噪声样本的策略。这一策略是基于以下观察而得到的：在网络在对噪声像素进行预测时，如果其置信度较高，该像素点的损失值也会较高。相反，那些受到更准确信号监督的像素具有较低的损失值。为了抑制噪声像素，本实施例根据损失图上的损失来为不同的像素点赋予不同的权重。换言之，其目的就是为噪声像素赋予低权重，为准确像素赋予更高的权重。具体来说，本实施例在损失图上加个负号，并在HW维度上使用softmax函数sm，再除以其平均值。其中，sm是为了将高损失值赋予一个较低的值，低损失值赋予一个较高的值，最终每个位置都除以平均值，从而达到根据损失值来赋予不同权重的目的。最终模型的预测结果使用argmax函数来得到。如图5所示对整张WSIs进行组织分割的具体步骤为：1)在所述肺癌H&amp;E染色图中的10x倍率下使用重叠滑动窗口预测操作，每次截取224*224像素大小的正方形图像块，重叠率为50％，并将图像块送入所述训练好的语义分割网络中，为每个patch得到通道数为n的概率图，对应于每个类别，然后本实施例将每个patch的概率图缝合为WSI级。对于重叠区域，计算每个像素位置的各个类别预测概率的平均值，最终，通过argmax操作来获取WSI分割结果；2)在对背景区域进行分割时，对WSI原图使用阈值分割方法进行分割，将灰度像素值大于210的点置为255，否则不变，具体操作为：ret,binary＝cv2.threshold在得到背景的灰度图之后，将其加入分割mask，得到最终的分割结果。本发明可以利用数字病理学和深度学习的分类算法，实现自动地从肺癌/乳腺癌H&amp;E染色图中识别肿瘤内不同的组织，并生成最终的分割结果，直观地展示肿瘤内部组织结构的空间分布情况，帮助医生对肺癌/乳腺癌患者进行分级以及预后分析。以上所述的实施例仅是对本发明优选方式进行的描述，并非对本发明的范围进行限定，在不脱离本发明设计精神的前提下，本领域普通技术人员对本发明的技术方案做出的各种变形和改进，均应落入本发明权利要求书确定的保护范围内。
