标题title
一种云优化的静态地理信息矢量数据在线服务方法
摘要abst
本发明提出一种基于云优化的静态地理信息矢量数据在线服务方法，包括：步骤S1、通过浏览器向云端服务器在线发起HTTP请求，请求获取地理信息数量数据；步骤S2、确定当前窗口地图比例尺；步骤S3、通过CoGeobuf库根据当前窗口地图比例尺，自动计算层级范围；步骤S4、判断是否有空间范围约束，如果有则使用空间索引，根据空间索引去计算字节范围；如果没有则根据请求参数计算出字节范围；将字节范围转换为HTTPRange请求；步骤S5、从CoGeobuf文件中提取二进制空间数据；步骤S6、将二进制空间数据返回浏览器；步骤S7、前端解析转换为GeoJSON格式进行显示。
权利要求书clms
1.一种基于云优化的静态地理信息矢量数据在线服务方法，其特征在于，包括：步骤S1、通过浏览器向云端服务器在线发起HTTP请求，请求获取地理信息数量数据；步骤S2、确定当前窗口地图比例尺；步骤S3、通过CoGeobuf库根据当前窗口地图比例尺，自动计算层级范围；步骤S4、判断是否有空间范围约束，如果有则使用空间索引，根据空间索引去计算字节范围；如果没有则根据请求参数计算出字节范围；将字节范围转换为HTTP Range请求；步骤S5、从CoGeobuf文件中提取二进制空间数据；步骤S6、将二进制空间数据返回浏览器；步骤S7、前端解析转换为GeoJSON格式进行显示。2.根据权利要求1所述的一种基于云优化的静态地理信息矢量数据在线服务方法，其特征在于：所述步骤S2中，通过如下方式确定窗口地图比例尺：HTTP请求中获取瓦片号z/x/y，其中z是显示级别，不同显示级别对应不同比例尺，依据地图层级与比例尺对应关系进行获取。3.根据权利要求1所述的一种基于云优化的静态地理信息矢量数据在线服务方法，其特征在于：所述步骤S3中，通过如下方式提供最适合的层级：经过Overview抽稀过的数据内部会记录层次相关信息，根据比例尺和层级对应关系，取出相应层级的数据。4.根据权利要求1所述的一种基于云优化的静态地理信息矢量数据在线服务方法，其特征在于：所述步骤S3中，将原始GIS数据通过库CoGeobuf，使用希尔伯特R树和FlatBuffers将0层数据及以上各层Overview数据序列化存储到CoGeobuf二进制文件，并上传到云对象存储桶中；CoGeobuf数据格式如下：CoGeobuf文件由3部分构成：文件头、索引区、数据区，索引区记录各数据区起始位置及长度，数据区记录各级要素，索引区和数据区一一对应。5.根据权利要求4所述的一种基于云优化的静态地理信息矢量数据在线服务方法，其特征在于：采用希尔伯特R树创建空间索引，采用FlatBuffers格式来序列化数据支持随机访问。6.根据权利要求1所述的一种基于云优化的静态地理信息矢量数据在线服务方法，其特征在于：所述步骤S4、判断是否有空间范围约束，如果有则使用空间索引，所述的空间索引是指依据空间对象的位置和形状或空间对象之间的某种空间关系按一定的顺序排列的一种数据结构，其中包含空间对象的概要信息，根据空间索引去计算字节范围；如果没有则根据请求参数计算出字节范围；将字节范围转换为HTTPRange请求，根据字节范围提取出相应的数据，并返回给客户端。
说明书desc
技术领域本发明涉及地理信息技术领域，尤其是一种云优化的静态地理信息矢量数据在线服务方法。背景技术已有技术中经常遇到地理信息系统数据的存储数据量较大，地图加载高精度矢量数据缓慢另外，地理信息矢量数据和带有空间特征的数据来源广泛，格式繁杂，大多都同时包含空间图形数据和属性数据，一般采用空间数据库管理，占用大量表空间，如果在线发布，需要搭建高性能服务器集群，成本很高。此外，这些数据大部分不需要进行编辑修改，即静态数据，现有的技术也能解决部分问题，比如FlatGeobuf也使用希尔伯特R树作为数据结构，使用FlatBuffers格式序列化数据，对于数据量大小没有限制，并且适合流式和随机访问。FlatGeobuf设计仅支持Simple Features，非Simple Features，比如带有交叉旋转等复杂的不规范拓扑的矢量数据不能导入；数据访问速度依赖数据集大小，在中小数据集中可快速加载，在大数据集情况下，则加载缓慢，虽流式接口可在一定程度上改善体验，但仅此是不够的。MBTiles和GeoPackage都是基于SQLite数据库文件，优点在于数据量小，方便迁移，方便使用于移动端使用，使用PHP或者Node.js开发简单的服务就可以发布数据。但是MBTiles和GeoPackage不适合云对象存储服务，且MBTiles是数据有损的，占用空间大。GeoJSON适合小型数据集，自身没有索引。Shapefile文件几何类型，大小，属性等都有限制，文件数量多，占用空间大。GeoJSON是基于JSON的格式，适合数据量较小的文件，不支持随机访问，数据量大的的情况下效率较低。Shapefile是一种比较原始的多文件格式矢量数据存储方式，而且文件大小和字段长度都有限制。综上，地理信息系统数据由于空间索引效率低，序列化数据的算法效率不够高，缺乏分层策略，没有针对高精度数据进行简化抽稀等优化，存在传输的数据较大，不适合随机访问等问题。发明内容为了解决上述技术问题，本发明通过云优化的静态地理信息矢量数据CloudOptimized Geobuf来加快地图数据访问的速度，高效的提供数据服务。这些优化方式包括按不同比例尺对数据提前分层处理，增加Overview，优先返回简化抽稀的数据；可导入非Simple Features数据格式，底层采用FlatBuffers来进行序列化，支持随机访问；使用希尔伯特R树算法为静态空间数据创建索引，来支持空间查询；并将已序列化的数据存储数据到云对象存储服务器上，直接对外发布。本发明的技术方案为：一种基于云优化的静态地理信息矢量数据在线服务方法，包括：步骤S1、通过浏览器向云端服务器在线发起HTTP请求，请求获取地理信息数量数据；步骤S2、确定当前窗口地图比例尺；步骤S3、通过CoGeobuf库根据当前窗口地图比例尺，自动计算层级范围；步骤S4、判断是否有空间范围约束，如果有则使用空间索引，根据空间索引去计算字节范围；如果没有则根据请求参数计算出字节范围；将字节范围转换为HTTP Range请求；步骤S5、从CoGeobuf文件中提取二进制空间数据；步骤S6、将二进制空间数据返回浏览器；步骤S7、前端解析转换为GeoJSON格式进行显示。有益效果：本发明的一种基于云优化的静态地理信息矢量数据在线服务方法，具有如下优点：1)增加Overview，对数据分层抽稀简化，可按比例尺返回最适合的层级数据；2)使用FlatBuffers格式支持随机访问；3)支持HTTP Range，可以通过http协议实现按字节范围读取文件；4)放宽了对非Simple Features数据的支持；5)采用希尔伯特R树存储空间数据，空间相邻要素存储在一起，通过空间索引，支持快速空间查询；6)支持云存储，不需要开发专用的服务端程序，可直接访问数据。附图说明图1：本发明的一种基于云优化的静态地理信息矢量数据在线服务方法流程图；图2：Overview数据层；图3：CoGeobuf数据格式。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整的描述，显然，所描述的实施例仅为本发明的一部分实施例，而不是全部的实施例，基于本发明中的实施例，本领域的普通技术人员在不付出创造性劳动的前提下所获得的所有其他实施例，都属于本发明的保护范围。根据本发明的实施例，提出一种基于云优化的静态地理信息矢量数据在线服务方法，如图1所示，包括：步骤S1、通过浏览器向云端服务器在线发起HTTP请求，请求获取地理信息数量数据；步骤S2、确定当前窗口地图比例尺；根据本发明的一个实施例，本发明的预先通过第三方工具对原始数据简化抽稀，作为Overview数据层。Overview：也即概视图，它的第一个级别在全分辨率下创建，后续各个级别均在上一次生成的概视图级别基础上进行抽稀创建。采用金字塔模型进行存储，针对不同分辨率的地图范围，提供不同分辨率的数据。金字塔模型是一种多分辨率层次模型，在统一的空间参照下，根据用户需要以不同分辨率进行存储与显示，形成分辨率由粗到细、数据量由小到大的金字塔结构。金字塔最底层的分辨率最高、比例尺最大、数据量最大、地图信息最详细，随着层数的增加，其分辨率逐渐降低，数据量逐渐减少、地图信息逐渐简化。比如0级仅显示洲名及简化后的全球地貌和洲边界线，8级显示市名及简化后的市边界线、道路、兴趣点，16级显示街道名及原始未简化的道路、等高线、兴趣点等全量要素。Overview一般用于栅格数据，本发明继续扩展性的沿用这个概念。根据本发明的实施例，以1千米分辨率的矢量数据为例，首先解析原始GIS数据，确定分层简化级别和各级简化参数，通过第三方工具对原始数据简化抽稀，作为Overview数据层。以北京地图为例，简化抽稀成1层，2层，如图2所示。0层有4662个点，1层抽稀后有333个点，2层进一步抽稀后有77个点，形成金字塔结构数据。根据本发明的实施例，通过如下方式确定窗口地图比例尺：HTTP请求中可以获取瓦片号z/x/y，其中z是显示级别，不同显示级别对应不同比例尺，参考openstreetmap地图层级与比例尺对应关系；根据本发明的实施例，通过如下方式提供最适合的层级：经过Overview抽稀过的数据内部会记录层次相关信息，根据比例尺和层级对应关系，可以取出相应层级的数据)表1步骤S3、通过CoGeobuf库根据当前窗口地图比例尺，自动计算层级范围；根据本发明的实施例，本发明采用定制的CoGeobuf库，其是使用FlatBuffers编码的，存储在云对象存储桶的，自定义的二进制地理空间数据，文件扩展名为cgf。R树，即R-Tree，是用来处理高维空间数据存储的树状数据结构。例如给地理位置，矩形和多边形这类多维数据创建索引。希尔伯特R树：Hilbert R-Tree，它是一种R树的变体，是一种对多维对象比如线、区域、三维物体或者高维特征对象的索引。用于实现快速边界框空间过滤，且数据存储有空间相邻的特征，查询效率更高。本发明将原始GIS数据通过本发明定制开发的库CoGeobuf，使用希尔伯特R树和FlatBuffers将0层数据及以上各层Overview数据序列化存储到CoGeobuf二进制文件，并上传到云对象存储桶中。这三层数据的存储格式如下图3所示。CoGeobuf数据格式如下：CoGeobuf文件由3部分构成：文件头、索引区、数据区。索引区记录各数据区起始位置及长度，数据区记录各级要素，索引区和数据区一一对应。本例由3层组成：0层：无损全量要素；1层：简化后的要素；2层：在1级基础上进一步简化后的要素。同时，本发明由于使用FlatBuffers格式，因此能够支持随机访问；本发明采用希尔伯特R树创建空间索引，希尔伯特曲线是一种空间填充曲线，特点是空间上相邻的对象会邻近存储在一块，可以减少IO的时间，提高内存中数据处理效率。采用FlatBuffers格式来序列化数据支持随机访问，FlatGeobuf：简称fgb，是一种为地理图形数据进行二进制编码的格式，基于FlatBuffers。它能容纳开放地理空间协会发布的Simple Features规范下的数据。主要用于提供无损静态矢量数据，其中，Simple Features:也称简单图形，是矢量数据的一种子集。它通常由两部分组成：geometry和attributes，前者用于描述对象在自然界的所处的位置，后者用于描述它自身的属性。本发明放宽了对非Simple Features数据的支持，FlatBuffers提供前向/后向兼容性和optional字段，以支持大多数格式的演变。但仅有这些是不够的，还需要对数据分层优化，比如增加Overview，还需要考虑数据的存储和访问，可以借助云对象存储服务，支持HTTP Range请求，快速实现静态GIS数据的请求响应。步骤S4、判断是否有空间范围约束，具体指的是：http请求中包含的空间范围参数，例如矩形范围bounds＝，如果有则使用空间索引，所述的空间索引是指依据空间对象的位置和形状或空间对象之间的某种空间关系按一定的顺序排列的一种数据结构，其中包含空间对象的概要信息，如对象的标识、外接矩形及指向空间对象实体的指针，根据空间索引去计算字节范围，例如，FlatBuffers把数据保存在一个一维的数组中，每个对象在数组中被分为两部分。元数据部分：负责存放索引。真实数据部分：存放实际的值。FlatBuffers使用严格的对齐规则和字节顺序。根据空间索引可以找到元数据中的字节范围值)；如果没有则根据请求参数计算出字节范围，例如，根据http请求中的瓦片号计算出该瓦片的空间范围，从而计算出相应的字节范围；将字节范围转换为HTTP Range请求，根据字节范围提取出相应的数据，并返回给客户端；所述HTTP Range，也即范围请求，HTTP协议范围请求允许服务器只发送HTTP消息的一部分到客户端。范围请求在传送大的媒体文件，或者与文件下载的断点续传功能搭配使用时非常有用。大多数的云服务提供商的对象存储服务，亚马逊AWS S3、阿里云OSS等，都默认支持这个选项。因此托管在这些地方的文件都可以通过HTTP协议按需读取数据。步骤S5、从CoGeobuf文件中提取二进制空间数据；步骤S6、将二进制空间数据返回浏览器；步骤S7、前端解析转换为GeoJSON格式进行显示。所述的GeoJSON：是一种基于JSON的地理空间数据交换格式，它定义了几种类型JSON对象以及它们组合在一起的方法，以表示有关地理要素、属性和它们的空间范围的数据。互联网工程任务组制作了的GeoJSON数据格式标准规范。根据本发明的另一个实施例，当有不同比例尺和不同精度数据的时候，不能简单套用这些步骤，而应综合考虑效果与效率，来权衡Overview分层层级和抽稀简化的程度。尽管上面对本发明说明性的具体实施方式进行了描述，以便于本技术领域的技术人员理解本发明，且应该清楚，本发明不限于具体实施方式的范围，对本技术领域的普通技术人员来讲，只要各种变化在所附的权利要求限定和确定的本发明的精神和范围内，这些变化是显而易见的，一切利用本发明构思的发明创造均在保护之列。
