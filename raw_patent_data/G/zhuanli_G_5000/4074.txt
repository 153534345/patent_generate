标题title
一种自动驾驶测试场景脚本生成方法、装置及电子设备
摘要abst
本申请提供一种自动驾驶测试场景脚本生成方法、装置及电子设备，其中方法包括：根据待生成测试场景类别，获取所述待生成测试场景的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率；根据待赋值变量、变量赋值顺序，待赋值变量候选取值以及候选取值的选取概率，按照变量赋值顺序，依次迭代概率抽取每个待赋值变量的候选取值，直至所述待赋值变量均完成赋值；将所述待生成测试场景转换为测试场景脚本。通过概率抽样的方式选取每个待赋值变量的候选取值，最终生成多样性的测试场景脚本，一方面提高了自动驾驶测试场景脚本的生成效率，另一方面提高了自动驾驶测试覆盖率。
权利要求书clms
1.一种自动驾驶测试场景脚本生成方法，其特征在于，包括：根据待生成测试场景类别，获取所述待生成测试场景的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率；根据待赋值变量、变量赋值顺序，待赋值变量候选取值以及候选取值的选取概率，按照变量赋值顺序，依次迭代概率抽取每个待赋值变量的候选取值，直至所述待赋值变量均完成赋值；将所述待生成测试场景转换为测试场景脚本。2.根据权利要求1所述的自动驾驶测试场景脚本生成方法，其特征在于，所述根据待生成测试场景类别，获取所述待生成测试场景的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率，包括：根据待生成测试场景类别，在预设映射表中查询所述待生成测试场景类别所对应的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率。3.根据权利要求1所述的自动驾驶测试场景脚本生成方法，其特征在于，其中，所述候选取值的选取概率根据流网络中流经每条边的流量确定，所述流网络的训练步骤包括：确定历史测试场景类别，针对每个类别的历史测试场景，分别以该历史测试场景下的待赋值变量为所述流网络的节点，以所述待赋值变量的候选取值作为边，以所述变量赋值顺序为每条路径中所述节点的排序顺序，构建流网络；所述流网络中的一条路径对应一个历史测试场景；以每个流网络所涉及历史测试场景的奖励值总和作为该流网络中初始节点的输入流量，以该流网络每条路径所对应的历史测试场景的奖励值作为该路径终端节点的输入流量；训练每个流网络，使得所述流网络学习流经每条边的流量；根据所述流网络中流经每条边的流量确定所述候选取值的选取概率。4.根据权利要求3所述的自动驾驶测试场景脚本生成方法，其特征在于，所述训练每个流网络，使得所述流网络学习流经每条边的流量，包括：以用于表征流入流网络节点与流出该流网络节点之间的流量差的损失函数最小为训练目标，训练所述流网络，使得所述流网络学习流经每条边的流量。5.根据权利要求3所述的自动驾驶测试场景脚本生成方法，其特征在于，所述根据所述流网络中流经每条边的流量确定所述候选取值的选取概率，包括：确定所述候选取值所在边的起始节点；获取所述起始节点的流入流量，根据流经所述候选取值所在边的流量与所述起始节点的流入流量之间的比值确定所述候选取值的选取概率。6.根据权利要求2所述的自动驾驶测试场景脚本生成方法，其特征在于，在所述将所述待生成测试场景转换为测试场景脚本之前，还包括：根据待生成测试场景所选取的每个待赋值变量候选取值的选取概率，获取待生成测试场景的奖励参数；筛选所述奖励参数大于预设奖励参数阈值的待生成测试场景。7.根据权利要求1所述的自动驾驶测试场景脚本生成方法，其特征在于，在所述将所述待生成测试场景转换为测试场景脚本之后，还包括：将所述测试场景脚本加载至部署有自动驾驶车辆的模拟环境；获取所述模拟环境中所述自动驾驶车辆反馈的车辆运行数据；根据所述车辆运行数据对所述测试场景脚本进行验证，获取满足预设验证要求的测试场景脚本。8.一种自动驾驶测试场景脚本生成装置，其特征在于，包括：待生成测试场景参数查询模块，用于根据待生成测试场景类别，获取所述待生成测试场景的待赋值变量以及变量赋值顺序；待赋值变量候选取值选取模块，用于根据待赋值变量、变量赋值顺序，待赋值变量候选取值以及候选取值的选取概率，按照变量赋值顺序，依次迭代概率抽取每个待赋值变量的候选取值，直至所述待赋值变量均完成赋值；测试场景脚本转换模块，用于将所述待生成测试场景转换为测试场景脚本。9.一种电子设备，其特征在于，包括：处理器、存储器和总线，其中，所述处理器和所述存储器通过所述总线完成相互间的通信；所述存储器存储有可被所述处理器执行的程序指令，所述处理器调用所述程序指令能够执行如权利要求1~7中任一项所述的方法。10.一种非暂态计算机可读存储介质，其特征在于，所述非暂态计算机可读存储介质存储计算机指令，所述计算机指令被计算机运行时，使所述计算机执行如权利要求1~7中任一项所述的方法。
说明书desc
技术领域本申请涉及自动驾驶测试技术领域，具体而言，涉及一种自动驾驶测试场景脚本生成方法、装置及电子设备。背景技术自动驾驶技术的快速发展令人振奋，因为它通过减少交通事故和提高交通效率而带来了巨大的社会和经济效益。目前，为了确保自动驾驶系统ADS的安全性，需要在将自动驾驶系统ADS部署到真正的自动驾驶车辆AV之前对其进行测试，否则ADS的错误决定可能会导致严重的交通事故。现阶段，需要采用测试场景来对自动驾驶系统ADS进行测试验证，而现有技术中的测试场景生成方法大都是以选取最高奖励值的测试场景为目标，其测试场景不够丰富，多样性较差，测试覆盖率较低。发明内容本申请实施例的目的在于提供一种自动驾驶测试场景脚本生成方法、装置及电子设备，用以生成多样性自动驾驶测试场景，提高自动驾驶测试覆盖率。第一方面，本申请实施例提供一种自动驾驶测试场景脚本生成方法，包括：根据待生成测试场景类别，获取所述待生成测试场景的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率；根据待生成测试场景类别，获取所述待生成测试场景的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率；根据待赋值变量、变量赋值顺序，待赋值变量候选取值以及候选取值的选取概率，按照变量赋值顺序，依次迭代概率抽取每个待赋值变量的候选取值，直至所述待赋值变量均完成赋值；将所述待生成测试场景转换为测试场景脚本。在上述方案的实现过程中，通过待生成测试场景的类别查询到预先为该测试场景类别所设置的待赋值变量、变量赋值顺序、待赋值变量的候选取值以及每个候选取值的选取概率，然后对每个待赋值变量的候选取值进行概率抽样，由于对待赋值变量的候选取值采用了概率抽样，最终生成多样性的测试场景脚本，一方面提高了自动驾驶测试场景脚本的生成效率，另一方面提高了自动驾驶测试覆盖率。在第一方面的一种实现方式中，所述根据待生成测试场景类别，获取所述待生成测试场景的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率，包括：根据待生成测试场景类别，在预设映射表中查询所述待生成测试场景类别所对应的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率。在第一方面的一种实现方式中，所述候选取值的选取概率根据流网络中流经每条边的流量确定，所述流网络的训练步骤包括：确定历史测试场景类别，针对每个类别的历史测试场景，分别以该历史测试场景下的待赋值变量为所述流网络的节点，以所述待赋值变量的候选取值作为边，以所述变量赋值顺序为每条路径中所述节点的排序顺序，构建流网络；所述流网络中的一条路径对应一个历史测试场景；以每个流网络所涉及历史测试场景的奖励值总和作为该流网络中初始节点的输入流量，以该流网络每条路径所对应的历史测试场景的奖励值作为该路径终端节点的输入流量；训练每个流网络，使得所述流网络学习流经每条边的流量；根据所述流网络中流经每条边的流量确定所述候选取值的选取概率。在第一方面的一种实现方式中，所述训练每个流网络，使得所述流网络学习流经每条边的流量，包括：以用于表征流入流网络节点与流出该流网络节点之间的流量差的损失函数最小为训练目标，训练所述流网络，使得所述流网络学习流经每条边的流量。在第一方面的一种实现方式中，所述根据所述流网络中流经每条边的流量确定所述候选取值的选取概率，包括：确定所述候选取值所在边的起始节点；获取所述起始节点的流入流量，根据流经所述候选取值所在边的流量与所述起始节点的流入流量之间的比值确定所述候选取值的选取概率。在第一方面的一种实现方式中，在所述将所述待生成测试场景转换为测试场景脚本之前，还包括：根据待生成测试场景所选取的每个待赋值变量候选取值的选取概率，获取待生成测试场景的奖励参数；筛选所述奖励参数大于预设奖励参数阈值的待生成测试场景。在第一方面的一种实现方式中，在所述将所述待生成测试场景转换为测试场景脚本之后，还包括：将所述测试场景脚本加载至部署有自动驾驶车辆的模拟环境；获取所述模拟环境中所述自动驾驶车辆反馈的车辆运行数据；根据所述车辆运行数据对所述测试场景脚本进行验证，获取满足预设验证要求的测试场景脚本。第二方面，本申请实施例提供一种自动驾驶测试场景脚本生成装置，包括：待生成测试场景参数查询模块，用于根据待生成测试场景类别，获取所述待生成测试场景的待赋值变量以及变量赋值顺序；待赋值变量候选取值选取模块，用于根据待赋值变量、变量赋值顺序，待赋值变量候选取值以及候选取值的选取概率，按照变量赋值顺序，依次迭代概率抽取每个待赋值变量的候选取值，直至所述待赋值变量均完成赋值；测试场景脚本转换模块，用于将所述待生成测试场景转换为测试场景脚本。第三方面，本申请实施例提供一种计算机可读存储介质，所述计算机可读存储介质上存储有计算机程序指令，所述计算机程序指令被处理器读取并运行时，执行第一方面或第一方面的任意一种可能的实现方式提供的方法。第四方面，本申请实施例提供一种电子设备，包括：存储器以及处理器，所述存储器中存储有计算机程序指令，所述计算机程序指令被所述处理器读取并运行时，执行第一方面或第一方面的任意一种可能的实现方式提供的方法。本申请的其他特征和优点将在随后的说明书阐述，并且，部分地从说明书中变得显而易见，或者通过实施本申请实施例了解。本申请的目的和其他优点可通过在所写的说明书、权利要求书、以及附图中所特别指出的结构来实现和获得。附图说明为了更清楚地说明本申请实施例的技术方案，下面将对本申请实施例中所需要使用的附图作简单地介绍，应当理解，以下附图仅示出了本申请的某些实施例，因此不应被看作是对范围的限定，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他相关的附图。图1为本申请实施例提供的自动驾驶测试场景脚本生成方法的流程示意图；图2为本申请实施例提供的针对单个测试场景类别的流网络结构示意图；图3为本申请实施例提供的自动驾驶测试场景脚本生成装置的结构示意图；图4为本申请实施例提供的电子设备的结构示意图。具体实施方式下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行描述。以下实施例仅用于更加清楚地说明本申请的技术方案，因此只作为示例，而不能以此来限制本申请的保护范围。除非另有定义，本文所使用的所有的技术和科学术语与属于本申请的技术领域的技术人员通常理解的含义相同；本文中所使用的术语只是为了描述具体的实施例的目的，不是旨在于限制本申请；本申请的说明书和权利要求书及上述附图说明中的术语“包括”和“具有”以及它们的任何变形，意图在于覆盖不排他的包含。在本申请实施例的描述中，技术术语“第一”“第二”等仅用于区别不同对象，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量、特定顺序或主次关系。在本申请实施例的描述中，“多个”的含义是两个以上，除非另有明确具体的限定。在本文中提及“实施例”意味着，结合实施例描述的特定特征、结构或特性可以包含在本申请的至少一个实施例中。在说明书中的各个位置出现该短语并不一定均是指相同的实施例，也不是与其它实施例互斥的独立的或备选的实施例。本领域技术人员显式地和隐式地理解的是，本文所描述的实施例可以与其它实施例相结合。目前，现有技术中生成自动驾驶测试场景的方法包括：1、人工设计；为了便于人工手动设计自动驾驶测试场景，自动化及测量系统标准协会ASAM制定了OpenSCENARIO等一系列标准，通过领域特定语言对自动驾驶测试场景进行描述，然而虽然有一系列标准来支撑自动驾驶测试场景的人工设计，但针对自动驾驶测试场景中每一个实体在不同时刻皆要设定其对应的行为，其空间异常巨大，通过手工编写DSL测试场景几乎无法实现大量测试场景的设计，其设计效率极低；此外，人工所生成的测试场景往往不具备多样性，容易漏掉对诸多关键情况的测试，无法满足自动驾驶系统ADS对高测试覆盖率的要求。2、测试场景生成方法自动生成；除人工设计外，现有技术也存在一些能够自动生成自动驾驶测试场景的生成方法，但这些自动驾驶测试场景生成方法大都是选取奖励值最高的测试场景来生成测试场景，虽然实现了单个测试场景的高质量，但是其仅能生成高奖励值的测试场景，并不能生成多样性的测试场景，依然无法满足自动驾驶系统ADS对高测试覆盖率的要求。为了解决现有技术中自动驾驶测试场景多样性低的缺陷，本申请实施例提供一种自动驾驶测试场景脚本生成方法，其流程示意请参见图1，自动驾驶测试场景脚本生成方法包括：步骤S110：根据待生成测试场景类别，获取所述待生成测试场景的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率；步骤S120：根据待赋值变量、变量赋值顺序，待赋值变量候选取值以及候选取值的选取概率，按照变量赋值顺序，依次迭代概率抽取每个待赋值变量的候选取值，直至所述待赋值变量均完成赋值；步骤S130：将待生成测试场景转换为测试场景脚本。下面分别介绍上述步骤S110~步骤S130：步骤S110根据待生成测试场景的类别获取待赋值变量的信息，其中待生成测试场景的类别是根据测试场景生成需求所设定的，例如：在对自动驾驶系统ADS是否能够满足交通法规要求进行验证时，可以设置超车测试场景、限速测试场景、鸣笛测试场景、紧急制动测试场景等类别的测试场景，具体的测试场景类别可以根据实际需求设置。需要指出的是：针对每种类别的测试场景均可以总结出相关规律，例如超车测试场景下，主车需要对NPC车辆进行超车，同时还可以设置其他NPC车辆，测试主车在对某个或者某几个NPC车辆进行超车时是否会碰撞到其他车辆，还可以测试主车在超车过程中是否会违反交规。基于上述相关规律，可以预先为每种类别的测试场景设置待赋值变量以及变量赋值顺序，然后根据历史测试场景确定所有待赋值变量的候选取值，使用流网络获取每个候选取值的选取概率。作为上述自动驾驶测试场景脚本生成方法的一种可选实施方式，步骤S110根据待生成测试场景类别，获取待生成测试场景的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率，包括：根据待生成测试场景类别，在预设映射表中查询待生成测试场景类别所对应的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率。该实施方式例如：根据经验为每种类别的测试场景设置待赋值变量以及变量赋值顺序，然后根据历史测试场景确定所有待赋值变量的候选取值，最后采用流网络确定每个候选取值的选取概率；建立映射表，该映射表内针对不同类别的测试场景，分别存储在该类别的测试场景下的待赋值变量、变量赋值顺序、待赋值变量的候选取值以及每个候选取值的选取概率；在获取到用户输入的待生成测试场景类别后，在映射表中查询该类别的测试场景所对应的待赋值变量、变量赋值顺序、待赋值变量的候选取值以及每个候选取值的选取概率。在上述方案的实现过程中，采用预设映射表存储每个类别的测试场景所对应的待赋值变量、变量赋值顺序、待赋值变量的候选取值以及每个候选取值的选取概率，在获取待生成测试场景类别后即可在预设映射表中快速获取待该类别测试场景所需要的待赋值变量、变量赋值顺序、待赋值变量的候选取值以及每个候选取值的选取概率，有效提高了上述自动驾驶测试场景脚本生成方法的测试场景生成效率。下面详细介绍步骤S120：步骤S120实质为按照变量赋值顺序，对每个待赋值变量的候选取值根据候选取值选取概率进行概率抽样，直至待赋值变量均完成赋值，即可获得待生成测试场景类别的测试场景，步骤S120具体为：根据变量赋值顺序，确定第一待赋值变量、所述第一待赋值变量的候选取值，以及所述候选取值的选取概率，根据所述候选取值的选取概率，对所述初始待赋值变量的候选取值进行概率抽样，获取所述第一待赋值变量的赋值结果；根据所述第一待赋值变量的赋值结果，确定第二待赋值变量的候选取值，以及所述候选取值的选取概率，对所述初始待赋值变量的候选取值进行概率抽样，获取所述第一待赋值变量的赋值结果；依次根据所述第一待赋值变量至第待赋值变量的赋值结果，确定第待赋值变量的候选取值，以及所述候选取值的选取概率，对所述第待赋值变量的候选取值进行概率抽样，获取所述第待赋值变量的赋值结果，直至所述待赋值变量均完成赋值，其中，，为所述待赋值变量的个数。作为上述自动驾驶测试场景脚本生成方法的一种可选实施方式，候选取值的选取概率根据流网络中流经每条边的流量确定，流网络的训练步骤包括：确定历史测试场景类别，针对每个类别的历史测试场景，分别以该历史测试场景下的待赋值变量为流网络的节点，以待赋值变量的候选取值作为边，以变量赋值顺序为每条路径中所述节点的排序顺序，构建流网络；所述流网络中的一条路径对应一个历史测试场景；以每个流网络所涉及历史测试场景的奖励值总和作为该流网络中初始节点的输入流量，以该流网络每条路径所对应的历史测试场景的奖励值作为该路径终端节点的输入流量；训练每个流网络，使得所述流网络学习流经每条边的流量；根据所述流网络中流经每条边的流量确定所述候选取值的选取概率。该实施方式例如：为了获取待赋值变量候选取值的选取概率，本申请实施例采用例如生成流网络GFlowNet等类型的流网络来获取每个候选取值的选取概率，流网络的构建过程为：请参见图2，图2示出了流网络的一种示意图，针对每个类别的历史测试场景，分别以该历史测试场景下的待赋值变量为流网络的节点，以待赋值变量的候选取值作为边，以变量赋值顺序为每条路径中节点的排序顺序，构建流网络；流网络中的一条路径对应一个历史测试场景；至此完成流网络的构建；流网络的训练过程为：以每个流网络所涉及历史测试场景的奖励值总和作为该流网络中初始节点的输入流量，以该流网络每条路径所对应的历史测试场景的奖励值作为该路径终端节点的输入流量，训练每个流网络，使得流网络学习流经每条边的流量；至此完成流网络的训练，最终获取每个流网络中流经每条边的流量；最后根据流网络中流经每条边的流量确定所述候选取值的选取概率。在上述方案的实现过程中，采用流网络来获取待赋值变量每个候选取值的选取概率，从而使得上述自动驾驶测试场景脚本生成方法可以采用候选取值的选取概率对每个待赋值变量的候选取值进行概率抽样，从而生成多样性的测试场景；同时，由于是以历史测试场景奖励值总和作为流网络输入，以每条路径所对应的历史测试场景的奖励值作为路径终端节点的输入流量，每个候选取值的选取概率均与其所能为测试场景带来的奖励值成正相关，虽然在多样性的测试场景中同时存在奖励值较高的测试场景以及奖励值较低的奖励场景，但采用此种选取概率对候选取值进行概率抽样能够实现在多样性的测试场景中，高奖励值的测试场景被生成的概率较高，而低奖励值的测试场景被生成的概率较低，在实现测试场景多样性的同时，还实现了测试场景的高质量。需要指出的是：在获取到历史测试场景后，需要对历史测试场景进行预处理，然后才能将其输入流网络，对历史测试场景的预处理过程包括：首先，所获取到的历史测试场景一般为脚本，需要将测试场景脚本编码为流网络所能使用的测试场景，具体过程为：实际上场景脚本描述测试场景，即为将值与对象的动作设置相关的过程，例如设置时间、天气、行人、NPC车辆的类型，以及这些变量在始发点、目的地以及路径点的具体行为；在对场景脚本进行编码时需要满足：1、编码后的测试场景需要保持原有场景脚本的上下文敏感性；2、编码后的测试场景能够解码回场景描述脚本；3、不同测试场景下针对同一个对象的相同设置操作，转换后所对应的赋值操作也需要一致；4、涵盖历史测试场景脚本中与所有与测试结果相关的设置操作。以AVUnit测试场景描述语言为例对价格场景脚本编码为测试场景的详细实现过程进行描述：如表1所述，给定一端以AVUnit语言描述的测试场景脚本代码片段，该代码定义了五辆NPC车辆组成的测试场景。具体来说：第1~3行指定了测试场景所使用的地图、时间和天气。在第5~8行中，主车的任务是从lane_540上的起点移动到lane_572上的目标点，距离它们的初始点分别50和60米车道位置。第9~13行显示NPC车辆npc1从起始位置以6 m/s的初始速度移动到目标点。特别是在第11行npc1添加了一个途经点，指定它到达距离lane_574起点200米处时的速度为4m/s。其他四辆 NPC 车辆的设置与npc1类似，为了篇幅省略其描述。所有这些陈述构成了一个测试场景脚本。如表2所示，给出了对表1所示例的脚本代码所编码后的测试场景。例如，该测试场景的第一行描述了表1中测试场景脚本中第5行的变量设置内容，该测试场景的第二行描述了表1中测试场景脚本中第 6 行的变量设置内容。对于添加到npc1的途经点，表1中第6行和第7行分别代表对偏移变量和速度变量的设置内容。其次，在将测试场景脚本转换为测试场景后，根据每个历史测试场景在历史仿真测试过程中所产生的数据计算出该测试场景的奖励值，即reward值。举例来说：在用于测试交规规约的测试场景中，若某个测试场景是用于测试碰撞条件，那么需要在历史测试场景在历史仿真测试过程中所产生的数据中抽取车与车之间的距离，以及车速等相关运行数据，以车辆是否违背交规规约为目标计算出测试场景的reward值。表1 AVUnit测试场景脚本描述代码片段需要指出的是：针对不同的测试场景以及不同的测试目标，往往需要不同的计算方式来计算reward值，具体的计算方式可以根据历史测试场景的类别以及测试目标来设置。另外，上述交规规约在测试场景中一般是采用信号时序逻辑表达式signaltemporal logic进行表达的。在将历史测试场景脚本转换为测试场景，并计算出对应历史测试场景的奖励值后即完成对历史测试场景的预处理。表2 针对表1中测试场景脚本所编码的测试场景作为上述自动驾驶测试场景脚本生成方法的一种可选实施方式，训练每个流网络，使得流网络学习流经每条边的流量，包括：以用于表征流入流网络节点与流出该流网络节点之间的流量差的损失函数最小为训练目标，训练流网络，使得流网络学习流经每条边的流量。该实施方式例如：在使用例如生成流网络GFlowNet等类型的流网络学习流经每条边的流量时，流网络中每个节点均需要满足流守恒：其中，表示当前节点；表示当前节点的父节点；表示当前节点的子节点，以当前节点为节点为例，当前节点的父节点即为节点，当前节点的子节点即为节点，；表征所有由当前节点的父节点流入当前节点的流量和；表征所有由当前节点流入当前节点的子节点的流量和；流网络就是以上述流守恒公式为目标来拟合出流网络中流经每条边的流量的，基于上述流守恒公式，可以为流网络设置如下损失函数：以上述损失函数最小为目标训练流网络，使得流网络学习流经每条边的流量。需要指出的是：本申请实施例所采用的损失函数能够表征流入流网络节点与流出该流网络节点之间的流量差即可，上述损失函数公式仅是一种可选的设置方式，本领域技术人员可以根据实际需求来设置损失函数。在上述方案的实现过程中，以用于表征流入流网络节点与流出该流网络节点之间的流量差的损失函数最小为训练目标来训练流网络，在获取流网络初始节点的输入以及每条路径终端节点的输入流量后，流网络即可拟合出流经流网络中每条边的流量，进而获取待赋值变量每个候选取值的选取概率，使得上述自动驾驶测试场景脚本生成方法可以以概率抽样的方式为每个待赋值变量选取候选取值，从而满足测试场景的多样性，提高自动驾驶测试覆盖率。作为上述自动驾驶测试场景脚本生成方法的一种可选实施方式，根据流网络中流经每条边的流量确定候选取值的选取概率，包括：确定候选取值所在边的起始节点；获取起始节点的流入流量，根据流经候选取值所在边的流量与起始节点的流入流量之间的比值确定所述候选取值的选取概率。该实施方式例如：在流网络对流经每条边的流量完成学习后，通过流经当前边的流量以及流入当前边初始节点的流量和后即可通过流经候选取值所在边的流量与起始节点的流入流量之间的比值计算候选取值的选取概率。需要指出的是：可以单独采用流经候选取值所在边的流量与起始节点的流入流量之间的比值作为候选取值的选取概率，也可以在上述比值的基础上增加权重，例如根据待赋值变量在测试场景中的重要性所确定的权重，具体采用何种计算方式可以根据实际需求来选取。在上述方案的实现过程中，在流网络完成对流经每条边的流量完成学习后，通过流经候选取值所在边的流量与起始节点的流入流量之间的比值即可确定候选取值的选取概率，使得上述自动驾驶测试场景脚本生成方法可以以概率抽样的方式为每个待赋值变量选取候选取值，从而满足测试场景的多样性，提高自动驾驶测试覆盖率。下面详细介绍步骤S130：步骤S130将待生成测试场景转换为测试场景脚本的过程本质上就是上述编码过程的逆过程。作为上述自动驾驶测试场景脚本生成方法的一种可选实施方式，在步骤S130将待生成测试场景转换为测试场景脚本之前，还包括：根据待生成测试场景所选取的每个待赋值变量候选取值的选取概率，获取待生成测试场景的奖励参数；筛选所述奖励参数大于预设奖励参数阈值的待生成测试场景。该实施方式例如：由于流网络是以每个流网络所涉及历史测试场景的奖励值总和作为该流网络中初始节点的输入流量，以该流网络每条路径所对应的历史测试场景的奖励值作为该路径终端节点的输入流量，因此流网络中流经每条边的流量侧面反映了该待赋值变量选取该候选取值时能够为最终的测试场景所能带来的奖励参数，因此在对每个待赋值变量的候选取值进行概率抽样后，可以根据每个待赋值变量候选取值的选取概率初步确定待生成测试场景的奖励参数。需要指出的是，奖励参数仅是一个用于对测试场景进行初筛的中间参数，与待生成测试场景的奖励值有关，但并不代表待生成测试场景的奖励值。另外，奖励参数的计算方式是根据预先设置的计算公式来计算的，而这一计算公式是根据经验所设置的，可以对每个候选取值的选取概率进行累加、累积、加权和或者加权乘的方式，具体采用何种方式来计算奖励参数，可以根据实际情况设置。在上述方案的实现过程中，通过奖励参数以及预设的奖励参数阈值对待生成测试场景进行初筛，初步剔除不满足奖励参数要求的测试场景，提高了上述自动驾驶测试场景脚本生成方法所生成测试场景的质量。作为上述自动驾驶测试场景脚本生成方法的一种可选实施方式，在步骤S130将待生成测试场景转换为测试场景脚本之后，还包括：将测试场景脚本加载至部署有自动驾驶车辆的模拟环境；获取模拟环境中自动驾驶车辆反馈的车辆运行数据；根据车辆运行数据对测试场景脚本进行验证，获取满足预设验证要求的测试场景脚本。该实施方式例如：在生成测试场景脚本后虽然通过奖励参数可以对测试场景脚本进行初筛，但奖励参数仅是奖励值的侧面表征测试场景脚本的奖励值，其并不是奖励值，因此还需要将生成的测试场景进行实际运行，以验证该测试场景是否满足预设验证需求，具体方法为：将测试场景加载至部署有自动驾驶车辆的模拟环境，获取模拟环境中自动驾驶车辆反馈的车辆运行数据，在车辆运行数据中抽取与测试场景的测试目的相关的数据，例如在对交通规约的测试场景中，为了满足对多种测试规约test oracle的测试，在模拟环境中执行测试场景时所抽取的数据包括但不限于：汽车状态变量，描述了涉及车灯、引擎、喇叭和方向的属性；Driving Status Variables，描述了主车AV的速度、加速和制动状态；Road Variables捕获主车AV当前行驶的道路属性，例如，是否允许按喇叭，路灯是否亮起；Traffic Signal Variables，允许规范涉及主车AV正在接近的路口交通灯的法律；Traffic Variables，指定与主车AV共享道路的其他车辆以及穿过它的任何行人相关联；地图变量，指定与环境条件相关的交通法规，例如天气或一天中的时间。收集完成的数据可以称之为trace，具有多个时间步，每一个时间步上具有以上类型数据所对应的变量值。在对交通规约的测试场景中，收集到trace以后，可以通过约束求解技术或者信号时序逻辑的robustness semantics度量方法进行验证交规规约在该trace上是否成立。如果路径trace不满足测试规约，那么说明找到一个使得ADS出错的测试场景，则将其放入测试场景数据库中。需要指出的是：在对交通规约的测试场景中，寻找使得自动驾驶系统ADS出错的测试场景即是在该场景下的验证需求。针对不同类型的测试场景，可以设置不同的验证需求，具体的验证需求可以根据测试场景的类型来设置。在上述方案的实现过程中，通过将通过概率抽样所生成的测试场景加载到部署有自动驾驶车辆的模拟环境中来对测试场景进行验证，以获得满足预设验证要求的测试场景，提高了上述自动驾驶测试场景生成方法所生成测试场景的质量。基于同一发明构思，请参见图3，本申请实施例中还提供一种自动驾驶测试场景脚本生成装置200，包括：待生成测试场景参数查询模块210，用于根据待生成测试场景类别，获取所述待生成测试场景的待赋值变量以及变量赋值顺序；待赋值变量候选取值选取模块220，用于根据待赋值变量、变量赋值顺序，待赋值变量候选取值以及候选取值的选取概率，按照变量赋值顺序，依次迭代概率抽取每个待赋值变量的候选取值，直至所述待赋值变量均完成赋值；测试场景脚本转换模块230，用于将所述待生成测试场景转换为测试场景脚本。作为上述自动驾驶测试场景脚本生成装置的一种可选实施方式，待生成测试场景参数查询模块210包括：根据待生成测试场景类别，在预设映射表中查询所述待生成测试场景类别所对应的待赋值变量、变量赋值顺序、待赋值变量候选取值以及候选取值的选取概率。作为上述自动驾驶测试场景脚本生成装置的一种可选实施方式，候选取值的选取概率根据流网络中流经每条边的流量确定，所述流网络的训练步骤包括：确定历史测试场景类别，针对每个类别的历史测试场景，分别以该历史测试场景下的待赋值变量为所述流网络的节点，以所述待赋值变量的候选取值作为边，以所述变量赋值顺序为每条路径中所述节点的排序顺序，构建流网络；所述流网络中的一条路径对应一个历史测试场景；以每个流网络所涉及历史测试场景的奖励值总和作为该流网络中初始节点的输入流量，以该流网络每条路径所对应的历史测试场景的奖励值作为该路径终端节点的输入流量；训练每个流网络，使得所述流网络学习流经每条边的流量；根据所述流网络中流经每条边的流量确定所述候选取值的选取概率。作为上述自动驾驶测试场景脚本生成装置的一种可选实施方式，训练每个流网络，使得所述流网络学习流经每条边的流量，包括：以用于表征流入流网络节点与流出该流网络节点之间的流量差的损失函数最小为训练目标，训练所述流网络，使得所述流网络学习流经每条边的流量。作为上述自动驾驶测试场景脚本生成装置的一种可选实施方式，根据所述流网络中流经每条边的流量确定所述候选取值的选取概率，包括：确定所述候选取值所在边的起始节点；获取所述起始节点的流入流量，根据流经所述候选取值所在边的流量与所述起始节点的流入流量之间的比值确定所述候选取值的选取概率。作为上述自动驾驶测试场景脚本生成装置的一种可选实施方式，自动驾驶测试场景脚本生成装置200还包括：奖励参数确定模块，用于根据待生成测试场景所选取的每个待赋值变量候选取值的选取概率，获取待生成测试场景的奖励参数；测试场景初筛模块，用于筛选所述奖励参数大于预设奖励参数阈值的待生成测试场景。作为上述自动驾驶测试场景脚本生成装置的一种可选实施方式，自动驾驶测试场景脚本生成装置200还包括：测试场景加载模块，用于将所述测试场景脚本加载至部署有自动驾驶车辆的模拟环境；车辆运行数据获取模块，用于获取所述模拟环境中所述自动驾驶车辆反馈的车辆运行数据；测试场景验证模块，用于根据所述车辆运行数据对所述测试场景脚本进行验证，获取满足预设验证要求的测试场景脚本。图4为本申请实施例提供的一种电子设备的示意图。参照图4，电子设备300包括：处理器310、存储器320以及通信接口330，这些组件通过通信总线340和/或其他形式的连接机构互连并相互通讯。其中，存储器320包括一个或多个，其可以是，但不限于，随机存取存储器，只读存储器，可编程只读存储器，可擦除只读存储器，电可擦除只读存储器等。处理器310以及其他可能的组件可对存储器320进行访问，读和/或写其中的数据。处理器310包括一个或多个，其可以是一种集成电路芯片，具有信号的处理能力。上述的处理器310可以是通用处理器，包括中央处理器、微控制单元、网络处理器或者其他常规处理器；还可以是专用处理器，包括数字信号处理器、专用集成电路、现场可编程门阵列或者其他可编程逻辑器件、分立门或者晶体管逻辑器件、分立硬件组件。通信接口330包括一个或多个，可以用于和其他设备进行直接或间接地通信，以便进行数据的交互。例如，通信接口330可以是以太网接口；可以是移动通信网络接口，例如3G、4G、5G网络的接口；还是可以是具有数据收发功能的其他类型的接口。在存储器320中可以存储一个或多个计算机程序指令，处理器310可以读取并运行这些计算机程序指令，以实现本申请实施例提供的自动驾驶测试场景脚本生成方法以及其他期望的功能。可以理解，图4所示的结构仅为示意，电子设备300还可以包括比图4中所示更多或者更少的组件，或者具有与图4所示不同的配置。图4中所示的各组件可以采用硬件、软件或其组合实现。例如，电子设备300可以是单台服务器、多台服务器的组合、大量服务器的集群等，并且，既可以是物理设备也可以是虚拟设备。本申请实施例还提供一种计算机可读存储介质，该计算机可读存储介质上存储有计算机程序指令，所述计算机程序指令被计算机的处理器读取并运行时，执行本申请实施例提供的自动驾驶测试场景脚本生成方法。例如，计算机可读存储介质可以实现为图4中电子设备300中的存储器320。在本申请所提供的实施例中，应该理解到，所揭露装置和方法，可以通过其它的方式实现。以上所描述的装置实施例仅仅是示意性的，例如，所述单元的划分，仅仅为一种逻辑功能划分，实际实现时可以有另外的划分方式，又例如，多个单元或组件可以结合或者可以集成到另一个系统，或一些特征可以忽略，或不执行。另一点，所显示或讨论的相互之间的耦合或直接耦合或通信连接可以是通过一些通信接口，装置或单元的间接耦合或通信连接，可以是电性，机械或其它的形式。另外，作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部单元来实现本实施例方案的目的。再者，在本申请各个实施例中的各功能模块可以集成在一起形成一个独立的部分，也可以是各个模块单独存在，也可以两个或两个以上模块集成形成一个独立的部分。以上所述仅为本申请的实施例而已，并不用于限制本申请的保护范围，对于本领域的技术人员来说，本申请可以有各种更改和变化。凡在本申请的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本申请的保护范围之内。
