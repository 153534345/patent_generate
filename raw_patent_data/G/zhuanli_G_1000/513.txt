标题title
基于图像处理的塑料管材质量检测方法
摘要abst
本发明涉及图像数据处理技术领域，具体涉及基于图像处理的塑料管材质量检测方法，包括：采集塑料管材的表面图像，获取管材灰度图像和分割阈值序列，在分割阈值序列中的任意两个相邻数据中，将最小和最大的数据，分别记为第一阈值和第二阈值，从而得到目标连通域与其中的主内连通域，获取目标连通域的方向相似性和扩展渐变相似性，结合目标连通域和主内连通域的圆形度，得到目标连通域为凹陷缺陷的可能性，由此获取最优分割阈值，根据最优分割阈值，判断所述塑料管材是否合格。本发明通过对凹陷缺陷特征进行分析从而判断凹陷边缘的具体位置，由此提高凹陷缺陷区域分割的准确性，从而提高塑料管材质量检测的准确性。
权利要求书clms
1.基于图像处理的塑料管材质量检测方法，其特征在于，该方法包括以下步骤：采集任意一个塑料管材的表面图像，进行去噪和灰度化处理，得到管材灰度图像；在管材灰度图像中，使用迭代阈值分割算法，依次记录每次迭代后的分割阈值，得到分割阈值序列；在分割阈值序列中的任意两个相邻数据中，将最小和最大的数据，分别记为第一阈值和第二阈值；根据第一阈值和第二阈值，得到管材灰度图像中有效连通域，并将有效连通域划分为目标连通域和参考连通域，以及得到目标连通域中的主内连通域；根据圆形度计算公式，分别得到目标连通域和主内连通域的圆形度；根据目标连通域和主内连通域的中心点，得到目标连通域的向量、第二距离和第一距离；根据目标连通域和所有参考连通域的向量的差异，得到目标连通域的方向相似性；根据目标连通域和所有参考连通域的第一距离、第二距离，得到目标连通域的扩展渐变相似性；将目标连通域的圆形度、方向相似性、扩展渐变相似性、主内连通域的圆形度的均值，记为目标连通域为凹陷缺陷的可能性；在分割阈值序列中，根据所有数据的数据值、所有相邻数据对应的目标连通域为凹陷缺陷的可能性，得到最优分割阈值；根据最优分割阈值，判断所述塑料管材是否合格。2.根据权利要求1所述基于图像处理的塑料管材质量检测方法，其特征在于，所述根据第一阈值和第二阈值，得到管材灰度图像中有效连通域，并将有效连通域划分为目标连通域和参考连通域，以及得到目标连通域中的主内连通域，包括的具体步骤如下：在管材灰度图像中，将灰度值小于第一阈值的像素点，记为第一像素点；将灰度值小于第二阈值的像素点，记为第二像素点；将所有的第二像素点构成的区域，记为第二区域；将第二区域中连续相邻的像素点构成的连通域，记为外连通域；将同时存在第一像素点和第二像素点的外连通域，记为有效连通域；根据有效连通域内的像素点数量，得到目标连通域和参考连通域；在目标连通域内，将连续相邻的第一像素点构成的连通域，记为内连通域；计算每个内连通域内的像素点数量，统计所有的内连通域内的像素点数量中的最大值，将所述内连通域内的像素点数量中的最大值对应的内连通域，记为主内连通域。3.根据权利要求2所述基于图像处理的塑料管材质量检测方法，其特征在于，所述根据有效连通域内的像素点数量，得到目标连通域和参考连通域，包括的具体步骤如下：计算每个有效连通域内的像素点数量，统计所有的有效连通域内的像素点数量中的最大值，将所述有效连通域内的像素点数量中的最大值对应的有效连通域，记为目标连通域；将不是目标连通域的有效连通域，记为参考连通域。4.根据权利要求1所述基于图像处理的塑料管材质量检测方法，其特征在于，所述根据目标连通域和主内连通域的中心点，得到目标连通域的向量、第二距离和第一距离，包括的具体步骤如下：使用连通域的重心计算算法，分别得到目标连通域和主内连通域的中心点；将目标连通域的中心点，记为外圆心；将主内连通域的中心点，记为内圆心；以内圆心到外圆心的方向为向量的方向，以内圆心到外圆心的距离为向量的模，构成目标连通域的向量；在目标连通域内，作以内圆心为起点、过外圆心的射线，统计所述过外圆心的射线分别与目标连通域边界和主内连通域边界的交点，将所述过外圆心的射线分别与目标连通域边界和主内连通域边界的交点之间的距离，记为目标连通域的第二距离；作以外圆心为起点、过内圆心的射线，统计所述过内圆心的射线分别与主内连通域边界和目标连通域边界的交点，将所述内圆心的射线分别与主内连通域边界和目标连通域边界的交点之间的距离，记为目标连通域的第一距离。5.根据权利要求1所述基于图像处理的塑料管材质量检测方法，其特征在于，所述根据目标连通域和所有参考连通域的向量的差异，得到目标连通域的方向相似性对应的具体计算公式为：其中C为目标连通域的方向相似性，为目标连通域的向量，/＞为第i个参考连通域的向量，/＞为/＞和/＞的夹角值，N为参考连通域的数量。6.根据权利要求1所述基于图像处理的塑料管材质量检测方法，其特征在于，所述根据目标连通域和所有参考连通域的第一距离、第二距离，得到目标连通域的扩展渐变相似性，包括的具体步骤如下：将目标连通域的第一距离除以第二距离，记为目标连通域在光照方向上的扩展渐变程度；将每个参考连通域的第一距离除以第二距离，记为参考连通域在光照方向上的扩展渐变程度；根据目标连通域与所有参考连通域在光照方向上的扩展渐变程度的差异，得到目标连通域的扩展渐变相似性。7.根据权利要求6所述基于图像处理的塑料管材质量检测方法，其特征在于，所述根据目标连通域与所有参考连通域在光照方向上的扩展渐变程度的差异，得到目标连通域的扩展渐变相似性对应的具体计算公式为：其中D为目标连通域的扩展渐变相似性，为目标连通域的第一距离，/＞为目标连通域的第二距离，/＞为第i个参考连通域的第一距离，/＞为第i个参考连通域的第二距离，N为参考连通域的数量，/＞为以自然常数为底的指数函数。8.根据权利要求1所述基于图像处理的塑料管材质量检测方法，其特征在于，所述在分割阈值序列中，根据所有数据的数据值、所有相邻数据对应的目标连通域为凹陷缺陷的可能性，得到最优分割阈值，包括的具体步骤如下：将分割阈值序列中连续相邻的三个数据，记为一组数据；在每组数据中，根据数据值之间的差异、所有相邻数据对应的目标连通域为凹陷缺陷的可能性的差异，得到每组数据的可能性阈值和灰度阈值；按照分割阈值序列的顺序，逐个判断每组数据的可能性阈值是否小于预设的可能性停止值、且每组数据的灰度阈值是否小于预设的灰度停止值，当所有组数据中的一组数据的可能性阈值小于预设的可能性停止值、且灰度阈值小于预设的灰度停止值时，停止判断，并将所述所有组数据中的一组数据中的数据均值，记为最优分割阈值。9.根据权利要求8所述基于图像处理的塑料管材质量检测方法，其特征在于，所述在每组数据中，根据数据值之间的差异、所有相邻数据对应的目标连通域为凹陷缺陷的可能性的差异，得到每组数据的可能性阈值和灰度阈值对应的具体计算公式为：其中为第k组数据的可能性阈值，/＞为第k组数据的灰度阈值，/＞为第k组数据中第一、二个数据对应的目标连通域为凹陷缺陷的可能性，/＞为第k组数据中第二、三个数据对应的目标连通域为凹陷缺陷的可能性，/＞为第k组数据中第一、二个数据的均值，/＞为第k组数据中第二、三个数据的均值，| |为绝对值函数。10.根据权利要求1所述基于图像处理的塑料管材质量检测方法，其特征在于，所述根据最优分割阈值，判断所述塑料管材是否合格，包括的具体步骤如下：在管材灰度图像中，将所有灰度值小于最优分割阈值的像素点构成的区域，记为凹坑缺陷区域；当凹坑缺陷区域中的像素点数量大于预设的面积阈值时，则判断所述塑料管材不合格；当凹坑缺陷区域中的像素点数量小于等于预设的面积阈值时，则判断所述塑料管材合格。
说明书desc
技术领域本发明涉及图像数据处理技术领域，具体涉及基于图像处理的塑料管材质量检测方法。背景技术塑料管材具有良好的可塑性和成型性，能够通过挤出、注塑等工艺形成各种形状和尺寸的管材，并且这一类管材制作过程相对简单以及成本较低，在工程项目中更具有经济性。并且塑料管材可以在多种化学介质和腐蚀环境中长期稳定运行，避免了金属管材在特定环境下容易受到腐蚀以及易受到电流的影响出现导电的危险现象。若塑料管材存在凹陷等缺陷时，可能导致管道正常运行的效率降低，还可能导致传输过程中管材受力不均，从而出现管材破裂、运输物质泄露，对设施、人员和环境造成不安全隐患。因此，对于塑料管材进行凹陷缺陷质量检测是非常有必要的。现有的问题：目前通常采用阈值分割的方式对塑料管材的凹陷缺陷进行检测。而由于凹陷缺陷的边缘部分与正常区域之间的灰度差异过小，导致采用阈值分割时对于最佳阈值的选取难以界定，令检测出的凹陷缺陷存在较大的误差，会降低塑料管材质量检测的准确性。发明内容本发明提供基于图像处理的塑料管材质量检测方法，以解决现有的问题。本发明的基于图像处理的塑料管材质量检测方法采用如下技术方案：本发明一个实施例提供了基于图像处理的塑料管材质量检测方法，该方法包括以下步骤：采集任意一个塑料管材的表面图像，进行去噪和灰度化处理，得到管材灰度图像；在管材灰度图像中，使用迭代阈值分割算法，依次记录每次迭代后的分割阈值，得到分割阈值序列；在分割阈值序列中的任意两个相邻数据中，将最小和最大的数据，分别记为第一阈值和第二阈值；根据第一阈值和第二阈值，得到管材灰度图像中有效连通域，并将有效连通域划分为目标连通域和参考连通域，以及得到目标连通域中的主内连通域；根据圆形度计算公式，分别得到目标连通域和主内连通域的圆形度；根据目标连通域和主内连通域的中心点，得到目标连通域的向量、第二距离和第一距离；根据目标连通域和所有参考连通域的向量的差异，得到目标连通域的方向相似性；根据目标连通域和所有参考连通域的第一距离、第二距离，得到目标连通域的扩展渐变相似性；将目标连通域的圆形度、方向相似性、扩展渐变相似性、主内连通域的圆形度的均值，记为目标连通域为凹陷缺陷的可能性；在分割阈值序列中，根据所有数据的数据值、所有相邻数据对应的目标连通域为凹陷缺陷的可能性，得到最优分割阈值；根据最优分割阈值，判断所述塑料管材是否合格。进一步地，所述根据第一阈值和第二阈值，得到管材灰度图像中有效连通域，并将有效连通域划分为目标连通域和参考连通域，以及得到目标连通域中的主内连通域，包括的具体步骤如下：在管材灰度图像中，将灰度值小于第一阈值的像素点，记为第一像素点；将灰度值小于第二阈值的像素点，记为第二像素点；将所有的第二像素点构成的区域，记为第二区域；将第二区域中连续相邻的像素点构成的连通域，记为外连通域；将同时存在第一像素点和第二像素点的外连通域，记为有效连通域；根据有效连通域内的像素点数量，得到目标连通域和参考连通域；在目标连通域内，将连续相邻的第一像素点构成的连通域，记为内连通域；计算每个内连通域内的像素点数量，统计所有的内连通域内的像素点数量中的最大值，将所述内连通域内的像素点数量中的最大值对应的内连通域，记为主内连通域。进一步地，所述根据有效连通域内的像素点数量，得到目标连通域和参考连通域，包括的具体步骤如下：计算每个有效连通域内的像素点数量，统计所有的有效连通域内的像素点数量中的最大值，将所述有效连通域内的像素点数量中的最大值对应的有效连通域，记为目标连通域；将不是目标连通域的有效连通域，记为参考连通域。进一步地，所述根据目标连通域和主内连通域的中心点，得到目标连通域的向量、第二距离和第一距离，包括的具体步骤如下：使用连通域的重心计算算法，分别得到目标连通域和主内连通域的中心点；将目标连通域的中心点，记为外圆心；将主内连通域的中心点，记为内圆心；以内圆心到外圆心的方向为向量的方向，以内圆心到外圆心的距离为向量的模，构成目标连通域的向量；在目标连通域内，作以内圆心为起点、过外圆心的射线，统计所述过外圆心的射线分别与目标连通域边界和主内连通域边界的交点，将所述过外圆心的射线分别与目标连通域边界和主内连通域边界的交点之间的距离，记为目标连通域的第二距离；作以外圆心为起点、过内圆心的射线，统计所述过内圆心的射线分别与主内连通域边界和目标连通域边界的交点，将所述内圆心的射线分别与主内连通域边界和目标连通域边界的交点之间的距离，记为目标连通域的第一距离。进一步地，所述根据目标连通域和所有参考连通域的向量的差异，得到目标连通域的方向相似性对应的具体计算公式为：其中C为目标连通域的方向相似性，为目标连通域的向量，/＞为第i个参考连通域的向量，/＞为/＞和/＞的夹角值，N为参考连通域的数量。进一步地，所述根据目标连通域和所有参考连通域的第一距离、第二距离，得到目标连通域的扩展渐变相似性，包括的具体步骤如下：将目标连通域的第一距离除以第二距离，记为目标连通域在光照方向上的扩展渐变程度；将每个参考连通域的第一距离除以第二距离，记为参考连通域在光照方向上的扩展渐变程度；根据目标连通域与所有参考连通域在光照方向上的扩展渐变程度的差异，得到目标连通域的扩展渐变相似性。进一步地，所述根据目标连通域与所有参考连通域在光照方向上的扩展渐变程度的差异，得到目标连通域的扩展渐变相似性对应的具体计算公式为：其中D为目标连通域的扩展渐变相似性，为目标连通域的第一距离，/＞为目标连通域的第二距离，/＞为第i个参考连通域的第一距离，/＞为第i个参考连通域的第二距离，N为参考连通域的数量，/＞为以自然常数为底的指数函数。进一步地，所述在分割阈值序列中，根据所有数据的数据值、所有相邻数据对应的目标连通域为凹陷缺陷的可能性，得到最优分割阈值，包括的具体步骤如下：将分割阈值序列中连续相邻的三个数据，记为一组数据；在每组数据中，根据数据值之间的差异、所有相邻数据对应的目标连通域为凹陷缺陷的可能性的差异，得到每组数据的可能性阈值和灰度阈值；按照分割阈值序列的顺序，逐个判断每组数据的可能性阈值是否小于预设的可能性停止值、且每组数据的灰度阈值是否小于预设的灰度停止值，当所有组数据中的一组数据的可能性阈值小于预设的可能性停止值、且灰度阈值小于预设的灰度停止值时，停止判断，并将所述所有组数据中的一组数据中的数据均值，记为最优分割阈值。进一步地，所述在每组数据中，根据数据值之间的差异、所有相邻数据对应的目标连通域为凹陷缺陷的可能性的差异，得到每组数据的可能性阈值和灰度阈值对应的具体计算公式为：其中为第k组数据的可能性阈值，/＞为第k组数据的灰度阈值，/＞为第k组数据中第一、二个数据对应的目标连通域为凹陷缺陷的可能性，/＞为第k组数据中第二、三个数据对应的目标连通域为凹陷缺陷的可能性，/＞为第k组数据中第一、二个数据的均值，/＞为第k组数据中第二、三个数据的均值，| |为绝对值函数。进一步地，所述根据最优分割阈值，判断所述塑料管材是否合格，包括的具体步骤如下：在管材灰度图像中，将所有灰度值小于最优分割阈值的像素点构成的区域，记为凹坑缺陷区域；当凹坑缺陷区域中的像素点数量大于预设的面积阈值时，则判断所述塑料管材不合格；当凹坑缺陷区域中的像素点数量小于等于预设的面积阈值时，则判断所述塑料管材合格。本发明的技术方案的有益效果是：本发明实施例中，采集塑料管材的表面图像，获取管材灰度图像和分割阈值序列，在分割阈值序列中的任意两个相邻数据中，将最小和最大的数据，分别记为第一阈值和第二阈值，从而得到目标连通域与其中的主内连通域，获取目标连通域的方向相似性和扩展渐变相似性，结合目标连通域和主内连通域的圆形度，得到目标连通域为凹陷缺陷的可能性，由此获取最优分割阈值，其根据迭代阈值分割过程中前后像素点的类别变化形成的图像形状关系判断区域属于缺陷的可能性，利用可能性判断阈值分割的终止条件，解决了在迭代阈值分割时允许停止阈值存在一定偏差而对凹坑的边缘的产生错误识别的影响，提高了对塑料管材凹坑缺陷分割的准确率。再根据最优分割阈值，判断所述塑料管材是否合格。至此本发明通过对凹陷缺陷特征进行分析从而判断凹陷边缘的具体位置，有效解决了迭代阈值分割对于停止阈值存在误差导致凹陷分割不准确的问题，提高了凹陷缺陷区域分割的准确性，从而提高塑料管材质量检测的准确性。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明基于图像处理的塑料管材质量检测方法的步骤流程图；图2为本实施例所提供的一个待检测塑料管材表面图像示意图；图3为本实施例所提供的一个迭代分割阈值时的凹陷缺陷变化特征示意图。具体实施方式为了更进一步阐述本发明为达成预定发明目的所采取的技术手段及功效，以下结合附图及较佳实施例，对依据本发明提出的基于图像处理的塑料管材质量检测方法，其具体实施方式、结构、特征及其功效，详细说明如下。在下述说明中，不同的“一个实施例”或“另一个实施例”指的不一定是同一实施例。此外，一或多个实施例中的特定特征、结构或特点可由任何合适形式组合。除非另有定义，本文所使用的所有的技术和科学术语与属于本发明的技术领域的技术人员通常理解的含义相同。下面结合附图具体的说明本发明所提供的基于图像处理的塑料管材质量检测方法的具体方案。请参阅图1，其示出了本发明一个实施例提供的基于图像处理的塑料管材质量检测方法的步骤流程图，该方法包括以下步骤：步骤S001：采集任意一个塑料管材的表面图像，进行去噪和灰度化处理，得到管材灰度图像；在管材灰度图像中，使用迭代阈值分割算法，依次记录每次迭代后的分割阈值，得到分割阈值序列。本实施例使用CMOS相机采集任意一个塑料管材的表面图像，并对所述塑料管材的表面图像进行去噪和灰度化处理，得到管材灰度图像。所需说明的是：CMOS相机是一种使用互补金属氧化物半导体图像传感器的数字相机，其具有高分辨率和精确度，还能够以高速进行检测实现快速的产品检查和分类。在塑料管材等产品的质量控制和外观检测方面具有高效、准确、自动化等多方面的优势，有助于提高生产效率和产品质量，降低生产成本，并且还能够有效降低对光的敏感程度。本实施例使用高斯滤波算法对塑料管材图像进行去噪处理，其中高斯滤波算法和图像灰度化均为公知技术，具体方法在此不做介绍，以此减小塑料管材杂质以及光照不均对后续图像处理产生的影响。图2为本实施例所提供的一个待检测塑料管材表面图像示意图。塑料管材上不同凹陷的表现的程度不同，在光照的情况下表现出的亮度不同。较大的凹坑存在明显的凹陷区域，颜色更偏暗，像素的灰度值偏小。而较小的凹坑与塑料管材之间灰度差异小，颜色偏亮。离凹陷边缘越近管材更平坦，会有更多的反射光线进入CMOS相机，成像更亮，灰度值更大。离凹陷的中心位置越近弧度大，进入相机的光线少，成像更暗，灰度值更小。因此从整幅图像上来说，凹陷的中心位置更容易检测，而凹陷的边缘部分与管材本身属于同一材质，并且不存在明显的形状变化，因此该部分的像素点灰度值与背景区域的灰度值差异较小，因此对于阈值的选取需要更加精细，因为稍有偏差就会对缺陷的分割造成较大的误差，所以不能通过迭代阈值分割的比较前后阈值的变化差异确定迭代的停止条件，而是需要考虑迭代前后的图形变化确定停止条件，从而确定凹坑缺陷的分割阈值和凹陷区域。由此根据迭代阈值分割过程中出现类别变化的像素点确定表现为凹陷缺陷的可能性。由于表现为凹陷中心的位置弧度大反射光线发散，进入相机的光线少，灰度值明显偏小，在图像中明显呈现出黑色区域。本实施例设定的初始阈值为10，以此为例进行叙述，其它实施方式中可设置为其它值，本实施例不进行限定。所需说明的是：管材灰度图像中灰度值小于初始阈值的像素点应为凹陷缺陷区域，且为缺陷最为明显的核心区域，其它像素点为背景区域。在管材灰度图像中，从初始阈值10开始，使用迭代阈值分割算法，依次记录每次迭代后的分割阈值，得到分割阈值序列。所需说明的是：迭代阈值分割算法为公知技术，其具体过程为：先根据初始阈值将图像分割为灰度值大于和小于等于初始阈值的两类像素点，分别计算两类像素点的灰度均值，再计算这两个灰度均值的均值，为新分割阈值，用新分割阈值将图像分割为两类，由此进行迭代。迭代次数为迭代阈值分割算法的主要参数，本实施例设定的迭代次数q为100，以此为例进行叙述，其它实施方式中可设置为其它值，本实施例不进行限定。故分割阈值序列中的数据数量为100。由于凹陷像素点的灰度值存在渐变关系，凹陷中心的像素点灰度值小，向外四周扩展时凹陷的灰度值逐步增大，并且呈现出以核心区域为中心，近似为圆形的形状向外四周扩展。因此根据迭代阈值分割过程前后发生类别变化的像素点形成的连通区域形状为近似于圆环。由于受到凹陷缺陷一侧的阻挡，导致成像时凹陷的各个方向上虽然都表现为向外扩展，但各个方向上扩展的程度不同。一方面，在图像上表现为在光照的影响下圆环的内边缘会向一侧偏移会朝着光照方向进行偏移，并且不同凹陷区域的偏移方向具有一致性。另一方面，尽管同一凹陷的各个方向上扩展程度不同，但是不同区域凹陷的扩展程度具有相似性。通过上述凹陷缺陷表现的特征判断迭代前后变化区域属于凹陷的可能性。图3为本实施例所提供的一个迭代分割阈值时的凹陷缺陷变化特征示意图。步骤S002：在分割阈值序列中的任意两个相邻数据中，将最小和最大的数据，分别记为第一阈值和第二阈值；根据第一阈值和第二阈值，得到管材灰度图像中有效连通域，并将有效连通域划分为目标连通域和参考连通域，以及得到目标连通域中的主内连通域。在分割阈值序列中的任意两个相邻数据中，将最小的数据，记为第一阈值，将最大的数据，记为第二阈值。所需说明的是：所述的任意两个相邻数据，本实施例以分割阈值序列中第一个和第二个数据为例。当分割阈值序列中第一个和第二个数据相等时，说明分割阈值迭代过程中，相邻的两次迭代得到的分割阈值相同，即第二个数据无意义，因此在分割阈值序列中去除第二个数据，此时原来的第三个数据就是当前的第二个数据，直至分割阈值序列中第一个和第二个数据不相等。在管材灰度图像中，将灰度值小于第一阈值的像素点，记为第一像素点，将灰度值小于第二阈值的像素点，记为第二像素点。将所有第二像素点构成的区域，记为第二区域。将第二区域中连续相邻的像素点构成的连通域，记为外连通域。将同时存在第一像素点和第二像素点的外连通域，记为有效连通域。计算每个有效连通域内的像素点数量，统计所有的有效连通域内的像素点数量中的最大值，将所述有效连通域内的像素点数量中的最大值对应的有效连通域，记为目标连通域。将不是目标连通域的有效连通域，记为参考连通域。在目标连通域内，将连续相邻的第一像素点构成的连通域，记为内连通域。计算每个内连通域内的像素点数量，统计所有的内连通域内的像素点数量中的最大值，将所述内连通域内的像素点数量中的最大值对应的内连通域，记为主内连通域。所需说明的是：第二像素点应包含所有第一像素点。凹陷缺陷从中心向四周扩展时像素点灰度值逐步增大，即目标连通域在图3中应为整个大圆，目标连通域的边界应为图3中的外边界，主内连通域在图3中应为整个小圆，主内连通域的边界应为图3中的内边界，目标连通域内只是第二像素点的像素点在图3中为发生类别变化的像素点，即为随着分割阈值增大，而多出来的小于分割阈值的像素点。且沿图3中的光照方向，越远离光照方向，在灰度值的变化越慢，因此发生类别变化的像素点会沿光照方向逐渐增加。若不存在有效连通域或者只有一个有效连通域，则说明当前第一阈值和第二阈值差异较小，需要在分割阈值序列中重新选取两个相邻阈值，保障存在多个有效连通域。本实施例选取像素点数量最多的为目标连通域和主内连通域，是为了用较多的数据，保障后续数据分析的可信度。步骤S003：根据圆形度计算公式，分别得到目标连通域和主内连通域的圆形度；根据目标连通域和主内连通域的中心点，得到目标连通域的向量、第二距离和第一距离；根据目标连通域和所有参考连通域的向量的差异，得到目标连通域的方向相似性。根据迭代过程中前后发生类别变化的像素点形成的目标连通域和主内连通域的形状特征，判断其属于凹陷缺陷的可能性。根据圆形度计算公式，分别得到目标连通域和主内连通域的圆形度。所需说明的是：圆形度计算公式为公知技术，具体过程为：4乘以圆周率乘以连通域的面积，再除以连通域的边界长度的平方，即为连通域的圆形度。圆形度的取值范围通常是从0到1之间。圆形度越接近1，表示连通域的形状越接近一个完美的圆形。而圆形度越接近0，表示连通域的形状越偏离圆形。因此目标连通域和主内连通域的圆形度越大，其表现为圆的程度大，从而目标连通域表现为圆环的程度高，目标连通域为凹陷缺陷的可能性大。已知目标连通域边界会沿光照的方向上存在一定程度的偏移，并且不同的凹陷区域的偏移方向存在相似性，由此判断目标连通域属于缺陷的可能性。使用连通域的重心计算算法，分别得到目标连通域和主内连通域的中心点。其中，连通域的重心计算算法为公知技术，具体方法在此不做介绍。将目标连通域的中心点，记为外圆心。将主内连通域的中心点，记为内圆心。在目标连通域内，以内圆心到外圆心的方向为向量的方向，以内圆心到外圆心的距离为向量的模，构成目标连通域的向量。其中目标连通域的向量方向，应为图3中的光照方向。按照上述方式，得到每个参考连通域的向量。在目标连通域内，作以内圆心为起点、过外圆心的射线，统计所述过外圆心的射线分别与目标连通域边界和主内连通域边界的交点，将所述过外圆心的射线分别与目标连通域边界和主内连通域边界的交点之间的距离，记为目标连通域的第二距离。其中第二距离/＞就是图3中的/＞。作以外圆心为起点、过内圆心的射线，统计所述过内圆心的射线分别与主内连通域边界和目标连通域边界的交点，将所述内圆心的射线分别与主内连通域边界和目标连通域边界的交点之间的距离，记为目标连通域的第一距离。其中第一距离/＞就是图3中的/＞。所需说明的是：不管外圆心是否在主内连通域内，所述过外圆心的射线分别与目标连通域和主内连通域的边界的交点只有两个，因此只有唯一的一个。当外圆心在主内连通域内时，所述过内圆心的射线分别与目标连通域和主内连通域的边界的交点只有两个，因此只有唯一的一个/＞。当外圆心在主内连通域外时，所述过内圆心的射线分别与目标连通域和主内连通域的边界的交点存在两个以上，此时取距离外圆心最远的两个交点之间的距离，为/＞。按照上述方式，得到每个参考连通域的第二距离和第一距离。由于检测过程中光源的位置固定，从而在塑料管材上的投影方向固定，故虽然不同的凹陷缺陷大小不一致，但是目标连通域的向量方向与参考连通域的向量方向之间存在相似性。如果目标连通域的相似性越大，则说明表现为凹陷缺陷的可能性越大。由此可知目标连通域的方向相似性C的计算公式为：其中C为目标连通域的方向相似性，为目标连通域的向量，/＞为第i个参考连通域的向量，/＞为/＞和/＞的夹角值，N为参考连通域的数量。所需说明的是：越大，说明目标连通域和参考连通域的向量方向差异越大，因此/＞越小，目标连通域和参考连通域的向量方向的相似性越大，其中分母中加1是为了防止分母为0，/＞为/＞的反比例归一化值。故用/＞表示目标连通域的方向相似性，C越大，目标连通域为凹陷缺陷的可能性越大。本实施例使用反余弦函数计算两个向量的夹角值。步骤S004：根据目标连通域和所有参考连通域的第一距离、第二距离，得到目标连通域的扩展渐变相似性。根据不同凹陷区域表现出向四周扩展的程度之间具有相似性，可判断属于缺陷的可能性。虽然不同的凹陷区域分割时的大小不同，从而导致距离和/＞不同，但由于光源位置固定从而塑料管材上不同的凹陷区域表现出的扩展程度相似，从而导致不同凹陷区域的灰度值在同一方向上的渐变程度相似。比较不同区域光照方向上的渐变关系，从而判断区域属于凹陷的可能性。由此可知目标连通域的扩展渐变相似性D的计算公式为：其中D为目标连通域的扩展渐变相似性，为目标连通域的第一距离，/＞为目标连通域的第二距离，/＞为第i个参考连通域的第一距离，/＞为第i个参考连通域的第二距离，N为参考连通域的数量。/＞为以自然常数为底的指数函数，本实施例以/＞来呈现反比例关系及归一化处理，实施者可根据实际情况设置反比例函数及归一化函数。所需说明的是表示目标连通域在光照方向上的扩展渐变程度，/＞为第i个参考连通域在光照方向上的扩展渐变程度，/＞表示目标连通域与第i个参考连通域之间的扩展变化差异，如果差异越小，则两区域之间的相似性越大。故用/＞表示目标连通域的扩展渐变相似性，D值越大，目标连通域为凹陷缺陷的可能性越大。步骤S005：将目标连通域的圆形度、方向相似性、扩展渐变相似性、主内连通域的圆形度的均值，记为目标连通域为凹陷缺陷的可能性。由此可知目标连通域为凹陷缺陷的可能性P的计算公式为：其中P为目标连通域为凹陷缺陷的可能性，为目标连通域的圆形度，/＞为主内连通域的圆形度，C为目标连通域的方向相似性，D为目标连通域的扩展渐变相似性。所需说明的是：、/＞、/＞、/＞的取值都在之间，且值越大，目标连通域为凹陷缺陷的可能性越大，因此用四者的均值，表示目标连通域为凹陷缺陷的可能性。至此，可通过对凹陷缺陷表现出的特征，判断了迭代过程中形成的目标连通域表现为凹陷的可能性。按照上述方式，得到分割阈值序列中任意相邻两个数据对应的目标连通域为凹陷缺陷的可能性。步骤S006：在分割阈值序列中，根据所有数据的数据值、所有相邻数据对应的目标连通域为凹陷缺陷的可能性，得到最优分割阈值；根据最优分割阈值，判断所述塑料管材是否合格。由此根据分割阈值序列中所有相邻数据对应的目标连通域为凹陷缺陷的可能性，判断整幅图像中凹陷缺陷的表示程度，利用对缺陷特征的表示程度确定迭代阈值分割的停止条件。将分割阈值序列中连续相邻的三个数据，记为一组数据。所需说明的是：若分割阈值序列为，则划分的每组数据依次为/＞、/＞、。由于分割阈值序列存在顺序，则每组数据也存在顺序。由此可知分割阈值序列中每组数据的可能性阈值和灰度阈值的计算公式为：其中为第k组数据的可能性阈值，/＞为第k组数据的灰度阈值，q为分割阈值序列中的数据数量，即分割阈值序列被划分为q-2组数据。/＞为第k组数据中第一、二个数据对应的目标连通域为凹陷缺陷的可能性，/＞为第k组数据中第二、三个数据对应的目标连通域为凹陷缺陷的可能性，/＞为第k组数据中第一、二个数据的均值，/＞为第k组数据中第二、三个数据的均值。| |为绝对值函数。所需说明的是：越小，说明相邻分割阈值将图像分割之后的目标连通域为凹陷缺陷的可能性大小相似，即此时的分割阈值越可信。/＞越小，说明相邻分割阈值之间的差异越小，此时迭代的分割阈值变化越小，越可信。即图像迭代对于缺陷的分割趋于稳定。本实施例设定的可能性停止值为0.05，灰度停止值为2，以此为例进行叙述，其它实施方式中可设置为其它值，本实施例不进行限定。按照分割阈值序列的顺序，逐个判断每组数据的可能性阈值是否小于可能性停止值、且灰度阈值是否小于灰度停止值，当所有组数据中一组数据的可能性阈值小于可能性停止值、且灰度阈值小于灰度停止值时，停止判断，并将所述所有组数据中一组数据中的数据均值，记为最优分割阈值。所需说明的是：若不存在任意一组数据的可能性阈值小于可能性停止值、且灰度阈值小于灰度停止值，则增加迭代次数，即增加分割阈值序列中，或者增大可能性停止值和灰度停止值。在管材灰度图像中，将所有灰度值小于最优分割阈值的像素点构成的区域，记为凹坑缺陷区域。本实施例设定的面积阈值为50，以此为例进行叙述，其它实施方式中可设置为其它值，本实施例不进行限定。当凹坑缺陷区域中的像素点数量大于50，则判断所述塑料管材不合格。当凹坑缺陷区域中的像素点数量小于等于50，则判断所述塑料管材合格。至此，本发明完成。综上所述，在本发明实施例中，采集塑料管材的表面图像，获取管材灰度图像和分割阈值序列，在分割阈值序列中的任意两个相邻数据中，将最小和最大的数据，分别记为第一阈值和第二阈值，从而得到目标连通域与其中的主内连通域，获取目标连通域的方向相似性和扩展渐变相似性，结合目标连通域和主内连通域的圆形度，得到目标连通域为凹陷缺陷的可能性。在分割阈值序列中，根据所有数据的数据值、所有相邻数据对应的目标连通域为凹陷缺陷的可能性，得到最优分割阈值。根据最优分割阈值，判断所述塑料管材是否合格。本发明通过对凹陷缺陷特征进行分析从而判断凹陷边缘的具体位置，由此提高凹陷缺陷区域分割的准确性，从而提高塑料管材质量检测的准确性。以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
