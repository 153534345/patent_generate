标题title
一种具有风格个性化的图像生成方法、装置及存储介质
摘要abst
本发明公开了人工智能技术领域的一种具有风格个性化的图像生成方法、装置及存储介质，旨在解决图像生成的质量与准确性的技术问题。所述方法包括：选取风格图像，将其输入预构建的VGG19_f3网络模型中，获得不同大小特征图；计算特征图的Gram矩阵，以提取出特征图的风格信息；将经过文本编码器得到的文本的编码、噪音图像、风格信息输入预构建的具有风格引导模块的噪音预测网络进行噪音预测，获得预测噪音并对噪音图像进行重复去噪，获得潜空间图像，以及将其通过图像解码器进行解码，获得最终生成风格个性化图像。本发明能够使模型端到端生成风格个性化图像，使模型具有更强的风格个性化能力，同时保证生成图像的质量以及准确性。
权利要求书clms
1.一种具有风格个性化的图像生成方法，其特征在于，包括：选取风格图像，将所述风格图像输入预构建的VGG19_f3网络模型中，获得不同大小的特征图；计算所述特征图的Gram矩阵，以提取出所述特征图的风格信息；将经过文本编码器得到的文本的编码、随机采样的噪音图像、风格信息输入预构建的具有风格引导模块的噪音预测网络中进行噪音预测，获得预测噪音；利用所述预测噪音对所述噪音图像进行重复的去噪操作，获得潜空间图像；将所述潜空间图像通过大型图像生成模型中的图像解码器进行解码，获得最终生成的风格个性化图像。2.根据权利要求1所述的具有风格个性化的图像生成方法，其特征在于，所述获得不同大小的特征图，包括：将所述风格图像的像素大小设置为设定尺寸；利用VGG19网络模型的前三个下采样块组成VGG19_f3网络模型，并将所述风格图像输入至所述VGG19_f3网络模型中，输出指定大小的第一特征图、第二特征图/＞和第三特征图/＞。3.根据权利要求2所述的具有风格个性化的图像生成方法，其特征在于，提取出所述特征图的风格信息，包括：计算所述第一特征图、第二特征图/＞和第三特征图/＞的Gram矩阵，获得第一风格特征，第二风格特征/＞和第三风格特征/＞；将所述第一风格特征，第二风格特征/＞进行最大池化操作后与所述第三风格特征/＞相加，得到风格信息S。4.根据权利要求3所述的具有风格个性化的图像生成方法，其特征在于，所述第一特征图、第二特征图/＞和第三特征图/＞的Gram矩阵的计算表达式如下：，其中，为特征图F的Gram矩阵中的第i行，第j列矩阵；/＞为特征图的通道/＞的第/＞个元素；/＞为特征图的通道/＞的第/＞个元素；/＞为特征图/＞的高；/＞为特征图/＞的宽。5.根据权利要求1所述的具有风格个性化的图像生成方法，其特征在于，所述具有风格引导模块的噪音预测网络的构建过程如下：复制大型图像生成模型中的噪音预测网络的下采样块和中间块，获得下采样网络，所述下采样网络和所述大型图像生成模型中的噪音预测网络组成具有风格引导模块的噪音预测网络。6.根据权利要求5所述的具有风格个性化的图像生成方法，其特征在于，所述获得预测噪音，包括：将所述风格信息输入至所述下采样网络，获得第一风格信息、第二风格信息/＞、第三风格信息/＞、第四风格信息/＞、第五风格信息/＞；将所述经过文本编码器得到的文本的编码、随机采样的噪音图像/＞依次输入至噪音预测网络中的下采样块和中间块，输出第一预测噪音；所述第五风格信息、第四风格信息/＞、第三风格信息/＞、第二风格信息/＞、第一风格信息依次与所述第一预测噪音相加，输出最终的预测噪音/＞。7.根据权利要求6所述的具有风格个性化的图像生成方法，其特征在于，所述获得潜空间图像，包括：利用所述预测噪音对噪音图像进行第一次去噪操作，获得第一次去噪图像，将所述第一次去噪图像/＞、风格信息S、文本的编码/＞再输入至预构建的具有风格引导模块的噪音预测网络，输出第一去噪预测结果/＞，利用所述第一去噪预测结果对第一次去噪图像/＞进行第二次去噪操作，获得第二去噪图像/＞；重复上述去噪操作设定次数，获得潜空间图像。8.根据权利要求7所述的具有风格个性化的图像生成方法，其特征在于，所述去噪操作的表达式如下：，，其中，为添加的噪声方差；/＞为由/＞计算得到的递减序列；/＞为/＞到/＞的积；/＞为/＞到/＞的积；/＞为从标准正态分布中随机采样的噪声图像；/＞为一步去噪后的噪音图像；/＞为/＞步时的噪声图像；/＞为编码后的文本信息；/＞为步长；/＞为风格信息；/＞为预测的噪声。9.一种具有风格个性化的图像生成装置，其特征在于，所述装置包括：图像输入模块，用于选取风格图像，将所述风格图像输入预构建的VGG19_f3网络模型中，获得不同大小的特征图；提取风格信息模块，用于计算所述特征图的Gram矩阵，以提取出所述特征图的风格信息；噪音预测模块，用于将经过文本编码器得到的文本的编码、随机采样的噪音图像、风格信息输入预构建的具有风格引导模块的噪音预测网络中进行噪音预测，获得预测噪音；去除噪音模块，用于利用所述预测噪音对所述噪音图像进行重复的去噪操作，获得潜空间图像；图像解码模块，将所述潜空间图像通过大型图像生成模型中的图像解码器进行解码，获得最终生成的风格个性化图像。10.一种计算机可读存储介质，其上存储有计算机程序，其特征在于，该程序被处理器执行时实现权利要求1~8任一项所述方法的步骤。
说明书desc
技术领域本发明涉及一种具有风格个性化的图像生成方法、装置及存储介质，属于人工智能技术领域。背景技术面向电子出版物的插图智能生成本质上是一个根据文本生成图像的过程，现有的大型图像生成模型可以根据自然语言文本提示，来实现高质量和多样化的图像生成，然而为了吸引更多的读者，面向电子出版物的插图生成要求模型根据用户个人的风格喜好为其生成风格个性化的插图，在这样的背景下，现有的大型图像生成模型则缺乏风格个性化能力，无法满足应用需求。对于图像生成问题，现有的研究通常是建立在预训练的大型图像生成模型上，以充分利用大模型的图像生成能力，其解决办法大都需要分成多个阶段或模块来训练模型，或者需要对预训练的大型图像生成模型进行许许多多步骤的微调，与端到端的模型相比，复杂度较高，且每当面对一个新的风格，都需要为其重新微调模型的权重，这样既耗时又消耗存储，因此这些方法的可扩展性和实用性受到很大限制。发明内容本发明的目的在于克服现有技术中的不足，提供一种具有风格个性化的图像生成方法、装置及存储介质，能够利用风格特征来引导图像的生成过程，并且不需要为每一种新风格重新训练模型，同时通过构建的具有风格引导模块的噪音预测网络，使得模型具有更强的风格个性化能力，同时能够保证生成图像的质量以及准确性。为达到上述目的，本发明是采用下述技术方案实现的：第一方面，本发明提供了一种具有风格个性化的图像生成方法，包括：选取风格图像，将所述风格图像输入预构建的VGG19_f3网络模型中，获得不同大小的特征图；计算所述特征图的Gram矩阵，以提取出所述特征图的风格信息；将经过文本编码器得到的文本的编码、随机采样的噪音图像、风格信息输入预构建的具有风格引导模块的噪音预测网络中进行噪音预测，获得预测噪音；利用所述预测噪音对所述噪音图像进行重复的去噪操作，获得潜空间图像；将所述潜空间图像通过大型图像生成模型中的图像解码器进行解码，获得最终生成的风格个性化图像。结合第一方面，进一步地，所述获得不同大小的特征图，包括：将所述风格图像的像素大小设置为设定尺寸；利用VGG19网络模型的前三个下采样块组成VGG19_f3网络模型，并将所述风格图像输入至所述VGG19_f3网络模型中，输出大指定大小的第一特征图、第二特征图/＞和第三特征图/＞。结合第一方面，所述提取出特征图的风格信息，包括：计算所述第一特征图、第二特征图/＞和第三特征图/＞的Gram矩阵，获得第一风格特征/＞，第二风格特征/＞和第三风格特征/＞；将所述第一风格特征，第二风格特征/＞进行最大池化操作后与所述第三风格特征/＞相加，得到风格信息S。结合第一方面，所述特征图和的Gram矩阵的计算表达式如下：，其中，为特征图F的Gram矩阵中的第i行，第j列矩阵；/＞为特征图的通道/＞的第/＞个元素；/＞为特征图的通道/＞的第/＞个元素；/＞为特征图/＞的高；/＞为特征图/＞的宽。结合第一方面，所述具有风格引导模块的噪音预测网络的构建过程如下：复制大型图像生成模型中的噪音预测网络的下采样块和中间块，获得下采样网络，所述下采样网络和所述大型图像生成模型中的噪音预测网络组成具有风格引导模块的噪音预测网络。结合第一方面，所述获得预测噪音，包括：将所述风格信息输入至所述下采样网络，获得第一风格信息、第二风格信息/＞、第三风格信息/＞、第四风格信息/＞、第五风格信息/＞；将所述经过文本编码器得到的文本的编码、随机采样的噪音图像/＞依次输入至噪音预测网络中的下采样块和中间块，输出第一预测噪音；所述第五风格信息、第四风格信息/＞、第三风格信息/＞、第二风格信息/＞、第一风格信息/＞依次与所述第一预测噪音相加，输出最终的预测噪音/＞。结合第一方面，所述获得潜空间图像，包括：利用所述预测噪音对噪音图像进行第一次去噪操作，获得第一次去噪图像，将所述第一次去噪图像/＞、风格个性化特征、文本的编码再输入至预构建的具有风格引导模块的噪音预测网络，输出第一去噪预测结果/＞，利用所述第一去噪预测结果对第一次去噪图像/＞进行第二次去噪操作，获得第二去噪图像/＞；重复上述去噪操作设定次数，获得潜空间图像。结合第一方面，所述去噪操作的表达式如下：，，其中，为添加的噪声方差；/＞为由/＞计算得到的递减序列；/＞为/＞到/＞的积；/＞为/＞到/＞的积；/＞为从标准正态分布中随机采样的噪声图像；/＞为一步去噪后的噪音图像；/＞为/＞步时的噪声图像；/＞为编码后的文本信息；/＞为步长；/＞为风格信息；/＞为预测的噪声。第二方面，一种具有风格个性化的图像生成装置，所述装置包括：图像输入模块，用于选取风格图像，将所述风格图像输入预构建的VGG19_f3网络模型中，获得不同大小的特征图；提取风格信息模块，用于计算所述特征图的Gram矩阵，以提取出所述特征图的风格信息；噪音预测模块，用于将经过文本编码器得到的文本的编码、随机采样的噪音图像、风格信息输入预构建的具有风格引导模块的噪音预测网络中进行噪音预测，获得预测噪音；去除噪音模块，用于利用所述预测噪音对所述噪音图像进行重复的去噪操作，获得潜空间图像；图像解码模块，将所述潜空间图像通过大型图像生成模型中的图像解码器进行解码，获得最终生成的风格个性化图像。第三方面，本发明提供了一种计算机可读存储介质，其上存储有计算机程序，该程序被处理器执行时实现前述任一项所述方法的步骤。与现有技术相比，本发明所达到的有益效果：本发明利用VGG19-f3网络模型提取出不同像素大小的特征图，并利用Gram矩阵计算特征图每一层的风格特征，以便提取出风格信息，利用该风格信息来引导图像的生成过程，图像的内容特征不参与引导，因此不需要使用内容对应的图像来训练模型，本发明构建的具有风格引导模块的噪音预测网络不需要单独为每一种新风格单独训练模型，节约了时间成本和存储模型所用的空间成本，并且充分利用了图像风格特征，既能够使图像具有更强的风格个性化能力，同时能够保证生成图像的质量以及准确性。附图说明图1是本发明实施例提供的图像生成过程示意图；图2是本发明实施例提供的风格图像数据；图3是本发明实施例提供的一种真值图像；图4是本发明实施例提供的一种具有风格个性化的图像；图5是本发明实施例提供的一种目前主流的条件图像生成模型ControlNet生成的图像。具体实施方式下面通过附图以及具体实施例对本发明技术方案做详细的说明，应当理解本发明实施例以及实施例中的具体特征是对本发明技术方案的详细的说明，而不是对本发明技术方案的限定，在不冲突的情况下，本发明实施例以及实施例中的技术特征可以相互组合。本发明中术语“和/或”，仅仅是一种描述关联对象的关联关系，表示可以存在三种关系，例如，A和/或B，可以表示：单独存在A，同时存在A和B，单独存在B这三种情况。另外，本文中字符"/"，一般表示前后关联对象是一种“或”的关系。实施例1图1是本发明实施例1中的一种具有风格个性化的图像生成方法的流程图。本流程图仅仅示出了本实施例所述方法的逻辑顺序，在互不冲突的前提下，在本发明其它可能的实施例中，可以以不同于图1所示的顺序完成所示出或描述的步骤。参见图1，本实施的方法具体包括如下步骤：步骤S1、选取风格图像，将风格图像输入预构建的VGG19_f3网络模型中，获得不同大小的特征图；需要说明的是，本发明的风格图像是从Pinterest开源图像数据集中随机选取共10000张。具体的，参见图2，对于选取的风格图像数据，为适配网络模型对输入尺寸的要求，将其像素大小设置为512×512，利用VGG19网络模型的前三个下采样块组成的VGG19_f3网络模型，将风格图像数据且像素大小为512×512输入至该模型中，以提取出大小分别为128×128×64、64×64×128和32×32×256的第一特征图、第二特征图/＞以及第三特征图/＞，并保存这三个特征图，以便于后续抽取风格信息。其中，VGG19_f3网络模型的组成以及参数参照表1前三个下采样块的网络结构及特征图大小：表1 VGG19_f3网络模型的组成以及参数步骤S2、计算特征图的Gram矩阵，以提取出特征图的风格信息；具体的，通过计算第一特征图、第二特征图/＞以及第三特征图/＞的Gram矩阵来提取风格图像数据的风格信息，其Gram矩阵的计算表达式如下：，其中，为特征图F的Gram矩阵中的第i行，第j列矩阵；/＞为特征图的通道/＞的第/＞个元素；/＞为特征图的通道/＞的第/＞个元素；/＞为特征图/＞的高；/＞为特征图/＞的宽。进一步地，采用上述Gram矩阵的计算表达式得出每一层的风格特征、和/＞，将/＞进行最大池化操作后与/＞相加，获得风格信息S。步骤S3、将经过文本编码器得到的文本的编码、随机采样的噪音图像、风格信息输入预构建的具有风格引导模块的噪音预测网络中进行噪音预测，获得预测噪音；具体的，利用大型图像生成模型实现图像的生成，并根据SD模型结构设计出具有风格引导模块的噪音预测网络。其中SD中的噪音预测网络包括4个下采样块、/＞、/＞和/＞、1个中间块/＞和4个上采样块/＞、/＞、/＞和/＞。进一步地，复制该噪音预测网络中的下采样块和中间块，得到下采样块副本、/＞、、/＞和中间块/＞，总计五个网络块共同构成下采样网络，经网络块复制后得到的下采样网络与SD中的噪音预测网络组成具有风格引导模块的噪音预测网络。需要说明的是，下采样块副本、/＞、/＞、/＞和中间块/＞的图像特征大小分别为64×64、32×32、16×16、8×8以及8×8。从图1中可以得出，将噪音预测网络中的输出与下采样块中的输出相加，获得最终的噪音预测，具体过程如下：当步骤2中得到的风格个性化特征S输入下采样网络时，能够得到的输出、/＞的输出/＞、/＞的输出/＞、/＞的输出/＞以及/＞的输出/＞，同时，将基于输入的文本提示得到输入文本的编码/＞，以及随机采样的一个噪音图像/＞输入到下采样块/＞，将下采样块/＞的输出输入到下采样块/＞，将下采样块/＞的输出输入到下采样块/＞，将下采样块/＞的输出输入到下采样块/＞，将下采样块/＞的输出输入到中间块/＞；接着，将的输出/＞与中间块/＞的输出相加作为上采样块/＞的输入，将特征图/＞与上采样块/＞的输出相加作为上采样块/＞的输入，将特征图/＞与上采样块/＞的输出相加作为上采样块/＞的输入，将特征图/＞与上采样块/＞的输出相加作为上采样块/＞的输入，最后将特征图与上采样块/＞的输出相加，输出最终的预测噪音/＞。步骤S4、用预测噪音对噪音图像进行重复的去噪操作，获得潜空间图像；具体的，利用预测噪音对噪音图像/＞进行第一次去噪操作，获得第一次去噪图像/＞，将所述第一次去噪图像/＞、风格信息S、文本的编码/＞再输入至预构建的具有风格引导模块的噪音预测网络，输出第一去噪预测结果/＞，利用所述第一去噪预测结果对第一次去噪图像/＞进行第二次去噪操作，获得第二去噪图像/＞，再次将第二次去噪图像/＞、风格信息S、文本的编码/＞再输入至预构建的具有风格引导模块的噪音预测网络，输出第二去噪预测结果/＞；重复上述去噪操作50次，直至获得潜空间图像/＞。需要说明的是，使用最终的预测噪音对噪音图像去噪，其去噪表达式如下：，，其中，为添加的噪声方差，且随/＞增大而线性增大的超参数，/＞；/＞为由/＞计算得到的递减序列；/＞为/＞到/＞的积；/＞为/＞到/＞的积；/＞为从标准正态分布中随机采样的噪音，即/＞；使用该表达式对噪音图像/＞一步去噪后得到噪音图像/＞。进一步地，具有风格引导模块的噪音预测网络的训练方法包括：对于选取的一张原始图像，不断对其添加噪声，将加噪后的图像和其对应的文本的编码、风格信息/＞输入到具有风格引导模块的噪音预测网络/＞，计算获得的预测噪音与添加的真实噪音/＞的损失来对网络进行优化，其损失函数/＞表达式为：，步骤S5、利用SD中的图像解码器对所述潜空间图像进行解码，获得最终的风格个性化图像。实施例2本发明实施例中将上述实施例1的方法和模型与目前主流的条件图像生成模型ControlNet在2000条用户数据构成的测试集上进行对比，在该数据集上的实验分别计算模型生成的图像在真值上的指标和在风格图像集上的指标，其整体性能对比结果如下述的表2所示，其中FID为图像生成领域中重要的衡量生成图像质量的指标Fréchet InceptionDistance；KID为重要的衡量生成图像多样性的指标Kernel Inception Distance；CLIPSIM为重要的衡量生成图像与文本一致程度的指标。StySim为本发明提出的衡量图像风格相似度的指标Style Similarity，其计算方法为：对于两张图像和/＞，使用VGG19网络前四个网络块提取他们的特征，每层输出结果为/＞以及/＞，分别计算他们的/＞矩阵得到/＞和/＞，计算每一层的一对Gram矩阵的均方误差，最后对四个均方误差的计算结果求和得到风格相似度，/＞的计算公式，其中，为每层中Gram矩阵的元素个数，该指标的值越小说明两张图像的风格约相似，则模型的风格个性化性能越强；/＞为/＞的Gram矩阵；/＞为/＞的Gram矩阵；为衡量图像风格相似度的指标Style Similarity。表2 性能对比结果从表2中可以看出，在质量指标FID上，本发明与ControlNet相当，在多样性指标KID上，本发明的性能低于ControlNet，这是因为其生成图像的风格受限导致生成图像的多样性下降，从侧面表明了本发明的风格个性化性能更强；在风格相似度指标StySim上与ControlNet相比，本发明在真值图像集和风格图像集上的分别显示出4.3%÷1.85×100%）与7.5%÷2.14×100%）的提升；在文本图像一致性指标CLIPSIM上，本发明与ControlNet相当。不同方法在一组风格条件下的生成结果如图3、图4、图5所示，图3中的狮子图像为真值，即原始图像；图4中的狮子图像为经过本发明获得的风格个性化图像；图5中的狮子为目前主流的条件图像生成模型ControlNet生成的图像，因此相较于ControlNet，本发明的风格个性化效果更为明显，更接近于风格图像和真值的平面彩绘风格。实施例3一种具有风格个性化的图像生成装置，所述装置包括：图像输入模块，用于选取风格图像，将所述风格图像输入预构建的VGG19_f3网络模型中，获得不同大小的特征图；提取风格信息模块，用于计算所述特征图的Gram矩阵，以提取出所述特征图的风格信息；噪音预测模块，用于将经过文本编码器得到的文本的编码、随机采样的噪音图像、风格信息输入预构建的具有风格引导模块的噪音预测网络中进行噪音预测，获得预测噪音；去除噪音模块，用于利用所述预测噪音对所述噪音图像进行重复的去噪操作，获得潜空间图像；图像解码模块，将所述潜空间图像通过大型图像生成模型中的图像解码器进行解码，获得最终生成的风格个性化图像。实施例4本发明实施例还提供了一种计算机可读存储介质，其上存储有计算机程序，该程序被处理器执行时实现下述方法的步骤。本领域内的技术人员应明白，本申请的实施例可提供为方法、系统、或计算机程序产品。因此，本申请可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本申请可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本申请是参照根据本申请实施例的方法、设备、和计算机程序产品的流程图和／或方框图来描述的。应理解可由计算机程序指令实现流程图和／或方框图中的每一流程和／或方框、以及流程图和／或方框图中的流程和／或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能的步骤。以上所述仅是本发明的优选实施方式，应当指出，对于本技术领域的普通技术人员来说，在不脱离本发明技术原理的前提下，还可以做出若干改进和变形，这些改进和变形也应视为本发明的保护范围。
