标题title
一种使用卫星云图识别冷锋的深度学习方法、系统
摘要abst
一种使用卫星云图识别冷锋的深度学习方法、系统，该方法包括获取气象数据，计算850hPa温度平流，绘制卫星云图和气象要素图；对卫星云图进行预处理；使用预处理云图、海平面气压图和850hPa温度平流图制作用于识别冷锋的RGB图像；利用气象数据、850hPa温度平流和预处理云图，制作冷锋标签集；将RGB图像数据集和冷锋标签集输入到DETR模型中进行训练并测试，获得冷锋的识别结果。本发明得到了较好的自动化识别结果，实现了直接从图像中识别冷锋，有益于现代化天气预报业务中结合卫星云图识别冷锋的自动化，且能够提高冷锋位置和形态识别的准确性，为预报业务提供参考。
权利要求书clms
1.一种使用卫星云图识别冷锋的深度学习方法，其特征在于，包括：S1、获取气象数据，计算850hPa温度平流，绘制卫星红外云图和气象要素图；S2、对卫星红外云图进行预处理；S3、读取预处理云图、气象要素图和850hPa温度平流图的灰度图像，分别放置到RGB图像的R、G、B通道中，叠加成RGB图像数据集；S4、利用步骤S1中的气象数据、850hPa温度平流和步骤S2中的预处理云图，制作冷锋标签集；S5、利用步骤S3中的RGB图像数据集和步骤S4中的冷锋标签集生成冷锋识别数据集，将该数据集输入到DETR模型中进行训练并测试，获得冷锋的识别结果。2.根据权利要求1所述的使用卫星云图识别冷锋的深度学习方法，其特征在于，步骤S1中，绘制图像包括以下子步骤：S101、选择海平面气压场、地面10m风场、850hPa温度场和风场，设定空间分辨率，下载ERA-5资料和卫星全圆盘标称图像文件，选择40~160°E、10~66°N范围，计算850hPa温度平流，具体公式为：；其中，u表示850hPa的纬向水平风，v表示850hPa的经向水平风，表示u、v的复合风，x表示纬向，y表示经向，T表示850hPa的温度进行平滑后的温度值，/＞表示T的梯度；S102、使用单一色图绘制卫星红外云图、海平面气压图和850hPa温度平流图。3.根据权利要求1所述的使用卫星云图识别冷锋的深度学习方法，其特征在于，步骤S2中，预处理包括以下子步骤：S201、将卫星红外云图按照设定比例分为训练集和验证集，制作云区域标签，生成对应的注释文件和标签集中物体类数的文件，设置类数为一类，获得红外云图云区域数据集；S202、设置数据集类别、损失函数、批次样本数量和学习率，使用预训练权重在U-Net模型上进行训练，直到损失函数曲线收敛后停止，保存权重文件，将步骤S201中的红外云图云区域数据集输入到训练完成的U-Net模型中，得到云图的初步分割结果；S203、读取初步分割图，分别标记出图中各个独立的云区；S204、读取卫星云图的灰度图和云区分块文件，选定一个时次，读取各个独立云区的位置，将该位置对应到卫星云图的灰度图的格点上，提取每个独立云区的最高灰度值和云区域平均灰度值的平均值作为区域代表灰度值，根据该值落入的灰度值的数值范围和季节基准获取筛选权重；S205、选定一个时次，根据筛选权重处理图像，将每个独立云区内灰度值小于筛选权重的格点重新赋值为0，其余格点保持原像素值，将该时次内所有独立云区按照原位置重新拼成一张图，得到风云二号气象卫星FY-2红外云图的预处理结果。4.根据权利要求3所述的使用卫星云图识别冷锋的深度学习方法，其特征在于，步骤S203中，判断独立云区包括以下内容：遍历初步分割图中的每一个格点，若相邻格点的灰度值不为0，则将这些格点判断为相连通的格点，标记相同的数值，继续扩展直至这些格点周围所有不为0的格点都已标记，则得到内部所有格点全部标记为相同数值的连通区域，该连通区域则为独立的云区。5.根据权利要求4所述的使用卫星云图识别冷锋的深度学习方法，其特征在于，步骤S4中，制作冷锋标签集包括以下子步骤：S401、根据ERA-5海平面气压场、地面10m风场、850hPa温度场和风场资料，对应RGB图像的时次绘制冷锋分析要素图，该图包含850hPa温度平流、850hPa温度、平均海平面气压和地面10m风场的冷锋分析要素图；S402、在冷锋分析要素图和预处理云图中，找到满足高空与冷锋云系相对应、位于850hPa冷平流区前方、地面图上存在等值线的最大气旋式曲率、存在地面10m风从偏北风到偏南风的转向和与850hPa等温线大致平行的格点，将其标记为冷锋格点，连接成独立的、完整的冷锋粗线条；S403、提取冷锋粗线条，将确定为冷锋的格点设置为白色，其他格点设置为黑色，获得黑白二值图像；S404、读取黑白二值图像，遍历所有格点，将一个连通区域判断为一条独立锋线，提取出独立冷锋的粗线条位置，将每一条独立锋线按照对应的位置分条存放在图片中，并处理为黑白二值图像，获得冷锋标签图片，得到冷锋标签集。6.根据权利要求1所述的使用卫星云图识别冷锋的深度学习方法，其特征在于，步骤S5中，得到冷锋识别结果包括以下子步骤：S501、将步骤S3中的RGB图像数据集按照设定比例随机抽取为训练集和验证集，利用冷锋标签集生成对应的注释JSON文件，将训练集、验证集和注释文件组合获得冷锋识别数据集；S502、将冷锋识别数据集输入到DETR模型中，设置数据集类别、损失函数、批次样本数量、学习率和权重衰减，使用预训练权重在GPU上进行训练，生成存在冷锋的预测框，完成目标检测；设置冻结权重，在目标检测输出的顶部并添加mask头继续训练，完成目标分割；S503、将DETR模型训练至损失函数曲线收敛后停止，保存权重，并设置参数的权重，将选取时次生成的RGB图像输入到训练完成的DETR模型中，得到冷锋识别结果。7.应用于权利要求1所述的一种使用卫星云图识别冷锋的深度学习方法的系统，其特征在于，包括：数据获取模块，用于获取气象数据，计算850hPa温度平流，绘制卫星红外云图和气象要素图；图像预处理模块，用于对数据获取模块中的卫星红外云图进行预处理；RGB图像数据集获取模块，用于读取预处理卫星红外云图、气象要素图和850hPa温度平流图的灰度图像，分别放置到RGB图像的R、G、B通道中，叠加成RGB图像数据集；冷锋标签集制作模块，用于利用数据获取模块中的气象数据、850hPa温度平流和图像预处理模块中的预处理卫星红外云图，制作冷锋标签集；冷锋识别获取模块，用于将RGB图像数据集获取模块中的RGB图像数据集和冷锋标签集制作模块中的冷锋标签集输入到DETR模型中进行训练并测试，获得冷锋的识别结果。8.一种电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，其特征在于，所述处理器执行所述计算机程序时实现权利要求1至6中任一项所述方法的步骤。9.一种计算机可读的存储介质，所述计算机可读的存储介质存储有计算机程序，其特征在于，所述计算机程序被处理器运行时执行所述权利要求1至6中任一项所述的方法。
说明书desc
技术领域本发明涉及天气系统自动识别技术领域，尤其涉及一种使用卫星云图识别冷锋的深度学习方法、系统。背景技术传统的锋面识别方法主要利用各种气象要素进行分析，而卫星、雷达等非常规资料的应用能够使得气象人员对锋面的结构、天气和分析预报有一些新的认识。气象卫星云图是一种识别锋面的重要工具，其云区边界和云系稠密状况有助于精准定位锋面。作为一种在时间和空间连续性上具有巨大优势的探测资料，云图在锋面识别中的应用仍然比较缺乏。在实际气象业务预报中，结合云图的锋面分析大多依赖人工，且大多集中于某一典型过程。对于锋面自动识别方法，目前主要分为两大类，第一类是利用各种气象要素的客观识别算法，包括主流的热力法和风矢法等；第二类方法是利用深度学习模型的识别，但现有的锋面识别模型大部分使用CNN网络，一些概率预测方法可能会降低锋面形状和位置的准确性，有必要开发直接从图片中识别锋面的方案，例如目前已经提出了一种基于Mask R-CNN方法的欧亚大陆冷锋识别方案。但以上这些方案都没有考虑云图要素，也没有长期的卫星云图冷锋数据集。若能利用深度学习模型解决使用卫星云图的锋面识别问题，不仅能在锋面自动识别方案中补充云系要素，而且能得到云图冷锋的长期数据集，有利于冷锋业务预报的改进和从气候学角度开展对冷锋的研究。此外，在使用卫星云图的识别过程中，需要先进行云区域和地表区域的分割，排除一些陆地或水体的干扰。目前，卫星云图的分割和分类方法主要集中于两大类，第一类是阈值法、边缘检测、区域分割等，第二类是基于机器学习/深度学习模型的方法。但在利用云图识别冷锋的过程中，对云图的预处理仅为制作RGB图像的前序步骤，如何快速高效地实现处理目的是本步骤的首要目的。因此，寻求一种更为快速且高效的云图前处理方案也是十分必要的。发明内容本发明所要解决的技术问题：提供一种使用卫星云图识别冷锋的深度学习方法、系统，通过对FY-2红外云图做预处理，叠加其他气象要素生成RGB图像数据集，和冷锋标签集一起输入深度学习模型进行训练并测试，实现使用卫星云图识别冷锋的深度学习方案，并获得长期卫星云图冷锋数据集，提高了冷锋位置和形态识别的准确性，为冷锋业务预报提供参考。本发明为解决以上技术问题而采用以下技术方案：本发明提出的一种使用卫星云图识别冷锋的深度学习方法，包括：S1、获取气象数据，计算850hPa温度平流，绘制风云二号气象卫星FY-2红外云图和气象要素图。S2、对风云二号气象卫星FY-2红外云图进行预处理。S3、利用Python的OpenCV库直接读取预处理风云二号气象卫星FY-2红外云图、海平面气压图和850hPa温度平流图的灰度图像，分别放置到RGB图像的R、G、B通道中，叠加成RGB图像数据集。S4、利用步骤S1中的气象数据、850hPa温度平流和步骤S2中的预处理风云二号气象卫星FY-2红外云图，制作冷锋标签集。S5、利用步骤S3中的RGB图像数据集和步骤S4中的冷锋标签集生成冷锋识别数据集，将该数据集输入到DETR模型中进行训练并测试，获得冷锋的识别结果。进一步的，步骤S1中，绘制图像包括以下子步骤：S101、选择海平面气压场、地面10m风场、850hPa温度场和风场，设定空间分辨率，下载NetCDF格式的ERA-5资料和HDF格式的风云二号气象卫星全圆盘标称图像文件，选择40~160°E、10~66°N范围，计算850hPa温度平流，具体公式为：；其中，u表示850hPa的纬向水平风，v表示850hPa的经向水平风，表示u、v的复合风，x表示纬向，y表示经向，T表示850hPa的温度进行平滑后的温度值，/＞表示T的梯度。S102、使用单一色图绘制风云二号气象卫星FY-2红外云图、海平面气压图、850hPa温度平流图。进一步的，步骤S2中，预处理包括以下子步骤：S201、将步骤S102中的风云二号气象卫星FY-2红外云图按照设定比例分为训练集和验证集，利用Python的LabelMe工具制作云区域标签，生成对应的注释文件和用于说明标签集中物体类数的文件，设置类数为一类，获得红外云图云区域数据集，按VOC格式存放。S202、训练U-Net模型并测试，对云图进行初步分割。具体内容为：设置数据集类别、损失函数、批次样本数量、学习率，使用预训练权重在U-Net模型上进行训练，直到损失函数曲线收敛后停止，保存权重文件，将步骤S201中的红外云图云区域数据集输入到训练完成的U-Net模型中，得到云图的初步分割结果。S203、读取初步分割图，分别标记出图中各个独立的云区。判断是否为独立云区的内容是：遍历初步分割图中的每一个格点，若相邻的格点的灰度值不为0，则将这些格点判断为相连通的格点，标记相同的数值，继续扩展直至这些格点周围的所有不为0的格点都已被标记，则得到一个内部所有格点全部标记为相同数值的连通区域，这个连通区域就作为一个独立的云区。S204、读取卫星云图的灰度图和云区分块文件，选定一个时次，读取各个独立云区的位置，将该位置对应到卫星云图的灰度图的格点上，提取每个独立云区的最高灰度值和云区域平均灰度值的平均值作为区域代表灰度值，根据该值落入的灰度值的数值范围和季节基准获取筛选权重。S205、根据筛选权重处理图像，拼接云区，得到云图预处理结果。具体内容为：选定一个时次，将每个独立云区内灰度值小于筛选权重的格点重新赋值为0，其余格点保持原像素值，将该时次内所有独立云区按照原位置重新拼成一张图，得到红外云图预处理结果。进一步的，步骤S4中，制作冷锋标签集包括以下子步骤：S401、使用ERA-5海平面气压场、地面10m风场、850hPa温度场和风场资料，利用Python的Matplotlib库对应RGB图像的时次绘制冷锋分析要素图，该图包含850hPa温度平流、850hPa温度、平均海平面气压和地面10m风场的冷锋分析要素图。S402、使用冷锋分析要素图和预处理云图，直接在冷锋分析要素图上绘制冷锋粗线条。具体内容为：在冷锋分析要素图和预处理云图中，找到满足高空与冷锋云系相对应、位于850hPa冷平流区前方、地面图上存在等值线的最大气旋式曲率、存在地面10m风从偏北风到偏南风的转向和与850hPa等温线大致平行的格点，将其标记为冷锋格点，连接成独立的、完整的冷锋粗线条。S403、提取冷锋粗线条，将确定为冷锋的格点设置为白色，其他格点设置为黑色，获得黑白二值图像。S404、读取选定时次的黑白二值图像，遍历所有格点，将一个连通区域判断为一条独立锋线，提取出独立冷锋的粗线条位置，将每一条独立锋线按照对应的位置分条存放在图片中，并处理为黑白二值图像，按COCO格式命名冷锋标签图片。进一步的，步骤S5中，得到冷锋识别结果包括以下子步骤：S501、制作COCO格式的冷锋识别数据集。具体内容为：将步骤S3中的RGB图像数据集按照设定比例随机抽取为训练集和验证集，利用冷锋标签集生成对应的注释JSON文件，将训练集、验证集和注释文件组合获得COCO格式的冷锋识别数据集。S502、将COCO格式的冷锋识别数据集输入到DETR模型中，设置数据集类别、损失函数、批次样本数量、学习率和权重衰减，使用预训练权重在GPU上进行训练，生成可能存在冷锋的预测框，完成目标检测；设置冻结权重，在目标检测输出的顶部并添加mask头继续训练，完成目标分割。S503、对选取时次生成的RGB图像进行测试，得到冷锋识别结果。具体内容为：将DETR模型训练至损失函数曲线收敛后停止，保存权重，并设置参数的权重，将选取时次生成的RGB图像输入到训练完成的DETR模型中，得到冷锋识别结果。进一步的，本发明还提出了一种使用卫星云图识别冷锋的深度学习系统，包括：数据获取模块，用于获取气象数据，计算850hPa温度平流，绘制风云二号气象卫星FY-2红外云图和气象要素图。图像预处理模块，用于对数据获取模块中的风云二号气象卫星FY-2红外云图进行预处理。RGB图像数据集获取模块，用于读取预处理风云二号气象卫星FY-2红外云图、气象要素图和850hPa温度平流图的灰度图像，分别放置到RGB图像的R、G、B通道中，叠加成RGB图像数据集。冷锋标签集制作模块，用于利用数据获取模块中的气象数据、850hPa温度平流和图像预处理模块中的预处理风云二号气象卫星FY-2红外云图，制作冷锋标签集。冷锋识别获取模块，用于将RGB图像数据集获取模块中的RGB图像数据集和冷锋标签集制作模块中的冷锋标签集输入到DETR模型中进行训练并测试，获得冷锋的识别结果。进一步的，本发明还提出了一种电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现前文所述的一种使用卫星云图识别冷锋的深度学习方法的步骤。进一步的，本发明还提出了一种计算机可读的存储介质，所述计算机可读的存储介质存储有计算机程序，所述计算机程序被处理器运行时执行前文所述的一种使用卫星云图识别冷锋的深度学习方法。本发明采用以上技术方案，与现有技术相比，其显著技术效果如下：本发明能够在对卫星云图进行预处理的基础上实现基于深度学习方法的卫星云图冷锋识别，先对卫星云图进行预处理后放入RGB图像，使用深度学习模型DETR进行冷锋分割的思路，得到了较好的自动化识别结果，有益于现代化天气预报业务中结合卫星云图识别冷锋的自动化，为预报业务提供参考。附图说明图1是本发明的整体实施流程图。图2是本发明实施例中得到的风云二号气象卫星FY-2红外云图、海平面气压图和850hPa温度平流图。图3是本发明对卫星云图做预处理的流程示意图。图4是本发明实施例中得到的初步分割图、分块标记示意图和预处理结果。图5是本发明实施例中通过三种通道放置方法制作的RGB图。图6是本发明实施例中得到的冷锋分析要素图、冷锋粗线条绘制图和冷锋粗线条提取图。图7是本发明实施例中得到的冷锋标签集和对应的图片命名。图8是本发明实施例中得到的冷锋测试结果与冷锋标签集的对比图。图9是本发明实施例中得到的冷锋测试结果分别与风云二号气象卫星FY-2红外云图、850hPa和地面要素场的对应关系图。具体实施方式为详细说明本发明的技术内容、构造特征、所实现目的及效果，以下结合附图和实例对本发明进行详细说明。为实现上述目的，本发明提出了一种使用卫星云图识别冷锋的深度学习方法，如图1所示，提供一种使用卫星云图识别冷锋的深度学习方法，包括以下步骤：S1、获取气象数据，计算850hPa温度平流，绘制卫星云图和气象要素图，如图2所示，具体内容为：S101、下载欧洲中期天气预报中心模式中ERA-5再分析数据，选择海平面气压场、地面10m风场、850hPa温度场和风场的要素，设定空间分辨率为0.25°×0.25°，存储为NetCDF格式；下载国家卫星气象中心风云卫星遥感数据服务网提供的HDF格式的风云二号气象卫星全圆盘标称图像文件；时次选择2005-2022年每日00:00 UTC和12:00 UTC。选择40~160°E、10~66°N范围，计算850hPa温度平流，具体公式为：；其中，u表示850hPa的纬向水平风，v表示850hPa的经向水平风，表示u、v的复合风，x表示纬向，y表示经向，T表示850hPa的温度进行五点平滑100次后的温度值，/＞表示T的梯度。S102、使用单一色图绘制风云二号气象卫星FY-2红外云图、海平面气压图、850hPa温度平流图。得到如图2的所示的风云二号气象卫星FY-2红外云图、如图2的所示的海平面气压图和如图2的所示的850hPa温度平流图，图片大小为，分别存放在“CloudImage”、“Slp”和“Advt”三个文件夹中，色图选择gist_yarg_r，图片保存为JPG格式。S2、对风云二号气象卫星FY-2红外云图进行预处理，如图3所示，具体内容为：S201、将步骤S102中的风云二号气象卫星FY-2红外云图按照8：2分为训练集和验证集，生成存放训练集文件名的train.txt文件和存放验证集文件名的test.txt文件。利用Python的LabelMe工具制作云区域标签，按VOC格式存放。生成对应的注释文件存储为JSON格式，生成Class.txt文件用于说明标签集中物体的类数。将JSON格式的标注文件转换为对应的PNG图片格式，存放在“SegmClass”文件夹中，设置类数为一类，获得红外云图云区域数据集。S202、设置如下训练参数：num_classes=2，input_shape=，Unfreeze_batch_size=2，Init_lr=1e-4，Min_lr=Init_lr*0.01，num_workers=4。在内存为12GB的GPU上训练U-Net模型，直到损失函数曲线收敛后停止，保存权重文件，将步骤S201中的红外云图云区域数据集输入到训练完成的U-Net模型中，得到2017-2019年共2174张初步分割图像，存储为JPG格式。如图4的所示，为2022年5月13日12:00的初步分割图像。S203、读取初步分割图，分别标记出图中各个独立的云区。遍历初步分割图中的每一个格点，若相邻格点的灰度值不为0，则将这些格点判断为相连通的格点，标记相同的数值，继续扩展直至这些格点周围所有不为0的格点都已标记，则得到内部所有格点全部标记为相同数值的连通区域，该连通区域则为独立的云区。得到2017-2019年共2174个云区分块文件，存储为GRD格式。如图4的所示，将2022年5月13日12:00的初步分割图划分出了23个独立区域，用不同颜色表示不同的云区分块结果。S204、读取卫星云图的灰度图和云区分块文件，选定一个时次，读取各个独立云区的位置，将该位置对应到卫星云图的灰度图的格点上，提取每个独立云区的最高灰度值和云区域平均灰度值的平均值作为区域代表灰度值，根据该值落入的灰度值的数值范围和季节基准获取筛选权重。其中，季节基准在一年中12-2月取0.8，3-4月和11月取0.7，5-6月和9-10月取0.6，7-8月取0.5；筛选权重的计算公式为：当G落入；当G落入；当G落入和T.Normalize，设置pretrained=False，num_classes=2，return_postprocessor=True，选择190轮的权重checkpoint0189.pth进行测试，得到2005-2022年卫星云图冷锋数据集。图8展示了在2017年9月18日00:00和12:00识别的冷锋和冷锋标签集的对比，可以看出本发明识别的冷锋在线条的位置和形态上都与标签集的冷锋准确对应。图9展示了2022年5月6日00:00和2021年4月18日00:00的冷锋测试结果，图9的和图9的叠加了风云二号气象卫星FY-2红外云图，图9的和图9的中填色部分表示850hPa冷平流，箭头表示地面10m风场，等值线的实线表示平均海平面气压场，虚线表示850hPa温度场。可以看出本发明识别出的冷锋均与云系相对应，位于850hPa冷平流区前方，大致与850hPa等温线平行，地面图上存在等值线的最大气旋式曲率，锋前后表现出地面10m风从偏北风到偏南风的转向。从图8和图9中可以看出本发明提供的使用卫星云图识别冷锋的深度学习方法能够准确识别冷锋的位置和形态。本发明实施例还提出一种使用卫星云图识别冷锋的深度学习系统，包括数据获取模块、图像预处理模块、RGB图像数据集获取模块、冷锋标签集制作模块、冷锋识别获取模块及可在处理器上运行的计算机程序。需要说明的是，上述系统中的各个模块对应本发明实施例所提供的方法的具体步骤，具备执行方法相应的功能模块和有益效果。未在本实施例中详尽描述的技术细节，可参见本发明实施例所提供的方法。本发明实施例还提出一种电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序。需要说明的是，所述处理器执行所述计算机程序时对应本发明实施例所提供的方法的具体步骤，具备执行方法相应的功能模块和有益效果。未在本实施例中详尽描述的技术细节，可参见本发明实施例所提供的方法。本发明实施例还提出一种计算机可读的存储介质，所述计算机可读的存储介质存储有计算机程序。需要说明的是，所述计算机程序被处理器运行时对应本发明实施例所提供的方法的具体步骤，具备执行方法相应的功能模块和有益效果。未在本实施例中详尽描述的技术细节，可参见本发明实施例所提供的方法。以上详细描述了本发明的较佳具体实施例。应当理解，本领域的普通技术人员无需创造性劳动就可以根据本发明的构思作出诸多修改和变化。因此，凡本技术领域中技术人员依本发明的构思在现有技术的基础上通过逻辑分析、推理或者有限的实验可以得到的技术方案，皆应在由权利要求书所确定的保护范围内。
