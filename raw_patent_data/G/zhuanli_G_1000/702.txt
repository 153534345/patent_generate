标题title
用于确定血管中心线的方法、计算设备和介质
摘要abst
本公开提供了一种用于确定血管中心线的方法、计算设备和介质，其中包括：接收血管的三维模型数据并将所接收的三维模型数据转换为点云集合；在所述点云集合中确定无效点和包括结尾点、连接点和分叉点的有效点；基于所述结尾点、连接点和分叉点，确定主血管路径和相对于所述主血管路径的分支血管路径；以及确定所述主血管路径和分支血管路径的中心点，对所述中心点执行拟合平滑，从而确定主血管路径和分支血管路径的中心线。
权利要求书clms
1.一种用于确定血管中心线的方法，其中包括：接收血管的三维模型数据并将所接收的三维模型数据转换为点云集合；在所述点云集合中确定无效点和包括结尾点、连接点和分叉点的有效点；基于所述结尾点、连接点和分叉点，确定主血管路径和相对于所述主血管路径的分支血管路径；以及确定所述主血管路径和分支血管路径的中心点，对所述中心点执行拟合平滑，从而确定主血管路径和分支血管路径的中心线。2.根据权利要求1所述的方法，其中确定所述主血管路径和分支血管路径的中心点包括：确定两点之间的最小曲率阈值以及最小间距阈值；从所述主血管路径和分支血管路径上的连接点中提取满足所确定的最小曲率阈值以及最小间距阈值的特征点；以所述特征点为基点，确定在切面上垂直于所述特征点且位于所述血管上的多个血管周长点；以及确定所述多个血管周长点相对的中心点，从而将所述中心点确定为所述主血管路径和分支血管路径的中心点。3.根据权利要求2所述的方法，其中确定在切面上垂直于所述特征点且位于所述血管上的多个血管周长点包括：确定特征点在所述主血管路径和分支血管路径上的切面方向；以及以所述特征点为基点，沿多个平行与所述切面方向的方向向外扩张，以对所述血管的三维模型数据执行体素检索。4.根据权利要求3所述的方法，其中确定在切面上垂直于所述特征点且位于所述血管上的多个血管周长点还包括：基于体素检索和预定义的阈值，确定所述三维模型数据中所述血管在所述切面方向上的边界位置；以及基于所确定的多个边界位置，确定在切面上垂直于所述特征点且位于所述血管上的多个血管周长点。5.根据权利要求2所述的方法，其中确定所述多个血管周长点相对的中心点包括：对所述多个血管周长点的坐标的平均值进行计算，从而确定所述多个血管周长点相对的中心点。6.一种计算设备，包括：至少一个处理器；以及至少一个存储器，所述至少一个存储器被耦合到所述至少一个处理器并且存储用于由所述至少一个处理器执行的指令，所述指令当由所述至少一个处理器执行时，使得所述计算设备执行根据权利要求1至5中任一项所述的方法的步骤。7.一种计算机可读存储介质，其上存储有计算机程序代码，所述计算机程序代码在被运行时执行如权利要求1至5中任一项所述的方法。
说明书desc
技术领域本发明概括而言涉及医学图像处理领域，更具体地，涉及一种用于确定血管中心线的方法、计算设备和计算机可读存储介质。背景技术动脉瘤、动脉血栓、动脉夹层、动脉狭窄等疾病，医生需要进行EVER，TEVER是由荷兰计算机科学家狄克斯特拉于1959年提出的算法，是从一个顶点到其余各顶点的最短路径算法，解决的是有权图中最短路径问题。迪杰斯特拉算法主要原理是从起始点开始，采用贪心算法的策略，每次遍历到始点距离最近且未访问过的顶点的邻接节点，直到扩展到终点为止。深度优先搜索算法是一种用于遍历、搜索树或图的一种搜索算法。搜索的灵感顾名思义：先递归下去，再回溯上来。意思是说，当人们需要在图、搜索树或者遍历中搜索某个对象时，DFS会首先一路走到底，直到不能再下，如果找到了对象，就返回，没有找到就回溯到上一步的地方，然后换一条路继续重复以上过程直到找到对象或者找遍所有对象为止。贝塞尔曲线是应用于图形应用程序的数学曲线，由一组称为控制点的向量来确定，给定的控制点按顺序连接构成控制多边形，贝塞尔曲线逼近这个多边形，进而通过调整控制点坐标改变曲线的形状。通过贝塞尔曲线，在不改变输入中心点集原有趋势形态的情况下，可以得到平滑的曲线。图2示出了根据本发明的一些实施例的用于确定血管中心线的方法200的流程图。方法200例如可以由图1中所示的系统1中的操作台10或另一计算设备执行。以下以在操作台10中执行为例，结合图1至图8对方法200进行描述。在步骤202中，可以接收血管的三维模型数据并将所接收的影像数据转换为点云集合。在一个实施例中，可以使用三维医学影像数据，如CT或MRI的三维模型数据，并将其转换为点云形式，以便后续的处理。这可以通过图像处理和计算几何学方法实现。具体来说，可以使用三维骨架提取算法提取三维立体图像的骨架点集，将其等同于点云集合。三维骨架提取算法的核心原理为迭代进行图像腐蚀操作，向图像中轴位置缩小图像，直到图像只剩下骨架。为保证得到正确的中心点数据，此图像腐蚀操作必须对称进行。决策树方法是迭代处理个像素点邻域内中目标和背景体素所有可能的二进制组合，并在每次迭代时找到所有可删除的表面点，其中，其中N为大于等于2的自然数，例如当n等于3时，算法讲计算像素点周围26个邻域像素。此算法的输入为二值化图像，对于体素值为1的体素为目标区域，体素值为0的体素为背景区域。经过数次迭代计算，输出1个体素格的点云图像。通过以上技术手段，可以利用三维骨架提取算法输出为未标记处理的点云图像，对于点云图像进行像素点的提取、分类和处理，得到节点和邻边的集合。例如，基于血管三维模型数据M1，通过成熟的骨架化算法得到可以展示粗略的血管中心线轨迹的点云集合M2。在步骤204中，可以在所述点云集合中确定无效点和包括结尾点、连接点和分叉点的有效点。在一个实施例中，可以通过点云集合中的几何特征，识别并排除无效点，如噪声或异常值。确定有效点，其中可能包括结尾点、连接点和分叉点。在所述点云集合中确定无效点和包括结尾点、连接点和分叉点的有效点包括：具体来说，可以确定所述三维模型数据中非0像素值的像素点，从而计算所述像素点相对邻域个像素点的非0像素值的像素点的个数，其中，其中N为大于等于2的自然数；响应于像素点相对邻域个非0像素值的像素点的个数为0时，将所述像素点确定为无效点；响应于像素点相对邻域个像素点的非0像素值的像素点的个数为1时，将所述像素点确定为有效点中的结尾点；响应于像素点相对邻域个像素点的非0像素值的像素点的个数为2时，将所述像素点确定为有效点中的连接点；以及响应于像素点相对邻域个像素点的非0像素值的像素点的个数大于2时，将所述像素点确定为有效点中的分叉点。例如当N等于3时，响应于像素点相对邻域26个非0像素值的像素点的个数，利用以上技术手段，可以对点云集合M2中的非0像素值的像素点进行分类，计算出像素点的邻域26个像素点中非0像素值的像素点的个数。响应于个数为0时，舍弃该像素点；个数为1时，将所述像素点记为结尾点P3；响应于个数为2时，将所述像素点记为连接点P1；响应于个数大于2时，将所述像素点记为分叉点P2。在步骤206中，可以基于所述结尾点、连接点和分叉点，确定主血管路径和相对于所述主血管路径的分支血管路径。在一个实施例中，通过分析有效点的空间位置关系，建立血管的拓扑结构。结合结尾点、连接点和分叉点的信息，确定主血管路径和相对于主血管路径的分支血管路径。这可以通过图论和拓扑学方法实现。基于迪杰斯特拉算法和深度优先搜索算法的最短路径规划算法可以通过自定义的起始点和终点，从节点和邻边的集合中得到目标中心线的最优路径。同时，自动从目标中心线路径中提取新的下级分支血管中心线起点，基于上述的最短路径规划算法从节点和邻边的集合中得到满足一定条件的分支血管中心线路径。下文将具体介绍确定主血管路径的方法和相对于所述主血管路径的分支血管路径的方法。在步骤208中，可以确定所述主血管路径和分支血管路径的中心点，对所述中心点执行拟合平滑，从而确定主血管路径和分支血管路径的中心线。在一个实施例中，对主血管路径和分支血管路径的中心点执行拟合平滑操作，以获得血管中心线。这可以通过使用曲线拟合算法，如贝塞尔曲线拟合或样条曲线拟合来实现。基于中心线路径，提取满足一定条件的特征点，重新计算垂直于该点的血管周长点，计算周长点的中心点，作为新的特征点位置。最后用贝塞尔曲线对特征点组成的折线进行平滑，得到光滑的曲线数据，从而确定主血管路径和分支血管路径的中心线。下文将具体介绍确定所述主血管路径和分支血管路径的中心点的方法。图3示出了根据本发明的一些实施例的用于确定主血管路径的方法300的流程图。方法300例如可以由图1中所示的系统1中的操作台10或另一计算设备执行。在步骤302中，可以以所述分叉点为起点，将所述结尾点或分叉点与相对邻域个像素点中的结尾点、连接点和分叉点连接。在一个实施例中，可以将在方法200中获取的结尾点P3和分叉点P2的像素点标记为节点N，从而得到节点数据集setN。以结尾点P3或分叉点P2为起始点，连接领域26个像素点中的连接点P1、分叉点P2和结尾点P3，重复连接动作直到连接到结尾点P3或分叉点P2为终点。在步骤304中，可以重复所述连接直到连接到结尾点或作为终点的分叉点，从而获取点与点相连接的邻边。在一个实施例中，可以基于连接获取点与点相连接的邻边E。通过将所有连接点P1、分叉点P2和结尾点P3都连接为不重复的、不区分方向的邻边数据，可以得到邻边数据集setE。通过以上步骤将点云数据M2转换为有计算价值的数据。在步骤306中，可以基于选定的起始位置和结束位置，确定所述邻边上的起始点和结束点。在一个实施例中，可以由用户选定主血管路径的起点和终点。通过用户输入的主血管路径的起始位置Pstart和结束位置Pend，从像素点集setN中寻找距离最近的节点Nstart和Nend，作为邻边上的起始点和结束点。在步骤308中，可以基于最短路径规划算法，确定通过所述邻边从起始点到结束点的最短路径，从而将所述最短路径确定为主血管路径。在一个实施例中，可以基于诸如迪杰斯特拉算法和深度优先搜索算法的最短路径规划算法，在点集setN和临边集setE范围内计算起始点Nstart到结束点Nend的最短路径Cmain，从而将所述最短路径确定为主血管路径。图4示出了根据本公开实施例的最短路径规划算法的示意图。如图4所示，本公开采用基于迪杰斯特拉算法和深度优先搜索算法改进的搜索血管最短路径的最短路径规划算法。以图4中包括节点A、B、C、D、F、E及与节点相接的邻边作为血管的拓扑模型。假设每个相邻节点之间邻边的距离为1，当前需要寻找从B为起始点的最短路径规划。首先，确定血管的起点和结尾点，随机确定一条路径。例如，首先通过深度有限搜索算法，随机得到一条路径B-C-D-F并存储，记录每个节点与起始点B的距离。随后在所确定的路径上从结尾点开始依次向上遍历每个有效点，反向搜索路径距离，以确定潜在路径，例如在随机的路径上返回到上一个分叉节点D，排除已访问的节点F，通过记录的距离判断，B-C-D-C和B-C-D-B均不满足最短距离条件，不能为潜在路径，同时此方法避免了节点重复被访问。最后基于最短距离条件，将潜在路径中距离最短的路径确定为最优的路径，从而确定为血管最短路径。例如，再回到上一个分叉节点C，排除已访问的节点D，B-C-B不满足最短距离条件，排除以上节点，并且获取满足条件的B-C-E路径。再返回起始点B，排除已访问节点C，存储满足条件的B-A路径，B-D路径通过D已记录的最短距离判断，此路径为更优最短路径，从已存储的路径中寻找是否存在带有节点D的路径：若存在，更新该已存储路径中B-....-D部分为B-D，同时更新后续路径节点所记录的最短距离，不再记录向下层访问搜索，在此例子中，存储的路径B-C-D-F更新为B-D-F路径；若不存在，则继续向下层访问搜索，从而确定为血管最短路径。图5示出了根据本发明的一些实施例的用于确定分支血管路径的方法500的流程图。方法500例如可以由图1中所示的系统1中的操作台10或另一计算设备执行。在步骤502中，可以确定所述主血管路径上的所有分叉点，从而将所述所有分叉点作为分支血管路径的候选起始点。在一个实施例中，可以提取在方法300中获取的中心血管路径中被确定为分叉点P2的所有节点，从而得到节点集合SetNbranchstart，节点集合SetNbranchstart中的所有节点作为分支血管中心线路径的候选起始点。在步骤504中，可以基于所述候选起始点，执行分支血管路径检索算法，以确定与主血管路径相连接的分支血管路径。在一个实施例中，可以基于诸如迪杰斯特拉算法和深度优先搜索算法的最短路径规划算法，在点集setN和临边集setE范围内，分别计算每个以分支血管节点集合中的所有节点为起始点，结尾点P3为结束点的所有可能的分支血管的最短路径的候选集合SetCbranch。随后对候选集合中的每个候选分支血管路径SetCbranch执行候选分支血管路径检索算法。候选分支血管路径检索算法包括：基于最短路径规划算法，确定以所述候选起始点为起点并以所述结尾点为终点的多个最短路径，以作为候选分支血管路径。基于分支血管路径的最小长度阈值、分支血管最大周长阈值以及分支血管路径的最小角度阈值，筛选出满足阈值条件的候选分支血管路径。具体来说，通过分支血管的医学特征，可以设定最小长度阈值、最大周长阈值和最小角度阈值，并将以上阈值为筛选条件。根据候选分支血管路径SetCbranch中的每条最短路径的长度、最短路径中间偏终点区域的周长和最短路径中的所有邻近三个点角度中的的最小角度与设定条件进行对比，淘汰不满足条件的最短路径。进一步地，将所述满足阈值条件的候选分支血管路径中最小角度值最大的候选分支血管路径确定为分支血管路径。具体来说，在满足条件的候选分支血管路径SetCbranch中，选择最短路径中的所有邻近三个点角度中的最小角度值最大的最短路径作为分支血管的最短的分支血管路径Cbranch。通过这样筛选的分支血管路径Cbranch为最短路径中的最平缓路径。利用以上技术手段，最小长度阈值可排除血管三维模型上的一些干扰的凸起位置所计算出的中心线数据，最大周长阈值可排除瘤体位置所计算出的中心线。这些限制条件排除了血管三维模型和骨架化算法所引起的点云集合M2结果的不准确。在步骤506中，可以在确定与主血管路径相连接的分支血管路径后，确定所述分支血管路径上是否存在所有分叉点。在一个实施例中，重复步骤502和步骤504的计算，直到分支血管起始点集合SetNbranchstart中所有起始节点均被计算。进一步地，还需要判断在步骤504中确定的分支血管路径Cbranch的下游是否存在下级血管，即连接到分支血管路径的分支血管路径。在步骤508中，可以响应于所述分支血管路径上存在所有分叉点，将所述分支血管路径上的所有分叉点确定为候选起始点，重复执行所述分支血管路径检索算法，以确定与所确定的分支血管路径相连接的分支血管路径。在一个实施例中，通过判断分支血管路径Cbranch中是否存在被分类为分叉点类型的节点来执行判断。若存在被分类为分叉点类型的节点，则以分支血管路径Cbranch作为中心线，重复执行所述分支血管路径检索算法，直到所有下级分支血管路径已生成，从而确定与所确定的分支血管路径相连接的分支血管路径。图6示出了根据本发明的一些实施例的用于确定主血管路径和分支血管路径的中心点的方法600的流程图。方法600例如可以由图1中所示的系统1中的操作台10或另一计算设备执行。在步骤602中，可以确定两点之间的最小曲率阈值以及最小间距阈值。在一个实施例中，可以对在方法200、400、500中获取的主血管路径Cmain和每一条主血管路径Cbranch进行进一步计算，从而确定所述主血管路径和分支血管路径的中心点。在步骤604中，可以从所述主血管路径和分支血管路径上的连接点中提取满足所确定的最小曲率阈值以及最小间距阈值的特征点。在一个实施例中，根据在方法200、400、500中获取的路径的三维坐标点集信息，计算在主血管路径Cmain和每一条主血管路径Cbranch上的每个点的曲率。基于最小曲率阈值以及两邻近特征点的最小间距阈值，将主血管路径Cmain和每一条主血管路径Cbranch上的三维坐标点集中满足两个条件之一的点记为特征点，从而得到一组特征点的三维坐标点集信息SetPoint。在步骤606中，可以所述特征点为基点，确定在切面上垂直于所述特征点且位于所述血管上的多个血管周长点。在一个实施例中，可以基于所获取的三维坐标点集信息特征点集SetPoint，计算除两端点外的SetPoint在血管截面上对应于的准确中心点位置，这需要确定在切面上垂直于所述特征点且位于所述血管上的多个血管周长点。具体来说，可以确定特征点在所述主血管路径和分支血管路径上的切面方向。以所述特征点为基点，沿多个平行与所述切面方向的方向向外扩张，以对所述血管的三维模型数据执行体素检索。基于体素检索和预定义的阈值，确定所述三维模型数据中所述血管在所述切面方向上的边界位置。基于所确定的多个边界位置，确定在切面上垂直于所述特征点且位于所述血管上的多个血管周长点。例如，为了确定在切面上垂直于所述特征点且位于所述血管上的多个血管周长点，可以计算SetPoint在血管中的切面方向；再从SetPoint为出发点，沿着X个平行与切面方向的方向对三维模型数据M1进行向外扩张，以对所述血管的三维模型数据执行体素检索。通过体素检索确定所述三维模型数据中所述血管在所述切面方向上的边界位置，即找到三维模型数据M1的边界位置。在步骤608中，可以确定所述多个血管周长点相对的中心点，从而将所述中心点确定为所述主血管路径和分支血管路径的中心点。图7示出了根据本公开的实施例的确定所述主血管路径和分支血管路径的中心点的示意图。在一个实施例中，以X为8为例，代表8个搜索方向，N的值越大，计算的Center位置越准确。可以以特征点SetPoint为圆点，三角形点为通过中心点计算确定的中心点Center，实线不规则圆形状多边形为实际血管切面。虚线圆为以SetPoint为中心点的正圆，虚线圆的半径为搜索范围的最大值，防止中心线因为下级分支血管开口处位置对中心点的位置产生影响。虚线箭头瞄准位置为此搜索方向的血管边界。中心点Center通过这8个搜索方向的边界坐标位置，计算平均值得出。中心点可以是对所述多个血管周长点的坐标的平均值，从而确定所述多个血管周长点相对的中心点。也可以采用诸如多边形确定法、最小二乘法等方法确定多个周长点的平均点，从而将平均点作为中心点。最后对应于方法200中的步骤208，可以应用贝塞尔曲线，保留分支血管折线段集合Smain和每一条分支血管路径集合Sbranch中的每个中心点Center的坐标信息，对分支血管折线段集合Smain和分支血管路径集合Sbranch进行平滑处理，得到光滑且精准的中心线数据中心线集合Lmain和每一条分支血管的路径集合Lbranch。对于主血管路径可以通过类似方法执行拟合平滑，在此不再赘述，从而确定主血管路径和分支血管路径的中心线。利用以上技术手段，可以基于主干中心线的起始和结束点的输入，自动计算出主干中心线，以及下级分支中心线，不需要额外的输入，自动定位和判断。并且中心线数据经过重新校准和平滑处理，位置精准且展示效果好。计算结果区分每条完整的主干和分支中心线数据，可用于后续的计算或分析使用。图8示出了适合实现本发明的实施例的计算设备800的结构方框图。计算设备800例如可以是如上所述的用于执行方法200、400、500、600的操作台10或另一计算设备。如图8中所示，计算设备800可以包括一个或多个中央处理单元810，其可以根据存储在只读存储器820中的计算机程序指令或者从存储单元880加载到随机访问存储器830中的计算机程序指令，来执行各种适当的动作和处理。在RAM 830中，还可存储计算设备800操作所需的各种程序和数据。CPU 810、ROM 820以及RAM 830通过总线840彼此相连。输入/输出接口880也连接至总线840。计算设备800中的多个部件连接至I/O接口880，包括：输入单元860，例如键盘、鼠标等；输出单元870，例如各种类型的显示器、扬声器等；存储单元850，例如磁盘、光盘等；以及通信单元890，例如网卡、调制解调器、无线通信收发机等。通信单元890允许计算设备800通过诸如因特网的计算机网络和/或各种电信网络与其他设备交换信息/数据。上文所描述的方法200、400、500、600例如可由计算设备800的CPU810执行。例如，在一些实施例中，方法200、400、500、600可被实现为计算机软件程序，其被有形地包括于机器可读介质，例如存储单元880。在一些实施例中，计算机程序的部分或者全部可以经由ROM 820和/或通信单元890而被载入和/或安装到计算设备800上。当计算机程序被加载到RAM 830并由CPU 810执行时，可以执行上文描述的方法200、400、500、600的一个或多个操作。此外，通信单元890可以支持有线或无线通信功能。本领域技术人员可以理解，图8所示的计算设备800仅是示意性的。在一些实施例中，计算设备800可以包含更多或更少的部件。以上结合附图对根据本发明的用于确定血管中心线的方法200、400、500、600以及可用作操作台10或另一计算设备的计算设备800进行了描述。然而本领域技术人员可以理解，方法200、400、500、600的步骤及其子步骤的执行并不局限于图中所示和以上所述的顺序，而是可以以任何其他合理的顺序来执行。此外，计算设备800也不必须包括图8中所示的所有组件，其可以仅仅包括执行本发明中所述的功能所必须的其中一些组件，并且这些组件的连接方式也不局限于图中所示的形式。本发明可以是方法、装置、系统和/或计算机程序产品。计算机程序产品可以包括计算机可读存储介质，其上载有用于执行本发明的各个方面的计算机可读程序指令。在一个或多个示例性设计中，可以用硬件、软件、固件或它们的任意组合来实现本发明所述的功能。例如，如果用软件来实现，则可以将所述功能作为一个或多个指令或代码存储在计算机可读介质上，或者作为计算机可读介质上的一个或多个指令或代码来传输。本文公开的装置的各个单元可以使用分立硬件组件来实现，也可以集成地实现在一个硬件组件，如处理器上。例如，可以用通用处理器、数字信号处理器、专用集成电路、现场可编程门阵列或其它可编程逻辑器件、分立门或者晶体管逻辑、分立硬件组件或用于执行本文所述的功能的任意组合来实现或执行结合本发明所描述的各种示例性的逻辑块、模块和电路。本领域普通技术人员还应当理解，结合本发明的实施例描述的各种示例性的逻辑块、模块、电路和算法步骤可以实现成电子硬件、计算机软件或二者的组合。本发明的以上描述用于使本领域的任何普通技术人员能够实现或使用本发明。对于本领域普通技术人员来说，本发明的各种修改都是显而易见的，并且本文定义的一般性原理也可以在不脱离本发明的精神和保护范围的情况下应用于其它变形。因此，本发明并不限于本文所述的实例和设计，而是与本文公开的原理和新颖性特性的最广范围相一致。
