标题title
一种实现ZNS固态硬盘加密功能的方法
摘要abst
本申请提供了一种实现ZNS固态硬盘加密功能的方法，在进行加解密算法之前，基于ZNS固态硬盘各分区Zone的读写频率，将Zone分区分为Zone冷区和Zone热区，Zone热区为读写频率次数&gt;动态读写频次临界值，动态读写频次临界值为固态硬盘分区的总读写次数的均方根；ZNS固态硬盘进行读写操作时，仅访问Zone冷区，而不对Zone热区进行数据调用；且在Zone冷区的所有分区都进行完读写操作后，根据命令集对ZNS固态硬盘所有分区进行扫描操作，重新分配Zone冷区和Zone热区；在下一轮读写操作中同样地仅访问Zone冷区，降低ZNS固态硬盘频繁读写造成的固件损坏。
权利要求书clms
1.一种ZNS固态硬盘的加解密方法，其特征在于, 在进行加解密算法之前，基于ZNS固态硬盘各分区Zone的读写频率，将Zone分区分为Zone冷区和Zone热区，Zone热区为读写频率次数＞动态读写频次临界值，动态读写频次临界值为固态硬盘分区的总读写次数的均方根；Zone冷区为固态硬盘中Zone热区以外的区域；ZNS固态硬盘进行读写操作时，直接访问Zone冷区，而不对Zone热区进行数据调用；且在Zone冷区的所有分区都进行完读写操作后，根据命令集对ZNS固态硬盘所有分区进行扫描操作，重新分配Zone冷区和Zone热区；并将重新分配的Zone冷区设置自己的ZD和ZDE区域，所述ZD为ZONE Descriptor，所述ZDE为ZONE DESCRIPTOR EXTEND；并将新的Zone热区中存在的ZD和ZDE区域停止物理地址分配；每一次动态更新数据后的Zone热区和Zone冷区的逻辑区域与物理分区映射关系表都存储在某一Zone冷区ZDE中。2.根据权利要求1所述的一种ZNS固态硬盘的加解密方法，其特征在于，在进行IO前，Nand flash IO的控制算法判断是否读写锁定；如果已锁定则需要先解锁，然后才能正常IO。3.根据权利要求2所述的一种ZNS固态硬盘的加解密方法，其特征在于，需要加密时，命令参数询问需加密的Zone分区是否有附加ZDE；如果分区没有ZDE扩展区域，则需要对该分区Zone增加ZDE，保存加密信息；如果有附加ZDE时，按照命令参数更新ZDE数据到对应的ZDE。4.根据权利要求3所述的一种ZNS固态硬盘的加解密方法，其特征在于，使用Zone管理命令设置valid， write_ctrl和read_ctrl字段值，并提供与该字段匹配password；当设置valid为0，则加密功能不生效，此时write_ctrl，read_ctrl，无论为何值，Zone上的IO操作，不受加密功能影响，可正常进行读写操作。5.根据权利要求4所述的一种ZNS固态硬盘的加解密方法，其特征在于，当前valid为非0时，则加密功能生效，write_ctrl控制Zone的写入操作，当write_ctrl为非0时，则不能写入；为0时，则可以写入；当前valid为非0时，则加密功能生效，read_ctrl控制Zone的读取操作，当read_ctrl为非0时，则不能读取；为0时，则可以读取。6.根据权利要求1所述的一种ZNS固态硬盘的加解密方法，其特征在于，对已加密的Zone进行IO时需要先解密，根据Zone管理命令，确定用户是否有权限或者密码是否匹配；用户有权限，如当前用户如果为root或者owner，则可以不需要提供password即可进行解密操作；用户密码正确，匹配通过，则通过设置write_ctrl，read_ctrl为0，可以完成解密操作；若用户无权限且用户密码不匹配时，则返回错误提示，解密不成功，不能读取加密数据；IO完成后，要恢复到原来的非零值。7.根据权利要求1所述的一种ZNS固态硬盘的加解密方法，其特征在于，IO结束后再恢复时，记录当前Zone的ZDE的write_ctrl，read_ctrl值，使用Zone管理命令确定密码是否匹配，匹配通过，则通过设置write_ctrl，read_ctrl为0，完成解密操作，用户可以进行读写操作；使用Zone管理命令确定密码是否匹配，匹配不通过，不能完成解密操作，用户返回错误并拒绝进行读写操作，同时恢复设置write_ctrl，read_ctrl为非零值。
说明书desc
技术领域本发明一种固态硬盘存储领域，具体的涉及一种实现ZNS固态硬盘加密功能的方法。背景技术目前，随着NAND闪存的价格逐渐降低，固态硬盘的数量逐年增加。 与传统硬盘不同，固态硬盘的存储单元是NAND闪存。对于NAND闪速存储器存储数据的能力，数据读取错误更可能随着PE的数量、数据读取的数量和数据存储时间的推移而增加，因此使得错误处理成为SSD的重要部分。在重试表中的大量读取数据增加了整个错误恢复流程所消耗的时间，并且降低了硬盘的数据读取效率。在ZNS架构中SSD设备对HOST提供了读写接口，HOST可以按照规则对SSD进行读写。当需要对某些Zone的读写进行权限控制时，就需要额外的管理，ZNS协议中还并没有相关规定。发明内容本发明的目的是解决Zone读写权限控制的需求。通过密码对相应的Zone进行加密使其访问权限可以控制，防止非意料意外的应用对ZONE进行操作，提升SSD数据安全性。具体地，本发明申请提供一种ZNS固态硬盘的加解密方法，其特征在于, 在进行加解密算法之前，基于ZNS固态硬盘各分区Zone的读写频率，将Zone分区分为Zone冷区和Zone热区，Zone热区为读写频率次数＞动态读写频次临界值，动态读写频次临界值为固态硬盘分区的总读写次数的均方根；Zone冷区为固态硬盘中Zone热区以外的区域；ZNS固态硬盘进行读写操作时，直接访问Zone冷区，而不对Zone热区进行数据调用；且在Zone冷区的所有分区都进行完读写操作后，根据命令集对ZNS固态硬盘所有分区进行扫描操作，重新分配Zone冷区和Zone热区；并将重新分配的Zone冷区设置自己的ZD和ZDE区域；并将新的Zone热区中存在的ZD和ZDE区域停止物理地址分配；每一次动态更新数据后的Zone热区和Zone冷区的逻辑区域与物理分区映射关系表都存储在某一Zone冷区ZDE中。进一步地，在进行IO前，Nand flash IO的控制算法判断是否读写锁定；如果已锁定则需要先解锁，然后才能正常IO。进一步地，需要加密时，命令参数询问需加密的Zone分区是否有附加ZDE；如果分区没有ZDE扩展区域，则需要对该分区Zone增加ZDE，保存加密信息；如果有附加ZDE时，按照命令参数更新ZDE数据到对应的ZDE。进一步地，使用Zone管理命令设置valid, write_ctrl, read_ctrl等字段值，并提供与该字段匹配password；当设置valid为0，则加密功能不生效，此时write_ctrl,read_ctrl，无论为何值，Zone上的IO操作，不受加密功能影响，可正常进行读写操作。进一步地，当前valid为非0时，则加密功能生效，write_ctrl控制Zone的写入操作，当write_ctrl为非0时，则不能写入；为0时，则可以写入；当前valid为非0时，则加密功能生效，read_ctrl控制Zone的读取操作，当read_ctrl为非0时，则不能读取；为0时，则可以读取。进一步地，对已加密的Zone进行IO时需要先解密，根据Zone管理命令，确定用户是否有权限或者密码是否匹配；用户有权限，如当前用户如果为root或者owner，则可以不需要提供password即可进行解密操作；用户密码正确，匹配通过，则通过设置write_ctrl，read_ctrl为0，可以完成解密操作；若用户无权限且用户密码不匹配时，则返回错误提示，解密不成功，不能读取加密数据；IO完成后，要恢复到原来的非零值。进一步地，IO结束后再恢复时，记录当前Zone的ZDE的write_ctrl，read_ctrl值，使用Zone管理命令确定密码是否匹配，匹配通过，则通过设置write_ctrl，read_ctrl为0，完成解密操作，用户可以进行读写操作；使用Zone管理命令确定密码是否匹配，匹配不通过，不能完成解密操作，用户返回错误并拒绝进行读写操作，同时恢复设置write_ctrl，read_ctrl为非零值。本发明的有益效果：动态设置ZNS固态硬盘Zone冷区和Zone热区；每一次动态更新数据后的Zone热区和Zone冷区的逻辑区域与物理分区映射关系表重新更新在Zone冷区ZDE中，实现ZNS固态硬盘实时读写操作时只访问Zone冷区，避免对Zone热区进行高频次的读写操作造成的固件坏损；在冷区访问时，设定加解密数据结构和流程实现ZNS固态硬盘度的访问控制，提升ZNS固体硬盘的安全性；同时提供解密控制流程，减少对固态硬盘读写性能的额外影响。附图说明为了更清楚地说明本申请实施例或相关技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本申请的实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据提供的附图获得其他的附图。本说明书附图所绘示的结构、比例、大小等，均仅用以配合说明书所揭示的内容，以供熟悉此技术的人士了解与阅读，并非用以限定本申请可实施的限定条件，故不具技术上的实质意义，任何结构的修饰、比例关系的改变或大小的调整，在不影响本申请所能产生的功效及所能达成的目的下，均应仍落在本申请所揭示的技术内容得能涵盖的范围内。图1为本申请实施例的Zone进行加密的算法流程示意图。图2为本申请实施例的加密功能开启时，IO操作的流程控制示意图。图3为本申请实施例的Zone进行解密的处理流程示意图。图4为本申请实施例的解密功能开启时，IO结束后的恢复流程示意图。具体实施方式下面将结合本申请实施例中的附图，对本申请中的实施例进行清楚、完整地描述，显然，所描述的实施例仅仅是本申请一部分实施例，而不是全部的实施例。基于本申请中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本申请保护的范围。本发明是ZNS固态硬盘中Zone读写权限管理相关的功能，作用于Zone读写操作之前，有别于Zone状态机对于读写的限制。本发明在Zone读写操作之前，有密码控制，可以进行加密和解密。使用到ZDE，将用到的数据结构放在ZDE中保存。本发明在固态硬盘中实现Zone加密和解密算法。在进行加解密算法之前，基于ZNS固态硬盘各分区Zone的读写频率，将Zone分区分为Zone冷区和Zone热区。Zone热区为读写频率次数＞动态读写频次临界值的物理地址区域的动态集合，动态读写频次临界值为固态硬盘分区的总读写次数的均方根。Zone冷区为固态硬盘中Zone热区以外的区域。ZNS固态硬盘进行读写操作时，直接访问Zone冷区，而不对Zone热区进行数据调用。每个Zone冷区都有自己的ZD，在各Zone冷区中附加设置ZDE区域，也就是说ZDE扩展区域对应的物理地址区域是固定的区域，利于中的ZDE区域数据存储与调用。逻辑区域映射关系表存储在ZDE区域中，且加密和解密U-KEY数据存储在ZDE区域。这样可以避免对Zone热区进行高频次的读写操作，造成ZNS固态硬盘部分Zone过度读写操作造成坏损。值得说明的是，Zone冷区的所有分区都进行完读写操作后，根据命令集对ZNS固态硬盘所有分区进行扫描操作，重新分配Zone冷区和Zone热区；并将重新分配的Zone冷区设置自己的ZD和ZDE区域；并将新的Zone热区中存在的ZD和ZDE区域停止物理地址分配。每一次动态更新数据后的Zone热区和Zone冷区的逻辑区域与物理分区映射关系表都存储在某一Zone冷区ZDE中。对冷区进行读写操作时，本发明申请提出一种ZNS固态硬盘的访问控制方法，包括相关的数据结构和对应的控制算法。一、数据结构设计，包括字段：tag, size, valid, password, write_ctrl,read_ctrl, rsvd；具体含义分别如表1所示：表1数据结构字段设计与释义tag数据结构标识字段，设置为0xA8A8。size按照ZNS功能协议ZDE大小以64 Bytes为单位，所以此字段也为64。user_id记录此Zone的拥有者用户ID。valid为非0值时，表示加密功能生效，write_ctrl和read_ctrl生效；为0时，则加密功能不生效。password加密功能的密码，当需要修改数据结构中的字段时，需要提供与此匹配的密码，其中valid，write_ctrl,read_ctrl是可修改字段。write_ctrl为非0值，表示当前Zone不可写入，为0时则反之。可理解为write_lock,当写锁生效时，则不可写。加锁和解锁操作需要host提供匹配的password。read_ctrl为非0值，表示当前Zone不可读取，为0时则反之。可理解为read_lock,当读锁生效时，则不可读。加锁和解锁操作需要host提供匹配的password。rsvd保留字段，要确保整个结构提大小满足64 Bytes。二、数据保存在ZDE中每个Zone冷区都有自己的ZD，同时，可以指定是否有附加ZDE。对为需要加密的Zone增加ZDE，保存加密信息。三、访问控制流程SSD固态硬盘中，Nand flash IO时需要增加控制算法，在进行IO前需要判断，是否读写锁定。如果已锁定则需要先解锁，然后才能正常IO。四、加密每个Zone都有自己的ZD，需要加密时，命令参数询问需加密的分区是否有附加ZDE。如果分区没有ZDE扩展区域，则需要对该分区Zone增加ZDE，保存加密信息。附图1 为本申请实施例的Zone进行加密的算法流程示意图 ，加密功能ZDE开始设置时，询问分区Zone管理命令，该分区是否有附加的ZDE扩展区域。对应所需加密的Zone分区存在ZDE时，按照命令参数更新ZDE数据到对应的ZDE的扩展区域；应所需加密的Zone分区不存在ZDE时，对该分区新增ZDE，并按照命令参数设置ZDE数据。附图2为加密功能开启时，IO操作的流程控制图；使用Zone管理命令设置valid,write_ctrl, read_ctrl等字段值，并提供与该字段匹配password。当设置valid为0，则加密功能不生效，此时write_ctrl,read_ctrl，无论为何值，Zone上的IO操作，不受加密功能影响，可正常进行读写操作。当前valid为非0时，则加密功能生效，write_ctrl控制Zone的写入操作，当write_ctrl为非0时，则不能写入。为0时，则可以写入。当前valid为非0时，则加密功能生效，read_ctrl控制Zone的读取操作，当read_ctrl为非0时，则不能读取。为0时，则可以读取。五、解密附图3为本申请实施例的Zone进行解密的处理流程示意图；对已加密的Zone进行IO时需要先解密，根据Zone管理命令，确定用户是否有权限或者密码是否匹配。用户有权限，如当前用户如果为root或者owner，则可以不需要提供password即可进行解密操作；用户密码正确，匹配通过，则通过设置write_ctrl，read_ctrl为0，可以完成解密操作。若用户无权限且用户密码不匹配时，则返回错误提示，解密不成功，不能读取加密数据。IO完成后，要恢复到原来的非零值。如果需要进行连续较长时间的IO，可以设置valid的为0，任务完成后，再将valid恢复到原来的非零值。这样可以避免重复解密、加密动作。加密的Zone进行IO时需要先进行解密，IO结束后再恢复的流程示意图为附图4所示：记录当前Zone的ZDE的write_ctrl，read_ctrl值，使用Zone管理命令确定密码是否匹配，匹配通过，则通过设置write_ctrl，read_ctrl为0，完成解密操作，用户可以进行读写操作；使用Zone管理命令确定密码是否匹配，匹配不通过，不能完成解密操作，用户返回错误并拒绝进行读写操作，同时恢复设置write_ctrl，read_ctrl为非零值。六、上电加载SSD固态硬盘在各分区Zone加载ZD时同步加载对应的ZDE。七、下电保存下点时，ZD和ZDE都保存到flash中。本说明书中各个实施例采用递进、或并列、或递进和并列结合的方式描述，每个实施例重点说明的都是与其他实施例的不同之处，各个实施例之间相同相似部分互相参见即可。对于实施例公开的装置而言，由于其与实施例公开的方法相对应，所以描述的比较简单，相关之处参见方法部分说明即可。需要说明的是，在本申请的描述中，需要理解的是，术语“上”、“下”、“顶”、“底”、“内”、“外”等指示的方位或位置关系为基于附图所示的方位或位置关系，仅是为了便于描述本申请和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本申请的限制。当一个组件被认为是“连接”另一个组件，它可以是直接连接到另一个组件或者可能同时存在居中设置的组件。还需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种物品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括上述要素的物品或者设备中还存在另外的相同要素。对所公开的实施例的上述说明，使本领域专业技术人员能够实现或使用本申请。对这些实施例的多种修改对本领域的专业技术人员来说将是显而易见的，本文中所定义的一般原理可以在不脱离本申请的精神或范围的情况下，在其它实施例中实现。因此，本申请将不会被限制于本文所示的这些实施例，而是要符合与本文所公开的原理和新颖特点相一致的最宽的范围。
