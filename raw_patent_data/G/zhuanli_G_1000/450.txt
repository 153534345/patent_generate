标题title
基于图像处理的果树靶标自动识别方法及系统
摘要abst
本发明涉及图像处理技术领域，公开了基于图像处理的果树靶标自动识别方法及系统，方法包括：S1：获取果树图像；S2：得到预处理后的图像；S3：对预处理后的图像进行判断，若预处理后的图像为第一图像类型则进入S4，若为第二图像类型则进入S5；S4：输入至第一深度学习模型，分割得到果树的树冠图像；S5：输入至第二深度学习模型，分割得到果树的树冠图像；S6：根据S4或S5得到的所述果树的树冠图像作为靶标。本发明首先对采集的果树图像进行分类，对图像中只包含一个果树树冠的图像和包含多个果树树冠的图像分别采用卷积神经网络模型或采用YOLOV3模型自动识别，提高了果树靶标自动识别的准确度。
权利要求书clms
1.基于图像处理的果树靶标自动识别方法，其特征在于，包括如下步骤：S1：通过摄像装置获取果树图像；S2：对所述果树图像进行预处理，得到预处理后的图像，所述预处理包括对所述果树图像进行灰度转换、降噪、图像增强，所述预处理后的图像为依次经过灰度转换、降噪和图像增强的图像；S3：对所述预处理后的图像进行判断，若所述预处理后的图像为第一图像类型则进入S4，若为第二图像类型则进入S5；其中，所述第一图像类型为：采集的图像中仅包含有一个果树树冠的图像；所述第二图像类型为：采集的图像中含有多于一个果树树冠的图像；S4：将所述预处理后的图像输入至第一深度学习模型，分割得到所述果树的树冠图像；S5：将所述预处理后的图像输入至第二深度学习模型，分割得到所述果树的树冠图像；S6：根据所述S4或所述S5得到的所述果树的树冠图像作为靶标，指导自动喷药装置对所述靶标进行自动喷药。2.根据权利要求1所述的基于图像处理的果树靶标自动识别方法，其特征在于，在所述S2中，所述灰度转换包括：采用OpenCV软件对所述果树图像进行灰度转换，得到灰度转换后的图像；所述降噪处理包括：采用均值滤波法对所述灰度转换后的图像进行降噪，得到降噪后的图像；所述图像增强包括：对所述降噪后的图像进行图像增强，得到图像增强后的图像。3.根据权利要求2所述的基于图像处理的果树靶标自动识别方法，其特征在于，所述均值滤波法具体为：计算所述灰度转换后的图像中像素点的邻域像素平均值代替所述像素点，得到去除高频噪声的降噪后的图像，所述均值滤波的公式为：，其中，为均值滤波后的图像，代表像素邻域，为邻域内的所有像素，为模板系数，采用3×3的模板。4.根据权利要求2所述的基于图像处理的果树靶标自动识别方法，其特征在于，对所述降噪后的图像进行图像增强的具体步骤为：S21：采用傅里叶变换对所述降噪后的图像进行频域转换，得到频域图像；S22：将所述频域图像输入至低通滤波器中，获取药物散播形成的频域图像；S23：将所述S21中获取的频域图像减去所述S22中所述药物散播形成的频域图像，得到图像增强后的图像。5.根据权利要求4所述的基于图像处理的果树靶标自动识别方法，其特征在于，在所述S22中，通过统计药物散播形成的图像的频率分布确定所述低通滤波器的截止频率。6.根据权利要求1所述的基于图像处理的果树靶标自动识别方法，其特征在于，在所述S4中，所述第一深度学习模型为卷积神经网络模型，所述卷积神经网络模型包括：输入层I、卷积层C1、采样层S1、卷积层C2、采样层S2、输出层O；所述输入层用于输入所述图像增强后的图像，两个所述卷积层均用于采用可训练的卷积核对所述图像增强后的图像进行卷积操作，两个所述采样层均用于对输入的特征图进行采样操作，所述输出层用于分类并输出分类结果。7.根据权利要求6所述的基于图像处理的果树靶标自动识别方法，其特征在于，两个所述卷积层的计算公式均为：，，其中，表示第/＞层的第/＞个特征地图的卷积输出，表示第/＞层的第/＞个输入特征地图，表示连接第/＞层的第/＞个输入特征地图和第/＞个特征地图的卷积核，表示第/＞层的第/＞个特征地图的偏置，表示激活函数，表示第/＞层的第/＞个输出特征地图。8.根据权利要求1所述的基于图像处理的果树靶标自动识别方法，其特征在于，在所述S5中，所述第二深度学习模型为YOLOV3模型，所述YOLOV3模型包括：Darknrt53层和ResNet层；所述Darknrt53层包括52个卷积层和1个最大池化层；所述ResNet层包括跳过连接层、双线性插值的上采样层、特征融层和检测图输出层。9.基于图像处理的果树靶标自动识别系统，使用如权利要求1-8任一项所述的基于图像处理的果树靶标自动识别方法，其特征在于，包括如下模块：预处理模块：用于对果树图像进行预处理，得到预处理后的图像，并上传；判断模块：与所述预处理模块连接，用于接收并判断所述预处理后的图像为第一图像类型或是第二图像类型，并上传；云服务器：与所述判断模块连接，用于运行第一深度学习模型和第二深度学习模块，若接收第一图像类型则输入至所述第一深度学习模型，若接收第二图像类型则输入至所述第二深度学习模型；所述云服务器还用于将所述第一深度学习模型和所述第二深度学习模块的输出图像作为靶标传输至自动喷药装置。
说明书desc
技术领域本发明涉及图像处理技术领域，具体涉及基于图像处理的果树靶标自动识别方法及系统。背景技术果园的病虫害预防和诊治工作一直以来是果树种植行业研究的重点。现如今对于果树大规模的病虫害防治手段仍然以向病变虫害区域喷洒农药的化学防治为主。近年来，无人操控自主喷雾机器人开始应用在果树药物喷洒领域。无人自主喷雾机器人能够实现精准指向性喷雾的前提是具有可靠的感知系统，使其能够准确识别出靶标并向其喷洒农药，同时区分出不应当施药的非靶标，避免向非靶标喷洒。而果树靶标实时探测是保证果园喷雾机器人精准作业的重要前提之一。目前，被广泛用于靶标探测的技术包括：激光雷达探测、超声波探测、红外线探测、机器视觉技术等，例如，中国发明专利公开了一种靶标识别方法，根据靶标图像的成像效果特点，基于图像直方图对图像进行灰度变换，可以有效区分目标与背景，并且保留信号边缘，比各类二值化算法适应性更高；通过中值滤波能够在少量损失信号的边缘的情况下剔除噪点，可有效剔除轮廓干扰，并且滤波算法速度快，能够以较低的资源消耗达到有效的滤波效果，从而为后续的轮廓提取、筛选提供了高质量的输入图像。然而，上述方案仅粗略的对靶标进行识别，导致识别准确度较低，因此，现有技术亟需一种识别准确度的基于图像处理的果树靶标自动识别方法及系统。发明内容本发明的目的在于提供基于图像处理的果树靶标自动识别方法及系统，以解决现有技术中的对靶标进行识别准确度较低问题。为解决上述技术问题，本发明具体提供下述技术方案：基于图像处理的果树靶标自动识别方法，包括如下步骤：S1：通过摄像装置获取果树图像；S2：对所述果树图像进行预处理，得到预处理后的图像，所述预处理包括对所述果树图像进行灰度转换、降噪、图像增强，所述预处理后的图像为依次经过灰度转换、降噪和图像增强的图像；S3：对所述预处理后的图像进行判断，若所述预处理后的图像为第一图像类型则进入S4，若为第二图像类型则进入S5；其中，所述第一图像类型为：采集的图像中仅包含有一个果树树冠的图像；所述第二图像类型为：采集的图像中含有多于一个果树树冠的图像；S4：将所述预处理后的图像输入至第一深度学习模型，分割得到所述果树的树冠图像；S5：将所述预处理后的图像输入至第二深度学习模型，分割得到所述果树的树冠图像；S6：根据所述S4或所述S5得到的所述果树的树冠图像作为靶标，指导自动喷药装置对所述靶标进行自动喷药。作为本发明的一种优选方案，在所述S2中，所述灰度转换包括：采用OpenCV软件对所述果树图像进行灰度转换，得到灰度转换后的图像；所述降噪处理包括：采用均值滤波法对所述灰度转换后的图像进行降噪，得到降噪后的图像；所述图像增强包括：对所述降噪后的图像进行图像增强，得到图像增强后的图像。作为本发明的一种优选方案，所述均值滤波法具体为：计算所述灰度转换后的图像中像素点的邻域像素平均值代替所述像素点，得到去除高频噪声的降噪后的图像，所述均值滤波的公式为：，其中，为均值滤波后的图像，代表像素邻域，为邻域内的所有像素，为模板系数，采用3×3的模板。作为本发明的一种优选方案，对所述降噪后的图像进行图像增强的具体步骤为：S21：采用傅里叶变换对所述降噪后的图像进行频域转换，得到频域图像；S22：将所述频域图像输入至低通滤波器中，获取药物散播形成的频域图像；S23：将所述S21中获取的频域图像减去所述S22中所述药物散播形成的频域图像，得到图像增强后的图像。作为本发明的一种优选方案，在所述S22中，通过统计药物散播形成的图像的频率分布确定所述低通滤波器的截止频率。作为本发明的一种优选方案，在所述S4中，所述第一深度学习模型为卷积神经网络模型，所述卷积神经网络模型包括：输入层I、卷积层C1、采样层S1、卷积层C2、采样层S2、输出层O；所述输入层用于输入所述图像增强后的图像，两个所述卷积层均用于采用可训练的卷积核对所述图像增强后的图像进行卷积操作，两个所述采样层均用于对输入的特征图进行采样操作，所述输出层用于分类并输出分类结果。作为本发明的一种优选方案，两个所述卷积层的计算公式均为：，，其中，表示第/＞层的第/＞个特征地图的卷积输出，表示第/＞层的第/＞个输入特征地图，表示连接第/＞层的第/＞个输入特征地图和第/＞个特征地图的卷积核，表示第/＞层的第/＞个特征地图的偏置，表示激活函数，表示第/＞层的第/＞个输出特征地图。作为本发明的一种优选方案，在所述S5中，所述第二深度学习模型为YOLOV3模型，所述YOLOV3模型包括：Darknrt53层和ResNet层；所述Darknrt53层包括52个卷积层和1个最大池化层；所述ResNet层包括跳过连接层、双线性插值的上采样层、特征融层和检测图输出层。基于图像处理的果树靶标自动识别系统，使用如上述的基于图像处理的果树靶标自动识别方法，包括如下模块：预处理模块：用于对果树图像进行预处理，得到预处理后的图像，并上传；判断模块：与所述预处理模块连接，用于接收并判断所述预处理后的图像为第一图像类型或是第二图像类型，并上传；云服务器：与所述判断模块连接，用于运行第一深度学习模型和第二深度学习模块，若接收第一图像类型则输入至所述第一深度学习模型，若接收第二图像类型则输入至所述第二深度学习模型；所述云服务器还用于将所述第一深度学习模型和所述第二深度学习模块的输出图像作为靶标传输至自动喷药装置。本发明与现有技术相比较具有如下有益效果：本发明根据果园中通过机器视觉技术对果树靶标自动识别时，摄像头采集的果树图像信息可能会存在多个果树的树冠信息，导致人工智能模型识别精度较低的现象，本发明首先对采集的果树图像进行分类，对图像中只包含一个果树树冠的图像采用卷积神经网络模型自动识别果树树冠，对图像中包含多个果树树冠的图像采用YOLOV3模型自动识别出最大的果树树冠作为靶标果树的树冠，极大的提高了果树靶标自动识别的准确度。本发明在采用不同模型识别果树树冠时，在获取训练集时，采用仅有一个树冠的图像作为卷积神经网络模型的数据集，采用有多个树冠的图像作为YOLOV3模型的数据集，使得训练的模型分别更适用于1个树冠的图像和多个树冠的图像的自动识别；进一步提高了果树靶标自动识别的准确度。本发明根据采集的果树图像存在药物散播在空气中对图像中的有用信息造成干扰的情况，采用低频滤波器得到药物散播形成的频域图像，然后采用原始图像减去药物散播形成的频域图像得到增强图像，相较于直接采用高通滤波器获取图像的高频信息对图像增强的方案，可减少图像的高频信息的损失，使得图像增强效果更好。附图说明为了更清楚地说明本发明的实施方式或现有技术中的技术方案，下面将对实施方式或现有技术描述中所需要使用的附图作简单地介绍。显而易见地，下面描述中的附图仅仅是示例性的，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据提供的附图引伸获得其它的实施附图。图1为本发明实施例一所述方法的流程示意图。图2为本发明实施例二所述系统的框架图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。下面首先结合附图对本发明所涉及的概念进行说明。在此需要指出的是，以下对各个概念的说明，仅为了使本发明的内容更加容易理解，并不表示对本发明保护范围的限定；同时，在不冲突的情况下，本发明中的实施例及实施例中的特征可以相互组合。下面将参考附图并结合实施例来详细说明本发明。实施例一：如图1所示，本发明提供了基于图像处理的果树靶标自动识别方法，包括如下步骤：S1：通过摄像装置获取果树图像。本实施例中，所述摄像装置为360°广角摄像头，设置于作业车体上，并至少距离地面高度120cm，所述摄像头可以在自动喷药装置喷药时实时拍摄果树图像。S2：对所述果树图像进行预处理，得到预处理后的图像，所述预处理包括对所述果树图像进行灰度转换、降噪、图像增强，所述预处理后的图像为依次经过灰度转换、降噪和图像增强的图像。具体地，在所述S2中，所述灰度转换包括：采用OpenCV软件对所述果树图像进行灰度转换，得到灰度转换后的图像。由于摄像头输出的图像含有大量颜色信息，在通过人工智能模型自动识别果树靶标数据时存在计算量大，效率低的情况，因此，本实施例首先对获取的果树图像进行灰度转换，得到果树图像的灰度图像。具体地，所述降噪处理包括：采用均值滤波法对所述灰度转换后的图像进行降噪，得到降噪后的图像。摄像头在拍摄图像时，图像在形成或传输过程会产生图像噪声，所产生的图像噪声会干扰图像信息、降低图像质量，因此需要对灰度图像进行降噪处理。由于本实施例中获取的是自动喷药装置工作时的果树图像，难免会存在药物散播在空气中对所述图像中的有用信息造成干扰，因此，需要对图像进行增强操作。所述图像增强包括：对所述降噪后的图像进行图像增强，得到图像增强后的图像。所述均值滤波法具体为：计算所述灰度转换后的图像中像素点的邻域像素平均值代替所述像素点，得到去除高频噪声的降噪后的图像，所述均值滤波的公式为：，其中，为均值滤波后的图像，代表像素邻域，为邻域内的所有像素，为模板系数，采用3×3的模板。对所述降噪后的图像进行图像增强的具体步骤为：S21：采用傅里叶变换对所述降噪后的图像进行频域转换，得到频域图像。S22：将所述频域图像输入至低通滤波器中，获取药物散播形成的频域图像。在所述S22中，通过统计药物散播形成的图像的频率分布确定所述低通滤波器的截止频率。由于空气中药物散播形成的像素信息在频域上多表现为低频信息，因此，可通过使用低频滤波器进行滤波操作，得到药物散播形成的频域图像。S23：将所述S21中获取的频域图像减去所述S22中所述药物散播形成的频域图像，得到图像增强后的图像。由于滤波器的工作原理的影响，且滤波器滤波时处于非理想状态，采用本实施例的步骤相较于直接采用高通滤波器获取图像的高频信息，可减少图像的高频信息的损失，使得图像增强效果更好。S3：对所述预处理后的图像进行判断，若所述预处理后的图像为第一图像类型则进入S4，若为第二图像类型则进入S5。由于果树处于果园中，果树一般均是成排栽重，因此，一般采集的果树图像中有可能存在一个果树树冠或者多个果树树冠；本实施例为了提高果树靶标的识别准确度，对采集的果树图像进行分类，对不同类图像采用不同模型识别；从而提高果树靶标的识别准确度。通过图像比较模块对所述图像增强后的图像进行判断为第一图像类型或者第二图像类型。在所述S3中，所述第一图像类型为：采集的图像中仅包含有一个果树树冠的图像；所述第二图像类型为：采集的图像中含有多于一个果树树冠的图像。S4：将所述预处理后的图像输入至第一深度学习模型，分割得到所述果树的树冠图像。在所述S4中，所述第一深度学习模型为卷积神经网络模型，所述卷积神经网络模型包括：输入层I、卷积层C1、采样层S1、卷积层C2、采样层S2、输出层O；所述输入层用于输入所述图像增强后的图像，所述卷积层用于采用可训练的卷积核对所述图像增强后的图像进行卷积操作，所述采样层用于对输入的特征图进行采样操作，所述输出层用于分类并输出分类结果。两个所述卷积层的计算公式均为：，，其中，表示第/＞层的第/＞个特征地图的卷积输出，表示第/＞层的第/＞个输入特征地图，表示连接第/＞层的第/＞个输入特征地图和第/＞个特征地图的卷积核，表示第/＞层的第/＞个特征地图的偏置，表示激活函数，表示第/＞层的第/＞个输出特征地图。值得强调的是，在对所述卷积神经网络模型训练时，在获取训练集时，采用仅有一个树冠的图像作为所述卷积神经网络模型的数据集，对所述卷积神经网络模型训练，以提高所述卷积神经网络模型对树冠图像的分割准确度。S5：将所述预处理后的图像输入至第二深度学习模型，分割得到所述果树的树冠图像。在所述S5中，所述第二深度学习模型为YOLOV3模型，所述YOLOV3模型包括：Darknrt53层和ResNet层；所述Darknrt53层包括52个卷积层和1个最大池化层；所述ResNet层包括跳过连接层、双线性插值的上采样层、特征融层和检测图输出层。ResNet层可实现在不同尺度上对目标进行提取分类，因此，可用于对复杂目标的图区分类，因此，本实施例选择YOLOV3模型用于对多个树冠的图像进行图像分割，并分割出靶标果树的树冠图像。由于摄像头一般围绕1棵靶标果树进行拍摄，一般采集到的其他影响果树的信息相对该靶标果树面积较小，所述第二深度学习模型得到的树冠图像为所述果树图像中面积最大的树冠图像作为该靶标果树的树冠图像。值得强调的是，在对所述YOLOV3模型训练时，在获取训练集时，采用含有多个树冠的图像作为所述卷积神经网络模型的数据集，对所述YOLOV3模型训练，以提高所述YOLOV3模型对复杂图像的分割准确度。S6：根据所述S4或所述S5得到的所述果树的树冠图像作为靶标，指导自动喷药装置对所述靶标进行自动喷药。本发明根据果园中通过机器视觉技术对果树靶标自动识别时，摄像头采集的果树图像信息可能会存在多个果树的树冠信息，导致人工智能模型识别精度较低的现象，本发明首先对采集的果树图像进行分类，对图像中只包含一个果树树冠的图像采用卷积神经网络模型自动识别果树树冠，对图像中包含多个果树树冠的图像采用YOLOV3模型自动识别出最大的果树树冠作为靶标果树的树冠，极大的提高了果树靶标自动识别的准确度。本发明在采用不同模型识别果树树冠时，在获取训练集时，采用仅有一个树冠的图像作为卷积神经网络模型的数据集，采用有多个树冠的图像作为YOLOV3模型的数据集，使得训练的模型分别更适用于1个树冠的图像和多个树冠的图像的自动识别；进一步提高了果树靶标自动识别的准确度。本发明根据采集的果树图像存在药物散播在空气中对图像中的有用信息造成干扰的情况，采用低频滤波器得到药物散播形成的频域图像，然后采用原始图像减去药物散播形成的频域图像得到增强图像，相较于直接采用高通滤波器获取图像的高频信息对图像增强的方案，可减少图像的高频信息的损失，使得图像增强效果更好。实施例二：如图2所示，基于图像处理的果树靶标自动识别系统，使用如上述的一种基于图像处理的果树靶标自动识别方法，包括如下模块：预处理模块：用于对果树图像进行预处理，得到预处理后的图像，并上传；判断模块：与所述预处理模块连接，用于接收并判断所述预处理后的图像为第一图像类型或是第二图像类型，并上传；云服务器：与所述判断模块连接，用于运行第一深度学习模型和第二深度学习模块，若接收第一图像类型则输入至所述第一深度学习模型，若接收第二图像类型则输入至所述第二深度学习模型；所述云服务器还用于将所述第一深度学习模型和所述第二深度学习模块的输出图像作为靶标传输至自动喷药装置。实施例三：本实施例包括一种计算机可读存储介质，所述计算机可读存储介质上存储有数据处理程序，所述数据处理程序被处理器执行实施例一的一种基于图像处理的果树靶标自动识别方法。本领域技术人员应明白，本文的实施例可提供为方法、装置、或计算机程序产品。因此，本文可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。包括但不限于RAM、ROM、EEPROM、闪存或其他存储器技术、CD-ROM、数字多功能盘或其他光盘存储、磁盒、磁带、磁盘存储或其他磁存储装置、或可以用于存储期望的信息并且可以被计算机访问的任何其他的介质等。此外，本领域普通技术人员公知的是，通信介质通常包含计算机可读指令、数据结构、程序模块或诸如载波或其他传输机制之类的调制数据信号中的其他数据，并且可包括任何信息递送介质。本文是参照根据本文实施例的方法、装置和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。以上所述的实施例及/或实施方式，仅是用以说明实现本发明技术的较佳实施例及/或实施方式，并非对本发明技术的实施方式作任何形式上的限制，任何本领域技术人员，在不脱离本发明内容所公开的技术手段的范围，当可作些许的更动或修改为其它等效的实施例，但仍应视为与本发明实质相同的技术或实施例。
