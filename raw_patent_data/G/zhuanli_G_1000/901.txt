标题title
一种基于改进yolov8的轻量化多环境番茄检测方法
摘要abst
本发明适用于目标检测领域，具体是一种基于改进yolov8的轻量化多环境番茄检测方法，包括：利用引入SimAM注意力机制的yolov8模型主干网络提取数据集图像的特征信息；采用轻量化检测结构Slim‑Neck改进yolov8模型中的neck检测模块，设置新的损失函数SIou，构建基于改进yolov8的目标检测模型；将划分的训练集放入改进的目标检测模型进行训练，得到改进模型，基于模型参数指标，对模型的每个模块进行消融实验，并与Faster‑RCNN、yolov8和yolov5模型进行对比实验，得到最终的番茄检测模型。本发明实现模型的轻量化，在保证了yolov8原本的检测速率的基础上，提高模型的泛化能力和多元环境下番茄检测的精度。
权利要求书clms
1.一种基于改进yolov8的轻量化多环境番茄检测方法，其特征在于，所述方法包括：步骤S101：基于图像采集设备获取原始图像，混合从不同角度、天气条件捕获的图像，创建复杂数据集:步骤S102：对于复杂数据集的图像进行图像增强处理，将图像增强处理后的数据集按照比例划分出训练集、测试集；步骤S103：利用引入SimAM注意力机制的yolov8 模型主干网络提取数据集图像的特征信息；步骤S104：采用轻量化检测结构Slim-Neck改进 yolov8 模型中的neck检测模块，设置新的损失函数SIou，构建基于改进yolov8的目标检测模型；步骤S105：将划分的训练集放入改进的目标检测模型进行训练，得到改进模型，基于模型参数指标，对模型的每个模块进行消融实验，并与Faster-RCNN、yolov8和yolov5模型进行对比实验，得到最终的番茄检测模型。2.根据权利要求1所述的基于改进yolov8的轻量化多环境番茄检测方法，其特征在于，在步骤S101中，将获得的原始数据集进行自适应缩放到640px×640px×3，通过开源应用LabelImg进行标记，创建VOC格式的数据集 以及对应的标签。3.根据权利要求2所述的基于改进yolov8的轻量化多环境番茄检测方法，其特征在于，在步骤S102中的混合数据增强是通过Mosaic、Mixup图像增强的方法联合作用，同时利用合成雾公式扩充数据集，生成得到增强后的数据，具体包括：在 Mosaic方法中：在训练集中随机选择4张图片，将这些照片拼接在一起，然后随机取图中640px×640px的区域作为生成的新图像；在Mixup方法中：分别从两个批次不同的训练集中，随机选择两张图像，并以为参数生成新的图像；Mosaic+Mixup混合增强方法，其原理公式为： ； ；其中，为一个批次样本，/＞为一个批次样本对应的标签；/＞为另一个批次的样本，/＞为另一个批次样本对应的标签；/＞为参数/＞、/＞贝塔分布计算出的混合系数，其公式为： ；其中，B为B分布，、/＞为可调参数；得到数据集/＞及标签；雾气合成公式：； ；其中，表示原始图像中坐标/＞处的像素值；/＞表示添加雾气效果后的图像中坐标/＞处的像素值；/＞表示雾气的明亮度，雾气的明亮度在区间在内，0表示纯黑的雾气，1表示纯白的雾气；/＞表示雾气的厚度，雾气的厚度区间在内，值越大表示雾气越厚；/＞表示像素点/＞到图像中心的距离；/＞表示雾气浓度衰减系数。4.根据权利要求3所述的基于改进yolov8的轻量化多环境番茄检测方法，其特征在于，在步骤S103中，在特征提取主干网络中，加入SimAM注意力机制，无需向原始网络添加参数，而是在一层中推断特征图的3-D关注权重；重新定义神经元的能量函数，然后通过封闭形式解决方案得到参数/＞、/＞，假设单通道中的所有像素遵循相同的分布，进而求得均值/＞、方差/＞和最小能量/＞，通过神经元反应的增益效应获得进一步提取的特征/＞。5.根据权利要求4所述的基于改进yolov8的轻量化多环境番茄检测方法，其特征在于，重新定义神经元的能量函数包括：度量神经元之间的线性可分性，寻找重要神经元；定义如下能量函数： ；其中，,/＞是线性变换，/＞和/＞是输入特征/＞单通道中的目标神经元和其他神经元，/＞是空间维度的索引，/＞是该通道上的神经元数；/＞、/＞是权重和偏差变换；等式中的所有值都是标量；当/＞等于/＞时，等式达到最小值，所有其他/＞是/＞，其中，/＞和/＞是两个不同的值；通过最小化方程，等式等价于找到目标神经元/＞与同一通道中所有其他神经元之间的线性可分性；对和/＞采用二进制标签，并将正则化器添加到等式中，最终的能量函数由下式给出： 。6.根据权利要求5所述的基于改进yolov8的轻量化多环境番茄检测方法，其特征在于，每个通道有M个能量函数；对和/＞有的封闭形式解决方案，通过以下方式获得： 其中，和/＞是在该通道中除/＞外的所有神经元上计算的均值和方差；由于式和式中所示的现有解是在单通道上获得的，因此可以合理地假设单通道中的所有像素遵循相同的分布；鉴于这一假设，均值和方差可以在所有神经元上计算，并重用该通道上的所有神经元，可以显著减少计算成本，避免迭代计算每个位置的/＞和/＞；因此，最小能量可以通过以下方式计算：其中，和/＞；等式表示能量较低的/＞；每个神经元/＞的重要性可以通过1//＞获得；对单个神经元进行操作，并将这种线性可分离性集成到端到端框架中。7.根据权利要求6所述的基于改进yolov8的轻量化多环境番茄检测方法，其特征在于，由注意力机制增强后的特征图：其中，E跨通道和空间维度对所有进行分组，添加sigmoid以限制E中的最大值，sigmoid是一个单调函数。8.根据权利要求7所述的基于改进yolov8的轻量化多环境番茄检测方法，其特征在于，用于对训练集的图像进行特征信息提取的网络包括：第一层标准卷积Conv模块，通道数=64，卷积核大小=3*3，对输入图像进行卷积操作，通道数变为64，特征图缩小为原来的一半；第二层标准卷积模块，通道数=128，卷积核大小=3*3，继续对特征图进行卷积操作，通道数变为128，特征图再次缩小为原来的一半；第三层C2f模块，通道数=128，将不同尺度的特征图进行融合；第四层标准卷积模块，通道数=256，卷积核大小=3*3，再次对特征图进行卷积操作，通道数变为256，特征图再次缩小为原来的一半；第五层C2f模块，通道数=256，对特征图进行进一步融合；第六层标准卷积模块，通道数=512，卷积核大小=3*3，继续对特征图进行卷积操作，通道数变为512，特征图再次缩小为原来的一半；第七层 C2f 模块，通道数=512，对特征图进行进一步融合；第八层标准卷积模块，通道数=512，卷积核大小=3*3，再次对特征图进行卷积操作，通道数变为512，特征图再次缩小为原来的一半；第九层 SPPF 模块，通道数=512，参数=5，执行空间金字塔池化操作，不同尺度上提取特征，从而捕捉到目标物体在不同尺度上的细节信息；第十层 SimAM 模块，通过在一层中推断特征图的3-D关注权重，获得进一步提取的特征。9.根据权利要求8所述的基于改进yolov8的轻量化多环境番茄检测方法，其特征在于，在采用轻量化检测结构Slim-Neck改进 yolov8 模型中的neck检测模块的步骤中，将检测头head的C2f模块替换为VoVGSCSP轻量化网络模块，将Conv改进为GSConv ；其中：在输入图像的空间信息逐步向通道转移的阶段中，利用GSConv的时间复杂度保留通道之间的隐藏连接，GSConv的时间复杂度为： ；其中，W是输出特征图的宽度；H是输出特征图的高度；是卷积核的大小；C1是每个卷积核的通道数，以及输入特征图的通道数，C2是输出特征图的通道数；继续在GSConv的基础上引入GS瓶颈，使用一次性聚合方法设计跨阶段部分网络GSCSP模块VoV-GSCSP；在目标检测网络中：第十一层nn.Upsample层，进行上采样，将特征图的分辨率增加两倍；第十二层 Concat 层，将骨干网络的 P4 特征图与其他特征图连接起来；第十三层 VoVGSCSP 层，通道数为512，对特征图进行处理；第十四层 nn.Upsample层，进行上采样，将特征图的分辨率增加两倍；第十五层 Concat 层，将骨干网络的 P3 特征图与其他特征图连接起来；第十六层 VoVGSCSP 层，通道数为256，对特征图进行处理；第十七层 GSConv 层，通道数为256，卷积核大小：3x3，执行GSConv操作，保留通道之间的连接；第十八层 Concat 层，将头部网络的 P4 特征图与其他特征图连接起来；第十九层 VoVGSCSP 层，通道数为512，对特征图进行处理；第二十层 GSConv 层，通道数为512，卷积核大小：3*3，执行GSConv操作，保留通道之间的连接；第二十一层 Concat 层，将头部网络的 P5 特征图与其他特征图连接起来；第二十二层 VoVGSCSP 层，通道数为512，对特征图进行处理；第二十三层 Detect 层，用于目标检测，生成最终的输出。10.根据权利要求9所述的基于改进yolov8的轻量化多环境番茄检测方法，其特征在于，步骤S104中：SIou损失函数采用角度损失、距离损失、形状损失和IOU损失的线性组合，通过迭代更新网络参数，直至总损失函数达到预设收敛条件，构建基于改进yolov8的目标检测模型；其中：角度损失：如果，收敛过程将首先最小化/＞，否则最小化/＞；引入和定义了LF组件： ；其中，； ； ；距离损失： ；其中：、/＞、/＞，当/＞时，距离损失的贡献大大降低；相反，/＞越接近/＞，距离损失贡献越大；随着角度的增大，问题变得越来越难；/＞被赋予时间优先的距离值，随着角度的增加；形状损失：；其中，，/＞；/＞的值定义了每个数据集的Shape cost及其值是唯一的；/＞的值控制着对Shape cost的关注程度；如果/＞的值设置为 1，它将立即优化一个Shape，从而损害Shape的自由移动；IOU损失：回归损失函数为： ；其中，；总损失函数为：；其中，是焦点损失，而/＞,/＞分别是框权重和分类损失权重；使用遗传算法计算,/＞和/＞的值：首先从训练集种提取一个小子集，随机赋予/＞,/＞和/＞值，计算总函数损失，然后通过遗传算法进行寻优，直到找到适应度值小于阈值或过程超过最大允许迭代，此时，将最终的获得的结果作为参数的最优解。
说明书desc
技术领域本发明属于目标检测技术领域，尤其涉及一种基于改进yolov8的轻量化多环境番茄检测方法。背景技术西红柿是全球最重要的作物之一，具有极高的经济价值和营养重要性。然而，采摘番茄在自然环境中一直是一项高度复杂且劳动密集型的工作，涉及多种复杂的视觉和环境因素。随着人工智能技术的迅速发展，拣选机器人被视为一种有望解决这一挑战的潜在解决方案。叶子的遮挡、成熟度的不同、植株之间的簇生长造成的重叠和光线条件的不稳定性都可能导致番茄的外观特征发生变化，进一步加大对机器人视觉检测系统的挑战。同时，在考虑机器人识别番茄准确率的时候，也要兼顾其检测的速度。因此，改善拣选机器人在自然环境中的目标检测精度、识别帧率和鲁棒性，以适应这些复杂的环境因素，已经成为当前研究领域的一个紧迫而关键的技术问题。现有的提升农业作物目标检测精度、识别帧率和鲁棒性的检测方法可以分为两大类：One-Stage的目标检测法和Two-Stage的目标检测法。前者将目标检测问题直接视为一个单一的回归问题，直接通过卷积神经网络输出目标的类别和位置信息，如中国专利CN116110042A，公开日为2023年05月12日，公开了一种基于YOLOv7的CBAM注意力机制番茄检测方法，采用高斯滤波对数据进行降噪，然后在主干网络加入CBAM其中是焦点损失，而/＞,/＞分别是框权重和分类损失权重；使用遗传算法计算,/＞和/＞的值：首先从训练集种提取一个小子集，随机赋予/＞,/＞和/＞值，计算总函数损失，然后通过遗传算法进行寻优，直到找到适应度值小于阈值或过程超过最大允许迭代，此时，将最终的获得的结果作为参数的最优解。与现有技术相比，本发明的基于改进yolov8的轻量化多环境番茄检测方法的有益效果是：第一，本发明使用Mosaic+Mixup进行混合数据增强和雾气生成算法，增加数据多样性，提高模型的鲁棒性和泛化能力；第二，本发明将 SimAM注意力机制引入到 yolov8 主干网络中，特别是在具有挑战性的差环境下，有效提升模型对关键特征的关注度；第三，本发明采用轻量化检测结构改进 yolov8 模型中的检测模块并且设置新的损失函数注意力机制引入到 yolov8 主干网络中，以提升模型对关键特征的关注度，特别是在具有挑战性的差环境下。然后，采用轻量化检测结构改进 yolov8 模型中的检测模块并且设置新的损失函数，准确率和速度；；其中，为一个批次样本，/＞为一个批次样本对应的标签；/＞为另一个批次的样本，/＞为另一个批次样本对应的标签；/＞为参数/＞、/＞贝塔分布计算出的混合系数，其公式为：；其中B为B分布，、/＞为可调参数；得到数据集/＞及标签；雾气合成公式： ；；其中，表示原始图像中坐标/＞处的像素值；/＞表示添加雾气效果后的图像中坐标/＞处的像素值；/＞表示雾气的明亮度，雾气的明亮度在区间内，0表示纯黑的雾气，1表示纯白的雾气；/＞表示雾气的厚度，通常在区间内，值越大表示雾气越厚；/＞表示像素点/＞到图像中心的距离；/＞表示雾气浓度衰减系数。在步骤S103的特征提取中。在模型的主干网络的最后C2f模块后引入SimAM注意力机制，帮助主干网络更准确地提取特征信息，增加模型的可解释性，即：在主干网络经过原始多个Conv卷积块和C2f模块以及SPPF特征提取后，再经过SimAM注意力机制进行进一步的特征提取，得到特征；具体的，在特征提取主干网络中，加入SimAM注意力机制，无需向原始网络添加参数，而是在一层中推断特征图的3-D关注权重；重新定义神经元的能量函数，然后通过封闭形式解决方案得到参数/＞、/＞，假设单通道中的所有像素遵循相同的分布，进而求得均值/＞、方差/＞和最小能量/＞，通过神经元反应的增益效应获得进一步提取的特征/＞。更进一步的，重新定义神经元的能量函数包括：度量神经元之间的线性可分性，寻找重要神经元；定义如下能量函数：；其中，,/＞是线性变换，/＞和/＞是输入特征/＞单通道中的目标神经元和其他神经元，/＞是空间维度的索引，/＞是该通道上的神经元数；/＞、/＞是权重和偏差变换；等式中的所有值都是标量；当/＞等于/＞时，等式达到最小值，所有其他/＞是/＞，其中，/＞和/＞是两个不同的值；通过最小化这个方程，等式等价于找到目标神经元/＞与同一通道中所有其他神经元之间的线性可分性；对/＞和/＞采用二进制标签，并将正则化器添加到等式中，最终的能量函数由下式给出：。进一步的，每个通道有M个能量函数；对和/＞有的封闭形式解决方案，通过以下方式获得： ；；其中，和/＞是在该通道中除/＞外的所有神经元上计算的均值和方差；由于式和式中所示的现有解是在单通道上获得的，因此可以合理地假设单通道中的所有像素遵循相同的分布；鉴于这一假设，均值和方差可以在所有神经元上计算，并重用该通道上的所有神经元，可以显著减少计算成本，避免迭代计算每个位置的/＞和/＞；因此，最小能量可以通过以下方式计算： ；其中，和/＞；等式表示能量较低的/＞，神经元/＞比周围的神经元更独特，对于视觉处理更重要；每个神经元的重要性可以通过1//＞获得；对单个神经元进行操作，并将这种线性可分离性集成到端到端框架中。进一步得到由注意力机制增强后的特征图： ；其中，E跨通道和空间维度对所有进行分组，添加sigmoid以限制E中的最大值，sigmoid是一个单调函数。进一步的，用于对训练集的图像进行特征信息提取的网络包括：第一层标准卷积Conv模块，通道数=64，卷积核大小=3*3，对输入图像进行卷积操作，通道数变为64，特征图缩小为原来的一半；第二层标准卷积模块，通道数=128，卷积核大小=3*3，继续对特征图进行卷积操作，通道数变为128，特征图再次缩小为原来的一半；第三层C2f模块，通道数=128，将不同尺度的特征图进行融合；第四层标准卷积模块，通道数=256，卷积核大小=3*3，再次对特征图进行卷积操作，通道数变为256，特征图再次缩小为原来的一半；第五层C2f模块，通道数=256，对特征图进行进一步融合；第六层标准卷积模块，通道数=512，卷积核大小=3*3，继续对特征图进行卷积操作，通道数变为512，特征图再次缩小为原来的一半；第七层 C2f 模块，通道数=512，对特征图进行进一步融合；第八层标准卷积模块，通道数=512，卷积核大小=3*3，再次对特征图进行卷积操作，通道数变为1024，特征图再次缩小为原来的一半；第九层 SPPF 模块，通道数=512，参数=5，执行空间金字塔池化操作，不同尺度上提取特征，从而捕捉到目标物体在不同尺度上的细节信息；第十层 SimAM 模块，通过在一层中推断特征图的3-D关注权重，获得进一步提取的特征。进一步的，在步骤 S104中，对模型轻量化处理，为保证的模型的检测速率，将检测头的C2f模块替换为VoVGSCSP轻量化网络模块，将Conv改进为GSConv 来减轻模型的复杂度并保持准确性，减少模型的计算量和参数量。在采用轻量化检测结构Slim-Neck改进 yolov8 模型中的neck检测模块的步骤中，将检测头head的C2f模块替换为VoVGSCSP轻量化网络模块，将Conv改进为GSConv ；其中：在输入图像的空间信息逐步向通道转移的阶段中，利用GSConv的时间复杂度保留通道之间的隐藏连接，GSConv的时间复杂度为：；W是输出特征图的宽度；H是输出特征图的高度；是卷积核的大小；C1是每个卷积核的通道数，以及输入特征图的通道数，C2是输出特征图的通道数；继续在GSConv的基础上引入GS瓶颈，使用一次性聚合方法设计跨阶段部分网络GSCSP模块VoV-GSCSP；在目标检测网络中：第十一层nn.Upsample层，进行上采样，将特征图的分辨率增加两倍；第十二层 Concat 层，将骨干网络的 P4 特征图与其他特征图连接起来；第十三层 VoVGSCSP 层，通道数为512，对特征图进行处理；第十四层nn.Upsample 层，进行上采样，将特征图的分辨率增加两倍；第十五层 Concat 层，将骨干网络的 P3 特征图与其他特征图连接起来；第十六层 VoVGSCSP 层，通道数为256，对特征图进行处理；第十七层 GSConv 层，通道数为256，卷积核大小：3x3，执行GSConv操作，保留通道之间的连接；第十八层 Concat 层，将头部网络的 P4 特征图与其他特征图连接起来；第十九层 VoVGSCSP 层，通道数为512，对特征图进行处理；第二十层 GSConv 层，通道数为512，卷积核大小：3*3，执行GSConv操作，保留通道之间的连接；第二十一层 Concat 层，将头部网络的 P5 特征图与其他特征图连接起来；第二十二层 VoVGSCSP 层，通道数为512，对特征图进行处理；第二十三层 Detect 层，用于目标检测，生成最终的输出。进一步的，步骤S104采用最小化整体损失，在训练过程中，我们首先导入设定的yaml配置文件，然后使用训练数据进行训练，计算损失函数的梯度，并使用下降梯度优化算法来更新网络参数，该过程将一直持续到损失函数达到默认收敛条件。SIoU构建了具有角度惩罚、距离惩罚和形状惩罚的交并比损失；其中，，/＞ ；；距离损失：；其中，，/＞，/＞，当/＞时，距离损失的贡献大大降低；相反，/＞越接近/＞，距离损失贡献越大；随着角度的增大，问题变得越来越难；/＞被赋予时间优先的距离值，随着角度的增加；/＞形状损失：；其中，，/＞；/＞的值定义了每个数据集的Shape cost及其值是唯一的；/＞的值是这个等式中非常重要的一项，它控制着对Shape cost的关注程度；如果/＞的值设置为 1，它将立即优化一个Shape，从而损害Shape的自由移动；IOU损失：回归损失函数为： ；其中，；总损失函数为： ；其中，是焦点损失，而/＞,/＞分别是框权重和分类损失权重；具体的，我们使用遗传算法计算,/＞和/＞的值：首先从训练集种提取一个小子集，随机赋予/＞,/＞和/＞值，计算总函数损失，然后通过遗传算法进行寻优，直到找到适应度值小于阈值或过程超过最大允许迭代，此时，将最终的获得的结果作为参数的最优解。进一步的，步骤S105的模型测试中，将划分的训练集放入到改进的轻量化模型进行训练，得到best.pt权重参数，然后再将验证集进行验证，得到改进模型的平均精度、参数量等指标并且与其他模型进行对比试验和自身消融实验。具体的，在保证硬件等实验配置相同的情况下，先训练出改进模型。采用目标检测类通用的指标平均精度，参数量和召回率、准确率等，对每个模块进行消融实验，然后为保证改进yolov8模型的有效性，与Faster-RCNN、yolov8和yolov5等模型进行对比实验。综上所述，本发明的基于改进yolov8的轻量化多环境番茄检测方法的有益效果是：第一，本发明使用Mosaic+Mixup进行混合数据增强和雾气生成算法，增加数据多样性，提高模型的鲁棒性和泛化能力；第二，本发明将 SimAM注意力机制引入到 yolov8 主干网络中，特别是在具有挑战性的差环境下，有效提升模型对关键特征的关注度；第三，本发明采用轻量化检测结构改进 yolov8 模型中的检测模块并且设置新的损失函数可以是易失性存储器或非易失性存储器，或者可以包括易失性存储器和非易失性存储器两者。作为例子而非限制性的，非易失性存储器可以包括只读存储器、可编程ROM、电可编程ROM、电可擦写可编程ROM或快闪存储器。易失性存储器可以包括随机存取存储器，该RAM可以充当外部高速缓存存储器。作为例子而非限制性的，RAM 可以以多种形式获得，比如同步RAM、动态RAM、同步DRAM、双数据速率SDRAM、增强SDRAM、同步链路DRAM、以及直接Rambus RAM。所公开的方面的存储设备意在包括但不限于这些和其它合适类型的存储器。结合这里的公开所描述的各种示例性逻辑块、模块和电路可以利用被设计成用于执行这类功能的下列部件来实现或执行：通用处理器、数字信号处理器、专用集成电路、现场可编程门阵列或其它可编程逻辑器件、分立门或晶体管逻辑、分立的硬件组件或者这些部件的任何组合。通用处理器可以是微处理器，但是可替换地，处理器可以是任何传统处理器、控制器、微控制器或状态机。处理器也可以被实现为计算设备的组合，例如，DSP和微处理器的组合、多个微处理器、一个或多个微处理器结合DSP和/或任何其它这种配置。以上是本发明公开的示例性实施例，但是应当注意，在不背离权利要求限定的本发明实施例公开的范围的前提下，可以进行多种改变和修改。根据这里描述的公开实施例的方法权利要求的功能、步骤和/或动作不需以任何特定顺序执行。此外，尽管本发明实施例公开的元素可以以个体形式描述或要求，但除非明确限制为单数，也可以理解为多个。应当理解的是，在本文中使用的，除非上下文清楚地支持例外情况，单数形式“一个”旨在也包括复数形式。还应当理解的是，在本文中使用的“和/或”是指包括一个或者一个以上相关联地列出的项目的任意和所有可能组合。上述本发明实施例公开实施例序号仅仅为了描述，不代表实施例的优劣。所属领域的普通技术人员应当理解：以上任何实施例的讨论仅为示例性的，并非旨在暗示本发明实施例公开的范围被限于这些例子；在本发明实施例的思路下，以上实施例或者不同实施例中的技术特征之间也可以进行组合，并存在如上的本发明实施例的不同方面的许多其它变化，为了简明它们没有在细节中提供。因此，凡在本发明实施例的精神和原则之内，所做的任何省略、修改、等同替换、改进等，均应包含在本发明实施例的保护范围之内。
