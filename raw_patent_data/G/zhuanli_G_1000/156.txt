标题title
一种基于深度相机的矩形托盘孔识别方法及系统
摘要abst
本发明属于物料托盘识别技术领域，公开了一种基于深度相机的矩形托盘孔识别方法及系统，通过测量获得托盘孔物理宽度，托盘孔物理高度，两个托盘孔中心距离，设置初始参数，获取深度相机的深度图数据及彩色图数据；将获得的深度图数据及彩色图数据融合为综合灰度图；根据获得的综合灰度图提取图像包含元素的轮廓；采用逐步排除法去除不符合托盘孔特征的轮廓；经过处理后剩余的轮廓作为最终识别得到的托盘孔轮廓，记录轮廓中心物理坐标。本发明提出了深度信息与颜色信息融合为综合灰度信息方法，可以提高光线较暗时的识别正确率。本发明提出了新的自适应阈值设置方法，可以提高远距离时托盘孔的识别精度和正确率。
权利要求书clms
1.一种基于深度相机的矩形托盘孔识别方法，其特征在于，该方法包括：S1、通过测量获得托盘孔物理宽度，托盘孔物理高度/＞，两个托盘孔中心距离/＞，设置初始参数；S2、获取深度相机的深度图数据及彩色图数据；S3、将获得的深度图数据及彩色图数据融合为综合灰度图；S4、根据获得的综合灰度图提取图像包含元素的轮廓；S5、采用逐步排除法去除不符合托盘孔特征的轮廓；S6、经过处理后剩余的轮廓作为最终识别得到的托盘孔轮廓，记录轮廓中心物理坐标。2.根据权利要求1所述基于深度相机的矩形托盘孔识别方法，其特征在于，在步骤S1中，初始参数包括：托盘孔实际物理宽度，托盘孔实际物理高度/＞，两个托盘孔中心实际距离/＞，红色分量加权系数/＞，绿色分量加权系数/＞，蓝色分量加权系数/＞，矩相似度阈值/＞，像素点上限阈值/＞，像素点下限阈值/＞，托盘孔宽度误差阈值/＞，托盘孔高度误差阈值/＞，托盘孔中心距离误差阈值/＞，托盘孔倾角差阈值/＞，灰度抑制阈值/＞，深度上限/＞，深度下限/＞，灰度值加权系数/＞。3.根据权利要求1所述基于深度相机的矩形托盘孔识别方法，其特征在于，在步骤S3中，将获得的深度图数据及彩色图数据融合为综合灰度图，包括：S2.1、将颜色图进行转换得到灰度图颜色分量；S2.2、将深度图进行转换得到灰度图深度分量；S2.3、将得到的灰度值颜色和深度分量进行叠加获得综合灰度图。4.根据权利要求3所述基于深度相机的矩形托盘孔识别方法，其特征在于，将颜色图进行转换得到灰度图颜色分量的公式如下：；式中，为像素/＞对应的灰度值颜色分量，/＞为取整函数，/＞为红色分量加权系数，/＞为绿色分量加权系数，/＞为蓝色分量加权系数，/＞为像素点/＞对应的红色分量，/＞为像素点/＞对应的绿色分量，/＞为像素点/＞对应的蓝色分量；将深度图进行转换得到灰度图深度分量的公式如下：；式中，为像素/＞对应的灰度值深度分量，/＞为像素/＞对应的深度值，为深度值上限，/＞为深度值下限；将得到的灰度值颜色和深度分量进行叠加获得综合灰度图的公式如下：；式中，为像素/＞对应的综合灰度值，/＞为灰度值加权系数。5.根据权利要求1所述基于深度相机的矩形托盘孔识别方法，其特征在于，在步骤S4中，根据获得的综合灰度图提取图像包含元素的轮廓，包括：S4.1、抑制高灰度值点，设置灰度抑制阈值，当像素点大于灰度抑制阈值/＞时，令像素点等于灰度抑制阈值/＞；S4.2、对处理后的图像进行高斯滤波；S4.3、对处理后的图像计算熵；S4.4、确定高阈值、低阈值/＞；S4.5、将高阈值及低阈值/＞作为参数，对步骤S4.2处理后的图像进行轮廓提取。6.根据权利要求5所述基于深度相机的矩形托盘孔识别方法，其特征在于，在步骤S4.3中，对处理后的图像计算熵的公式为：；式中，为综合灰度图像的信息熵，/＞为综合灰度图像中灰度值/＞出现的概率；根据以下公式计算高阈值、低阈值/＞：；；式中，为轮廓提取算法实际使用的高阈值，/＞为自然常数，/＞为综合灰度图像的信息熵，/＞为使用/＞算法计算得到的高阈值，/＞为轮廓提取算法实际使用的低阈值；在步骤S4.5中，将高阈值及低阈值/＞作为参数，对步骤S4.2处理后的图像进行轮廓提取，包括：计算处理后的图像像素点的梯度，计算公式为：；式中，为像素点/＞对应的梯度值，/＞及/＞为像素点/＞对应的/＞方向及/＞方向的梯度分量；计算梯度方向，像素点对应的梯度方向计算公式为：；式中，为像素点/＞的梯度方向，/＞为像素点/＞对应的/＞方向的梯度方向，/＞为像素点/＞对应的/＞方向的梯度方向；利用邻域扫描整幅图像，在邻域内沿像素点/＞的梯度方向判断/＞是否在梯度方向上为最大值，如果不是，则令梯度值/＞，并进行如下判断：如果梯度值，则令梯度值/＞；如果梯度值/＞，则令梯度值；如果/＞，则判断/＞的/＞邻域内是否存在值为255的点，如果存在，则令梯度值/＞，否则，令梯度值/＞；为梯度下限阈值，/＞为梯度上限阈值。7.根据权利要求1所述基于深度相机的矩形托盘孔识别方法，其特征在于，在步骤S5中，采用逐步排除法去除不符合托盘孔特征的轮廓，包括：S5.1、获得各轮廓的最小外包矩形，记录每个最小外包矩形4个顶点的图像坐标；S5.2、计算第个轮廓最小外包矩形内像素点个数/＞，其中，/＞为剩余轮廓数；如果/＞或/＞，则删除对应轮廓；/＞为像素点上限阈值，/＞为像素点下限阈值；S5.3、计算剩余每个轮廓与最小外包矩形的矩相似度/＞，若，则删除对应轮廓；/＞为/＞矩相似度阈值；S5.4、对于剩余的每个轮廓，根据最小外包矩形顶点对应的物理坐标计算轮廓相应的物理宽度/＞和高度/＞，去除不同时满足和/＞的轮廓；/＞为托盘孔宽度误差阈值，为托盘孔高度误差阈值，/＞为托盘孔物理宽度，/＞为托盘孔物理高度；S5.5、对剩余的轮廓进行轮廓匹配，去除匹配失败的轮廓；匹配时计算两个轮廓的中心距离，两个轮廓中心线与相机/＞平面的夹角/＞和/＞；同时满足/＞和的两个轮廓视为匹配成功，匹配成功的轮廓被保留，匹配失败的轮廓被剔除；/＞为两托盘孔中心距离误差阈值，/＞为托盘孔倾角差阈值，/＞为两个托盘孔中心距离；S5.6、对剩余轮廓挑选最佳匹配轮廓，计算每对匹配轮廓的矩相似度，选择/＞矩相似度最小的一对轮廓作为目标轮廓。8.根据权利要求7所述基于深度相机的矩形托盘孔识别方法，其特征在于，在步骤S5.4中，根据最小外包矩形顶点对应的物理坐标计算轮廓相应的物理宽度和高度/＞，计算公式为：；；式中，分别为托盘孔最小外包矩形上、下两边的物理宽度；/＞分别为托盘孔最小外包矩形左、右两边的物理高度；；；；；式中，分别为托盘孔轮廓最小外包矩形四个顶点对应的物理坐标，；对于任一像素点，对应物理坐标/＞的计算公式为：；式中，为图像坐标系下像素位置，/＞为像素/＞对应的深度值，/＞为图像坐标系原点位置，/＞为相机焦距。9.根据权利要求7所述基于深度相机的矩形托盘孔识别方法，其特征在于，两个轮廓的中心距离的计算公式为：；式中，为两个轮廓的中心距离，/＞和/＞分别为/＞轮廓和/＞轮廓最小外包矩形的中心物理坐标；两个轮廓中心线与相机平面的夹角/＞和/＞计算公式为：；；式中，分别为轮廓/＞最小外包矩形左边上、下两个端点的图像坐标，/＞分别为轮廓/＞最小外包矩形左边上、下两个端点的图像坐标。10.一种基于深度相机的矩形托盘孔识别系统，其特征在于，该系统用于对权利要求1~9任意一项所述基于深度相机的矩形托盘孔识别方法进行调控，该系统包括：初始化模块，用于通过测量获得托盘孔物理宽度，托盘孔物理高度/＞，两个托盘孔中心距离/＞，设置初始参数；数据采集模块，用于获取深度相机的深度图数据及彩色图数据；图像融合模块，用于将获得的深度图数据及彩色图数据融合为综合灰度图；轮廓提取模块，用于根据获得的综合灰度图提取图像包含元素的轮廓；轮廓筛选模块，用于采用逐步排除法去除不符合托盘孔特征的轮廓；轮廓匹配模块，用于将经过处理后剩余的轮廓作为最终识别得到的托盘孔轮廓，记录轮廓中心物理坐标。
说明书desc
技术领域本发明属于物料托盘识别技术领域，尤其涉及一种基于深度相机的矩形托盘孔识别方法及系统。背景技术带有矩形孔的物料托盘在工业领域有着广泛应用。随着自动搬运需求日益增加，基于视觉感知技术对物料托盘进行识别及定位需求迫切。深度相机可以获得物体颜色及距离信息，在工业物料托盘识别中得到了广泛应用。目前物料托盘识别方法主要有两大类：一类是机器学习方法，该方法采用人工神经网络等工具通过训练获得待识别托盘的模型，然后通过模型匹配辨识图像中是否存在目标物并获得目标物位置，这种方法不必关心目标物的具体特征，但需要提供大量待识别托盘的图片进行训练，所需时间及人力成本较高、并且计算量较大。另一种是轮廓匹配方法。该方法首先基于深度相机获取的信息识别图像中物体轮廓，然后通过轮廓特征确定是否存在待识别托盘并计算托盘位姿。托盘轮廓易受托盘上方摆放货物的影响，所以这种识别方式对托盘上方货物摆放位置有严格要求。其次，轮廓提取时多采用沿图像水平及竖直方向扫描，这要求相机X平面与托盘摆放物体平面始终保持平行状态，为实现这一点，除对相机安装位置有严格要求外，还要求托盘周围场地的平整度较高，否则车辆行进过程中会产生倾斜导致相机与托盘不严格处于同一平面，这时轮廓扫描会产生较大的误差。再次，轮廓识别受光线影响较大，光线过强或过暗都会导致轮廓信息不足，致使轮廓辨识出现偏差。通过上述分析，现有技术存在的问题及缺陷为：目前基于机器学习的物料托盘识别方法需要提供大量待识别托盘的图片进行训练，所需时间及人力成本较高，对于一般工业领域而言实施难度较大。目前基于轮廓匹配的物料托盘识别方法对物料摆放、相机安装、地面平整度、光线等均有严格要求，很难适应复杂多变的场景及非标准化工业环境。发明内容为克服相关技术中存在的问题，本发明公开实施例提供了一种基于深度相机的矩形托盘孔识别方法及系统，所述技术方案如下：本发明是这样实现的，一种基于深度相机的矩形托盘孔识别方法，包括：S1、通过测量获得托盘孔物理宽度，托盘孔物理高度/＞，两个托盘孔中心距离，设置初始参数；S2、获取深度相机的深度图数据及彩色图数据；S3、将获得的深度图数据及彩色图数据融合为综合灰度图；S4、根据获得的综合灰度图提取图像包含元素的轮廓；S5、采用逐步排除法去除不符合托盘孔特征的轮廓；S6、经过处理后剩余的轮廓作为最终识别得到的托盘孔轮廓，记录轮廓中心物理坐标。在步骤S1中，初始参数包括：托盘孔实际物理宽度，托盘孔实际物理高度/＞，两个托盘孔中心实际距离/＞，红色分量加权系数/＞，绿色分量加权系数/＞，蓝色分量加权系数/＞，/＞矩相似度阈值/＞，像素点上限阈值/＞，像素点下限阈值/＞，托盘孔宽度误差阈值/＞，托盘孔高度误差阈值/＞，托盘孔中心距离误差阈值/＞，托盘孔倾角差阈值/＞，灰度抑制阈值/＞，深度上限/＞，深度下限/＞，灰度值加权系数/＞。在步骤S3中，将获得的深度图数据及彩色图数据融合为综合灰度图，包括：S2.1、将颜色图进行转换得到灰度图颜色分量；S2.2、将深度图进行转换得到灰度图深度分量；S2.3、将得到的灰度值颜色和深度分量进行叠加获得综合灰度图。进一步，将颜色图进行转换得到灰度图颜色分量的公式如下：；式中，为像素/＞对应的灰度值颜色分量，/＞为取整函数，/＞为红色分量加权系数，/＞为绿色分量加权系数，/＞为蓝色分量加权系数，/＞为像素点/＞对应的红色分量，/＞为像素点/＞对应的绿色分量，/＞为像素点/＞对应的蓝色分量；将深度图进行转换得到灰度图深度分量的公式如下：；式中，为像素/＞对应的灰度值深度分量，/＞为像素/＞对应的深度值，/＞为深度值上限，/＞为深度值下限；将得到的灰度值颜色和深度分量进行叠加获得综合灰度图的公式如下：；式中，为像素/＞对应的综合灰度值，/＞为灰度值加权系数。在步骤S4中，根据获得的综合灰度图提取图像包含元素的轮廓，包括：S4.1、抑制高灰度值点，设置灰度抑制阈值，当像素点大于灰度抑制阈值时，令像素点等于灰度抑制阈值/＞；S4.2、对处理后的图像进行高斯滤波；S4.3、对处理后的图像计算熵；S4.4、确定高阈值、低阈值/＞；S4.5、将高阈值及低阈值/＞作为参数，对步骤S4.2处理后的图像进行轮廓提取。在步骤S4.3中，对处理后的图像计算熵的公式为：；式中，为综合灰度图像的信息熵，/＞为综合灰度图像中灰度值/＞出现的概率；根据以下公式计算高阈值、低阈值/＞：；；式中，为轮廓提取算法实际使用的高阈值，/＞为自然常数，/＞为综合灰度图像的信息熵，/＞为使用/＞算法计算得到的高阈值，/＞为轮廓提取算法实际使用的低阈值；在步骤S4.5中，将高阈值及低阈值/＞作为参数，对步骤S4.2处理后的图像进行轮廓提取，包括：计算处理后的图像像素点的梯度，计算公式为：；式中，为像素点/＞对应的梯度值，/＞及/＞为像素点/＞对应的/＞方向及/＞方向的梯度分量；计算梯度方向，像素点对应的梯度方向计算公式为：；式中，为像素点/＞的梯度方向，/＞为像素点/＞对应的/＞方向的梯度方向，/＞为像素点/＞对应的/＞方向的梯度方向；利用邻域扫描整幅图像，在邻域内沿像素点/＞的梯度方向判断/＞是否在梯度方向上为最大值，如果不是，则令梯度值/＞，并进行如下判断：如果梯度值/＞，则令梯度值/＞；如果梯度值/＞，则令梯度值/＞；如果/＞，则判断/＞的/＞邻域内是否存在值为255的点，如果存在，则令梯度值/＞，否则，令梯度值/＞；为梯度下限阈值，/＞为梯度上限阈值。在步骤S5中，采用逐步排除法去除不符合托盘孔特征的轮廓，包括：S5.1、获得各轮廓的最小外包矩形，记录每个最小外包矩形4个顶点的图像坐标；S5.2、计算第个轮廓最小外包矩形内像素点个数/＞，其中，为剩余轮廓数；如果/＞或/＞，则删除对应轮廓；/＞为像素点上限阈值，/＞为像素点下限阈值；S5.3、计算剩余每个轮廓与最小外包矩形的矩相似度/＞，若，则删除对应轮廓；/＞为/＞矩相似度阈值；S5.4、对于剩余的每个轮廓，根据最小外包矩形顶点对应的物理坐标计算轮廓相应的物理宽度和高度/＞，去除不同时满足/＞和/＞的轮廓；/＞为托盘孔宽度误差阈值，/＞为托盘孔高度误差阈值，/＞为测量获得的托盘孔物理宽度，/＞为测量获得的托盘孔物理高度；S5.5、对剩余的轮廓进行轮廓匹配，去除匹配失败的轮廓；匹配时计算两个轮廓的中心距离，两个轮廓中心线与相机/＞平面的夹角/＞和/＞；同时满足和/＞的两个轮廓视为匹配成功，匹配成功的轮廓被保留，匹配失败的轮廓被剔除；/＞为两托盘孔中心距离误差阈值，/＞为托盘孔倾角差阈值，/＞为测量获得的两个托盘孔中心距离；S5.6、对剩余轮廓挑选最佳匹配轮廓，计算每对匹配轮廓的矩相似度，选择/＞矩相似度最小的一对轮廓作为目标轮廓。在步骤S5.4中，根据最小外包矩形顶点对应的物理坐标计算轮廓相应的物理宽度和高度/＞，计算公式为：；；式中，分别为托盘孔最小外包矩形上、下两边的物理宽度；/＞分别为托盘孔最小外包矩形左、右两边的物理高度；；；；；式中，分别为托盘孔轮廓最小外包矩形四个顶点对应的物理坐标，；对于任一像素点，对应物理坐标/＞的计算公式为：；式中，为图像坐标系下像素位置，/＞为像素/＞对应的深度值，/＞为图像坐标系原点位置，/＞为相机焦距。进一步，两个轮廓的中心距离的计算公式为：；式中，为两个轮廓的中心距离，/＞和/＞分别为/＞轮廓和/＞轮廓最小外包矩形的中心物理坐标；两个轮廓中心线与相机平面的夹角/＞和/＞计算公式为：；；式中，分别为轮廓/＞最小外包矩形左边上、下两个端点的图像坐标，/＞分别为轮廓/＞最小外包矩形左边上、下两个端点的图像坐标。本发明的另一目的在于提供一种基于深度相机的矩形托盘孔识别系统，该系统用于对所述基于深度相机的矩形托盘孔识别方法进行调控，该系统包括：初始化模块，通过测量获得托盘孔物理宽度，托盘孔物理高度/＞，两个托盘孔中心距离/＞，设置初始参数；数据采集模块，用于获取深度相机的深度图数据及彩色图数据；图像融合模块，用于将获得的深度图数据及彩色图数据融合为综合灰度图；轮廓提取模块，用于根据获得的综合灰度图提取图像包含元素的轮廓；轮廓筛选模块，用于采用逐步排除法去除不符合托盘孔特征的轮廓；轮廓匹配模块，用于将经过处理后剩余的轮廓作为最终识别得到的托盘孔轮廓，记录轮廓中心物理坐标。结合上述的所有技术方案，本发明所具备的优点及积极效果为：本发明提出了一种基于深度相机的矩形托盘孔识别方法，解决了矩形托盘孔的识别及定位问题。本发明的矩形托盘孔识别方法不需识别整个托盘，而是直接识别托盘上的两个矩形托盘孔；托盘孔内嵌于托盘侧面，其与周围物体之间存在明显边界，所以深度相机获取的托盘孔轮廓不受托盘上方物体的干扰；其次，托盘孔内部被托盘外壳遮挡，不易受光线影响，可以降低光线波动对托盘孔识别的干扰；再次，托盘孔中心距离比托盘宽度小，可以降低对相机视场角的需求。目前已有专利主要是对工业托盘进行识别，鲜有托盘孔直接识别技术，所以本发明对矩形托盘孔的特征确定，特征计算、特征识别流程等均为首次提出。本发明只对托盘孔进行识别，识别过程不易受光线及托盘上货物的干扰，可避免识别过程出现较大的误差。本发明提出了深度信息与颜色信息融合为综合灰度信息方法，可以提高光线较暗时的识别正确率。同时，本发明提出了新的自适应阈值设置方法，可以提高远距离时托盘孔的识别精度。本发明提出了基于逐步删除法的托盘孔识别流程，识别过程不需考虑托盘的摆放位置。作为本发明的权利要求的创造性辅助证据，还体现在以下几个重要方面：自动搬运必将在普通工业领域得到广泛应用，而可靠、稳定的托盘识别及定位技术是实现自动搬运的基础环节。目前来说，一辆应用于普通工业领域的智能搬运车造价约30万元，目标识别模块造价约占总成本的10%，就化工行业来说，截至2022年底，全国规模以上化工企业共计28760家，这些化工企业均有物料自动搬运需求，按每个企业配置2辆自动搬运车计算，自动搬运车的市场规模约为172亿元，目标识别模块造价约为17.2亿元左右，本发明的技术方案转化后市按照在化工企业市占率15%计算，市场规模约为2.6亿元。按照10%的收益率计算，本发明在化工行业的预期收益可达0.26亿元，考虑到本发明也可推广到其他行业，所以，预期收益将会更高。目前托盘识别技术在标准化程度较高的装卸领域得到了广泛应用。但在一般过程工业领域应用还较少，主要是由于不同工业企业的装卸操作区别较大，很难做到标准化。本发明主要针对过程工业领域的托盘特点，在非标准化场合实现托盘的精确识别和定位，目前国内过程工业领域尚无此项技术。本发明解决了过程工业领域一种常用托盘的高精度识别和定位，为该领域物料自动搬运技术的推广及应用提供了有利的支撑。此外，本发明所述的识别方法计算量小，1秒钟可实现5~8帧动态图片的识别，在识别效率上优于机器学习算法，也可避免机器学习方法中的样本采集、标注等繁冗工作。目前托盘识别研究主要是针对标准化场景。识别的主流方法是先识别托盘轮廓，然后再确定托盘孔位置。这种方法可以快速减小待识别区域，从而减小计算量。但该方法对物料在托盘上的摆放位置有严格要求。本发明直接对托盘孔进行识别，与主流方法相比，直接识别托盘孔难度更大，但本发明可以解决托盘孔识别的难点问题，并且识别结果可以不受托盘轮廓的影响，对托盘上物料摆放位置没有严格要求，可以适应各种非标准化的场景。工业领域自动搬运需求巨大，且工业场景各不相同，很难实现标准化。所以，本发明所提方案对于过程工业领域的非标准化自动搬运过程有较大的应用价值。附图说明此处的附图被并入说明书中并构成本说明书的一部分，示出了符合本公开的实施例，并与说明书一起用于解释本公开的原理；图1是本发明实施例提供的基于深度相机的矩形托盘孔识别方法流程图；图2是本发明实施例提供的相机坐标系下托盘孔与相机平面的投影关系示意图；图3是本发明实施例提供的托盘孔倾角及中心距离示意图；图4是本发明实施例提供的通过特征对比去除非托盘孔轮廓的流程图；图5是本发明实施例提供的轮廓匹配流程图；图6是本发明实施例提供的场景1中颜色直接转换得到的灰度图；图7是本发明实施例提供的场景1中颜色和深度叠加得到的综合灰度图；图8是本发明实施例提供的场景1中提取到的轮廓图；图9是本发明实施例提供的场景1中最终识别出的托盘孔轮廓；图10是本发明实施例提供的场景2中颜色直接转换得到的灰度图；图11是本发明实施例提供的场景2中颜色和深度叠加得到的综合灰度图；图12是本发明实施例提供的场景2中提取到的轮廓图；图13是本发明实施例提供的场景2中最终识别出的托盘孔轮廓；图14是本发明实施例提供的场景3中颜色直接转换得到的灰度图；图15是本发明实施例提供的场景3中颜色和深度叠加得到的综合灰度图；图16是本发明实施例提供的场景3中提取到的轮廓图；图17是本发明实施例提供的场景3中最终识别出的托盘孔轮廓；图18是本发明实施例提供的场景4中颜色直接转换得到的灰度图；图19是本发明实施例提供的场景4中颜色和深度叠加得到的综合灰度图；图20是本发明实施例提供的场景4中提取到的轮廓图；图21是本发明实施例提供的场景4中最终识别出的托盘孔轮廓；图22是本发明实施例提供的场景5中颜色直接转换得到的灰度图；图23是本发明实施例提供的场景5中颜色和深度叠加得到的综合灰度图；图24是本发明实施例提供的场景5中提取到的轮廓图；图25是本发明实施例提供的场景5中最终识别出的托盘孔轮廓；图26是本发明实施例提供的场景6中颜色直接转换得到的灰度图；图27是本发明实施例提供的场景6中颜色和深度叠加得到的综合灰度图；图28是本发明实施例提供的场景6中提取到的轮廓图；图29是本发明实施例提供的场景6中最终识别出的托盘孔轮廓；图30是本发明实施例提供的场景7中颜色直接转换得到的灰度图；图31是本发明实施例提供的场景7中颜色和深度叠加得到的综合灰度图；图32是本发明实施例提供的场景7中提取到的轮廓图；图33是本发明实施例提供的场景7中最终识别出的托盘孔轮廓；图34是本发明实施例提供的场景8中颜色直接转换得到的灰度图；图35是本发明实施例提供的场景8中颜色和深度叠加得到的综合灰度图；图36是本发明实施例提供的场景8中提取到的轮廓图；图37是本发明实施例提供的场景8中最终识别出的托盘孔轮廓；图38是本发明实施例提供的场景9中颜色直接转换得到的灰度图；图39是本发明实施例提供的场景9中颜色和深度叠加得到的综合灰度图；图40是本发明实施例提供的场景9中提取到的轮廓图；图41是本发明实施例提供的场景9中最终识别出的托盘孔轮廓；图42是本发明实施例提供的场景10中颜色直接转换得到的灰度图；图43是本发明实施例提供的场景10中颜色和深度叠加得到的综合灰度图；图44是本发明实施例提供的场景10中提取到的轮廓图；图45是本发明实施例提供的场景10中最终识别出的托盘孔轮廓；图46是本发明方法与FAST-RCNN方法在不同下的识别成功率对比图；图47是本发明方法与FAST-RCNN方法在不同下的识别时间对比图。具体实施方式为使本发明的上述目的、特征和优点能够更加明显易懂，下面结合附图对本发明的具体实施方式做详细的说明。在下面的描述中阐述了很多具体细节以便于充分理解本发明。但是本发明能够以很多不同于在此描述的其他方式来实施，本领域技术人员可以在不违背本发明内涵的情况下做类似改进，因此本发明不受下面公开的具体实施的限制。本发明与现有技术的区别主要在于：本发明提出了托盘孔直接识别方法；本发明提出了适应托盘孔的特点的彩色图与深度图融合方法；本发明提出了一种新的自适应阈值设置方法；本发明确定了矩形托盘孔识别的关键物理特征；本发明基于相机成像原理推导出了不依赖于托盘位姿的轮廓特征计算方法；本发明提出了逐步剔除非托盘孔轮廓的方法及流程。实施例1，如图1所示，本发明实施例提供的基于深度相机的矩形托盘孔识别方法包括以下步骤：S1、通过测量获得托盘孔物理宽度，托盘孔物理高度/＞，两个托盘孔中心距离，设置初始参数；S2、获取深度相机的深度图数据及彩色图数据；S3、将获得的深度图数据及彩色图数据融合为综合灰度图；S4、根据获得的综合灰度图提取图像包含元素的轮廓；S5、采用逐步排除法去除不符合托盘孔特征的轮廓；S6、经过处理后剩余的轮廓作为最终识别得到的托盘孔轮廓，记录轮廓中心物理坐标。作为优选，本发明步骤S3具体包含以下过程：S301、将颜色图进行转换得到灰度图颜色分量的公式如下：；式中，为像素/＞对应的灰度值颜色分量，/＞为取整函数，/＞为红色分量加权系数，优选值为0.299；/＞为绿色分量加权系数，优选值为0.587；/＞为蓝色分量加权系数，优选值为0.114；/＞为像素点/＞对应的红色分量，/＞为像素点/＞对应的绿色分量，/＞为像素点/＞对应的蓝色分量；公式为彩色图转换为灰度图的常规方法，的典型值为：。S302、将深度图进行转换得到灰度图深度分量，公式如下：；式中，为像素/＞对应的灰度值深度分量，/＞为像素/＞对应的深度值，/＞为深度值上限，/＞为深度值下限；公式是本发明针对托盘孔特点提出了灰度转换方法，由于托盘孔内部是空的，所以其内部深度值大于外部深度值；公式使得深度值与其转换后的灰度值分量成反比，即深度值越大，转换后的灰度值分量越小。该转换方法使得托盘孔外侧的灰度值高于内部，可有效提升托盘孔周围的亮度，从而解决光线较暗时托盘孔与周围暗色背景的耦合问题。S303、将得到的灰度值颜色和深度分量进行叠加获得综合灰度图，公式如下：；式中，为像素/＞对应的综合灰度值，/＞为灰度值加权系数。公式是本发明针对托盘孔特点提出的综合灰度计算公式，由公式计算得到的灰度值将作为后续轮廓识别的基础数据。这样做有两个优点：一是将颜色、深度等信息转换为综合灰度信息后，数据量大幅减少，可提高数据处理的效率，降低数据处理对硬件的需求；二是将深度及颜色信息融入综合灰度信息可更有效地突出托盘孔边缘，解决光线较暗时托盘边缘难以识别的问题。公式中，可根据光线情况确定，当托盘孔周围光线较暗时，可适当减小/＞，反之，可适当增大/＞。作为优选，本发明步骤S4具体包含以下过程：S401、抑制高灰度值点，设置灰度抑制阈值，当像素点大于灰度抑制阈值时，令像素点等于/＞；由于托盘孔灰度值较低，通过抑制高灰度值点可以去除背景中高亮元素干扰；S402、对处理后的图像进行高斯滤波；S403、对处理后的图像计算熵，公式为：；式中，为综合灰度图像的信息熵，/＞为综合灰度图像中灰度值/＞出现的概率；S404、确定高阈值、低阈值/＞；；；式中，为轮廓提取算法实际使用的高阈值，/＞为自然常数，/＞为使用算法计算得到的高阈值，/＞为轮廓提取算法实际使用的低阈值；S405、将高阈值及低阈值/＞作为参数，对步骤S4.2处理后的图像进行轮廓提取。首先，计算处理后的图像像素点的梯度，计算公式为：；式中，为像素点/＞对应的梯度值，/＞及/＞为像素点/＞对应的/＞方向及/＞方向的梯度分量；其次，计算梯度方向，像素点对应的梯度方向计算公式为：；式中，为像素点/＞的梯度方向，/＞为像素点/＞对应的/＞方向的梯度方向，/＞为像素点/＞对应的/＞方向的梯度方向；最后，利用邻域扫描整幅图像，在邻域内沿像素点/＞的梯度方向判断是否在梯度方向上为最大值，如果不是，则令/＞，并进行如下判断：如果，则令/＞；如果/＞，则令/＞；如果，则判断/＞的/＞邻域内是否存在值为255的点，如果存在，则令/＞，否则，令/＞。对于上述提取算法而言，轮廓提取的效果与高阈值设置密切相关，/＞越小轮廓分割越精细，/＞越大轮廓分割越粗糙。一般图像比较简单时可以采用较大的/＞值，而图像较复杂时采用较小的/＞值。搬运车辆行驶过程中，相机采集的图像是实时变化的，所以必须根据图像的变化实时调整/＞才能保证轮廓识别的效果。目前常规的自适应阈值设置方法一般采用OTSU算法，该算法主要思想是通过类间方差最大化来确定/＞。这种/＞自适应方法能够满足大多数场景的需求，但对于非常小的轮廓提取效果欠佳。对托盘孔识别而言，当托盘距离相机较近时，使用OSTU算法确定/＞值能够满足轮廓分割要求，但当托盘距离相机较远时，托盘孔在图像中占比非常小，采用OTSU算法确定的/＞偏大，轮廓提取不够精细，导致无法精确提取托盘孔轮廓。为解决此问题，本发明提出了一种基于OSTU的改进型/＞值自适应确定方法）。一般情况下，相机距离托盘较远时，由于没有托盘遮挡，相机视野比较开阔，采集的图像包含元素较多，图像比较复杂，而当相机距离托盘较近时，托盘在图像中占比较大，其它元素占比减少，图像包含的元素相对简单，所以可以根据图像包含元素的复杂程度来判断相机距离托盘的远近。信息熵是衡量图像复杂程度的指标之一，当/＞较大时说明图像比较复杂，反之说明图像比较简单。所以，在公式中用/＞对/＞值进行修正。相机距离托盘较远时，/＞较大，/＞较小，此时/＞显著小于/＞，当相机距离托盘较近时，较大，此时/＞接近/＞。由于/＞的范围为0~1，所以/＞的理论范围为：。通过公式确定阈值，有助于提高复杂场景下轮廓分割的精细程度，这对于远距离托盘孔识别是有利的。作为优选，本发明步骤S5具体包含以下过程：S501、获得各轮廓的最小外包矩形，记录每个最小外包矩形4个顶点的图像坐标；S502、计算第个轮廓最小外包矩形内像素点个数/＞，其中，/＞为剩余轮廓数；如果/＞或/＞，则删除对应轮廓，/＞为像素点上限阈值，/＞为像素点下限阈值；S503、计算剩余每个轮廓与最小外包矩形的矩相似度/＞，若，则删除对应轮廓，其中，/＞为/＞矩相似度阈值；/＞越小表示轮廓与其最小外包矩形相似度越高，由于托盘孔轮廓为近似矩形，最小外包矩形与轮廓形状相似度极高；该步骤可去除显著非矩形的轮廓，大幅减小后续计算的工作量；S504、对于剩余的每个轮廓，根据相应最小外包矩形顶点对应的物理坐标计算轮廓相应的物理宽度和高度/＞，去除不同时满足/＞和的轮廓，/＞为托盘孔宽度误差阈值，/＞为托盘孔高度误差阈值；根据相机物理坐标与图像坐标的变换关系，/＞可通过公式、公式计算：；；其中，；；；‘；式中，分别为托盘孔轮廓最小外包矩形四个顶点对应的物理坐标，；图2中，托盘A的四个顶点坐标为：，/＞，/＞，/＞，/＞分别为托盘孔最小外包矩形上、下两边的物理宽度，也就是图2中点到/＞点以及/＞点到/＞点的物理距离；/＞分别为托盘孔最小外包矩形左、右两边的物理高度，也就是图2中/＞点到/＞点以及/＞点到/＞点的物理距离；图2中，1为工业托盘；2为托盘孔A；3为托盘孔B；4为托盘孔A在相机平面投影；5为托盘孔A顶点/＞；6为托盘孔A顶点；7为托盘孔A顶点/＞；8为托盘孔A顶点/＞。对于任一像素点，其对应物理坐标/＞采用计算方法如下：/＞；公式中，为图像坐标系下像素位置，/＞为像素/＞对应的深度值，为图像坐标系原点位置，/＞为相机焦距。经过S504，只有符合托盘孔高度和宽度的矩形轮廓被保留，其它轮廓被剔除；S505、对S504剩余的轮廓进行轮廓匹配，去除匹配失败的轮廓。托盘任一侧面均包含两个矩形托盘孔，只有两个托盘孔同时被识别，才能视为托盘孔识别成功。见附图3托盘任一侧面两个托盘孔存在如下特征：一是两个矩形孔中心的物理距离是固定的；二是不论托盘如何摆放，同一托盘侧面的两个托盘孔相对于相机平面的倾角一致。符合这两个特征的轮廓可视为一对匹配轮廓。轮廓匹配采用两两比较的方法。比较时计算两个轮廓的中心距离，两个轮廓中心线与相机/＞平面的夹角。同时满足和/＞的两个轮廓视为匹配成功，匹配成功的轮廓被保留，匹配失败的轮廓被剔除，/＞为两托盘孔中心距离误差阈值，/＞为托盘孔倾角差阈值。两个轮廓中心物理距离计算方法为：；式中，和/＞分别为/＞轮廓和/＞轮廓最小外包矩形的中心物理坐标；和/＞计算公式为：；；式中，分别为轮廓/＞最小外包矩形左边上/＞、下/＞两个端点的图像坐标，/＞分别为轮廓/＞最小外包矩形左边上/＞、下/＞两个端点的图像坐标。S506、对剩余轮廓挑选最佳匹配轮廓。计算每对匹配轮廓的矩相似度，选择/＞矩相似度最小的一对轮廓作为目标轮廓。本发明的步骤S501~S506采用逐步删除法剔除非托盘孔轮廓，该方法有两个优势：前两步只需通过少量计算即可删除大量不符合目标要求的轮廓，后续步骤只需对较少的轮廓进行精细特征计算，在很大程度上节省了图像处理的工作量。通过轮廓匹配及最佳轮廓选择可以在众多候选轮廓中选出一对最佳轮廓，保证托盘孔识别的正确率。公式~公式的特征计算方法是基于相机成像原理及托盘孔固有特征推导而来，计算中将相机坐标系和世界坐标系视为重合，这种计算方法避免了坐标系转换的麻烦，并且可不必考虑托盘位姿，所以该计算方法具有广泛的场景适应性。在公式~公式中，特征计算是基于物理坐标进行的，计算得到的宽、高、距离等与物体的实际物理尺寸相对应，这些物理尺寸与物体的摆放位置及角度无关。在公式、中，采用图像坐标计算轮廓倾角，这与物体的实际摆放倾角可能不一致。但在特征判别时不是以倾角作为依据，而是以两个轮廓的倾角差作为依据，对于实际托盘孔轮廓，无论采用物理坐标还是采用图像坐标计算，托盘同一侧面的两个托盘孔轮廓的倾角差都十分接近于0°，在此情况下，采用物理坐标与采用图像坐标计算得到的/＞差别较小，而采用图像坐标计算相对简单，所以，公式和公式采用图像坐标计算。本发明步骤S501~S504的流程如图4所示，S505的流程如图5所示。实施例2，在本发明实施例中，相机彩色图及深度图分辨率均为640×360，深度测量距离最大为10m，目标是识别托盘上的两个托盘孔中心的物理坐标。下面为各步骤的详细说明。 S1：测量托盘孔宽度，高度及两个托盘孔中心距离，测量结果为：，，/＞。设置初始参数如下：/＞，/＞，，/＞，/＞，/＞，/＞，，/＞，/＞，/＞，/＞，。S2：获取深度相机采集到的颜色图及深度图。S3：根据公式、、将颜色图及深度图转换为综合灰度图。S4：采用公式、获得阈值，并应用S405所述的轮廓提取算法获取S3得到的综合灰度图的轮廓，本步骤的轮廓提取算法也可以使用其它轮廓提取算法，但只要采用了公式、的方法设置阈值，均应在本发明保护范围之内。S5：采用逐步排除法去除不符合托盘孔特征的轮廓。在该步骤中，也可以根据实际情况减少或增加关键特征，如增加轮廓面积特征、轮廓边缘与轮廓中心点深度差特征等，或采用不同的特征组合过滤非托盘孔轮廓。在选择最佳匹配轮廓时也可采用非矩相似度标准，比如采用距离相机最近标准、轮廓倾角最小标准等其它标准或两种及两种以上的标准组合；在该步骤中，也可以减少其中某些剔除环节或对某些环节的判断标准进行修改，比如不进行S501或S502的操作，直接进入S503，或者是修改S501、S502的判断标准；在该步骤中，部分特征计算也可以采用其它方法，如采用物理坐标而非图像坐标计算/＞和/＞；上述改动均符合本发明的思想和原则。S6：将S5剩余的轮廓作为最终识别的托盘孔轮廓，记录托盘孔轮廓物理坐标。上述实验分别在10个不同场景下进行，分别是：场景1：相机与托盘孔高度差为0.5米，相机与托盘中心距离0.75米，此场景实验可测试相机安装位置较低，近距离时的托盘孔识别效果；比较图6和7可见，由颜色及深度转换得到的综合灰度图在托盘孔附近亮度要高于只采用颜色转换的灰度图；场景2：相机与托盘孔高度差为0.5米，相机与托盘中心距离2.55米，此场景实验可测试相机安装位置较低，中距离时的托盘孔识别效果；场景3：相机与托盘孔高度差为0.5米，相机与托盘中心距离6.55米，此场景实验可测试相机安装位置较低，远距离时的托盘孔识别效果；场景4：相机与托盘孔高度差为1.0米，相机与托盘中心距离0.95米，此场景实验可测试相机安装位置较高，近距离时的托盘孔识别效果；场景5：相机与托盘孔高度差为1.0米，相机与托盘中心距离3.35米，此场景实验可测试相机安装位置较高，中距离时的托盘孔识别效果；场景6：相机与托盘孔高度差为1.0米，相机与托盘中心距离7.25米，此场景实验可测试相机安装位置较高，远距离时的托盘孔识别效果；场景7：相机与托盘孔高度差为1.0米，相机与托盘呈一定角度时的托盘孔识别效果。场景8：相机与托盘孔高度差为1.0米，相机与托盘呈一定角度时的托盘孔识别效果。场景7和场景8的实验可测试相机安装位置较高，相机与托盘不同角度时的识别效果；场景9：相机与托盘孔高度差为1.0米，相机与托盘中心距离为2.75米，托盘孔周围光线较暗，此场景实验可测试光线较暗时的托盘孔识别效果；图38为彩色图直接转换得到的灰度图；图39为彩色和深度叠加得到的综合灰度图；图40为提取到的轮廓图，图41为最终识别结果图。在托盘孔周围光线较暗时，综合灰度图可显著提高托盘孔周围亮度，突出托盘孔轮廓，进而降低托盘孔轮廓提取的难度，提高托盘孔识别的正确率和坐标定位精度。场景10：相机与托盘孔高度差为1.0米，相机与托盘距离为7.25米，图像包含较多元素，此场景实验可测试相机距离托盘孔较远，并且视野内图像元素较多时的托盘孔识别效果；上述场景验证了本发明在不同情况下的识别效果，这些情况包括：相机距离托盘孔近、中、远时的识别效果；相机与托盘孔呈一定角度时的识别效果；托盘孔周围光线较暗，托盘孔与周围背景耦合时的识别效果；相机安装高度不同时的识别效果，场景1、2、3为相机安装高度较低时的近、中、远距离识别效果，场景4、5、6为相机安装高度较高时的近、中、远距离识别效果；场景中元素较多时的轮廓提取效果。实验结果表明，本发明的托盘孔识别方法在远、中、近距离以及相机与托盘孔呈不同角度时均可实现精确识别，并且本发明方法对相机的安装位置和高度没有具体要求，只要车辆行驶过程中托盘孔出现在相机的有效视野及视距范围内，即可捕获托盘孔位置。场景1~9中对托盘孔前宽阔范围内的物体进行了整理，所以基本没有其它物体，此时计算得到的范围为0.70~0.82，即本发明得到的高阈值/＞为。在场景10中，随机增加了一些物体，使得图像元素增加，图像的信息熵增大，此场景下，/＞约为/＞。由图44可见，由于/＞降低，轮廓提取较前面场景明显精细，这有利于精确提取远距离轮廓。理论上，在所有场景下，/＞均低于，场景越复杂，/＞比/＞低的越多。前面场景虽然也能提取远距离的托盘孔轮廓，但远距离轮廓有一定变形，而图44的轮廓变形明显较前面场景轻微。所以，本发明提出的自适应阈值方法在远距离轮廓提取，尤其是复杂场景的远距离轮廓提取方面具有优势。在上述实施例中，对各个实施例的描述都各有侧重，某个实施例中没有详述或记载的部分，可以参见其它实施例的相关描述。所属领域的技术人员可以清楚地了解到，为了描述的方便和简洁，仅以上述场景为例对本发明的方法进行说明，实际应用可以是不同场景的组合，或使用与上述场景不同的参数。根据本申请的实施例，本发明还提供了一个实现该方法的计算机程序，该计算机程序可运行与多种操作系统和多种计算机设备，运行该程序可实现上述任意实施例中的步骤。使用该程序还可以对本发明中的相应参数进行在线修改及设置。为进一步证明上述实施例的积极效果，本发明还对参数取不同值时的识别成功率及识别精度进行了实验。/＞时为纯彩色图像，/＞时为纯深度图像，图46、图47显示了在不同/＞值及本发明的方法与FAST-RCNN识别的成功率及识别时间对比。FAST-RCNN是一种人工智能领域常用的基于机器学习技术的图像识别方法。本实验采用Arm嵌入式处理器，CPU频率为1.50GHz，内存为4G，图像分辨率为640×360。在固定场景下只调整/＞值，对于每个值动态采集1000张图片，根据1000张图片的识别结果计算图片的总体成功率及每张图片识别的平均时间。这里的精度是指托盘孔中心实际位置与识别位置的空间距离。精度小于2cm视为识别成功，否则视为识别失败。成功率为：识别成功次数/识别总次数。从图46可见，FAST-RCNN对于彩色图片的识别效果较好，识别成功率最高可达98.5%，而对深度图片识别效果较差，当β值为0时识别成功率仅78.4%。相比之下，本发明方法对彩色图片的识别成功率略低于FAST-RCNN，但当值选择合适时，本发明的成功率最高可达98.2%，与FAST-RCNN相当。对完全深度图像的识别成功率可达89.2%，远超过FAST-RCNN识别方法。FAST-RCNN识别方法的成功率依赖于学习样本标注的准确性，对于彩色样本，边缘相对清晰，人工标注较为容易，标注准确率较高，而对于融入深度信息的样本，边缘较为模糊，此时人工标注的准确性会明显降低。这会显著影响FAST-RCNN的学习效果及测试的准确性，而如何实现模糊边缘的准确标注依然是人工智能领域未解决的问题。/＞本发明所提的方法避免了人工标注的难题。从图47可见，本发明所提方法在识别时间上显著优于FAST-RCNN方法，目前几乎所有的人工智能方法都存在计算量大的问题，在精度要求不高的场合，这个问题可通过降低图像分辨率解决，而对于精度要求高的场合，则必须借助其它辅助措施，如规定特定场景、辅以其它传感器等。本发明所提方法计算量显著小于FAST-RCNN方法，并且随着深度信息比例的增加，识别时间减小。这主要是由于彩色图片比较复杂，识别时要做大量的边缘处理，而深度信息加入后很多非托盘孔边缘会变形明显，很容易被过滤掉。本发明方法在深度比例为0.5~0.7时，每帧图像识别时间约为0.17秒，而FAST-RCNN约为0.42秒，所以在识别速度方面，本发明具有显著优势。以上所述，仅为本发明较优的具体的实施方式，但本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，凡在本发明的精神和原则之内所作的任何修改、等同替换和改进等，都应涵盖在本发明的保护范围之内。
