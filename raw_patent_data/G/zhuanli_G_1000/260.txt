标题title
基于分割的细胞分裂均衡度评估方法及设备
摘要abst
本发明公开了基于分割的细胞分裂均衡度评估方法和设备，所述方法包括步骤：S1将细胞图像分别输入至经过训练的分割网络模型，提取细胞边缘信息，生成语义分割图；S2统计语义分割图中每个细胞语义区域的面积，根据平均面积判断是否存在重叠区域；S3对于具有重叠区域的语义分割图，将重叠区域的边缘按曲率分段；S4根据每段边缘的凹向将该段边缘补充给对应方向的相邻细胞；S5对语义分割图中每个细胞取最大的边缘统计细胞面积；S6根据统计得到的所有细胞面积评估细胞分裂均衡度。本发明通过提取细胞边缘统计细胞面积，避免了椭圆拟合不规则细胞导致的精度下降，提升细胞分裂均衡度判断的准确性。
权利要求书clms
1.一种基于分割的细胞分裂均衡度评估方法，其特征在于：包括步骤：S1将细胞图像分别输入至经过训练的分割网络模型，提取细胞边缘信息，将图像中的细胞区域分割，生成语义分割图；S2统计语义分割图中每个细胞语义区域的面积，根据平均面积判断是否存在重叠区域；S3对于具有重叠区域的语义分割图，将重叠区域的边缘按曲率分段；S4重叠区域的边缘分段数表明该重叠区域属于对应个数的细胞，根据每段边缘的凹向将该段边缘补充给对应方向的相邻细胞；S5对语义分割图中每个细胞取最大的边缘统计细胞面积；S6根据统计得到的所有细胞面积评估细胞分裂均衡度。2.根据权利要求1所述的基于分割的细胞分裂均衡度评估方法，其特征在于：步骤S2中判断是否存在重叠区域的方法为：将面积小于平均面积的设定阈值的语义区域视为重叠区域，记第m个重叠区域为/＞。3.根据权利要求2所述的基于分割的细胞分裂均衡度评估方法，其特征在于：步骤S3中将重叠区域的边缘按曲率分段的方法为：对第m个重叠区域对应的边缘像素集，遍历集合中每个像素的坐标，计算该像素的曲率值C，如果当前像素的曲率值C和相邻两端像素的曲率值差距超过阈值η时，将当前像素设为分段点，根据分段点将细胞边缘分段，设定分段数量为/＞，/＞对应于第m个重叠区域的第k段边缘。4.根据权利要求3所述的基于分割的细胞分裂均衡度评估方法，其特征在于：所述边缘像素集的生成方法为：对第m个重叠区域/＞，遍历区域内每个像素，如果当前像素的上下左右四个方向的相邻像素存在不同语义标签的像素，则代表当前像素为所属语义标签的边缘像素，将第m个重叠区域的边缘像素集合记为/＞。5.根据权利要求1所述的基于分割的细胞分裂均衡度评估方法，其特征在于：步骤S1将细胞图像分别输入至经过训练的分割网络模型，提取细胞边缘信息的具体步骤包括：a.收集细胞分裂全过程中的细胞图像，标注每一张图像中细胞的语义标签，将标注好的图像划分为训练集、验证集和测试集；b.采用标注的训练集对分割网络模型进行训练；c.根据边缘提取网络模型在验证集上的准确率变化，调整模型的超参数，最终保存在测试集上表现最佳的分割网络模型；d.运用保存的边缘提取网络模型检测拍摄的细胞图像，输出对图像语义的预测结果；e.根据语义标签提取代表细胞的语义区域，生成语义分割图。6.根据权利要求5所述的基于分割的细胞分裂均衡度评估方法，其特征在于：所述分割网络模型包括特征提取模块、金字塔池化网络和卷积神经网络，所述特征提取模块提取图像中图像的高层次特征信息，生成特征图，将特征图输入所述金字塔池化网络，融合不同尺度的特征信息，输出包含不同层级的金字塔池化全局特征，最终由卷积网络将金字塔池化全局特征和初始特征图拼接，卷积生成语义分割图和边缘图。7.根据权利要求5所述的基于分割的细胞分裂均衡度评估方法，其特征在于：所述分割网络模型使用传统边缘检测算子配合形态学操作对输入的图像进行检测，所述分割网络模型输出的边缘图记为，使用传统边缘检测算子输出细胞边缘图像记为/＞，利用/＞对进行约束，要求/＞输出的边缘图像尽可能包含/＞中的边缘，通过该约束使分割网络模对细胞进行分割。8.根据权利要求1所述的基于分割的细胞分裂均衡度评估方法，其特征在于：步骤S5中细胞分裂均衡度的计算方式为：式中，B细胞分裂均衡度指数，n为细胞总数，为细胞面积的平均值。9.根据权利要求8所述的基于分割的细胞分裂均衡度评估方法，其特征在于：所述细胞均衡度指数当B大于阈值ξ时，判断为细胞分裂均衡，否则视为细胞分裂不均衡。10.一种设备，其特征在于，包括：至少一个处理器；以及，与所述至少一个处理器通信连接的存储器；其中，所述存储器存储有可被所述至少一个处理器执行的指令，所述指令被所述至少一个处理器执行，以使所述至少一个处理器能够执行如权利要求1~9中任一项所述的基于分割的细胞分裂均衡度评估方法。
说明书desc
技术领域本发明涉及人工智能技术领域，具体地指基于分割的细胞分裂均衡度评估方法及设备。背景技术通过计算机视觉方法辅助细胞学家快速地检测细胞分裂过程中的均衡度具有十分重要的研究意义。目前，虽然存在一些图像分割的方法来计算细胞的面积以评估细胞分裂均衡度。然而，细胞分裂均衡度的智能预测在实际应用中仍存在以下问题：使用椭圆拟合技术对分割的区域进行拟合时往往和真实细胞的形状存在误差，因为真实细胞往往不是一个规则的椭圆，不规则的地方会导致面积统计时产生误差；细胞分裂过程中，细胞之间往往会存在重叠现象，产生重叠区域，而单纯的图像分割会将重叠区域误分割为一个单独的细胞，使得统计细胞面积时发生偏差，也会直接导致细胞均衡度计算的不准确。发明内容本发明针对上述现有技术的不足之处，提出一种基于分割的细胞分裂均衡度评估方法及设备，以提高细胞均衡度的评估准确率。为实现上述目的，本发明设计的基于分割的细胞分裂均衡度评估方法，其特殊之处在于，包括如下步骤：S1将细胞图像分别输入至经过训练的分割网络模型，提取细胞边缘信息，将图像中的细胞区域分割，生成语义分割图；S2统计语义分割图中每个细胞语义区域的面积，根据平均面积判断是否存在重叠区域；S3对于具有重叠区域的语义分割图，将重叠区域的边缘按曲率分段；S4重叠区域的边缘分段数表明该重叠区域属于对应个数的细胞，根据每段边缘的凹向将该段边缘补充给对应方向的相邻细胞；S5对语义分割图中每个细胞取最大的边缘统计细胞面积；S6根据统计得到的所有细胞面积评估细胞分裂均衡度。优选地，步骤S2中判断是否存在重叠区域的方法为：将面积小于平均面积的设定阈值的语义区域视为重叠区域，记第m个重叠区域为/＞。优选地，步骤S3中将重叠区域的边缘按曲率分段的方法为：对第m个重叠区域对应的边缘像素集，遍历集合中每个像素的坐标，计算该像素的曲率值C，如果当前像素的曲率值C和相邻两端像素的曲率值差距超过阈值η时，将当前像素设为分段点，根据分段点将细胞边缘分段，设定分段数量为/＞，/＞对应于第m个重叠区域的第k段边缘。优选地，所述边缘像素集的生成方法为：对第m个重叠区域/＞，遍历区域内每个像素，如果当前像素的上下左右四个方向的相邻像素存在不同语义标签的像素，则代表当前像素为所属语义标签的边缘像素，将第m个重叠区域的边缘像素集合记为/＞。优选地，步骤S1将细胞图像分别输入至经过训练的分割网络模型，提取细胞边缘信息的具体步骤包括：a.收集细胞分裂全过程中的细胞图像，标注每一张图像中细胞的语义标签，将标注好的图像划分为训练集、验证集和测试集；b.采用标注的训练集对分割网络模型进行训练；c.根据边缘提取网络模型在验证集上的准确率变化，调整模型的超参数，最终保存在测试集上表现最佳的分割网络模型；d.运用保存的边缘提取网络模型检测拍摄的细胞图像，输出对图像语义的预测结果；e.根据语义标签提取代表细胞的语义区域，生成语义分割图。优选地，所述分割网络模型包括特征提取模块、金字塔池化网络和卷积神经网络，所述特征提取模块提取图像中图像的高层次特征信息，生成特征图，将特征图输入所述金字塔池化网络，融合不同尺度的特征信息，输出包含不同层级的金字塔池化全局特征，最终由卷积网络将金字塔池化全局特征和初始特征图拼接，卷积生成语义分割图和边缘图。优选地，所述分割网络模型使用传统边缘检测算子配合形态学操作对输入的图像进行检测，所述分割网络模型输出的边缘图记为，使用传统边缘检测算子输出细胞边缘图像记为/＞，利用/＞对/＞进行约束，要求/＞输出的边缘图像尽可能包含/＞中的边缘，通过该约束使分割网络模对细胞进行分割。优选地，步骤S5中细胞分裂均衡度的计算方式为：式中，B细胞分裂均衡度指数，n为细胞总数，为细胞面积的平均值。优选地，所述细胞均衡度指数当B大于阈值ξ时，判断为细胞分裂均衡，否则视为细胞分裂不均衡。本发明还提出一种设备，包括：至少一个处理器；以及，与所述至少一个处理器通信连接的存储器；其中，所述存储器存储有可被所述至少一个处理器执行的指令，所述指令被所述至少一个处理器执行，以使所述至少一个处理器能够执行上述的基于分割的细胞分裂均衡度评估方法。本发明的有益效果在于：1）本发明通过提取细胞边缘来统计细胞面积，避免了椭圆拟合不规则细胞导致的精度下降，提升细胞分裂均衡度判断的准确性；2）本发明通过细胞平均面积判断重叠区域，并根据曲率将重叠区域边缘分段，扩充相邻细胞，降低了细胞重叠导致面积统计时的误差，让细胞面积统计更准确；3）本发明使用传统边缘检测算子指导分割网络可以在一定程度上提升分割性能，提高准确度。附图说明图1为本发明基于分割的细胞分裂均衡度评估方法的流程图；图2为分割网络模型的结构示意图；图3为传统边缘算子检测示意图；图4为网络输出的边缘图；图5为重叠区域边缘示意图；图6为曲率分段示意图；图7为匹配分段边缘和重叠区域补偿示意图。具体实施方式以下结合附图和具体实施例对本发明作进一步的详细描述。细胞在分裂过程中，因重叠导致细胞的部分面积被掩盖，通过图像检测无法准确判断细胞面积，因此，本发明提出了一种基于分割的细胞分裂均衡度评估方法和设备。为了准确评估细胞大小，可以利用图像分割方法分割细胞，得到准确细胞边缘，使用细胞边缘来帮助统计细胞面积。为此，首先要做的是将图像中的细胞分割开来，为后续统计细胞面积做准备。本发明通过分割网络模型提取细胞边缘信息，分割网络模型的构建过程为：收集细胞分裂全过程中的细胞图像，标注每一张图像中细胞的语义标签，将标注好的图像划分为训练集、验证集和测试集，对训练集中的细胞图像进行翻转、旋转、平移等预处理操作，扩充数据集；采用标注的训练集对模型进行训练；根据模型在验证集上的准确率变化，调整模型的超参数，最终保存在测试集上表现最佳的网络模型；运用保存的模型检测拍摄的细胞图像，输出对图像各细胞分割图的预测结果；根据语义标签提取代表细胞的语义区域。分割网络可以使用PSPNet、SegNet、RefineNet等网络，本实施例以Pyramid SceneParsing Network 网络作为网络框架，对细胞图像进行粗分割，预测细胞分割图。分割网络模型如图2所示，将细胞图像输入分割网络模型中，由特征提取模块ResNet50提取图像中图像的高层次特征信息，生成特征图。将特征图输入金字塔池化网络，融合不同尺度的特征信息，输出包含不同层级的金字塔池化全局特征。最终由卷积网络将金字塔池化全局特征和初始特征图拼接，卷积生成最终的分割语义图和边缘图。传统边缘检测算子检测的边缘一般都不够完整，但比较可靠，如图3所示，使用传统边缘检测算子指导分割网络可以在一定程度上提升分割性能，提高准确度。在分割网络模型中，输出边缘图，记该图像为边缘图；使用传统边缘检测算子配合形态学操作对输入的图像进行检测，输出检测的细胞边缘图像，记为/＞，如图4所示；利用/＞对进行约束，要求/＞输出的边缘图像尽可能包含/＞中的边缘，通过这种约束来让网络更准确的对细胞进行分割。经过上述操作，分割网络模型将图像中的细胞区域分割，生成后续重叠区域处理需要的语义分割图。由于细胞间往往存在重叠，因此需要对重叠区域进行处理，让每个细胞的面积更精确。本发明提出将重叠区域的边缘按曲率分段，并根据凹凸方向补充给对应的相邻细胞的方法以解决细胞重叠区域识别和补偿的问题。首先，统计语义分割图中每个语义标签的区域面积，第j个语义标签的面积记为，计算所有语义标签的平均面积/＞。由于一般各细胞的面积差距不会太大，根据这个规律，将面积小于平均面积的某个阈值的语义区域视为重叠区域，记第m个重叠区域为/＞。重叠区域边缘如图5所示，对第m个重叠区域，遍历区域内每个像素，如果当前像素的上下左右四个方向的相邻像素存在不同语义标签的像素，则代表当前像素为所属语义标签的边缘像素，将第m个重叠区域的边缘像素集合记为/＞。此外，对于非重叠的细胞区域，同样统计该区域的边缘像素集，将第n个细胞区域的边缘像素集记为/＞。对每个重叠区域的边缘按照曲率分段，如图6所示，对第m个重叠区域对应的边缘像素集，遍历集合中每个像素的坐标，计算该像素的曲率值C，如果当前像素的曲率值C和相邻两端像素的曲率值差距超过阈值η时，将当前像素设为分段点。根据分段点将细胞边缘分段，设定分段数量为/＞，/＞对应于第m个重叠区域的第k段边缘。重叠区域的边缘分段数通常可以反映该重叠区域属于几个细胞，根据每段边缘的凹向将该段边缘补充给对应方向的相邻细胞。将每段边缘的两个端点连线，根据该段边缘的凹向从边缘任意一点做垂直于端点连线的线段，从边缘上的点指向端点连线的方向即为该段边缘搜寻相邻细胞的方向，该线段指向的相邻细胞即为对应的细胞。确定该段对应边缘重叠细胞后，将该段边缘对应的边缘像素集添加到对应相邻细胞的边缘像素集。如图7所示，对重叠区域白色边缘按曲率取得分段点、/＞，连接黑色线段/＞，将重叠边缘分段为Sm1和Sm2,从Sm1上任取一点/＞，作一条垂直于/＞的线段交重叠边缘于点，则从点/＞指向点/＞的方向可以视为该段边缘的凹向，延长线段/＞，遇到的第一个非重叠区域Ce1即为对应的细胞区域，将边缘Sm1对应的边缘像素集添加到Ce1的边缘像素集/＞。按相同的方法作线段/＞，可知Ce2为边缘Sm2对应的细胞区域, 将边缘Sm2对应的边缘像素集添加到Ce2的边缘像素集/＞。将所有重叠区域处理后，对每个细胞，取最大的边缘来统计面积，记第i个细胞的面积为。根据统计得到的所有细胞面积评估细胞分裂均衡度指数B：式中，n为细胞总数，为细胞面积的平均值，当B大于阈值/＞时，视为均衡，否则视为不均衡，根据经验设置/＞。本发明还提出一种设备，包括：至少一个处理器；以及，与所述至少一个处理器通信连接的存储器；其中，所述存储器存储有可被所述至少一个处理器执行的指令，所述指令被所述至少一个处理器执行，以使所述至少一个处理器能够执行如上述的基于分割的细胞分裂均衡度评估方法。本说明书未作详细描述的内容属于本领域专业技术人员公知的现有技术。最后需要说明的是，以上具体实施方式仅用以说明本专利技术方案而非限制，尽管参照较佳实施例对本专利进行了详细说明，本领域的普通技术人员应当理解，可以对本专利的技术方案进行修改或者等同替换，而不脱离本专利技术方案的精神和范围，其均应涵盖在本专利的权利要求范围当中。
