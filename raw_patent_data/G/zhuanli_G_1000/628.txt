标题title
基于数据分析的视频非接触测量疼痛识别方法及系统
摘要abst
本发明公开了基于数据分析的视频非接触测量疼痛识别方法及系统，属于深度学习技术领域。本发明的方法步骤如下：S100、通过人脸视频采集进行人脸检测，建立面部表情支路和非接触生理信号支路；S200、在面部表情支路中，进行尺寸归一化和灰度化处理，将处理后的图像输入C3D网络；S300、非接触生理信号支路选择额头和脸颊作为感兴趣区域，获取rPPG信号；基于RR间期进行HRV时域、频域和非线性分析；通过随机森林算法实现基于rPPG信号的疼痛等级预测；S400、将面部表情支路中C3D网络的全连接层输出的特征向量与非接触生理信号支路筛选出的最具代表性的手工特征进行拼接，实现疼痛识别。
权利要求书clms
1.基于数据分析的视频非接触测量疼痛识别方法，其特征在于：步骤如下：S100、通过人脸视频采集进行人脸检测，获取人脸识别特征，建立面部表情支路和非接触生理信号支路；S200、在面部表情支路中，进行尺寸归一化和灰度化处理，将处理后的图像输入C3D网络；S300、非接触生理信号支路选择额头和脸颊作为感兴趣区域，进行通道分离、像素均值计算、小波变换和带通滤波，获取rPPG信号；对rPPG信号进行峰值点检测获取RR间期，基于RR间期进行HRV时域、频域和非线性分析；通过随机森林算法实现基于rPPG信号的疼痛等级预测，筛选出最具代表性的手工特征；S400、将面部表情支路中C3D网络的全连接层输出的特征向量与非接触生理信号支路筛选出的最具代表性的手工特征进行拼接，计算面部表情支路中C3D网络的全连接层与非接触生理信号支路的权重分配，实现双支路的特征级融合，实现疼痛识别。2.根据权利要求1所述的基于数据分析的视频非接触测量疼痛识别方法，其特征在于：根据步骤S200，细化步骤如下：S201、获取包含疼痛和非疼痛样本的视频数据集，进行尺度归一化和灰度化处理；S202、基于获取的视频数据集进行数据批处理，按照每t0帧进行采样，将t帧的连续采样后的图像输入C3D网络，其中t0和t都是正整数，保持张量形状为，其中channel是通道数，t是连续采样后的图像帧数，h是图像的高度，w是图像的宽度。3.根据权利要求1所述的基于数据分析的视频非接触测量疼痛识别方法，其特征在于：根据步骤S300，细化步骤如下：S301、通过获取相应的关键点坐标，创建一个掩码，并将掩码和原始图像做与运算，从而提取感兴趣区域；S302、将面部ROI图片分离为红色、绿色、蓝色三个单通道图像，通过计算每个通道内ROI的像素均值得到三个包含面部生理信号的一维时间序列，选择绿色通道的一维时间序列作为rPPG的原始信号；S303、选取db8小波基对绿色通道rPPG源信号进行分解去噪，对源信号进行五层小波分解；脉搏波信号集中在CD3、CD4，将CD3、CD4这两层信号结果进行叠加，作为去除基线漂移后的小波重构波形；为脉搏波信号设置带通滤波器，满足人体心跳的变化范围；S304、经过小波变换后得到信号结果，横坐标为时间，纵坐标为像素均值，对像素均值进行了归一化处理；S305、对rPPG信号进行峰值点检测获取RR间期，基于RR间期进行HRV时域分析、HRV频域分析和HRV非线性分析，得到特征向量；S306、通过随机森林算法实现基于rPPG信号的疼痛等级预测，筛选出最具代表性的手工特征。4.根据权利要求3所述的基于数据分析的视频非接触测量疼痛识别方法，其特征在于：根据步骤S305，进行HRV时域分析使用如下方法：;其中，HR是心跳率，单位为bmp；M是RR间期总数；是第/＞个RR间期；;其中，SDNN代表全部正常窦性心搏间期的标准差，单位为ms，反映了心率变异性偏离平均值的程度；是第/＞个RR间期；/＞是N个心搏的RR间期的平均值；;其中，PNN U代表相邻RR间期之差大于U ms的心搏数占RR间期总数的百分比，其中U是一个正整数，反映副交感神经的活动；NN U是相邻RR间期之差大于U ms的心搏数；;其中，RMSSD代表全部相邻RR间期之差的均方根，单位为ms，反映副交感神经对心率的调节作用；是第/＞个RR间期；/＞是第/＞个RR间期；;其中，代表全部相邻R-R间期之差的标准差，单位ms；/＞，；/＞是第/＞个RR间期；/＞是第/＞+1个RR间期；;其中，CVSD是疼痛受试者脉搏波连续差异的变化系数，是第/＞个RR间期；;其中，CVnni是疼痛受试者脉搏波连续差异的变异系数，是第/＞个RR间期；HRV频域分析反映交感神经与副交感神经各自的活动，进行HRV频域分析使用如下方法：;其中，TE代表疼痛受试者脉搏波在频率范围内的总体能量，单位是；PSD是功率谱密度，表示在频率f处的功率；;其中，LF表示疼痛受试者脉搏波在频率范围  内的低频能量，/＞和/＞都是正小数；;其中，LFnu表示疼痛受试者脉搏波在频率范围  内的归一化低频能量；;其中，HF表示疼痛受试者脉搏波在频率范围  内的高频能量，/＞和/＞都是正小数；;其中，HFnu表示疼痛受试者脉搏波在频率范围  内的归一化高频能量；进行HRV非线性分析，使用庞加莱图，对于一段连续的心跳间隔，将第r个心跳间隔作为横坐标，第r+1个心跳间隔作为纵坐标，在二维平面画出散点图，使用到的公式如下：;其中，SD1是椭圆的半长轴，E是心跳间隔序列的长度，是时间序列的第r个数据点；;其中，SD2是椭圆的半短轴；根据步骤S306，使用随机森林算法对计算得到的HRV特征进行分类，输入为步骤S305经过HRV时域分析、HRV频域分析和HRV非线性分析所得的所有特征向量；预测值为疼痛等级标签，在过程中提供有关每个特征重要性的信息；收集BioVid数据集，所述疼痛数据集标签为五级分类。5.根据权利要求1所述的基于数据分析的视频非接触测量疼痛识别方法，其特征在于：根据步骤S400，在实现双支路的特征级融合时，计算面部表情支路中C3D网络的全连接层与非接触生理信号支路在特征级融合期间的权重分配，进行疼痛识别，步骤如下：S401、从系统中获取人脸采集视频的时长Time和历史数据中的疼痛等级标签，其中Time的单位为秒；S402、利用历史数据中的疼痛等级标签的OPI评级与对应的用户填写的疼痛等级/＞，其中，/＞为疼痛等级标签的数量；计算历史数据中的疼痛等级标签的OPI评级与用户填写的疼痛等级之间的等级差异；S403、用户设定标准等级差异Q，筛选中小于Q的值组成优选疼痛等级标签的OPI评级，其中/＞为优选疼痛等级标签的数量；S404、根据优选疼痛等级标签的OPI评级获得对应的优选人脸采集视频时长和优选权重分配，其中，/＞到/＞分别为优选疼痛等级标签的OPI评级从/＞到/＞对应的人脸采集视频时长，/＞到分别为优选疼痛等级标签的OPI评级从/＞到/＞对应的表情支路中C3D网络的全连接层的权重，/＞到/＞分别为优选疼痛等级标签的OPI评级从/＞到对应的/＞支路的权重；S405、根据优选人脸采集视频时长，获取优选人脸采集视频时长的中位数/＞，其中/＞，/＞到/＞的单位为秒；S406、将Time与进行比较，并结合优选权重分配计算非接触生理信号支路的权重/＞和表情支路中C3D网络的全连接层的权重/＞；定义权重调整常量/＞，表示Time与进行比较时的权重调整参数，/＞越大，/＞越大；/＞的计算公式如下：；其中，是每个优选视频的视频时长与初始表情支路中C3D网络的全连接层的权重分配的关系的平均值，公式如下：；通过，计算优选非接触生理信号支路的权重/＞，公式如下：；根据得到的权重调整常量，计算/＞和/＞，公式如下：；；其中，当时，/＞增大，/＞减小；反之，当时，/＞减小，/＞增大；S407、使用交叉熵损失函数计算C3D网络输出的概率分布与视频对应的疼痛类别之间的交叉熵损失；S408、使用随机梯度下降优化器，设置动量参数和正则化项系数；S409、进行学习率调度，设置初始学习率和学习率衰减方法；S410、在训练集上使用C3D网络进行训练，通过反向传播和优化器更新权重；S411、选择C3D网络输出概率分布中最大概率对应的类别作为疼痛预测结果，根据视频对应的疼痛类别和C3D网络预测进行计算，获取C3D网络评估参数。6.根据权利要求5所述的基于数据分析的视频非接触测量疼痛识别方法，其特征在于：根据步骤S407，多分类下的交叉熵损失的表达式为：；其中，CrossEntropyLoss’是多分类下的交叉熵损失函数，适用于二分类；C是疼痛数据标签类别的总数量；是一个指示函数，表示第i个视频是否属于疼痛类别j，如果是，则/＞为1，否则，/＞为0；/＞是C3D网络将第i个视频预测为疼痛类别j的概率；所述损失函数的目标是最小化C3D网络对于每个样本疼痛类别的负对数概率，C3D网络对疼痛数据的预测接近实际疼痛类别时，损失趋向于零，反映C3D网络对疼痛程度的准确预测；否则，损失增加，表明C3D网络对疼痛程度的预测偏离实际情况。7.根据权利要求5所述的基于数据分析的视频非接触测量疼痛识别方法，其特征在于：根据步骤S408，使用随机梯度下降优化器，设置梯度的改变量，即动量为v，动量参数为momentum，正则化项系数为weight_decay，其中momentum和weight_decay为正小数；权重更新如下式所示：；；其中，是C3D网络在第t+1次迭代中的参数值；/＞是C3D网络在第t次迭代中的参数值；L是损失函数关于/＞的梯度；/＞是学习率，是一个超参数，用于调整C3D网络在每次/＞更新时的步长。8.根据权利要求5所述的基于数据分析的视频非接触测量疼痛识别方法，其特征在于：根据步骤S409，初始学习率设置为A，每十个epoch衰减为B，衰减两次后不再衰减，其中A和B是正小数；衰减如下式，新学习率的值为旧学习率的B倍：；其中，是C3D网络衰减后新的学习率，/＞是衰减前的旧学习率。9.根据权利要求5所述的基于数据分析的视频非接触测量疼痛识别方法，其特征在于：根据步骤S411，根据视频对应的疼痛类别和C3D网络预测计算评估参数，计算准确率Acc、精确率P、召回率R和F1值，最后将计算出的值取平均得到C3D网络评估参数G；在多分类的情况中，公式如下：；；；；其中TPi、TNi、FPi、FNi分别是第 i 个类别的 TP、TN、FP、FN的数量；TP是真正类，表示C3D网络将疼痛视频正确地预测为疼痛类别的数量；TN是真负类，表示C3D网络将无痛视频正确地预测为无痛类别的数量；FP是假正类，表示C3D网络错误地将无痛视频预测为疼痛类别的数量；FN是假负类，表示C3D网络错误地将疼痛视频预测为无痛类别的数量；适用于二分类的情况；最终，获取C3D网络评估参数，公式如下：；其中，G是C3D网络评估参数。10.基于数据分析的视频非接触测量疼痛识别系统，使用权利要求1-9中任一项所述的基于数据分析的视频非接触测量疼痛识别方法，其特征在于：基于数据分析的视频非接触测量疼痛识别系统包括：人脸检测模块：通过人脸视频采集进行人脸检测，获取人脸识别特征，建立面部表情支路和非接触生理信号支路；面部表情支路处理模块：在面部表情支路中，进行尺寸归一化和灰度化处理，将处理后的图像输入C3D网络；非接触生理信号支路处理模块：非接触生理信号支路选择额头和脸颊作为感兴趣区域，进行通道分离、像素均值计算、小波变换和带通滤波，获取rPPG信号；对rPPG信号进行峰值点检测获取RR间期，基于RR间期进行HRV时域、频域和非线性分析；通过随机森林算法实现基于rPPG信号的疼痛等级预测，筛选出最具代表性的特征；特征级融合模块：将面部表情支路中C3D网络的全连接层输出的特征向量与非接触生理信号支路筛选出的最具代表性的手工特征进行拼接，计算面部表情支路中C3D网络的全连接层与非接触生理信号支路的权重分配，实现双支路的特征级融合，进行疼痛识别。
说明书desc
技术领域本发明涉及深度学习技术领域，具体为基于数据分析的视频非接触测量疼痛识别方法及系统。背景技术本发明通过引入面部表情支路和非接触生理信号支路，旨在克服传统方法的缺点。现有技术主要依赖于单一模态的信息，即只使用面部表情或生理信号rPPG，这种单一模态的依赖限制了疼痛识别系统对多源信息的充分利用，导致对疼痛状态的不充分理解。在处理面部表情时，现有技术采用C3D网络进行疼痛识别任务，但存在对特定情境的过拟合或者对某些表情的过敏感问题，导致模型在真实场景中的泛化能力不足。非接触生理信号支路通过额头和脸颊的感兴趣区域进行信号采集，但在现有技术中存在对光线、环境噪声等因素的较强敏感性。导致信号采集的稳定性和准确性受到影响，影响整个疼痛识别系统的可靠性。现有技术在特征级融合中没有有效的机制动态调整表情支路中C3D网络和非接触生理信号支路的权重，缺乏对于不同情境、个体或数据特性的动态适应性，可能导致模型在某些场景下权重分配不合理，影响系统的鲁棒性。现有技术中几乎采用的是固定的权重分配方案，这将导致在某些情境下表情支路和非接触生理信号支路的贡献程度不同，从而限制了模型对于复杂场景的适应性，固定权重无法很好地捕捉不同模态之间的关系变化。发明内容本发明的目的在于提供基于数据分析的视频非接触测量疼痛识别方法及系统，以解决上述背景技术中提出的问题。为了解决上述技术问题，本发明提供如下技术方案：基于数据分析的视频非接触测量疼痛识别方法，步骤如下：S100、通过人脸视频采集进行人脸检测，获取人脸识别特征，建立面部表情支路和非接触生理信号支路；S200、在面部表情支路中，进行尺寸归一化和灰度化处理，将处理后的图像输入C3D网络；S300、非接触生理信号支路选择额头和脸颊作为感兴趣区域，进行通道分离、像素均值计算、小波变换和带通滤波，获取rPPG信号；对rPPG信号进行峰值点检测获取RR间期，基于RR间期进行HRV时域、频域和非线性分析；通过随机森林算法实现基于rPPG信号的疼痛等级预测，筛选出最具代表性的手工特征；S400、将面部表情支路中C3D网络的全连接层输出的特征向量与非接触生理信号支路筛选出的最具代表性的手工特征进行拼接，计算面部表情支路中C3D网络的全连接层与非接触生理信号支路的权重分配，实现双支路的特征级融合，实现疼痛识别。C3D模型具有8个卷积层，5个池化层，2个全连接层，1个Softmax输出层。所有卷积核均为3×3×3。第一个Pooling层1×2×2，Stride=1×2×2，之后都是2×2×2，Stride=2×2×2。在面部表情支路中，每个卷积层Conv和全连接层fc之后都进行ReLU激活函数操作，全连接层在经过激活函数后，添加dropout操作，以减少过拟合风险。根据步骤S200，细化步骤如下：S201、获取包含疼痛和非疼痛样本的视频数据集，进行尺度归一化和灰度化处理；S202、基于获取的视频数据集进行数据批处理，按照每t0帧进行采样，将t帧的连续采样后的图像输入C3D网络，其中t0和t都是正整数，保持张量形状为，其中channel是通道数，t是连续采样后的图像帧数，h是图像的高度，w是图像的宽度。根据步骤S300，细化步骤如下：S301、通过获取相应的关键点坐标，创建一个掩码，并将掩码和原始图像做与运算，从而提取感兴趣区域；S302、将面部ROI图片分离为红色、绿色、蓝色三个单通道图像，通过计算每个通道内ROI的像素均值得到三个包含面部生理信号的一维时间序列，选择绿色通道的一维时间序列作为rPPG的原始信号；S303、选取db8小波基对绿色通道rPPG源信号进行分解去噪，对源信号进行五层小波分解；脉搏波信号集中在CD3、CD4，将CD3、CD4这两层信号结果进行叠加，作为去除基线漂移后的小波重构波形；为脉搏波信号设置带通滤波器，满足人体心跳的变化范围；S304、经过小波变换后得到信号结果，横坐标为时间，纵坐标为像素均值，对像素均值进行了归一化处理；S305、对rPPG信号进行峰值点检测获取RR间期，基于RR间期进行HRV时域分析、HRV频域分析和HRV非线性分析，得到特征向量；S306、通过随机森林算法实现基于rPPG信号的疼痛等级预测，筛选出最具代表性的手工特征。考虑到生活中戴眼镜的情况以及疼痛过程中嘴部、鼻子等部位会发生严重形变，进而影响信号质量，最终选择额头和脸颊作为感兴趣区域。使用MediaPipe库中的 FaceMesh 模型进行人脸关键点检测，该模型具有468个关键点，可以更精准的得到理想的感兴趣区域。通过获取相应的关键点坐标，创建一个掩码mask，并将掩码应用于原始图像，从而提取感兴趣区域。根据步骤S305，进行HRV时域分析使用如下方法：其中，HR是心跳率，单位为bmp；M是RR间期总数；是第/＞个RR间期；其中，SDNN代表全部正常窦性心搏间期的标准差，单位为ms，反映了心率变异性偏离平均值的程度；是第/＞个RR间期；/＞是N个心搏的RR间期的平均值；其中，PNN U代表相邻RR间期之差大于U ms的心搏数占RR间期总数的百分比，其中U是一个正整数，反映副交感神经的活动；NN U是相邻RR间期之差大于U ms的心搏数；其中，RMSSD代表全部相邻RR间期之差的均方根，单位为ms，反映副交感神经对心率的调节作用；是第/＞个RR间期；/＞是第/＞个RR间期；其中，代表全部相邻R-R间期之差的标准差，单位ms；，/＞；/＞是第/＞个RR间期；/＞是第/＞+1个RR间期；其中，CVSD是疼痛受试者脉搏波连续差异的变化系数，是第/＞个RR间期；其中，CVnni是疼痛受试者脉搏波连续差异的变异系数，是第/＞个RR间期；HRV频域分析反映交感神经与副交感神经各自的活动，进行HRV频域分析使用如下方法：其中，TE代表疼痛受试者脉搏波在频率范围内的总体能量，单位是；PSD是功率谱密度，表示在频率f处的功率；其中，LF表示疼痛受试者脉搏波在频率范围  内的低频能量，/＞和/＞都是正小数；其中，LFnu表示疼痛受试者脉搏波在频率范围  内的归一化低频能量；其中，HF表示疼痛受试者脉搏波在频率范围  内的高频能量，/＞和/＞都是正小数；其中，HFnu表示疼痛受试者脉搏波在频率范围  内的归一化高频能量；进行HRV非线性分析，使用庞加莱图，对于一段连续的心跳间隔，将第r个心跳间隔作为横坐标，第r+1个心跳间隔作为纵坐标，在二维平面画出散点图，使用到的公式如下：其中，SD1是椭圆的半长轴，E是心跳间隔序列的长度，是时间序列的第r个数据点；其中，SD2是椭圆的半短轴；根据步骤S306，使用随机森林算法对计算得到的HRV特征进行分类，输入为步骤S305经过HRV时域分析、HRV频域分析和HRV非线性分析所得的所有特征向量；预测值为疼痛等级标签，在过程中提供有关每个特征重要性的信息；收集BioVid数据集，该疼痛数据集标签为五级分类。BioVid数据集共包括90名受试者，来自三个年龄组。每个实验对象的右臂被诱导出四种不同强度的疼痛。同时记录皮肤电导水平、心电图、肌电图和脑电图等心理信号。BioVid数据集数据为五级分类，即在疼痛阈值，刚能感觉到疼痛时的温度；耐受阈值，能接受的最大温度；两个中间级别温度，根据疼痛阈值以及耐受阈值计算得到；基准温度，不施加温度时记录的视频；五种状态下记录的视频，即都是视频级别的标签，且标签为施加的温度的等级。随机森林是一种集成学习算法，通过整合多个决策树来进行分类或回归任务。将上述计算得到的所有hrv特征作为预测依据出入随机森林模型，预测结果为疼痛等级。之后分析在此次预测过程中各个特征为随机森林模型得到预测结果做出的贡献，从而得到各个特征的重要性，分析原理如下：基于不纯度的减少：在每个决策树的构建过程中，当一个节点被分裂时，根据分裂前后节点的不纯度的减少来评估分裂的好坏，分裂前后节点的不纯度通常是 Gini 不纯度或信息熵。而每次分裂都涉及到选择一个特征进行划分。特征的分裂贡献：当一个特征被选择进行节点分裂时，该特征对不纯度的减少越大，说明该特征越重要，因为它在决策树的构建中起到了更大的作用。累积特征重要性：在随机森林中，对于每个决策树，每个特征都有一个相应的不纯度减少。随机森林将每个决策树的贡献进行平均或加权平均，得到了每个特征的累积重要性。Gini 减少或信息增益：在评估特征重要性时，通常使用的度量是 Gini 减少或信息增益。Gini 减少是指节点不纯度的减少量，信息增益是指使用某个特征进行分裂后整体数据集纯度的提高。重要性的标准化：最终，得到的每个特征的不纯度减少值可以被标准化，以便比较它们的相对重要性。总之我们根据随机森林算法的信息增益特性，将能提高信息增益的特征视为对疼痛具有代表性特征。根据步骤S400，在实现双支路的特征级融合时，计算面部表情支路中C3D网络的全连接层与非接触生理信号支路在特征级融合期间的权重分配，进行疼痛识别，步骤如下：S401、从系统中获取人脸采集视频的时长Time和历史数据中的疼痛等级标签，其中Time的单位为秒；S402、利用历史数据中的疼痛等级标签的OPI评级与对应的用户填写的疼痛等级/＞，其中，/＞为疼痛等级标签的数量；计算历史数据中的疼痛等级标签的OPI评级与用户填写的疼痛等级之间的等级差异；S403、用户设定标准等级差异Q，筛选中小于Q的值组成优选疼痛等级标签的OPI评级，其中/＞为优选疼痛等级标签的数量；S404、根据优选疼痛等级标签的OPI评级获得对应的优选人脸采集视频时长和优选权重分配，其中，/＞到/＞分别为优选疼痛等级标签的OPI评级从/＞到/＞对应的人脸采集视频时长，/＞到分别为优选疼痛等级标签的OPI评级从/＞到/＞对应的表情支路中C3D网络的全连接层的权重，/＞到/＞分别为优选疼痛等级标签的OPI评级从/＞到对应的/＞支路的权重；S405、根据优选人脸采集视频时长，获取优选人脸采集视频时长的中位数/＞，其中/＞，/＞到/＞的单位为秒；S406、将Time与进行比较，并结合优选权重分配计算非接触生理信号支路的权重/＞和表情支路中C3D网络的全连接层的权重/＞；定义权重调整常量/＞，表示Time与进行比较时的权重调整参数，/＞越大，/＞越大；/＞的计算公式如下：其中，是每个优选视频的视频时长与初始表情支路中C3D网络的全连接层的权重分配的关系的平均值，公式如下：通过，计算优选非接触生理信号支路的权重，公式如下：根据得到的权重调整常量，计算/＞和/＞，公式如下：其中，当时，/＞增大，/＞减小；反之，当时，/＞减小，/＞增大；S407、使用交叉熵损失函数计算C3D网络输出的概率分布与视频对应的疼痛类别之间的交叉熵损失；S408、使用随机梯度下降优化器，设置动量参数和正则化项系数；S409、进行学习率调度，设置初始学习率和学习率衰减方法；S410、在训练集上使用C3D网络进行训练，通过反向传播和优化器更新权重；S411、选择C3D网络输出概率分布中最大概率对应的类别作为疼痛预测结果，根据视频对应的疼痛类别和C3D网络预测进行计算，获取C3D网络评估参数。根据步骤S407，在二分类的情况下，C3D网络需要预测的结果为疼痛和无痛两种情况，对于两个类别的预测得到的概率为 p 和 1-p ，此时表达式为：其中，CrossEntropyLoss是二分类下的交叉熵损失函数；N表示训练时一个迭代中的疼痛数据集视频数量；表示第i个视频的标签，无痛时为0，疼痛时为1；/＞表示第i个视频被预测为疼痛时的概率；在多分类的情况下，作为二分类的拓展，此时表达式为：其中，CrossEntropyLoss’是多分类下的交叉熵损失函数；C是疼痛数据标签类别的总数量；是一个指示函数，表示第i个视频是否属于疼痛类别j，如果是，则/＞为1，否则，/＞为0；/＞是C3D网络将第i个视频预测为疼痛类别j的概率；所述损失函数的目标是最小化C3D网络对于每个样本疼痛类别的负对数概率，C3D网络对疼痛数据的预测接近实际疼痛类别时，损失趋向于零，反映C3D网络对疼痛程度的准确预测；否则，损失增加，表明C3D网络对疼痛程度的预测偏离实际情况。根据步骤S408，使用随机梯度下降优化器，设置梯度的改变量，即动量为v，动量参数为momentum，正则化项系数为weight_decay，其中momentum和weight_decay为正小数；权重更新如下式所示：其中，是C3D网络在第t+1次迭代中的参数值；/＞是C3D网络在第t次迭代中的参数值；L是损失函数关于/＞的梯度；/＞是学习率，是一个超参数，用于调整C3D网络在每次/＞更新时的步长。根据步骤S409，初始学习率设置为A，每十个epoch衰减为B，衰减两次后不再衰减，其中A和B是正小数；衰减如下式，新学习率的值为旧学习率的B倍：其中，是C3D网络衰减后新的学习率，/＞是衰减前的旧学习率。在深度学习中，一个 epoch 表示模型训练过程中，使用整个训练数据集进行一次前向传播和反向传播的过程。在一个 epoch 中，模型会遍历整个训练数据集，将每个样本都用于参数更新。一般而言，一个 epoch 包含了多个训练批次。根据步骤S410，监控模型在验证集上的性能，以确定是否需要调整学习率或模型结构。根据步骤S411，根据视频对应的疼痛类别和C3D网络预测计算评估参数，计算准确率Acc、精确率P、召回率R和F1值，最后将计算出的值取平均得到C3D网络评估参数G；在二分类的情况中，公式如下：其中，TP是真正类，表示C3D网络将疼痛视频正确地预测为疼痛类别的数量；TN是真负类，表示C3D网络将无痛视频正确地预测为无痛类别的数量；FP是假正类，表示C3D网络错误地将无痛视频预测为疼痛类别的数量；FN是假负类，表示C3D网络错误地将疼痛视频预测为无痛类别的数量；在多分类的情况中，公式如下：其中,TPi、TNi、FPi、FNi分别是第 i 个类别的 TP、TN、FP、FN的数量；最终，获取C3D网络评估参数，公式如下：其中，G是C3D网络评估参数。基于数据分析的视频非接触测量疼痛识别系统包括：人人脸检测模块：通过人脸视频采集进行人脸检测，获取人脸识别特征，建立面部表情支路和非接触生理信号支路；面部表情支路处理模块：在面部表情支路中，进行尺寸归一化和灰度化处理，将处理后的图像输入C3D网络；非接触生理信号支路处理模块：非接触生理信号支路选择额头和脸颊作为感兴趣区域，进行通道分离、像素均值计算、小波变换和带通滤波，获取rPPG信号；对rPPG信号进行峰值点检测获取RR间期，基于RR间期进行HRV时域、频域和非线性分析；通过随机森林算法实现基于rPPG信号的疼痛等级预测，筛选出最具代表性的特征；特征级融合模块：将面部表情支路中C3D网络的全连接层输出的特征向量与非接触生理信号支路筛选出的最具代表性的手工特征进行拼接，计算面部表情支路中C3D网络的全连接层与非接触生理信号支路的权重分配，实现双支路的特征级融合，进行疼痛识别。与现有技术相比，本发明所达到的有益效果是：本发明采用面部表情支路和非接触生理信号支路相结合的方式，融合了视觉和生理信号两种不同的信息来源，有助于更全面地捕捉疼痛相关的特征，这样的多模态融合能够提高模型对于疼痛状态的准确性。本发明通过非接触生理信号支路对生理信号进行详细分析，包括通道分离、小波变换和带通滤波等步骤，有助于提取生理信号中的有用信息，随机森林算法的应用进一步增强了对rPPG信号的挖掘能力，筛选出最具代表性的特征。本发明采用特征级融合的方法，通过拼接面部表情支路和非接触生理信号支路的特征，实现了更高层次的信息融合，通过计算全连接层与非接触生理信号支路的权重分配，进一步提高了模型对于不同特征的灵活性和适应性。附图说明附图用来提供对本发明的进一步理解，并且构成说明书的一部分，与本发明的实施例一起用于解释本发明，并不构成对本发明的限制。在附图中：图1是本发明基于数据分析的视频非接触测量疼痛识别方法的流程示意图；图2是本发明基于数据分析的视频非接触测量疼痛识别方法的面部表情支路的具体实现流程图；图3是本发明基于数据分析的视频非接触测量疼痛识别方法的小波分解示意图；图4是本发明基于数据分析的视频非接触测量疼痛识别方法的基于特征级融合的疼痛识别网络图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。请参阅图1-图4，本发明提供技术方案：根据本发明的一个实施例，如图1基于数据分析的视频非接触测量疼痛识别方法的流程示意图所示，基于数据分析的视频非接触测量疼痛识别方法，步骤如下：S100、通过人脸视频采集进行人脸检测，获取人脸识别特征，建立面部表情支路和非接触生理信号支路；S200、在面部表情支路中，进行尺寸归一化和灰度化处理，将处理后的图像输入C3D网络；S300、非接触生理信号支路选择额头和脸颊作为感兴趣区域，进行通道分离、像素均值计算、小波变换和带通滤波，获取rPPG信号；对rPPG信号进行峰值点检测获取RR间期，基于RR间期进行HRV时域、频域和非线性分析；通过随机森林算法实现基于rPPG信号的疼痛等级预测，筛选出最具代表性的手工特征；S400、将面部表情支路中C3D网络的全连接层输出的特征向量与非接触生理信号支路筛选出的最具代表性的手工特征进行拼接，计算面部表情支路中C3D网络的全连接层与非接触生理信号支路的权重分配，实现双支路的特征级融合，实现疼痛识别。如图2基于数据分析的视频非接触测量疼痛识别方法的面部表情支路的具体实现流程图所示，C3D模型具有8个卷积层，5个池化层，2个全连接层，1个Softmax输出层。所有卷积核均为3×3×3。第一个Pooling层1×2×2，Stride=1×2×2，之后都是2×2×2，Stride=2×2×2。在面部表情支路中，每个卷积层Conv和全连接层fc之后都进行ReLU激活函数操作，全连接层在经过激活函数后，添加dropout操作，以减少过拟合风险。视频帧经过人脸检测以及尺度归一化后变为尺度112×112的人脸图像，每6帧采样后，将16帧连续的采样后图像输入模型，当batch_size为1时，此时的tensor形状为，四个数字分别代表通道数、帧数、图像帧宽和高，表1为网络各层输出形状表。表1 网络各层输出形状表Fc8也就是模型最后一层的全连接层，它的输出是模型对输入数据的预测输出，表示模型对每个类别的预测得分。之后经过softmax操作转化为概率分布，使得所有类别预测概率的总和为1。最大概率所在类别即为模型预测的结果，便于计算准确度等值。根据步骤S200，细化步骤如下：S201、获取包含疼痛和非疼痛样本的视频数据集，进行尺度归一化和灰度化处理；S202、基于获取的视频数据集进行数据批处理，按照每t0帧进行采样，将t帧的连续采样后的图像输入C3D网络，其中t0和t都是正整数，保持张量形状为，其中channel是通道数，t是连续采样后的图像帧数，h是图像的高度，w是图像的宽度。根据步骤S300，细化步骤如下：S301、通过获取相应的关键点坐标，创建一个掩码，并将掩码和原始图像做与运算，从而提取感兴趣区域；S302、将面部ROI图片分离为红色、绿色、蓝色三个单通道图像，通过计算每个通道内ROI的像素均值得到三个包含面部生理信号的一维时间序列，选择绿色通道的一维时间序列作为rPPG的原始信号；S303、选取db8小波基对绿色通道rPPG源信号进行分解去噪，对源信号进行五层小波分解；脉搏波信号集中在CD3、CD4，将CD3、CD4这两层信号结果进行叠加，作为去除基线漂移后的小波重构波形；为脉搏波信号设置带通滤波器，满足人体心跳的变化范围；S304、经过小波变换后得到信号结果，横坐标为时间，纵坐标为像素均值，对像素均值进行了归一化处理；S305、对rPPG信号进行峰值点检测获取RR间期，基于RR间期进行HRV时域分析、HRV频域分析和HRV非线性分析，得到特征向量；S306、通过随机森林算法实现基于rPPG信号的疼痛等级预测，筛选出最具代表性的手工特征。根据步骤S302，在皮肤中，黑色素对于波长较短的光波有着强烈的吸收作用，而血红蛋白在500~600 nm波段内对可见光的吸收最为显著，对应于黄绿色光谱。因此，绿色通道的信号更能够准确地反映心脏的周期性变化。在本实施例中，我们选择绿色通道的信号作为rPPG的原始信号。如图3基于数据分析的视频非接触测量疼痛识别方法的小波分解示意图所示，根据步骤S303，选取db8小波基对绿色通道rPPG源信号进行分解去噪，当视频帧率为30 Hz时，则rPPG源信号的频率范围为0~15 Hz，对源信号进行五层小波分解。本发明为脉搏波信号设置带通滤波器，脉搏波信号通频带设置为0.7~3 Hz，对应心跳频率为42~180 bmp，可以满足短时间内人体心跳的变化范围。根据步骤S305，得到的部分公式如下：其中，PNN50代表相邻RR间期之差大于50ms的心搏数占RR间期总数的百分比，反映副交感神经的活动；NN50是相邻RR间期之差大于50ms的心搏数；其中，PNN20代表相邻RR间期之差大于20ms的心搏数占RR间期总数的百分比，反映副交感神经的活动；NN20是相邻RR间期之差大于20ms的心搏数；其中，PNN25代表相邻RR间期之差大于25ms的心搏数占RR间期总数的百分比，反映副交感神经的活动；NN25是相邻RR间期之差大于25ms的心搏数；HRV频域分析反映交感神经与副交感神经各自的活动，进行HRV频域分析使用如下方法：其中，TE代表疼痛受试者脉搏波在频率范围内的总体能量，单位是；PSD是功率谱密度，表示在频率f处的功率；其中，LF表示疼痛受试者脉搏波在频率范围  内的低频能量；其中，LFnu表示疼痛受试者脉搏波在频率范围  内的归一化低频能量；其中，HF表示疼痛受试者脉搏波在频率范围  内的高频能量；其中，HFnu表示疼痛受试者脉搏波在频率范围  内的归一化高频能量；其中，TE的频率范围为0~0.4Hz，LFnu的频率范围为0.04~0.15Hz，HFnu的频率范围为0.15~0.4Hz。由于心脏的搏动并不完全是规律的运动，因此非线性特征被加入到特征提取之中。进行HRV非线性分析，使用庞加莱图，对于一段连续的心跳间隔，将第r个心跳间隔作为横坐标，第r+1个心跳间隔作为纵坐标，在二维平面画出散点图，使用到的公式如下：其中，SD1是椭圆的半长轴，E是数据点的数量，是时间序列的第r个数据点；其中，SD2是椭圆的半短轴。SD1的意义是与恒等线垂直的庞加莱图标准差，SD2的意义是沿恒等线的庞加莱图标准差。根据步骤S306，使用随机森林算法对计算得到的HRV特征进行分类，HRV表示心率变异性，输入为计算所得特征向量，预测值为疼痛等级标签，在过程中提供有关每个特征重要性的信息。构建随机森林模型时，将计算的所有特征输入随机森林模型。在第一次分类任务训练中通过分析特征的重要性得分，了解哪些特征对于模型的性能贡献较大。选择重要性排名前几的特征。作为在后续分类任务中的输入特征。这一思路用于特征选择，可以帮助提高模型的解释性、降低在此过程以及后续融合时过拟合的风险，并提高模型的泛化能力。本实施例所用的疼痛等级标签来自于数据集，数据集中疼痛发生主要分为两大类，外部刺激类和自身疼痛诱发类。目前公共数据集中使用最多的两个数据集为BioVid数据集和UNBC肩痛数据集。本实施例所用为BioVid数据集。BioVid数据集为五级分类，即在疼痛阈值、耐受阈值、两个中间级别温度以及基准温度，五种状态下记录的视频。即都是视频级别的标签，且标签为施加的温度的等级。在模型训练及预测等过程中，五级疼痛用0，1，2，3，4指代。本实施例进行了二分类和三分类任务，具体不同之处在于所用数据，及表情支路模型最后一层classes按照分类数量变化；非接触生理信号支路随机森林模型会按照输入数据的标签种类数量进行相应的分类任务。如图4基于数据分析的视频非接触测量疼痛识别方法的基于特征级融合的疼痛识别网络图，根据步骤S400，在实现双支路的特征级融合时，计算表情支路中C3D网络的全连接层与非接触生理信号支路在特征级融合期间的权重分配，进行疼痛识别，步骤如下：S401、从系统中获取人脸采集视频的时长Time和历史数据中的疼痛等级标签，其中Time的单位为秒；S402、利用历史数据中的疼痛等级标签的OPI评级与对应的用户填写的疼痛等级/＞，其中，/＞为疼痛等级标签的数量；计算历史数据中的疼痛等级标签的OPI评级与用户填写的疼痛等级之间的等级差异；S403、用户设定标准等级差异Q，筛选中小于Q的值组成优选疼痛等级标签的OPI评级，其中/＞为优选疼痛等级标签的数量；S404、根据优选疼痛等级标签的OPI评级获得对应的优选人脸采集视频时长和优选权重分配，其中，/＞到/＞分别为优选疼痛等级标签的OPI评级从/＞到/＞对应的人脸采集视频时长，/＞到分别为优选疼痛等级标签的OPI评级从/＞到/＞对应的表情支路中C3D网络的全连接层的权重，/＞到/＞分别为优选疼痛等级标签的OPI评级从/＞到对应的/＞支路的权重；S405、根据优选人脸采集视频时长，获取优选人脸采集视频时长的中位数/＞，其中/＞，/＞到/＞的单位为秒；S406、将Time与进行比较，并结合优选权重分配计算非接触生理信号支路的权重/＞和表情支路中C3D网络的全连接层的权重/＞；定义权重调整常量/＞，表示Time与进行比较时的权重调整参数，/＞越大，/＞越大；/＞的计算公式如下：其中，是每个优选视频的视频时长与初始表情支路中C3D网络的全连接层的权重分配的关系的平均值，公式如下：/＞通过，计算优选非接触生理信号支路的权重，公式如下：根据得到的权重调整常量，计算/＞和/＞，公式如下：其中，当时，/＞增大，/＞减小；反之，当时，/＞减小，/＞增大；S407、使用交叉熵损失函数计算C3D网络输出的概率分布与视频对应的疼痛类别之间的交叉熵损失；S408、使用随机梯度下降优化器，设置动量参数和正则化项系数；S409、进行学习率调度，设置初始学习率和学习率衰减方法；S410、在训练集上使用C3D网络进行训练，通过反向传播和优化器更新权重；S411、选择C3D网络输出概率分布中最大概率对应的类别作为疼痛预测结果，根据视频对应的疼痛类别和C3D网络预测进行计算，获取C3D网络评估参数。根据步骤S407，在二分类的情况下，C3D网络需要预测的结果为疼痛和无痛两种情况，对于两个类别的预测得到的概率为 p 和 1-p ，此时表达式为：其中，CrossEntropyLoss是二分类下的交叉熵损失函数；N表示训练时一个迭代中的疼痛数据集视频数量；表示第i个视频的标签，无痛时为0，疼痛时为1；/＞表示第i个视频被预测为疼痛时的概率；在多分类的情况下，作为二分类的拓展，此时表达式为：其中，CrossEntropyLoss’是多分类下的交叉熵损失函数；C是疼痛数据标签类别的总数量；是一个指示函数，表示第i个视频是否属于疼痛类别j，如果是，则/＞为1，否则，/＞为0；/＞是C3D网络将第i个视频预测为疼痛类别j的概率；所述损失函数的目标是最小化C3D网络对于每个样本疼痛类别的负对数概率，C3D网络对疼痛数据的预测接近实际疼痛类别时，损失趋向于零，反映C3D网络对疼痛程度的准确预测；否则，损失增加，表明C3D网络对疼痛程度的预测偏离实际情况。/＞根据步骤S408，使用随机梯度下降优化器，设置动量参数为momentum，正则化项系数为weight_decay，其中momentum和weight_decay为正小数；权重更新如下式所示：其中，是C3D网络在第t+1次迭代中的参数值；/＞是C3D网络在第t次迭代中的参数值；L是损失函数关于/＞的梯度；/＞是学习率，是一个超参数，用于调整C3D网络在每次/＞更新时的步长。根据步骤S409，初始学习率设置为1e-3，每十个epoch衰减为0.8，衰减两次后不再衰减；衰减如下式，新学习率的值为旧学习率的0.8倍：其中，是疼痛识别模型衰减后新的学习率，/＞是衰减前的旧学习率。根据步骤S411，根据视频对应的疼痛类别和C3D网络预测计算评估参数，计算准确率Acc、精确率P、召回率R和F1值，最后将计算出的值取平均得到C3D网络评估参数G。在本实施例中，在 Scikit-learn 中，随机森林模型的特征重要性信息可以通过模型的 feature_importances_ 属性获得。通过该算法，我们能够深入了解每个HRV特征对分类结果的贡献程度，进而筛选出具有代表性的特征：SDSD：相邻RR间期差异的标准差，RMSSD：相邻RR间期差异的均方根，pNN25：相邻RR间期差异超过25毫秒的比例，pNN50：相邻RR间期差异超过50毫秒的比例，RRmean RR：间期的平均值，RRSTD：RR间期的标准差，RRMax：RR间期的最大值，RRMed：RR间期的中位数，RRMin：RR间期的最小值，LF：心率变异功率谱中的低频带，HF：心率变异功率谱中的高频带，LF/HF：LF 与 HF 的比值，SD1：Poincaré图中垂直于直线的标准差，SD2：Poincaré 图中沿着直线的标准差，SD2/SD1：SD2与 SD1 的比值。根据本发明的另一个实施例，基于数据分析的视频非接触测量疼痛识别系统包括：人脸检测模块：通过人脸视频采集进行人脸检测，获取人脸识别特征，建立面部表情支路和非接触生理信号支路；面部表情支路处理模块：在面部表情支路中，进行尺寸归一化和灰度化处理，将处理后的图像输入C3D网络进行疼痛识别任务，优化C3D网络，生成疼痛预测结果；非接触生理信号支路处理模块：非接触生理信号支路选择额头和脸颊作为感兴趣区域，进行通道分离、像素均值计算、小波变换和带通滤波，获取rPPG信号；对rPPG信号进行峰值点检测获取RR间期，基于RR间期进行HRV时域、频域和非线性分析；通过随机森林算法实现基于rPPG信号的疼痛识别，筛选出最具代表性的特征；特征级融合模块：将面部表情支路中C3D网络的全连接层输出的特征向量与非接触生理信号支路筛选出的最具代表性的手工特征进行拼接，计算表情支路中C3D网络的全连接层与非接触生理信号支路的权重分配，实现双支路的特征级融合。在表情支路中输入为16帧图像。特征级融合时，在C3D模型中，命名为Fc6的全连接层本身及之前输出保持不变，fc6输出形状仍为，将其与非接触生理信号支路提取的形状为的手工特征进行拼接，此时形状变为。以此实现表情和生理支路特征的融合。fc7输出形状：；fc8输出形状：。需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。最后应说明的是：以上所述仅为本发明的优选实施例而已，并不用于限制本发明，尽管参照前述实施例对本发明进行了详细的说明，对于本领域的技术人员来说，其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
