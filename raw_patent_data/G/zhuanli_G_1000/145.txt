标题title
一种SM2私钥授权码快速验证方法及其应用
摘要abst
本发明公开一种SM2私钥授权码快速验证方法及其应用，根据不同的对称密钥加密或解密相同数据所得加密密文或解密明文也必然不同的原理，应用运算命令逻辑通道，充分利用CCP907T安全芯片算法安全引擎的独立于CPU的硬件算法自主调度能力，实现减少CPU资源消耗的同时可以支持并行处理私钥授权码验证的方法。解决基于CCP907T安全芯片的密码卡的获取私钥使用权限接口中私钥授权码验证消耗大量CPU资源且不能并行处理的技术问题，可显著提升在多线程应用中的性能。
权利要求书clms
1.一种SM2私钥授权码快速验证方法，其特征为：首先进行初始化：主机通过管理命令逻辑通道，执行密钥产生管理命令，密码卡产生索引号为ID1的密钥数据结构；执行获取密钥地址管理命令，主机获取各个索引号的密钥地址结构；然后执行下面步骤：步骤S1：主机通过运算命令逻辑通道，使用密码卡对私钥授权码A1进行杂凑运算，获取杂凑值为B1；步骤S2：主机将杂凑值B1处理到对称算法的密钥长度，得到C1作为密钥值；步骤S3：主机通过所述运算命令逻辑通道，使用密码卡，以密钥值C1作为对称密钥，以D1为待处理数据，进行对称运算，获得运算结果E1；步骤S4：主机通过私钥索引号ID1从各个索引号的密钥地址结构中得到密码卡内相同索引号的密钥数据结构中的对称密钥C2的内存地址值addr；步骤S5：主机通过所述运算命令逻辑通道，使用密码卡，以步骤S4所述的对称密钥C2的内存地址值addr为对称密钥的内存地址值，以D1为待处理数据，进行对称运算，获得运算结果E2；所述私钥索引号ID1为获取私钥使用权限接口的入参；步骤S6：主机对比E1和E2数据是否相等，相等则私钥授权码验证通过，不相等则私钥授权码验证不通过。2.根据权利要求1所述的一种SM2私钥授权码快速验证方法，其特征为：执行初始化过程进一步包括如下内容：主机通过管理命令逻辑通道，发送密钥产生管理命令、索引号ID1和私钥授权码A2到所述密码卡，密码卡根据密钥产生管理命令，产生指定索引号ID1的密钥数据结构到密码卡的内存并保存到密码卡的存储器，并返回密钥产生管理命令执行结果到主机；所述密钥数据结构包括一个索引号、一个签名密钥对、一个加密密钥对和一个对称密钥C2；所述索引号ID1为一个范围从1开始的正整数，最大值根据密码卡的密钥能力确定；所述签名密钥对包括一个私钥和一个公钥，私钥用于对数据进行签名，公钥用于验证签名的有效性；所述加密密钥对包括一个私钥和一个公钥，公钥用于加密数据，私钥用于解密数据；所述对称密钥C2为密码卡对A2进行杂凑运算得到杂凑值B2，对B2经过步骤S2中的所述处理得到的数据，C2用作私钥授权码验证过程中的对称运算的对称密钥，加密或者解密待处理数据D1；所述密码卡持久化保存的值为C2，不会保存和直接使用A2，避免直接明文存储私钥授权码A2，同时省略私钥授权码验证过程中将A2重新进行杂凑运算并处理得到C2的过程，使得所述主机在初始化步骤中提前获取密码卡中各个索引号的密钥数据结构中的对称密钥的内存地址；在步骤S1中所述的杂凑运算的算法与对A2进行的杂凑运算的算法一致；在主机调用获取私钥使用权限接口之前，主机通过管理命令逻辑通道，发送获取密钥地址管理命令给密码卡，密码卡将内存中的各个索引号的密钥数据结构中的对称密钥的内存地址和索引号通过管理命令逻辑通道返回主机，主机即可获得与密码卡内各个索引号的密钥数据结构对应的各个索引号的密钥地址结构；所述密钥地址结构包括一个索引号和一个对称密钥内存地址，所述索引号与所述密钥数据结构中的索引号含义相同，所述对称密钥内存地址为与其所属密钥地址结构中索引号相同的密码卡内密钥数据结构中对称密钥的内存地址；所述内存地址是内存中每个存储单元的唯一标识符，通过内存地址可以唯一访问和定位内存中的数据。3.根据权利要求1所述的一种SM2私钥授权码快速验证方法，其特征为：所述步骤S1中，所述私钥授权码A1为获取私钥使用权限接口的入参；所述杂凑运算是把任意长度的输入数据变化成较短的固定长度的杂凑值的一种函数，变化过程是单向的，逆向操作难以完成，两个不同的输入数据产生不相同的杂凑值，两个相同的输入数据产生相同的杂凑值；所述获取私钥使用权限接口为《密码设备应用接口规范GM/T 0018-2012》行业标准中设备管理类函数里的一个功能是获取密码卡内指定索引号的密钥数据结构中签名密钥对的私钥和加密密钥对的私钥的使用权的函数，其函数名称为SDF_GetPrivateKeyAccessRight，函数入参包括密码卡内存储私钥的索引号，记为ID1、待验证的私钥授权码，记为A1；函数原理是判断入参私钥授权码A1是否正确，正确则获取私钥使用权限成功，否则失败；所述杂凑运算的算法与初始化步骤中密钥产生时设置的私钥授权码A2使用的杂凑运算的算法一致，作用是在杂凑算法一致的情况下，根据A1和A2的杂凑值B1和B2是否相同判断A1和A2是否相同，B1和B2相同则A1和A2相同；所述杂凑运算的算法包括但不限于SM3、SHA1、SHA256、SHA384、SHA512等CCP907T安全芯片支持的杂凑算法。4.根据权利要求1所述的一种SM2私钥授权码快速验证方法，其特征为：所述步骤S2中，所述处理包括填充、压缩或不处理；所述对称算法为步骤S3中的对称运算算法；处理包括：当密钥长度大于杂凑值B1长度时，对杂凑值B1进行填充得到密钥值C1；当密钥长度小于杂凑值B1长度时，对杂凑值B1进行压缩得到密钥值C1；当密钥长度等于杂凑值B1的长度时，密钥值C1则为杂凑值B1。5.根据权利要求1所述的一种SM2私钥授权码快速验证方法，其特征为：所述步骤S3中，所述对称运算为所述主机将对称密钥C1、待处理数据D1、对称运算的算法标识、对称运算的模式标识、对称运算的操作标识和IV值，通过所述运算命令逻辑通道传递给所述密码卡，所述密码卡根据收到的算法标识和模式标识，使用相应对称运算的算法和模式，以C1为对称密钥，根据操作标识对D1进行相应操作得到运算结果E1，E1通过所述运算命令逻辑通道返回到所述主机；所述对称运算的算法包括但不限于SM1、SM4、AES、DES、3DES等CCP907T安全芯片支持的对称算法；所述对称运算的操作包括加密操作、解密操作；当对称运算的操作为加密操作时，D1为待加密明文，E1为加密密文；当对称运算的操作为解密操作时，D1为待解密密文，E1为解密明文；所述D1为预先设置的长度和内容固定不变数据，作用是在确保待处理数据D1是固定不变的情况下，两次加密或解密的对称运算结果不一致时，即可排除是待处理数据D1的影响，判断为对称运算的算法、模式、IV值或对称密钥的不一致导致的；所述D1和E1的长度均为所述对称运算的算法的分组长度，所述分组长度是在加密或解密过程中，将待处理数据分成固定长度的分组进行处理的长度；所述对称运算的模式包括但不限于ECB、CBC、CFB、OFB等CCP907T安全芯片支持的对称算法模式；所述对称运算的模式为除ECB外的其它模式时，以预先设置的长度和内容固定的数据V1为对称运算的IV值；所述IV值，也称初始化向量，是在对称运算中使用的一种参数，是一个固定长度的消息串，作用是对称运算时，算法、模式、待处理数据和对称密钥相同时，由于 IV 值的不同，相同操作的对称运算结果也会不同；所述V1为长度和内容固定的消息串，作用是在确保IV值V1是固定不变的情况下，当两次加密或解密的对称运算结果不一致时，即可排除是IV值的影响，可判断为对称运算的算法、模式、待处理数据或对称密钥的不一致导致的；所述C1作为对称密钥的作用是在确保对称运算的算法、模式、IV值V1和待处理数据D1是相同的情况下，当两次加密或解密的对称运算结果不一致时，可判断是两次对称运算的对称密钥不同导致的。6.根据权利要求1所述的一种SM2私钥授权码快速验证方法，其特征为：所述步骤S4中，主机通过遍历各个索引号的密钥地址结构，找到其中索引号与所述获取私钥使用权限接口的入参私钥索引号ID1相同的密钥地址结构，该密钥地址结构中的对称密钥内存地址，记为addr，即为密码卡的内存中相同索引号的密钥数据结构中的对称密钥C2的内存地址；所述各个索引号的密钥地址结构是初始化步骤中所述主机通过管理命令逻辑通道从所述密码卡中获取的。7.根据权利要求1所述的一种SM2私钥授权码快速验证方法，其特征为：所述步骤S5中，主机将对称密钥C2的内存地址addr、待处理数据D1、对称运算的算法标识、对称运算的模式标识、对称运算的操作标识和IV值V1，通过所述运算命令逻辑通道传递给密码卡，密码卡根据收到的算法标识和模式标识，使用相应对称运算的算法和模式，以C2的内存地址addr定位并获取到密码卡的内存中C2的数据并将其作为对称运算的对称密钥，根据操作标识对D1进行相应操作得到运算结果E2，E2通过所述运算命令逻辑通道返回到主机；所述对称运算的算法与所述步骤S3中所述对称运算的算法一致；所述对称运算的操作与所述步骤S3中所述对称运算的操作一致；所述对称运算的模式与所述步骤S3的对称运算的模式一致；所述对称运算的模式需要IV值时，以预先设置的长度和内容固定数据V1为对称运算的IV值。8.根据权利要求1所述的一种SM2私钥授权码快速验证方法，其特征为：所述步骤S6中，具体操作如下，所述步骤S3和所述步骤S5中所述的对称运算的算法、模式、操作、IV值均相同，则根据对称运算的结果E1和E2是否相同就可以体现作为对称密钥的C1和C2是否相同；由于初始化步骤中A2得到C2进行的杂凑运算的算法和处理与在步骤S1和S2中A1得到C1进行的杂凑运算的算法和处理均相同，则根据C1和C2是否相同就可以体现私钥授权码A1和A2是否相同。9.一种非易失性存储介质，其特征在于，所述非易失性存储介质包括存储的程序，其中，所述程序运行时控制非易失性存储介质所在的设备执行权利要求1至8中任意一项所述的方法。10.一种电子装置，其特征在于，包含处理器和存储器；所述存储器中存储有计算机可读指令，所述处理器用于运行所述计算机可读指令，其中，所述计算机可读指令运行时执行权利要求1至8中任意一项所述的方法。
说明书desc
技术领域本发明涉及计算机技术领域和密码安全领域，具体为一种SM2私钥授权码快速验证方法及其应用。背景技术目前，SOC芯片广泛用于与PCI-E密码卡产品。PCI-E密码卡采用的SOC芯片支持相应的密码算法，例如苏州国芯科技有限公司的CCP907T芯片具有的算法安全引擎为实现各种密码算法的协处理器。PCI-E密码卡支持的应用接口的性能高低是其市场竞争力的关键因素。例如，《密码设备应用接口规范GM/T 0018-2012》行业标准中所规定的应用接口广泛应用于国密领域，其主要分为运算类接口和管理类接口。管理类接口中的获取私钥使用权限接口是运算类接口中使用私钥进行运算接口的前置调用接口，因此具备高性能的获取私钥使用权限接口也是满足市场需求的关键。由于芯片特性，基于CCP907T芯片的PCI-E密码卡与主机物理连接后可通过运算命令逻辑通道并行处理运算命令，但通过管理命令逻辑通道只能串行处理管理命令。在多线程的应用场景中管理命令的处理性能将明显低于运算命令的处理性能。现有技术方案：1）基于CCP907T芯片的密码卡与主机通过PCI-E接口物理连接；2）主机通过管理命令逻辑通道，将获取私钥使用权限作为管理命令发送给密码卡的CCP907T芯片处理，管理命令包括私钥授权管理命令的标识码、私钥索引号和私钥授权码；3）芯片首先判断管理命令标识码是否与私钥授权管理命令标识码一致，一致后执行私钥授权码验证操作：使用芯片中的算法安全引擎去计算主机发送的私钥授权码的杂凑值；根据私钥索引号获取相应私钥索引位的私钥授权码的杂凑值；对比A与B是否相等，相等则通过私钥授权码验证，否则验证不通过；芯片将验证结果作为管理命令的返回发送到主机。4）主机根据验证结果决定获取私钥使用权限是否成功。验证通过则获取私钥使用权限成功，验证不通过则获取私钥使用权限失败。其中2）和3）步骤为获取私钥使用权限接口中的私钥授权码验证方法的现有技术方案。现有私钥授权码验证技术方案是应用管理命令逻辑通道，通过密码卡的CPU对私钥授权码进行操作来完成验证，需要消耗大量的CPU资源，且只能串行处理。在多线程调用获取私钥使用权限接口的应用中会进一步凸显该接口性能低、耗时长的缺陷。发明内容鉴于以上所述现有技术的缺点，本发明的目的在于提供一种SM2私钥授权码快速验证方法，根据不同的对称密钥加密或解密相同数据所得加密密文或解密明文也必然不同的原理，应用运算命令逻辑通道，充分利用CCP907T安全芯片算法安全引擎的独立于CPU的硬件算法自主调度能力，实现减少CPU资源消耗的同时可以支持并行处理私钥授权码验证的方法。解决基于CCP907T安全芯片的密码卡的获取私钥使用权限接口中私钥授权码验证消耗大量CPU资源且不能并行处理的技术问题，可显著提升在多线程应用中的性能。为实现上述目的及其他相关目的，本发明提供以下技术方案：首先进行初始化：主机通过管理命令逻辑通道，执行密钥产生管理命令，密码卡产生索引号为ID1的密钥数据结构；执行获取密钥地址管理命令，主机获取各个索引号的密钥地址结构；然后执行下面步骤：步骤S1：主机通过运算命令逻辑通道，使用密码卡对私钥授权码A1进行杂凑运算，获取杂凑值为B1；步骤S2：主机将杂凑值B1处理到对称算法的密钥长度，得到C1作为密钥值；步骤S3：主机通过所述运算命令逻辑通道，使用密码卡，以密钥值C1作为对称密钥，以D1为待处理数据，进行对称运算，获得运算结果E1；步骤S4：主机通过私钥索引号ID1从各个索引号的密钥地址结构中得到密码卡内相同索引号的密钥数据结构中的对称密钥C2的内存地址值addr；步骤S5：主机通过所述运算命令逻辑通道，使用密码卡，以步骤S4所述的对称密钥C2的内存地址值addr为对称密钥的内存地址值，以D1为待处理数据，进行对称运算，获得运算结果E2；所述私钥索引号ID1为获取私钥使用权限接口的入参；步骤S6：主机对比E1和E2数据是否相等，相等则私钥授权码验证通过，不相等则私钥授权码验证不通过。有益效果本发明在私钥授权码验证过程中使用的杂凑运算的算法和对称运算的算法、模式和操作各具有多种选择，并且可以灵活组合。本发明根据不同的对称密钥加密或解密相同数据所得加密密文或解密明文也必然不同的原理，通过运算命令逻辑通道使密码卡进行杂凑运算和对称运算，主机负责对比对称运算结果的方法完成私钥授权码的验证，避免了私钥授权码验证过程中使用管理命令逻辑通道。本发明中需要使用管理命令逻辑通道的操作都集中在初始化步骤，初始化步骤仅需在获取私钥使用权限接口使用之前运行一次，避免了管理命令逻辑通道仅可串行处理管理命令且消耗大量CPU资源的缺点；私钥授权码验证过程所有步骤都使用运算命令逻辑通道，充分通过运算命令逻辑通道发挥CCP907T安全芯片算法安全引擎的独立于CPU的硬件算法自主调度能力，实现减少CPU资源消耗的同时支持并行处理私钥授权码的验证。以具体实施为例，进行获取私钥使用权限接口性能测试。64线程，每个线程调用接口1000次的测试条件下，接口性能为80000次/秒；单个线程调用接口1000次的测试条件下，接口性能为10000次/秒。以现有技术方案例，进行获取私钥使用权限接口性能测试。64线程，每个线程调用接口1000次的测试条件下，接口性能为1700次/秒；单个线程调用接口1000次的测试条件下，接口性能为1650次/秒。本发明技术方案比现有技术相比，获取私钥使用权限接口的私钥授权码验证过程在多线程应用情况下，性能提升可达到47倍左右；在单线程应用情况下，性能提升可达到6倍左右。附图说明图1为基于CCP907T安全芯片的PCI-E密码卡的数据通信命令逻辑通道示意图；图2为本发明的主机与密码卡通信步骤的示意图；图3为本发明的主机获取密码卡内密钥数据结构中对称密钥内存地址的示意图。具体实施方式本实施例提供一种SM2私钥授权码快速验证方法，包括通过PCI-E接口物理连接的主机和密码卡，所述密码卡为基于苏州国芯科技有限公司的CCP907T安全芯片设计的密码卡，所述密码卡遵循国家密码管理局关于密码卡的相关技术规范。如图1所示，所述密码卡包括CCP907T安全芯片，内存，存储器。所述CCP907T安全芯片用于运行计算机可读指令并提供硬件算法能力；所述内存用于存放密钥数据结构，所述CCP907T安全芯片可直接读取所述内存里存放的数据进行算法运算；所述存储器用于存储计算机可读指令和所述密钥数据结构。所述主机与所述密码卡之间设置有运算命令逻辑通道和管理命令逻辑通道。所述主机通过所述运算命令逻辑通道，可使得所述密码卡进行密码运算，所述密码运算包括但不限于SM1、SM2、SM3、SM4等国密算法和AES、DES、3DES、SHA1、SHA256、SHA384、SHA512等国际算法，通过所述运算命令逻辑通道进行的所述密码运算为独立于CCP907T安全芯片CPU的硬件算法自主调度，支持并行处理。所述主机通过所述管理命令逻辑通道，可使用所述密码卡进行密码管理，所述密码管理包括但不限于密钥产生、销毁、查询、导出和导入等操作，通过所述管理命令逻辑通道进行的所述密码管理只支持串行处理。如图2所示：初始化步骤，主机通过管理命令逻辑通道使得密码卡执行密钥产生管理命令和获取密钥地址管理命令后，密码卡拥有各个索引号的密钥数据结构，主机持有密码卡内各个索引号的密钥地址结构，所述初始化步骤仅需执行一次。调用获取私钥使用权限接口时，主机增加持有私钥授权码A1、私钥索引号ID1。所述主机持有的私钥授权码A1，作为获取私钥使用权限接口的入参，是待验证与密钥产生时设置的私钥授权码A2是否一致的数据；所述主机持有的私钥索引号ID1，作为获取私钥使用权限接口的入参，作用是指定获取索引号为ID1的密钥数据结构中私钥的使用权；所述主机持有的各个索引号的密钥地址结构，作为初始化步骤中主机从密码卡获取的数据，主机可从中获取索引号与ID1相等的密钥地址结构中的对称密钥内存地址，对称密钥内存地址可通过所述运算命令逻辑通道传递给密码卡进行对称运算，所述密码卡可直接定位并使用收到的对称密钥内存地址处的对称密钥数据作为对称密钥进行对称运算。一种SM2私钥授权码快速验证方法，包括以下步骤：初始化阶段，主机通过管理命令逻辑通道，发送密钥产生管理命令、索引号ID1和私钥授权码A2到所述密码卡，密码卡根据密钥产生管理命令，产生指定索引号的密钥数据结构到密码卡的内存并保存到密码卡的存储器，并返回密钥产生管理命令执行结果到主机。所述密钥数据结构包括一个索引号、一个签名密钥对、一个加密密钥对和一个对称密钥C2。所述索引号ID1为一个范围从1开始的正整数，最大值根据密码卡的密钥能力确定。所述签名密钥对包括一个私钥和一个公钥，私钥用于对数据进行签名，公钥用于验证签名的有效性；所述加密密钥对包括一个私钥和一个公钥，公钥用于加密数据，私钥用于解密数据。所述对称密钥C2为密码卡对A2进行杂凑运算得到杂凑值B2，对B2经过步骤S2中的所述处理得到的数据，C2用作私钥授权码验证过程中的对称运算的对称密钥，加密或者解密待处理数据D1。所述密码卡持久化保存的值为C2，不会保存和直接使用A2，避免直接明文存储私钥授权码A2，同时省略私钥授权码验证过程中将A2重新进行杂凑运算并处理得到C2的过程，使得所述主机在初始化步骤中提前获取密码卡中各个索引号的密钥数据结构中的对称密钥的内存地址。步骤S1中所述的杂凑运算的算法与对A2进行的杂凑运算的算法一致。如图3所示，进一步的，在主机调用获取私钥使用权限接口之前，主机通过管理命令逻辑通道，发送获取密钥地址管理命令给密码卡，密码卡将内存中的各个索引号的密钥数据结构中的对称密钥的内存地址和索引号通过管理命令逻辑通道返回主机，主机即可获得与密码卡内各个索引号的密钥数据结构对应的各个索引号的密钥地址结构。所述密钥地址结构包括一个索引号和一个对称密钥内存地址，所述索引号与所述密钥数据结构中的索引号含义相同，所述对称密钥内存地址为与其所属密钥地址结构中索引号相同的密码卡内密钥数据结构中对称密钥的内存地址。所述内存地址是内存中每个存储单元的唯一标识符，通过内存地址可以唯一访问和定位内存中的数据。步骤S1：主机通过运算命令逻辑通道，使用密码卡对私钥授权码A1进行杂凑运算，获取杂凑值为B1。所述私钥授权码A1为获取私钥使用权限接口的入参。所述杂凑运算是把任意长度的输入数据变化成较短的固定长度的杂凑值的一种函数，变化过程是单向的，逆向操作难以完成，两个不同的输入数据产生不相同的杂凑值，两个相同的输入数据产生相同的杂凑值。所述获取私钥使用权限接口为《密码设备应用接口规范GM/T 0018-2012》行业标准中设备管理类函数里的一个功能是获取密码卡内指定索引号的密钥数据结构中签名密钥对的私钥和加密密钥对的私钥的使用权的函数，其函数名称为SDF_GetPrivateKeyAccessRight，函数入参包括密码卡内存储私钥的索引号、待验证的私钥授权码；函数原理是判断入参私钥授权码A1是否正确，正确则获取私钥使用权限成功，否则失败。所述杂凑运算的算法与初始化步骤中密钥产生时设置的私钥授权码A2使用的杂凑运算的算法一致，作用是在杂凑算法一致的情况下，可以根据A1和A2的杂凑值B1和B2是否相同判断A1和A2是否相同，B1和B2相同则A1和A2相同。所述杂凑运算的算法包括但不限于SM3、SHA1、SHA256、SHA384、SHA512等CCP907T安全芯片支持的杂凑算法。步骤S2：主机将杂凑值B1处理到对称算法的密钥长度，得到C1作为密钥值。所述处理包括填充、压缩或不处理；所述对称算法为下面步骤S3中的对称运算算法；处理包括：当密钥长度大于杂凑值B1长度时，对杂凑值B1进行填充得到密钥值C1；当密钥长度小于杂凑值B1长度时，对杂凑值B1进行压缩得到密钥值C1；当密钥长度等于杂凑值B1的长度时，密钥值C1则为杂凑值B1。步骤S3：主机通过所述运算命令逻辑通道，使用密码卡，以密钥值C1作为对称密钥，以D1为待处理数据，进行对称运算，获得运算结果E1。所述对称运算为所述主机将C1、D1、对称运算的算法标识、对称运算的模式标识、对称运算的操作标识和IV值，通过所述运算命令逻辑通道传递给所述密码卡，所述密码卡根据收到的算法标识和模式标识，使用相应对称运算的算法和模式，以C1为对称密钥，根据操作标识对D1进行相应操作得到运算结果E1，E1通过所述运算命令逻辑通道返回到所述主机。所述对称运算的算法包括但不限于SM1、SM4、AES、DES、3DES等CCP907T安全芯片支持的对称算法；所述对称运算的操作包括加密操作、解密操作；当对称运算的操作为加密操作时，D1为待加密明文，E1为加密密文；当对称运算的操作为解密操作时，D1为待解密密文，E1为解密明文；所述D1为预先设置的长度和内容固定不变数据，作用是在确保待处理数据D1是固定不变的情况下，两次加密或解密的对称运算结果不一致时，即可排除是待处理数据D1的影响，可判断为对称运算的算法、模式、IV值或对称密钥的不一致导致的。所述D1和E1的长度均为所述对称运算的算法的分组长度，所述分组长度是在加密或解密过程中，将待处理数据分成固定长度的分组进行处理的长度；所述对称运算的模式包括但不限于ECB、CBC、CFB、OFB等CCP907T安全芯片支持的对称算法模式；所述对称运算的模式为除ECB外的其它模式时，以预先设置的长度和内容固定的数据V1为对称运算的IV值。所述IV值，也称初始化向量，是在对称运算中使用的一种参数，是一个固定长度的消息串，作用是对称运算时，算法、模式、待处理数据和对称密钥相同时，由于 IV值的不同，相同操作的对称运算结果也会不同。所述V1为长度和内容固定的消息串，作用是在确保IV值V1是固定不变的情况下，当两次加密或解密的对称运算结果不一致时，即可排除是IV值的影响，可判断为对称运算的算法、模式、待处理数据或对称密钥的不一致导致的。所述C1作为对称密钥的作用是在确保对称运算的算法、模式、IV值和待处理数据是相同的情况下，当两次加密或解密的对称运算结果不一致时，可判断是两次对称运算的对称密钥不同导致的。步骤S4：主机通过遍历各个索引号的密钥地址结构，找到其中索引号与所述获取私钥使用权限接口的入参私钥索引号ID1相同的密钥地址结构，该密钥地址结构中的对称密钥内存地址,即为密码卡的内存中相同索引号的密钥数据结构中的对称密钥C2的内存地址。所述各个索引号的密钥地址结构是初始化步骤中所述主机通过管理命令逻辑通道从所述密码卡中获取的。步骤S5：主机将对称密钥C2的内存地址addr、待处理数据D1、对称运算的算法标识、对称运算的模式标识、对称运算的操作标识和IV值V1，通过所述运算命令逻辑通道传递给密码卡，密码卡根据收到的算法标识和模式标识，使用相应对称运算的算法和模式，以C2的内存地址addr定位并获取到密码卡的内存中C2的数据并将其作为对称运算的对称密钥，根据操作标识对D1进行相应操作得到运算结果E2，E2通过所述运算命令逻辑通道返回到主机。所述对称运算的算法与所述步骤S3中所述对称运算的算法一致；所述对称运算的操作与所述步骤S3中所述对称运算的操作一致；所述对称运算的模式与所述步骤S3的对称运算的模式一致；所述对称运算的模式需要IV值时，以预先设置的长度和内容固定数据V1为对称运算的IV值。步骤S6：主机对比步骤S3得到的E1和步骤S5得到的E2数据是否相等，相等则私钥授权码验证通过，不相等则私钥授权码验证不通过。所述步骤S3和所述步骤S5中所述的对称运算的算法、模式、操作、IV值均相同，则根据对称运算的结果E1和E2是否相同就可以体现作为对称密钥的C1和C2是否相同；由于初始化步骤中A2得到C2进行的杂凑运算的算法和处理与在步骤S1和S2中A1得到C1进行的杂凑运算的算法和处理均相同，则根据C1和C2是否相同就可以体现私钥授权码A1和A2是否相同。根据上述操作步骤，基于不同的对称密钥加密或解密相同数据所得加密密文或解密明文也必然不同的原理，主机通过运算命令逻辑通道使密码卡进行一次杂凑运算和两次对称运算，主机对比对称运算结果的方法实现了私钥授权码的验证。上述操作中的杂凑运算的算法和对称运算的算法、模式和操作各具有多种可选择，并且可以灵活组合。相较于原有技术方案中主机使用管理命令逻辑通道使密码卡进行私钥授权码验证的方法需要消耗大量CPU资源的同时只能串行处理的缺陷，上述操作使用运算命令逻辑通道可以充分利用CCP907T安全芯片算法安全引擎的独立于CPU的硬件算法自主调度能力，实现减少CPU资源消耗的同时可以支持并行处理私钥授权码的验证，显著提升了获取私钥使用权限接口的性能。以上显示和描述了本发明的基本原理、主要特征和本发明的优点。本行业的技术人员应该了解，本发明不受上述实施例的限制，上述实施例和说明书中描述 的只是本发明的原理，在不脱离本发明精神和范围的前提下本发明还会有各种变化和改进，这些变化和改进都落入要求保护的本发明的范围内。本发明要求的保护范围由所附的权利要求书及其等同物界定。
