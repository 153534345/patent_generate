标题title
一种防止模拟芯片被逆向分析的电路及方法
摘要abst
本发明提出一种防止模拟芯片被逆向分析的电路及方法，包括带开关控制的数字电路和带冗余的模拟电路，模拟电路的开关组合接收数字电路的开关控制电路发出的控制信号，控制模拟电路的阵列中模拟电路器件的接入状态，使得串并联关系发生变化；当模拟电路器件阵列的接入状态与预设目标值一致时，电路正常工作；否则，模拟电路器件阵列的其余接入状态使得电路行为偏离设计预期，电路处于非正常工作状态。因此，当模拟部分版图被逆向时，由于存在大量冗余而偏离目标值，影响了正常的功能和性能，使得逆向的电路无法实际使用，有效保障了芯片的安全性。
权利要求书clms
1.一种防止模拟芯片被逆向分析的电路，其特征在于包括：带开关控制的数字电路，包括数字逻辑电路和开关控制电路，所述数字逻辑电路用于控制开关控制电路，以驱动模拟电路中开关组合的通断；带冗余的模拟电路，由模拟电路器件阵列和开关组合构成，所述开关组合接收开关控制电路的控制信号，控制所述阵列中模拟电路器件的接入状态，使得串并联关系发生变化；当模拟电路器件阵列的接入状态与预设目标值一致时，电路正常工作；否则，模拟电路器件阵列的其余接入状态使得电路行为偏离设计预期，电路处于非正常工作状态。2.根据权利要求1所述的防止模拟芯片被逆向分析的电路，其特征在于，所述模拟电路器件阵列包括电阻阵列，电容阵列和/或电流源阵列中的一种或多种组合。3.根据权利要求1或2所述的防止模拟芯片被逆向分析的电路，其特征在于，所述模拟电路器件阵列采用电阻阵列，阵列中各电阻分别通过开关串联或者并联组成若干种等效电阻网络：串联阵列，包括若干个串联电阻以及与各电阻匹配的开关组，各开关组均为一对互相取反的开关，当一个接通时，另一个断开；其中一种状态电阻被连接到电阻网络中，另一个状态电阻被跳过；并联阵列，包括若干个并联电阻以及与各电阻串联的单个开关，当开关接通时，对应的电阻被并联进电阻网络；当开关断开时，对应的电阻被断出电阻网络。4.根据权利要求1或2所述的防止模拟芯片被逆向分析的电路，其特征在于，所述模拟电路器件阵列采用电容阵列，阵列中各电容分别通过开关串联或者并联组成若干种等效电容网络：串联阵列，包括若干个串联电容以及与各电容匹配的开关组，各开关组均为一对互相取反的开关，当一个接通时，另一个断开；其中一种状态电容被连接到电容网络中，另一个状态电容被跳过；并联阵列，包括若干个并联电容以及与各电容串联的单个开关，当开关接通时，对应的电容被并联进电容网络；当开关断开时，对应的电容被断出电容网络。5.根据权利要求1或2所述的防止模拟芯片被逆向分析的电路，其特征在于，所述模拟电路器件阵列采用电流源阵列，阵列中各电流源分别通过开关并联组成若干种等效电流源；当并联开关接通时，电流源被并联进电流源网络；当并联开关断开时，电流源被断出电流源网络。6.根据权利要求1或2所述的防止模拟芯片被逆向分析的电路，其特征在于，所述模拟电路器件阵列采用RC延时电路，电阻部分采用电阻阵列，电容部分采用电容阵列。7.根据权利要求1或2所述的防止模拟芯片被逆向分析的电路，其特征在于，通过自动布局布线技术将数字逻辑电路、开关控制电路以及芯片本体数字电路混合，使得开关控制电路埋藏在数字逻辑电路和芯片本体数字电路中。8.根据权利要求1所述的防止模拟芯片被逆向分析的电路，其特征在于，所述开关控制电路采用数字冗余逻辑实现，包括或逻辑、与逻辑、异或逻辑以及同或逻辑。9.根据权利要求8所述的防止模拟芯片被逆向分析的电路，其特征在于，所述数字冗余逻辑用于将数字控制开关从接固定电平变成逻辑运算，包括：当信号和信号的反相进行或逻辑运算，得到结果为恒1；当信号和信号的反相进行与逻辑运算，得到结果为恒0；当信号和信号的反相进行异或逻辑运算，得到结果为恒1；当信号和信号的反相进行同或逻辑运算，得到结果为恒0。10.一种防止模拟芯片被逆向分析的方法，应用权利要求1-9任意一项所述的防止模拟芯片被逆向分析的电路，其特征在于，该方法包括以下步骤：当模拟电路器件阵列的接入状态与预设目标值一致时，电路正常工作；否则，模拟电路器件阵列的其余接入状态使得电路行为偏离设计预期,电路处于非正常工作状态。
说明书desc
技术领域本发明属于芯片安全领域，尤其涉及一种防止模拟芯片被逆向分析的电路及方法。背景技术随着信息技术的发展和芯片国产化替代浪潮的不断攀升，模拟芯片，尤其是高性能模拟芯片，在市场中占据着越来越重要的地位。模拟芯片本身的特点决定了芯片的面积和规模都比较小，因此，通过芯片逆向分析工程，可以提取版图和电路图，达到对芯片分析的目的。少数公司滥用芯片逆向分析技术，对市售芯片进行分析和仿制。目前市场上没有专门的模拟芯片防逆向方案，这片基本属于空白领域。一般实现中，控制逻辑通过简单的信号线去使能模拟电路，但是这种信号线在版图上非常易于识别，起不到防逆向的作用。因此，芯片被逆向分析的安全问题，亟待解决。发明内容本发明的目的是针对芯片被逆向分析，存在安全隐患的问题，提出一种防止模拟芯片被逆向分析的电路及方法。在基础模拟电路中加入冗余，通过数字电路控制冗余开关，同时采用数字电路冗余技术和自动布局布线技术，将控制逻辑隐藏于数字版图中。由于数字版图难以通过逆向提取出电路图和逻辑关系，即使模拟部分版图被逆向，由于基础模块存在大量冗余而偏离目标值，影响了正常的功能和性能，使得逆向的电路无法实际使用。本发明的技术方案是：本发明提供一种防止模拟芯片被逆向分析的电路，包括：带开关控制的数字电路，包括数字逻辑电路和开关控制电路，所述数字逻辑电路用于控制开关控制电路，以驱动模拟电路中开关组合的通断；带冗余的模拟电路，由模拟电路器件阵列和开关组合构成，所述开关组合接收开关控制电路的控制信号，控制所述阵列中模拟电路器件的接入状态，使得串并联关系发生变化；当模拟电路器件阵列的接入状态与预设目标值一致时，电路正常工作；否则，模拟电路器件阵列的其余接入状态使得电路行为偏离设计预期，电路处于非正常工作状态。进一步地，所述模拟电路器件阵列包括电阻阵列，电容阵列和/或电流源阵列中的一种或多种组合。进一步地，所述模拟电路器件阵列采用电阻阵列，阵列中各电阻分别通过开关串联或者并联组成若干种等效电阻网络：串联阵列，包括若干个串联电阻以及与各电阻匹配的开关组，各开关组均为一对互相取反的开关，当一个接通时，另一个断开；其中一种状态电阻被连接到电阻网络中，另一个状态电阻被跳过；并联阵列，包括若干个并联电阻以及与各电阻串联的单个开关，当开关接通时，对应的电阻被并联进电阻网络；当开关断开时，对应的电阻被断出电阻网络。进一步地，模拟电路器件阵列采用电容阵列，阵列中各电容分别通过开关串联或者并联组成若干种等效电容网络：串联阵列，包括若干个串联电容以及与各电容匹配的开关组，各开关组均为一对互相取反的开关，当一个接通时，另一个断开；其中一种状态电容被连接到电容网络中，另一个状态电容被跳过；并联阵列，包括若干个并联电容以及与各电容串联的单个开关，当开关接通时，对应的电容被并联进电容网络；当开关断开时，对应的电容被断出电容网络。进一步地，所述模拟电路器件阵列采用电流源阵列，阵列中各电流源分别通过开关并联组成若干种等效电流源；当并联开关接通时，电流源被并联进电流源网络；当并联开关断开时，电流源被断出电流源网络。进一步地，所述模拟电路器件阵列采用RC延时电路，电阻部分采用电阻阵列，电容部分采用电容阵列。进一步地，通过自动布局布线技术将数字逻辑电路、开关控制电路以及芯片本体数字电路混合，使得开关控制电路埋藏在数字逻辑电路和芯片本体数字电路中。进一步地，所述开关控制电路采用数字冗余逻辑实现，包括或逻辑、与逻辑、异或逻辑以及同或逻辑。进一步地，所述数字冗余逻辑用于将数字控制开关从接固定电平变成逻辑运算，包括：当信号和信号的反相进行或逻辑运算，得到结果为恒1；当信号和信号的反相进行与逻辑运算，得到结果为恒0；当信号和信号的反相进行异或逻辑运算，得到结果为恒1；当信号和信号的反相进行同或逻辑运算，得到结果为恒0。一种防止模拟芯片被逆向分析的电路所采用的方法，该方法包括以下步骤：当模拟电路器件阵列的接入状态与预设目标值一致时，电路正常工作；否则，模拟电路器件阵列的其余接入状态使得电路行为偏离设计预期,电路处于非正常工作状态。本发明的有益效果：本发明由带冗余的模拟电路和带开关控制的数字电路组成，具有以下优点：1、带冗余的模拟电路由器件阵列组成，并由开关控制。通过预设的开关组合，将器件阵列调整到目标值，此时电路可以正常工作。当器件阵列未被调整到目标值时，冗余电路会干扰正常模拟电路的性能和功能，使得电路行为偏离设计预期。2、带开关控制的数字电路由数字逻辑电路和开关控制电路组成。通过自动布局布线技术将数字逻辑电路、开关控制电路以及芯片本体数字电路混合，将开关控制电路埋藏在数字逻辑电路和芯片本体数字电路中，使得数字版图逆向分析非常困难。3、开关控制电路采用数字冗余逻辑实现，而不是直接连接到逻辑信号，进一步加大了数字控制信号被逆向分析的难度。本发明的其它特征和优点将在随后具体实施方式部分予以详细说明。附图说明通过结合附图对本发明示例性实施方式进行更详细的描述，本发明的上述以及其它目的、特征和优势将变得更加明显，其中，在本发明示例性实施方式中，相同的参考标号通常代表相同部件。图1示出了本发明的防止模拟芯片被逆向分析的电路整体结构图。图2示出了模拟电路器件阵列采用电阻阵列的电路图。图3示出了根据本发明的一个实施例的电阻阵列等效电阻示意图。图4示出了模拟电路器件阵列采用电容阵列的电路图。图5示出了根据本发明的一个实施例的电容阵列等效电容示意图。图6示出了模拟电路器件阵列采用电流源阵列的电路图。图7示出了根据本发明的一个实施例的电流源阵列等效电流源示意图。图8示出了根据本发明的一个实施例的基于RC延时电路防止模拟芯片被逆向分析的电路整体示意图。图9示出了本发明的开关控制电路的冗余逻辑示意图。具体实施方式下面将参照附图更详细地描述本发明的优选实施方式。虽然附图中显示了本发明的优选实施方式，然而应该理解，可以以各种形式实现本发明而不应被这里阐述的实施方式所限制。实施例一：如图1所示，本发明提供一种防止模拟芯片被逆向分析的电路，由带冗余的基础模拟电路器件组成的模拟电路和带开关控制的数字电路组成；带开关控制的数字电路，包括数字逻辑电路和开关控制电路，所述数字逻辑电路用于控制开关控制电路，以驱动模拟电路中开关组合的通断；带冗余的模拟电路，由模拟电路器件阵列和开关组合构成，所述开关组合接收开关控制电路的控制信号，控制所述阵列中模拟电路器件的接入状态，使得串并联关系发生变化；当模拟电路器件阵列的接入状态与预设目标值一致时，电路正常工作；否则，模拟电路器件阵列的其余接入状态使得电路行为偏离设计预期，电路处于非正常工作状态。在本实施例中，当模拟部分版图被逆向时，由于存在大量冗余而偏离目标值，影响了正常的功能和性能，使得逆向的电路无法实际使用，有效保障了芯片的安全性。同时，通过自动布局布线技术将数字逻辑电路、开关控制电路以及芯片本体数字电路混合，使得开关控制电路埋藏在数字逻辑电路和芯片本体数字电路中，使得数字版图逆向分析非常困难。实施例二：本发明中，模拟电路器件阵列包括电阻阵列，电容阵列和/或电流源阵列中的一种或多种组合。如图2、图3所述，为模拟电路器件阵列采用电阻阵列的电路图和电阻阵列等效电阻示意图：图2中，模拟电路器件阵列采用电阻阵列，阵列中各电阻分别通过开关串联或者并联组成若干种等效电阻网络：串联阵列，包括若干个串联电阻以及与各电阻匹配的开关组，各开关组均为一对互相取反的开关K1/~K1，当K1接通时，~K1断开，电阻1被连接到电阻网络中；当K1断开时，~K1接通，电阻1被跳过；并联阵列，包括若干个并联电阻以及与各电阻串联的单个开关，如图中K3/K4，当开关接通时，对应的电阻被并联进电阻网络；当开关断开时，对应的电阻被断出电阻网络。实际电路中串联电阻和并联电阻均可拓展至多个，以组成复杂的电阻网络。假设图中电阻1~4的阻值均为R，当K1~K4全部导通时，整个电路的等效电阻如图3上部分所示，最终电阻为0.4R；当K1导通，K2关闭，K3导通，K4关闭时，如图3下部分所示，整个电路的等效电阻最终为0.5R；由此可见，通过控制开关的切换，可以改变整个电阻网路的等效电阻。实施例三：如图4、图5所示，为模拟电路器件阵列采用电容阵列的电路图和电容阵列等效电容示意图；图4中，模拟电路器件阵列采用电容阵列，阵列中各电容分别通过开关串联或者并联组成若干种等效电容网络：串联阵列，包括若干个串联电容以及与各电容匹配的开关组，各开关组均为一对互相取反的开关K1/~K1，当K1接通时，~K1断开，电容1被连接到电容网络中；当K1断开时，~K1接通，电容1被跳过；并联阵列，包括若干个并联电容以及与各电容串联的单个开关，如图中K3/K4，当开关接通时，对应的电容被并联进电容网络；当开关断开时，对应的电容被断出电容网络。实际电路中串联电容和并联电容均可拓展至多个，以组成复杂的电容网络。假设图中电容1~4的容值均为C。当K1~K4全部导通时，整个电路的等效电容如图5上部分所示，最终电容为2.5C；当K1导通，K2关闭，K3导通，K4关闭时，如图5下部分所示，整个电路的等效电容如下，最终为2C。实施例四：如图6、图7所述，为模拟电路器件阵列采用电流源阵列的电路图和电流源阵列等效电流源示意图：图6中，模拟电路器件阵列采用电流源阵列，阵列中各电流源分别通过开关并联，如图K1~ K4组成若干种等效电流源；当并联开关接通时，电流源被并联进电流源网络；当并联开关断开时，电流源被断出电流源网络；实际电路中并联电流源可拓展至多个，以组成复杂的电流源网络示例；假设图中电流源1~4的均为1ua电流。当K1~K4全部导通时，整个电流源的等效电流如图7所示，最终电流为4ua。实施例五：如图8所示，采用RC延时电路的实例去描述电路冗余控制方式工作原理。在模拟电路中，通过电阻和电容组成RC电路产生延时脉冲，延时脉冲的宽度由电阻和电容值决定。控制信号一共有12组开关，共有2^12=4096中组合，用户无法通过穷举法去猜中正确的RC设置。因此，针对不同的模拟电路，可以设计不同的冗余电路，其共同的特点是通过数字开关控制基础器件的目标值以使设计正常或者偏离设计工作点。数字逻辑电路控制模拟冗余电路的打开和关闭。为高时表示打开，为低时表示关闭。一组数字控制开关的高低状态，控制模拟电路正常工作。比如上述例子中，数字控制开关为101时电路可以正常工作。由于三位控制开关一共由8种组合，逆向破解者需要尝试8中组合，才能获得正确的工作状态。实际电路中的数字控制开关组合数目为2^N，当N=10时，有1024种组合，当N=20时，有一百万种组合。在一个芯片中增加20个冗余点的成本很低，逆向分析无法通过尝试一百万种组合使电路达到正常工作状态，从而实现了防逆向的保密功能。实施例六：在实施例一的基础上，增加开关控制电路的冗余实现。由于数字控制开关被设定为打开或者关闭。为了进一步增加逆向分析的难度，不直接采用一般数字电路设计中的将开关直接接高或者接低的做法，利用了数字冗余逻辑，实现输出高低电平。数字冗余逻辑如下，当信号和信号的反相进行或逻辑运算，得到结果为恒1；当信号和信号的反相进行与逻辑运算，得到结果为恒0；当信号和信号的反相进行异或逻辑运算，得到结果为恒1；当信号和信号的反相进行同或逻辑运算，得到结果为恒0；通过上述冗余逻辑，数字控制开关从接固定电平变成逻辑运算，大大增加了破解的难度。在本实施例中，所有的数字逻辑被打散布局布线，数字逻辑电路、开关控制电路以及芯片本体数字电路被没有任何区别的被散布于版图的各个角落，并通过自动连线组成正确的逻辑功能。自动布局布线技术使得版图逆向无法对数字电路和冗余逻辑做出正确的分析。综上所述，本发明提出了一种在模拟电路中加入冗余电路，并采用数字开关控制模拟冗余电路的方式，实现了对芯片版图的保护。数字电路自动布局布线技术将控制开关隐藏于普通数字电路中，采用数字冗余技术的开关设计加强了这种隐藏的效果。版图逆向分析获取了模拟电路和冗余电路，但是由于无法逆袭分析数字控制开关电路，因此无法得到电路的正确工作状态。以上已经描述了本发明的各实施例，上述说明是示例性的，并非穷尽性的，并且也不限于所披露的各实施例。在不偏离所说明的各实施例的范围和精神的情况下，对于本技术领域的普通技术人员来说许多修改和变更都是显而易见的。
