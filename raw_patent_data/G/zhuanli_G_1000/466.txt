标题title
一种基于FPGA高速收发器的数字脉冲发生器
摘要abst
本发明提供了一种基于FPGA高速收发器的数字脉冲发生器，包括编码器、RAM写控制器、RAM读控制器、RAM、FPGA高速收发器；所述FPGA高速收发器内配置有并行转串行模块；编码器接收数字脉冲的宽度和周期设定指令，并基于设定指令产生串行比特流；RAM写控制器将串行比特流转换为一个或多个字，更新到RAM中；编码器根据设定指令控制RAM读控制器读取RAM内的字，并将读取的字以并行数据的形式发送至并行转串行模块；FPGA高速收发器通过并行转串行模块将接收到的并行数据转换为串行数据流，并将串行数据流以高速差分信号的形式输出。本发明可以实现数字脉冲皮秒级的高精度可调。
权利要求书clms
1.一种基于FPGA高速收发器的数字脉冲发生器，其特征在于：包括编码器、RAM写控制器、RAM读控制器、RAM、FPGA高速收发器；所述FPGA高速收发器内配置有并行转串行模块；编码器接收数字脉冲的宽度和周期的设定指令，并基于设定指令产生串行比特流；RAM写控制器将串行比特流转换为一个或多个字，更新到RAM中；编码器根据设定指令控制RAM读控制器读取RAM内的字，并将读取的字以并行数据的形式发送至并行转串行模块；FPGA高速收发器通过并行转串行模块将接收到的并行数据转换为串行数据流，并将串行数据流以高速差分信号的形式输出。2.根据权利要求1所述的一种基于FPGA高速收发器的数字脉冲发生器，其特征在于：还包括数据拼接器；RAM读控制器所读取的字经由数据拼接器根据设定指令进行拼接后，送往RAM和并行转串行模块。3.根据权利要求2所述的一种基于FPGA高速收发器的数字脉冲发生器，其特征在于：所述FPGA高速收发器内还配置有锁相环模块和相位内插模块；锁相环模块将外部基准时钟转换为高频时钟；相位内插模块基于高频时钟和设定指令调整FPGA高速收发器输出的串行数据流的脉宽和周期。4.根据权利要求1所述的一种基于FPGA高速收发器的数字脉冲发生器，其特征在于：编码器根据设定指令，调整串行比特流中1的个数，以调整FPGA高速收发器输出的数字脉冲脉宽；调整比特流的长度，以调整FPGA高速收发器输出的数字脉冲周期。5.根据权利要求2所述的一种基于FPGA高速收发器的数字脉冲发生器，其特征在于：RAM读控制器在每个循环，依次读取RAM中所有的字；每个字的长度为M；在第一个循环中，RAM读控制器读到最后一个字时，数据拼接器采用缓存的数据替代最后一个字的高W位数据；所述缓存的数据为该循环内，RAM读控制器所读出的第一个字的低W位数据；除第一个循环的最后一个字，数据拼接器直接输出RAM读控制器正常读取的字；在每个循环，数据拼接器获取当前地址中字的高W位数据，作为下一个循环该地址中字的低W位数据；并获取当前地址下一个字的低M-W位数据，作为下个循环该地址的字的高M-W位数据；数据拼接器将生成的下个循环的字发送至RAM，由RAM读控制器在下个循环读取；W表示比特数，W＜M,其取值取决于数字脉冲的周期设定指令。6.根据权利要求5所述的一种基于FPGA高速收发器的数字脉冲发生器，其特征在于：定义FPGA高速收发器的线速为S；N表示RAM中所有字的个数；并行转串行模块输出的串行数据流周期T=·M+W)/S。7.根据权利要求3所述的一种基于FPGA高速收发器的数字脉冲发生器，其特征在于：相位内插模块调整串行数据流脉宽的过程包括：当串行数据流达到上升沿时，高频时钟的相位为第一相位；相位内插模块在下降沿到达前，改变高频时钟的相位为第二相位；当串行数据流达到下降沿时，高频时钟在第二相位的相位下输出串行数据流；第一相位和第二相位的差值取值取决于数字脉冲的宽度设定指令。8.根据权利要求7所述的一种基于FPGA高速收发器的数字脉冲发生器，其特征在于：相位内插模块调整串行数据流周期的过程包括：当串行数据流达到上升沿时，高频时钟的相位为第三相位；相位内插模块在下一个上升沿到达前，改变高频时钟的相位为第四相位；当串行数据流达到下一个上升沿时，高频时钟在第四相位的相位下输出串行数据流；第三相位和第四相位的差值取值取决于数字脉冲的周期设定指令。9.根据权利要求8所述的一种基于FPGA高速收发器的数字脉冲发生器，其特征在于：编码器按照设定的第一脉宽步长调整数字脉冲的宽度；编码器将设定的第一脉宽步长乘以RAM中单个字的长度作为第一周期步长，以调整数字脉冲的周期；数据拼接器以第一脉宽步长作为第二周期步长，以调整数字脉冲的周期；相位内插模块以第一脉宽的1/64作为第二脉宽步长，以调整数字脉冲的宽度；将第二周期步长的1/64作为第三周期步长，以调整数字脉冲的周期。10.根据权利要求9所述的一种基于FPGA高速收发器的数字脉冲发生器，其特征在于：基于数字脉冲的宽度和周期的设定指令，编码器、数据拼接器和相位内插模块依次执行数字脉冲的宽度和周期的调整过程，其中编码器按照第一脉宽步长和第一周期步长调整数字脉冲的宽度和周期；数据拼接器针对编码器无法覆盖的精度范围，按照第二周期步长调整数字脉冲的周期；相位内插模块针对编码器和数据拼接器无法覆盖的精度范围，按照第二脉宽步长和第三周期步长调整数字脉冲的宽度和周期。
说明书desc
技术领域本发明属于信号发生器技术领域，具体涉及一种基于FPGA高速收发器的数字脉冲发生器。背景技术数字脉冲发生器可用于产生脉冲宽度及周期可配置的数字脉冲，继而被用来做相关测试的测试激励。该装置的实现方法一般是采用某种数字时间转换器将数值转换成时间宽度，进而控制脉冲的宽度及周期等参数。现有技术中常用的数字脉冲发生器通常采用专用的集成电路或现场可编辑门阵列实现。与ASIC的实现方案相比FPGA方案具有更高的灵活性，并且大幅的减少了开发周期。目前的基于FPGA的实现方案结构复杂，调整步长往往在10皮秒以上，且多有死时间的限制，无法适用于当下高精度试验的需求。发明内容本发明的目的就是为了解决上述背景技术存在的不足，提供一种基于FPGA高速收发器的数字脉冲发生器，可以实现数字脉冲宽度和周期的高精度可调。本发明采用的技术方案是：一种基于FPGA高速收发器的数字脉冲发生器，包括编码器、RAM写控制器、RAM读控制器、RAM、FPGA高速收发器；所述FPGA高速收发器内配置有并行转串行模块；编码器接收数字脉冲的宽度和周期的设定指令，并基于设定指令产生串行比特流；RAM写控制器将串行比特流转换为一个或多个字，更新到RAM中；编码器根据设定指令控制RAM读控制器读取RAM内的字，并将读取的字以并行数据的形式发送至并行转串行模块；FPGA高速收发器通过并行转串行模块将接收到的并行数据转换为串行数据流，并将串行数据流以高速差分信号的形式输出。上述技术方案中，还包括数据拼接器；RAM读控制器所读取的字经由数据拼接器根据设定指令进行拼接后，送往RAM和并行转串行模块。上述技术方案中，所述FPGA高速收发器内还配置有锁相环模块和相位内插模块；锁相环模块将外部基准时钟转换为高频时钟；相位内插模块基于高频时钟和设定指令调整FPGA高速收发器输出的串行数据流的脉宽和周期。上述技术方案中，编码器根据设定指令，调整串行比特流中1的个数，以调整FPGA高速收发器输出的数字脉冲脉宽；调整比特流的长度，以调整FPGA高速收发器输出的数字脉冲周期。上述技术方案中，RAM读控制器在每个循环，依次读取RAM中所有的字；每个字的长度为M；在第一个循环中，RAM读控制器读到最后一个字时，数据拼接器采用缓存的数据替代最后一个字的高W位数据；所述缓存的数据为该循环内，RAM读控制器所读出的第一个字的低W位数据；除第一个循环的最后一个字，数据拼接器直接输出RAM读控制器正常读取的字；在每个循环，数据拼接器获取当前地址中字的高W位数据，作为下一个循环该地址中字的低W位数据；并获取当前地址下一个字的低M-W位数据，作为下个循环该地址的字的高M-W位数据；数据拼接器将生成的下个循环的字发送至RAM，由RAM读控制器在下个循环读取；W表示比特数，W＜M,其取值取决于数字脉冲的周期设定指令。上述技术方案中，定义FPGA高速收发器的线速为S；N表示RAM中所有字的个数；并行转串行模块输出的串行数据流周期T=·M+W)/S。上述技术方案中，相位内插模块调整串行数据流脉宽的过程包括：当串行数据流达到上升沿时，高频时钟的相位为第一相位；相位内插模块在下降沿到达前，改变高频时钟的相位为第二相位；当串行数据流达到下降沿时，高频时钟在第二相位的相位下输出串行数据流；第一相位和第二相位的差值取值取决于数字脉冲的宽度设定指令。上述技术方案中，相位内插模块调整串行数据流周期的过程包括：当串行数据流达到上升沿时，高频时钟的相位为第三相位；相位内插模块在下一个上升沿到达前，改变高频时钟的相位为第四相位；当串行数据流达到下一个上升沿时，高频时钟在第四相位的相位下输出串行数据流；第三相位和第四相位的差值取值取决于数字脉冲的周期设定指令。上述技术方案中，编码器按照设定的第一脉宽步长调整数字脉冲的宽度；编码器将设定的第一脉宽步长乘以RAM中单个字的长度作为第一周期步长，以调整数字脉冲的周期；数据拼接器以第一脉宽步长作为第二周期步长，以调整数字脉冲的周期；相位内插模块以第一脉宽的1/64作为第二脉宽步长，以调整数字脉冲的宽度；将第二周期步长的1/64作为第三周期步长，以调整数字脉冲的周期。上述技术方案中，基于数字脉冲的宽度和周期的设定指令，编码器、数据拼接器和相位内插模块依次执行数字脉冲的宽度和周期的调整过程，其中编码器按照第一脉宽步长和第一周期步长调整数字脉冲的宽度和周期；数据拼接器针对编码器无法覆盖的精度范围，按照第二周期步长调整数字脉冲的周期；相位内插模块针对编码器和数据拼接器无法覆盖的精度范围，按照第二脉宽步长和第三周期步长调整数字脉冲的宽度和周期。本发明的有益效果是：本发明利用FPGA内部高速收发器的并转串模块及配套FPGA固件实现高精度的数字脉冲发生器，实现数字脉冲的高精度的脉宽和周期可调，且没有死时间，其中脉宽的调整步长精度可以小于64皮秒。进一步地，本发明通过增设数据拼接器对从RAM读取的数据进行拼接转换，实现更高精度的脉冲周期调节能力，调整步长精度可以小于64皮秒。进一步地，本发明通过增设锁相环模块、相位内插模块和时钟分频器，利用XilinxFPGA特有的相位内插模块，实现将脉冲宽度和周期的调节精度进一步提升约64倍；对于目前先进的Xilinx FPGA，脉冲宽度和周期的调整步长分辨率可达到1皮秒。进一步地，本发明通过编码器控制比特流中1的个数和长度，实现对数字脉冲的脉宽和周期调整，保证调整的精度能够达到64皮秒。进一步地，本发明通过数据拼接器采用循环移位的方式动态更新RAM数据后读出，有效节约计算成本；并通过设定高位数据和低位数据的比特数执行拼接过程，保证调整的精度能够达到64皮秒。进一步地，本发明通过相位内插模块调整串行数据流的前沿和后沿的位置，从而使数字脉冲的脉冲和宽度调整精度达到1皮秒。进一步地，本发明通过RAM写控制器、数据拼接器和相位内插模块对并行数据依次进行调整，编码器先进行粗略调整，数据拼接器和相位内插模块依次再进行精细化的调整，有效节约计算成本的同时，保证数字脉冲的调整精度。附图说明图1为具体实施例1的模块示意图；图2为具体实施例2的模块示意图；图3为具体实施例2的工作原理图；图4为具体实施例3的模块示意图；图5为具体实施例3的工作原理图a；图6为具体实施例3的工作原理图b。具体实施方式下面结合附图和具体实施例对本发明作进一步的详细说明，便于清楚地了解本发明，但它们不对本发明构成限定。本发明提供了一种基于FPGA高速收发器的数字脉冲发生器，包括编码器、RAM写控制器、RAM读控制器、RAM、FPGA高速收发器；所述FPGA高速收发器内配置有并行转串行模块；编码器接收数字脉冲的宽度和周期的设定指令，并基于设定指令产生串行比特流；RAM写控制器将串行比特流转换为一个或多个字，更新到RAM中；编码器根据设定指令控制RAM读控制器读取RAM内的字，并将读取的字以并行数据的形式发送至并行转串行模块；FPGA高速收发器通过并行转串行模块将接收到的并行数据转换为串行数据流，并将串行数据流以高速差分信号的形式输出。如图1所示，本具体实施例提供了一种基于FPGA高速收发器的数字脉冲发生器，包括编码器、RAM写控制器、RAM读控制器、RAM、缓冲器、FPGA高速收发器；所述FPGA高速收发器内配置有并行转串行模块；并行转串行模块接收外部提供的基准时钟并产生参考时钟发送至缓冲器；缓冲器基于参考时钟生成全局时钟并发送至RAM读控制器、RAM和并行转串行模块；所述全局时钟用于RAM读控制器、RAM和并行转串行模块的正常运行。编码器根据接收到的数字脉冲的宽度和周期设定指令产生串行比特流，并基于设定指令通过RAM写控制器将该比特流转换为指定长度的字更新到RAM的指定地址中；编码器根据宽度和周期设定指令控制RAM读控制器在全局时钟下按照地址顺序单次或循环读取RAM内的字，并将读取的字以并行数据的形式发送至FPGA高速收发器；FPGA高速收发器通过并行转串行模块将接收到的数据转换为串行数据流，并以高速差分信号的形式输出。FPGA高速收发器是现有技术中的常见模块，该模块接收外部提供的基准时钟。并行转串行模块针对RAM中的每个字处理方式相同。针对待发送的字,先发送该字的低位，然后再发送该字高位。比如编码器发送RAM的比特流为1111111111110000000000000000000000000000000000000000000011111111，即RAM读控制器发送至RAM的第一个字为0xFFF00000,第二个字为0x000000FF，最后并行转串行模块输出的是0000000000000000000011111111111111111111000000000000000000000000。具体地，用户将要产生的数字脉冲的宽度和周期送给编码器；编码器产生比特流，并根据接收到的数字脉冲的宽度和周期设定指令调整串行比特流中1的个数，以调整并行转串行模块输出的数字脉冲脉宽；同时调整比特流的长度，以调整FPGA高速收发器输出的数字脉冲周期。RAM写控制器将编码器输出的比特流，转换为相应长度的字并更新到RAM的相应地址。编码器根据宽度和周期设定指令控制RAM读控制器按照指定频率读取RAM内指定地址的字，并将读取的字发送至并行转串行模块。具体地，RAM读控制器，对RAM指定地址范围内的值进行单次或者周期性的按地址顺序循环读取。周期性读取时将产生周期性数字脉冲，单次读取则产生单个数字脉冲。读取的值直接被送往FPGA高速收发器的并行转串行模块。FPGA高速收发器通过并行转串行模块将接收到的数据转换为串行数据流，并将串行数据流以差分信号的形式输出。具体实施例1所采用的基准时钟为480MHz，RAM数据宽度为32比特，高速收发器输出速度为15.36Gbps，脉冲宽度设定指令可以在0到整个脉冲周期间以约1/15.36GHz的步长进行实时动态调整，即第一脉宽步长设定为1/15.36GHz。同时可以接收脉冲周期为1/480MHz整数倍的周期设定指令，即第一周期步长为1/480MHz，并能够有效实现与设定指令相匹配的数字脉冲输出。第一脉宽步长是人为设定的，设定的最小值取决于系统的硬件性能。具体实施例2如图2所示，在具体实施1的基础上增设了数据拼接器；RAM读控制器所读取的并行数据经由数据拼接器根据宽度和周期设定指令进行拼接转换后，送往并行转串行模块。具体地，RAM读控制器在每个循环，依次读取RAM中所有的字；每个字为M位；在第一个循环中，RAM读控制器读到最后一个字时，数据拼接器采用缓存的数据替代最后一个字的高W位数据；所述缓存的数据为该循环内，RAM读控制器所读出的第一个字的低W位数据；除第一个循环的最后一个字，数据拼接器直接输出RAM读控制器正常读取的字；在每个循环，数据拼接器获取当前地址中字的高W位数据，作为下一个循环该地址中字的低W位数据；并获取当前地址下一个字的低M-W位数据，作为下个循环该地址的字的高M-W位数据；数据拼接器将生成的下个循环的字发送至RAM，由RAM读控制器在下个循环读取；W表示的比特数，其取值取决于数字脉冲的周期设定指令。FPGA高速收发器线速为S；N表示RAM中所有字的个数；并行转串行模块输出的串行数据流周期T=·M+W)/S。编码器将接收到的设定指令发送至RAM读控制器，RAM读控制器基于设定指令控制数据拼接器选择相应比特数的低位数据和高位数据进行拼接操作，以生成下个循环的字并发送至RAM。本具体实施例中N的取值为3，M的取值为32，W的取值为20。如图3所示，每一行从左到右分别代表每个循环RAM读控制器依次从RAM读取的3个字。第一行代表在第一个循环RAM读控制器从RAM读取的3个字。其中第一个和第二个字为RAM读控制器正常读取的数据并经由数据拼接器直接发送至并行转串行模块，数据拼接器不对该数据进行拼接操作。针对第一个循环的第3个字，由于缓存的字为该周期内第一个字的低20位数据，即FFF00。所有由数据拼接器将读出的第3个字的处于高20位的字由缓存的字FFF00替换，与原始的剩余的低12位的字00F拼接，作为该循环的所读取的最后一个字FFF0000F，将拼接形成字发送至并行转串行模块；所述缓存的字为该循环内，RAM读控制器所读出的第一个字的低20位数据，即FFF00。RAM的每个字被读出后，立刻接收数据拼接器所生成的下一个循环的字，下一个循环更新的字由当前循环中相同地址的字和下一个字拼接得到。对于每个循环最后一个字，其下一个字为下一个循环第一个字。如图3所示，第二个循环的第一个字，由第一个循环中第二个字的低20位数据FFFFF作为其高位数据，和第一循环中第一个字的高12位数据FFF作为其低12位数据，拼接形成FFFFFFFF。第二个循环的第2个字，由第一个循环中第3个字的低20位数据0000F作为其高20位数据，和第一个循环中第2个字的高12位数据FFF作为其低12位数据，拼接形成0000FFFF。第二循环的第3个字，由第2个循环中第1个字的低20位数据FFFFF作为其高20位数据，和第一循环中第3个字的高12位数据FFF作为其低12位数据，拼接形成FFFFFFFF。由此类推，在下个循环，再由RAM读控制器将由数据拼接器形成的字从RAM中正常读取，并经由数据拼接器直接发送至并行转串行模块，数据拼接器在该数据发送过程中同步对数据进行拼接操作以生成下下个循环的字并发送至RAM。具体实施例2的第二周期步长为1/15.36GHz，本具体实施例中输出的周期性波形的正脉冲宽度为1.875个1/480MHz，波形周期为2.375个1/480MHz。并行转串行模块周期性循环的总周期为19个1/480MHz周期。如图3所示，第1个并行数据为0xFFFFFF00，第20个并行数据也为0xFFFFFF00。具体实施例3如图4所示，在具体实施例2的基础上，收发器内还配置有锁相环模块、相位内插模块和时钟分频器；基准时钟经过锁相环模块得到的高频时钟由相位内插模块进行相位调节后，经过时钟分频器生成参考时钟发送至缓冲器；相位内插模块根据宽度和周期设定指令调整高频时钟相位，从而调整并行转串行模块输出的串行数据流上升沿和下降沿的位置，最终实现FPGA高速收发器输出的串行数据流的脉宽和周期的调节。编码器将接收到的数字脉冲的宽度和周期设定指令发送至FPGA高速收发器内的相位内插模块。相位内插模块调整串行数据流的相位的过程包括：如图5所示，当串行数据流达到上升沿时，高频时钟的相位为第一相位phase1；相位内插模块在串行数据流为高电平时，改变高频时钟的相位为第二相位phase2；当串行数据流达到下降沿时，高频时钟在第二相位的相位下输出串行数据流；此时下降沿的位置相比相位内插调节前改变了，在本实施例中该变化最小为1.02皮秒。如图6所示，当串行数据流达到上升沿时，高频时钟的相位为第三相位phase3；相位内插模块在下一个上升沿到达前，改变高频时钟的相位为第四相位phase4；当串行数据流达到下一个上升沿时，高频时钟在第四相位的相位下输出串行数据流；此时两个上升降沿的位置相比相位内插调节前改变了，在本实施例中该变化最小为1.02皮秒。第一相位和第二相位的取值取决于宽度设定指令。第三相位和第四相位的取值取决于周期设定指令。第一相位和第三相位的设定可以在FPGA程序编写中进行设定；FPGA在程序执行过程中，基于设定指令进一步调整第二相位与第一相位差值和第四相位与第三相位差值的取值。编码器按照设定的第一脉宽步长调整数字脉冲的宽度；编码器将设定的第一脉宽步长乘以RAM中单个字的长度作为第一周期步长，以调整数字脉冲的周期；数据拼接器以第一脉宽步长作为第二周期步长，以调整数字脉冲的周期；相位内插模块以第一脉宽的1/64作为第二脉宽步长，以调整数字脉冲的宽度；将第二周期步长的1/64作为第三周期步长，以调整数字脉冲的周期。基于数字脉冲的宽度和周期的设定指令，编码器、数据拼接器和相位内插模块依次执行数字脉冲的宽度和周期的调整过程，其中编码器按照第一脉宽步长和第一周期步长调整数字脉冲的宽度和周期；数据拼接器针对编码器无法覆盖的精度范围，按照第二周期步长调整数字脉冲的周期；相位内插模块针对编码器和数据拼接器无法覆盖的精度范围，按照第二脉宽步长和第三周期步长调整数字脉冲的宽度和周期。具体实施例3中，基于数字脉冲的宽度和周期设定指令，分别设定编码器、数据拼接器和相位内插模块的控制参数：编码器以1/480MHz为步长执行数字脉冲的周期调整，以1/15.36GHz为步长执行数字脉冲的宽度调整；数据拼接器以1/15.36GHz为步长执行数字脉冲的周期的调整；相位内插模块以1.02皮秒为步长执行数字脉冲的宽度与周期的调整。即针对数字脉冲的宽度和周期的设定指令，周期指令中可以被1/480MHz除尽的部分数值，以及脉冲宽度指令中可以被以1/15.36GHz除尽的部分数值，采用编码器设定相应的比特流中1的个数和长度，完成该部分数值的调整，实现初步的调整。然后针对周期指令中，编码器的控制参数未能覆盖到的部分数值，其中可以被1/15.36GHz除尽的部分数值，采用数据拼接器设定相应的拼接比特数W，完成该部分数值的调整，实现进一步的精调。最后针对周期和宽度指令中，编码器和数据拼接器的控制参数仍未能覆盖到的部分数值，采用相位内插模块设定相应第一相位和第二相位的差值，以及第三相位和第四相位的差值的取值，完成该部分数值的调整，实现最终的精调。具体实施例3中单次相位调节步长范围为1.02皮秒的0到15倍。通过多次精确的调节产生脉冲的高速时钟的前沿和后沿，具体实施例3可实现步长为1.02皮秒的波形宽度与周期的调节。相对于具体实施例2，具体实施例3的调节步长压缩了64倍，大大提升系统的精度。本说明书中未作详细描述的内容属于本领域专业技术人员公知的现有技术。
