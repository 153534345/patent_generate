标题title
基于分水岭的WC颗粒电镜图像分割及粒度分布计算方法
摘要abst
本发明属于图像处理技术领域，公开了一种基于分水岭的WC颗粒电镜图像分割及粒度分布计算方法。所述方法利用计算机视觉的图像处理方法对WC颗粒的原始图像进行预处理，对图像提取ROI区域，对每一个ROI区域进行图像分割操作，包括使用欧式距离变换获得距离变换图像，使用局部均值法生成ROI区域最佳分割阈值，使用连通组件分析得到标记图像，使用分水岭算法对标记图像进行分割，提取其边缘轮廓，进而通过图像像素信息对其特征进行提取。通过识别出的颗粒轮廓计算获得颗粒的物理面积，将颗粒面积转换为等效圆直径，计算PSD结果。本发明能高效且精准地完成WC颗粒分割并对其PSD结果提取，可用来准确地预测颗粒的性能，便于硬质合金制备过程中进行调整和控制。
权利要求书clms
1.基于分水岭的WC颗粒电镜图像分割方法，其特征在于，所述方法包括以下步骤：S1.获取WC颗粒的原始图像并进行图像预处理；S2.对图像轮廓进行初步提取，对每个轮廓提取ROI区域；S3.遍历每个ROI区域，并对每个ROI区域单独进行步骤S31至步骤S35的处理，将各ROI区域处理结果覆盖到原图的对应区域上；S31.对ROI区域图像进行双边滤波预处理，然后对图像进行灰度化、二值化处理得到二值图像；S32.使用欧式距离变换方法处理图像得到距离变换图像；S33.使用高斯平滑函数处理距离变换图像，使用局部均值的方法获得前景像素最佳阈值并进行二值化处理；S34.对二值图像进行膨胀处理，将形态学处理后的图像与距离变换图像在每一个阈值下的二值化结果做差值运算，得到未知区域；S35.遍历差值后的图像像素，找出非零像素，并在连通区域标记图对应位置做上标记；应用分水岭算法使用标记执行图像分割。2.根据权利要求1所述的基于分水岭的WC颗粒电镜图像分割方法，其特征在于，所述步骤S31中，对ROI区域图像进行双边滤波预处理的方法包括：对于任意图像，给定其输出图像/＞，其在图像坐标处的任一像素的双边滤波函数表示如下：其中表示经过双边滤波后的输出图像/＞在坐标/＞处的像素值；/＞表示滤波器的半径；/＞表示输入图像/＞中坐标为/＞处的像素值；表示权重函数，用于计算在给定位置的像素对输出像素的影响；i、j分别表示在输入图像I中横坐标方向、纵坐标方向上的像素偏移量，范围是从/＞到/＞；/＞表示归一化的双边权重，其函数表示为：其中，表示滤波器的半径；i、j分别表示在输入图像I中横坐标方向、纵坐标方向上的像素偏移量/＞范围是从/＞到/＞；/＞是空间域权重，衡量像素与中心像素/＞之间的空间距离，/＞是灰度值域权重，衡量像素与中心像素/＞之间的像素值相似度，均使用高斯函数进行计算：其中i、j分别表示在输入图像I中横坐标方向、纵坐标方向上的像素偏移量、/＞分别为空间域标准差、灰度值域标准差。3.根据权利要求1所述的基于分水岭的WC颗粒电镜图像分割方法，其特征在于，所述步骤S31中，对图像进行灰度化、二值化处理得到二值图像的方法具体为：通过分析图像的灰度分布直方图特点，选择使用OTSU算法得到图像区间最佳二值化阈值，对图像进行二值化处理。4.根据权利要求1所述的基于分水岭的WC颗粒电镜图像分割方法，其特征在于，所述步骤S32中，使用欧式距离变换方法处理图像得到距离变换图像的方法具体为：使用欧式距离变换方法对二值图像进行处理，得到每个像素点与最近边缘像素之间的距离，即计算出每个前景像素到最近背景像素的距离，并将计算结果进行归一化，将其作为像素的灰度值，生成距离变换图像。5.根据权利要求1所述的基于分水岭的WC颗粒电镜图像分割方法，其特征在于，所述步骤S32中，对于二值图像I，其中像素点的取值为0或1，分别表示背景和前景，找到每一个前景像素到最近背景像素点的最短欧式距离，获得距离灰度值并使用归一化公式将其归一化获得；欧式计算的距离公式如下所示， ， /＞其中，表示一个前景像素，x1、y1分别为前景像素p的横、纵坐标；/＞表示一个背景像素，x2、y2分别为背景像素q的横、纵坐标；/＞表示前景像素为经过归一化处理后的欧式距离。6.根据权利要求1所述的基于分水岭的WC颗粒电镜图像分割方法，其特征在于，所述步骤S33中，使用局部均值的方法获得前景像素最佳阈值并进行二值化处理的过程具体包括：根据局部均值图像生成一个二值掩模，将距离变换图像中大于局部均值的像素标记为前景像素，小于等于局部均值的像素标记为背景像素，然后将前景像素的平均灰度值作为阈值对图像进行二值化处理，得到分割结果。7.根据权利要求1所述的基于分水岭的WC颗粒电镜图像分割方法，其特征在于，在步骤S34前，还设有步骤：使用连通组件分析算法对确定的前景标记进行分析，得到初始标记图像，其中前景区域的标记值为2，背景区域的标记值为1。8.一种基于分水岭的WC颗粒电镜图像粒度分布计算方法，其特征在于，应用权利要求1至7任一项所述基于分水岭的WC颗粒电镜图像分割方法获得分割后的WC颗粒电镜图像；计算颗粒的等效圆直径，统计各区间等效直径频率绘制直方图获得PSD结果。9.根据权利要求8所述的基于分水岭的WC颗粒电镜图像粒度分布计算方法，其特征在于，计算颗粒的等效圆直径的方法包括：根据获得的WC颗粒的轮廓计算电镜图像分辨率，遍历每一个WC颗粒轮廓，通过计算轮廓内部的像素点个数得到颗粒面积，将颗粒面积转换为等效圆直径，其具体的计算公式分别为：，/＞其中，u 是焊点轮廓上的像素点的索引； N是焊点轮廓上的像素点的总数；为锡焊轮廓上或轮廓内的第u个像素；/＞是颗粒的面积。10.根据权利要求8或9所述的基于分水岭的WC颗粒电镜图像粒度分布计算方法，其特征在于，统计各区间等效直径频率绘制直方图获得PSD结果的方法具体包括：将等效直径数据按照一定的间隔进行分组，并统计每个区间内的等效直径频率，将区间设置为X轴，等效直径频率设置为Y轴，绘制直方图获得PSD结果。
说明书desc
技术领域本发明属于图像处理技术领域，特别涉及基于分水岭的WC颗粒电镜图像分割及粒度分布计算方法。背景技术WC颗粒是一种硬质合金颗粒，主要由钨碳化物和钴粉末组成，通常被称为钨钴颗粒。它具有硬度高、耐磨性好、耐高温、抗腐蚀等优良性质，因此被广泛应用于各种领域，具有广泛的应用前景。在硬质合金的制备过程中，WC颗粒粒度分布对微区变形和力学行为有着重要的影响。微观变形机理分析表明粒度分布更为均匀的合金，其应力分布也更为均匀，从而材料有更好的力学性能。其同时影响了复合涂层微观组织、硬度、断裂韧性及界面结合强度，是WC质量的重要分析指标。目前实际测量颗粒尺寸都是统计性的指标，常用的方法有费氏粒度、BET法、激光粒度法等。但这些方法都是测得相对粒度，绝对粒度难以测出。因为颗粒会团聚吸附，无法反应真实粒度。这些都妨碍了生产过程中及时地由结果指导，因此，及时且准确的在线PSD分析方法是迫切需要的。PSD分析方法的核心是颗粒边缘的分割识别。然而WC颗粒形状多样，并不规则且大小不一，表面粗糙，具有许多微小的凸起和凹陷，边缘较为模糊，电镜下图像有大量的噪声还有和WC颗粒形状近似的絮状污渍，这些都对分割效果有较大的影响。基于WC颗粒的特点，人工识别效率太低，传统分割方法也无法直接精准的实现分割。发明内容为了解决以上问题，本发明提供一种基于分水岭的WC颗粒电镜图像分割方法，方法高效且能精准地完成WC颗粒分割任务。具体技术方案如下。基于分水岭的WC颗粒电镜图像分割方法，包括以下步骤：S1.获取WC颗粒的原始图像并进行图像预处理；S2.对图像轮廓进行初步提取，对每个轮廓提取ROI区域；S3.遍历每个ROI区域，并对每个ROI区域单独进行步骤S31至步骤S35的处理，将各ROI区域处理结果覆盖到原图的对应区域上；S31.对ROI区域图像进行双边滤波预处理，然后对图像进行灰度化、二值化处理得到二值图像；S32.使用欧式距离变换方法处理图像得到距离变换图像；S33.使用高斯平滑函数处理距离变换图像，使用局部均值的方法获得前景像素最佳阈值并进行二值化处理；S34.对二值图像进行膨胀处理，将形态学处理后的图像与距离变换图像在每一个阈值下的二值化结果做差值运算，得到未知区域；S35.遍历差值后的图像像素，找出非零像素，并在连通区域标记图对应位置做上标记；应用分水岭算法使用标记执行图像分割。进一步地，所述步骤S31中，对ROI区域图像进行双边滤波预处理的方法包括：对于任意图像，给定其输出图像/＞，其在图像坐标处的任一像素的双边滤波函数表示如下：其中为经过双边滤波后的输出图像/＞在坐标/＞处的像素值；/＞为滤波器的半径；/＞表示输入图像/＞中坐标为/＞处的像素值；表示权重函数，用于计算在给定位置的像素对输出像素的影响；i、j分别表示在输入图像I中横坐标方向、纵坐标方向上的像素偏移量，范围是从/＞到/＞；/＞表示归一化的双边权重，其函数表示为：其中，表示滤波器的半径；i、j分别表示在输入图像I中横坐标方向、纵坐标方向上的像素偏移量/＞范围是从/＞到/＞；/＞是空间域权重，衡量像素与中心像素/＞之间的空间距离，/＞是灰度值域权重，衡量像素与中心像素/＞之间的像素值相似度，均使用高斯函数进行计算：其中i、j分别表示在输入图像I中横坐标方向、纵坐标方向上的像素偏移量、分别为空间域标准差、灰度值域标准差。进一步地，所述步骤S31中，对图像进行灰度化、二值化处理得到二值图像的方法具体为：通过分析图像的灰度分布直方图特点，选择使用OTSU算法得到图像区间最佳二值化阈值，对图像进行二值化处理。进一步地，所述步骤S32中，使用欧式距离变换方法处理图像得到距离变换图像图像的方法具体为：使用欧式距离变换方法对二值图像进行处理，得到每个像素点与最近边缘像素之间的距离，即计算出每个前景像素到最近背景像素的距离，并将计算结果进行归一化，将其作为像素的灰度值，生成距离变换图像。进一步地，所述步骤S32中，对于二值图像I，其中像素点的取值为0或1，分别表示背景和前景，找到每一个前景像素到最近背景像素点的最短欧式距离，获得距离灰度值并使用归一化公式将其归一化获得；欧式计算的距离公式如下所示，，/＞其中，表示一个前景像素，x1、y1分别为前景像素p的横、纵坐标；表示一个背景像素，x2、y2分别为背景像素q的横、纵坐标；/＞表示前景像素为经过归一化处理后的欧式距离。进一步地，所述步骤S33中，使用局部均值的方法获得前景像素最佳阈值并进行二值化处理的过程具体包括：根据局部均值图像生成一个二值掩模，将距离变换图像中大于局部均值的像素标记为前景像素，小于等于局部均值的像素标记为背景像素，然后将前景像素的平均灰度值作为阈值对图像进行二值化处理，得到分割结果。进一步地，在步骤S34前，还设有步骤：使用连通组件分析算法对确定的前景标记进行分析，得到初始标记图像，其中前景区域的标记值为2，背景区域的标记值为1。本发明的另一目的在于提供一种基于分水岭的WC颗粒电镜图像粒度分布计算方法，用以准确地预测颗粒的性能，以在硬质合金制备过程中进行调整和控制，可选择适合不同应用场景的颗粒材料来提高产品性能，满足生产需求。方法包括：应用上述基于分水岭的WC颗粒电镜图像分割方法获得分割后的WC颗粒电镜图像；计算颗粒的等效圆直径，统计各区间等效直径频率绘制直方图获得PSD结果。进一步地，计算颗粒的等效圆直径的方法包括：根据获得的WC颗粒的轮廓计算电镜图像分辨率，遍历每一个WC颗粒轮廓，通过计算轮廓内部的像素点个数得到颗粒面积，将颗粒面积转换为等效圆直径，其具体的计算公式分别为：，/＞其中，u是焊点轮廓上的像素点的索引；N是焊点轮廓上的像素点的总数；为锡焊轮廓上或轮廓内的第u个像素；/＞是颗粒的面积。进一步地，统计各区间等效直径频率绘制直方图获得PSD结果的方法具体包括：将等效直径数据按照一定的间隔进行分组，并统计每个区间内的等效直径频率，将区间设置为X轴，等效直径频率设置为Y轴，绘制直方图获得PSD结果。与现有技术相比，上述技术方案之一或多个技术方案能达到至少以下有益效果之一：本发明利用计算机视觉的图像处理方法对WC颗粒的原始图像进行预处理，对图像提取ROI区域，对每一个ROI区域进行图像分割操作，包括使用欧式距离变换获得距离变换图像，使用局部均值法生成ROI区域最佳分割阈值，使用连通组件分析得到标记图像，使用分水岭算法对标记图像进行分割，提取其边缘轮廓，进而通过图像像素信息对其特征进行提取。通过识别出的颗粒轮廓计算获得颗粒的物理面积，将颗粒面积转换为等效圆直径，计算PSD结果。本发明能高效且精准地完成WC颗粒分割任务，实现了WC颗粒的在线PSD分析功能；相较于人工识别的传统方法，本发明可以提供高效、准确、非破坏性的测量手段，获取精确的WC颗粒PSD信息，便于在生产过程中提供及时有效的指导。附图说明为了更清楚地说明本发明实施例的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为实施例2基于分水岭的WC颗粒电镜图像分割方法流程示意图。图2为实施例1ROI区域选择示意图。图3为实施例1单独处理区域示意图。图4为实施例1保留边缘滤波处理效果图。图5为实施例1二值化处理效果图。图6为实施例1欧式距离变换处理效果图。图7为实施例1ROI区域最终分割效果图。图8为本实施例1图像最终分割效果图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有作出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。实施例1本实施例提供一种基于分水岭的WC颗粒电镜图像分割方法，包括以下步骤：S1.使用电子显微镜采集WC颗粒的原始图像，并使用二值化、形态学操作对其进行预处理，填充孔洞。S2.如图2所示，使用例如Canny算子的边缘识别算法对图像轮廓进行初步提取，对每个轮廓提取ROI区域。S3.遍历每个ROI区域，对每个ROI区域单独进行步骤S31至步骤S35的处理，并将处理结果覆盖到原图区域。如图3所示，将其中3个相邻ROI区域效果进行展示。其中具体的处理方法如下：S31.对ROI区域图像进行双边滤波预处理，然后对图像进行灰度化、二值化处理得到二值图像。S311.对ROI区域图像使用双边滤波进行预处理，对非边缘部分进行平滑，平滑掉图像中的细节部分，有效地去除图像中的噪声和污渍，且保留图像边缘信息，其效果如图4所示。对于任意图像，给定其输出图像/＞，其在图像坐标处的任一像素/＞的双边滤波函数表示如下。其中表示经过双边滤波后的输出图像/＞在坐标/＞处的像素值；/＞表示滤波器的半径；/＞表示输入图像/＞中坐标为/＞处的像素值；表示权重函数，用于计算在给定位置的像素对输出像素的影响；i、j分别表示在输入图像I中横坐标方向、纵坐标方向上的像素偏移量，范围是从/＞到/＞；/＞表示归一化的双边权重，其函数表示为：其中，表示滤波器的半径；i、j分别表示在输入图像I中横坐标方向、纵坐标方向上的像素偏移量/＞范围是从/＞到/＞；/＞是空间域权重，它衡量了像素与中心像素/＞之间的空间距离，/＞是灰度值域权重，它衡量了像素/＞与中心像素/＞之间的像素值相似度，均使用高斯函数进行计算：其中i、j分别表示在输入图像I中横坐标方向、纵坐标方向上的像素偏移量空间域标准差/＞，灰度值域标准差/＞均选择75，窗口大小选择7。S312.对区域图像进行灰度化处理，通过分析图像的灰度分布直方图特点，选择使用OTSU算法得到图像区间最佳二值化阈值，对图像进行二值化处理，其处理结果如图5所示。S32.使用欧式距离变换方法处理图像得到距离变换图像。具体地，使用欧式距离变换方法对上述二值图像进行处理，得到每个像素点与最近边缘像素之间的距离，即计算出每个前景像素到最近背景像素的距离，并将计算结果进行归一化，将其作为像素的灰度值，生成距离变换图像，生成的距离变换图像，如图6所示。欧式计算的距离公式如下所示，对于二值图像I，其中像素点的取值为0或1，分别表示背景和前景，找到每一个前景像素到最近背景像素点的最短欧式距离,获得距离灰度值并使用归一化公式将其归一化获得，以便后续处理和可视化。，/＞其中，表示一个前景像素，x1、y1分别为前景像素p的横、纵坐标；表示一个背景像素，x2、y2分别为背景像素q的横、纵坐标；/＞表示前景像素为经过归一化处理后的欧式距离。S33.使用高斯平滑函数处理灰度图像，使用局部均值的方法获得前景像素最佳阈值并进行二值化处理。具体地，使用高斯平滑函数，对距离变换后的图像进行平滑处理，去除噪声，然后使用局部均值法确定距离变换图像的最佳标记阈值得到局部均值图像。根据局部均值图像生成一个二值掩模，将距离变换图像中大于局部均值的像素标记为前景像素，小于等于局部均值的像素标记为背景像素，然后将前景像素的平均灰度值作为阈值对图像进行二值化处理，得到分割结果。局部均值法的基本思路是通过计算每个像素点周围一定范围内像素的平均灰度值来确定该像素的标记阈值。设当前像素点的灰度值为，邻域的大小为n×n，则该像素点的标记阈值/＞可以通过以下公式计算：其中，表示以/＞为中心的n×n邻域内的像素点，/＞表示对区域内所有像素点灰度值进行求和。计算得到标记阈值/＞后，可以将该像素点的灰度值设为1或0，即：,if/＞,if/＞其中，为像素点/＞的二值化结果。使用连通组件分析算法对确定的前景标记进行分析，得到初始标记图像，其中前景区域的标记值为2，背景区域的标记值为1。S34.对上一步获得的二值图像进行膨胀处理，扩展前景图像，消除细小噪声，方便后续操作能更好的获得前景标记。将形态学处理后的图像与距离变换图像在每一个阈值下的二值化结果做差值运算，得到未知区域的标记，将其标记值设为0。S35.遍历差值后的图像像素，找出非零像素，并在连通区域标记图对应位置做上标记，即得到分水岭掩膜标记。根据分水岭掩膜标记，应用分水岭算法使用标记执行图像分割，获得此区域最终的分割图像，此区域的分割效果如图7所示。如图8所示，将各区域处理结果覆盖到原图的对应区域上，实现图像分割。实施例2如图1所示，本实施例提供一种基于分水岭的WC颗粒电镜图像粒度分布计算方法，包括以下步骤。应用实施例1的基于分水岭的WC颗粒电镜图像分割方法获得分割后的WC颗粒电镜图像，包括步骤S1至步骤S35，其详细实施方式可参见实施例1，此处不再赘述。S1.获取WC颗粒的原始图像并进行图像预处理。S2.对图像轮廓进行初步提取，对每个轮廓提取ROI区域。S3.遍历每个ROI区域，并对每个ROI区域单独进行步骤S31至步骤S35的处理，将各ROI区域处理结果覆盖到原图的对应区域上。S31.对ROI区域图像进行双边滤波预处理，然后对图像进行灰度化、二值化处理得到二值图像。S32.使用欧式距离变换方法处理图像得到距离变换图像。S33.使用高斯平滑函数处理灰度图像，使用局部均值的方法获得前景像素最佳阈值并进行二值化处理。S34.对二值图像进行膨胀处理，将形态学处理后的图像与距离变换图像在每一个阈值下的二值化结果做差值运算，得到未知区域。S35.遍历差值后的图像像素，找出非零像素，并在连通区域标记图对应位置做上标记；应用分水岭算法使用标记执行图像分割。S4.计算颗粒的等效圆直径，统计各区间等效直径频率绘制直方图获得PSD结果。通过识别出的颗粒轮廓计算获得颗粒的物理面积，将颗粒面积转换为等效圆直径。具体地，根据如图8所示获得的WC颗粒的轮廓计算电镜图像分辨率，遍历每一个WC颗粒轮廓，通过计算轮廓内部的像素点个数得到颗粒面积，将颗粒面积转换为等效圆直径，其具体的计算公式分别为：，/＞。其中，u是焊点轮廓上的像素点的索引； N是焊点轮廓上的像素点的总数；为锡焊轮廓上或轮廓内的第u个像素；/＞是颗粒的面积。将等效直径数据按照一定的间隔进行分组，并统计每个区间内的等效直径频率，将区间设置为X轴，等效直径频率设置为Y轴，绘制直方图获得PSD结果。本实施例能高效且精准地完成WC颗粒分割任务并对其PSD结果提取，可用来准确地预测颗粒的性能，便于硬质合金制备过程中进行调整和控制，以选择适合不同应用场景的颗粒材料来提高产品性能，满足生产需求。显然，上述实施例仅仅是为清楚地说明本发明的技术方案所作的举例，而并非是对本发明的实施方式的限定。对于所属领域的普通技术人员来说，在上述说明的基础上还可以做出其它不同形式的变化或变动。凡在本发明的精神和原则之内所作的任何修改、等同替换和改进等，均应包含在本发明权利要求的保护之内。
