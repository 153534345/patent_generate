标题title
一种基于规则引擎实现的模型驱动用户风险行为判别方法
摘要abst
本发明公开了一种基于规则引擎实现的模型驱动用户风险行为判别方法，包括以下步骤：S1：采集包括用户操作行为的日志数据；S2：提取操作行为主体；S3：构建主体行为基线；S4：发现主体异常行为，生成异常事件；S5：构建多个风险场景模型；S6：通过规则引擎解析风险场景模型，基于异常事件和行为日志，进行风险评估；S7：根据规则引擎的评估结果，判定用户行为是否构成风险，本申请能够更精确地判别用户风险行为，降低误报率，并在复杂多样的业务环境下快速适应新的风险场景和行为模式。
权利要求书clms
1.一种基于规则引擎实现的模型驱动用户风险行为判别方法，其特征在于，包括以下步骤：S1：采集包括用户操作行为的日志数据；S2：提取操作行为主体；通过日志数据中的请求元数据信息，得到操作行为接入的网络站点，配置账号提取规则，提取用户账号作为操作行为主体；S3：构建操作行为主体的行为基线；基于日志数据，结合S2提取的操作行为主体，在预设的标签基线粒度下，通过机器学习或统计算法，学习得到操作行为主体的各类行为基线；S4：发现操作行为主体的异常行为，生成异常事件；通过基线异常分析模块，根据S3学习到的操作行为主体的各类行为基线，实时分析日志数据，判断操作行为主体的各类行为指标是否偏离各类基线，若偏离则生成异常事件并进入下一步骤，若未偏离则返回S1；S5：构建多个风险场景模型；每个风险场景模型均包括模型基础信息、生效范围配置、以及规则配置三部分，规则配置中配置有风险规则；S6：通过规则引擎解析风险场景模型，基于异常事件和行为日志，进行风险评估；规则引擎动态加载当前定义的所有风险场景模型并解析模型中的风险规则，规则引擎根据所有规则配置中的风险规则对操作行为主体的异常事件做出风险评估；S7：根据规则引擎的评估结果，判定用户行为是否构成风险；当任意风险评估命中时，从风险评估命中缓存中筛选相同操作行为主体的其他风险评估命中事件，评估操作行为主体是否命中风险场景模型，判定用户行为是否构成风险。2.根据权利要求1所述的一种基于规则引擎实现的模型驱动用户风险行为判别方法，其特征在于，S1中采集日志数据的操作具体步骤为：S1.1：旁路接入企业内网业务系统访问交互的网络流量，基于网络协议采集引擎，对多协议流量进行解析还原，持续生成企业系统用户的操作日志数据；S1.2:对还原出的原始日志数据中的关键指标、请求指令、请求对象、访问内容逐层进行抽取；S1.3：结合对上下行请求响应数据识别敏感与分类分级，完成操作日志数据的初步清洗和打标，并推送到消息组件。3.根据权利要求1所述的一种基于规则引擎实现的模型驱动用户风险行为判别方法，其特征在于，S2中用户账号的获取方法具体为：将各网络站点梳理合并为业务系统，针对单个业务系统，配置账号提取规则，在清洗日志数据时同步提取得到系统的用户账号。4.根据权利要求1所述的一种基于规则引擎实现的模型驱动用户风险行为判别方法，其特征在于，S4中，生成异常事件后，根据基线权重和偏离度因素对事件进行评分；异常事件包含异常主体、异常基线、关联操作日志、异常评分；异常事件会推送到消息组件。5.根据权利要求1所述的一种基于规则引擎实现的模型驱动用户风险行为判别方法，其特征在于，S5中，基础信息包括风险场景模型的名称、用途、状态和告警对象类型；生效范围配置定义了可触发风险评估的日志范围；规则配置定义了具体的风险行为的判定规则；判定规则包括必须规则、可选规则、基线规则、参数规则、单一规则和组合规则。6.根据权利要求5所述的一种基于规则引擎实现的模型驱动用户风险行为判别方法，其特征在于，必须规则和可选规则分别具体为：必须规则：必须规则在必需命中时才能认定操作行为主体的操作行为符合风险场景定义；可选规则：存在多条可选规则的情况下，每条可选规则可单独不命中，若同时命中大于或等于预设条数的可选规则，则认定操作行为主体的操作行为符合风险场景定义。7.根据权利要求5所述的一种基于规则引擎实现的模型驱动用户风险行为判别方法，其特征在于，基线规则和参数规则分别具体为：基线规则：以操作行为主体的操作行为的基线和偏离基线产生的异常事件作为主要评判依据的场景规则，操作行为主体的行为显著偏离基线时，生成基线异常事件，风险分析程序通过对基线异常行为日志、异常主体、异常风险评分进行断言，判定基线规则是否命中；参数规则：以人工配置的行为阈值参数作为主要评判依据的场景规则，通过对流量日志进行实时或近实时流批处理，风险分析程序基于规则约束条件对流量日志、窗口统计数据进行断言，判定参数规则是否命中。8.根据权利要求5所述的一种基于规则引擎实现的模型驱动用户风险行为判别方法，其特征在于，单一规则和组合规则分别具体为：单一规则：一条独立的、具体的规则，单一规则包含一组约束和一个相应的判定断言，当给定约束条件满足时，单一规则触发相应的断言评估；组合规则：由多个单一规则或组合规则组合而成的规则体系，组合规则可相互关联、嵌套或按预设的顺序执行，组合规则用于处理多个条件之间的复杂关系或在不同情境下采取多个行动。9.根据权利要求1所述的一种基于规则引擎实现的模型驱动用户风险行为判别方法，其特征在于，S6的具体操作步骤为：规则引擎中的风险行为判别程序启动，将当前定义的所有风险场景模型加载到内存缓存中，并支持订阅模型变更消息，规则引擎提取风险场景模型中的所有判定规则，对所有判定规则进行分组；风险行为判别程序实时订阅用户操作日志消息和基线异常事件消息，根据消费的消息类型，分别执行不同判定规则的逻辑。
说明书desc
技术领域本发明属于数据安全技术领域，具体涉及一种基于规则引擎实现的模型驱动用户风险行为判别方法。背景技术近年来，传统的病毒、木马、钓鱼等网络攻击方法已不再是企业系统的主要威胁，而是转变为以APT、社工、内部人员违规等为主要威胁。这一变化表明，网络威胁不断演进，攻击者正在采用更为高级和隐蔽的手段，以获取对企业系统和数据的未授权访问。在这种新的威胁环境下，企业不能再仅仅依靠传统的防病毒、防火墙软件作为主要防御手段，还需采取更先进有力的安全措施，如部署使用数据防泄漏产品、数据安全监测产品等。上述这些产品在实现和侧重点上虽然会有所区别，但共同点在于都会使用行为监测技术。通过对用户的访问行为进行监测和分析，对比自身策略库，发现可能会对企业数据安全产生威胁的风险异常行为，及时告警或阻断。目前，风险行为判别的方法总体上可分为以下三种类型：规则检测法：通常涉及制定一组规则或策略，以定义正常和异常行为。当用户的行为与这些规则不符时，即可认为存在异常行为。异常检测法：针对历史行为数据，通过统计或机器学习技术，如方差-标准差计算、箱线图、聚类分析、离群点检测等方法，识别其中与多数行为不符的异常模式，认定为异常行为。历史行为模型法：基于用户的历史行为数据构建模型，形成用户在特定维度的行为基线，并在检测到偏离基线的不寻常活动时生成告警。这些方法的局限性如下：规则检测法通过支持制定规则策略，提供了较好的灵活性。但规则制定，特别是规则中阈值的制定，严重依赖于特定领域的安全专家的经验，且由于场景多样和用户行为的多变性，在不同企业中制定的规则很难通用，导致具有较高的使用门槛，且一旦阈值设置不合理，就会造成误报和漏报。异常检测法虽然能够发现历史行为数据中与多数行为不符的异常模式，但这种方法难以对异常模式进行准确归类。此外，由于企业系统往往业务复杂、用户角色繁多，客观上也存在部分角色用户的行为模式与多数用户不同的情况，使用此方法很难准确区分。再有就是异常检测法通常是对一定时间区间内的所有历史行为数据进行检测分析，作为事后分析方法，基本无法达到良好的实时性。历史行为模型法，这种方法通过对真实历史数据学习分析，形成用户的行为基线，一定程度上可以解决规则阈值制定难的问题，并且针对新产生的用户行为，可以及时判别用户行为是否偏离基线，发现风险行为。但是，该方法难以适应复杂业务场景，其只能针对事先梳理出来的单一场景维度，定制开发对应的基线学习模型，而无法在运行时动态针对新的场景维度构建基线模型。本发明的目标是为了克服上述方法的局限，提供一种基于规则引擎实现的模型驱动用户风险行为判别方法，能够更精确地判别用户风险行为，降低误报率，并在动态环境下快速适应新的风险场景和行为模式。发明内容为解决上述背景技术中提出的问题，本发明提供一种基于规则引擎实现的模型驱动用户风险行为判别方法，以解决现有技术会造成误报和漏报，无法达到良好的实时性和难以适应复杂业务场景的问题。为实现上述目的，本发明提供如下技术方案：一种基于规则引擎实现的模型驱动用户风险行为判别方法，包括以下步骤：S1：采集包括用户操作行为的日志数据；S2：提取操作行为主体；通过日志数据中的请求元数据信息，得到操作行为接入的网络站点，配置账号提取规则，提取用户账号作为操作行为主体；S3：构建操作行为主体的行为基线；基于日志数据，结合S2提取的操作行为主体，在预设的标签基线粒度下，通过机器学习或统计算法，学习得到操作行为主体的各类行为基线；S4：发现操作行为主体的异常行为，生成异常事件；通过基线异常分析模块，根据S3学习到的操作行为主体的各类行为基线，实时分析日志数据，判断操作行为主体的各类行为指标是否偏离各类基线，若偏离则生成异常事件并进入下一步骤，若未偏离则返回S1；S5：构建多个风险场景模型；每个风险场景模型均包括模型基础信息、生效范围配置、以及规则配置三部分，规则配置中配置有风险规则；S6：通过规则引擎解析风险场景模型，基于异常事件和行为日志，进行风险评估；规则引擎动态加载当前定义的所有风险场景模型并解析模型中的风险规则，规则引擎根据所有规则配置中的风险规则对操作行为主体的异常事件做出风险评估；S7：根据规则引擎的评估结果，判定用户行为是否构成风险；当任意风险评估命中时，从风险评估命中缓存中筛选相同操作行为主体的其他风险评估命中事件，评估操作行为主体是否命中风险场景模型，判定用户行为是否构成风险。优选地，S1中采集日志数据的操作具体步骤为：S1.1：旁路接入企业内网业务系统访问交互的网络流量，基于网络协议采集引擎，对多协议流量进行解析还原，持续生成企业系统用户的操作日志数据；S1.2:对还原出的原始日志数据中的关键指标、请求指令、请求对象、访问内容逐层进行抽取；S1.3：结合对上下行请求响应数据识别敏感与分类分级，完成操作日志数据的初步清洗和打标，并推送到消息组件。优选地，S2中用户账号的获取方法具体为：将各网络站点梳理合并为业务系统，针对单个业务系统，配置账号提取规则，在清洗日志数据时同步提取得到系统的用户账号。优选地，S4中，生成异常事件后，根据基线权重和偏离度因素对事件进行评分；异常事件包含异常主体、异常基线、关联操作日志、异常评分；异常事件会推送到消息组件。优选地，S5中，基础信息包括风险场景模型的名称、用途、状态和告警对象类型；生效范围配置定义了可触发风险评估的日志范围；规则配置定义了具体的风险行为的判定规则；判定规则包括必须规则、可选规则、基线规则、参数规则、单一规则和组合规则。优选地，必须规则和可选规则分别具体为：必须规则：必须规则在必需命中时才能认定操作行为主体的操作行为符合风险场景定义；可选规则：存在多条可选规则的情况下，每条可选规则可单独不命中，若同时命中大于或等于预设条数的可选规则，则认定操作行为主体的操作行为符合风险场景定义。优选地，基线规则和参数规则分别具体为：基线规则：以操作行为主体的操作行为的基线和偏离基线产生的异常事件作为主要评判依据的场景规则，操作行为主体的行为显著偏离基线时，生成基线异常事件，风险分析程序通过对基线异常行为日志、异常主体、异常风险评分进行断言，判定基线规则是否命中；参数规则：以人工配置的行为阈值参数作为主要评判依据的场景规则，通过对流量日志进行实时或近实时流批处理，风险分析程序基于规则约束条件对流量日志、窗口统计数据进行断言，判定参数规则是否命中。优选地，单一规则和组合规则分别具体为：单一规则：一条独立的、具体的规则，单一规则包含一组约束和一个相应的判定断言，当给定约束条件满足时，单一规则触发相应的断言评估；组合规则：由多个单一规则或组合规则组合而成的规则体系，组合规则可相互关联、嵌套或按预设的顺序执行，组合规则用于处理多个条件之间的复杂关系或在不同情境下采取多个行动。优选地，S6的具体操作步骤为：规则引擎中的风险行为判别程序启动，将当前定义的所有风险场景模型加载到内存缓存中，并支持订阅模型变更消息，规则引擎提取风险场景模型中的所有判定规则，对所有判定规则进行分组；风险行为判别程序实时订阅用户操作日志消息和基线异常事件消息，根据消费的消息类型，分别执行不同判定规则的逻辑。与现有技术相比，本发明的有益效果是：1、精确性：针对每个用户主体学习行为基线，自动根据用户行为与基线的偏离度产生异常事件，减少人工阈值配置，降低运营门槛；支持基线规则、参数规则结合，并在模型规则、规则约束、规则断言、断言运算等各层级支持组合逻辑，支持通过前置规则定义和前置判定，映射特定情境的时间关系，照映现实复杂风险场景。综合以上特点，本发明发放能够更准确地判别用户风险行为，降低误报率。2、动态性：用户风险行为判定由公开的风险场景模型驱动，允许根据需求实际，基于本模型动态定义风险场景，规则引擎支持动态加载风险场景模型，根据模型定义的规则驱动不同的判别逻辑，适应新的风险行为模式。3、高效性：通过对用户操作日志和异常事件消息的实时和近实时数据流批处理，依靠模型驱动规则引擎进行风险评估，能够在大规模用户行为数据下快速进行风险判别，提高效率。总体而言，本发明能够更精确地判别用户风险行为，降低误报率，并在复杂多样的业务环境下快速适应新的风险场景和行为模式。附图说明图1为本申请的流程示意图。具体实施方式为便于本领域技术人员理解本发明的技术内容，以下结合附图和具体的实例对本发明作进一步地详细说明。应当理解，此处所描述的具体实例仅用以解释本发明，并不用于限定本发明。实施例1：如图1所示，一种基于规则引擎实现的模型驱动用户风险行为判别方法，包括以下步骤：S1：采集用户操作行为日志数据；旁路接入企业内网业务系统访问交互的网络流量，基于网络协议采集引擎，对多协议流量进行解析还原，持续生成企业系统用户的操作日志数据。然后对这些还原出的较原始日志数据中的关键指标、请求指令、请求对象、访问内容逐层进行抽取，结合对上下行请求响应数据识别敏感与分类分级，完成操作日志数据的初步清洗和打标，并推送到消息组件。S2：提取操作行为主体；基于操作日志中的目标IP端口等请求元数据信息，发现流量中接入的网络站点，并根据实际将各网络站点梳理合并为业务系统。针对单个业务系统，配置账号提取规则，进而在清洗日志数据时同步提取发现系统的用户账号，作为操作行为主体。S3：学习主体行为基线；基于系统用户操作日志，结合上一步骤提取的操作行为主体，在预设的标签基线粒度下，通过机器学习或统计算法，学习得到主体的各类行为基线。S4：发现主体异常行为，生成异常事件；由基线异常分析模块，根据上一步骤学习得到的主体行为基线，实时分析操作日志数据，结合统计算法、时间序列算法等，判断主体的行为指标是否偏离基线，若显著偏离基线，则生成异常事件，并根据基线权重、偏离度等因素对事件进行评分。异常事件包含异常主体、异常基线、关联操作日志、异常评分等。异常事件会推送到消息组件。S5：构建风险场景模型；发明公开了一种用于风险行为判别的风险场景模型，该模型支持动态定义，允许管理员针对企业系统复杂多变的真实风险场景，按需进行调整和优化。风险场景模型主要包括模型基础信息、生效范围配置、以及规则配置三部分。基础信息部分描述了模型的名称、用途、状态和告警对象类型；生效范围配置部分，定义了可以触发风险评估的日志范围；规则配置部分，定义了具体的风险行为判定规则。其中，风险场景模型的规则配置部分，是模型定义的核心。本发明公开的风险场景模型，将规则从必要性角度，分为必须规则和可选规则；从实现角度，分为基线规则和参数规则；从构成角度，分为简单规则和组合规则。以下分别进行说明：必须规则：指示该场景规则必需命中，才能认定主体行为符合风险场景定义。可选规则：指示该场景规则可以不命中，但所有可选规则，应命中至少“最小可选规则命中数”条规则，方能认定主体行为符合风险场景定义。基线规则：以主体行为基线和偏离基线产生的异常事件作为主要评判依据的场景规则。主体行为显著偏离基线时，会生成基线异常事件，风险分析程序通过对基线异常行为日志、异常主体、异常风险评分等因子进行断言，判定基线规则是否命中。参数规则：以人工配置的行为阈值参数作为主要评判依据的场景规则。通过对流量日志进行实时或近实时流批处理，风险分析程序基于规则约束条件对流量日志、窗口统计数据等因子进行断言，判定参数规则是否命中。单一规则：一条独立的、具体的规则，这种规则通常包含一组约束和一个相应的判定断言。当给定约束条件满足时，单一规则会触发相应的断言评估。例如，一个简单的单一规则示例情境可以是：工作时间范围内，调用超过100种API的账号需要告警。在这个规则中，约束是"访问时间介于09:00和18:00"，断言是"访问的API接口数量大于100"。组合规则：由多个单一规则或组合规则组合而成的更复杂的规则体系。这些规则可以相互关联、嵌套或按预设的顺序执行，以支持更复杂的情境行为。组合规则通常用于处理多个条件之间的复杂关系或在不同情境下采取多个行动。例如，一小时内访问业务系统超过1000次，且大量下载敏感数据或访问敏感数据频次超过或下载超过50M+频次超过50次。在这个情境中，“一小时内访问业务系统超过1000次”是一个单一规则，“大量下载敏感数据或访问敏感数据频次超过或下载超过50M+频次超过50次”是一个组合规则，同时这两个规则通过逻辑与运算又构成了一个新的组合规则。风险场景模型中的一条单一规则，通常除了名称、所属场景模型等通用属性外，还包含该规则的前置生效规则清单，以表征规则之间的先后顺序，映射现实复杂场景中特定情境的时间关系。特别的，任意一条单一规则，可以是基线规则，也可以是参数规则。前者需指定触发规则评估的基线异常，后者需指定触发规则评估的参数约束。此外，两者都需要指定评估判定规则是否命中的断言。规则断言主要包含以下内容：限定对象、窗口函数、统计窗口、窗口统计附加维度、断言运算等。限定对象可以是异常事件的评分、操作日志的属性、异常主体的属性或前置规则判定结果的属性，代表了断言运算的左操作数；窗口函数支持对限定对象进行初步的窗口求值，受支持的窗口函数包括求和、求平均、最小值、最大值、计数、去重等，特别的，去重函数可以与其他窗口函数叠加计算；统计窗口限定了窗口函数计算的时间区间；附加维度允许指定更精细的统计粒度；最后是断言运算，通常是一个比较运算，可以指定上述基于限定对象通过窗口函数计算后得到的左操作数，在指定右操作数的比较运算。当运算为真时，表示规则评估判定命中。特别的，规则断言和其中的断言运算，也支持逻辑组合。基线规则通过关联基础基线的方式区分能够触发规则评估的主体基线异常事件。而参数规则，则是通过设定参数约束，触发规则评估，其在结构上与断言类似，只是不再包含窗口统计的相关属性和逻辑。S6：通过规则引擎解析风险场景模型规则，基于异常事件和行为日志，进行风险评估；发明公开了一种可解析风险场景模型规则，进行风险评估的规则引擎。该规则引擎是用户风险行为判别程序的核心组件，可以动态加载当前定义的所有风险场景模型，解析模型中的规则，并根据规则定义，评估判定用户行为是否是风险行为，做相应告警。以下做详细阐述：风险行为判别程序启动时，会将当前定义的所有风险场景模型加载到内存缓存中，并支持订阅模型变更消息，以便于及时更新内存缓存中的风险场景模型。规则引擎会提取程序加载的风险场景模型中的所有规则，包括简单规则和组合规则，然后根据模型规则是否具有前置规则，以及类型是基线规则还是参数规则，对所有规则进行分组。对于有前置规则要求的规则，在前置规则未命中时，可以不进行命中判定，以提高程序运行效率。风险行为判别程序会实时订阅用户操作日志消息和基线异常事件消息，根据消费的消息类型，分别执行不同逻辑。对于用户操作日志消息，判别程序会执行参数规则评估逻辑；对于基线异常事件消息，判别程序会执行基线规则评估逻辑。执行参数规则评估，规则引擎解析规则约束，根据约束定义，判定当前消费的用户操作日志是否符合约束条件，如果符合约束条件，做进一步规则断言判定，若断言成功，则认为该参数规则命中。对于参数规则断言，断言限定对象可选配置为操作日志属性、主体属性、前置规则命中结果属性等。若断言配置为不执行窗口函数，则基于单条操作日志提取限定对象属性，并进行比较运算，根据运算结果评估是否断言成功；若断言配置为执行窗口函数，则根据规则生效对象，结合窗口统计附加维度，筛选统计窗口内同样符合约束条件的日志集，执行窗口函数，再将窗口函数结果进行比较运算，根据运算结果评估是否断言成功。执行基线规则评估，规则引擎首先根据异常事件所偏离的异常基线，筛选配置对应基础基线的基线规则，并提取或查询异常事件的其他信息，如事件评分、关联日志集、异常主体等，做进一步的规则断言判定，若断言成功，则认为该基线规则命中。对于基线规则断言，断言限定对象可选配置为事件评分、异常行为日志属性、异常主体属性、前置规则命中结果属性等。当断言限定对象为异常行为日志属性时，若断言配置为不执行窗口函数，则取值异常关联日志集中的最新日志的相关属性，进行比较运算，根据运算结果评估是否断言成功；若断言配置为执行窗口函数，则对异常关联日志集的对应日志属性执行窗口函数，再将函数结果做比较运算，根据运算结果评估是否断言成功。若评估命中的规则是组合规则的成员，则还需根据组合运算符判断组合规则是否命中。若组合运算是逻辑与，则需判定命中规则的主体是否命中所属组合规则中的其他规则，当所有规则都命中时，该组合规则方命中；若组合运算是逻辑或，则该组合规则直接命中。当任意规则评估命中，不论是单一规则亦或组合规则，缓存记录该规则命中事件，并重新判定是否存在具有前置规则命中要求的模型规则已达成前置要求，若存在，则该达成前置要求的模型规则进入评估序列，等待执行规则评估。S7：根据规则引擎的评估结果，判定用户行为是否构成风险；当任意规则评估命中，根据命中规则的主体，从规则命中缓存中筛选相同主体的其他规则命中事件，结合风险场景模型的必须规则、可选规则、最小可选规则命中数限制，评估是否命中风险场景模型，进而判定用户行为是否构成风险。
