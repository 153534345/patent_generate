标题title
一种基于上下文分析的加密流威胁检测方法及系统
摘要abst
本发明提供一种基于上下文分析的加密流威胁检测方法及系统，所述方法的步骤包括：获取待检测的原始网络流文件中的多个数据包的长度特征值，将全部数据包的长度特征值构建为原始长度序列；基于所述长度特征值在原始长度序列中的出现频率对每个所述长度特征值映射为编码值，得到所述原始长度序列对应的长度编码序列；将所述长度编码序列输入到预设的编码器中，所述编码器包括嵌入层和循环层，所述嵌入层向循环层输出编码向量，所述循环层输出上下文向量，将所述上下文向量输入到预设的解码器中，得到注意力向量；基于所述注意力向量和编码向量计算上下文长度序列，将所述上下文长度序列输入到训练的检测器中，得到威胁检测结果。
权利要求书clms
1.一种基于上下文分析的加密流威胁检测方法，其特征在于，所述方法的步骤包括：获取待检测的原始网络流文件中的多个数据包，并获取每个数据包中的长度特征值，将全部数据包的长度特征值构建为原始长度序列；基于所述长度特征值在原始长度序列中的出现频率对每个所述长度特征值映射为编码值，得到所述原始长度序列对应的长度编码序列；将所述长度编码序列输入到预设的编码器中，所述编码器包括嵌入层和循环层，所述嵌入层向循环层输出编码向量，所述循环层输出上下文向量，将所述上下文向量输入到预设的解码器中，得到注意力向量；基于所述注意力向量和编码向量计算上下文长度序列，将所述上下文长度序列输入到训练的检测器中，得到威胁检测结果。2.根据权利要求1所述的基于上下文分析的加密流威胁检测方法，其特征在于，在基于所述注意力向量和编码向量计算上下文长度序列的步骤中，对所述注意力向量和编码向量进行矩阵相乘，得到上下文长度序列。3.根据权利要求1所述的基于上下文分析的加密流威胁检测方法，其特征在于，在获取待检测的原始网络流文件中的多个数据包，并获取每个数据包中的长度特征值，将全部数据包的长度特征值构建为原始长度序列的步骤中，基于所述数据包的五元组数据将所述数据包分为多个检测组，将同一检测组中的数据包的长度特征值构建为原始长度序列。4.根据权利要求1所述的基于上下文分析的加密流威胁检测方法，其特征在于，在基于所述长度特征值在原始长度序列中的出现频率对每个所述长度特征值映射为编码值的步骤中，基于所述长度特征值在原始长度序列中的出现频率对所述长度特征值排序为队列，基于所述长度特征值在队列中的位置将所述长度特征值映射为编码值。5.根据权利要求4所述的基于上下文分析的加密流威胁检测方法，其特征在于，所述长度特征值的队列中的每个位置设置有位置序号，在基于所述长度特征值在队列中的位置将所述长度特征值映射为编码值的步骤中，将所述长度特征值对应的位置序号作为映射的编码值。6.根据权利要求1~5任一项所述的基于上下文分析的加密流威胁检测方法，其特征在于，所述检测器包括流分类器和序列预测器，所述流分类器用于基于输入的上下文长度序列输出威胁检测结果，所述序列预测器基于输入的上下文长度序列输出下一数据包的长度特征值，所述方法的步骤还包括对编码器、解码器和检测器进行预训练，在对编码器、解码器和检测器进行预训练的步骤中，分别计算所述流分类器和序列预测器的损失函数值，基于所述流分类器和序列预测器的损失函数值计算总损失函数值，基于总损失函数值对所述检测器进行训练。7.根据权利要求6所述的基于上下文分析的加密流威胁检测方法，其特征在于，在基于所述流分类器和序列预测器的损失函数值计算总损失函数值的步骤中，基于如下公式计算总损失函数值：其中，表示总损失函数值，/＞表示流分类器的损失函数值，/＞表示序列预测器的损失函数值，/＞表示预设的计算参数。8.根据权利要求6所述的基于上下文分析的加密流威胁检测方法，其特征在于，在基于所述流分类器和序列预测器的损失函数值计算总损失函数值的步骤中还包括对预设置的标签向量进行平滑处理，基于如下公式对预设置的标签向量进行平滑处理：其中，β表示预设的对应标签值的修改值，m表示标签向量中标签值所在位置，i为平滑处理的位置，C表示标签向量中的位置个数。9.根据权利要求6所述的基于上下文分析的加密流威胁检测方法，其特征在于，所述对编码器、解码器和检测器进行预训练的步骤包括顺序设置的单步预测、注意力优化和多步预测；在单步预测和多步预测的步骤中，基于总损失函数值进行反向传播更新编码器、解码器和检测器的模型参数，在注意力优化的步骤中，保持检测器的模型参数不变，基于总损失函数值进行反向传播更新编码器和解码器的模型参数。10.一种基于上下文分析的加密流威胁检测系统，其特征在于，该系统包括计算机设备，所述计算机设备包括处理器和存储器，所述存储器中存储有计算机指令，所述处理器用于执行所述存储器中存储的计算机指令，当所述计算机指令被处理器执行时该系统实现如权利要求1~9任一项所述方法所实现的步骤。
说明书desc
技术领域本发明涉及流量分析技术领域，尤其涉及一种基于上下文分析的加密流威胁检测方法及系统。背景技术随着加密技术的广泛应用以及数据隐私安全要求的增加，加密流量呈现爆炸式增长。加密通信可以有效保护用户隐私和数据安全，但也给防御者在网络流量威胁发现方面带来了极大挑战。加密流分析包括流量生成、流量表征和流量分类三部分。为了保证通信安全，通常使用SSL/TLS协议对客户端和服务器之间的交互进行加密，产生加密流量。加密流分类的主要挑战是表征加密数据流。根据分类的粒度，常使用的两个主要流表征级别包括流级别和会话级别。会话是双向的并且可以包含多个流。与可以使用深度数据包检测方法检测到的明文网络流量不同，加密数据包的数据部分是不可知的。只有头部信息能被直接获取，包括时间戳和长度特征值。然而，时间特征受网络环境的影响很大。网络中的丢包、重传、乱序等因素均会影响报文的到达时间和到达间隔时间，从而影响时间特征的准确性和稳定性。传统的基于内容和特征的分类方法通常依赖于对数据包的深入分析和特征提取，加密流的加密过程使数据包内容不可见，可提取的特征数量大大减少，不利于通用模型的准确分类。发明内容鉴于此，本发明的实施例提供了一种基于上下文分析的加密流威胁检测方法，以消除或改善现有技术中存在的一个或更多个缺陷。本发明的一个方面提供了一种基于上下文分析的加密流威胁检测方法，所述方法的步骤包括：获取待检测的原始网络流文件中的多个数据包，并获取每个数据包中的长度特征值，将全部数据包的长度特征值构建为原始长度序列；基于所述长度特征值在原始长度序列中的出现频率对每个所述长度特征值映射为编码值，得到所述原始长度序列对应的长度编码序列；将所述长度编码序列输入到预设的编码器中，所述编码器包括嵌入层和循环层，所述嵌入层向循环层输出编码向量，所述循环层输出上下文向量，将所述上下文向量输入到预设的解码器中，得到注意力向量；基于所述注意力向量和编码向量计算上下文长度序列，将所述上下文长度序列输入到训练的检测器中，得到威胁检测结果。采用上述方案，本方案首先在数据处理过程中仅用到了数据包的长度特征值，便于获取，且本方案基于所述长度特征值在原始长度序列中的出现频率对每个所述长度特征值映射为编码值，使数据进一步简化，提高了处理的难度，进一步的，基于所述注意力向量和编码向量计算上下文长度序列，得到一个集成了注意力加权的上下文长度序列，对原始的全部数据包长度特征值信息的总结，能够对可提取到的特征进行进一步处理，提高最终的分类精度。在本发明的一些实施方式中，在基于所述注意力向量和编码向量计算上下文长度序列的步骤中，对所述注意力向量和编码向量进行矩阵相乘，得到上下文长度序列。在本发明的一些实施方式中，在获取待检测的原始网络流文件中的多个数据包，并获取每个数据包中的长度特征值，将全部数据包的长度特征值构建为原始长度序列的步骤中，基于所述数据包的五元组数据将所述数据包分为多个检测组，将同一检测组中的数据包的长度特征值构建为原始长度序列。在本发明的一些实施方式中，在基于所述长度特征值在原始长度序列中的出现频率对每个所述长度特征值映射为编码值的步骤中，基于所述长度特征值在原始长度序列中的出现频率对所述长度特征值排序为队列，基于所述长度特征值在队列中的位置将所述长度特征值映射为编码值。在本发明的一些实施方式中，所述长度特征值的队列中的每个位置设置有位置序号，在基于所述长度特征值在队列中的位置将所述长度特征值映射为编码值的步骤中，将所述长度特征值对应的位置序号作为映射的编码值。在本发明的一些实施方式中，所述检测器包括流分类器和序列预测器，所述流分类器用于基于输入的上下文长度序列输出威胁检测结果，所述序列预测器基于输入的上下文长度序列输出下一数据包的长度特征值，所述方法的步骤还包括对编码器、解码器和检测器进行预训练，在对编码器、解码器和检测器进行预训练的步骤中，分别计算所述流分类器和序列预测器的损失函数值，基于所述流分类器和序列预测器的损失函数值计算总损失函数值，基于总损失函数值对所述检测器进行训练。在本发明的一些实施方式中，所述流分类器和序列预测器均包括顺序设置的线性层和分类层。在本发明的一些实施方式中，在基于所述流分类器和序列预测器的损失函数值计算总损失函数值的步骤中，基于如下公式计算总损失函数值：其中，表示总损失函数值，/＞表示流分类器的损失函数值，/＞表示序列预测器的损失函数值，/＞表示预设的计算参数。在本发明的一些实施方式中，在基于所述流分类器和序列预测器的损失函数值计算总损失函数值的步骤中还包括对预设置的标签向量进行平滑处理，基于如下公式对预设置的标签向量进行平滑处理：其中，β表示预设的对应标签值的修改值，m表示标签向量中标签值所在位置，i为平滑处理的位置，C表示标签向量中的位置个数。本发明的第二方面还提供一种基于上下文分析的加密流威胁检测系统，该系统包括计算机设备，所述计算机设备包括处理器和存储器，所述存储器中存储有计算机指令，所述处理器用于执行所述存储器中存储的计算机指令，当所述计算机指令被处理器执行时该系统实现如前所述方法所实现的步骤。本发明的第三方面还提供一种计算机可读存储介质，其上存储有计算机程序，该计算机程序被处理器执行时以实现前述基于上下文分析的加密流威胁检测方法所实现的步骤。本发明的附加优点、目的，以及特征将在下面的描述中将部分地加以阐述，且将对于本领域普通技术人员在研究下文后部分地变得明显，或者可以根据本发明的实践而获知。本发明的目的和其它优点可以通过在说明书以及附图中具体指出并获得。本领域技术人员将会理解的是，能够用本发明实现的目的和优点不限于以上具体所述，并且根据以下详细说明将更清楚地理解本发明能够实现的上述和其他目的。附图说明此处所说明的附图用来提供对本发明的进一步理解，构成本申请的一部分，并不构成对本发明的限定。图1为本发明基于上下文分析的加密流威胁检测方法一种实施方式的示意图；图2为本发明基于上下文分析的加密流威胁检测方法的架构示意图。具体实施方式为使本发明的目的、技术方案和优点更加清楚明白，下面结合实施方式和附图，对本发明做进一步详细说明。在此，本发明的示意性实施方式及其说明用于解释本发明，但并不作为对本发明的限定。在此，还需要说明的是，为了避免因不必要的细节而模糊了本发明，在附图中仅仅示出了与根据本发明的方案密切相关的结构和/或处理步骤，而省略了与本发明关系不大的其他细节。现有技术介绍：将机器学习算法与特征工程相结合已成为加密流量分类的主流方法。流量按统计特征，例如最大数据包长度、平均数据包长度和字节分布，进行分类。然而，这些机器学习算法的性能很大程度上取决于专家选择的手动特征。特征提取的过程需要大量先验知识，并且通常非常耗时。另一种方法是基于深度学习设计端到端模型，从原始输入中学习代表性特征，而无需手动设计特征。通过建立相邻数据包之间的时间关系，可以从加密流中提取更细粒度的序列特征。一些深度学习模型，例如长短期记忆和门循环单元，对时间相关的序列数据表现出更强的建模能力。不同类型的网络流量往往有不同的行为和模式，这可能导致其长度特征序列在时间上存在差异。例如，DDoS 攻击流量可能会在短时间内达到峰值，因此数据包长度序列多呈现尖峰和波动的模式。而正常流量的报文长度顺序可能会更加稳定和统一。在现有技术中，现有的使用机器学习的现有研究需要大量的统计特征，但这些特征的提取过程需要大量先验知识，并且通常非常耗时；现有的基于序列特征的方法只是一味地将这些特征输入到模型中，而不考虑序列数据之间的上下文关系，限制了模型对流在时间维度上的行为模式的理解，不利于加密流的精确分类；使用深度学习的现有研究通常直接将序列数据输入到模型中，让模型自动学习并提供最终的分类结果，对于分类结果往往缺乏可解释性，不利于业务人员的最终决策。本发明对加密流的包长度序列进行上下文分析，以揭示特征序列之间的复杂关系。不同于以往工作，除了流分类之外，对长度特征序列进行预测，通过这两个分支共同提升对加密流的威胁发现能力。为进一步增强模型对不同时间尺度序列数据的建模能力，本发明提出了先单步预测后多步预测的策略，仅采用前几个数据包便能实现精准分类效果。此外，利用注意力机制自动检测上下文序列中哪些数据包长度与下一个数据包的长度相关，可以揭示不同类别网络流的长度特征分布差异并支持可解释性，能够增强模型对不同环境下背景流的适应性，从而提高其鲁棒性。本发明的步骤具体包括：如图1和2所示，本发明提出一种基于上下文分析的加密流威胁检测方法，所述方法的步骤包括：步骤S100，获取待检测的原始网络流文件中的多个数据包，并获取每个数据包中的长度特征值，将全部数据包的长度特征值构建为原始长度序列；在具体实施过程中，所述原始长度序列按数据包时间的先后顺序，依次提取数据包的长度特征值，即比特长度。在具体实施过程中，所述原始长度序列包括预设个数个数据位置，每个数据包的长度特征值对应一个数据位置，若数据包数量小于预设个数，则在未对应数据包的数据位置用0补充。步骤S200，基于所述长度特征值在原始长度序列中的出现频率对每个所述长度特征值映射为编码值，得到所述原始长度序列对应的长度编码序列；在具体实施过程中，由于数据包长度特征值是离散分布的，大小差距极大，不利于深度学习模型的泛化学习。因此，为进一步提升数据包长度序列的区分能力，本方案提出了长度频率编码，以数据包长度出现的频率为基础进行映射编码，对每个所述长度特征值映射为编码值。步骤S300，将所述长度编码序列输入到预设的编码器中，所述编码器包括嵌入层和循环层，所述嵌入层向循环层输出编码向量，所述循环层输出上下文向量，将所述上下文向量输入到预设的解码器中，得到注意力向量；在具体实施过程中，为便于后续的数据包长度预测功能的实现，同时保留原始离散特征的信息，本方案的编码器采用one-hot编码嵌入输入；进一步的，将所有输入组合并输出一个抽象的向量表示，将整个流序列表示为一个固定长度的向量，即编码向量，编码向量可以设置为128维。步骤S400，基于所述注意力向量和编码向量计算上下文长度序列，将所述上下文长度序列输入到训练的检测器中，得到威胁检测结果。在具体实施过程中，所述威胁检测结果可以为检测器的softmax层输出的为威胁流量或者不为威胁流量的分类结果。采用上述方案，本方案首先在数据处理过程中仅用到了数据包的长度特征值，便于获取，且本方案基于所述长度特征值在原始长度序列中的出现频率对每个所述长度特征值映射为编码值，使数据进一步简化，提高了处理的难度，进一步的，基于所述注意力向量和编码向量计算上下文长度序列，得到一个集成了注意力加权的上下文长度序列，对原始的全部数据包长度特征值信息的总结，能够对可提取到的特征进行进一步处理，提高最终的分类精度。在本发明的一些实施方式中，在基于所述注意力向量和编码向量计算上下文长度序列的步骤中，对所述注意力向量和编码向量进行矩阵相乘，得到上下文长度序列。在具体实施过程中，注意力解码器将编码器输出的编码向量解码为注意力向量。/＞表示第i个数据包对应的长度特征值与该样本对应的标签的相关程度的权重分数，归一化为1。该注意力向量反应了每个时间步长处的数据包对流所属类别的影响的权重分布。为了更准确预测下一个数据包的长度值，本方案将每个步长对应的注意力向量值与长度值相乘，以将其联系起来。具体来说，本方案将注意力向量/＞与经独热编码处理之后的编码向量/＞进行矩阵相乘，最终得到一个集成了注意力加权的上下文向量，即上下文长度序列/＞。/＞为第i个数据包对应的长度特征值经one-hot编码后的结果，长度为s。假设/＞，则/＞仅在k位置处为1，其余位置为0。将该/＞与其对应的权重分数/＞相乘，便得到k位置处的长度特征对整条流对应的标签的影响程度。由于两个矩阵相乘涉及到一个矩阵的行与另一矩阵的列对应位置元素相乘再相加，这一结果相当于将每个可能的长度值k对应的权重值进行简单相加，即对原始的全部数据包长度特征信息的总结。比如，若/＞和/＞相同，均在k位置处为1。那么，上下文长度序列中k位置处的注意力分数应该等于/＞和/＞的加和。因此，在上下文长度序列中，如果某一个长度值对应的位置为0，意味着该长度值在此样本中几乎不会出现，因此将会被忽略；与之相反的极端情况下，某一长度值对应的注意力值为1，说明它将会被接下来的检测器重点关注，很有可能正是下一步长对应的长度值，这一点对于后续的序列值预测是极为有益的。在本发明的一些实施方式中，在获取待检测的原始网络流文件中的多个数据包，并获取每个数据包中的长度特征值，将全部数据包的长度特征值构建为原始长度序列的步骤中，基于所述数据包的五元组数据将所述数据包分为多个检测组，将同一检测组中的数据包的长度特征值构建为原始长度序列。在具体实施过程中，所述五元组数据包括源IP、目的IP、源端口、目的端口和协议。在本发明的一些实施方式中，在基于所述长度特征值在原始长度序列中的出现频率对每个所述长度特征值映射为编码值的步骤中，基于所述长度特征值在原始长度序列中的出现频率对所述长度特征值排序为队列，基于所述长度特征值在队列中的位置将所述长度特征值映射为编码值。在具体实施过程中，得到原始长度序列后，统计所有样本中长度特征值出现的频率，并按照从高到低的顺序排列。选择前s个出现次数最多的长度值作为代表，并依次映射为0，1，2，…，s-1，得到长度值映射表，比如, , , , 说明出现次数最多的长度值为60，将其映射为0，次多的76映射为1，依次推之。然后，遍历所有的样本，将每个长度值依据映射表转换为长度编码值。对于没在映射表出现的长度值，即出现次数较少，选择与之大小最为接近的长度值进行替换。比如75字节的长度值，与映射表中的76最为接近，则用1替换。这种变换方式通过省略精确的长度信息，与原始数据包长度序列具有相同的长度，但取值范围较小，具有降低数据维度、减少过拟合风险和提高模型的泛化能力等优势。在本发明的一些实施方式中，所述长度特征值的队列中的每个位置设置有位置序号，在基于所述长度特征值在队列中的位置将所述长度特征值映射为编码值的步骤中，将所述长度特征值对应的位置序号作为映射的编码值。在本发明的一些实施方式中，所述检测器包括流分类器和序列预测器，所述流分类器用于基于输入的上下文长度序列输出威胁检测结果，所述序列预测器基于输入的上下文长度序列输出下一数据包的长度特征值，所述方法的步骤还包括对编码器、解码器和检测器进行预训练，在对编码器、解码器和检测器进行预训练的步骤中，分别计算所述流分类器和序列预测器的损失函数值，基于所述流分类器和序列预测器的损失函数值计算总损失函数值，基于总损失函数值对所述检测器进行训练。在本发明的一些实施方式中，所述流分类器和序列预测器均包括顺序设置的线性层和分类层。在本发明的一些实施方式中，所述对编码器、解码器和检测器进行预训练的步骤包括顺序设置的单步预测、注意力优化和多步预测；在单步预测和多步预测的步骤中，基于总损失函数值进行反向传播更新编码器、解码器和检测器的模型参数，在注意力优化的步骤中，保持检测器的模型参数不变，基于总损失函数值进行反向传播更新编码器和解码器的模型参数。在具体实施过程中，在本方案的注意力优化的步骤中，通过暂时冻结检测器的权重，即它的权重不会被更新或优化，反向传播过程只对编码器、解码器的网络进行参数更新，来调整注意力向量，以便检测器对真实目标产生最高的预测，本方案将这一步骤夹在单步预测和多步预测中间。因为单步预测结束之后，模型对数据包长度序列已经具备一定的理解能力，即将在此基础上进行多步预测。此时，若是能够通过注意力优化机制对注意力解码网络的权重参数进行优化，使其能够更加准确的预测下一序列值和分类。那么，这对于后续的多步预测将是更为有益的。在本发明的一些实施方式中，在基于所述流分类器和序列预测器的损失函数值计算总损失函数值的步骤中，基于如下公式计算总损失函数值：其中，表示总损失函数值，/＞表示流分类器的损失函数值，/＞表示序列预测器的损失函数值，/＞表示预设的计算参数。在具体实施过程中，以往的分类方法大多直接对特征序列进行分类，或者利用自编码器结构计算重建损失，辅助分类，不同于现有技术，本方案更关注特征序列中的上下文联系，因此本方案通过预测未来的特征值并计算对应损失，不断反向优化，逐步增强模型的理解能力，以实现更精准的分类。因此，检测器由序列预测器和分类器组成，二者的结构相似，都是由单个带有ReLU函数的线性层和softmax层构成。在具体实施过程中，所述流分类器和序列预测器的损失函数值均采用交叉熵进行计算，来衡量模型的输出概率分布与真实标签的概率分布之间的差异；流分类器和序列预测器的损失函数值将共同指导网络中可训练参数的学习方向，序列预测器将更加侧重学习有助于上下文理解的内在特征，而流分类器则更关注生成适合分类任务的代表性特征。通过这种联合学习的架构，模型的两个分支即长度值预测和标签预测，最大化共享了可训练参数，两种损失的平衡可以学习到更有效的利于最终分类的结果。在本发明的一些实施方式中，在基于所述流分类器和序列预测器的损失函数值计算总损失函数值的步骤中还包括对预设置的标签向量进行平滑处理，基于如下公式对预设置的标签向量进行平滑处理：其中，β表示预设的对应标签值的修改值，m表示标签向量中标签值所在位置，i为平滑处理的位置，C表示标签向量中的位置个数。在具体实施过程中，在计算损失函数之前，本方案考虑到序列预测器输出的是所有可能长度值的概率分布。理想情况下，应该为实际的长度值赋予1的概率，而对其他长度值均赋予0的概率。但这样一来，容易会引发网络过度自信，产生高概率的输出，无论这一预测结果是否正确。然而，本方案增加序列预测功能的目的是为了更好地辅助分类，只有当下一长度值被正确预测时，才能说明所设计的模型对网络流具有一定的理解能力，才有希望助于提升分类精度，因此，为了避免网络过度自信产生的消极影响，我们对序列预测器的输出采用标签平滑技术。本发明设计了一种流序列上下文分析网络结构，由编码器、注意力解码器和检测器三大模块组成，其中检测器由序列预测器和流分类器共同构成。该结构输入序列的上下文关联，由单步预测到多步预测，这一过程进一步提升了模型对网络流的理解和表征能力。而且，集成的注意力机制，通过识别相关的上下文长度来构建一个关注向量，用于探索各个数据包对整条流的贡献，为模型分类结果提供可解释性。在具体实施过程中，在多步预测环节中，需要预测的步长数为10，采用与单步预测相同的输入，只是通过迭代多次来预测未来更多步长的序列值，与真实的目标序列对比并计算损失，反向传播优化。虽然，在进行多步预测时，序列预测器的准确性会随着预测步数的增加而逐渐受到累积误差的影响，但本方案通过这一过程，能够使模型学习到序列数据中更深层的模式和规律，逐渐提高流分类的准确性。本方案采用对网络流长度序列进行上下文分析的方法，旨在揭示特征序列之间的复杂关系，包括编码器、注意力解码器和检测器。借助注意力机制，循环神经网络 能够专注于输入序列中相对于预期输出的相关部分，并支持通过视觉分析来解释分类结果。在检测器中，本方案采用一个序列预测器来预测未来时间步的包长度并验证模型理解加密流的能力，从而辅助分类器更准确地识别加密流。本方案的有益效果包括：1.现有技术通常直接将长度序列特征输入模型得到分类结果，而不考虑序列数据之间的上下文关系。本发明可对网络流的长度序列进行上下文分析，并设计了流分类器和序列预测器的并行结构，通过预测长度序列来提升网络对流量的理解和判断能力，辅助分类器进行更准确的分类。更重要的是，本发明提出了先单步预测后多步预测的策略，仅需少量数据包就能实现出色的分类性能。2.现有的基于深度学习的加密流分类技术大多缺乏可解释性，本发明提出了集成注意力机制的特殊RNN作为注意力解码器，可以揭示不同类别网络流的长度特征分布差异并支持可解释性。利用Seaborn工具对输出的平均注意力向量绘制热图，可支持可视化不同类别加密流的平均注意力向量分布之间的差异，能够直观说明哪些数据包对最终的预测结果更为重要，从而帮助业务人员提高决策的可靠性。3.针对加密流分类面临的可利用特征少且时间特征不可靠等因素导致的表征难题，本方案仅利用长度序列特征结合上下文分析技术，充分挖掘深层次的关联特征，提升对流在时间维度上行为模式的理解，从而帮助更好的流分类；此外，设计的先单步预测后多步预测策略，仅需少量数据包便能达到理想的检测效果，为实时的网络威胁发现应用提供一种新思路。本发明实施例还提供一种基于上下文分析的加密流威胁检测系统，该系统包括计算机设备，所述计算机设备包括处理器和存储器，所述存储器中存储有计算机指令，所述处理器用于执行所述存储器中存储的计算机指令，当所述计算机指令被处理器执行时该系统实现如前所述方法所实现的步骤。本发明实施例还提供一种计算机可读存储介质，其上存储有计算机程序，该计算机程序被处理器执行时以实现前述基于上下文分析的加密流威胁检测方法所实现的步骤。该计算机可读存储介质可以是有形存储介质，诸如随机存储器、内存、只读存储器、电可编程ROM、电可擦除可编程ROM、寄存器、软盘、硬盘、可移动存储盘、CD-ROM、或技术领域内所公知的任意其它形式的存储介质。本领域普通技术人员应该可以明白，结合本文中所公开的实施方式描述的各示例性的组成部分、系统和方法，能够以硬件、软件或者二者的结合来实现。具体究竟以硬件还是软件方式来执行，取决于技术方案的特定应用和设计约束条件。专业技术人员可以对每个特定的应用来使用不同方法来实现所描述的功能，但是这种实现不应认为超出本发明的范围。当以硬件方式实现时，其可以例如是电子电路、专用集成电路、适当的固件、插件、功能卡等等。当以软件方式实现时，本发明的元素是被用于执行所需任务的程序或者代码段。程序或者代码段可以存储在机器可读介质中，或者通过载波中携带的数据信号在传输介质或者通信链路上传送。需要明确的是，本发明并不局限于上文所描述并在图中示出的特定配置和处理。为了简明起见，这里省略了对已知方法的详细描述。在上述实施例中，描述和示出了若干具体的步骤作为示例。但是，本发明的方法过程并不限于所描述和示出的具体步骤，本领域的技术人员可以在领会本发明的精神后，做出各种改变、修改和添加，或者改变步骤之间的顺序。本发明中，针对一个实施方式描述和/或例示的特征，可以在一个或更多个其它实施方式中以相同方式或以类似方式使用，和/或与其他实施方式的特征相结合或代替其他实施方式的特征。以上所述仅为本发明的优选实施例，并不用于限制本发明，对于本领域的技术人员来说，本发明实施例可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
