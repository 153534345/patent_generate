标题title
一种用于SOC总线的数据传输系统、方法及芯片
摘要abst
一种用于SOC总线的数据传输系统、方法及芯片，用于SOC总线的数据传输系统包括：监控模块，被配置为监控SOC总线上的写事务，将需要拆分的写事务输出；监控队列模块，被配置为接收需要拆分的写事务并将其存储为监控队列并输出；SOC总线适配模块，包括地址通道队列，被配置为接收SOC总线上的写事务和监控队列模块发送的监控队列，基于监控队列和当前地址通道队列中的信息进行模式切换并输出写事务数据包。本申请的数据传输系统，对于SOC总线的数据传输，能够实现对写事务进行自动拆分，移除了必须满足PCIE TLP定义的字节使能限制，从而能够有效避免PCIE传输数据错误，并避免多次重试后出现的链路中断现象。
权利要求书clms
1.一种用于SOC总线的数据传输系统，其特征在于，包括：监控模块，与SOC总线通信，被配置为监控SOC总线上的写事务，将需要拆分的所述写事务输出；监控队列模块，与所述监控模块连接，被配置为接收所述需要拆分的写事务并将其存储为监控队列并输出；SOC总线适配模块，与SOC总线通信，与所述监控队列模块连接，包括地址通道队列，被配置为接收SOC总线上的写事务和所述监控队列模块发送的所述监控队列，基于所述监控队列和当前所述地址通道队列中的信息进行模式切换并输出写事务数据包。2.根据权利要求1所述的系统，其特征在于，所述SOC总线适配模块，还被配置为当传输完成后，发送响应消息到SOC总线上，用于通知SOC总线已完成传输。3.根据权利要求1所述的系统，其特征在于，还包括：SOC总线仲裁模块，与多条所述SOC总线通信，与所述SOC总线适配模块连接，被配置为接收多条所述SOC总线上的写事务，并对多个所述写事务按照优先级进行排序后发送给所述SOC总线适配模块；所述SOC总线适配模块还配置为接收所述SOC总线仲裁模块发送的所述写事务。4.根据权利要求1所述的系统，其特征在于，所述写事务包括：写事务的地址、控制信息、写数据和写使能信息。5.根据权利要求4所述的系统，其特征在于，所述监控模块，还被配置为基于所述写事务的写使能信息，判断所述写事务是否需要拆分，若所述写事务的写使能信息为预设值，则确定该写事务需要拆分，若所述写事务的写使能信息不为预设值，则确定该写事务不需要拆分。6.根据权利要求5所述的系统，其特征在于，所述SOC总线适配模块，还包括数据通道队列，被配置为接收所述监控队列和所述写事务，并基于预设的有限状态机，根据所述监控队列是否为空以及当前已缓存的所述地址通道队列中的所述写事务是否需要拆分，进行旁路模式和非旁路模式之间的切换，在所述旁路模式下，将所述写事务输出，在非旁路模式下，将所述写事务中的所述地址和所述控制信息缓存至所述地址通道队列，将所述写事务的所述写数据和所述写使能信息缓存至所述数据通道队列。7.根据权利要求6所述的系统，其特征在于，所述基于所述监控队列以及当前已缓存的所述地址通道队列，进行旁路模式和非旁路模式之间的切换的步骤，包括：在旁路模式下，若当前所述地址通道队列中的所述写事务不需要拆分，且所述监控队列为空，则基于预设的有限状态机，保持旁路模式；在旁路模式下，若当前所述地址通道队列中的所述写事务需要拆分，或所述监控队列不为空，则基于预设的有限状态机，切换到非旁路模式；在非旁路模式下，若当前所述地址通道队列中的所述写事务不需要拆分，且所述监控队列为空，则基于预设的有限状态机，切换到旁路模式；在非旁路模式下，若当前所述地址通道队列中的所述写事务需要拆分，或所述监控队列不为空，则基于预设的有限状态机，保持非旁路模式。8.一种用于SOC总线的数据传输的方法，其特征在于，应用于权利要求1至7任一项所述的用于SOC总线的数据传输系统，所述方法包括：监控SOC总线上的写事务，将需要拆分的所述写事务输出；接收所述需要拆分的写事务并将其存储为监控队列并输出；接收SOC总线上的写事务和所述监控队列，基于所述监控队列和当前所述地址通道队列，进行模式切换并输出写事务数据包。9.一种芯片，其特征在于，所述芯片上集成有权利要求1至7任一项所述的用于SOC总线的数据传输的系统。10.一种电路板，其特征在于，所述电路板，包括权利要求9所述的芯片。11.一种车机，其特征在于，所述车机，包括权利要求9所述的芯片。12.一种电子设备，包括，存储器和处理器，其特征在于，所述存储器中存储有计算机指令，所述处理器被配置为运行所述指令以执行权利要求8所述的用于SOC总线的数据传输的方法的步骤。13.一种计算机可读存储介质，其特征在于，其上存储有计算机指令，当计算机指令运行时执行权利要求8所述的用于SOC总线的数据传输的方法。
说明书desc
技术领域本申请涉及数据传输技术领域，特别是涉及一种用于SOC总线的数据传输系统、方法及芯片。背景技术在主流PC系统中，PCIE作为主要的主板级互连总线，将主机系统处理器与各种集成外设连接起来，扩展了存储空间、计算能力以及网络通信带宽。PCIE经过不断完善，已经能够支持速度64Gbps和总线宽度x16，从而不仅成为新兴的云计算领域中最有利的互联总线竞争者，而且在低功耗领域也表现优秀。此外，目前IoT和Mobile领域，也常采用PCIE总线作为主SOC的扩展总线。相关技术中，在PCIE TLP中，仅定义了DWord首地址与末地址的Byte Enable字段，而没有定义中间段数据的Byte Enable字段。但在SOC内部总线中，为了提高读写的效率，避免读后写入操作，通常每一byte数据都带有使能属性。因此，PCIE控制器作为SOC内部总线和PCIE总线之间的控制转换接口，对于软件和系统层面提出了使用限制条件：内部总线发出的写操作中，Byte Enable属性必须完全符合PCIE TLP定义。否则将会出现PCIE传输数据错误，并避免多次重试后出现的链路中断现象。发明内容为了解决现有技术中存在的至少一个问题，本申请的目的在于提供一种用于SOC总线的数据传输系统、方法及芯片，其对于SOC总线的数据传输，能够实现对写事务进行自动拆分，移除了必须满足PCIE TLP定义的字节使能限制，从而能够有效避免PCIE传输数据错误，并避免多次重试后出现的链路中断现象。为实现上述目的，本申请提供的用于SOC总线的数据传输系统，包括：监控模块，与SOC总线通信，被配置为监控SOC总线上的写事务，将需要拆分的所述写事务输出；监控队列模块，与所述监控模块连接，被配置为接收所述需要拆分的写事务并将其存储为监控队列并输出；SOC总线适配模块，与SOC总线通信，与所述监控队列模块连接，包括地址通道队列，被配置为接收SOC总线上的写事务和所述监控队列模块发送的所述监控队列，基于所述监控队列和当前所述地址通道队列中的信息进行模式切换并输出写事务数据包。进一步地，所述SOC总线适配模块，还被配置为当传输完成后，发送响应消息到SOC总线上，用于通知SOC总线已完成传输。进一步地，所述系统还包括：SOC总线仲裁模块，与多条所述SOC总线通信，与所述SOC总线适配模块连接，被配置为接收多条所述SOC总线上的写事务，并对多个所述写事务按照优先级进行排序后发送给所述SOC总线适配模块；所述SOC总线适配模块还配置为接收所述SOC总线仲裁模块发送的所述写事务。进一步地，所述写事务包括：写事务的地址、控制信息、写数据和写使能信息。更进一步地，所述监控模块，还被配置为基于所述写事务的写使能信息，判断所述写事务是否需要拆分，若所述写事务的写使能信息为预设值，则确定该写事务需要拆分，若所述写事务的写使能信息不为预设值，则确定该写事务不需要拆分。更进一步地，所述SOC总线适配模块，还包括数据通道队列，被配置为接收所述监控队列和所述写事务，并基于预设的有限状态机，根据所述监控队列是否为空以及当前已缓存的所述地址通道队列中的所述写事务是否需要拆分，进行旁路模式和非旁路模式之间的切换，在所述旁路模式下，将所述写事务输出，在非旁路模式下，将所述写事务中的所述地址和所述控制信息缓存至所述地址通道队列，将所述写事务的所述写数据和所述写使能信息缓存至所述数据通道队列。更进一步地，所述基于所述监控队列以及当前已缓存的所述地址通道队列，进行旁路模式和非旁路模式之间的切换的步骤，包括：在旁路模式下，若当前所述地址通道队列中的所述写事务不需要拆分，且所述监控队列为空，则基于预设的有限状态机，保持旁路模式；在旁路模式下，若当前所述地址通道队列中的所述写事务需要拆分，或所述监控队列不为空，则基于预设的有限状态机，切换到非旁路模式；在非旁路模式下，若当前所述地址通道队列中的所述写事务不需要拆分，且所述监控队列为空，则基于预设的有限状态机，切换到旁路模式；在非旁路模式下，若当前所述地址通道队列中的所述写事务需要拆分，或所述监控队列不为空，则基于预设的有限状态机，保持非旁路模式。为实现上述目的，本申请还提供的用于SOC总线的数据传输的方法，应用如上所述的用于SOC总线的数据传输系统，所述方法包括：监控SOC总线上的写事务，将需要拆分的所述写事务输出；接收所述需要拆分的写事务并将其存储为监控队列并输出；接收SOC总线上的写事务和所述监控队列，基于所述监控队列和当前所述地址通道队列，进行模式切换并输出写事务数据包。为实现上述目的，本申请还提供的芯片，其上集成有如上所述的用于SOC总线的数据传输的系统。为实现上述目的，本申请还提供的电路板，包括如上所述的芯片。为实现上述目的，本申请还提供的车机，包括如上所述的芯片。为实现上述目的，本申请还提供的电子设备，包括，存储器和处理器，所述存储器中存储有计算机指令，所述处理器被配置为运行所述指令以执行如上所述的用于SOC总线的数据传输的方法的步骤。为实现上述目的，本申请还提供的计算机可读存储介质，其上存储有计算机指令，当计算机指令运行时执行如上所述的用于SOC总线的数据传输的方法。本申请的一种用于SOC总线的数据传输系统、方法及芯片，通过监控模块监控SOC总线上的写事务，将需要拆分的写事务输出，并通过监控队列模块接收需要拆分的写事务并将其存储为监控队列并输出，以及通过SOC总线适配模块接收SOC总线上的写事务和监控队列模块发送的监控队列，基于监控队列和当前地址通道队列中的信息进行模式切换并输出写事务数据包。由此，对于SOC总线的数据传输，能够实现对写事务进行自动拆分，移除了必须满足PCIE TLP定义的字节使能限制，从而能够有效避免PCIE传输数据错误，并避免多次重试后出现的链路中断现象。本申请的其它特征和优点将在随后的说明书中阐述，并且，部分地从说明书中变得显而易见，或者通过实施本申请而了解。附图说明附图用来提供对本申请的进一步理解，并且构成说明书的一部分，并与本申请的实施例一起，用于解释本申请，并不构成对本申请的限制。在附图中：图1为根据本申请实施例的用于SOC总线的数据传输系统结构示意图；图2为根据本申请另一实施例的用于SOC总线的数据传输系统结构示意图；图3为根据本申请实施例的SOC总线适配模块应用示意图；图4为本申请实施例的模式切换示意图；图5为本申请实施例的用于SOC总线的数据传输的方法流程图；图6为本申请实施例的芯片结构框图；图7为本申请实施例的电路板结构框图；图8为本申请实施例的车机结构框图；图9为本申请实施例的电子设备结构框图。具体实施方式下面将参照附图更详细地描述本申请的实施例。虽然附图中显示了本申请的某些实施例，然而应当理解的是，本申请可以通过各种形式来实现，而且不应该被解释为限于这里阐述的实施例，相反提供这些实施例是为了更加透彻和完整地理解本申请。应当理解的是，本申请的附图及实施例仅用于示例性作用，并非用于限制本申请的保护范围。应当理解，本申请的方法实施方式中记载的各个步骤可以按照不同的顺序执行，和/或并行执行。此外，方法实施方式可以包括附加的步骤和/或省略执行示出的步骤。本申请的范围在此方面不受限制。本文使用的术语“包括”及其变形是开放性包括，即“包括但不限于”。术语“基于”是“至少部分地基于”。术语“一个实施例”表示“至少一个实施例”；术语“另一实施例”表示“至少一个另外的实施例”；术语“一些实施例”表示“至少一些实施例”。其他术语的相关定义将在下文描述中给出。需要注意，本申请中提及的“一个”、“多个”的修饰是示意性而非限制性的，本领域技术人员应当理解，除非在上下文另有明确指出，否则应该理解为“一个或多个”。“多个”应理解为两个或以上。下面，将参考附图详细地说明本申请的实施例。图1为根据本申请实施例的用于SOC总线的数据传输系统结构示意图，参考图1所示，用于SOC总线的数据传输系统10，包括：监控模块11、监控队列模块12和SOC总线适配模块13。监控模块11，与SOC总线通信，被配置为监控SOC总线上的写事务，将需要拆分的写事务输出。具体地，参考图2所示，该监控模块11可以是多个，分别与SOC总线的多个主机，如CPU、GPU、DMA等，一一对应配置，来监控SOC总线上的写事务。本申请实施例中，写事务可以是PCIE的写事务，具体包括写事务的地址、控制信息、写数据和写使能信息。在具体示例中，监控模块11对SOC总线上的写事务进行监控时，可以先确定其写数据的长度。若其长度小于等于长度阈值，则确定该写事务不需要被拆分；若其长度大于长度阈值，则确定该写事务需要被拆分，或该写事务需要进一步策略确定是否需要被拆分。本申请实施例中，监控模块11，还被配置为基于写事务的写使能信息，判断写事务是否需要拆分，若写事务的写使能信息为预设值，则确定该写事务需要拆分，若写事务的写使能信息不为预设值，则确定该写事务不需要拆分。具体地，写使能信息可以为1或0，其值在软件应用上是相对随机的。当写事务的写使能信息为0时，监控模块13确定该写事务需要拆分。需要说明的是，由于对写事务的拆分需要对应的开销，为了避免不必要的拆分，监控模块11可以先判断接收到的写事务是否需要进行拆分，进而对需要拆分的写事务通过SOC总线适配模块13进行拆分，对不需要拆分的写事务进行透传，从而能够在自动拆分时，有效控制开销，减少带宽利用率损失，提高有效数据的占空比。监控队列模块12，与监控模块连接，被配置为接收需要拆分的写事务并将其存储为监控队列并输出。也就是说，监控队列模块12接收由监控模块11发送的需要拆分的写事务，将其写入监控队列，并输出至SOC总线适配模块13。参考图2-3所示，SOC总线适配模块13，与SOC总线通信，与监控队列模块12连接，包括地址通道队列131。SOC总线适配模块13，被配置为接收SOC总线上的写事务和监控队列模块12发送的监控队列，基于监控队列和当前地址通道队列131中的信息进行模式切换并输出写事务数据包。具体地，地址通道队列131中包括写事务的地址和控制信息，如图3所示，SOC总线适配模块13可以根据监控队列与对应的地址和控制信息，通过仲裁单元132确定旁路模式或确定非旁路模式，并通过有限状态机134控制对旁路模式和非旁路模式的切换，以及对应模式下向PCIE控制器输出写事务数据包，以便PCIE控制器通过PCIE总线对数据进行传输。需要说明的是，由于PCIE TLP中，定义了DWord首地址与末地址的Byte Enable字段，而没有定义中间段数据的Byte Enable字段。因此根据本申请的用于SOC总线的数据传输的系统，在具体示例中，若监控模块11监控到写事务数据的写使能信息为0，则确定该事务数据包需要进行拆分，而后监控队列模块12接收需要拆分的写事务，并将其存储为监控队列并输出至SOC总线适配模块13，之后SOC总线适配模块13根据写使能信息为0的数据的地址对该写事务数据包进行拆分，具体可以将写使能信息为0的byte配置为PCIE TLP的DWord首地址或DWord末地址，使得PCIE TLP中的中间段数据的使能信息均为1，即确保了缩短后的PCIE TLP中所有数据也都带有使能属性，消除了必须满足PCIE TLP定义的字节使能限制，从而能够有效避免PCIE传输数据错误，并避免多次重试后出现的链路中断现象。本申请实施例中，SOC总线适配模块13，还包括数据通道队列133。SOC总线适配模块13被配置为接收监控队列和写事务，并基于预设的有限状态机134，根据监控队列是否为空以及当前已缓存的地址通道队列131中的写事务是否需要拆分，通过MUX进行旁路模式和非旁路模式之间的切换。具体地，数据通道队列133可以包括写事务的写数据和写使能信息。对于非旁路模式来说，在监控队列不为空，且当前已缓存的地址通道队列131中的写事务需要拆分时，将处理模式配置为非旁路模式。在非旁路模式下，SOC总线适配模块13将写事务中的地址和控制信息缓存至地址通道队列131，并将写事务的写数据和写使能信息缓存至数据通道队列133。对于旁路模式来说，在监控队列为空，或当前已缓存的地址通道队列131中的写事务不需要拆分时，将处理模式配置为旁路模式。在旁路模式下，SOC总线适配模块13将写事务透传输出。进一步地，参考图4所示，基于监控队列以及当前已缓存的地址通道队列，进行旁路模式和非旁路模式之间的切换的步骤，包括：在旁路模式下，若当前地址通道队列中的写事务不需要拆分，且监控队列为空，则基于预设的有限状态机，保持旁路模式；在旁路模式下，若当前地址通道队列中的写事务需要拆分，或监控队列不为空，则基于预设的有限状态机，切换到非旁路模式；在非旁路模式下，若当前地址通道队列中的写事务不需要拆分，且监控队列为空，则基于预设的有限状态机，切换到旁路模式；在非旁路模式下，若当前地址通道队列中的写事务需要拆分，或监控队列不为空，则基于预设的有限状态机，保持非旁路模式。本申请实施例中，SOC总线适配模块13，还被配置为当传输完成后，发送响应消息到SOC总线上，用于通知SOC总线已完成传输。具体地，如图3所示，对于采用非旁路模式的传输，可以通过响应通道队列135进行响应。本申请实施例中，如图3所示，用于SOC总线的数据传输系统10还包括SOC总线仲裁模块14。SOC总线仲裁模块14与多条SOC总线通信，与SOC总线适配模块13连接，被配置为接收多条SOC总线上的写事务，并对多个写事务按照优先级进行排序后发送给SOC总线适配模块13。SOC总线适配模块13还配置为接收SOC总线仲裁模块14发送的写事务。综上，根据本申请实施例的用于SOC总线的数据传输系统，通过监控模块监控SOC总线上的写事务，将需要拆分的写事务输出，并通过监控队列模块接收需要拆分的写事务并将其存储为监控队列并输出，以及通过SOC总线适配模块接收SOC总线上的写事务和监控队列模块发送的监控队列，基于监控队列和当前地址通道队列中的信息进行模式切换并输出写事务数据包。由此，对于SOC总线的数据传输，能够实现对写事务进行自动拆分，移除了必须满足PCIE TLP定义的字节使能限制，从而能够有效避免PCIE传输数据错误，并避免多次重试后出现的链路中断现象。此外，由于上述写事务的自动拆分对于软件完全透明，对端设备也不需要做任何更改，便于实施。图5为本申请实施例的用于SOC总线的数据传输的方法流程图。参考图5所示，用于SOC总线的数据传输的方法，应用上述实施例中的用于SOC总线的数据传输系统，其包括以下步骤：在步骤201，监控SOC总线上的写事务，将需要拆分的写事务输出。在步骤202，接收需要拆分的写事务并将其存储为监控队列并输出。在步骤203，接收SOC总线上的写事务和监控队列，基于监控队列和当前地址通道队列，进行模式切换并输出写事务数据包。本申请实施例中，该方法还包括：为当传输完成后，发送响应消息到SOC总线上，用于通知SOC总线已完成传输。本申请实施例中，该方法还包括：SOC总线仲裁模块接收多条SOC总线上的写事务，并对多个写事务按照优先级进行排序后发送给SOC总线适配模块。进一步地，该方法还包括：基于写事务的写使能信息，判断写事务是否需要拆分，若写事务的写使能信息为预设值，则确定该写事务需要拆分，若写事务的写使能信息不为预设值，则确定该写事务不需要拆分。进一步地，该方法还包括：接收监控队列和写事务，并基于预设的有限状态机，根据监控队列是否为空以及当前已缓存的地址通道队列中的写事务是否需要拆分，进行旁路模式和非旁路模式之间的切换，在旁路模式下，将写事务输出，在非旁路模式下，将写事务中的地址和控制信息缓存至地址通道队列，将写事务的写数据和写使能信息缓存至数据通道队列。进一步地，基于监控队列以及当前已缓存的地址通道队列，进行旁路模式和非旁路模式之间的切换的步骤，包括：在旁路模式下，若当前地址通道队列中的写事务不需要拆分，且监控队列为空，则基于预设的有限状态机，保持旁路模式；在旁路模式下，若当前地址通道队列中的写事务需要拆分，或监控队列不为空，则基于预设的有限状态机，切换到非旁路模式；在非旁路模式下，若当前地址通道队列中的写事务不需要拆分，且监控队列为空，则基于预设的有限状态机，切换到旁路模式；在非旁路模式下，若当前地址通道队列中的写事务需要拆分，或监控队列不为空，则基于预设的有限状态机，保持非旁路模式。需要说明的是，上述实施例中对用于SOC总线的数据传输系统的解释说明也适用于上述实施例中的用于SOC总线的数据传输的方法，此处不再赘述。图6为本申请实施例的芯片结构框图。参考图6所示，芯片100，其上集成有上述实施例中的用于SOC总线的数据传输的系统10。图7为本申请实施例的电路板结构框图。参考图7所示，电路板200，包括上述实施例中的芯片100。图8为本申请实施例的车机结构框图。参考图8所示，车机300，包括上述实施例中的芯片100。图9为本申请实施例的电子设备结构框图。参考图9所示，电子设备400，包括，存储器401和处理器402，存储器401中存储有计算机指令，处理器402被配置为运行指令以执行上述实施例中的用于SOC总线的数据传输的方法的步骤。本申请一个实施例中，还提供了一种计算机可读存储介质，该计算机可读存储介质可以是上述实施例中描述的系统中所包含的；也可以是单独存在，而未装配入该系统中。上述计算机可读存储介质承载有一个或者多个计算机指令，当上述一个或者多个计算机指令被执行时，实现上述实施例的用于SOC总线的数据传输系统的步骤。本申请的实施例，计算机可读存储介质可以是非易失性的计算机可读存储介质，例如可以包括但不限于：便携式计算机磁盘、硬盘、随机访问存储器、只读存储器、可擦式可编程只读存储器、便携式紧凑磁盘只读存储器、光存储器件、磁存储器件、或者上述的任意合适的组合。在本申请中，计算机可读存储介质可以是任何包含或存储程序的有形介质，该程序可以被指令执行系统、装置或者器件使用或者与其结合使用。应该理解的是，虽然说明书附图的流程图中的各个步骤按照箭头的指示依次显示，但这些步骤并不是必然按照箭头指示的顺序依次执行。除非本文中有明确的说明，这些步骤的执行并没有严格的顺序限制，这些步骤可以以其它的顺序执行。而且，流程图中的至少一部分步骤可以包括多个子步骤或者多个阶段，这些子步骤或者阶段并不必然是在同一时刻执行完成，而是可以在不同的时刻执行，这些子步骤或者阶段的执行顺序也不必然是依次进行，而是可以与其它步骤或者其它步骤的子步骤或者阶段的至少一部分轮流或者交替地执行。需要指出的是，上述所提到的具体数值只为了作为示例详细说明本申请的实施，而不应理解为对本申请的限制。在其它例子或实施方式或实施例中，可根据本申请来选择其它数值，在此不作具体限定。本领域普通技术人员可以理解：以上仅为本申请的优选实施例而已，并不用于限制本申请，尽管参照前述实施例对本申请进行了详细的说明，对于本领域的技术人员来说，其依然可以对前述各实施例记载的技术方案进行修改，或者对其中部分技术特征进行等同替换。凡在本申请的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本申请的保护范围之内。
