标题title
一种基于注意力及深度学习的光伏发电量预测系统及方法
摘要abst
本发明属于光伏发电量预测技术领域，公开了一种基于注意力及深度学习的光伏发电量预测系统及方法，通过数据预处理模块对数据集进行预处理，并生成训练集；transformer网络模块与CNN网络模块间使用残差连接；使用基于注意力机制的transformer网络提取数据之间的时序特征信息；使用CNN网络中的卷积和池化方法，解决多变量协同预测问题；将数据集多维度数据分开处理训练，保证训练效果的同时降低了训练用时。
权利要求书clms
1.一种基于注意力及深度学习的光伏发电量预测系统，其特征在于，所述系统包括训练模块、数据预处理模块、transformer网络模块、CNN网络模块及应用模块；所述数据预处理模块对数据集进行预处理，并生成训练集；所述训练模块使用transformer网络模块、CNN网络模块进行训练和预测；所述transformer网络模块基于注意力机制提取时序特征，并预测下一时刻的值，生成时序预测结果；所述CNN网络模块对训练集的数据及时序预测结果进行训练，生成最终预测结果；所述应用模块通过训练好的模型，对于发电量预测任务输出预测结果；其中，CNN网络模块包括2层一维卷积层，1层一维最大池化层，2层全连接层；2层全连接层之间通过ReLU激活函数,连接，一维卷积层卷积核大小为3，池化层大小为2；CNN网络接受transformer网络输出作为参数，但transformer网络不参与反向传播；CNN网络模块和transformer网络模块之间使用残差连接，记transformer网络输出为；/＞分别在CNN网络模块的输入层，以及CNN网络模块的第一层全连接层输入CNN网络；CNN网络模块的输入数据包括/＞以及数据集中的多变量部分，输入数据首先通过卷积层提取关联信息，然后由池化层对信息降维，最后通过残差连接至全连接层输出得到预测值。2.根据权利要求1所述的一种基于注意力及深度学习的光伏发电量预测系统，其特征在于，所述transformer网络模块包括位置编码层、基于注意力机制的6个transformer编码器、基于注意力机制的6个transformer解码器、全连接层和Softmax输出层；其中每个transformer编码器依次由多头注意力层和全连接前馈网络层组成，这两个子层各自通过残差和归一化层连接至下一层；transformer解码器依次由带有掩码的多头注意力层、继承编码器权重的多头注意力层和全连接前馈网络层组成，各个子层各自通过残差和归一化层连接至下一层。3.一种基于注意力及深度学习的光伏发电量预测方法，其特征在于，基于权利要求1-2任一项所述的系统进行光伏发电量预测，所述方法步骤为：S1、收集智能电网中光伏电站的各项数据，对缺漏异常数据进行预处理；S2、将训练数据输入训练模块，使用训练数据集训练transformer网络，并使用训练数据集以及以训练的transformer网络训练CNN网络；S3、训练完成后启动预测程序，将待预测数据转换为输入向量格式，输入到训练完成的网络中，输出发电量预测值。4.根据权利要求3所述的一种基于注意力及深度学习的光伏发电量预测方法，其特征在于，步骤1中，对缺漏异常数据进行预处理具体为：S101、获取目标电站的数据集，并根据每条数据的时间戳得到对应的月份和小时，将月份及小时合并进数据集并删除时间戳；S102、针对每一条数据，首先检查每条数据是否在设置的阈值范围内，若发现异常数据则将这项数据置空；S103、检查每条数据内完整性；若数据为空，则先判定缺失部分数据项上下两条数据是否为空；若不为空则将上下两条数据的平均值作为该项数据的值，否则，使用前三天该项数据的平均值作为该项数据的值；S104、检查数据是否缺失；通过检查时间戳是否和上一条数据间隔为一次标准采样时间间隔，若间隔时间超过一次标准采样时间间隔，即代表出现数据缺失；首先计算间隔时间，若间隔时间是2个标准采样时间间隔，即只有一条数据缺失，则将上下两条数据的平均值作为缺失部分的值；若有多条数据缺失，则将前一天同一时刻的值作为对应时刻的值；S105、将数据归一化，并按照如下规则转换为训练数据集：每条训练数据中，前10项为前10条数据的实际发电量值，记为；第11-18项为当前数据的特征数据项，即月份、小时、辐照度、风速、风向、温度、湿度、压强，记为/＞，第19项为当前实际发电量，记为。5.根据权利要求3所述的一种基于注意力及深度学习的光伏发电量预测方法，其特征在于，S2中，使用训练数据集训练transformer网络，具体为：S211、初始化transformer网络，将数据集分为训练和测试数据集，设置初始学习率为；S212、迭代训练集中数据，取每条训练数据中前10项，即，输入transformer网络；S213、使用均方损失函数作为损失函数，将当前实际发电量/＞作为真实标签/＞，将transformer网络输出结果/＞与标签使用损失函数计算误差，通过反向传播算法更新transformer网络参数；S214、重复上述步骤，使用Adam算法更新学习率，循环迭代直至网络收敛；S215、在测试数据集上对transformer网络进行测试，保存transformer网络参数。6.根据权利要求5所述的一种基于注意力及深度学习的光伏发电量预测方法，其特征在于，在transformer网络中，输入数据通过输入位置编码层，位置编码层使用全连接网络将输入数据映射为嵌入向量，并与位置编码向量相加；然后将相加后结果合并为编码数据矩阵；位置编码层基于正余弦函数生成位置向量；位置编码层公式如下：，，其中，pos代表元素在序列中的实际位置，代表嵌入向量的维度。7.根据权利要求6所述的一种基于注意力及深度学习的光伏发电量预测方法，其特征在于，在transformer编码器和transformer解码器的注意力层中，通过计算三个矩阵获得相关性分数；其中，Q代表查询矩阵，K代表被查询的信息和其他信息的相关程度的矩阵，V代表被查询信息的矩阵；通过以下步骤计算相关性分数，以分析每个位置的重要性：Sa、随机初始化权重矩阵，并将前面经过位置编码的编码数据矩阵/＞分别与对应权重矩阵相乘，得到/＞矩阵；Sb、计算分数矩阵，/＞为K的转置，得到输入序列中数据之间的相关性分数；Sc、归一化分数矩阵，并对其进行softmax处理，再与/＞相乘得到相关性分数矩阵，即，其中，是每个数据向量对应的值向量即Key的维度，/＞定义为/＞。8.根据权利要求3所述的一种基于注意力及深度学习的光伏发电量预测方法，其特征在于，S2中，使用训练数据集以及已训练的transformer网络训练CNN网络，具体为：S221、初始化CNN网络，将数据集分为训练和测试数据集，设置初始学习率为；S222、读取已训练transformer网络参数；S223、迭代训练集中数据，取每条训练数据中前10项，即，输入transformer网络，得到transformer网络输出/＞；S224、取每条训练数据中1-18项，即，以及transformer网络输出/＞，合并为向量/＞输入CNN网络；S225、使用均方损失函数作为损失函数，将当前实际发电量/＞作为真实标签/＞，将CNN网络输出结果/＞与标签使用损失函数计算误差，通过反向传播算法更新CNN网络参数；S226、重复上述步骤，使用Adam算法更新学习率，循环迭代直至网络收敛；S227、在测试数据集上对CNN网络进行测试，保存CNN网络参数。
说明书desc
技术领域本发明属于光伏发电量预测技术领域，具体是涉及一种基于注意力及深度学习的光伏发电量预测系统及方法。背景技术近年来随着光伏发电相关技术的不断提高，光伏发电成为了重要的发电方式之一。国家大力发展光伏发电作为清洁能源，以实现“碳达峰”，“碳中和”目标，但由于光伏发电本身的性质，其输出的功率并不确定，在实际应用中需要对其输出功率进行预测，以便更好调整发电结构。目前的光伏预测大多通过智能算法，深度学习等方法实现；相比于传统算法，深度学习的效率更高，效果更好。但基于深度学习的预测算法大多基于卷积神经网络，长短期记忆网络等网络，在信息提取方面，单一的网络大多只能单一的提取同一时刻的多变量信息，或者在时间维度上提取单一变量的时序特征。如专利申请CN115347571A提出了一种基于迁移学习的光伏发电功率短期预测方法及装置，其基于迁移学习的数据集迁移，对光伏发电功率数据变分模态分解，然后构建预测模型，对光伏发电功率预测；该技术方案基于迁移学习，对于时序特征的获取能力较弱，并且其基于的长短期记忆网络缺少注意力机制，不能很好提取有效信息。该技术方案的迁移学习与变分模态分解复杂度高，并且在每次训练时均需要重复执行这些步骤，相对而言耗时较多。光伏发电受到各种环境因素影响较多，迁移学习不能很好的将当地的环境因素学习，模型缺乏针对性。考虑到光伏功率也是一种时间序列，具有时序的特征，但光伏发电功率受到多种因素影响，预测算法复杂，多变量条件下光伏发电功率时序信息无法得到有效利用，且深度光伏发电量预测模型无法提取各个时间点权重，导致收敛慢，预测效果差、输入信息容易丢失的问题等；因此，需要一个可以结合多变量信息以及时序特征的方法。发明内容为解决上述技术问题，本发明提供了一种基于注意力及深度学习的光伏发电量预测系统及方法，使用残差连接transformer网络输出和CNN网络；通过基于注意力机制的transformer网络提取数据之间的时序特征信息，解决传统算法时序信息利用率不高，无法获得序列中各个时刻权重的问题；利用CNN网络中的卷积和池化方法，解决多变量协同预测问题；将数据集多维度数据分开处理训练，保证训练效果的同时降低了训练用时。本发明所述的一种基于注意力及深度学习的光伏发电量预测系统，包括训练模块，数据预处理模块、transformer网络模块、CNN网络模块及应用模块；所述数据预处理模块对数据集进行预处理，并生成训练集；所述训练模块使用transformer网络模块、CNN网络模块进行训练和预测；所述transformer网络模块基于注意力机制提取时序特征，并预测下一时刻的值，生成时序预测结果；所述CNN网络模块对训练集的数据及时序预测结果进行训练，生成最终预测结果；所述应用模块通过训练好的模型，对于发电量预测任务输出预测结果；其中，CNN网络模块包括2层一维卷积层，1层一维最大池化层，2层全连接层；2层全连接层之间通过ReLU激活函数, 连接，一维卷积层卷积核大小为3，池化层大小为2；CNN网络接受transformer网络输出作为参数，但transformer网络不参与反向传播；CNN网络模块和transformer网络模块之间使用残差连接，记transformer网络输出为；/＞分别在CNN网络模块的输入层，以及CNN网络模块的第一层全连接层输入CNN网络；CNN网络模块的输入数据包括/＞以及数据集中的多变量部分，输入数据首先通过卷积层提取关联信息，然后由池化层对信息降维防止过拟合，最后通过残差连接至全连接层输出得到预测值。进一步的，所述transformer网络模块包括位置编码层、基于注意力机制的6个transformer编码器、基于注意力机制的6个transformer解码器、全连接层和Softmax输出层；其中每个transformer编码器依次由多头注意力层和全连接前馈网络层组成，这两个子层各自通过残差和归一化层连接至下一层；transformer解码器依次由带有掩码的多头注意力层、继承编码器权重的多头注意力层和全连接前馈网络层组成，各个子层各自通过残差和归一化层连接至下一层。一种基于注意力及深度学习的光伏发电量预测方法，步骤为：S1、收集智能电网中光伏电站的各项数据，对缺漏异常数据进行预处理；S2、将训练数据输入训练模块，使用训练数据集训练基于注意力的神经网络预测模型中的transformer网络，并使用训练数据集以及以训练的transformer网络训练神经网络预测模型中的CNN网络；S3、训练完成后启动预测程序，将待预测数据转换为输入向量格式，输入到训练完成的网络中，输出发电量预测值。进一步的，对缺漏异常数据进行预处理具体为：S101、获取目标电站的数据集，并根据每条数据的时间戳得到对应的月份和小时，将月份及小时合并进数据集并删除时间戳；S102、针对每一条数据，首先检查每条数据是否在设置的阈值范围内，若发现异常数据则将这项数据置空；S103、检查每条数据内完整性；若数据为空，则先判定缺失部分数据项上下两条数据是否为空；若不为空则将上下两条数据的平均值作为该项数据的值，否则，使用前三天该项数据的平均值作为该项数据的值；S104、检查数据是否缺失；通过检查时间戳是否和上一条数据间隔为一次标准采样时间间隔，若间隔时间超过一次标准采样时间间隔，即代表出现数据缺失；首先计算间隔时间，若间隔时间是2个标准采样时间间隔，即只有一条数据缺失，则将上下两条数据的平均值作为缺失部分的值；若有多条数据缺失，则将前一天同一时刻的值作为对应时刻的值；S105、将数据归一化，并按照如下规则转换为训练数据集：每条训练数据中，前10项为前10条数据的实际发电量值，记为；第11-18项为当前数据的特征数据项，即月份、小时、辐照度、风速、风向、温度、湿度、压强，记为/＞，第19项为当前实际发电量，记为/＞。进一步的，S2中，使用训练数据集训练transformer网络，具体为：S211、初始化transformer网络，将数据集分为训练和测试数据集，设置初始学习率为；S212、迭代训练集中数据，取每条训练数据中前10项，即，输入transformer网络；S213、使用均方损失函数作为损失函数，将当前实际发电量/＞作为真实标签/＞，将transformer网络输出结果/＞与标签使用损失函数计算误差，通过反向传播算法更新transformer网络参数；S214、重复上述步骤，使用Adam算法更新学习率，循环迭代直至网络收敛；S215、在测试数据集上对transformer网络进行测试，保存transformer网络参数。进一步的，所述数据集的数据通过输入位置编码层，位置编码层使用全连接网络将输入数据映射为嵌入向量，并与位置编码向量相加；然后将相加后结果合并为编码数据矩阵；位置编码层基于正余弦函数生成位置向量；位置编码层公式如下：，，其中，pos代表元素在序列中的实际位置，代表嵌入向量的维度。进一步的，在transformer编码器和transformer解码器的注意力层中，通过计算三个矩阵获得相关性分数；其中，Q代表查询矩阵，K代表被查询的信息和其他信息的相关程度的矩阵，V代表被查询信息的矩阵；通过以下步骤计算相关性分数，以分析每个位置的重要性：Sa、随机初始化权重矩阵，并将前面经过位置编码的编码数据矩阵分别与对应权重矩阵相乘，得到/＞矩阵；Sb、计算分数矩阵，/＞为K的转置，得到输入序列中数据之间的相关性分数；Sc、归一化分数矩阵，并对其进行softmax处理，再与/＞相乘得到相关性分数矩阵/＞，即，其中，是每个数据向量对应的值向量即Key的维度，/＞定义为/＞。进一步的，S2中，使用训练数据集以及已训练的transformer网络训练CNN网络，具体为：S221、初始化CNN网络，将数据集分为训练和测试数据集，设置初始学习率为；S222、读取已训练transformer网络参数；S223、迭代训练集中数据，取每条训练数据中前10项，即，输入transformer网络，得到transformer网络输出/＞；S224、取每条训练数据中1-18项，即，以及transformer网络输出/＞，合并为向量/＞输入CNN网络；S225、使用均方损失函数作为损失函数，将当前实际发电量/＞作为真实标签/＞，将CNN网络输出结果/＞与标签使用损失函数计算误差，通过反向传播算法更新CNN网络参数；S226、重复上述步骤，使用Adam算法更新学习率，循环迭代直至网络收敛；S227、在测试数据集上对CNN网络进行测试，保存CNN网络参数。本发明所述的有益效果为：本发明通过使用基于注意力机制的transformer网络提取数据之间的时序特征，提高预测精度；使用残差连接transformer网络输出和CNN网络，更好的保留时序预测特征，使得模型深度增加的同时不易丢失有效信息；通过CNN卷积层提取多维度信息，达到使用多变量协同预测的效果；通过结合transformer网络的时序特征提取能力以及CNN网络的多变量协同预测能力，使模型不仅可以通过注意力机制关注历史数据变化趋势，也能融合各种外部变量进行预测，提高了模型的预测效果；将数据集多维度数据分开处理训练，保证训练效果的同时降低了训练用时，防止神经网络收敛过慢。附图说明图1是基于注意力机制以及深度学习的光伏发电量预测方法结构图；图2是Transformer-CNN融合网络结构图；图3是基于注意力机制以及深度学习的光伏发电量预测系统结构图。具体实施方式为了使本发明的内容更容易被清楚地理解，下面根据具体实施例并结合附图，对本发明作进一步详细的说明。如图1所示，本发明所述的一种基于注意力及深度学习的光伏发电量预测系统，包括训练模块，数据预处理模块、transformer网络模块、CNN网络模块及应用模块；所述数据预处理模块对数据集进行预处理，并生成训练集；所述训练模块使用transformer网络模块、CNN网络模块进行训练和预测；所述transformer网络模块与CNN网络模块间使用残差连接；所述transformer网络模块基于注意力机制提取时序特征，并预测下一时刻的值，生成时序预测结果；所述CNN网络模块对训练集的数据及时序预测结果进行训练，生成最终预测结果；所述应用模块通过训练好的模型，对于发电量预测任务输出预测结果。如图3所示，所述transformer网络模块包括位置编码层、基于注意力机制的6个transformer编码器、基于注意力机制的6个transformer解码器、全连接层和Softmax输出层；其中每个transformer编码器依次由多头注意力层和全连接前馈网络层组成，这两个子层各自通过残差和归一化层连接至下一层；transformer解码器依次由带有掩码的多头注意力层、继承编码器权重的多头注意力层和全连接前馈网络层组成，各个子层各自通过残差和归一化层连接至下一层。CNN网络模块包括2层一维卷积层，1层一维最大池化层，2层全连接层；2层全连接层之间通过ReLU激活函数, 连接，一维卷积层卷积核大小为3，池化层大小为2；CNN网络使用卷积层进一步提取时序信息，同时通过提取多个关联变量和发电量之间的关系提高预测精度。CNN网络接受transformer网络输出作为参数，但transformer网络不参与反向传播；为了减少信息丢失，CNN网络模块和transformer网络模块之间使用残差连接，记transformer网络输出为；/＞分别在CNN网络模块的输入层，以及CNN网络模块的第一层全连接层输入CNN网络；CNN网络模块的输入数据包括/＞以及数据集中的多变量部分，输入数据首先通过卷积层提取关联信息，然后由池化层对信息降维防止过拟合，最后通过残差连接至全连接层输出得到预测值。一种基于注意力及深度学习的光伏发电量预测方法，如图2所示，包括以下步骤：S1、收集智能电网中光伏电站的各种可能影响电站发电量的数据，时间，辐照度，风速，风向，温度，湿度，压强。同时，考虑到电站存在维护等原因造成的部分时间数据不可用或数据异常的问题，使用插值等方法对缺漏异常数据进行填补修改，具体为：S101、获取目标电站的数据集，并根据每条数据的时间戳得到对应的月份和小时，将月份及小时合并进数据集并删除时间戳；S102、针对每一条数据，首先检查每条数据是否在预先设置的合理范围内，比如温度应在-20至50之间；如果发现异常数据则将这项数据置空；S103、检查每条数据内完整性，如每一个数据项是否为空；如果数据为空则使用如下算法填充空白数据；先判定缺失部分数据项上下两条数据是否为空，若不为空则将上下两条数据的平均值作为该项数据的值；否则，使用前三天该项数据的平均值作为该项数据的值；S104、检查数据是否缺失；通过检查时间戳是否和上一条数据间隔为一次标准采样时间间隔，如果间隔时间超过一次标准采样时间间隔，即代表出现数据缺失。首先计算间隔时间，如果间隔时间是2个标准采样时间间隔，即只有一条数据缺失，则将上下两条数据的平均值作为缺失部分的值；如果有多条数据缺失，则将昨天同一时刻的值作为对应时刻的值；S105、将数据归一化，并按照如下规则转换为训练数据集。每条训练数据中，前10项为前10条数据的实际发电量值，记为。第11-18项为当前数据的特征数据项，即月份，小时，辐照度，风速，风向，温度，湿度，压强，记为/＞，第19项为当前实际发电量，记为/＞。S2、将训练数据输入训练模块，使用训练数据集训练基于注意力的神经网络预测模型中的transformer网络，并使用训练数据集以及以训练的transformer网络训练神经网络预测模型中的CNN网络；训练时先训练transformer网络，然后在不改变transformer网络的前提下训练transformer-CNN融合网络；使用transformer网络处理光伏发电时间序列，具体步骤如下。S211、初始化transformer网络，将数据集分为训练和测试数据集，设置初始学习率为；S212、迭代训练集中数据，取每条训练数据中前10项，即，输入transformer网络；S213、使用均方损失函数作为损失函数，将当前实际发电量/＞作为真实标签/＞，将transformer网络输出结果/＞与标签使用损失函数计算误差，通过反向传播算法更新transformer网络参数；S214、重复上述步骤，使用Adam算法更新学习率，循环迭代直至网络收敛；S215、在测试数据集上对transformer网络进行测试，保存transformer网络参数。具体地，在transformer网络中，输入数据首先通过输入位置编码层，位置编码层基于正余弦函数生成位置向量，并与原始值相加，随后输入至编码器。编码器由多个相同的层堆叠而成，编码器中包含注意力子层，前馈网络子层和归一化子层。编码器中的注意力层通过三个矩阵对每个值计算相关性分数，其中，Q代表查询矩阵，K代表被查询的信息和其他信息的相关程度的矩阵，V代表被查询信息的矩阵；然后进行求和与归一化后通过前馈网络层连接至下一层编码器层。具体地，在注意力层中通过以下步骤计算相关性分数，以分析每个位置的重要性：Sa、随机初始化权重矩阵，并将前面经过位置编码的编码数据矩阵分别与对应权重矩阵相乘，得到/＞矩阵；Sb、计算分数矩阵，/＞为K的转置，得到输入序列中数据之间的相关性分数；Sc、归一化分数矩阵，并对其进行softmax处理，再与/＞相乘得到相关性分数矩阵/＞，即，/＞其中，是每个数据向量对应的值向量即Key的维度，/＞定义为/＞。解码器也是由多个相同结构的层堆叠而成，每层包含掩码注意力子层，编解码器注意力子层，前馈网络子层和归一化子层。掩码注意力层，编解码器注意力层，前馈层依次由归一化子层相连接，编解码器层使用编码器层最后一个子层的的注意力层权重作为自身权重；最后，连接至一个全连接网络生成最后的输出结果作为预测值。在步骤S1处理数据集后，通过transformer网络提取光伏发电功率序列的时序特征，在编码器注意力层中提取时序每个位置的注意力值，并送至解码器中的编解码器注意力层中；带有掩码的解码器注意力层保证注意力仅与该位置之前的所有位置有关，确保预测是因果的。使用训练数据集以及已训练的transformer网络训练神经网络预测模块中的CNN网络，具体过程如下：S221、初始化CNN网络，将数据集分为训练和测试数据集，设置初始学习率为；S222、读取已训练transformer网络参数；S223、迭代训练集中数据，取每条训练数据中前10项，即，输入transformer网络，得到transformer网络输出/＞；S224、取每条训练数据中1-18项，即，以及transformer网络输出/＞，合并为向量/＞输入CNN网络；S225、使用均方损失函数作为损失函数，将当前实际发电量/＞作为真实标签/＞，将CNN网络输出结果/＞与标签使用损失函数计算误差，通过反向传播算法更新CNN网络参数；S226、重复上述步骤，使用Adam算法更新学习率，循环迭代直至网络收敛；S227、在测试数据集上对CNN网络进行测试，保存CNN网络参数。CNN网络的输入层接受各变量，以及transformer网络的输出结果，通过卷积以及池化提取相关信息，并经过第一层全连接层，/＞残差连接至第二层全连接层，减少了时序信息的损失，全连接层输出最终的预测结果。S3、训练完成后启动预测程序，具体为：从光伏电厂读取待测数据以及历史数据，获取光伏发电功率时间序列以及其他变量数据，生成可以被网络接受的数据向量；将时序数据输入至transformer网络，经过位置编码后，编码器中的注意力层提取注意力值并将权重同步至解码器，解码器依此预测下一时刻的值；CNN网络接受数据向量以及，并通过卷积层、池化层提取关联信息；/＞经过残差连接至全连接层，并输出最后的预测结果/＞。以上所述仅为本发明的优选方案，并非作为对本发明的进一步限定，凡是利用本发明说明书及附图内容所作的各种等效变化均在本发明的保护范围之内。
