标题title
一种语义分割模型优化方法及系统
摘要abst
本申请公开了一种语义分割模型优化方法及系统，通过构建第一语义分割模型及处理模块；并对第一空间权重和第一类别权重进行初始化处理；在每轮训练迭代过程中根据处理模块的输出结果对第一空间权重进行更新获得第二空间权重；根据验证结果和第一类别权重，以获取第二类别权重；最后再根据第二空间权重和第二类别权重以及预设条件获得优化后的第二语义分割模型；本方法不改变语义分割网络模型的网络结构以及不增加推理过程中的运算工作量就可以解决训练过程中图像不均衡和语义分割中的多尺度目标的问题。
权利要求书clms
1.一种语义分割模型优化方法，其特征在于，包括以下步骤：S1.构建第一语义分割模型及处理模块；S2.初始化第一空间权重和第一类别权重；S3.根据所述处理模块的输出结果，对所述第一空间权重进行更新，以获取第二空间权重；S4.根据预设轮次对所述第一语义分割模型进行验证以获取验证结果，并根据所述验证结果和所述第一类别权重，以获取第二类别权重；S5.根据所述第二空间权重和所述第二类别权重以及预设条件，以获取第二语义分割模型。2.根据权利要求1所述的语义分割模型优化方法，其特征在于，所述步骤S3之前，还包括：A1.输入图像数据至所述第一语义分割模型，以获取第一分割结果；A2.输入所述图像数据和所述第一分割结果至所述处理模块，以获取第二分割结果。3.根据权利要求2所述的语义分割模型优化方法，其特征在于，所述处理模块用于根据所述第一分割结果和所述图像数据中相邻两个像素之间的关联性优化所述第一分割结果；其中，优化后的所述第一分割结果即为所述第二分割结果。4.根据权利要求2所述的语义分割模型优化方法，其特征在于，所述步骤S3，包括如下步骤：B1.分别对所述第一分割结果和所述第二分割结果进行归一化处理，以获取所述第一分割结果所对应的第三分割结果和所述第二分割结果所对应的第四分割结果；B2.根据所述第四分割结果获取所述图像数据在每个空间位置的类别；B3.根据所述类别获取所述第三分割结果对应空间位置对应类别下的概率值；B4.根据所述概率值对所述第一空间权重进行更新，以获取所述第二空间权重。5.根据权利要求2所述的语义分割模型优化方法，其特征在于，所述步骤S4根据预设轮次对所述第一语义分割模型进行验证以获取验证结果，包括如下步骤：C1.将所述图像数据划分为训练集和验证集；C2.输入所述训练集至所述第一语义分割模型进行训练，以获取中间结果；C3.输入所述验证集至所述第一语义分割模型对所述中间结果进行验证，以获取验证结果。6.根据权利要求5所述的语义分割模型优化方法，其特征在于，所述步骤S4中的并根据所述验证结果和所述第一类别权重，以获取第二类别权重，具体为：根据所述验证结果、预设验证结果范围和预设更新比例因子对所述第一类别权重进行更新，以获取所述第二类别权重。7.根据权利要求5所述的语义分割模型优化方法，其特征在于，所述预设条件包括：迭代轮次达到所述预设轮次的上限；或，所述验证结果大于或等于预设阈值。8.根据权利要求7所述的语义分割模型优化方法，其特征在于，所述步骤S5，包括如下步骤：当满足任一所述预设条件时，根据所述第二空间权重和所述第二类别权重对所述第一语义分割模型进行优化，以获取第二语义分割模型；不满足任一所述预设条件时，返回执行步骤S3至S5。9.一种语义分割模型优化系统，其特征在于，包括：构建模块、处理模块、初始化模块、空间权重模块、类别权重模块和优化模块；所述构建模块，用于构建第一语义分割模型及处理模块；所述处理模块，用于根据所述第一分割结果和所述图像数据中相邻两个像素之间的关联性优化分割结果；所述初始化模块，用于初始化所述第一语义分割模型中的第一空间权重和第一类别权重；所述空间权重模块，用于根据所述处理模块的输出结果，对所述第一空间权重进行更新，以获取第二空间权重；所述类别权重模块，用于根据预设轮次进行迭代，验证所述第一语义分割模型以获取验证结果，并根据所述验证结果更新所述第一类别权重，以获取第二类别权重；所述优化模块，用于根据所述第二空间权重和所述第二类别权重以及预设条件，以获取第二语义分割模型。
说明书desc
技术领域本申请涉及图像语义分割领域，尤其涉及一种语义分割模型优化方法及系统。背景技术图像语义分割是计算机视觉中的一个重要方向，该技术是将图像细分为子区域，这些子区域互不重叠，并集为初始图像，每个子区域内的像素分布符合预定规则；传统基于图像处理实现语义分割的方法有阈值分割、区域生长、分水岭算法和图割等算法；如今随着深度学习技术的发展，基于深度神经网络的图像语义分割算法蓬勃发展，验证结果和鲁棒性远超传统方法，已经被广泛应用于自动驾驶的场景识别、增强现实和医学图像分析等领域。一些图像语义分割算法通过改变网络结构来提高感受野，如PSPNet引入了空洞卷积和金字塔结构，ParseNet借鉴了ResNet的残差结构，但这类方法往往只针对特有的网络，难以有效应用在所有的语义分割算法中；一些算法通过先验知识实现分割结果的优化，如以像素位置和颜色作为先验知识，借助条件随机场实现分割后处理的方法；这类后处理方法虽然能够以后处理的方式兼容大部分语义分割网络，但增加了推理过程中的运算量；虽然像CRFasRNN的方法实现了将CRF集合进语义分割网络的目标，但需要对现有网络做改造再重新训练，工作量比较大；相较于同样基于深度学习的图像分类和目标检测任务，图像语义分割的样本标注需要对每个像素实现精确分类，标注难度非常大；此外另一个影响图像语义分割的因素是网络的真实感受野不够大，不能兼顾多尺度的目标。鉴于此，提出一种通过不改变语义分割网络模型的网络结构，不增加推理过程中的运算工作量可以缓解训练过程中图像不均衡以及语义分割中的多尺度目标的语义分割模型优化方法及系统是本领域技术人员亟待解决的问题。发明内容本发明的目的在于提供一种语义分割模型优化方法及系统，不改变现有语义分割网络模型，不增加推理过程中的运算量就可以有效缓解训练图像不均衡和语义分割中的多尺度目标问题。为解决上述技术问题，本发明提供的技术方案如下：一种语义分割模型优化方法，包括以下步骤：S1.构建第一语义分割模型及处理模块；S2.初始化第一空间权重和第一类别权重；S3.根据所述处理模块的输出结果，对所述第一空间权重进行更新，以获取第二空间权重；S4.根据预设轮次对所述第一语义分割模型进行验证以获取验证结果，并根据所述验证结果和所述第一类别权重，以获取第二类别权重；S5.根据所述第二空间权重和所述第二类别权重以及预设条件，以获取第二语义分割模型。优选地，所述步骤S3之前，还包括：输入图像数据至所述第一语义分割模型，以获取第一分割结果；输入所述图像数据和所述第一分割结果至所述处理模块，以获取第二分割结果。优选地，所述处理模块用于根据所述第一分割结果和所述图像数据中相邻两个像素之间的关联性优化所述第一分割结果；其中，优化后的所述第一分割结果即为所述第二分割结果。优选地，所述步骤S3，包括如下步骤：B1.分别对所述第一分割结果和所述第二分割结果进行归一化处理，以获取所述第一分割结果所对应的第三分割结果和所述第二分割结果所对应的第四分割结果；B2.根据所述第四分割结果获取所述图像数据在每个空间位置的类别；B3.根据所述类别获取所述第三分割结果对应空间位置对应类别下的概率值；B4.根据所述概率值对所述第一空间权重进行更新，以获取所述第二空间权重。优选地，所述步骤S4中根据预设轮次对所述第一语义分割模型进行验证以获取验证结果，包括如下步骤：C1.将所述图像数据划分为训练集和验证集；C2.输入所述训练集至所述第一语义分割模型进行训练，以获取中间结果；C3.输入所述验证集至所述第一语义分割模型对所述中间结果进行验证，以获取验证结果。优选地，所述步骤S4中的并根据所述验证结果和所述第一类别权重，以获取第二类别权重，具体为：根据每轮迭代完成后的所述验证结果、预设验证结果范围和预设更新比例因子对所述第一类别权重进行更新，以获取所述第二类别权重。优选地，所述预设条件包括：迭代轮次达到所述预设轮次的上限；或，所述验证结果大于或等于预设阈值。优选地，所述步骤S5，包括如下步骤：当满足任一所述预设条件时，根据所述第二空间权重和所述第二类别权重对所述第一语义分割模型进行优化，以获取第二语义分割模型；不满足任一所述预设条件时，返回执行步骤S3至S5。一种语义分割模型的优化系统，包括：构建模块、处理模块、初始化模块、空间权重模块、类别权重模块和优化模块；所述构建模块，用于构建第一语义分割模型及处理模块；所述处理模块，用于根据所述第一分割结果和所述图像数据中相邻两个像素之间的关联性优化分割结果；所述初始化模块，用于初始化所述第一语义分割模型中的第一空间权重和第一类别权重；所述空间权重模块，用于根据所述处理模块的输出结果，对所述第一空间权重进行更新，以获取第二空间权重；所述类别权重模块，用于根据预设轮次进行迭代，验证所述第一语义分割模型以获取验证结果，并根据所述验证结果更新所述第一类别权重，以获取第二类别权重；所述优化模块，用于根据所述第二空间权重和所述第二类别权重以及预设条件，以获取第二语义分割模型。本发明提供了一种语义分割模型优化方法，通过构建第一语义分割模型及处理模块；并对第一语义分割模型中的第一空间权重和第一类别权重进行初始化处理；根据处理模块的输出结果对第一空间权重进行加权获得第二空间权重；根据预设轮次进行迭代，验证第一语义分割模型以获取验证结果，并根据验证结果和第一类别权重，以获取第二类别权重；最后再根据第二空间权重和第二类别权重以及预设条件获得优化后的第二语义分割模型；本方法通过优化后的第一语义分割模型，可以通过不改变语义分割网络模型的网络结构以及不增加推理过程中的运算工作量就可以解决训练过程中图像不均衡和语义分割中的多尺度目标的问题。本发明还提供了一种语义分割模型优化系统，由于该系统与该语义分割模型优化方法解决相同的技术问题，属于相同的技术构思，理应具有相同的有益效果，在此不再赘述。附图说明为了更清楚地说明本申请实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本申请中记载的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例中语义分割模型优化方法的流程图；图2为本发明实施例中步骤S3的流程图；图3为本发明实施例中步骤S4中获取验证结果的流程图；图4为本发明实施例中语义分割模型优化系统的结构示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。如图1所示，本发明实施例提供一种语义分割模型优化方法，包括以下步骤：S1.构建第一语义分割模型及处理模块；S2.初始化第一空间权重和第一类别权重；S3.根据处理模块的输出结果，对第一空间权重进行更新，以获取第二空间权重；S4.验证第一语义分割模型以获取验证结果，并根据验证结果和第一类别权重，以获取第二类别权重；S5.根据第二空间权重和第二类别权重以及预设条件，以获取第二语义分割模型。步骤S1中，通过构建第一语义分割模型便于对第一语义分割模型进行优化处理，本实施例构建的第一语义分割模型可以是任意一种需要对图像进行语义分割的图像处理模型；所构建的处理模块是通过将语义分割结果作为输入，再结合颜色、像素空间位置对分割结果做优化，输出更高精度的分割结果。步骤S2中，空间权重是在每张图像数据的训练过程中通过比较第一语义分割模型输出和处理模块输出的差异得到的；类别权重是通过在训练过程中每次验证得到的各类别精度得到。需要说明的是，空间权重尺寸与训练图像尺寸一致，实现训练过程中像素损失的惩罚，训练开始时空间权重被初始化为全1的矩阵；类别权重长度与训练样本集包含的类别数目一致，实现训练过程中类别损失的惩罚，训练开始时类别权重被初始化为全1的向量。步骤S3中，通过处理模块的输出结果，对第一空间权重进行更新后，以得到第二空间权重，促使第一语义分割模型对图像数据进行语义分割时更加准确，同时可以促使其他类型的图像语义分割模型通过不改变网络结构来提高感受野。步骤S4中，可以对第一语义分割模型的验证进行迭代轮次设置，如每k轮对第一语义模型进行验证；然后根据第一语义分割模型的中间结果对第一语义分割模型进行验证，得到验证结果，再根据验证结果并结合初始化后的第一类别权重对第一类别权重进行处理后，得到第二类别权重，通过反复训练以及第二类别权重可以有效提高第一语义分割模型对图像进行语义分割后的验证结果；需要说明的是，若迭代轮次设置为10次，则在步骤S3至S5的迭代次数达到10次，才对第一语义模型进行验证，并获取验证结果，再根据验证结果并结合初始化后的第一类别权重对第一类别权重进行处理后，得到第二类别权重；若没有达到迭代轮次时，则将步骤S2初始化后的第一类别权重作为第二类别权重。步骤S5中，通过为第一语义分割模型预先设置判断条件，可以有效判断第一语义分割模型是否达到理想状态，若达到理想状态，根据第二空间权重和第二类别权重对第一语义分割模型进行优化处理得到第二语义分割模型，其中，第二语义分割模型为最优的语义分割模型。优选地，步骤S3之前，还包括：A1.输入图像数据至第一语义分割模型，以获取第一分割结果；A2.输入图像数据和第一分割结果至处理模块，以获取第二分割结果。步骤A1中，将初始图像数据输入至第一语义分割模型，以得到第一分割结果，再将第一分割结果作为输入数据，发送至步骤A2中进行处理，可以有效提高第一语义分割模型的准确性。步骤A2中，将图像数据输入至处理模块，提取出图像数据中的有效数据，然后再将步骤A1中获取到的第一个分割结果输入至处理模块中，以得到第二分割结果。优选地，处理模块用于根据第一分割结果和图像数据中相邻两个像素之间的关联性优化第一分割结果；其中，优化后的第一分割结果即为第二分割结果。实际运用中，将第一分割结果作为处理模块的输入，并结合图像数据中相邻两个像素之间的关联性，通过最小化公式实现对第一分割结果的优化，得到第二分割结果；最小化公式为：其中，ψu是一元势函数，表示第一语义分割模型的第一分割结果；ψp是二元势函数，表示图像数据中相邻两个像素xi和xj之间的关联性；E表示第二分割结果。如图2所示，优选地，步骤S3，包括如下步骤：B1.分别对第一分割结果和第二分割结果进行归一化处理，以获取第一分割结果所对应的第三分割结果和第二分割结果所对应的第四分割结果；B2.根据第四分割结果获取图像数据在每个空间位置的类别；B3.根据类别获取第三分割结果对应空间位置对应类别下的概率值；B4.根据概率值对第一空间权重进行更新，以获取第二空间权重。步骤B1中，分别对第一分割结果和第二分割结果进行归一化处理，以得到第一分割结果所对应的第三分割结果和第二分割结果所对应的第四分割结果，具体公式为：其中，表示空间位置处类别c的概率值；/＞表示对第一分割结果和第二分割结果中处类别c的输出值做以自然数e为底的指数运算；表示将第一分割结果和第二分割结果中处所有C个类别的指数结果做累加。步骤B2中，根据两个像素的空间位置和颜色来计算其关联性，可以发现位置邻近且颜色相似的像素属于同一个类别，因此本实施例通过图像数据的空间位置来得到第四分割结果的所属类别；步骤B3中，通过两个相邻像素之前的关联性，可以得到分割结果所属类别，因此，本实施例根据步骤B2中所得到的第四分割结果的类别计算出第三分割结果处于对应空间位置对应类别下的概率值；步骤B4中，通过步骤B3中计算得到的概率值，对第一空间权重进行加权后更新，以得到第二空间权重，并根据公式计算出训练损失；第二空间权重计算公式为：γ2＝1-c1，其中，表示空间位置，γ2表示第二空间权重，c1表示第三分割结果处于第四分割结果的类别的概率值；训练损失计算公式为：其中，dc表示d中第c类的值；C是样本集总类别数；是类别c对应的类别权重；训练损失是通过计算每个空间位置上预测值和真实值的差异d，最后累加得到的，然后再根据更新后的空间权重对d做加权，最后做累加得到加权损失lossw。如图3所示，优选地，步骤S4中根据预设轮次对所述第一语义分割模型进行验证以获取验证结果，包括如下步骤：C1.将图像数据划分为训练集和验证集；C2.输入训练集至第一语义分割模型进行训练，以获取中间结果；C3.输入验证集至第一语义分割模型对中间结果进行验证，以获取验证结果。步骤C1中，通过将图像数据划分为训练集和验证集，形成一个对照实验组，便于得到更准确的训练数据，训练集用于在第一语义分割模型中进行训练以得到训练的中间结果；验证集用于验证训练的中间结果得到最后验证结果；步骤C2中，将训练集输入至第一语义分割模型进行训练，以得到中间结果，然后将中间结果发送至步骤C3中，进行结果验证，可以有效提高第一语义分割模型的准确率；步骤C3中，将验证集输入至第一语义分割模型对步骤C2得到是中间结果进行验证，以得到验证结果。优选地，步骤S4中并根据验证结果和第一类别权重，以获取第二类别权重，具体为：根据验证结果、预设验证结果范围和预设更新比例因子对第一类别权重进行更新，以获取第二类别权重。实际运用中，通过步骤C3中获得的验证结果结合预设验证结果范围和预设更新比例因子构建计算公式对第一类别权重进行更新得到第二类别权重，本实施例中，将验证结果范围预先设置为1；具体公式如下：γc＝λ其中，λ是更新比例因子，控制权重的尺度大小，一般可以取10；pc表示每轮迭代完成后的验证结果；当验证结果pc较高时更新后的类别权重较低，下一轮训练时对该类别误分类的敏感度降低；相反当验证结果pc较低时更新后的类别权重较高，下一轮训练时对该类别误分类的敏感度会提高。优选地，预设条件包括：迭代轮次达到预设轮次的上限；或，验证结果大于或等于预设阈值。实际运用中，通过设置两种类型的条件，避免了在训练过程中出现不同的结果却没有判断条件的问题，因此，在本实施例中，这两个条件总有一个会满足，比如预设的迭代次数上限是100次，即使迭代次数达到了100次，验证结果没达到预设阈值，也会迭代终止，完成训练。优选地，根据第二空间权重和第二类别权重以及预设条件，以获取第二语义分割模型，包括如下步骤：当满足任一预设条件时，根据第二空间权重和第二类别权重对第一语义分割模型进行优化，以获取第二语义分割模型；不满足任一预设条件时，返回执行步骤S3至S5。实际运用中，当迭代轮次或验证结果满足任一预设条件时，可以通过得到的第二空间权重和第二类别权重对第一语义分割模型进行优化处理，得到优化后的第二语义分割模型；优化后的第二语义分割模型可以通过不改变语义分割网络模型的网络结构以及不增加推理过程中的运算工作量就可以解决训练过程中图像不均衡以及语义分割中的多尺度目标的问题；若任一预设条件都不满足时，需要返回执行步骤S3至步骤S5，直至满足任一预设条件后，迭代终止，完成训练。如图4所示，本发明实施例还提供了一种语义分割模型优化系统，包括：构建模块、处理模块、初始化模块、空间权重模块、类别权重模块和优化模块；构建模块，用于构建第一语义分割模型及处理模块；处理模块，用于根据第一分割结果和图像数据中相邻两个像素之间的关联性优化分割结果；初始化模块，用于初始化第一语义分割模型中的第一空间权重和第一类别权重；空间权重模块，用于根据处理模块的输出结果，对第一空间权重进行更新，以获取第二空间权重；类别权重模块，用于根据预设轮次进行迭代，验证第一语义分割模型以获取验证结果，并根据验证结果更新第一类别权重，以获取第二类别权重；优化模块，用于根据第二空间权重和第二类别权重以及预设条件，以获取第二语义分割模型。实际运用过程中，语义分割模型的优化系统中，设置有构建模块、处理模块、初始化模块、空间权重模块、类别权重模块和优化模块；构建模块与处理模块是并列关系；空间权重模块和类别权重模块是并列关系；初始化模块与构建模块连接；空间权重模块一端与初始化模块连接，另一端与处理模块连接；类别权重模块与初始化模块连接；优化模块一端与空间权重连接，另一端与类别权重连接；构建模块将第一语义分割模块构建后，将进入初始化模块；初始化模块将对第一语义分割模型中的第一空间权重进行初始化后，将初始化后的第一空间权重发送至空间权重模块；处理模块将分割结果优化后，将优化后的分割结果发送至空间权重模块；空间权重模块将根据初始化后的第一空间权重和优化后的分割结果得到第二空间权重，并第二空间权重发送至优化模块；初始化模块将对第一语义分割模型中的第一类别权重进行初始化后，将初始化后的第一类别权重发送至类别权重模块；类别权重模块对第一类别权重进行处理后得到第二类别权重，并将第二类别权重发送至优化模块；优化模块将根据第二空间权重和第二类别权重对第一语义分割模型进行优化，得到第二语义分割模型。在本申请所提供的实施例中，应该理解到，所揭露的方法和系统，可以通过其它的方式实现。以上所描述的系统实施例仅仅是示意性的，例如，模块的划分，仅仅为一种逻辑功能划分，实际实现时可以有另外的划分方式，如：多个模块或组件可以结合，或可以集成到另一个系统，或一些特征可以忽略，或不执行。另外，所显示或讨论的各组成部分相互之间的耦合、或直接耦合、或通信连接可以是通过一些接口，设备或模块的间接耦合或通信连接，可以是电性的、机械的或其它形式的。另外，在本发明各实施例中的各功能模块可以全部集成在一个处理器中，也可以是各模块分别单独作为一个器件，也可以两个或两个以上模块集成在一个器件中；本发明各实施例中的各功能模块既可以采用硬件的形式实现，也可以采用硬件加软件功能单元的形式实现。本领域普通技术人员可以理解：实现上述方法实施例的全部或部分步骤可以通过程序指令及相关的硬件来完成，前述的程序指令可以存储于计算机可读取存储介质中，该程序指令在执行时，执行包括上述方法实施例的步骤；而前述的存储介质包括：移动存储设备、只读存储器、磁碟或者光盘等各种可以存储程序代码的介质。应当理解，本申请中如若使用了“方法”、“装置”、“单元”和/或“模块”，仅是用于区分不同级别的不同组件、元件、部件、部分或装配的一种方法。然而，如果其他词语可实现相同的目的，则可通过其他表达来替换该词语。如本申请和权利要求书中所示，除非上下文明确提示例外情形，“一”、“一个”、“一种”和/或“该”等词并非特指单数，也可包括复数。一般说来，术语“包括”与“包含”仅提示包括已明确标识的步骤和元素，而这些步骤和元素不构成一个排它性的罗列，方法或者设备也可能包含其它的步骤或元素。由语句“包括一个……”限定的要素，并不排除在包括要素的过程、方法、商品或者设备中还存在另外的相同要素。以下，术语“第一”、“第二”仅用于描述目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量。由此，限定有“第一”、“第二”的特征可以明示或者隐含地包括一个或者更多个该特征。本申请中如若使用了流程图，则该流程图是用来说明根据本申请的实施例的系统所执行的操作。应当理解的是，前面或后面操作不一定按照顺序来精确地执行。相反，可以按照倒序或同时处理各个步骤。同时，也可以将其他操作添加到这些过程中，或从这些过程移除某一步或数步操作。以上对本发明所提供的一一种语义分割模型优化方法及系统进行了详细介绍。对所公开的实施例的上述说明，使本领域专业技术人员能够实现或使用本发明。对这些实施例的多种修改对本领域的专业技术人员来说将是显而易见的，本文中所定义的一般原理可以在不脱离本发明的精神或范围的情况下，在其它实施例中实现。因此，本发明将不会被限制于本文所示的这些实施例，而是要符合与本文所公开的原理和新颖特点相一致的最宽的范围。
