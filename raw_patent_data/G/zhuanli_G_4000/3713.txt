标题title
一种空间规划业务库的更新方法
摘要abst
本发明公开了一种空间规划业务库的更新方法，其技术方案要点在于：采用区域更新，同时对需要接边的线要素和面要素进行几何检查和属性检查，通过要素的几何位置关系以及属性字段编码两个方面进行接边的判断。本发明通过区域更新、要素更新、属性检索三方面的结合，进行接边处理，提高了新的空间数据与业务库内相邻图幅的空间数据的边缘衔接处的精度，保证了业务库更新的准确度，有助于提高城市体检评估中地理分析作业的准确度。
权利要求书clms
1.一种空间规划业务库的更新方法，其特征在于：包括如下步骤：S1、确定待更新范围图框；S2、将业务库中在更新范围图框内以及与更新范围图框相交的图形要素从业务库中裁切掉；将待更新数据中在更新范围图框内以及与更新范围图框相交的图形要素写入临时库中；S3、临时库接边；其中S3中的接边步骤具体如下：S31、将业务库内的已有数据与更新范围图框相交的线要素j、面要素k写入临时库；S32、要素几何检查：线要素检查：求解出线要素j的相接线长度Lj，其中相接线的长度为已有数据中的线要素j与待更新数据中对应线要素j相接端点之间的长度，将长度Lj与预先设定的阈值进行比较，Lj满足阈值则线要素j满足几何条件；Lj不满足阈值则线要素j不满足几何条件；j+1，进行线要素j+1的检查，直至将所有线要素检查完毕；面要素检查：将面要素k与更新范围图框相交的线作为接边线，获取接边线的长度kj、角度ak；将待更新数据与已有数据中的接边线长度kj的比值与设定的阈值比较，将角度ak与设定的阈值比较，将接边线与已有数据中对应的接边线之间的距离与设定的阈值进行比较；三次比较均满足阈值要求，则面要素k满足几何条件；三次比较如未全部满足阈值要求，则面要素k未满足几何条件；k+1，进行面要素k+1的检查，直至将所有面要素检查完毕；S33、属性检查：将满足几何条件的已有数据与待更新数据中线要素j与面要素k，依据水平方向X、垂直方向Y和角度的属性进行字段编码；将已有数据中的线要素与待更新数据中对应的线要素进行逐个属性字段编码的比较，将已有数据中的面要素与待更新数据中对应的面要素进行逐个属性字段编码的比较；字段编码完全相同的线要素和面要素即满足属性条件，相同字段编码的线要素、面要素合并，反之则不做处理；S4、将临时库内接边后的待更新数据写入业务库中更新范围图框对应的位置，作为更新数据。2.根据权利要求1所述的一种空间规划业务库的更新方法，其特征在于：步骤S2中需要裁切掉的数据需先复制到备份库中，备份成功才可裁切，备份失败则重新进行将需要裁切掉的数据需复制到备份库的操作；若数据更新失败，则使用备份库内数据恢复业务库数据。3.根据权利要求2所述的一种空间规划业务库的更新方法，其特征在于：备份库中的图层命名与业务库一致。4.根据权利要求2所述的一种空间规划业务库的更新方法，其特征在于：还包括步骤S5，步骤S5为业务库接边，其具体为：对步骤S3中进行接边结果有效的线要素与面要素进行属性检查，将已有数据与更新数据中线要素j与面要素k，依据水平方向X、垂直方向Y和角度的属性进行字段编码；将已有数据中的线要素与更新数据中对应的线要素进行逐个属性字段编码的比较，将已有数据中的面要素与更新数据中对应的面要素进行逐个属性字段编码的比较；字段编码完全相同的要素为同一要素，保留属性，接边成功；反之则将更新数据删除，依据备份库中的数据进行复原。5.根据权利要求4所述的一种空间规划业务库的更新方法，其特征在于：对要素及其属性利用GIS中属性的自动挂接并入到临时库中的更新记录表，步骤S3结束后，根据临时库中的更新记录表自动进行更新后数据库中新要素的编号。6.根据权利要求4所述的一种空间规划业务库的更新方法，其特征在于：步骤S3中还包括S34，S34为过滤无效接边，其具体为：过滤面要素：将步骤S33中满足属性条件的面要素及其接边线加入到接边候选集中；随后任选一条接边线的角度和坐标，其中坐标依据接边线的角度确定，接边线为水平角度则取其Y方向坐标，接边线为垂直角度则取其X方向坐标；然后遍历接边候选集中其他接边线的角度和坐标，若其他接边线与当前接边线的角度一致，且对应的坐标距离差值满足预设的缓冲距离要求，则接边结果有效，反之则接边结果无效，将接边结果无效的面要素及接边线从接边候选集中删除；过滤线要素：将步骤S33中满足属性条件的线要素加入到接边候选集中；随后任选一条线要素的坐标，其中坐标依据与线要素相交的更新范围图框边沿的角度确定，水平角度则取线要素与更新范围图框相交端点的Y方向坐标，垂直角度则取线要素与更新范围图框相交端点的X方向坐标；然后遍历接边候选集中其他接边线的坐标，若对应的坐标距离差值满足预设的缓冲距离要求，则接边结果有效，反之则接边结果无效，将接边结果无效的线要素从接边候选集中删除。7.根据权利要求1所述的一种空间规划业务库的更新方法，其特征在于：根据更新后的业务库，将被更换掉的业务库数据写入历史库。8.根据权利要求1所述的一种空间规划业务库的更新方法，其特征在于：在更新结束后将更新要素的时间设置为业务库的最新时间。
说明书desc
技术领域本发明涉及数据处理领域，更具体的说，它涉及一种空间规划业务库的更新方法。背景技术对于一个具体的城市，随着自身的经济发展，其土地空间数据也会相应的发生变化。因此每次城市体检评估都需要对记录土地空间数据的业务库进行数据更新。现有技术，CN108427572A，公开了一种土地调查数据库更新方法及其更新增量包生成方法，具体步骤为：a、加载年初库，开始土地调查数据库更新工作；b、预先定义与所述年初库的要素层相对应的变更参考层；c、预先定义变更参考层要素绘制规则；d、根据土地更新材料，在所述步骤a中的变更参考层上设定需要发生变更的字段项，绘制变更参考要素；e、将所述步骤d中绘制完变更参考要素的变更参考层与所述步骤a中年初库对应的图层进行叠加分析和空间运算，生成更新过程层要素和更新结果层要素；f、对所述步骤e中所有更新过程层要素和更新结果层要素进行属性信息自动化处理；g、经步骤f处理后的更新过程层要素和更新结果层要素即为更新增量包；h、将所述步骤g中的更新增量包写入到所述年初库中，根据更新过程层要素的更新行为对所述年初库进行相应的修改，将所述更新结果层要素写入到所述年初库中，生成年末库。上述专利主要是基于变更参考层与年初数据相叠加的更新方法解决了业务库更新工作中无法对某变更操作进行回退问题，也解决全库叠加大数据量运算效率低下的问题。当某起变更操作需要回退时，只需修改对应的参考层数据重新执行变更过程即可，操作灵活易操作。由于变更参考数据的数据量相对整个业务库而言数据量很小，节省了大量计算资源和作业时间。但上述专利在业务库更新作业中仅仅是将区域空间数据直接更新至业务库中的对应位置，并未考虑新的空间数据与业务库内相邻图幅的空间数据的边缘衔接问题。新的空间数据与业务库内相邻图幅的空间数据的边缘衔接处的精度，将会直接影响城市体检评估中地理分析作业的准确度。基于上述原因，本发明旨在于提供一种空间规划业务库的更新方法，以提高新的空间数据与业务库内相邻图幅的空间数据的边缘衔接处的精度，进而提高城市体检评估中地理分析作业的准确度。发明内容为实现上述目的，本发明提供了如下技术方案：一种空间规划业务库的更新方法，包括如下步骤：S1、确定待更新范围图框；S2、将业务库中在更新范围图框内以及与更新范围图框相交的图形要素从业务库中裁切掉；将待更新数据中在更新范围图框内以及与更新范围图框相交的图形要素写入临时库中；S3、临时库接边；其中S3中的接边步骤具体如下：S31、将业务库内的已有数据与更新范围图框相交的线要素j、面要素k写入临时库；S32、要素几何检查：线要素检查：求解出线要素j的相接线长度Lj，其中相接线的长度为已有数据中的线要素j与待更新数据中对应线要素j相接端点之间的长度，将长度Lj与预先设定的阈值进行比较，Lj满足阈值则线要素j满足几何条件；Lj不满足阈值则线要素j不满足几何条件；j+1，进行线要素j+1的检查，直至将所有线要素检查完毕；面要素检查：将面要素k与更新范围图框相交的线作为接边线，获取接边线的长度kj、角度ak；将待更新数据与已有数据中的接边线长度kj的比值与设定的阈值比较，将角度ak与设定的阈值比较，将接边线与已有数据中对应的接边线之间的距离与设定的阈值进行比较；三次比较均满足阈值要求，则面要素k满足几何条件；三次比较如未全部满足阈值要求，则面要素k未满足几何条件；k+1，进行面要素k+1的检查，直至将所有面要素检查完毕；S33、属性检查：将满足几何条件的已有数据与待更新数据中线要素j与面要素k，依据水平方向X、垂直方向Y和角度的属性进行字段编码；将已有数据中的线要素与待更新数据中对应的线要素进行逐个属性字段编码的比较，将已有数据中的面要素与待更新数据中对应的面要素进行逐个属性字段编码的比较；字段编码完全相同的线要素和面要素即满足属性条件，相同字段编码的线要素、面要素合并，反之则不做处理；S4、将临时库内接边后的待更新数据写入业务库中更新范围图框对应的位置，作为更新数据。本发明进一步设置为：步骤S2中需要裁切掉的数据需先复制到备份库中，备份成功才可裁切，备份失败则重新进行将需要裁切掉的数据需复制到备份库的操作；若数据更新失败，则使用备份库内数据恢复业务库数据。本发明进一步设置为：备份库中的图层命名与业务库一致。本发明进一步设置为：还包括步骤S5，步骤S5为业务库接边，其具体为：对步骤S3中进行接边结果有效的线要素与面要素进行属性检查，将已有数据与更新数据中线要素j与面要素k，依据水平方向X、垂直方向Y和角度的属性进行字段编码；将已有数据中的线要素与更新数据中对应的线要素进行逐个属性字段编码的比较，将已有数据中的面要素与更新数据中对应的面要素进行逐个属性字段编码的比较；字段编码完全相同的要素为同一要素，保留属性，接边成功；反之则将更新数据删除，依据备份库中的数据进行复原。本发明进一步设置为：对要素及其属性利用GIS中属性的自动挂接并入到临时库中的更新记录表，步骤S3结束后，根据临时库中的更新记录表自动进行更新后数据库中新要素的编号。本发明进一步设置为：步骤S3中还包括S34，S34为过滤无效接边，其具体为：过滤面要素：将步骤S33中满足属性条件的面要素及其接边线加入到接边候选集中；随后任选一条接边线的角度和坐标，其中坐标依据接边线的角度确定，接边线为水平角度则取其Y方向坐标，接边线为垂直角度则取其X方向坐标；然后遍历接边候选集中其他接边线的角度和坐标，若其他接边线与当前接边线的角度一致，且对应的坐标距离差值满足预设的缓冲距离要求，则接边结果有效，反之则接边结果无效，将接边结果无效的面要素及接边线从接边候选集中删除；过滤线要素：将步骤S33中满足属性条件的线要素加入到接边候选集中；随后任选一条线要素的坐标，其中坐标依据与线要素相交的更新范围图框边沿的角度确定，水平角度则取线要素与更新范围图框相交端点的Y方向坐标，垂直角度则取线要素与更新范围图框相交端点的X方向坐标；然后遍历接边候选集中其他接边线的坐标，若对应的坐标距离差值满足预设的缓冲距离要求，则接边结果有效，反之则接边结果无效，将接边结果无效的线要素从接边候选集中删除。本发明进一步设置为：根据更新后的业务库，将被更换掉的业务库数据写入历史库。本发明进一步设置为：在更新结束后将更新要素的时间设置为业务库的最新时间。综上所述，本发明相比于现有技术具有以下有益效果：本发明采用区域更新，同时对需要接边的线要素和面要素进行几何检查和属性检查，通过要素的几何位置关系以及属性字段编码两个方面进行接边的判断，提高了新的空间数据与业务库内相邻图幅的空间数据的边缘衔接处的精度，保证了业务库更新的准确度，有助于提高城市体检评估中地理分析作业的准确度。本发明在接边要素有多幅图纸时会自动赋值唯一标识码，在对标准分幅数据进行检查或者转换入库操作时，可保证所有跨图幅接边要素其编号的一致，从而数据库内外接边和入库过程中可实现对于分幅、分区数据自动进行线面接边处理及在更新的过程中实现自动线面接边。附图说明图1为实施例中步骤S1的流程图；图2为实施例中步骤S2的流程图；图3为实施例步骤S3中提取出已有数据中的接边线和面要素的流程图；图4为实施例步骤S3中更新编号的流程图。具体实施方式下面将对本发明的技术方案进行清楚的描述，显然，所描述的实施例并不是本发明的全部实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于发明的保护范围。实施例如图1-4所示，为本发明较佳实施例，一种空间规划业务库的更新方法，包括如下步骤：S1、确定待更新范围图框。S2、将业务库中在更新范围图框内以及与更新范围图框相交的图形要素从业务库中裁切掉，以保证业务库内数据的唯一性。将待更新数据中在更新范围图框内以及与更新范围图框相交的图形要素写入临时库中。需要裁切掉的数据需先复制到备份库中，备份成功才可裁切，备份失败则重新进行将需要裁切掉的数据需复制到备份库的操作，以保证业务库内数据的健壮性，避免在更新或写入过程中因意外情况造成的系统故障或数据丢失时可以进行还原恢复。若数据更新失败，则使用备份库内数据恢复业务库数据。其中备份库中的图层命名与业务库一致。根据更新后的业务库，将被更换掉的业务库数据写入历史库，要把各个操作留痕，方便日后归档工作中将历史库与业务库做对比。S3、临时库接边，S3中的接边步骤具体如下：S31、将业务库内的已有数据与更新范围图框相交的线要素j、面要素k写入临时库。S32、要素几何检查：线要素检查：求解出线要素j的相接线长度Lj，其中相接线的长度为已有数据中的线要素j与待更新数据中对应线要素j相接端点之间的长度，将长度Lj与预先设定的阈值进行比较，Lj满足阈值则线要素j满足几何条件；Lj不满足阈值则线要素j不满足几何条件；j+1，进行线要素j+1的检查，直至将所有线要素检查完毕。面要素检查：将面要素k与更新范围图框相交的线作为接边线，获取接边线的长度kj、角度ak；将待更新数据与已有数据中的接边线长度kj的比值与设定的阈值比较，将角度ak与设定的阈值比较，将接边线与已有数据中对应的接边线之间的距离与设定的阈值进行比较；三次比较均满足阈值要求，则面要素k满足几何条件；三次比较如未全部满足阈值要求，则面要素k未满足几何条件；k+1，进行面要素k+1的检查，直至将所有面要素检查完毕。S33、属性检查：将满足几何条件的已有数据与待更新数据中线要素j与面要素k，依据水平方向X、垂直方向Y和角度的属性进行字段编码；将已有数据中的线要素与待更新数据中对应的线要素进行逐个属性字段编码的比较，将已有数据中的面要素与待更新数据中对应的面要素进行逐个属性字段编码的比较；字段编码完全相同的线要素和面要素即满足属性条件，相同字段编码的线要素、面要素合并，反之则不做处理。S34、过滤无效接边：过滤面要素：将步骤S33中满足属性条件的面要素及其接边线加入到接边候选集中；随后任选一条接边线的角度和坐标，其中坐标依据接边线的角度确定，接边线为水平角度则取其Y方向坐标，接边线为垂直角度则取其X方向坐标；然后遍历接边候选集中其他接边线的角度和坐标，若其他接边线与当前接边线的角度一致，且对应的坐标距离差值满足预设的缓冲距离要求，则接边结果有效，反之则接边结果无效，将接边结果无效的面要素及接边线从接边候选集中删除。过滤线要素：将步骤S33中满足属性条件的线要素加入到接边候选集中；随后任选一条线要素的坐标，其中坐标依据与线要素相交的更新范围图框边沿的角度确定，水平角度则取线要素与更新范围图框相交端点的Y方向坐标，垂直角度则取线要素与更新范围图框相交端点的X方向坐标；然后遍历接边候选集中其他接边线的坐标，若对应的坐标距离差值满足预设的缓冲距离要求，则接边结果有效，反之则接边结果无效，将接边结果无效的线要素从接边候选集中删除。S4、将临时库内接边后的待更新数据写入业务库中更新范围图框对应的位置，作为更新数据。S5、业务库接边：对步骤S3中进行接边结果有效的线要素与面要素进行属性检查，将已有数据与更新数据中线要素j与面要素k，依据水平方向X、垂直方向Y和角度的属性进行字段编码；将已有数据中的线要素与更新数据中对应的线要素进行逐个属性字段编码的比较，将已有数据中的面要素与更新数据中对应的面要素进行逐个属性字段编码的比较；字段编码完全相同的要素为同一要素，保留属性，接边成功；反之则将更新数据删除，依据备份库中的数据进行复原。具体的，对要素及其属性利用GIS中属性的自动挂接并入到临时库中的更新记录表，步骤S3结束后，根据临时库中的更新记录表自动进行更新后数据库中新要素的编号。具体的，在更新结束后将更新要素的时间设置为业务库的最新时间，要把各个操作的历史节点留痕，方便日后归档工作中将历史库与业务库做对比。将更新要素的时间设置为业务库的最新时间的操作通过GX时间触发器实现。具体的，本实施例步骤S2中的备份操作通过BF触发器控制，BF触发器判断业务库中的数据是否属于更新范围图框内以及与更新范围图框相交的图形要素，如果是，则BF触发器启动控制进行数据备份，如果不是则不进行备份动作。具体的，本实施例S2中裁切出的业务库数据通过TtoH触发器根据最后的更新结果进行判断，由TtoH触发器判断并控制S2中裁切出的业务库数据进入业务库或历史库。综上所述，本实施例相比于现有技术具有以下有益效果：本实施例采用区域更新，同时对需要接边的线要素和面要素进行几何检查和属性检查，通过要素的几何位置关系以及属性字段编码两个方面进行接边的判断，提高了新的空间数据与业务库内相邻图幅的空间数据的边缘衔接处的精度，保证了业务库更新的准确度，有助于提高城市体检评估中地理分析作业的准确度。本实施例在接边要素有多幅图纸时会自动赋值唯一标识码，在对标准分幅数据进行检查或者转换入库操作时，可保证所有跨图幅接边要素其编号的一致，从而数据库内外接边和入库过程中可实现对于分幅、分区数据自动进行线面接边处理及在更新的过程中实现自动线面接边。以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、同替换、改进，均应包含在本发明的保护范围之内。
