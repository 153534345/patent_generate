标题title
数据库容灾方法、设备、系统及存储介质
摘要abst
本申请实施例提供一种数据库容灾方法、设备、系统及存储介质。在本申请实施例中，主节点和备节点分别对注册为存储协议中的持有者和注册者。这样，备节点可在主节点异常时，基于云盘支持的存储协议，抢占云盘的写权限，并切换为主节点，实现了基于云盘支持的数据库的容灾处理。由于存储协议为云盘支持的标准协议，因此，本实施例提供的数据库的容灾方式基于云盘支持的标准存储协议，不仅可实现对数据库的容灾处理，可保证基于云盘的数据库的高可用性；而且，无需为基于云盘的数据库额外开发或定制其它协议的容灾方案，可提高基于云盘的数据库的容灾处理方案的通用性。
权利要求书clms
1.一种数据库容灾方法，数据库系统包括：计算节点和被配置为目标模式的云盘；所述云盘支持的存储协议中的持有者对所述目标模式的云盘具有读写权限；所述存储协议中的注册者对所述目标模式的云盘具有只读权限；所述计算节点包括：被注册为所述持有者的主节点及被注册为所述注册者的备节点，所述方法包括：所述备节点检测所述云盘存储的心跳文件中的租约信息的有效性；所述主节点通过修改所述租约信息维持主节点状态；在检测到所述租约信息失效的情况下，所述备节点基于所述存储协议，抢占所述云盘的写权限，以将所述备节点注册为新的持有者；将所述备节点的节点状态切换为主节点状态。2.根据权利要求1所述的方法，所述存储协议为非易失性内存主机控制器接口规范NVMe协议，所述NVMe协议包括持久保留PR协议；所述备节点基于所述存储协议，抢占所述云盘的写权限，以将所述备节点注册为新的持有者，包括：所述备节点调用所述PR协议提供的优先抢占接口；通过所述优先抢占接口，抢占所述云盘的写权限，以将所述备节点注册为所述PR协议中的持有者。3.根据权利要求1所述的方法，在所述备节点检测所述云盘存储的心跳文件中的租约信息的有效性之前，所述方法还包括：所述主节点基于所述存储协议，抢占所述云盘的写权限，以将所述主节点注册为所述存储协议中的持有者；通过更新所述心跳文件的租约信息维持主节点状态。4.根据权利要求3所述的方法，所述存储协议为NVMe协议，所述NVMe协议包括PR协议；在所述主节点基于所述存储协议，抢占所述云盘的写权限之前，所述方法还包括：所述计算节点调用所述PR协议的注册接口，将所述计算节点注册为所述PR协议中的注册者；确定所述计算节点的节点状态；若所述计算节点的节点状态为主节点，执行所述主节点基于所述存储协议，抢占所述云盘的写权限的步骤，以将所述主节点注册为所述存储协议中的持有者。5.根据权利要求4所述的方法，所述备节点为多个；所述方法还包括：所述主节点从多个备节点中，确定继承节点；将所述继承节点的标识写入所述心跳文件；所述备节点在检测到所述心跳文件记录的租约信息失效的情况下，判断所述心跳文件记录的继承节点的标识是否为所述备节点的标识；若是，执行所述备节点基于所述存储协议，抢占所述云盘的写权限，以将所述备节点注册为新的持有者的步骤。6.根据权利要求5所述的方法，所述确定所述计算节点的节点状态，包括：若所述云盘中不存在心跳文件或者所述心跳文件记录的云盘的标识与所述计算节点维护的云盘的标识不同，确定所述计算节点的节点状态为主节点；若所述云盘存在心跳文件、所述心跳文件记录的云盘的标识与所述计算节点维护的云盘的标识相同，以及所述计算节点不是继承节点，确定所述计算节点的节点状态为备节点；若所述云盘存在心跳文件、所述心跳文件记录的云盘的标识与所述计算节点维护的云盘的标识相同、所述计算节点是继承节点且所述心跳文件中的租约信息失效，确定所述计算节点的节点状态为主节点；若所述云盘存在心跳文件、所述心跳文件记录的云盘的标识与所述计算节点维护的云盘的标识相同、所述计算节点是继承节点且所述心跳文件中的租约信息处于有效期，确定所述计算节点的节点状态为备节点。7.根据权利要求5所述的方法，所述主节点从多个备节点中，确定继承节点，包括：从所述多个备节点中，随机选择一个备节点，作为所述继承节点；或者，获取所述多个备节点的优先级；根据所述多个备节点的优先级，选择优先级最高的备节点，作为所述继承节点。8.根据权利要求7所述的方法，所述获取多个备节点的优先级，包括：获取所述多个备节点的性能参数信息；根据所述多个备节点的性能参数信息，确定所述多个备节点的优先级；性能参数信息反映的性能越好的备节点的优先级越高；或者，获取通过优先级设置接口指定的所述多个备节点的优先级。9.根据权利要求5所述的方法，所述心跳文件包括：任期信息和持有者的地址信息；所述方法还包括：所述继承节点在抢占所述云盘的写权限之后，更新所述心跳文件记录的任期信息；并将所述持有者的地址信息修改为所述继承节点的地址信息；所述备节点监测所述心跳文件中的任期信息；并在监测到所述心跳文件中的任期信息发生变化的情况下，从所述心跳文件中获取持有者的第一地址信息；在所述第一地址信息与所述备节点维护的持有者的第二地址信息不同的情况下，基于所述第一地址信息，建立与所述第一地址信息对应的主节点之间的连接。10.根据权利要求5所述的方法，还包括：所述主节点响应于设定的关机指令，将所述心跳文件记录的继承节点的标识修改为所述主节点的标识，以使所述主节点在响应所述关机指令进行重启的过程中保持主节点状态。11.根据权利要求5-10任一项所述的方法，还包括：所述备节点在检测到所述心跳文件记录的租约信息失效，且所述继承节点异常的情况下，休眠随机时长；在休眠随机时长之后，基于所述存储协议，抢占所述云盘的写权限。12.根据权利要求11所述的方法，还包括：所述备节点在检测到所述心跳文件中的租约信息失效的情况下，监测所述心跳文件中的租约信息是否更新；若所述心跳文件中的租约信息超过设定时长未更新，确定所述继承节点异常。13.根据权利要求1-10任一项所述的方法，所述备节点检测所述心跳文件的租约信息的有效性，包括：所述备节点按照设定的数据读取周期，周期性地读取所述心跳文件记录的租约信息；若所述心跳文件记录的租约信息的时间戳早于当前时间，确定所述心跳文件中的租约信息失效；所述数据读取周期小于所述心跳文件中的租约信息的有效时长。14.一种数据库系统，包括：多个计算节点和云盘；所述多个计算节点共享所述云盘；所述云盘被配置为目标模式，且存储有心跳文件；其中，所述存储协议中的持有者对所述目标模式的云盘具有读写权限；所述存储协议中的注册者对所述目标模式的云盘具有只读权限；所述计算设备用于执行权利要求1-13任一项所述方法中的步骤。15.一种计算设备，所述计算设备实现为数据库系统中的计算节点；所述数据库系统还包括：被配置为目标模式的云盘；所述云盘支持的存储协议中的持有者对所述目标模式的云盘具有读写权限；所述存储协议中的注册者对所述目标模式的云盘具有只读权限；所述计算设备包括：存储器和处理器；其中，所述存储器，用于存储计算机程序；所述处理器耦合至所述存储器，用于执行所述计算机程序以用于执行权利要求1-13任一项所述方法中的步骤。16.一种存储有计算机指令的计算机可读存储介质，当所述计算机指令被一个或多个处理器执行时，致使所述一个或多个处理器执行权利要求1-13任一项所述方法中的步骤。
说明书desc
技术领域本申请涉及数据存储技术领域，尤其涉及一种数据库容灾方法、设备、系统及存储介质。背景技术云原生数据库大多是存储和计算分离的架构，由计算节点和共享的分布式存储系统组成。其中计算节点包括一个主节点和多个只读节点，所有计算节点共享同一份存储，支持一写多读，即主节点对分布式存储系统具有读写权限，只读节点对分布式存储系统具有只读权限。这类方案具有弹性存储、高性能及海量存储等优势，但是由于云原生数据库依赖定制化的分布式存储系统，使得云原生数据库价格高且交付难。为了克服这两个缺陷，在一些方案中采用支持多重挂载的云盘代替分布式存储系统，云盘作为公有云标准产品，在费用和交付难度上都可以节约成本。如何基于云盘达到和原有数据库一致的高可用能力，成为本领域亟待解决的技术问题。发明内容本申请的多个方面提供一种数据库容灾方法、设备、系统及存储介质，用以实现基于云盘的数据库系统的容灾处理，有助于保证数据库的高可用性。本申请实施例提供一种数据库容灾方法，数据库系统包括：计算节点和被配置为目标模式的云盘；所述云盘支持的存储协议中的持有者对所述目标模式的云盘具有读写权限；所述存储协议中的注册者对所述目标模式的云盘具有只读权限；所述计算节点包括：被注册为所述持有者的主节点及被注册为所述注册者的备节点，所述方法包括：所述备节点检测所述云盘存储的心跳文件中的租约信息的有效性；所述数据库系统中的主节点通过修改所述租约信息维持主节点状态；在检测到所述租约信息失效的情况下，所述备节点基于所述存储协议，抢占所述云盘的写权限，以将所述备节点注册为新的持有者；将所述备节点的节点状态切换为主节点状态。本申请实施例还提供一种数据库系统，包括：多个计算节点和云盘；所述多个计算节点共享所述云盘；所述云盘被配置为目标模式，且存储有心跳文件；其中，所述存储协议中的持有者对所述目标模式的云盘具有读写权限；所述存储协议中的注册者对所述目标模式的云盘具有只读权限；所述计算设备用于执行上述数据库容灾方法中的步骤。本申请实施例还提供一种计算设备，所述计算设备实现为数据库系统中的计算节点；所述数据库系统还包括：被配置为目标模式的云盘；所述云盘支持的存储协议中的持有者对所述目标模式的云盘具有读写权限；所述存储协议中的注册者对所述目标模式的云盘具有只读权限；所述计算设备包括：存储器和处理器；其中，所述存储器，用于存储计算机程序；所述处理器耦合至所述存储器，用于执行所述计算机程序以用于执行上述数据库容灾方法中的步骤。本申请实施例还提供一种存储有计算机指令的计算机可读存储介质，当所述计算机指令被一个或多个处理器执行时，致使所述一个或多个处理器执行上述数据库容灾方法中的步骤。在本申请实施例中，主节点和备节点分别对注册为存储协议中的持有者和注册者。这样，备节点可在主节点异常时，基于云盘支持的存储协议，抢占云盘的写权限，并切换为主节点，实现了基于云盘支持的数据库的容灾处理。由于存储协议为云盘支持的标准协议，因此，本实施例提供的数据库的容灾方式基于云盘支持的标准存储协议，不仅可实现对数据库的容灾处理，可保证基于云盘的数据库的高可用性；而且，无需为基于云盘的数据库额外开发或定制其它协议的容灾方案，可提高基于云盘的数据库的容灾处理方案的通用性。附图说明此处所说明的附图用来提供对本申请的进一步理解，构成本申请的一部分，本申请的示意性实施例及其说明用于解释本申请，并不构成对本申请的不当限定。在附图中：图1为本申请实施例提供的数据库系统的结构示意图；图2和图3为本申请实施例提供的数据库容灾方法的流程示意图；图4为本申请实施例提供的计算节点的节点状态的确定过程示意图；图5为本申请实施例提供的计算节点的启动过程示意图；图6为本申请实施例提供的另一数据库容灾方法的流程示意图；图7为本申请实施例提供的计算设备的结构示意图。具体实施方式为使本申请的目的、技术方案和优点更加清楚，下面将结合本申请具体实施例及相应的附图对本申请技术方案进行清楚、完整地描述。显然，所描述的实施例仅是本申请一部分实施例，而不是全部的实施例。基于本申请中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本申请保护的范围。为了保证基于云盘的数据库的高可用性，在本申请一些实施例中，主节点和备节点分别对注册为存储协议中的持有者和注册者。这样，备节点可在主节点异常时，基于云盘支持的存储协议，抢占云盘的写权限，并切换为主节点，实现了基于云盘支持的数据库的容灾处理。由于存储协议为云盘支持的标准协议，因此，本实施例提供的数据库的容灾方式基于云盘支持的标准存储协议，不仅可实现对数据库的容灾处理，可保证基于云盘的数据库的高可用性；而且，无需为基于云盘的数据库额外开发或定制其它协议的容灾方案，可提高基于云盘的数据库的容灾处理方案的通用性。以下结合附图，详细说明本申请各实施例提供的技术方案。应注意到：相同的标号在下面的附图以及实施例中表示同一物体，因此，一旦某一物体在一个附图或实施例中被定义，则在随后的附图和实施例中不需要对其进行进一步讨论。图1为本申请实施例提供的数据库系统的结构示意图。如图1所示，该数据库系统包括：计算节点10和云盘20。在本实施例中，计算节点10的数量可为1个或多个。多个是指2个或2个以上。一个计算节点10可挂载至少一个云盘20，一个云盘20可供一个或多个计算节点10使用。图1中仅以计算节点10为多个，云盘20为1个进行图示，但不构成限定。在本实施例中，数据库系统为计算和存储分离的系统。计算节点10是执行数据库系统所需的计算操作的电子设备。数据库系统所需的计算操作包括但不局限于：查询操作及数据定义语言操作等。计算节点10以为单一服务器设备，也可以云化的服务器阵列，或者为云化的服务器阵列中运行的虚拟机，或者为云服务器。另外，计算节点10也可以指具备相应服务能力的其他计算设备，例如电脑等终端设备等。云盘20为云厂商为云服务器提供的数据块级别的块存储设备，用于实现数据库的存储功能，存储数据库的数据。云盘20可实现为多个磁盘构成的存储集群。在本实施例中，云盘20可支持多重挂载功能。多重挂载是指将一块云盘20可挂载到多个计算节点10上，使得多个计算节点10可对同一云盘20进行并发读写访问，即多个计算节点10共享云盘20。支持多重挂载的云盘，也可称为共享盘。在本实施例中，对于共享云盘20的多个计算节点10，可位于同一可用区。可用区是指在同一区域内，电力和网络互相独立的物理区域。不同可用区之间电力和网络相互隔离。由于多个计算节点10共享云盘20，多个计算节点10可对云盘20进行并发读写访问，这就可能导致数据库系统出现脑裂，损坏数据库的数据的一致性。为了降低数据库产生脑裂的概率，多个计算节点10可通过选主，确定出主节点101和备节点102。主节点对云盘20具有读写权限，备节点对云盘20具有只读权限。在实际应用中，主节点101可能会发生异常，导致主节点处于不可服务的状态，这就需要数据库具有一定的容灾能力，来保障数据库的高可用能力。数据库的高可用能力一般包括主节点异常探测、选主、主节点切换等3个部分。其中，主节点异常探测是指当主节点异常时，能够尽可能快的检测出主节点处于不可服务的状态，并触发容灾行为；选主是指在数据库容灾且备节点为多个的场景下，需要从多个备节点中，选出唯一的备节点升级为主节点，该决策需要在所有计算节点中达成一致。主节点切换是指将备节点的节点状态切换为主节点。其中，主节点切换的关键是保证数据库系统不出现“脑裂”。这就需要对原主节点进行输入输出防护之后，新的主节点才能开始提供服务，从而实现数据库的容灾。其中，IO防护是指对于一写多读模式的共享存储的系统来说，同一时刻只允许一个节点进行写入。在容灾切换的场景下，只有保证原主节点停止写入后，新的主节点才能允许提供服务，否则会因为“脑裂”导致数据损坏。在存储层面禁止原主节点写入的行为就称为IO防护。在本实施例中，为了对基于云盘的数据库实现容灾处理，在云盘20中设置心跳文件。心跳文件可用于对主节点进行心跳检测，以确定主节点101是否出现异常。具体地，该心跳文件可包括：租约信息。结合图1、图2和图3，主节点101可通过更新心跳文件的租约信息，维持主节点状态。即主节点101通过更新心跳文件的租约信息，实现主节点状态续约。主节点101可按照设定的续租周期，周期性地更新心跳文件中的租约信息。备节点102可通过检测心跳文件中租约信息的有效性，判断主节点101是否异常。其中，备节点102检测到心跳文件中的租约信息失效，确定主节点101异常。在一些实施例中，租约信息可为时间戳信息。时间戳信息为租约到期对应的时刻。例如，时间戳信息为2023年3月16日9点38分，则租约到期时间就是2023年3月16日9点38分。主节点101可通过更新心跳文件中的租约信息，维持主节点状态。具体地，主节点101可按照设定的租约更新周期，在心跳文件记录的租约信息的时间戳到达之前更新心跳文件中的租约信息。例如，可在心跳文件记录的租约信息的时间戳到达之前将心跳文件记录的租约信息的时间戳，更新为：在更新租约信息时的时间基础上加上有效时长。例如，若租约的有效时长为5分钟，心跳文件记录的租约信息的时间戳为2023年3月16日9点00分，则主节点101可在2023年3月16日9点00分到达之前，将心跳文件记录的租约信息的时间戳更新为：在更新租约信息时的时间基础上加上有效时长，如上述2023年3月16日8点59分将心跳文件记录的租约信息更新为2023年3月16日9点04分。上述实施例仅以租约更新周期和租约的有效时长为分钟级别为例进行示例性说明，在实际使用过程中，租约更新周期和租约的有效时长可为秒量级的。相应地，备节点102可按照设定的数据读取周期，周期性地读取心跳文件中的租约信息；若租约信息的时间戳早于当前时间，确定心跳文件中的租约信息失效。其中，数据读取周期小于心跳文件中的租约信息的有效时长。云盘20支持对应的存储协议标准。例如，云盘20可支持非易失性内存主机控制器接口规范协议、高级主机控制器接口协议或小型计算机接口协议。存储协议定义了云盘和客户端权限。存储协议中一般有不同的角色类型。不同角色对云盘的访问权限不同。存储协议中的角色一般具有持有者、注册者及Non-Registrant等不同的角色。其中，持有者具有云盘的所有操作权限，注册者具有云盘的部分操作权限，访客只具有云盘的读权限。多重挂载云盘具有不同的模式，存储协议中的不同角色对不同模式的云盘的访问权限不同。对于处于目标模式的云盘，存储协议中的持有者对云盘具有读写权限，注册者或访客具有只读权限。例如，对于存储协议中的持久保留协议，多重挂载云盘为写独占模式时，PR协议中的持有者对云盘具有读写权限，注册者或访客具有只读权限。相应地，在PR协议中，目标模式为写独占模式。由于云盘处于目标模式下，存储协议中的持有者对云盘具有读写权限，与主节点的功能相同；注册者具有只读权限，与备节点的功能相同。因此，在本申请实施例中，可基于云盘支持的存储协议对计算节点10进行云盘的IO权限管理。具体地，云盘20在挂载于计算节点10时，可配置云盘20的模式为目标模式。这样，存储协议中的持有者对云盘具有读写权限，注册者或访客具有只读权限。该配置过程可由数据库的运维人员预先设置。当然，也可由计算节点10中的主节点在抢主成功的过程中，通过存储协议的接口将云盘20的模式配置为目标模式。在本实施例中，云盘被配置为目标模式。计算节点10可在启动过程中，确定该计算节点10的节点状态。在本申请实施例中，不限定计算节点10确定自身的节点状态的具体实施方式。在一些实施例中，计算节点10可检测云盘20中是否存在心跳文件；若云盘20不存在心跳文件，说明该数据库系统为新的实例，尚未有主节点，则可确定自己的节点状态为主节点。若云盘中存在心跳文件，且心跳文件记录的云盘的标识与该计算节点10维护的云盘的标识不同，说明该数据库系统为云盘恢复的实例，即计算节点10挂载的云盘为新的云盘快照，则可确定计算节点10的节点状态为主节点。即云盘20中不存在心跳文件或者心跳文件记录的云盘的标识与该计算节点10维护的云盘的标识不同，确定该计算节点10为主节点。在一些实施例中，若云盘中存在心跳文件，且心跳文件记录的云盘的标识信息与该计算节点维护的云盘的标识相同，确定计算节点10的状态为备节点。在另一些实施例中，为了防止主节点异常时，备节点并发选主时产生乒乓式的活锁，提出唯一继承节点机制。其中，Ping Pong式的活锁是指主节点异常时，多个备节点并发选主时，某个备节点在更新心跳文件的租约信息成功之后，还未来得及将其地址信息写入心跳文件，心跳文件的租约信息已被其它备节点更新，造成活锁的现象。为了降低主节点异常时，备节点并发选主时产生Ping Pong式的活锁的概率，主节点101可从备节点中，指定继承节点，用于在主节点异常时，接替主节点对云盘进行写访问。关于主节点101指定继承节点的具体实施方式，将在下文实施例中进行描述，在此暂不赘述。基于，主节点101指定有继承节点的实施例，则还可结合继承节点的信息，确定计算节点的节点状态。继承节点的信息可为继承节点的标识，该主节点101可将继承节点的标识写入心跳文件中。相应地，若云盘中存在心跳文件、心跳文件记录的云盘的标识信息与该计算节点维护的云盘的标识相同，且该计算节点10不是继承节点，则确定计算节点10的节点状态为备节点。继承节点是指主节点指定的用于在主节点异常时，接替主节点对云盘进行写访问的备节点。关于继承节点，将在下文实施例中进行详细说明，在此不再赘述。进一步，若云盘中存在心跳文件、心跳文件记录的云盘的标识信息与该计算节点维护的云盘的标识相同、该计算节点10是继承节点且心跳文件记录的租约信息失效，确定该计算节点10的节点状态为主节点。相应地，若云盘中存在心跳文件、心跳文件记录的云盘的标识信息与该计算节点维护的云盘的标识相同、该计算节点10是继承节点且心跳文件记录的租约信息处于有效期，确定该计算节点10的节点状态为备节点。在本实施例中，不限定上述确定节点状态的步骤的具体执行顺序。在一些实施例中，可采用图4示出的节点状态检测方式，确定计算节点的节点状态。如图4所示，计算节点的节点状态检测方法主要包括：S1、检测心跳文件是否存在。若存在执行步骤S2；若不存在，执行步骤S6。S2、检测心跳文件记录的云盘的标识D1与该计算节点维护的云盘的标识D2是否相同。若相同，执行步骤S6；若不同，执行步骤S3。S3、从心跳文件中读取继承节点的标识H1。S4、判断心跳文件记录的继承节点的标识H1与该计算节点维护的继承节点的标识H2是否相同；若相同，执行步骤S5；若不同，执行步骤S7。S5、检测心跳文件记录的租约信息是否处于有效期；若是，执行步骤S6；若否，执行步骤S7。S6、确定计算节点的节点状态为主节点。S7、确定计算节点的节点状态为备节点。上述实施例示出的计算节点的节点状态的确定方式仅为示例性说明，但不构成限定。进一步，若该计算节点10的节点状态为主节点，则确定主节点为存储协议中的持有者，可将计算节点10注册为存储协议中的持有者。若该计算节点10的节点状态为备节点，则备节点为存储协议中的注册者，可将计算节点10注册为存储协议中的注册者。这样，计算节点10可基于云盘支持的存储协议，对基于云盘的数据库进行容灾处理。这部分内容将在下文实施例中进行描述，在此暂不赘述。主节点101可基于云盘支持的存储协议，抢占云盘的写权限，抢占云盘20的写权限，从而将主节点101注册为存储协议中的持有者。具体地，对于存储协议为NVMe协议的实施例，主节点101可调用NVMe协议中的PR协议提供的优先抢占接口，并通过优先抢占接口，获取云盘的写权限，从而将主节点101注册为PR协议中的持有者。可选地，计算节点10可调用PR协议的注册接口，将计算节点10注册为PR协议中的注册者。进一步，计算节点10可确定其节点状态。关于确定计算节点的节点状态的具体实施方式，可参见上述实施例的相关内容，在此不再赘述。其中，图2和图3中的“启动流程”可实现为图5。图5中的步骤S11和步骤S12对应上述计算节点确定其节点状态的相关内容，如步骤S11和步骤12可实现为上述图4。其中，步骤S11中读取心跳文件记录的信息可包括：心跳文件记录的云盘的标识、心跳文件记录的继承节点的标识及心跳文件记录的租约信息等。进一步，若计算节点的节点状态为主节点，则确定该计算节点为存储协议中的持有者，相应地，如图5步骤S13所示，被注册为持有者的主节点，可调用NVMe协议中的PR协议提供的优先抢占接口，并通过优先抢占接口，抢占云盘的写权限，以将该计算节点的角色类型从注册者修改为持有者。如图5步骤S14和步骤S15所示，对于被注册为持有者的主节点，还可更新心跳文件，成为数据库系统的主节点。在图5中更新心跳文件包括但不局限于：更新心跳文件中的租约信息及更新心跳文件记录的持有者的地址信息等。相应地，若计算节点的节点状态为备节点，则继续保持该计算节点为注册者。当然，被注册为持有者的主节点还可通过优先抢占接口，将云盘配置为目标模式。结合图1、图2和图3，对于数据库系统的主节点101可通过更新心跳文件的租约信息，维持主节点状态。即主节点101通过更新心跳文件的租约信息，实现主节点状态续约。备节点102可通过检测心跳文件中租约信息的有效性，判断主节点101是否异常。关于备节点102检测心跳文件记录的租约信息的有效性的具体实施方式，可参见上述实施例的相关内容。对于备节点102来说，可在检测到心跳文件记录的租约信息失效的情况下，基于存储协议抢占云盘的写权限，以将该备节点注册为新的持有者。关于继承节点基于存储协议抢占云盘的写权限的具体实施方式，可参见上述主节点101基于存储协议抢占云盘的写权限的相关内容，在此不再赘述。进一步，备节点可将其节点状态切换为主节点状态，即备节点成为新的主节点，负责对云盘20的读写。其它备节点，继续保持为存储协议中的注册者，对云盘20具有只读权限。对于新的主节点，可更新心跳文件记录的信息。例如，新的主节点可更新心跳文件的租约信息，将心跳文件记录的持有者的地址信息更新为新的主节点的地址信息等等。在本实施例中，主节点和备节点分别注册为存储协议中的持有者和注册者。这样，备节点可在主节点的租约失效时，基于云盘支持的存储协议，抢占云盘的写权限，并切换为主节点，实现了基于云盘支持的数据库的容灾处理。由于存储协议为云盘支持的标准协议，因此，本实施例提供的数据库的容灾方式基于云盘支持的标准存储协议，实现对数据库的容灾处理，无需为基于云盘的数据库额外开发或定制其它协议的容灾方案，可提高基于云盘的数据库的容灾处理方案的通用性。此外，由于备节点在主节点的租约失效时，抢占了对云盘的写权限，注册为了新的持有者，使得原主节点失去了云盘的写权限。即便原主节点重新启动，也会因为丢失云盘的写权限，而无法向云盘写入数据，从而实现了对原主节点的IO防护，可降低数据库脑裂的概率。在本申请实施例中，为了降低主节点异常时，备节点并发选主时产生乒乓式的活锁的概率，主节点101可从被注册为存储协议中的注册者的备节点中，确定继承节点。在本申请实施例中，不限定主节点101从备节点中，确定继承节点的具体实施方式。在一些实施例中，主节点101可从多个备节点102中，随机选择一个备节点，作为继承节点。在另一些实施例中，主节点101可基于优先级机制，从多个备节点102中，选择一个备节点作为继承节点。具体地，主节点101可获取多个备节点的优先级；并根据多个备节点的优先级，选择优先级最高的备节点，作为继承节点。可选地，主节点101可获取多个备节点102的性能参数信息。备节点的性能参数是指反映备节点的性能优劣的参数，可包括：备节点的回放延迟、网络延迟及备节点的资源规格等信息。备节点的回放延迟是指主节点持有了对云盘的访问操作，至在备机回放该条记录的延迟时间。备节点的资源规格用于反映备节点的资源大小。备节点的资源主要包括但不局限于：计算资源的核数等）及内存资源等。具体地，结合图5，计算节点被确定为备节点之后，可注册为存储协议的注册者。进一步，如图5步骤S17和S18所示，确定为备节点的计算节点，被注册为注册者，可向心跳文件记录的持有者，注册该注册者的信息，该计算节点成为数据库系统的备节点。具体地，确定为备节点的计算节点从心跳文件中读取持有者的地址信息，并基于持有者的地址信息，向持有者注册自己的信息。在该实施例中，确定为备节点的计算节点可基于持有者的地址信息，将该备节点的性能参数信息发送给持有者对应的主节点。主节点可接收备节点发送的性能参数信息。主节点101可根据多个备节点102的性能参数信息，确定多个备节点102的优先级。其中，性能参数信息反映的性能越好的备节点的优先级越高。例如，对于备节点的回放延迟和网络延迟来说，延迟时间越小，备节点的性能越好。对于备节点的资源规格来说，资源规格越大，备节点的性能越好。可选地，主节点101可根据预先设定的多种性能参数信息各自的权重及备节点102的性能参数信息，计算备节点102的优先级得分；根据多个备节点102的优先级得分，确定备节点102的优先级。其中，优先级得分越高的备节点，其优先级越高。或者，在另一些实施例中，计算节点10可提供优先级设置接口。用户可通过优先级设置接口指定多个备节点102的优先级。可选地，计算节点10可在确定自己为主节点时，向用户的终端设备发送提示信息，用于提示用户自主设置备节点优先级。用户可通过终端设备调用优先级设置接口，并通过该优先级设置接口配置多个备节点的优先级。可选地，优先级设置接口可为结构化查询语言接口。相应地，用户可通过SQL调用该接口，并通过SQL配置备节点的优先级。作为主节点的计算节点10可获取通过优先级设置接口指定的多个备节点102的优先级。进一步，主节点101在获取多个备节点102的优先级之后，可根据多个备节点102的优先级，选择优先级最高的备节点，作为继承节点。上述实施例示出的继承节点的确定方法仅为示例性说明，并不构成限定。主节点101还可将继承节点的标识写入心跳文件。具体地，主节点101可将继承节点的标识写入心跳文件的继承节点信息字段。继承节点的标识是指唯一标识一个计算节点的信息，可为计算节点的唯一编号，也可为计算节点的地址信息等。计算节点的地址信息可为网际协议地址等。备节点102可检测云盘20中的心跳文件记录的租约信息的有效性；并在检测到心跳文件记录的租约信息失效的情况下，进入选主流程。具体地，备节点102可从心跳文件中获取继承节点的标识，若心跳文件中记录的继承节点的标识为该备节点102自身的标识，则备节点102确定自己为主节点101指定的继承节点。其中，确定为继承节点，即确定为新的持有者。该继承节点可执行选主操作。若心跳文件中记录的继承节点的标识不是该备节点102自身的标识，则备节点102确定自己不是继承节点，不执行选主操作。上述唯一继承节点机制可保证只有被主节点指定的继承节点才能成为新的主节点，可有效规避多个备节点在主节点异常时并发选主，进而可降低产生Ping Pong式的活锁的概率。如图3所示，对于继承节点，可在检测到心跳文件记录的租约信息失效的情况下，基于存储协议抢占云盘的写权限，以将该继承节点注册为新的持有者。进一步，继承节点可将其节点状态切换为主节点状态，即继承节点成为新的主节点，负责对云盘20的读写。其它备节点，继续保持为存储协议中的注册者，对云盘20具有只读权限。这样，只有继承节点进行选主，可有效规避多个备节点在主节点异常时并发选主，进而可降低产生Ping Pong式的活锁的概率。在本申请实施例中，对于继承节点，在抢占云盘的写权限之后，更新心跳文件记录的信息。例如，继承节点可更新心跳文件记录的租约信息、将心跳文件记录的持有者的地址信息更新为该继承节点的地址信息，当然还可更新心跳文件中的任期信息等。对于其它备节点可从心跳文件中获取新的持有者的地址信息，并将维护的持有者的地址信息更新为该新的持有者的地址信息。其中，上述任期信息可为递增的字段，即任期信息每更新一次，对应的值增加设定的梯度。如任期信息每更新一次，增加1等。本申请发明人通过对存储协议中的代次字段研究分析发现，根据存储协议标准，Generation字段在以下3种情形下会递增：存储协议中的注册者注册或注销会导致Generation字段递增；存储协议的释放-清除行为会导致Generation字段递增；存储协议对应的抢占或优先抢占行为则触发Generation递增。由于Generation字段是会自增，因此可将存储协议中的Generation字段作为任期信息。本申请不涉及上述情形导致的Generation字段递增，因此上述情形不在本申请的讨论范围之内。在本实施例中，对于继承节点可在抢占云盘的写权限之后，更新心跳文件的任期信息。由于继承节点抢占云盘的写权限属于上述情形，因此，采用Generation字段作为心跳文件中的任期信息，可该Generation字段可继承节点抢占云盘的写权限的操作，触发Generation字段自动增加。对于继承节点，还可将心跳文件记录的持有者的地址信息，修改为该继承节点的地址信息。对于备节点102，可监测心跳文件中的任期信息；并在监测到心跳文件记录的任期信息发生变化的情况下，从心跳文件中获取持有者的第一地址信息；若心跳文件记录的持有者的第一地址信息与该备节点维护的持有者的第二地址信息不同，则备节点102基于心跳文件记录的持有者的第一地址信息，建立与第一地址信息对应的主节点之间的连接。若心跳文件记录的持有者的第一地址信息与该备节点维护的持有者的第二地址信息相同，则说明是其它情况导致任期信息变化的，则备节点102继续保持与第二地址信息对应的主节点之间的连接。例如，对于上述Generation字段，上述情形和也会导致Generation字段递增，但不会导致心跳文件记录的持有者的地址信息的更新。在实际应用中，原主节点在异常恢复后，可能会发生关机或重新启动。对于主节点重新启动的情况，原主节点在重新启动后，从心跳文件中读取继承节点的标识；可确定继承节点不是自己，则自动将节点状态调整为备节点状态。在实际应用中，一些预期内主节点的重新启动，并不需要触发容灾切换，可保持计算节点角色的稳定。针对设定的关机指令，原主节点可响应于设定的关机指令，将心跳文件中的继承节点的标识修改为该原主节点的标识。这样，后续原主节点在响应该关机指令进行重启的过程中，即使心跳文件记录的租约信息过期，原主节点也可继续保持主节点状态，有助于保持计算节点的角色稳定性。在另一些实施例中，可能存在继承节点不可用的情况。由于无法保证选主操作：确定心跳文件记录的租约信息失效；更新心跳文件中的租约信息；及执行优先抢占操作获取云盘的写权限等三个操作的原子性，因此在上述一些实施例中，采用唯一继承人机制来规避并发选主。然而该实施方式存在以下缺陷：若心跳文件记录的继承节点不可用，且在原主节点之前未发现继承节点不可用，则会导致无计算节点进行选主，使得云盘20永久不可用。基于此，引入继承节点失效机制。具体地，备节点102可在检测到心跳文件记录的租约信息失效，且继承节点异常的情况下，休眠随机时长；并在休眠随机时长之后，基于上述存储协议抢占云盘的写权限。具体地，备节点102可在检测到心跳文件中的租约信息失效的情况下，监测心跳文件中的租约信息是否更新；若心跳文件中的租约信息超过设定时长未更新，确定继承节点异常。心跳文件中的租约信息未更新的时长，可从备节点检测到心跳文件中的租约信息失效时开始计时。设定时长可根据实际容灾效率需求进行灵活设置。例如，设定时长可为3分钟、5分钟等。上述实施例中，备节点休眠的时长为随机的，可从确定继承节点异常时开始计时。例如，设定时长为3分钟，心跳文件中的租约信息为10：00，则备节点可从10：03开始休眠随机时长。由于各备节点休眠的时长是随机的，引入了随机性，在各备节点随机休眠的过程中，可能会存在有两个备节点休眠的随机时长之间的差异值，超过上述、和这三个操作的执行总时间，在这种情况下，就会有其中一个备节点选主成功。例如，假设、和这三个操作的执行总时间为30秒，备节点A休眠2分钟，备节点B休眠3分钟。这样，在备节点B还在休眠的过程中，备节点A在休眠2分钟之后，执行选主操作，耗时约为30秒，可备节点A在备节点B休眠过程中选主成功。该实施例对于长时间无主的场景，以时间和小概率的Ping Pong为代价，换取数据库系统的最终可用，有助于提高数据库的鲁棒性。上述实施例仅以计算节点为多个的情况，对本申请实施例提供的数据库容灾方式进行示例性说明。当然，本申请实施例提供的数据库容灾方式也可兼容无备节点的数据库系统。在该数据库系统中，主节点可将自己作为继承节点，并将自己的标识写入心跳文件的继承节点字段。这样，主节点在重新启动过程中，检测到心跳文件记录的继承节点为自己，则可再次基于存储协议抢占云盘的写权限，成为持有者。在实际应用中，备节点也可能出现异常或停止运行等情况，导致与主节点之间的连接链路断开。对于主节点可在检测到备节点退出注册者的情况下，在选择继承节点时，删除该备节点的相关信息等等。本申请实施例除了上述数据库系统之外，还提供数据库容灾方法，下面对本申请实施例提供的数据库容灾方法进行示例性说明。图6为本申请实施例提供的数据库容灾方法的流程示意图。该方法适用于数据库系统中的计算节点。数据库系统还包括：被配置为目标模式的云盘；云盘存储有心跳文件。其中，存储协议中的持有者对目标模式的云盘具有读写权限；存储协议中的注册者对目标模式的云盘具有只读权限。基于此，可将数据库系统中的主节点注册为存储协议中的持有者，将数据库系统中的备节点注册为存储协议中的注册者。被注册为持有者的主节点可通过修改心跳文件中的租约信息维持主节点状态。在本实施例中，计算节点在某一时刻可为数据库的备节点，在另一时刻也可实现为数据库的主节点。因此，本申请实施例提供的数据库容灾方法中主节点的执行逻辑和备节点的执行逻辑，可在同一计算节点上实现。基于上述存储协议，如图6所示，本申请实施例提供的数据库容灾方法可包括：601、备节点检测心跳文件中的租约信息的有效性；其中，主节点通过修改租约信息维持主节点状态。602、在检测到主节点的运行状态异常的情况下，备节点基于存储协议抢占云盘的写权限，以将备节点注册为新的持有者。603、将备节点的节点状态切换为主节点状态。图6示出的数据库容灾方法主要适用于数据库系统的计算节点中的备节点。在本实施例中，为了对基于云盘的数据库实现容灾处理，在云盘中设置心跳文件。心跳文件可用于对主节点进行心跳检测，以确定主节点是否出现异常。具体地，该心跳文件可包括：租约信息。主节点可通过更新心跳文件的租约信息，维持主节点状态。主节点可按照设定的续租周期，周期性地更新心跳文件中的租约信息。如图6步骤601所示，对于备节点，可检测心跳文件中租约信息的有效性。在一些实施例中，租约信息可为时间戳信息。时间戳信息为租约到期对应的时刻。相应地，可按照设定的数据读取周期，周期性地读取心跳文件中的租约信息；若租约信息的时间戳早于当前时间，确定心跳文件中的租约信息失效。其中，数据读取周期小于心跳文件中的租约信息的有效时长。云盘支持对应的存储协议标准。存储协议中一般有不同的角色类型。不同角色对云盘的访问权限不同。存储协议中的角色一般具有持有者、注册者及Non-Registrant等不同的角色。其中，持有者具有云盘的所有操作权限，注册者具有云盘的部分操作权限，访客只具有云盘的读权限。由于云盘处于目标模式下，存储协议中的持有者对云盘具有读写权限，与主节点的功能相同；注册者具有只读权限，与备节点的功能相同。因此，云盘可被配置为目标模式。计算节点可在启动过程中，确定该计算节点的节点状态。在本申请实施例中，不限定计算节点确定自身的节点状态的具体实施方式。在一些实施例中，可检测云盘中是否存在心跳文件；若云盘不存在心跳文件，说明该数据库系统为新的实例，尚未有主节点，则确定自己的节点状态为主节点。若云盘中存在心跳文件，且心跳文件记录的云盘的标识与该计算节点维护的云盘的标识不同，说明该数据库系统为云盘恢复的实例，即计算节点10挂载的云盘为新的云盘快照，则可确定计算节点的节点状态为主节点。即云盘中不存在心跳文件或者心跳文件记录的云盘的标识与该计算节点维护的云盘的标识不同，确定该计算节点为主节点。在一些实施例中，若云盘中存在心跳文件，且心跳文件记录的云盘的标识信息与该计算节点维护的云盘的标识相同，确定计算节点的状态为备节点。在另一些实施例中，若云盘中存在心跳文件、心跳文件记录的云盘的标识信息与该计算节点维护的云盘的标识相同，且该计算节点不是继承节点，则确定计算节点的节点状态为备节点。继承节点是指主节点指定的用于在主节点异常时，接替主节点对云盘进行写访问的备节点。关于继承节点，将在下文实施例中进行详细说明，在此不再赘述。进一步，若云盘中存在心跳文件、心跳文件记录的云盘的标识信息与该计算节点维护的云盘的标识相同、该计算节点是继承节点且心跳文件记录的租约信息失效，确定该计算节点的节点状态为主节点。相应地，若云盘中存在心跳文件、心跳文件记录的云盘的标识信息与该计算节点维护的云盘的标识相同、该计算节点是继承节点且心跳文件记录的租约信息处于有效期，确定该计算节点的节点状态为备节点。上述实施例示出的计算节点的节点状态的确定方式仅为示例性说明，但不构成限定。进一步，若该计算节点的节点状态为主节点，则确定主节点为存储协议中的持有者，可将计算节点注册为存储协议中的持有者。若该计算节点的节点状态为备节点，则备节点为存储协议中的注册者，可将计算节点注册为存储协议中的注册者。这样，计算节点可基于云盘支持的存储协议，对基于云盘的数据库进行容灾处理。这部分内容将在下文实施例中进行描述，在此暂不赘述。作为主节点的计算节点，可基于云盘支持的存储协议，抢占云盘的写权限，抢占云盘的写权限，从而将主节点注册为存储协议中的持有者。具体地，对于存储协议为NVMe协议的实施例，主节点可调用NVMe协议中的PR协议提供的优先抢占接口，并通过优先抢占接口，获取云盘的写权限，从而将主节点注册为PR协议中的持有者。可选地，可调用PR协议的注册接口，将计算节点注册为PR协议中的注册者。进一步，计算节点可确定其节点状态。关于确定计算节点的节点状态的具体实施方式，可参见上述实施例的相关内容，在此不再赘述。进一步，若计算节点的节点状态为主节点，则确定该计算节点为存储协议中的持有者，相应地，计算节点可调用NVMe协议中的PR协议提供的优先抢占接口，并通过优先抢占接口，抢占云盘的写权限，以将该计算节点的角色类型从注册者修改为持有者。对于数据库系统的主节点，可通过更新心跳文件的租约信息，维持主节点状态。即主节点通过更新心跳文件的租约信息，实现主节点状态续约。备节点可通过检测心跳文件中租约信息的有效性。对于备节点来说，在步骤602中，在检测到心跳文件记录的租约信息失效的情况下，基于存储协议抢占云盘的写权限，以将该备节点注册为新的持有者。关于继承节点基于存储协议抢占云盘的写权限的具体实施方式，可参见上述主节点基于存储协议抢占云盘的写权限的相关内容，在此不再赘述。进一步，在步骤603中，备节点可将其节点状态切换为主节点状态，即备节点成为新的主节点，负责对云盘的读写。其它备节点，继续保持为存储协议中的注册者，对云盘具有只读权限。对于新的主节点，可更新心跳文件记录的信息。例如，新的主节点可更新心跳文件的租约信息，将心跳文件记录的持有者的地址信息更新为该新的主节点的地址信息等等。在本实施例中，主节点和备节点分别对注册为存储协议中的持有者和注册者。这样，备节点可在主节点的租约失效时，基于云盘支持的存储协议，抢占云盘的写权限，并切换为主节点，实现了基于云盘支持的数据库的容灾处理。由于存储协议为云盘支持的标准协议，因此，本实施例提供的数据库的容灾方式基于云盘支持的标准存储协议，实现对数据库的容灾处理，无需为基于云盘的数据库额外开发或定制其它协议的容灾方案，可提高基于云盘的数据库的容灾处理方案的通用性。此外，由于备节点在主节点的租约失效时，抢占了对云盘的写权限，注册为了新的持有者，使得原主节点失去了云盘的写权限。即便原主节点重新启动，也会因为丢失云盘的写权限，而无法向云盘写入数据，从而实现了对原主节点的IO防护，可降低数据库脑裂的概率。在本申请实施例中，为了降低主节点异常时，备节点并发选主时产生乒乓式的活锁的概率，作为主节点的计算设备，可从被注册为存储协议中的注册者的备节点中，确定继承节点。在本申请实施例中，不限定主节点从备节点中，确定继承节点的具体实施方式。在一些实施例中，主节点可从多个备节点中，随机选择一个备节点，作为继承节点。在另一些实施例中，可基于优先级机制，从多个备节点中，选择一个备节点作为继承节点。具体地，主节点可获取多个备节点的优先级；并根据多个备节点的优先级，选择优先级最高的备节点，作为继承节点。可选地，可获取多个备节点的性能参数信息，并根据多个备节点的性能参数信息，确定多个备节点的优先级。其中，性能参数信息反映的性能越好的备节点的优先级越高。或者，在另一些实施例中，计算节点可提供优先级设置接口。用户可通过优先级设置接口指定多个备节点的优先级。作为主节点的计算节点可获取通过优先级设置接口指定的多个备节点的优先级。进一步，主节点在获取多个备节点的优先级之后，可根据多个备节点的优先级，选择优先级最高的备节点，作为继承节点。上述实施例示出的继承节点的确定方法仅为示例性说明，并不构成限定。主节点还可将继承节点的标识写入心跳文件。作为备节点的计算节点，可检测云盘中的心跳文件记录的租约信息的有效性；并在检测到心跳文件记录的租约信息失效的情况下，进入选主流程。具体地，可从心跳文件中获取继承节点的标识，若心跳文件中记录的继承节点的标识为该备节点自身的标识，则备节点确定自己为主节点指定的继承节点。若心跳文件中记录的继承节点的标识不是该备节点自身的标识，则确定自己不是继承节点，不执行选主操作。上述唯一继承节点机制可保证只有被主节点指定的继承节点才能成为新的主节点，可有效规避多个备节点在主节点异常时并发选主，进而可降低产生Ping Pong式的活锁的概率。对于继承节点，可在检测到心跳文件记录的租约信息失效的情况下，基于存储协议抢占云盘的写权限，以将该继承节点注册为新的持有者。进一步，继承节点可将其节点状态切换为主节点状态，即继承节点成为新的主节点，负责对云盘的读写。其它备节点，继续保持为存储协议中的注册者，对云盘具有只读权限。这样，只有继承节点进行选主，可有效规避多个备节点在主节点异常时并发选主，进而可降低产生Ping Pong式的活锁的概率。在本申请实施例中，对于继承节点，在抢占云盘的写权限之后，更新心跳文件记录的信息。例如，继承节点可更新心跳文件记录的租约信息、将心跳文件记录的持有者的地址信息更新为该继承节点的地址信息，当然还可更新心跳文件中的任期信息等。对于其它备节点可从心跳文件中获取新的持有者的地址信息，并将维护的持有者的地址信息更新为该新的持有者的地址信息。其中，上述任期信息可为递增的字段，即任期信息每更新一次，对应的值增加设定的梯度。如任期信息每更新一次，增加1等。在一些实施例中，可将存储协议中的Generation字段作为任期信息。对于作为继承节点的计算设备，还可将心跳文件记录的持有者的地址信息，修改为该继承节点的地址信息。对于作为备节点的计算设备，可监测心跳文件中的任期信息；并在监测到心跳文件记录的任期信息发生变化的情况下，从心跳文件中获取持有者的第一地址信息；若心跳文件记录的持有者的第一地址信息与该备节点维护的持有者的第二地址信息不同，则备节点基于心跳文件记录的持有者的第一地址信息，建立与第一地址信息对应的主节点之间的连接。若心跳文件记录的持有者的第一地址信息与该备节点维护的持有者的第二地址信息相同，则说明是其它情况导致任期信息变化的，则备节点继续保持与第二地址信息对应的主节点之间的连接。在实际应用中，原主节点在异常恢复后，可能会发生关机或重新启动。一些预期内主节点的重新启动，并不需要触发容灾切换，可保持计算节点角色的稳定。针对设定的关机指令，原主节点可响应于设定的关机指令，将心跳文件中的继承节点的标识修改为该原主节点的标识。这样，后续原主节点在响应该关机指令进行重启的过程中，即使心跳文件记录的租约信息过期，原主节点也可继续保持主节点状态，有助于保持计算节点的角色稳定性。在另一些实施例中，可能存在继承节点不可用的情况。由于无法保证选主操作：确定心跳文件记录的租约信息失效；更新心跳文件中的租约信息；及执行优先抢占操作获取云盘的写权限等三个操作的原子性，因此在上述一些实施例中，采用唯一继承人机制来规避并发选主。然而该实施方式存在以下缺陷：若心跳文件记录的继承节点不可用，且在原主节点之前未发现继承节点不可用，则会导致无计算节点进行选主，使得云盘永久不可用。基于此，引入继承节点失效机制。具体地，作为备节点的计算节点，可在检测到心跳文件记录的租约信息失效，且继承节点异常的情况下，休眠随机时长；并在休眠随机时长之后，基于上述存储协议抢占云盘的写权限。具体地，作为备节点的计算节点，可在检测到心跳文件中的租约信息失效的情况下，监测心跳文件中的租约信息是否更新；若心跳文件中的租约信息超过设定时长未更新，确定继承节点异常。心跳文件中的租约信息未更新的时长，可从备节点检测到心跳文件中的租约信息失效时开始计时。设定时长可根据实际容灾效率需求进行灵活设置。上述实施例中，备节点休眠的时长为随机的，可从确定继承节点异常时开始计时。由于各备节点休眠的时长是随机的，引入了随机性，在各备节点随机休眠的过程中，可能会存在有两个备节点休眠的随机时长之间的差异值，超过上述、和这三个操作的执行总时间，在这种情况下，就会有其中一个备节点选主成功。该实施例对于设定时长无主的场景，可以时间和小概率的Ping Pong，换取数据库系统的最终可用，有助于提高数据库的鲁棒性。上述实施例仅以计算节点为多个的情况，对本申请实施例提供的数据库容灾方式进行示例性说明。当然，本申请实施例提供的数据库容灾方式也可兼容无备节点的数据库系统。在该数据库系统中，主节点可将自己作为继承节点，并将自己的标识写入心跳文件的继承节点字段。这样，主节点在重新启动过程中，检测到心跳文件记录的继承节点为自己，则可再次基于存储协议抢占云盘的写权限，成为持有者。在实际应用中，备节点也可能出现异常或停止运行等情况，导致与主节点之间的连接链路断开。对于主节点可在检测到备节点退出注册者的情况下，在选择继承节点时，删除该备节点的相关信息等等。需要说明的是，上述实施例所提供方法的各步骤的执行主体均可以是同一设备，或者，该方法也由不同设备作为执行主体。比如，步骤601和602的执行主体可以为设备A；又比如，步骤601的执行主体可以为设备A，步骤602的执行主体可以为设备B；等等。另外，在上述实施例及附图中的描述的一些流程中，包含了按照特定顺序出现的多个操作，但是应该清楚了解，这些操作可以不按照其在本文中出现的顺序来执行或并行执行，操作的序号如601、602等，仅仅是用于区分开各个不同的操作，序号本身不代表任何的执行顺序。另外，这些流程可以包括更多或更少的操作，并且这些操作可以按顺序执行或并行执行。相应地，本申请实施例还提供一种存储有计算机指令的计算机可读存储介质，当计算机指令被一个或多个处理器执行时，致使一个或多个处理器执行上述数据库容灾方法中的步骤。图7为本申请实施例提供的计算设备的结构示意图。在本实施例中，该计算设备可实现为数据库系统中的计算节点；所述数据库系统还包括：被配置为目标模式的云盘；所述云盘支持的存储协议中的持有者对所述目标模式的云盘具有读写权限；所述存储协议中的注册者对所述目标模式的云盘具有只读权限。该计算设备可实现为数据库系统的备节点，也可实现为数据库系统的主节点。一般地，计算设备在某一时刻可为主节点，在另一时刻又可降级为备节点。在计算设备为主节点时，可被注册为存储协议的持有者；在计算设备为备节点时，可被注册为存储协议的注册者。如图7所示，该计算设备包括：存储器70a和处理器70b。存储器，用于存储计算机程序；处理器70b耦合至存储器70a，用于执行计算机程序实现上述各实施例提供的数据库容灾方法中的步骤。具体地，计算设备实现为备节点时，处理器70b可用于：检测云盘存储的心跳文件中的租约信息的有效性；其中，主节点通过修改租约信息维持主节点状态；在检测到租约信息失效的情况下，基于存储协议，抢占云盘的写权限，以将备节点注册为新的持有者；以及，将计算设备的节点状态切换为主节点状态。可选地，处理器70b在检测心跳文件的租约信息的有效性时，具体用于：按照设定的数据读取周期，周期性地读取心跳文件记录的租约信息；若心跳文件记录的租约信息的时间戳早于当前时间，确定心跳文件中的租约信息失效；数据读取周期小于心跳文件中的租约信息的有效时长。在一些实施例中，存储协议为NVMe协议，NVMe协议包括PR协议；处理器70b在基于存储协议，抢占云盘的写权限时，具体用于：调用PR协议提供的优先抢占接口；通过优先抢占接口，抢占云盘的写权限，以将计算设备注册为PR协议中的持有者。计算设备实现为主节点时，处理器70b还用于：在备节点检测云盘存储的心跳文件中的租约信息的有效性之前，基于存储协议，抢占云盘的写权限，以将主节点注册为存储协议中的持有者；通过更新心跳文件的租约信息维持主节点状态。可选地，存储协议为NVMe协议，NVMe协议包括PR协议；处理器70b还用于：在主节点基于存储协议，抢占云盘的写权限之前，调用PR协议的注册接口，将计算节点注册为PR协议中的注册者；确定计算节点的节点状态；若计算设备的节点状态为主节点，执行主节点基于存储协议，抢占云盘的写权限的步骤，以将主节点注册为存储协议中的持有者。在一些实施例中，备节点为多个。计算设备在实现为主节点时，处理器70b还用于：主节点从多个备节点中，确定继承节点；将继承节点的标识写入心跳文件。相应地，计算设备在实现为备节点时，处理器70b可在检测到心跳文件记录的租约信息失效的情况下，判断心跳文件记录的继承节点的标识是否为备节点的标识；若是，执行基于存储协议，抢占云盘的写权限，以将备节点注册为新的持有者的步骤。可选地，处理器70b在确定计算节点的节点状态时，具体用于：若云盘中不存在心跳文件或者心跳文件记录的云盘的标识与计算节点维护的云盘的标识不同，确定计算节点的节点状态为主节点；若云盘存在心跳文件、心跳文件记录的云盘的标识与计算节点维护的云盘的标识相同，以及计算节点不是继承节点，确定计算节点的节点状态为备节点；若云盘存在心跳文件、心跳文件记录的云盘的标识与计算节点维护的云盘的标识相同、计算节点是继承节点且心跳文件中的租约信息失效，确定计算节点的节点状态为主节点；若云盘存在心跳文件、心跳文件记录的云盘的标识与计算节点维护的云盘的标识相同、计算节点是继承节点且心跳文件中的租约信息处于有效期，确定计算节点的节点状态为备节点。可选地，处理器70b在从多个备节点中，确定继承节点时，具体用于：从多个备节点中，随机选择一个备节点，作为继承节点；或者，获取多个备节点的优先级；根据多个备节点的优先级，选择优先级最高的备节点，作为继承节点。进一步，处理器70b在获取多个备节点的优先级时，具体用于：获取多个备节点的性能参数信息；根据多个备节点的性能参数信息，确定多个备节点的优先级；性能参数信息反映的性能越好的备节点的优先级越高；或者，获取通过优先级设置接口指定的多个备节点的优先级。在一些实施例中，心跳文件包括：任期信息和持有者的地址信息。若计算设备为继承节点，处理器70b还用于：在抢占云盘的写权限之后，更新心跳文件记录的任期信息；并将持有者的地址信息修改为继承节点的地址信息。对于作为备节点的计算设备，处理器70b还用于：监测心跳文件中的任期信息；并在监测到心跳文件中的任期信息发生变化的情况下，从心跳文件中获取持有者的第一地址信息；在第一地址信息与备节点维护的持有者的第二地址信息不同的情况下，基于第一地址信息，建立与第一地址信息对应的主节点之间的连接。对于作为主节点的计算设备，处理器70b还用于：响应于设定的关机指令，将心跳文件记录的继承节点的标识修改为主节点的标识，以使主节点在响应关机指令进行重启的过程中保持主节点状态。对于作为备节点的计算设备，处理器70b还用于：在检测到心跳文件记录的租约信息失效，且继承节点异常的情况下，休眠随机时长；在休眠随机时长之后，基于存储协议，抢占云盘的写权限。可选地，处理器70b还用于：在检测到心跳文件中的租约信息失效的情况下，监测心跳文件中的租约信息是否更新；若心跳文件中的租约信息超过设定时长未更新，确定继承节点异常。在一些可选实施方式中，如图7所示，该计算设备还可以包括：通信组件70c、电源组件70d等可选组件。在一些实施例中，计算设备可实现为电脑等终端设备，还可包括：显示组件70e及音频组件70f等组件。图7中仅示意性给出部分组件，并不意味着计算设备必须包含图7所示全部组件，也不意味着计算设备只能包括图7所示组件。在本实施例中，主节点和备节点分别对注册为存储协议中的持有者和注册者。这样，备节点可在主节点异常时，基于云盘支持的存储协议，抢占云盘的写权限，并切换为主节点，实现了基于云盘支持的数据库的容灾处理。由于存储协议为云盘支持的标准协议，因此，本实施例提供的数据库的容灾方式基于云盘支持的标准存储协议，不仅可实现对数据库的容灾处理，可保证基于云盘的数据库的高可用性；而且，无需为基于云盘的数据库额外开发或定制其它协议的容灾方案，可提高基于云盘的数据库的容灾处理方案的通用性。在本申请实施例中，存储器用于存储计算机程序，并可被配置为存储其它各种数据以支持在其所在设备上的操作。其中，处理器可执行存储器中存储的计算机程序，以实现相应控制逻辑。存储器可以由任何类型的易失性或非易失性存储设备或者它们的组合实现，如静态随机存取存储器，电可擦除可编程只读存储器，可擦除可编程只读存储器，可编程只读存储器，只读存储器，磁存储器，快闪存储器，磁盘或光盘。在本申请实施例中，处理器可以为任意可执行上述方法逻辑的硬件处理设备。可选地，处理器可以为中央处理器、图形处理器或微控制单元；也可以为现场可编程门阵列、可编程阵列逻辑器件、通用阵列逻辑器件、复杂可编程逻辑器件等可编程器件；或者为先进精简指令集处理器或系统芯片等等，但不限于此。在本申请实施例中，通信组件被配置为便于其所在设备和其他设备之间有线或无线方式的通信。通信组件所在设备可以接入基于通信标准的无线网络，如无线保真，2G或3G，4G，5G或它们的组合。在一个示例性实施例中，通信组件经由广播信道接收来自外部广播管理系统的广播信号或广播相关信息。在一个示例性实施例中，通信组件还可基于近场通信技术、射频识别技术、红外数据协会技术、超宽带技术、蓝牙技术或其他技术来实现。在本申请实施例中，显示组件可以包括液晶显示器和触摸面板。如果显示组件包括触摸面板，显示组件可以被实现为触摸屏，以接收来自用户的输入信号。触摸面板包括一个或多个触摸传感器以感测触摸、滑动和触摸面板上的手势。触摸传感器可以不仅感测触摸或滑动动作的边界，而且还检测与触摸或滑动操作相关的持续时间和压力。在本申请实施例中，电源组件被配置为其所在设备的各种组件提供电力。电源组件可以包括电源管理系统，一个或多个电源，及其他与为电源组件所在设备生成、管理和分配电力相关联的组件。在本申请实施例中，音频组件可被配置为输出和/或输入音频信号。例如，音频组件包括一个麦克风，当音频组件所在设备处于操作模式，如呼叫模式、记录模式和语音识别模式时，麦克风被配置为接收外部音频信号。所接收的音频信号可以被进一步存储在存储器或经由通信组件发送。在一些实施例中，音频组件还包括一个扬声器，用于输出音频信号。例如，对于具有语言交互功能的设备，可通过音频组件实现与用户的语音交互等。需要说明的是，本文中的“第一”、“第二”等描述，是用于区分不同的消息、设备、模块等，不代表先后顺序，也不限定“第一”和“第二”是不同的类型。本领域内的技术人员应明白，本申请的实施例可提供为方法、系统、或计算机程序产品。因此，本申请可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本申请可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质、光学存储器等）上实施的计算机程序产品的形式。本申请是参照根据本申请实施例的方法、设备、和计算机程序产品的流程图和／或方框图来描述的。应理解可由计算机程序指令实现流程图和／或方框图中的每一流程和／或方框、以及流程图和／或方框图中的流程和／或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能的步骤。在一个典型的配置中，计算设备包括一个或多个处理器 、输入/输出接口、网络接口和内存。内存可能包括计算机可读介质中的非永久性存储器，随机存取存储器  和/或非易失性内存等形式，如只读存储器  或闪存。内存是计算机可读介质的示例。计算机的存储介质为可读存储介质，也可称为可读介质。可读存储介质包括永久性和非永久性、可移动和非可移动媒体可以由任何方法或技术来实现信息存储。信息可以是计算机可读指令、数据结构、程序的模块或其他数据。计算机的存储介质的例子包括，但不限于相变内存 、静态随机存取存储器 、动态随机存取存储器 、其他类型的随机存取存储器、只读存储器 、电可擦除可编程只读存储器 、快闪记忆体或其他内存技术、只读光盘只读存储器 、数字多功能光盘  或其他光学存储、磁盒式磁带，磁盘存储或其他磁性存储设备或任何其他非传输介质，可用于存储可以被计算设备访问的信息。按照本文中的界定，计算机可读介质不包括暂存电脑可读媒体 ，如调制的数据信号和载波。还需要说明的是，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、商品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、商品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括上述要素的过程、方法、商品或者设备中还存在另外的相同要素。以上内容仅为本申请的实施例而已，并不用于限制本申请。对于本领域技术人员来说，本申请可以有各种更改和变化。凡在本申请的精神和原理之内所作的任何修改、等同替换、改进等，均应包含在本申请的权利要求范围之内。
