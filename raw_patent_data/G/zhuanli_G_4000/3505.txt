标题title
一种石英晶体谐振频率快速测量方法及装置
摘要abst
本发明公开一种石英晶体谐振频率快速测量方法及装置，应用于电子与电路技术领域，针对现有技术在测量石英晶体谐振频率时存在的需要获取一段频率区间内完整的阻抗‑频率响应，极大限制了系统的测量速度，并且难以测量非稳态环境，通常不适用于高速传感检测应用的问题；本发明提出的测量方法在测量时仅获取当前激励频率下待测石英晶体的电纳响应，利用石英晶体电纳响应在谐振点处过零且近似线性的特点，引入PID调节，实现对石英晶体谐振频率的快速测量。
权利要求书clms
1.一种石英晶体谐振频率快速测量方法，其特征在于，每次测量获取当前激励信号下的待测石英晶体的电纳响应，采用PID负反馈追踪调节，若当前电纳响应大于设定的允许的测量误差值范围上限，则降低激励信号的频率，若当前电纳响应小于设定的允许的测量误差值范围下限，则增大激励信号的频率；直至获取到的电纳响应在设定的允许的测量误差值范围内，将该电纳响应对应的激励信号的频率作为测量得到的石英晶体谐振频率。2.根据权利要求1所述的一种石英晶体谐振频率快速测量方法，其特征在于，所述方法包括以下步骤：在测量开始前，设置激励石英晶体的激励信号的起始频率，设置频率追踪的PID参数，设定单次电纳测量的间隔时间，设置允许的测量误差值范围；开始测量；等待设定的间隔时间后，获取得到石英晶体的电纳响应值；将石英晶体的电纳响应值与零值的差值作为PID控制的误差量，激励信号的频率作为被控量，进行PID控制；若电纳响应与零值的差值在允许的测量误差值范围内，则将激励信号的频率值作为测量值输出，否则根据步骤中PID输出的被控量作为更新后的激励信号的频率，然后返回步骤。3.根据权利要求2所述的一种石英晶体谐振频率快速测量方法，其特征在于，PID控制的控制算法如下式：f＝f+K]其中，f为PID控制当前的输出，f为PID控制上一次的输出，e为PID控制当前的误差量，K为比例系数，e为PID控制上一次的误差量。4.一种石英晶体谐振频率快速测量装置，其特征在于，包括：石英晶体、MCU模块、FPGA模块、DAC模块、激励电路、正交下变频电路、ADC模块以及显示器；激励电路用于获取石英晶体导纳相关的交流电压；正交下变频电路用于从激励电路输出的交流电压中提取电纳响应并转换至直流电压输出；ADC模块用于读取正交下变频电路输出的直流电压值并反馈至FPGA模块；DAC模块为双路DAC，用于生成两路可控正弦信号，分别作为激励电路的激励信号与正交下变频电路的参考信号；FPGA模块用于控制激励信号与参考信号的频率与相位，判断谐振频率，并与MCU通讯传输测量结果；MCU模块用于进行人机交互，与FPGA模块进行通讯设置测量过程的参数，并连接显示器进行信息显示。5.根据权利要求4所述的一种石英晶体谐振频率快速测量装置，其特征在于，激励电路包括：石英晶体插座、参考电阻、放大电路单元，石英晶体插入石英晶体插座中与参考电阻串联分压，得到与石英晶体导纳相关的交流电压，该交流电压通过放大电路单元进行放大后作为激励电路的输出。6.根据权利要求4所述的一种石英晶体谐振频率快速测量装置，其特征在于，正交下变频电路包括：第一组乘法器与低通滤波器；使用第一组中的乘法器将激励电路输出信号与参考信号混频，然后使用第一组中的低通滤波器滤除混频的信号中的高频成分，得到最终的直流输出信号；正交下变频电路还包括第二组乘法器与低通滤波器，用于将激励信号与参考信号进行混频。7.根据权利要求4所述的一种石英晶体谐振频率快速测量装置，其特征在于，FPGA模块包括：谐振频率测量控制器、DDS模块；谐振频率测量控制器的输出作为DDS模块的输入，DDS模块的输出作为FPGA模块的输出；谐振频率测量控制器具体包括：等待开始信号单元、配置参数单元、数据稳定策略单元、PID控制策略单元以及结果处理单元；等待开始信号单元用于接收MCU模块下发的开始信号；配置参数单元用于接收MCU模块下发的配置参数；数据稳定策略单元用于稳定ADC模块的采集数据；PID控制策略单元采用电纳响应与零值的差值作为误差量，激励信号的输出频率为被控制量，构成负反馈环路进行谐振频率追踪；结果处理单元用于判定当前误差是否在允许的测量误差值范围内，若是，则返回当前激励信号的频率值作为测量结果，否则进入下一轮测量。
说明书desc
技术领域本发明属于电子与电路技术领域，特别涉及一种快速测量石英晶体谐振频率并追踪其变化的检测技术及检测装置。背景技术石英晶体谐振式传感器是一种以石英晶体谐振器作为敏感元件的谐振式传感器，利用石英晶体的逆压电效应、表面质量敏感效应对被测参量进行测量，其特点是当对石英晶体外加交变电压时，石英晶体会以一定频率进行机械振动，当交变电压的频率与晶体固有频率相同时，便产生共振，机械振动达到最大，该频率又称为谐振频率。而石英晶体谐振式传感器通常是建立待测量与石英晶体谐振频率之间的映射关系，从而进行传感测量。可以发现，利用石英晶体谐振式传感器进行传感测量时，其关键在于测量石英晶体在特定条件下的谐振频率，不同的石英晶体谐振频率测量方法会影响石英晶体传感系统的性能。通常，测量石英晶体谐振频率会采用振荡电路法，其原理是将石英谐振器作为选频器件置入正反馈电路中构成振荡电路，振荡电路的振荡频率便为石英晶体的谐振频率，使用数字频率计等设备对该信号进行测量，便可得到石英晶体的谐振频率。振荡电路法存在具有结构简单、速度快等优势，但当待测石英晶体的品质因数Q较低时，其选频性能较差，从而导致振荡电路的振荡稳定性降低，甚至可能出现振荡电路停振，影响测量。为了解决电路停振的问题，一种基于频率扫描的阻抗分析方法被提出用来测量石英晶体谐振频率，利用石英晶体在谐振点阻抗达到极小值的特点，该方法可不借助振荡电路对石英晶体的谐振频率进行测量。但是该方法需要获取一段频率区间内完整的频率-阻抗响应，极大降低了系统的测量速度，并且难以测量非稳态环境，通常不能满足高速传感应用场景下的测量要求。发明内容为解决上述技术问题，本发明提出一种石英晶体谐振频率快速测量方法及装置，在阻抗分析法的基础上，利用石英晶体在谐振频率点附近电纳响应过零且近似线性的特点，无需获取石英晶体的频率-阻抗响应即可追踪待测石英晶体的谐振频率，结合PID控制策略，实现对石英晶体谐振频率的快速测量。本发明采用的技术方案之一为：一种石英晶体谐振频率快速测量方法：每次测量获取当前激励信号下的待测石英晶体的电纳响应，采用PID负反馈追踪调节，若当前电纳响应大于设定的允许的测量误差值范围上限，则降低激励信号的频率，若当前电纳响应小于设定的允许的测量误差值范围下限，则增大激励信号的频率；直至获取到的电纳响应在设定的允许的测量误差值范围内，将该电纳响应对应的激励信号的频率作为测量得到的石英晶体谐振频率。具体步骤如下：在测量开始前，设置激励石英晶体的激励信号的起始频率，设置频率追踪的PID参数，设定单次电纳测量的间隔时间，设置允许的测量误差值范围；开始测量；等待设定的间隔时间后，获取得到石英晶体的电纳响应值；将石英晶体的电纳响应值与零值的差值作为PID控制策略的误差量，激励信号的频率作为被控量，进行PID控制；若电纳响应与零值的误差在允许的测量误差值范围内，则将激励信号的频率值作为测量值输出，否则根据步骤中PID输出的被控制量作为更新后的激励信号的频率，然后执行步骤。本发明采用的技术方案之二为：一种石英晶体谐振频率快速测量装置；包括：石英晶体、MCU模块、FPGA模块、双路DAC模块、激励电路、正交下变频电路、ADC模块以及显示器；激励电路用于获取石英晶体导纳相关的交流电压；正交下变频电路用于从激励电路输出的交流电压中提取电纳响应并转换至直流电压输出；ADC模块用于读取正交下变频电路输出的直流电压值并反馈至FPGA模块；双路DAC模块生成两路可控正弦信号，分别作为激励电路的激励信号与正交下变频电路的参考信号；FPGA模块用于控制激励信号与参考信号的频率与相位，判断谐振频率，并与MCU通讯传输测量结果；MCU模块用于进行人机交互，与FPGA通讯设置测量参数，并连接显示器进行信息显示。显示器至少显示最终测量的频率值。激励电路包括：石英晶体插座、参考电阻、放大电路单元，石英晶体插入石英晶体插座中与参考电阻串联分压，得到与石英晶体导纳相关的交流电压，该交流电压通过放大电路单元进行放大后作为激励电路的输出；正交下变频电路包括：第一组乘法器与低通滤波器；使用第一组中的乘法器将激励电路输出信号与参考信号混频，然后使用第一组中的低通滤波器滤除混频的信号中的高频成分，得到最终的直流输出信号；正交下变频电路还包括第二组乘法器与低通滤波器，用于将激励信号与参考信号进行混频。FPGA模块包括：谐振频率测量控制器、DDS模块；谐振频率测量控制器的输出作为DDS模块的输入，DDS模块的输出作为FPGA模块的输出；谐振频率测量控制器具体包括：等待开始信号单元、配置参数单元、数据稳定策略单元、PID控制策略单元以及结果处理单元；等待开始信号单元用于接收MCU模块下发的开始信号；配置参数单元用于接收MCU模块下发的配置参数；数据稳定策略单元用于稳定ADC模块的采集数据；PID控制策略单元采用电纳响应与零值的差值作为误差量，激励信号的输出频率为被控制量，构成负反馈环路进行谐振频率追踪；结果处理单元用于判定当前误差是否在允许的测量误差值范围内，若是，则返回当前激励信号的频率值作为测量结果，否则进入下一轮测量。本发明的有益效果：利用石英晶体在谐振频率点附近电纳响应近似线性的特点，引入PID调节；每次测量仅获取当前频率下待测石英晶体的电纳响应，本发明的方法可以做到测量误差最小，即测量误差值为0，若当前电纳响应大于零，则降低激励频率，若当前电纳响应大于零，则增大激励频率，实现负反馈追踪调节，直至获取到的电纳响应等于0，将该电纳响应等于0对应的激励信号的频率作为测量得到的石英晶体谐振频率；可以快速测量石英晶体频率；本发明具有以下优点：本发明使用DDS技术产生激励信号以获取石英晶体在不同频率激励下的电纳响应，对低品质因数晶体进行测量时测量精度高且不会出现停振现象；本发明对石英晶体进行测量时，不需要获取完整的频率-阻抗响应曲线，避免了耗时的频率扫描过程，提高了测量速度；本发明利用石英晶体电纳响应的特点，采用负反馈控制的方式进行频率追踪，弥补了频率扫描法等开环测量方法难以测量非稳态条件下的石英晶体的缺点；本发明利用石英晶体电纳响应的特点，在频率追踪过程中引入了PID控制策略，提高了测量速度；本发明使用正交下变频的方式解析获取石英晶体电纳响应，ADC只需采集直流信号，降低了对ADC的采集速率要求。附图说明图1为本发明提供的石英晶体谐振频率快速测量方法示意图。图2为本发明提供的石英晶体谐振频率快速测量装置结构框图。图3为本发明实施例中的测量装置的电路逻辑图。图4为本发明实施例中的测量控制器工作流程框图。图5为本发明实施例中的数据稳定策略流程图。图6为本发明实施例所实现系统的频率追踪过程对比图。具体实施方式为便于本领域技术人员理解本发明的技术内容，下面结合附图对本发明内容进一步阐释。如图2所示，为本发明的石英晶体谐振频率快速测量方法实现所基于的石英晶体谐振频率快速测量装置结构框图。该测量装置主要用于获取特定频率下石英晶体的电纳响应，系统包括：MCU模块、FPGA模块、DAC模块、激励电路、正交下变频电路、ADC模块以及显示器等外围交互设备。DAC模块为双路DAC。图3为本发明的实施例测量装置的电路逻辑图。实施例中激励电路将石英晶体与参考电阻进行串联分压，得到与晶体导纳相关的交流电压，并通过放大电路提供给后续模块。设当前幅度为As、频率为ω的激励信号Vs＝Ascosωt，石英晶体阻抗为ZQ，参考电阻为Rref，放大电路增益为Ap，可计算激励电路的电压输出Vod为：进一步的，令石英晶体与参考电阻的串联导纳为Y，其导纳角为即：代入上式，可得到激励电路电压输出为：实施例中正交下变频电路用于从激励电路输出的交流电压中提取电纳响应并转换至直流电压输出；具体的：首先使用乘法器将激励电路输出信号与参考信号混频，设与激励信号正交的参考信号Vq＝Aqsin，可得到乘法器输出Vm：其中Aod＝AsApRref。进一步使用低通滤波器滤除信号中的高频成分，得到最终的直流输出信号Vo：其中k＝AodAq/2，在本例中为恒定值，B则为石英晶体与参考电阻的串联电纳，同样可以用于石英晶体的谐振频率追踪。需要注意的是，实施例中将激励信号与参考信号进行了混频，目的是保证激励信号与参考信号的正交，消除由外部器件影响产生的相位差。如图1所示为本发明的测量方法，具体步骤如下：在测量开始前，设置激励石英晶体的激励信号的起始频率，设置频率追踪的PID参数，根据硬件系统执行一次电纳测量的最短耗时，设定单次电纳测量的间隔时间，设置允许的测量误差值范围；一般情况允许的测量误差值范围下限为0，上限设置为大于0的一个数，比如0.01。起始频率设置在预计谐振频率附近即可。单次间隔时间与硬件电路对当前电纳响应的获取速度有关，理论上间隔时间越小测量速度越快，但由于获取电纳响应的硬件系统具有一定的固有耗时，间隔时间太小会影响系统的测量精度。开始测量，向硬件系统给定激励信号的频率值，使其输出给定频率值的激励信号；等待设定的间隔时间后，从硬件系统获取石英晶体的电纳响应值，该响应值应与石英晶体的实际电纳值呈正比例关系；将石英晶体的电纳响应值与零值的差值作为PID控制策略的误差量，激励信号的频率作为被控量，进行PID控制；若电纳响应与零值的误差在可允许范围内，则将激励信号的频率值作为测量值输出，否则直接执行步骤；重复测量过程～。图4为实施例中FPGA内测量控制器的工作流程图，其中开始信号与配置参数通过AXI总线受MCU控制；数据稳定策略用于减少ADC本身不稳定导致的误差；PID控制策略采用电纳响应与零值的差值作为误差量，激励信号的输出频率为被控制量，构成负反馈环路进行谐振频率追踪；结果处理步骤用于判定当前误差是否在可接受误差范围内，若是，则返回测量结果，若不是，则进行下一轮追踪。数据稳定策略的工作流程图如图5所示，最终获取一段时间内ADC所采集的数据中稳定存在时间最长的数据值作为ADC的稳定采集结果进行输出，数据稳定策略为现有已知技术，本发明在此不做详细阐述。本实施例中可接受误差设置为0，即当ADC获取的电纳响应为0时，输出结果。对于PID控制部分，本实施例的控制算法如下式：f＝f+K]其中f为PID控制的输出，e为误差量，K为PID参数的比例系数，用于构建误差量与控制量之间的关系，同时也用于调整追踪策略的激进程度，当K的值越大，追踪速度越快，但测量的稳定性越差。采用上述实施例，即可对石英晶体谐振频率进行快速追踪，以测量标称为10MHz的晶振为例，将追踪起始频率设置为9.99MHz，单次电纳测量的间隔时间为0.5ms，使用本发明提出的测量系统对晶振进行测量，并记录频率的追踪过程，可得到如图6所示的结果，图6中提供了三种不同PID参数下的结果，分别对应着追踪策略由激进到平缓，追踪速度由快到慢。可以看到，在合适的参数下，使用本发明提出的方法与装置追踪石英晶体谐振频率时，可以在0.1s内追踪到当前频率点±8kHz范围的谐振频率变化，考虑到所追踪的石英晶体谐振频率变化过程是连续的，该指标能满足大部分高动态石英晶体传感应用。合适参数的取法为，系统能够正常测量的情况下，K值越大越好，正常测量指频率追踪结果能稳定在一个频率点。如图5所示，K＝0.4时，追踪结果在0.1s后稳定；K＝0.1时，追踪结果在0.6s后稳定；K＝0.05时，追踪结果在1.6s后稳定；因此合适的参数可以取值为K＝0.4。本领域的普通技术人员将会意识到，这里所述的实施例是为了帮助读者理解本发明的原理，应被理解为本发明的保护范围并不局限于这样的特别陈述和实施例。对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的权利要求范围之内。
