标题title
基于机器视觉的贴片电路板生产缺陷检测方法
摘要abst
本发明涉及图像数据处理技术领域，具体涉及一种基于机器视觉的贴片电路板生产缺陷检测方法。该方法通过对贴片电路板图像中的线路边缘线段的梯度方向得到疑似缺陷线路边缘线段，对疑似缺陷线路边缘线段的边缘像素点的梯度方向进行分析得到疑似缺陷线路边缘线段上边缘像素点的高度，根据边缘像素点的高度得到疑似缺陷区域，根据疑似缺陷区域面积、边缘像素点高度和边缘像素点的梯度方向得到疑似缺陷区域的缺陷概率，根据缺陷概率实现贴片电路板生产缺陷检测。
权利要求书clms
1.基于机器视觉的贴片电路板生产缺陷检测方法，其特征在于，所述方法包括：获取贴片电路板图像；所述贴片电路板图像中包含至少两个直线线路区域，每个所述直线线路区域包含两条线路边缘线段；将每条所述线路边缘线段进行分段，获得对应的至少两个新线路边缘线段；将相邻且边缘像素点梯度方向分布混乱的所述新线路边缘线段合并为疑似缺陷线路边缘线段，统计所述疑似缺陷线路边缘线段上各边缘像素点的梯度方向得到梯度方向向量，通过所述梯度方向向量得到所述疑似缺陷线路边缘线段上各边缘像素点对应的边缘像素点高度；通过所述边缘像素点高度得到所述疑似缺陷线路边缘线段上的极值点，将所述疑似缺陷线路边缘线段上极值点两侧的曲线段记为疑似缺陷区域，根据每个所述疑似缺陷区域中像素点数量得到缺陷区域面积；根据所述缺陷区域面积和所述极值点的高度以及所述边缘像素点的梯度方向得到所述疑似缺陷区域的缺陷概率，通过对所述缺陷概率设定缺陷阈值完成对贴片电路板生产缺陷的检测。2.根据权利要求1所述的基于机器视觉的贴片电路板生产缺陷检测方法，其特征在于，所述新线路边缘线段的获取方法包括：对所述贴片电路板图像通过边缘细化和直线检测得到线路边缘线段，计算所述线路边缘线段上每个边缘像素点梯度方向的角度的信息熵和每个所述线路边缘线段长度，根据所述信息熵和所述线路边缘长度将每个所述线路边缘线段分割为至少两个新线路边缘线段。3.根据权利要求2所述的基于机器视觉的贴片电路板生产缺陷检测方法，其特征在于，所述获取所述线路边缘线段上每个边缘像素点梯度方向的角度的信息熵的方法包括：利用sobel算子获取所述贴片电路板图像内所述线路边缘线段上每个边缘像素点的梯度方向的角度，并将所述梯度方向的角度分为两个以上角度种类，根据所述角度种类计算所述线路边缘线段上每个边缘像素点梯度方向的角度的信息熵。4.根据权利要求2所述的基于机器视觉的贴片电路板生产缺陷检测方法，其特征在于，所述根据所述信息熵和所述线路边缘长度将每个所述线路边缘线段分割为至少两个新线路边缘线段包括：根据所述信息熵和所述线路边缘长度通过线路边缘线段分割模型将每个所述线路边缘线段分割为至少两个新线路边缘线段，所述线路边缘线段分割模型包括：其中，为第/＞个所述线路边缘线段需要分割段数，/＞为第/＞个所述线路边缘线段对应的所述信息熵，/＞为所述信息熵中的最大值，/＞为第/＞个所述线路边缘线段的长度，/＞表示所述线路边缘线段的长度最大值，/＞为预设最大分段数量；通过所述线路边缘线段分割模型将每个所述线路边缘线段分割为一个以上新线路边缘线段。5.根据权利要求1所述的基于机器视觉的贴片电路板生产缺陷检测方法，其特征在于，所述疑似缺陷线路包括：计算每个所述新线路边缘线段各边缘像素点的梯度方向的方差，采用K-means聚类算法根据所述方差的数值对所述梯度方向的角度的方差进行分类得到两个以上线段类别，将所述方差类别中数值非最小的方差对应的线段类别为梯度方向混乱类别，将所述梯度方向混乱类别中的所述新线路边缘线段记为疑似缺陷线路边缘线段，并将混乱类别中相邻的所述新线路边缘线段合并为疑似缺陷线路边缘线段。6.根据权利要求1所述的基于机器视觉的贴片电路板生产缺陷检测方法，其特征在于，所述通过所述梯度方向向量得到所述疑似缺陷线路边缘线段上各边缘像素点对应的边缘像素点高度包括：根据所述梯度方向向量通过像素点高度计算模型得到所述疑似缺陷线路边缘线段上各边缘像素点对应的边缘像素点高度，所述像素点高度计算模型包括：其中，为前/＞个所述梯度方向向量的和的模，/＞为第/＞个所述梯度方向向量，/＞表示预设高度为0的梯度方向向量，/＞为前/＞个所述梯度方向向量的和，/＞表示预设高度为0的梯度方向向量的模，/＞为第/＞个边缘像素点对应的边缘像素点高度；根据所述像素点高度计算模型得到所有所述疑似缺陷线路边缘线段上各边缘像素点对应的边缘像素点高度。7.根据权利要求1所述的基于机器视觉的贴片电路板生产缺陷检测方法，其特征在于，所述获得所述疑似缺陷线路边缘线段上的极值点方法包括：统计目标疑似缺陷线路边缘线段上所有所述边缘像素点的高度，利用最小二乘法对所有所述边缘像素点的高度进行波动曲线拟合得到所述疑似缺陷线路边缘线段上的极值点；改变目标疑似缺陷线路边缘线段得到所有疑似缺陷线路边缘线段的极值点。8.根据权利要求1所述的基于机器视觉的贴片电路板生产缺陷检测方法，其特征在于，所述缺陷区域面积的获取方法包括：将梯度方向垂直于线路的边缘像素点记为正常边缘像素点，获得每个极值点与相邻正常边缘像素点之间曲线，所述曲线与所述相邻正常边缘像素点所围成的区域为缺陷区域；以所述缺陷区域中的像素点数量作为缺陷区域面积。9.根据权利要求7所述的基于机器视觉的贴片电路板生产缺陷检测方法，其特征在于，所述疑似缺陷区域的缺陷概率的获取方法包括：根据所述缺陷区域面积和所述极值点的高度以及所述边缘像素点的梯度方向通过缺陷概率模型得到所述疑似缺陷区域的缺陷概率，所述缺陷概率模型包括：其中，为目标疑似缺陷区域的缺陷概率，/＞为目标疑似缺陷区域的所述极值点对应的边缘像素点高度，/＞为所述目标疑似缺陷区域的所述缺陷区域面积，/＞为所述目标疑似缺陷区域的边缘像素点数量，/＞为所述疑似缺陷线路边缘线段上正常边缘像素点的梯度方向的角度的均值，/＞为所述目标疑似缺陷区域内第/＞个边缘像素点的梯度方向的角度；改变目标疑似缺陷区域得到所有所述疑似缺陷区域的缺陷概率。
说明书desc
技术领域本发明涉及图像数据处理技术领域，具体涉及一种基于机器视觉的贴片电路板生产缺陷检测方法。背景技术贴片电路板作为微型电子产品中非常重要的基础设备，随着科技的进步，相应的其制造工艺和水平越来越复杂，使得对贴片电路板质量检测要求也越来越严苛，因此在贴片电路板的生产过程中，需要对贴片电路板进行生产缺陷检测；但是人工目视检测的线路缺陷检测方法由于容易导致漏检和误检，速度较慢且成本高，因此现有技术中基于深度学习的电路板表面缺陷检测方法能够有效的提高检测精度和检测效率。发明人在实践中，发现上述现有技术存在以下缺陷：现有技术中基于深度学习的电路板表面缺陷检测方法通过光电传感模块和深度学习模型完成对电路板的缺陷检测，该方法由于根据光电传感模块得到的图像特征进行深度学习，对于贴片电路板表面毛刺和缺口等微小表面缺陷检测不够准确，而且考虑到通过深度学习的方法完成电路板的缺陷检测需要大量的历史数据作为学习成本，相对来说成本较高；所以现有技术中贴片电路板生产缺陷检测方法成本过高且不够准确。发明内容为了解决现有技术中贴片电路板生产缺陷检测成本高且不准确的技术问题，本发明的目的在于提供一种基于机器视觉的贴片电路板生产缺陷检测方法，所采用的技术方案具体如下：本发明提出了一种基于机器视觉的贴片电路板生产缺陷检测方法，所述方法包括：获取贴片电路板图像；所述贴片电路板图像中包含至少两个直线线路区域，每个所述直线线路区域包含两条线路边缘线段；将每条所述线路边缘线段进行分段，获得对应的至少两个新线路边缘线段；将相邻且边缘像素点梯度方向分布混乱的所述新线路边缘线段合并为疑似缺陷线路边缘线段，统计所述疑似缺陷线路边缘线段上各边缘像素点的梯度方向得到梯度方向向量，通过所述梯度方向向量得到所述疑似缺陷线路边缘线段上各边缘像素点对应的边缘像素点高度；通过所述边缘像素点高度得到所述疑似缺陷线路边缘线段上的极值点，将所述疑似缺陷线路边缘线段上极值点两侧的曲线段记为疑似缺陷区域，根据每个所述疑似缺陷区域中像素点数量得到缺陷区域面积；根据所述缺陷区域面积和所述极值点的高度以及所述边缘像素点的梯度方向得到所述疑似缺陷区域的缺陷概率，通过对所述缺陷概率设定缺陷阈值完成对贴片电路板生产缺陷的检测。进一步地，所述新线路边缘线段的获取方法包括：对所述贴片电路板图像通过边缘细化和直线检测得到线路边缘线段，计算所述线路边缘线段上每个边缘像素点梯度方向的角度的信息熵和每个所述线路边缘线段长度，根据所述信息熵和所述线路边缘长度将每个所述线路边缘线段分割为至少两个新线路边缘线段。进一步地，所述获取所述线路边缘线段上每个边缘像素点梯度方向的角度的信息熵的方法包括：利用sobel算子获取所述贴片电路板图像内所述线路边缘线段上每个边缘像素点的梯度方向的角度，并将所述梯度方向的角度分为两个以上角度种类，根据所述角度种类计算所述线路边缘线段上每个边缘像素点梯度方向的角度的信息熵。进一步地，所述根据所述信息熵和所述线路边缘长度将每个所述线路边缘线段分割为至少两个新线路边缘线段包括：根据所述信息熵和所述线路边缘长度通过线路边缘线段分割模型将每个所述线路边缘线段分割为至少两个新线路边缘线段，所述线路边缘线段分割模型包括：其中，为第/＞个所述线路边缘线段需要分割段数，/＞为第/＞个所述线路边缘线段对应的所述信息熵，/＞为所述信息熵中的最大值，/＞为第/＞个所述线路边缘线段的长度，/＞表示所述线路边缘线段的长度最大值，/＞为预设最大分段数量；通过所述线路边缘线段分割模型将每个所述线路边缘线段分割为一个以上新线路边缘线段。进一步地，所述疑似缺陷线路包括：计算每个所述新线路边缘线段各边缘像素点的梯度方向的方差，采用K-means聚类算法根据所述方差的数值对所述梯度方向的角度的方差进行分类得到两个以上线段类别，将所述方差类别中数值非最小的方差对应的线段类别为梯度方向混乱类别，将所述梯度方向混乱类别中的所述新线路边缘线段记为疑似缺陷线路边缘线段，并将混乱类别中相邻的所述新线路边缘线段合并为疑似缺陷线路边缘线段。进一步地，所述通过所述梯度方向向量得到所述疑似缺陷线路边缘线段上各边缘像素点对应的边缘像素点高度包括：根据所述梯度方向向量通过像素点高度计算模型得到所述疑似缺陷线路边缘线段上各边缘像素点对应的边缘像素点高度，所述像素点高度计算模型包括：其中，为前/＞个所述梯度方向向量的和的模，/＞为第/＞个所述梯度方向向量，/＞表示预设高度为0的梯度方向向量，/＞为前/＞个所述梯度方向向量的和，/＞表示预设高度为0的梯度方向向量的模，/＞为第/＞个边缘像素点对应的边缘像素点高度；根据所述像素点高度计算模型得到所有所述疑似缺陷线路边缘线段上各边缘像素点对应的边缘像素点高度。进一步地，所述获得所述疑似缺陷线路边缘线段上的极值点方法包括：统计目标疑似缺陷线路边缘线段上所有所述边缘像素点的高度，利用最小二乘法对所有所述边缘像素点的高度进行波动曲线拟合得到所述疑似缺陷线路边缘线段上的极值点；改变目标疑似缺陷线路边缘线段得到所有疑似缺陷线路边缘线段的极值点。进一步地，所述缺陷区域面积的获取方法包括：将梯度方向垂直于线路的边缘像素点记为正常边缘像素点，获得每个极值点与相邻正常边缘像素点之间曲线，所述曲线与所述相邻正常边缘像素点所围成的区域为缺陷区域；以所述缺陷区域中的像素点数量作为缺陷区域面积。进一步地，所述疑似缺陷区域的缺陷概率的获取方法包括：根据所述缺陷区域面积和所述极值点的高度以及所述边缘像素点的梯度方向通过缺陷概率模型得到所述疑似缺陷区域的缺陷概率，所述缺陷概率模型包括：其中，为目标疑似缺陷区域的缺陷概率，/＞为目标疑似缺陷区域的所述极值点对应的边缘像素点高度，/＞为所述目标疑似缺陷区域的所述缺陷面积，/＞为所述目标疑似缺陷区域的边缘像素点数量，/＞为所述疑似缺陷线路边缘线段上正常边缘像素点的梯度方向的角度的均值，/＞为所述目标疑似缺陷区域内第/＞个边缘像素点的梯度方向的角度；改变目标疑似缺陷区域得到所有所述疑似缺陷区域的缺陷概率。本发明具有如下有益效果：本发明实施例考虑到贴片电路板的毛刺缺陷和缺口缺陷相对来说比较微小的特征，根据新线路边缘线段上边缘像素点的梯度方向识别出疑似缺陷线路边缘线段，进而对疑似缺陷线路边缘线段进行着重分析，减少了计算的数据量的同时提高了检测精度；本发明实施例考虑到疑似缺陷区域由于可能存在少部分的像素点梯度方向变化剧烈但是疑似缺陷区域整体并不符合毛刺和缺口的特征的情况，根据边缘像素点的高度得到缺陷区域面积实现对疑似缺陷区域中缺陷特征进行量化处理，进一步根据缺陷面积、边缘像素点高度和边缘像素点的梯度方向得到疑似缺陷区域的缺陷概率，使得所得到的缺陷概率更加准确；本发明实施例仅基于贴片电路板的图像数据完成生产缺陷检测，相比于采用深度学习中需要获得大量的历史数据的方法成本更低；本发明在保证缺陷检测准确性的同时成本低。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案和优点，下面将对实施例或现有技术描述中所需要使用的附图作简单的介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其它附图。图1为本发明一个实施例所提供的一种基于机器视觉的贴片电路板生产缺陷检测方法流程图。具体实施方式为了更进一步阐述本发明为达成预定发明目的所采取的技术手段及功效，以下结合附图及较佳实施例，对依据本发明提出的一种基于机器视觉的贴片电路板生产缺陷检测方法，其具体实施方式、结构、特征及其功效，详细说明如下。在下述说明中，不同的“一个实施例”或“另一个实施例”指的不一定是同一实施例。此外，一或多个实施例中的特定特征、结构或特点可由任何合适形式组合。除非另有定义，本文所使用的所有的技术和科学术语与属于本发明的技术领域的技术人员通常理解的含义相同。下面结合附图具体的说明本发明所提供的一种基于机器视觉的贴片电路板生产缺陷检测方法的具体方案。请参阅图1，其示出了本发明一个实施例提供的基于机器视觉的贴片电路板生产缺陷检测方法流程图，该方法包括：步骤S1：获取贴片电路板图像；贴片电路板图像中包含至少两个直线线路区域，每个直线线路区域包含两条线路边缘线段。本发明在贴片电路板的生产过程中对蚀刻工序后的线路进行缺陷检测，因此需要在贴片电路板的正上方垂直于贴片电路板设置图像采集设备，以采集能够清楚的显示贴片电路板线路区域的贴片电路板图像。但是由于本发明是对贴片电路板中线路的毛刺和缺口的微小缺陷进行检测，因此所设置的图像采集设备需要保证采集的图像分辨率足够高以及图像足够清晰。在本发明实施例中，将工业高分辨率相机作为图像采集设备采集贴片电路板图像。考虑到贴片电路板图像上的线路区域的像素值与贴片电路板图像上其他区域的像素值存在明显差异，因此对所采集到的贴片电路板图像进行灰度化处理得到贴片电路板灰度图像，然后对贴片电路板灰度图像进行阈值分割获取贴片电路板图像上的线路区域。而且由于采集贴片电路板图像的过程中，会不可避免的出现噪声对电路板图像清晰度造成影响，因此需要对贴片电路板灰度图像进行去噪处理以消除贴片电路板灰度图像的噪声。因为在贴片电路板蚀刻工序中，贴片电路板表面缺陷中最为常见的线路缺陷为凸起的毛刺缺陷和凹陷的缺口缺陷，因此本发明为检测贴片电路板上线路的毛刺缺陷和缺口缺陷。需要说明的是，图像去噪为和阈值分割本领域技术人员所熟知的现有技术，在此不做进一步限定和赘述。并且为了便于后续对贴片电路板线路的分析，后续贴片电路板图像仅为去噪后的贴片电路板灰度图像。由于贴片电路板图像中线路会存在转折，使得如果直接对贴片电路板中的线路进行分析会存在误差导致后续缺陷检测不够准确，因此需要消除线路转折的影响；本发明采用直线检测的方法将贴片电路板图像中的线路分为两个以上直线段。为了使得直线检测更加准确，在进行直线检测之前首先对贴片电路板的线路区域进行形态学细化操作，将其沿各线路的中心轴线细化为一个像素宽的线条，再利用直线检测方法将细化后的线条分割为各直线段，即直线段对应的线路区域为直线线路区域，取直线线路区域的垂直于线路区域细化后的线条的个直线两侧的边缘线段，进而获得每个直线线路直线区域对应的两条线路边缘线段。步骤S2：将每条线路边缘线段进行分段，获得对应的至少两个新线路边缘线段。至此，通过步骤S1得到贴片电路板图像中每个直线线路区域对应的两个线路边缘线段，进一步在获得的线路边缘线段的基础上完成对贴片电路板的缺陷检测。但是由于贴片电路板上的线路毛刺缺陷和缺口缺陷非常微小，所以直接对线路边缘线段进行缺陷检测会使得后续的计算量非常大。因此为了减少计算量，本发明对线路区域的线路边缘线段进行分段处理。因为当贴片电路板图像的线路边缘线段中不存在毛刺缺陷和缺口缺陷时，该线路边缘线段上的像素点的梯度方向一定一致；相反的当贴片电路板图像的线路边缘线段中存在毛刺缺陷和缺口缺陷时，该线路边缘线段上边缘像素点的梯度方向会存在多个种类，且当线路边缘线段的毛刺缺陷和缺口缺陷的特征越明显时，该线路边缘线段上边缘像素点的梯度方向分布越混乱，所以引入信息熵来量化梯度方向分布的混乱程度，当线路边缘线段上边缘像素点的梯度分布越混乱时，该线路线段需要分割的段数越多，以防止每段存在多个缺陷。信息熵的具体获取方法包括：利用sobel算子获取贴片电路板图像内线路边缘线段上每个边缘像素点的梯度方向的角度，并将梯度方向的角度分为两个以上角度种类，根据角度种类计算线路边缘线段上每个边缘像素点梯度方向的信息熵，该线路边缘线段上边缘像素点的梯度方向的信息熵表达式为：其中，H为线路边缘线段上边缘像素点的梯度方向的信息熵，为该线路边缘线段上角度为第/＞种角度种类的梯度方向对应的边缘像素点在该线路边缘线段上总边缘像素点的数量占比。需要说明的是，信息熵为本领域技术人员所熟知的现有技术，在此不做进一步赘述。在对线路边缘线段进行分段时，除了需要对将梯度方向混乱的线路边缘线段进行分段，还需要考虑到线路边缘线段过长的情况，当线路边缘线段的长度越大，对应的计算量也会增加，因此在对边缘线路线段进行分段时，还需要考虑到每个线路边缘线段的长度。在获得每个线路边缘线段长度和对应的信息熵之后，通过线路边缘线段分割模型将每个线路边缘线段分割为至少两个新线路边缘线段，线路边缘线段分割模型包括：其中，为第/＞个线路边缘线段需要分割段数，/＞为第/＞个线路边缘线段对应的所述信息熵，/＞为所有信息熵中的最大值，/＞为第/＞个线路边缘线段的长度，/＞表示所有线路边缘线段的长度最大值，/＞为预设最大分段数量；在本发明实施例中，预设最大分段数量/＞设置为30。需要说明的是，预设最大分段数量需要根据实施的情况自行调整。在线路边缘线段分割模型中，和/＞均表示归一化处理，通过/＞将信息熵归一化，通过/＞将线路边缘的长度归一化，使得后续选取的分割段数过程更加方便。对应的，当线路边缘线段的信息熵越大，长度越长，则需要分割的段数越多。即以信息熵和长度的归一化取值的累加的平均值作为线路边缘线段所需分割段数的主要指标，获取线路边缘线段所需分割段数需要分割的段数。通过线路边缘分割模型根据每个线路边缘线段的长度和对应的信息熵将每个线路边缘线段划分为一个以上新线路边缘线段。步骤S3：将相邻且边缘像素点灰度梯度方向分布混乱的新线路边缘线段合并为疑似缺陷线路边缘线段，统计疑似缺陷线路边缘线段上各边缘像素点的灰度梯度得到灰度梯度向量，通过灰度梯度向量得到疑似缺陷线路边缘线段上各边缘像素点对应的边缘像素点高度。至此，通过步骤S2将每个线路边缘线段划分为一个以上新线路边缘线段。考虑到本发明主要解决的问题为贴片电路板上的毛刺缺陷和缺口缺陷等微小的表面缺陷检测，因此需要检测出能够体现毛刺缺陷和缺口缺陷的特征。对于该两种缺陷，均可采用缺陷中的像素点所处的位置与正常情况下像素点所处的位置进行对比来识别出缺陷特征，但是由于这两种缺陷过于微小，不能够准确的识别出每个像素点所处的位置，因此可根据每个像素点的梯度方向，逐像素点进行分析进而得到每个像素点的高度来进一步表征缺陷特征。在得到新线路边缘线段后，由于贴片线路板的毛刺缺陷和缺口缺陷在整体线路上仅为一小部分甚至不存在，如果对所有的新线路边缘线段进行分析，会产生大量的无效计算，因此需要着重对可能存在毛刺缺陷和缺口缺陷的新线路边缘线段进行分析。可能存在毛刺缺陷和缺口缺陷的新线路边缘线段相比于不存在缺陷的新线路边缘线段来说，其线路边缘会发生显著变化，将该线路边缘的显著变化特征量化后，可能存在毛刺缺陷和缺口缺陷的新线路边缘线段上各边缘像素点的梯度方向会产生明显的变化，即梯度方向分布混乱；而不存在缺陷的新线路边缘线段上的各边缘像素点的梯度方向相似。因此为了识别出贴片电路板上的毛刺缺陷和缺口缺陷，需要对各个新线路边缘线段的各边缘像素点的梯度分析，具体的：首先计算每个新线路边缘线段各边缘像素点的梯度方向的方差，考虑到通过方差能够直观的展示出每个边缘像素点的梯度方向数据的均匀程度，因此当方差较大时，对应的线段类别中的新线路边缘线段可能存在缺陷。采用K-means聚类算法根据每个方差的数值对梯度的角度的方差进行分类得到两个以上线段类别。将方差类别中数值非最小的方差对应的线段类别记为梯度方向混乱类别，将所述梯度方向混乱类别中的新线路边缘线段记为疑似缺陷线路边缘线段，并将混乱类别中相邻的所述新线路边缘线段合并为疑似缺陷线路边缘线段。在本发明实施例中，所采用的K-means聚类算法中将聚类簇设置为2，即存在两个线段类别，其中方差较大的线段类别为梯度方向混乱类别。需要说明的是，K-means聚类算法为本领域技术人员所熟知的现有技术，在此不做进一步限定和赘述。在获取疑似缺陷线路边缘线段之后，根据疑似线路边缘上每个像素点的梯度方向逐像素点计算，得到每个像素点对应的高度，具体的：从疑似缺陷线路边缘线段其中一端的端点出发，逐像素点计算该疑似缺陷线路边缘线段上各个边缘像素点的梯度方向，每个梯度方向为一个向量。考虑到贴片电路板上线路区域的边缘像素点的灰度值相似，因此可认为疑似缺陷线路边缘线段上各个边缘像素点的梯度方向的模相似。当疑似缺陷线路边缘线段上存在毛刺缺陷或缺口缺陷时，缺陷区域的边缘像素点梯度方向求和后的方向变化大，且每个边缘像素点的高度会产生明显的变化，当疑似缺陷线路边缘线段上不存在毛刺缺陷或缺口缺陷时，边缘像素点梯度方向求和后的方向变化不大，且每个边缘像素点的高度并不会产生明显变化。因此可根据梯度方向向量通过像素点高度计算模型得到疑似缺陷线路边缘线段上各边缘像素点对应的边缘像素点高度，像素点高度计算模型包括：其中，为前/＞个梯度方向向量的和的模，/＞为第/＞个梯度方向向量，/＞表示预设高度为0的梯度方向向量，/＞为前/＞个梯度方向向量的和，/＞表示预设高度为0的梯度方向向量的模，/＞为第/＞个边缘像素点对应的边缘像素点高度。根据像素点高度计算模型得到所有疑似缺陷线路边缘线段上各边缘像素点对应的边缘像素点高度像素点高度计算模型根据向量求和的三角形法则计算出每个边缘像素点的高度，当疑似缺陷线路边缘线段不存在缺陷时，求和后的梯度方向变化不大且各个边缘像素点的高度基本一致；相对的，当疑似缺陷线路边缘线段存在缺陷时，求和后的梯度方向变化较大且各个边缘像素点的高度会存在明显不一致的情况。考虑到疑似缺陷线路边缘线段上各个边缘像素点的梯度方向的模相似，因此边缘像素点的高度仅和缺陷位置的边缘像素点的梯度方向有关，在贴片电路板图像上表现为毛刺缺陷凸起程度越高或缺口缺陷凹陷深度越深，对应的边缘像素点的高度变化越大，从非缺陷区域的边缘像素点到缺陷区域的边缘像素点对应的边缘像素点的高度逐渐增大直至达到毛刺缺陷的最顶处和缺口缺陷的最深处，然后从毛刺缺陷的最顶处和缺口缺陷的最深处的边缘像素点向非缺陷区域的边缘像素点对应的边缘像素点的高度逐渐减小。步骤S4：通过边缘像素点高度得到疑似缺陷线路边缘线段上的极值点，将疑似缺陷线路边缘线段上极值点两侧的曲线段记为疑似缺陷区域，根据每个疑似缺陷区域中像素点数量得到缺陷区域面积；根据缺陷区域面积和极值点的高度以及边缘像素点的灰度梯度得到疑似缺陷区域的缺陷概率，通过对缺陷概率设定缺陷阈值完成对贴片电路板生产缺陷的检测。至此，通过步骤S3得到每个疑似缺陷线路边缘线段上每个边缘像素点的高度。但是仅仅根据边缘像素点的高度来判定该疑似缺陷线路边缘线段是否存在缺陷并不准确，因此需要根据毛刺缺陷和缺口缺陷的其他特征进一步判断疑似缺陷线路边缘线段上存在缺陷的概率。考虑到当毛刺缺陷和缺口缺陷的缺陷特征越明显时，对应的毛刺缺陷中凸出部分的像素点和缺口缺陷中凹陷部分的像素点的数量会越大，因此本发明引入缺陷面积来表征缺陷部分像素点数量。统计每个疑似缺陷线路边缘线段上每个边缘像素点的高度，利用最小二乘法对所有边缘像素点的高度进行波动曲线拟合，得到每个疑似缺陷的极值点，每个疑似缺陷的极值点对应疑似缺口缺陷的凹陷深度或者毛刺缺陷的凸起高度。当疑似缺陷的极值点高度小于0时，对应疑似缺口缺陷的凹陷深度；当疑似缺陷的极值点高度大于0时，对应毛刺缺陷的凸起高度。需要说明的是，利用最小二乘法进行波动曲线拟合的方法为本领域技术人员所熟知的现有技术，在此不做进一步限定和赘述。缺陷面积需要考虑到缺陷部分的像素点数量，而缺陷部分的获取方法为：将梯度方向垂直于线路的边缘像素点记为正常边缘像素点，获得每个极值点与相邻正常边缘像素点之间曲线，将曲线与相邻正常边缘像素点所围成的区域记为疑似缺陷区域。疑似缺陷区域为所需要获取的缺陷部分。在获取缺陷区域之后，将疑似缺陷区域内的像素点数量记为缺陷区域面积。根据所获得的疑似缺陷区域的极值点对应的边缘像素点高度和缺陷面积能够表征该疑似缺陷区域的缺陷程度，但是不能够完全根据缺陷程度判定该疑似缺陷区域为缺陷，考虑到疑似缺陷区域的凹陷或者凸起的陡峭程度也会对缺陷的判定造成影响，因此引入疑似缺陷区域边缘像素点的梯度方向的角度来表征疑似缺陷区域的凹陷或者凸起的陡峭程度。根据缺陷区域面积和极值点的高度以及边缘像素点的梯度方向通过缺陷概率模型得到所述疑似缺陷区域的缺陷概率，缺陷概率模型包括：其中，为疑似缺陷区域的缺陷概率，/＞为疑似缺陷区域的极值点对应的边缘像素点高度，/＞为疑似缺陷区域的缺陷面积，/＞为疑似缺陷区域的边缘像素点数量，/＞为疑似缺陷线路边缘线段上正常边缘像素点的梯度方向的角度的均值，/＞为目标疑似缺陷区域内第/＞个边缘像素点的梯度方向的角度，分母设置为180目的是归一化处理。表示该极值点对应的疑似缺陷区域的凹陷深度或者凸起高度，其值越大，说明该疑似缺陷区域的凹陷深度或者凸起高度越大。/＞表示该极值点对应的疑似缺陷区域的凹陷或者凸起面积，其值越大，说明说明该疑似缺陷区域的面积越大，而/＞的值越大对应的该疑似缺陷区域为真正的缺陷概率越大。此外/＞对应疑似缺陷边缘像素点与正常边缘像素点的梯度方向差异，对应的/＞越大，表示该疑似缺陷边缘像素点与正常边缘像素点的梯度方向差异越大，/＞在整体上表征该疑似缺陷区域的凹陷或者凸起的陡峭程度，其值越大，该疑似缺陷区域为真正缺陷的概率越大。该缺陷概率模型考虑到疑似缺陷区域的缺陷部分像素点数量和边缘像素点的梯度方向，即考虑到疑似缺陷区域的缺陷程度以及缺陷区域的凹陷和凸起的陡峭程度，使得所得到的疑似缺陷区域的缺陷概率更加准确。根据所得到的每个疑似缺陷区域的缺陷概率进行进一步的判定即可完成对贴片电路板的生产缺陷检测，具体的：统计疑似缺陷线路边缘线段上各个疑似缺陷区域的缺陷概率得到一组缺陷概率数据，计算每组缺陷概率数据的均值，以每组缺陷概率数据的均值的预设倍数作为缺陷阈值，将大于缺陷阈值的缺陷概率对应的疑似缺陷区域记为真正的缺陷，将小于等于缺陷阈值的缺陷概率对应的疑似缺陷区域记为无缺陷。在本发明实施例中，将预设倍数设置为0.7倍，即以每组缺陷概率数据的均值的0.7倍作为缺陷阈值。通过贴片电路板上所有疑似缺陷区域的缺陷判定完成贴片电路板生产缺陷检测。综上所述，本发明通过对贴片电路板图像中的线路边缘线段的梯度方向得到疑似缺陷线路边缘线段，对疑似缺陷线路边缘线段的边缘像素点的梯度方向进行分析得到疑似缺陷线路边缘线段上边缘像素点的高度，根据边缘像素点的高度得到疑似缺陷区域，根据疑似缺陷区域面积、边缘像素点高度和边缘像素点的梯度方向得到疑似缺陷区域的缺陷概率，根据缺陷概率实现对贴片电路板生产缺陷检测。需要说明的是：上述本发明实施例先后顺序仅仅为了描述，不代表实施例的优劣。在附图中描绘的过程不一定要求示出的特定顺序或者连续顺序才能实现期望的结果。在某些实施方式中，多任务处理和并行处理也是可以的或者可能是有利的。本说明书中的各个实施例均采用递进的方式描述，各个实施例之间相同相似的部分互相参见即可，每个实施例重点说明的都是与其他实施例的不同之处。
