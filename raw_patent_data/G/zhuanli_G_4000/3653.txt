标题title
一种柱状图堆叠显示方法及装置
摘要abst
本发明公开了一种柱状图堆叠显示方法及装置，该方法包括：获取待显示图表中某一列的统计数据，并将所述某一列的统计数据转换为若干个柱状图的第一坐标数据；根据所述若干个柱状图的第一坐标数据，对发生重叠的柱状图的坐标进行调节，得到所述若干个柱状图的第二坐标数据；根据预设的静态变量，对所述若干个柱状图的第二坐标数据进行绘制，渲染绘制后的所述若干个柱状图。采用本发明实施例，通过将图表的统计数据转换为坐标数据，利用坐标数据进行碰撞检测，从而实现对多个柱状图堆叠的衔接部分进行优化。
权利要求书clms
1.一种柱状图堆叠显示方法，其特征在于，包括：获取待显示图表中某一列的统计数据，并将所述某一列的统计数据转换为若干个柱状图的第一坐标数据；根据所述若干个柱状图的第一坐标数据，对发生重叠的柱状图的坐标进行调节，得到所述若干个柱状图的第二坐标数据；根据预设的静态变量，对所述若干个柱状图的第二坐标数据进行绘制，渲染绘制后的所述若干个柱状图。2.如权利要求1所述的柱状图堆叠显示方法，其特征在于，所述获取待显示图表中某一列的统计数据，并将所述某一列的统计数据转换为若干个柱状图的第一坐标数据，具体为：从图表库中获取所述待显示图表中某一列的统计数据；根据所述待显示图表的方向和自定义接口，将所述某一列的统计数据转换为网页坐标，在对所述网页坐标进行最小值高度补全后，得到所述若干个柱状图的第一坐标数据。3.如权利要求2所述的柱状图堆叠显示方法，其特征在于，所述根据所述待显示图表的方向和自定义接口，将所述某一列的统计数据转换为网页坐标，在对所述网页坐标进行最小值高度补全后，得到所述若干个柱状图的第一坐标数据，具体为：根据所述待显示图表的方向和自定义接口，将所述某一列的统计数据转换为所述若干个柱状图的网页坐标；其中，所述网页坐标包括：第一x轴坐标和第一y轴坐标；根据所述若干个柱状图的第一y轴坐标，计算每个柱状图的高度；将高度小于第一阈值的柱状图顶部的第一y轴坐标增加所述第一阈值，得到所述若干个柱状图的第一坐标数据。4.如权利要求1所述的柱状图堆叠显示方法，其特征在于，在所述获取待显示图表中某一列的统计数据，并将所述某一列的统计数据转换为若干个柱状图的第一坐标数据之后，包括：对所述若干个柱状图的第一坐标数据进行异常值检测，当发现某一柱状图的第一坐标数据为异常值时，停止对所述某一柱状图进行渲染。5.如权利要求4所述的柱状图堆叠显示方法，其特征在于，对所述若干个柱状图的第一坐标数据进行异常值检测，当发现某一柱状图的第一坐标数据为异常值时，停止对所述某一柱状图进行渲染，具体为：根据所述若干个柱状图的第二坐标数据，计算每个柱状图的顶部与底部的坐标差；当某一柱状图的顶部与底部的坐标差为0时，停止对所述某一柱状图进行渲染。6.如权利要求1所述的柱状图堆叠显示方法，其特征在于，所述根据所述若干个柱状图的第一坐标数据，对发生重叠的柱状图的坐标进行调节，得到所述若干个柱状图的第二坐标数据，具体为：从所述若干个柱状图的第一坐标数据中，获取任意两个相邻柱状图的第一坐标数据；其中，所述第一坐标数据包括第一顶部坐标和第一底部坐标；当任意两个相邻柱状图中的前一个柱状图的第一顶部坐标大于后一个柱状图的第一底部坐标时，调节所述后一个柱状图的底部坐标，以使所述后一个柱状图的第一底部坐标大于所述前一个柱状图的第一顶部坐标，得到所述若干个柱状图的第二坐标数据。7.如权利要求6所述的柱状图堆叠显示方法，其特征在于，所述调节所述后一个柱状图的第一底部坐标，以使所述后一个柱状图的第二底部坐标大于所述前一个柱状图的第一顶部坐标，具体为：将所述前一个柱状图的第一顶部坐标赋值给所述后一个柱状图的第一底部坐标，再将所述后一个柱状图的第一底部坐标增加间隙值。8.如权利要求1-6任意一项所述的柱状图堆叠显示方法，其特征在于，所述根据预设的静态变量，对所述若干个柱状图的第二坐标数据进行绘制，渲染绘制后的所述若干个柱状图，具体为：其中，所述预设的静态变量包括：柱状图高度和柱状图宽度；所述第二坐标数据包括：第二顶部坐标和第二底部坐标；对所述柱状图高度和所述柱状图宽度进行赋值；根据每个柱状图的第二顶部坐标、每个柱状图的第二底部坐标和旋转角度，计算得到每个柱状图中各个点的坐标；根据所述每个柱状图的各个点的坐标、所述柱状图高度和所述柱状图宽度，分别对每个柱状图的顶部和左右两侧进行绘制，得到绘制后的柱状图像，并对所述柱状图像进行渲染。9.一种柱状图堆叠显示装置，其特征在于，包括：数据获取模块、数据处理模块和图像显示模块；其中，所述数据获取模块用于获取待显示图表中某一列的统计数据，并将所述某一列的统计数据转换为若干个柱状图的第一坐标数据；所述数据处理模块用于根据所述若干个柱状图的第一坐标数据，对发生重叠的柱状图的坐标进行调节，得到所述若干个柱状图的第二坐标数据；所述图像显示模块用于根据预设的静态变量，对所述若干个柱状图的第二坐标数据进行绘制，渲染绘制后的所述若干个柱状图。10.如权利要求9所述的柱状图堆叠显示装置，其特征在于，所述数据处理模块，包括：数据获取单元和坐标调节单元；其中，所述数据获取单元用于从所述若干个柱状图的第一坐标数据中，获取任意两个相邻柱状图的第一坐标数据；其中，所述第一坐标数据包括第一顶部坐标和第一底部坐标；所述坐标调节单元用于当任意两个相邻柱状图中的前一个柱状图的第一顶部坐标大于后一个柱状图的第一底部坐标时，调节所述后一个柱状图的底部坐标，以使所述后一个柱状图的第一底部坐标大于所述前一个柱状图的第一顶部坐标，得到所述若干个柱状图的第二坐标数据。
说明书desc
技术领域本发明涉及数据显示技术领域，尤其涉及一种柱状图堆叠显示方法及装置。背景技术目前流行的可视化解决方案有Echarts、HighCharts、D3.js，这些解决方案中均未提供可直接使用的N层堆叠的3D柱状图组件。在详细调研流行的可视化解决方案后发现使用较为复杂且性能较差的“拼接法”可以生成简单的3D柱状图；即通过内置的矩形、菱形、三角形来拼接组合生成3D柱状图，具体做法为使用顶部菱形、中部矩形、中部三角形、中部矩形、中部三角形、底部三角形、底部三角形共7个子元素拼接组合而成3D柱状图。使用拼接法，每个3D柱状图具有7个子元素，如果N层3D柱状图堆叠，则有7×N个子元素，这种方法不仅在多个柱状图堆叠的衔接处出现碰撞，从而现有技术在多个3D柱状图堆叠的情况下，柱状图之间的衔接处优化较差。发明内容本发明提供了一种柱状图堆叠显示方法及装置，以解决现有技术在实现多个3D柱状图堆叠时，柱状图之间的衔接处优化较差的技术问题。为了解决上述技术问题，本发明实施例提供了一种柱状图堆叠显示方法，包括：获取待显示图表中某一列的统计数据，并将所述某一列的统计数据转换为若干个柱状图的第一坐标数据；根据所述若干个柱状图的第一坐标数据，对发生重叠的柱状图的坐标进行调节，得到所述若干个柱状图的第二坐标数据；根据预设的静态变量，对所述若干个柱状图的第二坐标数据进行绘制，渲染绘制后的所述若干个柱状图。本发明通过将待显示图表中的统计数据先转化为第一坐标数据，再利用第一坐标数据对各个柱状图堆叠时的衔接部分进行碰撞检测或对是否重叠进行检测，最后使用经坐标调节得到的第二坐标数据进行柱状图堆叠的绘制，从而优化了多个柱状图堆叠的衔接部分。进一步地，所述获取待显示图表中某一列的统计数据，并将所述某一列的统计数据转换为若干个柱状图的第一坐标数据，具体为：从图表库中获取所述待显示图表中某一列的统计数据；根据所述待显示图表的方向和自定义接口，将所述某一列的统计数据转换为网页坐标，在对所述网页坐标进行最小值高度补全后，得到所述若干个柱状图的第一坐标数据。进一步地，所述根据所述待显示图表的方向和自定义接口，将所述某一列的统计数据转换为网页坐标，在对所述网页坐标进行最小值高度补全后，得到所述若干个柱状图的第一坐标数据，具体为：根据所述待显示图表的方向和自定义接口，将所述某一列的统计数据转换为所述若干个柱状图的网页坐标；其中，所述网页坐标包括：第一x轴坐标和第一y轴坐标；根据所述若干个柱状图的第一y轴坐标，计算每个柱状图的高度；将高度小于第一阈值的柱状图顶部的第一y轴坐标增加所述第一阈值，得到所述若干个柱状图的第一坐标数据。本发明通过将待显示图表的统计数据转换为坐标数据，从而利用坐标数据和第一阈值进行最小高度的补全，避免因某一柱状图因小于最小高度而导致在堆叠的柱状图之间无法显示，实现对多个柱状图堆叠的衔接处进行优化。进一步地，在所述获取待显示图表中某一列的统计数据，并将所述某一列的统计数据转换为若干个柱状图的第一坐标数据之后，包括：对所述若干个柱状图的第一坐标数据进行异常值检测，当发现某一柱状图的第一坐标数据为异常值时，停止对所述某一柱状图进行渲染。进一步地，对所述若干个柱状图的第一坐标数据进行异常值检测，当发现某一柱状图的第一坐标数据为异常值时，停止对所述某一柱状图进行渲染，具体为：根据所述若干个柱状图的第二坐标数据，计算每个柱状图的顶部与底部的坐标差；当某一柱状图的顶部与底部的坐标差为0时，停止对所述某一柱状图进行渲染。本发明利用柱状图的第二坐标数据对异常值进行排除，避免了高度为0的坐标在最终绘制的某一列的若干个柱状图中出现，优化了多个柱状图堆叠的衔接处。进一步地，所述根据所述若干个柱状图的第一坐标数据，对发生重叠的柱状图的坐标进行调节，得到所述若干个柱状图的第二坐标数据，具体为：从所述若干个柱状图的第一坐标数据中，获取任意两个相邻柱状图的第一坐标数据；其中，所述第一坐标数据包括第一顶部坐标和第一底部坐标；当任意两个相邻柱状图中的前一个柱状图的第一顶部坐标大于后一个柱状图的第一底部坐标时，调节所述后一个柱状图的底部坐标，以使所述后一个柱状图的第一底部坐标大于所述前一个柱状图的第一顶部坐标，得到所述若干个柱状图的第二坐标数据。本发明采用利用第二坐标数据对相邻两个柱状图的顶部和底部进行比较，将碰撞的两个柱状图中的后一个柱状图的底部坐标进行调节，从而避免了两个柱状图之间的重叠，优化了多个柱状图堆叠的衔接部分。进一步地，所述调节所述后一个柱状图的第一底部坐标，以使所述后一个柱状图的第二底部坐标大于所述前一个柱状图的第一顶部坐标，具体为：将所述前一个柱状图的第一顶部坐标赋值给所述后一个柱状图的第一底部坐标，再将所述后一个柱状图的第一底部坐标增加间隙值。进一步地，所述根据预设的静态变量，对所述若干个柱状图的第二坐标数据进行绘制，渲染绘制后的所述若干个柱状图，具体为：其中，所述预设的静态变量包括：柱状图高度和柱状图宽度；所述第二坐标数据包括：第二顶部坐标和第二底部坐标；对所述柱状图高度和所述柱状图宽度进行赋值；根据每个柱状图的第二顶部坐标、每个柱状图的第二底部坐标和旋转角度，计算得到每个柱状图中各个点的坐标；根据所述每个柱状图的各个点的坐标、所述柱状图高度和所述柱状图宽度，分别对每个柱状图的顶部和左右两侧进行绘制，得到绘制后的柱状图像，并对所述柱状图像进行渲染。另一方面，本发明实施例还提供了一种柱状图堆叠显示装置，包括：数据获取模块、数据处理模块和图像显示模块；其中，所述数据获取模块用于获取待显示图表中某一列的统计数据，并将所述某一列的统计数据转换为若干个柱状图的第一坐标数据；所述数据处理模块用于根据所述若干个柱状图的第一坐标数据，对发生重叠的柱状图的坐标进行调节，得到所述若干个柱状图的第二坐标数据；所述图像显示模块用于根据预设的静态变量，对所述若干个柱状图的第二坐标数据进行绘制，渲染绘制后的所述若干个柱状图。本发明通过将待显示图表中的统计数据先转化为第一坐标数据，再利用第一坐标数据对各个柱状图堆叠时的衔接部分进行碰撞检测或对是否重叠进行检测，最后使用经坐标调节得到的第二坐标数据进行柱状图堆叠的绘制，从而优化了多个柱状图堆叠的衔接部分。进一步地，所述数据处理模块，包括：数据获取单元和坐标调节单元；其中，所述数据获取单元用于从所述若干个柱状图的第一坐标数据中，获取任意两个相邻柱状图的第一坐标数据；其中，所述第一坐标数据包括第一顶部坐标和第一底部坐标；所述坐标调节单元用于当任意两个相邻柱状图中的前一个柱状图的第一顶部坐标大于后一个柱状图的第一底部坐标时，调节所述后一个柱状图的底部坐标，以使所述后一个柱状图的第一底部坐标大于所述前一个柱状图的第一顶部坐标，得到所述若干个柱状图的第二坐标数据。本发明采用利用第二坐标数据对相邻两个柱状图的顶部和底部进行比较，将碰撞的两个柱状图中的后一个柱状图的底部坐标进行调节，从而避免了两个柱状图之间的重叠，优化了多个柱状图堆叠的衔接部分。附图说明图1为本发明提供的柱状图堆叠显示方法的一种实施例的流程示意图；图2为本发明提供的柱状图堆叠显示方法的另一种实施例的流程示意图；图3为本发明提供的柱状图堆叠显示装置的一种实施例的结构示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有作出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。请参照图1，为本发明提供的柱状图堆叠显示方法的一种实施例的流程示意图，包括步骤101-103，具体如下：步骤101：获取待显示图表中某一列的统计数据，并将所述某一列的统计数据转换为若干个柱状图的第一坐标数据。在本实施例中，步骤101具体包括步骤1011-1012，具体如下：步骤1011：从图表库中获取所述待显示图表中某一列的统计数据。在本实施例中，所述图标库为Echarts图标库；其为基于JavaScript的开源可视化图标库。步骤1012：根据所述待显示图表的方向和自定义接口，将所述某一列的统计数据转换为网页坐标，在对所述网页坐标进行最小值高度补全后，得到所述若干个柱状图的第一坐标数据。在本实施例中，所述步骤1012具体为：根据所述待显示图表的方向和自定义接口，将所述某一列的统计数据转换为所述若干个柱状图的网页坐标；根据所述若干个柱状图的第一y轴坐标，计算每个柱状图的高度；将高度小于第一阈值的柱状图顶部的第一y轴坐标增加所述第一阈值，得到所述若干个柱状图的第一坐标数据；其中，所述网页坐标包括：第一x轴坐标和第一y轴坐标。在本实施例中，获取到当前3D柱状图数据值后，还需要利用dataset计算当前3D柱状图之前的所有3D柱状图数据值之和。因为堆叠时有层级的关系，上一层级的3D柱状图数据值必须是与下一层级的3D柱状图数据值之和才能产生堆叠的效果，否则会出现柱状图部分或全部重叠的情况。此时得到了首坐标对应的数据值，尾坐标数据值即上述中当前3D柱状图之前的所有3D柱状图数据值之和。这里需要注意的是如果传入的direction为水平方向，获取数据值方法为：api.value，该数据值代表y轴；如果为竖直方向，获取数据值方法为：api.value，该数据值代表x轴。水平方向的x轴数值与竖直方向的y轴数值可以通过Echarts中custom的params.dataIndex获得。得到x、y轴分别对应的数据值后，可以调用api.coord得到顶部坐标与底部坐标；其中，3D柱状图由所述若干个柱状图堆叠得到。在本实施例中，所述第一阈值的范围为10-20px，优选为12px。在本实施例中，自定义接口包括：tooltip接口、xAxis接口、yAxis接口和legend接口等。在本实施例中，所述得到所述若干个柱状图的第一坐标数据之后，包括：将所述若干个柱状图的第一坐标数据保存至缓存中。本发明通过将待显示图表的统计数据转换为坐标数据，从而利用坐标数据和第一阈值进行最小高度的补全，避免因某一柱状图因小于最小高度而导致在堆叠的柱状图之间无法显示，实现对多个柱状图堆叠的衔接处进行优化。在本实施例中，在步骤101之后包括：对所述若干个柱状图的第一坐标数据进行异常值检测，当发现某一柱状图的第一坐标数据为异常值时，返还null并停止对所述某一柱状图进行渲染，具体为：根据所述若干个柱状图的第一坐标数据，计算每个柱状图的顶部与底部的坐标差；当某一柱状图的顶部与底部的坐标差为0时，停止对所述某一柱状图进行渲染。本发明利用柱状图的第二坐标数据对异常值进行排除，避免了高度为0的坐标在最终绘制的某一列的若干个柱状图中出现，优化了多个柱状图堆叠的衔接处。步骤102：根据所述若干个柱状图的第一坐标数据，对发生重叠的柱状图的坐标进行调节，得到所述若干个柱状图的第二坐标数据。在本实施例中，柱状图碰撞即指在多个柱状图堆叠的过程中，当前柱状图与前一个或后一个柱状图发生重叠的情况。步骤103：根据预设的静态变量，对所述若干个柱状图的第二坐标数据进行绘制，渲染绘制后的所述若干个柱状图。在本实施例中，步骤103具体包括步骤1031-103，具体如下：其中，所述预设的静态变量包括：柱状图宽度和柱状图高度；步骤1031：对所述柱状图高度和所述柱状图宽度进行赋值。在本实施例中，步骤1031具体为：将所述柱状图高度的赋值为5-15px，优选为10px；将所述柱状图宽度赋值为6-10px，优选为8px。在本实施例中，所述第二坐标数据包括：第二顶部坐标和第二底部坐标。步骤1032：根据每个柱状图的第二顶部坐标、每个柱状图的第二底部坐标和旋转角度，计算得到每个柱状图中各个点的坐标。步骤1033：根据所述每个柱状图的各个点的坐标、所述柱状图高度和所述柱状图宽度，分别对每个柱状图的顶部和左右两侧进行绘制，得到绘制后的柱状图像，并对所述柱状图像进行渲染。在本实施例中，绘制后的柱状图像返回至图表库，如Echarts图表库，中完成渲染。当3D柱状图坐标都完成了处理确保无误后，开始绘制图形。首先创建可全局统一修改的静态变量BAR_WIDTH、BAR_HEIGHT分别赋值10px、8px。其次使用首坐标与旋转角度计算得出顶部棱形的各个点坐标3DBarTop，然后绘制左、右俩个侧面3DBarLeft、3DBarRight，最终得到3DBar，将3DBar返回给Echarts即可完成渲染。其中，3DBar为绘制后的柱状图像。请参照图2，为本发明提供的柱状图堆叠显示方法的另一种实施例的流程示意图，包括步骤201-202，具体如下：在本实施例中，步骤102具体包括步骤201至步骤202。步骤201：从所述若干个柱状图的第一坐标数据中，获取任意两个相邻柱状图的第一坐标数据；其中，所述第一坐标数据包括第一顶部坐标和第一底部坐标。步骤202：当任意两个相邻柱状图中的前一个柱状图的第一顶部坐标大于后一个柱状图的第一底部坐标时，调节所述后一个柱状图的底部坐标，以使所述后一个柱状图的第一底部坐标大于所述前一个柱状图的第一顶部坐标，得到所述若干个柱状图的第二坐标数据。在本实施例中，所述调节所述后一个柱状图的底部坐标，以使所述后一个柱状图的底部坐标大于所述前一个柱状图的顶部坐标，具体为：将所述前一个柱状图的顶部坐标赋值给所述后一个柱状图的底部坐标，再将所述后一个柱状图的底部坐标增加间隙值。在本实施例中，间隙值的范围为1-20px，优选为10px。在本实施例中，所述顶部坐标为顶部y轴坐标，所述底部坐标为底部y轴坐标。本发明采用利用第二坐标数据对相邻两个柱状图的顶部和底部进行比较，将碰撞的两个柱状图中的后一个柱状图的底部坐标进行调节，从而避免了两个柱状图之间的重叠，优化了多个柱状图堆叠的衔接部分。请参照图3，为本发明提供的柱状图堆叠显示装置的一种实施例的结构示意图，该柱状图堆叠显示装置，包括：数据获取模块301、数据处理模块302和图像显示模块303。在本实施例中，数据获取模块301用于获取待显示图表中某一列的统计数据，并将所述某一列的统计数据转换为若干个柱状图的第一坐标数据。在本实施例中，数据获取模块301包括：第二数据获取单元和数据转换单元；其中，第二数据获取单元用于从图表库中获取所述待显示图表中某一列的统计数据；数据转换单元用于根据所述待显示图表的方向和自定义接口，将所述某一列的统计数据转换为网页坐标，在对所述网页坐标进行最小值高度补全后，得到所述若干个柱状图的第一坐标数据。在本实施例中，该柱状图堆叠显示装置，还包括：异常值排除模块，用于对所述若干个柱状图的第一坐标数据进行异常值检测，当发现某一柱状图的第一坐标数据为异常值时，停止对所述某一柱状图进行渲染。数据处理模块302用于根据所述若干个柱状图的第一坐标数据，对发生重叠的柱状图的坐标进行调节，得到所述若干个柱状图的第二坐标数据。在本实施例中，数据处理模块302，包括：数据获取单元和坐标调节单元；其中，所述数据获取单元用于从所述若干个柱状图的第一坐标数据中，获取任意两个相邻柱状图的第一坐标数据；其中，所述第一坐标数据包括第一顶部坐标和第一底部坐标；所述坐标调节单元用于当任意两个相邻柱状图中的前一个柱状图的第一顶部坐标大于后一个柱状图的第一底部坐标时，调节所述后一个柱状图的底部坐标，以使所述后一个柱状图的第一底部坐标大于所述前一个柱状图的第一顶部坐标，得到所述若干个柱状图的第二坐标数据。图像显示模块303用于根据预设的静态变量，对所述若干个柱状图的第二坐标数据进行绘制，渲染绘制后的所述若干个柱状图。本发明通过将待显示图表中的统计数据先转化为第一坐标数据，再利用第一坐标数据对各个柱状图堆叠时的衔接部分进行碰撞检测或对是否重叠进行检测，最后使用经坐标调节得到的第二坐标数据进行柱状图堆叠的绘制，从而优化了多个柱状图堆叠的衔接部分。采用本发明实施例可得到如下有益效果：1.可维护性强。将不同的坐标处理逻辑封装成不同的函数，例如：最小高度补齐、缓存坐标处理、是否渲染数据0、碰撞检测、间隙补全等。若干个柱状图的首尾坐标按顺序进行处理，最终输出位置、顺序正确的新坐标。2.可扩展性、可定制性强。传入不同旋转角度后即可生成对应角度下的菱形，对于不想使用菱形的情况可以根据坐标随意绘制图形。3.通过缓存、集合绘制等手段减少内存占用，提升页面渲染速度避免白屏、卡顿等情况的发生。4.通过碰撞检测，合理规划柱状图坐标从而达到堆叠的目的。5.动态控制某个柱状图的显示与隐藏。以上所述的具体实施例，对本发明的目的、技术方案和有益效果进行了进一步的详细说明，应当理解，以上所述仅为本发明的具体实施例而已，并不用于限定本发明的保护范围。特别指出，对于本领域技术人员来说，凡在本发明的精神和原则之内，所做的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
