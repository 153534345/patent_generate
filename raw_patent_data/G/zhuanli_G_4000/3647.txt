标题title
一种内窥镜冻结状态检测的方法
摘要abst
本发明涉及一种内窥镜冻结状态检测的方法，针对于实时获取到的内窥镜镜下画面，首先通过画面中多个点位置RGB颜色值的一致性判断，实现内窥镜镜体安装的判断，然后构建内窥镜镜下画面的采样范围，即缩减识别区域降低样本容量，最后分析采样范围内各像素关于红色值、蓝色值的分布，结合相邻各幅内窥镜镜下画面之间的相似性，实现对内窥镜冻结状态的检测，其中降低数据直方图组数，提升了状态识别的速度，并且结合容差的设定，提高了方法执行的容错率，并可以有效去除单次冻结的重复检测；整个设计通过较少的资源，即可针对高帧率的彩色高清、超清内窥镜图像，实现冻结状态的快速判定。
权利要求书clms
1.一种内窥镜冻结状态检测的方法，其特征在于：针对于实时获取到的内窥镜镜下画面，执行如下步骤A至步骤C，实现对内窥镜冻结状态的检测；步骤A. 获取位于内窥镜镜下画面中以中心位置为圆心、预设半径范围内，且彼此距离大于预设间距的至少两个点位置的RGB颜色值，并判断各个点位置RGB颜色值彼此是否相同，是则表示内窥镜镜体未安装于内窥镜主机上，针对下一幅内窥镜镜下画面，重新执行步骤A；否则进入步骤B；步骤B. 以该内窥镜镜下画面左下顶点为原点、该内窥镜镜下画面宽度所在直线为x轴、该内窥镜镜下画面高度所在直线为y轴的，构建坐标系；然后基于坐标系，以该内窥镜镜下画面宽度二分之一处为x轴方向采样起始位置，该内窥镜镜下画面宽度的四分之一为采样宽度，以该内窥镜镜下画面高度三分之一处为y轴方向采样起始位置，该内窥镜镜下画面高度的三分之一为采样高度，构建内窥镜镜下画面的采样范围，再进入步骤C；步骤C. 获得内窥镜镜下画面中采样范围内各像素关于红色值、蓝色值的分布，结合依次所获各幅内窥镜镜下画面之间的相似性，实现对内窥镜冻结状态的检测，然后针对下一幅内窥镜镜下画面，返回步骤A。2.根据权利要求1所述一种内窥镜冻结状态检测的方法，其特征在于：所述步骤C中按如下步骤C1至步骤C3，获得内窥镜镜下画面中采样范围内各像素关于红色值、蓝色值的分布；步骤C1. 设定一个长度为a的正整型一维数组iColorRAry=0、一个长度为a的正整型一维数组iColorBAry=0、一个长度为a的浮点型一维数组fRAry=0、一个长度为a的浮点型一维数组fBAry=0，然后进入步骤C2；步骤C2. 分别针对内窥镜镜下画面中采样范围内的各像素，获得像素颜色中的红色值，并与a进行取余数运算，所获余数即为该像素关于红色对应的分组序号，进而获得各像素分别关于红色对应的分组序号，并统计顺序各分组序号之下像素的数量，顺序写入一维数组iColorRAry中的各位；同时，分别针对内窥镜镜下画面中采样范围内的各像素，获得像素颜色中的蓝色值，并与a进行取余数运算，所获余数即为该像素关于蓝色对应的分组序号，进而获得各像素分别关于蓝色对应的分组序号，并统计顺序各分组序号之下像素的数量，顺序写入一维数组iColorBAry中的各位，然后进入步骤C3；步骤C3. 顺序获得一维数组iColorRAry中各位上数值分别与内窥镜镜下画面中采样范围内像素总数的比值，并顺序写入一维数组fRAry中的各位；同时顺序获得一维数组iColorBAry中各位上数值分别与内窥镜镜下画面中采样范围内像素总数的比值，并顺序写入一维数组fBAry中的各位。3.根据权利要求2所述一种内窥镜冻结状态检测的方法，其特征在于：基于初始化三个长度为a的一维数组m_fPreImageMarkData、m_fCurrentImageMarkData、m_fPreSaveImageMarkData，且各一维数组分别等于0，以及初始化正整数变量m_iSameCount=0；针对陆续采集所获取各幅内窥镜镜下画面，执行如下步骤A至步骤C，实现对内窥镜冻结状态的检测的过程中，步骤C中按如下步骤C4至步骤C9，基于内窥镜镜下画面中采样范围内各像素关于红色值、蓝色值的分布，结合依次所获各幅内窥镜镜下画面之间的相似性，实现对内窥镜冻结状态的检测；步骤C4. 顺序获得一维数组fRAry中各位的值分别与一维数组fBAry中对应相同位的值的相加结果，并顺序写入一维数组m_fCurrentImageMarkData中的各位，然后进入步骤C5；步骤C5. 顺序获得一维数组m_fCurrentImageMarkData中各位的值分别与一维数组m_fPreImageMarkData中对应相同位的值的差值绝对值，并获得全部差值绝对值的和，然后判断该和是否小于0.1，是则进入步骤C6；否则设置m_iSameCount=0，并判定内窥镜当前状态为非冻结状态，再返回步骤A；步骤C6. 针对m_iSameCount的值进行加1更新，并进入步骤C7；步骤C7. 判断m_iSameCount是否大于预设连续相似画面数阈值b，是则设置m_iSameCount=0，并进入步骤C8；否则判定内窥镜当前状态为非冻结状态，并返回步骤A；步骤C8. 顺序获得一维数组m_fCurrentImageMarkData中各位的值分别与一维数组m_fPreSaveImageMarkData中对应相同位的值的差值绝对值，并获得全部差值绝对值的和，然后判断该和是否大于0.1，是则判定该内窥镜镜下画面与上一轮冻结状态内窥镜镜下画面内容不相同，是新一轮内窥镜镜下画面冻结状态，并进入步骤C9；否则判定该内窥镜镜下画面与上一轮冻结状态内窥镜镜下画面内容相同，该内窥镜镜下画面是上一轮冻结状态内窥镜镜下画面的延续，并返回步骤A；步骤C9. 顺序将一维数组m_fCurrentImageMarkData中各位的值分别赋值给一维数组m_fPreImageMarkData中对应相同位、以及一维数组m_fPreSaveImageMarkData中对应相同位，然后返回步骤A。4.根据权利要求3所述一种内窥镜冻结状态检测的方法，其特征在于：所述预设连续相似画面数阈值b的取值范围为8-30中的整数值。5.根据权利要求1所述一种内窥镜冻结状态检测的方法，其特征在于：所述步骤A中，针对内窥镜镜下画面中位于宽度三分之一、且高度三分之一的点位置、位于宽度三分之一、且高度三分之二的点位置、位于宽度三分之二、且高度三分之一的点位置、以及位于宽度三分之二、且高度三分之二的点位置，获得该各个点位置的RGB颜色值，并判断各个点位置RGB颜色值彼此是否相同。6.根据权利要求2至5中任意一项所述一种内窥镜冻结状态检测的方法，其特征在于：所述a=8。
说明书desc
技术领域本发明涉及一种内窥镜冻结状态检测的方法，属于图像处理技术领域。背景技术随着科技技术的不断进步，内窥镜的应用范围越来越广泛，除了应用于工业或生活中对不可达位置的观察，最主要的应用是用于医学上作为医生眼、手的延伸，可以实现医生对人体内消化道，肝、胆、胰腺管道系统、腹腔脏器及耳鼻喉等各种组织器官的实际情况进行观察、诊断、治疗。在医生使用内窥镜的过程中，对于关注的内窥镜画面或者到达医学标准的预定位置，需要通过按下内窥镜把手上冻结按钮，使内窥镜画面处于冻结状态，用于观察、以及用于后期的报告和患者的病历记录，由于用于报告和病历记录的报告工作站与内窥镜画面状态没有关联，就无法在内窥镜画面冻结后做出相应的后续动作，而是由人为参与进行后续操作，这就给术中的医护人员带来了额外的工作量，也分散了术中医护人员的精力和关注度、干扰了手术的成功率。发明内容本发明所要解决的技术问题是提供一种内窥镜冻结状态检测的方法，基于具体所设计的图像检测过程，能够准确、快速的识别出内窥镜是否处于冻结状态，并可避免内窥镜画面中设备参数跳动的干扰和有效规避因冻结时间较长而导致的重复触发，为后续操作处理提供实时准确的参考，从而将人工参与操作替代为自动完成后续处理变为可能。本发明为了解决上述技术问题采用以下技术方案：本发明设计了一种内窥镜冻结状态检测的方法，针对于实时获取到的内窥镜镜下画面，执行如下步骤A至步骤C，实现对内窥镜冻结状态的检测；步骤A. 获取位于内窥镜镜下画面中以中心位置为圆心、预设半径范围内，且彼此距离大于预设间距的至少两个点位置的RGB颜色值，并判断各个点位置RGB颜色值彼此是否相同，是则表示内窥镜镜体未安装于内窥镜主机上，针对下一幅内窥镜镜下画面，重新执行步骤A；否则进入步骤B；步骤B. 以该内窥镜镜下画面左下顶点为原点、该内窥镜镜下画面宽度所在直线为x轴、该内窥镜镜下画面高度所在直线为y轴的，构建坐标系；然后基于坐标系，以该内窥镜镜下画面宽度二分之一处为x轴方向采样起始位置，该内窥镜镜下画面宽度的四分之一为采样宽度，以该内窥镜镜下画面高度三分之一处为y轴方向采样起始位置，该内窥镜镜下画面高度的三分之一为采样高度，构建内窥镜镜下画面的采样范围，再进入步骤C；步骤C. 获得内窥镜镜下画面中采样范围内各像素关于红色值、蓝色值的分布，结合依次所获各幅内窥镜镜下画面之间的相似性，实现对内窥镜冻结状态的检测，然后针对下一幅内窥镜镜下画面，返回步骤A。作为本发明的一种优选技术方案：所述步骤C中按如下步骤C1至步骤C3，获得内窥镜镜下画面中采样范围内各像素关于红色值、蓝色值的分布；步骤C1. 设定一个长度为a的正整型一维数组iColorRAry=0、一个长度为a的正整型一维数组iColorBAry=0、一个长度为a的浮点型一维数组fRAry=0、一个长度为a的浮点型一维数组fBAry=0，然后进入步骤C2；步骤C2. 分别针对内窥镜镜下画面中采样范围内的各像素，获得像素颜色中的红色值，并与a进行取余数运算，所获余数即为该像素关于红色对应的分组序号，进而获得各像素分别关于红色对应的分组序号，并统计顺序各分组序号之下像素的数量，顺序写入一维数组iColorRAry中的各位；同时，分别针对内窥镜镜下画面中采样范围内的各像素，获得像素颜色中的蓝色值，并与a进行取余数运算，所获余数即为该像素关于蓝色对应的分组序号，进而获得各像素分别关于蓝色对应的分组序号，并统计顺序各分组序号之下像素的数量，顺序写入一维数组iColorBAry中的各位，然后进入步骤C3；步骤C3. 顺序获得一维数组iColorRAry中各位上数值分别与内窥镜镜下画面中采样范围内像素总数的比值，并顺序写入一维数组fRAry中的各位；同时顺序获得一维数组iColorBAry中各位上数值分别与内窥镜镜下画面中采样范围内像素总数的比值，并顺序写入一维数组fBAry中的各位。作为本发明的一种优选技术方案：基于初始化三个长度为a的一维数组m_fPreImageMarkData、m_fCurrentImageMarkData、m_fPreSaveImageMarkData，且各一维数组分别等于0，以及初始化正整数变量m_iSameCount=0；针对陆续采集所获取各幅内窥镜镜下画面，执行如下步骤A至步骤C，实现对内窥镜冻结状态的检测的过程中，步骤C中按如下步骤C4至步骤C9，基于内窥镜镜下画面中采样范围内各像素关于红色值、蓝色值的分布，结合依次所获各幅内窥镜镜下画面之间的相似性，实现对内窥镜冻结状态的检测；步骤C4. 顺序获得一维数组fRAry中各位的值分别与一维数组fBAry中对应相同位的值的相加结果，并顺序写入一维数组m_fCurrentImageMarkData中的各位，然后进入步骤C5；步骤C5. 顺序获得一维数组m_fCurrentImageMarkData中各位的值分别与一维数组m_fPreImageMarkData中对应相同位的值的差值绝对值，并获得全部差值绝对值的和，然后判断该和是否小于0.1，是则进入步骤C6；否则设置m_iSameCount=0，并判定内窥镜当前状态为非冻结状态，再返回步骤A；步骤C6. 针对m_iSameCount的值进行加1更新，并进入步骤C7；步骤C7. 判断m_iSameCount是否大于预设连续相似画面数阈值b，是则设置m_iSameCount=0，并进入步骤C8；否则判定内窥镜当前状态为非冻结状态，并返回步骤A；步骤C8. 顺序获得一维数组m_fCurrentImageMarkData中各位的值分别与一维数组m_fPreSaveImageMarkData中对应相同位的值的差值绝对值，并获得全部差值绝对值的和，然后判断该和是否大于0.1，是则判定该内窥镜镜下画面与上一轮冻结状态内窥镜镜下画面内容不相同，是新一轮内窥镜镜下画面冻结状态，并进入步骤C9；否则判定该内窥镜镜下画面与上一轮冻结状态内窥镜镜下画面内容相同，该内窥镜镜下画面是上一轮冻结状态内窥镜镜下画面的延续，并返回步骤A；步骤C9. 顺序将一维数组m_fCurrentImageMarkData中各位的值分别赋值给一维数组m_fPreImageMarkData中对应相同位、以及一维数组m_fPreSaveImageMarkData中对应相同位，然后返回步骤A。作为本发明的一种优选技术方案：所述预设连续相似画面数阈值b的取值范围为8-30中的整数值。作为本发明的一种优选技术方案：所述步骤A中，针对内窥镜镜下画面中位于宽度三分之一、且高度三分之一的点位置、位于宽度三分之一、且高度三分之二的点位置、位于宽度三分之二、且高度三分之一的点位置、以及位于宽度三分之二、且高度三分之二的点位置，获得该各个点位置的RGB颜色值，并判断各个点位置RGB颜色值彼此是否相同。作为本发明的一种优选技术方案：所述a=8。本发明所述一种内窥镜冻结状态检测的方法，采用以上技术方案与现有技术相比，具有以下技术效果：本发明所设计内窥镜冻结状态检测的方法，针对于实时获取到的内窥镜镜下画面，首先通过画面中多个点位置RGB颜色值的一致性判断，实现内窥镜镜体安装的判断，然后构建内窥镜镜下画面的采样范围，即缩减识别区域降低样本容量，最后分析采样范围内各像素关于红色值、蓝色值的分布，结合相邻各幅内窥镜镜下画面之间的相似性，实现对内窥镜冻结状态的检测，其中降低数据直方图组数，提升了状态识别的速度，并且结合容差的设定，提高了方法执行的容错率，并可以有效去除单次冻结的重复检测；整个设计通过较少的资源，即可针对高帧率的彩色高清、超清内窥镜图像，实现冻结状态的快速判定。附图说明图1是本发明设计内窥镜冻结状态检测的方法的流程图。具体实施方式下面结合说明书附图对本发明的具体实施方式作进一步详细的说明。本发明所设计一种内窥镜冻结状态检测的方法，实际应用当中，如图1所示，初始化三个长度为a=8的一维数组m_fPreImageMarkData、m_fCurrentImageMarkData、m_fPreSaveImageMarkData，且各一维数组分别等于0，以及初始化正整数变量m_iSameCount=0，针对于实时获取到的内窥镜镜下画面，执行如下步骤A至步骤C，实现对内窥镜冻结状态的检测。步骤A. 获取位于内窥镜镜下画面中以中心位置为圆心、预设半径范围内，且彼此距离大于预设间距的至少两个点位置的RGB颜色值，并判断各个点位置RGB颜色值彼此是否相同，是则表示内窥镜镜体未安装于内窥镜主机上，针对下一幅内窥镜镜下画面，重新执行步骤A；否则进入步骤B。实际应用当中，上述步骤A中，针对内窥镜镜下画面中位于宽度三分之一、且高度三分之一的点位置、位于宽度三分之一、且高度三分之二的点位置、位于宽度三分之二、且高度三分之一的点位置、以及位于宽度三分之二、且高度三分之二的点位置，获得该各个点位置的RGB颜色值，并判断各个点位置RGB颜色值彼此是否相同，是则表示内窥镜镜体未安装于内窥镜主机上，针对下一幅内窥镜镜下画面，重新执行步骤A；否则进入步骤B。步骤B. 以该内窥镜镜下画面左下顶点为原点、该内窥镜镜下画面宽度所在直线为x轴、该内窥镜镜下画面高度所在直线为y轴的，构建坐标系；然后基于坐标系，以该内窥镜镜下画面宽度二分之一处为x轴方向采样起始位置，该内窥镜镜下画面宽度的四分之一为采样宽度，以该内窥镜镜下画面高度三分之一处为y轴方向采样起始位置，该内窥镜镜下画面高度的三分之一为采样高度，构建内窥镜镜下画面的采样范围，再进入步骤C。上述内窥镜镜下画面的采样范围的构建，即通过缩减识别区域，降低样本容量，去除了与镜下画面无关的区域，有效降低了大于90%的样本容量。步骤C. 获得内窥镜镜下画面中采样范围内各像素关于红色值、蓝色值的分布，结合依次所获各幅内窥镜镜下画面之间的相似性，实现对内窥镜冻结状态的检测，然后针对下一幅内窥镜镜下画面，返回步骤A。实际应用当中，上述步骤C具体设计执行如下步骤C1至步骤C3，获得内窥镜镜下画面中采样范围内各像素关于红色值、蓝色值的分布。步骤C1. 设定一个长度为a的正整型一维数组iColorRAry=0、一个长度为a的正整型一维数组iColorBAry=0、一个长度为a的浮点型一维数组fRAry=0、一个长度为a的浮点型一维数组fBAry=0，然后进入步骤C2。步骤C2. 分别针对内窥镜镜下画面中采样范围内的各像素，获得像素颜色中的红色值，并与a进行取余数运算，所获余数即为该像素关于红色对应的分组序号，进而获得各像素分别关于红色对应的分组序号，并统计顺序各分组序号之下像素的数量，顺序写入一维数组iColorRAry中的各位。同时，分别针对内窥镜镜下画面中采样范围内的各像素，获得像素颜色中的蓝色值，并与a进行取余数运算，所获余数即为该像素关于蓝色对应的分组序号，进而获得各像素分别关于蓝色对应的分组序号，并统计顺序各分组序号之下像素的数量，顺序写入一维数组iColorBAry中的各位，然后进入步骤C3。步骤C3. 顺序获得一维数组iColorRAry中各位上数值分别与内窥镜镜下画面中采样范围内像素总数的比值，并顺序写入一维数组fRAry中的各位；同时顺序获得一维数组iColorBAry中各位上数值分别与内窥镜镜下画面中采样范围内像素总数的比值，并顺序写入一维数组fBAry中的各位。应用中，进一步设计执行如下步骤C4至步骤C9，基于内窥镜镜下画面中采样范围内各像素关于红色值、蓝色值的分布，结合依次所获各幅内窥镜镜下画面之间的相似性，实现对内窥镜冻结状态的检测。步骤C4. 顺序获得一维数组fRAry中各位的值分别与一维数组fBAry中对应相同位的值的相加结果，并顺序写入一维数组m_fCurrentImageMarkData中的各位，然后进入步骤C5。步骤C5. 顺序获得一维数组m_fCurrentImageMarkData中各位的值分别与一维数组m_fPreImageMarkData中对应相同位的值的差值绝对值，并获得全部差值绝对值的和，然后判断该和是否小于0.1，是则进入步骤C6；否则设置m_iSameCount=0，并判定内窥镜当前状态为非冻结状态，再返回步骤A。步骤C6. 针对m_iSameCount的值进行加1更新，并进入步骤C7。步骤C7. 判断m_iSameCount是否大于预设连续相似画面数阈值b，b的取值范围为8-30中的整数值，是则设置m_iSameCount=0，并进入步骤C8；否则判定内窥镜当前状态为非冻结状态，并返回步骤A。步骤C8. 顺序获得一维数组m_fCurrentImageMarkData中各位的值分别与一维数组m_fPreSaveImageMarkData中对应相同位的值的差值绝对值，并获得全部差值绝对值的和，然后判断该和是否大于0.1，是则判定该内窥镜镜下画面与上一轮冻结状态内窥镜镜下画面内容不相同，是新一轮内窥镜镜下画面冻结状态，并进入步骤C9；否则判定该内窥镜镜下画面与上一轮冻结状态内窥镜镜下画面内容相同，该内窥镜镜下画面是上一轮冻结状态内窥镜镜下画面的延续，并返回步骤A。步骤C9. 顺序将一维数组m_fCurrentImageMarkData中各位的值分别赋值给一维数组m_fPreImageMarkData中对应相同位、以及一维数组m_fPreSaveImageMarkData中对应相同位，然后返回步骤A。上述具体设计步骤C1至步骤C9的过程，实际应用中，设计减少数据直方图组数，由RGB常规三色直方图256×3个分组改为两色八均分直方图8×2个分组，根据内镜镜下画面特征，对关键数值维度进行合并统计，并且舍弃了对绿色值G的统计判断，有效减少了大于79%的数据量，提升了识别速度；并未通过设定容差10%、延缓判定，提高了涉及方案实际应用的容错率。整个设计方案，使用较少资源，即可以针对高帧率的彩色高清、超清内窥镜图像，高效实现冻结状态的快速判定。整个设计方案实际应用当中，针对于实时获取到的内窥镜镜下画面，首先通过画面中多个点位置RGB颜色值的一致性判断，实现内窥镜镜体安装的判断，然后构建内窥镜镜下画面的采样范围，即缩减识别区域降低样本容量，最后分析采样范围内各像素关于红色值、蓝色值的分布，结合相邻各幅内窥镜镜下画面之间的相似性，实现对内窥镜冻结状态的检测，其中降低数据直方图组数，提升了状态识别的速度，并且结合容差的设定，提高了方法执行的容错率，并可以有效去除单次冻结的重复检测；整个设计通过较少的资源，即可针对高帧率的彩色高清、超清内窥镜图像，实现冻结状态的快速判定。上面结合附图对本发明的实施方式作了详细说明，但是本发明并不限于上述实施方式，在本领域普通技术人员所具备的知识范围内，还可以在不脱离本发明宗旨的前提下做出各种变化。
