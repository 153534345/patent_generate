标题title
一种数字音频AGC线性增益调制方法及系统
摘要abst
本发明涉及音频调制技术领域，公开了一种数字音频AGC线性增益调制方法及系统，其中，一种数字音频AGC线性增益调制方法，包括接收输入音频幅度值Ain；根据输入音频幅度值Ain确定音频增益值G；根据输入音频幅度值Ain和音频增益值G计算并输出输出音频幅度值Ao；一种数字音频AGC线性增益调制系统，包括输入音频幅度值采集模块、音频增益值确定模块和输出音频幅度值计算模块。本发明使输出的音频更加平滑，降低了音频音频的失真度，同时使用数字电路代替模拟电路，不仅提高了设备的可靠性，而且可以灵活的设置参数。
权利要求书clms
1.一种数字音频AGC线性增益调制方法，其特征在于，主要包括以下步骤：S1：接收经低通滤波后的输入音频幅度值Ain；S2：根据输入音频幅度值Ain确定音频增益值G，所述音频增益值G为“0”或“1”或“一种线性处理的结果且在线性处理的结果满足约束条件时被锁定”；S3：根据输入音频幅度值Ain和音频增益值G获得输出音频幅度值Ao，所述输出音频幅度值Ao为输入音频幅度值Ain和音频增益值G的乘积。2.根据权利要求1所述的一种数字音频AGC线性增益调制方法，其特征在于，所述S2包括S2A，所述S2A具体包括：S2A1：若输入音频幅度值Ain大于小信号门限值B，则生成待处理音频增益值G，所述小信号门限值B为用户设置的值，所述待处理音频增益值G为系统生成的值；S2A2：根据输入音频幅度值Ain、待处理音频增益值G、输出上门限值D和输出下门限值C对待处理音频增益值G进行线性处理得到一种线性处理的结果且在线性处理的结果满足约束条件时锁定为音频增益值G，所述线性处理包括线性递减处理和线性递增处理，所述输出上门限值D和输出下门限值C均为用户设置的值，所述输出上门限值D大于输出下门限值C。3.根据权利要求2所述的一种数字音频AGC线性增益调制方法，其特征在于，所述S2A2包括S2A2A，所述S2A2A具体包括：S2A2A1：若输入音频幅度值Ain与待处理音频增益值G的乘积大于或等于输出上门限值D，则对待处理音频增益值G进行线性递减处理；S2A2A2：将经线性递减处理的待处理音频增益值G更新为最新的待处理音频增益值G；S2A2A3：重复步骤S2A2A1至S2A2A2，直至输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C，将最新的待处理音频增益值G标记为音频增益值G，所述输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C为约束条件。4.根据权利要求2所述的一种数字音频AGC线性增益调制方法，其特征在于，所述S2A2包括S2A2B，所述S2A2B具体包括：S2A2B1：若输入音频幅度值Ain与待处理音频增益值G的乘积小于或等于输出下门限值D，则对待处理音频增益值G进行线性递增处理；S2A2B2：将经线性递增处理的待处理音频增益值G更新为最新的待处理音频增益值G；S2A2B3：重复步骤S2A2B1至S2A2B2，直至输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C，将最新的待处理音频增益值G标记为音频增益值G，所述输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C为约束条件。5.根据权利要求2所述的一种数字音频AGC线性增益调制方法，其特征在于，所述S2A2包括S2A2C，所述S2A2C具体包括：若输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C，则将待处理音频增益值G标记为音频增益值G，所述输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C为约束条件。6.根据权利要求2所述的一种数字音频AGC线性增益调制方法，其特征在于，所述线性处理的表达式为：其中，G为音频增益值，G为待处理音频增益值，Aexp为用户设定的期望音频幅度值，所述期望音频幅度值Aexp大于输出下门限值C且小于输出上门限值D，Ain为输入音频幅度值，为用户设定的跳变系数，n为自然数。7.根据权利要求1所述的一种数字音频AGC线性增益调制方法，其特征在于，所述S2包括S2B，所述S2B具体包括：若输入音频幅度值Ain大于或等于输入幅度下门限值A且小于等于小信号门限值B，则将音频增益值G设置为1，所述小信号门限值B大于或等于输入幅度下门限值A。8.根据权利要求1所述的一种数字音频AGC线性增益调制方法，其特征在于，所述S2包括S2C，所述S2C具体包括：若输入音频幅度值Ain小于输入幅度下门限值A，则将音频增益值G设置为0。9.一种数字音频AGC线性增益调制系统，其特征在于，包括音频增益值计算模块，所述音频增益值计算模块包括：一个或若干个处理器；存储器，用于存储一个或若干个程序，当所述一个或若干个程序被所述一个或若干个处理器执行时，能使得所述一个或若干个处理器实现权利要求1至8所述的数字音频AGC线性增益调制方法。
说明书desc
技术领域本发明涉及音频调制技术领域，具体涉及一种数字音频AGC线性增益调制方法及系统。背景技术在音频邻域中，为了得到清晰柔和的声音，通常会对输入音频进行AEC回声消除、ANS噪声抑制和AGC自动增益控制处理，相较与回声和噪声，音量大小往往被忽视，而音频设备实际使用中音频源的不稳定是客观存在的问题，如音量大小、音频传输距离差异，为了解决微弱声音无法听清和响亮声音产生啸叫的问题，音频AGC就成为音频信道设计的必选项，音频AGC简单来说就是如果讲话者的声音过大， AGC 便会自动降低音频增益，反之，便自动提高音频增益，以确保音量维持在一个比较稳定的水平。现有的音频AGC方案通常为使用线性音频放大器、有源滤波器、包络检波模块等模拟电路形成模拟反馈机制，实现音频检测、自动限幅调制的功能，最终实现音频ACG，这种方法具有以下几点问题：1、应用了模拟电路，增加了电路复杂度，降低了设备的可靠性。2、易引入模拟噪声，导致音频失真和系统抗干扰能力差的问题。3、电路固定，不能灵活地设置音频门限等参数。4、现有的AGC方案对音频幅度较大的信号直接进行抹平处理，使经处理过后输出的音频不够平滑，音频失真严重。发明内容本发明的目的在于提供一种数字音频AGC线性增益调制方法及系统，使输出的音频更加平滑，降低了音频音频的失真度，同时使用数字电路代替模拟电路，不仅提高了设备的可靠性，而且可以灵活的设置参数。为解决上述技术问题，本发明采用了以下方案：第一方面，一种数字音频AGC线性增益调制方法，主要包括以下步骤：S1：接收经低通滤波后的输入音频幅度值Ain；S2：根据输入音频幅度值Ain确定音频增益值G，所述音频增益值G为“0”或“1”或“一种线性处理的结果且在线性处理的结果满足约束条件时被锁定”；S3：根据输入音频幅度值Ain和音频增益值G获得输出音频幅度值Ao，所述输出音频幅度值Ao为输入音频幅度值Ain和音频增益值G的乘积。进一步的，所述S2包括S2A，所述S2A具体包括：S2A1：若输入音频幅度值Ain大于小信号门限值B，则生成待处理音频增益值G，所述小信号门限值B为用户设置的值，所述待处理音频增益值G为系统生成的值；S2A2：根据输入音频幅度值Ain、待处理音频增益值G、输出上门限值D和输出下门限值C对待处理音频增益值G进行线性处理得到一种线性处理结果且在线性处理的结果满足约束条件时锁定为音频增益值G，所述线性处理包括线性递减处理和线性递增处理，所述输出上门限值D和输出下门限值C均为用户设置的值，所述输出上门限值D大于输出下门限值C。进一步的，所述S2A2包括S2A2A，所述S2A2A具体包括：S2A2A1：若输入音频幅度值Ain与待处理音频增益值G的乘积大于或等于输出上门限值D，则对待处理音频增益值G进行线性递减处理；S2A2A2：将经线性递减处理的待处理音频增益值G更新为最新的待处理音频增益值G；S2A2A3：重复步骤S2A2A1至S2A2A2，直至输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C，将最新的待处理音频增益值G标记为音频增益值G，所述输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C为约束条件。进一步的，所述S2A2包括S2A2B，所述S2A2B具体包括：S2A2B1：若输入音频幅度值Ain与待处理音频增益值G的乘积小于或等于输出下门限值D，则对待处理音频增益值G进行线性递增处理；S2A2B2：将经线性递增处理的待处理音频增益值G更新为最新的待处理音频增益值G；S2A2B3：重复步骤S2A2B1至S2A2B2，直至输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C，将最新的待处理音频增益值G标记为音频增益值G，所述输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C为约束条件。进一步的，所述S2A2包括S2A2C，所述S2A2C具体包括：若输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C，则将待处理音频增益值G标记为音频增益值G，所述输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C为约束条件。进一步的，所述线性处理的表达式为：其中，G为音频增益值，G为待处理音频增益值，Aexp为用户设定的期望音频幅度值，所述期望音频幅度值Aexp大于输出下门限值C且小于输出上门限值D，Ain为输入音频幅度值，为用户设定的跳变系数，n为自然数。进一步的，所述S2包括S2B，所述S2B具体包括：若输入音频幅度值Ain大于或等于输入幅度下门限值A且小于等于小信号门限值B，则将音频增益值G设置为1，所述小信号门限值B大于或等于输入幅度下门限值A。进一步的，所述S2包括S2C，所述S2C具体包括：若输入音频幅度值Ain小于输入幅度下门限值A，则将音频增益值G设置为0。另一方面，一种数字音频AGC线性增益调制系统，包括音频增益值计算模块，所述音频增益值计算模块包括：一个或若干个处理器；存储器，用于存储一个或若干个程序，当所述一个或若干个程序被所述一个或若干个处理器执行时，能使得所述一个或若干个处理器实现上述方案所述的数字音频AGC线性增益调制方法。本发明具有的有益效果：1、本发明通过设置包括输入音频幅度值接收模块、音频增益值确定模块和输出音频幅度值计算模块的数字音频AGC线性增益调制系统，其中，音频增益值确定模块会对用户设定小信号门限值、输入幅度下门限值、输出上门限值和输出下门限值以及输入音频幅度值进行数字处理确定音频增益值，在输入音频幅度值大于小信号门限值时，若输入音频幅度值与待处理音频增益值的乘积大于或等于输出上门限值，则会根据线性处理的表达式对音频增益值进行线性递减处理直至输入音频幅度值与待处理音频增益值的乘积小于输出上门限值且大于输出下门限值；若输入音频幅度值与待处理音频增益值的乘积小于或等于输出下门限值，则会根据线性处理的表达式对音频增益值进行线性递增处理直至输入音频幅度值与待处理音频增益值的乘积小于输出上门限值且大于输出下门限值；本发明对音频幅度较大的信号采用线性调节的方式进行处理，相比于现有技术中对音频幅度较大的信号进行抹平处理，本发明中得到的输出音频更加平滑，降低了音频的失真度，同时使用数字电路代替模拟电路，首先门限参数、增益跳变系数等均可由用户进行配置，应用范围更大，其次简化了硬件电路，减少引入的模拟噪声，降低了音频的失真度，系统的抗干扰能力更强，最后降低了电路复杂度，设备的可靠性得以提升。2、本发明中提供的数字音频AGC线性增益调制方法对AGC算法进行了优化，实现了增益计算的联动匹配调整，使音频增益值的动态调整更加精准，线性度更好。附图说明图1为本发明中的数字音频AGC线性增益调制系统的总体结构图；图2为本发明中的数字音频AGC线性增益调制方法的总体流程图；图3为本发明中的基于FPGA平台实现的数字音频AGC线性增益调制方法的总体流程图。具体实施方式为使本领域技术人员更好地理解本发明/发明的技术方案，下面结合附图和具体实施方式对本发明/发明作进一步详细描述。实施例1：如图2和图3所示的一种数字音频AGC线性增益调制方法，主要包括以下步骤：S1：接收经低通滤波后的输入音频幅度值Ain；S2：根据输入音频幅度值Ain确定音频增益值G，所述音频增益值G为“0”或“1”或“一种线性处理的结果且在线性处理的结果满足约束条件时被锁定”；S3：根据输入音频幅度值Ain和音频增益值G获得输出音频幅度值Ao，所述输出音频幅度值Ao为输入音频幅度值Ain和音频增益值G的乘积。本实施例中，所述S2包括S2A，所述S2A具体包括：S2A1：若输入音频幅度值Ain大于小信号门限值B，则生成待处理音频增益值G，所述小信号门限值B为用户设置的值，所述待处理音频增益值G为系统生成的值；S2A2：根据输入音频幅度值Ain、待处理音频增益值G、输出上门限值D和输出下门限值C对待处理音频增益值G进行线性处理得到一种线性处理结果且在线性处理的结果满足约束条件时锁定为音频增益值G，所述线性处理包括线性递减处理和线性递增处理，所述输出上门限值D和输出下门限值C均为用户设置的值，所述输出上门限值D大于输出下门限值C。本实施例中，所述S2A2包括S2A2A，所述S2A2A具体包括：S2A2A1：若输入音频幅度值Ain与待处理音频增益值G的乘积大于或等于输出上门限值D，则对待处理音频增益值G进行线性递减处理；S2A2A2：将经线性递减处理的待处理音频增益值G更新为最新的待处理音频增益值G；S2A2A3：重复步骤S2A2A1至S2A2A2，直至输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C，将最新的待处理音频增益值G标记为音频增益值G，所述输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C为约束条件。本实施例中，所述S2A2包括S2A2B，所述S2A2B具体包括：S2A2B1：若输入音频幅度值Ain与待处理音频增益值G的乘积小于或等于输出下门限值D，则对待处理音频增益值G进行线性递增处理；S2A2B2：将经线性递增处理的待处理音频增益值G更新为最新的待处理音频增益值G；S2A2B3：重复步骤S2A2B1至S2A2B2，直至输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C，将最新的待处理音频增益值G标记为音频增益值G，所述输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C为约束条件。本实施例中，所述S2A2包括S2A2C，所述S2A2C具体包括：若输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C，则将待处理音频增益值G标记为音频增益值G，所述输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C为约束条件。本实施例中，所述线性处理的表达式为：其中，G为音频增益值，G为待处理音频增益值，Aexp为用户设定的期望音频幅度值，所述期望音频幅度值Aexp大于输出下门限值C且小于输出上门限值D，Ain为输入音频幅度值，为用户设定的跳变系数，n为自然数。本实施例中，所述S2包括S2B，所述S2B具体包括：若输入音频幅度值Ain大于或等于输入幅度下门限值A且小于等于小信号门限值B，则将音频增益值G设置为1，所述小信号门限值B大于或等于输入幅度下门限值A。本实施例中，所述S2包括S2C，所述S2C具体包括：若输入音频幅度值Ain小于输入幅度下门限值A，则将音频增益值G设置为0。实施例2：如图1和图3所示的一种数字音频AGC线性增益调制系统，包括音频增益值计算模块，所述音频增益值计算模块包括：一个或若干个处理器；存储器，用于存储一个或若干个程序，当所述一个或若干个程序被所述一个或若干个处理器执行时，能使得所述一个或若干个处理器实现上述方案所述的数字音频AGC线性增益调制方法。具体的，本实施例提供的数字音频AGC线性增益调制系统还包括用于采集输入音频幅度值Ain的输入音频幅度值采集模块和用于计算输出音频幅度值Ao的输出音频幅度值计算模块；本实施例中的AGC算法是基于FPGA平台实现的，本实施例中提供的数字音频AGC线性增益调制系统中的前级采用可配置的FIR低通数字滤波器，可根据音频直采芯片采样率灵活设置低通截止频率，抑制带外噪声，无反馈回路，稳定性强，同时使电路的线性相位发生延迟，FIR系统函数公式如下所示：其中，为FIR低通数字滤波器的系统输出，/＞，/＞，...，/＞均为单位冲激响应，当n＞m时，/＞= 0，m为滤波器的滤波阶数，z为波形幅值与时间的商。同时本实施例中使用了FIFO延迟机制，能够为音频增益值G的计算调整提供必要的时间，在本发明中音频数据进行缓存后，可被动读取，即每当待处理音频增益值G进行更新时就读取缓存的音频数据，进行输出音频幅度值的调整，该延迟时间与音频增益值的计算时间有关，不是固定值，在对待处理音频增益值G进行线性处理时，延时时间与跳变系数有关，跳变系数越大跳变越慢，延迟时间越长，FIFO延迟机制将延迟时间和音频增益值G的计算紧密的结合在一起，实现了延迟时间的动态变化，解决了现有技术中的AGC算法中因延迟时间长度固定，用户为了避免因音频大小突变产生的过冲现象，不得不设置较大长延迟时间的问题。本实施例的工作原理：现有技术中使用的音频AGC方案通常为使用线性音频放大器、有源滤波器、包络检波模块等模拟电路形成模拟反馈机制，实现音频检测、自动限幅调制的功能，最终实现音频ACG，这种方法具有以下几点问题：应用了模拟电路，增加了电路复杂度，降低了设备的可靠性；引入了模拟噪声，使音频失真和系统抗干扰能力差；电路固定，不能灵活地设置音频门限等参数；现有的AGC方案对音频幅度较大的信号直接进行抹平处理，使经处理过后输出的音频不够平滑，音频失真严重。基于这种情况，本实施例提供了一种数字音频AGC线性增益调制方法及系统，本实施例提供的数字音频AGC线性增益调制系统包括输入音频幅度值采集模块、音频增益值确定模块和输出音频幅度值计算模块；其中，输入音频幅度值采集模块采集输入音频幅度值Ain，并将输入音频幅度值Ain输出至音频增益值确定模块，音频增益值确定模块接收来自输入音频幅度值采集模块的输入音频幅度值Ain，并会对用户设定小信号门限值B、输入幅度下门限值A、输出上门限值D和输出下门限值C以及输入音频幅度值Ain进行数据处理确定音频增益值G，确定音频增益值G的方法具体包括：在输入音频幅度值Ain大于小信号门限值B时，系统随机生成待处理音频增益值G，若输入音频幅度值Ain与待处理音频增益值G的乘积大于或等于输出上门限值D，则会根据线性处理的表达式对待处理音频增益值G进行线性递减处理直至输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C，此时将最新的待处理音频增益值G标记为音频G；若输入音频幅度值Ain与待处理音频增益值G的乘积小于或等于输出下门限值C，则会根据线性处理的表达式对待处理音频增益值G进行线性递增处理直至输入音频幅度值Ain与待处理音频增益值G的乘积小于输出上门限值D且大于输出下门限值C，此时将最新的待处理音频增益值G标记为音频增益值G；若输入音频幅度值Ain与待处理音频增益值G的乘积大于输出下门限值C且小于输出上门限值D，则直接将待处理音频增益值G标记为音频增益值G。在输入音频幅度值Ain大于等于输入幅度下门限值A且小于等于小信号门限值B时，将音频增益值G设置为1，此时输入音频幅度值Ain和输出音频幅度值Ao保持一致。在输入音频幅度值Ain小于输入幅度下门限值A时，将音频增益值G设置为0，此时对输入音频进行截断抑制。本实施例采用数字AGC的方式，相比于现有技术具有以下优势：门限参数、增益跳变系数等均可由用户进行配置，应用范围更大；简化了硬件电路，减少引入的模拟噪声，降低了音频的失真度，系统的抗干扰能力更强；降低了电路复杂度，设备的可靠性得以提升；对音频幅度较大的信号采用线性调节的方式而非直接进行抹平处理，使经处理过后输出的音频更加平滑，减少音频失真。除此之外，本实施例中的AGC算法是基于FPGA平台实现的，使用了FIFO延迟机制，能够为音频增益值G的计算调整提供必要的时间，在本实施例中音频数据进行缓存后，可被动读取，即每当待处理音频增益值G进行更新时就读取缓存的音频数据，进行输出音频幅度值Ao的调整，该延迟时间与音频增益值G的计算时间有关，不是固定值，在对音频增益值G进行线性处理时，延时时间与跳变系数有关，跳变系数越大跳变越慢，延迟时间越长，FIFO延迟机制将延迟时间和音频增益值G的计算紧密的结合在一起，实现了延迟时间的动态变化，解决了现有技术中的AGC算法中因延迟时间长度固定，用户为了避免因音频大小突变产生的过冲现象，不得不设置较大长延迟时间的问题。可以理解的是，以上实施方式仅仅是为了说明本发明/发明的原理而采用的示例性实施方式，然而本发明/发明并不局限于此。对于本领域内的普通技术人员而言，在不脱离本发明/发明的精神和实质的情况下，可以做出各种变型和改进，这些变型和改进也视为本发明/发明的保护范围。
