标题title
x射线图像的样本扩充方法、样本扩充装置
摘要abst
本发明提供一种x射线图像的样本扩充方法、样本扩充装置，所述方法采取两次交叉重建的方式，在第一阶段使用正常图像的编码特征实现一次生成，使用鉴别器在一次阶段实现对抗性训练，第二阶段依然使用交叉传递的方式，但是并没有使用内容鉴别器，通过加入交叉循环一致性损失函数实现无监督的非配对数据集，可以生成连鉴别器都无法辨别真假的x射线伪图像。本发明无需成对的标签数据集即可实现x射线图像的瑕疵生成，同时，通过对图像的内容和细节进行编码，将样本的内容特征和语义特征解码，使用权重共享的编码器提取x域和y域中的共享潜在编码，采用内容鉴别器区分共享编码特征的域隶属度，可以增加瑕疵编码特征的多样性。
权利要求书clms
1.一种x射线图像的样本扩充方法，其特征在于，包括以下步骤：获取IC封装模块的x射线图像构成的训练数据集，所述训练数据集包括：正常图像和瑕疵图像；将所述训练数据集进行缩放处理；将缩放处理后的正常图像和瑕疵图像分别输入权重共享的第一内容编码器和第二内容编码器，且所述第一内容编码器和所述第二内容编码器通过内容鉴别器进行特征编码域的隶属度的判断，以通过所述第一内容编码器和第二内容编码器将所述正常图像和所述瑕疵图像的内容映射至第一共享特征空间，所述第一共享特征空间包括：x域共享的第一特征编码Zx1和y域共享的第一特征编码Zy1；将缩放处理后的瑕疵图像输入第一细节编码器中，以生成第一细节特征编码；将所述第一细节特征编码和所述x域共享的第一特征编码Zx1输入第一生成器Gy1中，以生成正常伪图，将所述y域共享的第一特征编码Zy1输入第二生成器Gx1中，以生成瑕疵伪图；将所述瑕疵图像和所述正常伪图输入第一鉴别器进行对抗性训练，以获取一次正常伪图，将所述正常图像和所述瑕疵伪图输入第二鉴别器进行对抗性训练，以获取一次瑕疵伪图；将所述一次正常伪图输入第二细节编码器，以生成第二细节特征编码，将所述一次瑕疵伪图和所述一次正常伪图输入权重共享的第三内容编码器和第四内容编码器，以通过所述第三内容编码器和第四内容编码器将所述一次瑕疵伪图和所述一次正常伪图的内容映射至第二共享特征空间，所述第二共享特征空间包括：x域共享的第二特征编码Zx2和y域共享的第二特征编码Zy2；将所述第二细节特征编码和所述x域共享的第二特征编码Zx2输入第三生成器Gy2中，以生成重建瑕疵伪图，将所述y域共享的第二特征编码Zy2输入第四生成器Gx2中，以生成重建正常伪图，其中，所述重建瑕疵伪图和所述瑕疵图像采用交叉循环一致性损失函数计算损失值，所述重建正常伪图和所述正常图像交叉循环一致性损失函数计算损失值；采用重建瑕疵伪图进行x射线图像的样本扩充。2.根据权利要求1所述的x射线图像的样本扩充方法，其特征在于，所述第一内容编码器、所述第二内容编码器、所述第三内容编码器、所述第四内容编码器包括：两次下采样的残差模块组成的全卷积网络，所述第一细节编码器或所述第二细节编码器包括：卷积层、残差模块和全连接层。3.根据权利要求1所述的x射线图像的样本扩充方法，其特征在于，所述内容鉴别器包括：三层5×5的下采样卷积模块、一层3×3的卷积层和LeakyReLU激活函数。4.根据权利要求3所述的x射线图像的样本扩充方法，其特征在于，所述内容鉴别器采用交叉熵损失函数进行特征编码的域隶属度的判断。5.根据权利要求1所述的x射线图像的样本扩充方法，其特征在于，所述第一生成器Gy1或所述第三生成器Gy2包括：两个残差模块、两个上采样模块和一个卷积模块，所述上采样模块包括：双线性插值、卷积层、BN层和ReLU激活函数。6.根据权利要求1所述的x射线图像的样本扩充方法，其特征在于，所述第二生成器Gx1或所述第四生成器Gx2包括：两个上采样模块、一个卷积模块和Tanh激活函数。7.根据权利要求1所述的x射线图像的样本扩充方法，其特征在于，所述第一鉴别器和所述第二鉴别器进行对抗性训练时，采用交叉熵损失函数计算损失值。8.一种x射线图像的样本扩充装置，其特征在于，包括：获取模块，所述获取模块用于获取IC封装模块的x射线图像构成的训练数据集，所述训练数据集包括：正常图像和瑕疵图像；缩放模块，所述缩放模块用于将所述训练数据集进行缩放处理；权重共享的第一内容编码器和第二内容编码器，所述第一内容编码器和第二内容编码器器用于将所述正常图像和所述瑕疵图像的内容映射至第一共享特征空间，且所述第一内容编码器和所述第二内容编码器通过内容鉴别器进行特征编码域的隶属度的判断，所述第一共享特征空间包括：x域共享的第一特征编码Zx1和y域共享的第一特征编码Zy1；第一细节编码器，所述第一细节编码器用于根据缩放处理后的瑕疵图像生成第一细节特征编码；第一生成器Gy1，所述第一生成器Gy1用于根据所述第一细节特征编码和所述/＞域共享的第一特征编码/＞生成正常伪图；第二生成器Gx1，所述第二生成器Gx1用于根据所述y域共享的第一特征编码Zy1生成瑕疵伪图；第一鉴别器，所述第一鉴别器用于根据所述瑕疵图像和所述正常伪图进行对抗性训练，以获取一次正常伪图；第二鉴别器，所述第二鉴别器用于根据所述正常图像和所述瑕疵伪图进行对抗性训练，以获取一次瑕疵伪图；第二细节编码器，所述第二细节编码器用于根据所述一次正常伪图生成第二细节特征编码；权重共享的第三内容编码器和第四内容编码器，所述权重共享的第三内容编码器和第四内容编码器用于将所述一次瑕疵伪图和所述一次正常伪图的内容映射至第二共享特征空间，所述第二共享特征空间包括：x域共享的第二特征编码Zx2和y域共享的第二特征编码Zy2；第三生成器Gy2，所述第三生成器Gy2用于根据所述第二细节特征编码和所述x域共享的第二特征编码Zx2生成重建瑕疵伪图；第四生成器Gx2，所述第四生成器Gx2用于根据所述y域共享的第二特征编码Zy2生成重建正常伪图，其中，所述重建瑕疵伪图和所述瑕疵图像采用交叉循环一致性损失函数计算损失值，所述重建正常伪图和所述正常图像采用L1损失函数计算损失值；扩充模块，所述扩充模块用于采用重建瑕疵伪图进行x射线图像的样本扩充。9.根据权利要求8所述的x射线图像的样本扩充装置，其特征在于，所述第一内容编码器、所述第二内容编码器、所述第三内容编码器、所述第四内容编码器包括：两次下采样的残差模块组成的全卷积网络，所述第一细节编码器或所述第二细节编码器包括：卷积层、残差模块和全连接层。10.根据权利要求8所述的x射线图像的样本扩充装置，其特征在于，所述内容鉴别器包括：三层5×5的下采样卷积模块、一层3×3的卷积层和LeakyReLU激活函数，所述内容鉴别器采用交叉熵损失函数进行特征编码的域隶属度的判断，所述第一生成器Gy1或所述第三生成器Gy2包括：两个残差模块、两个上采样模块和一个卷积模块，所述上采样模块包括：双线性插值、卷积层、BN层和ReLU激活函数；所述第二生成器Gx1或所述第四生成器Gx2包括：两个上采样模块、一个卷积模块和Tanh激活函数。
说明书desc
技术领域本发明涉及图像处理技术领域，具体涉及一种x射线图像的样本扩充方法和一种x射线图像的样本扩充装置。背景技术图像处理技术已经广泛应用于瑕疵检测领域，利用深度神经网络的强大学习能力，有效的解决了人工检测率低和漏检等问题，减少了人工成本的投入，从而提升产品的性能。但基于深度网络的检测模型在训练时需要大量的瑕疵样本，而工业生产过程中良品率很高，产生瑕疵样本是属于小概率时间，瑕疵特征的出现具有一定的随机性，导致原始样本的数据量不足。为提高瑕疵样本的数量和多样性，相关技术中，一般采用采用旋转、填充、平移、插值、翻转、高斯噪声、翻折、裁剪、几何变换、缩放、弹性形变和主要成分分析抖动以及其组合，该方法虽然通用性很好，可以使用在大多数任务中，但这些方法都是针对单张图像进行处理，并且不具有针对性，无法对图像的局部的目标特征进行有效的扩充，从而不能有效的提升模型的泛化性能。也有通过基于深度学习的样本扩充方法，该方法需要大量的配对数据集，而配对数据集的获取是非常困难的，并且这也违背了数据扩充初衷。发明内容为解决上述技术问题，本发明的第一个目的在于提出一种x射线图像的样本扩充方法。本发明的第二个目的在于提出一种x射线图像的样本扩充装置。本发明采用的技术方案如下：本发明第一方面的实施例提出了一种x射线图像的样本扩充方法，包括以下步骤：获取IC封装模块的x射线图像构成的训练数据集，所述训练数据集包括：正常图像和瑕疵图像；将所述训练数据集进行缩放处理；将缩放处理后的正常图像和瑕疵图像分别输入权重共享的第一内容编码器和第二内容编码器，且所述第一内容编码器和所述第二内容编码器通过内容鉴别器进行特征编码域的隶属度的判断，以通过所述第一内容编码器和第二内容编码器将所述正常图像和所述瑕疵图像的内容映射至第一共享特征空间，所述第一共享特征空间包括：x域共享的第一特征编码Zx1和y域共享的第一特征编码Zy1；将缩放处理后的瑕疵图像输入第一细节编码器中，以生成第一细节特征编码；将所述第一细节特征编码和所述x域共享的第一特征编码Zx1输入第一生成器Gy1中，以生成正常伪图，将所述y域共享的第一特征编码Zy1输入第二生成器Gx1中，以生成瑕疵伪图；将所述瑕疵图像和所述正常伪图输入第一鉴别器进行对抗性训练，以获取一次正常伪图，将所述正常图像和所述瑕疵伪图输入第二鉴别器进行对抗性训练，以获取一次瑕疵伪图；将所述一次正常伪图输入第二细节编码器，以生成第二细节特征编码/＞，将所述一次瑕疵伪图和所述一次正常伪图输入权重共享的第三内容编码器和第四内容编码器，以通过所述第三内容编码器和第四内容编码器将所述一次瑕疵伪图和所述一次正常伪图的内容映射至第二共享特征空间，所述第二共享特征空间包括：x域共享的第二特征编码Zx2和y域共享的第二特征编码Zy2；将所述第二细节特征编码/＞和所述x域共享的第二特征编码Zx2输入第三生成器Gy2中，以生成重建瑕疵伪图，将所述y域共享的第二特征编码Zy2输入第四生成器Gx2中，以生成重建正常伪图，其中，所述重建瑕疵伪图和所述瑕疵图像采用交叉循环一致性损失函数计算损失值，所述重建正常伪图和所述正常图像交叉循环一致性损失函数计算损失值；采用重建瑕疵伪图进行x射线图像的样本扩充。本发明上述提出的x射线图像的样本扩充方法还可以具有如下附加技术特征：根据本发明的一个实施例，所述第一内容编码器、所述第二内容编码器、所述第三内容编码器、所述第四内容编码器包括：两次下采样的残差模块组成的全卷积网络，所述第一细节编码器或所述第二细节编码器包括：卷积层、残差模块和全连接层。根据本发明的一个实施例，所述内容鉴别器包括：三层5×5的下采样卷积模块、一层3×3的卷积层和LeakyReLU激活函数。根据本发明的一个实施例，所述内容鉴别器采用交叉熵损失函数进行特征编码隶属度的判断。根据本发明的一个实施例，所述第一生成器Gy1或所述第三生成器Gy2包括：两个残差模块、两个上采样模块和一个卷积模块，所述上采样模块包括：双线性插值、卷积层、BN层和ReLU激活函数。根据本发明的一个实施例，所述第二生成器Gx1或所述第四生成器Gx2包括：两个上采样模块、一个卷积模块和Tanh激活函数。根据本发明的一个实施例，所述第一鉴别器和所述第二鉴别器进行对抗性训练时，采用交叉熵损失函数计算损失值。本发明第二方面的实施例提出了一种x射线图像的样本扩充装置，包括：获取模块，所述获取模块用于获取IC封装模块的x射线图像构成的训练数据集，所述训练数据集包括：正常图像和瑕疵图像；缩放模块，所述缩放模块用于将所述训练数据集进行缩放处理；权重共享的第一内容编码器和第二内容编码器，所述第一内容编码器和第二内容编码器器用于将所述正常图像和所述瑕疵图像的内容映射至第一共享特征空间，且所述第一内容编码器和所述第二内容编码器通过内容鉴别器进行特征编码域的隶属度的判断，所述第一共享特征空间包括：x域共享的第一特征编码Zx1和y域共享的第一特征编码Zy1；第一细节编码器，所述第一细节编码器用于根据缩放处理后的瑕疵图像生成第一细节特征编码；第一生成器Gy1，所述第一生成器Gy1用于根据所述第一细节特征编码/＞和所述x域共享的第一特征编码/＞生成正常伪图；第二生成器Gx1，所述第二生成器Gx1用于根据所述y域共享的第一特征编码Zy1生成瑕疵伪图；第一鉴别器，所述第一鉴别器用于根据所述瑕疵图像和所述正常伪图进行对抗性训练，以获取一次正常伪图；第二鉴别器，所述第二鉴别器用于根据所述正常图像和所述瑕疵伪图进行对抗性训练，以获取一次瑕疵伪图；第二细节编码器，所述第二细节编码器用于根据所述一次正常伪图生成第二细节特征编码/＞；权重共享的第三内容编码器和第四内容编码器，所述权重共享的第三内容编码器和第四内容编码器用于将所述一次瑕疵伪图和所述一次正常伪图的内容映射至第二共享特征空间，所述第二共享特征空间包括：x域共享的第二特征编码Zx2和y域共享的第二特征编码Zy2；第三生成器Gy2，所述第三生成器Gy2用于根据所述第二细节特征编码/＞和所述x域共享的第二特征编码Zx2生成重建瑕疵伪图；第四生成器Gx2，所述第四生成器Gx2用于根据所述y域共享的第二特征编码Zy2生成重建正常伪图，其中，所述重建瑕疵伪图和所述瑕疵图像采用交叉循环一致性损失函数计算损失值，所述重建正常伪图和所述正常图像采用L1损失函数计算损失值；扩充模块，所述扩充模块用于采用重建瑕疵伪图进行x射线图像的样本扩充。本发明上述提出的x射线图像的样本扩充装置还可以具有如下附加技术特征：根据本发明的一个实施例，所述第一内容编码器、所述第二内容编码器、所述第三内容编码器、所述第四内容编码器包括：两次下采样的残差模块组成的全卷积网络，所述第一细节编码器或所述第二细节编码器包括：卷积层、残差模块和全连接层。根据本发明的一个实施例，所述内容鉴别器包括：三层5×5的下采样卷积模块、一层3×3的卷积层和LeakyReLU激活函数，所述内容鉴别器采用交叉熵损失函数进行特征编码隶属度的判断，所述第一生成器Gy1或所述第三生成器Gy2包括：两个残差模块、两个上采样模块和一个卷积模块，所述上采样模块包括：双线性插值、卷积层、BN层和ReLU激活函数；所述第二生成器Gx1或所述第四生成器Gx2包括：两个上采样模块、一个卷积模块和Tanh激活函数。本发明的有益效果：本发明无需成对的标签数据集即可实现x射线图像的瑕疵生成，同时，通过对图像的内容和细节进行编码，将样本的内容特征和语义特征解码，使用权重共享的编码器提取x域和y域中的共享潜在编码，采用内容鉴别器区分共享编码特征的域隶属度，可以增加瑕疵编码特征的多样性。附图说明图1是根据本发明一个实施例的x射线图像的样本扩充方法的流程图；图2是根据本发明一个实施例的x射线图像的样本扩充装置的方框示意图；图3是采用本发明实施例的x射线图像的样本扩充方法后输入图片、一次伪图和重建伪图的对比图；图4是采用本发明实施例的x射线图像的样本扩充方法后生成的样本示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。图1是根据本发明一个实施例的x射线图像的样本扩充方法的流程图，如图1所示，该方法包括以下步骤：S1，获取IC封装模块的x射线图像构成的训练数据集，训练数据集包括：正常图像和瑕疵图像。具体地，针对一些IC封装模块，其瑕疵主要存在于其内部的模块，直接获取其表面图像无法对其进行实质的瑕疵检测，因此需要获取其x射线图像，在进行训练数据集构建时，采用其x射线图像，训练数据集包括正常图像和瑕疵图像，瑕疵图像的分类包括为断线和虚焊等，本发明的正常图像采样分布为，瑕疵图像的采样分布为/＞，P为变量x的边缘分布，P为变量y的边缘分布。S2，将训练数据集进行缩放处理。S3，将缩放处理后的正常图像和瑕疵图像分别输入权重共享的第一内容编码器和第二内容编码器，且第一内容编码器和第二内容编码器通过内容鉴别器进行特征编码域的隶属度的判断，以通过第一内容编码器和第二内容编码器将正常图像和瑕疵图像的内容映射至第一共享特征空间，第一共享特征空间包括：x域共享的第一特征编码Zx1和y域共享的第一特征编码Zy1。在本发明的实施例中，内容鉴别器可以包括：三层5×5的下采样卷积模块、一层3×3的卷积层和LeakyReLU激活函数。具体地，如图2所示，将训练数据集的输入尺寸缩放至128×128，然后经过权重共享的第一内容编码器和第二内容编码器从边缘分布P和P中学习共享的特征编码，以将正常图像和瑕疵图像内容映射至共享的特征空间，引入了基于对抗域自适应的离散表示学习更丰富的纹理和语义特征。通过权重共享第一内容编码器和第二内容编码器将图像的内容特征映射至共享特征空间时，相同的高级映射函数不能保证相同的内容表示为两个域编码相同的信息，因此，加入了一个内容鉴别器，内容鉴别器/＞通过交叉熵损失函数，可以正常图像和瑕疵图像的特征编码的域隶属度进行区分，并使用交叉熵损失函数对其进行优化。此外，内容鉴别器不能用于区分生成域的内容编码器编码的特征。内容鉴别器的优化函数/＞可表示为：表示x域的期望，/＞表示y域的期望，/＞为内容鉴别器。S4，将缩放处理后的瑕疵图像输入第一细节编码器中，以生成第一细节特征编码。S5，将第一细节特征编码和x域共享的第一特征编码Zx1输入第一生成器Gy1中，以生成正常伪图，将y域共享的第一特征编码Zy1输入第二生成器Gx1中，以生成瑕疵伪图。S6，将瑕疵图像和正常伪图输入第一鉴别器进行对抗性训练，以获取一次正常伪图，将正常图像和瑕疵伪图输入第二鉴别器/＞行对抗性训练，以获取一次瑕疵伪图。具体地，如图2所示，将步骤S2中获取的x域共享的第一特征编码Zx1和步骤S4中获取的瑕疵图像的第一细节特征编码送入第一生成器Gy1中，将步骤S3中获取的y域共享的第一特征编码Zy1送入第二生成器Gx1。在本发明的实施例中，第一生成器Gy1和第二生成器Gx1或的输入数据不同，因此构造也不同，第一生成器Gy1为y域生成器，第二生成器Gx1为x域生成器。第一生成器Gy1包括：两个残差模块、两个上采样模块和一个卷积模块，上采样模块包括：双线性插值、卷积层、BN层和ReLU激活函数。输入的瑕疵图像的第一细节特征编码与x域共享的第一特征编码Zx1经过残差模块进行拼接形成一次特征编码，一次特征编码经过上采样模块形成二次编码特征，以此类推，最终输出的四次特征编码经过激活函数生成正常伪图。第二生成器Gx1包括：两个上采样模块、一个卷积模块和Tanh激活函数。输入的特征编码经过两次次上采样和卷积生成最终特征编码，最后再经过Tanh激活函数生成瑕疵伪图具体地，步骤S5生成的正常伪图和瑕疵伪图需要分别经过两个鉴别器进行对抗性训练，以提高瑕疵样本生成的真实性，鉴别器的结构为多尺度的形式，由一组逐步下采样的卷积层组成，分别对输入伪图进行64倍、32倍和16倍下采样，两个此外鉴别器采用与PathGan相同的全卷积方式，通过多尺度全卷积输出真图和伪图特征经过交叉熵损失函数计算最终损失值，最后使用反向梯度传播算法对鉴别器、编码器和生成器进行优化。对于瑕疵图像域定义了对抗损失，对于正常图像域定义对抗性损失/＞，即使用交叉熵损失函数进行优化，公式表示为：表示第二鉴别器的对抗性损失，/＞表示第二鉴别器，/＞表示正常伪图，x表示x域变量，y表示y域变量，/＞表示采样分布为/＞的正常图像的期望，表示采样分布为/＞瑕疵图像的期望，/＞表示瑕疵伪图，/＞表示第一鉴别器的对抗性损失，/＞表示采样分布为/＞的正常图像和采样分布为/＞瑕疵图像的期望。步骤S1-S6阶段为前向交叉翻译阶段，y域共享的第一特征编码Zy1经过Gx1生成瑕疵伪图，第一细节特征编码和x域共享的第一特征编码Zx1拼接后经过Gy1拼生成正常伪图，此时生成的伪图可能改变了原图中的特征，并且产生了一些与图像内容无关干扰特征，为此，本发明还进行下述S7-S8的后向重建阶段。S7，将一次正常伪图输入第二细节编码器，以生成第二细节特征编码，将一次瑕疵伪图和一次正常伪图输入权重共享的第三内容编码器和第四内容编码器，以通过第三内容编码器和第四内容编码器将一次瑕疵伪图和一次正常伪图的内容映射至第二共享特征空间，第二共享特征空间包括：x域共享的第二特征编码Zy2和y域共享的第二特征编码Zy2。第二细节编码器与第一细节编码器的结构作用相同，第三内容编码器和第一内容编码器结构相同，第四内容编码器与第二内容编码器的结构相同。S8，将第二细节特征编码和x域共享的第二特征编码Zx2输入第三生成器Gy2中，以生成重建瑕疵伪图，将y域共享的第二特征编码Zy2输入第四生成器Gx2中，以生成重建正常伪图，其中，重建瑕疵伪图和瑕疵图像采用交叉循环一致性损失函数计算损失值，重建正常伪图和正常图像交叉循环一致性损失函数计算损失值。第三生成器Gy2与第一生成器Gy1的结构相同，第四生成器Gx2与第二生成器Gx1的结构相同。具体地，如图2所示，前向交叉翻译阶段生成的一次伪图会再经历一次交叉翻译，但不需要使用相应的鉴别器对内容编码和生成的伪图鉴别，正常和瑕疵伪图分别经过编码后，编码特征经过Gy2和Gx2分别生成重建瑕疵伪图和重建正常伪图，这整个过程称作交叉循环一致性，使用交叉循环一致性损失函数计算二次生成的伪图和输入图像之间的损失值，这个过程是为了保持重建后图像的内容能够保持与原图像相同，只对细微的特征做出变换。S9，采用重建瑕疵伪图进行x射线图像的样本扩充。在上述的步骤的基础上，对本发明的超参数设置进行详细说明，输入大小为128×128，使用6个adam优化器分别对两个内容编码器，一个细节编码器，以及两个生成器，一个内容鉴别器进行优化，其中beta值设置为0.5，权重衰减系数为0.0001，初始的学习率大小设置为0.0001，学习率衰减周期为200个epoch，由于x射线采集的图像为灰度图，因此设置输入输出通道数为1，其中KL散度损失的权重系数为0.01，交叉循环一致性损失函数权重系数为10。图3是采用本发明上述的x射线图像的样本扩充方法后输入图片、一次伪图和重建伪图的对比图，具体图3中上部分图片依次代表正常图像、一次瑕疵伪图和重建正常伪图，图3中下半部分依次代表瑕疵图像、一次正常伪图和重建瑕疵伪图。由图3可知，采用二次重建后生成的图像细节特征更为清楚。图4是采用本发明上述的x射线图像的样本扩充方法后生成的样本示意图。经相关具体实验得到采用本发明上述提出的扩充方法进行样本扩充后的分割效果，表1是采用不同的样本扩充方法后同一分割模型的分割效果对比。表1其中，None代表不进行样本扩充，CycleGan代表采用CycleGan进行样本扩充，OURs代表采用本发明上述提出的图像的样本扩充方法进行样本扩充。U-net代表分割模型，IS表示生成后的图片与真实图像的分布的距离，Dice score是精确率和召回率的调和平均数，这个分数是像素级的检测得分，当应用于二元分割任务时，它会评估预测值A和真实值B之间的重叠程度。由表1可知，采用本发发明上述提出的图像的样本扩充方法进行样本扩充后，分割效果显著提高。综上所述，根据本发明实施例的x射线图像的样本扩充方法，不需要成对的标签数据集也能够实现x射线图像的瑕疵生成，同时，通过对抗域自适应的离散表示对图像的内容和风格进行编码，将样本的内容特征和语义特征解码，并且使用权重共享的编码器提取x域和y域中的共享潜在编码，加入了内容鉴别器区分共享编码特征共享编码特征的域隶属度，增加瑕疵编码特征的多样性。为了能够实现瑕疵样本和原始图像内容的保持，采取两次交叉重建的方式，在第一阶段使用正常图像的编码特征实现一次生成，使用鉴别器在一次阶段实现传统的对抗性损失，第二阶段依然使用交叉传递的方式，但是并没有使用内容鉴别器，最后通过加入交叉循环一致性损失函数实现无监督的非配对数据集训练和保持原图内容。与上述的x射线图像的样本扩充方法相对应，本发明还提出一种x射线图像的样本扩充装置。图2是根据本发明一个实施例的x射线图像的样本扩充装置的方框示意图，如图2所示，该装置包括：获取模块、缩放模块、权重共享的第一内容编码器和第二内容编码、第一细节编码器、第一生成器Gy1、第二生成器Gx1、第一鉴别器、第二鉴别器、第二细节编码器、权重共享的第三内容编码器和第四内容编码器、第三生成器Gy2、第四生成器Gx2和扩充模块。获取模块用于获取IC封装模块的x射线图像构成的训练数据集，训练数据集包括：正常图像和瑕疵图像；缩放模块用于将训练数据集进行缩放处理；第一内容编码器和第二内容编码器器用于将正常图像和瑕疵图像的内容映射至第一共享特征空间，且第一内容编码器和第二内容编码器通过内容鉴别器进行特征编码域的隶属度的判断，第一共享特征空间包括：x域共享的第一特征编码Zx1和y域共享的第一特征编码Zy1；第一细节编码器用于根据缩放处理后的瑕疵图像生成第一细节特征编码；第一生成器Gy1用于根据第一细节特征编码/＞和/＞域共享的第一特征编码/＞生成正常伪图；第二生成器Gx1，第二生成器Gx1用于根据y域共享的第一特征编码Zy1生成瑕疵伪图；第一鉴别器用于根据瑕疵图像和正常伪图进行对抗性训练，以获取一次正常伪图；第二鉴别器用于根据正常图像和瑕疵伪图进行对抗性训练，以获取一次瑕疵伪图；第二细节编码器用于根据一次正常伪图生成第二细节特征编码/＞；权重共享的第三内容编码器和第四内容编码器，权重共享的第三内容编码器和第四内容编码器用于将一次瑕疵伪图和一次正常伪图的内容映射至第二共享特征空间，第二共享特征空间包括：x域共享的第二特征编码Zx2和y域共享的第二特征编码Zy2；第三生成器Gy2用于根据第二细节特征编码/＞和x域共享的第二特征编码Zx2生成重建瑕疵伪图；第四生成器Gx2用于根据y域共享的第二特征编码Zy2生成重建正常伪图，其中，重建瑕疵伪图和瑕疵图像采用交叉循环一致性损失函数计算损失值，重建正常伪图和正常图像采用L1损失函数计算损失值；扩充模块，扩充模块用于采用重建瑕疵伪图进行x射线图像的样本扩充。根据本发明的一个实施例，第一内容编码器、第二内容编码器、第三内容编码器、第四内容编码器包括：两次下采样的残差模块组成的全卷积网络，第一细节编码器或第二细节编码器包括：卷积层、残差模块和全连接层。根据本发明的一个实施例，内容鉴别器包括：三层5×5的下采样卷积模块、一层3×3的卷积层和LeakyReLU激活函数，内容鉴别器采用交叉熵损失函数进行特征编码的域隶属度的判断，第一生成器Gy1或第三生成器Gy2包括：两个残差模块、两个上采样模块和一个卷积模块，上采样模块包括：双线性插值、卷积层、BN层和ReLU激活函数；第二生成器Gx1或第四生成器Gx2包括：两个上采样模块、一个卷积模块和Tanh激活函数。根据本发明的一个实施例，第一鉴别器和第二鉴别器进行对抗性训练时，采用交叉熵损失函数计算损失值。综上所述，x射线图像的样本扩充装置，需要成对的标签数据集也能够实现x射线图像的瑕疵生成，同时，通过对抗域自适应的离散表示对图像的内容和风格进行编码，将样本的内容特征和语义特征解码，并且使用权重共享的编码器提取x域和y域中的共享潜在编码，加入了内容鉴别器区分共享编码特征共享编码特征的域隶属度，增加瑕疵编码特征的多样性。为了能够实现瑕疵样本和原始图像内容的保持，采取两次交叉重建的方式，在第一阶段使用正常图像的编码特征实现一次生成，使用鉴别器在一次阶段实现传统的对抗性损失，第二阶段依然使用交叉传递的方式，但是并没有使用内容鉴别器，最后通过加入交叉循环一致性损失函数实现无监督的非配对数据集训练和保持原图内容。在本发明的描述中，术语“第一”、“第二”仅用于描述目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量。由此，限定有“第一”、“第二”的特征可以明示或者隐含地包括一个或者更多个该特征。“多个”的含义是两个或两个以上，除非另有明确具体的限定。在本说明书的描述中，参考术语“一个实施例”、“一些实施例”、“示例”、“具体示例”、或“一些示例”等的描述意指结合该实施例或示例描述的具体特征、结构、材料或者特点包含于本发明的至少一个实施例或示例中。在本说明书中，对上述术语的示意性表述不必针对相同的实施例或示例。而且，描述的具体特征、结构、材料或者特点可以在任一个或多个实施例或示例中以合适的方式结合。此外，在不相互矛盾的情况下，本领域的技术人员可以将本说明书中描述的不同实施例或示例以及不同实施例或示例的特征进行结合和组合。在本说明书的描述中，参考术语“一个实施例”、“一些实施例”、 “示例”、“具体示例”、或“一些示例”等的描述意指结合该实施例或示例描述的具体特征、结构、材料或者特点包含于本发明的至少一个实施例或示例中。在本说明书中，对上述术语的示意性表述不必须针对的是相同的实施例或示例。而且，描述的具体特征、结构、材料或者特点可以在任一个或多个实施例或示例中以合适的方式结合。此外，在不相互矛盾的情况下，本领域的技术人员可以将本说明书中描述的不同实施例或示例以及不同实施例或示例的特征进行结合和组合。流程图中或在此以其他方式描述的任何过程或方法描述可以被理解为，表示包括一个或更多个用于实现定制逻辑功能或过程的步骤的可执行指令的代码的模块、片段或部分，并且本发明的优选实施方式的范围包括另外的实现，其中可以不按所示出或讨论的顺序，包括根据所涉及的功能按基本同时的方式或按相反的顺序，来执行功能，这应被本发明的实施例所属技术领域的技术人员所理解。在流程图中表示或在此以其他方式描述的逻辑和/或步骤，例如，可以被认为是用于实现逻辑功能的可执行指令的定序列表，可以具体实现在任何计算机可读介质中，以供指令执行系统、装置或设备使用，或结合这些指令执行系统、装置或设备而使用。就本说明书而言，"计算机可读介质"可以是任何可以包含、存储、通信、传播或传输程序以供指令执行系统、装置或设备或结合这些指令执行系统、装置或设备而使用的装置。计算机可读介质的更具体的示例包括以下：具有一个或多个布线的电连接部，便携式计算机盘盒，随机存取存储器，只读存储器，可擦除可编辑只读存储器，光纤装置，以及便携式光盘只读存储器。另外，计算机可读介质甚至可以是可在其上打印所述程序的纸或其他合适的介质，因为可以例如通过对纸或其他介质进行光学扫描，接着进行编辑、解译或必要时以其他合适方式进行处理来以电子方式获得所述程序，然后将其存储在计算机存储器中。应当理解，本发明的各部分可以用硬件、软件、固件或它们的组合来实现。在上述实施方式中，多个步骤或方法可以用存储在存储器中且由合适的指令执行系统执行的软件或固件来实现。如，如果用硬件来实现和在另一实施方式中一样，可用本领域公知的下列技术中的任一项或他们的组合来实现：具有用于对数据信号实现逻辑功能的逻辑门电路的离散逻辑电路，具有合适的组合逻辑门电路的专用集成电路，可编程门阵列，现场可编程门阵列等。本技术领域的普通技术人员可以理解实现上述实施例方法携带的全部或部分步骤是可以通过程序来指令相关的硬件完成，所述的程序可以存储于一种计算机可读存储介质中，该程序在执行时，包括方法实施例的步骤之一或其组合。此外，在本发明各个实施例中的各功能单元可以集成在一个处理模块中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个模块中。上述集成的模块既可以采用硬件的形式实现，也可以采用软件功能模块的形式实现。所述集成的模块如果以软件功能模块的形式实现并作为独立的产品销售或使用时，也可以存储在一个计算机可读取存储介质中。上述提到的存储介质可以是只读存储器，磁盘或光盘等。尽管上面已经示出和描述了本发明的实施例，可以理解的是，上述实施例是示例性的，不能理解为对本发明的限制，本领域的普通技术人员在本发明的范围内可以对上述实施例进行变化、修改、替换和变型。尽管已经示出和描述了本发明的实施例，对于本领域的普通技术人员而言，可以理解在不脱离本发明的原理和精神的情况下可以对这些实施例进行多种变化、修改、替换和变型，本发明的范围由所附权利要求及其等同物限定。
