标题title
一种基于BP神经网络的超声水表流量数据融合方法和装置
摘要abst
本发明提供一种基于BP神经网络的超声水表流量数据融合方法和装置，属于流量检测技术领域。方法包括：获取超声水表在多种情况下特定流量点的各个声道的流速数据；分别将各个声道的流速数据进行平均；构建BP神经网络模型：训练BP神经网络模型以及验证BP神经网络模型，得到训练好的BP神经网络模型；将训练好的BP神经网络模型各神经元的最终权值和偏置参数传输至多声道超声水表，多声道超声水表通过训练好的BP神经网络模型对当前的流场进行识别，并调用对应流场下的权重系数进行数据融合；本发明提高了各种安装环境下流量测量的准确性，解决超声水表在实际安装过程中对长直管段的要求，具有更优的测量性能。
权利要求书clms
1.一种基于BP神经网络的超声水表流量数据融合方法，其特征在于，所述方法包括：S101、获取超声水表在多种情况下特定流量点的各个声道的流速数据；S102、分别将各个声道的流速数据进行平均；S103、构建BP神经网络模型：训练BP神经网络模型以及验证BP神经网络模型，得到训练好的BP神经网络模型；S104、将S103训练好的BP神经网络模型各神经元的最终权值和偏置参数传输至多声道超声水表，所述多声道超声水表通过训练好的BP神经网络模型对当前的流场进行识别，并调用对应流场下的权重系数进行数据融合；S104包括确定BP神经网络的激活函数为Leaky-ReLU函数、输入层神经元数量为n个、输出层神经元数量为1个、隐含层神经元数量为n+m、隐含层为神经元数量为1个；其中，BP神经网络输出层的输出结果为声道测量流速数据融合后的面平均流速；所述面平均流速提供如下公式进行计算：式中，y为面平均流速，x为各声道流速组成的输入向量，为隐含层的第j个神经元的最优权系数向量，/＞为隐含层的第j个神经元与输入层第n个神经元的最优权系数；为隐含层的第1个神经元的输出结果；其中n为1、2、3……；m为1、2、3……。2.根据权利要求1所述的基于BP神经网络的超声水表流量数据融合方法，其特征在于，隐含层1的输出结果向量计算公式如式所示：式中，y1为隐含层的输出结果向量，f为隐含层激活函数，w1为隐含层的用于流场识别神经元的权系数矩阵，为隐含层的第m+1神经元的最优权系数向量，b1为隐含层用于流场识别神经元的偏置系数矩阵，/＞为隐含层用于流场识别神经元的偏置系数向量。3.根据权利要求2所述的基于BP神经网络的超声水表流量数据融合方法，其特征在于，隐含层的第1个神经元的输出结果如式所示：式中，为隐含层的第1个神经元的输出结果，f为隐含层激活函数，y1为隐含层输出结果向量，/＞为隐含层第1神经元的最优权系数矩阵，/＞为隐含层的偏置系数，/＞为隐含层1的用于管道内流场识别部分的神经元，/＞为隐含层2的最优权系数矩阵，/＞为隐含层2的第1个神经元与/＞神经元对应的权值，/＞为隐含层2的第1个神经元与/＞神经元对应的权值。4.根据权利要求1所述的基于BP神经网络的超声水表流量数据融合方法，其特征在于，S103中训练BP神经网络模型包括：S31、通过随机函数为BP神经网络各神经元进行权值和偏置参数的初值赋值；S32、提取BP神经网络学习样本，将n个声道的流速作为输入层，将面平均流速作为输出期望，并对输入层数据进行归一化处理，采用最大值与最小值法归一化处理所述神经网络学习样本，使输出期望值分布在范围内，得到已训练好的BP神经网络模型；S33、进入BP神经网络训练过程，将已训练好的BP神经网络通过各神经元的权值和偏置参数计算各层各神经元的输出结果，将已训练好的BP神经网络输出层的输出结果进行反归一化处理，得到本次训练输出值。5.根据权利要求4所述的基于BP神经网络的超声水表流量数据融合方法，其特征在于，S103中验证BP神经网络模型包括：S34、计算本次训练输出值与所述输出期望的误差，比较本次训练输出值与所述输出期望的误差，如果所述误差未满足设计要求则根据最速下降法和动量法更新BP神经网络各层各神经元的权值和偏置，然后重复S33；S35、输出BP神经网络各神经元的最终权值和偏置参数。6.根据权利要求5所述的基于BP神经网络的超声水表流量数据融合方法，其特征在于，所述方法还包括对S35中输出的BP神经网络各神经元的权值和偏置参数进行修正。7.根据权利要求6所述的基于BP神经网络的超声水表流量数据融合方法，其特征在于，通过如下公式对S35中输出的BP神经网络各神经元的权值和偏置参数进行优化：a＝a+Δa式中，k为迭代运算步数，mc为动量因子，η为第k步的学习率，EA为第k步的传递误差，a为优化后的权值和偏置参数，ω为第k步的权值和偏置参数，Δω为第k步权值和偏置参数的偏差。8.根据权利要求4所述的基于BP神经网络的超声水表流量数据融合方法，其特征在于，所述S34中的误差为相对误差。9.一种基于BP神经网络的超声水表流量数据融合装置，其特征在于，所述装置包括可读存储介质，所述可读存储介质可执行权利要求1-8任一所述的方法。
说明书desc
技术领域本发明属于流量检测技术领域，具体涉及一种基于BP神经网络的超声水表流量数据融合方法和装置。背景技术基于时差法的超声波流量测量原理是通过检测测量管道中超声波信号顺逆流的渡越时间得到时间差，根据时间差求得管道内的流体流量。该方法具有精度高、量程比宽和重复性好等优点。基于时差法的超声水表通常按照声道分为单声道和多声道，与单声道超声流量计相比，多声道超声波流量计受流场的影响较小，应用较为广泛。多声道超声流量计常用权重系数法进行数据融合方法，通常的方法是在高斯积分的基础上，采用高斯-勒让德、高斯-雅可比、Tailored和OWICS等数据融合方法来获取声道权重系数。采用基于遗传BP神经网络算法方法结合了遗传算法在全局搜索中的优势，使其流量测量误差远小于高斯求积法，但算法的有效性很大程度上取决于设计者指定的网络架构、初始权重和层偏差。多声道超声流量计的融合方法多采用传统的固定权值，将各声道流速数据进行加权求和。该方法具有局限性，导致其测量的误差很难减小。发明内容本发明要解决的技术问题是提供一种基于BP神经网络的超声水表流量数据融合方法和装置，可以解决上述背景技术中提出的问题。为解决上述技术问题，本发明提供如下技术方案：一方面，提供了一种基于BP神经网络的超声水表流量数据融合方法，所述方法包括：S101、获取超声水表在多种情况下特定流量点的各个声道的流速数据；S102、分别将各个声道的流速数据进行平均；S103、构建BP神经网络模型：训练BP神经网络模型以及验证BP神经网络模型，得到训练好的BP神经网络模型；S104、将S103训练好的BP神经网络模型各神经元的最终权值和偏置参数传输至多声道超声水表，所述多声道超声水表通过训练好的BP神经网络模型对当前的流场进行识别，并调用对应流场下的权重系数进行数据融合；S104包括确定BP神经网络的激活函数为Leaky-ReLU函数、输入层神经元数量为n个、输出层神经元数量为1个、隐含层1神经元数量为n+m、隐含层2为神经元数量为1个；其中，BP神经网络输出层的输出结果为声道测量流速数据融合后的面平均流速；所述面平均流速提供如下公式进行计算：式中，y为面平均流速，x为各声道流速组成的输入向量，为隐含层1的第j个神经元的最优权系数向量，/＞为隐含层1的第j个神经元与输入层第n个神经元的最优权系数；/＞为隐含层2的第1个神经元的输出结果；其中n为1、2、3……；m为1、2、3……。其中，各声道流速组成的输入向量可以通过获取管道内不同声道的水流流速数据建立向量。隐含层1的第j个神经元的最优权系数向量通过隐含层1的第j个神经元的最优权系数组成向量。在一种可选的实施例中，隐含层2的输出结果向量计算公式如式所示：式中，y1为隐含层1的输出结果向量，f为隐含层激活函数，w1为隐含层1的用于流场识别神经元的权系数矩阵，为隐含层1的第m+1神经元的最优权系数向量，b1为隐含层1用于流场识别神经元的偏置系数矩阵，/＞为隐含层1用于流场识别神经元的偏置系数向量。在一种可选的实施例中，隐含层2的第1个神经元的输出结果如式所示：式中，为隐含层2的第1个神经元的输出结果，f为隐含层激活函数，y1为隐含层1输出结果向量，/＞为隐含层2第1神经元的最优权系数矩阵，/＞为隐含层2的偏置系数，为隐含层1的用于管道内流场识别部分的神经元，/＞为隐含层2的最优权系数矩阵，/＞为隐含层2的第1个神经元与/＞神经元对应的权值，/＞为隐含层2的第1个神经元与/＞神经元对应的权值，/＞为隐含层2的偏置系数。在一种可选的实施例中，S103中训练BP神经网络模型包括：S31、通过随机函数为BP神经网络各神经元进行权值和偏置参数的初值赋值；S32、提取BP神经网络学习样本，将n个声道的流速作为输入层，将面平均流速作为输出期望，并对输入层数据进行归一化处理，采用最大值与最小值法归一化处理所述神经网络学习样本，使输出期望值分布在范围内，得到已训练好的BP神经网络模型；S33、进入BP神经网络训练过程，将已训练好的BP神经网络通过各神经元的权值和偏置参数计算各层各神经元的输出结果，将已训练好的BP神经网络输出层的输出结果进行反归一化处理，得到本次训练输出值。在一种可选的实施例中，S103中验证BP神经网络模型包括：S34、计算本次训练输出值与所述输出期望的误差，比较本次训练输出值与所述输出期望的误差，如果所述误差未满足设计要求则根据最速下降法和动量法更新BP神经网络各层各神经元的权值和偏置，然后重复S33。最速下降法一般指梯度下降。梯度下降是迭代法的一种，可以用于求解最小二乘问题。在求解机器学习算法的模型参数，即无约束优化问题时，梯度下降是最常采用的方法之一，最速下降法与动量法的使用为现有技术，因此本申请对此不做赘述。S35、输出BP神经网络各神经元的最终权值和偏置参数。在一种可选的实施例中，所述方法还包括对S35中输出的BP神经网络各神经元的权值和偏置参数进行修正。在一种可选的实施例中，通过如下公式对S35中输出的BP神经网络各神经元的权值和偏置参数进行优化a＝a+Δa式中，k为迭代运算步数，mc为动量因子，η为第k步的学习率，EA为第k步的传递误差，a为优化后的权值和偏置参数，ω为第k步的权值和偏置参数，Δω为第k步权值和偏置参数的偏差。在一种可选的实施例中，所述S34中的误差为相对误差。另一方面，提供了一种基于BP神经网络的超声水表流量数据融合装置，所述装置包括可读存储介质，所述可读存储介质可执行上述任一所述的方法。本发明实施例提供的方法至少具有以下有益效果：本发明实施例提供了基于BP神经网络的多声道超声水表流量数据融合方法，通过输入的各声道流速，识别管道内的不同流场下对应的最优权值计算，提高了各种安装环境下流量测量的准确性，解决超声水表在实际安装过程中对长直管段的要求，具有更优的测量性能。附图说明并入本文中并且构成说明书的部分的附图示出了本公开的实施例，并且与说明书一起进一步用来对本公开的原理进行解释，并且使相关领域技术人员能够实施和使用本公开。图1为本发明一种基于BP神经网络的超声水表流量数据融合方法流程示意图；图2为本发明BP神经网络拓扑结构示意图。具体实施方式下面结合附图和具体实施例对本发明提供的一种建筑施工用警示效果好的护栏进行详细描述。同时在这里做以说明的是，为了使实施例更加详尽，下面的实施例为最佳、优选实施例，对于一些公知技术本领域技术人员也可采用其他替代方式而进行实施；而且附图部分仅是为了更具体的描述实施例，而并不旨在对本发明进行具体的限定。需要指出的是，在说明书中提到“一个实施例”、“实施例”、“示例性实施例”、“一些实施例”等指示的实施例可以包括特定特征、结构或特性，但未必每个实施例都包括该特定特征、结构或特性。另外，在结合实施例描述特定特征、结构或特性时，结合其它实施例实现这种特征、结构或特性应在相关领域技术人员的知识范围内。通常，可以至少部分从上下文中的使用来理解术语。例如，至少部分取决于上下文，本文中使用的术语“一个或多个”可以用于描述单数意义的任何特征、结构或特性，或者可以用于描述复数意义的特征、结构或特性的组合。另外，术语“基于”可以被理解为不一定旨在传达一组排他性的因素，而是可以替代地，至少部分地取决于上下文，允许存在不一定明确描述的其他因素。如图1所示，本发明的实施例提供一种基于BP神经网络的超声水表流量数据融合方法，方法包括：S101、获取超声水表在多种情况下特定流量点的各个声道的流速数据；S102、分别将各个声道的流速数据进行平均；S103、构建BP神经网络模型：训练BP神经网络模型以及验证BP神经网络模型，得到训练好的BP神经网络模型；S104、将S103训练好的BP神经网络模型各神经元的最终权值和偏置参数传输至多声道超声水表，多声道超声水表通过训练好的BP神经网络模型对当前的流场进行识别，并调用对应流场下的权重系数进行数据融合；S104包括确定BP神经网络的激活函数为Leaky-ReLU函数、输入层神经元数量为n个、输出层神经元数量为1个、用于识别的神经网络隐含层神经元数量为n+1个、用于最优权重计算的神经网络隐含层数量为m个；其中，n为声道数量，m为不同流场分类数量，BP神经网络输出层的输出结果为声道测量流速数据融合后的面平均流速；面平均流速提供如下公式进行计算：式中，y为面平均流速，x为各声道流速组成的输入向量，为隐含层1的第j个神经元的最优权系数向量，/＞为隐含层1的第j个神经元与输入层第n个神经元的最优权系数；/＞为隐含层2的第1个神经元的输出结果；其中n为1、2、3……；m为1、2、3……。本发明实施例提供的方法至少具有以下有益效果：本发明实施例提供了基于BP神经网络的多声道超声水表流量数据融合方法，通过输入的各声道流速，识别管道内的不同流场下对应的最优权值计算，提高了各种安装环境下流量测量的准确性，解决超声水表在实际安装过程中对长直管段的要求，具有更优的测量性能。以下将通过可选的实施例进一步解释和描述本发明实施例提供的方法：本发明实施例首先通过在多声道超声水表通过不同流场下的多流量点实验，分别获取超声水表在多种情况下特定流量点的各个声道的流速数据，分别将各个声道多次测量的数据进行平均，以减少测量过程中的随机误差。然后采用BP神经网络对实验数据对进行训练，得到多声道超声水表的神经网络参数。最后将训练得到的BP神经网络参数传输至多声道超声水表，超声水表通过训练好的BP神经网络对当前的流场进行识别，并调用对应流场下的权重系数进行数据融合。在一种可选的实施例中，隐含层n的输出结果向量计算公式如式所示：式中，y1为隐含层1的输出结果向量，f为隐含层激活函数，w1为隐含层1的用于流场识别神经元的权系数矩阵，为隐含层1的第m+1神经元的最优权系数向量，b1为隐含层1用于流场识别神经元的偏置系数矩阵，/＞为隐含层1用于流场识别神经元的偏置系数向量。在一种可选的实施例中，隐含层2的第1个神经元的输出结果如式所示：式中，为隐含层2的第1个神经元的输出结果，f为隐含层激活函数，y1为隐含层1输出结果向量，/＞为隐含层2第1神经元的最优权系数矩阵，/＞为隐含层2的偏置系数，，为隐含层1的用于管道内流场识别部分的神经元，/＞为隐含层2的最优权系数矩阵，/＞为隐含层2的第1个神经元与/＞神经元对应的权值，/＞为隐含层2的第1个神经元与/＞神经元对应的权值，/＞为隐含层2的偏置系数。在一种可选的实施例中，S103中训练BP神经网络模型包括：S31、通过随机函数为BP神经网络各神经元进行权值和偏置参数的初值赋值；S32、提取BP神经网络学习样本，将M个声道的流速作为输入层，将面平均流速作为输出期望，并对输入层数据进行归一化处理，采用最大值与最小值法处理神经网络学习样本，使输出期望值分布在范围内，得到已训练好的BP神经网络模型；S33、进入BP神经网络训练过程，将已训练好的BP神经网络通过各神经元的权值和偏置参数计算各层各神经元的输出结果，将已训练好的BP神经网络输出层的输出结果进行反归一化处理，得到本次训练输出值。在一种可选的实施例中，S103中验证BP神经网络模型包括：S34、计算本次训练输出值与所述输出期望的误差，比较本次训练输出值与所述输出期望的误差，如果所述误差未满足设计要求则根据最速下降法和动量法更新BP神经网络各层各神经元的权值和偏置，然后重复S33；S35、输出BP神经网络各神经元的最终权值和偏置参数。在一种可选的实施例中，方法还包括对S35中输出的BP神经网络各神经元的最终权值和偏置参数进行修正。在一种可选的实施例中，通过如下公式对S35中输出的BP神经网络各神经元的权值和偏置参数进行优化ω＝ω+Δω式中，k为迭代运算步数，mc为动量因子，η为第k步的学习率，EA为第k步的传递误差，a为优化后的权值和偏置参数，ω为第k步的权值和偏置参数，Δω为第k步权值和偏置参数的偏差。BP神经网络的隐含层设计是BP神经网络的关键。隐含层层数和隐含层神经元个数决定了BP神经网络的性能。隐含层中神经元个数太少BP神经网络拟合的准确度低，不能准确反映训练数据的内在规律，造成数据融合误差大；隐含层神经元个数太多会导致过拟合现象，同时会占用过多的数据存储空间并使数据融合程序运行时间过长。本发明实施例中输入层神经元数量为4个，输出层神经元数量为1个，因此用于识别的BP神经网络隐含层神经元数量为5个。在一种可选的实施例中，S34中的误差为相对误差。以下通过四声道超声水表3种不同流场进行识别进行为例对本发明实施例提供的方法进行详细说明。请参见图2，通过神经元分别计算不同流场情况下的最优权重，通过神经元进行流场识别，然后根据/＞神经元流场识别结果对应选择输出对应面平均流速结果。BP神经网络通过BP算法训练得到各参数，最终面平均流速如式所示，通过BP神经元计算结果识别管道内的流场，并调用对应流场的最优权值进行数据融合计算最终得到面平均流速。式中，y为面平均流速，x为各声道流速组成的输入向量，为隐含层1的第j个神经元的最优权系数向量，j取值1～3，/＞为隐含层1的第j个神经元与输入层第1神经元的最优权系数，/＞为隐含层1的第j个神经元与输入层第2神经元的最优权系数，/＞为隐含层1的第j个神经元与输入层第3神经元的最优权系数；/＞为隐含层2的第1个神经元的输出结果。管道内流场识别部分采用这4个神经元作为隐含层构成多层神经网络，使其具备非线性分类能力。隐含层1的计算公式如式所示。式中，y1为隐含层1的输出结果向量，f为隐含层激活函数，w1为隐含层1的用于流场识别神经元的权系数矩阵，为隐含层1的第4神经元的最优权系数向量，j为输入层神经元编号，取值为1～4，/＞为隐含层1的第5神经元的最优权系数向量，/＞为隐含层1的第6神经元的最优权系数向量，/＞为隐含层1的第7神经元的最优权系数向量，b1为隐含层1用于流场识别神经元的偏置系数向量，/＞为隐含层1的第7个神经元…,/＞..为隐含层1的第7神经元的偏置系数。流场识别神经元计算计算公式如式所示为管道内的流场识别神经元，f为隐含层激活函数，y1为隐含层1输出结果向量，为隐含层2第1神经元的最优权系数向量，/＞为隐含层2的偏置系数，为管道内流场识别部分作为隐含层1的神经元，/＞为隐含层2的最优权系数矩阵，/＞为隐含层2的第1个神经元与/＞神经元对应的权值，/＞为隐含层2的第1个神经元与/＞神经元对应的权值，为/＞为隐含层2的偏置系数。通过采用附加动量法修正网络中的权值，从而对BP神经网络进行改进，可以提高BP神经网络预测性能，式与式为动量法权值调节公式：a＝a+Δa式中，k为迭代运算步数，mc为动量因子，η为第k步的学习率，EA为第k步的传递误差，a为优化后的权值和偏置参数，ω为第k步的权值和偏置参数，Δω为第k步权值和偏置参数的偏差。BP神经网络算法通过动量因子mc将上时刻权值修正量引入本次调整中，利用“惯性效应”解决误差目标函数陷入局部极小值问题。BP神经网络通过训练，得到BP神经网络各神经元的最终权值和偏置参数。在验证阶段，BP神经网络根据训练阶段获得的各神经元权值和偏置参数，将验证数据输入至BP神经网络，计算BP神经网络输出值与验证数据结果之间的误差。验证数据取不同流场下不同流量点的数据作为神经网络的验证数据。实际测量中，由获得的BP神经网络各神经元偏置和权值，根据各个声道的实时测量流速，BP神经网络识别当前测量流场情况和声道流速数据融合权重系数，计算得到多声道超声流量测量的平均流量。另一方面，本发明实施例还提供了一种基于BP神经网络的超声水表流量数据融合装置，装置包括可读存储介质，可读存储介质可执行上述任一的方法。本发明涵盖任何在本发明的精髓和范围上做的替代、修改、等效方法以及方案。为了使公众对本发明有彻底的了解，在以下本发明优选实施例中详细说明了具体的细节，而对本领域技术人员来说没有这些细节的描述也可以完全理解本发明。另外，为了避免对本发明的实质造成不必要的混淆，并没有详细说明众所周知的方法、过程、流程、元件和电路等。以上所述仅是本发明的优选实施方式，应当指出，对于本技术领域的普通技术人员来说，在不脱离本发明原理的前提下，还可以作出若干改进和润饰，这些改进和润饰也应视为本发明的保护范围。
