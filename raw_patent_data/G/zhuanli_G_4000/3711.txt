标题title
一种风场模型三维可视化的实现方法及装置
摘要abst
本发明公开了一种风场模型三维可视化的实现方法及装置，该方法包括：获取风场的GIS原始数据，并对GIS原始数据进行预处理；基于预处理后的GIS数据确定设置对应的坐标系和相机参数；根据预处理后的GIS数据构建风场的网格模型；从风场的网格模型中选取待可视化的计算域；对计算域中的风速剖面进行可视化；对计算域中的三维粒子进行可视化。本发明通过将粒子运动可视化更直观地得出风场流动的趋势，通过该方法能够更有效地展现三维复杂的气流运动，提升风场模型可视化的效果，同时本发明还基于该风场模型的可视化方法进行平台开发，结合流体计算程序能够有效展示计算程序的可视化操作、计算域的可视化选取以及计算结果的可视化展示。
权利要求书clms
1.一种风场模型三维可视化的实现方法，包括：获取风场的GIS原始数据，并对所述GIS原始数据进行预处理；基于预处理后的GIS数据确定设置对应的坐标系和相机参数；根据预处理后的GIS数据构建所述风场的网格模型；从所述风场的网格模型中选取待可视化的计算域；对所述计算域中的风速剖面进行可视化；对所述计算域中的三维粒子进行可视化。2.根据权利要求1所述的方法，其特征在于，所述GIS原始数据包括地形数据，所述地形数据包括第一经度信息和第一纬度信息，对所述GIS原始数据进行预处理，包括：对所述第一经度信息和所述第一纬度信息进行偏移量修正；根据修正后的第一经度信息和修正后的第一纬度信息计算出对应的第一法向量；根据修正后的第一经度信息和修正后的第一纬度信息、所述第一法向量建立所述地形数据对应的第一网格模型。3.根据权利要求2所述的方法，其特征在于，所述GIS原始数据还包括城市数据，对所述GIS原始数据进行预处理，包括：获取所述城市数据中建筑对应的第二经度信息和第二纬度信息；根据所述第二经度信息和所述第二纬度信息计算出对应的第二法向量；根据所述第二经度信息和所述第二纬度信息、所述第二法向量建立所述建筑数据对应的第二网格模型。4.根据权利要求1所述的方法，其特征在于，基于预处理后的GIS数据确定设置对应的坐标系，包括：获取UTM坐标系中的原点坐标；对所述原点坐标进行偏移，获得转换后的原点坐标。5.根据权利要求1所述的方法，其特征在于，基于预处理后的GIS数据确定设置相机参数，包括：获取相机到画布的高度和画布宽度；根据所述相机到画布的高度、所述画布宽度确定相机的视角和窗口纵横比；获取画布的分辨率，并根据所述相机到画布的高度、所述画布宽度、所述相机的视角和所述画布的分辨率计算出相机到画布的距离；设置观测点的坐标为PlookAt＝xi+yj；设置顶向量的坐标为Pup＝sini+cosj；根据所述观测点的坐标、所述顶向量的坐标、所述相机到画布的距离计算得到相机的坐标Pcamera。6.根据权利要求1所述的方法，其特征在于，根据预处理后的GIS数据构建所述风场的网格模型，包括：建立一个实例，并将预处理后的GIS数据赋值到所述实例中对应的参数；计算显示屏幕所包含的所述风场的网格模型中的数据块。7.根据权利要求6所述的方法，其特征在于，计算显示屏幕所包含的所述风场的网格模型中的数据块，包括：从显示屏幕中心点对应的数据块开始，左右遍历至不可见，再上下逐行遍历，直至当前行不存在任何可显示的数据块为止。8.根据权利要求1所述的方法，其特征在于，从所述风场的网格模型中选取待可视化的计算域，包括：获取计算域的中心点坐标和宽度、交互点的坐标；根据所述计算域的中心点坐标和宽度、所述交互点的坐标确定交互点是否在当前计算域中；如果在当前计算域中，则确定当前计算域为待可视化的计算域；利用片元着色器为所述待可视化的计算域赋予第一颜色值；利用所述片元着色器为非待可视化的计算域赋予第二颜色值。9.根据权利要求1所述的方法，其特征在于，对所述计算域中的风速剖面进行可视化，包括：将风速数据以二维纹理贴图的形式转为统一变量；获取所述计算域的输出层数量、横向数据点数和截面高度；根据所述统一变量、所述输出层数量、所述横向数据点数和所述截面高度计算出每层数据对应的纹理坐标utexture和vtexture；对所述纹理坐标进行线性插值计算得到所述计算域中所有位置的风速数据；使用HSV颜色空间对所有位置的风速数据进行颜色映射。10.根据权利要求1所述的方法，其特征在于，对所述计算域中的三维粒子进行可视化，包括：在所述计算域中对所述三维粒子进行初始化；对所述计算域的网格数据进行线性插值计算，以更新每一时刻所述三维粒子的位置；根据每一时刻所述三维粒子的位置绘制出所述三维粒子的轨迹。11.一种风场模型三维可视化的实现装置，包括：预处理模块，用于获取风场的GIS原始数据，并对所述GIS原始数据进行预处理；设置模块，用于基于预处理后的GIS数据确定设置对应的坐标系和相机参数；构建模块，用于根据预处理后的GIS数据构建所述风场的网格模型；选取模块，用于从所述风场的网格模型中选取待可视化的计算域；风速剖面可视化模块，用于对所述计算域中的风速剖面进行可视化；粒子可视化模块，用于对所述计算域中的三维粒子进行可视化。12.根据权利要求11所述的装置，其特征在于，所述GIS原始数据包括地形数据，所述地形数据包括第一经度信息和第一纬度信息，所述预处理模块用于：对所述第一经度信息和所述第一纬度信息进行偏移量修正；根据修正后的第一经度信息和修正后的第一纬度信息计算出对应的第一法向量；根据修正后的第一经度信息和修正后的第一纬度信息、所述第一法向量建立所述地形数据对应的第一网格模型。13.根据权利要求12所述的装置，其特征在于，所述GIS原始数据还包括城市数据，所述预处理模块用于：获取所述城市数据中建筑对应的第二经度信息和第二纬度信息；根据所述第二经度信息和所述第二纬度信息计算出对应的第二法向量；根据所述第二经度信息和所述第二纬度信息、所述第二法向量建立所述建筑数据对应的第二网格模型。14.根据权利要求11所述的装置，其特征在于，所述设置模块，用于：获取UTM坐标系中的原点坐标；对所述原点坐标进行偏移，获得转换后的原点坐标。15.根据权利要求11所述的装置，其特征在于，所述设置模块，用于：获取相机到画布的高度和画布宽度；根据所述相机到画布的高度、所述画布宽度确定相机的视角和窗口纵横比；获取画布的分辨率，并根据所述相机到画布的高度、所述画布宽度、所述相机的视角和所述画布的分辨率计算出相机到画布的距离；设置观测点的坐标为PlookAt＝xi+yj；设置顶向量的坐标为Pup＝sini+cosj；根据所述观测点的坐标、所述顶向量的坐标、所述相机到画布的距离计算得到相机的坐标Pcamera。16.根据权利要求11所述的装置，其特征在于，所述构建模块，用于：建立一个实例，并将预处理后的GIS数据赋值到所述实例中对应的参数；计算显示屏幕所包含的所述风场的网格模型中的数据块。17.根据权利要求16所述的装置，其特征在于，所述构建模块，用于：从显示屏幕中心点对应的数据块开始，左右遍历至不可见，再上下逐行遍历，直至当前行不存在任何可显示的数据块为止。18.根据权利要求11所述的装置，其特征在于，所述选取模块，用于：获取计算域的中心点坐标和宽度、交互点的坐标；根据所述计算域的中心点坐标和宽度、所述交互点的坐标确定交互点是否在当前计算域中；如果在当前计算域中，则确定当前计算域为待可视化的计算域；利用片元着色器为所述待可视化的计算域赋予第一颜色值；利用所述片元着色器为非待可视化的计算域赋予第二颜色值。19.根据权利要求11所述的装置，其特征在于，所述风速剖面可视化模块，用于：将风速数据以二维纹理贴图的形式转为统一变量；获取所述计算域的输出层数量、横向数据点数和截面高度；根据所述统一变量、所述输出层数量、所述横向数据点数和所述截面高度计算出每层数据对应的纹理坐标utexture和vtexture；对所述纹理坐标进行线性插值计算得到所述计算域中所有位置的风速数据；使用HSV颜色空间对所有位置的风速数据进行颜色映射。20.根据权利要求11所述的装置，其特征在于，所述粒子可视化模块用于：在所述计算域中对所述三维粒子进行初始化；对所述计算域的网格数据进行线性插值计算，以更新每一时刻所述三维粒子的位置；根据每一时刻所述三维粒子的位置绘制出所述三维粒子的轨迹。
说明书desc
技术领域本发明涉及可视化技术领域，尤其涉及一种风场模型三维可视化方法及装置。背景技术随着互联网、可视化等技术的发展，如何更高效、准确、直观模拟特定区域内风场的运动状态是一个重要的研究课题，这对认识局部地区气候特征、大气循环规律和认识不同地形下风场对城市的影响等都有重要作用。虽然目前对于风场模型三维可视化的研究在不断加深，但仍存在着以下问题：1)采用传统技术对原始GIS地形数据进行划分生成的数据文件大小通常在500MB至1GB范围，且原始城市建筑数据以建筑轮廓及层数确定，以城市划分文件得到的数据文件大小约50MB，数据传输较慢且耗费内存资源。2)由于数据资源的限制，粒子系统技术往往仅停留于全球风场、流场的可视化中，粒子运动仍停留于由经纬度坐标表示的球面上，其本质上仍是二维的粒子仿真，以二维的粒子运动难以表示三维复杂的气流运动。现有专利CN106846474A公开了一种基于时序特征和粒子系统的WebGIS时空过程模拟方法，该方法通过分别创建WebGIS场景和粒子系统场景并进行场景融合；基于时间序列分析时空过程的特征，对时空现象产生、发展和灭亡的过程进行抽象表达；之后根据运动规则更新粒子状态，并执行渲染完成时空过程可视化。该方法能够扩展WebGIS对时空现象的可视化能力。现有专利CN113836762A公开了一种风力机及风电场数字镜像模拟展示系统，该系统包括：叶片状态监测及预测模块，用于基于风机叶轮声光监测和叶片震动变形监测；塔筒振动监测及应力分析预测模块，用于预测塔筒的累积疲劳水平；机组动态尾流模拟展示模块，用于通过高精度仿真和3D虚拟现实展示风电场的尾流干扰风机受力运行工况；自适应优化控制模块，用于基于监测到的机组运行数据，实时调整偏航系统的控制方式和机组控制方式。该方法能够模拟展示风力机及风电场运行状态下尾流干扰。上述两个专利中仍无法实现对三维复杂的气流运动的准确模拟，且未针对GIS数据划分方式进行改进。发明内容基于上述技术问题，本发明提出一种风场模型三维可视化的实现方法及装置，解决现有技术中对GIS数据划分后数据文件过大传输较慢、难以模拟三维复杂气流运动的问题。为了实现上述目的，本发明提出一种风场模型三维可视化的实现方法，该方法包括：获取风场的GIS原始数据，并对所述GIS原始数据进行预处理。基于预处理后的GIS数据确定设置对应的坐标系和相机参数。根据预处理后的GIS数据构建所述风场的网格模型。从所述风场的网格模型中选取待可视化的计算域。对所述计算域中的风速剖面进行可视化。对所述计算域中的三维粒子进行可视化。可选的，所述GIS原始数据包括地形数据，所述地形数据包括第一经度信息和第一纬度信息，对所述GIS原始数据进行预处理，包括：对所述第一经度信息和所述第一纬度信息进行偏移量修正。根据修正后的第一经度信息和修正后的第一纬度信息计算出对应的第一法向量。根据修正后的第一经度信息和修正后的第一纬度信息、所述第一法向量建立所述地形数据对应的第一网格模型。可选的，所述GIS原始数据还包括城市数据，对所述GIS原始数据进行预处理，包括：获取所述城市数据中建筑对应的第二经度信息和第二纬度信息。根据所述第二经度信息和所述第二纬度信息计算出对应的第二法向量。根据所述第二经度信息和所述第二纬度信息、所述第二法向量建立所述建筑数据对应的第二网格模型。可选的，基于预处理后的GIS数据确定设置对应的坐标系，包括：获取UTM坐标系中的原点坐标。对所述原点坐标进行偏移，获得转换后的原点坐标。可选的，基于预处理后的GIS数据确定设置相机参数，包括：获取相机到画布的高度和画布宽度。根据所述相机到画布的高度、所述画布宽度确定相机的视角和窗口纵横比。获取画布的分辨率，并根据所述相机到画布的高度、所述画布宽度、所述相机的视角和所述画布的分辨率计算出相机到画布的距离。设置观测点的坐标为PlookAt＝xi+yj。设置顶向量的坐标为Pup＝sini+cosj。根据所述观测点的坐标、所述顶向量的坐标、所述相机到画布的距离计算得到相机的坐标Pcamera。可选的，根据预处理后的GIS数据构建所述风场的网格模型，包括：建立一个实例，并将预处理后的GIS数据赋值到所述实例中对应的参数。计算显示屏幕所包含的所述风场的网格模型中的数据块。可选的，计算显示屏幕所包含的所述风场的网格模型中的数据块，包括：从显示屏幕中心点对应的数据块开始，左右遍历至不可见，再上下逐行遍历，直至当前行不存在任何可显示的数据块为止。可选的，从所述风场的网格模型中选取待可视化的计算域，包括：获取计算域的中心点坐标和宽度、交互点的坐标。根据所述计算域的中心点坐标和宽度、所述交互点的坐标确定交互点是否在当前计算域中。如果在当前计算域中，则确定当前计算域为待可视化的计算域。利用片元着色器为所述待可视化的计算域赋予第一颜色值。利用所述片元着色器为非待可视化的计算域赋予第二颜色值。可选的，对所述计算域中的风速剖面进行可视化，包括：将风速数据以二维纹理贴图的形式转为统一变量。获取所述计算域的输出层数量、横向数据点数和截面高度。根据所述统一变量、所述输出层数量、所述横向数据点数和所述截面高度计算出每层数据对应的纹理坐标utexture和vtexture。对所述纹理坐标进行线性插值计算得到所述计算域中所有位置的风速数据。使用HSV颜色空间对所有位置的风速数据进行颜色映射。可选的，对所述计算域中的三维粒子进行可视化，包括：在所述计算域中对所述三维粒子进行初始化。对所述计算域的网格数据进行线性插值计算，以更新每一时刻所述三维粒子的位置。根据每一时刻所述三维粒子的位置绘制出所述三维粒子的轨迹。为了实现与上述方法相同的目的，本发明还提出一种风场模型三维可视化的实现装置，包括：预处理模块，用于获取风场的GIS原始数据，并对所述GIS原始数据进行预处理。设置模块，用于基于预处理后的GIS数据确定设置对应的坐标系和相机参数。构建模块，用于根据预处理后的GIS数据构建所述风场的网格模型。选取模块，用于从所述风场的网格模型中选取待可视化的计算域。风速剖面可视化模块，用于对所述计算域中的风速剖面进行可视化。粒子可视化模块，用于对所述计算域中的三维粒子进行可视化。可选的，所述GIS原始数据包括地形数据，所述地形数据包括第一经度信息和第一纬度信息，所述预处理模块用于：对所述第一经度信息和所述第一纬度信息进行偏移量修正。根据修正后的第一经度信息和修正后的第一纬度信息计算出对应的第一法向量。根据修正后的第一经度信息和修正后的第一纬度信息、所述第一法向量建立所述地形数据对应的第一网格模型。可选的，所述GIS原始数据还包括城市数据，所述预处理模块用于：获取所述城市数据中建筑对应的第二经度信息和第二纬度信息。根据所述第二经度信息和所述第二纬度信息计算出对应的第二法向量。根据所述第二经度信息和所述第二纬度信息、所述第二法向量建立所述建筑数据对应的第二网格模型。可选的，所述设置模块，用于：获取UTM坐标系中的原点坐标。对所述原点坐标进行偏移，获得转换后的原点坐标。可选的，所述设置模块，用于：获取相机到画布的高度和画布宽度。根据所述相机到画布的高度、所述画布宽度确定相机的视角和窗口纵横比。获取画布的分辨率，并根据所述相机到画布的高度、所述画布宽度、所述相机的视角和所述画布的分辨率计算出相机到画布的距离。设置观测点的坐标为PlookAt＝xi+yj。设置顶向量的坐标为Pup＝sini+cosj。根据所述观测点的坐标、所述顶向量的坐标、所述相机到画布的距离计算得到相机的坐标Pcamera。可选的，所述构建模块，用于：建立一个实例，并将预处理后的GIS数据赋值到所述实例中对应的参数。计算显示屏幕所包含的所述风场的网格模型中的数据块。可选的，所述构建模块，用于：从显示屏幕中心点对应的数据块开始，左右遍历至不可见，再上下逐行遍历，直至当前行不存在任何可显示的数据块为止。可选的，所述选取模块，用于：获取计算域的中心点坐标和宽度、交互点的坐标。根据所述计算域的中心点坐标和宽度、所述交互点的坐标确定交互点是否在当前计算域中。如果在当前计算域中，则确定当前计算域为待可视化的计算域。利用片元着色器为所述待可视化的计算域赋予第一颜色值。利用所述片元着色器为非待可视化的计算域赋予第二颜色值。可选的，所述风速剖面可视化模块，用于：将风速数据以二维纹理贴图的形式转为统一变量。获取所述计算域的输出层数量、横向数据点数和截面高度。根据所述统一变量、所述输出层数量、所述横向数据点数和所述截面高度计算出每层数据对应的纹理坐标utexture和vtexture。对所述纹理坐标进行线性插值计算得到所述计算域中所有位置的风速数据。使用HSV颜色空间对所有位置的风速数据进行颜色映射。可选的，所述粒子可视化模块用于：在所述计算域中对所述三维粒子进行初始化。对所述计算域的网格数据进行线性插值计算，以更新每一时刻所述三维粒子的位置。根据每一时刻所述三维粒子的位置绘制出所述三维粒子的轨迹。基于上述技术方案，该风场模型三维可视化的实现方法及装置上述的实施例至少具有如下有益效果：1、本发明通过将粒子运动可视化更直观地得出风场流动的趋势，其中涉及的粒子运动不再停留于由经纬度坐标表示的球面上，还考虑到辐向的粒子运动，通过该方法能够更有效地展现三维复杂的气流运动，提升风场模型可视化的效果。3、本发明中基于该风场模型的可视化方法进行平台开发，结合流体计算程序能够有效展示计算程序的可视化操作、计算域的可视化选取以及计算结果的可视化展示。3、本发明在获取GIS原始数据后，对该类数据进行了预处理，在一定程度上缩短了上传数据所消耗的时间，同时减少数据所占的内存。附图说明构成本发明的一部分的说明书附图用来提供对本发明的进一步理解，本发明的示意性实施例及其说明用于解释本发明，并不构成对本发明的不当限定。在附图中：图1为本发明一个实施例的一种风场模型三维可视化的实现方法的流程图；图2为本发明一个实施例中对地形数据的预处理操作流程图；图3为本发明一个实施例中对城市数据的预处理操作流程图；图4为本发明一个实施例中基于预处理后的GIS数据确定设置相机参数的流程图；图5为本发明一个实施例中采用的透视相机及参数示意图；图6A为本发明一个具体实施例的地形数据可视化效果图图6B为本发明一个具体实施例的城市数据的可视化效果；图7为本发明一个实施例中从风场网格模型中选取待可视化计算域的流程图；图8为本发明基于一个实施例所建立的平台的程序鼠标交互时序图；图9为本发明一个具体实施例的计算域可视化效果；图10为本发明一个实施例对计算域中的风速剖面进行可视化的流程图；图11为本发明一个具体实施例的纹理坐标转换示意图；图12为本发明一个实施例对计算域中的三维粒子进行可视化的流程图；图13为本发明一个具体实施例中三维粒子插值计算的示意图；图14A为本发明一个具体实施例中地形数据的三维粒子系统风场流动趋势示意图；图14B为本发明一个具体实施例中地形数据及城市数据的三维粒子系统风场流动趋势示意图；图15为本发明一个实施例的一种风场模型三维可视化的实现装置示意图。具体实施方式需要说明的是，在不冲突的情况下，本发明中的实施例及实施例中的特征可以相互组合。下面将参考附图并结合实施例来详细说明本发明。以下结合具体实施例对本发明作进一步详细描述，这些实施例不能理解为限制本发明所要求保护的范围。实施例为了实现上述目的，本发明提出一种风场模型三维可视化的实现方法。如图1中示出了本发明一个实施例的一种风场模型三维可视化的实现方法的流程图，如图1所示，该方法包括如下步骤：S1，获取风场的GIS原始数据，并对所述GIS原始数据进行预处理。具体来说，所述GIS原始数据可包括地形数据，所述地形数据包括第一经度信息和第一纬度信息。在本发明的一个具体实施例中，获取的地形数据中第一经度信息为东经116-117°，第一纬度信息为北纬39-40°。获取到地形数据后，需要将该地形数据以最近点原则对齐到30m的网格中，对齐后得出整体经纬度网格在x、y轴分别偏移10.1256m和-3.3866m，基于获得的数据偏移量进行预处理操作，如图2所示，所述预处理操作具体包括如下步骤：S101，对所述第一经度信息和所述第一纬度信息进行偏移量修正。本实施例在将地形数据转换为几何网格时，以附加偏移量的方式消除偏移误差。具体地，该实施例中以3000m的正方形网格进行分块，并以x、y依次编号，即每个网格包含101×101个数据点，数据点经偏移量修正后，转化为经度116.5°北纬39.5°为中心的坐标系中，可缩小浮点数误差。S102，根据修正后的第一经度信息和修正后的第一纬度信息计算出对应的第一法向量。基于步骤S101修正后的第一经度信息、修正后的第一纬度信息计算出对应的第一法向量。S103，根据修正后的第一经度信息和修正后的第一纬度信息、所述第一法向量建立所述地形数据对应的第一网格模型。基于上述步骤S101与S102得到的修正后的第一经度信息、修正后的第一纬度信息与第一法向量建立第一网格模型，将坐标及第一法向量结果依次以32位浮点数保存为public/data/mesh/relief/x/y文件，其中x、y表示其网格横纵向的分块编号。具体来说，本实施例是通过Three.js方法建立的第一网格模型。在本发明的另一个实施例中，所述GIS原始数据还包括城市数据，如图3所示，所述城市数据的预处理操作主要包括如下步骤：S110，获取所述城市数据中建筑对应的第二经度信息和第二纬度信息。与地形数据相同，同样采用3000m网格对城市数据进行分块，本实施例中简单以建筑中心坐标所在位置进行划分而不对建筑进行切割，以加快数据转换效率。数据分块结束后，获取所述城市数据中建筑对应的第二经度信息和第二纬度信息。S111，根据所述第二经度信息和所述第二纬度信息计算出对应的第二法向量。基于步骤S110获取的第二经度信息和第二纬度信息计算出对应的第二法向量。S112，根据所述第二经度信息和所述第二纬度信息、所述第二法向量建立所述建筑数据对应的第二网格模型。基于获取的第二经度信息、所述第二纬度信息和所述第二法向量，建立所述建筑数据对应的第二网格模型。为了保证建筑性能，本实施例中将各块建筑合并为同一个几何网格模型，加速模型渲染的速度，最终将其坐标及法向量数据依次以32位浮点数保存为public/data/mesh/urban/x/y文件，其中x、y表示其网格横纵向的分块编号。具体来说，本实施例是通过Three.js方法将建筑轮廓转换得到的第二网格模型。S2，基于预处理后的GIS数据确定设置对应的坐标系和相机参数。具体地，该步骤S2包括如下两个子步骤，S210，基于预处理后的GIS数据确定设置对应的坐标系；S220，基于预处理后的GIS数据确定设置相机参数。其中，步骤S210，基于预处理后的GIS数据确定设置对应的坐标系，首先需要获取UTM坐标系中的原点坐标，并对所述原点坐标进行偏移以获得转换后的原点坐标，详细说明如下：在本发明的一个具体实施例中，以北京为例，使用东经116-117°，北纬39-40°并以UTM坐标系表示的数据作为地形及城市建筑数据，为了降低坐标值过大造成的浮点数误差，该实施例中以东经116.5°，北纬39.5°为原点坐标，该原点坐标相对UTM坐标系在x、y方向分别偏移457010.38774697867m和4372383.823613901m，经转换得到转换后的原点坐标：x＝xutm-457010.38774697867、y＝yutm-4372383.823613901。具体来说，本实施例中采用Three.js的透视相机进行三维模型渲染，其以视角、窗口纵横比、远、近裁剪面为参数确定视景体，其中远近裁剪面取固定值near＝1和far＝1010，由相机位置、观测点和顶向量确定视角。如图4所示，所述步骤S220，基于预处理后的GIS数据确定设置相机参数，包括如下子步骤：S221，获取相机到画布的高度和画布宽度。基于预处理后的GIS数据，获取相机到画布的高度height和画布宽度width。S222，根据所述相机到画布的高度、所述画布宽度确定相机的视角和窗口纵横比。在本发明的一个具体实施例中，基于S221获取的相机到画布的高度、画布宽度值，通过公式一计算视角fov，公式一：基于S221获取的相机到画布的高度、画布宽度值，根据公式二计算窗口纵横比aspect，公式二：S223，获取画布的分辨率，并根据所述相机到画布的高度、所述画布宽度、所述相机的视角和所述画布的分辨率计算出相机到画布的距离。其中，分辨率scale通过视平面与z＝0平面交线上的实际长度与像素点比值确定，单位为米/像素。其次，基于相机到画布的高度height、画布宽度width、相机的视角fov和画布的分辨率scale，根据公式三计算相机到画布的距离，公式三：S224，设置观测点的坐标为PlookAt＝xi+yj。具体地，x、y表示投影坐标，i、j表示x、y方向上的单位向量，基于初始投影坐标可设置初始观测点的坐标PlookAt。S225，设置顶向量的坐标为Pup＝sini+cosj。其中，i、j表示x、y方向上的单位向量，yaw为偏航角，是本实施例设置的新参数，表示视线铅垂面与z＝0的交线同y轴的夹角。如图5所示，在PlookAt处附加分别以平行于x、y、z坐标轴的方向向量以表示新参数与对应坐标轴的关系。结合上述参数，根据公式四Pup＝sini+cosj设置顶向量的坐标Pup。S226，根据所述观测点的坐标、所述顶向量的坐标、所述相机到画布的距离计算得到相机的坐标Pcamera。具体来说，该步骤中还需要获取俯仰角pitch，俯仰角指的是视线与z轴的夹角且以角度制表示，为了适配不同的高宽比，约定视角按宽高平均数为16°计算。基于上述步骤得到的初始观测点的坐标PlookAt、相机到画布的距离distance，俯仰角pitch、顶向量坐标Pup及z方向上的单位向量k，根据公式四可计算得到相机的坐标Pcamera，公式四：Pcamera＝PlookAt+distance×sin×Pup+distance×cosk此外，为达到对视图矩阵更新的效果，在本申请的另一个实施例中，依据初始观测点的坐标PlookAt求出Pup、Pcamera后，调用相机的lookAt方法对观测点PlookAt进行迭代更新。S3，根据预处理后的GIS数据构建所述风场的网格模型。具体来说，根据预处理后的GIS数据构建所述风场的网格模型包括如下步骤：首先，建立一个实例，并将预处理后的GIS数据赋值到所述实例中对应的参数。虽然本实施例在GIS数据预处理时采用了数据分块的方式，但由于未对数据进行压缩，导致预处理后得到的所述城市数据可能会达到5MB以上。为了防止数据过大，在本发明的一个具体实施例中，在服务器中对data下的静态文件设置有缓存标记，以防止重复读取。同时，在读取数据时仅需新建一个BufferGeometry实例，并将预处理后的GIS数据分别赋值给position和normal参数，实现几何网格模型的构建。其次，计算显示屏幕所包含的所述风场的网格模型中的数据块。基于上述操作中已构建的几何网格模型，根据屏幕显示计算屏幕所包含的数据块，项目从显示屏幕中心点对应的数据块开始，从左向右遍历至当前列不存在可显示的数据块，再上下逐行遍历，直至当前行不存在任何可显示的数据块为止。为了防止地形起伏和俯仰角造成底部的图块上移，在本发明的一个具体实施例中，将所述屏幕范围的长度设置为100×scale×sin，依据角点是否位于屏幕内或通过各边端点位于以屏幕边界划分的不同区间来判断数据块是否位于屏幕内，计算显示屏幕所包含的所述风场的网格模型中的数据块。如图6A中示出了该具体实施例的地形数据可视化效果，图6B示出了城市数据的可视化效果。S4，从所述风场的网格模型中选取待可视化的计算域。如图7所示，从所述风场的网格模型中选取待可视化的计算域，具体包括如下步骤：S401，获取计算域的中心点坐标和宽度、交互点的坐标。基于上述步骤S3构建的所述风场的网格模型，获取计算域的中心点坐标和宽度、交互点的坐标。本实施例中所述交互点指的是鼠标光标指到的点。S402，根据所述计算域的中心点坐标和宽度、所述交互点的坐标确定交互点是否在当前计算域中。基于上述步骤S401中获取的计算域的中心点坐标和宽度可唯一确定各边与坐标轴平行的正方形计算域，从而确定所述交互点是否在当前计算域中。S403，如果在当前计算域中，则确定当前计算域为待可视化的计算域。经过上述判断，若所述交互点位于当前计算域中，则确定当前计算域为待可视化的计算域；反之，若所述交互点不在当前计算域中，则确定当前计算域为非待可视化的计算域。S404，利用片元着色器为所述待可视化的计算域赋予第一颜色值。S405，利用所述片元着色器为非待可视化的计算域赋予第二颜色值。为提升计算效率，本实施例中采用自定义着色器为所述待可视化、非待可视化的计算域赋予第一颜色值、第二颜色值。考虑到片元着色器无法获得原始的坐标点信息，本实施例中通过扩展顶点着色器将坐标信息以易变变量的形式传入片元着色器，即每次传入的坐标信息为不同的随机数，当所述坐标信息传入片元着色器后，所述片元着色器会根据坐标信息和由JavaScript传入的计算域中心和计算域半边长两个统一变量计算当前坐标是否位于计算域中。对于计算域外的点，即位于非待可视化的计算域的点，本实施例通过将参数gl_FragColor乘以0.5使得颜色变暗，为非待可视化的计算域赋予第二颜色值。如图8示出了该实施例中所建立平台的程序鼠标交互时序图，具体的计算域可视化效果如图9所示。S5，对所述计算域中的风速剖面进行可视化。该步骤可概括为：依照输出层参数返回对应离地高度曲面上的风场网格数据，然后将获取的风场网格数据进行按层划分，并通过预处理将风速数据以数组形式保存至speed参数中，之后采用自定义着色器将二维纹理贴图映射成三维纹理贴图。如图10中示出了该步骤的详细流程，具体说明如下：S501，将风速数据以二维纹理贴图的形式转为统一变量。基于S4中选取的计算域，将风速数据以二维纹理贴图的形式转为统一变量。S502，获取所述计算域的输出层数量、横向数据点数和截面高度。基于S4中选取的计算域，获取输出层数量、横向数据点数和截面高度参数。S503，根据所述统一变量、所述输出层数量、所述横向数据点数和所述截面高度计算出每层数据对应的纹理坐标utexture和vtexture。具体来说，在该步骤中需要通过texture2D方法读取二维纹理贴图坐标数据，所述二维纹理贴图从下往上从左往右填充数据，经过读取得到所述二维纹理贴图共sectionSize列，sectionSize×sectionCount行数据，如图11所示，其u向数据相同，不需映射，v向数据为各层数据堆叠而成，每层数据占/的范围，每层数据坐标偏移量为sectionSize/，因此，第i层u、v坐标对应的纹理坐标为：S504，对所述纹理坐标进行线性插值计算得到所述计算域中所有位置的风速数据。获取截面高度所在的上下层对应的纹理数据后，本实施例使用mix方法对所述纹理坐标进行线性插值，计算得到当前位置的风速数据，并根据选定的数据范围对其进行归一化。S505，使用HSV颜色空间对所有位置的风速数据进行颜色映射。具体来说，本发明使用HSV颜色空间进行数据-颜色映射，使用其不同色相对应不同风速值，以红色表示最大值，蓝色表示最小值，在最大值和最小值之间进行线性内插，最后将HSV颜色空间转为RGB值并修改diffuseColor的参数值。S6，对所述计算域中的三维粒子进行可视化。如图12所示，对所述计算域中的三维粒子进行可视化具体包括以下子步骤：S601，在所述计算域中对所述三维粒子进行初始化。在计算域范围内特定离地高度曲面上对所述三维粒子进行随机初始化。S602，对所述计算域的网格数据进行线性插值计算，以更新每一时刻所述三维粒子的位置。基于S601随机初始化后粒子所在的位置计算其所在的三维风场数据网格的位置，通过网格8个角点的数据进行三次线性插值计算出粒子的风速数据，如图13所示，所述粒子下一时刻的位置Pi+1可通过公式五计算，公式五：Pi+1＝Pi+Vdt。其中，Pi表示i时刻粒子的位置，dt表示两次迭代之间的时间差，V表示粒子的风速数据。依照上述方法可计算得到粒子在每一时刻的位置，并对粒子位置进行更新，同时将粒子Pi和Pi+1的位置存储在LineSegments方法中，具体来说，所述LineSegments方法是一种描点划线的方式，在本实施例中具体通过LineSegments方法将Pi和Pi+1的位置连成一条直线，从而显示粒子的运动轨迹。S603，根据每一时刻所述三维粒子的位置绘制出所述三维粒子的轨迹。本实施例中通过使用一个LineSegments循环队列将历史时刻的轨迹保存下来，每一时刻新的粒子轨迹依次赋给下一个LineSegments，同时将将下一个LineSegments的透明度重置为1，并将其他LineSegments的透明度乘上0.9以实现尾迹淡出的效果。该实施例的地形数据的所述三维粒子的轨迹可视化效果如图14A所示，地形数据及城市数据的所述三维粒子的轨迹可视化效果如图14B所示，如图14A和14B所示，当风场流经城市和山丘时，可明显地看到风场绕过建筑物、从山丘上方越过的趋势，能够更有效地展现三维复杂的气流运动。此外，为了防止由于局部漩涡或极低风速区域造成粒子停滞，除了超越计算域边界要重置粒子，还使用生命周期的方式对其进行控制，在粒子创建时随机初始化生命周期，每一次迭代时生命周期减1，若生命周期结束则重置粒子。为了实现与上述方法相同的目的，本发明还提出一种风场模型三维可视化的实现装置。图15中示出了本发明一个实施例的一种风场模型三维可视化的实现装置示意图，如图15所示，该装置包括预处理模块151、设置模块152、构建模块153、选取模块154、风速剖面可视化模块155、粒子可视化模块156。预处理模块151，用于获取风场的GIS原始数据，并对所述GIS原始数据进行预处理。具体来说，所述GIS原始数据包括地形数据，所述地形数据包括第一经度信息和第一纬度信息，所述预处理模块151用于：对所述第一经度信息和所述第一纬度信息进行偏移量修正。根据修正后的第一经度信息和修正后的第一纬度信息计算出对应的第一法向量。根据修正后的第一经度信息和修正后的第一纬度信息、所述第一法向量建立所述地形数据对应的第一网格模型。所述GIS原始数据还包括城市数据，所述预处理模块151还用于：获取所述城市数据中建筑对应的第二经度信息和第二纬度信息。根据所述第二经度信息和所述第二纬度信息计算出对应的第二法向量。根据所述第二经度信息和所述第二纬度信息、所述第二法向量建立所述建筑数据对应的第二网格模型。设置模块152，用于基于预处理后的GIS数据确定设置对应的坐标系和相机参数。所述设置模块152，用于：获取UTM坐标系中的原点坐标。对所述原点坐标进行偏移，获得转换后的原点坐标。所述设置模块152，还用于：获取相机到画布的高度和画布宽度。根据所述相机到画布的高度、所述画布宽度确定相机的视角和窗口纵横比。获取画布的分辨率，并根据所述相机到画布的高度、所述画布宽度、所述相机的视角和所述画布的分辨率计算出相机到画布的距离。设置观测点的坐标为PlookAt＝xi+yj。设置顶向量的坐标为Pup＝sini+cosj。根据所述观测点的坐标、所述顶向量的坐标、所述相机到画布的距离计算得到相机的坐标Pcamera。构建模块153，用于根据预处理后的GIS数据构建所述风场的网格模型。所述构建模块153，具体用于：建立一个实例，并将预处理后的GIS数据赋值到所述实例中对应的参数。计算显示屏幕所包含的所述风场的网格模型中的数据块。所述构建模块153，还用于：从显示屏幕中心点对应的数据块开始，左右遍历至不可见，再上下逐行遍历，直至当前行不存在任何可显示的数据块为止。选取模块154，用于从所述风场的网格模型中选取待可视化的计算域。所述选取模块154，具体用于：获取计算域的中心点坐标和宽度、交互点的坐标。根据所述计算域的中心点坐标和宽度、所述交互点的坐标确定交互点是否在当前计算域中。如果在当前计算域中，则确定当前计算域为待可视化的计算域。利用片元着色器为所述待可视化的计算域赋予第一颜色值。利用所述片元着色器为非待可视化的计算域赋予第二颜色值。风速剖面可视化模块155，用于对所述计算域中的风速剖面进行可视化。所述风速剖面可视化模块155，具体用于：将风速数据以二维纹理贴图的形式转为统一变量。获取所述计算域的输出层数量、横向数据点数和截面高度。根据所述统一变量、所述输出层数量、所述横向数据点数和所述截面高度计算出每层数据对应的纹理坐标utexture和vtexture。对所述纹理坐标进行线性插值计算得到所述计算域中所有位置的风速数据。使用HSV颜色空间对所有位置的风速数据进行颜色映射。粒子可视化模块156，用于对所述计算域中的三维粒子进行可视化。所述粒子可视化模块156，具体用于：在所述计算域中对所述三维粒子进行初始化。对所述计算域的网格数据进行线性插值计算，以更新每一时刻所述三维粒子的位置。根据每一时刻所述三维粒子的位置绘制出所述三维粒子的轨迹。应当理解的是，一种风场模型三维可视化的实现装置与其对应的一种风场模型三维可视化的实现方法实施例描述一致，故本实施例不再赘述。总之，从以上的描述中可以看出，该风场模型三维可视化的实现方法及装置上述的实施例可实现如下技术效果：1、本发明通过将粒子运动可视化更直观地得出风场流动的趋势，其中涉及的粒子运动不再停留于由经纬度坐标表示的球面上，还考虑到辐向的粒子运动，通过该方法能够更有效地展现三维复杂的气流运动，提升风场模型可视化的效果。3、本发明中基于该风场模型的可视化方法进行平台开发，结合流体计算程序能够有效展示计算程序的可视化操作、计算域的可视化选取以及计算结果的可视化展示。3、本发明在获取GIS原始数据后，对该类数据进行了预处理，在一定程度上缩短了上传数据所消耗的时间，同时减少数据所占的内存。以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括要素的过程、方法、物品或者设备中还存在另外的相同要素。在流程图中表示或在此以其他方式描述的逻辑和/或步骤，例如，可以被认为是用于实现逻辑功能的可执行指令的定序列表，可以具体实现在任何计算机可读介质中，以供指令执行系统、装置或设备使用，或结合这些指令执行系统、装置或设备而使用。应当理解，本发明的各部分可以用硬件、软件、固件或它们的组合来实现。在上述实施方式中，多个步骤或方法可以用存储在存储器中且由合适的指令执行系统执行的软件或固件来实现。例如，如果用硬件来实现，和在另一实施方式中一样，可用本领域公知的下列技术中的任一项或他们的组合来实现：具有用于对数据信号实现逻辑功能的逻辑门电路的离散逻辑电路，具有合适的组合逻辑门电路的专用集成电路，可编程门阵列，现场可编程门阵列等。需要说明的是，在本说明书的描述中，参考术语“一个实施例”、“一些实施例”、“示例”、“具体示例”、或“一些示例”等的描述意指结合该实施例或示例描述的具体特征、结构、材料或者特点包含于本发明的至少一个实施例或示例中。在本说明书中，对上述术语的示意性表述不必须针对的是相同的实施例或示例。而且，描述的具体特征、结构、材料或者特点可以在任一个或多个实施例或示例中以合适的方式结合。此外，在不相互矛盾的情况下，本领域的技术人员可以将本说明书中描述的不同实施例或示例以及不同实施例或示例的特征进行结合和组合。
