标题title
一种超声信号TOF自动提取方法
摘要abst
本发明属于超声成像领域，具体涉及一种超声信号TOF自动提取方法，包括：进行USCT成像系统数学建模，获得原始信号阵列数据集；对原始信号匹配滤波；计算理论窗；进行质量评估；进行线谱提取；进行直达波检测；进行对称性检查，得到最终提取结果。本发明基于匹配滤波的方法进行改进，结合线谱提取技术，综合利用USCT超声阵列的位置信息和校准参考信号，可以自动判别信号质量并提取TOF，具有计算速度快，准确度高的优点。尤其是在低信噪比信号的情况下，提取结果依然具有较高的准确度。
权利要求书clms
1.一种超声信号TOF自动提取方法，其特征在于，包括：步骤1，进行USCT成像系统数学建模，获得原始信号阵列数据集；步骤2，对原始信号匹配滤波；步骤3，计算理论窗；步骤4，进行质量评估；步骤5，进行线谱提取；步骤6，进行直达波检测；步骤7，进行对称性检查，得到最终提取结果。2.根据权利要求1所述的一种超声信号TOF自动提取方法，其特征在于，所述的步骤1包括：设定USCT成像系统由M个换能器阵元组成，M个换能器阵元在空间上呈半球形分布，换能器阵元在空间的坐标为GM×3；实际成像时，其中一个换能器阵元发射超声波时，其他所有阵元进行接收，每个接收通路获取T点接收信号，待所有换能器阵元均发射完成后，数据采集结束，此时得到原始信号阵列数据集UM×N×T，M为发射阵元数目，N为接收阵元数目，T表示采集点数。3.根据权利要求1所述的一种超声信号TOF自动提取方法，其特征在于，所述的步骤2包括：USCT成像系统获取阵元自发自收情况下的电路信号，作为系统的参考信号，记为RM×T，M表示阵元数目；当发射阵元为i，接收阵元j的时域信号为Uij，对应的参考信号为Ri，首先依据信号的绝对幅度初步评估信号是否正常，对在经验阈值范围的信号进行匹配滤波，得到信号MFij：MFij＝Uij*Ri*信号正包络为处理的目标部分，这里对匹配滤波后的信号进行希尔伯特变换提取正包络：Envij＝|HT)|其中，Env表示正包络信号，HT表示希尔波尔变换，1≤i,j≤M，1≤t≤T，i代表发射阵元序号，j代表接收阵元序号，t表示时间点，T表示采集点数。4.根据权利要求3所述的一种超声信号TOF自动提取方法，其特征在于，所述的步骤3包括：通过采集过程中的测量的水的温度Te，计算出声速c，再根据发射接收阵元的几何坐标信息，计算信号理论到达时间：TheroyTOFij＝|G-G|/c其中，TheroyTOFij为信号理论到达时间，G为发射阵元坐标，G为接收阵元坐标；通过数据采样率将时间映射到接收信号的位置点TheroyTOFij→TheroyLij，以该点为中心，左右各取若干点数构造处理窗；处理窗左右边界分别为TheroyLij-winLen和TheroyLij+2winLen，这里winLen设为表示窗长，即后续的处理对象Wij变为：Wij＝Envij。5.根据权利要求4所述的一种超声信号TOF自动提取方法，其特征在于，所述的步骤4包括：计算处理对象Wij的离散系数作为质量评估指标：CVij＝std/mean其中，CVij表示第i个阵元发射时，第j个阵元接收信号计算得到的离散系数，std表示求标准差，mean代表求均值；设定离散系数门限CVthreshold，门限以下的数据认为是纯噪声，直接将对应的TOF提取结果置零，不做后续的处理。6.根据权利要求5所述的一种超声信号TOF自动提取方法，其特征在于，所述的步骤5包括：步骤5.1，极值提取首先通过对相邻数据点的连续两次差分，寻找极大值的位置，保留极值点的位置的数据，其他位置的数据直接置零，即：if Wij＞Wij&amp;Wij＞Wij Wij＝Wij,else Wij＝0其中，TheroyLij-winLen＜t＜TheroyLij+2winLen；步骤5.2，线谱筛选计算理论窗内所有原始数据点的平均值，设定q倍的平均值作为线谱的幅度门限Athreshold：Athreshold＝q*mean)，保留大于幅度门限的数据点，其他位置的数据置零，即：Wij＝0,Wij＜Athreshold其中，TheroyLij-winLen≤t≤TheroyLij+2winLen；步骤5.3，线谱合并依据阵列接收数据的采样率，设定f倍的采样间隔为线谱的宽度门限Bthreshold，即两根线谱如果间隔差在f个采样点内，认为是同一根线谱，需要进行合并，保留幅度较大的，即：if Wij≥Wij Wij＝0,else Wij＝0|tm1-tm2|＜Bthreshold其中，tm1表示第一根线谱的位置，tm2表示第二根线谱的位置。7.根据权利要求6所述的一种超声信号TOF自动提取方法，其特征在于，所述的步骤6包括：步骤6.1，极值排序对Wij进行幅度排序，记录幅度最大值Wij和第二大幅度值Wij，对应位置记为t1,t2；步骤6.2，直达波判断if t1＜t2 TOFij＝t1*Δt；if t1＞t2 TOFij＝t2*Δt；其中，Wij＞Wij，Δt为采样间隔；步骤6.3，理论值对比将TOF提取结果与理论时间作差，设置偏差阈值ΔT，阈值以内的提取结果认为计算有效，否则置零，即：if TOFij＞0&amp;|TheroyTOFij-TOFij|＜ΔT TOFij＝TOFijelse TOFij＝0。8.根据权利要求1所述的一种超声信号TOF自动提取方法，其特征在于，所述的步骤7包括：首先判断TOFij和TOFji是否有提取结果，如果都大于0，则计算二者绝对差值，将偏差超过门限Tthreshold的提取结果认为是异常值，即：if TOFij＞0&amp;TOFij＞0&amp;|TOFij-TOFji|＞Tthreshold则TOFij＝0,TOFji＝0，最终得到所有数据的提取结果矩阵TOFM×N。
说明书desc
技术领域本发明属于超声成像领域，具体涉及一种超声信号TOF自动提取方法。背景技术超声信号TOF自动提取技术，可获取图像重建所需的TOF信息，是超声信号处理的重要内容。常规的TOF提取方法的准确度依赖于信号的信噪比，低信噪比情况下，TOF提取结果准确度不高。基于上述问题，本申请提出一种超声信号TOF自动提取方法。发明内容为了弥补现有技术的不足，本发明提供一种超声信号TOF自动提取方法的技术方案。一种超声信号TOF自动提取方法，包括：步骤1，进行USCT成像系统数学建模，获得原始信号阵列数据集；步骤2，对原始信号匹配滤波；步骤3，计算理论窗；步骤4，进行质量评估；步骤5，进行线谱提取；步骤6，进行直达波检测；步骤7，进行对称性检查，得到最终提取结果。进一步地，所述的步骤1包括：设定USCT成像系统由M个换能器阵元组成，M个换能器阵元在空间上呈半球形分布，换能器阵元在空间的坐标为GM×3；实际成像时，其中一个换能器阵元发射超声波时，其他所有阵元进行接收，每个接收通路获取T点接收信号，待所有换能器阵元均发射完成后，数据采集结束，此时得到原始信号阵列数据集UM×N×T，M为发射阵元数目，N为接收阵元数目，T表示采集点数。进一步地，所述的步骤2包括：USCT成像系统获取阵元自发自收情况下的电路信号，作为系统的参考信号，记为RM×T，M表示阵元数目；当发射阵元为i，接收阵元j的时域信号为Uij，对应的参考信号为Ri，首先依据信号的绝对幅度初步评估信号是否正常，对在经验阈值范围的信号进行匹配滤波，得到信号MFij：MFij＝Uij*Ri*信号正包络为处理的目标部分，这里对匹配滤波后的信号进行希尔伯特变换提取正包络：Envij＝|HT)|其中，Env表示正包络信号，HT表示希尔波尔变换，1≤i,j≤M，1≤t≤T，i代表发射阵元序号，j代表接收阵元序号，t表示时间点，T表示采集点数。进一步地，所述的步骤3包括：通过采集过程中的测量的水的温度Te，计算出声速c，再根据发射接收阵元的几何坐标信息，计算信号理论到达时间：TheroyTOFij＝|G-G|/c其中，TheroyTOFij为信号理论到达时间，G为发射阵元坐标，G为接收阵元坐标；通过数据采样率将时间映射到接收信号的位置点TheroyTOFij→TheroyLij，以该点为中心，左右各取若干点数构造处理窗；处理窗左右边界分别为TheroyLij-winLen和TheroyLij+2winLen，这里winLen设为表示窗长，即后续的处理对象Wij变为：Wij＝Envij。进一步地，所述的步骤4包括：计算处理对象Wij的离散系数作为质量评估指标：CVij＝std/mean其中，CVij表示第i个阵元发射时，第j个阵元接收信号计算得到的离散系数，std表示求标准差，mean代表求均值；设定离散系数门限CVthreshold，门限以下的数据认为是纯噪声，直接将对应的TOF提取结果置零，不做后续的处理。进一步地，所述的步骤5包括：步骤5.1，极值提取首先通过对相邻数据点的连续两次差分，寻找极大值的位置，保留极值点的位置的数据，其他位置的数据直接置零，即：if Wij＞Wij&amp;Wij＞WijWij＝Wij,else Wij＝0其中，TheroyLij-winLen＜t＜TheroyLij+2winLen；步骤5.2，线谱筛选计算理论窗内所有原始数据点的平均值，设定q倍的平均值作为线谱的幅度门限Athreshold：Athreshold＝q*mean)，保留大于幅度门限的数据点，其他位置的数据置零，即：Wij＝0,Wij＜Athreshold其中，TheroyLij-winLen≤t≤TheroyLij+2winLen；步骤5.3，线谱合并依据阵列接收数据的采样率，设定f倍的采样间隔为线谱的宽度门限Bthreshold，即两根线谱如果间隔差在f个采样点内，认为是同一根线谱，需要进行合并，保留幅度较大的，即：if Wij＞WijWij＝0,else Wij＝0|tm1-tm2|＜Bthreshold其中，tm1表示第一根线谱的位置，tm2表示第二根线谱的位置。进一步地，所述的步骤6包括：步骤6.1，极值排序对Wij进行幅度排序，记录幅度最大值Wij和第二大幅度值Wij，对应位置记为t1,t2；步骤6.2，直达波判断if t1＜t2 TOFij＝t1*Δt；if t1＞t2 TOFij＝t2*Δt；其中，Wij＞Wij，Δt为采样间隔；步骤6.3，理论值对比将TOF提取结果与理论时间作差，设置偏差阈值ΔT，阈值以内的提取结果认为计算有效，否则置零，即：if TOFij＞0&amp;|TheroyTOFij-TOFij|＜ΔT TOFij＝TOFijelse TOFij＝0。进一步地，所述的步骤7包括：首先判断TOFij和TOFji是否有提取结果，如果都大于0，则计算二者绝对差值，将偏差超过门限Tthreshold的提取结果认为是异常值，即：if TOFij＞0&amp;TOFij＞0&amp;|TOFij-TOFji|＞Tthreshold则TOFij＝0,TOFji＝0，最终得到所有数据的提取结果矩阵TOFM×N。与现有技术相比，本发明的有益效果是：本发明基于匹配滤波的方法进行改进，结合线谱提取技术，综合利用USCT超声阵列的位置信息和校准参考信号，可以自动判别信号质量并提取TOF，具有计算速度快，准确度高的优点。尤其是在低信噪比信号的情况下，提取结果依然具有较高的准确度。附图说明图1为本发明流程图图2为本发明中USCT成像系统半球阵列空间分布图。具体实施方式下面结合附图对本发明作进一步说明。请参阅图1，一种超声信号TOF自动提取方法，包括以下步骤：步骤1，成像系统数学建模USCT成像系统的核心是半球形的超声换能器阵列，该阵列共有M个收发兼用型阵元。以半球中心为原点，建立空间三维坐标系，所有阵元在空间的分布如下图，坐标记为GM×3,M为阵元数目。实际成像时，其中一个阵元发射超声波时，其他所有阵元进行接收，每个接收通路获取T点接收信号，待所有阵元均发射完成后，数据采集结束，此时得到原始阵列数据集UM×N×T，M为发射阵元数目，N为接收阵元数目，T表示采集点数，本实施例中，M＝N＝2304，T＝4000。本发明的主要目标是从超声阵列数据UM×N×T提取所有发射接收对的实际传播时间，结果记为TOFM×N，M为发射阵元数目，N为接收阵元数目，计算之前该矩阵初始化为0。步骤2，原始信号匹配滤波理论发射信号经过多级硬件通路后再加载到换能器端发射，实际发射信号与理论发射信号的存在差异，故USCT成像系统专门设计了自校准功能，以获取阵元自发自收情况下的电路信号，作为系统的参考信号，记为RM×T。发射信号为宽频脉冲，经半球腔体中的水介质的传播，到达接收阵元，故接收信号与发射信号存在相关性。以系统参考信号集RM×T构造匹配滤波器，对阵元接收信号集UM×N×T进行脉冲压缩，可提高输出信噪比，得到的时延信息更精确，信号信噪比低的情况下，该步骤非常重要。当发射阵元为i，接收阵元j的时域信号为Uij，对应的参考信号为Ri，首先依据信号的绝对幅度初步评估信号是否正常，对在经验阈值范围的信号进行匹配滤波，得到信号MFij：MFij＝Uij*Ri*信号正包络为处理的目标部分，这里对匹配滤波后的信号进行希尔伯特变换提取正包络：Envij＝|HT)|其中，Env表示正包络信号，HT表示希尔波尔变换，1≤i,j≤M，1≤t≤T，i代表发射阵元序号，j代表接收阵元序号，t表示时间点。步骤3，计算理论窗通过采集过程中的测量的水的温度Te，计算出声速c，再根据发射接收阵元的几何坐标信息，计算信号的理论到达时间：TheroyTOFij＝|G-G|/c其中，TheroyTOFij为信号理论到达时间，G为发射阵元坐标，G为接收阵元坐标。通过数据采样率将时间映射到接收信号的位置点TheroyTOFij→TheroyLij，以该点为中心，左右各取一定点数构造处理窗。由于理论位置只需一次计算并且可以提前进行计算，直接处理窗内的数据点，这样可减小计算量，同时也可以提高处理速度。根据处理经验，处理窗左右边界分别为TheroyLij-winLen和TheroyLij+2winLen，这里winLen设为100，即后续的处理对象Wij变为：Wij＝Envij步骤4，质量评估线谱操作相对耗时，所以首先对处理对象进行质量评估，对满足质量要求的信号才进行线谱提取操作。接收脉冲绝对幅度较背景噪声大，而且噪声数据变化幅度比较稳定，所以当窗内信号同时存在脉冲段和噪声段时，整体的变化幅度要比窗内只存在噪声时大。统计学中，离散系数通常被用作衡量数据离散程度的指标，这一指标的特性符合窗内信号的判断需求，离散系数越大，说明数据中包含有幅度较大的接收脉冲，所以计算信号段Wij的离散系数作为质量评估指标：CVij＝std/mean其中，CVij表示第i个阵元发射时，第j个阵元接收信号计算得到的离散系数，std表示求标准差，mean代表求均值。设定离散系数门限CVthreshold，门限以下的数据认为是纯噪声，直接将对应的TOF提取结果置零，不做后续的处理，即：TOFij＝0,CVij＜CVthreshold。步骤5，线谱提取对Wij进行线谱提取操作，主要包含如下步骤：步骤5.1，极值提取线谱为满足一定幅度条件和宽度条件的局部极大值，首先通过对相邻数据点的连续两次差分，寻找极大值的位置，保留极值点的位置的数据，其他位置的数据直接置零。if Wij＞Wij&amp;Wij＞WijWij＝Wij,else Wij＝0其中，TheroyLij-winLen＜t＜TheroyLij+2winLen，由于边界处的点不满足极值条件，所以无需经过判断，直接置零。并不是所有点极大值都是线谱，所以极值提取后，还要根据筛选出大于幅度门限的极值点，再合并小于宽度门限的极值。步骤5.2，线谱筛选计算理论窗内所有原始数据点的平均值，设定q倍的平均值作为线谱的幅度门限Athreshold＝q*mean)，q优选为2，保留大于幅度门限的数据点，其他位置的数据置零，即：Wij＝0,Wij＜Athreshold其中，TheroyLij-winLen≤t≤TheroyLij+2winLen.步骤5.3，线谱合并依据阵列接收数据的采样率，设定f倍的采样间隔为线谱的宽度门限Bthreshold，f优选为5，即两根线谱如果间隔差在f个采样点内，认为是同一根线谱，需要进行合并，保留幅度较大的即：if Wij≥WijWij＝0,else Wij＝0|tm1-tm2|＜Bthreshold其中，tm1表示第一根线谱的位置，tm2表示第二根线谱的位置。步骤6，直达波检测线谱对应的位置点即为超声脉冲通过不同传播路径到达接收点的时刻，线谱幅度对应为脉冲的能量。直达波为从发射点直接到达接收点的信号，其传播距离最短，理论上来说能量也最大，其对应的传播时间即为该数据的TOF。直达波后面包含经过不同反射路径到达接收点的反射波，由于传播路径长且存在边界反射，信号能量衰减较多，故幅度较小。依据以上特性分析，理想情况下，直达波对应的线谱幅度最大，传播时间最短即位置距离起点最近，但是考虑到换能器存在指向性，发射阵元和接收阵元所成夹角在偏离指向性中心较多，则可能直达波的能量小于一次反射波的能量，同时线谱提取依赖于门限，无法将所有噪声剔除干净，所以设计直达波检测步骤如下：步骤6.1，极值排序经上述步骤处理后的数据段Wij，TheroyLij-winLen≤t≤TheroyLij+2winLen，线谱位置的幅度被保留，其他位置均为0。对Wij进行幅度排序，记录幅度最大值Wij和第二大幅度值Wij，对应位置记为t1,t2。步骤6.2，直达波判断直达波的判断必须包含幅度小于反射波的情况，所以通过结合位置和幅度，综合检测逻辑如下：if t1＜t2 TOFij＝t1*Δt；if t1＞t2 TOFij＝t2*Δt；其中，Wij＞Wij，Δt为采样间隔。步骤6.3，理论值对比将TOF提取结果与理论时间作差，考虑到水中声速的不均匀性以及采样率，设置偏差阈值ΔT为15*Δt，阈值以内的提取结果认为计算有效，否则置零即：if TOFij＞0&amp;|TheroyTOFij-TOFij|＜ΔT TOFij＝TOFijelse TOFij＝0步骤7，对称性检查对称性指的是当发射阵元和阵元交换顺序后，对应的信号传播时间应该基本保持一致。USCT成像过程中，所有阵元依次发射，阵列数据存在对称性。所以当所有信号的TOF提取完成后，再利用发射接收对的对称性进行最后的异常值排除。判断逻辑如下：首先判断TOFij和TOFji是否有提取结果，如果都大于0，则计算二者绝对差值，将偏差超过门限5*Δt的提取结果认为是异常值，即：if TOFij＞0&amp;TOFij＞0&amp;|TOFij-TOFji|＞5*Δt则TOFij＝0,TOFji＝0。经过上述步骤，最终得到所有数据的提取结果矩阵TOFM×N。最后应说明的是：以上各实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述各实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分或者全部技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的范围。
