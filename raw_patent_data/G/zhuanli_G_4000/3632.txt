标题title
地下排水管网快速三维可视化方法及系统、设备、介质
摘要abst
本发明涉及地理信息技术领域，提供一种地下排水管网快速三维可视化方法，包括以下步骤：Web端获取地下排水管网数据，该地下排水管网数据为第一编码格式；将地下排水管网数据的第一编码格式转化为第二编码格式；第一编码格式的地下排水管网数据所占的存储空间小于第二编码格式的地下排水管网数据的所占的存储空间；根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵；根据多根管道的空间中心位置、最终变换矩阵对地图进行渲染，得到三维可视化的地下排水管网。本方案能较好较快地反应管网的分布和形态，尤其是对实时呈现地下管网的现势性要求的空间表达效果，有较大的提升。
权利要求书clms
1.一种地下排水管网快速三维可视化方法，其特征在于，包括以下步骤：Web端获取地下排水管网数据，该地下排水管网数据为第一编码格式；将地下排水管网数据的第一编码格式转化为第二编码格式；第一编码格式的地下排水管网数据所占的存储空间小于第二编码格式的地下排水管网数据的所占的存储空间；根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵；根据多根管道的空间中心位置、最终变换矩阵对地图进行渲染，得到三维可视化的地下排水管网。2.根据权利要求1所述的地下排水管网快速三维可视化方法，其特征在于，所述Web端获取地下排水管网数据的方法包括：Web端获取数据源配置文件；所述数据源配置文件包括数据源请求地址和版本信息；Web端查询Web端的数据库系统，如果Web端的数据库系统存储有与该数据源请求地址和版本信息匹配的地下排水管网数据，则直接获取地下排水管网数据；如果Web端的数据库系统没有与该数据源请求地址和版本信息匹配的地下排水管网数据，则：Web端根据数据源请求地址和版本信息向时空数据平台提交请求；时空数据平台根据请求地址和版本信息发送地下排水管网数据给Web端。3.根据权利要求2所述的地下排水管网快速三维可视化方法，其特征在于，所述时空数据平台根据请求地址和版本信息发送地下排水管网数据给Web端的方法包括：如果时空数据平台的缓存模块内存储有该数据源请求地址和版本信息匹配的地下排水管网数据，则直接发送该时空数据平台的缓存模块的地下排水管网数据给Web端；如果时空数据平台的缓存模块没有存储该数据源请求地址和版本信息匹配的地下排水管网数据，则从时空数据平台的时空数据库中获取该数据源请求地址和版本信息匹配的第二编码格式的地下排水管网数据，将第二编码格式的地下排水管网数据转成第一编码格式的地下排水管网数据后，发送第一编码格式的地下排水管网数据给Web端。4.根据权利要求1所述的地下排水管网快速三维可视化方法，其特征在于，所述根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵的方法包括：地下排水管网数据包括每根管道的位置、埋深和尺寸；根据每根管道的位置、埋深和尺寸获得每根管道空间中心位置；根据每根管道的位置、埋深和尺寸获得每根管道的缩放变换矩阵、旋转变换欧拉角；根据每根管道的缩放变换矩阵、旋转变换欧拉角获得最终变换矩阵。5.根据权利要求4所述的地下排水管网快速三维可视化方法，其特征在于，所述地下排水管网数据还包括每根管道的类型；获得空间中心位置和缩放变换矩阵之前，先判断每根管道的类型；如果管道为方形管道，则管道的尺寸包括宽度、高度和长度；缩放变换矩阵为S＝，其中，W为宽度，L为长度，H为高度，N为转换系数，N为常数；如果管道为圆形管道，则管道的尺寸包括直径和长度；缩放变换矩阵为S＝，其中，D为直径，L为长度，N为转换系数，N为常数。6.根据权利要求5所述的地下排水管网快速三维可视化方法，其特征在于，所述旋转变换欧拉角的获得方法包括：定义地图坐标系，包括两两相互垂直的X轴、Y轴和Z轴；分别计算出管道的旋转变换欧拉角；旋转变换欧拉角为R＝，其中，Pitch为Y轴方向的欧拉角，Yaw为Z轴方向的欧拉角，Roll为X轴方向的欧拉角；以X轴和Y轴所在的平面建立平面直角坐标系，X和Y均为正值为第一象限，X为负值、Y为正值为第二象限，X和Y均为负值为第三象限，X为正值、Y为负值为第四象限；当管道空间坐标起点在第三象限，管道空间坐标终点在第一象限时：Yaw＝PI-atan/)；当管道空间坐标起点在第二象限，管道空间坐标终点在第四象限时：Yaw＝atan/)；当管道空间坐标起点在第四象限，管道空间坐标终点在第二象限时：Yaw＝PI+atan/)；当管道空间坐标起点在第一象限，管道空间坐标终点在第三象限时：Yaw＝2*PI-atan/)；Roll＝-asin/L)；其中，管道空间坐标起点为，管道空间坐标终点为，起点埋深为z0，终点埋深为z1，管道长度为L，PI为π。7.根据权利要求1所述的地下排水管网快速三维可视化方法，其特征在于，所述根据多根管道的空间中心位置、最终变换矩阵对地图进行渲染的方法包括：建立预定尺寸的管道实例单位模型，以管道的空间中心位置为基准点，通过缩放变换矩阵进行拉伸、通过旋转变换欧拉角旋转形成单根管道实例模型，再将多根管道实例模型拼接成三维管道模型。8.一种地下排水管网快速三维可视化系统，其特征在于，所述三维可视化系统可执行权利要求1-7中任一项所述的地下排水管网快速三维可视化方法；该三维可视化系统包括：Web端，该Web端用于获取地下排水管网数据，该地下排水管网数据为第一编码格式；将地下排水管网数据的第一编码格式转化为第二编码格式；第一编码格式的地下排水管网数据所占的存储空间小于第二编码格式的地下排水管网数据的所占的存储空间；根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵；根据多根管道的空间中心位置、最终变换矩阵对地图进行渲染，得到三维可视化的地下排水管网。9.一种电子设备，其特征在于，包括：一个或多个处理器；存储装置，用于存储一个或多个程序；当所述一个或多个程序被所述一个或多个处理器执行，使得所述一个或多个处理器实现如权利要求1-7中任一所述的地下排水管网快速三维可视化方法。10.一种计算机可读介质，其上存储有计算机程序，其特征在于，所述程序被处理器执行时实现如权利要求1-7中任一所述的地下排水管网快速三维可视化方法。
说明书desc
技术领域本发明涉及地理信息技术领域，特别是涉及一种地下排水管网快速三维可视化方法及系统、设备、介质。背景技术地下管网地理信息系统可以实现地下管网管材、管径、阀门、检查井等综合信息输入、查询、管理，剖面图纸的绘制以及地形和专业管网图纸输出等功能，为管网系统规划设计、改造施工等提供准确可靠的地下管网的分布、走向、埋深等状态信息及各专业属性信息。在传统的地下管网地理信息系统项目的建设中，主要采用以下三种方式展现管网可视化信息：第一种，桌面客户端的三维可视化方法，这种方法需要商业软体开发包支持且体量较重，用户使用时需要安装各类基础环境包、客户端软件等，体积较大，安装环境要求较高；第二种，通过Web端二维平面展现，不满足管网空间的立体化表现要求；第三种，Web端三维模型展现，这种方法需要提前建模满足展示要求，数据不能快速实时表达。同时，这类建模软件收费，需要手动使用工具生成模型文件，生成时间根据各自技术、生成质量所需不一，模型因为包含所有顶点和三角面，体积一般较大，然后还需要手动导入系统手动发布。因此，亟需开发一种地下排水管网快速三维可视化方法及系统、设备、介质，能够快速地在Web端展现三维管网信息，为地下管网的管理、设计提供保障。发明内容本发明的目的是提供一种地下排水管网快速三维可视化方法及系统、设备、介质，能够快速、无需预先建模地、轻量化的渲染地在Web端展现三维管网信息，为地下管网的管理、设计提供保障。为解决上述技术问题，作为本发明的一个方面，提供了一种地下排水管网快速三维可视化方法，包括以下步骤：Web端获取地下排水管网数据，该地下排水管网数据为第一编码格式；将地下排水管网数据的第一编码格式转化为第二编码格式；第一编码格式的地下排水管网数据所占的存储空间小于第二编码格式的地下排水管网数据的所占的存储空间；根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵；根据多根管道的空间中心位置、最终变换矩阵对地图进行渲染，得到三维可视化的地下排水管网。根据本发明一示例实施方式，所述地下排水管网数据包括每根管道的颜色，不同的颜色表示不同的业务种类，还根据多根管道的颜色对地图进行渲染。根据本发明一示例实施方式，第二编码格式的地下排水管网数据所占的存储空间比第一编码格式的地下排水管网数据的所占的存储空间大6-8倍。根据本发明一示例实施方式，所述第一编码格式为Geobuf；所述第二编码格式为GeoJSON。根据本发明一示例实施方式，所述Web端获取地下排水管网数据的方法包括：Web端获取数据源配置文件；所述数据源配置文件包括数据源请求地址和版本信息；Web端查询Web端的数据库系统，如果Web端的数据库系统存储有与该数据源请求地址和版本信息匹配的地下排水管网数据，则直接获取地下排水管网数据；如果Web端的数据库系统没有与该数据源请求地址和版本信息匹配的地下排水管网数据，则：Web端根据数据源请求地址和版本信息向时空数据平台提交请求；时空数据平台根据请求地址和版本信息发送地下排水管网数据给Web端。根据本发明一示例实施方式，所述时空数据平台根据请求地址和版本信息发送地下排水管网数据给Web端的方法包括：如果时空数据平台的缓存模块内存储有该数据源请求地址和版本信息匹配的地下排水管网数据，则直接发送该时空数据平台的缓存模块的地下排水管网数据给Web端；如果时空数据平台的缓存模块没有存储该数据源请求地址和版本信息匹配的地下排水管网数据，则从时空数据平台的时空数据库中获取该数据源请求地址和版本信息匹配的第二编码格式的地下排水管网数据，将第二编码格式的地下排水管网数据转成第一编码格式的地下排水管网数据后，发送第一编码格式的地下排水管网数据给Web端。根据本发明一示例实施方式，所述根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵的方法包括：地下排水管网数据包括每根管道的位置、埋深和尺寸；根据每根管道的位置、埋深和尺寸获得每根管道空间中心位置；根据每根管道的位置、埋深和尺寸获得每根管道的缩放变换矩阵、旋转变换欧拉角；根据每根管道的缩放变换矩阵、旋转变换欧拉角获得最终变换矩阵。根据本发明一示例实施方式，所述地下排水管网还包括每根管道的类型；获得空间中心位置和缩放变换矩阵之前，先判断每根管道的类型；如果管道为方形管道，则管道的尺寸包括宽度、高度和长度；缩放变换矩阵为S＝，其中，W为宽度，L为长度，H为高度，N为转换系数，N为常数；如果管道为圆形管道；则管道的尺寸包括直径和长度；缩放变换矩阵为S＝，其中，D为直径，L为长度，N为转换系数，N为常数。根据本发明一示例实施方式，如果管道为方形管道，所述空间中心位置为Position＝；其中，Position表示空间中心位置，管道空间坐标起点为，管道空间坐标终点为，起点埋深为z0，终点埋深为z1，管道宽度为W，管道高度为H，管道长度为L，N为转换系数，N为常数；如果管道为圆形管道，所述空间中心位置为Position＝；其中，Position表示空间中心位置，管道空间坐标起点为，管道空间坐标终点为，起点埋深为z0，终点埋深为z1，管道直径为D，管道长度为L，N为转换系数，N为常数。根据本发明一示例实施方式，所述旋转变换欧拉角的获得方法包括：定义地图坐标系，包括两两相互垂直的X轴、Y轴和Z轴；分别计算出管道的旋转变换欧拉角；旋转变换欧拉角为R＝，其中，Pitch为Y轴方向的欧拉角，Yaw为Z轴方向的欧拉角，Roll为X轴方向的欧拉角。根据本发明一示例实施方式，Pitch＝0；以X轴和Y轴所在的平面建立平面直角坐标系，X和Y均为正值为第一象限，X为负值、Y为正值为第二象限，X和Y均为负值为第三象限，X为正值、Y为负值为第四象限。当管道空间坐标起点在第三象限，管道空间坐标终点在第一象限时：Yaw＝PI-atan/)；当管道空间坐标起点在第二象限，管道空间坐标终点在第四象限时：Yaw＝atan/)；当管道空间坐标起点在第四象限，管道空间坐标终点在第二象限时：Yaw＝PI+atan/)；当管道空间坐标起点在第一象限，管道空间坐标终点在第三象限时：Yaw＝2*PI-atan/)；Roll＝-asin/L)；其中，管道空间坐标起点为，管道空间坐标终点为，起点埋深为z0，终点埋深为z1，管道长度为L，PI为π。根据本发明一示例实施方式，所述最终变换矩阵如下：其中，缩放变换矩阵为S＝，旋转变换欧拉角为R＝。根据本发明一示例实施方式，所述根据多根管道的空间中心位置、最终变换矩阵对地图进行渲染的方法包括：建立预定尺寸的管道实例单位模型，以管道的空间中心位置为基准点，通过缩放变换矩阵进行拉伸、通过旋转变换欧拉角进行旋转形成单根管道实例模型，再将多根管道实例模型拼接成三维管道模型。作为本发明的第二个方面，提供一种地下排水管网快速三维可视化系统，所述三维可视化系统可执行所述的地下排水管网快速三维可视化方法；该三维可视化系统包括：Web端，该Web端用于获取地下排水管网数据，该地下排水管网数据为第一编码格式；将地下排水管网数据的第一编码格式转化为第二编码格式；第一编码格式的地下排水管网数据所占的存储空间小于第二编码格式的地下排水管网数据的所占的存储空间；根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵；根据多根管道的空间中心位置、最终变换矩阵对地图进行渲染，得到三维可视化的地下排水管网。根据本发明一示例实施方式，所述Web端包括可视化引擎组件、数据库系统、渲染引擎；所述可视化引擎组件用于获取配置文件、地下排水管网数据，还用于将地下排水管网数据的第一编码格式转化为第二编码格式；以及根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵；所述数据库系统用于存储地下排水管网数据；所述渲染引擎用于根据多根管道的空间中心位置、最终变换矩阵对地图进行渲染，得到三维可视化的地下排水管网。根据本发明一示例实施方式，所述三维可视化系统还包括：时空数据平台；该时空数据平台用于向Web端提供配置文件和地下排水管网数据。根据本发明一示例实施方式，所述时空数据平台包括时空数据库、缓存模块和数据请求服务模块；所述时空数据库用于存储地下排水管网数据；经过查询GIS服务后可从时空数据库中获取第二编码格式的数据；所述缓存模块用于存储第一编码格式的地下排水管网数据；所述数据请求服务模块用于向时空数据库和缓存模块请求获取地下排水管网数据，还用于将配置文件和地下排水管网数据提供给Web端。作为本发明的第三方面，提供一种电子设备，包括：一个或多个处理器；存储装置，用于存储一个或多个程序；当所述一个或多个程序被所述一个或多个处理器执行，使得所述一个或多个处理器实现所述地下排水管网快速三维可视化方法。作为本发明的第四个方面，提供一种计算机可读介质，其上存储有计算机程序，所述程序被处理器执行时实现所述地下排水管网快速三维可视化方法。本发明的有益效果是：本方案通过获取地下排水管网数据，然后在Web端根据获取的数据绘制出三维管网，将地下排水管网快速三维可视化，能较好较快地反应管网的分布和形态，尤其是对实时呈现地下管网的现势性要求的空间表达效果，有较大的提升。附图说明图1示意性示出了地下排水管网快速三维可视化系统的结构图。图2示意性示出了地下排水管网快速三维可视化方法的步骤图。图3示意性示出了第一编码格式和第二编码格式所占空间的对比表格。图4示意性示出了建立地图坐标系的示意图。图5示意性示出了欧拉角的旋转关系图。图6示意性示出了渲染后的单位方形管沟的结构图。图7示意性示出了渲染后的单位圆形管段的结构图。图8示意性示出了管道实例单位模型和模型坐标系的示意图。图9示意性示出了单根管道实例单位模型加载在地图三维坐标系下的结构图。图10示意性示出了多根管道实例单位模型加载在地图三维坐标系下的结构图。图11示意性示出了经过缩放矩阵变换的管线的示意图。图12示意性示出了经过缩放变换后的管线渲染图。图13示意性示出了管道旋转的示意图。图14示意性示出了管道绕Z轴旋转的示意图。图15示意性示出了管道绕X轴旋转的示意图。图16示意性示出了渲染后的圆形管段的示意图。图17示意性示出了渲染后的方形管沟和圆形管段相交的示意图。图18示意性示出了一种电子设备的框图。图19示意性示出了一种计算机可读介质的框图。具体实施方式现在将参考附图更全面地描述示例实施例。然而，示例实施例能够以多种形式实施，且不应被理解为限于在此阐述的实施例；相反，提供这些实施例使得本申请将全面和完整，并将示例实施例的构思全面地传达给本领域的技术人员。在图中相同的附图标记表示相同或类似的部分，因而将省略对它们的重复描述。此外，所描述的特征、结构或特性可以以任何合适的方式结合在一个或更多实施例中。在下面的描述中，提供许多具体细节从而给出对本申请的实施例的充分理解。然而，本领域技术人员将意识到，可以实践本申请的技术方案而没有特定细节中的一个或更多，或者可以采用其它的方法、组元、装置、步骤等。在其它情况下，不详细示出或描述公知方法、装置、实现或者操作以避免模糊本申请的各方面。附图中所示的方框图仅仅是功能实体，不一定必须与物理上独立的实体相对应。即，可以采用软件形式来实现这些功能实体，或在一个或多个硬件模块或集成电路中实现这些功能实体，或在不同网络和/或处理器装置和/或微控制器装置中实现这些功能实体。附图中所示的流程图仅是示例性说明，不是必须包括所有的内容和操作/步骤，也不是必须按所描述的顺序执行。例如，有的操作/步骤还可以分解，而有的操作/步骤可以合并或部分合并，因此实际执行的顺序有可能根据实际情况改变。应理解，虽然本文中可能使用术语第一、第二、第三等来描述各种组件，但这些组件不应受这些术语限制。这些术语乃用以区分一组件与另一组件。因此，下文论述的第一组件可称为第二组件而不偏离本申请概念的教示。如本文中所使用，术语“及/或”包括相关联的列出项目中的任一个及一或多者的所有组合。本领域技术人员可以理解，附图只是示例实施例的示意图，附图中的模块或流程并不一定是实施本申请所必须的，因此不能用于限制本申请的保护范围。作为本发明的第一个实施方式，提供一种地下排水管网快速三维可视化系统，如图1所示，包括：Web端和时空数据平台。Web端用于获取地下排水管网数据，该地下排水管网数据为第一编码格式；将地下排水管网数据的第一编码格式转化为第二编码格式；第一编码格式的地下排水管网数据所占的存储空间小于第二编码格式的地下排水管网数据的所占的存储空间；根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵；根据多根管道的空间中心位置、最终变换矩阵对地图进行渲染，得到三维可视化的地下排水管网。Web端只需要通过浏览器打开系统即可访问获取三维可视化数据，更轻量化，对用户电脑要求相对较低。Web端包括可视化引擎组件、数据库系统、渲染引擎。可视化引擎组件用于获取配置文件、地下排水管网数据，还用于将地下排水管网数据的第一编码格式转化为第二编码格式；以及根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵。第一编码格式为Geobuf格式，第二编码格式为GeoJSON格式。数据库系统用于存储地下排水管网数据。数据库系统采用IndexedDB。IndexedDB是一种Web端的数据库系统，用于在Web端存储大量的结构化数据，包括文件、二进制大型对象，具有键值对储存、支持异步、存储空间大等特点。相对于服务端来说，Web端可以对应浏览器。渲染引擎用于根据多根管道的空间中心位置、最终变换矩阵对地图进行渲染，得到三维可视化的地下排水管网。渲染引擎采用WebGL渲染引擎。WebGL是现代浏览器中的三维光栅化引擎，使用GLSL语言的顶点着色器和片段着色器可在GPU中执行。通过MVP矩阵，观察，投影三个矩阵)，可将顶点坐标经过计算、投影、裁剪，最后以像素的形式显示在屏幕上。时空数据平台用于向Web端提供配置文件和地下排水管网数据。时空数据平台底层使用geoserver作为提供WFS协议的基础GIS服务器。使用Java搭建时空数据平台，管理数据源地址及其版本信息、地图token及配置文件等。使用Nodejs通过geobuf、pbf类库搭建geobuf缓存服务。时空数据平台包括时空数据库、缓存模块和数据请求服务模块。时空数据库用于存储地下排水管网数据，经过查询GIS服务后可从时空数据库中获取第二编码格式的数据。地理信息系统有时又称为“地学信息系统”。它是一种特定的十分重要的空间信息系统。它是在计算机硬、软件系统支持下，对整个或部分地球表层空间中的有关地理分布数据进行采集、储存、管理、运算、分析、显示和描述的技术系统。缓存模块用于存储第一编码格式的地下排水管网数据。数据请求服务模块用于向时空数据库和缓存模块请求获取地下排水管网数据，还用于将配置文件和地下排水管网数据提供给Web端。本方案的系统能较好较快地反应管网的分布和形态，尤其是对实时呈现地下管网的现势性要求的空间表达效果，有较大的提升。作为本发明的第二个实施方式，提供一种地下排水管网快速三维可视化方法，采用第一个实施方式的地下排水管网快速三维可视化系统，如图2所示，包括以下步骤：S1：Web端获取地下排水管网数据，该地下排水管网数据为第一编码格式。Web端获取地下排水管网数据的方法包括：Web端获取数据源配置文件；数据源配置文件包括数据源请求地址和版本信息；Web端查询Web端的数据库系统，如果Web端的数据库系统存储有与该数据源请求地址和版本信息匹配的地下排水管网数据，则直接获取地下排水管网数据；如果Web端的数据库系统没有与该数据源请求地址和版本信息匹配的地下排水管网数据，则：Web端根据数据源请求地址和版本信息向时空数据平台提交请求；时空数据平台根据请求地址和版本信息发送地下排水管网数据给Web端。Web端获取数据源配置文件的方法包括：Web端的可视化引擎组件通过token访问时空数据平台，从时空数据平台获取数据源配置文件，并解析配置文件。Token在计算机身份认证中是令牌的意思，在词法分析中是标记的意思，一般作为邀请、登录系统使用。一个数据源请求地址和版本信息对应一个地下排水管网实例，如果数据源请求地址或版本信息更改，则对应另一个地下排水管网实例。数据源请求地址遵循WFS协议。WFS通过GML传递地理空间数据，它支持在基于HTTP协议的分布式计算平台上对地理要素进行插入、更新、删除和发现等操作，并且在这些操作的过程中保证了地理数据变化的一致性。时空数据平台根据请求地址和版本信息发送地下排水管网数据给Web端的方法包括：如果时空数据平台的缓存模块内存储有该数据源请求地址和版本信息匹配的地下排水管网数据，则数据请求服务模块直接发送该时空数据平台的缓存模块的地下排水管网数据给Web端；如果时空数据平台的缓存模块没有存储该数据源请求地址和版本信息匹配的地下排水管网数据，则数据请求服务模块从时空数据平台的时空数据库中获取该数据源请求地址和版本信息匹配的第二编码格式的地下排水管网数据，将第二编码格式的地下排水管网数据转成第一编码格式的地下排水管网数据后，发送第一编码格式的地下排水管网数据给Web端。第一编码格式为Geobuf格式，第二编码格式为GeoJSON格式。GeoJSON是一种对各种地理数据结构进行编码的行业标准格式，基于Javascript对象表示法的地理空间信息数据交换格式。GeoJSON对象可以表示几何、要素或者要素集合。GeoJSON支持下面几何类型：点、线、面、多点、多线、多面和几何集合。GeoJSON里的要素包含一个几何对象和其他属性，要素集合表示一系列要素。Geobuf是一种用于地理数据的紧凑二进制编码。可以将GeoJSON数据几乎无损地压缩到协议缓冲区中。压缩后通常比GeoJSON小6-8倍，可再次经过gzip压缩缩小体积，减少时空数据平台到Web端的数据传输时间，同时编码与解码速度非常快，即GeoJSON传输时间＞Geobuf传输损耗+解码时间，当数据量越大优势越明显。如图3所示，图3为样本压缩大小的对照表。US zip codes数据的GeoJSON格式大小为101.85MB，转成Geobuf格式大小为12.24MB。Idaho counties数据的GeoJSON格式大小为10.92MB，转成Geobuf格式大小为1.37MB。由此可见，采用Geobuf格式传输，极大减小了传输大小，加快传输时间。US zip codes和Idaho counties表示两份测试数据名字，gz是gzip压缩的缩写。如下表1所示，通过本方案的方法，采集管网的要素36596个，由时空数据平台传输至Web端的压缩后的Geobuf数据的大小为1.6M，平均传输时长为0.7秒。表1Web端的可视化引擎组件从数据库系统读取地下排水管网数据或从时空数据平台获取到地下排水管网数据后，执行步骤S2。如果Web端从时空数据平台获取地下排水管网数据，则表明Web端没有存储该数据源请求地址和版本信息的地下排水管网数据，在可视化引擎组件收到该地下排水管网数据后，将数据写入数据库系统，如果下次还需要提取该数据，可视化引擎组件可以根据配置文件中的数据源请求地址和版本信息从数据库系统中读取，不再需要从时空数据平台获取，以节约时间。S2：将地下排水管网数据的第一编码格式转化为第二编码格式；第一编码格式的地下排水管网数据所占的存储空间小于第二编码格式的地下排水管网数据的所占的存储空间。可视化引擎组件获取数据后，将第一编码格式的数据解码为第二编码格式。解码的方法包括：采用pbf、geobuf类库对数据解码。第二编码格式的地下排水管网数据所占的存储空间比第一编码格式的地下排水管网数据的所占的存储空间大6-8倍。Pbf指Google的Protocol Buffer协议，也是基于该协议的文件格式，此处指的是官方提供的pbf解析类库，geobuf的解码依赖pbf类库。S3：根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵。地下排水管网数据包括每根管道的类型、位置、埋深和尺寸。位置包括起点坐标和终点坐标。埋深包括起点埋深和终点埋深。地下排水管网数据还包括每根管道的颜色，不同的颜色表示不同业务种类的管道。管道的RGB颜色矩阵为，其中，r表示红色值，g表示绿色值，b表示蓝色值。根据转化为第二编码格式的地下排水管网数据得到每根管道的空间中心位置和最终变换矩阵的方法包括：先判断每根管道的类型；如果管道为方形管道，则管道的尺寸包括宽度、高度和长度；如果管道为圆形管道；则管道的尺寸包括直径和长度；根据每根管道的位置、埋深和尺寸获得每根管道空间中心位置；根据每根管道的位置、埋深和尺寸获得每根管道的缩放变换矩阵、旋转变换欧拉角；根据每根管道的缩放变换矩阵、旋转变换欧拉角获得最终变换矩阵。如果管道为方形管道，空间中心位置为Position＝；其中，Position表示空间中心位置，管道空间坐标起点为，管道空间坐标终点为，起点埋深为z0，终点埋深为z1，管道宽度为W，管道高度为H，管道长度为L，N为转换系数，N为常数；如果管道为圆形管道，空间中心位置为Position＝；其中，Position表示空间中心位置，管道空间坐标起点为，管道空间坐标终点为，起点埋深为z0，终点埋深为z1，管道直径为D，管道长度为L，N为转换系数，N为常数。空间中心位置在管道的中部，而管道空间起终点坐标为管底位置，需要增加半个管高才是管的中心位置。优选地，还根据每根管道的位置、埋深和尺寸获得每根管道的平移变换矩阵；根据每根管道的平移变换矩阵获得最终变换矩阵。平移变换矩阵为T＝。本方案的设计的变换中不需要平移，所以平移矩阵在管线的初始化渲染时设置，但一般在三维模型渲染中为了适配后续可能的平移功能，在向GPU中传递预留了平移矩阵位置。缩放变换矩阵的获得方法包括：如果管道为方形管道，缩放变换矩阵为S＝，其中，W为宽度，L为长度，H为高度，N为转换系数，N为常数，/表示除号；如果管道为圆形管道，缩放变换矩阵为S＝，其中，D为直径，L为长度，N为转换系数，N为常数。转换系数为毫米-米制转换系数，进行缩放变换主要是单位换算，在第二编码格式数据中属性W、H单位为毫米，为了统一变化矩阵，需要转换米单位。旋转变换欧拉角的获得方法包括：定义地图坐标系，包括两两相互垂直的X轴、Y轴和Z轴，如图4，优选地，X轴为由西向东，Y轴由南向北，XY轴形成地平面，Z轴垂直地平面向上。分别计算出管道的旋转变换欧拉角，即X轴、Y轴和Z轴方向的欧拉角；旋转变换欧拉角为R＝，其中，Pitch为Y轴方向的欧拉角，Yaw为Z轴方向的欧拉角，Roll为X轴方向的欧拉角。旋转在三维引擎中常用欧拉角来表示。欧拉角是在空间中描述从一个用于表示某个固定的参考系的、已知的方向，经过一系列基本旋转得到新的代表另一个参考系的方向的方式。欧拉角有两种表达形式，分别是两轴旋转的经典欧拉角，三轴旋转的泰特布莱恩角，如图5所示，定义ψ、θ、φ分别为绕Z轴、Y轴、X轴的旋转角度，由小写字母的坐标轴变换成大写字母的坐标轴。大多数情况下我们采用泰特-布莱恩角表示，可以用来直观地描述一艘船或者一架飞行器的方向，即：yaw、pitch、roll。管道绕Y轴方向无需旋转，因此Pitch＝0。圆形管道怎么旋转结果都是一样的，方形管沟也不需要旋转，因为初始安装的时候就是和水平面平行的。管道绕Z轴方向的旋转数值主要计算管道在水平面上的旋转角度。管线在地平面上，以管段中心点为基准点建立笛卡尔坐标系，如图4所示，在X轴和Y轴形成的坐标系中，按照平面直角坐标系分为四象限，右上的称为第一象限，左上的称为第二象限，左下的称为第三象限，右下的称为第四象限，即X和Y均为正值为第一象限，X为负值、Y为正值为第二象限，X和Y均为负值为第三象限，X为正值、Y为负值为第四象限。正北角度为0，象限是逆时针方向。管线默认是起点朝北，终点朝南。管道按逆时针旋转，当目标起点在第三象限，终点在第一象限时：Yaw＝PI-atan/)；管道按逆时针旋转，当目标起点在第二象限，终点在第四象限时：Yaw＝atan/)；管道按逆时针旋转，当目标起点在第四象限，终点在第二象限时：Yaw＝PI+atan/)；管道按逆时针旋转，当目标起点在第一象限，终点在第三象限时：Yaw＝2*PI-atan/)；绕X轴方向的旋转数值主要计算管道在垂直面上的旋转角度。管线在地平面上，以管段中心点为基准点建立以Y轴和Z轴形成的笛卡尔坐标系，如图15所示，因管线倾斜度基本不会超过90度，以三角函数计算角度即可。Roll＝-asin/L)；其中，管道空间坐标起点为，管道空间坐标终点为，起点埋深为z0，终点埋深为z1，管道长度为L，PI为圆周率π。计算机程序一般用PI表示，GPU此处主要计算弧度。最终变换矩阵如下：其中，缩放变换矩阵为S＝，旋转变换欧拉角为R＝。所有管道可以看做是每根管道在不同的空间坐标位置，通过三个方向不同比例缩放、旋转后形成的，因此，需要管道得到每根管道的空间中心位置和最终变换矩阵。空间中心位置、最终变换矩阵、管道的颜色为typed arrays数据格式。S4：根据多根管道的空间中心位置、最终变换矩阵对地图进行渲染，得到三维可视化的地下排水管网。可视化引擎组件将多根管道的空间中心位置、最终变换矩阵传输给渲染引擎，为了区分管道的业务种类，可视化引擎组件还将多根管道的颜色传输给渲染引擎，渲染引擎根据空间中心位置、最终变换矩阵和管道的颜色对地图进行渲染。在渲染引擎渲染的过程包括：建立预定尺寸的管道实例单位模型，以管道的空间中心位置为基准点，通过缩放变换矩阵进行拉伸、通过旋转变换欧拉角进行旋转形成单根管道实例模型，再将多根管道实例模型拼接成三维管道模型。以管道的空间中心位置为基准点进行三维可视化的渲染，起终点坐标传入引擎只能绘制出线段，三维空间中需要多顶点构成三角面才能渲染出三维立体模型。因为我们后续使用实例渲染，只需要传入模型在空间中的位置即可，这也是和其他直接把所有顶点传入引擎渲染的本质区别，利用实例渲染可以大幅度提升绘制效率。后面变换矩阵也是以空间中心位置为基准点来计算，如果使用起点或终点作为基准点也是可以渲染的，只是后续使用管段模型中心点时获取不正确。管道实例单位模型根据管道的类型不同，包括单位圆形管段和单位方形管沟，一根长的管道以管道实例单位模型为一个单位，拉伸、旋转成真实宽、长的管道实例模型并拼接起来，由于是CPU执行一次绘制调用而GPU执行多次绘制，极大节省了CPU处理和调用资源，占用极少的内存，减轻处理系统的压力，同时提高了渲染效率。如图6所示，图6为单位方形管沟的结构图，优选地，单位方形管沟对应长1米、宽1米、高1米的管线。管沟是排水系统里面排水沟的一种叫法，一般管沟是方形造型。如图7所示，图7为单元圆形管段的结构图，优选地，单位圆形管段对应直径1米、高1米的管线。具体地，在形成完整的三维模型之前，先将每个管道实例单位模型放置在管道的空间中心位置，如图8所示，建立模型坐标系，模型坐标系与地图坐标系重合，模型坐标系以管道实例单位模型的管段中心点为基准，包括两两相互垂直的X轴、Y轴和Z轴。以管道的空间中心位置为基准，将管道实例单位模型加载在地图中，图9为一根管道加载到地图中的示意图，图10为多根管道加载到地图中的示意图。三维模型中本身携带了坐标系定义，当该模型加载到三维引擎中时会按照XYZ轴对应放置，放置后模型在未经矩阵变换之前的初始状态是平行于地图，由北向南放置，初始状态起点坐标在北边，终点坐标在南边。如图11所示，根据缩放变换矩阵将管道实例单位模型沿X轴、Y轴和Z轴拉伸，渲染成如图12所示的地图场景。如图13所示，然后根据旋转矩阵欧拉角将管道实例单位模型沿X轴、Y轴和Z轴旋转，Y轴的旋转角度为0。如图14所示，管道先绕Z轴的偏航角旋转，然后如图15所示绕X轴的翻滚角旋转，完成后可形成图16和图17的管道三维结构图。管道实例单位模型采用gltf格式的模型。glTF是由Khronos Group开发的3D模型文件格式，该格式的特点是最大程度的减少了3D模型文件的大小，提高了传输、加载以及解析3D模型文件的效率，并且它可扩展，可互操作。通过管道实例单位模型进行实例化渲染。实例化渲染Instanced Rendering是指在渲染的过程中将相同图元数据模型采用不同变换矩阵一次draw call渲染出来，可以非常有效的提升整体渲染效率，尤其适用于使用相同三维符号的数据可视化。完成管道三维结构的渲染后，根据管道的颜色，通过着色器程序渲染成最终的三维可视化的地下排水管网。图16是实例化渲染的圆形管段，图17是实例化渲染的方形管沟。整个地下排水管网包括了方形的管沟和圆形的管段，实例化时分别根据不同的形状进行两批实例化渲染。通过本方案的方法，Web端不从时空数据平台直接下载已渲染生成的模型文件，而是下载压缩后的位置、尺寸、颜色、埋深等数据，这些数据本身占用的内存空间就很小，压缩之后就更小了，在传输的过程中能够非常快地就传输到Web端，也能便于存储在Web端，免去了二次下载所占用的时间；在Web端对数据进行处理，通过单位模型的方式拼接管道，进一步加快了渲染速度，同时只占用极小的内存，对Web端的处理系统要求不高，可以应用在任意配置尤其是低配置的Web端上，由此可见，本方案的方法能够快速、无需建模、轻量化地渲染实时渲染出地下排水管网的三维数据，为后续的管理、设计等工作提供保障及提高效率。相比于建模的软件，本方案的可视化方法，不存在建模步骤，无需人工干预，进入系统即可秒级加载显示实时数据，30000+要素的情况下，缓存全部未命中情况下3秒以内加载显示，有缓存情况下毫秒级加载显示。根据本发明的第三个具体实施方式，本发明提供一种电子设备，如图18所示，图18是根据一示例性实施例示出的一种电子设备的框图。下面参照图18来描述根据本申请的这种实施方式的电子设备800。图18显示的电子设备800仅仅是一个示例，不应对本申请实施例的功能和使用范围带来任何限制。如图18所示，电子设备800以通用计算设备的形式表现。电子设备800的组件可以包括但不限于：至少一个处理单元810、至少一个存储单元820、连接不同系统组件的总线830、显示单元840等。其中，所述存储单元存储有程序代码，所述程序代码可以被所述处理单元810执行，使得所述处理单元810执行本说明书中描述的根据本申请各种示例性实施方式的步骤。例如，所述处理单元810可以执行如图2中所示的步骤。所述存储单元820可以包括易失性存储单元形式的可读介质，例如随机存取存储单元8201和/或高速缓存存储单元8202，还可以进一步包括只读存储单元8203。所述存储单元820还可以包括具有一组程序模块8205的程序/实用工具8204，这样的程序模块8205包括但不限于：操作系统、一个或者多个应用程序、其它程序模块以及程序数据，这些示例中的每一个或某种组合中可能包括网络环境的实现。总线830可以为表示几类总线结构中的一种或多种，包括存储单元总线或者存储单元控制器、外围总线、图形加速端口、处理单元或者使用多种总线结构中的任意总线结构的局域总线。电子设备800也可以与一个或多个外部设备800’通信，使得用户能与该电子设备800交互的设备通信，和/或该电子设备800能与一个或多个其它计算设备进行通信的任何设备通信。这种通信可以通过输入/输出接口850进行。并且，电子设备800还可以通过网络适配器860与一个或者多个网络，广域网和/或公共网络，例如因特网)通信。网络适配器860可以通过总线830与电子设备800的其它模块通信。应当明白，尽管图中未示出，可以结合电子设备800使用其它硬件和/或软件模块，包括但不限于：微代码、设备驱动器、冗余处理单元、外部磁盘驱动阵列、RAID系统、磁带驱动器以及数据备份存储系统等。通过以上的实施方式的描述，本领域的技术人员易于理解，这里描述的示例实施方式可以通过软件实现，也可以通过软件结合必要的硬件的方式来实现。因此，根据本发明的第四个具体实施方式，本发明提供一种计算机可读介质。如图19所示，根据本发明实施方式的技术方案可以以软件产品的形式体现出来，该软件产品可以存储在一个非易失性存储介质中或网络上，包括若干指令以使得一台计算设备执行根据本发明实施方式的上述方法。所述软件产品可以采用一个或多个可读介质的任意组合。可读介质可以是可读信号介质或者可读存储介质。可读存储介质例如可以为但不限于电、磁、光、电磁、红外线、或半导体的系统、装置或器件，或者任意以上的组合。可读存储介质的更具体的例子包括：具有一个或多个导线的电连接、便携式盘、硬盘、随机存取存储器、只读存储器、可擦式可编程只读存储器、光纤、便携式紧凑盘只读存储器、光存储器件、磁存储器件、或者上述的任意合适的组合。所述计算机可读存储介质可以包括在基带中或者作为载波一部分传播的数据信号，其中承载了可读程序代码。这种传播的数据信号可以采用多种形式，包括但不限于电磁信号、光信号或上述的任意合适的组合。可读存储介质还可以是可读存储介质以外的任何可读介质，该可读介质可以发送、传播或者传输用于由指令执行系统、装置或者器件使用或者与其结合使用的程序。可读存储介质上包含的程序代码可以用任何适当的介质传输，包括但不限于无线、有线、光缆、RF等等，或者上述的任意合适的组合。可以以一种或多种程序设计语言的任意组合来编写用于执行本发明操作的程序代码，所述程序设计语言包括面向对象的程序设计语言—诸如Java、C++等，还包括常规的过程式程序设计语言—诸如“C”语言或类似的程序设计语言。程序代码可以完全地在用户计算设备上执行、部分地在用户设备上执行、作为一个独立的软件包执行、部分在用户计算设备上部分在远程计算设备上执行、或者完全在远程计算设备或服务器上执行。在涉及远程计算设备的情形中，远程计算设备可以通过任意种类的网络，包括局域网或广域网，连接到用户计算设备，或者，可以连接到外部计算设备。上述计算机可读介质承载有一个或者多个程序，当上述一个或者多个程序被一个该设备执行时，使得该计算机可读介质实现第二个实施方式的功能。本领域技术人员可以理解上述各模块可以按照实施例的描述分布于装置中，也可以进行相应变化唯一不同于本实施例的一个或多个装置中。上述实施例的模块可以合并为一个模块，也可以进一步拆分成多个子模块。通过以上的实施例的描述，本领域的技术人员易于理解，这里描述的示例实施例可以通过软件实现，也可以通过软件结合必要的硬件的方式来实现。因此，根据本发明实施例的技术方案可以以软件产品的形式体现出来，该软件产品可以存储在一个非易失性存储介质中或网络上，包括若干指令以使得一台计算设备执行根据本发明实施例的方法。以上仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
