标题title
一种能有效嵌入图像信号处理器的场景光源颜色估计方法
摘要abst
本发明公开了一种能有效嵌入图像信号处理器的场景光源颜色估计方法。该方法根据提取的图像统计特征和多个单一策略获得的光源颜色估计值，使用K‑means++算法对图像数据集进行聚类，对每个聚类分别训练最小二乘支持向量机光源颜色非线性模型；当需要估计图像场景光源颜色时，首先确定该图像所属聚类，然后使用相应的模型进行准确预测。利用最小二乘支持向量机将建模中的二次优化问题简化为线性方程组求解，相比深度学习方法，能以有限的计算量、较快的预测速度，达到较高的估计精度。尤其适合于针对单独的相机构建数据集进行训练，所得模型能方便地嵌入相机的图像信号处理器，高效实现计算颜色恒常，提高机器视觉感知质量。
权利要求书clms
1.一种能有效嵌入图像信号处理器的场景光源颜色估计方法，其特征在于，包括以下步骤：S1，训练阶段，根据图像数据集和其附带的光源颜色参考值数据集，训练彩色图像光源颜色估计模型；S2，估计阶段，读取待预估的彩色图像，使用训练好的LSSVM非线性变换模型进行光源估计。2.根据权利要求1所述的能有效嵌入图像信号处理器的场景光源颜色估计方法，其特征在于，所述S1具体为：S101，根据获取的图像数据集，进行特征提取与降维，构建ISF特征矩阵；S102，基于K-means++聚类算法，将ISF特征矩阵的行向量进行聚类，并对图像训练数据集进行相应划分；S103，对S102中得到的每一个训练图像集的子集，应用多种光源颜色估计的基础算法，构建对应的光源颜色估计值SSE矩阵；S104，使用最小二乘支持向量机对每个聚类训练光源颜色估计模型，建立从SSE矩阵到光源颜色估计的非线性变换模型。3.根据权利要求1所述的能有效嵌入图像信号处理器的场景光源颜色估计方法，其特征在于，所述S2具体为：S201，提取待预估图像的ISF特征向量，判断图像属于哪个聚类，计算待预估图像的SSE向量；S202，根据待预估图像的所属聚类，使用对应的LSSVM非线性光源估计模型估计图像的光源颜色。4.根据权利要求2所述的能有效嵌入图像信号处理器的场景光源颜色估计方法，其特征在于，所述S101具体为：S1011，提取为了便于对图像进行处理和分析而选择的图像特征，记为ISF特征，包括图像的频谱特征、边缘特征、纹理特征、形状特征，以及图像的各种统计特征，包括图像的均值、方差、标准差、信息熵；记图像数据集为Itrain，将图像数据集作为建模的训练集，Itrain对应的光源颜色参考值数据集为Itrain-E；对Itrain中每幅图像提取ISF，记提取的第i幅图像的第j个ISF特征为其中cij，k表示第i幅图像的第j个特征的第k个分量，Kj为该特征的长度；如果该特征为多行多列矩阵，需将其展开成行向量的形式；记Itrain中图像数量为N，选取的ISF特征的个数为M，则i＝1，2，…，N，j＝1，2，…，M；S1012，提取完ISF特征之后，对于第i幅图像的第j个ISF特征fij，进行零均值归一化；记μj，k为Itrain中所有图像的第j个ISF特征的第k个分量的均值，σj，k为Itrain中所有图像的第j个ISF特征的第k个分量的标准差，零均值归一化后的ISF特征为对于训练集Itrain中的图像Ii，记其ISF特征向量为/＞其中ω1，ω2，…，ωM分别依次对应M个ISF特征的权重，且/＞一般情况下，可取/＞向量/＞中元素的个数为/＞提取训练数据集Itrain中所有图像的ISF特征向量，构建Itrain的ISF矩阵/＞应用主成分分析即PCA方法，对ISF矩阵/＞进行奇异值分解，确定一组特征向量或称为加载向量，实现降维；降维后的紧凑矩阵/＞其中P为前q个最大奇异值对应的加载向量构成的特征矩阵；q可以手动设置或根据主成分贡献率与累计贡献率自动选择；进一步，求/＞的列平均向量b。5.根据权利要求2所述的能有效嵌入图像信号处理器的场景光源颜色估计方法，其特征在于：所述S102体为，采用K-means++方法对的行向量进行聚类，设置聚类数为K，并根据聚类结果将/＞及Itrain对应划分成K类；在K-means++聚类之后，Itrain中的每个图像落入某个子集，这些子集分别为/＞其中K为聚类数，nj为第j个聚类中的图像个数，每个聚类中的图像个数可能会不同；同时，对应划分光源颜色参考值数据集Itrain-E，得到/＞中所有图像对应的光源颜色参考值子集/＞记/＞中某图像为Iq，则其对应的/＞中的光源颜色参考值为/＞6.根据权利要求2所述的能有效嵌入图像信号处理器的场景光源颜色估计方法，其特征在于：所述S103具体为，记使用的场景光源颜色估计的基础、单一算法共n种，组成集合Mdl＝{m1，m2，…，mn}；取训练数据集Itrain中的任意一个聚类，对其中的任一张图像依次使用Mdl中的单一算法，对应得到n组RGB颜色估计值SSE；若记某聚类中某图像为Iq，应用Mdl中所有算法所得的n组SSE构成一个光源颜色估计值向量：θ＝，则对于整个聚类/＞可得一个SSE矩阵：/＞nj为第j个聚类中的图像个数；对于训练数据集Itrain的所有K个聚类，对应得到K个SSE矩阵。7.根据权利要求2所述的能有效嵌入图像信号处理器的场景光源颜色估计方法，其特征在于，所述S104具体为：S1041，由步骤S102及S103，对于聚类i，将每次获得的SSE矩阵及/＞中的各nj行数据分别作为输入输出训练样本，得到nj个样本点{xi，yi}，i＝1，2，…，l，其中l＝nj；xi∈R3n作为输入，表示聚类/＞中图像Ii使用S103中所述方法得到的光源颜色估计值向量θ，这里向量θ的长度为3n；yi∈R3作为输出，表示图像Ii的光源颜色参考值对每个聚类依次进行建模，组成模型集Model＝{LSSVM1，LSSVM2，…，LSSVMK}，K表示聚类数目；S1042，对每个聚类建模时，引入非线性映射R3n→RD，将输入数据投影到维数为D的高维特征空间，从而将低维非线性回归问题转化为高维特征空间中的线性回归问题，回归估计表示为：/＞其中w为权重向量，w∈RD×3，/＞R3n→RD代表向高维空间的映射，b为偏置量，b∈R3；基于结构化风险最小化原则，上述回归问题可以描述为如下优化问题：/＞其中，J表示结构风险函数，表达式中第1项和第2项分别控制模型复杂度和误差的范围；γ为惩罚因子，γ＞0，ξi＝T为不敏感损失函数的松弛因子，s.t.表示约束条件；S1043，为能够在对偶空间中求解上中所述具有等式约束的二次规划问题，构造拉格朗日函数：式中αi＝为拉格朗日乘子；在上述方程中取w，b，ξ，α的偏导数并将其设为0，得到一个线性方程组；按照Mercer条件，存在核函数K和映射函数/＞满足即高维空间的内积运算可转化为低维空间的核函数，故可将核函数代入方程组；求解该线性方程组，得到b和α，从而获得基于LSSVM的非线性变换模型其中K是核函数；如果选择不同的核函数，LSSVM算法的性能将不同；选择RBF核函数/＞其中σ为核宽度；惩罚因子γ可取2～10，松弛因子分量可取1～10，核宽度σ可取0.1～8。8.根据权利要求3所述的能有效嵌入图像信号处理器的场景光源颜色估计方法，其特征在于：所述S201具体为，记需要进行场景光源颜色估计的测试图像为It，使用步骤S101所述方法提取It的ISF特征向量得到使用主成分分析方法对提取的特征进行降维，根据S103所得的特征向量P、主成分个数q、列平均向量b，计算待预估图像It的降维后的紧凑向量包含q个主成分系数；记步骤S102中所得的K个ISF特征的聚类中心为C1，C2，…，CK，计算紧凑向量/＞与这些聚类中心的欧式距离，采用如下公式：其中/＞而为聚类中心；获得这K个距离值后，若/＞与其中某聚类中心的欧式距离最短，就判定图像It属于该聚类子集；同时，使用步骤S103中所述光源估计算法集Mdl中所有n个算法对预估图像It的光源颜色进行估计，得到It的SSE向量θ＝。9.根据权利要求3所述的能有效嵌入图像信号处理器的场景光源颜色估计方法，其特征在于：所述S202具体为，根据S201确定的It所属的聚类，以及由步骤S104所获得的LSSVM光源估计模型集Model＝{LSSVM1，LSSVM2，…，LSSVMK}，K表示聚类数目，选择与该聚类相应的模型LSSVMi，i∈；将S201所得θ作为模型输入x，使用模型LSSVMi对应的决策函数及相应的模型参数，即可估计出待预估图像It最终的光源颜色值/＞/＞
说明书desc
技术领域本发明涉及数字图像处理和计算机视觉技术领域，特别涉及一种能有效嵌入图像信号处理器的场景光源颜色估计方法。背景技术人类视觉系统具备一种特性，即当照射至某一物体表面的光的颜色发生变化时，人们对该物体表面颜色的知觉仍然能保持不变，这种人眼视觉的感知特性称为颜色恒常性。通常，数字相机等成像设备上的图像传感器并不具备这种特性。计算颜色恒常性，就是让计算机模拟人眼的这种特性，尽可能地使成像设备所得的图像与人类视觉系统所感知的图像一致。在很多计算机视觉任务中，如特征提取、目标识别等，实现计算颜色恒常性是基本前提。相机图像形成的物理模型可以表示为：f＝∫ωISCdλ，其中λ表示光波波长，ω表示可见光的波长范围，f代表图像传感器中坐标处的像素点的响应值，I表示光源光谱功率分布，S表示物体表面光谱反射率，C表示相机光谱灵敏度函数。根据该模型，对于单一均匀光照场景成像，令物体表面光谱反射率S＝1，可知成像场景光源的颜色估计为I＝∫ωICdλ。进一步得到场景光源颜色向量I＝后，即可对图像进行vonKries对角转换，校正图像中由于光源颜色引起的色偏，模拟人眼的颜色恒常感知。所以，计算颜色恒常的首要目标即是估计场景光源的颜色。由于估计光源颜色向量I时唯一可用的信息是图像上的传感器响应f，所以计算颜色恒常性是一个不适定问题，通常需要一些额外的假设。例如，灰度世界即Grayworld假设认为，对于一幅有着大量色彩变化的图像,RGB三个通道分量的平均值趋于同一个灰度，因此可认为场景光源的颜色分量分别是RGB三通道的平均值。现有计算颜色恒常性算法大致可以分为三类：基于图像统计特征的方法、基于学习的估计方法、基于组合的光源估计方法。基于统计的方法对假设的依赖性较强，如果假设不成立，这些方法的表现效果就会较差，例如，Gray world虽然算法简单快速，但是当图像的场景并不丰富时，算法常会失效；White patch虽然计算复杂度低，但是要求场景中必须存在白色像素点。基于学习的方法，利用包括机器学习、深度学习相关算法，在大量训练数据的基础上，得到精确的预测模型或先进的网络结构，提升了光源估计的精度，但是很难在实现成本、计算工作量和算法复杂度之间取得平衡。相比之下，基于组合的方法，可使用多个简单的单一策略来估计初始光照颜色，然后以某种方式组合，以形成稳定的估计；此类方法的主要缺点之一通常表现为推理时间与组合中涉及的算法数量、复杂程度相关，因为它需要在同一输入图像上运行多个独立的算法，然后将结果综合；另外，基于组合的方法的鲁棒性也有待严格考察，有时组合后的效果还没有单一策略的估计精度高。因此，虽然光源颜色估计的方法有很多，但是目前还没有一种方法能占主导地位。如何在提高光源颜色估计精度的同时又能降低计算量、易于在相机芯片中实施，而且使算法应用的图像场景更加广泛，仍然是亟待解决的问题。为此，本申请设计了一种能有效嵌入图像信号处理器的场景光源颜色估计方法，以解决上述问题。发明内容本发明为了弥补现有技术中的不足，提供了一种利用最小二乘支持向量机估计彩色图像场景光源颜色的方法，计算量小、精度高、易于嵌入相机图像信号处理器；该方法利用LSSVM有效组合多种单一策略，实现快速、准确的光源颜色估计。该方法的显著优点是模型训练速度快、估计精度高、泛化能力强；当图像数据集具有光源颜色参考值时，该发明提供的方法可以对这些输入图像进行特征提取和分类，并重新训练相应的LSSVM光源颜色估计模型。本发明的方法能有效预估彩色数字图像的场景光源颜色，用于对偏色图像进行快速准确的色彩校正，实现计算颜色恒常。本发明是通过如下技术方案实现的：第一阶段：根据图像数据集和其附带的光源颜色参考值数据集，训练彩色图像光源颜色估计模型。S101：根据获取的图像数据集，进行特征提取与降维，构建ISF特征矩阵。具体过程包括：ISF特征提取。本发明中ISF是指为了便于对图像进行处理和分析而选择的图像特征，可包括图像的频谱特征、图像的边缘特征、纹理特征、形状特征，以及图像的各种统计特征，例如图像的均值、方差、标准差、信息熵等。记图像数据集为Itrain，将图像数据集作为建模的训练集，Itrain对应的光源颜色参考值数据集为Itrain-E。对Itrain中每幅图像提取ISF，记提取的第i幅图像的第j个ISF特征为其中cij,k表示第i幅图像的第j个特征的第k个分量，Kj为该特征的长度。需要说明的是，如果该特征为多行多列矩阵，需将其展开成行向量的形式。记Itrain中图像数量为N，选取的ISF特征的个数为M，则i＝1,2，…,N,j＝1,2，…,M。特征融合与降维。考虑到不同的图像特征在表征图像时，其所具备的可靠性、区别性以及特征信息间的不相关性都有很大的差异，因此本发明中特征融合目的是既能将特征彼此间的优势结合起来，又可以提升整体特征的多样性，从而提高LSSVM光源颜色估计模型的准确性。提取完ISF特征之后，对于第i幅图像的第j个ISF特征为fij，进行零均值归一化。记μj,k为Itrain中所有图像的第j个ISF特征的第k个分量的均值，σj,k为Itrain中所有图像的第j个ISF特征的第k个分量的标准差，零均值归一化后的ISF特征为对于训练集Itrain中的图像Ii，记其ISF特征向量为其中ω1,ω2,…,ωM分别依次对应M个ISF特征的权重，且/＞一般情况下，可取/＞需要说明的是，向量/＞中元素的个数为/＞提取训练数据集Itrain中所有图像的ISF特征向量，即可构建Itrain的ISF矩阵：应用主成分分析即PCA方法，对ISF矩阵/＞进行奇异值分解，确定一组特征向量或称为加载向量，然后/＞便可映射到另一维度的矩阵/＞中，实现降维。该矩阵/＞为：/＞其中P为前q个最大奇异值对应的加载向量构成的特征矩阵。q可以手动设置或根据主成分贡献率与累计贡献率自动选择。进一步，令是/＞的列平均向量。这里特征向量P、主成分个数q、列平均向量b将用于S201中以实现预估图像ISF特征向量的降维。S102：基于K-means++聚类算法，将ISF特征矩阵的行向量进行聚类，并对图像训练数据集进行相应划分。具体过程包括：在此步骤，采用K-means++方法对的行向量进行聚类，设置聚类数为K，并根据聚类结果将/＞及Itrain对应划分成K类。K-means++算法是一种K-means算法的改进，由于选择聚类初始值的方法不同，避免了标准K-means算法有时发现较弱的聚类。K-means++选取K个聚类中心的思想如下：假设已经选取了n个初始聚类中心，则在选取第n+1个聚类中心时，距离当前n个聚类中心越远的点会有更高的概率被选为第n+1个聚类中心。第一个聚类中心，即n＝1的选取，同K-means一样是随机的。这个改进虽然直观简单，但是却非常有效。在K-means++聚类之后，Itrain中的每个图像应落入某个子集，这些子集分别为其中K为聚类数，nj为第j个聚类中的图像个数，每个聚类中的图像个数可能会不同。同时，对应划分光源颜色参考值数据集Itrain-E，得到中所有图像对应的光源颜色参考值子集/＞记/＞中某图像为Iq，则其对应的/＞中的光源颜色参考值为S103：对S102中得到的每一个训练图像集的子集，应用多种光源颜色估计的基础算法，构建对应的光源颜色估计值SSE矩阵。具体过程如下：场景光源颜色估计的基础方法有很多，本发明中称为单一算法，比如KNN-WB、color Tiger、Using gray pixels、Double-opponency、Whitepatch、CNN-based等。记本发明中使用的单一算法共n种，组成集合Mdl＝{m1,m2,…,mn}。取训练数据集Itrain中的任意一个聚类，对其中的任一张图像依次使用Mdl中的单一算法，都可对应得到n组RGB颜色估计值SSE。记聚类中某图像为Iq，应用Mdl中所有算法所得的n组SSE构成一个光源颜色估计值向量：θ＝，则对于整个聚类/＞可得一个SSE矩阵：nj为第j个聚类中的图像个数。对于训练数据集Itrain的所有K个聚类，对应得到K个SSE矩阵。S104：使用最小二乘支持向量机对每个聚类训练光源颜色估计模型，建立从SSE矩阵到光源颜色估计的非线性变换模型。具体过程包括：由步骤S102及S103，对于聚类i，将每次获得的SSE矩阵及/＞中的各nj行数据分别作为输入输出训练样本，得到nj个样本点{xi,yi}，i＝1,2,…,l，其中l＝nj；xi∈R3n作为输入，表示聚类/＞中图像Ii使用S103中所述方法得到的光源颜色估计值向量θ，这里向量θ的长度为3n；yi∈R3作为输出，表示图像Ii的光源颜色参考值按如下对每个聚类依次进行建模，组成模型集Model＝{LSSVM1,LSSVM2,…,LSSVMK}，K表示聚类数目。训练LSSVM非线性映射变换函数模型，建立从多个单一算法获得的光源颜色估计值向量至光源颜色参考值的非线性映射转换关系。由于光源颜色参考值有RGB三个分量，需训练LSSVM多输入多输出模型。引入非线性映射将输入数据投影到维数为D的高维特征空间，从而将低维非线性回归问题转化为高维特征空间中的线性回归问题，回归估计表示为其中w为权重向量，w∈RD×3，代表向高维空间的映射，b为偏置量，b∈R3。基于结构化风险最小化原则，上述回归问题可以描述为如下优化问题：其中，J表示结构风险函数，表达式中第1项和第2项分别控制模型复杂度和误差的范围；γ为惩罚因子，γ＞0，ξi＝T为不敏感损失函数的松弛因子，s.t.表示约束条件。为能够在对偶空间中求解式中所述具有等式约束的二次规划问题，构造拉格朗日函数：式中αi＝为拉格朗日乘子。在上述方程中取w,b,ξ,α的偏导数并将其设为0，得到一个线性方程组。按照Mercer条件，存在核函数K和映射函数满足/＞即高维空间的内积运算可转化为低维空间的核函数，故可将核函数代入方程组。求解该线性方程组，得到b和α，从而获得基于LSSVM的非线性变换模型：其中K是核函数。如果选择不同的核函数，LSSVM算法的性能将不同。优选地，本发明中选择RBF核函数其中σ为核宽度。优选地，惩罚因子γ可取2～10，松弛因子分量可取1～10，核宽度σ可取0.1～8。第二阶段：读取待预估的彩色图像，使用训练好的LSSVM非线性变换模型进行光源估计。具体步骤如下：S201：提取待预估图像的ISF特征向量，判断图像属于哪个聚类，计算待预估图像的SSE向量。具体过程包括：记需要进行场景光源颜色估计的测试图像为It，使用步骤S101所述方法提取It的ISF特征向量得到使用主成分分析方法对提取的特征进行降维，根据S103所得的特征向量P、主成分个数q、列平均向量b，计算待预估图像It的降维后的紧凑向量：包含q个主成分系数。因此，图像It的ISF特征向量可以由少量主成分系数组成的紧凑向量/＞表示。记步骤S102中所得的K个ISF特征的聚类中心为C1,C2,…,CK，计算紧凑向量与这些聚类中心的欧式距离，采用如下公式：/＞其中而为聚类中心。获得这K个距离值后，若/＞与其中某聚类中心的欧式距离最短，就判定图像It属于该聚类子集。同时，使用S103中所述光源估计算法集Mdl中所有n个算法对预估图像It的光源颜色进行估计，得到It的SSE向量θ＝。S202：根据待预估图像的所属聚类，使用对应的LSSVM非线性光源估计模型估计图像的光源颜色。具体过程包括：根据S201确定的It所属的聚类，以及由步骤S104所获得的LSSVM光源估计模型集Model＝{LSSVM1,LSSVM2,…,LSSVMK}，K表示聚类数目，选择与该聚类相应的模型LSSVMi,i∈。将S201所得θ作为模型输入x，使用模型LSSVMi对应的决策函数及相应的模型参数，即可估计出待预估图像It最终的光源颜色值/＞本发明的有益效果是：本发明提供的方法，可基于K-means++聚类对图像训练数据集进行聚类，原理简单，算法的可解释度较强，实现容易，收敛速度快，能大大提升模型的预测精度和计算效率。本发明通过组合多种基本方法给出的估计来计算场景光源颜色的最终估计，增强了对不同场景的图像的适用性；利用LSSVM算法较强的非线性建模能力实现多个单一算法的有效组合，为彩色图像光源颜色的估计问题提供了一种高性能、轻量级的解决方法。从算法的估计精度和计算效率上来看，本发明具有很好的实用效果。另外，LSSVM具有良好的学习能力，所需的训练样本少，表征非线性的能力强，用于回归，泛化错误率低；解决高维问题简单，没有神经网络模型需要进行主观的结构选择、且易陷入局部极小点的缺点。与标准支持向量机不同，LSSVM将建模求解过程转换成求解等式方程组，无需求解耗时的有约束二次型规划问题。这些特点使得将LSSVM用于图像光源颜色估计问题具有快速、可靠且易于实现等明显优势。通过使用LSSVM，能有效改善光源颜色估计中存在的计算量大且估计精度不足的问题。本发明提供的方法，尤其适合于针对特定相机构建数据集进行训练；并且所得模型参数相比深度学习模型参数较少，能方便地嵌入对应相机，由相机芯片快速计算出场景光源颜色，用于精确校正图像色偏，高效实现计算颜色恒常。附图说明图1为本发明的场景光源颜色估计方法示意图；图2为本发明的场景光源颜色估计方法流程图；图3为本发明的场景光源颜色估计方法与其他估计方法在Gehler-Shi数据集上的统计指标对比图；图4为本发明的场景光源颜色估计方法与其他估计方法在Cube+数据集上的统计指标对比图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述。显然，所描述的实施例仅仅是本发明的一部分实施例，而不是全部的实施例。因此，以下对在附图中提供的本发明的实施例的详细描述并非旨在限制要求保护的本发明的范围，而是仅仅表示本发明的选定实施例。基于本发明的实施例，本领域技术人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。下面结合附图，对本发明的一些实施方式作详细说明。在不冲突的情况下，下述的实施例及实施例中的特征可以相互组合。图1-图2为本发明的一种具体实施例，在图2中，步骤S101至步骤S104主要用于建立并训练彩色图像非线性光源颜色估计模型，为本发明所述方法的第一阶段工作；而步骤S201至步骤S202，是应用步骤S101至步骤S104所得的模型去估计图像的场景光源颜色，为本方法的第二阶段工作。本实施例需要获取图像数据集和其对应的光源颜色参考值数据集。为测试和验证本发明方法，也可以采用一些常用的公开的光源估计图像数据集，例如Cube+光照估计数据集、Gehler-Shi数据集、NUS光照估计数据集、ETH3D Dataset、DepthAWB Dataset等。本实施例使用了Gehler-Shi和Cube+两个数据集，两个数据集都包含指示真实场景照片的图像数据文件。数据集中的每张图像都附带场景的光源参考颜色值。Gehler-Shi数据集是来自Canon1D和Canon5D相机拍摄的568个RAW图像的集合，并在RAW基础上进行无损压缩、去除马赛克，从而获得高质量图像。Cube+是一个相对较新的大规模颜色恒常数据集，包含1365张图像和另外342张图像，这些图像均由Canon 550D相机拍摄。Cube+数据集包括原始的CR2图像、经过最低限度处理的PNG图像和JPG图像，本实施例使用PNG格式的图像。其中的PNG图像，它们是通过使用dcraw软件，使用选项-D-4-T从原始图像中转换、然后仅应用简单的子采样进行去马赛克获得的。本实施例训练和测试过程遵循常用的标准三折交叉验证方法。为此，需要分别将图像数据集随机分为三组，每次两组用于训练，其余一组用于测试。所有实验的参数都是在前两组的基础上选择的，用于对第三组测试时使用。Gehler-Shi和Cube+两种图像数据集分别都是采用这种方式。参见图2中步骤S101：根据获取的图像数据集，进行特征提取与降维，构建ISF特征矩阵。本实施例所述ISF特征主要包括全局和局部图像特征，这些特征从不同的角度描述了图像本身的特点。本实施例从图像中提取了以下ISF特征：图像的色彩范围、与图像色度相关的统计特征、颜色矩。图像的色彩范围指图像所有像素的颜色数量，颜色矩采用一阶矩、二阶矩和三阶矩。色度统计特征采用以下四种：平均色度、最亮色度、主导色度和色度模式，这些色度特征是通过不同色度值计算方式处理图像而获得的，参见文献Cheng,D.；Price,B.L.；Cohen,S.；Brown,M.S.Effective learning-based illuminant estimationusing simple features.In Proceedings of the IEEE Conference on ComputerVision and Pattern Recognition,CVPR 2015,Boston,MA,USA,7–12 June 2015。参见图2中步骤S102：基于K-means++聚类方法，对图像训练集的提取的所有ISF特征进行聚类、对图像训练数据集中的图像进行对应聚类分组。K-means++算法选择初始化聚类中心的基本思想是：初始的聚类中心之间的相互距离要尽可能的远。K-means++聚类的距离函数选择欧式距离形式，即对于两张图像，若它们的ISF特征分别为和，则定义它们之间的距离为本实施例中，考虑到Gehler-Shi数据集和Cube+数据集中的图像数量都不是很大，聚类数K均设置为2。本实施例中，分别尝试设置K为3、4、5等，最终性能比K为2时略微下降。对于更大规模的图像数据集，可以增大K的设置。参见图2中步骤S103：提取其他光源估计算法的估计值构建SSE矩阵。光源估计算法有很多，本实施例中使用了Gray world、White patch、PCA-based和LSR-based四种常用方法进行光源颜色估计，并将所得的估计值进行组合得到SSE矩阵。上述Gray world、White patch、PCA-based和LSR-based是四种经典的基于假设的算法，可根据图像统计特征直接进行简单的计算估计场景光源颜色，在研究论文中经常作为基本算法用来进行初步计算或比较算法性能。这四种算法中，Gray world方法参见Buchsbaum,G.A spatial processor model for object colourperception.J.Frankl.Inst.1980,310,1–26.；White patch方法参见Land,E.H.Theretinex theory of color vision.Sci.Am.1977,237,108–128.；PCA-based方法参见Cheng,D.,Price,B.L.,Cohen,S.,Brown,M.S.Effective learning-based illuminantestimation using simple features.In Proceedings of the IEEE Conference onComputer Vision and Pattern Recognition,CVPR 2015,Boston,MA,USA,7–12June2015.；LSR-based方法参见Gao,S.,Han,W.,Yang,K.,Li,C.,Li,Y.Effificient colorconstancy with local surface reflflectance statistics.In Proceedings of theComputer Vision-ECCV 2014-13th European Conference,Zurich,Switzerland,6–12September 2014。参见图2中步骤S104：使用LSSVM对每个聚类训练光源估计模型，建立从SSE矩阵到光源估计的非线性变换模型。将每次提取的SSE矩阵Θ及其中的N行数据分别作为输入输出训练样本，得到样本点{xi,yi}，i＝1,2,…,nj，其中xi∈R3n作为输入，这里n＝4，表示聚类/＞中图像i使用Gray world、White patch、PCA-based和LSR-based四种光源估计算法所得的光源色度估计值组成的向量，yi∈R3作为输出，表示图像i的光源颜色估计值，包含RGB三个分量。通过引入非线性映射/＞将输入数据投影到维数为N的高维特征空间，从而将低维非线性回归问题转化为高维特征空间中的线性回归问题，从而得到基于LSSVM的回归估计。继续采用S104所述方法，求得模型参数α、b，从而获得对应聚类的基于LSSVM的非线性变换模型：其中αi＝为拉格朗日乘子，K是核函数，b∈R3为偏置量。本实施例选择RBF核函数：RBF可以映射到无限维，具有更多的可变决策边界和更少的参数。需要说明的是，建模过程需要设置一些参数的具体数值，本实施例中为计算简便，直接设置惩罚因子γ＝5、不敏感损失函数的松弛因子ξi＝，核宽度σ＝5，也获得了较好的预测结果。参见图2中步骤S201：提取待预估图像的ISF特征向量，判断图像属于哪个聚类，计算待预估图像的SSE向量。具体过程包括：首先，提取待预估图像的ISF特征向量并降维，然后根据步骤S102中K-means++聚类所得的图像类别，计算距离函数值，判断预估图像属于哪个聚类；然后，将待预估的图像使用步骤S103中Gray world、White patch、PCA-based和LSR-based四种方法进行预估，并将估计值组成SSE向量。参见图2中步骤S202：根据S201计算所得SSE向量，使用与待预估图像所属聚类相对应的LSSVM光源估计模型去估计场景光源的颜色。需要说明的是，本实施例分别采用了Gehler-Shi和Cube+两个数据集训练和测试本发明所述方法。这两个数据集都分为了测试集和训练集，训练阶段使用训练集，最终得到训练集图像的聚类划分及对应聚类的LSSVM模型；而在测试阶段，将测试集中的每一图像，作为待预估光源颜色的图像，利用步骤S201及S202所述方法及训练所得模型进行估计光源颜色；这样可得到测试集中的所有图像的光源估计值。并且，由于实验验证采用了三折交叉验证方法，数据集分为三组，每次两组用于训练，其余一组用于测试；经过三次实验后，可以得到数据集中所有图像的光源颜色估计。在所得到的数据集所有图像的光源颜色估计值、及对应的参考光源颜色值的基础上，通过性能比较，可知本发明所述方法的性能。对于性能比较指标，本发明中采用了常用的角度误差，这里角度误差定义为：其中ea指的是图像中场景光源的实际颜色值，ee指的是使用光源估计算法估计的光源颜色值。本发明中使用的角度误差统计指标包括：mean、median、trimean、best25％、worst25％。trimean是概率分布中的一个概念，定义为/＞其中Q1、Q2和Q3分别是从最小到最大排列的角度误差值中排在25％、50％和75％的四分位数。本实施例中给出了本实施例所述方法在Gehler-Shi和Cube+两个数据集上测试分别所得的结果，如表1所示。可以发现，各项指标数值都较低，说明本实施例所述方法达到了较好的光源颜色估计性能。表1本实施例所述方法在Gehler-Shi和Cube+上的性能数据集MeanMedianTrimeanBest25％Worst25％Gehler-Shi2.511.761.900.475.82Cube+1.490.961.080.283.61附图3和附图4中，使用角度误差性能指标、以曲线的方式比较了不同光源颜色估计算法的性能，两图中本实施例所述方法标注为“proposed”。两个附图中使用的统计指标包括：mean、median、trimean、best25％、worst25％，这五个指标作为了坐标轴横轴的标度；两个附图中纵坐标为对应指标的数值。本实施例说明书附图3和附图4是使用本发明中光源估计方法及相关其他一些方法分别在Gehler-Shi和Cube+数据集上的统计结果。附图3为说明本实施例所提方法在Gehler-Shi数据集上的性能，给出了其他四种常用图像场景光源颜色估计方法的性能曲线，这四种方法为：Bayesian、ExemplarCC、AlexNet-FC、以及Choietal。附图4中，为说明本实施例所提方法在Cube+数据集上的性能，也给出了四种常用图像场景光源颜色估计方法的性能曲线，这四种方法为：Generalgrayworld、Shadeofgray、AttentionCNN、以及ColorBeaver。上述一共八种方法的原理及这些方法在附图3、附图4中对应的性能指标数值参见论文及该论文引用的文献。附图2中，步骤S101至步骤S104、步骤S201至步骤S202，可按本方法编写程序实现。编写的程序组合其他光源估计算法实现对图像场景光源的准确估计，模型训练快，预估准确度高，明显优于其他大多数估计方法。在预测图像光源颜色时，编写的程序使用预先训练的LSSVM模型进行估计，可利用预估的光源颜色对偏色图像进行校正。本实施例提供的方法只适用于使用数字相机拍摄所得的RAW图像经过去黑底和去饱和、以及去马赛克之后所得的线性图像；不适用于数字相机拍照后最终所得的sRGB图像的场景光源颜色值估计。此外，本实施例提供的方法要求图像中的场景光源为单一光源；当图像场景中存在多个光源时，使用本实施例提供的方法不能保证估计的精确度。本实施例所提供的方法尤其适合于针对特定相机构建数据集进行训练，所得模型能方便地嵌入对应相机，高效实现计算颜色恒常。上述实施例中，Cube+是由Canon 550D一种相机拍摄的图像组成的数据集。上述实施例附表1及附图4表明，本实施例所述方法应用至单一相机能提供较高的图像场景光源估计精度。由于本发明所提方法建立的LSSVM模型集的参数个数大大少于动辄数十万以上个参数的深度学习模型，且计算时只需求S202中所述线性决策函数，计算速度快，适合于编写程序嵌入至相机图像信号处理器ISP，改善数字相机自动白平衡性能。最后说明的是，以上实施例仅用以说明本发明的技术方案而非限制，本领域普通技术人员对本发明的技术方案所做的其他修改或者等同替换，只要不脱离本发明技术方案的精神和范围，均应涵盖在本发明的权利要求范围当中。
