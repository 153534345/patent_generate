标题title
喷墨打印在线测量和打印位置角度实时调整系统和方法
摘要abst
本发明公开了喷墨打印在线测量和打印位置角度实时调整系统和方法，属于喷墨打印技术领域，方法包括以下步骤：采集产品的图像信息；将获取的图像进行校正处理，通过液晶面板内部蚀刻的像素晶格找准直线，转正获取的图像；分别识别待检测的产品的油墨区和可操作区；对待检测的产品的油墨区和可操作区进行间距计算；油墨区的墨边和可操作区距离计算以及测量结果显示：油墨区到可操作区距离=油墨区坐标‑可操作区坐标；根据预设的需求参数修正打印参数。本发明公开的一种喷墨打印在线测量和打印位置角度实时调整系统和方法，能够通过采集的产品图像，精确了解产品位置状态，了解产品需要校正的参数数据，从而调整实际产品在设备上的位置。
权利要求书clms
1.一种喷墨打印在线测量和打印位置角度实时调整方法，其特征在于，包括以下步骤：步骤S1，采集待检测的产品的图像；步骤S2，将获取的图像进行校正处理，通过液晶面板内部蚀刻的像素晶格找准直线，像素晶格中包括多条相对平行的直线，再通过找多条直线取中位数的方式，进一步减少找直线的角度误差，获得校正的信息，转正获取的图像；步骤S3，分别识别待检测的产品的油墨区和可操作区；步骤S4，对待检测的产品的油墨区和可操作区进行间距计算，判定是否符合产品要求；对油墨区的墨边和可操作区距离计算以及显示测量结果：油墨区到可操作区距离=油墨区坐标-可操作区坐标；步骤S5，根据预设的需求参数修正打印参数。2.根据权利要求1所述的一种喷墨打印在线测量和打印位置角度实时调整方法，其特征在于：步骤S1中，待检测的产品是液晶面板，通过相机获得液晶面板的两组对角图像，得到所述液晶面板的四个角区域的图像。3.根据权利要求1所述的一种喷墨打印在线测量和打印位置角度实时调整方法，其特征在于，所述步骤S2包括以下方法：步骤S2.1，对获取的图像的宽度方向进行灰度腐蚀，将像素晶格中红绿蓝晶格的差异消除；灰度腐蚀操作:；其中，b为腐蚀或膨胀使用的内核大小，s和t为b的长和宽；x和y为图像中每个点的坐标；将图像中每个点x，y的灰度，替换为以b为大小的滑动窗口中的最小灰度；步骤S2.2，对获取的图像的宽度方向进行灰度膨胀，闭合横方向晶格的凹凸；灰度膨胀操作:；将图像中每个点x，y的灰度，替换为以b为大小的滑动窗口中的最大灰度；步骤S2.3，对步骤S2.2操作后的图像通过卡尺巡边算法，得到多条待选直线；取多条待选直线的角度的中位数，得出最终图像要旋转的角度angle；步骤S2.4，通过缩放旋转矩阵公式，以图像中心center为旋转中心，center.x=图像宽度/2，center.y=图像高度/2，缩放系数scale=1，将图像转正。4.根据权利要求3所述的一种喷墨打印在线测量和打印位置角度实时调整方法，其特征在于：在步骤S2.4中，；/＞；公式中center.x、center.y、angle、scale为已知量，α、β通过已知量计算得出，求解整个缩放旋转矩阵，使用缩放旋转矩阵对原始图像进行仿射变换，得到转正后的图像。5.根据权利要求1所述的一种喷墨打印在线测量和打印位置角度实时调整方法，其特征在于，识别待检测的产品的油墨区，包括以下步骤：步骤S3.1.1，根据油墨区和可操作区亮度的显著差异，通过二值化和形态学开闭运算去除图像干扰，首先将图像区分为油墨区和可操作区；步骤S3.1.2，计算油墨区的灰度平均值MeanInk和标准差DeviationInk，SigmaInk为设置的允许偏离标准差DeviationInk的倍数，计算出油墨区填充阈值limitInk = MeanInk +SigmaInk * DeviationInk；将油墨区低于limitInk灰度的像素，统一用limitInk灰度填充；步骤S3.1.3，计算可操作区的灰度平均值MeanAA和标准差DeviationAA，SigmaAA为设置的允许偏离标准差DeviationAA的倍数，计算出可操作区填充阈值limitAA=MeanAA+SigmaAA*DeviationAA；将可操作区高于limitAA灰度的像素，统一用limitAA灰度填充；步骤S3.1.4，将步骤S3.1.3获取的图像，灰度范围再拉伸到0-255之间，突出油墨区和面板黑框区的过渡边界；步骤S3.1.5，使用公式res:=round*Factor)+orig进行图像二次增强；公式中orig=原图，mean=原图的灰度平均值，Factor=人为设定的增强系数，round=四舍五入取整；步骤S3.1.6，使用灰度水平堆积和垂直堆积公式；灰度水平堆积公式是：；垂直堆积公式是：；将二维图像在水平方向和垂直方向投影到一维；其中，公式中n1为∑求和元素的个数，是所选区域左上角的x,y坐标，是当前像素在所选区域坐标系的x,y坐标，求得二维图像在水平方向和垂直方向投影后的灰度均值；步骤S3.1.7，在一维投影图上通过阈值判断，找到明暗分界线，最终确定油墨区边缘的位置。6.根据权利要求1所述的一种喷墨打印在线测量和打印位置角度实时调整方法，其特征在于，识别待检测的产品的可操作区，包括以下步骤：步骤S3.2.1：提取出图像的油墨区；步骤S3.2.2：对油墨区使用公式res:= round*Factor)+orig进行图像增强，突出油墨区内的电路特征；公式中orig=原图，mean=原图的灰度平均值，Factor=人为设定的增强系数，round=四舍五入取整；步骤S3.2.3：改进的NCC模板匹配算法，采用至少两个特征框，分别抓取油墨区水平和垂直方向的特征。7.根据权利要求1所述的一种喷墨打印在线测量和打印位置角度实时调整方法，其特征在于：将步骤S4中的测量结果反馈至异常管理统计系统中，并根据异常管理统计系统中预设的需求参数修正打印参数；NCC模板匹配算法的匹配公式：；；；；；其中：u，v为模板Roi区域中每个点的x,y坐标；R为多个Roi区域中每个点坐标u，v的集合；n2为模板Roi区域中所有点的个数；为模板Roi区域所有点的灰度均值；/＞为模板Roi区域所有点的灰度均方差；r，c为模板匹配滑动窗口左上角的x,y坐标；/＞为模板匹配滑动窗口所有点的灰度均值；/＞为模板匹配滑动窗口中所有点的灰度均方差；为模板Roi区域中当前点的灰度；/＞为模板匹配滑动窗口当前点的灰度。8.根据权利要求5所述的一种喷墨打印在线测量和打印位置角度实时调整方法，其特征在于，测量数据通过异常管理统计系统统计：选取异常管理系统中异常管理基准中多条基准，对多个测量位置油墨区到可操作区的距离进行异常管理，发生异常时触发打印位置和角度补偿量计算和反馈。9.根据权利要求8所述的一种喷墨打印在线测量和打印位置角度实时调整方法，其特征在于，打印位置和角度补偿量计算反馈：计算打印位置和角度补偿量；水平方向角度=Average/可操作区长度)，arctan/可操作区长度))；垂直方向角度=Average/可操作区宽度)，arctan/可操作区宽度))；平均打印角度=Average；修正打印角度时液晶面板需要绕着平台的旋转中心旋转，会带动液晶面板的四角x坐标和y坐标移动，所以需要计算打印角度旋转后，液晶面板的四角x坐标和y坐标的新坐标，公式如下：；x，y为点在旋转中心坐标系的坐标，θ为平均打印角度取反，x1，y1为旋转后新的x,y坐标；打印起始位置补偿量△T=-θ；打印起始位置补偿量△X=x1-标准距离；打印起始位置补偿量△Y=y1-标准距离；将△X，△Y，△T发送给打印控制机构，下枚材料打印时，使用新的位置和角度进行打印。10.采用权利要求1~9中任一权利要求所述的一种喷墨打印在线测量和打印位置角度实时调整方法的喷墨打印在线测量和打印位置角度实时调整系统，其特征在于: 包括载台调整机构，所述载台调整机构上驱动设置有用于装载待检测产品的治具载台；所述治具载台的上方还设置有若干组图像采集机构，所述图像采集机构通过位移机构驱动设置在所述治具载台的上方。
说明书desc
技术领域本发明涉及喷墨打印技术领域，具体涉及一种喷墨打印在线测量和打印位置角度实时调整系统和方法。背景技术目前，针对无边框和窄边框液晶显示器或显示面板，为了满足显示屏体的最小化外框及全面显示的市场需求，与传统液晶显示器或显示面板的CF面出光不同，需要用TF面做出光面。在传统的CF面做出光面的条件下，观众/观察者面向CF面，则显示面板的边框部分为TF板和CF板之间的BM面，本身为纯净黑色外观，整体画质美观。而TF面做出光面时，由于传统的液晶面板制造工艺流程中没有单独的BM工艺，导致边框部分金属线路反光，影响产品美观和整体画面边缘纯净观感。因此，需要在TF面边框区域增加外部BM工艺以满足产品需求。现有技术需要离线使用显微镜对墨边到显示区域的距离进行测量。现有技术测量时间长，每枚测量需要10分钟。现有技术无法做到在线测量、实时反馈、实时调整打印起始位置和角度。由于墨边覆盖了面板电路特征，图片中无法找到合适的特征区域来确定AA区域的位置。由于墨边和BM区域灰度差异小，现有图像处理算法无法很好的区分墨边和BM区域，导致墨边位置测量错误。发明内容本发明克服了现有技术的不足，提供了一种喷墨打印在线测量和打印位置角度实时调整系统和方法，能够通过采集的产品图像，精确了解产品位置状态，了解产品需要校正的参数数据，从而调整实际产品在设备上的位置。为达到上述目的，本发明采用的技术方案为：一种喷墨打印在线测量和打印位置角度实时调整方法，包括以下步骤：步骤S1，采集待检测的产品的图像；步骤S2，将获取的图像进行校正处理，通过液晶面板内部蚀刻的像素晶格找准直线，像素晶格中包括多条相对平行的直线，再通过找多条直线取中位数的方式，进一步减少找直线的角度误差，获得校正的信息，转正获取的图像；步骤S3，分别识别待检测的产品的油墨区和可操作区；步骤S4，对待检测的产品的油墨区和可操作区进行间距计算，判定是否符合产品要求；对油墨区的墨边和可操作区距离计算以及显示测量结果：油墨区到可操作区距离=油墨区坐标-可操作区坐标；步骤S5，根据预设的需求参数修正打印参数。本发明一个优选的实施方案中，步骤S1中，待检测的产品是液晶面板，通过相机获得液晶面板的两组对角图像，得到所述液晶面板的四个角区域的图像。具体的，由于油墨区的墨边位置和可操作区位置的测量，需要在液晶面板放置完全水平垂直的前提下进行，而液晶面板在相机视野中不可能摆放到完全水平垂直，因此必须增加图像精确转正的预处理操作，且此操作必须有高度的稳定性，使液晶面板转正。本发明一个优选的实施方案中，所述步骤S2包括以下方法：步骤S2.1，对获取的图像的宽度方向进行灰度腐蚀，将像素晶格中红绿蓝晶格的差异消除；灰度腐蚀操作:；其中，b为腐蚀或膨胀使用的内核大小，s和t为b的长和宽；x和y为图像中每个点的坐标；将图像中每个点x，y的灰度，替换为以b为大小的滑动窗口中的最小灰度；步骤S2.2，对获取的图像的宽度方向进行灰度膨胀，闭合横方向晶格的凹凸；灰度膨胀操作:；将图像中每个点x，y的灰度，替换为以b为大小的滑动窗口中的最大灰度；步骤S2.3，对步骤S2.2操作后的图像通过卡尺巡边算法，得到多条待选直线；取多条待选直线的角度的中位数，得出最终图像要旋转的角度angle；步骤S2.4，通过缩放旋转矩阵公式，以图像中心center为旋转中心，center.x=图像宽度/2，center.y=图像高度/2，缩放系数scale=1，将图像转正。本发明一个优选的实施方案中，在步骤S2.4中，；；公式中center.x、center.y、angle、scale为已知量，α、β通过已知量计算得出，求解整个缩放旋转矩阵，使用缩放旋转矩阵对原始图像进行仿射变换，得到转正后的图像。本发明一个优选的实施方案中，识别待检测的产品的油墨区，包括以下步骤：步骤S3.1.1，根据油墨区和可操作区亮度的显著差异，通过二值化和形态学开闭运算去除图像干扰，首先将图像区分为油墨区和可操作区；步骤S3.1.2，计算油墨区的灰度平均值MeanInk和标准差DeviationInk，SigmaInk为设置的允许偏离标准差DeviationInk的倍数，计算出油墨区填充阈值limitInk =MeanInk + SigmaInk * DeviationInk；将油墨区低于limitInk灰度的像素，统一用limitInk灰度填充；步骤S3.1.3，计算可操作区的灰度平均值MeanAA和标准差DeviationAA，SigmaAA为设置的允许偏离标准差DeviationAA的倍数，计算出可操作区填充阈值limitAA=MeanAA+SigmaAA*DeviationAA；将可操作区高于limitAA灰度的像素，统一用limitAA灰度填充；步骤S3.1.4，将步骤S3.1.3获取的图像，灰度范围再拉伸到0-255之间，突出油墨区和面板黑框区的过渡边界；步骤S3.1.5，使用公式res:=round*Factor)+orig进行图像二次增强；公式中orig=原图，mean=原图的灰度平均值，Factor=人为设定的增强系数，round=四舍五入取整；步骤S3.1.6，使用灰度水平堆积和垂直堆积公式；灰度水平堆积公式是：；垂直堆积公式是：；将二维图像在水平方向和垂直方向投影到一维；其中，公式中n1为∑求和元素的个数，是所选区域左上角的x,y坐标，是当前像素在所选区域坐标系的x,y坐标，求得二维图像在水平方向和垂直方向投影后的灰度均值；步骤S3.1.7，在一维投影图上通过阈值判断，找到明暗分界线，最终确定油墨区边缘的位置。本发明一个优选的实施方案中，识别待检测的产品的可操作区，包括以下步骤：步骤S3.2.1：提取出图像的油墨区；步骤S3.2.2：对油墨区使用公式res:= round*Factor)+orig进行图像增强，突出油墨区内的电路特征；公式中orig=原图，mean=原图的灰度平均值，Factor=人为设定的增强系数，round=四舍五入取整；步骤S3.2.3：改进的NCC模板匹配算法，采用至少两个特征框，分别抓取油墨区水平和垂直方向的特征。本发明一个优选的实施方案中，将步骤S4中的测量结果反馈至异常管理统计系统中，并根据异常管理统计系统中预设的需求参数修正打印参数；NCC模板匹配算法的匹配公式：；；；；；其中：u，v为模板Roi区域中每个点的x,y坐标；R为多个Roi区域中每个点坐标u，v的集合；n2为模板Roi区域中所有点的个数；为模板Roi区域所有点的灰度均值；/＞为模板Roi区域所有点的灰度均方差；r，c为模板匹配滑动窗口左上角的x,y坐标；/＞为模板匹配滑动窗口所有点的灰度均值；/＞为模板匹配滑动窗口中所有点的灰度均方差；为模板Roi区域中当前点的灰度；/＞为模板匹配滑动窗口当前点的灰度。具体的，中t是一个上标，是template的英文缩写。i是灰度，取值范围是≥0的实数。是当前点的坐标；i当前点的灰度。本发明一个优选的实施方案中，测量数据通过异常管理统计系统统计：选取异常管理系统中异常管理基准中多条基准，对多个测量位置油墨区到可操作区的距离进行异常管理，发生异常时触发打印位置和角度补偿量计算和反馈。 本发明一个优选的实施方案中，打印位置和角度补偿量计算反馈：计算打印位置和角度补偿量；水平方向角度=Average/可操作区长度)，arctan/可操作区长度))；垂直方向角度=Average/可操作区宽度)，arctan/可操作区宽度))；平均打印角度=Average；修正打印角度时液晶面板需要绕着平台的旋转中心旋转，会带动液晶面板的四角x坐标和y坐标移动，所以需要计算打印角度旋转后，液晶面板的四角x坐标和y坐标的新坐标，公式如下：；x，y为点在旋转中心坐标系的坐标，θ为平均打印角度取反，x1，y1为旋转后新的x,y坐标；打印起始位置补偿量△T=-θ；打印起始位置补偿量△X=x1-标准距离；打印起始位置补偿量△Y=y1-标准距离；将△X，△Y，△T发送给打印控制机构，下枚材料打印时，使用新的位置和角度进行打印。本发明一个优选的实施方案中，一种喷墨打印在线测量和打印位置角度实时调整方法的喷墨打印在线测量和打印位置角度实时调整系统，包括载台调整机构，所述载台调整机构上驱动设置有用于装载待检测产品的治具载台；所述治具载台的上方还设置有若干组图像采集机构，所述图像采集机构通过位移机构驱动设置在所述治具载台的上方。本发明解决了技术背景中存在的缺陷，本发明有益的技术效果是：本发明的一种喷墨打印在线测量和打印位置角度实时调整系统和方法，能够通过采集的产品图像，精确了解产品位置状态，了解产品需要校正的参数数据，从而调整实际产品在设备上的位置。通过产品中的像素晶格找直线，提高了对产品在设备上位置状态的准确获取。通过对转正的图像进行图像处理区分出采集的产品图像中进行区域区分找到边界线。对油墨区和可操作区进行间距计算，判定是否符合产品要求；根据预设的需求参数修正打印参数。附图说明下面结合附图和实施例对本发明进一步说明。图1是本发明实施例的系统流程示意图；图2是本发明实施例中系统结构示意图；图3是待检测产品的局部图；图4是本发明实施例中利用液晶面板内部蚀刻的像素晶格找直线采集的图像；图5是本发明实施例中对像素晶格找直线采集的图像在宽度方向进行灰度腐蚀和在宽度方向进行灰度膨胀后的图像；图6是本发明实施例中对图5获得的图像通过卡尺巡边算法，得到多条待选直线的图像；图7是本发明实施例中对获得的图像转正前的图像；图8是本发明实施例中对获得的图像转正后的图像；图9是本发明实施例中将图像区分为油墨区和可操作区的图像；图10是本发明实施例中将图9中的图像灰度的范围压缩到了大于油墨区平均灰度且小于可操作区平均灰度的范围内，去除了对区分油墨区的墨边和黑色遮光边框的边无用的图像信息后的图像；图11是本发明实施例中将图10的图像的灰度范围再拉伸到0-255之间，突出油墨区和黑色遮光边框的过渡边界；图12是本发明实施例中提取出图像的油墨区中的区域；图13是本发明实施例中图12提取出图像的油墨区中的区域对提取的图像进行图像增强，突出油墨区内的电路特征；图14是本发明实施例中计算结果通过画线和文字的方式在软件界面上显示的示意图一；图15是本发明实施例中计算结果通过画线和文字的方式在软件界面上显示的示意图二；图16是其中一个异常基准的示意图一；图17是其中一个异常基准的示意图二；图18是其中一个异常基准的示意图三；其中：1-载台调整机构，2-图像采集机构，3-位移机构，4-工业相机，5-远心镜头，6-图像采集框，7-治具载台。具体实施方式现在结合附图和实施例对本发明作进一步详细的说明，这些附图均为简化的示意图，仅以示意方式说明本发明的基本结构，因此其仅显示与本发明有关的构成。需要说明，若本发明实施例中有涉及方向性指示，则该方向性指示仅用于解释在某一特定姿态下各部件之间的相对位置关系、运动情况等，如果该特定姿态发生改变时，则该方向性指示也相应地随之改变。术语“第一”、“第二”仅用于描述目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量。由此，限定有“第一”、“第二”的特征可以明示或者隐含地包括一个或者更多个该特征。除非另有明确的规定和限定，术语“设置”、“相连”、“连接”应做广义理解，例如，可以是固定连接，也可以是可拆卸连接，或一体地连接；可以是直接相连，也可以通过中间媒介间接相连，可以是两个元件内部的连通。对于本领域的普通技术人员而言，可以具体情况理解上述术语在本发明中的具体含义。实施例一如图1所示，一种喷墨打印在线测量和打印位置角度实时调整方法，包括以下步骤：步骤S1，采集产品的图像。待检测的产品是液晶面板，通过相机获液晶面板的两组如图3所示的对角图像，得到液晶面板的四个角区域的图像。步骤S2，将获取的图像进行校正处理。具体的，由于油墨区的墨边位置和可操作区位置的测量，需要在液晶面板放置完全水平垂直的前提下进行，而液晶面板在相机视野中不可能摆放到完全水平垂直，因此必须增加图像精确转正的预处理操作，且此操作必须有较高的稳定性，使液晶面板转正。现有技术中采用的方式有两种：其一，如图3所示，找液晶面板的外边缘直线，进行图像转正。由于液晶面板切割后的外边缘直线存在毛刺和误差，墨水未涂布等因素的影响，找直线稳定性极差。其二；如图3所示，找液晶面板的 BM部内边缘直线，BM部内边缘直线和墨水距离非常近，墨水多涂时，直线方向偏差出现，稳定性极差。为了减少误差，本实施例采用的是：如图4~图6所示，通过液晶面板内部蚀刻的像素晶格找准直线，像素晶格中包括多条相对平行直线，再通过找多条直线取中位数的方式，进一步减少找直线的角度误差，从而获得校正的信息，如图7、图8所示，转正获取的图像。采用像素晶格找准直线，是基于产品本身的FAB蚀刻精度很高，因此像素晶格的直线精度很高，且这种直线反复出现，可以通过找多条直线取中位数的方式，进一步减少找直线的角度误差。步骤S3，分别识别待检测的产品的油墨区和可操作区；如图9~图11所示，通过对图像进行灰度腐蚀和灰度膨胀凸显出图像中油墨区和可操作区的特征，在对两个区进行不同灰度的填充，将需要区分的区域用不同灰度块区分出来。在一维投影图、上通过阈值判断，找到明暗分界线，最终确定油墨区边缘的位置，进而实现识别出油墨区和可操作区。步骤S4，对待检测的产品的油墨区和可操作区进行间距计算，判定是否符合产品要求；步骤S5，根据预设的需求参数修正打印参数。实施例二如图1~图14所示，一种喷墨打印在线测量和打印位置角度实时调整方法，包括以下步骤：步骤S1，采集产品的图像信息；如图3所示，待检测的产品是液晶面板，通过相机获液晶面板的两组对角图像，得到所述液晶面板的四个角区域的图像。步骤S2，将获取的图像进行校正处理。具体的，如图4~图8所示，由于油墨区的墨边位置和可操作区位置的测量，需要在液晶面板放置完全水平垂直的前提下进行，而液晶面板在相机视野中不可能摆放到完全水平垂直，因此必须增加图像精确转正的预处理操作，且此操作必须有高度的稳定性，使液晶面板转正。现有技术中采用的方式有两种：其一；如图3所示，找液晶面板的外边缘直线，进行图像转正。其二；如图3所示，找液晶面板的 BM部内边缘直线，BM部内边缘直线和墨水距离非常近，墨水多涂时，直线方向偏差出现，稳定性极差。为了减少误差，本实施例采用的是：如图4~图8所示，通过液晶面板内部蚀刻的像素晶格找准直线，像素晶格中包括多条相对平行直线，再通过找多条直线取中位数的方式，进一步减少找直线的角度误差，从而获得校正的信息，转正获取的图像。采用像素晶格找准直线，是基于FAB蚀刻精度很高，因此像素晶格的直线精度很高，且这种直线反复出现，可以通过找多条直线取中位数的方式，进一步减少找直线的角度误差。更具体地，步骤S2中包括以下步骤：步骤S2.1，对宽度方向进行灰度腐蚀，将红绿蓝晶格的差异消除；灰度腐蚀操作:；其中，b为腐蚀或膨胀使用的kernel核大小，s和t为b的长和宽；x和y为图像中每个点的坐标；将图像中每个点x，y的灰度，替换为以b为大小的滑动窗口中的最小灰度。步骤S2.2，对宽度方向进行灰度膨胀，闭合横方向晶格的凹凸；灰度膨胀操作:；将图像中每个点x，y的灰度，替换为以b为大小的滑动窗口中的最大灰度；如图5所示。步骤S2.3，通过卡尺巡边算法，得到多条待选直线；取多条直线角度的中位数，得出最终图像要旋转的角度angle；如图6所示。步骤S2.4，通过缩放旋转矩阵公式，以图像中心center为旋转中心，缩放系数scale=1，将图像转正，如图8所示。具体的，在步骤S2.4中，定义；/＞；公式中center.x、center.y、angle、scale为已知量，α、β通过已知量计算得出，求解整个缩放旋转矩阵，使用缩放旋转矩阵对原始图像进行仿射变换，得到转正后的图像，如图8所示。步骤S3，分别识别待检测的产品的油墨区和可操作区；通过对图像进行灰度腐蚀和灰度膨胀凸显出图像中油墨区和可操作区的特征，在对两个区进行不同灰度的填充，将需要区分的区域用不同灰度块区分出来。在一维投影图上通过阈值判断，找到明暗分界线，最终确定油墨区边缘的位置，实现识别出油墨区和可操作区。如图9所示，图中格栅图示的区域为AA区，外围灰度区是BM区。更具体地，步骤S3还包括以下步骤：步骤S3.1，识别待检测的产品的油墨区，包括以下步骤：步骤S3.1.1，根据油墨区和可操作区亮度的显著差异，通过二值化和形态学开闭运算去除图像干扰，首先将图像区分为油墨区和可操作区；如图9所示。步骤S3.1.2，计算油墨区的灰度平均值MeanInk和标准差DeviationInk，人为设置SigmaInk，计算出填充阈值limitInk = MeanInk + SigmaInk * DeviationInk；将油墨区低于limitInk灰度的像素，统一用limitInk灰度填充；如图10所示。更具体的，SigmaInk是为根据生产的工艺经验设置的允许偏离标准差DeviationInk的倍数。步骤S3.1.3，计算可操作区的灰度平均值MeanAA和标准差DeviationAA，人为设置SigmaAA，计算出填充阈值limitAA=MeanAA+SigmaAA*DeviationAA；将可操作区高于limitAA灰度的像素，统一用limitAA灰度填充。更具体的，SigmaAA为根据生产的工艺经验设置的允许偏离标准差DeviationAA的倍数。步骤S3.1.4，将步骤S3.3获取的图像，灰度范围再拉伸到0-255之间，突出油墨区和面板黑框区的过渡边界；如图11所示，图中的矩形框框处的区域中是INK和BM过渡边界。步骤S3.1.5，使用公式res:=round*Factor)+orig进行图像二次增强；公式中orig=原图，mean=原图的灰度平均值，Factor=人为设定的增强系数，round=四舍五入取整；如图12所示。步骤S3.1.6，使用灰度水平堆积和垂直堆积公式；灰度水平堆积公式是：；垂直堆积公式是：；将二维图像在水平方向和垂直方向投影到一维；其中，公式中n1为∑求和元素的个数，是所选区域左上角的x,y坐标，是当前像素在所选区域坐标系的x,y坐标，求得二维图像在水平和垂直方向投影后的灰度均值；如图13所示。步骤S3.1.7，在一维投影图、上通过阈值判断，找到明暗分界线，最终确定油墨区边缘的位置。具体的，经过步骤S3.2和步骤S3.3后，将图像灰度的范围压缩到了大于油墨区平均灰度且小于可操作区平均灰度的范围内，去除了对区分油墨区的INK边和面板黑框区的BM边无用的图像信息。步骤S3.2，识别待检测的产品的可操作区，包括以下步骤：步骤S3.2.1：提取出图像的油墨区；步骤S3.2.2：对油墨区使用公式res:= round*Factor)+orig进行图像增强，突出油墨区内的电路特征；公式中orig=原图，mean=原图的灰度平均值，Factor=人为设定的增强系数，round=四舍五入取整；步骤S3.2.3：改进的NCC模板匹配算法，采用两个特征框，分别抓取油墨区水平和垂直方向的特征。虽然电路特征在水平或垂直单方向存在重复，但同时寻找水平和垂直方向特征时，两者的相对位置关系成为新增的位置卡控特征，保证了最后寻找到唯一不重复的正确模板位置。步骤S4，对待检测的产品的油墨区和可操作区进行间距计算，判定是否符合产品要求。ncc模板匹配公式：；；；；；其中：u,v为模板Roi区域中每个点的x,y坐标；R为多个Roi区域中每个点坐标u,v的集合；n2为模板Roi区域中所有点的个数；为模板Roi区域所有点的灰度均值；/＞为模板Roi区域所有点的灰度均方差；r，c为模板匹配滑动窗口左上角的x,y坐标；/＞为模板匹配滑动窗口所有点的灰度均值；/＞为模板匹配滑动窗口中所有点的灰度均方差；为模板Roi区域中当前点的灰度；/＞为模板匹配滑动窗口当前点的灰度，如图14、图15所示。具体的，/＞中t是一个上标，是template的英文缩写。i是灰度，取值范围是≥0的实数。是当前点的坐标；i当前点的灰度。本发明一个优选的实施方案中，油墨区的墨边和可操作区距离计算以及测量结果显示：油墨区到可操作区距离=油墨区坐标-可操作区坐标。步骤S5，根据预设的需求参数修正打印参数。将反馈测量数据至异常管理统计系统中，并根据异常管理统计系统中预设的需求参数修正打印参数。测量数据异常管理系统统计：选取异常管理系统中异常管理基准中最主要的多条对多个测量位置油墨区到可操作区的距离进行异常管理，发生异常时触发打印位置和角度补偿量计算和反馈，设备自动改善工程能力状态。本实施例的其中一个列举中，3条异常管理基准如下：如图16所示，异常基准一：1个点超过距离上下限。如图17所示，异常基准二：连续9点落在中心线同一侧。如图18所示，异常基准三：连续6点递增或递减。打印位置和角度补偿量计算反馈：计算打印位置和角度补偿量；水平方向角度=Average/可操作区长度)，arctan/可操作区长度))；垂直方向角度=Average/可操作区宽度)，arctan/可操作区宽度))；平均打印角度=Average；修正打印角度时液晶面板需要绕着平台旋转中心旋转，会带动液晶面板的四角X,Y坐标移动，所以需要计算打印角度旋转后，液晶面板的四角X,Y的新坐标。公式如下：；x，y为点在旋转中心坐标系的坐标，θ为平均打印角度取反，x1，y1为旋转后新的x,y坐标；打印起始位置补偿量△T=-θ；打印起始位置补偿量△X=x1-标准距离；打印起始位置补偿量△Y=y1-标准距离；将△X，△Y，△T发送给打印控制机构，下枚材料打印时，使用新的位置和角度进行打印。实施例三本发明一个优选的实施方案中，如图2所示，采用一种喷墨打印在线测量和打印位置角度实时调整方法的喷墨打印在线测量和打印位置角度实时调整系统，包括载台调整机构1，所述载台调整机构1上驱动设置有用于装载待检测产品的治具载台7；治具载台7的上方还设置有若干组图像采集机构2，图像采集机构2通过位移机构3驱动设置在所述治具载台7的上方。本实施例中，图像采集机构2包括工业相机4以及与工业相机4组装连接的远心镜头5，远心镜头5的下部还设置有图像采集框6，图像采集框6内设置有同轴光源。进一步的，为了提升工作效果采用的是双工位设置，因此采用的是一对驱动设置在位移机构3驱动上的图像采集机构2。载台调整机构1驱动载台的驱动轨迹与位移机构3驱动图像采集机构2的驱动轨迹相互交叉。更进一步的，载台调整机构1治具载台7的驱动轨迹与位移机构3驱动图像采集机构2的驱动轨迹相互交叉且成90°夹角排布。工作原理：采用喷墨打印技术在TF面板边框区域制作超薄黑色遮光层，在不影响后续制造流程的偏光片贴附工艺的前提下，实现边框遮光的功能。对比现有的薄膜制作工艺，现有工艺比如丝网印刷、移印等方式，在对应大尺寸面板时效率极低，耗材管理难，且为基板接触式工艺特性，对产品表面划伤等难以确保良率。喷墨打印技术作为非接触式薄膜制作工艺形式很好的解决了这些困难点。以上具体实施方式是对本发明提出的方案思想的具体支持，不能以此限定本发明的保护范围，凡是按照本发明提出的技术思想，在本技术方案基础上所做的任何等同变化或等效的改动，均仍属于本发明技术方案保护的范围。
