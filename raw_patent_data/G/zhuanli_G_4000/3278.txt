标题title
数据库水印嵌入方法、提取方法、存储介质及电子设备
摘要abst
本发明特别涉及一种数据库水印嵌入方法、提取方法、存储介质及电子设备。其中，一种数据库水印嵌入方法，包括如下步骤：确定数据库中可嵌入水印的数值属性列X；将X列的数值xi和待嵌入的水印信息W转换为相同进制得到xi'和W'；依次判断xi'是否为好数，若是则判断下一个，否则对xi进行小比例修改后再次执行该判断；好数判断结束后即完成水印的嵌入；对于任一xi'，若xi'在位置s处的数值与待嵌入的水印内容一致，则该xi'视为好数。本案中将数值的修改过程和水印嵌入过程独立开，无论数值是否被修改，只要其被判定为好数，就已经嵌入了水印信息，因此，我们只需要重复修改直至每个数都是好数，就可以实现水印的嵌入了。
权利要求书clms
1.一种数据库水印嵌入方法，其特征在于：包括如下步骤：确定数据库中可嵌入水印的数值属性列，记为X列；将X列的数值xi和待嵌入的水印信息W转换为相同进制得到xi'和W'，其中i＝1,2,3,…，n，n为数据库总行数；依次判断xi'是否为好数，若是则判断下一个，否则对xi进行小比例修改后再次执行该判断；好数判断结束后即完成水印的嵌入；对于任一xi'，确定其待嵌入的水印内容和水印嵌入位置s，若xi'在位置s处的数值与待嵌入的水印内容一致，则该xi'视为好数。2.如权利要求1所述的数据库水印嵌入方法，其特征在于：对于任一xi'，通过如下步骤确定其水印嵌入位置s：指定xi'的某一位或多位为水印嵌入位置。3.如权利要求1所述的数据库水印嵌入方法，其特征在于：对于任一xi'，通过如下公式确定其水印嵌入位置s：，式中，ks为密钥，Pki为数据库第i行对应的主键内容，“||”为连接运算符，H为哈希运算，“%”为取余运算符，S为预设常整数，Li为xi'的长度，min是取最小值运算。4.如权利要求1所述的数据库水印嵌入方法，其特征在于：对于任一xi'，通过如下步骤确定其待嵌入的水印内容：根据水印长度L和水印密度k对水印W'进行分组得到子水印Wg'，其中，g＝0,1,2,…,NG-1；NG＝roundup，roundup为向上取整操作符；对于任一xi'，嵌入的子水印下标g根据如下公式计算得到：，ks为密钥，Pki为数据库第i行对应的主键内容，“||”为连接运算符，H为哈希运算，“%”为取余运算符。5.如权利要求1所述的数据库水印嵌入方法，其特征在于：还包括如下步骤：根据以下公式计算良数比：RGN＝gn/n，其中，gn为未修改的xi的总数；若RGN小于设定阈值，则修改水印嵌入内容或水印嵌入位置并返回依次判断xi'是否为好数的步骤。6.如权利要求1所述的数据库水印嵌入方法，其特征在于：所述的对xi进行小比例修改包括如下步骤：确定数据库中与X列相关的数值属性列，记为Y列；根据如下公式计算ri：，式中，i＝1,2,3,…，n，n为数据库行数；xi、yi分别为X列、Y列第i行的数值；α是从N列随机抽样得到的且N列是独立于X列和Y列的标准正态分布；k1、k2、kx、ky是根据如下公式计算得到的超参数：，式中，uX、uY分别为X列和Y列的期望，、/＞分别为X列、Y列的方差，/＞为X列和Y列的协方差，/＞为X列和Y列的相关系数，/＞为预设的大于0的常数；将xi加上ri即得到修改后的xi。7.一种提取权利要求1中数据库水印的方法，其特征在于：包括如下步骤：确定数据库中可嵌入水印的数值属性列，记为X列；将X列的数值xi转换为指定进制得到xi'，其中i＝1,2,3,…，n，n为数据库总行数；对于任一xi'，确认其嵌入子水印的位置s，并根据位置s提取数值xi中包含的子水印内容；将X列所有xi对应的子水印内容进行合并得到水印信息，若水印信息为乱码，则舍弃该水印信息，否则保留该水印信息。8.如权利要求7所述的数据库水印提取方法，其特征在于：所述任一xi'嵌入水印的位置s通过如下公式计算得到：，嵌入水印的下标g通过如下公式计算得到：/＞；式中，ks为密钥，Pki为数据库第i行对应的主键内容，“||”为连接运算符，H为哈希运算，“%”为取余运算符，S为预设常整数，Li为xi'的长度，min是取最小值运算；xi'的第s位即下标为g的子水印；所述将X列所有xi对应的子水印内容进行合并得到水印信息包括如下步骤：对下标相同的所有水印进行投票，投票最多的水印即为该下标对应的水印，投票后得到子水印Wg'；将子水印按照下标排序后进行连接得到水印W'。9.一种计算机可读存储介质，其特征在于：其上存储有计算机程序，所述计算机程序被处理器执行时，实现如权利要求1-6中任一项所述的数据库水印嵌入方法或如权利要求7或8所述的数据库水印提取方法。10.一种电子设备，其特征在于：包括存储器、处理器及存储在存储器上的计算机程序，所述处理器执行所述计算机程序时，实现如权利要求1-6中任一项所述的数据库水印嵌入方法或如权利要求7或8所述的数据库水印提取方法。
说明书desc
技术领域本发明涉及数据库水印技术领域，特别涉及一种数据库水印嵌入方法、提取方法、存储介质及电子设备。背景技术随着信息技术的发展，数据量的迅速增加使得数据库技术显得尤为重要。数据库的一个非常重要的作用就是为数据分析提供资料，从而更好地帮助生产和生活。为了有效地保护数据库的隐私和版权，数据库水印技术被广泛研究。传统的鲁棒数据库水印通过一定的规则修改数据值来实现水印的嵌入过程，常见的操作是通过修改数据的最低有效位来嵌入水印。修改数据的最低有效位的确可以完成数据库水印的嵌入，但这种嵌入方法有很大的不足之处：缺点一：嵌入位置是确定的，很容易被攻击、提取；缺点二、因为需要修改最低有效位使其与水印吻合，所以水印列中各项数值的修改都是确定的，比如针对某一个数19.1875，其转换成二进制后为10011.0011，假设这个数中要嵌入的水印为0，我们只能将其最低有效位修改为0，即得到含水印的二进制数10011.0010，转换至十进制后得到19.125，也就是说，对于一个数，只有一种修改方式。在此种修改方式下，整列嵌入水印后，统计特征会发生改变。发明内容本发明的首要目的在于提供一种数据库水印嵌入方法，嵌入位置可变且修改方式多样。为实现以上目的，本发明采用的技术方案为：一种数据库水印嵌入方法，包括如下步骤：确定数据库中可嵌入水印的数值属性列，记为X列；将X列的数值xi和待嵌入的水印信息W转换为相同进制得到xi'和W'，其中i＝1,2,3,…，n，n为数据库总行数；依次判断xi'是否为好数，若是则判断下一个，否则对xi进行小比例修改后再次执行该判断；好数判断结束后即完成水印的嵌入；对于任一xi'，确定其待嵌入的水印内容和水印嵌入位置s，若xi'在位置s处的数值与待嵌入的水印内容一致，则该xi'视为好数。与现有技术相比，本发明存在以下技术效果：这里通过引入好数的概念，将数值的修改过程和水印嵌入过程独立开，数值可以任意进行修改，每次修改后，这个数值都有可能是好数或非好数；无论数值是否被修改，只要其被判定为好数，就已经嵌入了水印信息，因此，我们只需要重复修改直至每个数都是好数，就可以实现水印的嵌入了；同时，这里对数值的修改方式多样，避免了背景技术中的单一修改方案。本发明的另一个目的在于提供一种数据库水印提取方法，可以方便的提取出通过前述水印嵌入方法嵌入的水印。为实现以上目的，本发明采用的技术方案为：一种用于提取前述数据库水印的方法，包括如下步骤：确定数据库中可嵌入水印的数值属性列，记为X列；将X列的数值xi转换为指定进制得到xi'，其中i＝1,2,3,…，n，n为数据库总行数；对于任一xi'，确认其嵌入子水印的位置s，并根据位置s提取数值xi中包含的子水印内容；将X列所有xi对应的子水印内容进行合并得到水印信息，若水印信息为乱码，则舍弃该水印信息，否则保留该水印信息。与现有技术相比，本发明存在以下技术效果：该提取方法相当于前述嵌入方法的逆运算，只不过一开始的时候用户并不知道那一列有水印嵌入，因此需要对所有可嵌入水印的数值属性列分别提取水印，如果提取的水印为乱码，则说明该列未嵌入水印，否则就可以正确的提取出水印信息。附图说明图1是本发明中水印嵌入方法流程图；图2是本发明中水印提取方法流程图。具体实施方式下面结合图1和图2，对本发明做进一步详细叙述。参阅图1，本发明公开了一种数据库水印嵌入方法，包括如下步骤：确定数据库中可嵌入水印的数值属性列，记为X列；一般来说，我们挑选出一列即可，也可以挑选多列，对每一列都执行该修改方法，但不管是一列还是多列，一定要选择数值属性列，因为本发明中的修改方式是针对数值进行修改的。比如一个包含了学生姓名、身高、体重、年龄、成绩等信息的数据库，其中的身高、体重都可以作为X列。将X列的数值xi和待嵌入的水印信息W转换为相同进制得到xi'和W'，其中i＝1,2,3,…，n，n为数据库总行数。这里说的相同进制，指的是xi'和W'的进制相同，可以同为二进制、三进制、八进制、十六进制等，最优选地，我们转换成二进制。以二进制为例，转换的时候，可以直接将数值xi转换成二进制，也可以对数值xi进行处理使其变为二进制数；水印信息W需要直接转换成二进制。之所以这样做，是因为数值xi的转换是单向的，我们无需根据xi'求解xi；水印的转换是双向的，我们还需要根据W'去求解W。水印信息W指的是要嵌入的信息，比如用户ID、版权信息、MAC地址等等。依次判断xi'是否为好数，若是则判断下一个，否则对xi进行小比例修改后再次执行该判断；这里我们引入了好数的概念，其具体定义如下：对于任一xi'，确定其待嵌入的水印内容和水印嵌入位置s，若xi'在位置s处的数值与待嵌入的水印内容一致，则该xi'视为好数。举例来说，假使待嵌入水印的二进制数为10011.0010，水印嵌入位置s是5，该位置上的数字为1，若待嵌入的水印内容为0，则该数为非好数，需要进行修改，直至第5位变为1；若待嵌入的水印内容为1，则该数为好数，无需进行修改。通过前述示例，我们可以看到，我们在进行好数判断的时候，会对数值进行修改，故好数判断和数值修改的过程就是水印的嵌入过程。好数判断结束后即完成水印的嵌入。这里通过引入好数的概念，将数值的修改过程和水印嵌入过程独立开，数值可以任意进行修改，每次修改后，这个数值都有可能是好数或非好数；无论数值是否被修改，只要其被判定为好数，就已经嵌入了水印信息，因此，我们只需要重复修改直至每个数都是好数，就可以实现水印的嵌入了；同时，这里对数值的修改方式多样，避免了背景技术中的单一修改方案。水印嵌入位置s有多种方式可以确定，本发明中提供了两种实施方式供参考。实施例一，对于任一xi'，通过如下步骤确定其水印嵌入位置s：指定xi'的某一位或多位为水印嵌入位置。比如我们指定最后一位或者倒数第二位为水印嵌入位置；或者我们可以动态的指定水印嵌入位置，比如i为奇数时水印嵌入位置为最后一位、i为偶数时水印嵌入位置为倒数第二位；或者指定最后一位和倒数第二位同时为水印嵌入位，对于多个水印嵌入位，必须要所有位置处数值与待嵌入的水印内容均一致时才视为好数。实施例二，对于任一xi'，通过如下公式确定其水印嵌入位置s：，式中，ks为密钥，Pki为数据库第i行对应的主键内容，“||”为连接运算符，H为哈希运算，“%”为取余运算符，S为预设常整数，Li为xi'的长度，min是取最小值运算。这里计算出来的s为整数1、2、3、…，其对应的是位置信息，至于s具体等于某个整数时对应的是哪个位置，可以由用户定义，比如s＝0、1、2分别对应倒数第1、2、3位，也可以对应正数第2、3、4位，xi'的正数第1位必定为1，一般不会选择此位置作为嵌入位置。通过引入密钥ks，使得水印嵌入位置s不能被轻易获取，必须知道密钥ks才能算出水印嵌入位置，相当于给水印进行了加密。通过引入主键内容Pki，使得每一行计算得到的位置s都有所不同，这样也就更不容易被破解。S是我们预设的常整数，假设我们想在倒数第1-5位嵌入水印，那么S就可以取5，基于该公式计算得到的s只能是0、1、2、3、4，分别代表倒数第1-5位。之所以计算S和Li的最小值，是为了避免计算出来的位置s超出xi'的长度。进一步地，对于任一xi'，通过如下步骤确定其待嵌入的水印内容：根据水印长度L和水印密度k对水印W'进行分组得到子水印Wg'，其中，g＝0,1,2,…,NG-1；NG＝roundup，roundup为向上取整操作符。假设水印W'为32位的二进制数，当水印密度k为1的时候，就相当于每个子水印为1位二进制数，当水印密度k为2时，每个子水印包括2位二进制数。这里引入了水印密度k，k可以理解为子水印的长度，其也等同于每个xi'中可嵌入的水印位数。通过对水印W'进行分组，可以得到多个子水印，每行中只嵌入一个子水印，对于X列的第i行，嵌入的子水印的下标g可以根据该行中的任意个参数根据计算公式计算得到。比如g＝H%NG、或者g＝H%NG、或者g＝H%NG，还有很多其他公式可以让下标g数据库某一行建立联系。本发明中优选地，对于任一xi'，嵌入的子水印下标g根据如下公式计算得到：，ks为密钥，Pki为数据库第i行对应的主键内容，“||”为连接运算符，H为哈希运算，“%”为取余运算符。通过该方案，使得在整个数据库中，水印W'被嵌入多次，以方便提取，子水印的下标和数据库第i行的主键内容关联起来，这样提取第i行的子水印时，只需要根据该行对应的主键内容就可以确定子水印的下标。需要指出的是，对于水印密度k大于1的情况，比如k＝2，此时数据库每一行嵌入的子水印有两位，这两位的嵌入位置可以根据2个密钥ks分别计算得到，也可以是一个密钥ks计算得到其中一位的嵌入位置s，s的前一位或后一位作为另一位的嵌入位置。或者，按照如下公式计算得到多个嵌入位置s：，式中，pki=Pki/j，j=1,2,…,k。进一步地，根据以下公式计算良数比：RGN＝gn/n，其中，gn为未修改的xi的总数；若RGN小于设定阈值，则修改水印嵌入内容或水印嵌入位置并返回依次判断xi'是否为好数的步骤。对于数据库水印来说，如果一个数字不是好数，算法就会对其进行修改，直到它成为一个好数，这样就会造成失真。我们希望修改的数据越少越好，换句话说，我们希望嵌入水印后未修改的xi越多越好，也即良数比RGN尽可能高。根据前面优选方案，我们可以发现水印嵌入位置可以通过密钥ks来修改，因此可以通过修改密钥ks来修改良数比。另外，下文提及的水印密度k也会影响良数比RGN，在密钥ks不变的情况下，水印密度k越小，良数比越高。对xi进行小比例修改有很多种方案可以实现，比如直接将xi乘上一个接近于1的系数，如1.01或0.99等等，但这些修改会影响到X列的统计特征，这样就会导致嵌入水印前后的数据库分析结果会发生改变，影响用户的使用。因此，本发明中优选地，所述的对xi进行小比例修改包括如下步骤：确定数据库中与X列相关的数值属性列，记为Y列；根据如下公式计算ri：，式中，i＝1,2,3,…，n，n为数据库行数；xi、yi分别为X列、Y列第i行的数值；α是从N列随机抽样得到的且N列是独立于X列和Y列的标准正态分布；k1、k2、kx、ky是根据如下公式计算得到的超参数：，式中，uX、uY分别为X列和Y列的期望，、/＞分别为X列、Y列的方差，/＞为X列和Y列的协方差，/＞为X列和Y列的相关系数，/＞为预设的大于0的常数；这些参数中，除了R列的方差/＞是预设的，其他参数都可以根据X列、Y列的数值计算得出。因此，对于已知的X列和Y列，只要给定R列的方差，就可以计算出四个超参数的具体值，进而可以计算出ri的值。将xi加上ri即得到修改后的xi。当我们按照上述步骤对xi进行修改后，通过引入公式两边变量的协方差得到如下公式：COV＝COV,X)，由此，我们可以进一步得到一个等式：，两边除以/＞后得到等式：/＞。使用类的方法，我们可以得到其他三个等式，这四个等式共同构成如下的四元方程组：，求解上述四元方程组，可以将超参数k1、k2、kx、ky表示为：/＞我们的目标是确保含水印的XW列和X列统计特征不变，那么我们的目标可以表示为：。进一步简化可以得到R列需要满足的要求为：，将这个公式带入超参数k1、k2、kx、ky的表示式中即可得到超参数k1、k2、kx、ky的计算公式。因此根据上述步骤修改xi后，保证修改前后X列的统计特征不会发生改变。参与图2，本发明还公开了一种用于提取前述数据库水印的方法，包括如下步骤：确定数据库中可嵌入水印的数值属性列，记为X列，这里的判定标准和嵌入时的标准一致；将X列的数值xi转换为指定进制得到xi'，其中i＝1,2,3,…，n，n为数据库总行数；对于任一xi'，确认其嵌入子水印的位置s，并根据位置s提取数值xi中包含的子水印内容；将X列所有xi对应的子水印内容进行合并得到水印信息，若水印信息为乱码，则舍弃该水印信息，否则保留该水印信息。该提取方法相当于前述嵌入方法的逆运算，只不过一开始的时候用户并不知道那一列有水印嵌入，因此需要对所有可嵌入水印的数值属性列分别提取水印，如果提取的水印为乱码，则说明该列未嵌入水印，否则就可以正确的提取出水印信息。进一步地，我们前面的优选方案中，水印嵌入位置和水印嵌入内容都是根据公式计算得到的。对应地，所述任一xi'嵌入水印的位置s通过如下公式计算得到：，嵌入水印的下标g通过如下公式计算得到：/＞；式中，ks为密钥，Pki为数据库第i行对应的主键内容，“||”为连接运算符，H为哈希运算，“%”为取余运算符，S为预设常整数，Li为xi'的长度，min是取最小值运算；xi'的第s位即下标为g的子水印。我们根据相同的公式就可以计算出水印嵌入位置s和子水印下标g。由于这里引入了分组概念，使得每一行嵌入了一个子水印，因此对于某一个子水印，其会嵌入在多个行中，这样即使某些行被删除、增加或修改，依然还会有很多行中含有该子水印信息。在提取的时候，对下标相同的所有水印进行投票，投票最多的水印即为该下标对应的水印，投票后得到子水印Wg'；投票就是找出现次数最多的水印内容，假设g=0时，对应的水印信息有300个00、10个01、20个11，那么我们经过投票后就可以确定W0'=00；基于此，我们可以求出W1'、W2'、…、的内容。最后，只需要将子水印按照下标排序后进行连接得到水印W'，即/＞。本发明还公开了一种计算机可读存储介质和一种电子设备。其中，一种计算机可读存储介质，其上存储有计算机程序，所述计算机程序被处理器执行时，实现如前所述的数据库水印嵌入方法或如前所述的数据库水印提取方法。一种电子设备，包括存储器、处理器及存储在存储器上的计算机程序，所述处理器执行所述计算机程序时，实现如前所述的数据库水印嵌入方法或如前所述的数据库水印提取方法。
