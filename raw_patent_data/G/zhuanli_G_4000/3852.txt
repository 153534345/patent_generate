标题title
一种细粒度图像识别分类模型训练方法、装置及设备
摘要abst
本发明提供一种细粒度图像识别分类模型训练方法、装置及设备，方法包括：将细粒度图像输入到预设网络模型当中进行训练，预设网络模型包括多层自注意力层；获取预设数量个目标自注意力层对细粒度图像进行学习得到的分类向量；将每个目标自注意力层的分类向量输入到预设分类器当中，输出每个目标自注意力层的分类标签，分别将每个目标自注意力层的分类标签与预设真实标签进行损失计算；根据每个目标自注意力层的损失值，分别通过反向传播机制更新网络参数。本发明通过引入渐进式训练机制，有利于挖掘不同层次分类向量中的互补信息并用于分类；还提出了多尺度模块，实现全局信息与局部信息的互补交流，提高细粒度图像分类效果。
权利要求书clms
1.一种细粒度图像识别分类模型训练方法，其特征在于，所述方法包括：获取模型训练用的细粒度图像，并将所述细粒度图像输入到预设网络模型当中进行训练，所述预设网络模型包括多层自注意力层，所述细粒度图像依次经过每一所述自注意力层，以通过所述自注意力层对所述细粒度图像进行分类向量学习；获取预设数量个目标自注意力层对所述细粒度图像进行学习得到的分类向量，所述目标自注意力层位于所述多层自注意力层的后端；将每个所述目标自注意力层的分类向量输入到预设分类器当中，输出每个所述目标自注意力层的分类标签，分别将每个所述目标自注意力层的分类标签与预设真实标签进行损失计算，得到每个所述目标自注意力层的损失值；根据每个所述目标自注意力层的损失值，分别通过反向传播机制更新网络参数，以训练所述细粒度图像识别分类模型。2.根据权利要求1所述的细粒度图像识别分类模型训练方法，其特征在于，还包括：根据预设计算规则计算出所述自注意力层在对所述细粒度图像进行分类向量学习之后的最终注意力权重矩阵；根据所述最终自注意力权重矩阵确定分类目标所在位置，并根据所述分类目标所在位置在所述细粒度图像中截取分类目标区域图像；将所述分类目标区域图像缩放到与所述细粒度图像同样大小后输入到所述预设网络模型当中进行训练，以强化训练所述细粒度图像识别分类模型。3.根据权利要求2所述的细粒度图像识别分类模型训练方法，其特征在于，所述预设网络模型还包括线性投影层和位置编码层，将所述细粒度图像输入到预设网络模型当中进行训练的步骤包括：按照预设分割规则将所述细粒度图像分割成预设份子图像，并通过所述线性投影层将每一所述子图像映射到高维特征空间，得到每份所述子图像的图片向量；通过所述位置编码层对每份所述子图像的图片向量进行编码，以为每个所述图片向量添加位置编码信息，并在第一个图片向量前添加一个空的分类向量，得到向量序列；将所述向量序列输入到所述多层自注意力层进行分类向量学习，每层所述自注意力层学习到的分类特征会更新于所述向量序列的分类向量当中，得到每层所述自注意力层的分类向量。4.根据权利要求3所述的细粒度图像识别分类模型训练方法，其特征在于，所述自注意力层包括多个注意力头，根据预设计算规则计算出所述自注意力层在对所述细粒度图像进行分类向量学习之后的最终注意力权重矩阵的步骤包括：在对所述细粒度图像进行分类向量学习之后，在每个所述注意力头当中，分别计算出本层当中分类向量与每个图片向量的注意力权重，得到每个所述注意力头对应的注意力权重矩阵；将所有所述注意力头的注意力权重矩阵进行点乘计算，得到所述最终注意力权重矩阵。5.根据权利要求4所述的细粒度图像识别分类模型训练方法，其特征在于，注意力权重的计算公式为：式中，为第l个注意力头当中的第i张图片向量与分类向量的注意力权重，Q为查询向量，K为键向量，V为值向量，dk为注意力头的映射空间维度，T为矩阵转置；其中，注意力权重矩阵A表示为：其中，l∈1,2,…,L， i∈1,2,…,K，L代表注意力头的数量，K代表图片向量的数量。6.根据权利要求3所述的细粒度图像识别分类模型训练方法，其特征在于，根据所述最终自注意力权重矩阵确定分类目标所在位置的步骤包括：计算所述最终注意力权重矩阵中所有注意力权重的平均值；将所述最终注意力权重矩阵中的每个注意力权重与所述平均值进行比较，大于所述平均值的注意力权重标记为第一阈值，否则标记为第二阈值；根据与分类向量的注意力权重为第一阈值的目标图片向量的位置编码信息，确定所述分类目标所在位置。7.根据权利要求1所述的细粒度图像识别分类模型训练方法，其特征在于，分别将每个所述目标自注意力层的分类标签与预设真实标签进行损失计算，得到每个所述目标自注意力层的损失值的步骤包括：分别将每个所述目标自注意力层的分类标签与预设真实标签进行交叉熵损失计算，得到每个所述目标自注意力层的损失值；其中，所述交叉熵损失计算的公式为：式中，y r为第r个目标自注意力层的分类标签，y为预设真实标签，LOSSCE为第r个目标自注意力层的分类标签与预设真实标签的交叉熵损失值，所述预设数量为3，r∈1,2,3。8.一种细粒度图像识别分类模型训练系统，其特征在于，所述系统包括：图像获取模块，用于获取模型训练用的细粒度图像，并将所述细粒度图像输入到预设网络模型当中进行训练，所述预设网络模型包括多层自注意力层，所述细粒度图像依次经过每一所述自注意力层，以通过所述自注意力层对所述细粒度图像进行分类向量学习；向量获取模块，用于获取预设数量个目标自注意力层对所述细粒度图像进行学习得到的分类向量，所述目标自注意力层位于所述多层自注意力层的后端；损失计算模块，将每个所述目标自注意力层的分类向量输入到预设分类器当中，输出每个所述目标自注意力层的分类标签，分别将每个所述目标自注意力层的分类标签与预设真实标签进行损失计算，得到每个所述目标自注意力层的损失值；渐进训练模块，用于根据每个所述目标自注意力层的损失值，分别通过反向传播机制更新网络参数，以训练所述细粒度图像识别分类模型。9.一种计算机可读存储介质，其上存储有计算机程序，其特征在于，该程序被处理器执行时实现如权利要求1－7任一所述的细粒度图像识别分类模型训练方法。10.一种细粒度图像识别分类模型训练设备，包括存储器、处理器以及存储在存储器上并可在处理器上运行的计算机程序，其特征在于，所述处理器执行所述程序时实现如权利要求1－7任一所述的细粒度图像识别分类模型训练方法。
说明书desc
技术领域本发明涉及模型训练技术领域，特别涉及一种细粒度图像识别分类模型训练方法、装置及设备。背景技术细粒度图像分类旨在识别同一父类别里的子类别。例如，属于同一车类别之下的奔驰、奥迪，属于同一鸟类别之下的蓝松鸦、鹦鹉，属于同一狗类别之下的拉布拉多犬、金毛等。细粒度图像分类技术因其在人脸识别、交通车辆识别、智能零售商品、农业疾病识别研究、濒危动物保护等方面具有许多实际意义而备受关注。但是，与传统图像分类问题不同，细粒度图像分类用的训练数据集图片往往只有在局部细微区域具有较大判别性意义。现有的细粒度图像分类模型大致分为两类：强监督模型与弱监督模型。强监督模型依赖于精细的图像标注，这些准确且精细的标注信息大多通过不同方面的专家标注获得，另外由于样本数据集大，这一标注工作需要消耗大量时间与精力。此外，标注信息可能受到主观影响并且存在错误。近期一种以弱监督为基础的工作逐渐引起研究人员的关注，此方法无需额外的图像标注，即以图像级标签为监督信号。例如近期由Google提出的VisionTransformer在计算机图像领域大放异彩，仅仅单纯的ViT即可在细粒度图像分类达到不错的效果，但是要实现精细化细粒度图像分类依然存在不足。因此，目前许多研究工作者也在提出各种基于ViT的变种，都具有一定成效。但是现有基于ViT的工作大多是对于卷积神经网络已有的思想进行迁移，缺少了对于ViT结构中独特多头注意力机制的思考。并且最近ViT的工作大部分都在单纯针对图片向量与多头注意力机制进行研究，而忽略了分类向量在进行分类时的重要性。现有的ViT以及一些ViT的变种仅仅考虑了最后一层注意力层学习到的有利信息用于分类，而忽略了其他层所学习到的互补信息，这将造成一定的信息丢失，导致模型的细粒度图像分类的精度效果欠缺。发明内容基于此，本发明的目的是提供一种细粒度图像识别分类模型训练方法、装置及设备，以解决现有技术当中的至少一个技术问题。根据本发明实施例的一种细粒度图像识别分类模型训练方法，所述方法包括：获取模型训练用的细粒度图像，并将所述细粒度图像输入到预设网络模型当中进行训练，所述预设网络模型包括多层自注意力层，所述细粒度图像依次经过每一所述自注意力层，以通过所述自注意力层对所述细粒度图像进行分类向量学习；获取预设数量个目标自注意力层对所述细粒度图像进行学习得到的分类向量，所述目标自注意力层位于所述多层自注意力层的后端；将每个所述目标自注意力层的分类向量输入到预设分类器当中，输出每个所述目标自注意力层的分类标签，分别将每个所述目标自注意力层的分类标签与预设真实标签进行损失计算，得到每个所述目标自注意力层的损失值；根据每个所述目标自注意力层的损失值，分别通过反向传播机制更新网络参数，以训练所述细粒度图像识别分类模型。另外，根据本发明上述实施例的一种细粒度图像识别分类模型训练方法，还可以具有如下附加的技术特征：进一步地，还包括：根据预设计算规则计算出所述自注意力层在对所述细粒度图像进行分类向量学习之后的最终注意力权重矩阵；根据所述最终自注意力权重矩阵确定分类目标所在位置，并根据所述分类目标所在位置在所述细粒度图像中截取分类目标区域图像；将所述分类目标区域图像缩放到与所述细粒度图像同样大小后输入到所述预设网络模型当中进行训练，以强化训练所述细粒度图像识别分类模型。进一步地，所述预设网络模型还包括线性投影层和位置编码层，将所述细粒度图像输入到预设网络模型当中进行训练的步骤包括：按照预设分割规则将所述细粒度图像分割成预设份子图像，并通过所述线性投影层将每一所述子图像映射到高维特征空间，得到每份所述子图像的图片向量；通过所述位置编码层对每份所述子图像的图片向量进行编码，以为每个所述图片向量添加位置编码信息，并在第一个图片向量前添加一个空的分类向量，得到向量序列；将所述向量序列输入到所述多层自注意力层进行分类向量学习，每层所述自注意力层学习到的分类特征会更新于所述向量序列的分类向量当中，得到每层所述自注意力层的分类向量。进一步地，所述自注意力层包括多个注意力头，根据预设计算规则计算出所述自注意力层在对所述细粒度图像进行分类向量学习之后的最终注意力权重矩阵的步骤包括：在对所述细粒度图像进行分类向量学习之后，在每个所述注意力头当中，分别计算出本层当中分类向量与每个图片向量的注意力权重，得到每个所述注意力头对应的注意力权重矩阵；将所有所述注意力头的注意力权重矩阵进行点乘计算，得到所述最终注意力权重矩阵。进一步地，注意力权重的计算公式为：式中，为第l个注意力头当中的第i张图片向量与分类向量的注意力权重，Q为查询向量，K为键向量，V为值向量，dk为注意力头的映射空间维度，T为矩阵转置；其中，注意力权重矩阵A表示为：其中，l∈1,2,…,L，i∈1,2,…,K，L代表注意力头的数量，K代表图片向量的数量。进一步地，根据所述最终自注意力权重矩阵确定分类目标所在位置的步骤包括：计算所述最终注意力权重矩阵中所有注意力权重的平均值；将所述最终注意力权重矩阵中的每个注意力权重与所述平均值进行比较，大于所述平均值的注意力权重标记为第一阈值，否则标记为第二阈值；根据与分类向量的注意力权重为第一阈值的目标图片向量的位置编码信息，确定所述分类目标所在位置。进一步地，分别将每个所述目标自注意力层的分类标签与预设真实标签进行损失计算，得到每个所述目标自注意力层的损失值的步骤包括：分别将每个所述目标自注意力层的分类标签与预设真实标签进行交叉熵损失计算，得到每个所述目标自注意力层的损失值；其中，所述交叉熵损失计算的公式为：式中，yr为第r个目标自注意力层的分类标签，y为预设真实标签，LOSSCE为第r个目标自注意力层的分类标签与预设真实标签的交叉熵损失值，所述预设数量为3，r∈1,2,3。根据本发明实施例的一种细粒度图像识别分类模型训练系统，所述系统包括：图像获取模块，用于获取模型训练用的细粒度图像，并将所述细粒度图像输入到预设网络模型当中进行训练，所述预设网络模型包括多层自注意力层，所述细粒度图像依次经过每一所述自注意力层，以通过所述自注意力层对所述细粒度图像进行分类向量学习；向量获取模块，用于获取预设数量个目标自注意力层对所述细粒度图像进行学习得到的分类向量，所述目标自注意力层位于所述多层自注意力层的后端；损失计算模块，将每个所述目标自注意力层的分类向量输入到预设分类器当中，输出每个所述目标自注意力层的分类标签，分别将每个所述目标自注意力层的分类标签与预设真实标签进行损失计算，得到每个所述目标自注意力层的损失值；渐进训练模块，用于根据每个所述目标自注意力层的损失值，分别通过反向传播机制更新网络参数，以训练所述细粒度图像识别分类模型。本发明还提出一种计算机可读存储介质，其上存储有计算机程序，该程序被处理器执行时实现上述的细粒度图像识别分类模型训练方法。本发明还提出一种细粒度图像识别分类模型训练设备，包括存储器、处理器以及存储在存储器上并可在处理器上运行的计算机程序，所述处理器执行所述程序时实现上述的细粒度图像识别分类模型训练方法。本发明的有益效果为：通过对传统ViT结构进行改进，引入渐进式训练机制，通过对于ViT结构中不同层次的分类向量进行选择，而不单纯只注意最后一层注意力层学习到的有利信息，同时关注分类向量在进行分类时的重要性，能够很好的将学习到的信息向上进行传递，这有利于挖掘不同层次分类向量中的互补信息并用于分类，提高细粒度图像分类的精度效果。附图说明图1为本发明实施例当中提供的加利福尼亚海鸥图片；图2为本发明实施例当中提供的北极鸥图片；图3为本发明第一实施例中的细粒度图像识别分类模型训练方法的流程图；图4为本发明实施例中提供的改进的ViT模型结构示意图；图5为本发明第三实施例中的细粒度图像识别分类模型训练系统的结构框图。以下具体实施方式将结合上述附图进一步说明本发明。具体实施方式为了便于理解本发明，下面将参照相关附图对本发明进行更全面的描述。附图中给出了本发明的若干实施例。但是，本发明可以以许多不同的形式来实现，并不限于本文所描述的实施例。相反地，提供这些实施例的目的是使对本发明的公开内容更加透彻全面。需要说明的是，当元件被称为“固设于”另一个元件，它可以直接在另一个元件上或者也可以存在居中的元件。当一个元件被认为是“连接”另一个元件，它可以是直接连接到另一个元件或者可能同时存在居中元件。本文所使用的术语“垂直的”、“水平的”、“左”、“右”以及类似的表述只是为了说明的目的。除非另有定义，本文所使用的所有的技术和科学术语与属于本发明的技术领域的技术人员通常理解的含义相同。本文中在本发明的说明书中所使用的术语只是为了描述具体的实施例的目的，不是旨在于限制本发明。本文所使用的术语“及／或”包括一个或多个相关的所列项目的任意的和所有的组合。细粒度图像分类旨在识别同一父类别里的子类别。例如，属于同一车类别之下的奔驰、奥迪，属于同一鸟类别之下的蓝松鸦、鹦鹉，属于同一狗类别之下的拉布拉多犬、金毛等。细粒度图像分类技术因其在人脸识别、交通车辆识别、智能零售商品、农业疾病识别研究、濒危动物保护等方面具有许多实际意义而备受关注。但是，与传统图像分类问题不同，细粒度图像分类用的训练数据集图片往往只有在局部细微区域具有较大判别性意义。如图1-图2所示，图1为加利福尼亚海鸥，图2为北极鸥。虽然是不同类别的海鸥，但是这两种类别之间又十分相似，普通人难以肉眼分辨。并且属于同一种类的海鸥又由于拍摄角度，光照，飞行姿态等问题导致难以判断是否为同一类别。因其特有的类内差异大，类间差异小，所以细粒度图像识别比传统图像分类更加困难，更具挑战。近期由Google提出的VisionTransformer在计算机图像领域大放异彩，仅仅单纯的ViT即可在细粒度图像分类达到不错的效果，但是要实现精细化细粒度图像分类依然存在不足。因此，目前许多研究工作者也在提出各种基于ViT的变种，都具有一定成效。但是现有基于ViT的工作大多是对于卷积神经网络已有的思想进行迁移，缺少了对于ViT结构中独特多头注意力机制的思考。并且最近ViT的工作大部分都在单纯针对图片向量与多头注意力机制进行研究，而忽略了分类向量在进行分类时的重要性。以及现有的ViT以及一些ViT的变种仅仅考虑了最后一层注意力层学习到的有利信息用于分类，而忽略了其他层所学习到的互补信息，这将造成一定的信息丢失，导致模型的细粒度图像分类的精度效果欠缺。基于此，本发明的目的在于对传统的ViT结构进行改进，并提出一套全新的细粒度图像分类模型的训练方法，使得训练得到的细粒度图像分类模型具有较佳的分类精度，从而提升模型的分类效果。具体方案将结合以下具体实例做详细描述。实施例一请参阅图3，所示为本发明第一实施例中的细粒度图像识别分类模型训练方法，所述细粒度图像识别分类模型训练方法可通过软件和/或硬件来实现，所述方法包括步骤S01-步骤S04。步骤S01，获取模型训练用的细粒度图像，并将所述细粒度图像输入到预设网络模型当中进行训练，所述预设网络模型包括多层自注意力层，所述细粒度图像依次经过每一所述自注意力层，以通过所述自注意力层对所述细粒度图像进行分类向量学习。在本实施例当中，预设网络模型具体为改进的ViT模型，请参阅图4，改进的ViT模型包括多层自注意力层，其中最后三层自注意力层分别连接MLPHead分类头，图中三个MLPHead分类头分别标记为MLP1、MLP2以及MLP3，使得自注意力层学习到的分类向量可以通过对应的MLPHead分类头输出对应的分类结果。在具体实施时，可以大量收集不同种类的细粒度图片，并将同种类图片归于一类，并给每一类图片预设相同的真实标签，例如收集大量的北极鸥图片和大量的加利福尼亚海鸥图片，北极鸥图片归为一类并赋予能够表征北极鸥特征的真实标签，而加利福尼亚海鸥图片归为一类并赋予表征加利福尼亚海鸥特征的真实标签。然后再分别用不同种类的细粒度图片作为训练集对改进的ViT模型进行训练，训练时细粒度图片会依次输入ViT模型的每一自注意力层当中，以通过自注意力层对细粒度图片的分类向量进行学习。优选地，在具体实施时，真实标签可以是每个类别的标号，例如北极鸥真实标签赋值为1，加利福尼亚海鸥真实标签赋值为2，或者真实标签也可以是每个类别的名称、细粒度特征等其他标识性信息。步骤S02，获取预设数量个目标自注意力层对所述细粒度图像进行学习得到的分类向量，所述目标自注意力层位于所述多层自注意力层的后端。步骤S03，将每个所述目标自注意力层的分类向量输入到预设分类器当中，输出每个所述目标自注意力层的分类标签，分别将每个所述目标自注意力层的分类标签与预设真实标签进行损失计算，得到每个所述目标自注意力层的损失值。其中，在本实施例当中，预设分类器为MLPHead分类头。步骤S04，根据每个所述目标自注意力层的损失值，分别通过反向传播机制更新网络参数，以训练所述细粒度图像识别分类模型。在具体实施时，本实施例具体选取最后三层自注意力层作为目标自注意力层，也即预设数量为三，然后分别将最后三层自注意力层学习到的分类向量通过对应的MLPHead分类头进行分类输出，得到每个目标自注意力层的分类标签，然后分别计算每个目标自注意力层的分类标签与真实标签的损失值，由此得到最后三层自注意力层的损失值，然后分别以每一自注意力层的损失值并采用反向传播机制对前面的自注意力层的网络参数进行迭代修改，以最终训练能够准确进行细粒度图像识别分类的细粒度图像识别分类模型。当然在其他实施例当中，还可以采用其他数量和/或其他位置的自注意力层来进行分类，例如选取最后四层自注意力层作为目标自注意力层。具体地，作为优先的实施方式，分别将每个所述目标自注意力层的分类标签与预设真实标签进行损失计算，得到每个所述目标自注意力层的损失值的步骤包括：分别将每个所述目标自注意力层的分类标签与预设真实标签进行交叉熵损失计算，得到每个所述目标自注意力层的损失值；其中，所述交叉熵损失计算的公式为：式中，yr为第r个目标自注意力层的分类标签，y为预设真实标签，LOSSCE为第r个目标自注意力层的分类标签与预设真实标签的交叉熵损失值，所述预设数量为3，r∈1,2,3。也即，本实施例在传统ViT的结构基础上选择最后三层自注意力层分别连接MLPHead分类头，从而选择最后三层自注意力层学习到的有利信息用于分类，并据此提出了渐进式逐级训练方式，即以最后三层自注意力层的损失值分别通过反向传播机制更新网络参数，从而引导模型学习多层互补信息。需要特别说明的是，本实施例当中的训练方法并不是简单的将不同层的损失叠加并反向传播。而是分别对于每一个损失进行反向传播并更新参数，这帮助模型的不同层更好的协调工作。此外，通过递进的方式将底层学习到的信息向上层传递，这将有利于模型学习与收敛。综上，本发明上述实施例当中的细粒度图像识别分类模型训练方法，通过对传统ViT结构进行改进，引入渐进式训练机制，通过对于ViT结构中不同层次的分类向量进行选择，而不单纯只注意最后一层注意力层学习到的有利信息，同时关注分类向量在进行分类时的重要性，能够很好的将学习到的信息向上进行传递，这有利于挖掘不同层次分类向量中的互补信息并用于分类，提高细粒度图像分类的精度效果。实施例二本发明第二实施例同样提出一种细粒度图像识别分类模型训练方法，所述细粒度图像识别分类模型训练方法可通过软件和/或硬件来实现，请参阅图4，改进的ViT模型还包括线性投影层、位置编码层以及多尺度模块，细粒度图像先经过线性投影层进行高维特征空间映射后得到对应的图片向量，再由位置编码层对图片向量进行位置编码后再输入后面的多层自注意力层，同时本实施例还在传统ViT结构的基础上，进一步增设多尺度模块，如图4所示，多尺度模块位于多层自注意力层的右侧，每一自注意力层分别与多尺度模块连接。可以理解的，ViT的多头注意力机制使其固有的更加关注全局信息，而在细粒度图像识别中一些判别性区域往往是微小的局部区域，所以为了更好的促使模型学习到一些显著性区域信息，本实施例提出多尺度模块，此模块的主要作用是通过自注意力层的多头注意力的叠加，将每层的注意力权重累乘，并映射到原图，从而找到每一自注意力层对应注意到的局部判别性区域，然后从原图当中截取出对应的局部判别性区域，之后再将每层截取的局部判别性区域图片重新输入到模型当中进行训练，帮助模型在学习全局信息的基础上发现判别性局部区域，从而实现全局信息与局部信息的互补交流，提高细粒度图像分类效果。具体地，在本实施例当中，所述细粒度图像识别分类模型训练方法具体包括步骤S11-步骤S16。步骤S11，按照预设分割规则将所述细粒度图像分割成预设份子图像，并通过所述线性投影层将每一所述子图像映射到高维特征空间，得到每份所述子图像的图片向量。在具体实施时，可以按照预设分割尺寸将每一细粒度图像等分成预设份子图像，例如可以按照3×3的分割尺寸将细粒度图像等分成9份子图像，每份子图像对应一个图片向量。步骤S12，通过所述位置编码层对每份所述子图像的图片向量进行编码，以为每个所述图片向量添加位置编码信息，并在第一个图片向量前添加一个空的分类向量，得到向量序列。在一些可选实施例当中，位置编码信息可以为子图像在整个细粒度图像的位置坐标信息，由于图片分割规则已知，因此每个子图像在整个细粒度图像的位置坐标信息也是已知的。或者在另一些可选实施例当中，位置编码信息可以为子图像的编号，具体可以根据分割的先后顺序对每份子图像进行编号。步骤S13，将所述向量序列输入到所述多层自注意力层进行分类向量学习，每层所述自注意力层学习到的分类特征会更新于所述向量序列的分类向量当中，得到每层所述自注意力层的分类向量。步骤S14，选取最后三个自注意力层作为目标自注意力层，获取每个目标自注意力层对所述细粒度图像进行学习得到的分类向量。步骤S15，将每个所述目标自注意力层的分类向量输入到预设分类器当中，输出每个所述目标自注意力层的分类标签，分别将每个所述目标自注意力层的分类标签与预设真实标签进行交叉熵损失计算，得到每个所述目标自注意力层的损失值。步骤S16，根据每个所述目标自注意力层的损失值，分别通过反向传播机制更新网络参数，以训练所述细粒度图像识别分类模型。除此之外，在进行上述模型训练的同时，本实施例当的细粒度图像识别分类模型训练方法还包括：根据预设计算规则计算出所述自注意力层在对所述细粒度图像进行分类向量学习之后的最终注意力权重矩阵；根据所述最终自注意力权重矩阵确定分类目标所在位置，并根据所述分类目标所在位置在所述细粒度图像中截取分类目标区域图像；将所述分类目标区域图像缩放到与所述细粒度图像同样大小后输入到所述预设网络模型当中进行训练，以强化训练所述细粒度图像识别分类模型。应当理解的，上述强化训练为多尺度模块对应的模型训练部分内容，其可以在上述渐进式训练的过程当中同时进行。其中，自注意力层包括多个注意力头，根据预设计算规则计算出所述自注意力层在对所述细粒度图像进行分类向量学习之后的最终注意力权重矩阵的步骤具体包括：在对所述细粒度图像进行分类向量学习之后，在每个所述注意力头当中，分别计算出本层当中分类向量与每个图片向量的注意力权重，得到每个所述注意力头对应的注意力权重矩阵；将所有所述注意力头的注意力权重矩阵进行点乘计算，得到所述最终注意力权重矩阵。其中，注意力权重的计算公式为：式中，为第l个注意力头当中的第i张图片向量与分类向量的注意力权重，Q为查询向量，K为键向量，V为值向量，dk为注意力头的映射空间维度，T为矩阵转置；在具体实施时，分别将分类向量和图片向量分成三份，一份为查询向量Q，一份为键向量K，一份为值向量V，然后根据分类向量和图片向量对应的查询向量Q、键向量K和值向量V计算分类向量和图片向量的关系程度，得到注意力权重。其中，注意力权重矩阵A表示为：其中，l∈1,2,…,L，i∈1,2,…,K，L代表注意力头的数量，K代表图片向量的数量。基于此，根据所述最终自注意力权重矩阵确定分类目标所在位置的步骤具体包括：计算所述最终注意力权重矩阵中所有注意力权重的平均值；将所述最终注意力权重矩阵中的每个注意力权重与所述平均值进行比较，大于所述平均值的注意力权重标记为第一阈值，否则标记为第二阈值，在具体实施时，第一阈值可以设定为1，第二阈值可以设定为0；根据与分类向量的注意力权重为第一阈值的目标图片向量的位置编码信息，确定所述分类目标所在位置。需要说明的是，由于分类向量是自注意力层对整个细粒度图像进行分类学习得到的分类向量，更加注意整个细粒度图像中分类目标所在位置区域，因此与分类向量的注意力权重为第一阈值的目标图片向量必然为更加接近或者本属于分类目标所在位置的图片，因此根据与分类向量的注意力权重为第一阈值的目标图片向量的位置编码信息，就可以确定分类目标所在位置，进而就能够映射到原图当中去截取分类目标所在的分类目标区域图像，进而通过分类目标区域图像对模型进行强化训练，使其在学习全局信息的基础上发现判别性局部区域，从而实现全局信息与局部信息的互补交流，进一步提高细粒度图像分类效果。本实施例与传统ViT结构和一些其他的ViT变种相比，本实施例提出的模型至少具有以下方面的优点，能有效地提高细粒度图像分类任务的性能与准确率。具体如下：1）本实施例提出一种细粒度图像识别分类模型的训练方法，能够进行端到端的训练，能够仅以图片级标签进行训练；2）本实施例对于传统ViT结构进行了改进，通过引入渐进式训练，通过对于ViT结构中不同层次的分类向量进行选择，能够很好的将学习到的信息向上进行传递，这有利于挖掘不同层次分类向量中的互补信息并用于分类；3）本实施例提出了多尺度模块，帮助模型学习全局信息的基础上发现判别性局部区域，从而实现全局信息与局部信息的互补交流，提高细粒度图像分类效果。实施例三本发明另一方面还提供一种细粒度图像识别分类模型训练系统，请查阅图5，所示为本发明第三实施例中的细粒度图像识别分类模型训练系统，所述细粒度图像识别分类模型训练系统包括：图像获取模块11，用于获取模型训练用的细粒度图像，并将所述细粒度图像输入到预设网络模型当中进行训练，所述预设网络模型包括多层自注意力层，所述细粒度图像依次经过每一所述自注意力层，以通过所述自注意力层对所述细粒度图像进行分类向量学习；向量获取模块12，用于获取预设数量个目标自注意力层对所述细粒度图像进行学习得到的分类向量，所述目标自注意力层位于所述多层自注意力层的后端；损失计算模块13，将每个所述目标自注意力层的分类向量输入到预设分类器当中，输出每个所述目标自注意力层的分类标签，分别将每个所述目标自注意力层的分类标签与预设真实标签进行损失计算，得到每个所述目标自注意力层的损失值；渐进训练模块14，用于根据每个所述目标自注意力层的损失值，分别通过反向传播机制更新网络参数，以训练所述细粒度图像识别分类模型。进一步地，在本发明一些可选实施例当中，所述系统还包括：多尺度训练模块，用于根据预设计算规则计算出所述自注意力层在对所述细粒度图像进行分类向量学习之后的最终注意力权重矩阵；根据所述最终自注意力权重矩阵确定分类目标所在位置，并根据所述分类目标所在位置在所述细粒度图像中截取分类目标区域图像；将所述分类目标区域图像缩放到与所述细粒度图像同样大小后输入到所述预设网络模型当中进行训练，以强化训练所述细粒度图像识别分类模型。进一步地，在本发明一些可选实施例当中，所述预设网络模型还包括线性投影层和位置编码层，所述图像获取模块11还用于按照预设分割规则将所述细粒度图像分割成预设份子图像，并通过所述线性投影层将每一所述子图像映射到高维特征空间，得到每份所述子图像的图片向量；通过所述位置编码层对每份所述子图像的图片向量进行编码，以为每个所述图片向量添加位置编码信息，并在第一个图片向量前添加一个空的分类向量，得到向量序列；将所述向量序列输入到所述多层自注意力层进行分类向量学习，每层所述自注意力层学习到的分类特征会更新于所述向量序列的分类向量当中，得到每层所述自注意力层的分类向量。进一步地，在本发明一些可选实施例当中，所述自注意力层包括多个注意力头，所述多尺度训练模块还用于在对所述细粒度图像进行分类向量学习之后，在每个所述注意力头当中，分别计算出本层当中分类向量与每个图片向量的注意力权重，得到每个所述注意力头对应的注意力权重矩阵；将所有所述注意力头的注意力权重矩阵进行点乘计算，得到所述最终注意力权重矩阵。其中，注意力权重的计算公式为：式中，为第l个注意力头当中的第i张图片向量与分类向量的注意力权重，Q为查询向量，K为键向量，V为值向量，dk为注意力头的映射空间维度，T为矩阵转置；其中，注意力权重矩阵A表示为：其中，l∈1,2,…,L，i∈1,2,…,K，L代表注意力头的数量，K代表图片向量的数量。进一步地，在本发明一些可选实施例当中，所述多尺度训练模块还用于计算所述最终注意力权重矩阵中所有注意力权重的平均值；将所述最终注意力权重矩阵中的每个注意力权重与所述平均值进行比较，大于所述平均值的注意力权重标记为第一阈值，否则标记为第二阈值；根据与分类向量的注意力权重为第一阈值的目标图片向量的位置编码信息，确定所述分类目标所在位置。进一步地，在本发明一些可选实施例当中，所述损失计算模块13还用于分别将每个所述目标自注意力层的分类标签与预设真实标签进行交叉熵损失计算，得到每个所述目标自注意力层的损失值；其中，所述交叉熵损失计算的公式为：式中，yr为第r个目标自注意力层的分类标签，y为预设真实标签，LOSSCE为第r个目标自注意力层的分类标签与预设真实标签的交叉熵损失值，所述预设数量为3，r∈1,2,3。本发明还提出一种计算机可读存储介质，其上存储有计算机程序，该程序被处理器执行时实现如上述的细粒度图像识别分类模型训练方法。本发明还提出一种细粒度图像识别分类模型训练设备，包括处理器、存储器以及存储在存储器上并可在处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现如上述的细粒度图像识别分类模型训练方法。其中，细粒度图像识别分类模型训练设备具体可以是电脑、服务器、摄像装置等等。处理器在一些实施例中可以是中央处理器、控制器、微控制器、微处理器或其他数据处理芯片，用于运行存储器中存储的程序代码或处理数据，例如执行访问限制程序等。其中，存储器至少包括一种类型的可读存储介质，所述可读存储介质包括闪存、硬盘、多媒体卡、卡型存储器、磁性存储器、磁盘、光盘等。存储器在一些实施例中可以是细粒度图像识别分类模型训练设备的内部存储单元，例如该细粒度图像识别分类模型训练设备的硬盘。存储器在另一些实施例中也可以是细粒度图像识别分类模型训练设备的外部存储装置，例如细粒度图像识别分类模型训练设备上配备的插接式硬盘，智能存储卡，安全数字卡，闪存卡等。进一步地，存储器还可以既包括细粒度图像识别分类模型训练设备的内部存储单元也包括外部存储装置。存储器不仅可以用于存储安装于细粒度图像识别分类模型训练设备的应用软件及各类数据，还可以用于暂时地存储已经输出或者将要输出的数据。本领域技术人员可以理解，在流程图中表示或在此以其他方式描述的逻辑和/或步骤，例如，可以被认为是用于实现逻辑功能的可执行指令的定序列表，可以具体实现在任何计算机可读介质中，以供指令执行系统、装置或设备使用，或结合这些指令执行系统、装置或设备而使用。就本说明书而言，“计算机可读介质”可以是任何可以包含、存储、通信、传播或传输程序以供指令执行系统、装置或设备或结合这些指令执行系统、装置或设备而使用的装置。计算机可读介质的更具体的示例包括以下：具有一个或多个布线的电连接部，便携式计算机盘盒，随机存取存储器，只读存储器，可擦除可编辑只读存储器，光纤装置，以及便携式光盘只读存储器。另外，计算机可读介质甚至可以是可在其上打印所述程序的纸或其他合适的介质，因为可以例如通过对纸或其他介质进行光学扫描，接着进行编辑、解译或必要时以其他合适方式进行处理来以电子方式获得所述程序，然后将其存储在计算机存储器中。应当理解，本发明的各部分可以用硬件、软件、固件或它们的组合来实现。在上述实施方式中，多个步骤或方法可以用存储在存储器中且由合适的指令执行系统执行的软件或固件来实现。例如，如果用硬件来实现，和在另一实施方式中一样，可用本领域公知的下列技术中的任一项或它们的组合来实现：具有用于对数据信号实现逻辑功能的逻辑门电路的离散逻辑电路，具有合适的组合逻辑门电路的专用集成电路，可编程门阵列，现场可编程门阵列等。在本说明书的描述中，参考术语“一个实施例”、“一些实施例”、 “示例”、“具体示例”、或“一些示例”等的描述意指结合该实施例或示例描述的具体特征、结构、材料或者特点包含于本发明的至少一个实施例或示例中。在本说明书中，对上述术语的示意性表述不一定指的是相同的实施例或示例。而且，描述的具体特征、结构、材料或者特点可以在任何的一个或多个实施例或示例中以合适的方式结合。以上所述实施例仅表达了本发明的几种实施方式，其描述较为具体和详细，但并不能因此而理解为对本发明专利范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本发明构思的前提下，还可以做出若干变形和改进，这些都属于本发明的保护范围。因此，本发明专利的保护范围应以所附权利要求为准。
