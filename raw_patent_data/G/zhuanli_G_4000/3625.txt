标题title
用于全屏或单角缺失的屏幕角点定位方法
摘要abst
本发明特别涉及一种用于全屏或单角缺失的屏幕角点定位方法，包括如下步骤：构建数据集：对包含完整屏幕的原图进行裁剪得到单角点缺失图；对单角点缺失图进行中心缩小处理并在四周填补0像素使图片长宽不变，裁剪掉的角点位于填补的区域内；根据缩小填补后的图片中的角点位置计算标签值；构建模型，利用数据集对模型进行训练得到训练好的角点识别模型；将待识别的全屏或单角缺失的图片代入训练好的角点识别模型中得到预测标签值；对预测标签值进行中心放大处理和坐标变换得到真实的角点坐标。通过上述步骤，使得不在原始图片的角点也能正常进行计算损失函数和反向传播优化模型，从而实现屏幕缺失一个的角点的情况下对全部角点的准确定位。
权利要求书clms
1.一种用于全屏或单角缺失的屏幕角点定位方法，其特征在于：包括如下步骤：通过全角点数据集按如下步骤构建缺失角点数据集：对包含完整屏幕的原图进行裁剪得到单角点缺失图；对单角点缺失图进行中心缩小处理并在四周填补0像素使图片长宽不变，其中，裁剪掉的角点位于填补的区域内，1/α为预设的缩小系数，1＜α＜3；根据缩小填补后的图片中的角点位置计算标签值；构建Yolo-ArbV2模型，利用数据集对模型进行训练得到训练好的角点识别模型，训练时单角点缺失图作为模型的输入、标签值作为模型的输出；将待识别的全屏或单角缺失的图片代入训练好的角点识别模型中得到预测标签值；对预测标签值进行中心放大处理和坐标变换得到真实的角点坐标，其中放大系数为α。2.如权利要求1所述的用于全屏或单角缺失的屏幕角点定位方法，其特征在于：所述的对包含完整屏幕的原图进行裁剪得到单角点缺失图包括：人工标记包含完整屏幕的原图得到四个角点坐标；任意选择一个角点A，记其对角点为C，经过点A和点C的连线上的点E作第一直线将点A和其余三个角点分割开，其中LAE≤LAC*/，LAE和LAC分别是点AE、点AC之间的距离；以第一直线为边，作包含除点A以外的三个角点的长方形，并基于该长方形对图片进行裁剪得到单角点缺失图。3.如权利要求1所述的用于全屏或单角缺失的屏幕角点定位方法，其特征在于：所述的根据缩小填补后的图片中的角点位置计算标签值包括：根据剪裁前、后的原图、单角点缺失图的变换关系将原图中的四个角点坐标转换为单角点缺失图中的角点坐标；根据单角点缺失图缩放前后的变换关系计算缩小填补后的图片中的角点坐标；根据缩小填补后的图片的长和宽将缩小填补后的图片中的角点坐标归一化为0-1之间的值即得到标签值。4.如权利要求1所述的用于全屏或单角缺失的屏幕角点定位方法，其特征在于：所述的对预测标签值进行中心放大处理和坐标变换得到真实的角点坐标包括：记预测标签值为Li，其中i=1,2,3，…,8，分别代表四个角点横、纵坐标对应的标签值；根据以下公式计算经过中心放大处理后标签值：Li'＝0.5+*α；将经过中心放大处理后标签值通过以下公式计算得到真实的角点坐标：xj=W*L',yj=H*L2j'，式中，j=1,2,3,4；W和H为待检测图片的宽和高。5.一种计算机可读存储介质，其特征在于：其上存储有计算机程序，所述计算机程序被处理器执行时，实现如权利要求1-4中任一项所述的用于全屏或单角缺失的屏幕角点定位方法。6.一种电子设备，其特征在于：包括存储器、处理器及存储在存储器上的计算机程序，所述处理器执行所述计算机程序时，实现如权利要求1-4中任一项所述的用于全屏或单角缺失的屏幕角点定位方法。
说明书desc
技术领域本发明涉及图片处理技术领域，特别涉及一种用于全屏或单角缺失的屏幕角点定位方法。背景技术YOLO系列算法是一类典型的one-stage目标检测算法，其利用anchor box将分类与目标定位的回归问题结合起来，从而做到了高效、灵活和泛化性能好，所以在工业界也十分受欢迎。YOLO算法采用一个单独的CNN模型实现end-to-end的目标检测，核心思想就是利用整张图作为网络的输入，直接在输出层回归bounding box的位置及其所属的类别，目前最新的YOLO系列算法是YOLOv5算法。YOLOv5算法输出的bounding box是由左上角点和右下角点构成的，对于很多目标来说，我们不仅需要其边界框，还需要其具体的角点位置。有学者在GitHub开源软件平台上提出了Yolo-ArbV2算法，该算法是在YOLOv5基础上进行二次开发，保持GT框检测功能的同时，新增了额外输出信息，用于检测输出中目标多边形的信息，这样实现了基于矩形Anchor-based的多边形检测功能。Yolo-ArbV2算法可以实现整个屏幕都在待检测图片情况下屏幕的准确多边形定位，但在实际场景中，很多时候屏幕并不会完整地出现在待检测图片中。Yolo-ArbV2算法是基于YOLOv5算法的，在YOLOv5算法中，预处理，批归一化和计算IOU Loss时都要求标签数据为归一化到0到1区间的浮点数，同时，输出结果也满足在0到1区间。而在屏幕外的点的坐标经过yolov5处理后就会变成包含负数的数据，因此使用原本的Yolo-ArbV2算法不能对单角缺失的图片进行屏幕角点的准确定位。发明内容本发明的目的在于提供一种用于全屏或单角缺失的屏幕角点定位方法，可实现单角缺失的图片中屏幕角点的定位。为实现以上目的，本发明采用的技术方案为：一种用于全屏或单角缺失的屏幕角点定位方法，包括如下步骤：通过全角点数据集按如下步骤构建缺失角点数据集：对包含完整屏幕的原图进行裁剪得到单角点缺失图；对单角点缺失图进行中心缩小处理并在四周填补0像素使图片长宽不变，其中，裁剪掉的角点位于填补的区域内，1/α为预设的缩小系数，1＜α＜3；根据缩小填补后的图片中的角点位置计算标签值；构建Yolo-ArbV2模型，利用数据集对模型进行训练得到训练好的角点识别模型，训练时单角点缺失图作为模型的输入、标签值作为模型的输出；将待识别的全屏或单角缺失的图片代入训练好的角点识别模型中得到预测标签值；对预测标签值进行中心放大处理和坐标变换得到真实的角点坐标，其中放大系数为α。与现有技术相比，本发明存在以下技术效果：为了使模型能正确预测第四个角点，需要保留预测的缺失检测点的占位，本案中将训练样本图片都进行缩小操作，使本来超出图片范围的角点也能包含在图片中，根据缩放之后的图片，生成训练需要的标签值；之后进行常规的模型训练和角点检测，但训练输入图片是没有经过缩放正常比例的图片，如此，训练的过程中，不在原始图片的角点也能正常进行计算损失函数和反向传播优化模型；在模型训练完毕进行推理时，得到的检测结果再缩放回原尺度，就能得到正确的结果；这样就实现了屏幕缺失一个的角点的情况下对全部角点的准确定位。附图说明图1是本发明的流程示意图。具体实施方式下面结合图1，对本发明做进一步详细叙述。参阅图1，本发明公开了一种用于全屏或单角缺失的屏幕角点定位方法，包括如下步骤：通过全角点数据集按如下步骤构建缺失角点数据集：对包含完整屏幕的原图进行裁剪得到单角点缺失图，图1中上排第1个小图即为原图，其中的虚线框为屏幕，上排第3个小图即为单角点缺失图，其中的实线框为缺失角点的屏幕。对单角点缺失图进行中心缩小处理并在四周填补0像素使图片长宽不变，其中，裁剪掉的角点位于填补的区域内，1/α为预设的缩小系数，中心缩小处理和填补处理后得到上排第4个小图。根据缩小填补后的图片中的角点位置计算标签值；构建Yolo-ArbV2模型，利用数据集对模型进行训练得到训练好的角点识别模型，训练时单角点缺失图作为模型的输入、标签值作为模型的输出；将待识别的全屏或单角缺失的图片代入训练好的角点识别模型中得到预测标签值；对预测标签值进行中心放大处理和坐标变换得到真实的角点坐标，其中放大系数为α。对于上述的α，其是放大系数，其倒数为缩小系数。既然是放大，那么α肯定是大于1的。在本实施例中，原图去掉一角后，屏幕至少要有一半留在新图片中，而屏幕至多可以占满原图片，所以单侧扩大等于原图大小时就一定能保证缩放后可以包含缺失角点；同时，因为是等比例方法，无论哪个角点缺失，对角线另一个方向上也会等比例放大，所以两侧最多都扩大原图大小，此时为极限情况，缩放比例为3，我们不会取该极限情况，所以α要小于3。实际预设α时，α越接近于1，预测的角点位置精度很高，但只能容忍较小区域的单角缺失，α越接近于3，预测的角点位置精度会降低，但其可容忍较大区域的单角缺失，因此，实际的取值是根据用户的使用情况来设置。为了使模型能正确预测第四个角点，需要保留预测的缺失检测点的占位，本案中将训练样本图片都进行缩小操作，使本来超出图片范围的角点也能包含在图片中，根据缩放之后的图片，生成训练需要的标签值；之后进行常规的模型训练和角点检测，但训练输入图片是没有经过缩放正常比例的图片，如此，训练的过程中，不在原始图片的角点也能正常进行计算损失函数和反向传播优化模型；在模型训练完毕进行推理时，得到的检测结果再缩放回原尺度，就能得到正确的结果；这样就实现了屏幕缺失一个的角点的情况下对全部角点的准确定位。进一步地，对原图进行裁剪得到单角点缺失图有很多种方案可以实现，本发明中优选地，如图1中上排第2个小图所示，所述的对包含完整屏幕的原图进行裁剪得到单角点缺失图包括：人工标记包含完整屏幕的原图得到四个角点坐标；任意选择一个角点A，记其对角点为C，经过点A和点C的连线上的点E作与直线AC具有一定夹角的第一直线，第一直线将点A和其余三个角点分割开，即点A在第一直线一侧，点B、C、D在第一直线另一侧。点E的位置需要满足公式：LAE≤LAE≤LAC*/，LAE和LAC分别是点AE、点AC之间的距离；以第一直线为边，作包含除点A以外的三个角点的长方形，如图中包含点BCD的虚线框所示，并基于该长方形对图片进行裁剪得到单角点缺失图。通过该步骤，可以方便的裁剪出单角点缺失图。进一步地，所述的根据缩小填补后的图片中的角点位置计算标签值包括：根据剪裁前、后的原图、单角点缺失图的变换关系将原图中的四个角点坐标转换为单角点缺失图中的角点坐标；需要注意的是，单角点缺失图中，有一个角点位于图片以外，其坐标会是负值。根据单角点缺失图缩放前后的变换关系计算缩小填补后的图片中的角点坐标，经过这一步操作后，四个角点的坐标都是正值。根据缩小填补后的图片的长和宽将缩小填补后的图片中的角点坐标归一化为0-1之间的值即得到标签值，之所以要进行归一化，是因为Yolo-ArbV2模型的输出就是归一化的标签值的。进一步地，根据预测标签值反推真实的角点坐标，有很多种实现方案。不管何种方案，都需要进行中心放大处理，即前面中心缩小处理的逆变换，并且，在不同的图片中，角点的坐标需要进行变换。中心放大处理和坐标变换的步骤不分先后，甚至可以在坐标变换的过程中插入中心放大处理的步骤。本发明中优选地，将中心放大处理放在坐标变换处理的前面，具体地，所述的对预测标签值进行中心放大处理和坐标变换得到真实的角点坐标包括：记预测标签值为，其中i=1,2,3，…,8，分别代表四个角点横、纵坐标对应的标签值，即L1和L2是第一个点横纵坐标对应的标签值，L3和L4是第二个点横纵坐标对应的标签值，以此类推。预测标签值Li都在0-1范围内。根据以下公式计算经过中心放大处理后标签值：Li'＝0.5+*α，这里就相当于做中心放大处理，对于1*1的图来说，中心点就是0.5、0.5，通过该公式可以轻松的计算出中心放大处理后的标签值Li'，Li'可以为负值。最后，将经过中心放大处理后标签值通过以下公式计算得到真实的角点坐标：xj=W*L',yj=H*L2j'，式中，j=1,2,3,4；W和H为待检测图片的宽和高。这里通过简单的数学计算就可以将预测标签值转换成真实的角点坐标，处理起来非常的迅速。本发明还公开了一种计算机可读存储介质和一种电子设备。其中，一种计算机可读存储介质，其上存储有计算机程序，所述计算机程序被处理器执行时，实现如前所述的用于全屏或单角缺失的屏幕角点定位方法。一种电子设备，包括存储器、处理器及存储在存储器上的计算机程序，所述处理器执行所述计算机程序时，实现如前所述的用于全屏或单角缺失的屏幕角点定位方法。
