标题title
一种消防设施计数方法、装置、存储介质及电子设备
摘要abst
本公开揭示了一种消防设施计数方法、装置、存储介质及电子设备，其方法包括：S100：采集消防设施输入图像；S200：对输入图像预处理；S300：构建消防设施计数模型并训练；S400：将预处理后的输入图像输入训练好的消防设施计数模型中，以实现对输入图像中的消防设施进行计数。本公开基于深度学习模型能够学习和捕捉到消防设施丰富的特征表示，并通过特征表示确定消防设施的位置信息，以及能够更好地适应复杂的场景和变化的环境，提高计数的准确性。
权利要求书clms
1.一种消防设施计数方法，其特征在于，所述的方法包括如下步骤：S100：采集消防设施输入图像；S200：对输入图像预处理；S300：构建消防设施计数模型并训练；所述消防设施计数模型包括轻量化主干网络，轻量化主干网络后依次连接通道注意力机制模块和空间注意力机制模块，其中，通道注意力机制模块用于捕获主干网络输出的特征图中更多上下文信息和高级语义信息，空间注意力机制模块用于编码空间维度上的长距离依赖；S400：将预处理后的输入图像输入训练好的消防设施计数模型中，以实现对输入图像中的消防设施进行计数。2.根据权利要求1所述的方法，其特征在于，步骤S200中，所述对输入图像预处理包括以下步骤：S201：对输入图像进行归一化处理；S202：对归一化处理后的输入图像进行对比度增强。3.根据权利要求1所述的方法，其特征在于，步骤S300中，所述消防设施计数模型还包括：轻量化多尺度特征融合模块和轻量化细粒度特征提取模块。4.一种消防设施计数装置，其特征在于，所述的装置包括：采集模块，用于输入包含消防设施的输入图像；预处理模块，用于对输入图像预处理；训练模块，用于构建消防设施计数模型并训练；所述消防设施计数模型包括轻量化主干网络，轻量化主干网络后依次连接通道注意力机制模块和空间注意力机制模块，其中，通道注意力机制模块用于捕获主干网络输出的特征图中更多上下文信息和高级语义信息，空间注意力机制模块用于编码空间维度上的长距离依赖；计数模块，用于将预处理后的输入图像输入训练好的消防设施计数模型中，以实现对图像中的消防设施进行计数。5.根据权利要求4所述的装置，其特征在于，所述预处理模块包括：归一化子模块，用于对输入图像进行归一化处理；增强子模块，用于对归一化处理后的输入图像进行对比度增强。6.根据权利要求5所述的装置，其特征在于，所述训练模块包括：获取子模块，用于获取多张包含消防设施的输入图像数据集；标注子模块，用于对输入图像中的消防设施进行标注；划分子模块，用于将标注后的输入图像数据集划分为训练集和测试集；训练子模块，用于通过训练集对消防设施计数模型进行训练；测试子模块，用于通过测试集对训练后的消防设施计数模型进行测试。7.一种电子设备，其特征在于，所述的电子设备包括：存储器，处理器及存储在存储器上并可在处理器上运行的计算机程序，其中，所述处理器执行所述程序时实现权利要求1至3任一所述的方法。8.一种计算机存储介质，其特征在于，所述的存储介质存储有计算机可执行指令，所述计算机可执行指令用于执行权利要求1至3任一所述的方法。
说明书desc
技术领域本公开属于深度学习技术领域，具体涉及一种消防设施计数方法、装置、存储介质及电子设备。背景技术在大型建筑物或公共场所中，消防设施的布置与数量是十分重要的。为了保障人们的生命财产安全，消防设施必须经过严格的检查和核对。现有的消防设施计数方法主要包含两种：第一种是使用深度学习目标检测来对图像中的消防设施进行标记，然后对这些标记的目标进行求和，得出最后的总数。此方法主要存在以下两个方面的问题：1、此方法需要在标记阶段对图像中的所有目标进行标记，其标签标记的范围为整个设备，因此需要消耗大量的时间来进行标记工作；2、此方法虽然能够在目标稀疏的场景下取得较好的结果，但是在目标比较密集的场所往往检测不到遮挡后的物体，从而导致检测精度降低；第二种是使用深度学习密度图回归的方式直接输出图像中目标的密度信息，然后通过对图中的像素点进行求和可以得出图像中的总目标数。但是此类方法为了追求准确度，使用了较深的卷积神经网络，因此会导致参数量和运算量的增加，从而使得此方法难以落地应用。发明内容针对现有技术中的不足，本公开的目的在于提供一种消防设施计数方法，该方法能够自动对消防设施进行识别和计数，从而能够极大提高消防设施的计数效率和准确性。为实现上述目的，本公开提供以下技术方案：一种基于深度学习的消防设施计数方法，包括如下步骤：S100：采集消防设施输入图像；S200：对输入图像预处理；S300：构建消防设施计数模型并训练；所述消防设施计数模型包括轻量化主干网络，轻量化主干网络后依次连接通道注意力机制模块和空间注意力机制模块，其中，通道注意力机制模块用于捕获主干网络输出的特征图中更多上下文信息和高级语义信息，空间注意力机制模块用于编码空间维度上的长距离依赖；S400：将预处理后的输入图像输入训练好的消防设施计数模型中，以实现对输入图像中的消防设施进行计数。优选的，所述对图像预处理包括以下步骤：S201：对输入图像进行归一化处理；S202：对归一化处理后的输入图像进行对比度增强。优选的，所述消防设施计数模型还包括：轻量化多尺度特征融合模块和轻量化细粒度特征提取模块。优选的，所述消防设施计数模型通过以下步骤进行训练：S301：获取多张包含消防设施的输入图像数据集，对输入图像中的消防设施进行标注，以获得标注后的输入图像数据集，对标注后的输入图像数据集预处理后划分为训练集和验证集；S302：对模型的权重进行初始化，通过训练集对模型进行训练，在训练过程中，将模型输出与训练集中已标注的消防设施数量进行比较，计算均方误差损失函数并进行反向传播以优化网络权重，使得模型的输出结果与标注的标签的差别在预设的阈值范围内，当损失函数收敛，模型训练完成；S303：利用验证集对训练后的模型进行验证，将标注数量与模型预测数量输入损失函数以计算两者之间的差距，并根据损失函数进行反向优化。本公开还提供一种消防设施计数装置，包括：采集模块，用于采集消防设施输入图像；预处理模块，用于对输入图像预处理；训练模块，用于构建消防设施计数模型并训练；所述消防设施计数模型包括轻量化主干网络，轻量化主干网络后依次连接通道注意力机制模块和空间注意力机制模块，其中，通道注意力机制模块用于捕获主干网络输出的特征图中更多上下文信息和高级语义信息，空间注意力机制模块用于编码空间维度上的长距离依赖；计数模块，用于将预处理后的输入图像输入训练好的消防设施计数模型中，以实现对输入图像中的消防设施进行计数。优选的，所述预处理模块包括：归一化子模块，用于对输入图像进行归一化处理；增强子模块，用于对归一化处理后的输入图像进行对比度增强。优选的，所述训练模块包括：获取子模块，用于获取多张包含消防设施的输入图像数据集；标注子模块，用于对输入图像中的消防设施进行标注；划分子模块，用于将标注后的输入图像数据集划分为训练集和测试集；训练子模块，用于通过训练集对消防设施计数模型进行训练；测试子模块，用于通过测试集对训练后的消防设施计数模型进行测试。本公开还提供一种电子设备，包括：存储器，处理器及存储在存储器上并可在处理器上运行的计算机程序，其中，所述处理器执行所述程序时实现任一所述的方法。本公开还提供一种计算机存储介质，所述计算机存储介质存储有计算机可执行指令，所述计算机可执行指令用于执行如前任一所述的方法。与现有技术相比，本公开带来的有益效果为：1、自动化和高效性：传统的消防设施数量核对通常需要人工参与，耗时且容易出错。本方法通过深度学习技术实现自动识别和计数，使得消防设施的数量可以在短时间内自动完成核对，节省了大量的人力和时间成本。2、高准确性：深度学习模型能够学习和捕捉到消防设施丰富的特征表示，并通过特征表示确定消防设施的位置信息，相比传统的基于规则或手工特征提取的方法，基于深度学习的方法能够更好地适应复杂的场景和变化的环境，提高计数的准确性。3、鲁棒性和泛化能力：深度学习模型通过大规模的训练数据和端到端的训练方式，可以学习到丰富的特征表示和模式，从而具有更好的鲁棒性和泛化能力。无论是在不同的消防设施场所、不同的光照条件或其他变化的环境中，该方法都能够提供稳定和可靠的计数结果。4、可扩展性：基于深度学习的方法可以通过增加更多的训练数据和调整网络结构来进行扩展和改进。随着更多数据的积累和算法的不断改进，该方法可以逐步提升性能并适应更广泛的消防设施场景。附图说明图1是本公开一个实施例提供的一种消防设施计数方法的流程图；图2是本公开另一个实施例提供的消防设施计数网络的结构示意图；图3是本公开另一个实施例提供的轻量化多尺度特征融合模块的结构示意图；图4是本公开另一个实施例提供的轻量化细粒度特征分割提取模块的结构示意图。具体实施方式下面将参照附图详细地描述本公开的具体实施例。虽然附图中显示了本公开的具体实施例，然而应当理解，可以通过各种形式实现本公开而不应被这里阐述的实施例所限制。相反，提供这些实施例是为了能够更透彻地理解本公开，并且能够将本公开的范围完整的传达给本领域的技术人员。需要说明的是，在说明书及权利要求当中使用了某些词汇来指称特定组件。本领域技术人员应可以理解，技术人员可能会用不同名词来称呼同一个组件。本说明书及权利要求并不以名词的差异作为区分组件的方式，而是以组件在功能上的差异作为区分的准则。如在通篇说明书及权利要求当中所提及的“包含”或“包括”为一开放式用语，故应解释成“包含但不限定于”。说明书后续描述为实施本公开的较佳实施方式，然所述描述乃以说明书的一般原则为目的，并非用以限定本公开的范围。本公开的保护范围当视所附权利要求所界定者为准。为便于对本公开实施例的理解，下面将结合附图1至图4以具体实施例为例做进一步的解释说明，且各个附图并不构成对本公开实施例的限定。一个实施例中，如图1所示，本公开提出一种消防设施计数方法，包括如下步骤：S100：采集消防设施输入图像；S200：对输入图像预处理；S300：构建消防设施计数模型并训练；S400：将预处理后的输入图像输入训练好的消防设施计数模型中，以实现对输入图像中的消防设施进行计数。另一个实施例中，所述对图像预处理包括以下步骤：S201：对输入图像进行归一化处理，以将输入图像的像素值映射到或的范围内。S202：通过直方图均衡化增强归一化处理后的输入图像的对比度，以使输入图像中的待计数消防设施更加明显，以便于模型识别计数。另一个实施例中，步骤S300中，如图2所示，所述消防设施计数模型包括：轻量化主干网络、注意力机制模块、轻量化多尺度特征融合模块和轻量化细粒度特征提取模块。本实施例中，轻量化主干网络包括卷积层L1至卷积层L5，依次对消防设施输入图像进行二维卷积操作，并最终输出维度为的特征图。尽管主干网络能够提取输入图像中大量丰富的语义特征信息，但是这些语义特征信息往往包含了大量背景信息，因此如何消除特征图中的背景信息对于提升网络整体性能具有重要作用。为了解决这一问题，本公开在主干网络末端引入了通道注意力机制模块CA，以用于捕获主干网络输出的特征图中更多上下文信息和高级语义信息，并且：当特征图中的消防设施分布特别密集的时候，通过通道注意力机制模块CA能够区分不同类型以及不同大小的消防设施的纹理特征，以便于后续模块可通过纹理特征实现对消防设施进行计数。另外，本公开还在通道注意力机制模块CA后引入了空间注意力机制模块SA，空间注意力机制模块SA能够进一步有效地编码空间维度上的长距离依赖，从而能够有效提升模型在空间位置上的对于消防设施的特征提取能力。以上，本公开通过引入通道注意力机制模块CA和空间注意力机制模块SA，能够根据输入的特征图中的上下文信息动态地分配不同特征的重要性权重，使得模型更关注那些对当前任务更有意义和贡献的特征，而忽略那些冗余或无用的特征，一方面能够减少模型对于内存的消耗，另一方面能够提高模型对于输入图像中消防设施的检测和计数效率。此外，膨胀卷积常被用于分割任务，其可以让网络在增加少许参数量和运算量的情况下提取到更深层次的语义信息。在计数网络中，通过多列并行卷积神经网络进行多尺度特征提取已被证明是可行的，然而它的缺点也十分明显，即对于较大尺度的特征图，其需要更大的卷积核来提升感受野，大卷积核带来的是参数量的上升和推理速度的下降。此外，还存在两个缺点：首先，当输出特征图的通道数增加时，特征图的大小减少到输入图像大小的1/8，随着特征图尺度的降低，网络更难捕捉到小目标物体的特征。同时，轻量模型在特征提取方面本身存在着一定限制，这就导致模型对小目标特征的感知能力较弱。针对这一问题，本实施例设计了一种轻量化多尺度特征融合模块，该模块与空间注意力机制模块SA连接，其结构如图3所示。图3中，轻量化多尺度特征融合模块包括一个全局平均池化层和四个膨胀卷积层，且全局平均池化层和四个膨胀卷积层并行设置。全局平均池化层用于对输入特征图Fin进行全局平均池化操作。其中，四个并行的膨胀卷积层包括第一膨胀卷积层Conv3-2、第二膨胀卷积层Conv3-4、第三膨胀卷积层Conv3-8和第四膨胀卷积层Conv3-12，且第一至第四膨胀卷积层具有不同的感受野3-2、3-4、3-8、3-12，所以能够帮助模型更好地学习并提取出特征图中的多尺度信息和高维度特征，同时不需要增加参数量。此外，全局平均池化操作被用于计算各通道输入特征图的所有像素的平均值，然后将计算结果输入到softmax激活函数中，以防止轻量化多尺度特征融合模块在不增加参数的情况下发生过度拟合。需要说明的是，图3中的为Concat操作，其用于实现叠加，/＞表示乘积操作。进一步的，上述四个膨胀卷积层的膨胀率分别为2，4，8，12，每个膨胀卷积层输出的特征图的通道数为输入特征图的1/4，通过操作对四个膨胀卷积层的输出特征图进行叠加，然后将叠加后的特征图输入卷积层Conv进行通道降维。轻量化多尺度特征融合模块的第一个任务是多尺度特征提取，其包含四个分支，具体如下：，表示膨胀率为2的膨胀卷积层的特征提取过程；，表示膨胀率为4的膨胀卷积层的特征提取过程；，表示膨胀率为8的膨胀卷积层的特征提取过程；，表示膨胀率为12的膨胀卷积层的特征提取过程。然后，对四个膨胀卷积层输出的具有不同感受野的特征图和进行操作以获得叠加后的特征图，具体为：操作后获得的特征图输入卷积层Conv中进行特征提取和降维，即可获得融合特征图。通过上述方式，使得模型结构的参数量得到了降低，同时局部信息和全部信息能够充分地保留下来，从而使得模型能够更好地提取出消防设施的关键信息，其公式如下：其中，表示输入特征图，表示卷积操作，GAP表示全局平均池化操作，为维度为C×1×1的权重向量。最后，将权重向量和融合特征图进行相乘，即可最终获得具有不同权重的多尺度的输出特征图Fout，具体计算过程如下：其中，为C×H×W维的输出特征图；表示乘积操作。相比传统的多列卷积，由于轻量化多尺度特征融合模块具有更少的参数量，并且膨胀卷积层能够在不增加参数量的情况下增强网络卷积运算的感受野，因此，轻量化多尺度特征融合模块可以在不增加参数量和运算量的情况下扩大模型的感受野，紧接着对具有不同感受野的特征图进行融合以获得融合特征图。最后，将融合特征图与权重向量相乘获得多尺度特征图，从而提升了模型的检测和计数性能。下面，为了更直观地描述轻量化多尺度特征融合模块的运算过程，本公开对其伪代码进行了示例，具体如表1所示：表1基于膨胀卷积的多尺度特征融合模块伪代码进一步的，在经由轻量化多尺度特征融合模块获得多尺度特征图后，消防设施的特征信息需要进一步从特征图中进行分离。从轻量化多尺度特征融合模块输出的多尺度特征图的尺寸已经减小到输入图像Fin的1/64。受轻量化网络MobileNet的启发，本公开进一步构建了第一轻量化细粒度特征提取模块和第二轻量化细粒度特征提取模块，以对由轻量化多尺度特征融合模块输出的多尺度特征图中的消防设施的特征信息作进一步分离。如图4所示，第一轻量化细粒度特征提取模块和第二轻量化细粒度特征提取模块的结构相同。图4中，表示上采样操作。下面，本实施例就以第一轻量化细粒度特征提取模块为例进行说明，第一轻量化细粒度特征提取模块包括第一分支和第二分支其中，在第一分支上，输入的特征图通过全局平均池化层得到一个的权重向量，该向量具体计算如下：ωp其中，和分别表示特征图的高度和宽度，表示特征图第个通道像素值，并且，和分别表示行和列。权重向量被输入卷积层进行卷积，最后经过非线性激活函数sigmoid得到通道系数，通道系数表示如下：其中，表示sigmoid激活函数，表示卷积。第二分支上，输入的特征图经过卷积层Conv卷积后再通过批归一化层进行批归一化操作获得Xb，可以表示为：。最后将两个分支所输出的结果进行相乘，具体表示为：，其中，表示通道系数和特征图相乘后的结果。紧接着，对和进行操作，表示为如下：其中，表示主干网络中第个卷积层输出的特征图，如图2所示，主干网络中的卷积层L4输出的特征图，即X4与第一轻量化细粒度特征提取模块的输出进行操作。同理，由于第二轻量化细粒度特征提取模块与第一轻量化细粒度特征提取模块的结构相同，因而，二者的原理也相同，此处就不再赘述，但与第一轻量化细粒度特征提取模块不同的是，与第二轻量化细粒度特征提取模块的输出进行操作的是主干网络中的卷积层L3输出的特征图。进一步的，在操作过程中，由于第一轻量化细粒度特征提取模块没有改变特征图的尺度，因此有必要通过上采样操作以扩大第一轻量化细粒度特征提取模块输出的特征图的尺度，具体为：将经一个卷积模块卷积后以降低的通道数，然后进行上采样后作为第二轻量化细粒度特征提取模块的输入，最终获得输出的细粒度特征图Xout。此外，本公开同样对第二轻量化细粒度特征提取模块的输出进行了上采样操作，以扩大第二轻量化细粒度特征提取模块输出的特征图的尺度。与通过大卷积核来减少通道数相比，轻量化细粒度特征提取模块不仅实现了低参数量，同时能够融合全局和局部信息，从而能够提升消防设施计数的准确度，轻量化细粒度特征提取模块的伪代码如表2所示：表2轻量尺度池化模块算法伪代码更进一步的，如图2所示，本实施例还在第二轻量化细粒度特征提取模块后面依次添加了卷积模块、可变卷积模块和卷积模块，通过设置卷积模块以降低第一轻量化细粒度特征提取模块输出的细粒度特征的通道数以及提取更深层次的目标特征。而可变卷积模块主要是在感受野中引入了偏移量，而且偏移量是可学习的，因此可以使得感受野不再只是方形，而是与消防设施的实际形状贴近，这样就使得之后的卷积区域便始终覆盖在物体形状周围，从而可以更好的学习到消防设施的特征。另一个实施例中，步骤S300中，所述消防设施计数模型通过以下步骤进行训练：S301：获取多张包含消防设施的图像，对图像中的消防设施进行标注，以获得标注后的图像数据集，对标注后的图像数据集预处理后划分为训练集和验证集；S302：对模型的权重进行初始化，通过训练集对模型进行训练，在训练过程中，将模型输出与训练集中已标注的消防设施数量进行比较，计算均方误差损失函数并进行反向传播以优化网络权重，使得模型的输出结果与标注的标签的差别在预设的阈值范围内，当损失函数收敛，模型训练完成；示例性的，预设的阈值范围为1。S303：利用验证集对训练后的模型进行验证，将标注数量与模型预测数量输入损失函数以计算两者之间的差距，并根据损失函数进行反向优化。本实施例中，通过利用多张包含消防设施的图像对模型进行训练，使得模型能够学习和捕捉到消防设施的表面特征、颜色特征以及形状特征，当需要对某一输入图像中的消防设施进行计数检测时，该模型即可通过综合识别消防设施的表面特征、颜色特征和形状特征以确定消防设施的位置信息，并通过对以上特征进行积分求和，从而实现对图像中的消防设施进行计数。下面，本公开通过消融实验对本公开所述消防设施计数模型与未引入轻量化多尺度特征融合模块和轻量化细粒度特征提取模块的基础网络、基础网络只引入轻量化多尺度特征融合模块以及基础网络只引入轻量化细粒度特征提取模块的网络进行比对，具体比对结果如表3所示：表3由表3可以看出，本公开所述消防设施计数模型通过在基础网络上同时引入轻量化多尺度特征融合模块和轻量化细粒度特征提取模块，指标MAE和MSE均有显著提升，因而能够证明，本模型通过同时引入轻量化多尺度特征融合模块和轻量化细粒度特征提取模块，能够提高消防设施计数的准确性。另一个实施例中，本公开还提供一种消防设施计数装置，包括：采集模块，用于输入包含消防设施的输入图像；预处理模块，用于对输入图像预处理；训练模块，用于构建消防设施计数模型并训练；所述消防设施计数模型包括轻量化主干网络，轻量化主干网络后依次连接通道注意力机制模块和空间注意力机制模块，其中，通道注意力机制模块用于捕获主干网络输出的特征图中更多上下文信息和高级语义信息，空间注意力机制模块用于编码空间维度上的长距离依赖；计数模块，用于将预处理后的输入图像输入训练好的消防设施计数模型中，以实现对图像中的消防设施进行计数。另一个实施例中，所述预处理模块包括：归一化子模块，用于对输入图像进行归一化处理；增强子模块，用于对归一化处理后的输入图像进行对比度增强。另一个实施例中，所述训练模块包括：获取子模块，用于获取多张包含消防设施的输入图像数据集；标注子模块，用于对输入图像中的消防设施进行标注；划分子模块，用于将标注后的输入图像数据集划分为训练集和测试集；训练子模块，用于通过训练集对消防设施计数模型进行训练；测试子模块，用于通过测试集对训练后的消防设施计数模型进行测试。另一个实施例中，本公开还提供一种电子设备，包括：存储器，处理器及存储在存储器上并可在处理器上运行的计算机程序，其中，所述处理器执行所述程序时实现如前任一所述的方法。另一个实施例中，本公开还提供一种计算机存储介质，所述计算机存储介质存储有计算机可执行指令，所述计算机可执行指令用于执行如前任一所述的方法。以上所述仅为本发明的较佳实例而已，并不用以限制本发明，凡在本发明的精神和原则之内所作的任何修改、等同替换和改进等，均应包含在本发明的保护范围之内。
