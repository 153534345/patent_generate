标题title
基于视频的河流流量流速监测方法及系统
摘要abst
本发明涉及视频测量学技术领域，具体涉及基于视频的河流流量流速监测方法及系统，采集河流视频数据中测量点的局部河流表面流速，获取河流表面流速序列；获取水深数据，根据水深数据绘制河流横截断面；获取河流横截断面上的样本点和河床线；根据样本点到河床线的距离获取流速衰减因子，进而结合河流表面流速序列获得预估流速；根据测量点到河床线的距离及局部河流表面流速获得样本点的预测流速；根据预估流速和预测流速获得置信预测流速，进而结合预估流速获得样本点的修正流速；根据样本点的修正流速获得河流横截断面的河流流量及河流平均流速。本发明解决了现有的河流流量流速监测方法存在较大误差的问题。
权利要求书clms
1.基于视频的河流流量流速监测方法，其特征在于，包括：采集河流视频数据中测量点的局部河流表面流速，获取河流表面流速序列；连接测量点，获得测量线；采集测量线上所有点处的水深，获取水深数据，根据水深数据绘制河流横截断面；获取河流横截断面上的样本点和河床线；根据样本点到河床线的距离获取样本点的流速衰减因子；根据河流表面流速序列获取最大测量流速，进而结合流速衰减因子获得样本点的预估流速；根据测量点到河床线的距离以及局部河流表面流速获得流速预测模型，进而获得样本点的预测流速；根据预估流速和预测流速获取河流流速预测置信系数；根据流速预测模型获得测量点的预测流速，进而结合局部河流表面流速及河流流速预测置信系数获得流速综合置信系数；根据流速综合置信系数获得样本点的置信预测流速，进而结合预估流速获得样本点的修正流速；连接相邻的样本点获得闭合区域；根据闭合区域边缘上所有样本点的修正流速获得区域平均流速，进而获得河流横截断面的河流流量及河流平均流速。2.根据权利要求1所述的基于视频的河流流量流速监测方法，其特征在于，所述获取河流横截断面上的样本点和河床线，包括的具体方法为：以预设长度和预设宽度为间隔在河流横截断面上设置样本点；将河流横截断面的底部边缘线记为河床线。3.根据权利要求1所述的基于视频的河流流量流速监测方法，其特征在于，所述根据样本点到河床线的距离获取样本点的流速衰减因子，包括的具体方法为：将样本点到河床线的水平距离的最小值记为样本点的最近水平距离；将样本点到河床线的垂直距离记为样本点的垂直距离；将所有样本点的最近水平距离的最大值记为最大水平距离；将所有样本点的垂直距离的最大值记为最大垂直距离；将样本点的最近水平距离与垂直距离的乘积记为样本点的综合距离；将最大水平距离与最大垂直距离的乘积记为最大距离值；将样本点的综合距离与最大距离值的比值记为样本点的流速影响因子；将以自然常数为底数，流速影响因子的相反数为指数的幂记为样本点的流速衰减因子。4.根据权利要求1所述的基于视频的河流流量流速监测方法，其特征在于，所述根据河流表面流速序列获取最大测量流速，进而结合流速衰减因子获得样本点的预估流速，包括的具体方法为：将河流表面流速序列中的最大元素值记为最大测量流速；将样本点的流速衰减因子与最大测量流速的乘积记为样本点的预估流速。5.根据权利要求3所述的基于视频的河流流量流速监测方法，其特征在于，所述根据测量点到河床线的距离以及局部河流表面流速获得流速预测模型，进而获得样本点的预测流速，包括的具体方法为：获取测量点的垂直距离和最近水平距离；将垂直距离和最近水平距离作为特征值，测量点的局部河流表面流速作为训练集，训练基于邻近点的机器学习模型，获得流速预测模型；根据样本点的垂直距离和最近水平距离，使用流速预测模型获得样本点的预测流速。6.根据权利要求1所述的基于视频的河流流量流速监测方法，其特征在于，所述根据预估流速和预测流速获取河流流速预测置信系数，包括的具体方法为：将样本点的预测流速与预估流速的差值的绝对值记为样本点的流速预测差异；将样本点的流速预测差异与预设数值之和的倒数记为样本点的河流流速预测置信系数。7.根据权利要求5所述的基于视频的河流流量流速监测方法，其特征在于，所述根据流速预测模型获得测量点的预测流速，进而结合局部河流表面流速及河流流速预测置信系数获得流速综合置信系数，包括的具体方法为：分别将每个样本点记为待分析样本点；将训练集中距离待分析样本点最近的预设数量个测量点记为待分析样本点的邻域样本点；分别将待分析样本点的每个邻域样本点记为待分析邻域点；将待分析样本点加入训练集，训练基于邻近点的机器学习模型，获得置信流速预测模型；根据待分析邻域点的特征值，使用置信流速预测模型获得待分析邻域点的模型预测流速；将待分析邻域点的局部河流表面流速与预测流速的差值的平方记为待分析邻域点的预测流速差；将待分析邻域点的局部河流表面流速与模型预测流速的差值的平方记为待分析邻域点的模型预测流速差；将待分析邻域点的预测流速差与模型预测流速差的差值记为待分析邻域点的预测流速置信程度；将所有待分析邻域点的预测流速置信程度的均值记为待分析样本点的模型预测置信度；将待分析样本点的模型预测置信度与河流流速预测置信系数之和记为待分析样本点的流速置信度；将待分析样本点的流速置信度的归一化值记为待分析样本点的流速综合置信系数。8.根据权利要求1所述的基于视频的河流流量流速监测方法，其特征在于，所述根据流速综合置信系数获得样本点的置信预测流速，进而结合预估流速获得样本点的修正流速，包括的具体方法为：将流速综合置信系数作为半监督学习协同回归算法的置信度，使用半监督学习协同回归算法获得每个样本点的置信预测流速；将流速综合置信系数记为样本点的置信预测流速的权重，将数字1与流速综合置信系数的差值记为样本点的预估流速的权重；将样本点的预估流速与置信预测流速的加权平均值记为样本点的修正流速。9.根据权利要求2所述的基于视频的河流流量流速监测方法，其特征在于，所述根据闭合区域边缘上所有样本点的修正流速获得区域平均流速，进而获得河流横截断面的河流流量及河流平均流速，包括的具体方法为：分别将每个闭合区域记为待分析区域；将待分析区域边缘上所有样本点的修正流速的均值记为待分析区域的区域平均流速；将所述预设宽度与预设长度乘积记为待分析区域的面积；将待分析区域的面积与区域平均流速的乘积记为待分析区域的局部流量；将所有闭合区域的局部流量之和记为河流横截断面的河流流量；将所有闭合区域的面积之和记为河流横截断面面积；将河流横截断面的河流流量与河流横截断面面积的比值作为河流平均流速。10.基于视频的河流流量流速监测系统，包括存储器、处理器以及存储在所述存储器中并在所述处理器上运行的计算机程序，其特征在于，所述处理器执行所述计算机程序时实现如权利要求1-9任意一项所述方法的步骤。
说明书desc
技术领域本发明涉及视频测量学技术领域，具体涉及基于视频的河流流量流速监测方法及系统。背景技术河流是自古以来就是人类活动中的重要组成部分，在城市的运行中也承担着重要的角色，随着经济的快速发展，准确测量水资源，合理分配水域资源是现代社会的重要议题。检测河流的流量流速是水资源管理和水文研究的任务之一，常用来监测河流流速的装置有电波雷达流速仪，流速测量器，声学多普勒流速剖面仪等。此外，还用更传统的浮标法和漂浮物法，原理为观测物体在水面上移动的距离和时间来计算水流流速。河流的流量等于平均流速乘以横截面积，在已知横截面积的情况下可简单的估算出河流的流量。河流的流量监测在水资源的管理，洪水预警，生态保护和能源利用方面都发挥着重要作用。综上所述，传统的河流流速测量方法需要采用流速仪或漂流物等设备，往往需要人工干预或在特定的位置放置监测装置。而河流的流速在截面处整体分布不均匀，河流中间区域流速大，越靠近岸边的水流流速越小，单一位置的流速难以代表河流的整个截面的平均流速。因此，现有的通过单一位置监测河流流量流速的方法存在较大误差。发明内容本发明提供基于视频的河流流量流速监测方法及系统，以解决现有的河流流量流速监测方法存在较大误差的问题。第一方面，本发明一个实施例提供了基于视频的河流流量流速监测方法，该方法包括以下步骤：采集河流视频数据中测量点的局部河流表面流速，获取河流表面流速序列；连接测量点，获得测量线；采集测量线上所有点处的水深，获取水深数据，根据水深数据绘制河流横截断面；获取河流横截断面上的样本点和河床线；根据样本点到河床线的距离获取样本点的流速衰减因子；根据河流表面流速序列获取最大测量流速，进而结合流速衰减因子获得样本点的预估流速；根据测量点到河床线的距离以及局部河流表面流速获得流速预测模型，进而获得样本点的预测流速；根据预估流速和预测流速获取河流流速预测置信系数；根据流速预测模型获得测量点的预测流速，进而结合局部河流表面流速及河流流速预测置信系数获得流速综合置信系数；根据流速综合置信系数获得样本点的置信预测流速，进而结合预估流速获得样本点的修正流速；连接相邻的样本点获得闭合区域；根据闭合区域边缘上所有样本点的修正流速获得区域平均流速，进而获得河流横截断面的河流流量及河流平均流速。进一步，所述获取河流横截断面上的样本点和河床线，包括的具体方法为：以预设长度和预设宽度为间隔在河流横截断面上设置样本点；将河流横截断面的底部边缘线记为河床线。进一步，所述根据样本点到河床线的距离获取样本点的流速衰减因子，包括的具体方法为：将样本点到河床线的水平距离的最小值记为样本点的最近水平距离；将样本点到河床线的垂直距离记为样本点的垂直距离；将所有样本点的最近水平距离的最大值记为最大水平距离；将所有样本点的垂直距离的最大值记为最大垂直距离；将样本点的最近水平距离与垂直距离的乘积记为样本点的综合距离；将最大水平距离与最大垂直距离的乘积记为最大距离值；将样本点的综合距离与最大距离值的比值记为样本点的流速影响因子；将以自然常数为底数，流速影响因子的相反数为指数的幂记为样本点的流速衰减因子。进一步，所述根据河流表面流速序列获取最大测量流速，进而结合流速衰减因子获得样本点的预估流速，包括的具体方法为：将河流表面流速序列中的最大元素值记为最大测量流速；将样本点的流速衰减因子与最大测量流速的乘积记为样本点的预估流速。进一步，所述根据测量点到河床线的距离以及局部河流表面流速获得流速预测模型，进而获得样本点的预测流速，包括的具体方法为：获取测量点的垂直距离和最近水平距离；将垂直距离和最近水平距离作为特征值，测量点的局部河流表面流速作为训练集，训练基于邻近点的机器学习模型，获得流速预测模型；根据样本点的垂直距离和最近水平距离，使用流速预测模型获得样本点的预测流速。进一步，所述根据预估流速和预测流速获取河流流速预测置信系数，包括的具体方法为：将样本点的预测流速与预估流速的差值的绝对值记为样本点的流速预测差异；将样本点的流速预测差异与预设数值之和的倒数记为样本点的河流流速预测置信系数。进一步，所述根据流速预测模型获得测量点的预测流速，进而结合局部河流表面流速及河流流速预测置信系数获得流速综合置信系数，包括的具体方法为：分别将每个样本点记为待分析样本点；将训练集中距离待分析样本点最近的预设数量个测量点记为待分析样本点的邻域样本点；分别将待分析样本点的每个邻域样本点记为待分析邻域点；将待分析样本点加入训练集，训练基于邻近点的机器学习模型，获得置信流速预测模型；根据待分析邻域点的特征值，使用置信流速预测模型获得待分析邻域点的模型预测流速；将待分析邻域点的局部河流表面流速与预测流速的差值的平方记为待分析邻域点的预测流速差；将待分析邻域点的局部河流表面流速与模型预测流速的差值的平方记为待分析邻域点的模型预测流速差；将待分析邻域点的预测流速差与模型预测流速差的差值记为待分析邻域点的预测流速置信程度；将所有待分析邻域点的预测流速置信程度的均值记为待分析样本点的模型预测置信度；将待分析样本点的模型预测置信度与河流流速预测置信系数之和记为待分析样本点的流速置信度；将待分析样本点的流速置信度的归一化值记为待分析样本点的流速综合置信系数。进一步，所述根据流速综合置信系数获得样本点的置信预测流速，进而结合预估流速获得样本点的修正流速，包括的具体方法为：将流速综合置信系数作为半监督学习协同回归算法的置信度，使用半监督学习协同回归算法获得每个样本点的置信预测流速；将流速综合置信系数记为样本点的置信预测流速的权重，将数字1与流速综合置信系数的差值记为样本点的预估流速的权重；将样本点的预估流速与置信预测流速的加权平均值记为样本点的修正流速。进一步，所述根据闭合区域边缘上所有样本点的修正流速获得区域平均流速，进而获得河流横截断面的河流流量及河流平均流速，包括的具体方法为：分别将每个闭合区域记为待分析区域；将待分析区域边缘上所有样本点的修正流速的均值记为待分析区域的区域平均流速；将所述预设宽度与预设长度乘积记为待分析区域的面积；将待分析区域的面积与区域平均流速的乘积记为待分析区域的局部流量；将所有闭合区域的局部流量之和记为河流横截断面的河流流量；将所有闭合区域的面积之和记为河流横截断面面积；将河流横截断面的河流流量与河流横截断面面积的比值作为河流平均流速。第二方面，本发明实施例还提供了基于视频的河流流量流速监测系统，包括存储器、处理器以及存储在所述存储器中并在所述处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现上述任意一项所述方法的步骤。本发明的有益效果是：本发明分析了河流流动时河流不同位置的流速受到河床阻碍的程度不同的情况，通过绘制河流横截断面，设置样本点，根据样本点的空间位置构建流速衰减因子，进而得到预估流速，考虑了河床的摩擦力对不同位置样本点的流速的影响；根据样本点的空间位置，使用基于邻近点的机器学习方法获取样本点的预测流速，考虑了样本点的空间位置对样本点处的河流流速的影响；通过分析预估流速和预测流速的差值对预测结果可信度的影响，根据预估流速和预测流速修改COREG算法中的置信参数，获得样本点的流速综合置信系数，进而获得样本点的修正流速，提高了样本点处河流流速预测的准确性；最后，通过所有样本点的修正流速计算河流横截断面的河流流量以及河流平均流速，解决了现有的通过单一位置监测河流流量流速的方法存在较大误差的问题。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其他的附图。图1为本发明的基于视频的河流流量流速监测方法的实施例的流程图；图2为抛射装置的示意图；图3为无人机航线示意图；图4为河流横截断面的示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。本发明的基于视频的河流流量流速监测方法的实施例，如图1所示，包括：步骤S1、使用无人机采集河流的视频数据，获取测量点的局部河流表面流速，进而得到河流表面流速序列。如图2所示，将搭载高分辨率CCD数码相机的无人机悬停于靠近岸边河流正上方固定高度处，经验取值为10米，此时无人机能观测到的长度为/＞，宽度为/＞的视野区域。图中矩形框为在无人机上游一端放置可抛射漂浮物的抛射装置，漂浮物要求颜色鲜艳，与水体环境有较大的差别。首先往河流上游方向抛射漂浮物，同时无人机开始记录河流信息。如图3所示，待漂浮物飘出无人机视野范围后停止摄像，然后朝河流对岸方向前进/＞再次悬停。继续上述操作，直到无人机到达河流对岸，共测量得到了/＞个视频数据。首先使用LabelImg标注工具，标注漂浮物来制作训练集。使用制作好的训练集训练YOLO网络，并保存训练好的模型。对采集得到的个视频数据，分别执行YOLO目标检测算法，检测视频中的漂浮物。当视频中首次检测到漂浮物时，记录时间为/＞，标记漂浮物与视野区域的交点/＞；漂浮物飘出视野，即当前帧刚好检测不到漂浮物时记录时间为/＞，标记漂浮物与视野区域的交点/＞；将/＞与/＞之间的欧式距离记为漂浮距离/＞，漂浮物出现时段长度为/＞。将每个视频的中心点记为测量点，第/＞个视频测得的第/＞个测量点的局部河流表面流速/＞为漂浮距离与漂浮物出现时段长度的比值。共获取/＞个视频测得的/＞个测量点的局部河流表面流速，得到河流表面流速序列/＞。至此，获得测量点的局部河流表面流速及河流表面流速序列。步骤S2、设置样本点，根据样本点与河床的距离获取流速衰减因子，分别通过流速衰减因子与河流表面流速序列获取样本点的预估流速和预测流速。由于河水流动的动力学性质和地质地貌的影响，河床河岸存在着对水流的摩擦力，即对水流的速度有阻碍的作用，因此，离岸边越近的地方其流速就越小，在河流的中心区域河流的流速大。一般而言，河流流速也受到水深的影响，深度较大导致水流的通道较宽，较宽的水流通道会产生较少的水流阻力。考虑到上述因素的影响，如图4所示，连接测量点获得测量线，本发明使用声纳测深仪，测量测量线处河流横截断面的水深，获取水深数据并描绘出河流横截断面，河流横截断面的底部边缘线为河床线。并以的距离为间隔在河流横截断面设置样本点，图中每个虚线交界处为一个样本点，共获得/＞个样本点。将样本点/＞到河床两侧的水平距离的最小值记为样本点/＞的最近水平距离/＞，将样本点/＞到河床的垂直距离记为样本点/＞的垂直距离/＞。将所有样本点的最近水平距离的最大值记为最大水平距离/＞，将所有样本点到河床的垂直距离的最大值记为最大垂直距离/＞。根据河流断面中的每个样本点所在的空间位置，构建流速衰减因子/＞，其中，样本点/＞处的流速衰减因子/＞，计算公式如下：式中，为河流横截断面中样本点/＞处的流速衰减因子；/＞代表样本点/＞的垂直距离；/＞表示样本点/＞的最近水平距离；/＞为自然常数；/＞为最大垂直距离；/＞为最大水平距离。离河床的水平距离与垂直距离越远的样本点其流速衰减因子就越小，说明流速减小的少，则流速衰减因子越小；而离河床的水平距离与垂直距离越近的样本点其流速衰减因子越大，流速减小的程度大。往往流速最大的地方也是离岸边和河床最远的地方。河床河岸存在着对水流的摩擦力，即对水流的速度有阻碍的作用，因此离岸边越近的地方其流速就越小，在河流的中心区域河流的流速大。基于上述分析，获得的河流表面流速序列中，每个元素代表了一个局部区域的河流表面流速，局部区域的河流表面流速之间存在差异的主要原因为河床河岸对水流的阻碍作用，并基于上述原因构建了流速衰减因子。在本实施例中将河流表面流速序列中的最大元素值作为受到阻碍作用最小的最大测量流速，进而根据流速衰减因子估算所有样本点处的预估流速，将河流表面流速序列中的最大元素值记为最大测量流速/＞，样本点/＞处的预估流速/＞表示为样本点/＞处的流速衰减因子/＞与最大测量流速/＞的乘积。获取所有测量点的垂直距离和最近水平距离，将垂直距离和最近水平距离作为特征值，测量点的局部河流表面流速作为训练集称为标注数据，使用/＞训练基于邻近点的机器学习模型KNN回归器，获得训练好的模型，将训练好的模型记为流速预测模型/＞，其中，/＞表示使用流速预测模型/＞得到的样本点/＞的预测流速。使用流速预测模型，根据样本点的特征值预测所有样本点处的预测流速。KNN回归器算法模型，通过/＞个最近邻样本来预测新样本的回归值，在本发明中设置/＞=4，即每个样本点有4个邻近样本点，通常认为某点的流速受到其上下左右四邻域的影响最大，KNN算法为公知技术，具体不再赘述。至此，获得样本点的预估流速和预测流速。步骤S3、根据预估流速和预测流速修改COREG算法中的置信参数，构建流速置信度，获得每个样本点的流速综合置信系数，进而获得样本点的修正流速。由于使用半监督学习协同回归算法COREG对样本点的流速进行预测时，COREG算法中的置信度较难确定，本发明通过上述两种方法分别获取的样本点的预估速度和预测速度修改COREG算法中的置信参数。首先可根据预估流速获取样本点/＞的河流流速预测置信系数/＞：式中，为样本点/＞的河流流速预测置信系数；/＞为使用流速预测模型得到的样本点/＞的预测流速；/＞为样本点/＞处的预估流速；/＞为极小的常数值，经验取值为0.005，防止分母零的情况，同时也限定了置信系数的最大值。当本文所述的两种方法估算的流速越相近，该点的流速置信系数就越大，可信度就越高。半监督学习协同回归算法COREG中协同训练需要不断将置信度最高的样本加入回归器的训练集重新训练，直到满足终止条件，本发明的终止条件为将所有样本点全部加入训练集。为提高流速预测的准确性，本发明通过分析样本加入前后对样本邻近点的预测结果的影响，进一步选择加入训练集的样本点。其中初始训练集中为测量点，则样本点的邻近样本点均为测量点。因此，根据样本点加入前后的流速预测结果，获取样本点/＞的流速置信度/＞：式中，为样本点/＞的流速置信度；/＞为样本点/＞在标注数据/＞中的邻近样本点数量；/＞为流速预测模型；/＞为使用流速预测模型得到的样本点/＞的第/＞个邻近样本点的预测流速；/＞为样本点/＞的第/＞个邻近样本点的局部河流表面流速；/＞为将样本点/＞加入训练集后获得的流速预测模型；/＞为使用/＞得到的样本点/＞的第/＞个邻近样本点的预测流速；/＞为样本点/＞的河流流速预测置信系数。若将样本点加入到训练集之前与加入到训练集之后，使用流速预测模型计算出的邻近样本点的预测流速与测量得到的局部河流表面流速的差值相差越小，说明将样本点加入到训练集之后对邻近样本点的预测流速的影响程度越小，则流速置信度越大，表示加入样本点/＞至训练集的收益越大，预测的结果越可信。将样本点的流速置信度的归一化值记为样本点/＞的流速综合置信系数/＞，获取所有样本点的流速综合置信系数，将流速综合置信系数最大的样本点加入训练集。使用改进的COREG算法得到每个样本点的置信预测流速，将样本点/＞的置信预测流速记为/＞。定义样本点的修正流速/＞为：其中，为样本点/＞的修正流速；/＞为样本点/＞的流速综合置信系数；/＞是通过流速衰减因子计算的样本点/＞处的预估流速，/＞是使用半监督学习协同回归算法COREG得到的样本点/＞的置信预测流速。样本点的流速综合置信系数越高，其预测流速在修正流速中的权重就越大，预估流速在修正流速中的权重就越小。至此，获得样本点的修正流速。步骤S4、根据样本点的修正流速获得河流横截断面的河流流量，进而得到河流平均流速。将所有相邻的样本点进行连接，此时河流横截断面被划分为个闭合区域，将第/＞个闭合区域/＞的边缘上所有样本点的修正流速的均值记为区域平均流速/＞，/＞的取值范围为1到/＞之间的整数。进一步，根据区域平均流速计算河流横截断面的河流流量，单位为/＞，河流横截断面的河流流量/＞的计算公式如下：式中，为河流横截断面的河流流量；/＞为样本点的采样间隔，即闭合区域的面积；/＞为闭合区域的数量；/＞为河流横截断面上第/＞个闭合区域/＞的区域平均流速。将所有闭合区域的面积之和记为河流横截断面的面积，进而将河流横截断面的河流流量与面积的比值作为河流平均流速，单位为。至此，获得河流横截断面的河流流量与河流平均流速。基于与上述方法相同的发明构思，本发明实施例还提供了基于视频的河流流量流速监测系统，包括存储器、处理器以及存储在所述存储器中并在所述处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现上述基于视频的河流流量流速监测方法中任意一项所述方法的步骤。以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
