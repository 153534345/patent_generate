标题title
一种基于注意力机制优化的大规模果园虫情监测方法
摘要abst
本发明公开了一种基于注意力机制优化的大规模果园虫情监测方法，包括以下步骤：S1.采集昆虫图片数据，并进行筛选，对筛选后的昆虫图片数据进行预处理和标注，形成果园昆虫数据集；S2.将处理后的数据集根据是否标注进行分类，得到标注数据集和未标注数据集；S3.构建学生网络和教师网络；S4.利用标注数据集中的数据对学生网络进行训练，得到训练好的学生网络；S5.将未标注数据集中的数据输入训练好的学生网络中，利用训练好的学生网络的输出作为伪标签，对输入数据进行标记；S6.利用未标注数据集中的数据和伪标签，对教师网络进行训练，得到训练好的教师网络。本发明能对农业园区虫情实时监测，为种植户提供准确昆虫类别识别结果。
权利要求书clms
1.一种基于注意力机制优化的大规模果园虫情监测方法，其特征在于：包括以下步骤：S1.采集昆虫图片数据，并进行筛选，对筛选后的昆虫图片数据进行预处理和标注，形成果园昆虫数据集；S2.将处理后的数据集根据是否标注进行分类，得到标注数据集和未标注数据集；S3.构建学生网络和教师网络；S4.利用标注数据集中的数据对学生网络进行训练，得到训练好的学生网络；S5.将未标注数据集中的数据输入训练好的学生网络中，利用训练好的学生网络的输出作为伪标签，对未标注数据集中的数据进行标记；S6.利用未标注数据集中的数据和对应的伪标签，对教师网络进行训练，得到训练好的教师网络。2.根据权利要求1所述的一种基于注意力机制优化的大规模果园虫情监测方法，其特征在于：所述步骤S1包括：S101.设定需要监测的若干个昆虫类别；S102.对于每一个昆虫类别，通过在搜索网站、农业网站进行网络爬取获取昆虫图片数据；然后从爬取的昆虫图片数据中，筛选出错误的图片进行剔除；所述错误的图片包括模糊、损坏或与昆虫无关、或不在设定类别的图片；得到各个昆虫类别的筛选后的图片数据；S103.对于任一个昆虫类别筛选后的图片数据进行预处理：首先应用Mosaic数据增强的方法对该昆虫类别筛选后的图片数据进行增强处理；然后随机抽取百分之十的图片采用Cutout算法进行处理，随机裁剪掉图像中的一块正方形区域，并在原图中补0，模拟真实场景下一些昆虫被叶片或其他物体遮挡部分轮廓时的情况，防止网络只关注显著的图像区域而发生过拟合；S104.对于每一个昆虫类别的图片，重复执行步骤S103，完成所有昆虫类别的图片数据预处理；S105.对于每一个昆虫类别，在图片预处理完成后，随机抽取其中10%的昆虫图片按照类别进行标注；然后将所有昆虫类别标注和未标注的图片均加入到同一个果园昆虫数据集中，果园昆虫数据集搭建完成。3.根据权利要求1所述的一种基于注意力机制优化的大规模果园虫情监测方法，其特征在于：所述步骤S2包括：将果园昆虫数据集中带有昆虫类别标注的图片加入到标注数据集中；将果园昆虫数据集中不带有昆虫类别标注的图片加入到未标注数据集中，完成数据集的分类。4.根据权利要求1所述的一种基于注意力机制优化的大规模果园虫情监测方法，其特征在于：所述步骤S3中，学生网络和教师网络均初始网络架构相同，均采用改进的YOLOv5检测器。5.根据权利要求4所述的一种基于注意力机制优化的大规模果园虫情监测方法，其特征在于：所述改进的YOLOv5检测器的获取方式如下：A1、YOLOv5检测器包括检测器输入端、主干网络、颈部网络、头部网络和检测器输出端；A2、将YOLOv5检测器的主干网络替换为轻量化网络Mobileone，并在轻量化网络Mobileone之间与YOLOv5检测器的输入端之间加入m个依次连接的SAC3模块：其中，SAC3模块通过在YOLOv5检测器的C3模块中添加注意力机制和Conv模块得到：C3模块包括全连接层和2个Conv模块，C3模块的输入端分别通过2个Conv模块与全连接层相连，全连接层与C3模块的输出端连接；加入注意力机制时，在任一个Conv模块与全连接层之间加入注意力机制模块shuffleattention，并在全连接层与C3模块的输出端之间再加入一个Conv模块；A3、对每一个SAC3模块引入残差模块进行处理，即将SAC3模块的输入和输出送入Mish激活函数进行处理，然后将Mish激活函数的输出作为下一级的输入；A4、在主干网络和头部网络之间加入小目标检测层；所述小目标检测层包括两个SAC3模块、两个contact层和两个Conv模块，第一个SAC3模块连接主干网络的输出，并通过第一个Conv模块和第一个contact层连接到第二个SAC3模块，第二个SAC3模块连接头部网络；第二个SAC3模块连接到第二个Conv模块，第一个Conv模块和第二个Conv模块均连接到第二个contact层，第二个contact层与颈部网络连接；A5、对YOLOv5检测器进行A2~A4的处理后即得到了改进的YOLOv5检测器。6.根据权利要求1所述的一种基于注意力机制优化的大规模果园虫情监测方法，其特征在于：所述方法还包括：利用训练好的教师网络进行果园图片中昆虫类别的识别，从而完成虫情监测。
说明书desc
技术领域本发明涉及虫情监测，特别是涉及一种基于注意力机制优化的大规模果园虫情监测方法。背景技术虫情——农业“四情”之一。因为在农业生产过程中种植者难免会和各种各样的害虫或益虫打交道，所以农业虫情的意义便在于对农业区各类昆虫潜伏、发生和活动的情况进行掌握。对农业虫情的监测可具体分为针对害虫和益虫。害虫的种类不同，生长时间和生长环境也不同，农作物生长到收获的整个过程，都会一直受到害虫的威胁。益虫在农作物的种植生产中也扮演着至关重要的作用。益虫具有捕食害虫的针对农作物害虫的生物防治功能，如蜻蜓、螳螂、瓢虫、赤眼蜂等能消灭害虫，以虫治虫；益虫的筑穴、授粉行为能促进农作物的生长发育，改善农作物生长环境，如蚯蚓将枯草败叶、生物粪便等作为食物，它们吃掉生活垃圾等废物后，排出的粪便成为土壤中的肥料；益虫种群的行动迁移轨迹也能间接 反映农业区的环境情况。益虫在改善作物生产，维护粮食安全乃至稳定农业区生态系统中 也起到至关重要的作用，因此对虫情进行监测十分重要。发明内容本发明的目的在于克服现有技术的不足，提供一种基于注意力机制优化的大规模果园虫情监测方法，能对农业园区虫情实时监测，提供准确昆虫类别识别结果。本发明的目的是通过以下技术方案来实现的：一种基于注意力机制优化的大规模果园虫情监测方法，包括以下步骤：S1.采集昆虫图片数据，并进行筛选，对筛选后的昆虫图片数据进行预处理和标注，形成果园昆虫数据集；S2.将处理后的数据集根据是否标注进行分类，得到标注数据集和未标注数据集；S3.构建学生网络和教师网络；S4.利用标注数据集中的数据对学生网络进行训练，得到训练好的学生网络；S5.将未标注数据集中的数据输入训练好的学生网络中，利用训练好的学生网络的输出作为伪标签，对未标注数据集中的数据进行标记；S6.利用未标注数据集中的数据和对应的伪标签，对教师网络进行训练，得到训练好的教师网络。进一步地，所述步骤S1包括：S101.设定需要监测的若干个昆虫类别；S102.对于每一个昆虫类别，通过在搜索网站、农业网站进行网络爬取获取昆虫图片数据；然后从爬取的昆虫图片数据中，筛选出错误的图片进行剔除；所述错误的图片包括模糊、损坏或与昆虫无关、或不在设定类别的图片；得到各个昆虫类别的筛选后的图片数据；S103.对于任一个昆虫类别筛选后的图片数据进行预处理：首先应用Mosaic数据增强的方法对该昆虫类别筛选后的图片数据进行增强处理；然后随机抽取百分之十的图片采用Cutout算法进行处理，随机裁剪掉图像中的一块正方形区域，并在原图中补0，模拟真实场景下一些昆虫被叶片或其他物体遮挡部分轮廓时的情况，防止网络只关注显著的图像区域而发生过拟合；S104.对于每一个昆虫类别的图片，重复执行步骤S103，完成所有昆虫类别的图片数据预处理；S105.对于每一个昆虫类别，在图片预处理完成后，随机抽取其中10%的昆虫图片按照类别进行标注；然后将所有昆虫类别标注和未标注的图片均加入到同一个果园昆虫数据集中，果园昆虫数据集搭建完成。进一步地，所述步骤S2包括：将果园昆虫数据集中带有昆虫类别标注的图片加入到标注数据集中；将果园昆虫数据集中不带有昆虫类别标注的图片加入到未标注数据集中，完成数据集的分类。进一步地，所述步骤S3中，学生网络和教师网络均初始网络架构相同，均采用改进的YOLOv5检测器。进一步地，所述改进的YOLOv5检测器的获取方式如下：A1、YOLOv5检测器包括检测器输入端、主干网络、颈部网络、头部网络和检测器输出端；A2、将YOLOv5检测器的主干网络替换为轻量化网络Mobileone，并在轻量化网络Mobileone之间与YOLOv5检测器的输入端之间加入m个依次连接的SAC3模块：其中，SAC3模块通过在YOLOv5检测器的C3模块中添加注意力机制和Conv模块得到：C3模块包括全连接层和2个Conv模块，C3模块的输入端分别通过2个Conv模块与全连接层相连，全连接层与C3模块的输出端连接；加入注意力机制时，在任一个Conv模块与全连接层之间加入注意力机制模块shuffleattention，并在全连接层与C3模块的输出端之间再加入一个Conv模块；A3、对每一个SAC3模块引入残差模块进行处理，即将SAC3模块的输入和输出送入Mish激活函数进行处理，然后将Mish激活函数的输出作为下一级的输入；A4、在主干网络和头部网络之间加入小目标检测层；所述小目标检测层包括两个SAC3模块、两个contact层和两个Conv模块，第一个SAC3模块连接主干网络的输出，并通过第一个Conv模块和第一个contact层连接到第二个SAC3模块，第二个SAC3模块连接头部网络；第二个SAC3模块连接到第二个Conv模块，第一个Conv模块和第二个Conv模块均连接到第二个contact层，第二个contact层与颈部网络连接；A5、对YOLOv5检测器进行A2~A4的处理后即得到了改进的YOLOv5检测器。进一步地，所述方法还包括：利用训练好的教师网络进行果园图片中昆虫类别的识别，从而完成虫情监测。本发明的有益效果是：本发明能对农业园区虫情实时监测，为种植户提供准确昆虫类别识别结果，有助于种植户及时进行处理，提高了农业生产过程的效率。附图说明图1为本发明的原理示意图。具体实施方式下面结合附图进一步详细描述本发明的技术方案，但本发明的保护范围不局限于以下所述。如图1所示，种基于注意力机制优化的大规模果园虫情监测方法，包括以下步骤：S1.采集昆虫图片数据，并进行筛选，对筛选后的昆虫图片数据进行预处理和标注，形成果园昆虫数据集；利用互联网作为图像的主要来源，大部分果园昆虫图片为网上爬取。首先在收集过程中，我们应用了如谷歌、百度、必应等常见的图像搜索引擎，以果园中常见昆虫为关键字进行图片爬取，同时我们也在专业的农业网站上收集相应的昆虫图片。其次，为了补充每一类别的昆虫图片，我们还应用了目前现存开源的昆虫数据集，采用了部分与我们所需要的类别相同的昆虫图片作为我们自制果园昆虫数据集的补充，大大丰富了我们自制数据集的容量。在本申请的实施例中，供获取了45个类别共计200000余张相关昆虫图片，结合昆虫知识筛选出了模糊，损坏，无关的图片，最后保留有58000张图片。对于每一个昆虫类别筛选后的图片数据进行预处理：首先应用Mosaic数据增强的方法对该昆虫类别筛选后的图片数据进行增强处理；然后对于每一个昆虫类别，随机抽取百分之十的图片采用Cutout算法进行处理，随机裁剪掉图像中的一块正方形区域，并在原图中补0，拟真实场景下一些昆虫被叶片或其他物体遮挡部分轮廓时的情况，防止网络只关注显著的图像区域而发生过拟合；在每个类别中随机抽取10%的昆虫图片使用LabelImg用矩形框对昆虫按照种类进行标注，种类保留梨蚜，苹果小吉丁等45种果园常见昆虫。在标注过程中，采用了标签软件LabelImg并用矩形标签库进行标注，生成了相应的XML标签文件并以COCO数据集的格式完成数据集的搭建。S2.将处理后的数据集根据是否标注进行分类，得到标注数据集和未标注数据集；将果园昆虫数据集中带有昆虫类别标注的图片加入到标注数据集中；将果园昆虫数据集中不带有昆虫类别标注的图片加入到未标注数据集中，完成数据集的分类。S3.构建学生网络和教师网络；学生网络和教师网络均初始网络架构相同，均采用改进的YOLOv5检测器。我们对YOLOv5检测器进行改进，将主干网络替换为轻量化网络Mobileone，并加入了注意力模块shuffleattention和自行设计的小目标检测层，引入了残差模块，以满足对小目标昆虫的检测。同时，将原网络中的激活函数替换为了目前最先进的Mish激活函数。输入端：在网络中输入端图片张量大小为640*640*3。主干网络：将输入端输入的图片输入主干网络backbone中。主干网络由Mobileone，残差模块，shuffleattetion注意力机制和conv卷积模块构成。A.Mobileone网络模块：MobileOne block的结构被分解成depthwise层和pointwise层，此外还引入了over-parameterization分支。basic block的结构基于MobileNet-V1的设计，3x3 depthwise卷积后接1x1 pointwise卷积，然后又加入可重参数化的skip-connection分支，具体包括一个batchnorm分支和一个可复制多次的分支。B.ShuffleAttention 注意力机制模块结构首先将tensor 划分为若干个组，每个组内部使用 SA Unit 进行处理。结构内部的空间注意力机制有 GN 实现，通道注意力机制的实现方法和 SENet 相似。C.Conv模块是卷积神经网络中常用的一种基础模块，它主要由卷积层、BN层和激活函数组成。其中卷积层采用Conv2d函数，BN层采用BatchNorm2d函数，激活函数采用Mish激活函数。D.在主干网络中采用残差模块，增加了模型层数，提升网络效果。残差网络核心公式为y=H+x，其中x为前两层输入，H为前两层x经过两层网络后的输出。颈部网络：采用FPN+PAN结构，FPN层自顶向下传达强语义特征，而PAN塔自底向上传达定位特征。FPN是一个结合了SSD的多分辨率尺度预测和U-Net的多分辨率特征融合的网络结构，FPN通过自顶向下的过程和横向连接来解决低层特征语义信息level较低的问题，保持低层特征利于检测小目标的优势的同时，提高检测精度。PAN 结构自底向上进行下采样，使顶层特征包含图像位置信息，两个特征最后进行融合，使不同尺寸的特征图都包含图像语义信息和图像特征信息，保证了对不同尺寸的图片的准确预测。头部网络：采用DIOU_LOSS 作为bounding box 的损失函数。DIoU Loss设计了符合实际检测效果的惩罚项，DIoU Loss表示原理为式：其中b和b表示两个矩形框的中心点，表示两个矩形框之间的欧氏距离，c表示两个矩形框的闭包区域的对角线的距离。DIoU loss的优化目标是直接减小两个矩形框中心点之间的欧式距离，c的作用是防止损失函数的值过大，提升收敛速度。图片输入head层后被划分为了7*7的网格，每个网络在Head侧进行独立检测，头部结构采用了卷积和Auto Learning Bounding Box Anchors来预测检测框。在本申请的实施例中采用相应的领域正负样本分配策略，其主要流程如下：1.将ground truth与当前feature map中的anchor box进行比较，如果groundtruth与anchor box的宽高比例都处在四分之一到四，那么这个groundtruth就能与当前featuer map相匹配。2.将当前feature map中的ground truth分配给对应的grid cell。将这个gridcell分为四个象限，针对与当前feature map匹配的ground truth，会计算该groundtruth处于四个象限中的哪一个，并将邻近的两个grid cell中的检测框也作为正样本。若ground truth偏向于右上角的象限，就会将groundtruth所在grid cell的上面和右边的grid cell中的检测框也作为正样本。Head侧引入了多尺度检测逻辑和多标签分类思想，在Neck侧的基础上顺势而为融合了3个尺度，在多个尺度的融合特征图上分布进行独立的监测。S4.利用标注数据集中的数据对学生网络进行训练，得到训练好的学生网络；在本申请的实施例中，训练过程中，将标注数据集中的每一个数据作为网络输入，将标记的类别作为网络期望输出，从而完成对学生网络的训练。S5.将未标注数据集中的数据输入训练好的学生网络中，利用训练好的学生网络的输出作为伪标签，对未标注数据集中的数据进行标记；在本申请的实施例中，将未标注数据集中的每一个数据输入学生网络中，将学生网络的输出结果作为对应数据的伪标签。S6.利用未标注数据集中的数据和对应的伪标签，对教师网络进行训练，得到训练好的教师网络。训练过程中，以数据集中的每一个数据作为输入，对应的伪标签作为期望输出，来完成对教师网络的训练。在本申请的实施例中，所述方法还包括：利用训练好的教师网络进行果园图片中昆虫类别的识别，从而完成虫情监测。以上实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的精神和范围。
