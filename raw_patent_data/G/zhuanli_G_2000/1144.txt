标题title
一种训练方法、流量检测方法、装置、设备及介质
摘要abst
本公开提供一种训练方法、流量检测方法、装置、设备及介质，所述方法用于训练流量检测模型，所述流量检测模型包括：胶囊提取网络、流量分类网络以及域对抗网络，其包括:基于源域流量样本数据对胶囊提取网络和流量分类网络进行第一次监督式训练，基于源域流量样本数据和目标域流量样本数据对第一次监督式训练获得的所述胶囊提取网络和所述域对抗网络进行第二次监督式训练。所述方法训练的流量检测模型可以实现从源域流量到目标域流量的跨域检测，削弱因为目标域和源域网络场景域偏移所产生的流量检测准确率下降的问题。
权利要求书clms
1.一种训练方法，其特征在于，用于训练流量检测模型，所述流量检测模型包括：胶囊提取网络、流量分类网络以及域对抗网络，所述方法包括：基于源域流量样本数据对所述胶囊提取网络和所述流量分类网络进行第一次监督式训练，所述胶囊提取网络用于基于所述源域流量样本数据确定第一源域流量高阶样本特征，所述流量分类网络用于基于所述源域流量高阶样本特征获取源域流量状态的预测分类结果；基于所述源域流量样本数据和目标域流量样本数据对所述第一次监督式训练获得的所述胶囊提取网络和所述域对抗网络进行第二次监督式训练，所述第一次监督式训练获得的胶囊提取网络用于基于所述源域流量样本数据和所述目标域流量样本数据确定第二源域流量高阶样本特征和目标域流量高阶样本特征，所述域对抗网络用于对所述第二源域流量高阶样本特征和目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征，基于所述域间自适应对齐特征确定领域分类的预测结果。2.根据权利要求1所述的方法，其特征在于，所述胶囊提取网络的模型参数和所述流量分类网络的模型参数在所述第一次监督式训练的更新方式包括最小化类别分类损失函数的更新方式。3.根据权利要求1所述的方法，其特征在于，所述域对抗网络的模型参数和所述第一次监督式训练获得的胶囊提取网络的模型参数在所述第二次监督式训练的更新方式包括：通过交替迭代方式更新所述域对抗网络的模型参数和所述第一次监督式训练获得的胶囊提取网络的模型参数。4.根据权利要求3所述的方法，其特征在于，所述域对抗网络的模型参数的更新方式为最小化领域分数损失函数的更新方式，所述第一次监督式训练获得的胶囊提取网络的模型参数的更新方式为最大化领域分类损失函数的更新方式。5.根据权利要求1所述的方法，其特征在于，所述域对抗网络包括：梯度反转层，用于对所述第二源域流量高阶样本特征和所述目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征；域分类器，用于基于所述域间自适应对齐特征，获得所述领域分类的预测结果。6.根据权利要求1所述的方法，其特征在于，所述胶囊提取网络包括：第一特征提取器，用于在第一次监督式训练过程中基于所述源域流量样本数据确定源域流量的多个第一基本特征，在所述第二次监督式训练过程中基于所述源域流量样本数据确定源域流量的多个第二基本特征；第二特征提取器，用于在第二次监督式训练过程中基于所述目标域流量样本数据确定目标域流量的多个基本特征；胶囊特征提取器，用于在所述第一次监督式训练过程中基于所述源域流量的多个第一基本特征确定所述第一源域流量高阶样本特征，在所述第二次监督式训练过程中基于所述源域流量的多个第二基本特征确定所述第二源域流量高阶样本特征，基于所述目标域流量的多个基本特征确定所述目标域流量高阶样本特征。7.根据权利要求1~6任一项所述的方法，其特征在于，所述流量分类网络用于在所述第一次监督式训练中对所述第一源域流量高阶样本特征进行非线性化处理，获得所述源域流量状态的预测分类结果。8.一种流量检测方法，其特征在于，应用权利要求1~7任一项所述训练方法训练的流量检测模型，所述方法包括：将目标域流量信息输入胶囊提取网络，获得目标域流量的高阶特征；将所述目标域流量的高阶特征输入流量分类网络，获得目标域流量状态的分类结果；基于所述目标域流量状态的分类结果确定目标域的流量状态。9.根据权利要求8所述方法，其特征在于，所述目标域流量的高阶特征包括多个所述目标域的胶囊特征通过耦合参数形成的耦合结果，所述胶囊提取网络至少包括第一特征提取器和胶囊特征提取器；所述第一特征提取器用于基于所述目标域流量信息获得目标域流量的基本特征；所述胶囊特征提取器用于基于所述目标域流量的基本特征获得所述目标域流量的高阶特征。10.一种训练装置，其特征在于，用于训练流量检测模型，所述流量检测模型包括：胶囊提取网络、流量分类网络以及域对抗网络，所述装置包括：第一训练模块，用于基于源域流量样本数据对所述胶囊提取网络和所述流量分类网络进行第一次监督式训练，所述胶囊提取网络用于基于所述源域流量样本数据确定第一源域流量高阶样本特征，所述流量分类网络用于基于所述源域流量高阶样本特征获取源域流量状态的预测分类结果；第二训练模块，用于基于所述源域流量样本数据和目标域流量样本数据对所述第一次监督式训练获得的所述胶囊提取网络和所述域对抗网络进行第二次监督式训练，所述第一次监督式训练获得的胶囊提取网络用于基于所述源域流量样本数据和所述目标域流量样本数据确定第二源域流量高阶样本特征和目标域流量高阶样本特征，所述域对抗网络用于对所述第二源域流量高阶样本特征和目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征，基于所述域间自适应对齐特征确定领域分类的预测结果。11.一种流量检测装置，其特征在于，应用权利要求1~7任一项所述方法训练的流量检测模型，所述装置包括：提取模块，用于将目标域流量信息输入胶囊提取网络，获得目标域流量的高阶特征；分类模块，用于将所述目标域流量的高阶特征输入流量分类网络，获得目标域流量状态的分类结果；确定模块，用于基于所述目标域流量状态的分类结果确定目标域的流量状态。12.一种电子设备，其特征在于，包括：处理器；以及，存储程序的存储器；其中，所述程序包括指令，所述指令在由所述处理器执行时使所述处理器执行根据权利要求1~9中任一项所述的方法。13.一种非瞬时计算机可读存储介质，其特征在于，所述非瞬时计算机可读存储介质用于存储有计算机指令，所述计算机指令用于使所述计算机执行根据权利要求1~9中任一项所述的方法。
说明书desc
技术领域本发明涉及网络安全技术领域，尤其涉及一种训练方法、流量检测方法、装置、设备及介质。背景技术网络异常流量检测是一种网络安全防护技术，可以分析网络流量，测出与正常流量明显不同的流量，从而及时发现网络面对的各种安全威胁和网络攻击，力争在网络空间安全中掌握主动。相关技术中，可以使用迁移学习将源网络场景下训练好的流量检测模型迁移至目标网络场景下，然后利用该流量检测模型检测目标网络流量。但是网络环境差异比较大，流量检测模型难以准确的检测目标网络流量是否异常。发明内容根据本公开的一方面，提供了一种训练方法，用于训练所述流量检测模型，所述流量检测模型包括：胶囊提取网络、流量分类网络以及域对抗网络，所述方法包括：基于源域流量样本数据对所述胶囊提取网络和所述流量分类网络进行第一次监督式训练，所述胶囊提取网络用于基于所述源域流量样本数据确定第一源域流量高阶样本特征，所述流量分类网络用于基于所述源域流量高阶样本特征获取源域流量状态的预测分类结果；基于所述源域流量样本数据和目标域流量样本数据对所述第一次监督式训练获得的所述胶囊提取网络和所述域对抗网络进行第二次监督式训练，所述第一次监督式训练获得的胶囊提取网络用于基于所述源域流量样本数据和所述目标域流量样本数据确定第二源域流量高阶样本特征和目标域流量高阶样本特征，所述域对抗网络用于对所述第二源域流量高阶样本特征和目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征，基于所述域间自适应对齐特征确定领域分类的预测结果。根据本公开的另一方面，提供了一种流量检测方法，应用本公开示例性实施例所述方法训练的流量检测模型，所述方法包括：将目标域流量信息输入胶囊提取网络，获得目标域流量的高阶特征；将所述目标域流量的高阶特征输入流量分类网络，获得目标域流量状态的分类结果；基于所述目标域流量状态的分类结果确定目标域的流量状态。根据本公开的另一方面，提供了一种训练装置，包括：第一训练模块，用于基于源域流量样本数据对所述胶囊提取网络和所述流量分类网络进行第一次监督式训练，所述胶囊提取网络用于基于所述源域流量样本数据确定第一源域流量高阶样本特征，所述流量分类网络用于基于所述源域流量高阶样本特征获取源域流量状态的预测分类结果；第二训练模块，用于基于所述源域流量样本数据和目标域流量样本数据对所述第一次监督式训练获得的所述胶囊提取网络和所述域对抗网络进行第二次监督式训练，所述第一次监督式训练获得的所述胶囊提取网络用于基于所述源域流量样本数据和所述目标域流量样本数据确定第二源域流量高阶样本特征和目标域流量高阶样本特征，所述域对抗网络用于对所述第二源域流量高阶样本特征和目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征，基于所述域间自适应对齐特征确定领域分类的预测结果。根据本公开的另一方面，提供了一种流量检测装置，应用所述方法训练的流量检测模型，所述装置包括：提取模块，用于将目标域流量信息输入胶囊提取网络，获得目标域流量的高阶特征；分类模块，用于将所述目标域流量的高阶特征输入流量分类网络，获得目标域流量状态的分类结果；确定模块，用于基于所述目标域流量状态的分类结果确定目标域的流量状态。根据本公开的另一方面，提供了一种电子设备，包括：处理器；以及，存储程序的存储器；其中，所述程序包括指令，所述指令在由所述处理器执行时使所述处理器执行根据本公开示例性实施例所述的方法。根据本公开的另一方面，提供了一种非瞬时计算机可读存储介质，其特征在于，所述非瞬时计算机可读存储介质用于存储有计算机指令，所述计算机指令用于使所述计算机执行根据本公开示例性实施例所述的方法。本公开实施例中提供的一个或多个技术方案中，在第一次监督式训练过程中，通过胶囊提取网络保证其所输出的第一源域流量高阶样本特征充分反映源域流量样本数据的底层特征和高层特征，使得所训练的流量分类网络可以准确对源域流量状态进行检测。而在第二次监督式训练过程中，可以通过第一次监督式训练获得的胶囊提取网络，使得第一次监督式训练获取的胶囊提取网络提取到的第二源域流量高阶样本特征可以充分反映源域流量样本数据的底层特征和高层特征，目标域流量高阶样本特征可以充分反映目标域流量样本数据的底层特征和高层特征。在此基础上，本公开示例性实施例的方法在第二次监督式训练时，域对抗网络用于对所述第二源域流量高阶样本特征和目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征，基于所述域间自适应对齐特征确定领域分类的预测结果，而通过训练过程中的反向传播过程，使得域对抗网络尽可能将第一源域流量高阶样本特征和目标域流量高阶样本特征映射到同一特征空间，并在该特征空间的距离逐渐接近。可见，本公开示例性实施例通过对流量检测模型的训练，可以保证胶囊提取网络从目标域流量信息和源域流量信息提取到尽可能相同的高层特征。当训练完成的流量检测模型应用于目标域流量检测时，胶囊提取网络所提取到的目标域流量的高阶特征可以适用于通过基于源域流量样本数据所训练的流量分类网络，从而保证流量分类网络可以准确识别目标域流量状态，因此，本公开示例性实施例的流量分类网络虽然由源域流量样本数据训练，但是通过训练域对抗网络，使得流量分类网络可以准确的实现从源域流量到目标域流量的跨域检测，从而削弱因为目标域网络场景和源域网络场景的域偏移所产生的流量检测准确率下降的问题。附图说明在下面结合附图对于示例性实施例的描述中，本公开的更多细节、特征和优点被公开，在附图中：图1示出了本公开示例性实施例的训练方法的流程示意图；图2示出了本公开示例性实施例的第二次监督式训练的流程示意图；图3示出了本公开示例性实施例的胶囊提取网络的结构示意图；图4示出了本公开示例性实施例的胶囊特征提取器的结构示意图；图5示出了本公开示例性实施例的胶囊特征提取器的层级间运算原理示意图；图6示出了本公开示例性实施例的流量检测模型的架构示意图；图7示出了本公开示例性实施例的流量检测方法的流程示意图；图8示出了根据本公开示例性实施例的训练装置的功能模块示意性框图；图9示出了根据本公开示例性实施例的流量检测装置的功能模块示意性框图；图10示出了根据本公开示例性实施例的芯片的示意性框图；图11示出了能够用于实现本公开的实施例的示例性电子设备的结构框图。具体实施方式下面将参照附图更详细地描述本公开的实施例。虽然附图中显示了本公开的某些实施例，然而应当理解的是，本公开可以通过各种形式来实现，而且不应该被解释为限于这里阐述的实施例，相反提供这些实施例是为了更加透彻和完整地理解本公开。应当理解的是，本公开的附图及实施例仅用于示例性作用，并非用于限制本公开的保护范围。应当理解，本公开的方法实施方式中记载的各个步骤可以按照不同的顺序执行，和/或并行执行。此外，方法实施方式可以包括附加的步骤和/或省略执行示出的步骤。本公开的范围在此方面不受限制。本文使用的术语“包括”及其变形是开放性包括，即“包括但不限于”。术语“基于”是“至少部分地基于”。术语“一个实施例”表示“至少一个实施例”；术语“另一实施例”表示“至少一个另外的实施例”；术语“一些实施例”表示“至少一些实施例”。其他术语的相关定义将在下文描述中给出。需要注意，本公开中提及的“第一”、“第二”等概念仅用于对不同的装置、模块或单元进行区分，并非用于限定这些装置、模块或单元所执行的功能的顺序或者相互依存关系。需要注意，本公开中提及的“一个”、“多个”的修饰是示意性而非限制性的，本领域技术人员应当理解，除非在上下文另有明确指出，否则应该理解为“一个或多个”。在介绍本公开实施例之前首先对本公开实施例中涉及到的相关名词作如下释义：胶囊网络可以看作是神经网络中的一层，由胶囊组成。胶囊可以看作一个向量，这个向量既可以表示图片识别的概率，又可以表示当前图像的特征。动态路由是胶囊网络在算法上的关键，在动态路由过程中，下层胶囊将输入向量传送到上层胶囊，下次胶囊将其输出乘上权重矩阵计算预测向量，如果该预测向量与上层胶囊的输出具有较大的标量积，则增加该上层胶囊的耦合系数，减小其他胶囊的耦合系数。梯度反转层主要在反向传播过程中梯度方向自动取反，在前向传播过程中实现恒等变换。源域是指已有的先验知识的数据集，目标域是指需要算法学习的新知识的数据集。域适应，也可称为域对抗用以消除不同域之间的特征分布差异，其目的是把具有不同分布的源域 和目标域 中的数据，映射到同一个特征空间，寻找某一种度量准则，使其在这个空间上的“距离”尽可能近。相关技术中，可以在有标记离线历史数据集上训练出流量检测模型，然后将流量检测模型直接应用到当前新的目标网络场景中。但是这种方法推广性差，且不适合一些复杂场景。虽然可以使用前迁移学习将源网络场景下训练好的流量检测模型迁移至目标网络场景下，该流量检测模型包括特征提取器和类别分类模型，利用该流量检测模型检测目标网络流量。但是网络环境差异比较大，流量检测模型难以准确的检测目标网络流量是否异常。本公开示例性实施例提供一种训练方法及流量检测方法，以利用域对抗原理提高跨域网络流量检测准确性，从而削弱因为目标域网络场景和源域网络场景的域偏移所产生的流量检测准确率下降的问题。本公开示例性实施例提供的训练方法用于训练流量检测模型，该流量检测模型其可以将胶囊网络理论和域对抗理论进行有机结合，实现跨域流量检测，其实质相当于在相关技术的流量检测模型增加域对抗胶囊网络，域对抗胶囊网络主要有两个作用：第一，通过胶囊特征提取器获得数据的高阶矢量特征，再进行类别分类，这样可以很好地对数据特征的多属性进行表征，使得流量检测模型的泛化能力更好；第二，通过设计域对抗网络完成领域分类任务，使得源域流量数据和目标域流量数据在高阶矢量特征层面上进行对齐，使得流量检测模型具有很好的领域自适应能力。上述流量检测模型包括：胶囊提取网络、流量分类网络以及域对抗网络。对流量检测模型训练时，可以分为两次监督式训练，第一次监督式训练可以以源域流量样本数据为数据集，训练胶囊提取网络、流量分类网络，第二次监督式训练可以以源域流量样本数据和目标域流量样本数据为数据集，对胶囊提取网络和域对抗网络进行训练，使得域对抗网络可以缩小源域流量特征和目标域流量特征之间的特征差异，从而解决异常流量检测中跨域下的知识迁移问题。图1示出了本公开示例性实施例的训练方法的流程示意图。如图1所示，本公开示例性实施例的训练方法可以包括：步骤101：基于源域流量样本数据对胶囊提取网络和流量分类网络进行第一次监督式训练。胶囊提取网络用于基于源域流量样本数据确定第一源域流量高阶样本特征，流量分类网络用于基于源域流量高阶样本特征获取源域流量状态的预测分类结果。应理解，本公开示例性实施例源域流量状态可以包括多种可能状态，流量分类网络所输出的源域流量状态的预测分类结果可以包括源域流量状态的多个预测概率，其中预测概率最大的源域流量状态为源域流量状态的最终预测结果。本公开示例性实施例在第一次监督式训练过程中，通过胶囊提取网络保证其所输出的第一源域流量高阶样本特征充分反映源域流量样本数据的底层特征和高层特征，使得所训练的流量分类网络可以准确对源域流量状态进行检测。在实际应用中，本公开示例性实施例在进行第一次监督式训练时，可以将源域流量样本数据输入胶囊提取网络，获得第一源域流量高阶样本特征，将第一源域流量高阶样本特征输入流量分类网络，获得源域流量状态的预测分类结果。当第一次监督式训练达到第一收敛条件时，完成胶囊提取网络和流量分类网络的第一次监督式训练，若第一次监督式训练未达到第一收敛条件时，基于源域流量状态的预测分类结果和源域流量样本数据的流量状态标签更新胶囊提取网络的模型参数和流量分类网络的模型参数。本公开示例性实施例的第一收敛条件可以包括基于源域流量状态的预测分类结果与源域流量样本数据的流量状态标签之间的实际分类损失小于或等于预设分类损失，或者实际分类损失围绕某个预设分类损失在一定范围内波动，还可以包括第一次监督式训练的模型参数迭代次数大于或等于预设次数。本公开示例性实施例可以通过类别分类损失函数评价源域流量状态的预测分类结果与源域流量样本数据的流量状态标签之间的实际分类损失，如果第一次监督式训练未达到收敛条件，可以通过最小化类别分类损失函数的方式优化胶囊提取网络和流量分类网络的模型参数。示例性的，本公开示例性实施例的源域流量样本数据的流量状态标签可以是表示源域流量样本的流量状态是否异常的标签，而源域流量和目标域流量可以是指两个不同网络场景的流量，例如：源域流量可以包括在企业局域网流量数据、目标域流量数据可以包括校园网流量数据。步骤102：基于源域流量样本数据和目标域流量样本数据对第一次监督式训练获得的胶囊提取网络和域对抗网络进行第二次监督式训练。第一次监督式训练获得的胶囊提取网络用于基于源域流量样本数据和目标域流量样本数据确定第二源域流量高阶样本特征和目标域流量高阶样本特征，域对抗网络用于对第二源域流量高阶样本特征和目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征，基于域间自适应对齐特征确定领域分类的预测结果。从第二次监督式训练可以看出，在第二次监督式训练的过程中，所使用的胶囊提取网络是经过第一次监督式训练获得的胶囊提取网络，由于其在第二次监督式训练前提前被训练，因此，本公开示例性实施例在第二次监督式训练所使用的胶囊提取网络已经具备比较好的源域流量高阶特征提取。在此基础上，通过训练域对抗网络，不仅可以保证胶囊提取网络所提取的源域流量高阶样本特征和目标域流量高阶样本特征逐渐在同一映射空间的距离逐渐接近，从而通过训练完成的流量检测模型实现跨域流量检测，而且还可以减少训练次数，提高训练效率。在第二次监督式训练过程中，本公开示例性实施例可以通过第一次监督式训练获得的胶囊提取网络，使得第一次监督式训练获取的胶囊提取网络提取到的第二源域流量高阶样本特征可以充分反映源域流量样本数据的底层特征和高层特征，而目标域流量高阶样本特征可以充分反映目标域流量样本数据的底层特征和高层特征。在此基础上，本公开示例性实施例的方法在第二次监督式训练时，域对抗网络用于对所述第二源域流量高阶样本特征和目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征，基于所述域间自适应对齐特征确定领域分类的预测结果，而通过训练过程中的反向传播过程，使得域对抗网络可以尽可能将第一源域流量高阶样本特征和目标域流量高阶样本特征映射到同一特征空间，并在该特征空间的距离逐渐接近。可见，本公开示例性实施例通过对流量检测模型的训练，可以保证胶囊提取网络从目标域流量信息和源域流量信息提取到尽可能相同的高层特征。当训练完成的流量检测模型应用于目标域流量检测时，胶囊提取网络所提取到的目标域流量的高阶特征可以适用于通过基于源域流量样本数据所训练的流量分类网络，从而保证流量分类网络可以准确识别目标域流量状态，因此，本公开示例性实施例的流量分类网络虽然由源域流量样本数据训练，但是通过训练域对抗网络，使得流量分类网络可以准确的实现从源域流量到目标域流量的跨域检测，从而削弱因为目标域网络场景和源域网络场景的域偏移所产生的流量检测准确率下降的问题。在一种可选方式中，本公开示例性实施例在进行第二次监督式训练时，可以以领域分类标签为监督信息，基于源域流量样本数据和目标域流量样本数据训练第一次监督式训练获得的胶囊提取网络和域对抗网络。图2示出了本公开示例性实施例的第二次监督式训练的流程示意图。如图2所示，本公开示例性实施例的第二次监督式训练可以包括：步骤201：将源域流量样本数据和目标域流量样本数据输入第一次监督式训练获得的胶囊提取网络，获得第二源域流量高阶样本特征和目标域流量高阶样本特征。本公开示例性实施例可以使用胶囊提取网络参数共享的方式提取第二源域流量高阶样本特征和目标域流量高阶样本特征。步骤202：将第二源域流量高阶样本特征和目标域流量高阶样本特征输入域对抗网络，获得领域分类的预测结果。此处域对抗网络不仅可以基于第二源域流量高阶样本特征和目标域流量高阶样本特征预测目标域流量样本数据和源域流量样本数据是否属于同一网络场景，还可以基于域对抗原理对第二源域流量高阶样本特征和目标域流量高阶样本特征进行自适应逐渐对齐。步骤203：若领域分类的预测结果和领域分类标签之间的实际领域分类损失满足收敛条件，获得训练完成的胶囊提取网络和域对抗网络。应理解，本公开示例性实施例的领域分类的预测结果，可以反映出域对抗网络预测的源域流量数据和目标域流量数据是否来自于同一网络场景，而领域分类标签可以包括表示源域流量数据和目标域流量数据是否来自于同一网络场景的真实情况。在实际应用中，本公开示例性实施例可以使用领域分类损失函数评价领域分类的预测结果和领域分类标签之间的实际领域分类损失。此处实际领域分类损失满足收敛条件，可以是指实际领域分类损失小于预设领域分类损失，还可以是实际领域分类损失围绕预设领域分类损失在一定范围内波动。当实际领域分类损失不满足收敛条件时，本公开示例性实施例的域对抗网络的模型参数和第一次监督式训练获得的胶囊提取网络的模型参数在第二次监督式训练的更新方式包括：通过交替迭代方式更新域对抗网络的模型参数和第一次监督式训练获得的胶囊提取网络的模型参数。也就是说，在当前迭代过程中，可以更新域对抗网络的模型参数，即不更新第一次监督式训练获得的胶囊提取网络的模型参数，即固定第一次监督式训练获得的胶囊提取网络。而在下一次更新第一次监督式训练获得的胶囊提取网络的模型参数，而不更新域对抗网络的模型参数，即保持域对抗网络的模型参数固定。这种模型参数更新方式通过博弈的方式达到平衡，保证域对抗网络能够对齐第二源域流量高阶样本特征和目标域流量高阶样本特征的同时，可以准确判断源域流量样本数据和目标域流量样本数据是否来自同一网络场景。示例性的，域对抗网络的模型参数的更新方式为最小化领域分数损失函数的迭代方式，第一次监督式训练获得的胶囊提取网络的模型参数的更新方式为最大化领域分类损失函数的迭代方式。当通过最小化领域分类损失函数更新域对抗网络的模型参数时，可以保证训练完成的域对抗网络可以准确预测输入胶囊提取网络的源域流量样本数据和目标域流量样本数据是否来自于同一网络场景。而通过最大化领域分类损失函数更新胶囊提取网络的模型参数，可以保证训练完成的胶囊提取网络可以提取到难以分辨的第二源域流量高阶样本特征和目标域流量高阶样本特征。基于此，本公开示例性实施例的训练方法训练的流量检测模型应用在目标域流量检测时，通过胶囊提取网络可以从目标域流量信息提取到与源域高阶特征尽可能相似甚至相同的目标域流量的高阶特征，进而使得利用源域流量样本数据训练的流量分类网络可以准确从目标域流量的高阶特征获取到目标域的流量状态，实现从源域流量到目标域流量的跨域检测，从而削弱因为目标域网络场景和源域网络场景的域偏移所产生的流量检测准确率下降的问题。可见，本公开示例性实施例的方法在第一次监督式训练所使用的标签为源域流量样本数据的流量状态标签，而第二次监督式训练所使用的标签为领域分类标签，不需要使用目标域流量样本数据的流量状态标签，因此，本公开示例性实施例可以通过带有流量状态标签的源域流量样本数据，辅助没有流量状态标签的目标域流量样本数据训练流量检测模型，从而利用训练完的流量检测模型对目标域流量进行状态检测。图3示出了本公开示例性实施例的胶囊提取网络的结构示意图。如图3所示，本公开示例性实施例胶囊提取网络300可以包括：第一特征提取器301、第二特征提取器302和胶囊特征提取器303。应理解，本公开示例性实施例的第一特征提取器301和第二特征提取器302可以是常规的卷积网络提取器，此处不做详述。在实际应用中，如图3所示，本公开示例性实施例的第一特征提取器301和第二特征提取器302架构可以相同。这种情况下，在第一次监督式训练完成之后，可以将第一次监督式训练所获得的第一特征提取器的模型参数迁移至第二特征提取器302，从而提高第二特征提取器的训练效率。上述第一特征提取器301可以用于在第一次监督式训练过程中基于源域流量样本数据确定源域流量的第一基本特征，胶囊特征提取器303用于在第一次监督式训练过程中基于源域流量的第一基本特征确定第一源域流量高阶样本特征。上述第二特征提取器302还可以用于在第二次监督式训练过程中基于源域流量样本数据确定源域流量的第二基本特征，第二特征提取器302用于在第二次监督式训练过程中基于目标域流量样本数据确定目标域流量的基本特征。上述胶囊特征提取器303还用于在第二次监督式训练过程中基于源域流量的第二基本特征确定第二源域流量高阶样本特征，基于目标域流量的基本特征确定目标域流量高阶样本特征。在这个过程中，胶囊特征提取器303通过参数共享的方式确定第二源域流量高阶样本特征和目标域流量高阶样本特征。也就是说，胶囊特征提取器303并未融合基于第二源域流量基本特征和目标域流量基本特征，而是并行的基于第二源域流量基本特征确定第二源域流量高阶样本特征，基于目标域流量基本特征确定目标域流量高阶样本特征的过程。在第二次监督式训练过程中，通过参数共享方式确定第二源域流量高阶样本特征和目标域流量高阶样本特征，可以使得更新胶囊特征提取器的模型参数时，胶囊特征提取器可以独立的提取尽可能接近的第二源域流量高阶样本特征和目标域流量高阶样本特征。基于此，本公开示例性实施例的流量检测模型训练完成后，可以利用第二特征提取器和胶囊特征提取器可以提取到目标域流量特征，且保证该目标域流量特征也存在于源域流量信息中，使得流量分类网络可以跨域准确检测到目标域的流量状态。在一种可选方式中，本公开示例性实施例的第一源域流量高阶样本特征包括源域流量的多个第一胶囊样本特征。第二源域流量高阶样本特征包括源域流量的多个第二胶囊样本特征，目标域流量高阶样本特征包括目标域流量的多个胶囊样本特征。图4示出了本公开示例性实施例的胶囊特征提取器的结构示意图。如图4所示，本公开示例性实施例的胶囊特征提取器400可以包括：主胶囊层401和数字胶囊层402。如图4所示，上述主胶囊层401用于在第一次监督式训练过程中对所述源域流量的第一基本特征进行初始化，获得源域流量的多个第一胶囊输入特征；数字胶囊层402用于在第一次监督式训练过程中对源域流量的多个第一胶囊输入特征进行仿射变换，获得源域流量的多个第一仿射变换结果，利用第一耦合系数对源域流量的多个第一仿射变换结果进行耦合，获得第一源域流量高阶样本特征。在实际应用中，主胶囊层对源域流量的多个第一基本特征进行初始化时，实际是对源域流量的多个第一基本特征进行融合，从而使得所获得的每个第一胶囊输入特征所含有的信息量比较全面。而数字胶囊层对多个第一胶囊输入特征进行仿射变换，以使得第一仿射变换结果可以体现源域流量的高层特征以及底层特征之间的各种关系。当第一源域流量高阶样本特征包括源域流量的多个第一胶囊样本特征时，数字胶囊层的数量可以为多个，每个数字胶囊层可以输出一种属性的第一胶囊样本特征，每个第一胶囊样本特征可以看作是通过第一耦合系数耦合多个属性的第一仿射变换结果所获得的胶囊样本特征。这种情况下，数字胶囊层可以实现对多个第一仿射变换结果的全连接，从而获得第一源域流量高阶样本特征。应理解，源域流量的每个第一仿射变换结果可以对应一个第一耦合参数，此处源域流量的各个第一仿射变换结果对应的第一耦合参数之和可以为1。同理，上述主胶囊层还用于在第二次监督式训练过程中对源域流量的多个第二基本特征进行初始化，获得源域流量的多个第二胶囊输入特征，对目标域流量的多个基本特征进行初始化，获得目标域流量的多个胶囊输入特征；上述数字胶囊层还用于在第二次监督式训练过程中对源域流量的多个第二胶囊输入特征进行仿射变换，获得源域流量的多个第二仿射变换结果，利用第二耦合系数对源域流量的多个第二仿射变换结果进行耦合，获得第二源域流量高阶样本特征；对目标域流量的多个胶囊输入特征进行仿射变换，获得目标域流量的多个仿射变换结果，利用第二耦合系数对目标域流量的多个仿射变换结果进行耦合，获得目标域流量高阶样本特征。本公开示例性实施例在第二次监督式训练过程中主胶囊层和数字胶囊层的作用，可以参考前文第一次监督式训练过程的描述，此处不做赘述。需要说明的是，源域流量的每个第二仿射变换结果和目标域流量的每个胶囊样本特征均对应一个第二耦合参数，且源域流量的每个第二仿射变换结果和目标域流量的每个仿射变换结果共享一个第二耦合系数，源域流量的各个胶囊样本特征和目标域流量的各个胶囊样本特征对应的第二耦合参数之和为1。不管是第一耦合系数还是第二耦合系数，均可以通过动态路由的方式进行迭代。另外，与卷积神经网络只关注特定特征的存在，而忽略了这些特征之间的相互关系不同，本公开示例性实施例的胶囊特征提取器可以将第一特征提取器和第二特征提取器提取的基本特征矢量化，获得的高阶样本特征均为矢量化特征，这些矢量化特征考虑标量特征缺失的位置、方向等信息，具有很强的识别特征中多属性相互关系的能力，可以有效辅助处理跨域流量特征。与全连接层相比，本公开示例性实施例的胶囊特征提取器更能提取特征中更深更广的属性特征，而且通过动态路由算法减少了参数量，因此，本公开示例性实施例通过两个卷积神经网络作为第一特征提取器和第二特征提取器在的第二次监督式训练过程中对源域流量样本数据和目标域流量样本数据进行一级提取，获得源域流量的多个第二基本特征和目标域流量的多个基本特征，而利用胶囊特征提取器对源域流量的多个第二基本特征和目标域流量的多个基本特征进行二级提取，从而保证所训练的流量检测模型具有更好的泛化性，提高跨域异常流量检测的准确性。在一种可选方式中，本公开示例性实施例的流量分类网络可以用于在第一次监督式训练中对第一源域流量高阶样本特征进行非线性化处理，获得源域流量状态的预测分类结果。应理解，本公开示例性对非线性化处理可以通过激活函数实现。示例性的，当第一源域流量高阶样本特征包括源域流量的多个属性第一胶囊样本特征时，实质可以认为是对每个属性的第一胶囊样本特征进行非线性化处理，从而使得源域流量状态的预测分类结果包括多个第一胶囊样本特征的非线性化结果，每个第一胶囊样本特征的非线性化结果可以对应一个源域流量状态的可能性。当通过激活函数实现第一胶囊样本特征的非线性化处理，本公开示例性实施例可以使用squash函数对第一胶囊样本特征进行非线性化处理，使得第一胶囊样本特征的非线性化结果处在0~1之间，然后将各个第一胶囊样本特征的非线性化结果中数值最大的结果对应的第一胶囊样本特征作为源域流量状态的最终结果。上述流量分类网络可以用于在第一次监督式训练中对第一源域流量高阶样本特征进行非线性化处理后，从而获得源域流量状态的预测分类结果，从而间接达到对各个第一耦合系数进行更新的目的。本公开示例性实施例的数字胶囊层所涉及的各种耦合参数可以通过动态路由机制确定。例如：通过动态路由机制可以确定不同仿射变换结果对应的路由参数，然后通过softmax函数，获取到仿射变换结果对应的路由参数。图5示出了本公开示例性实施例的胶囊特征提取器的层级间运算原理示意图。如图5所示，主胶囊层可以输出K个胶囊输入向量，数字胶囊层的数量M可以为一个，也可以为多个，可以根据实际情况决定，针对第j个数字胶囊层，各个胶囊输入向量经过仿射变换矩阵进行仿射变换，然后将各个胶囊输入特征的仿射变换结果通过对应的耦合参数进行加权求和，获得第j个数字胶囊层的预测向量sj，最后通过squash函数对胶囊样本向量sj进行规范化，获得第j个胶囊特征提取器输出的输出向量vj。ui表示主胶囊层输出的第i个胶囊输入向量，其可以以向量形式表示，例如：当i=1时，u1表示主胶囊层输出的第1个胶囊输向量，当i=2时，u2表示主胶囊层的第2个胶囊输向量，uK表示主胶囊层的第K个胶囊输向量；表示第j个数字胶囊层的第i个仿射变换矩阵，当i=1时，W1j表示第j个数字胶囊层的第1个仿射变换矩阵，当i=2时，W2j表示第j个数字胶囊层的第2个仿射变换矩阵，当i=K时，WKj表示第j个数字胶囊层的第K个仿射变换矩阵，j表示数字胶囊层的序号。表示第j个数字胶囊层的第i个仿射变换结果，/＞可以参考式一计算：式一当i=1时，表示第j个数字胶囊层的第1个仿射变换结果，当i=2时，/＞表示第j个数字胶囊层的第2个仿射变换结果，当i=K时，/＞表示第j个数字胶囊层的第K个仿射变换结果。cij表示第j个数字胶囊层的第i个耦合系数，其可以将第j个数字胶囊层的第i个仿射变换结果进行加权。应理解，本公开示例性实施例第j个数字胶囊层的各个耦合系数可以通过动态路由机制进行迭代。当i=1时，c1j表示第j个数字胶囊层的第1个耦合系数，当i=2时，c2j表示第j个数字胶囊层的第2个耦合系数，当i=K时，cKj表示第j个数字胶囊层的第K个耦合系数。在实际应用中，本公开示例性实施例的可以先初始化第j类别流量状态的预测结果vj和第j个数字胶囊层的第i个仿射变换结果的先验概率/＞，使得/＞和的值为0，再通过动态路由算法进行迭代，迭代次数可以根据实际情况选择。当进行迭代时，第j个数字胶囊层的第i个耦合系数cij可以利用如式二所示的softmax函数获取。式二当i=1时，b1j表示第j个数字胶囊层的第1个仿射变换结果的先验概率，c1j表示第j个数字胶囊层的第1个耦合系数，当i=2时，b2j表示第j个数字胶囊层的第2个仿射变换结果/＞的先验概率，c2j表示第j个数字胶囊层的第2个耦合系数，当i=K时，bKj表示第j个数字胶囊层的第K个仿射变换结果/＞的先验概率，cKj表示第j个数字胶囊层的第K个耦合系数。基于此，本公开示例性实施例各个胶囊输入特征的仿射变换结果通过对应的耦合参数进行加权求和的过程，可以通过式三所示的公式表示：式三接着，使用非线性激活函数squash函数规范第j个数字胶囊层的输出向量的长度在0~1之间，即式四所示的表达式。式四最后，通过求解第j个数字胶囊层的第i个仿射变换结果和第j个数字胶囊层的输出向量/＞的内积，来权衡向量之间的一致性，实现对第j个数字胶囊层的第i个仿射变换结果/＞的先验概率/＞的更新，其过程可以如式五所示。式五本公开示例性实施例在基于式五更新第j个数字胶囊层的第i个仿射变换结果的先验概率/＞后，可以通过式二重新计算第j个数字胶囊层的第i个耦合系数cij，进而达到更新第j个数字胶囊层的第i个耦合系数cij的目的。在一种可选方式中，本公开示例性实施例的域对抗网络可以包括梯度反转层和域分类器，梯度反转层可以用于对第二源域流量高阶样本特征和目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征，域分类器用于基于域间自适应对齐特征，获得领域分类的预测结果。本公开示例性实施例的梯度反转层在第二次监督式训练过程中，前向传播主要是对输入的第二源域流量高阶样本特征和目标域流量高阶样本特征进行恒等变换，而在反向传播时，领域分类损失梯度在传播到胶囊提取网络如第二特征提取器之前，梯度反转层可以对领域分类损失梯度取反，使得领域分类损失梯度与生成对抗网络类似的对抗损失类似，因此，本公开示例性实施例可以在第二次监督式训练过程中，通过梯度反转层达到网络流量跨域下的高阶矢量特征对齐，有效解决了由外部网络环境改变而造成的准确率下降问题，提高了流量检测方法的推广性和可靠性。为了方便理解本公开示例性实施例的流量检测模型的训练方法，图6示出了本公开示例性实施例的流量检测模型的架构示意图。如图6所示，本公开示例性实施例的流量检测模型600可以包括：第一特征提取器Gs、第二特征提取器Gt、胶囊特征提取器Gcap、流量分类网络C和域对抗网络D，第一特征提取器Gs和第二特征提取器Gt可以均为卷积神经网络，其结构可以相同。本公开示例性实施例包括两次监督式训练，分别为第一次监督式训练和第二次监督式训练，第一次监督式训练的损失函数包括类别分类损失函数，第二次监督式训练的损失函数包括领域分类损失函数。如图6所示，本公开示例性实施例在第一次监督式训练时，所使用的数据集包括源域流量样本数据xs，其带有流量状态标签，将源域流量样本数据xs输入第一特征提取器Gs，获得源域流量样本数据xs的第一基本特征，接着将源域流量样本数据xs的第一基本特征输入胶囊特征提取器，获得第一源域流量高阶样本特征，其以第一源域流量高阶向量特征s的向量形式表示，可以包括多个属性第一胶囊向量。如图6所示，最后，将第一源域流量的高阶向量特征s输入流量分类网络C，流量分类网络C可以对第一源域流量的高阶向量特征s进行非线性化，获得源域流量的高阶向量特征s的非线性化结果。举例来说，对于第i个属性的第一胶囊向量sj，可以使用如式四所示的squash函数规范第i个第一输出向量sj的长度在0~1之间，获得源域流量的第j个第一输出向量sj的非线性化结果vj，即源域流量的第j个预测状态。在此基础上，可以比较多个第一胶囊向量的非线性化结果的大小，将非线性化结果最大时对应的源域流量状态确定为源域流量的预测状态，该过程可以表示，Pc表示源域流量状态的预测分类结果，/＞表示第一源域流量的高阶特征。可见，由于通过胶囊特征提取器得到的第一源域流量的高阶向量特征s为矢量形式，流量分类网络主要是通过squash函数，获得第一源域流量的高阶向量特征s的模长，并将其作为源域流量状态的预测分类结果，从而达到对源域流量样本数据进行状态类别分类的目的。此后，可以取模长最大的结果对应的源域流量状态作为源域流量的预测状态。本公开示例性实施例在第一次监督式训练完成一次预测分类结果预测后，可以通过式二所示的类别分类损失函数Lc计算某个源域流量样本数据的单个类别的流量状态的实际分类损失，然后将所有类别的流量状态的实际分类损失求和，可得到源域流量样本数据的实际分类损失，如果有多个源域流量样本数据，也可以将多个源域流量样本数据的实际分类损失进行加和，获得第一次监督式训练的实际分类损失。式六其中，表示第c个流量状态类别，/＞表示流量分类网络输出的第c个流量状态类别的概率值；/＞表示分类指示函数，假设k表示第k个流量状态类别，当源域流量样本数据的流量状态标签为第k个流量状态类别，且c=k时，/＞，否则/＞；可见，本公开示例性实施例可以通过源域流量样本数据的流量状态标签和源域流量状态的预测分类结果可以确定其中分类指示函数/＞的取值。表示惩罚假阳性，可以认为是概率值的上边界，可以取固定值0.9，当/＞＞0.9时，将损失函数置为0；/＞表示惩罚假阴性，可以认为是概率值的下边界，取固定值0.1，当＜0.1时，将损失函数置为0；/＞表示比例系数，用来调整两项比例，通常取值0.5。如图6所示，设源域特征提取器、胶囊提取器/＞和流量分类网络/＞的模型参数表示为/＞，可以通过最小化类别分类损失函数来进行模型参数优化。假设胶囊特征提取器包括的数字胶囊层的数量为1，且输入的源域流量样本数据的样本数量为1，可以通过式七至式八所示的最小化类别分类损失函数优化第一特征提取器/＞的模型参数/＞，胶囊特征提取器/＞的模型参数/＞和流量分类网络/＞的模型参数/＞。式七式八式九其中，表示第一特征提取器/＞的模型参数/＞的优化值，/＞表示胶囊特征提取器/＞的模型参数/＞的优化值，/＞表示流量分类网络/＞的模型参数/＞的优化值。本公开示例性实施例在完成第一次监督式训练后，可以对目标域流量数据进行分类测试，而且，通过第一次监督式训练，可以利用第一特征提取器的模型参数和非线性层的优化参数，而通过第一特征提取器的模型参数可以对第二特征提取器的模型参数进行初始化。如图6所示，本公开示例性实施例在第二次监督式训练的目的是混淆源域流量样本数据和目标域流量样本数据，可以利用第一次监督式训练所获得的第一特征提取器Gs对第二特征提取器Gt进行初始化，然后将源域流量样本数据输入第一特征提取器Gs，获得源域流量样本数据xs的第二基本特征Gs。应理解，此处源域流量样本数据xs可以为重新获取的源域流量样本数据，也可以是原有的源域流量样本数据xs。同时，将目标域流量样本数据输入第二特征提取器Gt，获得目标域流量的基本特征Gt。接着将源域流量样本数据xs的第二基本特征Gs和目标域流量的基本特征Gt输入胶囊特征提取器，可以获得第二源域流量高阶样本特征/＞和目标域流量高阶样本特征/＞。将第二源域流量高阶样本特征和目标域流量高阶样本特征输入域对抗网络，域对抗网络D中的梯度反转层GRL可以对第二源域流量高阶样本特征/＞和目标域流量高阶样本特征/＞进行恒等变换，然后域对抗网络D可以通过全连接方式对第二源域流量高阶样本特征/＞和目标域流量高阶样本特征/＞进行领域分类，从而获得领域分类的预测结果。示例性的，上述第二源域流量高阶样本特征实质可以包括胶囊特征提取器中各个数字胶囊层输出的源域流量的预测向量，目标域流量高阶样本特征实质可以包括各个数字胶囊层输出的目标域流量的预测向量。考虑到第二次监督式训练进行模型参数优化时，基于领域分类任务为二分类任务，本公开示例性实施例在进行第二次监督式训练时所使用的领域分类损失函数Ld可以为交叉熵损失函数，其可以表示为式十：式十其中，表示以第i个源域流量样本数据为输入，域对抗网络输出的第一个预测向量，/＞表示以第i个源域流量样本数据，域对抗网络输出的第二个预测向量；/＞表示以第i个目标域流量样本数据为输入，域对抗网络输出的第一个预测向量，/＞表示以第i个目标域流量样本数据为输入，域对抗网络输出的第二个预测向量。假设第一个输出数值表示源域流量，第二个表示目标域流量，领域分类标签包括源域流量样本数据的领域标签和目标域流量样本数据的领域标签，ns表示源域流量样本数据的样本总数，nt表示目标流量样本数据的样本总数。鉴于第二特征提取器的目标是最大化领域分类损失，而域对抗网络的目标是最小化领域分类损失，二者的模型参数优化方向相反，因此，本公开示例性实施例在第二次监督式训练时，在域对抗网络引入梯度反转层，梯度反转层在反向传播过程对域对抗层的领域分类损失梯度自动取反，使得领域分类损失梯度在传播到第二域特征提取器的模型参数之前自动反向，达到与生成对抗网络相似的效果。示例性的，本公开示例性实施例的梯度反转层的相关表达式可以如式十一所示，而在反向传播过程中，梯度反转层的梯度反转功能可以通过式十二实现，具体如下：式十一式十二I为单位矩阵，λp表示梯度反转参数，其呈现动态变化，可以表示为式十三，具体如下：式十三p表示迭代进程相对值，即当前迭代次数与总迭代次数的比率，γ表示常数，可以取10。本公开示例性实施例在第二次监督式训练时，还可以通过交替迭代通过交替迭代方式更新域对抗网络的模型参数和第一次监督式训练获得的胶囊提取网络的模型参数。在实际应用中，本公开示例性实施例先固定胶囊特征提取器的模型参数和流量分类网络/＞的模型参数，然后在获取到领域分类的预测结果时，可以通过式十四所示的公式最小化领域分类损失函数的方式更新域对抗网络的模型参数。式十四其中，表示域对抗网络的模型参数/＞的优化值，/＞表示第二特征提取器的模型参数/＞的优化值，/＞表示胶囊特征提取器的模型参数的优化值。在完成域对抗网络的模型参数的优化值的一次更新后，可以固定对抗网络的模型参数和胶囊特征提取器的模型参数，然后以源域流量样本数据和目标域流量样本数据为数据集开始下一次训练。这一次在获取到领域分类的预测结果后，可以通过如式十五所示的最大化领域分类损失函数进行第二特征提取器的模型参数优化。式十五在完成第二次监督式训练后，本公开示例性实施例可以以目标域流量数据为输入，进行目标域流量数据类别分类测试。考虑到第二次监督式训练可以混淆源域流量样本数据和目标域流量样本数据，因此，通过流量分类网络可以比较准确的预测源域流量状态和目标域流量状态。本公开示例性实施例还可以提供一种流量检测方法，其可以应用本公开示例性实施例的训练方法训练的流量检测模型。图7示出了本公开示例性实施例的流量检测方法的流程示意图。如图7所示，本公开示例性实施例的流量检测方法可以包括：步骤701：将目标域流量信息输入胶囊提取网络，获得目标域流量的高阶特征。此处目标域流量信息所涉及的目标域网络可以是指训练阶段所指的目标域网络，该目标域网络可以是指各种可能的网络，例如：校园网络、家庭网络、公司网络等各种网络，但不仅限于此。步骤702：将目标域流量的高阶特征输入流量分类网络，获得目标域流量状态的分类结果。该目标域流量状态的分类结果可能包括一个或多个分类结果，每个分类结果可以通过概率的方式表示其分类可能性。步骤703：基于目标域流量状态的分类结果确定目标域的流量状态。当每个分类结果通过概率方式表示其分类可能性时，可以分类可能性大于预设阈值的分类结果对应的目标域的流量状态，也可以比较各个分类结果的分类可能性，选择分类可能性最高的分类结果对应的目标域流量状态。在一种可选方式中，本公开示例性实施例的胶囊提取网络至少包括第一特征提取器和胶囊特征提取器时，本公开示例性实施例的第一特征提取器用于基于目标域流量信息获得目标域流量的基本特征，而胶囊特征提取器用于基于目标域流量的基本特征获得目标域流量的高阶特征。此处目标域流量的高阶特征包括多个目标域的胶囊特征通过耦合参数形成的耦合结果。示例性的，当胶囊提取特征可以通过主胶囊层对目标域流量的基本特征进行初始化，获得目标域流量的多个胶囊输入特征，每个数字胶囊层对目标域流量的多个胶囊输入特征进行仿射变换，获得多个仿射变换结果，接着将多个仿射变换结果通过耦合系数进行加权，从而获得数字胶囊层输出的目标域流量的输出向量，接着通过流量分类网络对各个数字胶囊层输出的目标域流量的输出向量模长进行规范化，获得多个目标域流量的分类概率，选择其中分类概率最高的类别为目标域的流量状态。本公开实施例中提供的一个或多个技术方案中，在第一次监督式训练过程中，通过胶囊提取网络保证其所输出的第一源域流量高阶样本特征充分反映源域流量样本数据的底层特征和高层特征，使得所训练的流量分类网络可以准确对源域流量状态进行检测。而在第二次监督式训练过程中，可以通过第一次监督式训练获得的胶囊提取网络，使得第一次监督式训练获取的胶囊提取网络提取到的第二源域流量高阶样本特征可以充分反映源域流量样本数据的底层特征和高层特征，而目标域流量高阶样本特征可以充分反映目标域流量样本数据的底层特征和高层特征。在此基础上，本公开示例性实施例的方法在第二次监督式训练时，域对抗网络用于对所述第二源域流量高阶样本特征和目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征，基于所述域间自适应对齐特征确定领域分类的预测结果，而通过训练过程中的反向传播过程，使得域对抗网络可以尽可能将第一源域流量高阶样本特征和目标域流量高阶样本特征映射到同一特征空间，并在该特征空间的距离逐渐接近。可见，本公开示例性实施例通过对流量检测模型的训练，可以保证胶囊提取网络从目标域流量信息和源域流量信息提取到尽可能相同的高层特征。当训练完成的流量检测模型应用于目标域流量检测时，胶囊提取网络所提取到的目标域流量的高阶特征可以适用于通过基于源域流量样本数据所训练的流量分类网络，从而保证流量分类网络可以准确识别目标域流量状态，因此，本公开示例性实施例的流量分类网络虽然由源域流量样本数据训练，但是通过训练域对抗网络，使得流量分类网络可以准确的实现从源域流量到目标域流量的跨域检测，从而削弱因为目标域网络场景和源域网络场景的域偏移所产生的流量检测准确率下降的问题。上述主要从方法的角度对本公开实施例提供的方案进行了介绍。可以理解的是，本公开示例性实施例实现本公开示例性实施例方法的装置可以包含执行各个功能相应的硬件结构和/或软件模块。本领域技术人员应该很容易意识到，结合本文中所公开的实施例描述的各示例的单元及算法步骤，本公开能够以硬件或硬件和计算机软件的结合形式来实现。某个功能究竟以硬件还是计算机软件驱动硬件的方式来执行，取决于技术方案的特定应用和设计约束条件。专业技术人员可以对每个特定的应用来使用不同方法来实现所描述的功能，但是这种实现不应认为超出本公开的范围。本公开实施例可以根据上述方法示例对实现本公开示例性实施例方法的装置进行功能单元的划分，例如，可以对应各个功能划分各个功能模块，也可以将两个或两个以上的功能集成在一个处理模块中。上述集成的模块既可以采用硬件的形式实现，也可以采用软件功能模块的形式实现。需要说明的是，本公开实施例中对模块的划分是示意性的，仅仅为一种逻辑功能划分，实际实现时可以有另外的划分方式。在采用对应各个功能划分各个功能模块的情况下，本公开示例性实施例提供一种训练装置，该训练装置可以为电子设备或应用于电子设备的芯片。图8示出了根据本公开示例性实施例的训练装置的功能模块示意性框图。如图8所示，该训练装置800用于训练流量检测模型，所述流量检测模型包括：胶囊提取网络、流量分类网络以及域对抗网络，所述训练装置800包括：第一训练模块801，用于基于源域流量样本数据对所述胶囊提取网络和所述流量分类网络进行第一次监督式训练，所述胶囊提取网络用于基于所述源域流量样本数据确定第一源域流量高阶样本特征，所述流量分类网络用于基于所述源域流量高阶样本特征获取源域流量状态的预测分类结果；第二训练模块802，用于基于所述源域流量样本数据和目标域流量样本数据对所述第一次监督式训练获得的所述胶囊提取网络和所述域对抗网络进行第二次监督式训练，所述第一次监督式训练获得的胶囊提取网络用于基于所述源域流量样本数据和所述目标域流量样本数据确定第二源域流量高阶样本特征和目标域流量高阶样本特征，所述域对抗网络用于对所述第二源域流量高阶样本特征和目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征，基于所述域间自适应对齐特征确定领域分类的预测结果。在一种可能的实现方式中，所述胶囊提取网络的模型参数和所述流量分类网络的模型参数在所述第一次监督式训练过程的更新方式包括最小化类别分类损失函数的更新方式。在一种可能的实现方式中，所述域对抗网络的模型参数和所述第一次监督式训练获得的胶囊提取网络的模型参数在所述第二次监督式训练的更新方式包括：通过交替迭代方式更新所述域对抗网络的模型参数和所述第一次监督式训练获得的胶囊提取网络的模型参数。在一种可能的实现方式中，所述域对抗网络的模型参数的更新方式为最小化领域分数损失函数的更新方式，所述第一次监督式训练获得的胶囊提取网络的模型参数的更新方式为最大化领域分类损失函数的更新方式。在一种可能的实现方式中，所述域对抗网络包括：梯度反转层，用于对所述第二源域流量高阶样本特征和所述目标域流量高阶样本特征进行自适应对齐，获得域间自适应对齐特征；域分类器，用于基于所述域间自适应对齐特征，获得所述领域分类的预测结果。在一种可能的实现方式中，所述胶囊提取网络包括：第一特征提取器，用于在第一次监督式训练过程中基于所述源域流量样本数据确定源域流量的多个第一基本特征，在所述第二次监督式训练过程中基于所述源域流量样本数据确定源域流量的多个第二基本特征；第二特征提取器，用于在所述第二次监督式训练过程中基于所述目标域流量样本数据确定目标域流量的多个基本特征；胶囊特征提取器，用于在所述第一次监督式训练过程中基于所述源域流量的多个第一基本特征确定所述第一源域流量高阶样本特征，在所述第二次监督式训练过程中基于所述源域流量的多个第二基本特征确定所述第二源域流量高阶样本特征，基于所述目标域流量的多个基本特征确定所述目标域流量高阶样本特征。在一种可能的实现方式中，所述流量分类网络用于在所述第一次监督式训练中对所述第一源域流量高阶样本特征进行非线性化处理，获得所述源域流量状态的预测分类结果。在一种可能的实现方式中，所述第一源域流量高阶样本特征包括所述源域流量的多个属性第一胶囊样本特征，所述第二源域流量高阶样本特征包括所述源域流量的多个属性第二胶囊样本特征，所述目标域流量高阶样本特征包括多个属性所述目标域的胶囊样本特征。在采用对应各个功能划分各个功能模块的情况下，本公开示例性实施例提供一种流量检测装置，该流量检测装置可以为电子设备或应用于电子设备的芯片。图9示出了根据本公开示例性实施例的流量检测装置的功能模块示意性框图。如图9所示，该流量检测装置900应用本公开示例性实施例所述方法训练的流量检测模型，包括：提取模块901，用于将目标域流量信息输入胶囊提取网络，获得目标域流量的高阶特征；分类模块902，用于将所述目标域流量的高阶特征输入流量分类网络，获得目标域流量状态的分类结果；确定模块903，用于基于所述目标域流量状态的分类结果确定目标域的流量状态。在一种可能的实现方式中，所述目标域流量的高阶特征包括多个所述目标域的胶囊特征通过耦合参数形成的耦合结果，所述胶囊提取网络至少包括第一特征提取器和胶囊特征提取器；所述第一特征提取器用于基于所述目标域流量信息获得目标域流量的基本特征；所述胶囊特征提取器用于基于所述目标域流量的基本特征获得所述目标域流量的高阶特征。图10示出了根据本公开示例性实施例的芯片的示意性框图。如图10所示，该芯片1000包括一个或两个以上处理器1001和通信接口1002。通信接口1002可以支持服务器执行上述图像处理方法中的数据收发步骤，处理器1001可以支持服务器执行上述图像处理方法中的数据处理步骤。可选的，如图10所示，该芯片1000还包括存储器1003，存储器1003可以包括只读存储器和随机存取存储器，并向处理器提供操作指令和数据。存储器的一部分还可以包括非易失性随机存取存储器。在一些实施方式中，如图10所示，处理器1001通过调用存储器存储的操作指令，执行相应的操作。处理器1001控制终端设备中任一个的处理操作，处理器还可以称为中央处理单元。存储器1003可以包括只读存储器和随机存取存储器，并向处理器1001提供指令和数据。存储器1003的一部分还可以包括NVRAM。例如应用中存储器、通信接口以及存储器通过总线系统耦合在一起，其中总线系统除包括数据总线之外，还可以包括电源总线、控制总线和状态信号总线等。但是为了清楚说明起见，在图10中将各种总线都标为总线系统1004。上述本公开实施例揭示的方法可以应用于处理器中，或者由处理器实现。处理器可能是一种集成电路芯片，具有信号的处理能力。在实现过程中，上述方法的各步骤可以通过处理器中的硬件的集成逻辑电路或者软件形式的指令完成。上述的处理器可以是通用处理器、数字信号处理器、ASIC、现成可编程门阵列或者其他可编程逻辑器件、分立门或者晶体管逻辑器件、分立硬件组件。可以实现或者执行本公开实施例中的公开的各方法、步骤及逻辑框图。通用处理器可以是微处理器或者该处理器也可以是任何常规的处理器等。结合本公开实施例所公开的方法的步骤可以直接体现为硬件译码处理器执行完成，或者用译码处理器中的硬件及软件模块组合执行完成。软件模块可以位于随机存储器，闪存、只读存储器，可编程只读存储器或者电可擦写可编程存储器、寄存器等本领域成熟的存储介质中。该存储介质位于存储器，处理器读取存储器中的信息，结合其硬件完成上述方法的步骤。本公开示例性实施例还提供一种电子设备，包括：至少一个处理器；以及与至少一个处理器通信连接的存储器。所述存储器存储有能够被所述至少一个处理器执行的计算机程序，所述计算机程序在被所述至少一个处理器执行时用于使所述电子设备执行根据本公开实施例的方法。本公开示例性实施例还提供一种存储有计算机程序的非瞬时计算机可读存储介质，其中，所述计算机程序在被计算机的处理器执行时用于使所述计算机执行根据本公开实施例的方法。本公开示例性实施例还提供一种计算机程序产品，包括计算机程序，其中，所述计算机程序在被计算机的处理器执行时用于使所述计算机执行根据本公开实施例的方法。参考图11，现将描述可以作为本公开的服务器或客户端的电子设备1100的结构框图，其是可以应用于本公开的各方面的硬件设备的示例。电子设备旨在表示各种形式的数字电子的计算机设备，诸如，膝上型计算机、台式计算机、工作台、个人数字助理、服务器、刀片式服务器、大型计算机、和其它适合的计算机。电子设备还可以表示各种形式的移动装置，诸如，个人数字处理、蜂窝电话、智能电话、可穿戴设备和其它类似的计算装置。本文所示的部件、它们的连接和关系、以及它们的功能仅仅作为示例，并且不意在限制本文中描述的和/或者要求的本公开的实现。如图11所示，电子设备1100包括计算单元1101，其可以根据存储在只读存储器1102中的计算机程序或者从存储单元1108加载到随机访问存储器1103中的计算机程序，来执行各种适当的动作和处理。在RAM 1103中，还可存储设备1100操作所需的各种程序和数据。计算单元1101、ROM 1102以及RAM 1103通过总线1104彼此相连。输入/输出接口1105也连接至总线1104。如图11所示，电子设备1100中的多个部件连接至I/O接口1105，包括：输入单元1106、输出单元1107、存储单元1108以及通信单元1109。输入单元1106可以是能向电子设备1100输入信息的任何类型的设备，输入单元1106可以接收输入的数字或字符信息，以及产生与电子设备的用户设置和/或功能控制有关的键信号输入。输出单元1107可以是能呈现信息的任何类型的设备，并且可以包括但不限于显示器、扬声器、视频/音频输出终端、振动器和/或打印机。存储单元1108可以包括但不限于磁盘、光盘。通信单元1109允许电子设备1100通过诸如因特网的计算机网络和/或各种电信网络与其他设备交换信息/数据，并且可以包括但不限于调制解调器、网卡、红外通信设备、无线通信收发机和/或芯片组，例如蓝牙TM设备、WiFi设备、WiMax设备、蜂窝通信设备和/或类似物。如图11所示，计算单元1101可以是各种具有处理和计算能力的通用和/或专用处理组件。计算单元1101的一些示例包括但不限于中央处理单元、图形处理单元、各种专用的人工智能计算芯片、各种运行机器学习模型算法的计算单元、数字信号处理器、以及任何适当的处理器、控制器、微控制器等。计算单元1101执行上文所描述的各个方法和处理。例如，在一些实施例中，本公开示例性实施例的方法可被实现为计算机软件程序，其被有形地包含于机器可读介质，例如存储单元1108。在一些实施例中，计算机程序的部分或者全部可以经由ROM 1102和/或通信单元1109而被载入和/或安装到电子设备1100上。在一些实施例中，计算单元1101可以通过其他任何适当的方式而被配置为执行本公开示例性实施例的方法。用于实施本公开的方法的程序代码可以采用一个或多个编程语言的任何组合来编写。这些程序代码可以提供给通用计算机、专用计算机或其他可编程数据处理装置的处理器或控制器，使得程序代码当由处理器或控制器执行时使流程图和/或框图中所规定的功能/操作被实施。程序代码可以完全在机器上执行、部分地在机器上执行，作为独立软件包部分地在机器上执行且部分地在远程机器上执行或完全在远程机器或服务器上执行。在本公开的上下文中，机器可读介质可以是有形的介质，其可以包含或存储以供指令执行系统、装置或设备使用或与指令执行系统、装置或设备结合地使用的程序。机器可读介质可以是机器可读信号介质或机器可读储存介质。机器可读介质可以包括但不限于电子的、磁性的、光学的、电磁的、红外的、或半导体系统、装置或设备，或者上述内容的任何合适组合。机器可读存储介质的更具体示例会包括基于一个或多个线的电气连接、便携式计算机盘、硬盘、随机存取存储器、只读存储器、可擦除可编程只读存储器、光纤、便捷式紧凑盘只读存储器、光学储存设备、磁储存设备、或上述内容的任何合适组合。如本公开使用的，术语“机器可读介质”和“计算机可读介质”指的是用于将机器指令和/或数据提供给可编程处理器的任何计算机程序产品、设备、和/或装置)，包括，接收作为机器可读信号的机器指令的机器可读介质。术语“机器可读信号”指的是用于将机器指令和/或数据提供给可编程处理器的任何信号。为了提供与用户的交互，可以在计算机上实施此处描述的系统和技术，该计算机具有：用于向用户显示信息的显示装置或者LCD监视器）；以及键盘和指向装置，用户可以通过该键盘和该指向装置来将输入提供给计算机。其它种类的装置还可以用于提供与用户的交互；例如，提供给用户的反馈可以是任何形式的传感反馈；并且可以用任何形式来接收来自用户的输入。可以将此处描述的系统和技术实施在包括后台部件的计算系统、或者包括中间件部件的计算系统、或者包括前端部件的计算系统、或者包括这种后台部件、中间件部件、或者前端部件的任何组合的计算系统中。可以通过任何形式或者介质的数字数据通信来将系统的部件相互连接。通信网络的示例包括：局域网、广域网和互联网。计算机系统可以包括客户端和服务器。客户端和服务器一般远离彼此并且通常通过通信网络进行交互。通过在相应的计算机上运行并且彼此具有客户端-服务器关系的计算机程序来产生客户端和服务器的关系。在上述实施例中，可以全部或部分地通过软件、硬件、固件或者其任意组合来实现。当使用软件实现时，可以全部或部分地以计算机程序产品的形式实现。所述计算机程序产品包括一个或多个计算机程序或指令。在计算机上加载和执行所述计算机程序或指令时，全部或部分地执行本公开实施例所述的流程或功能。所述计算机可以是通用计算机、专用计算机、计算机网络、终端、用户设备或者其它可编程装置。所述计算机程序或指令可以存储在计算机可读存储介质中，或者从一个计算机可读存储介质向另一个计算机可读存储介质传输，例如，所述计算机程序或指令可以从一个网站站点、计算机、服务器或数据中心通过有线或无线方式向另一个网站站点、计算机、服务器或数据中心进行传输。所述计算机可读存储介质可以是计算机能够存取的任何可用介质或者是集成一个或多个可用介质的服务器、数据中心等数据存储设备。所述可用介质可以是磁性介质，例如，软盘、硬盘、磁带；也可以是光介质，例如，数字视频光盘；还可以是半导体介质，例如，固态硬盘。尽管结合具体特征及其实施例对本公开进行了描述，显而易见的，在不脱离本公开的精神和范围的情况下，可对其进行各种修改和组合。相应地，本说明书和附图仅仅是所附权利要求所界定的本公开的示例性说明，且视为已覆盖本公开范围内的任意和所有修改、变化、组合或等同物。显然，本领域的技术人员可以对本公开进行各种改动和变型而不脱离本公开的精神和范围。这样，倘若本公开的这些修改和变型属于本公开权利要求及其等同技术的范围之内，则本公开也意图包括这些改动和变型在内。
