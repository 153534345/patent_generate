标题title
一种车载监控系统监控画面角点标定方法
摘要abst
本发明提供一种车载监控系统监控画面角点标定方法，其可以快速且准确地完成车载摄像头的角点检测，鲁棒性较强，适用于大部分应用场景。其基于轻量级网络MobileNetV3和注意力机制构建主干网络，在主干网中对输入图像进行下采样进行特征提取，降低计算量，提高计算速度；同时将主干网网络中卷积过程中的损失特征信息补充到特征融合解码器的上采样过程中，确保最终的检测结果更为准确。
权利要求书clms
1.一种车载监控系统监控画面角点标定方法，其包括以下步骤：S1：采集与处理训练数据，构建训练数据集；其特征在于，其还包括以下步骤：S2：构建角点检测网络模型；所述角点检测网络模型包括：依次连接的主干网络、特征融合解码器和预测头；所述主干网络基于融入了空间注意力模块的轻量级网络MobileNetV3构建；所述空间注意力模块包括：一个通道维度平均池化层、一个通道维度最大池化层，卷积层和激活函数；所述主干网络中首先对图像进行32倍下采样，然后经过所述空间注意力模块处理后，得到主干网输出特征，送入到所述特征融合解码器中；所述特征融合解码器对输入的特征图中进行逐层上采样操作；将所述主干网络中下采样操作的损失特征信息补充到所述特征融合解码器中的上采样操作的结果中，得到特征融合后输出图，将所述特征融合后输出图送入所述预测头，输出预测结果；所述角点检测网络模型中，具体包括以下步骤：a1：所述主干网络对输入图像进行32倍下采样，得到下采样后特征图；所述下采样操作包括依次设置的：4倍下采样、8倍下采样、16倍下采样和32倍下采样；在每一次下采样过程中依次取出每次的下采样特征，分别命名为C1、C2、C3、C4；a2：将所述下采样后特征图送入所述空间注意力模块处理后，得到主干网输出特征；a3：将所述主干网输出特征、C1、C2、C3和C4作为所述特征融合解码器的输入；a4：在所述特征融合解码器中的处理包括以下步骤：b1：对所述主干网输出特征进行2倍上采样处理后，结合C4得到P4；b2：将P4和C3在通道维度上进行拼接，然后经过两层卷积神经网络进行进一步特征提取，得到的特征同样进行最近邻插值2倍上采样，得到P3；b3：将P3和C2在通道维度上进行拼接，并经过两层卷积神经网络进行进一步特征提取，得到融合特征P2；b4：将P2和C1在通道维度上进行拼接，再通过一层反卷积神经网络进行2倍上采样，得到特征融合后输出图，记作：P1；a5：将P1送入所述预测头，得到最终的角点信息；S3：基于所述训练数据集对所述角点检测网络模型进行训练，得到训练好的所述角点检测网络模型；S4：基于车载监控系统的摄像头实时采集待检测图像，将所述待检测图像送入到训练好的所述角点驾车网络模型中，得到所述待检测图像对应的角点标定结果。2.根据权利要求1所述一种车载监控系统监控画面角点标定方法，其特征在于：步骤a2中，所述空间注意力模块中的注意力机制操作，具体包括以下步骤：输入的特征图像分别送入一个通道维度平均池化层和一个通道维度最大池化层，将两个池化层的输出送入卷积层，在所述卷积层中进行卷积操作；将所述卷积层的输出送入Sigmoid激活函数进行计算注意力分数，再和输入特征相乘，得到所述主干网输出特征。3.根据权利要求1所述一种车载监控系统监控画面角点标定方法，其特征在于：所述预测头包括：依次连接的两层卷积网络和一个激活函数，输入特征图经过卷积网络和激活函数处理后输出热力图，热力图再经过极值化处理，得到最终的角点信息。4.根据权利要求1所述一种车载监控系统监控画面角点标定方法，其特征在于：步骤S1中，所述训练数据集的构建方法包括以下步骤：c1：在不同时间、不同地点的不同车内，利用车身四周的镜头采集多组业务场景图像，所述业务场景图像中包含地面棋盘格；c2：对所述业务场景图像中的角点和棋盘格区域进行标注；c3：对标注后的业务场景图像进行预处理操作；所述预处理操作包括：resize、水平和垂直方向随机平移、随机旋转、随机色调变换、随机亮度变换、随机对比度变换、随机更换背景、以及随机添加mask。5.根据权利要求1所述一种车载监控系统监控画面角点标定方法，其特征在于：步骤S3中，对所述角点检测网络模型的训练，基于反向传播算法，利用Adam优化器进行训练，训练过程中使用的损失函数为Focal Loss。
说明书desc
技术领域本发明涉及智能交通控制技术领域，具体为一种车载监控系统监控画面角点标定方法。背景技术随着汽车技术的快速发展，汽车安全性和驾驶辅助系统的需求不断增加。为了提供更全方位的视野和帮助驾驶员准确判断车辆位置、障碍物距离等信息，车身周围监控系统通过在汽车四周安装鱼眼摄像头来实现。然而，要实现精准的车身标定，需要能够准确检测出摄像头画面中的角点位置。现有技术中大多采用传统的基于图像处理的角点检测算法在鱼眼摄像头标定中角点位置，常见的如Harris角点检测、Shi-Tomasi角点检测、FAST角点检测等。通常，其大致流程如图1所示。然而，传统的基于图像处理的角点检测算法在鱼眼摄像头标定中存在一些局限性。首先，由于鱼眼摄像头的特殊成像方式，图像中的目标物体会发生畸变，另外，现实场景复杂，如背景繁杂、亮度、对比度、标定板污渍甚至遮挡等，导致传统角点算法的不准确。随着深度学习技术的发展，也有技术人员将深度学习引入角点检测算法中。如申请号为CN201910778486.4所示的技术方案，其使用卷积神经网络对车载摄像头采集的图像进行角点定位。但是，在实际的使用中，因为卷积神经网络的计算时间较长，可以适用于停车等低速场景，但无法满足行驶中的车辆的实时性的要求，同时，卷积神经网络在下采样的过程中会丢失一部分图像特征信息，直接进行反卷积后生成的图像不但准确度不高，导致计算结果不够精准，而且反卷积操作非常占用算力空间，因而无法满足行驶中的车辆的定位准确性的需求，进而导致现有的基于深度学习进行角点检测的方法适用场景有限。发明内容为了解决现有的基于深度学习进行焦点检测的方法适用场景有限的问题，本发明提供一种车载监控系统监控画面角点标定方法，其可以快速且准确地完成车载摄像头的角点检测，鲁棒性较强，适用于大部分应用场景。本发明的技术方案是这样的：一种车载监控系统监控画面角点标定方法，其包括以下步骤：S1：采集与处理训练数据，构建训练数据集；其还包括以下步骤：S2：构建角点检测网络模型；所述角点检测网络模型包括：依次连接的主干网络、特征融合解码器和预测头；所述主干网络基于融入了空间注意力模块的轻量级网络MobileNetV3构建；所述空间注意力模块包括：一个通道维度平均池化层、一个通道维度最大池化层，卷积层和激活函数；所述主干网络中首先对图像进行32倍下采样，然后经过所述空间注意力模块处理后，得到主干网输出特征，送入到所述特征融合解码器中；所述特征融合解码器对输入的特征图中进行逐层上采样操作；将所述主干网络中下采样操作的损失特征信息补充到所述特征融合解码器中的上采样操作的结果中，得到特征融合后输出图，将所述特征融合后输出图送入所述预测头，输出预测结果；所述角点检测网络模型中，具体包括以下步骤：a1：所述主干网络对输入图像进行32倍下采样，得到下采样后特征图；所述下采样操作包括依次设置的：4倍下采样、8倍下采样、16倍下采样和32倍下采样；在每一次下采样过程中依次取出每次的下采样特征，分别命名为C1、C2、C3、C4；a2：将所述下采样后特征图送入所述空间注意力模块处理后，得到主干网输出特征；a3：将所述主干网输出特征、C1、C2、C3和C4作为所述特征融合解码器的输入；a4：在所述特征融合解码器中的处理包括以下步骤：b1：对所述主干网输出特征进行2倍上采样处理后，结合C4得到P4；b2：将P4和C3在通道维度上进行拼接，然后经过两层卷积神经网络进行进一步特征提取，得到的特征同样进行最近邻插值2倍上采样，得到P3；b3：将P3和C2在通道维度上进行拼接，并经过两层卷积神经网络进行进一步特征提取，得到融合特征P2；b4：将P2和C1在通道维度上进行拼接，再通过一层反卷积神经网络进行2倍上采样，得到特征融合后输出图，记作：P1；a5：将P1送入所述预测头，得到最终的角点信息；S3：基于所述训练数据集对所述角点检测网络模型进行训练，得到训练好的所述角点检测网络模型；S4：基于车载监控系统的摄像头实时采集待检测图像，将所述待检测图像送入到训练好的所述角点驾车网络模型中，得到所述待检测图像对应的角点标定结果。其进一步特征在于：步骤a2中，所述空间注意力模块中的注意力机制操作，具体包括以下步骤：输入的特征图像分别送入一个通道维度平均池化层和一个通道维度最大池化层，将两个池化层的输出送入卷积层，在所述卷积层中进行卷积操作；将所述卷积层的输出送入Sigmoid激活函数进行计算注意力分数，再和输入特征相乘，得到所述主干网输出特征；所述预测头包括：依次连接的两层卷积网络和一个激活函数，输入特征图经过卷积网络和激活函数处理后输出热力图，热力图再经过极值化处理，得到最终的角点信息；步骤S1中，所述训练数据集的构建方法包括以下步骤：c1：在不同时间、不同地点的不同车内，利用车身四周的镜头采集多组业务场景图像，所述业务场景图像中包含地面棋盘格；c2：对所述业务场景图像中的角点和棋盘格区域进行标注；c3：对标注后的业务场景图像进行预处理操作；所述预处理操作包括：resize、水平和垂直方向随机平移、随机旋转、随机色调变换、随机亮度变换、随机对比度变换、随机更换背景、以及随机添加mask；步骤S3中，对所述角点检测网络模型的训练，基于反向传播算法，利用Adam优化器进行训练，训练过程中使用的损失函数为Focal Loss。本发明提供的一种车载监控系统监控画面角点标定方法，基于轻量级网络MobileNetV3和注意力机制构建主干网络，在主干网中对输入图像进行下采样进行特征提取，降低计算量，提高计算速度，其并行计算优势使得角点检测算操作能够在实际应用中快速响应，满足各种场景下的实时性的要求；同时将主干网网络中卷积过程中的损失特征信息补充到特征融合解码器的上采样过程中，确保最终的检测结果更为准确；本申请中的角点检测网络模型经过大量数据学习之后，可以自动识别标准、非标准、畸变、非畸变等各种情况下的标定板角点，同时具有良好的适应性，对于鱼眼摄像头畸变、现实场景复杂等问题具有鲁棒性。附图说明图1为现有技术中的角点检测算法流程图；图2为本申请中的基于轻量级网络和注意力机制的角点检测算法的架构示意图；图3为主干网络中的上采样和下采样过程示意图；图4为空间注意力模块中的注意力机制操作过程示意图；图5为注意力机制操作过程示例；图6为检测头机制示意图；图7为实施例中实际场景数据图；图8为实施例中的热力图效果对比图；图9为实施例中自动标定结果对比图。具体实施方式本申请包括一种车载监控系统监控画面角点标定方法，其包括以下步骤。S1：采集与处理训练数据，构建训练数据集。训练数据集的构建方法包括以下步骤：c1：在不同时间、不同地点的不同车内，利用车身四周的镜头采集多组业务场景图像，业务场景图像中包含地面棋盘格；c2：对业务场景图像中的角点和棋盘格区域进行标注；c3：对标注后的业务场景图像进行预处理操作；预处理操作包括：resize、水平和垂直方向随机平移、随机旋转、随机色调变换、随机亮度变换、随机对比度变换、随机更换背景、以及随机添加mask。S2：构建角点检测网络模型。如图2所示，本申请中构建的角点检测网络模型包括：依次连接的主干网络、特征融合解码器和预测头。其中，如图3所示，主干网络基于融入了空间注意力模块的轻量级网络MobileNetV3构建，得到主干网络的MobileNetV3-SA，用于提取业务场景图像特征。在角点检测网络模型中，具体包括以下步骤：a1：主干网络对输入图像进行32倍下采样，得到下采样后特征图；下采样操作包括依次设置的：4倍下采样、8倍下采样、16倍下采样和32倍下采样；取出其中的下采样特征，分别命名为C1、C2、C3、C4；主干网络部分将800×800的图片信息，通过四次下采样，处理为25×25分辨率的图片，作为注意力机制模块的输入。即将800×800分辨率的图通过4倍下采样处理为200×200分辨率的图时，会出现第一次的特征信息损失；将200×200分辨率的图通过2倍下采样处理为100×100分辨率的图时，会出现第二次的特征信息损失；将100×100分辨率的图通过2倍下采样处理为50×50分辨率的图时，会出现第三次特征信息损失；将50×50分辨率的图通过2倍下采样处理为25×25分辨率的图时，会出现第四次特征信息损失。a2：将下采样后特征图送入空间注意力模块处理后，得到主干网输出特征；空间注意力模块包括：一个通道维度平均池化层、一个通道维度最大池化层，卷积层和激活函数。如图4所示，空间注意力模块中的注意力机制操作具体包括以下步骤：输入的特征图像Fc×h×W分别送入一个通道维度平均池化层fsavg和一个通道维度最大池化层fsmax，将两个池化层的输出在通道维度拼接后送入卷积层，在卷积层中进行卷积操作fsavg；fsmax；将卷积层的输出送入Sigmoid激活函数进行计算得到注意力分数Ms，再将Ms和输入特征Fc×h×W相乘，得到主干网输出特征。在图5的示例中，注意力机制操作过程为：通道维度平均池化层：25×25分辨率的图与一个7×7的矩阵进行卷积，获得一个25×25的数据矩阵为矩阵1；在进行池化操作的过程中，将25×25分辨率的特征图直接与一个7×7的矩阵进行卷积，会变成23×23的矩阵，整体变小，而为了保持矩阵尺寸不变，则需要先将对25×25的特征图在外面填充一圈，再和7×7卷积相乘就可以得到25×25的尺寸不变的数据矩阵。通道维度最大池化层：25×25分辨率的图填充后与一个7×7的矩阵进行卷积，获得一个25×25的数据矩阵为矩阵2；矩阵1与矩阵2进行拼接，然后在经过一层卷积压缩，可将通道维度平均池化层和最大池化层变为25×25分辨率的图，25×25分辨率的图即为经过注意力机制处理后的结果图，表示输入特征中的注意力分数。其中，平均池化层的作用是为了保留图片的细节信息，最大池化层的作用是保留图片的最明显特征。“fsavg；fsmax”是将两种信息进行融合，融合后的信息，更能够保存原800×800图片的特征信息；特征图经过Sigmoid激活函数进行计算后，得到注意力分数，与输入特征Fc×h×W相乘，引导模型关注更重要的区域。如图3所示，主干网络中首先对图像进行32倍下采样，得到25×25分辨率的图，送入通过注意力机制处理后变为具备充分特征信息的25×25分辨率的图，得到主干网输出特征，送入到特征融合解码器中。a3：将主干网输出特征、C1、C2、C3和C4作为特征融合解码器的输入；a4：在特征融合解码器中的处理包括以下步骤：b1：对主干网输出特征进行2倍上采样处理后，结合C4得到P4；b2：将P4和C3在通道维度上进行拼接，然后经过两层卷积神经网络进行进一步特征提取，得到的特征同样进行最近邻插值2倍上采样，得到P3；b3：将P3和C2在通道维度上进行拼接，并经过两层卷积神经网络进行进一步特征提取，得到融合特征P2；b4：将P2和C1在通道维度上进行拼接，再通过一层反卷积神经网络进行2倍上采样，得到特征融合后输出图，记作：P1；a5：将P1送入预测头，得到最终的角点信息。在上一步的将800×800分辨率的输入图像数据通过主干网络-MobilenetV3-SA，处理为2×25分辨率的图后，需要通过特征融合解码网络把25×25分辨率的图上采样回400×400分辨率的图。在MobilenetV3-SA处理的过程中，将800×800分辨率的图通过4倍下采样处理为200×200分辨率的图时，会出现第一次的特征信息损失；将200×200分辨率的图通过2倍下采样处理为100×100分辨率的图时，会出现第二次的特征信息损失；将100×100分辨率的图通过2倍下采样处理为50×50分辨率的图时，会出现第三次特征信息损失；将50×50分辨率的图通过2倍下采样处理为25×25分辨率的图时，会出现第四次特征信息损失；然而普通的反卷积解码网络不会将损失的特征信息补全。而本申请所使用的特征融合解码网络，对25×25分辨率的图先补充损失的特征信息，进行2倍上采样处理，变为50×50分辨率的图，结合第四次的已丢失特征信息，进行特征信息补充；通过对补充损失特征信息的50×50分辨率的图，进行2倍上采样处理，变为100×100分辨率的图，结合第三次的已丢失特征信息，进行特征信息补充；通过对补充损失特征信息的100×100分辨率的图，进行2倍上采样处理，变为200×200分辨率的图，结合第二次的已丢失特征信息，进行特征信息补充；最后对200×200分辨率的图进行2倍上采样，得到400×400分辨率的图。其特征信息比普通的卷积解码网络更加丰富，可使结果更优。特征融合解码器对输入的特征图中进行逐层上采样操作；将主干网络中下采样操作的损失特征信息补充到特征融合解码器中的上采样操作的结果中，得到特征融合后输出图，将特征融合后输出图送入预测头，输出预测结果。特征融合解码器处理后得到的整体2倍下采样的特征P1，送入热力图预测头，该预测头由两层卷积网络和sigmoid操作构成，最终输出一个通道为1的热力图。预测头包括：依次连接的两层卷积网络和一个激活函数，输入特征图经过卷积网络和激活函数处理后输出热力图，热力图再经过极值化处理，得到最终的角点信息。如图6所示，通过激活函数处理400×400分辨率的图，可使特征融合解码网络的热力图结果可观化效果更好；最后对400×400分辨率的图进行极值化，获取最终的角点信息。最终的角点信息的形式参照图2中的“角点信息”。S3：基于训练数据集对角点检测网络模型进行训练，得到训练好的角点检测网络模型。具体实施过程中，对角点检测网络模型的训练，基于反向传播算法，利用Adam优化器进行训练，确保训练过程能够快速迭代收敛，训练过程中使用的损失函数为Focal Loss，该损失函数有效缓解了数据正负样本不均衡的问题。S4：基于车载监控系统的摄像头实时采集待检测图像，将待检测图像送入到训练好的角点驾车网络模型中，得到待检测图像对应的角点标定结果。具体应用时，在真实场景中采集的多组标定图像进行了可视化检测，同时对mAP、F1分数、精准度、召回率、推理速度等指标上进行了评估。基于本方法进行实景应用。将车载摄像头采集到的如图7所示的分辨率为1280×800的数据图，经过预处理将其处理为800×800的分辨率的数据图：Fc×h×W，将800×800分辨率的图，通过注意力机制处理后变为25×25分辨率的主干网输出特征图。再通过特征融合解码网络把25×25分辨率的主干网输出特征图上采样为400×400分辨率的图。最后通过激活函数处理400×400分辨率的图，可使特征融合解码网络的热力图结果可观化效果更好；对400×400分辨率的图进行热力图显示，获得最终结果；最后对400×400分辨率的图进行极值化，获取最终的角点信息；作为自动标定的关键输入，从而对原图进行角点的标定。在特征提取过程中，模型中使用注意力机制与不使用注意力机制的得到的热力图差距较大，如图8所示，未使用注意机制的MobilenetV3模型输出的热力图出现部分角点未检测到的问题；而使用了本申请中使用了注意力机制的MobilenetV3-SA模型输出的热力图中所有目标角点全部检测到。从效果对比图中可明确看到MobilenetV3-SA效果优，即，注意力机制的引入为后续标定提供了准确无误的消息。将本方法中的模型与现有技术中的其他模型的标定结果进行比较，比较结果如图9所示，左上使用的为MobilenetV3和特征融合解码网络结合后的结果，9个点检测错误；右上用的为MobilenetV3-SA和特征融合解码网络结合后的结果，0个点检测错误；左下为MobilenetV3和三层反卷积神经网络结合后的结果，11个点检测错误；右下为ResNet-50和三层反卷积网络结合后的结果，13个点检测错误。从标定效果来看，使用注意力机制的标定效果优于未使用注意力机制，使用特征融合解码网络的结果优于三层反卷积网络的结果。本申请技术方案中对数据进行增强，并使用MobilenetV3-SA和特征融合解码网络结合进行角点检测，针对各种场景，都能够准确无误的检测出目标角点。使用本发明的技术方案后，基于轻量级网络和注意力机制的角点检测算法，适用于各种类型车辆的自动标定功能。与现有技术相比，本方法是一种更为通用、鲁棒的角点检测方法，可以自动识别标准、非标准、畸变、非畸变等各种情况下的标定板角点，为自动标定技术提供了强有力的支持。实现自动标定功能时，本方法可以灵活地根据用户的具体情况，对各种场地进行标定场地角点的准确无误的查找。本方法尤其适用于行进中的车载摄像头所面对的复杂背景、标准和非标准、畸变和非畸变等多种场景下的角点检测。
