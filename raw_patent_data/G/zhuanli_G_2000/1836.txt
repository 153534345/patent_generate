标题title
一种网格报表的制作方法及装置
摘要abst
本发明公开了一种网格报表的制作方法及装置，其中制作方法包括以下步骤：在当前数据库中添加其他数据库的链接；获取其他数据库的表结构信息，将所述表结构信息同步到当前数据库中；根据数据源类型配置对应的网格报表，所述数据源类型包括基础表、数据集和SQL语句中的一项或多项；创建查询语句，在当前数据库中执行所述查询语句；将查询结果呈现在所述网格报表中；本发明支持多种数据库，只要能获取到表结构信息，接着生成需要的查询语句，然后在数据库中执行，将查询结果显示出来；能够同时支持多种数据库，而且制作简单，用户容易二次开发，使用简便。
权利要求书clms
1.一种网格报表的制作方法，其特征在于，包括：在当前数据库中添加其他数据库的链接；获取其他数据库的表结构信息，将所述表结构信息同步到当前数据库中；所述表结构信息包括表名、字段名、数据类型、字段备注中的一种或多种；根据数据源类型配置对应的网格报表，所述数据源类型包括基础表、数据集和SQL语句中的一项或多项；创建查询语句，在当前数据库中执行所述查询语句；将查询结果呈现在所述网格报表中。2.根据权利要求1所述的制作方法，其特征在于，所述数据集通过以下步骤创建：选择当前数据库内的表，设置主表作为基础表，选择其他表后设置连接方式与关联字段，建立主表与一张或多张表的关联关系；根据所述关联关系创建数据集。3.根据权利要求1所述的制作方法，其特征在于：所述查询语句包括查询条件和查询列表，所述查询条件中的字段包括字符串类型、数字类型、日期类型中的一种或多种；所述查询列表中的字段后续在转化成SQL语句时会添加到Select字段中。4.根据权利要3所述的制作方法，其特征在于，当所述数据源类型为SQL语句时，将所述查询条件插入到内部查询中，具体包括：使用占位符在查询列表添加预设字段，用户输入查询内容后所述查询条件插入到原始SQL中的子查询内。5.根据权利要求1所述的制作方法，其特征在于：当所述数据源类型为SQL语句时，将所述查询结果中的代码根据字段映射表中的对应关系，转化成名称或者代码加上名称。6.根据权利要求1所述的制作方法，其特征在于，还包括：添加下钻，所述下钻中包括打开详情页模式、打开网格报表模式、打开业务系统模式中的一种或多种。7.根据权利要求6所述的制作方法，其特征在于：所述打开详情页模式用于显示表头和表体信息，所述表体信息通过在主题中添加的主表和从表的关联关系中确定。8.根据权利要求7所述的制作方法，其特征在于，所述主题通过以下步骤创建：选择当前数据库内的表，设置主表作为基础表，选择其他表后设置连接方式与关联字段，建立主表与一张或多张从表的关联关系，用于下钻的时候使用。9.一种网格报表的制作装置，其特征在于，包括：添加单元，用于在当前数据库中添加其他数据库的链接；获取单元，用于获取其他数据库的表结构信息，将所述表结构信息同步到当前数据库中；配置单元，用于根据数据源类型配置对应的网格报表，所述数据源类型包括基础表、数据集和SQL语句中的一项或多项；创建单元，用于创建查询语句，在当前数据库中执行所述查询语句；显示单元，用于将查询结果呈现在所述网格报表中。10.一种计算机可读存储介质，其特征在于，包括：所述计算机可读存储介质存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现如权利要求1至8任一项所述的一种网格报表的制作方法的步骤。
说明书desc
技术领域本发明涉及表格数据处理领域，特别涉及一种网格报表的制作方法及装置。背景技术表格数据处理是数据库的数据处理过程中非常重要的一环，现有技术中有三种处理方式：Dynamics 365、直接开发相应页面以及镝数图表。Dynamics 365: 由Microsoft开发的客户关系管理软件包，专注于增强任何组织的客户关系。用户可以通过界面快速创建表结构，关系以及事件。快速生成表单页面，查询列表以及统计数据。但是配置过程中得非常了解数据结构，也无法直接支持现有业务，只能从0开始配置。直接开发相应页面：可以满足个性化需求，但是大部分查询页面都是通用的，个性化的都是很小一部分的需求。直接开发人力成本和时间成本比较高。镝数图表：零代码数据内容协作平台，帮助用户轻松高效地获取数据、展示数据，实现基于数据内容的有效协作与沟通。但是只能支持Excel获取数据，无法支持更多数据模式。发明内容为了解决上述问题，本发明提供一种支持多种数据库而且开发容易的网格报表的制作方法及装置。为了实现上述目的，本发明一方面提供一种网格报表的制作方法，包括以下步骤：在当前数据库中添加其他数据库的链接；获取其他数据库的表结构信息，将所述表结构信息同步到当前数据库中；所述表结构信息包括表名、字段名、数据类型、字段备注中的一种或多种；根据数据源类型配置对应的网格报表，所述数据源类型包括基础表、数据集和SQL语句中的一项或多项；创建查询语句，在当前数据库中执行所述查询语句；将查询结果呈现在所述网格报表中。作为优选的一种实施方案，所述数据集通过以下步骤创建：选择当前数据库内的表，设置主表作为基础表，选择其他表后设置连接方式与关联字段，建立主表与一张或多张表的关联关系；根据所述关联关系创建数据集。作为优选的一种实施方案，所述查询语句包括查询条件和查询列表，所述查询条件中的字段包括字符串类型、数字类型、日期类型中的一种或多种；所述查询列表中的字段后续在转化成SQL语句时会添加到Select字段中。作为优选的一种实施方案，当所述数据源类型为SQL语句时，将所述查询条件插入到内部查询中，具体包括：使用占位符在查询列表添加预设字段，用户输入查询内容后所述查询条件插入到原始SQL中的子查询内。作为优选的一种实施方案，当所述数据源类型为SQL语句时，将所述查询结果中的代码根据字段映射表中的对应关系，转化成名称或者代码加上名称。作为优选的一种实施方案，添加下钻，所述下钻中包括打开详情页模式、打开网格报表模式、打开业务系统模式中的一种或多种。作为优选的一种实施方案，所述打开详情页模式用于显示表头和表体信息，所述表体信息通过在主题中添加的主表和从表的关联关系中确定。作为优选的一种实施方案，所述主题通过以下步骤创建：选择当前数据库内的表，设置主表作为基础表，选择其他表后设置连接方式与关联字段，建立主表与一张或多张从表的关联关系，用于下钻的时候使用。另一方面，本发明还提供一种网格报表的制作装置，包括：添加单元，用于在当前数据库中添加其他数据库的链接；获取单元，用于获取其他数据库的表结构信息，将所述表结构信息同步到当前数据库中；配置单元，用于根据数据源类型配置对应的网格报表，所述数据源类型包括基础表、数据集和SQL语句中的一项或多项；创建单元，用于创建查询语句，在当前数据库中执行所述查询语句；显示单元，用于将查询结果呈现在所述网格报表中。本发明相对于现有技术的有益效果是：本发明支持多种数据库，只要能获取到表结构信息，接着生成需要的查询语句，然后在数据库中执行，将查询结果显示出来；能够同时支持多种数据库，而且制作简单，用户容易二次开发，使用简便。附图说明图1是本发明一实施例提供的网格报表的制作方法的流程图；图2是本发明一实施例提供的网格报表的制作装置的结构图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅是本发明的一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。参照图1，本实施例提供一种网格报表的制作方法，包括以下步骤：S10：在当前数据库中添加其他数据库的链接；具体的，其他数据库可以是Mysql，Oracle，达梦，SqlServer，人大金仓，Clickhouse，Doris等数据库中的一个或者多个。添加数据库连接然后保存后会存储到本发明的数据库中，在页面上可以切换当前使用的数据库，此后配置的相关信息都是基于此数据库配置的。S20：获取其他数据库的表结构信息，将所述表结构信息同步到当前数据库中；所述表结构信息包括表名、字段名、数据类型、字段备注中的一种或多种；具体的，是将表名，字段名，数据类型，字段备注等信息，根据不同的数据库，采用不同的方式获取，再存储到本发明的数据库中。读取和写入都采用批处理的方式处理，提升读写性能。应当说明的是，获取方式取决于数据库，属于本领域的常规技术手段在此不在赘述。S30：根据数据源类型配置对应的网格报表，所述数据源类型包括基础表、数据集和SQL语句中的一项或多项；应当说明的是，基础表指本实施例中当前数据库的实际表，数据集指由基础库通过左右连接形成的视图表，SQL指直接通过SQL语句生成的查询结果表。网格报表的配置之前需要创建主题和数据集，具体的创建主题是选择当前数据库内的表，设置主表作为基础表，选择其他表后设置连接方式与关联字段，建立主表与一张或多张从表的关联关系，用于下钻的时候使用。创建数据集是选择当前数据库内的表，设置主表作为基础表，选择其他表后设置连接方式与关联字段，建立主表与一张或多张表的关联关系，用于网格报表的数据集，这与创建主题的区别在于，主题只是建立了关联关系，数据集是创建了一个大的视图表，后续读取数据都是基于这个视图表的结构。针对复杂情况，也可以直接写SQL语句创建数据集，比如联合查询、带条件的查询，数据聚合等场景。主题和数据集创建完成之后就可以创建网格报表，可以选择基础表，数据集，或者直接写SQL语句，获取到列的信息。如果需要统计报表，可以创建计算字段，支持多种函数，或者自行编写其他复杂计算函数，保存时会测试此函数在当前选择的数据类型中测试语句是否正确，由于在有些数据库中字段名称太长会执行失败，可以使用as语法创建别名。S40：创建查询语句，在当前数据库中执行所述查询语句；创建完网格报表之后，就可以创建查询语句了，在字段列表可以通过点击或拖拽字段添加到查询条件中和查询列表中。在查询条件中的字段后续在转化成SQL语句时会添加到Where条件中。查询条件中的字段根据不同字段类型可以设置不同的查询方式，比如字符串类型的可以设置匹配方式是模糊查询还是精确查询；比如数字类型的可以设置是大于、小于、等于等方式查询；比如日期类型的可以设置是按年查找、按月查找、按日查找等方式。另外可以设置默认值，体现在页面上的初始化数值。还可以设置页面显示的一些属性，比如控件的长度、提示语、是否只读、是否在页面显示等。针对SQL模式的数据源，还能够将查询条件插入到内部查询中，使用占位符@a{n}，在查询列表添加“@a{n}.字段名称”，页面上用户输入查询内容后，此条件可以插入到原始SQL中的子查询内，增加查询灵活性。在查询列表中的字段后续在转化成SQL语句时会添加到Select字段中，在查询列表中的字段除了能够设置显示方式，如前缀等、后缀，颜色，宽度，对齐方式等，这些都是前端根据查询结果在渲染页面的时候去处理。在获得查询结果时，可以将结果中的相关“代码”根据字段映射的表中的对应关系，转化成“名称”或“代码｜名称”，另外可以配置导出属性，配置后的字段在导出PDF或Excel时会导出此字段内容。S50：将查询结果呈现在所述网格报表中。最后将查询结果呈现在网格报表中，针对有下钻需求的，可以添加下钻，选择指定字段，开启下钻后当前列可以改变颜色，突出显示，下钻有三种方式，第一种打开详情页的方式，主要显示表头表体信息，表体需要在主题中添加了表的关联关系，在编辑下钻的时候，本发明会自动拉取预先设置完成、作为基础表的主题，选中主题后会查询出此表的关联子表。第二种是打开相关的网格报表，设置好网格报表id后，如果需要传递参数，可以将页面上的查询条件和此数据行的查询结果的信息映射到新的网格报表的查询条件中去，接收的网格报表根据页面请求参数是否匹配到相应的字段，在能够匹配到查询条件的情况下，会作为默认值显示在页面的查询条件内，执行查询方法。第三种是打开业务系统页面，参数传递的方式与第二种方式一致，需要业务系统页面内存在相关的查询条件并且能够接受传递参数，设置好映射关系后，即可传递。另外需要说明的是，为了降低生产系统出错的概率，本实施例记载的网格报表的制作方法在开发环境配置完成网格报表后，将配置过程中涉及的相关信息导出为json格式文件并制作成压缩包，再导入到生产系统中。另外，进一步优化可以将查询慢或者查询量比较大的数据集，通过定时任务直接落地到本发明的Doris数据库内，降低查询过程中产生的损耗。本实施例记载的网格报表制作方法可以让网格报表客户私有化配置，为了满足不同客户对同一张网格报表的不同需求，在制作网格报表时会将常规查询条件和查询结果都进行设置，客户在使用时，可以根据自己的需要调整顺序、显示或隐藏，实现个性化需求。参照图2，本实施例还提供一种网格报表的制作装置，包括：添加单元100，用于在当前数据库中添加其他数据库的链接；应当说明的是，由于具体的添加方法以及过程在上述一种网格报表的制作方法的步骤S10中已经详细阐述，故在此不再赘述。获取单元200，用于获取其他数据库的表结构信息，将所述表结构信息同步到当前数据库中；应当说明的是，由于具体的获取方法以及过程在上述一种网格报表的制作方法的步骤S20中已经详细阐述，故在此不再赘述。配置单元300，用于根据数据源类型配置对应的网格报表，所述数据源类型包括基础表、数据集和SQL语句中的一项或多项；应当说明的是，由于具体的配置方法以及过程在上述一种网格报表的制作方法的步骤S30中已经详细阐述，故在此不再赘述。创建单元400，用于创建查询语句，在当前数据库中执行所述查询语句；应当说明的是，由于具体的创建方法以及过程在上述一种网格报表的制作方法的步骤S40中已经详细阐述，故在此不再赘述。显示单元500，用于将查询结果呈现在所述网格报表中；应当说明的是，由于具体的显示方法以及过程在上述一种网格报表的制作方法的步骤S50中已经详细阐述，故在此不再赘述。另外，本发明实施例还提供一种计算机可读存储介质，其中，该计算机可读存储介质可存储有程序，该程序执行时包括上述方法实施例中记载的任何网格报表的制作方法的部分或全部步骤。另外，在本发明各个实施例中的各功能单元可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中。上述集成的单元既可以采用硬件的形式实现，也可以采用软件功能单元的形式实现。所述集成的单元如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储器中。基于这样的理解，本发明的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的全部或部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储器中，包括若干指令用以使得一台计算机设备执行本发明各个实施例所述方法的全部或部分步骤。而前述的存储器包括：U盘、只读存储器、随机存取存储器、移动硬盘、磁碟或者光盘等各种可以存储程序代码的介质。本领域普通技术人员可以理解上述实施例的各种方法中的全部或部分步骤是可以通过程序来指令相关的硬件来完成，该程序可以存储于一计算机可读存储器中，存储器可以包括：闪存盘、只读存储器、随机存取器、磁盘或光盘等。以上参照附图描述了根据本发明的实施例的用于实现网格报表的制作方法的示例性流程图。应指出的是，以上描述中包括的大量细节仅是对本发明的示例性说明，而不是对本发明的限制。在本发明的其他实施例中，该方法可具有更多、更少或不同的步骤，且各步骤之间的顺序、包含、功能等关系可以与所描述和图示的不同。
