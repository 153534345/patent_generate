标题title
基于多特融合的纺织品染整染色异常检测方法
摘要abst
本发明涉及图像处理技术领域，具体涉及基于多特融合的纺织品染整染色异常检测方法，包括：采集布匹印花图像；获取布匹印花图像中每个像素点的初始阈值，进而得到每个像素点的初始类别；根据每个像素点的初始类别获取每个待修正像素点的待修正可能性，得到每个待修正像素点；获取每个待修正像素点的初始阈值改正程度，进而得到每个待修正像素点的初始阈值权重，获取每个待修正像素点在竖直方向上的初始阈值偏差以及每个待修正像素点在竖直方向上的光照变化偏差，进而得到每个待修正像素点的初始阈值修正系数，获取每个待修正像素点的最终阈值，对布匹印花图像进行分割得到印花区区域判断是否出现染色异常，本发明分割出的印花区域更加准确。
权利要求书clms
1.基于多特融合的纺织品染整染色异常检测方法，其特征在于，该方法包括以下步骤：采集布匹印花图像；获取布匹印花图像中每个像素点的初始阈值，根据每个像素点的初始阈值对每个像素点进行初始分类，得到每个像素点的初始类别；根据每个像素点的初始类别获取每个待修正像素点的待修正可能性；根据每个待修正像素点的待修正可能性获取若干待修正像素点；根据待修正像素点的初始类别及灰度值，获取每个待修正像素点的初始阈值改正程度；根据每个待修正像素点的初始阈值改正程度，获取每个待修正像素点的初始阈值权重，根据每个待修正像素点的初始阈值权重对每个待修正像素点的初始阈值进行修正，得到每个待修正像素点在竖直方向上的初始阈值偏差；根据待修正像素点在竖直方向上其他像素点的灰度值，获取每个待修正像素点在竖直方向上的光照变化偏差；根据每个待修正像素点在竖直方向上的初始阈值偏差以及每个待修正像素点在竖直方向上的光照变化偏差，获取每个待修正像素点的初始阈值修正系数；根据每个待修正像素点的初始阈值修正系数，获取每个待修正像素点的最终阈值；根据每个待修正像素点的最终阈值对布匹印花图像进行分割得到完整印花区域，根据完整印花区域的灰度均值判断染色异常；所述根据每个像素点的初始类别获取每个待修正像素点的待修正可能性，包括的具体步骤如下：对于布匹印花图像中的任一像素点，在该像素点的水平方向上的所有像素点中，获取与该像素点的灰度值一致的所有像素点，构成该像素点的灰度一致集合，在该像素点的灰度一致集合中，获取与该像素点的初始类别一致的所有像素点，构成该像素点的类别一致集合；式中，代表第/＞个像素点的待修正可能性；/＞代表第/＞个像素点的灰度一致集合中的像素点数量，/＞代表第/＞个像素点的类别一致集合中的像素点数量；所述根据每个待修正像素点的待修正可能性获取若干待修正像素点，包括的具体步骤如下：预设修正阈值，当像素点的待修正可能性大于修正阈值/＞时，像素点为待修正像素点；所述获取每个待修正像素点的初始阈值改正程度，包括的具体步骤如下：式中，代表第/＞个s待修正像素点的初始阈值改变程度，/＞代表第/＞个待修正像素点的待修正可能性；/＞代表在第/＞个修正像素点的类别一致集合中，与第/＞个修正像素点距离最近的/＞个像素点到第/＞个修正像素点的距离均值；/＞代表第/＞个待修正像素点的灰度一致集合中的像素点数量；/＞代表第/＞个待修正像素点对应的滑动窗口中小于第/＞个待修正像素点的初始阈值的所有像素点的灰度均值；/＞代表第/＞个待修正像素点对应的滑动窗口中大于或等于第/＞个待修正像素点的初始阈值的所有像素点的灰度均值；/＞代表第/＞个待修正像素点的灰度一致集合中的第/＞个像素点对应的滑动窗口中小于第/＞个像素点的初始阈值的所有像素点的灰度均值；/＞代表第/＞个待修正像素点的灰度一致集合中的第/＞个像素点对应的滑动窗口中大于或等于第/＞个像素点的初始阈值的所有像素点的灰度均值；代表绝对值符号；所述根据每个待修正像素点的初始阈值改正程度，获取每个待修正像素点的初始阈值权重，根据每个待修正像素点的初始阈值权重对每个待修正像素点的初始阈值进行修正，得到每个待修正像素点在竖直方向上的初始阈值偏差，包括的具体步骤如下：式中，代表第/＞个待修正像素点的初始阈值权重，/＞代表第/＞个待修正像素点的阈值改变程度，/＞代表归一化函数；根据每个待修正像素点的初始阈值权重对每个待修正像素点与其在竖直方向上的所有待修正像素点的初始阈值进行修正后，使用最小二乘法进行曲线拟合，将每个像素点的初始阈值拟合残差作为每个像素点在竖直方向上的初始阈值偏差；所述获取每个待修正像素点在竖直方向上的光照变化偏差，包括的具体步骤如下：预设，在每个待修正像素点的滑动窗口中，获取灰度值最大的/＞个像素点的灰度均值作为每个待修正像素点的光照变化，对每个待修正像素点与其在竖直方向上的所有待修正像素点的光照变化，使用最小二乘法进行曲线拟合，将每个像素点的光照变化拟合残差作为每个像素点在竖直方向上的光照变化偏差；所述根据每个待修正像素点在竖直方向上的初始阈值偏差以及每个待修正像素点在竖直方向上的光照变化偏差，获取每个待修正像素点的初始阈值修正系数，包括的具体步骤如下：式中，代表第/＞个待修正像素点在竖直方向上的初始阈值偏差；/＞代表第/＞个待修正像素点在竖直方向上的光照变化偏差；/＞代表归一化函数；/＞代表选择函数，当/＞时，/＞；当/＞时，/＞；/＞代表绝对值符号；所述根据每个待修正像素点的初始阈值修正系数，获取每个待修正像素点的最终阈值，包括的具体步骤如下：式中，代表第/＞个待修正像素点的最终阈值；/＞代表第/＞个待修正像素点的初始阈值；代表第/＞个待修正像素点的初始阈值修正系数；/＞代表归一化函数，/＞代表初始阈值的改正方向函数，当第/＞个待修正像素点在竖直方向上的阈值分布偏差大于或等于0时，/＞，否则/＞。2.根据权利要求1所述的基于多特融合的纺织品染整染色异常检测方法，其特征在于，所述获取布匹印花图像中每个像素点的初始阈值，根据每个像素点的初始阈值对每个像素点进行初始分类，得到每个像素点的初始类别，包括的具体步骤如下：预设滑动窗口，将布匹印花图像中每个像素点作为滑动窗口的中心，得到每个像素点的滑动窗口，将每个像素点的滑动窗口中所有像素点的灰度均值作为每个像素点的初始阈值，当任一像素点的灰度值小于该像素点的初始阈值时，该像素点的初始类别为印花区域，否则该像素点的初始类别为背景区域，得到每个像素点的初始类别。3.根据权利要求1所述的基于多特融合的纺织品染整染色异常检测方法，其特征在于，所述根据每个待修正像素点的最终阈值对布匹印花图像进行分割得到完整印花区域，根据完整印花区域的灰度均值判断染色异常，包括的具体步骤如下：预设差值阈值，当任一待修正像素点的灰度值小于该待修正像素点的最终阈值时，该待修正像素点为完整印花区域的像素点，分割出完整印花区域，当分割出的完整印花区域的灰度均值与正常印花区域的灰度均值之间的差值绝对值大于差值阈值时，分割出的完整印花区域的染色存在异常。
说明书desc
技术领域本发明涉及图像处理技术领域，具体涉及基于多特融合的纺织品染整染色异常检测方法。背景技术纺织品即布匹，布匹印花是一种在织物上印上图案、设计的装饰工艺。以增加它们的视觉吸引力、独特性和市场价值。此时印花染色的质量直接影响着布匹质量，所以布匹染色异常检测是纺织工业中的关键任务之一，它有助于确保布料的质量和一致性，以及检测任何染色缺陷或问题。在对布匹印花图像进行染色异常检测时，首先需要在布匹印花图像中分割获得印花区域，即布匹染色区域，传统的使用自适应阈值分割算法对布匹印花图像中的印花区域进行分割时，根据各像素点的滑动窗口的灰度分布，确定各像素点的阈值来对印花区域进行分割，但是实际中可能存在滑动窗口灰度级分布差异或者噪声影响，导致像素点的阈值出现偏差，从而使得分割出来的印花区域不准确，导致无法进行染色异常检测。发明内容为了解决上述问题，本发明提供基于多特融合的纺织品染整染色异常检测方法。本发明的基于多特融合的纺织品染整染色异常检测方法采用如下技术方案：本发明一个实施例提供了基于多特融合的纺织品染整染色异常检测方法，该方法包括以下步骤：采集布匹印花图像；获取布匹印花图像中每个像素点的初始阈值，根据每个像素点的初始阈值对每个像素点进行初始分类，得到每个像素点的初始类别；根据每个像素点的初始类别获取每个待修正像素点的待修正可能性；根据每个待修正像素点的待修正可能性获取若干待修正像素点；根据待修正像素点的初始类别及灰度值，获取每个待修正像素点的初始阈值改正程度；根据每个待修正像素点的初始阈值改正程度，获取每个待修正像素点的初始阈值权重，根据每个待修正像素点的初始阈值权重对每个待修正像素点的初始阈值进行修正，得到每个待修正像素点在竖直方向上的初始阈值偏差；根据待修正像素点在竖直方向上其他像素点的灰度值，获取每个待修正像素点在竖直方向上的光照变化偏差；根据每个待修正像素点在竖直方向上的初始阈值偏差以及每个待修正像素点在竖直方向上的光照变化偏差，获取每个待修正像素点的初始阈值修正系数；根据每个待修正像素点的初始阈值修正系数，获取每个待修正像素点的最终阈值；根据每个待修正像素点的最终阈值对布匹印花图像进行分割得到完整印花区域，根据完整印花区域的灰度均值判断染色异常；所述根据每个像素点的初始类别获取每个待修正像素点的待修正可能性，包括的具体步骤如下：对于布匹印花图像中的任一像素点，在该像素点的水平方向上的所有像素点中，获取与该像素点的灰度值一致的所有像素点，构成该像素点的灰度一致集合，在该像素点的灰度一致集合中，获取与该像素点的初始类别一致的所有像素点，构成该像素点的类别一致集合；式中，代表第/＞个像素点的待修正可能性；/＞代表第/＞个像素点的灰度一致集合中的像素点数量，/＞代表第/＞个像素点的类别一致集合中的像素点数量；所述根据每个待修正像素点的待修正可能性获取若干待修正像素点，包括的具体步骤如下：预设修正阈值，当像素点的待修正可能性大于修正阈值/＞时，像素点为待修正像素点；所述获取每个待修正像素点的初始阈值改正程度，包括的具体步骤如下：式中，代表第/＞个s待修正像素点的初始阈值改变程度，/＞代表第/＞个待修正像素点的待修正可能性；/＞代表在第/＞个修正像素点的类别一致集合中，与第/＞个修正像素点距离最近的/＞个像素点到第/＞个修正像素点的距离均值；/＞代表第/＞个待修正像素点的灰度一致集合中的像素点数量；/＞代表第/＞个待修正像素点对应的滑动窗口中小于第/＞个待修正像素点的初始阈值的所有像素点的灰度均值；/＞代表第/＞个待修正像素点对应的滑动窗口中大于或等于第/＞个待修正像素点的初始阈值的所有像素点的灰度均值；/＞代表第/＞个待修正像素点的灰度一致集合中的第/＞个像素点对应的滑动窗口中小于第/＞个像素点的初始阈值的所有像素点的灰度均值；/＞代表第/＞个待修正像素点的灰度一致集合中的第/＞个像素点对应的滑动窗口中大于或等于第/＞个像素点的初始阈值的所有像素点的灰度均值；/＞代表绝对值符号；所述根据每个待修正像素点的初始阈值改正程度，获取每个待修正像素点的初始阈值权重，根据每个待修正像素点的初始阈值权重对每个待修正像素点的初始阈值进行修正，得到每个待修正像素点在竖直方向上的初始阈值偏差，包括的具体步骤如下：式中，代表第/＞个待修正像素点的初始阈值权重，/＞代表第/＞个待修正像素点的阈值改变程度，/＞代表归一化函数；根据每个待修正像素点的初始阈值权重对每个待修正像素点与其在竖直方向上的所有待修正像素点的初始阈值进行修正后，使用最小二乘法进行曲线拟合，将每个像素点的初始阈值拟合残差作为每个像素点在竖直方向上的初始阈值偏差；所述获取每个待修正像素点在竖直方向上的光照变化偏差，包括的具体步骤如下：预设，在每个待修正像素点的滑动窗口中，获取灰度值最大的/＞个像素点的灰度均值作为每个待修正像素点的光照变化，对每个待修正像素点与其在竖直方向上的所有待修正像素点的光照变化，使用最小二乘法进行曲线拟合，将每个像素点的光照变化拟合残差作为每个像素点在竖直方向上的光照变化偏差；所述根据每个待修正像素点在竖直方向上的初始阈值偏差以及每个待修正像素点在竖直方向上的光照变化偏差，获取每个待修正像素点的初始阈值修正系数，包括的具体步骤如下：式中，代表第/＞个待修正像素点在竖直方向上的初始阈值偏差；/＞代表第/＞个待修正像素点在竖直方向上的光照变化偏差；/＞代表归一化函数；/＞代表选择函数，当/＞时，/＞；当/＞时，/＞；/＞代表绝对值符号；所述根据每个待修正像素点的初始阈值修正系数，获取每个待修正像素点的最终阈值，包括的具体步骤如下：式中，代表第/＞个待修正像素点的最终阈值；/＞代表第/＞个待修正像素点的初始阈值；/＞代表第/＞个待修正像素点的初始阈值修正系数；/＞代表归一化函数，代表初始阈值的改正方向函数，当第/＞个待修正像素点在竖直方向上的阈值分布偏差大于或等于0时，/＞，否则/＞。优选的，所述获取布匹印花图像中每个像素点的初始阈值，根据每个像素点的初始阈值对每个像素点进行初始分类，得到每个像素点的初始类别，包括的具体步骤如下：预设滑动窗口，将布匹印花图像中每个像素点作为滑动窗口的中心，得到每个像素点的滑动窗口，将每个像素点的滑动窗口中所有像素点的灰度均值作为每个像素点的初始阈值，当任一像素点的灰度值小于该像素点的初始阈值时，该像素点的初始类别为印花区域，否则该像素点的初始类别为背景区域，得到每个像素点的初始类别。优选的，所述根据每个待修正像素点的最终阈值对布匹印花图像进行分割得到完整印花区域，根据完整印花区域的灰度均值判断染色异常，包括的具体步骤如下：预设差值阈值，当任一待修正像素点的灰度值小于该待修正像素点的最终阈值时，该待修正像素点为完整印花区域的像素点，分割出完整印花区域，当分割出的完整印花区域的灰度均值与正常印花区域的灰度均值之间的差值绝对值大于差值阈值时，分割出的完整印花区域的染色存在异常。本发明的技术方案的有益效果是：本发明首先获取布匹印花图像中每个像素点的初始阈值，得到每个像素点的初始类别，根据每个像素点与其水平方向上其他相同灰度值的像素点之间的初始分类关系，来获取每个像素点的待修正可能性，得到了待修正像素点，便于后续仅对待修正像素点的初始阈值进行改正，再根据每个待修正像素点的待修正可能性，以及在每个待修正像素点与其水平方向上相同灰度值的像素点的滑动窗口中像素点的灰度值分布，获取每个待修正像素点的初始阈值改正程度，又由于竖直方向上的像素点之间的光照变化关系以及初始阈值的变化关系具有一致性，因此根据每个待修正像素点的初始阈值改正程度获取每个待修正像素点在竖直方向上的初始阈值偏差以及每个待修正像素点在竖直方向上的光照变化偏差，进而得到每个待修正像素点的初始阈值修正系数，有效避免了将光照变化引起的初始阈值进行改正，从而提高待修正像素点滑动窗口的初始阈值的改正准确性，最后根据每个待修正像素点的初始阈值修正系数，对待修正像素点的初始阈值进行改进得到每个待修正像素点的最终阈值，完成对于印花区域的分割，使得分割的印花区域更加完整，能够根据完整的印花区域判断染色是否出现异常。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明的基于多特融合的纺织品染整染色异常检测方法的步骤流程图。具体实施方式为了更进一步阐述本发明为达成预定发明目的所采取的技术手段及功效，以下结合附图及较佳实施例，对依据本发明提出的基于多特融合的纺织品染整染色异常检测方法，其具体实施方式、结构、特征及其功效，详细说明如下。在下述说明中，不同的“一个实施例”或“另一个实施例”指的不一定是同一实施例。此外，一或多个实施例中的特定特征、结构或特点可由任何合适形式组合。除非另有定义，本文所使用的所有的技术和科学术语与属于本发明的技术领域的技术人员通常理解的含义相同。下面结合附图具体的说明本发明所提供的基于多特融合的纺织品染整染色异常检测方法的具体方案。请参阅图1，其示出了本发明一个实施例提供的基于多特融合的纺织品染整染色异常检测方法的步骤流程图，该方法包括以下步骤：S001．采集布匹印花图像。需要说明的是，在布匹印花染色结束后，首先对其进行干燥处理，对于干燥处理后的布匹进行染色异常检测，因此在本发明实施例中，在检测平台上方安装相机，将完成印花染色的干燥布匹传输到检测平台上，通过相机拍摄待检测的原始图像，为了便于后续分析，使用语义分割算法对待检测的图像进行分割，获取布匹区域图像，对布匹区域图像进行灰度化处理，将灰度化处理后布匹区域图像记为布匹印花图像，需要说明的是，语义分割获取布匹区域图像为公知技术，在本发明实施例中，不再对其进行赘述。至此，获取了布匹印花图像。S002．获取每个像素点的初始阈值，根据每个像素点的初始阈值对每个像素点进行初始分类，得到每个像素点的初始类别。需要说明的是，对于布匹印花进行异常检测时，首先需要在布匹印花图像中分割获得印花区域，再根据分割得到的印花区域的颜色来判断是否存在异常印花区域，已知印花区域在布匹印花图像中首先表现为与背景区域存在着颜色的差异，并且在光照等原因的影响下，不同位置的印花区域的颜色具有差异，因此直接利用自适应阈值分割算法对印花区域进行分割会有更好的效果。因此在本发明实施例中，使用自适应阈值分割算法对印花区域进行分割：预设滑动窗口大小为，将布匹印花图像中每个像素点作为滑动窗口的中心，得到每个像素点的滑动窗口，将每个像素点的滑动窗口中所有像素点的灰度均值，作为每个像素点的初始阈值，已知印花区域在布匹印花图像中的灰度值较低，因此根据该特征与每个像素点的初始阈值，对每个像素点进行初始分类：当任一像素点的灰度值小于该像素点的初始阈值时，该像素点的初始类别为印花区域，否则该像素点的分类为背景区域，至此获取了每个像素点的初始类别，在本发明实施例中，设置滑动窗口大小/＞，在其他实施例中，实施人员可根据具体实施情况设置/＞的值；若像素点靠近布匹印花图像的边界位置，导致其滑动窗口超出图像边界，则通过二次线性插值方法对窗口进行补全。至此，获取每个像素点的初始阈值，并根据每个像素点的初始阈值对每个像素点进行初始分类，得到了每个像素点的初始类别。S003．根据像素点的初始类别，获取每个待修正像素点的待修正可能性，根据每个待修正像素点的待修正可能性获取每个待修正像素点；获取每个待修正像素点的初始阈值改正程度。需要说明的是，上述步骤通过获取每个像素点的初始阈值对每个像素点进行了一个初始分类，但是由于光照的影响，会使得具有相同灰度值的像素点在不同位置的初始阈值不同，从而导致其初始类别也不同，进而使得分割出来的印花区域不准确，已知在布匹印花图像中光照方向对应不同位置光照条件逐渐降低，布匹印花图像的光照方向为布匹印花图像的竖直方向，因此像素点在其垂直光照方向上具有相同的光照条件，垂直光照方向即为布匹印花图像的水平方向，因此，不同位置具有相同灰度值的像素点在相同光照条件下的应该具有相同分类，即具有相似的阈值，但是在实际中可能存在像素点的滑动窗口灰度级分布存在差异或者噪声影响，导致像素点的初始阈值偏差，而对于存在初始阈值偏差的像素点，应该对其阈值进行修正。需要进一步说明的是，已知对于相同灰度值的像素点在相同光照条件下，具有相同的初始类别，又由于布匹印花图像在水平方向上具有相同光照条件，因此，可以根据每个像素点与其水平方向上其他相同灰度值的像素点之间的初始分类关系，来获取每个像素点的待修正可能性，即确定初始阈值存在偏差的像素点，需要后续对于初始阈值存在偏差的像素点的初始阈值进行修正。在本发明实施例中，获取每个像素点的待修正可能性：对于布匹印花图像中的任一像素点，在该像素点的水平方向上的所有像素点中，获取与该像素点的灰度值一致的所有像素点，构成该像素点的灰度一致集合，在该像素点的灰度一致集合中，获取与该像素点的初始类别一致的所有像素点，构成该像素点的类别一致集合。式中，代表第/＞个像素点的待修正可能性；/＞代表第/＞个像素点的灰度一致集合中的像素点数量，/＞代表第/＞个像素点的类别一致集合中的像素点数量，当/＞的比值越大时，的值较小，说明第/＞个像素点的初始阈值的偏差较小，第/＞个像素点的待修正可能性越小，当/＞的比值越小时，/＞的值较小，此时第/＞个像素点的初始阈值的偏差较大导致第/＞个像素点的初始类别的偏差程度越大，则第/＞个像素点的待修正可能性越大。预设修正阈值，当第/＞个像素点的待修正可能性大于修正阈值/＞时，此时第/＞个像素点为待修正像素点，即第/＞个像素点的阈值需要修正，在本发明实施例中，预设修正阈值，在其他实施例中，实施人员可根据具体实施情况设置/＞的值。至此，得到了布匹印花图像中的所有待修正像素点。需要说明的是，上述步骤根据每个像素点与其水平方向上其他相同灰度值的像素点之间的初始分类关系，获取了每个像素点的待修正可能性，得到了所有待修正像素点，而每个待修正像素点的待修正可能性，代表每个像素点的初始阈值偏差程度，当任一待修正像素点的待修正可能性越大时，说明该待修正像素点的初始阈值改正程度越大，又由于每个像素点与其水平方向上相同灰度值的像素点之间的初始分类理应一致，其表现为每个像素点与其水平方向上其他相同灰度值的像素点之间的初始阈值具有一致关系，而每个像素点的初始阈值受其滑动窗口中像素点的灰度值分布影响，因此在任一待修正像素点与其水平方向上相同灰度值的像素点的滑动窗口中，同时大于或者小于初始阈值的像素点之间灰度差异越大时，说明该待修正像素点的滑动窗口中像素点的灰度值分布偏差越大，则该待修正像素点的初始阈值存在偏差的可能性越大，说明该待修正像素点的初始阈值改正程度越大，因此在本发明实施例中，根据每个待修正像素点的待修正可能性，以及在每个待修正像素点与其水平方向上相同灰度值的像素点的滑动窗口中像素点的灰度值分布，获取每个待修正像素点的初始阈值改正程度。在本发明实施例中，获取每个待修正像素点的初始阈值改正程度。式中，代表第/＞个待修正像素点的初始阈值改变程度，/＞代表第/＞个待修正像素点的待修正可能性；/＞代表在第/＞个修正像素点的类别一致集合中，与第/＞个修正像素点距离最近的/＞个像素点到第/＞个修正像素点的距离均值，其值越小时，说明第/＞个待修正像素点的初始类别越稳定，说明第/＞个待修正像素点的待修正可能性越准确，需要说明的是，在本发明实施例中，设置/＞，在其他实施例中，实施人员可根据具体实施情况设置/＞的值；当/＞的值越大时，说明第/＞个待修正像素点的初始阈值的偏差程度较大，说明第/＞个待修正像素点的阈值改正程度越大，/＞代表第/＞个待修正像素点的灰度一致集合中的像素点数量；/＞代表第/＞个待修正像素点对应的滑动窗口中小于第/＞个待修正像素点的初始阈值的所有像素点的灰度均值；/＞代表第/＞个待修正像素点对应的滑动窗口中大于或等于第/＞个待修正像素点的初始阈值的所有像素点的灰度均值；/＞代表第/＞个待修正像素点的灰度一致集合中的第/＞个像素点对应的滑动窗口中小于第/＞个像素点的初始阈值的所有像素点的灰度均值；/＞代表第/＞个待修正像素点的灰度一致集合中的第/＞个像素点对应的滑动窗口中大于或等于第/＞个像素点的初始阈值的所有像素点的灰度均值；此时表示第/＞个待修正像素点与其水平方向上相同灰度值的第/＞个像素点所对应的滑动窗口中的灰度值分布偏差，其值越大时，说明第/＞个待修正像素点的初始阈值存在偏差的可能性越大，因此第/＞个待修正像素点的初始阈值改正程度越大。至此，根据像素点的初始类别，获取每个待修正像素点的待修正可能性，根据每个待修正像素点的待修正可能性获取每个待修正像素点；获取每个待修正像素点的初始阈值改正程度。S004．根据每个待修正像素点的初始阈值改正程度，获取每个待修正像素点的初始阈值权重对每个待修正像素点的初始阈值进行修正，得到每个待修正像素点在竖直方向上的初始阈值偏差；获取每个待修正像素点在竖直方向上的光照变化偏差；根据每个待修正像素点在竖直方向上的初始阈值偏差以及每个待修正像素点在竖直方向上的光照变化偏差，获取每个待修正像素点的初始阈值修正系数。需要说明的是，根据每个待修正像素点在相同光照条件下，即水平方向下与其相同灰度值的像素点的滑动窗口中的灰度值分布偏差以及每个待修正像素点的待修正可能性，获取了每个待修正像素点的初始阈值改正程度，但其反应的只是水平方向下每个待修正像素点的初始阈值改正程度，已知竖直方向上的像素点之间具有光照变化关系，而光照会影响布匹图像中像素点的灰度值，从而导致竖直方向上的像素点之间的初始阈值具有变化关系，即竖直方向上的像素点之间的光照变化关系以及初始阈值的变化关系具有一致性，如果待修正像素点在竖直方向上的初始阈值偏差可能来源于像素点的光照变化，那么对该像素点的初始阈值不需要进行改正，如果待修正像素点的初始阈值偏差相对于像素点的光照变化较大，那么对该像素点的初始阈值需要进行改正，因此需要根据每个待修正像素点在竖直方向上的初始阈值偏差以及每个待修正像素点在竖直方向上的光照变化偏差，来获取每个待修正像素点的初始阈值修正系数，因此首先需要获取每个待修正像素点在竖直方向上的初始阈值偏差以及每个待修正像素点在竖直方向上的光照变化偏差。需要说明的是，通过对每个待修正像素点与其竖直方向上的其他待修正像素点的初始阈值使用最小二乘法进行拟合曲线，进而得到每个待修正像素点的拟合残差，将每个待修正像素点的拟合残差作为每个待修正像素点在竖直方向上的初始阈值偏差，但是上述步骤S004得到每个待修正像素点的初始阈值改正程度，当初始阈值改正程度越大时，说明待修正像素点的初始阈值不仅是来源于像素点的关照变化，因此在进行拟合曲线时，对于初始阈值改正程度较大的待修正像素点的初始阈值权重较小，对于初始阈值改正程度较小的待修正像素点的初始阈值权重较大，使得初始阈值改正程度较小的待修正像素点对拟合结果的贡献更大，使得拟合结果能够准确的反映出竖直方向上的待修正像素点的初始阈值变化关系。在本发明实施例中，获取每个待修正像素点在竖直方向上的初始阈值偏差：获取每个待修正像素点的初始阈值权重：，其中，/＞代表第/＞个待修正像素点的初始阈值权重，/＞代表第/＞个待修正像素点的阈值改正程度，/＞表示归一化函数，采用线性归一化方法，归一化对象为所有待修正像素点的阈值改正程度。对每个待修正像素点与其在竖直方向上的所有待修正像素点的初始阈值进行加权后，再使用最小二乘法进行曲线拟合，得到每个待修正像素点的初始阈值拟合残差，将每个像素点的初始阈值拟合残差作为每个像素点在竖直方向上的初始阈值偏差；最小二乘法进行曲线拟合，以及拟合残差均为公知技术，本实施例不再赘述。获取每个待修正像素点在竖直方向上的光照变化偏差：在每个待修正像素点的滑动窗口中，获取灰度值最大的个像素点的灰度均值，作为每个待修正像素点的光照变化，对每个待修正像素点与其在竖直方向上的所有待修正像素点的光照变化，使用最小二乘法进行拟合，得到每个像素点的光照变化拟合残差，将每个像素点的光照变化拟合残差作为每个像素点在竖直方向上的光照变化偏差。在本发明实施例中，设置/＞，在其他实施例中，实施人员可根据具体实施情况设置/＞的值。需要说明的是，如果待修正像素点在竖直方向上的初始阈值偏差可能来源于像素点的光照变化，那么对该像素点的初始阈值不需要进行改正，即当任一待修正像素点在竖直方向上的初始阈值偏差相对于其在竖直方向上的光照变化偏差较小或者相等时，说明该待修正像素点的初始阈值偏差可能来自于像素点的光照变化，不需要对该待修正像素点的初始阈值进行过多改正，因此其初始阈值修正系数较小，当任一待修正像素点在竖直方向上的初始阈值偏差相对于其在竖直方向上的光照变化偏差较大时，说明该待修正像素点的初始阈值偏差不仅来自于像素点的光照变化，可能还有噪声的不影响，需要对该待修正像素点的初始阈值进行过多改正，因此其初始阈值修正系数较大，如此基于光照变化的偏差有效避免了将光照变化引起的阈值进行改正，从而提高待修正像素点滑动窗口的初始阈值的改正准确性。获取每个待修正像素点的初始阈值修正系数：式中，代表第/＞个待修正像素点在竖直方向上的初始阈值偏差；/＞代表第/＞个待修正像素点在竖直方向上的光照变化偏差；/＞代表归一化函数，采用线性归一化方法，归一化对象为所有待修正像素点在初始方向上的初始阈值偏差减去光照变化偏差得到的差值；/＞代表选择函数，当/＞，说明第/＞个待修正像素点在竖直方向上的初始阈值偏差较小，此时第/＞个待修正像素点的初始阈值修正系数较小，此时，仅需要根据/＞得到第/＞个待修正像素点的初始阈值修正系数，当，说明第/＞个待修正像素点在竖直方向上的初始阈值偏差较大，需要获取第/＞个待修正像素点在竖直方向上的初始阈值偏差与光照变化偏差的实际差异，因此，需要根据/＞得到第/＞个待修正像素点的初始阈值修正系数。至此，根据每个待修正像素点的初始阈值改正程度，获取每个待修正像素点的初始阈值权重，根据每个待修正像素点的初始阈值权重对每个待修正像素点的初始阈值进行修正，得到每个待修正像素点在竖直方向上的初始阈值偏差；获取每个待修正像素点在竖直方向上的光照变化偏差；根据每个待修正像素点在竖直方向上的初始阈值偏差以及每个待修正像素点在竖直方向上的光照变化偏差，获取每个待修正像素点的初始阈值修正系数。S005．根据每个待修正像素点的初始阈值修正系数，获取每个待修正像素点的最终阈值。需要说明的是，当任一待修正像素点的初始阈值修正系数越大时，该待修正像素点的初始阈值的改正量越大，又由于所述每个待修正像素点的初始阈值拟合残差是拟合值减去原始初始阈值之间的差异，当任一待修正像素点的初始阈值拟合残差为正时，拟合值大于原始初始阈值，此时需要将该待修正像素点的初始阈值调大，当任一待修正像素点的初始阈值拟合残差为负时，拟合值小于原始初始阈值，此时需要将该待修正像素点的初始阈值调小，因此在本发明实施例中，根据每个待修正像素点的初始阈值修正系数以及每个待修正像素点在竖直方向上的阈值分布偏差，获取每个待修正像素点的最终阈值。在发明实施例中，获取每个待修正像素点的最终阈值：式中，代表第/＞个待修正像素点的最终阈值；/＞代表第/＞个待修正像素点的初始阈值；/＞代表第/＞个待修正像素点的初始阈值修正系数，/＞代表归一化系数，采用线性归一化方法，归一化对象为所有待修正像素点的初始阈值修正系数；/＞代表第/＞个待修正像素点的初始阈值改正量，/＞代表初始阈值的改正方向函数，当第/＞个待修正像素点在竖直方向上的初始阈值偏差大于或等于0时，即当/＞时，，否则/＞。S006．根据每个待修正像素点的最终阈值，对布匹印花图像进行分割，得到印花区域判断染色异常。在本发明实施例中，预设差值阈值，根据每个待修正像素点的最终阈值，对每个待修正像素点进行分割，当待修正像素点的灰度值小于阈值时，待修正像素点为印花区域像素点。至此，分割出了完整印花区域，当分割出的完整印花区域的灰度均值与现有的正常印花区域的灰度均值之间的差值绝对值大于差值阈值时，认为分割出的完整印花区域的染色存在异常，在本发明实施例中，设置差值阈值/＞，在其他实施例中，实施人员可根据具体实施情况设置/＞的值。以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
