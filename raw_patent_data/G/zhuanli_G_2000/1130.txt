标题title
一种基于图像处理的水表检测方法
摘要abst
本发明涉及一种基于图像处理的水表检测方法，属于图像处理技术领域，获取水表表面玻璃对焦图像，自适应调整高亮像素点区域的色度信息，构建玻璃表面污渍模型；获取水表内部对焦图像，将水表内部对焦图像及玻璃表面的污渍模型输入至分割神经网络，去除背景污渍，获得清晰的水表内部图像；基于图像匹配法，检测清晰的水表内部图像的匹配差异性，根据匹配差异性判断水表是否需要校准。
权利要求书clms
1.一种基于图像处理的水表检测方法，其特征在于，包括如下步骤：S1、获取水表表面玻璃对焦图像，自适应调整高亮像素点区域的色度信息，构建玻璃表面污渍模型；S2、获取水表内部对焦图像，将水表内部对焦图像及玻璃表面污渍模型输入至分割神经网络，去除背景污渍，获得清晰的水表内部图像；S3、基于图像匹配法，检测清晰的水表内部图像的匹配差异性，根据所述匹配差异性判断水表是否需要校准。2.根据权利要求1所述的基于图像处理的水表检测方法，其特征在于，步骤S1包括：S11、求取水表表面玻璃对焦图像中每一个像素点的亮度差异值；S12、自适应调整高亮像素点区域的色度信息；S13、根据自适应调整后的水表表面玻璃对焦图像构建玻璃表面污渍模型。3.根据权利要求1所述的基于图像处理的水表检测方法，其特征在于，步骤S2中：利用卷积神经网络Sf提取输入的水表内部对焦图像的初始特征V，将其展开成关注特征F:；K表示卷积神经网络参数,d表示归一化处理系数；将关注特征与玻璃表面污渍模型嵌入分割神经网络，获取污渍特征映射，实现污渍特征映射与关注特征的分割，得到去除污渍特征映射的分割结果。4.根据权利要求3所述的基于图像处理的水表检测方法，其特征在于，将玻璃表面污渍模型嵌入迭代模型/＞，进行迭代学习，第i次迭代后的污渍特征映射Q为：,i=1,2…，n；其中，n表示迭代次数,F表示关注特征,每次迭代更新一次，生成新的污渍特征映射再嵌入下次迭代；分割神经网络的分割结果Output如下：Output=At ；其中的Q、V分别表示污渍特征映射和初始特征；At为分割神经网络模型，分割结果Output代表去除对应类别的污渍后得到的清晰的水表内部图像。5.根据权利要求1所述的基于图像处理的水表检测方法，其特征在于，步骤S3中：设参考图像为IR，待匹配的清晰的水表内部图像为IM，图像匹配模型表示为：；其中，Topt表示匹配差异性，S表示参考图像IR与待匹配的清晰的水表内部图像IM之间的相似度；根据匹配差异性Topt所对应的数值区间范围，对清晰的水表内部对焦图像进行检测，判断是否需要水表校准。6.根据权利要求5所述的基于图像处理的水表检测方法，其特征在于，设W={W1,W2…,Wj…,WN}是参考图像IR与待匹配的图像IM之间的像素点特征对集合，其中Wj=，WjR是参考图像IR中的像素点特征，WjM是待匹配的清晰的水表内部图像IM中对应的像素点特征，N表示像素点特征对的数量。
说明书desc
技术领域本发明属于图像处理技术领域，更具体地，涉及一种基于图像处理的水表检测方法。背景技术仪器仪表是重要的检测与测量工具，也是信息的源头。仪表依据测量对象的不同，通过一定的变换关系将测量机构得到的测量信号转化成数字信号或者角偏移量。指针水表具有读数直观、结构简单、精度高、制造成本低、抗电磁干扰能力强、方便维护等优点，在生产实践中得到了广泛的应用。通常指针水表没有数字通信接口，不能将测量信号转化为数字信号，需要依靠人工方式进行校准。仪表校准是一项繁琐、枯燥、重复性高的工作。在一些需要大量识别仪表读数的场景，获取仪表示数的准确与否很大程度上依赖操作员的责任心与视觉疲劳程度，在识别过程中容易出现失误与读数误差，若要及时发现失误则需要增加工作量，否则可能会造成严重的后果。由于不同仪表的外观、结构均存在差异，根据现有技术的实现原理，只能解决预定图像匹配模板对应类型的仪表的校准问题，通用性较差，而且使用不灵活，且仪表表面玻璃的反射及污渍对校准的结果也带来了很大的影响发明内容为了解决上述技术问题，本发明提出了一种基于图像处理的水表检测方法，包括如下步骤：S1、获取水表表面玻璃对焦图像，自适应调整高亮像素点区域的色度信息，构建玻璃表面污渍模型；S2、获取水表内部对焦图像，将水表内部对焦图像及玻璃表面的污渍模型输入至分割神经网络，去除背景污渍，获得清晰的水表内部图像；S3、基于图像匹配法，检测清晰的水表内部图像的匹配差异性，根据所述匹配差异性判断水表是否需要校准。进一步地，步骤S1包括：S11、求取水表表面玻璃对焦图像中每一个像素点的亮度差异值；S12、自适应调整高亮像素点区域的色度信息；S13、根据自适应调整后的玻璃对焦图像构建玻璃表面的污渍模型。进一步地，步骤S2中：利用卷积神经网络Sf提取输入的水表内部对焦图像的初始特征V，将其展开成关注特征F:；K表示卷积神经网络参数,d表示归一化处理系数；将关注特征与玻璃表面的污渍模型嵌入分割神经网络，获取污渍特征映射，实现污渍特征映射与关注特征分割，得到去除污渍特征映射的分割结果。进一步地，将玻璃表面的污渍模型嵌入迭代模型/＞，进行迭代学习，且每次迭代i后的污渍特征映射Q为：,i=1,2…，n；其中，n表示迭代次数,F表示关注特征,每次迭代更新一次，生成新的污渍特征映射再嵌入下次迭代；分割神经网络的分割结果Output如下表示：Output=At；其中的Q、V分别表示污渍特征映射和初始特征；At为分割神经网络模型，分割结果Output代表去除对应类别的污渍后得到清晰的水表内部图像。进一步地，步骤S3中：设参考图像IR，待匹配的清晰的水表内部图像为IM，图像匹配模型表示为：；其中，Topt表示匹配差异性，S表示参考图像IR与待匹配的图像IM之间的相似度；根据匹配差异性Topt所对应的数值区间范围，对清晰的水表内部对焦图像进行检测，判断是否需要水表校准。进一步地，设W={W1,W2…,Wj…,WN}是参考图像IR与待匹配的图像IM之间的像素点特征对集合，其中Wj=，WjR是图像IR中的像素点特征，WjM是待匹配的图像IM中对应的像素点特征，N表示像素点特征对的数量。相比于现有技术，本发明具有如下有益技术效果：获取水表表面玻璃对焦图像，自适应调整高亮像素点区域的色度信息，构建玻璃表面污渍模型；本发明充分考虑了水表表面玻璃的反光和污渍带来的影响，通过迭代模型进行迭代学习，去除对应类别的污渍后得到清晰的水表内部图像，得到清晰的水表内部图像。基于图像匹配法，检测清晰的水表内部图像的匹配差异性，根据所述匹配差异性判断水表是否需要校准，校准基础准确，校准结果精确。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其他的附图。图1为本发明的基于图像处理的水表检测方法的流程图；图2为利用本发明处理前后的水表内部图像对比示意图；图3为指针与水表表盘平面位置示意图;图4为角度匹配法示意图。具体实施方式为使本申请实施例的目的、技术方案和优点更加清楚，下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本申请一部分实施例，而不是全部的实施例。基于本申请中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本申请保护的范围。在本发明的具体实施例附图中，为了更好、更清楚的描述系统中的各元件的工作原理，表现所述装置中各部分的连接关系，只是明显区分了各元件之间的相对位置关系，并不能构成对元件或结构内的信号传输方向、连接顺序及各部分结构大小、尺寸、形状的限定。如图1所示，为本发明的一种基于图像处理的水表检测方法的流程图，该水表检测方法包括以下步骤：S1、获取水表表面玻璃对焦图像，自适应调整高亮像素点区域的色度信息，构建玻璃表面污渍模型。S11、求取水表表面玻璃对焦图像中每一个像素点的亮度差异值，将亮度差异值大于阈值的像素点确定为高亮像素点。亮度差异值通过下式获取：；其中，S为待求像素点p的亮度差异值，Yp为像素点p在亮度通道的灰度值，Yq为像素点q在亮度通道的灰度值，表示灰度距离，N为RGB图像总像素点。将亮度差异值大于阈值的像素点确定为高亮像素点，其余确定为漫反射点。S12、自适应调整高亮像素点区域的色度信息。将待检测的玻璃对焦图像转换到亮度空间中，最终的亮度校正模型表达式为:；T为亮度比值，Tmax和Tmin分别为T的最大值和最小值；为常数，Lin为原始图像的亮度,Lout为输出图像的亮度，Cout为颜色比值，Cin为颜色通道，/＞为颜色校正因子。对亮度信息不作改变，只对颜色和色差进行处理，通过调节颜色校正因子自自适应调整高亮像素点区域的色度信息。S13、根据自适应调整后的玻璃对焦图像构建玻璃表面的污渍模型。在基础目标检测神经网络结构的输出层中增加用于检测玻璃聚焦图像污渍的定位函数，以构成改进目标检测神经网络结构。玻璃表面的污渍模型如下：；；其中，Lo表示玻璃污渍模型的定位函数；表示玻璃聚焦图像中目标检测框和污渍框之间的距离向量；C表示经验参数；/＞表示二阶范数；cxa表示玻璃聚焦图像中目标检测框的中心点在图像坐标系中的横坐标，cya表示玻璃聚焦图像中目标检测框的中心点在图像坐标系中的纵坐标，wa表示玻璃聚焦图像中目标检测框的宽度，ha表示玻璃聚焦图像中目标检测框的高度；cxb表示玻璃聚焦图像中污渍框B的中心点在图像坐标系中的横坐标，cyb表示玻璃聚焦图像中污渍框的中心点在图像坐标系中的纵坐标，wb表示玻璃聚焦图像中污渍框的宽度，hb表示玻璃聚焦图像中污渍框的高度。将污渍大数据输入到改进目标检测神经网络结构中进行训练，训练得到玻璃污渍模型。S2、获取水表内部对焦图像，将水表内部对焦图像及玻璃表面的污渍模型输入至分割神经网络，去除背景污渍，获得清晰的水表内部图像。分割神经网络是图像处理和是机器视觉技术中关于图像理解的重要一环，对图像中每一个像素点进行分类，确定每个点的类别，从而进行区域分割及背景去除。分割神经网络是不含全连接层的全卷积网络,对图像进行像素级的分类,解决了图像的区域分割向题,能够接受任意尺寸的图像大小,采用反卷积对最后一个特征图进行处理,使其恢复到输入图像的尺寸,对每个像素产生一个预测,同时保留了原始输入图像中的空间信息,最后在上采样的特征图上进行逐像素分类。利用卷积神经网络Sf提取输入的水表内部对焦图像的初始特征V并将其展开成关注特征。计算关注特征F：。K、V分别表示卷积神经网络参数、初始特征,d表示为防止结果过大而进行的归一化处理系数。将关注特征与玻璃污渍模型嵌入分割神经网络，用以获取污渍特征映射，实现污渍特征映射与关注特征F的分割，得到去除污渍特征映射的分割结果。将玻璃表面的污渍模型嵌入迭代模型/＞，进行迭代学习，且每次迭代i后的污渍特征映射Q表示为：,i=1,2…，n；其中的n表示迭代次数,F表示关注特征,每次迭代更新一次，就会生成一个新的类别嵌入下次迭代。分割神经网络的分割结果Output如下表示：Output=At ；其中的Q、V分别表示污渍特征映射、初始特征；At为分割神经网络模型。分割结果Output即去除对应类别的污渍后得到清晰的水表内部图像，如图2所示为处理前后的水表内部图像对比示意图。S3、基于图像匹配法，检测清晰的水表内部图像的匹配差异性，根据所述匹配差异性判断水表是否需要校准。由于指针与水表表盘并不严格在同一平面中，而是分别处于距离较小的两个平行平面中如图3所示，在进行透视变换进行图像校正后，指针的位置会产生一定程度的偏移，需要对这种误差进行修正。对于给出的两幅图像：参考图像IR与待匹配的清晰的水表内部对焦图像IM，图像匹配的目的是找到一个最优的几何转换参数矩阵T，使得待匹配的清晰的水表内部对焦图像IM尽可能与参考图像IR一致。图像匹配模型表示为：；其中，Topt表示匹配差异性，S表示参考图像IR与待匹配的图像IM之间的相似度。设W={W1,W2…,Wj…,WN}是参考图像IR与待匹配的图像IM之间的像素点特征对集合，其中Wj=，WjR是图像IR中的像素点特征，WjM是待匹配的图像IM中对应的像素点特征，N表示像素点特征对的数量。根据匹配差异性Topt所对应的数值区间范围，对清晰的水表内部对焦图像进行检测，并判断是否需要水表校准，以及校准区间范围，即匹配差异性Topt所对应的数值区间范围。仪表图像匹配法相较于现有技术的近似近邻搜索方法具有准确度高的优点，仪表图像匹配法采用逐个像素点特征遍历的方式找到最佳匹配，优点是找到的是全局最优解，匹配正确率较高。在优选实施例中，利用角度匹配法检测清晰的水表内部图像的与标准相同角度图像的角度匹配性，根据所述角度匹配性判断水表是否需要校准。角度匹配法就是根据指针的角度与最小值刻度重心、最大值刻度重心与圆心的角度进行读数计算的方法。如图4所示,点C表示拟合圆圆心,点A和点B分别表示水最小值刻度重心和最大值刻度重心,线l表示指针拟合直线,CA与CB的夹角为,CA与l的夹角为/＞。设仪表的最小刻度值为MA,最大刻度值为MB,仪表读数值为I,那么仪表角度的计算公式为：。清晰的水表内部图像的与标准相同角度图像的角度匹配性，根据所述角度匹配性判断水表是否需要校准。在上述实施例中，可以全部或部分地通过软件、硬件、固件或者其任意组合来实现。当使用软件实现时，可以全部或部分地以计算机程序产品的形式实现。所述计算机程序产品包括一个或多个计算机指令。在计算机上加载和执行所述计算机程序指令时，全部或部分地产生按照本申请实施例所述的流程或功能。所述计算机可以是通用计算机、专用计算机、计算机网络、或者其他可编程装置。所述计算机指令可以存储在计算机可读存储介质中，或者通过所述计算机可读存储介质进行传输。所述计算机可读存储介质可以是计算机能够存取的任何可用介质或者是包含一个或多个可用介质集成的服务器、数据中心等数据存储设备。所述可用介质可以是磁性介质，、光介质、或者半导体介质)等。以上所述，仅为本申请的具体实施方式，但本申请的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本申请揭露的技术范围内，可轻易想到各种等效的修改或替换，这些修改或替换都应涵盖在本申请的保护范围之内。因此，本申请的保护范围应以权利要求的保护范围为准。
