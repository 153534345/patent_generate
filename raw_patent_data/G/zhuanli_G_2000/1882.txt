标题title
一种虚拟机快照方法、系统、电子设备及计算机存储介质
摘要abst
本发明公开了一种虚拟机快照方法、系统、电子设备及计算机存储介质，涉及服务器虚拟技术领域，应用于物理服务器，获取目标虚拟机发送的第一写操作数据；响应于存在对目标虚拟机的快照操作，将第一写操作数据重定向至目标缓存层；待目标虚拟机的快照操作结束后，将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中。本发明的有益效果是：目标虚拟机存在快照时，依然可以借助目标缓存层处理目标虚拟机的写操作，保证了快照的正常进行和目标虚拟机的业务稳定性。本发明提供的一种虚拟机快照系统、电子设备及计算机可读存储介质也解决了相应技术问题。
权利要求书clms
1.一种虚拟机快照方法，其特征在于，应用于物理服务器，包括：获取目标虚拟机发送的第一写操作数据；响应于存在对所述目标虚拟机的快照操作，将所述第一写操作数据重定向至目标缓存层；待所述目标虚拟机的快照操作结束后，将所述目标缓存层中的目标写操作数据重定向至所述目标虚拟机对应的虚拟磁盘中。2.根据权利要求1所述的方法，其特征在于，所述将所述第一写操作数据重定向至目标缓存层，包括：获取所述第一写操作数据的第一接收时间戳；基于所述第一接收时间戳，按照接收时间先后顺序，将所述第一写操作数据存储至目标队列中；从所述目标队列的头部开始，依次将所述目标队列中的所述第一写操作数据重定向至所述目标缓存层。3.根据权利要求2所述的方法，其特征在于，所述将所述第一写操作数据重定向至目标缓存层，包括：生成所述第一写操作数据的记录头信息；判断所述第一写操作数据是否完整；若所述第一写操作数据完整，则生成完整标记，基于所述记录头信息、所述第一写操作数据、所述完整标记生成写操作记录，将所述写操作记录重定向至所述目标缓存层。4.根据权利要求3所述的方法，其特征在于，所述判断所述第一写操作数据是否完整之后，还包括：若所述第一写操作数据不完整，则发送表征所述第一写操作数据不完整的信息至所述目标虚拟机；接收所述目标虚拟机发送的所述第一写操作数据的补充数据；将所述补充数据添加至所述第一写操作数据中，返回执行所述判断所述第一写操作数据是否完整的步骤。5.根据权利要求3所述的方法，其特征在于，所述生成所述第一写操作数据的记录头信息，包括：获取所述第一写操作数据的请求编号；获取所述第一写操作数据在所述虚拟磁盘上的地址信息；获取所述第一写操作数据的长度信息；基于所述第一接收时间戳、所述请求编号、所述地址信息和所述长度信息生成所述记录头信息。6.根据权利要求5所述的方法，其特征在于，所述将所述目标缓存层中的目标写操作数据重定向至所述目标虚拟机对应的虚拟磁盘中，包括：对于所述目标缓存层中的每个所述目标写操作数据，从所述目标写操作数据对应的记录头信息中解析出所述目标写操作数据的目标接收时间戳；按照时间先后顺序，对所述目标接收时间戳进行排序，得到排序时间戳；从所述排序时间戳的头部开始，依次将所述排序时间戳对应的所述目标写操作数据重定向至所述目标虚拟机对应的所述虚拟磁盘中。7.根据权利要求3所述的方法，其特征在于，所述判断所述第一写操作数据是否完整，包括：获取所述目标虚拟机发送的所述第一写操作数据对应的第一校验码；生成所述第一写操作数据的第二校验码；判断所述第一校验码与所述第二校验码是否一致；若所述第一校验码与所述第二校验码一致，则判定所述第一写操作数据完整；若所述第一校验码与所述第二校验码不一致，则判定所述第一写操作数据不完整。8.根据权利要求1至7任一项所述的方法，其特征在于，所述将所述目标缓存层中的目标写操作数据重定向至所述目标虚拟机对应的虚拟磁盘中，包括：在所述目标缓存层中确定第一数量个所述目标写操作数据；将所述第一数量个所述目标写操作数据重定向至所述目标虚拟机对应的所述虚拟磁盘中；判断是否阻塞所述目标虚拟机的写操作；若是，则阻塞所述目标虚拟机的写操作，每次在所述目标缓存层中确定第二数量个所述目标写操作数据，将所述第二数量个所述目标写操作数据重定向至所述目标虚拟机对应的所述虚拟磁盘中，直至所述目标缓存层为空；其中，在不阻塞所述目标虚拟机的写操作时，获取所述目标虚拟机的第二写操作数据并重定向至所述目标缓存层。9.根据权利要求8所述的方法，其特征在于，所述判断是否阻塞所述目标虚拟机的写操作之后，还包括：若不阻塞所述目标虚拟机的写操作，则在所述目标缓存层中确定第三数量个所述目标写操作数据；将所述第三数量个所述目标写操作数据重定向至所述目标虚拟机对应的所述虚拟磁盘中；返回执行所述判断是否阻塞所述目标虚拟机的写操作的步骤。10.根据权利要求8所述的方法，其特征在于，所述判断是否阻塞所述目标虚拟机的写操作，包括：确定所述目标缓存层中剩余的所述目标写操作数据的目标数量值；判断所述目标数量值是否小于第一预设数量值；若所述目标数量值小于所述第一预设数量值，则判定阻塞所述目标虚拟机的写操作；若所述目标数量值大于等于所述第一预设数量值，则判定不阻塞所述目标虚拟机的写操作。11.根据权利要求8所述的方法，其特征在于，所述判断是否阻塞所述目标虚拟机的写操作，包括：确定所述目标缓存层中剩余的所述目标写操作数据的目标数据量；判断所述目标数据量是否小于预设数据量值；若所述目标数据量小于所述预设数据量值，则判定阻塞所述目标虚拟机的写操作；若所述目标数据量大于等于所述预设数据量值，则判定不阻塞所述目标虚拟机的写操作。12.根据权利要求8所述的方法，其特征在于，所述判断是否阻塞所述目标虚拟机的写操作，包括：确定所述目标缓存层中剩余的所述目标写操作数据的目标数据量；基于所述目标数据量预估所述目标缓存层的数据重定向时长；判断所述数据重定向时长是否小于预设时长；若所述数据重定向时长小于所述预设时长，则判定阻塞所述目标虚拟机的写操作；若所述数据重定向时长大于等于所述预设时长，则判定不阻塞所述目标虚拟机的写操作。13.根据权利要求8所述的方法，其特征在于，所述将所述第一数量个所述目标写操作数据重定向至所述目标虚拟机对应的所述虚拟磁盘中之后，所述判断是否阻塞所述目标虚拟机的写操作之前，还包括：预估所述目标虚拟机在未来时长内的写操作数量；判断所述写操作数量是否大于第二预设数量值；若所述写操作数量小于等于所述第二预设数量值，则执行所述判断是否阻塞所述目标虚拟机的写操作的步骤；若所述写操作数量大于所述第二预设数量值，则返回执行所述在所述目标缓存层中确定第一数量个所述目标写操作数据的步骤。14.根据权利要求13所述的方法，其特征在于，所述预估所述目标虚拟机在未来时长内的写操作数量，包括：获取所述目标虚拟机在历史时长内的历史写操作数量；基于所述历史写操作数量，确定所述目标虚拟机在各个时间段内的平均写操作数量；基于所述平均写操作数量，预估所述目标虚拟机在未来时长内的所述写操作数量。15.根据权利要求1所述的方法，其特征在于，所述将所述第一写操作数据重定向至目标缓存层之后，还包括：获取所述目标虚拟机发送的读操作请求；在所述目标缓存层中查找与所述读操作请求对应的最新的目标数据；若在所述目标缓存层中查找到所述目标数据，则返回所述目标数据至所述目标虚拟机；若未在所述目标缓存层中查找到所述目标数据，则在所述虚拟磁盘中查找到所述目标数据后返回至所述目标虚拟机。16.根据权利要求1所述的方法，其特征在于，所述将所述目标缓存层中的目标写操作数据重定向至所述目标虚拟机对应的虚拟磁盘中之后，还包括：格式化并旁路所述目标缓存层；获取所述目标虚拟机发送的第三写操作数据；将所述第三写操作数据存储至所述虚拟磁盘中。17.根据权利要求1所述的方法，其特征在于，所述响应于存在对所述目标虚拟机的快照操作，将所述第一写操作数据重定向至目标缓存层之前，还包括：判断是否接收到所述目标虚拟机的快照指令；若接收到所述快照指令，则确定所述目标缓存层；初始化所述目标缓存层。18.根据权利要求17所述的方法，其特征在于，所述确定所述目标缓存层，包括：确定所述目标虚拟机的快照时长；预估所述快照时长内进行写操作所需的数据存储量；基于所述数据存储量确定所述目标缓存层。19.根据权利要求1所述的方法，其特征在于，所述获取目标虚拟机发送的第一写操作数据之后，还包括：响应于不存在对所述目标虚拟机的快照操作，将所述第一写操作数据存储至所述目标虚拟机对应的所述虚拟磁盘中。20.一种虚拟机快照系统，其特征在于，应用于物理服务器，包括：第一获取模块，用于获取目标虚拟机发送的第一写操作数据；第一重定向模块，用于响应于存在对所述目标虚拟机的快照操作，将所述第一写操作数据重定向至目标缓存层；第二重定向模块，用于待所述目标虚拟机的快照操作结束后，将所述目标缓存层中的目标写操作数据重定向至所述目标虚拟机对应的虚拟磁盘中。21.一种电子设备，其特征在于，包括：存储器，用于存储计算机程序；处理器，用于执行所述计算机程序时实现如权利要求1至19任一项所述虚拟机快照方法的步骤。22.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质中存储有计算机程序，所述计算机程序被处理器执行时实现如权利要求1至19任一项所述虚拟机快照方法的步骤。
说明书desc
技术领域本发明涉及服务器虚拟技术领域，更具体地说，涉及一种虚拟机快照方法、系统、电子设备及计算机可读存储介质。背景技术虚拟化是构建云计算基础架构的技术之一，快照技术是虚拟化的功能之一，可以将虚拟机的当前运行状态进行保存，并在需要时将系统运行状态恢复到某个历史时刻。然而，当对服务器中的虚拟机进行快照时，会中断虚拟机的写操作，导致虚拟机需等待快照结束后才能继续进行写操作，影响虚拟机的业务稳定性。综上所述，如何保证虚拟机的业务稳定性是目前本领域技术人员亟待解决的问题。发明内容本发明的目的是提供一种虚拟机快照方法，其能在一定程度上解决如何提高虚拟机的业务稳定性的技术问题。本发明还提供了一种虚拟机快照系统、电子设备及计算机可读存储介质。根据本发明实施例的第一方面，提供一种虚拟机快照方法，应用于物理服务器，包括：获取目标虚拟机发送的第一写操作数据；响应于存在对所述目标虚拟机的快照操作，将所述第一写操作数据重定向至目标缓存层；待所述目标虚拟机的快照操作结束后，将所述目标缓存层中的目标写操作数据重定向至所述目标虚拟机对应的虚拟磁盘中。在一示例性实施例中，所述将所述第一写操作数据重定向至目标缓存层，包括：获取所述第一写操作数据的第一接收时间戳；基于所述第一接收时间戳，按照接收时间先后顺序，将所述第一写操作数据存储至目标队列中；从所述目标队列的头部开始，依次将所述目标队列中的所述第一写操作数据重定向至所述目标缓存层。在一示例性实施例中，所述将所述第一写操作数据重定向至目标缓存层，包括：生成所述第一写操作数据的记录头信息；判断所述第一写操作数据是否完整；若所述第一写操作数据完整，则生成完整标记，基于所述记录头信息、所述第一写操作数据、所述完整标记生成写操作记录，将所述写操作记录重定向至所述目标缓存层。在一示例性实施例中，所述判断所述第一写操作数据是否完整之后，还包括：若所述第一写操作数据不完整，则发送表征所述第一写操作数据不完整的信息至所述目标虚拟机；接收所述目标虚拟机发送的所述第一写操作数据的补充数据；将所述补充数据添加至所述第一写操作数据中，返回执行所述判断所述第一写操作数据是否完整的步骤。在一示例性实施例中，所述生成所述第一写操作数据的记录头信息，包括：获取所述第一写操作数据的请求编号；获取所述第一写操作数据在所述虚拟磁盘上的地址信息；获取所述第一写操作数据的长度信息；基于所述第一接收时间戳、所述请求编号、所述地址信息和所述长度信息生成所述记录头信息。在一示例性实施例中，所述将所述目标缓存层中的目标写操作数据重定向至所述目标虚拟机对应的虚拟磁盘中，包括：对于所述目标缓存层中的每个所述目标写操作数据，从所述目标写操作数据对应的记录头信息中解析出所述目标写操作数据的目标接收时间戳；按照时间先后顺序，对所述目标接收时间戳进行排序，得到排序时间戳；从所述排序时间戳的头部开始，依次将所述排序时间戳对应的所述目标写操作数据重定向至所述目标虚拟机对应的所述虚拟磁盘中。在一示例性实施例中，所述判断所述第一写操作数据是否完整，包括：获取所述目标虚拟机发送的所述第一写操作数据对应的第一校验码；生成所述第一写操作数据的第二校验码；判断所述第一校验码与所述第二校验码是否一致；若所述第一校验码与所述第二校验码一致，则判定所述第一写操作数据完整；若所述第一校验码与所述第二校验码不一致，则判定所述第一写操作数据不完整。在一示例性实施例中，所述将所述目标缓存层中的目标写操作数据重定向至所述目标虚拟机对应的虚拟磁盘中，包括：在所述目标缓存层中确定第一数量个所述目标写操作数据；将所述第一数量个所述目标写操作数据重定向至所述目标虚拟机对应的所述虚拟磁盘中；判断是否阻塞所述目标虚拟机的写操作；若是，则阻塞所述目标虚拟机的写操作，每次在所述目标缓存层中确定第二数量个所述目标写操作数据，将所述第二数量个所述目标写操作数据重定向至所述目标虚拟机对应的所述虚拟磁盘中，直至所述目标缓存层为空；其中，在不阻塞所述目标虚拟机的写操作时，获取所述目标虚拟机的第二写操作数据并重定向至所述目标缓存层。在一示例性实施例中，所述判断是否阻塞所述目标虚拟机的写操作之后，还包括：若不阻塞所述目标虚拟机的写操作，则在所述目标缓存层中确定第三数量个所述目标写操作数据；将所述第三数量个所述目标写操作数据重定向至所述目标虚拟机对应的所述虚拟磁盘中；返回执行所述判断是否阻塞所述目标虚拟机的写操作的步骤。在一示例性实施例中，所述判断是否阻塞所述目标虚拟机的写操作，包括：确定所述目标缓存层中剩余的所述目标写操作数据的目标数量值；判断所述目标数量值是否小于第一预设数量值；若所述目标数量值小于所述第一预设数量值，则判定阻塞所述目标虚拟机的写操作；若所述目标数量值大于等于所述第一预设数量值，则判定不阻塞所述目标虚拟机的写操作。在一示例性实施例中，所述判断是否阻塞所述目标虚拟机的写操作，包括：确定所述目标缓存层中剩余的所述目标写操作数据的目标数据量；判断所述目标数据量是否小于预设数据量值；若所述目标数据量小于所述预设数据量值，则判定阻塞所述目标虚拟机的写操作；若所述目标数据量大于等于所述预设数据量值，则判定不阻塞所述目标虚拟机的写操作。在一示例性实施例中，所述判断是否阻塞所述目标虚拟机的写操作，包括：确定所述目标缓存层中剩余的所述目标写操作数据的目标数据量；基于所述目标数据量预估所述目标缓存层的数据重定向时长；判断所述数据重定向时长是否小于预设时长；若所述数据重定向时长小于所述预设时长，则判定阻塞所述目标虚拟机的写操作；若所述数据重定向时长大于等于所述预设时长，则判定不阻塞所述目标虚拟机的写操作。在一示例性实施例中，所述将所述第一数量个所述目标写操作数据重定向至所述目标虚拟机对应的所述虚拟磁盘中之后，所述判断是否阻塞所述目标虚拟机的写操作之前，还包括：预估所述目标虚拟机在未来时长内的写操作数量；判断所述写操作数量是否大于第二预设数量值；若所述写操作数量小于等于所述第二预设数量值，则执行所述判断是否阻塞所述目标虚拟机的写操作的步骤；若所述写操作数量大于所述第二预设数量值，则返回执行所述在所述目标缓存层中确定第一数量个所述目标写操作数据的步骤。在一示例性实施例中，所述预估所述目标虚拟机在未来时长内的写操作数量，包括：获取所述目标虚拟机在历史时长内的历史写操作数量；基于所述历史写操作数量，确定所述目标虚拟机在各个时间段内的平均写操作数量；基于所述平均写操作数量，预估所述目标虚拟机在未来时长内的所述写操作数量。在一示例性实施例中，所述将所述第一写操作数据重定向至目标缓存层之后，还包括：获取所述目标虚拟机发送的读操作请求；在所述目标缓存层中查找与所述读操作请求对应的最新的目标数据；若在所述目标缓存层中查找到所述目标数据，则返回所述目标数据至所述目标虚拟机；若未在所述目标缓存层中查找到所述目标数据，则在所述虚拟磁盘中查找到所述目标数据后返回至所述目标虚拟机。在一示例性实施例中，所述将所述目标缓存层中的目标写操作数据重定向至所述目标虚拟机对应的虚拟磁盘中之后，还包括：格式化并旁路所述目标缓存层；获取所述目标虚拟机发送的第三写操作数据；将所述第三写操作数据存储至所述虚拟磁盘中。在一示例性实施例中，所述响应于存在对所述目标虚拟机的快照操作，将所述第一写操作数据重定向至目标缓存层之前，还包括：判断是否接收到所述目标虚拟机的快照指令；若接收到所述快照指令，则确定所述目标缓存层；初始化所述目标缓存层。在一示例性实施例中，所述确定所述目标缓存层，包括：确定所述目标虚拟机的快照时长；预估所述快照时长内进行写操作所需的数据存储量；基于所述数据存储量确定所述目标缓存层。在一示例性实施例中，所述获取目标虚拟机发送的第一写操作数据之后，还包括：响应于不存在对所述目标虚拟机的快照操作，将所述第一写操作数据存储至所述目标虚拟机对应的所述虚拟磁盘中。根据本发明实施例的第二方面，提供一种虚拟机快照系统，应用于物理服务器，包括：第一获取模块，用于获取目标虚拟机发送的第一写操作数据；第一重定向模块，用于响应于存在对所述目标虚拟机的快照操作，将所述第一写操作数据重定向至目标缓存层；第二重定向模块，用于待所述目标虚拟机的快照操作结束后，将所述目标缓存层中的目标写操作数据重定向至所述目标虚拟机对应的虚拟磁盘中。根据本发明实施例的第三方面，提供一种电子设备，包括：存储器，用于存储计算机程序；处理器，用于执行所述计算机程序时实现如上任一所述虚拟机快照方法的步骤。根据本发明实施例的第四方面，提供一种计算机可读存储介质，所述计算机可读存储介质中存储有计算机程序，所述计算机程序被处理器执行时实现如上任一所述虚拟机快照方法的步骤。本发明提供的一种虚拟机快照方法，应用于物理服务器，获取目标虚拟机发送的第一写操作数据；响应于存在对目标虚拟机的快照操作，将第一写操作数据重定向至目标缓存层；待目标虚拟机的快照操作结束后，将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中。本发明的有益效果是：目标虚拟机存在快照时，依然可以借助目标缓存层处理目标虚拟机的写操作，保证了快照的正常进行和目标虚拟机的业务稳定性。本发明提供的一种虚拟机快照系统、电子设备及计算机可读存储介质也解决了相应技术问题。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据提供的附图获得其他的附图。图1为本发明实施例提供的一种虚拟机快照方法的第一流程图；图2为目标缓存层的结构示意图；图3为本发明实施例提供的一种虚拟机快照方法的第二流程图；图4为本发明实施例提供的一种虚拟机快照方法的第三流程图；图5为本发明实施例提供的一种虚拟机快照方法的第三流程图；图6为本发明实施例提供的一种虚拟机快照系统的结构示意图；图7为本发明实施例提供的一种电子设备的结构示意图；图8为本发明实施例提供的一种电子设备的另一结构示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。请参阅图1，图1为本发明实施例提供的一种虚拟机快照方法的第一流程图。本发明实施例提供的一种虚拟机快照方法，应用于物理服务器，可以包括以下步骤：步骤S101：获取目标虚拟机发送的第一写操作数据。实际应用中，物理服务器，具体可以为物理服务器中的虚拟化管理程序获取目标虚拟机发送的第一写操作数据，目标虚拟机可以为单一虚拟机，也可以为多个虚拟机，且写操作数据可以包括写请求及所需写入的数据等，本发明在此不做具体限定。步骤S102：响应于存在对目标虚拟机的快照操作，将第一写操作数据重定向至目标缓存层。实际应用中，在获取第一写操作数据之后，若目标虚拟机正在进行快照，也即响应于存在对目标虚拟机的快照操作时，将第一写操作数据重定向至目标缓存层，以便借助目标缓存层处理第一写操作数据。步骤S103：待目标虚拟机的快照操作结束后，将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中。实际应用中，在将第一写操作数据重定向至目标缓存层之后，物理服务器还需监视目标虚拟机的快照进度，需在目标虚拟机的快照操作结束后，才能将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中，以真正将写操作数据落盘。需要说明的是，在等待目标虚拟机的快照操作结束的过程中，所有新接收的写操作数据均需重定向至目标缓存层中。具体应用场景中，目标缓存层可以是物理服务器的存储池中的某块存储空间，如图2所示，也可以是额外为物理服务器配置的存储空间等，本发明在此不做具体限定。此外，由于目标缓存层归物理服务器管理，与后端存储池解耦合，所以本发明可以适用于不同类型的存储池，比如可以适用于本地存储池、集中式存储池、软件定义存储池等。本发明提供的一种虚拟机快照方法，应用于物理服务器，获取目标虚拟机发送的第一写操作数据；响应于存在对目标虚拟机的快照操作，将第一写操作数据重定向至目标缓存层；待目标虚拟机的快照操作结束后，将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中。本发明的有益效果是：目标虚拟机存在快照时，依然可以借助目标缓存层处理目标虚拟机的写操作，保证了快照的正常进行和目标虚拟机的业务稳定性。请参阅图3，图3为本发明实施例提供的一种虚拟机快照方法的第二流程图。本发明实施例提供的一种虚拟机快照方法，应用于物理服务器，可以包括以下步骤：步骤S201：获取目标虚拟机发送的第一写操作数据。步骤S202：响应于存在对目标虚拟机的快照操作，获取第一写操作数据的第一接收时间戳。步骤S203：基于第一接收时间戳，按照接收时间先后顺序，将第一写操作数据存储至目标队列中。步骤S204：从目标队列的头部开始，依次将目标队列中的第一写操作数据重定向至目标缓存层。实际应用中，在将第一写操作数据重定向至目标缓存层的过程中，考虑到写操作数据需按照接收时间顺序进行落盘，为了便于实现此操作，可以先将写操作数据顺序存储在目标缓存层中，也即可以获取第一写操作数据的第一接收时间戳；基于第一接收时间戳，按照接收时间先后顺序，将第一写操作数据存储至目标队列中，具体的，可以存储至目标队列的尾部；从目标队列的头部开始，依次将目标队列中的第一写操作数据重定向至目标缓存层，这样，目标缓存层承接的新业务IO是向尾部写入，因此IO写回过程与虚拟机IO请求处理事并行工作，IO请求不会阻塞。具体应用场景中，为了便于记录每个写操作数据，在将第一写操作数据重定向至目标缓存层的过程中，可以生成第一写操作数据的记录头信息；判断第一写操作数据是否完整；若第一写操作数据完整，则生成完整标记，基于记录头信息、第一写操作数据、完整标记生成写操作记录，比如可以按照顺次将记录头信息、第一写操作数据、完整性标记进行组合生成写操作记录等，再将写操作记录重定向至目标缓存层。具体应用场景中，在判断第一写操作数据是否完整之后，若第一写操作数据不完整，则还可以发送表征第一写操作数据不完整的信息至目标虚拟机；接收目标虚拟机发送的第一写操作数据的补充数据；将补充数据添加至第一写操作数据中，返回执行判断第一写操作数据是否完整的步骤。具体应用场景中，在生成第一写操作数据的记录头信息的过程中，为了便于后续了解写操作数据的相应信息，可以获取第一写操作数据的请求编号；获取第一写操作数据在虚拟磁盘上的地址信息；获取第一写操作数据的长度信息；基于第一接收时间戳、请求编号、地址信息和长度信息生成记录头信息。具体应用场景中，在判断第一写操作数据是否完整的过程中，可以获取目标虚拟机发送的第一写操作数据对应的第一校验码；生成第一写操作数据的第二校验码；判断第一校验码与第二校验码是否一致；若第一校验码与第二校验码一致，则判定第一写操作数据完整；若第一校验码与第二校验码不一致，则判定第一写操作数据不完整。步骤S205：待目标虚拟机的快照操作结束后，将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中。具体应用场景中，在将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中的过程中，对于目标缓存层中的每个目标写操作数据，可以从目标写操作数据对应的记录头信息中解析出目标写操作数据的目标接收时间戳；按照时间先后顺序，对目标接收时间戳进行排序，得到排序时间戳；从排序时间戳的头部开始，依次将排序时间戳对应的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中。请参阅图4，图4为本发明实施例提供的一种虚拟机快照方法的第三流程图。本发明实施例提供的一种虚拟机快照方法，应用于物理服务器，可以包括以下步骤：步骤S301：获取目标虚拟机发送的第一写操作数据。步骤S302：响应于存在对目标虚拟机的快照操作，将第一写操作数据重定向至目标缓存层。步骤S303：在目标缓存层中确定第一数量个目标写操作数据。步骤S304：将第一数量个目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中。步骤S305：判断是否阻塞目标虚拟机的写操作；若是，则执行步骤S306；若否，则执行步骤S307。步骤S306：阻塞目标虚拟机的写操作，每次在目标缓存层中确定第二数量个目标写操作数据，将第二数量个目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中，直至目标缓存层为空。步骤S307：在目标缓存层中确定第三数量个目标写操作数据。步骤S308：将第三数量个目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中，返回执行步骤S305；其中，在不阻塞目标虚拟机的写操作时，获取目标虚拟机的第二写操作数据并重定向至目标缓存层。实际应用中，在将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中的过程中，因为无法瞬间将目标写操作数据重定向至虚拟磁盘上，而在此过程中，可能仍需处理目标虚拟机的写操作数据，所以为了均衡目标虚拟机的写操作数据的处理及重定向，可以在目标缓存层中确定第一数量个目标写操作数据；将第一数量个目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中；判断是否阻塞目标虚拟机的写操作；若是，则阻塞目标虚拟机的写操作，此时不再处理目标虚拟机新发送的写操作数据，每次在目标缓存层中确定第二数量个目标写操作数据，将第二数量个目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中，直至目标缓存层为空；其中，在不阻塞目标虚拟机的写操作时，获取目标虚拟机的第二写操作数据并重定向至目标缓存层。需要说明的是，当目标缓存层中的目标写操作数据全部重定向至虚拟磁盘中之后，后续的写操作数据可以正常写入虚拟磁盘，所以在阻塞目标虚拟机的写操作及完成目标写数据的重定向的过程中，目标虚拟机的业务处于中断状态，因此可以根据目标虚拟机所允许的中断时长来确定阻塞目标虚拟机的写操作的条件，本发明在此不做具体限定。具体应用场景中，在判断是否阻塞目标虚拟机的写操作之后，若不阻塞目标虚拟机的写操作，则在目标缓存层中确定第三数量个目标写操作数据；将第三数量个目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中；返回执行判断是否阻塞目标虚拟机的写操作的步骤。第一数量、第二数量和第三数量的值可以根据应用场景确定，比如三个值可以为同一个值等。具体应用场景中，在判断是否阻塞目标虚拟机的写操作的过程中，考虑到剩余目标写操作数据的个数值，也即数量值会影响目标虚拟机的中断时长，所以可以确定目标缓存层中剩余的目标写操作数据的目标数量值；判断目标数量值是否小于第一预设数量值；若目标数量值小于第一预设数量值，则判定阻塞目标虚拟机的写操作；若目标数量值大于等于第一预设数量值，则判定不阻塞目标虚拟机的写操作。具体应用场景中，在判断是否阻塞目标虚拟机的写操作的过程中，考虑到剩余目标写操作数据的数据量值会影响目标虚拟机的中断时长，所以可以确定目标缓存层中剩余的目标写操作数据的目标数据量；判断目标数据量是否小于预设数据量值；若目标数据量小于预设数据量值，则判定阻塞目标虚拟机的写操作；若目标数据量大于等于预设数据量值，则判定不阻塞目标虚拟机的写操作。具体应用场景中，在判断是否阻塞目标虚拟机的写操作的过程中，考虑到剩余目标写操作数据的转移时长影响目标虚拟机的中断时长，所以可以确定目标缓存层中剩余的目标写操作数据的数据量；基于数据量预估目标缓存层的数据重定向时长；判断数据重定向时长是否小于预设时长；若数据重定向时长小于预设时长，则判定阻塞目标虚拟机的写操作；若数据重定向时长大于等于预设时长，则判定不阻塞目标虚拟机的写操作。具体应用场景中，在将第一数量个目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中之后，判断是否阻塞目标虚拟机的写操作之前，还可以预估目标虚拟机在未来时长内的写操作数量；判断写操作数量是否大于第二预设数量值；若写操作数量小于等于第二预设数量值，则执行判断是否阻塞目标虚拟机的写操作的步骤；若写操作数量大于第二预设数量值，则返回执行在目标缓存层中确定第一数量个目标写操作数据的步骤。也即在目标虚拟机需处理大量写操作的情况下，可以延迟对目标虚拟机的阻塞时刻，以保证目标虚拟机不会积压大量的写操作数据，进一步保证虚拟机的业务稳定性。具体应用场景中，在预估目标虚拟机在未来时长内的写操作数量的过程中，可以根据历史写操作数据来进行预估，也即可以获取目标虚拟机在历史时长内的历史写操作数量；基于历史写操作数量，确定目标虚拟机在各个时间段内的平均写操作数量；基于平均写操作数量，预估目标虚拟机在未来时长内的写操作数量，比如在未来时长命中单一时间段时，直接将该时间段所对应的平均写操作数量作为未来时长内的预估写操作数量，在未来时长命中多个时间段时，可以将该多个时间段所对应的平均写操作数量的平均值作为未来时长内的预估写操作数等。请参阅图5，图5为本发明实施例提供的一种虚拟机快照方法的第三流程图。本发明实施例提供的一种虚拟机快照方法，应用于物理服务器，可以包括以下步骤：步骤S401：获取目标虚拟机发送的第一写操作数据。步骤S402：响应于存在对目标虚拟机的快照操作，将第一写操作数据重定向至目标缓存层。步骤S403：待目标虚拟机的快照操作结束后，将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中。步骤S404：获取目标虚拟机发送的读操作请求。步骤S405：在目标缓存层中查找与读操作请求对应的最新的目标数据。步骤S406：若在目标缓存层中查找到目标数据，则返回目标数据至目标虚拟机。步骤S407：若未在目标缓存层中查找到目标数据，则在虚拟磁盘中查找到目标数据后返回至目标虚拟机。实际应用中，在将第一写操作数据重定向至目标缓存层之后，若磁石需进行数据读取，需综合目标缓存层和虚拟磁盘来进行数据读取，也即可以获取目标虚拟机发送的读操作请求；在目标缓存层中查找与读操作请求对应的最新的目标数据；若在目标缓存层中查找到目标数据，则返回目标数据至目标虚拟机；若未在目标缓存层中查找到目标数据，则在虚拟磁盘中查找到目标数据后返回至目标虚拟机。实际应用中，在将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中之后，便可以按照正常的处理方式来直接将目标虚拟机的写操作数据存储至虚拟磁盘中，此时不再应用目标缓存层，也即可以格式化并旁路目标缓存层，以使目标缓存层失效；获取目标虚拟机发送的第三写操作数据；将第三写操作数据存储至虚拟磁盘中。实际应用中，在响应于存在对目标虚拟机的快照操作，将第一写操作数据重定向至目标缓存层之前，还可以判断是否接收到目标虚拟机的快照指令；若接收到快照指令，则确定目标缓存层；初始化目标缓存层，比如初始化目标缓存层的地址空间、初始化目标缓存层的状态等，以准确目标缓存层进行作业。实际应用中，在确定目标缓存层的过程中，可以根据快照时长来预估目标缓存层的大小，也即可以确定目标虚拟机的快照时长；预估快照时长内进行写操作所需的数据存储量；基于数据存储量确定目标缓存层。实际应用中，在获取目标虚拟机发送的第一写操作数据之后，当不存在快照时，也即响应于不存在对目标虚拟机的快照操作时，可以将第一写操作数据存储至目标虚拟机对应的虚拟磁盘中。请参阅图6，图6为本发明实施例提供的一种虚拟机快照系统的结构示意图。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，可以包括：第一获取模块101，用于获取目标虚拟机发送的第一写操作数据；第一重定向模块102，用于响应于存在对目标虚拟机的快照操作，将第一写操作数据重定向至目标缓存层；第二重定向模块103，用于待目标虚拟机的快照操作结束后，将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第一重定向模块可以包括：第一获取单元，用于获取第一写操作数据的第一接收时间戳；第一存储单元，用于基于第一接收时间戳，按照接收时间先后顺序，将第一写操作数据存储至目标队列中；第一重定向单元，用于从目标队列的头部开始，依次将目标队列中的第一写操作数据重定向至目标缓存层。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第一重定向单元可以具体用于：生成第一写操作数据的记录头信息；判断第一写操作数据是否完整；若第一写操作数据完整，则生成完整标记，基于记录头信息、第一写操作数据、完整标记生成写操作记录，将写操作记录重定向至目标缓存层。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第一重定向单元还可以用于：判断第一写操作数据是否完整之后，若第一写操作数据不完整，则发送表征第一写操作数据不完整的信息至目标虚拟机；接收目标虚拟机发送的第一写操作数据的补充数据；将补充数据添加至第一写操作数据中，返回执行判断第一写操作数据是否完整的步骤。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第一重定向单元可以具体用于：获取第一写操作数据的请求编号；获取第一写操作数据在虚拟磁盘上的地址信息；获取第一写操作数据的长度信息；基于第一接收时间戳、请求编号、地址信息和长度信息生成记录头信息。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第二重定向模块可以包括：第一解析单元，用于对于目标缓存层中的每个目标写操作数据，从目标写操作数据对应的记录头信息中解析出目标写操作数据的目标接收时间戳；第一排序单元，用于按照时间先后顺序，对目标接收时间戳进行排序，得到排序时间戳；第二重定向单元，用于从排序时间戳的头部开始，依次将排序时间戳对应的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第一重定向单元可以具体用于：获取目标虚拟机发送的第一写操作数据对应的第一校验码；生成第一写操作数据的第二校验码；判断第一校验码与第二校验码是否一致；若第一校验码与第二校验码一致，则判定第一写操作数据完整；若第一校验码与第二校验码不一致，则判定第一写操作数据不完整。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第二重定向模块可以包括：第一确定单元，用于在目标缓存层中确定第一数量个目标写操作数据；第三重定向单元，用于将第一数量个目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中；第一判断单元，用于判断是否阻塞目标虚拟机的写操作；若是，则阻塞目标虚拟机的写操作，每次在目标缓存层中确定第二数量个目标写操作数据，将第二数量个目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中，直至目标缓存层为空；其中，在不阻塞目标虚拟机的写操作时，获取目标虚拟机的第二写操作数据并重定向至目标缓存层。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第一判断单元可以具体用于：判断是否阻塞目标虚拟机的写操作之后，若不阻塞目标虚拟机的写操作，则在目标缓存层中确定第三数量个目标写操作数据；将第三数量个目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中；返回执行判断是否阻塞目标虚拟机的写操作的步骤。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第一判断单元可以具体用于：确定目标缓存层中剩余的目标写操作数据的目标数量值；判断目标数量值是否小于第一预设数量值；若目标数量值小于第一预设数量值，则判定阻塞目标虚拟机的写操作；若目标数量值大于等于第一预设数量值，则判定不阻塞目标虚拟机的写操作。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第一判断单元可以具体用于：确定目标缓存层中剩余的目标写操作数据的目标数据量；判断目标数据量是否小于预设数据量值；若目标数据量小于预设数据量值，则判定阻塞目标虚拟机的写操作；若目标数据量大于等于预设数据量值，则判定不阻塞目标虚拟机的写操作。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第一判断单元可以具体用于：确定目标缓存层中剩余的目标写操作数据的目标数据量；基于目标数据量预估目标缓存层的数据重定向时长；判断数据重定向时长是否小于预设时长；若数据重定向时长小于预设时长，则判定阻塞目标虚拟机的写操作；若数据重定向时长大于等于预设时长，则判定不阻塞目标虚拟机的写操作。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，还可以包括：第一预估单元，用于第三重定向单元将第一数量个目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中之后，第一判断单元判断是否阻塞目标虚拟机的写操作之前，预估目标虚拟机在未来时长内的写操作数量；第二判断单元，用于判断写操作数量是否大于第二预设数量值；若写操作数量小于等于第二预设数量值，则执行判断是否阻塞目标虚拟机的写操作的步骤；若写操作数量大于第二预设数量值，则返回执行在目标缓存层中确定第一数量个目标写操作数据的步骤。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第一预估单元可以具体用于：获取目标虚拟机在历史时长内的历史写操作数量；基于历史写操作数量，确定目标虚拟机在各个时间段内的平均写操作数量；基于平均写操作数量，预估目标虚拟机在未来时长内的写操作数量。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，还可以包括：第二获取模块，用于第一重定向模块将第一写操作数据重定向至目标缓存层之后，获取目标虚拟机发送的读操作请求；第一查找模块，用于在目标缓存层中查找与读操作请求对应的最新的目标数据；若在目标缓存层中查找到目标数据，则返回目标数据至目标虚拟机；若未在目标缓存层中查找到目标数据，则在虚拟磁盘中查找到目标数据后返回至目标虚拟机。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，还可以包括：第一处理模块，用于第二重定向模块将目标缓存层中的目标写操作数据重定向至目标虚拟机对应的虚拟磁盘中之后，格式化并旁路目标缓存层；第三获取模块，用于获取目标虚拟机发送的第三写操作数据；第一存储模块，用于将第三写操作数据存储至虚拟磁盘中。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，还可以包括：第一判断模块，用于第一重定向模块响应于存在对目标虚拟机的快照操作，将第一写操作数据重定向至目标缓存层之前，判断是否接收到目标虚拟机的快照指令；若接收到快照指令，则确定目标缓存层；初始化目标缓存层。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，第一判断模块可以具体用于：确定目标虚拟机的快照时长；预估快照时长内进行写操作所需的数据存储量；基于数据存储量确定目标缓存层。本发明实施例提供的一种虚拟机快照系统，应用于物理服务器，还可以包括：第二存储模块，用于第一获取模块获取目标虚拟机发送的第一写操作数据之后，响应于不存在对目标虚拟机的快照操作，将第一写操作数据存储至目标虚拟机对应的虚拟磁盘中。本发明还提供了一种电子设备及计算机可读存储介质，其均具有本发明实施例提供的一种虚拟机快照方法具有的对应效果。请参阅图7，图7为本发明实施例提供的一种电子设备的结构示意图。本发明实施例提供的一种电子设备，包括存储器201和处理器202，存储器201中存储有计算机程序，处理器202执行计算机程序时实现如上任一实施例所描述虚拟机快照方法的步骤。请参阅图8，本发明实施例提供的另一种电子设备中还可以包括：与处理器202连接的输入端口203，用于传输外界输入的命令至处理器202；与处理器202连接的显示单元204，用于显示处理器202的处理结果至外界；与处理器202连接的通信模块205，用于实现电子设备与外界的通信。显示单元204可以为显示面板、激光扫描使显示器等；通信模块205所采用的通信方式包括但不局限于移动高清链接技术、通用串行总线、高清多媒体接口、无线连接：无线保真技术、蓝牙通信技术、低功耗蓝牙通信技术、基于IEEE802.11s的通信技术。本发明实施例提供的一种计算机可读存储介质，计算机可读存储介质中存储有计算机程序，计算机程序被处理器执行时实现如上任一实施例所描述虚拟机快照方法的步骤。本发明所涉及的计算机可读存储介质包括随机存储器、内存、只读存储器、电可编程ROM、电可擦除可编程ROM、寄存器、硬盘、可移动磁盘、CD-ROM、或技术领域内所公知的任意其它形式的存储介质。本发明实施例提供的虚拟机快照方法、系统、电子设备及计算机可读存储介质中相关部分的说明请参见本发明实施例提供的虚拟机快照方法中对应部分的详细说明，在此不再赘述。另外，本发明实施例提供的上述技术方案中与现有技术中对应技术方案实现原理一致的部分并未详细说明，以免过多赘述。还需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括所述要素的过程、方法、物品或者设备中还存在另外的相同要素。对所公开的实施例的上述说明，使本领域技术人员能够实现或使用本发明。对这些实施例的多种修改对本领域技术人员来说将是显而易见的，本文中所定义的一般原理可以在不脱离本发明的精神或范围的情况下，在其它实施例中实现。因此，本发明将不会被限制于本文所示的这些实施例，而是要符合与本文所公开的原理和新颖特点相一致的最宽的范围。
