标题title
酒店多供应商资源并行查询耗时的熔断方法和系统
摘要abst
本发明公开了一种酒店多供应商资源并行查询耗时的熔断方法和系统。熔断方法包括：选取标杆酒店，将标杆酒店的静态信息存入基础数据表；建立酒店映射表，将其它所有供应商的静态信息和标杆酒店的静态信息进行匹配映射；将基础数据表中的酒店数据输出给前端；获取选中的标杆酒店ID，后端再通过标杆酒店ID查询酒店映射表，获取供应商类型、供应商酒店CODE；根据供应商类型，查询调用API接口时的超时阈值；根据供应商酒店CODE和对应的超时阈值，构建各供应商的请求任务，将请求任务加入任务集合中，开启并行调用；对于超时的任务终止等待响应；将在超时内获取的数据整合并输出至前端。本发明能够有效提高查询效率，并保证了整合后数据的准确性和时效性。
权利要求书clms
1.一种酒店多供应商资源并行查询耗时的熔断方法，其特征在于，包括：从多个酒店供应商中选取一个供应商作为标杆酒店，将所述标杆酒店的静态信息作为基础标准化数据存入标准化基础数据表；建立酒店映射表，将其它所有供应商的静态信息和所述标杆酒店的静态信息进行匹配映射；如果映射成功，则往所述酒店映射表中插入一条记录，并标记供应商酒店CODE和供应商类型；所述其它所有供应商为所述多个酒店供应商中除去所述标杆酒店的供应商；将所述标准化基础数据表中的酒店数据作为酒店列表输出给用户前端；用户进入酒店列表，选中某一个酒店，进行房型价格政策查询；获取到选中的标杆酒店ID，后端再通过所述标杆酒店ID查询所述酒店映射表，获取目标供应商类型、目标供应商酒店CODE信息；根据所述目标供应商类型，查询配置中心中配置的在调用各个供应商的酒店静态信息API接口时的超时时间阈值；根据所述目标供应商酒店CODE和对应的超时时间阈值，构建各供应商的请求任务信息，并根据所述超时时间阈值设置各供应商的请求任务的执行超时时间；将构建的各供应商的请求任务加入任务集合中，并开启并行调用；对于超过设置的执行超时时间的任务，根据并行调用的特性，终止等待响应；将在执行超时时间内获取到的数据进行整合，并输出至用户前端。2.根据权利要求1所述的熔断方法，其特征在于，所述建立酒店映射表的过程包括：通过调用各个酒店供应商的酒店静态信息API接口获取到各供应商的酒店静态信息；将获取到的各供应商的酒店静态信息和所述标准化基础数据表进行比对，如果一致，则认为是一个酒店，则往所述酒店映射表中插入一条记录，并记录对应的供应商类型、供应商酒店CODE信息。3.根据权利要求2所述的熔断方法，其特征在于，所述静态信息包括酒店名称、酒店地址、酒店联系电话、酒店图片中的一个或多个；所述酒店映射表至少包括以下字段：主键ID、所述标准化基础数据表的主键ID、供应商类型、供应商酒店CODE。4.根据权利要求1所述的熔断方法，其特征在于，在调用各个供应商的酒店静态信息API接口后，将响应数据缓存到Redis中；同时，将所调用的API接口名称及对应的接口响应时间也记录到Redis中；根据所述接口响应时间，按照预设的第一时间间隔统计所调用的API接口的平均耗时，如果所述平均耗时大于等于超时时间阈值，则将所述超时时间阈值调大；如果所述平均耗时小于超时时间阈值，则将所述超时时间阈值调小。5.根据权利要求1所述的熔断方法，其特征在于，所述将在执行超时时间内获取到的数据进行整合包括：对多个供应商的API接口返回的核心数据进行字符串分析，实现房型合并和政策合并。6.一种酒店多供应商资源并行查询耗时的熔断系统，其特征在于，所述系统包括：标准化基础数据表构建模块，用于从多个酒店供应商中选取一个供应商作为标杆酒店，将所述标杆酒店的静态信息作为基础标准化数据存入标准化基础数据表；酒店映射表构建模块，用于建立酒店映射表，将其它所有供应商的静态信息和所述标杆酒店的静态信息进行匹配映射；如果映射成功，则往所述酒店映射表中插入一条记录，并标记供应商酒店CODE和供应商类型；所述其它所有供应商为所述多个酒店供应商中除去所述标杆酒店的供应商；第一输出模块，用于将所述标准化基础数据表中的酒店数据作为酒店列表输出给用户前端；用户进入酒店列表，选中某一个酒店，进行房型价格政策查询；目标查询信息获取模块，用于获取到选中的标杆酒店ID，后端再通过所述标杆酒店ID查询所述酒店映射表，获取目标供应商类型、目标供应商酒店CODE信息；超时时间信息获取模块，用于根据所述目标供应商类型，查询配置中心中配置的在调用各个供应商的酒店静态信息API接口时的超时时间阈值；查询请求任务构建模块，用于根据所述目标供应商酒店CODE和对应的超时时间阈值，构建各供应商的请求任务信息，并根据所述超时时间阈值设置各供应商的请求任务的执行超时时间；查询请求任务执行模块，用于将构建的各供应商的请求任务加入任务集合中，并开启并行调用；对于超过设置的执行超时时间的任务，根据并行调用的特性，终止等待响应；第二输出模块，将在执行超时时间内获取到的数据进行整合，并输出至用户前端。7.根据权利要求6所述的熔断系统，其特征在于，所述建立酒店映射表的过程包括：通过调用各个酒店供应商的酒店静态信息API接口获取到各供应商的酒店静态信息；将获取到的各供应商的酒店静态信息和所述标准化基础数据表进行比对，如果一致，则认为是一个酒店，则往所述酒店映射表中插入一条记录，并记录对应的供应商类型、供应商酒店CODE信息。8.根据权利要求7所述的熔断系统，其特征在于，所述静态信息包括酒店名称、酒店地址、酒店联系电话、酒店图片中的一个或多个；所述酒店映射表至少包括以下字段：主键ID、所述标准化基础数据表的主键ID、供应商类型、供应商酒店CODE。9.根据权利要求6所述的熔断系统，其特征在于，在调用各个供应商的酒店静态信息API接口后，将响应数据缓存到Redis中；同时，将所调用的API接口名称及对应的接口响应时间也记录到Redis中；根据所述接口响应时间，按照预设的第一时间间隔统计所调用的API接口的平均耗时，如果所述平均耗时大于等于超时时间阈值，则将所述超时时间阈值调大；如果所述平均耗时小于超时时间阈值，则将所述超时时间阈值调小。10.根据权利要求6所述的熔断系统，其特征在于，所述将在执行超时时间内获取到的数据进行整合包括：对多个供应商的API接口返回的核心数据进行字符串分析，实现房型合并和政策合并。
说明书desc
技术领域本发明属于数据搜索技术领域，具体涉及一种酒店多供应商资源并行查询耗时的熔断方法和系统。背景技术在酒店、机票等资源在线预订电商性质的平台中，资源的来源是多元化的。既有自签的资源，也有分销其他OTA等其他平台的资源。那么对于这些资源的查询整合是关键。在资源整合方法中，存在多种方法，比如预先将从各渠道的资源进行落地，再用离线非实时整合，还有一种是在线实时地调用资源供应商API进行查询整合，再对整合后的数据进行标准化落地，提升用户查询效率。第一种方法实施的条件难度往往比较大，数据的时效性保障上的挑战不小。第二种方法相较于第一种方法，缺点是数据的丰富性和查询效率教查，但是最大的优点是能保证数据的时效性，技术实操性比较简单。在一定阶段，往往会先采用第二种的方式进行资源处理。现有技术中，离线式调用供应商的API接口获取原生数据，并对数据进行落地，然后再根据各个供应商的落地数据进行标准化清洗整合。这种方法存在多方面的挑战，比如：海量数据存储、价格政策的时效性，搜索方案的设计等。每一方面都需要投入较大的人力，物力和财力，技术力。在商业模式还未得到验证，或者产品初期，使用这种方案无疑会延缓产品的上线，及诸多挑战带来的产品预订体验的不稳定甚至系统性错误。发明内容本发明的目的是提供了一种在线实时查询多供应商酒店、机票等资源的价格数据，并实时进行整合输出。一方面降低了实现技术的难度，另一方面屏蔽了海量数据存储处理等方便的难度，更重要的是保证了价格数据的准确性和时效性。基于此，大大提升了产品迭代的效率和用户体验。为了达到前述发明目的，本发明采用了以下方案：本发明的一个方面提供了一种酒店多供应商资源并行查询耗时熔断方法，包括：从多个酒店供应商中选取一个供应商作为标杆酒店，将所述标杆酒店的静态信息作为基础标准化数据存入标准化基础数据表；建立酒店映射表，将其它所有供应商的静态信息和所述标杆酒店的静态信息进行匹配映射；如果映射成功，则往所述酒店映射表中插入一条记录，并标记供应商酒店CODE和供应商类型；所述其它所有供应商为所述多个酒店供应商中除去所述标杆酒店的供应商；将所述标准化基础数据表中的酒店数据作为酒店列表输出给用户前端；用户进入酒店列表，选中某一个酒店，进行房型价格政策查询；获取到选中的标杆酒店ID，后端再通过所述标杆酒店ID查询所述酒店映射表，获取目标供应商类型、目标供应商酒店CODE信息；根据所述目标供应商类型，查询配置中心中配置的在调用各个供应商的酒店静态信息API接口时的超时时间阈值；根据所述目标供应商酒店CODE和对应的超时时间阈值，构建各供应商的请求任务信息，并根据所述超时时间阈值设置各供应商的请求任务的执行超时时间；将构建的各供应商的请求任务加入任务集合中，并开启并行调用；对于超过设置的执行超时时间的任务，根据并行调用的特性，终止等待响应；将在执行超时时间内获取到的数据进行整合，并输出至用户前端。本发明的另一个方面提供了一种酒店多供应商资源并行查询耗时熔断系统，所述系统包括：标准化基础数据表构建模块，用于从多个酒店供应商中选取一个供应商作为标杆酒店，将所述标杆酒店的静态信息作为基础标准化数据存入标准化基础数据表；酒店映射表构建模块，用于建立酒店映射表，将其它所有供应商的静态信息和所述标杆酒店的静态信息进行匹配映射；如果映射成功，则往所述酒店映射表中插入一条记录，并标记供应商酒店CODE和供应商类型；所述其它所有供应商为所述多个酒店供应商中除去所述标杆酒店的供应商；第一输出模块，用于将所述标准化基础数据表中的酒店数据作为酒店列表输出给用户前端；用户进入酒店列表，选中某一个酒店，进行房型价格政策查询；目标查询信息获取模块，用于获取到选中的标杆酒店ID，后端再通过所述标杆酒店ID查询所述酒店映射表，获取目标供应商类型、目标供应商酒店CODE信息；超时时间信息获取模块，用于根据所述目标供应商类型，查询配置中心中配置的在调用各个供应商的酒店静态信息API接口时的超时时间阈值；查询请求任务构建模块，用于根据所述目标供应商酒店CODE和对应的超时时间阈值，构建各供应商的请求任务信息，并根据所述超时时间阈值设置各供应商的请求任务的执行超时时间；查询请求任务执行模块，用于将构建的各供应商的请求任务加入任务集合中，并开启并行调用；对于超过设置的执行超时时间的任务，根据并行调用的特性，终止等待响应；第二输出模块，将在执行超时时间内获取到的数据进行整合，并输出至用户前端。与现有技术相比，本发明至少具有如下优点：本发明在接收到用户的查询请求后，后端根据事先做好的酒店映射，决定调用哪些供应商的房型价格API。在调用供应商的API时，根据配置中心配置好的各供应商的超时时间发起多任务并行调用。当其中某些供应商接口响应超过设定的超时时间阈值时，程序将终止查询等待它的响应结果。那些在规定时间内返回供应商的数据，先各自做标准化数据结构的转化，然后，程序再将各供应商转化后的数据集合起来，进行房型数据，价格政策数据的整合，即根据产品需求进行目标数据的筛选，价格策略设定等逻辑处理。本发明提出的技术方案，根据不同供应商接口的特性，针对性地配置超时时间，保证查询了查询效率。保证产品体验的同时保证了整合后数据的准确性和时效性，降低了实时难度。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明中记载的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明一实施方式的多供应商查询耗时熔断方法时序图。具体实施方式为使本发明的目的、技术方案和优点更加清楚，下面结合附图对本发明的具体实施方式进行详细说明。这些优选实施方式的示例在附图中进行了例示。附图中所示和根据附图描述的本发明的实施方式仅仅是示例性的，并且本发明并不限于这些实施方式。在此，还需要说明的是，为了避免因不必要的细节而模糊了本发明，在附图中仅仅示出了与根据本发明的方案密切相关的结构和/或处理步骤，而省略了与本发明关系不大的其他细节。本发明的一个方面提供了一种酒店多供应商资源并行查询耗时熔断方法，包括：从多个酒店供应商中选取一个供应商作为标杆酒店，将所述标杆酒店的静态信息作为基础标准化数据存入标准化基础数据表；建立酒店映射表，将其它所有供应商的静态信息和所述标杆酒店的静态信息进行匹配映射；如果映射成功，则往所述酒店映射表中插入一条记录，并标记供应商酒店CODE和供应商类型；所述其它所有供应商为所述多个酒店供应商中除去所述标杆酒店的供应商；将所述标准化基础数据表中的酒店数据作为酒店列表输出给用户前端；用户进入酒店列表，选中某一个酒店，进行房型价格政策查询；获取到选中的标杆酒店ID，后端再通过所述标杆酒店ID查询所述酒店映射表，获取目标供应商类型、目标供应商酒店CODE信息；根据所述目标供应商类型，查询配置中心中配置的在调用各个供应商的酒店静态信息API接口时的超时时间阈值；根据所述目标供应商酒店CODE和对应的超时时间阈值，构建各供应商的请求任务信息，并根据所述超时时间阈值设置各供应商的请求任务的执行超时时间；将构建的各供应商的请求任务加入任务集合中，并开启并行调用；对于超过设置的执行超时时间的任务，根据并行调用的特性，终止等待响应；将在执行超时时间内获取到的数据进行整合，并输出至用户前端。在一个实施例中，所述建立酒店映射表的过程包括：通过调用各个酒店供应商的酒店静态信息API接口获取到各供应商的酒店静态信息；将获取到的各供应商的酒店静态信息和所述标准化基础数据表进行比对，如果一致，则认为是一个酒店，则往所述酒店映射表中插入一条记录，并记录对应的供应商类型、供应商酒店CODE信息。在一个实施例中，所述静态信息包括酒店名称、酒店地址、酒店联系电话、酒店图片中的一个或多个；所述酒店映射表至少包括以下字段：主键ID、所述标准化基础数据表的主键ID、供应商类型、供应商酒店CODE。在一个实施例中，在调用各个供应商的酒店静态信息API接口后，将响应数据缓存到Redis中；同时，将所调用的API接口名称及对应的接口响应时间也记录到Redis中；根据所述接口响应时间，按照预设的第一时间间隔统计所调用的API接口的平均耗时，如果所述平均耗时大于等于超时时间阈值，则将所述超时时间阈值调大；如果所述平均耗时小于超时时间阈值，则将所述超时时间阈值调小。在一个实施例中，所述将在执行超时时间内获取到的数据进行整合包括：对多个供应商的API接口返回的核心数据进行字符串分析，实现房型合并和政策合并。本发明的另一个方面提供了一种酒店多供应商资源并行查询耗时熔断系统，所述系统包括：标准化基础数据表构建模块，用于从多个酒店供应商中选取一个供应商作为标杆酒店，将所述标杆酒店的静态信息作为基础标准化数据存入标准化基础数据表；酒店映射表构建模块，用于建立酒店映射表，将其它所有供应商的静态信息和所述标杆酒店的静态信息进行匹配映射；如果映射成功，则往所述酒店映射表中插入一条记录，并标记供应商酒店CODE和供应商类型；所述其它所有供应商为所述多个酒店供应商中除去所述标杆酒店的供应商；第一输出模块，用于将所述标准化基础数据表中的酒店数据作为酒店列表输出给用户前端；用户进入酒店列表，选中某一个酒店，进行房型价格政策查询；目标查询信息获取模块，用于获取到选中的标杆酒店ID，后端再通过所述标杆酒店ID查询所述酒店映射表，获取目标供应商类型、目标供应商酒店CODE信息；超时时间信息获取模块，用于根据所述目标供应商类型，查询配置中心中配置的在调用各个供应商的酒店静态信息API接口时的超时时间阈值；查询请求任务构建模块，用于根据所述目标供应商酒店CODE和对应的超时时间阈值，构建各供应商的请求任务信息，并根据所述超时时间阈值设置各供应商的请求任务的执行超时时间；查询请求任务执行模块，用于将构建的各供应商的请求任务加入任务集合中，并开启并行调用；对于超过设置的执行超时时间的任务，根据并行调用的特性，终止等待响应；第二输出模块，将在执行超时时间内获取到的数据进行整合，并输出至用户前端。在一个实施例中，所述建立酒店映射表的过程包括：通过调用各个酒店供应商的酒店静态信息API接口获取到各供应商的酒店静态信息；将获取到的各供应商的酒店静态信息和所述标准化基础数据表进行比对，如果一致，则认为是一个酒店，则往所述酒店映射表中插入一条记录，并记录对应的供应商类型、供应商酒店CODE信息。在一个实施例中，所述静态信息包括酒店名称、酒店地址、酒店联系电话、酒店图片中的一个或多个；所述酒店映射表至少包括以下字段：主键ID、所述标准化基础数据表的主键ID、供应商类型、供应商酒店CODE。在一个实施例中，在调用各个供应商的酒店静态信息API接口后，将响应数据缓存到Redis中；同时，将所调用的API接口名称及对应的接口响应时间也记录到Redis中；根据所述接口响应时间，按照预设的第一时间间隔统计所调用的API接口的平均耗时，如果所述平均耗时大于等于超时时间阈值，则将所述超时时间阈值调大；如果所述平均耗时小于超时时间阈值，则将所述超时时间阈值调小。在一个实施例中，所述将在执行超时时间内获取到的数据进行整合包括：对多个供应商的API接口返回的核心数据进行字符串分析，实现房型合并和政策合并。图1是本发明技术方案的主流程图。如图1所示，本发明提出的酒店多供应商资源并行查询耗时熔断方法包括下列步骤：选定某一个供应商的酒店静态信息作为基础标标准化数据，比如酒店名称、酒店地址、酒店联系电话、酒店图片等，将这些静态信息存入基础数据表，即酒店信息表。然后建立酒店映射表，其他所有供应商的酒店数据跟标杆酒店信息进行匹配映射。如果映射成功，则往映射表插入一条记录，标记供应商的酒店Code和供应商类型。映射表的字段有：Id、HotelId、SupplierType、SupplierHotelCode。通过调用各个酒店供应商的酒店静态信息API接口获取到各供应商的酒店静态信息，然后根据这些静态信息和之前已保存的标准化基础数据表进行比对，如果一样，则认为是一个酒店，则往酒店映射表插入一条记录，记录该供应商类型，供应商酒店code等信息。通过API将酒店标准化静态信息基础数据表的酒店数据输出给前端，称之为酒店列表。用户进入酒店列表，选中某一个酒店，进行房型价格政策查询。在第步骤中，获取到选中的标杆酒店ID，后端再以标杆酒店ID，查询酒店映射表，查询出需要查询哪些供应商哪些酒店的房型价格等信息。根据第步获取到的供应商类型，查询配置中心中配置的在调用各个供应商API接口时的超时时间阈值。在调用各个供应商API接口后，将相应数据缓存到Redis中，提升后续再次查询的效率。同时，将接口名称及接口响应时间也记录到Redis,每一小时统计该接口的平均耗时情况。如果因为设置的阈值小而导致大量的接口超时，则程序自动修改调大阈值，并发送通知信息给业务人员，让业务人员跟进观察。如果统计出的平均耗时远低于设置的超时时间阈值，则自动调小，并发送通知信息给业务人员，让业务人员跟进观察。通过这种方式，可以更精准地掌握供应商的较快调用耗时。另外，有一套针对每个客户的第三方接口超时设置配置。业务人员也可以根据客户的要求，给不同的客户设置不同的超时时间，这个超时时间不可自动修改，只能由业务人员手动调整。根据第和第步获取到供应商酒店Code和对应的超时时间，构建各供应商的请求信息，并设任务的执行超时时间。将第步构建好的任务放到一个任务集合中，开启并行调用。超过设定的超时时间的任务，根据并行调用的特性，终止等待响应。将第步在超时时间内获取到的数据进行整合，并说出给前端。在一具体实施方式中，数据整合过程如下：A供应商房型价格接口返回的核心数据如下：大床房、有窗；大床房下有2个政策：有早餐B供应商房型价格接口返回的核心数据如下：高级大床房、有窗；高级大床房下有2个政策：无早、有早餐针对如上两个供应商的房型政策信息，系统自动合并房型和政策，减少数据量，让用户精准选择，提升用户体验。合并整合策略如下：先合并房型：预先将“豪华”、“高级”等字符串从房型名称中删除。移除后如果两个供应商的房型名称相同，且窗型一样，则认为是同一个房型，否则就是两个房型。政策合并：通过房型合并成功后，再合并两个房型下的政策。如供应商的早餐一样，则认为是相同的政策。通过和两个步骤的逻辑处理，输出给用的整合后的数据为：大床房有窗：无早、有早餐。应当理解，虽然本说明书按照实施方式加以描述，但并非每个实施方式仅包含一个独立的技术方案，说明书的这种叙述方式仅仅是为清楚起见，本领域技术人员应当将说明书作为一个整体，各实施例的技术方案也可以经适当组合形成本领域技术人员可以理解的其他实施方式。
