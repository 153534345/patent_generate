标题title
用于芯片仿真中大规模结构线性方程组的并行求解方法
摘要abst
本发明公开了一种用于芯片仿真中大规模结构线性方程组的并行求解方法，涉及电路仿真技术领域，包括：步骤一，对仿真稀疏矩阵排序后分块得到单层箭形结构的矩阵；步骤二，对角线上每个子矩阵按箭形结构分块，转化为双层箭形结构矩阵；步骤三，对角线中箭形矩阵耦合边合并至大矩阵耦合边，双层箭形矩阵转化为单层箭形矩阵；步骤四，重复上述步骤直至矩阵中对角块数量达到预期，输出排序的置换向量与分块具体位置；步骤五，并行处理具有相同结构且非零元位置相同的初始矩阵，得到具有多对角块的单层箭形结构矩阵；步骤六，并行对单层箭形结构进行LU分解，得到单层单边对角结构下三角矩阵L和上三角矩阵U；步骤七，并行求解过渡向量w和最终解x。
权利要求书clms
1.一种用于芯片仿真中大规模结构线性方程组的并行求解方法，其特征在于，包括以下步骤：步骤一，用嵌套分割法对仿真稀疏矩阵进行排序，按箭形的结构进行分块，得到一个具有单层箭形结构的矩阵；步骤二，将步骤一中单层箭形矩阵的对角线上的每个子矩阵，分别用嵌套分割法进行排序，再按箭形的结构进行分块，此时单层箭形结构转化为具有双层箭形结构的矩阵；步骤三，将步骤二中得到的双层箭形结构的矩阵通过排序将对角线中的箭形矩阵的耦合边合并至大矩阵的耦合边中，此时双层箭形矩阵转化为单层箭形矩阵；步骤四，重复步骤二和步骤三直至矩阵中的对角块数量达到预期设置，输出排序的置换向量与分块的具体位置；步骤五，根据排序的置换向量与分块的具体位置，并行处理数万个具有相同结构且非零元位置相同的初始矩阵，得到数万个具有多对角块的单层箭形结构的矩阵；步骤六，并行对单层箭形结构的矩阵进行LU分解，得到单层单边对角结构的下三角矩阵L和上三角矩阵U；步骤七，并行求解过渡向量 w 和最终解 x。2.根据权利要求1所述的用于芯片仿真中大规模结构线性方程组的并行求解方法，其特征在于，所述步骤一中，按箭形的结构进行分块，具体包括以下内容：设置耦合块占整个矩阵的比例；设置每个对角块占整个矩阵的比例；设置输出排序的置换向量以及分块的具体位置。3.根据权利要求1所述的用于芯片仿真中大规模结构线性方程组的并行求解方法，其特征在于，所述步骤四中，对于不满足箭形的对角块进行近似最小度排序。4.根据权利要求1所述的用于芯片仿真中大规模结构线性方程组的并行求解方法，其特征在于，所述步骤六中，通过对单层箭形矩阵的对角块进行LU分解，得到下三角矩阵L和上三角矩阵U的对角块的数值。5.根据权利要求4所述的用于芯片仿真中大规模结构线性方程组的并行求解方法，其特征在于，所述步骤六中，对角分解结果结合单层箭形矩阵的耦合边求解得到下三角矩阵L和上三角矩阵U的单边。
说明书desc
技术领域本发明涉及电路仿真技术领域，具体涉及一种用于芯片仿真中大规模结构线性方程组的并行求解方法。背景技术由于集成电路技术的高速发展，在一个芯片上可以集成数万乃至数十万、数百万个晶体管的电路，因而所需要进行电路模拟的电路规模十分庞大。许多计算密集型的应用最终都会化简成为求解大规模线性方程组的问题，因此,在广泛的应用中,许多求解大规模线性方程组的并行算法扮演着非常重要的作用。对于线性方程组有许多分类方法,一种分类方法是简单的将其划分成稠密线性方程组和稀疏线程方程组,稠密线性方程组一般采取直接法求解,而稀疏线性方程组一般采取迭代法求解,特别是大规模稀疏线程方程组的求解在实际应用中尤其重要。集成电路瞬态仿真，根本问题是在每个时间点求解大规模非线性方程组，对于非线性方程组的求解，需要采用牛顿迭代方法。而牛顿迭代方法的每一步，都需要在Ax=b计算完成之后，检查阻尼系数是否满足条件、进行收敛性判定后，再进行下一步操作即可,需要求解成千上万个具有相同结构的线性方程组Ax＝b，而稀疏线性方程组求解复杂度高、耗时长。由于稀疏线性方程组求解占据了电路仿真总时间的最大比例,成为了电路仿真的性能瓶颈。此外对于大规模集成电路瞬态仿真，采用现有的方法，执行每次牛顿迭代过程，都要检查阻尼系数是否满足条件、进行收敛性判定，使得每次牛顿迭代过程的时间比较缓慢，降低了仿真效率。如何快速执行每次牛顿迭代过程，成为一个重要技术问题。发明内容本发明要解决的技术问题就在于：本发明提供一种用于芯片仿真中大规模结构线性方程组的并行求解方法。为解决上述技术问题，本发明提出的技术方案为：一种用于芯片仿真中大规模结构线性方程组的并行求解方法，包括以下步骤：步骤一，用嵌套分割法对仿真稀疏矩阵进行排序，按箭形的结构进行分块，得到一个具有单层箭形结构的矩阵；步骤二，将步骤一中单层箭形矩阵的对角线上的每个子矩阵，分别用嵌套分割法进行排序，再按箭形的结构进行分块，此时单层箭形结构转化为具有双层箭形结构的矩阵；步骤三，将步骤二中得到的双层箭形结构的矩阵通过排序将对角线中的箭形矩阵的耦合边合并至大矩阵的耦合边中，此时双层箭形矩阵转化为单层箭形矩阵；步骤四，重复步骤二和步骤三直至矩阵中的对角块数量达到预期设置，输出排序的置换向量与分块的具体位置；步骤五，根据排序的置换向量与分块的具体位置，并行处理数万个具有相同结构且非零元位置相同的初始矩阵，得到数万个具有多对角块的单层箭形结构的矩阵；步骤六，并行对单层箭形结构的矩阵进行LU分解，得到单层单边对角结构的下三角矩阵L和上三角矩阵U；步骤七，并行求解过渡向量 w 和最终解 x。作为上述技术方案的进一步改进为：上述技术方案中，优选地，所述步骤一中，按箭形的结构进行分块，具体包括以下内容：设置耦合块占整个矩阵的比例，默认设置为1%；设置每个对角块占整个矩阵的比例，默认设置为1%；设置输出排序的置换向量以及分块的具体位置。上述技术方案中，优选地，所述步骤四中，对于不满足箭形的对角块进行近似最小度排序。上述技术方案中，优选地，所述步骤六中，通过对单层箭形矩阵的对角块进行LU分解，得到下三角矩阵L和上三角矩阵U的对角块的数值。上述技术方案中，优选地，所述步骤六中，对角分解结果结合单层箭形矩阵的耦合边求解得到下三角矩阵L和上三角矩阵U的单边。本发明提供的用于芯片仿真中大规模结构线性方程组的并行求解方法，与现有技术相比，有以下优点：本发明的用于芯片仿真中大规模结构线性方程组的并行求解方法，采用对角加边矩阵划分方法对电路进行划分, 建立各划分的方程组, 并行LU分解和回代求解方法, 从而加快仿真速度。本发明的用于芯片仿真中大规模结构线性方程组的并行求解方法，求解第一个线性方程组时，记录矩阵排序的置换向量与分块的具体位置，后续求解具有相同结构的线性方程组时，根据排序的置换向量与分块的具体位置，即可直接得到具有多对角块的线性方程组。本发明用于芯片仿真中大规模结构线性方程组的并行求解方法，有效地利用芯片仿真中大规模结构线性方程组的稀疏矩阵特点，系数矩阵的非零元位置保持不变，通过对大规模矩阵进行嵌套排序分块，提高了方程组求解的计算效率，克服了常用的不分块方法求解效率较低和不能充分利用求解矩阵结构特点的缺陷。附图说明图1是本发明应用实施时对角加边矩阵划分示意图。图2是本发明应用实施时的流程示意图。图3是本发明应用实施时的单层箭形矩阵LU分解及求解的示意图。图4是本发明应用实施时步骤三中双层箭形矩阵转化为单层箭形矩阵的示意图。具体实施方式下面将结合本说明书实施例中的附图，对本说明书实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本说明书一部分实施例，而不是全部的实施例。基于本说明书中的实施例，本领域普通技术人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。图1至图3示出了本发明用于芯片仿真中大规模结构线性方程组的并行求解方法的一种实施方式，本实施例的并行求解方法采用对角加边矩阵划分的方法，划分示意图如图1所示。具体包括以下步骤：步骤一，用嵌套分割法对仿真稀疏矩阵进行排序，按箭形的结构进行分块，得到一个具有单层箭形结构的矩阵。按箭形的结构进行分块，具体包括以下内容：设置耦合块占整个矩阵的比例，默认设置为1%。设置耦合块与整个矩阵的占比，可以避免划分之后输出的箭形矩阵中耦合块过大的情形。默认设置为1%，有可能导致稀疏矩阵无法划分为一个箭形矩阵，因此需要设置了一个while循环，通过逐步增大耦合块占整个矩阵的比例，从而确保能得到一个具有单层箭形结构的矩阵。设置每个对角块占整个矩阵的比例，默认设置为1%。设置对角块与整个矩阵的占比，可以避免出现对角块过小的情形。设置输出排序的置换向量以及分块的具体位置。因为在芯片仿真中，需要连续求解从一个稳态到另一个稳态的过渡过程中电信号的变化，从而需要求解成千上万个具有相同结构的线性方程组，即系数矩阵的非零元位置保持不变，只需要这同一个排序的置换向量与分块的具体位置即可处理这成千上万个具有相同结构的线性方程组。每一个矩阵都可以通过同样的排序与分块，转化为具有多对角块的单层箭形结构的矩阵。步骤二，将步骤一中得到的单层箭形矩阵的对角线上的每个子矩阵，分别用嵌套分割法进行排序，再按箭形的结构进行分块，将对角线上的每个子矩阵转化为一个单层箭形矩阵，整个稀疏矩阵转化为具有双层箭形结构的矩阵。对于对角线上的每个子矩阵进行排序时，需要对大矩阵中对应的耦合边进行排序，从而确保矩阵的整体性。嵌套分割法是使用图论方法来生成减少填充的排序，该算法是一种多级图形分区算法，将矩阵视为图的邻接矩阵，通过将图中的顶点对折叠在一起，大幅减小问题的规模。在对较小的图重新排序后，该算法随即通过应用投影和细化步骤，将图恢复至原始大小。与其他重新排序算法相比，它往往产生最少的填充量。步骤三，将步骤二中得到的双层箭形结构的矩阵通过排序把对角线中的箭形矩阵的耦合边合并到大矩阵的耦合边中，此时双层箭形矩阵便又转化为单层箭形矩阵，如图4所示。对于双层箭形结构的矩阵并非所有的对角块都是具有箭形结构的矩阵，一方面因为对角块的矩阵无法通过嵌套分割法的排序得到箭形结构，另一方面因为对角块的矩阵规模已经足够小了，无法再进一步划分为箭形矩阵，因此只需要把具备箭形结构的对角块的矩阵的耦合边合并到大矩阵的耦合边中，即可把双层箭形矩阵转化为单层箭形矩阵。对矩阵重新排序通常可以使其 LU 因子更加稀疏。最简单的重新排序是按照非零元素计数为列排序，对于具有及其不规则结构的矩阵而言，这是一个优选的重新排序方法，尤其是行或列的非零元素计数出现重大变化时。对稀疏矩阵的各行和列重新排序可以加快计算速度，因为对矩阵重新排序，有可能减少由于分解而产生的填充值数量，从而降低后续计算的时间和存储成本。步骤四，重复步骤二和步骤三，直至矩阵中的对角块数量达到预期设置，默认设置为100，输出排序的置换向量与分块的具体位置。对于不满足箭形的对角块还需要进行近似最小度排序，以便再次进行嵌套分割法排序时，能具有箭形的结构。步骤五，根据输出排序的置换向量与分块的具体位置，并行处理数万个具有相同结构的初始矩阵，即可得到数万个具有多对角块的单层箭形结构的矩阵。在芯片仿真中，由于需要连续求解从一个稳态到另一个稳态的过渡过程中电信号的变化，因此需要求解成千上万个具有相同结构的线性方程组，本发明的方法只需要同一个排序的置换向量与分块的具体位置即可处理这成千上万个具有相同结构的线性方程组，每一个矩阵都可以通过这同样的排序与分块，转化为具有多对角块的单层箭形结构的矩阵。步骤六，并行对步骤五中的单层箭形结构进行LU分解，得到单层单边对角结构的下三角矩阵L和上三角矩阵U。并行对具有多对角块的单层箭形结构进行LU分解，矩阵可以分解为一个上三角矩阵 U、一个单位下三角矩阵 L 和一个置换矩阵 P，并满足 PA=LU，其中置换矩阵 P 解释行交换，计算 的 LU 分解，然后，使用因子来求解两个三角线性系统。单层箭形是双边对角块，而LU分解会得到单层单边对角结构的下三角矩阵L和上三角矩阵U，下三角矩阵L和上三角矩阵U的对角块的数值是通过对单层箭形矩阵的对角块进行LU分解得到的，下三角矩阵L和上三角矩阵U的单边，是根据对角分解得到的结果再结合单层箭形矩阵的耦合边求解得到。在求解线性系统之前预先计算矩阵因子的方法可以在求解许多线性系统时提高性能，因为分解仅发生一次而不需要重复。预先计算矩阵因子可获得许多性能优势，而不需要知道如何使用这些因子。步骤七，并行求解过渡向量 w 和最终解 x。在该步骤，并行求解过渡向量 w 和最后的解 x，如图三所示，得到的解是具有块结构的值，按顺序合并成列向量，再经过逆排序即可得到最终的解x。上述实施案例只是本发明的较佳实施例，并非对本发明作任何形式上的限制。虽然本发明已以较佳实施例揭露如上，然而并非用以限定本发明。因此，凡是未脱离本发明技术方案的内容，依据本发明技术实质对以上实施例所做的任何简单修改、等同变化及修饰，均应落在本发明技术方案保护的范围内。
