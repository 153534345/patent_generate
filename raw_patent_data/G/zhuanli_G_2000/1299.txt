标题title
基于MR的CAD文件查看方法、装置、介质和设备
摘要abst
本发明公开了一种基于MR的CAD文件查看方法、装置、介质和设备，首先获取目标三维模型的CAD文件，然后对CAD文件进行解析并将解析结果保存为MR设备支持的标准格式数据。接着，获取MR设备在大地坐标系下的设备坐标，并通过坐标转换参数将标准格式数据中各要素的三维坐标转换为在同一大地坐标系下的显示坐标。最后，基于设备坐标在坐标转换后的标准格式数据中查找预设空间范围内的数据，对这些数据进行投影渲染，生成对应的三维立体模型，实现混合现实效果。可见，本发明可实现在现场直观立体的查看CAD文件。
权利要求书clms
1.一种基于MR的CAD文件查看方法，其特征在于，应用于MR设备中，所述方法包括：获取目标三维模型的CAD文件；其中，所述CAD文件中包含由点要素构成的点要素模型、由线要素构成的线要素模型及由面要素构成的面要素模型、每一要素模型中的要素标注有三维坐标、名称及连接关系；对所述CAD文件进行解析并将解析结果保存为所述MR设备支持的标准格式数据；获取所述MR设备在大地坐标系下的设备坐标，并基于坐标转换参数将所述标准格式数据中各要素的三维坐标转换为在同一大地坐标系下的显示坐标；基于所述设备坐标在坐标转换后的标准格式数据中查找预设空间范围内的标准格式数据，对预设空间范围内的标准格式数据进行投影渲染以生成对应的三维立体模型。2.根据权利要求1所述的方法，其特征在于，所述点要素包括绿植、道路、建筑及公园；所述线要素包括细实线、粗实线、中心线、虚线及标注线；所述面要素包括纯色填充、网格填充、斜线填充以及图案填充。3.根据权利要求1所述的方法，其特征在于，所述获取目标三维模型的CAD文件之后，还包括：若所述CAD文件为非解析格式，则将非解析格式的CAD文件准换为dxf格式的CAD文件。4.根据权利要求1所述的方法，其特征在于，所述对所述CAD文件进行解析并将解析结果保存为所述MR设备支持的标准格式数据之后，还包括：根据CAD图层信息对标准格式数据进行分层。5.根据权利要求1所述的方法，其特征在于，所述MR设备上还设置有双目相机，所述方法还包括：获取所述双目相机拍摄到的现实实景的双目图像，提取所述双目图像中的特征点并进行特征点匹配，基于匹配成功的特征点的水平坐标计算特征点的视差值；基于所述视差值和所述双目相机的焦距与基线长度，计算所述现实实景内特征点的深度信息；基于所述设备坐标和预设空间范围内标准格式数据的显示坐标计算所有投影点的投影距离；若目标投影点的投影距离小于或等于目标投影路径上特征点的深度信息，则对所述目标投影点进行投影渲染，若目标投影点的投影距离大于目标投影路径上特征点的深度信息，则对所述目标投影点进行遮蔽；其中，所述目标投影点为所有投影点中的任意一个，所述目标投影路径为所述目标投影点的投影路径。6.根据权利要求5所述的方法，其特征在于，所述视差值的计算公式为：上式中，d指示视差值，和/＞分别指示左右图像中匹配成功的特征点的水平坐标；所述深度信息的计算公式为：上式中，z指示特征点的深度信息，指示双目相机的焦距，/＞指示双目相机的基线长度。7.根据权利要求1所述的方法，其特征在于，投影距离的计算公式以为：上式中，指示MR设备到第i个投影点的投影距离，指示设备坐标，指示第i个投影点的显示坐标。8.一种基于MR的CAD文件查看装置，其特征在于，应用于MR设备中，所述装置包括：文件获取模块，用于获取目标三维模型的CAD文件；其中，所述CAD文件中包含由点要素构成的点要素模型、由线要素构成的线要素模型及由面要素构成的面要素模型、每一要素模型中的要素标注有三维坐标、名称及连接关系；解析模块，用于对所述CAD文件进行解析并将解析结果保存为所述MR设备支持的标准格式数据；坐标统一模块，用于获取所述MR设备在大地坐标系下的设备坐标，并基于坐标转换参数将所述标准格式数据中各要素的三维坐标转换为在同一大地坐标系下的显示坐标；投影渲染模块，用于投影基于所述设备坐标在坐标转换后的标准格式数据中查找预设空间范围内的标准格式数据，对预设空间范围内的标准格式数据进行投影渲染以生成对应的三维立体模型。9.一种计算机可读存储介质，其特征在于，存储有计算机程序，所述计算机程序被处理器执行时，使得所述处理器执行如权利要求1至7中任一项所述方法的步骤。10.一种基于MR的CAD文件查看设备，其特征在于，包括存储器和处理器，所述存储器存储有计算机程序，所述计算机程序被所述处理器执行时，使得所述处理器执行如权利要求1至7中任一项所述方法的步骤。
说明书desc
技术领域本发明涉及CAD数据查看技术领域，尤其是涉及一种基于MR的CAD文件查看方法、装置、介质和设备。背景技术CAD是一款自动计算机辅助设计软件，可以用于绘制二维制图和基本三维设计，通过它无需懂得编程，即可自动制图，可以实现从绘图到修改到成图打印等一系列功能。广泛应用于土木建筑、装潢设计、工业制图、工程制图、电子工业、服装加工、城市规划、园林设计、机械设计、航空航天、轻工化工等诸多领域。用户在使用CAD图纸进行现场施工作业时，需要理解复杂的CAD图纸并通过坐标放样，将CAD图纸内容放样到现场实地，来确定CAD各图层内容和现场环境的关系，这种将CAD图纸展示到现场的方式一方面不够直观，另外也效率较低。因此需要一种更加高效的方法，来对应CAD图纸与现实场景之间的相互关系，指导用户现场施工，提高工作效率。发明内容基于此，有必要提供基于MR的CAD文件查看方法、装置、介质和设备，以解决无法较为直观立体的查看CAD文件的问题。一种基于MR的CAD文件查看方法，应用于MR设备中，所述方法包括：获取目标三维模型的CAD文件；其中，所述CAD文件中包含由点要素构成的点要素模型、由线要素构成的线要素模型及由面要素构成的面要素模型、每一要素模型中的要素标注有三维坐标、名称及连接关系；对所述CAD文件进行解析并将解析结果保存为所述MR设备支持的标准格式数据；获取所述MR设备在大地坐标系下的设备坐标，并基于坐标转换参数将所述标准格式数据中各要素的三维坐标转换为在同一大地坐标系下的显示坐标；基于所述设备坐标在坐标转换后的标准格式数据中查找预设空间范围内的标准格式数据，对预设空间范围内的标准格式数据进行投影渲染以生成对应的三维立体模型。在其中一个实施例中，所述点要素包括绿植、道路、建筑及公园；所述线要素包括细实线、粗实线、中心线、虚线及标注线；所述面要素包括纯色填充、网格填充、斜线填充以及图案填充。在其中一个实施例中，所述获取目标三维模型的CAD文件之后，还包括：若所述CAD文件为非解析格式，则将非解析格式的CAD文件准换为dxf格式的CAD文件。在其中一个实施例中，所述对所述CAD文件进行解析并将解析结果保存为所述MR设备支持的标准格式数据之后，还包括：根据CAD图层信息对标准格式数据进行分层。在其中一个实施例中，所述MR设备上还设置有双目相机，所述方法还包括：获取所述双目相机拍摄到的现实实景的双目图像，提取所述双目图像中的特征点并进行特征点匹配，基于匹配成功的特征点的水平坐标计算特征点的视差值；基于所述视差值和所述双目相机的焦距与基线长度，计算所述现实实景内特征点的深度信息；基于所述设备坐标和预设空间范围内标准格式数据的显示坐标计算所有投影点的投影距离；若目标投影点的投影距离小于或等于目标投影路径上特征点的深度信息，则对所述目标投影点进行投影渲染，若目标投影点的投影距离大于目标投影路径上特征点的深度信息，则对所述目标投影点进行遮蔽；其中，所述目标投影点为所有投影点中的任意一个，所述目标投影路径为所述目标投影点的投影路径。在其中一个实施例中，所述视差值的计算公式为：上式中，d指示视差值，和/＞分别指示左右图像中匹配成功的特征点的水平坐标；所述深度信息的计算公式为：上式中，z指示特征点的深度信息，指示双目相机的焦距，/＞指示双目相机的基线长度。在其中一个实施例中，投影距离的计算公式以为：上式中，指示MR设备到第i个投影点的投影距离，指示设备坐标，指示第i个投影点的显示坐标。一种基于MR的CAD文件查看装置，应用于MR设备中，所述装置包括：文件获取模块，用于获取目标三维模型的CAD文件；其中，所述CAD文件中包含由点要素构成的点要素模型、由线要素构成的线要素模型及由面要素构成的面要素模型、每一要素模型中的要素标注有三维坐标、名称及连接关系；解析模块，用于对所述CAD文件进行解析并将解析结果保存为所述MR设备支持的标准格式数据；坐标统一模块，用于获取所述MR设备在大地坐标系下的设备坐标，并基于坐标转换参数将所述标准格式数据中各要素的三维坐标转换为在同一大地坐标系下的显示坐标；投影渲染模块，用于投影基于所述设备坐标在坐标转换后的标准格式数据中查找预设空间范围内的标准格式数据，对预设空间范围内的标准格式数据进行投影渲染以生成对应的三维立体模型。一种计算机可读存储介质，存储有计算机程序，所述计算机程序被处理器执行时，使得所述处理器执行上述基于MR的CAD文件查看方法的步骤。一种基于MR的CAD文件查看设备，包括存储器和处理器，所述存储器存储有计算机程序，所述计算机程序被所述处理器执行时，使得所述处理器执行上述基于MR的CAD文件查看方法的步骤。本发明提供了基于MR的CAD文件查看方法、装置、介质和设备， 首先获取目标三维模型的CAD文件，然后对CAD文件进行解析并将解析结果保存为MR设备支持的标准格式数据。接着，获取MR设备在大地坐标系下的设备坐标，并通过坐标转换参数将标准格式数据中各要素的三维坐标转换为在同一大地坐标系下的显示坐标。最后，基于设备坐标在坐标转换后的标准格式数据中查找预设空间范围内的数据，对这些数据进行投影渲染，生成对应的三维立体模型，实现混合现实效果。可见，本发明可实现直观立体的查看CAD文件。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。其中：图1为基于MR的CAD文件查看方法的流程示意图；图2为基于MR的CAD文件查看装置的结构示意图；图3为基于MR的CAD文件查看设备的结构框图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有作出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。本申请的说明书和权利要求书及上述附图中的术语“第一”、“第二”等是用于区别不同对象，而不是用于描述特定顺序。此外，术语“包括”和“具有”以及它们任何变形，意图在于覆盖不排他的包含。例如包含了一系列步骤或单元的过程、方法、系统、产品或设备没有限定于已列出的步骤或单元，而是可选地还包括没有列出的步骤或单元，或可选地还包括对于这些过程、方法、产品或设备固有的其他步骤或单元。在本文中提及“实施例”意味着，结合实施例描述的特定特征、结构或特性可以包含在本申请的至少一个实施例中。在说明书中的各个位置出现该短语并不一定均是指相同的实施例，也不是与其它实施例互斥的独立的或备选的实施例。本领域技术人员显式地和隐式地理解的是，本文所描述的实施例可以与其它实施例相结合。如图1所示，图1为一个实施例中基于MR的CAD文件查看方法的流程示意图，本实施例中基于MR的CAD文件查看方法提供的步骤包括：S101，获取目标三维模型的CAD文件。首先，需要从目标三维模型的来源处获取CAD文件，例如从网络下载、从U盘拷贝、从其他软件导出等。CAD文件的扩展名可能有多种，例如dwg、dxf、skp、stp等，需要根据不同的软件选择合适的格式。在一个具体实施例中，若CAD文件为非解析格式，则将非解析格式的CAD文件准换为dxf格式的CAD文件。例如dwg格式是一种闭源的非解析格式，要求较高的技术能力，才可以进行解析。而dxf数据是一种开源的数据格式，易于解析；因此CAD文件为dwg格式，则将dwg格式的CAD文件准换为dxf格式的CAD文件。接着，需要检查CAD文件的内容和结构，确保它包含了所需的要素模型和信息。要素模型可以分为点要素模型、线要素模型和面要素模型，分别由点、线和面构成。每一要素模型中的要素都应该标注有三维坐标、名称和连接关系，以便在混合现实设备上进行识别和操作。在一个具体实施例中，点要素包括绿植、道路、建筑及公园等；线要素包括细实线、粗实线、中心线、虚线及标注线等；面要素包括纯色填充、网格填充、斜线填充以及图案填充等。本具体实施例展示如何使用不同的点要素、线要素和面要素来构建一个三维模型，并在MR设备上进行显示和交互。S102，对CAD文件进行解析并将解析结果保存为MR设备支持的标准格式数据。可选的，该标准格式数据为GeoJSON格式。GeoJSON格式是一种基于JSON的地理空间数据交换格式，它可以用于存储和交换地理信息系统中的点、线、面等空间和形状信息，以及这些对象的属性信息。将解析后的CAD文件数据保存为GeoJSON格式，有助于在MR设备中更方便地处理和展示地理空间信息。同时这也确保了数据的一致性和可用性，为后续的坐标转换和渲染步骤提供了基础。在一个具体实施例中，还执行如下步骤：根据CAD图层信息对标准格式数据进行分层。这是因为CAD文件通常可以包含多个图层，每个图层代表不同的信息或物体类别。根据CAD图层信息对标准格式数据进行分层的目的是将不同类型的要素分类组织，可使得在MR设备中更容易管理和展示不同类型的三维模型信息。这有助于提高数据的可读性和可操作性，以及更好地满足用户特定需求。例如，如果CAD文件中有一个名为“WALL”的图层，包含了一些表示墙体的面要素，可以在GeoJSON文件中为这些面要素添加一个属性，如"layer": “WALL”，表示它们属于“WALL”图层。这样，就可以根据CAD图层信息对标准格式数据进行分层了。S103，获取MR设备在大地坐标系下的设备坐标，并基于坐标转换参数将标准格式数据中各要素的三维坐标转换为在同一大地坐标系下的显示坐标。具体的来说，MR设备上还设置有实时动态定位传感器，该RTK传感器用于实时获取设备的设备坐标，包括经度、纬度和高程等。这样的设备坐标是基于大地坐标系的，提供了全球统一的空间参考。同时由于标准格式数据可能是在不同的坐标系下生成的，需要使用坐标转换参数将这些数据的坐标转换为与MR设备在同一大地坐标系下的显示坐标。这个过程包括平移、旋转和缩放等变换。通过这一步骤，确保了MR设备和标准格式数据在同一大地坐标系下，使得在MR设备上显示的虚拟模型能够准确地对应到现实世界的位置，保证了后续使用中空间信息的一致性和准确性。S104，基于设备坐标在坐标转换后的标准格式数据中查找预设空间范围内的标准格式数据，对预设空间范围内的标准格式数据进行投影渲染以生成对应的三维立体模型。在MR设备中，用户可能只对特定空间范围内的数据感兴趣。因此本步骤利用MR设备上获取的设备坐标信息，确定用户的视点或兴趣区域，然后从坐标转换后的标准格式数据中筛选出在该空间范围内的数据，这样可以提高渲染效率和用户体验。最后利用渲染技术将预设空间范围内的标准格式数据在MR设备的屏幕上显示，并确保其在三维空间中的位置、形状与现实环境相匹配。上述基于MR的CAD文件查看方法，首先获取目标三维模型的CAD文件，然后对CAD文件进行解析并将解析结果保存为MR设备支持的标准格式数据。接着，获取MR设备在大地坐标系下的设备坐标，并通过坐标转换参数将标准格式数据中各要素的三维坐标转换为在同一大地坐标系下的显示坐标。最后，基于设备坐标在坐标转换后的标准格式数据中查找预设空间范围内的数据，对这些数据进行投影渲染，生成对应的三维立体模型，实现混合现实效果。可见，本发明可实现直观立体的查看CAD文件。在一个具体实施例中，为了实现更沉浸式的查看效果，本发明还可执行如下步骤：、获取双目相机拍摄到的现实实景的双目图像，提取双目图像中的特征点并进行特征点匹配，基于匹配成功的特征点的水平坐标计算特征点的视差值。具体的来说，提取双目图像中的特征点可以通过使用一些图像处理的算法和工具来实现，例如SIFT、SURF、ORB等。而特征点匹配可以通过计算特征点之间的特征描述符来实现，特征描述符是一种对特征点周围区域的数值表示，它可以用来比较特征点的相似度。接着计算特征点的视差值，视差值的计算公式为：上式中，d指示视差值，和/＞分别指示左右图像中匹配成功的特征点的水平坐标。、基于视差值和双目相机的焦距与基线长度，计算现实实景内特征点的深度信息。其中，深度信息的计算公式为：上式中，z指示特征点的深度信息，也即特征点距MR设备的距离，指示双目相机的焦距，/＞指示双目相机的基线长度。、基于设备坐标和预设空间范围内标准格式数据的显示坐标计算所有投影点的投影距离。其中，投影距离的计算公式以为：上式中，指示MR设备到第i个投影点的投影距离，指示设备坐标，指示第i个投影点的显示坐标。、若目标投影点的投影距离小于或等于目标投影路径上特征点的深度信息，则对目标投影点进行投影渲染，若目标投影点的投影距离大于目标投影路径上特征点的深度信息，则对目标投影点进行遮蔽。其中，目标投影点为所有投影点中的任意一个，也就是对所有投影点都执行相同的投影操作；目标投影路径为目标投影点的投影路径，这条路径上可能有多个特征点，这些特征点的深度信息用于判断虚拟内容是否被实际场景遮挡。也就是说，本步骤比较虚拟内容和现实场景距MR设备的前后关系，如果目标投影点的投影距离小于或等于目标投影路径上特征点的深度信息，说明虚拟内容在现实场景前面，执行投影渲染操作，将虚拟内容呈现到设备上。如果目标投影点的投影距离大于目标投影路径上特征点的深度信息，说明虚拟内容被现实场景遮挡，执行遮蔽操作，不将虚拟内容呈现或者以不可见的方式呈现，以模拟被实际场景遮挡的效果。在一个实施例中，如图2所示，提出了一种基于MR的CAD文件查看装置，该装置包括：文件获取模块201，用于获取目标三维模型的CAD文件；其中，CAD文件中包含由点要素构成的点要素模型、由线要素构成的线要素模型及由面要素构成的面要素模型、每一要素模型中的要素标注有三维坐标、名称及连接关系；解析模块202，用于对CAD文件进行解析并将解析结果保存为MR设备支持的标准格式数据；坐标统一模块203，用于获取MR设备在大地坐标系下的设备坐标，并基于坐标转换参数将标准格式数据中各要素的三维坐标转换为在同一大地坐标系下的显示坐标；投影渲染模块204，用于投影基于设备坐标在坐标转换后的标准格式数据中查找预设空间范围内的标准格式数据，对预设空间范围内的标准格式数据进行投影渲染以生成对应的三维立体模型。图3示出了一个实施例中基于MR的CAD文件查看设备的内部结构图。如图3所示，该基于MR的CAD文件查看设备包括通过系统总线连接的处理器、存储器和网络接口。其中，存储器包括非易失性存储介质和内存储器。该基于MR的CAD文件查看设备的非易失性存储介质存储有操作系统，还可存储有计算机程序，该计算机程序被处理器执行时，可使得处理器实现基于MR的CAD文件查看方法。该内存储器中也可储存有计算机程序，该计算机程序被处理器执行时，可使得处理器执行基于MR的CAD文件查看方法。本领域技术人员可以理解，图3中示出的结构，仅仅是与本申请方案相关的部分结构的框图，并不构成对本申请方案所应用于其上的基于MR的CAD文件查看设备的限定，具体的基于MR的CAD文件查看设备可以包括比图中所示更多或更少的部件，或者组合某些部件，或者具有不同的部件布置。一种计算机可读存储介质，该计算机可读存储介质存储有计算机程序，该计算机程序被处理器执行时实现如下步骤：获取目标三维模型的CAD文件；其中，CAD文件中包含由点要素构成的点要素模型、由线要素构成的线要素模型及由面要素构成的面要素模型、每一要素模型中的要素标注有三维坐标、名称及连接关系；对CAD文件进行解析并将解析结果保存为MR设备支持的标准格式数据；获取MR设备在大地坐标系下的设备坐标，并基于坐标转换参数将标准格式数据中各要素的三维坐标转换为在同一大地坐标系下的显示坐标；基于设备坐标在坐标转换后的标准格式数据中查找预设空间范围内的标准格式数据，对预设空间范围内的标准格式数据进行投影渲染以生成对应的三维立体模型。一种基于MR的CAD文件查看设备，包括存储器、处理器以及存储在该存储器中并可在该处理器上执行的计算机程序，该处理器执行该计算机程序时实现如下步骤：获取目标三维模型的CAD文件；其中，CAD文件中包含由点要素构成的点要素模型、由线要素构成的线要素模型及由面要素构成的面要素模型、每一要素模型中的要素标注有三维坐标、名称及连接关系；对CAD文件进行解析并将解析结果保存为MR设备支持的标准格式数据；获取MR设备在大地坐标系下的设备坐标，并基于坐标转换参数将标准格式数据中各要素的三维坐标转换为在同一大地坐标系下的显示坐标；基于设备坐标在坐标转换后的标准格式数据中查找预设空间范围内的标准格式数据，对预设空间范围内的标准格式数据进行投影渲染以生成对应的三维立体模型。需要说明的是，上述基于MR的CAD文件查看方法、装置、设备及计算机可读存储介质属于一个总的发明构思，基于MR的CAD文件查看方法、装置、设备及计算机可读存储介质实施例中的内容可相互适用。本领域普通技术人员可以理解实现上述实施例方法中的全部或部分流程，是可以通过计算机程序来指令相关的硬件来完成，该程序可存储于一非易失性计算机可读取存储介质中，该程序在执行时，可包括如上述各方法的实施例的流程。其中，本申请所提供的各实施例中所使用的对存储器、存储、数据库或其它介质的任何引用，均可包括非易失性和/或易失性存储器。非易失性存储器可包括只读存储器、可编程ROM、电可编程ROM、电可擦除可编程ROM或闪存。易失性存储器可包括随机存取存储器或者外部高速缓冲存储器。作为说明而非局限，RAM以多种形式可得，诸如静态RAM、动态RAM、同步DRAM、双数据率SDRAM、增强型SDRAM、同步链路 DRAM、存储器总线直接RAM、直接存储器总线动态RAM、以及存储器总线动态RAM等。以上实施例的各技术特征可以进行任意的组合，为使描述简洁，未对上述实施例中的各个技术特征所有可能的组合都进行描述，然而，只要这些技术特征的组合不存在矛盾，都应当认为是本说明书记载的范围。以上实施例仅表达了本申请的几种实施方式，其描述较为具体和详细，但并不能因此而理解为对本申请专利范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本申请构思的前提下，还可以做出若干变形和改进，这些都属于本申请的保护范围。因此，本申请专利的保护范围应以所附权利要求为准。
