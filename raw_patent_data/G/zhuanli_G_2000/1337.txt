标题title
一种大规模三维场景快速轻量化方法
摘要abst
本发明公开了一种大规模三维场景快速轻量化方法，涉及三维场景轻量化技术领域。该方法包括获取三维场景中三角形网络，提取三角形网络的边构建无向边集合；设定几何变形阈值，并将从零到该几何变形阈值的取值区间进行非线性划分；按照从小到大的顺序依次选取划分的几何变形阈值；遍历无向边集合中的每条无向边，计算缩减该无向边产生的几何变形值，判断当前无向边对应的几何变形值是否小于选取的几何变形阈值；若是，则将当前无向边缩减为一个点，并将与该点关联的所有三角形网络的边构建无向边集合。本发明解决了常规轻量化算法遇到超常密集三角网格因为耗时达到天级别而不可用的问题，显著提高了三维场景轻量化处理效率。
权利要求书clms
1.一种大规模三维场景快速轻量化方法，其特征在于，包括以下步骤：S1、获取三维场景中三角形网络，提取三角形网络的边构建无向边集合；S2、设定几何变形阈值，并将从零到该几何变形阈值的取值区间进行非线性划分；S3、按照从小到大的顺序依次选取划分的几何变形阈值；S4、遍历无向边集合中的每条无向边，计算缩减该无向边产生的几何变形值，判断当前无向边对应的几何变形值是否小于选取的几何变形阈值；若是，则执行步骤S5；否则执行步骤S6；S5、将当前无向边缩减为一个点，并将与该点关联的所有三角形网络的边构建无向边集合，返回步骤S4；S6、判断选取的几何变形阈值是否达到设定的几何变形阈值；若是，则流程结束；否则返回步骤S3。2.根据权利要求1所述的一种大规模三维场景快速轻量化方法，其特征在于，将从零到该几何变形阈值的取值区间进行非线性划分具体包括以下步骤：初始化迭代次数，并设定迭代速度指数；根据迭代次数和迭代速度指数构建幂函数；设定非线性系数，基于非线性系数与幂函数构建非线性划分函数对从零到该几何变形阈值的取值区间进行非线性划分。3.根据权利要求2所述的一种大规模三维场景快速轻量化方法，其特征在于，非线性划分函数具体为：，其中，为设定的非线性系数，/＞为迭代次数，/＞为迭代速度指数。4.根据权利要求1所述的一种大规模三维场景快速轻量化方法，其特征在于，计算缩减该无向边产生的几何变形值的计算公式具体为：，其中，表示顶点误差，V表示三维空间的顶点坐标，T表示矩阵转置，/＞表示通过当前无向边连接的三角形所在平面。
说明书desc
技术领域本发明涉及三维场景轻量化技术领域，具体涉及一种大规模三维场景快速轻量化方法。背景技术在大规模三维场景的轻量化过程中，经常会遇到千万级别的三角形网格的构件或者模型，这些超常密集的三角形网格通常来自于三维扫描或者基于体素的三角形网格的构建。对于超常密集的三角形网格采用常规的轻量化流程，在每次三角形的边的缩减过程中，必然要做所有三角形网格的无向边的排序，即按照每条边的缩减产时的几何变形的值进行从小到大的排序，选出一个几何变形最小的边优先进行缩减。就算采用速度非常快最小堆排序算法，每次三角形边的缩减的时间复杂度也是NlogN，N是三角形网格的无向边的数量。无向边排序这个步骤就是轻量化过程中最耗时的一个瓶颈。当三角形网格中三角形数量达到50万级别时，整体轻量化所需时间通常在20分钟左右。这种分钟级别的时间消耗，对于拥有成千上万个构建或者模型的三维场景的轻量化就是一个灾难，算法的耗时会达到天的级别，导致其基本不可用。发明内容针对现有技术中的上述不足，本发明提供了一种大规模三维场景快速轻量化方法，通过去掉轻量化过程中每次做三角形的边的缩减时对于所有三角形网格中的无向边排序，从而将其耗时从20分钟这种分钟级别下降到10秒左右，解决了常规轻量化算法遇到超常密集三角网格因为耗时达到天级别而不可用的问题。为了达到上述发明目的，本发明采用的技术方案为：一种大规模三维场景快速轻量化方法，包括以下步骤：S1、获取三维场景中三角形网络，提取三角形网络的边构建无向边集合；S2、设定几何变形阈值，并将从零到该几何变形阈值的取值区间进行非线性划分；S3、按照从小到大的顺序依次选取划分的几何变形阈值；S4、遍历无向边集合中的每条无向边，计算缩减该无向边产生的几何变形值，判断当前无向边对应的几何变形值是否小于选取的几何变形阈值；若是，则执行步骤S5；否则执行步骤S6；S5、将当前无向边缩减为一个点，并将与该点关联的所有三角形网络的边构建无向边集合，返回步骤S4；S6、判断选取的几何变形阈值是否达到设定的几何变形阈值；若是，则流程结束；否则返回步骤S3。进一步地，将从零到该几何变形阈值的取值区间进行非线性划分具体包括以下步骤：初始化迭代次数，并设定迭代速度指数；根据迭代次数和迭代速度指数构建幂函数；设定非线性系数，基于非线性系数与幂函数构建非线性划分函数对从零到该几何变形阈值的取值区间进行非线性划分。进一步地，非线性划分函数具体为：，其中，为设定的非线性系数，/＞为迭代次数，/＞为迭代速度指数。进一步地，计算缩减该无向边产生的几何变形值的计算公式具体为：，其中，表示顶点误差，V表示三维空间的顶点坐标，T表示矩阵转置，表示通过当前无向边连接的三角形所在平面。本发明具有以下有益效果：本发明通过去掉轻量化过程中每次做三角形的边的缩减时对于所有三角形网格中的无向边排序，从而将其耗时从20分钟这种分钟级别下降到10秒左右，解决了常规轻量化算法遇到超常密集三角网格因为耗时达到天级别而不可用的问题，显著提高了三维场景轻量化处理效率。附图说明图1为本发明实施例中一种大规模三维场景快速轻量化方法的流程示意图。具体实施方式下面对本发明的具体实施方式进行描述，以便于本技术领域的技术人员理解本发明，但应该清楚，本发明不限于具体实施方式的范围，对本技术领域的普通技术人员来讲，只要各种变化在所附的权利要求限定和确定的本发明的精神和范围内，这些变化是显而易见的，一切利用本发明构思的发明创造均在保护之列。对于超常密集的三角形网格的轻量化问题，因为在轻量化过程中，三角形进行边的缩减时，必然会做一个三角形网格所有无向边基于其缩减时产生的几何变形值的最小堆排序问题，即每次进行三角形边的缩减时，必须找一个几何变形值最小的无向边进行缩减，确保尽量少的改动原始模型的几何细节，直到这个几何变形值到达一个指定的几何变形阈值，才会停止三角形边的缩减操作。该几何变形阈值是一个非负实数，用costlimit表示，默认costlimit为0.0 。本发明为了去掉非常耗时的全体无向边排序的最小堆排序过程，同时又能确保每次在三角形的边的缩减操作中，都能将几何变形值小的无向边优先缩减掉，以确保尽量小对原始模型的几何细节进行修改，保留原始模型的几何外观。为此，本发明将几何变形阈值从0.0到costlimit之间的区间进行一个非线性划分，每个划分的刻度都作为一个几何变形的阈值，从小到大进行全体无向边的扫描，凡是小于一个几何变形阈值的边都会被一次性缩减掉，依次迭代到costlimit这个指定的几何变形阈值即可停止轻量化。如图1所示，本发明实施例提供了一种大规模三维场景快速轻量化方法，包括以下步骤S1至S6：S1、获取三维场景中三角形网络，提取三角形网络的边构建无向边集合；在本发明的一个可选实施例中，本实施例的步骤S1依次输入三维场景的三角形网络A{v0,v1,v2}，其中v0,v1,v2是三角形网络的三个顶点。S2、设定几何变形阈值，并将从零到该几何变形阈值的取值区间进行非线性划分；在本发明的一个可选实施例中，本实施例的步骤S2首先设定一个最大的几何变形阈值，作为轻量化过程的停止条件；然后将从0到该几何变形阈值costlimit的取值区间进行非线性划分，每个划分的刻度分别作为每一次迭代过程的一个几何变形阈值。本实施例将从零到该几何变形阈值的取值区间进行非线性划分具体包括以下步骤：初始化迭代次数，并设定迭代速度指数；根据迭代次数和迭代速度指数构建幂函数；设定非线性系数，基于非线性系数与幂函数构建非线性划分函数对从零到该几何变形阈值的取值区间进行非线性划分。具体而言，本实施例采用的非线性划分函数具体为：，其中，为设定的非线性系数，即设定为10的负6次方；/＞为迭代次数，从0开始，每迭代依次加1，即itercnt=itercnt+1；/＞为迭代速度指数，是一个固定指数，代表了limit从0开始接近costlimit的速度，默认取值indexval=6。S3、按照从小到大的顺序依次选取划分的几何变形阈值；在本发明的一个可选实施例中，本实施例的步骤S3将步骤S2非线性划分的每个刻度，从0开始，按照从小到大的顺序依次选取一个刻度作为每一次迭代过程的一个几何变形阈值。S4、遍历无向边集合中的每条无向边，计算缩减该无向边产生的几何变形值，判断当前无向边对应的几何变形值是否小于选取的几何变形阈值；若是，则执行步骤S5；否则执行步骤S6；在本发明的一个可选实施例中，本实施例的步骤S4遍历构建的无向边集合中的每条无向边，并计算缩减该无向边产生的几何变形值以及缩减该无向边成为一个点的三维点坐标。本实施例计算缩减该无向边产生的几何变形值的计算公式具体为：=，其中，表示顶点误差，V表示三维空间的顶点坐标，通常用其次坐标表示，即列向量/＞；T表示矩阵转置，/＞表示通过当前无向边连接的三角形所在平面，即/＞，其中a，b，c表示平面的法向方向，d表示原点到平面的有向距离，n表示平面数量。a，b，c，d构成三角形所在平面的平面方程，满足：ax + by + cz + d = 0,具体计算过程如下：，，其中，、/＞、/＞为三角形的三个顶点，/＞为顶点/＞和/＞组成的边向量，为顶点/＞和/＞组成的边向量。，利用平面法向的模长进行归一化，表示为：，从而得到原点到平面的有向距离为：，其中，、/＞、/＞为顶点/＞的在三个方向上的分量。本实施例中三维空间的顶点坐标V可以通过以下过程求出：构建当前无向边连接的三角形所在平面的基本误差二次方程，表示为：，计算与当前无向边的两个顶点关联的所有三角形的基本误差二次方程的累加和，表示为：，若矩阵Q可逆，则可以计算得到：Vmin=，此时将Vmin代入几何变形值计算公式中的V即可得到缩减该无向边产生的几何变形值。若矩阵Q不可逆，则将几何变形值计算公式中的V分别取当前无向边的两个顶点以及顶点平均值，选择得到的三个计算值中的最小值作为缩减该无向边产生的几何变形值。本实施例将计算得到的当前无向边对应的几何变形值与步骤S3所选取的几何变形阈值进行比较，若当前无向边对应的几何变形值小于选取的几何变形阈值，则开始执行该无向边的缩减操作；否则进入下一轮迭代过程。S5、将当前无向边缩减为一个点，并将与该点关联的所有三角形网络的边构建无向边集合，返回步骤S4；在本发明的一个可选实施例中，本实施例步骤S5执行该无向边的缩减操作，即将与该无向边通过边关联的三角形全部从三维场景中删除，该无向边缩成一个三维点；然后将与该三维点关联的所有三角形的边构建新的无向边集合，返回步骤S4重新计算无向边集合中无向边对应的几何变形值，实现对无向边对应的几何变形值的更新操作。S6、判断选取的几何变形阈值是否达到设定的几何变形阈值；若是，则流程结束；否则返回步骤S3。在本发明的一个可选实施例中，本实施例所进行的三维场景轻量化过程直到将无向边的几何变形值减小到设定的几何变形阈值，才会停止三角形边的缩减操作。因此本实施例在进行一轮无向边缩减操作后通过判断当前迭代的几何变形阈值是否达到设定的几何变形阈值来确定是否继续进行更新迭代，直到当前迭代的几何变形阈值达到设定的几何变形阈值时停止三维场景轻量化过程。本发明是参照根据本发明实施例的方法、设备、和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。本发明中应用了具体实施例对本发明的原理及实施方式进行了阐述，以上实施例的说明只是用于帮助理解本发明的方法及其核心思想；同时，对于本领域的一般技术人员，依据本发明的思想，在具体实施方式及应用范围上均会有改变之处，综上所述，本说明书内容不应理解为对本发明的限制。本领域的普通技术人员将会意识到，这里所述的实施例是为了帮助读者理解本发明的原理，应被理解为本发明的保护范围并不局限于这样的特别陈述和实施例。本领域的普通技术人员可以根据本发明公开的这些技术启示做出各种不脱离本发明实质的其它各种具体变形和组合，这些变形和组合仍然在本发明的保护范围内。
