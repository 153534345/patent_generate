标题title
一种用于手术术前规划的三维重建系统及方法
摘要abst
本发明公开了一种用于手术术前规划的三维重建系统及方法，属于医学图像技术领域，具体方法包括：采集患者病灶位置的图像，对图像进行灰度化和去噪处理，利用图像分割策略，提取经过灰度化和去噪处理后图像的特征，并结合注意力机制，将处理后病灶位置的图像分割成若干份，利用三维重建策略，对分割的图像切片的匹配代价进行求取，再通过代价聚合和视差优化对分割的图像切片进行拟合重建，将患者病灶区域以三维可视化形式展示，对图像分割时的边缘进行处理，且在分割后图像切片匹配时，利用边缘像素进行匹配，提高了分割精度和匹配精度，精准的展示三维重建后的患者病灶位置三维图像，提高了手术成功率，大大降低了手术风险。
权利要求书clms
1.一种用于手术术前规划的三维重建方法，其特征在于，包括以下具体步骤：采集患者病灶位置的图像，对图像进行灰度化和去噪处理；利用图像分割策略，提取经过灰度化和去噪处理后图像的特征，并结合注意力机制，将处理后病灶位置的图像分割成若干份；利用三维重建策略，对分割的图像切片的匹配代价进行求取，再通过代价聚合和视差优化对分割的图像切片进行拟合重建，将患者病灶区域以三维可视化形式展示。2.如权利要求1所述的一种用于手术术前规划的三维重建方法，其特征在于，所述图像分割策略具体方法包括：步骤S101：将经过灰度化和去噪处理后的图像放入训练好的神经网络模型中，将所述神经网络模型中浅层特征和高层特征进行拼接，然后进行卷积运算，得到灰度值特征值，设定提取灰度值特征值为Query；步骤S102：结合注意力机制，对提取的灰度值特征值Query进行加权计算，并且捕获到整个图像的边缘灰度值特征，得到图像的整体灰度值特征；步骤S103：统计经过灰度化和去噪处理后的图像中每个灰度像素的个数，设定为经过灰度化和去噪处理后的图像中灰度为i的像素的数量，经过灰度化和去噪处理后的图像中灰度为i的概率为/＞，且/＞，设定经过灰度化和去噪处理后的整个图像的灰度值为/＞，灰度阈值为/＞，像素被分到A的概率为/＞，分配到A的像素平均灰度为/＞，像素被分到B的概率为/＞，分配到B的像素平均灰度为/＞；步骤S104：计算像素的最大化类间方差，计算公式为：；其中，，/＞，/＞，，/＞；根据计算的方差，进行像素分类，结合灰度值特征值和像素分类对经过灰度化和去噪处理后的病灶位置的图像进行分割。3.如权利要求2所述的一种用于手术术前规划的三维重建方法，其特征在于，所述三维重建策略的具体步骤为：步骤S201：设定分割后图像切片和任意图像切片/＞的单侧边缘像素点集合为P和Q，，/＞，其中，/＞表示切片/＞中的第i个边缘像素点，表示切片/＞中的第j个边缘像素点，灰度值分别为/＞和/＞，，/＞，对分割后图像切片的匹配初始代价进行计算，代价值计算公式为：；其中，表示代价值控制参数，/＞表示绝对值函数，e表示自然对数的底数；步骤S202：代价聚合，设定灰度差异阈值为，像素距离差阈值为/＞，切片/＞和/＞的单侧边缘像素点集合差阈值为/＞，像素聚合的原则公式为：；其中，表示像素点/＞与像素点/＞的像素距离；步骤S203：根据所述代价值，计算聚合后的代价值，计算公式为：；其中，w表示切片和/＞中的第w个边缘像素点，/＞表示切片/＞中的第w个边缘像素点，表示切片/＞中的第w个边缘像素点；步骤S204：根据所述步骤S201-步骤S203，计算出分割后图像切片上下左右四侧边缘的聚合代价值，视差值/＞选取四侧代价值最小的均值，即，其中，/＞表示分割后图像切片/＞上侧边缘的聚合最小代价值，/＞表示分割后图像切片/＞下侧边缘的聚合最小代价值，表示分割后图像切片/＞左侧边缘的聚合最小代价值，/＞表示分割后图像切片右侧边缘的聚合最小代价值；步骤S205：根据视差值，选取匹配的分割后图像切片，并进行三维重建，使患者病灶区域以三维可视化形式展示。4.如权利要求1所述的一种用于手术术前规划的三维重建方法，其特征在于，所述灰度化和去噪处理具体为对彩色图像进行灰度化处理和对成像过程中的高斯噪声和莱斯噪声进行处理。5.如权利要求2所述的一种用于手术术前规划的三维重建方法，其特征在于，所述步骤S101中神经网络模型为Densenet网络。6.如权利要求2所述的一种用于手术术前规划的三维重建方法，其特征在于，所述步骤S102中注意力机制包括：通道注意力机制和空间注意力机制。7.如权利要求7所述的一种用于手术术前规划的三维重建方法，其特征在于，所述通道注意力机制用于在特征图的通道域中进行加权运算。8.如权利要求7所述的一种用于手术术前规划的三维重建方法，其特征在于，所述空间注意力机制用于对各种形变数据在空间中进行转换，并自动捕获区域特征。9.如权利要求4所述的一种用于手术术前规划的三维重建方法，其特征在于，所述步骤S205中的三维重建利用立方卷积插值将匹配的图像切片进行三维重组。10.一种用于手术术前规划的三维重建系统，其基于如权利要求1-9任一项所述的一种用于手术术前规划的三维重建方法实现，其特征在于，包括：图像采集设备，用于拍摄患者的病灶位置图像；图像处理单元，对患者病灶位置图像进行灰度化和去噪处理，并利用图像分割策略，提取经过灰度化和去噪处理后图像的特征，结合注意力机制，将处理后病灶位置的图像分割成若干份，利用三维重建策略，对分割的图像切片的匹配进行求取，再通过代价聚合和视差优化进行拟合重建，使患者病灶区域以三维可视化形式展示；三维成像设备，用将三维重建的患者病灶位置图像以三维可视化形式展示。11.如权利要求10所述的一种用于手术术前规划的三维重建系统，其特征在于，所述图像采集设备包括：核磁共振设备、CT设备和PET设备。12.一种电子设备，包括存储器和处理器，所述存储器存储有计算机程序，其特征在于，所述处理器执行所述计算机程序时实现权利要求1-9任一项所述的一种用于手术术前规划的三维重建方法的步骤。13.一种计算机可读存储介质，其特征在于，其上存储有计算机指令，当计算机指令运行时执行权利要求1-9任一项所述的一种用于手术术前规划的三维重建方法的步骤。
说明书desc
技术领域本发明属于医学图像技术领域，具体的说是一种用于手术术前规划的三维重建系统及方法。背景技术近年来，随着患者逐渐增多，作为关键辅助诊疗手段的医学图像处理技术受到了越来越多的关注，分割与重建方法的设计一直都是医学图像处理与计算机辅助诊断领域备受关注且极度活跃的研究热点。在手术前，对患者病灶位置进行三维成像，对术前医生规划和指导具有重要的意义，能够大大提升手术成功的概率，减小手术中的风险。然而，在成像过程中，噪声会经常叠加出现，造成采集到的图像质量退化，导致分割精度受限，且现有的自动或半自动分割方法往往难以精确预测感兴趣区域的边界，导致在重建时难以呈现出患者病灶组织复杂的非线性曲面，在进行切割后的图片切片匹配问题上，由于患者病灶组织复杂行，导致切割后的图片切片匹配精度受限，无法精确的展示患者病灶位置的三维图像。如授权公告号为CN107895364B的中国专利公开了一种用于虚拟手术术前规划的三维重建系统。该方案包括通过对CT或MRI图像进行预处理，把经过去噪、平滑及增强后的图像进行图像分割，分割后引入空洞处理，力求图像完整不缺少信息。再将分割后的完整图像进行三维重建，三维重建技术采用改进的MC算法，在原有算法15种基本拓扑构型基础上增加了9种，弥补了原有算法连接问题的不足，促使拟合曲面更加完整不易产生空洞，最后引入了光滑处理，使拟合后的曲面光滑平整，重建后的模型可以直接用于后面虚拟手术切割和碰撞检测应用。发明内容针对现有技术的不足，本发明提出了一种用于手术术前规划的三维重建系统及方法，该系统功能全面，采集患者病灶位置的图像，对图像进行灰度化和去噪处理，利用图像分割策略，提取经过灰度化和去噪处理后图像的特征，并结合注意力机制，将处理后病灶位置的图像分割成若干份，利用三维重建策略，对分割的图像切片的匹配代价进行求取，再通过代价聚合和视差优化对分割的图像切片进行拟合重建，将患者病灶区域以三维可视化形式展示，对图像分割时的边缘进行处理，且在分割后图像切片匹配时，利用边缘像素进行匹配，提高了分割精度和匹配精度，精准的展示三维重建后的患者病灶位置三维图像，在手术术前规划时，提高了规划精度，提高了手术成功率，大大降低了手术风险。为实现上述目的，本发明提供如下技术方案：一种用于手术术前规划的三维重建方法，包括以下具体步骤：采集患者病灶位置的图像，对图像进行灰度化和去噪处理；利用图像分割策略，提取所述处理后图像的特征，并结合注意力机制，将处理后病灶位置的图像分割成若干份；利用三维重建策略，对分割的图像切片的匹配进行求取，再通过代价聚合和视差优化进行拟合重建，使患者病灶区域以三维可视化形式展示。具体的，所述图像分割策略具体方法包括：步骤S101：将处理后的图像放入训练好的神经网络模型中，将所述神经网络模型中浅层特征和高层特征进行拼接，然后进行卷积运算，得到灰度值特征值，设定提取灰度值特征值为Query；步骤S102：结合注意力机制，对提取的灰度值特征Query进行加权计算，并且捕获到整个图像的边缘灰度值特征，得到图像的整体灰度值特征；步骤S103：统计经过灰度化和去噪处理后的图像中每个灰度像素的个数，设定为经过灰度化和去噪处理后的图像中灰度为i的像素的数量，经过灰度化和去噪处理后的图像中灰度为i的概率为/＞，且/＞，设定经过灰度化和去噪处理后的整个图像的灰度值为/＞，灰度阈值为/＞，像素被分到A的概率为/＞，分配到A的像素平均灰度为/＞，像素被分到B的概率为/＞，分配到B的像素平均灰度为；步骤S104：计算像素的最大化类间方差，计算公式为：；其中，，/＞，/＞，，/＞；根据计算的方差，进行像素分类，结合灰度值特征值和像素分类对病灶位置的图像进行分割。具体的，所述三维重建策略的具体步骤为：步骤S201：设定分割后图像切片和任意图像切片/＞的单侧边缘像素点集合为P和Q，/＞，/＞，其中，/＞表示切片/＞中的第i个边缘像素点，/＞表示切片/＞中的第j个边缘像素点，灰度值分别为/＞和/＞，，/＞，对分割后图像切片的匹配初始代价进行计算，代价值计算公式为：；其中，表示代价值控制参数，/＞表示绝对值函数，e表示自然对数的底数；步骤S202：代价聚合，设定灰度差异阈值为，像素距离差阈值为/＞，切片/＞和/＞的单侧边缘像素点集合差阈值为/＞，像素聚合的原则公式为：；其中，表示像素点/＞与像素点/＞的像素距离；步骤S203：根据所述代价值，计算聚合后的代价值，计算公式为：；其中，w表示切片和/＞中的第w个边缘像素点，/＞表示切片/＞中的第w个边缘像素点，/＞表示切片/＞中的第w个边缘像素点；步骤S204：根据所述步骤S201-步骤S203，计算出分割后图像切片上下左右四侧边缘的聚合代价值，视差值/＞选取四侧代价值最小的均值，即，其中，/＞表示分割后图像切片/＞上侧边缘的聚合最小代价值，/＞表示分割后图像切片/＞下侧边缘的聚合最小代价值，表示分割后图像切片/＞左侧边缘的聚合最小代价值，/＞表示分割后图像切片右侧边缘的聚合最小代价值；步骤S205：根据视差值，选取匹配的分割后图像切片，并进行三维重建，使患者病灶区域以三维可视化形式展示。具体的，所述灰度化和去噪处理具体为对彩色图像进行灰度化处理和对成像过程中的高斯噪声和莱斯噪声进行处理。具体的，所述步骤S101中神经网络模型为Densenet网络。具体的，所述步骤S102中注意力机制包括：通道注意力机制和空间注意力机制。具体的，所述通道注意力机制用于在特征图的通道域中进行加权运算。具体的，所述空间注意力机制用于对各种形变数据在空间中进行转换，并自动捕获区域特征。具体的，所述步骤S205中的三维重建利用立方卷积插值将匹配的图像切片进行三维重组。一种用于手术术前规划的三维重建系统，包括：图像采集设备，用于拍摄患者的病灶位置图像；图像处理单元，对患者病灶位置图像进行灰度化和去噪处理，并利用图像分割策略，提取经过灰度化和去噪处理后图像的特征，结合注意力机制，将处理后病灶位置的图像分割成若干份，利用三维重建策略，对分割的图像切片的匹配进行求取，再通过代价聚合和视差优化进行拟合重建，使患者病灶区域以三维可视化形式展示；三维成像设备，用将三维重建的患者病灶位置图像以三维可视化形式展示。所述图像采集设备包括：核磁共振设备、CT设备和PET设备。一种电子设备，包括存储器和处理器，所述存储器存储有计算机程序，其特征在于，所述处理器执行所述计算机程序时实现一种用于手术术前规划的三维重建方法的步骤。一种计算机可读存储介质，其特征在于，其上存储有计算机指令，当计算机指令运行时执行一种用于手术术前规划的三维重建方法的步骤。与现有技术相比，本发明的有益效果是：1.本发明对用于手术术前规划的三维重建系统进行了架构、运行步骤和流程上的优化改进，系统具备流程简单，投资运行费用低廉，生产工作成本低的优点，提高了三维重建精度。2.本发明提出一种用于手术术前规划的三维重建方法，采集患者病灶位置的图像，对图像进行灰度化和去噪处理，利用图像分割策略，提取经过灰度化和去噪处理图像的特征，并结合注意力机制，将处理后病灶位置的图像分割成若干份，利用三维重建策略，对分割的图像切片的匹配代价进行求取，再通过代价聚合和视差优化进行拟合重建，使患者病灶区域以三维可视化形式展示，对图像分割时的边缘进行处理，且在分割后图像切片匹配时，利用边缘像素进行匹配，提高了分割精度和匹配精度，精准的展示三维重建后的患者病灶位置三维图像，在手术术前规划时，提高了规划精度，提高了手术成功率，大大降低了手术风险。3.本发明提出三维重建策略，计算图像边缘间的匹配代价，进行代价聚合，计算图像四侧的边缘代价，取图像四侧的边缘代价最小值的均值，通过对边缘的处理，有效的降低噪声对边缘的影响，大大提高了匹配的精准度，再通过三维重建，精确的显示患者病灶位置，复杂环境下的三维图像。附图说明图1为本发明用于手术术前规划的三维重建方法流程图；图2为本发明分割后图像切片边缘和边缘匹配图；图3为本发明用于手术术前规划的三维重建系统架构图。图4为本发明用于手术术前规划的三维重建方法的电子设备图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅是本发明一部分实施例，而不是全部的实施例。实施例1请参阅图1，本发明提供的一种实施例：一种用于手术术前规划的三维重建方法，其特征在于，包括以下具体步骤：采集患者病灶位置的图像，对图像进行灰度化和去噪处理；利用图像分割策略，提取经过灰度化和去噪处理图像的特征，并结合注意力机制，将处理后病灶位置的图像分割成若干份；利用三维重建策略，对分割的图像切片的匹配代价进行求取，再通过代价聚合和视差优化对分割的图像切片进行拟合重建，将患者病灶区域以三维可视化形式展示。图像分割策略具体方法包括：步骤S101：将经过灰度化和去噪处理后的图像放入训练好的神经网络模型中，将所述神经网络模型中浅层特征和高层特征进行拼接，然后进行卷积运算，得到灰度值特征值，设定提取灰度值特征值为Query；步骤S102：结合注意力机制，对提取的灰度值特征值Query进行加权计算，并且捕获到整个图像的边缘灰度值特征，得到图像的整体灰度值特征；常规卷积神经网络中，运算对象通常为特征图与网络参数，而网络参数在前向过程中总是固定且共享的，这导致特征图很难实现二阶运算，例如求模或求相关计算，虽然从宏观上说，这种运算过程都可以利用傅里叶展开的方式进行近似拟合，但从网络拟合的复杂度和效率上考虑，其可行性都相对较低。如何在网络中设计一种特征与特征之间的自我交互机制以提高网络对特征的表征能力，从而提升网络的特征的构建能力是一个值得考虑的问题。对注意力机制的直觉性描述为特征的加权求和，以关注重要特征并抑制其余特征，但从本质上分析，重要特征被定义基于任务的高相关特征，而注意力机制就是一种求相关并重新分配特征权重的操作，其优越性在于，实现了特征与特征之间的自我交互。步骤S103：统计经过灰度化和去噪处理后的图像中每个灰度像素的个数，设定为经过灰度化和去噪处理后的图像中灰度为i的像素的数量，经过灰度化和去噪处理后的图像中灰度为i的概率为/＞，且/＞，设定经过灰度化和去噪处理后的整个图像的灰度值为/＞，灰度阈值为/＞，像素被分到A的概率为/＞，分配到A的像素平均灰度为/＞，像素被分到B的概率为/＞，分配到B的像素平均灰度为；步骤S104：计算像素的最大化类间方差，计算公式为：；其中，，/＞，/＞，，/＞；根据计算的方差，进行像素分类，结合灰度值特征值和像素分类对经过灰度化和去噪处理后的病灶位置的图像进行分割。实施例2请参阅图2，本发明提供的另一个实施例：三维重建策略的具体步骤为：步骤S201：设定分割后图像切片和任意图像切片/＞的单侧边缘像素点集合为P和Q，/＞，/＞，其中，/＞表示切片/＞中的第i个边缘像素点，/＞表示切片/＞中的第j个边缘像素点，灰度值分别为/＞和/＞，，/＞，对分割后图像切片的匹配初始代价进行计算，代价值计算公式为：；其中，表示代价值控制参数，/＞表示绝对值函数；代价计算的另一种方法：AD法，通过左右视图像素点的三个颜色分量之差的绝对值取平均，来确定匹配的代价，计算公式为：；其中，表示AD法的代价值，P表示左视图图像中的像素点，Pd表示右视图图像中的与像素点P对应的像素点，/＞表示左视图中像素点P的R、G和B的值，/＞表示右视图中像素点Pd的R、G和B的值。步骤S202：代价聚合，设定灰度差异阈值为，像素距离差阈值为/＞，切片/＞和/＞的单侧边缘像素点集合差阈值为/＞，像素聚合的原则公式为：；其中，表示像素点/＞与像素点/＞的像素距离；对像素距离差阈值值的选取，/＞值取2或3效果最佳，对边缘像素的对比，不能只对比最边缘的一个像素，因为在图片切割时，存在着噪声影响，会影响匹配的精度，通过边缘多个像素的对比，可以有效的减小噪声的误差，更加精准的进行匹配和三维重建。步骤S203：根据所述代价值，计算聚合后的代价值，计算公式为：；其中，w表示切片和/＞中的第w个边缘像素点，/＞表示切片/＞中的第w个边缘像素点，/＞表示切片/＞中的第w个边缘像素点；步骤S204：根据所述步骤S201-步骤S203，计算出分割后图像切片上下左右四侧边缘的聚合代价值，视差值/＞选取四侧代价值最小的均值，即，其中，/＞表示分割后图像切片/＞上侧边缘的聚合最小代价值，/＞表示分割后图像切片/＞下侧边缘的聚合最小代价值，表示分割后图像切片/＞左侧边缘的聚合最小代价值，/＞表示分割后图像切片右侧边缘的聚合最小代价值；选取视差值为四侧代价值最小的均值的好处为：通过图像切割，将不同感兴趣区域分割开，并利用空间注意力和通道注意力机制，加强对切割后图片边缘的处理，选取四侧代价值最小为了减小匹配代价，提高效率，均值是因为更加准确的匹配同一感兴趣区域，例如肝脏和血管的匹配，肝脏和血管的边缘像素灰度值相差很大，在计算代价时，由于同一感兴趣区域的灰度值相差很小，所以选取该视差值为了更容易匹配到同一感兴趣区域。步骤S205：根据视差值，选取匹配的分割后图像切片，并进行三维重建，使患者病灶区域以三维可视化形式展示。三维重建方法：基于切片边缘的重组，首先对匹配的两张患者病灶位置的分割后的切图一侧边缘像素的匹配代价进行计算，并设定原则进行限制，计算出匹配的总代价值，对总代价值进行排序，取总代价值最小的，重复上述步骤，对切图的四侧边缘进行匹配，选取四侧边缘总代价值最小值的均值作为匹配条件，筛选出符合条件的匹配图片，所有切片匹配筛选完后，进行重组，根据边缘的长度和宽度信息，对切片的每一个面进行复原，而后进行拼接重组，形成三维图像。灰度化和去噪处理具体为对彩色图像进行灰度化处理和对成像过程中的高斯噪声和莱斯噪声进行处理。灰度化处理：根据图像的R、G和B三个分量的数值，按照一定的权值进行加权平均进行灰度化转化，加权计算公式为：；其中，表示患者病灶位置的彩色图像中任意一个像素的灰度化后的灰度值，/＞表示患者病灶位置的彩色图像中的任意一个像素，/＞表示像素/＞的R值，/＞表示像素/＞的G值，/＞表示像素/＞的B值。步骤S101中神经网络模型为Densenet网络。步骤S102中注意力机制包括：通道注意力机制和空间注意力机制。通道注意力机制用于在特征图的通道域中进行加权运算。通道注意力机制从数字图像处理的角度理解，单个卷积核表示为某一类特征的滤波器，N维特征图来源于N个卷积运算输出，因此基于通道加权的方式实际上是对特征进行筛选的操作，主流的通道注意力方法都是基于空间域上特征压缩操作完成的，通常采用池化的方式。通道注意力机制筛选特征类型并找出与任务相关性高的特征类型，从而加权模型的表达能力并进一步抑制噪声所带来的影响。空间注意力机制用于对各种形变数据在空间中进行转换，并自动捕获区域特征。空间注意力机制与通道注意力机制不同，空间注意力机制用于关注在同一种特征类型下的高相关位置的响应，例如，通道注意力捕获了整个图像的边缘特征，那么空间注意力则是关注了肝脏的边缘像素。空间注意力是对平移不变性运算的一种补充运算，可以学习到目标关键特征在空间上的分布统计特性。除此之外，在空间注意力机制中，基于Non-Local的注意力机制还具备打破卷积神经网络局部感受野限制的能力，可以实现远距离像素之间的关联。步骤S205中的三维重建利用立方卷积插值将匹配的图像切片进行三维重组。实施例3三维重建方法还有：1)等值面提取算法，通过线性插值在三维离散数据域中对等值面进行逼近，首先定义一个体元代表由顺序排列的8个像素构成的立方体，数据中每个非边界的体素包含于8个体元，每个体元的极点值存在三种情况：高于或等于等值表示在表面的内部，低于等值表示在表面的外部。因此，根据等值，每个体元中的极点存在两种状态，两两组合后一个体元就有256种状态，根据空间平移不变性和对称性可以将其分为15种基本构型，当对应于立方体的八个顶点之一的体素被认为在边界上时，将创建一个三角形面，将立方体分成两部分以创建四面体元素，根据等值面的值和三件面片穿过的边的两个顶点的值采用线性插值计算出三角面片顶点的空间位置，每个体元内部将含有若干个三角面片，通过遍历所有体元，组合所有的三角面组合构造出最终的三角网格表面模型。此时混合网格模型的外层由四面体单元组成，而内部区域由六面体单元组成，两层共享同一组节点并无缝连接，保持了有限元的合规性，将所有产生贡献的三角形面片组合构成网格表面数据，近似表示当前内部平面生成真实的图形效果。MC算法在原理上比较直观，理论上构造相互独立，非常适用于规则结构的三维重建绘制，但算法运行过程中大量三角面片可能会造成数据间的拓扑连接二义性问题，需要并行计算解决。对于MRI图像来说，数字化成像的特点、解剖结构的复杂性和组织的特异性，导致其不可避免地受到噪声的干扰，因此MC算法在医学领域的应用存在局限性。2)基于Mimics的三维成像，由多种可实现不同图像处理领域功能的模块构成，模块之间可根据用户的需求灵活搭配，应用性很高。基于医学图像数据，Mimics可以用于辅助医生对很多类型的病症进行诊断，开展手术计划和模拟研究，尤其对于灰度值图像有着非常完善的分割功能的模块，它可以处理任意数目的图像切层，处理图像的界面提供了几种分割和可视化的工具。Mimics的可视化界面主要分为4个视图：轴向、冠状、矢状视图，以及3D对象视图。而MimicsSTL+模块对于三角片文件，提供了所有快速成型系统的接口，生成文件时软件自动调用双线性和中值插值算法，用于提高快速成型的模型的精度，计算所得的模型同样可以导出为STL格式。由于分割后图像数据中仅包含感兴趣区域，此时基于mimic进行三维重建流程简便易操作，首先在主界面右上角右击鼠标生成mask，根据划分好的HU值区间范围选择custom并且为了保证体素之间的连通性，勾选Fillholes和Keeplargest选项，生成对应的mask，然后选中它，右键选择Calculate3D并选择Quality为high，如果此时提示将生成多个模型，返回上一步，选中对应mask后使用RegionGrowing工具点击对应mask，并且勾选MultipleLayer和任意连接方式生成全连通的mask1，然后对mask1计算3D模型并生成质量模型，并可选是否进行模型的后处理：表面光滑处理和检测自交。后处理的主要目的包括：保证三维表面模型的质量的同时简化网格数目，减少计算量和模型的几何错误。一系列操作后生成的三维表面模型可在3D视图进行观察，选中生成的3D对象右键使用STL+对其进行保存以及展示。3)光线投射法，是一种切片级三维重建算法，以图像空间为序的直接体绘制方法，被广泛应用在医学成像领域。光线投影法主要包含存储、投射、插值、梯度估计等步骤。与光线跟踪算法不同，它的基本思想是从某个像素点出发，沿着人眼视线的方向投射出一条平行束直线，直线不停留在物体表面，而是会穿透三维体数据场。沿着这条射线做间隔均匀地采样，并利用插值算法计算采样点的光学属性。然后按照特定的顺序对等距离的所有采样点进行合成，最后在空间坐标系上计算光线对应二维屏幕上的像素点。泛光模型是只考虑环境光的简单经验模型，通过泛光模型只能看到物体的平面形状，无法感受到空间体积感，其计算公式如下所示：，其中，/＞表示反射后的环境光强度，/＞表示物体对环境光的反射系数，/＞表示入射环境光的强度，光线投射法与MC算法之间最大的区别是光线投射法通过设置参数得到不透明的绘制结果，能够有效地反映物体的内部结构形态。光线投射法绘制的成像质量较好，但不容忽视的缺陷是其无法按照逻辑存储的顺序来对体数据进行有序存储，即需要遍历数据中的每个体积元素，一旦体数据场中采样点的方向发生细微变化就要进行重新采样。因此，该方法难以提高三维重建的速度。K维点的二叉树、八叉树结构及金字塔结构等改进光线投影法的算法都试图通过内部相关性来提高体绘制效率，从而减少算法复杂度，但应用到真实医学图像时效果并不理想。实施例4请参阅图3，本发明提供的另一个实施例：一种用于手术术前规划的三维重建系统，包括：图像采集设备，用于拍摄患者的病灶位置图像；图像处理单元，对患者病灶位置图像进行灰度化和去噪处理利用图像分割策略，提取经过灰度化和去噪处理后图像的特征，并结合注意力机制，将处理后病灶位置的图像分割成若干份，利用三维重建策略，对分割的图像切片的匹配进行求取，再通过代价聚合和视差优化进行拟合重建，使患者病灶区域以三维可视化形式展示；三维成像设备，用将三维重建的患者病灶位置图像以三维可视化形式展示。图像采集设备包括：核磁共振设备、CT设备和PET设备。实施例5一种电子设备，包括存储器和处理器，所述存储器存储有计算机程序，其特征在于，所述处理器执行所述计算机程序时实现一种用于手术术前规划的三维重建方法的步骤。实施例6一种计算机可读存储介质，其上存储有计算机指令，当计算机指令运行时执行一种用于手术术前规划的三维重建方法的步骤。本领域普通技术人员可以理解，以上所述仅为发明的优选实例而已，并不用于限制发明，尽管参照前述实例对发明进行了详细的说明，对于本领域的技术人员来说，其依然可以对前述各实例记载的技术方案进行修改，或者对其中部分技术特征进行等同替换，凡在发明的精神和原则之内，所做的修改、等同替换等均应包含在发明的保护范围之内。
