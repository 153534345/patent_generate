标题title
一种优化眼部医学图像的方法、装置和存储介质
摘要abst
本发明提供了一种优化眼部医学图像的方法、装置和存储介质，涉及图像处理技术领域，包括：获取眼部图像；对存在镜面反射现象的区域进行检测，确定反射区域；根据反射区域生成掩膜；利用循环生成对抗网络生成掩膜覆盖区域的图像，即生成图像；保留眼部图像的掩膜之外的部分，与生成图像融合成为优化图像；其中，循环生成对抗网络具有由局部判别器和全局判别器构成的双判别器模块，通过双判别器模块与生成器的配合，对输入图像的若干区域进行不同程度的增强。本发明能够准确识别眼部医学图像中出现的反光区域并进行处理，将被反光掩盖的部分通过循环对抗生成网络修复为尽可能接近真实的图像，提升对眼部医学图像的检测精度。
权利要求书clms
1.一种优化眼部医学图像的方法，其特征在于，包括：获取眼部图像；对所述眼部图像中存在镜面反射现象的区域进行检测，确定反射区域；根据所述反射区域生成掩膜；利用循环生成对抗网络生成掩膜覆盖区域的图像，即生成图像；保留所述眼部图像的掩膜之外的部分，与所述生成图像融合成为优化图像；其中，所述循环生成对抗网络的输入图像包括所述眼部图像所显示的眼部区域的多个图像；所述循环生成对抗网络具有由局部判别器和全局判别器构成的双判别器模块，通过所述双判别器模块与生成器的配合，对输入图像的若干区域进行不同程度的增强，以提升生成图像的图像质量。2.根据权利要求1所述的优化眼部医学图像的方法，其特征在于，所述确定反射区域的步骤，具体包括：利用边缘检测算法检测出亮度变化剧烈的边界，根据边界确定所述反射区域，和/或将亮度高于设定阈值的区域确定为反射区域。3.根据权利要求1所述的优化眼部医学图像的方法，其特征在于，融合的步骤具体包括：将所述眼部图像的掩膜部分设置为单色色块，作为第一图像；将所述循环生成对抗网络的输出图像的非掩膜部分设置为所述单色色块，作为第二图像；合并所述第一图像和所述第二图像。4.根据权利要求1所述的优化眼部医学图像的方法，其特征在于，所述局部判别器和所述全局判别器基于PatchGAN算法实施鉴别任务；其中，所述局部判别器从清晰图像以及生成器的输出图像中随机裁剪局部块，学习区分所述局部块是来自清晰图像或来自生成器输出的图像，所述清晰图像为输入图像中不存在镜面反射现象的图像；所述全局判别器从输入图像中提取特征，生成一个N*N矩阵与生成器的输出图像进行比较，从而形成全局比较的概念，考虑全局感受野信息的差异。5.根据权利要求2所述的优化眼部医学图像的方法，其特征在于，所述边缘检测算法基于Canny边缘检测算法进行改进，边缘检测的具体过程包括：对所述眼部图像进行表面模糊处理以过滤噪声；采用Scharr 算子计算梯度；根据梯度的方向，比较此方向上的相邻点，抑制非最大值；根据双阈值分类得到强边缘、虚边缘、非边缘；连接强边缘的虚边缘为边缘，不连接强边缘的为弱边缘，对弱边缘进行抑制。6.根据权利要求5所述的优化眼部医学图像的方法，其特征在于，所述表面模糊处理的步骤表示为：；其中，Mij 代表矩阵中的每个元素值，Pij 代表矩阵中每个元素对应的像素分量值，P0代表矩阵中心的像素分量值，T 表示阈值，表示矩阵元素对应像素分量值与中心元素对应像素分量值的绝对差；如果 Mij 的值小于 0，则将Mij设为 0。7.根据权利要求1至6中任一项所述的优化眼部医学图像的方法，其特征在于，所述输入图像与待处理的眼部图像为同一患者的眼部图像。8.根据权利要求1至6中任一项所述的优化眼部医学图像的方法，其特征在于，所述眼部图像为睑板腺图像。9.一种优化眼部医学图像的装置，其特征在于，包括：存储器，用于存储程序指令；处理器，用于调用所述存储器中存储的所述程序指令以实现如权利要求1至8中任一项所述的优化眼部医学图像的方法。10.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质存储有程序代码，所述程序代码用于实现如权利要求1至8中任一项所述的优化眼部医学图像的方法。
说明书desc
技术领域本发明涉及图像处理技术领域，具体而言，涉及一种优化眼部医学图像的方法、装置和存储介质。背景技术在眼科医疗项目中，通过获取目标部位的医学图像进行病情研判是不可或缺的一个重要环节，例如在睑板腺检测项目中：睑板腺埋藏于眼睑之内侧，其开口位于睑缘，具有分泌各种脂质成分，形成脂质层，防止泪液过度蒸发的功能。睑板腺的数量和形态一旦发生异常，往往就会导致睑板腺油脂分泌异常，泪膜稳定性下降，最终发生睑板腺功能障碍，这是蒸发过强型干眼症的主要病因，干眼症严重影响人们的正常生活。现有技术中，利用医学图像对睑板腺进行检测的方式主要包括：通过拍摄睑板腺图像并采用传统的图像处理技术，从整体图像中分割和提取出睑板腺腺体来自动统计睑板腺的形态结构和数量。该检测方式虽能够较为客观的反应睑板腺的情况，且操作快速简单、患者的不适感小；但在实现本发明的过程中发明人发现：由于眼睑内表面覆盖着有起保护和湿润作用的油脂层，睑板腺成像过程中很容易产生表面反射而形成高光亮斑，受高光亮斑区域的影响，导致传统的图像处理方法难以快速有效地提取睑板腺腺体，检测误差较大。伴随着深度学习在图像处理领域的快速发展，各种卷积神经网络纷纷被用来提升图像检测的效率。然而，大部分深度学习网络是强监督学习，需要大量的成对的标注图像构成训练样本。在医学领域，它要求同一患者同一部位同时拍下两张图片，一张有反光，一张无反光，其他完全相同，这是很难实现的，即深度学习在医学图像尤其是睑板腺检测和识别中的应用受到了很大限制。因此，如何设计一种更适用于眼部医学图像的图像处理方案，优化眼部医学图像以提高检测精度成为亟待解决的技术问题。发明内容本发明旨在至少解决现有技术或相关技术中存在的技术问题之一，公开了一种优化眼部医学图像的方法、装置和存储介质，考虑到眼部医学图像的特殊性，增强眼部医学图像的细节表现力，进而提高了检测精度。本发明的第一方面公开了一种优化眼部医学图像的方法，包括：获取眼部图像；对眼部图像中存在镜面反射现象的区域进行检测，确定反射区域；根据反射区域生成掩膜；利用循环生成对抗网络生成掩膜覆盖区域的图像，即生成图像；保留眼部图像的掩膜之外的部分，与生成图像融合成为优化图像；其中，循环生成对抗网络的输入图像包括眼部图像所显示的眼部区域的多个图像；循环生成对抗网络具有由局部判别器和全局判别器构成的双判别器模块，双判别器模块既考虑到了图片映射中宏观上的相似性，同时对关键细节进行针对性的考量，指导生成器对输入图像的若干区域进行不同程度的增强，以提升生成图像在全局和关键细节上的图像质量。在该技术方案中，基于改进的循环生成对抗网络即弱监督模型，学习有反光和无反光图像的跨域映射函数，不再需要使用成对图像进行训练，而可以接受同一患者不同时间拍摄的同类图像作为输入。模型能够捕捉到上下文和语义信息，因而输出的图像在内容和结构上与输入内容类似。考虑到眼部医学图像的特点，CycleGAN需要对输入图像的若干局部区域与其他部分进行不同的增强，例如，对于整体黑暗背景中的小型亮斑区域，传统CycleGAN中单独的全局图像判别器通常无法提供所需的自适应性，所以本发明为了自适应增强局部区域而改进判别器结构，采用全局-局部双判别器结构，局部判别器和全局判别器都基于PatchGAN进行鉴别。根据本发明公开的优化眼部医学图像的方法，优选地，确定反射区域的步骤，具体包括：利用边缘检测算法检测出亮度变化剧烈的边界，根据边界确定反射区域，和/或将亮度高于设定阈值的区域确定为反射区域。根据本发明公开的优化眼部医学图像的方法，优选地，融合的步骤具体包括：将眼部图像的掩膜部分设置为单色色块，作为第一图像；将循环生成对抗网络的输出图像的非掩膜部分设置为单色色块，作为第二图像；合并第一图像和第二图像。根据本发明公开的优化眼部医学图像的方法，优选地，局部判别器和全局判别器基于PatchGAN算法实施鉴别任务；其中，局部判别器从清晰图像以及生成器的输出图像中随机裁剪局部块，学习区分局部块是来自清晰图像或来自生成器输出的图像，清晰图像为输入图像中不存在镜面反射现象的图像；全局判别器从输入图像中提取特征，生成一个N*N矩阵与生成器的输出图像进行比较，从而形成全局比较的概念，考虑全局感受野信息的差异。通过在全局和局部细节两个尺度判别图像，既能指导图像生成的整体相似性，又指导对反光局部进行针对性的着重增强，使得生成图像在细节上也更接近真实情况。根据本发明公开的优化眼部医学图像的方法，优选地，边缘检测算法基于Canny边缘检测算法进行改进，边缘检测的具体过程包括：对眼部图像进行表面模糊处理以过滤噪声；采用Scharr 算子计算梯度；根据梯度的方向，比较此方向上的相邻点，抑制非最大值；根据双阈值分类得到强边缘、虚边缘、非边缘；连接强边缘的虚边缘为边缘，不连接强边缘的为弱边缘，对弱边缘进行抑制。根据本发明公开的优化眼部医学图像的方法，优选地，表面模糊处理的步骤表示为：其中，Mij 代表矩阵中的每个元素值，Pij 代表矩阵中每个元素对应的像素分量值，P0 代表矩阵中心的像素分量值，T 表示阈值，表示矩阵元素对应像素分量值与中心元素对应像素分量值的绝对差；如果 Mij 的值小于 0，则将Mij设为 0。根据本发明公开的优化眼部医学图像的方法，优选地，输入图像与待处理的眼部图像为同一患者的眼部图像。根据本发明公开的优化眼部医学图像的方法，优选地，眼部图像为睑板腺图像。本发明的第二方面公开了一种优化眼部医学图像的装置，包括：存储器，用于存储程序指令；处理器，用于调用存储器中存储的程序指令以实现如上述任一技术方案的优化眼部医学图像的方法。本发明的第三方面公开了一种计算机可读存储介质，该计算机可读存储介质存储有程序代码，程序代码用于实现如上述任一技术方案的优化眼部医学图像的方法。本发明的有益效果至少包括：采用改进后的循环对抗生成网络对眼部医学图像中存在镜面反射现象的区域进行重建，得到清晰的眼部图像，有助于进行病情研判，本发明提供的图像处理方案无需成对的图片进行模型训练，相较于传统的图像处理方法、强监督的深度学习方法，本发明提供的方案更适用于医学图像的处理。通过使用全局-局部双判别器结构，使得输入图像有若干局部区域与图像其他部分有不同程度的增强，能关注到更多细节，伴随着判别器的判别能力的提高，生成器生成能力也会提高，基于输入一张反光的图像，生成器能够生成一张无反光的图像，那么随着生成器的生成能力的提高，它生成的图像就更接近真实的图像，修复得到的图像越接近理想的无反光清晰图像。在睑板腺成像图像常存在因光照角度、睑板表面成像区域不规则等因素导致图像光照不均匀、以及腺体与非腺体区域对比度低的情况下，使用全局-局部双判别器结构，对反光区域进行不同于整体图像的着重增强，更有利于生成在细节上更接近真实睑板腺图像的预测图像，最终大大降低检测难度，检测结果也更为准确。附图说明图1示出了根据本发明的一个实施例的优化眼部医学图像的方法的流程示意图。图2示出了根据本发明的一个实施例的循环生成对抗网络的模型示意图。图3示出了根据本发明的一个实施例的循环生成对抗网络的全局-局部双判别器示意图。图4示出了根据本发明的一个实施例的优化眼部医学图像的装置的示意框图。图5示出了未经优化的睑板腺图像。图6示出了传统图像处理方法处理后的睑板腺图像。图7示出了经过本发明的优化方法处理后的睑板腺图像。具体实施方式为了能够更清楚地理解本发明的上述目的、特征和优点，下面结合附图和具体实施方式对本发明进行进一步的详细描述。在下面的描述中阐述了很多具体细节以便于充分理解本发明，但是，本发明还可以采用其他不同于在此描述的其他方式来实施，因此，本发明并不限于下面公开的具体实施例的限制。如图1所示，根据本发明的一个实施例，本发明公开的优化眼部医学图像的方法包括：步骤S101，获取眼部图像；步骤S102，对眼部图像中存在镜面反射现象的区域进行检测，确定反射区域；步骤S103，根据反射区域生成掩膜；步骤S104，基于改进的循环生成对抗网络生成掩膜覆盖区域的图像，即生成图像；步骤S105，保留眼部图像的掩膜之外的部分，与生成图像融合成为优化图像；其中，改进的循环生成对抗网络的输入图像包括眼部图像所显示的眼部区域的多个图像；改进的循环生成对抗网络具有由局部判别器和全局判别器构成的双判别器模块，通过双判别器模块与生成器的配合，对输入图像的若干区域进行不同程度的增强，以提升生成图像的图像质量。在本实施例中，对传统的循环生成对抗网络的网络结构进行改进，采用双判别器模块替代原网络的判别器，基于新的局部判别器和全局判别器对循环生成对抗网络的输入图像进行局部鉴别以及全局鉴别，将输入图像的若干局部区域与其他部分进行不同的增强，从而提升输出图像的图像质量，使其能够显示更多细节信息，如图5、图6和图7所示：图5是未经优化的睑板腺图像，其中包含若干反光区域，具有代表性的区域如图中a、b、c框中所示。图6是传统图像处理方法处理后的睑板腺图像，其对原图做了一定的增强，如a、b框中反光区域在一定程度上被修复，但a框中未能完全消除反光区域，b框中消除后在局部上与周围像素间存在明显色差，c框中反光区域未能进行增强，由此可见，图6示出的传统方法虽然对原图有一定的增强效果，但仍不能满足病情研判的需要。图7是经过本发明的优化方法处理后的睑板腺图像， 其基本消除了a、c框中的反光区域，同时对b框中的反光局部修复也更加准确，与周围像素没有明显色差。图7示出根据上述实施例提出的优化方法对原图中的镜面反射区域进行修复，使其尽量接近睑板腺的真实情况，整个过程中无需成对的图片进行模型训练，相较于传统的图像处理方法更适用于医学图像的处理。优化原理主要包括：通过使用全局-局部双判别器结构，可以使得输入图像有若干局部区域与图像其他部分有不同程度的增强，能关注到更多细节，伴随着判别器的判别能力的提高，生成器生成能力也会提高，基于输入一张反光的图像，生成器可以生成一张无反光的图像，那么随着生成器的生成能力的提高，它生成的图像就更接近真实的图像，能更好的去反光，修复得到的图像越接近理想的无反光睑板腺清晰图像。根据上述实施例，优选地，步骤S102具体包括：利用边缘检测算法检测出亮度变化剧烈的边界，根据边界确定反射区域，和/或将亮度高于设定阈值的区域确定为反射区域。根据上述实施例，优选地，步骤S105中融合的步骤具体包括：将眼部图像的掩膜部分设置为单色色块，作为第一图像；将循环生成对抗网络的输出图像的非掩膜部分设置为单色色块，作为第二图像；合并第一图像和第二图像。根据上述实施例，优选地，局部判别器和全局判别器基于PatchGAN算法实施鉴别任务；其中，局部判别器从清晰图像以及生成器的输出图像中随机裁剪局部块，学习区分局部块是来自清晰图像或来自生成器输出的图像，清晰图像为输入图像中不存在镜面反射现象的图像；全局判别器从输入图像中提取特征，生成一个N*N矩阵与生成器的输出图像进行比较，从而形成全局比较的概念，考虑全局感受野信息的差异。根据上述实施例，优选地，边缘检测算法基于Canny边缘检测算法进行改进，边缘检测的具体过程包括：对眼部图像进行表面模糊处理以过滤噪声；采用Scharr 算子计算梯度；根据梯度的方向，比较此方向上的相邻点，抑制非最大值；根据双阈值分类得到强边缘、虚边缘、非边缘；连接强边缘的虚边缘为边缘，不连接强边缘的为弱边缘，对弱边缘进行抑制。在该实施例中，有别于传统的Canny边缘检测算法，本发明不使用高斯滤波核而使用表面模糊过滤噪声，改 3*3 Sobel 算子为采用 Scharr 算子。这样改进的原因是：噪声和边缘信号都属于高频信号。高斯模糊会对所有高频信息进行模糊处理，然而包含保留边缘功能的表面模糊方法不会将所有相邻像素均纳入平滑计算，而是制定一个阈值，只有中心像素与其他像素灰度差小于此阈值时才被考虑在内。由此，对于与中心像素灰度差距较大的像素，认为其包含有效信息而非噪声，故不被纳入平滑处理，对于保留边缘细节更为合适。本发明采用非极大值抑制可以排除非边缘特征，同时提高定位边缘的精度；而采用滞后阈值化则可以有效减少边缘漏检的概率。根据数据经验来看，锐化  算子比Sobel 算子在连续性和对细节的处理上表现更好。非极大值抑制：非极大值抑制是一种图像处理方法，它的原理是在像素点周围寻找局部最大值，并将非最大值点所对应的灰度值视为背景像素。如果像素点邻域的梯度值满足局部最优条件，则该像素点被认为是具有边缘特征的像素。执行该方法可有效减少非边缘点，只留下有潜在边缘特征的像素点。这个步骤的主要目的是排除非边缘像素，保留候选图像边缘。滞后阈值化：受到噪声的影响，边缘经常会发生中断的问题。滞后阈值化方法可以解决这个问题，它根据两个阈值来进行设定：高阈值和低阈值。双阈值处理时，高阈值可除去大部分噪音，但同时也会丢失一些有用的边缘信息；而低阈值则能够保留更多的边缘信息。如果某像素的响应值位于低阈值和高阈值之间，并且该像素与周围已被标记为边缘的像素是八邻接关系，则该像素也会被标记为边缘。这样就可以有效解决边缘中断的问题。根据上述实施例，优选地，表面模糊处理的步骤表示为：其中，Mij 代表矩阵中的每个元素值，Pij 代表矩阵中每个元素对应的像素分量值，P0 代表矩阵中心的像素分量值，T 表示阈值，表示矩阵元素对应像素分量值与中心元素对应像素分量值的绝对差；如果 Mij 的值小于 0，则将Mij设为 0。根据上述实施例，优选地，输入图像与待处理的眼部图像为同一患者的眼部图像。根据上述实施例，优选地，眼部图像为睑板腺图像。如图2所示，根据本发明的又一个实施例还公开了循环生成对抗网络的模型框架示意图：包含前向映射器 G : X →Y 和后向映射器 F :Y → X 以及对应的判别器 D y和 D x ；该模型的目标是学习源域 X和目标域 Y之间的映射函数；模型接受不成对的训练图片样本 x ∈ X 和 y ∈Y，包括两个映射器：前向映射器G : X →Y 和后向映射器 F :Y → X，以及训练数据集使用两个对抗性判别器 D x 和 D y ：D y 的任务是区分目标图像集合{y} 和生成的图像集合 {G} ，D x的任务是区分源图像集合 {x}和生成的图像集合 {F}。如图3所示，根据本发明的又一个实施例还公开了一种循环生成对抗网络的全局-局部双判别器的结构。 D x 和 D y被配置为全局-局部双判别器结构，即D x和D y均具有全局判别器和局部判别器。全局判别器和局部判别器都使用PatchGAN实施鉴别任务。PatchGAN是一种图像处理方式，它使用若干卷积层处理输入图像，最终使用一个通道数为1的卷积将特征图映射为一个N×N的矩阵。在这个矩阵中，每个点所代表的是原始图像中一个小区域的评价值，这样做等同于使用单一的评价值进行评估。相比于只输出一个值的方式，输出一个N×N的矩阵的好处在于能够独立评估每个小区域，这也是Patch的含义所在。为了实现损失计算，标签也会被设置成N×N的格式。PatchGAN的优势在于，它使用更多的“感受野”，从而可以综合考虑更多的区域。局部判别器：从输出和真实正常光图像中随机裁剪局部块，并学习区分它们是真实的还是虚假的全局判别器：使用卷积神经网络，从输入图像中提取特征，然后生成一个N*N矩阵进行比较，从而形成全局比较的概念，考虑全局感受野信息的差异。如图4所示，根据本发明的又一个实施例还公开了一种优化眼部医学图像的装置300，包括：存储器301，用于存储程序指令；处理器302，用于调用存储器中存储的程序指令以实现如上述实施例的优化眼部医学图像的方法。根据本发明的又一个实施例还公开了一种计算机可读存储介质，该计算机可读存储介质存储有程序代码，程序代码用于实现如上述实施例的优化眼部医学图像的方法。上述实施例的各种方法中的全部或部分步骤是可以通过程序来控制相关的硬件来完成，该程序可以存储于可读存储介质中，存储介质包括只读存储器 、随机存储器 、可编程只读存储器 、可擦除可编程只读存储器 、一次可编程只读存储器 、电子抹除式可复写只读存储器 、只读光盘 或其他光盘存储器、磁盘存储器、磁带存储器、或者能够用于携带或存储数据的可读的任何其他介质。以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
