标题title
塑形镜划痕前景图像提取方法、装置、设备及存储介质
摘要abst
本发明实施例公开了一种塑形镜划痕前景图像提取方法、装置、设备及存储介质，其中，所述方法包括：获取塑形镜多曝光划痕图像；选择一个像素点，并对像素点按照设定角度邻域生成参考线段，在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，分别计算得到每条辅助判断线段的灰度值均值；在不小于设定的第二参考阈值时，两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定像素点为划痕点；返回选择像素点步骤，直至遍历完成所有像素点，根据划痕点生成划痕前景图像。
权利要求书clms
1.一种塑形镜划痕前景图像提取方法，其特征在于，包括：获取塑形镜多曝光划痕图像；选择所述塑形镜多曝光划痕图像中的一个像素点，并对所述像素点按照设定角度邻域生成参考线段，并计算每个参考线段的灰度值均值；在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别为存在的至少一条参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，所述平行辅助判断线段长度与对应的参考线段的长度相同；分别计算得到每条辅助判断线段的灰度值均值，判断每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值；在不小于设定的第二参考阈值时，计算两条辅助判断线段的灰度值均值差值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值；在所述两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定所述像素点为划痕点；返回选择所述塑形镜多曝光划痕图像中的一个像素点步骤，直至遍历完成所有像素点，根据划痕点的确定结果生成划痕前景图像。2.根据权利要求1所述的方法，其特征在于，所述方法还包括：对区分前景和后景的塑形镜多曝光划痕图像进行二值化转换，并利用FLD算法对二值化转换后的图像进行直线段检测，得到检测后的多个直线段；随机选取其中一个直线段，并计算与相邻直线段间的夹角θ、所述直线段中点到相邻直线段的距离d和所述直线段端点与所述相邻直线段间的最小距离g；在夹角θ小于预设的角度阈值，距离d小于预设的距离阈值，以及最小距离g小于预设的最小距离阈值时，则将所述直线段和所述相邻直线段设为同组直线段；返回随机选取其中一个直线段步骤，直至遍历完成所有直线段；根据分组设定划痕兴趣区域。3.根据权利要求1所述的方法，其特征在于，所述获取塑形镜多曝光划痕图像，包括：对多张半光划痕的图像进行特征检测，得到每张多聚焦图像的特征描述子；根据所述每张多聚焦图像的特征描述子得到每张划痕图像的清晰度描述子；使用s×s的滑动窗口同时遍历每张划痕图像的相同区域，在其中一张划痕图像的滑动窗口内清晰度描述子之和大于其余任一划痕图像的清晰度描述子之和时，上调所述滑动窗口内所有像素点权重值；根据调整后的像素点权重值，确定图像中的清晰点、模糊点和不确定点；根据预设的清晰点、模糊点和不确定点的比例对多张划痕图像进行拼接，得到塑形镜多曝光划痕图像。4.根据权利要求1所述的方法，其特征在于，所述获取塑形镜多曝光划痕图像还包括：将光阑作为载物台，将角膜塑形镜内表面朝上放置在光阑小孔处所述光阑仅有中心大小可调的小孔可透过光束，其余位置均不透光，且光阑小孔口径略小于角膜塑形镜直径；使用环形LED作为光源，以透射的方式进行照明，光阑中心为点O，点M、N分别为物镜和环形LED边缘上任意一点，OM与光轴夹角为，ON与光轴夹角为/＞，/＞；利用电机控制光阑台移动预设距离，得到多张清晰区域不同的多聚焦划痕图像。5.根据权利要求2所述的方法，其特征在于，所述方法还包括：在每个划痕兴趣区域内对区域内所有直线段，进行多项式拟合，得到拟合后的划痕；将拟合到的划痕图像划痕检测结果，并按照原始图像中对应位置的灰度值，在塑形镜多曝光划痕图像中标出。6.根据权利要求5所述的方法，其特征在于，在所述得到拟合后的划痕之前，所述方法还包括：利用RANCAS算法对区域内的线段进行初步拟合，以去除外点的影响；相应的，所述在每个划痕兴趣区域内对区域内所有直线段，进行多项式拟合，包括：在每个划痕兴趣区域内对区域内去除外点的所有直线段进行多项式拟合。7.一种塑形镜划痕前景图像提取装置，其特征在于，包括：获取模块，用于获取塑形镜多曝光划痕图像；选择模块，用于选择所述塑形镜多曝光划痕图像中的一个像素点，并对所述像素点按照设定角度邻域生成参考线段，并计算每个参考线段的灰度值均值；建立模块，用于在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别为存在的至少一条参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，所述平行辅助判断线段长度与对应的参考线段的长度相同；判断模块，用于分别计算得到每条辅助判断线段的灰度值均值，判断每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值；计算模块，用于在不小于设定的第二参考阈值时，计算两条辅助判断线段的灰度值均值差值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值；确定模块，用于在所述两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定所述像素点为划痕点；生成模块，用于返回选择所述塑形镜多曝光划痕图像中的一个像素点步骤，直至遍历完成所有像素点，根据划痕点的确定结果生成划痕前景图像。8.一种设备，其特征在于，所述设备包括：一个或多个处理器；存储装置，用于存储一个或多个程序，当所述一个或多个程序被所述一个或多个处理器执行，使得所述一个或多个处理器实现如权利要求1-6中任一所述的塑形镜划痕前景图像提取方法。9.一种包含计算机可执行指令的存储介质，其特征在于，所述计算机可执行指令在由计算机处理器执行时用于执行如权利要求1-6任一所述的塑形镜划痕前景图像提取方法。
说明书desc
技术领域本发明涉及前景图像提取技术领域，尤其涉及一种塑形镜划痕前景图像提取方法、装置、设备及存储介质。背景技术前景图像通常为图像中的兴趣区域，与背景共同构成一幅完整的图像。在进行图像处理和识别中，得到准确的前景图像能够实现目标的准确识别，便于后续处理。目前，通常采用分水岭法对图像中的前景进行提取。其核心思路为利用前景图像与背景图像的像素点灰度值的区别，通过设定的合理阈值将其进行区分。在实现本发明的过程中，发明人发现如下技术问题：分水岭法虽然能够对常规图像取得良好的前景提取效果，但对于某些特殊图像，例如塑形镜划痕提取则无法适用。由于塑形镜的划痕在常规光线下，较难显现，通常需要外界强光源照射才能直观显示。然而，由于角膜塑形镜不仅面积小、曲率大，而且在不同的弧段具有不同的曲率，在强光源照射下，容易产生不同程度的光反射和折射，进而使得该区域灰度值发生变化。并且由于角膜塑形镜直接与人眼接触，其表面不可避免地会积累蛋白质等有机物质。有机物质在强光源照射下，也容易使得该区域灰度值发生变化，使得采用分水岭法无法准确的提取到划痕的前景图像。发明内容本发明实施例提供了一种塑形镜划痕前景图像提取方法、装置、设备及存储介质，以解决现有技术中无法准确的提取到划痕的前景图像的技术问题。第一方面，本发明实施例提供了一种塑形镜划痕前景图像提取方法，包括：获取塑形镜多曝光划痕图像；选择所述塑形镜多曝光划痕图像中的一个像素点，并对所述像素点按照设定角度邻域生成参考线段，并计算每个参考线段的灰度值均值；在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别为存在的至少一条参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，所述平行辅助判断线段长度与对应的参考线段的长度相同；分别计算得到每条辅助判断线段的灰度值均值，判断每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值；在不小于设定的第二参考阈值时，计算两条辅助判断线段的灰度值均值差值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值；在所述两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定所述像素点为划痕点；返回选择所述塑形镜多曝光划痕图像中的一个像素点步骤，直至遍历完成所有像素点，根据划痕点的确定结果生成划痕前景图像。第二方面，本发明实施例还提供了一种塑形镜划痕前景图像提取装置，包括：获取模块，用于获取塑形镜多曝光划痕图像；选择模块，用于选择所述塑形镜多曝光划痕图像中的一个像素点，并对所述像素点按照设定角度邻域生成参考线段，并计算每个参考线段的灰度值均值；建立模块，用于在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别为存在的至少一条参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，所述平行辅助判断线段长度与对应的参考线段的长度相同；判断模块，用于分别计算得到每条辅助判断线段的灰度值均值，判断每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值；计算模块，用于在不小于设定的第二参考阈值时，计算两条辅助判断线段的灰度值均值差值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值；确定模块，用于在所述两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定所述像素点为划痕点；生成模块，用于返回选择所述塑形镜多曝光划痕图像中的一个像素点步骤，直至遍历完成所有像素点，根据划痕点的确定结果生成划痕前景图像。第三方面，本发明实施例还提供了一种设备，包括：一个或多个处理器；存储装置，用于存储一个或多个程序，当所述一个或多个程序被所述一个或多个处理器执行，使得所述一个或多个处理器实现如上述实施例提供的塑形镜划痕前景图像提取方法。第四方面，本发明实施例还提供了一种包含计算机可执行指令的存储介质，所述计算机可执行指令在由计算机处理器执行时用于执行如上述实施例提供的塑形镜划痕前景图像提取方法。本发明实施例提供的塑形镜划痕前景图像提取方法、装置、设备及存储介质，通过获取塑形镜多曝光划痕图像；选择所述塑形镜多曝光划痕图像中的一个像素点，并对所述像素点按照设定角度邻域生成参考线段，并计算每个参考线段的灰度值均值；在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别为存在的至少一条参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，所述平行辅助判断线段长度与对应的参考线段的长度相同；分别计算得到每条辅助判断线段的灰度值均值，判断每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值；在不小于设定的第二参考阈值时，计算两条辅助判断线段的灰度值均值差值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值；在所述两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定所述像素点为划痕点；返回选择所述塑形镜多曝光划痕图像中的一个像素点步骤，直至遍历完成所有像素点，根据划痕点的确定结果生成划痕前景图像。利用划痕图像的特点，通过设置参考线和辅助线，并对参考线和辅助线上的像素灰度值进行综合判断，可以准确的确定该像素点是否为划痕。利用上述方法，可准确的从塑形镜图像中准确提取到划痕前景图像。附图说明通过阅读参照以下附图所作的对非限制性实施例所作的详细描述，本发明的其它特征、目的和优点将会变得更明显：图1是本发明实施例一提供的塑形镜划痕前景图像提取方法的流程示意图；图2是本发明实施例二提供的塑形镜划痕前景图像提取方法的流程示意图；图3是本发明实施例三提供的塑形镜划痕前景图像提取方法的流程示意图；图4是本发明实施例四提供的塑形镜划痕前景图像提取装置的结构示意图；图5是本发明实施例五提供的设备的结构图。具体实施方式下面结合附图和实施例对本发明作进一步的详细说明。可以理解的是，此处所描述的具体实施例仅仅用于解释本发明，而非对本发明的限定。另外还需要说明的是，为了便于描述，附图中仅示出了与本发明相关的部分而非全部结构。实施例一图1是本发明实施例一提供的塑形镜划痕前景图像提取方法的流程图，本实施例可适用于从塑形镜图像中准确提取划痕前景图像的情况，该方法可以由塑形镜划痕前景图像提取装置来执行，具体包括如下步骤：步骤110,获取塑形镜多曝光划痕图像，选择所述塑形镜多曝光划痕图像中的一个像素点，并对所述像素点按照设定角度邻域生成参考线段，并计算每个参考线段的灰度值均值。在本实施例中，可以从所述塑形镜多曝光划痕图像中任意选取其中一个像素点，也可根据经验选取塑形镜最常出现划痕的区域吗，例如曲率最高的位置对应的预设范围，在此范围内选取一个像素点。从该像素点出发，按照设定角度邻域生成参考线段。示例性的，对每个像素点考虑8个方向，分别为0°,45°,90°,135°所在直线，每条直线代表两个方向。计算每个方向预设长度的线段上相邻的共计个像素点灰度平均值，记为I0。可选的，可根据不同情况选择方向的角度，在此不对角度进行限定。步骤120，在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别为存在的至少一条参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，所述平行辅助判断线段长度与对应的参考线段的长度相同。在本实施例中，由于划痕灰度值与非划痕的灰度值存在区别，且划痕灰度值大于非划痕灰度值。并且由于不同塑形镜的灰度值不同。因此，设定的第一参考阈值可借鉴该塑形镜的整体灰度值设定。示例性的，可将设定的第一参考阈值设定为在塑形镜的整体灰度值的基础上增加预设的数值作为第一参考阈值。由于划痕通常具有一定的宽度，利用该特性，可避免某些单点与周围灰度值差距过大产生的误判，因此，可以考虑左右与其平行且相距个像素的线段，同为/＞个像素点构成。每个方向这样的线段有两组，灰度平均值分别记为/＞和/＞。步骤130，分别计算得到每条辅助判断线段的灰度值均值，判断每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值。每个方向辅助线段有两组，且像素数量一致，将灰度平均值分别记为I1和I2。并分别对每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值进行判断。考虑到划痕周围分布为浅-深-浅的分布，可选的，所述第二参考阈值可在塑形镜的整体灰度值的基础上增加预设的数值，增加的数值小于第一参考阈值对应的预设的数值。步骤140，在不小于设定的第二参考阈值时，计算两条辅助判断线段的灰度值均值差值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值。考虑到划痕的图像特点，划痕在垂直划痕方向的法线上应该具有一定梯度。假设选取的像素点为划痕上一点。与/＞或/＞应存在一定的差值。同时考虑到划痕在垂直划痕方向的法线上不会太宽。若中心像素点为划痕上一点，/＞与/＞之间的差值不应过大。即划痕在垂直划痕方向的法线上不能太宽。步骤150，在所述两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定所述像素点为划痕点。判断两条辅助判断线段的灰度值均值差值是否小于预设的第三参考阈值，即与之间的差值是否小于预设的第三参考阈值，以及/＞与/＞或/＞之间的差值是否小于第四参考阈值，在满足上述条件时，可确定选取的像素点为划痕点。所述第三参考阈值和第四参考阈值可以通过经验设定。步骤160，返回选择所述塑形镜多曝光划痕图像中的一个像素点步骤，直至遍历完成所有像素点，根据划痕点的确定结果生成划痕前景图像。采用上述方法，依次遍历选取塑形镜多曝光划痕图像的每个像素点，将同时满足上述条件的像素点置为前景像素点，认为其很可能是潜在划痕；其余像素点置为背景。实现划痕图像的前后景分离。本实施例通过获取塑形镜多曝光划痕图像；选择所述塑形镜多曝光划痕图像中的一个像素点，并对所述像素点按照设定角度邻域生成参考线段，并计算每个参考线段的灰度值均值；在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别为存在的至少一条参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，所述平行辅助判断线段长度与对应的参考线段的长度相同；分别计算得到每条辅助判断线段的灰度值均值，判断每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值；在不小于设定的第二参考阈值时，计算两条辅助判断线段的灰度值均值差值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值；在所述两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定所述像素点为划痕点；返回选择所述塑形镜多曝光划痕图像中的一个像素点步骤，直至遍历完成所有像素点，根据划痕点的确定结果生成划痕前景图像。利用划痕图像的特点，通过设置参考线和辅助线，并对参考线和辅助线上的像素灰度值进行综合判断，可以准确的确定该像素点是否为划痕。利用上述方法，可准确的从塑形镜图像中准确提取到划痕前景图像。实施例二图2是本发明实施例二提供的塑形镜划痕前景图像提取方法的流程示意图，本实施例以上述实施例为基础进行优化，将所述获取塑形镜多曝光划痕图像，具体优化为： 对多张半光划痕的图像进行特征检测，得到每张多聚焦图像的特征描述子；根据所述每张多聚焦图像的特征描述子得到每张划痕图像的清晰度描述子；使用s×s的滑动窗口同时遍历每张划痕图像的相同区域，在其中一张划痕图像的滑动窗口内清晰度描述子之和大于其余任一划痕图像的清晰度描述子之和时，上调所述滑动窗口内所有像素点权重值；根据调整后的像素点权重值，确定图像中的清晰点、模糊点和不确定点；根据预设的清晰点、模糊点和不确定点的比例对多张划痕图像进行拼接，得到塑形镜多曝光划痕图像。参见图2，所述塑形镜划痕前景图像提取方法，包括：步骤210，对多张半光划痕的图像进行特征检测，得到每张多聚焦图像的特征描述子，根据所述每张多聚焦图像的特征描述子得到每张划痕图像的清晰度描述子。在本实施例中，考虑到塑形镜的曲面特性，因此，需要采集多张图像。在获取到多张角度不同的图像后，需要对其进行拼接，在本实施例中，采用Dense SIFT特征检测得到同一角膜塑形镜的每张多聚焦图像的特征描述子，利用描述子可体现图像中每个像素点周围的多维特征。在得到特征描述子后，可利用特征描述子计算得到每张划痕图像的清晰度描述子。示例性的，可选定一个窗口大小为，将窗口划分成/＞个单元，每个单元有k个梯度方向，如此便生成了/＞维的特征描述子。/＞维的特征描述子各维度求和取平均可以作为图像清晰度的描述。步骤220，使用s×s的滑动窗口同时遍历每张划痕图像的相同区域，在其中一张划痕图像的滑动窗口内清晰度描述子之和大于其余任一划痕图像的清晰度描述子之和时，上调所述滑动窗口内所有像素点权重值。示例性的，可先生成全0的两张权重图，大小与图像A,B相同。取大小为/＞的滑动窗口，在A,B中滑动窗口内的所有清晰度描述子之和分别记为。若/＞，则在/＞中对应窗口中的所有像素点权重+1，反之则/＞中对应窗口中的所有像素点权重+1。最终得到两幅完整的权重图，其各像素点的灰度值分别记为/＞，/＞，并根据下式赋予图像A,B最终权重：某像素点只有当中的值为s，/＞中的值为0时，才认为该像素点在图A是完全清晰的，赋予图A该点权重为1。同样的，只有当/＞中的值为0，中的值为s时，才认为该像素点在图A是完全模糊的，赋予图A该点权重为0。其它情况均认为该点处于清晰和模糊的过渡，赋予该点权重为0.5。对于每个像素点，将多张划痕图对应位置的像素点的灰度值按照归一化后的权重进行加权平均，得到的结果作为拼接后该像素点的灰度值。由此实现多聚焦划痕图像的融合，得到全局清晰的划痕图像。步骤230,根据调整后的像素点权重值，确定图像中的清晰点、模糊点和不确定点,根据预设的清晰点、模糊点和不确定点的比例对多张划痕图像进行拼接，得到塑形镜多曝光划痕图像。对于每个像素点，将多张划痕图对应位置的像素点的灰度值按照归一化后的权重进行加权平均，得到的结果作为拼接后该像素点的灰度值。由此实现多聚焦划痕图像的融合，得到全局清晰的划痕图像。步骤240,选择所述塑形镜多曝光划痕图像中的一个像素点，并对所述像素点按照设定角度邻域生成参考线段，并计算每个参考线段的灰度值均值。步骤250,在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别为存在的至少一条参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，所述平行辅助判断线段长度与对应的参考线段的长度相同。步骤260,分别计算得到每条辅助判断线段的灰度值均值，判断每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值；步骤270,在不小于设定的第二参考阈值时，计算两条辅助判断线段的灰度值均值差值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值；步骤280,在所述两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定所述像素点为划痕点；步骤290,返回选择所述塑形镜多曝光划痕图像中的一个像素点步骤，直至遍历完成所有像素点，根据划痕点的确定结果生成划痕前景图像。本实施例通过将所述获取塑形镜多曝光划痕图像，具体优化为： 对多张半光划痕的图像进行特征检测，得到每张多聚焦图像的特征描述子；根据所述每张多聚焦图像的特征描述子得到每张划痕图像的清晰度描述子；使用s×s的滑动窗口同时遍历每张划痕图像的相同区域，在其中一张划痕图像的滑动窗口内清晰度描述子之和大于其余任一划痕图像的清晰度描述子之和时，上调所述滑动窗口内所有像素点权重值；根据调整后的像素点权重值，确定图像中的清晰点、模糊点和不确定点；根据预设的清晰点、模糊点和不确定点的比例对多张划痕图像进行拼接，得到塑形镜多曝光划痕图像。利用上述方式，可保证多张划痕图像能够在充分保留清晰特征的情况下进行融合，有效提高了在不同照射角度下图像中划痕的特征。进一步提高了划痕前景图像提取的准确性。在本实施例的一个优选实施方式中，所述获取塑形镜多曝光划痕图像还可包括：将光阑作为载物台，将角膜塑形镜内表面朝上放置在光阑小孔处所述光阑仅有中心大小可调的小孔可透过光束，其余位置均不透光，且光阑小孔口径略小于角膜塑形镜直径；使用环形LED作为光源，以透射的方式进行照明，光阑中心为点O，点M、N分别为物镜和环形LED边缘上任意一点，OM与光轴夹角为，ON与光轴夹角为/＞，/＞；利用电机控制光阑台移动预设距离 ，得到多张清晰区域不同的多聚焦划痕图像。利用上述方式，可在不同角度得到充分体现划痕图像的塑形镜多曝光划痕图像。实施例三图3是本发明实施例三提供的塑形镜划痕前景图像提取方法的流程示意图，本实施例在上述实施例的基础上进行优化，具体的，所述方法还可增加如下步骤：对区分前景和后景的塑形镜多曝光划痕图像进行二值化转换，并利用FLD算法对二值化转换后的图像进行直线段检测，得到检测后的多个直线段；随机选取其中一个直线段，并计算与相邻直线段间的夹角θ、所述直线段中点到相邻直线段的距离d和所述直线段端点与所述相邻直线段间的最小距离g；在夹角θ小于预设的角度阈值，距离d小于预设的距离阈值，以及最小距离g小于预设的最小距离阈值时，则将所述直线段和所述相邻直线段设为同组直线段；返回随机选取其中一个直线段步骤，直至遍历完成所有直线段；根据分组设定划痕兴趣区域。参见图3，所述塑形镜划痕前景图像提取方法，包括：步骤310、获取塑形镜多曝光划痕图像，选择所述塑形镜多曝光划痕图像中的一个像素点，并对所述像素点按照设定角度邻域生成参考线段，并计算每个参考线段的灰度值均值；步骤320、在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别为存在的至少一条参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，所述平行辅助判断线段长度与对应的参考线段的长度相同。步骤330、分别计算得到每条辅助判断线段的灰度值均值，判断每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值。步骤340、在不小于设定的第二参考阈值时，计算两条辅助判断线段的灰度值均值差值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值。步骤350、在所述两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定所述像素点为划痕点。步骤360、返回选择所述塑形镜多曝光划痕图像中的一个像素点步骤，直至遍历完成所有像素点，根据划痕点的确定结果生成划痕前景图像。步骤370、对区分前景和后景的塑形镜多曝光划痕图像进行二值化转换，并利用FLD算法对二值化转换后的图像进行直线段检测，得到检测后的多个直线段。在得到划痕前景图像后，还需要对划痕图像进行处理，以得到完整的划痕供医生参考，评估塑形镜的使用性能。因此，首先需要对区分前景和后景的塑形镜多曝光划痕图像进行二值化转换，进一步增强前景和背景的区分特征。由于提取到的划痕前景图像仍然存在断续的可能，在进行二值化检测后，可利用FLD算法对二值化转换后的图像进行直线段检测，得到检测后的多个直线段。步骤380、随机选取其中一个直线段，并计算与相邻直线段间的夹角θ、所述直线段中点到相邻直线段的距离d和所述直线段端点与所述相邻直线段间的最小距离g；在夹角θ小于预设的角度阈值，距离d小于预设的距离阈值，以及最小距离g小于预设的最小距离阈值时，则将所述直线段和所述相邻直线段设为同组直线段。角膜塑形镜上的划痕种类大致如下类别：理想的长划痕、长划痕断裂为几段中等长度划痕、长划痕断裂为很多条短划痕、在长划痕周围引入了杂质作为干扰、在断点周围引入了杂质作为干扰。在断点周围引入了杂质作为干扰。因此，需要判断直线段是否为同一划痕造成。将得到的直线段进行分组。每组里面含有许多直线段，代表一根长划痕，它们可以是断裂的也可以是连续的。分组的依据有以下三点：线段间的夹角θ、一直线段中点到另一直线段的距离d、两线段断点距离最小值g。首先随机选择一条线段当作初始线段，标号组O。再遍历所有未分组线段，第N次遍历中所有同时满足下式的线段构成/＞，将/＞里的所有线段标号组N，并分别记为/＞,步骤390、返回随机选取其中一个直线段步骤，直至遍历完成所有直线段，根据分组设定划痕兴趣区域。重复上述遍历步骤，直到所有线段均有唯一的标号。注意第次遍历时/＞中的所有线段仅与刚进组的/＞判断上式中的条件，而并非与组内所有线段进行判断。并将同一分组的线段设定为一个划痕兴趣区域。本实施例通过增加如下步骤：对区分前景和后景的塑形镜多曝光划痕图像进行二值化转换，并利用FLD算法对二值化转换后的图像进行直线段检测，得到检测后的多个直线段；随机选取其中一个直线段，并计算与相邻直线段间的夹角θ、所述直线段中点到相邻直线段的距离d和所述直线段端点与所述相邻直线段间的最小距离g；在夹角θ小于预设的角度阈值，距离d小于预设的距离阈值，以及最小距离g小于预设的最小距离阈值时，则将所述直线段和所述相邻直线段设为同组直线段；返回随机选取其中一个直线段步骤，直至遍历完成所有直线段；根据分组设定划痕兴趣区域。可对划痕前景图像进一步处理，实现对划痕进行划分，以得到更多的划痕信息。在本实施例的一个优选实施方式中，所述方法还可增加如下步骤：在每个划痕兴趣区域内对区域内所有直线段，进行多项式拟合，得到拟合后的划痕；将拟合到的划痕图像划痕检测结果，并按照原始图像中对应位置的灰度值，在塑形镜多曝光划痕图像中标出。并可在所述得到拟合后的划痕之前，所述方法还可增加如下步骤：利用RANCAS算法对区域内的线段进行初步拟合，以去除外点的影响；相应的，并将所述在每个划痕兴趣区域内对区域内所有直线段，进行多项式拟合，具体优化为：在每个划痕兴趣区域内对区域内去除外点的所有直线段进行多项式拟合。对划痕兴趣区域进行RANSAC划痕拟合。对于数据点集P，随机选择一个含有n个点的子集，实例化模型/＞，计算出模型参数。随后从P中筛选出在一定误差范围e内满足模型/＞的点集/＞。若点集/＞中元素的数量大于阈值t，则使用/＞计算新的模型/＞。反之，则重新选择n个点的子集/＞，重复上述步骤。若循环N次后仍没有找到合适的子集S和对应的模型M，则模型失败。本文选用基于最小二乘法的多项式拟合作为初始模型，找到最佳子集/＞和最佳模型/＞。将/＞中的点按/＞画出，得到划痕拟合图。在得到划痕拟合图每条红线的像素点个数/＞之后，下式根据图像分辨率给出了划痕的相对长度/＞和划痕的覆盖率/＞。其中/＞为划痕的平均宽度。将拟合到的划痕作为最终检测结果，按照原始图像此处的灰度大小，在全局清晰的划痕图像中标出，以实现结果可视化。划痕越亮则表示划痕越深。通过上述方式，可在图像中得到可视化的划痕图像，并可确定划痕的深度、宽度等信息，便于医生评估划痕影响。实施例四图4是本发明实施例四提供的塑形镜划痕前景图像提取装置的结构示意图，参见图4，所述塑形镜划痕前景图像提取装置，包括：获取模块410，用于获取塑形镜多曝光划痕图像；选择模块420，用于选择所述塑形镜多曝光划痕图像中的一个像素点，并对所述像素点按照设定角度邻域生成参考线段，并计算每个参考线段的灰度值均值；建立模块430，用于在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别为存在的至少一条参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，所述平行辅助判断线段长度与对应的参考线段的长度相同；判断模块440，用于分别计算得到每条辅助判断线段的灰度值均值，判断每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值；计算模块450，用于在不小于设定的第二参考阈值时，计算两条辅助判断线段的灰度值均值差值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值；确定模块460，用于在所述两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定所述像素点为划痕点；生成模块470，用于返回选择所述塑形镜多曝光划痕图像中的一个像素点步骤，直至遍历完成所有像素点，根据划痕点的确定结果生成划痕前景图像。本实施例提供的塑形镜划痕前景图像提取装置，通过获取塑形镜多曝光划痕图像；选择所述塑形镜多曝光划痕图像中的一个像素点，并对所述像素点按照设定角度邻域生成参考线段，并计算每个参考线段的灰度值均值；在存在至少一条参考线段的灰度值均值不小于设定的第一参考阈值时，分别为存在的至少一条参考线段在其左右侧预设距离分别建立一条平行辅助判断线段，所述平行辅助判断线段长度与对应的参考线段的长度相同；分别计算得到每条辅助判断线段的灰度值均值，判断每条辅助判断线段的灰度值均值是否均不小于设定的第二参考阈值；在不小于设定的第二参考阈值时，计算两条辅助判断线段的灰度值均值差值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值；在所述两条辅助判断线段的灰度值均值差值小于预设的第三参考阈值，以及所述至少一条参考线段与每条辅助判断线段的灰度值均值的差值小于预设的第四参考阈值时，确定所述像素点为划痕点；返回选择所述塑形镜多曝光划痕图像中的一个像素点步骤，直至遍历完成所有像素点，根据划痕点的确定结果生成划痕前景图像。利用划痕图像的特点，通过设置参考线和辅助线，并对参考线和辅助线上的像素灰度值进行综合判断，可以准确的确定该像素点是否为划痕。利用上述方法，可准确的从塑形镜图像中准确提取到划痕前景图像。在上述各实施例的基础上，所述装置还包括：转换模块，用于对区分前景和后景的塑形镜多曝光划痕图像进行二值化转换，并利用FLD算法对二值化转换后的图像进行直线段检测，得到检测后的多个直线段；随机选取模块，用于随机选取其中一个直线段，并计算与相邻直线段间的夹角θ、所述直线段中点到相邻直线段的距离d和所述直线段端点与所述相邻直线段间的最小距离g；同组设置模块，用于在夹角θ小于预设的角度阈值，距离d小于预设的距离阈值，以及最小距离g小于预设的最小距离阈值时，则将所述直线段和所述相邻直线段设为同组直线段；遍历模块，用于返回随机选取其中一个直线段步骤，直至遍历完成所有直线段；设定模块，用于根据分组设定划痕兴趣区域。在上述各实施例的基础上，所述获取模块包括：特征检测单元，用于对多张半光划痕的图像进行特征检测，得到每张多聚焦图像的特征描述子；得到单元，用于根据所述每张多聚焦图像的特征描述子得到每张划痕图像的清晰度描述子；上调单元，用于使用s×s的滑动窗口同时遍历每张划痕图像的相同区域，在其中一张划痕图像的滑动窗口内清晰度描述子之和大于其余任一划痕图像的清晰度描述子之和时，上调所述滑动窗口内所有像素点权重值；确定单元，用于根据调整后的像素点权重值，确定图像中的清晰点、模糊点和不确定点；拼接单元，用于根据预设的清晰点、模糊点和不确定点的比例对多张划痕图像进行拼接，得到塑形镜多曝光划痕图像。在上述各实施例的基础上，所述获取模块还包括：放置单元，用于将光阑作为载物台，将角膜塑形镜内表面朝上放置在光阑小孔处所述光阑仅有中心大小可调的小孔可透过光束，其余位置均不透光，且光阑小孔口径略小于角膜塑形镜直径；照明单元，用于使用环形LED作为光源，以透射的方式进行照明，光阑中心为点O，点M、N分别为物镜和环形LED边缘上任意一点，OM与光轴夹角为，ON与光轴夹角为/＞，；移动单元，用于利用电机控制光阑台移动预设距离，得到多张清晰区域不同的多聚焦划痕图像。在上述各实施例的基础上，所述装置还包括：拟合模块，用于在每个划痕兴趣区域内对区域内所有直线段，进行多项式拟合，得到拟合后的划痕；标出模块，用于将拟合到的划痕图像划痕检测结果，并按照原始图像中对应位置的灰度值，在塑形镜多曝光划痕图像中标出。在上述各实施例的基础上，所述装置还包括：初步拟合模块，用于利用RANCAS算法对区域内的线段进行初步拟合，以去除外点的影响；相应的，所述拟合单元，用于在每个划痕兴趣区域内对区域内去除外点的所有直线段进行多项式拟合。本发明实施例所提供的塑形镜划痕前景图像提取装置可执行本发明任意实施例所提供的塑形镜划痕前景图像提取方法，具备执行方法相应的功能模块和有益效果。实施例五图5为本发明实施例五提供的一种设备的结构示意图。图3示出了适于用来实现本发明实施方式的示例性设备12的框图。图3显示的设备12仅仅是一个示例，不应对本发明实施例的功能和使用范围带来任何限制。如图3所示，设备12以通用计算终端的形式表现。设备12的组件可以包括但不限于：一个或者多个处理器或者处理单元16，系统存储器28，连接不同系统组件的总线18。总线18表示几类总线结构中的一种或多种，包括存储器总线或者存储器控制器，外围总线，图形加速端口，处理器或者使用多种总线结构中的任意总线结构的局域总线。举例来说，这些体系结构包括但不限于工业标准体系结构总线，微通道体系结构总线，增强型ISA总线、视频电子标准协会局域总线以及外围组件互连总线。设备12典型地包括多种计算机系统可读介质。这些介质可以是任何能够被设备12访问的可用介质，包括易失性和非易失性介质，可移动的和不可移动的介质。系统存储器28可以包括易失性存储器形式的计算机系统可读介质，例如随机存取存储器30和/或高速缓存32。设备12可以进一步包括其它可移动/不可移动的、易失性/非易失性计算机系统存储介质。仅作为举例，存储系统34可以用于读写不可移动的、非易失性磁介质。尽管图3中未示出，可以提供用于对可移动非易失性磁盘读写的磁盘驱动器，以及对可移动非易失性光盘读写的光盘驱动器。在这些情况下，每个驱动器可以通过一个或者多个数据介质接口与总线18相连。系统存储器28可以包括至少一个程序产品，该程序产品具有一组程序模块，这些程序模块被配置以执行本发明各实施例的功能。具有一组程序模块42的程序/实用工具40，可以存储在例如系统存储器28中，这样的程序模块42包括但不限于操作系统、一个或者多个应用程序、其它程序模块以及程序数据，这些示例中的每一个或某种组合中可能包括网络环境的实现。程序模块42通常执行本发明所描述的实施例中的功能和/或方法。设备12也可以与一个或多个外部终端14通信，还可与一个或者多个使得用户能与该设备12交互的终端通信，和/或与使得该设备12能与一个或多个其它计算终端进行通信的任何终端通信。这种通信可以通过输入/输出接口22进行。并且，设备12还可以通过网络适配器20与一个或者多个网络，广域网和/或公共网络，例如因特网）通信。如图所示，网络适配器20通过总线18与设备12的其它模块通信。应当明白，尽管图中未示出，可以结合设备12使用其它硬件和/或软件模块，包括但不限于：微代码、终端驱动器、冗余处理单元、外部磁盘驱动阵列、RAID系统、磁带驱动器以及数据备份存储系统等。处理单元16通过运行存储在系统存储器28中的程序，从而执行各种功能应用以及数据处理，例如实现本发明实施例所提供的塑形镜划痕前景图像提取方法。实施例六本发明实施例六还提供了一种包含计算机可执行指令的存储介质，所述计算机可执行指令在由计算机处理器执行时用于执行如上述实施例提供的任一所述的塑形镜划痕前景图像提取方法。本发明实施例的计算机存储介质，可以采用一个或多个计算机可读的介质的任意组合。计算机可读介质可以是计算机可读信号介质或者计算机可读存储介质。计算机可读存储介质例如可以是——但不限于——电、磁、光、电磁、红外线、或半导体的系统、装置或器件，或者任意以上的组合。计算机可读存储介质的更具体的例子包括：具有一个或多个导线的电连接、便携式计算机磁盘、硬盘、随机存取存储器、只读存储器、可擦式可编程只读存储器、光纤、便携式紧凑磁盘只读存储器、光存储器件、磁存储器件、或者上述的任意合适的组合。在本文件中，计算机可读存储介质可以是任何包含或存储程序的有形介质，该程序可以被指令执行系统、装置或者器件使用或者与其结合使用。计算机可读的信号介质可以包括在基带中或者作为载波一部分传播的数据信号，其中承载了计算机可读的程序代码。这种传播的数据信号可以采用多种形式，包括但不限于电磁信号、光信号或上述的任意合适的组合。计算机可读的信号介质还可以是计算机可读存储介质以外的任何计算机可读介质，该计算机可读介质可以发送、传播或者传输用于由指令执行系统、装置或者器件使用或者与其结合使用的程序。计算机可读介质上包含的程序代码可以用任何适当的介质传输，包括——但不限于无线、电线、光缆、RF等等，或者上述的任意合适的组合。可以以一种或多种程序设计语言或其组合来编写用于执行本发明操作的计算机程序代码，所述程序设计语言包括面向对象的程序设计语言—诸如Java、Smalltalk、C++，还包括常规的过程式程序设计语言—诸如“C”语言或类似的程序设计语言。程序代码可以完全地在用户计算机上执行、部分地在用户计算机上执行、作为一个独立的软件包执行、部分在用户计算机上部分在远程计算机上执行、或者完全在远程计算机或设备上执行。在涉及远程计算机的情形中，远程计算机可以通过任意种类的网络——包括局域网或广域网—连接到用户计算机，或者，可以连接到外部计算机。注意，上述仅为本发明的较佳实施例及所运用技术原理。本领域技术人员会理解，本发明不限于这里所述的特定实施例，对本领域技术人员来说能够进行各种明显的变化、重新调整和替代而不会脱离本发明的保护范围。因此，虽然通过以上实施例对本发明进行了较为详细的说明，但是本发明不仅仅限于以上实施例，在不脱离本发明构思的情况下，还可以包括更多其他等效实施例，而本发明的范围由所附的权利要求范围决定。
