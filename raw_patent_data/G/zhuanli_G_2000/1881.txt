标题title
基于临床多模态数据深度表示学习的合理用药判别方法
摘要abst
本发明提供一种基于临床多模态数据深度表示学习的合理用药判别方法，深度贯彻“人要找对药”以及“药要找对人”的原则，利用用药规则和患者病历信息进行向量的交叉匹配，并在交叉匹配的基础上各自进行决策树分类，进而求得相应的信息增益，并以信息增益作为权重指标进一步求得用药规则和患者病历的相应信息增益特征向量，由此将这两个特征向量在全连接层中进行分类预测，输出患者用药合理的概率值。
权利要求书clms
1.一种基于临床多模态数据深度表示学习的合理用药判别方法，其特征在于，将药品的用药规则通过BERT模型嵌入表示学习，输出合理用药规则向量；将患者的结构化电子病历数据与其文本描述进行匹配，形成完整病历文本描述，该完整病历文本描述利用BERT表示学习，输出患者病历向量；将所述合理用药规则向量和所述患者病历向量输入卷积神经网络进行匹配学习，输出适配合理用药规则向量和适配患者病历向量，其中，适配合理用药规则向量仅仅包含与所述完整病历文本描述相关的关联用药规则，所述关联用药规则和对应患者的标签信息整合后作为所述适配合理用药规则向量的向量特征，而适配患者病历向量仅仅包含与用药规则相关的关联病历信息，所述关联病历信息和对应的用药规则标签整合后作为适配患者病历向量的向量特征；以患者样本集合作为训练数据集，以适配合理用药规则向量中的所有向量特征作为特征集进行用药规则决策树分类，由此计算出在用药规则决策树下适配合理用药规则中的每个向量特征的信息增益，设定适配合理用药规则向量中的所有向量特征为e1、e2…ek，对应的信息增益为g1、g2…gk，由此计算出用药规则信息增益特征向量E，其每一个向量特征为E1、E2…Ek，其中，构建权重函数f，使得E1=f，E2=f…Ek=f；以用药规则集合作为训练数据集，以适配患者病历向量中的所有向量特征作为特征集进行患者病历特征决策树分类，由此计算出在患者病历特征决策树下适配患者病历特征向量中的每个向量特征的信息增益，设定适配患者病历特征向量中的所有向量特征为p1、p2…pn，对应的信息增益为h1、h2…hn，由此计算出患者病历信息增益特征向量P，其每一个向量特征为P1、P2…Pn，其中，构建权重函数F，使得P1=F，P2=F…Pn=F；将用药规则信息增益特征向量E和患者病历信息增益特征向量P进行匹配，组合成分类特征向量表示，将分类特征向量输入全连接层进行分类预测，由此输出患者用药是否合理的概率值。2.根据权利要求1所述的方法，其特征在于，所述用药规则包括推荐规则和禁忌规则。3.根据权利要求1所述的方法，其特征在于，所述用药规则决策树的经验熵计算公式为其中，K表示患者样本集合本身可分成的基础大类数量，D为训练数据集的样本总数，Ck为每个基础大类下对应的样本数，在适配合理用药规则向量中的所有向量特征作为特征集的所有向量特征中选定该决策树的根节点，为此引入经验条件熵，其计算公式为：其中，H表示在在特定的合理用药规则向量特征下的经验条件熵，最终呈现的等式右边中，Di表示该合理用药规则向量特征下分类出的患者样本数，Dik表示在根据特征A的分类下每一类的患者样本数，由此求出在特定的合理用药规则向量特征下的信息增益为：。4.根据权利要求2所述的方法，其特征在于，所述推荐规则包括用药推荐年龄段、用药间隔时长、单次用药量。5.根据权利要求2所述的方法，其特征在于，所述禁忌规则包括用药禁忌人群、用药慎用年龄段。6.根据权利要求1所述的方法，其特征在于，以患者样本集合作为训练数据集，以适配合理用药规则向量中的所有向量特征作为特征集进行用药规则决策树分类之前，患者样本集合分为“适合用药”与“不适合用药”两个基础大类，或者分为“适合用药”、“慎用药”与“不适合用药”三个基础大类。
说明书desc
技术领域本发明涉及一种基于临床多模态数据深度表示学习的合理用药判别方法。背景技术在医疗领域，为了确保患者得到适当的治疗，判别患者用药是否合理至关重要。为确保合理用药，一般需根据疾病种类、患者状况和药理学理论选择最佳的药物及其制剂。而当前判断用药时，仍然需要依靠人力来对用药指南和规则进行人工筛查，往往费时费力。因此，如何将这些用药指南和规则与现如今逐步电子化的患者病历数据进行正确匹配，是摆在医疗领域从业人员面前的重要课题。发明内容本发明提供一种基于临床多模态数据深度表示学习的合理用药判别方法，结合机器学习，有效地将用药指南和规则与现如今逐步电子化的患者病历数据进行正确匹配，解决了现有技术的上述缺陷。具体而言，本发明提供一种基于临床多模态数据深度表示学习的合理用药判别方法，将药品的用药规则通过BERT模型嵌入表示学习，输出合理用药规则向量；将患者的结构化电子病历数据与其文本描述进行匹配，形成完整病历文本描述，该完整病历文本描述利用BERT表示学习，输出患者病历向量；将所述合理用药规则向量和所述患者病历向量输入卷积神经网络进行匹配学习，输出适配合理用药规则向量和适配患者病历向量，其中，适配合理用药规则向量仅仅包含与所述完整病历文本描述相关的关联用药规则，所述关联用药规则和对应患者的标签信息整合后作为所述适配合理用药规则向量的向量特征，而适配患者病历向量仅仅包含与用药规则相关的关联病历信息，所述关联病历信息和对应的用药规则标签整合后作为适配患者病历向量的向量特征；以患者样本集合作为训练数据集，以适配合理用药规则向量中的所有向量特征作为特征集进行用药规则决策树分类，由此计算出在用药规则决策树下适配合理用药规则中的每个向量特征的信息增益，设定适配合理用药规则向量中的所有向量特征为e1、e2…ek，对应的信息增益为g1、g2…gk，由此计算出用药规则信息增益特征向量E，其每一个向量特征为E1、E2…Ek，其中，构建权重函数f，使得E1=f，E2=f…Ek=f；以用药规则集合作为训练数据集，以适配患者病历向量中的所有向量特征作为特征集进行患者病历特征决策树分类，由此计算出在患者病历特征决策树下适配患者病历特征向量中的每个向量特征的信息增益，设定适配患者病历特征向量中的所有向量特征为p1、p2…pn，对应的信息增益为h1、h2…hn，由此计算出患者病历信息增益特征向量P，其每一个向量特征为P1、P2…Pn，其中，构建权重函数F，使得P1=F，P2=F…Pn=F；将用药规则信息增益特征向量E和患者病历信息增益特征向量P进行匹配，组合成分类特征向量表示，将分类特征向量输入全连接层进行分类预测，由此输出患者用药是否合理的概率值。可选地，所述用药规则包括推荐规则和禁忌规则。优选地，所述用药规则决策树的经验熵计算公式为其中，K表示患者样本集合本身可分成的基础大类数量，D为训练数据集的样本总数，Ck为每个基础大类下对应的样本数，在适配合理用药规则向量中的所有向量特征作为特征集的所有向量特征中选定该决策树的根节点，为此引入经验条件熵，其计算公式为：其中，H表示在在特定的合理用药规则向量特征下的经验条件熵，最终呈现的等式右边中，Di表示该合理用药规则向量特征下分类出的患者样本数，Dik表示在根据特征A的分类下每一类的患者样本数，由此求出在特定的合理用药规则向量特征下的信息增益为：。可选地，所述推荐规则包括用药推荐年龄段、用药间隔时长、单次用药量。可选地，所述禁忌规则包括用药禁忌人群、用药慎用年龄段。优选地，以患者样本集合作为训练数据集，以适配合理用药规则向量中的所有向量特征作为特征集进行用药规则决策树分类之前，患者样本集合分为“适合用药”与“不适合用药”两个基础大类，或者分为“适合用药”、“慎用药”与“不适合用药”三个基础大类。如上，本发明提供一种基于临床多模态数据深度表示学习的合理用药判别方法，深度贯彻“人要找对药”以及“药要找对人”的原则，利用用药规则和患者病历信息进行向量的交叉匹配，并在交叉匹配的基础上各自进行决策树分类，进而求得相应的信息增益，并以信息增益作为权重指标进一步求得用药规则和患者病历的相应信息增益特征向量，由此将这两个特征向量在全连接层中进行分类预测，输出患者用药合理的概率值。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，以下将对实施例或现有技术描述中所需要使用的附图进行论述，显然，在结合附图进行描述的技术方案仅仅是本发明的一些实施例，对于本领域普通技术人员而言，在不付出创造性劳动的前提下，还可以根据这些附图所示实施例得到其它的实施例及其附图。图1示出了根据本发明的基于临床多模态数据深度表示学习的合理用药判别方法的全流程图。图2示例性示出了根据本发明的基于临床多模态数据深度表示学习的合理用药判别方法的基于患者群体为训练集之下的决策树案例。具体实施方式以下将结合附图对本发明各实施例的技术方案进行清楚完整描述，显然，所描述的实施例仅为本发明的一部分实施例，而不是全部实施例。基于本发明中所述的实施例，本领域普通技术人员在不需要创造性劳动的前提下所得到的所有其它实施例，都在本发明所保护的范围内。本发明所提供的基于临床多模态数据深度表示学习的合理用药判别方法，首先，将合理用药规则和患者病历信息通过卷积神经网络进行嵌入表示学习，输出相互适配的双向适配向量，随后，将双向适配向量各自进行决策树训练，由此取得适配向量中每个向量特征的信息增益权重，进而获取用药规则信息增益特征向量和患者病历信息增益特征向量，这两个向量进行匹配，由此输出患者用药是否合理的概率值。最后，还利用损失函数进行模型优化，损失函数包括三部分，分类损失、推荐规则相似性损失和禁忌规则相似性损失。下文中，将具体展开本发明的详细描述。本发明的宗旨在于，以机器学习为手段实现病患能找到合适的药物。这就需要考虑两个方向，即，药要找对人，人要找对药。在机器学习中就意味着合理用药规则向量与患者电子病历向量二者相互间要寻求一种合理的匹配机制，而要形成合理的匹配机制，首先即是需要关注于合理用药规则向量与患者电子病历向量这两个向量的正确建立。图1示出了根据本发明的基于临床多模态数据深度表示学习的合理用药判别方法的全流程图。首先分析用药规则，用药规则一般分为推荐规则和禁忌规则。推荐规则例如，用药推荐年龄段、用药间隔时长、单次用药量等等，禁忌规则例如，用药禁忌人群、用药慎用年龄段等等。在此将推荐规则和禁忌规则作为输入，通过BERT模型进行嵌入表示学习，输出合理用药规则向量。另一方面，则将每个患者的结构化电子病历数据与其文本描述进行匹配，形成完整病历文本描述。所述完整病历文本描述利用BERT进行表示学习，输出患者病历向量，其中包含结构化病历分向量和非结构化病历分向量。进一步，将针对药品的合理用药规则向量和针对患者的患者病历向量输入卷积神经网络进行匹配学习，由此可以输出适配特征向量，即，针对患者的适配合理用药规则向量以及针对药品的适配患者病历向量。具体而言，原有的合理用药规则向量针对的样本是药品本身，包含的信息为药品的多个推荐信息和禁忌信息，例如，用药推荐年龄段、用药慎用年龄段、用药间隔时长、用药禁忌人群等等。而针对患者的适配合理用药规则向量其中尽管包含的依然是用药规则信息，但针对的仅仅是与完整病历文本描述相关的关联用药规则，例如患者由于用药年龄段不合适而导致无法用药，则触发患者禁忌的关于年龄段限制的该条禁忌规则与患者信息标签整合后作为适配合理用药规则向量的一个向量特征。类似地，原有的患者病历向量针对的样本是患者本身，包含的信息囊括了患者在患病期间记录在电子病历中的信息，例如患者患病严重程度、患者服药历史、患者身份信息、患者年龄、患者性别等等。而针对药品的适配完整病历文本向量尽管包含的依然是患者病历信息，但针对的仅仅是与用药规则相关的病历信息，例如，患者由于孕妇身份而不得用药，导致不得用药的患者孕妇身份与该禁忌规则标签整合后作为适配患者病历向量的一个向量特征。接下来，基于CNN匹配学习所输出的针对患者的适配合理用药规则向量以及针对药品的适配患者病历向量，进行对象决策树交叉操作。换言之，通常的决策树决策都是以样本自带的样本特征进行决策树归类。然而，本发明则不同，其对象决策树交叉操作的意思是，以患者集为训练数据集时，并非以患者病历向量中自带的患者特征进行决策树分类，而是以用药规则进行决策树分类，以用药规则作为训练数据集时，则不以其原始的合理用药规则向量自带的用药规则特征进行决策树分类，而是以患者病历信息进行决策树分类。而前文通过CNN匹配学习所输出的针对患者的适配合理用药规则向量以及针对药品的适配患者病历向量，则为这种对象决策树交叉操作提供了基础。遵循“人要找对药”的原则，形成药品特征决策树归类。以患者集合作为训练数据集，以适配合理用药规则向量的所有向量特征作为特征集进行用药规则决策树分类。适配合理用药规则向量的所有向量特征中，推荐规则对于患者能否用药起到正向激励作用，而禁忌规则对于患者能否用药则起到负面限制作用。因此，根据推荐规则和禁忌规则，可以将药品特征决策树又分成药品特征正向决策树和药品特征负面决策树。药品特征决策树仍然以患者集合作为训练数据集，以适配合理用药规则向量中的所有向量特征作为特征集，由此进行药品特征决策树分类。如果不考虑决策树分类，则决策树经验熵计算公式为：在不考虑决策树分类的情况下，K=2，意思是所有患者可分为两大类，“适合用药”与“不适合用药”两个基础大类。当然，最终的结果分类也可将所有患者分为三个基础大类，即，“适合用药”、“慎用药”、“不适合用药”，如此一来K=3。其中的D为训练数据集的样本总数，也就是在本次决策树分类中所考察的患者总数，设定患者总数为10人。Ck为每个基础大类下对应的样本数，例如，适合用药的患者数为6人，不适合用药的患者数为4人，则C1=6，C2=4。图2示例性示出了根据本发明的基于临床多模态数据深度表示学习的合理用药判别方法的基于患者群体为训练集之下的决策树案例。可以看出，该决策树中，适合用药的人群最终为6人，而不适合用药的人群最终为4人。这其中，通过用药年龄段规则可淘汰不适合用药的人群2人，再通过用药禁忌人群规则可再淘汰不适合用药的人群2人。接下来要在特征集的所有向量特征中选定该决策树的根节点，为此引入经验条件熵，其计算公式为：其中，H表示在在特定的合理用药规则向量特征下的经验条件熵，最终呈现的等式右边中，Di表示该合理用药规则向量特征下分类出的患者样本数，Dik表示在根据特征A的分类下每一类的患者样本数。如此一来，就可以求出在特定的合理用药规则向量特征下的信息增益为：由此，针对合理用药规则向量中的每一个向量特征，均可以轮番尝试求得信息增益，并确定获得最大信息增益的向量特征作为该决策树的根节点特征。由此，该向量特征记为e1，对应的信息增益记为g1。接下来，以根节点为起始节点再进行预期分类。在根节点向量特征e1的基础上再进行二次分类，形成决策树的第二级散枝，由此，在合理用药规则向量中除e1之外的每一个向量特征均轮番尝试求得各自在e1作为条件向量之下的信息增益，并确定在e1之外的所有向量特征中最大的信息增益为g2，对应的向量特征为e2。随后，再以向量特征e2的基础上进行下一级分类，想成决策树的第三级散枝，由此，在合理用药规则向量中除e1、e2之外的每一个向量特征均轮番求得各自在e1、e2作为条件向量之下的信息增益，并确定在e1、e2之外的所有向量特征中最大的信息增益为g3，对应的向量特征为e3。以此类推，随着决策树最终分类完成，考察完毕适配合理用药规则向量e中的k个向量特征，按照决策树中信息增益从大到小依次排成e1、e2…ek，各自对应的k个信息增益为g1、g2…gk。根据实际情况，构建用药规则信息增益特征向量E，其中向量E中包含k个向量特征，其中第一个向量特征E1=f，其中，f为针对e1和g1构建的信息增益函数。根据实际情况，可以考虑f=e1*g1，或者f=e1*^2等等。以此类推，相应地，E2=f，直至Ek=f。由此就形成了用药规则信息增益特征向量E：E1、E2…Ek。该用药规则信息增益特征向量融合了用药规则的同时还融合了用药规则针对患者的信息增益，由此最大限度地将用药规则以及该规则在用药中的参与程度均囊括其中。上文中以患者集合作为训练数据集，以适配合理用药规则向量的所有向量特征作为特征集进行用药规则决策树分类。接下来，则以用药规则作为训练数据集，以适配患者病历向量中的所有向量特征为特征集，进行患者病历特征的决策树分类。在患者病历特征决策树下，类似于用药规则决策树的构建，最终考察完毕适配患者病历向量p中所有向量特征，按照决策树中信息增益从大到小依次排成p1、p2、p3…pn，各自对应的n个信息增益为h1、h2…hn。根据实际情况，构建患者病历信息增益特征向量P，其中向量P中包含n个向量特征，其中第一个向量特征P1=F，其中，F为针对p1和h1构建的信息增益函数。根据实际情况，可以考虑F=p1*h1，或者f=p1*^2等等。以此类推，相应地，P2=F，直至Pn=F。由此就形成了患者病历信息增益特征向量P：P1、P2…Pn。该患者病历信息增益特征向量融合了患者信息的同时还融合了患者信息针对药物使用的信息增益，由此最大限度地将患者信息以及患者信息对于用药状况的关联性均囊括其中。由此，原先获取的适配合理用药规则向量e和适配患者病历向量p就演变成了用药规则信息增益特征向量E和患者病历信息增益特征向量P。通过决策树信息增益的计算，对用药规则信息增益特征向量E和患者病历信息增益特征向量P中各向量的相关性进行了相关度排序，进而进行了信息交叉融合。一方面，本着“人要找对药”的考虑，用药规则针对患者集合作为训练数据集进行训练，由此就将患者信息融入到用药规则特征之中，形成用药规则信息增益特征向量E。另一方面，本着“药要找对人”的考虑，患者信息针对药品进行作为训练数据集进行训练，由此就将药品信息融入到患者信息之中，形成患者病历信息增益特征向量P。随后，将用药规则信息增益特征向量E和患者病历信息增益特征向量P进行匹配，组合成分类特征向量表示。将分类特征向量输入全连接层进行分类预测，由此输出患者用药是否合理的概率值y^, 在 之间。到此已经将本专利技术描述完毕。概括而言，本发明提供一种基于临床多模态数据深度表示学习的合理用药判别方法，深度贯彻“人要找对药”以及“药要找对人”的原则，利用用药规则和患者病历信息进行向量的交叉匹配，并在交叉匹配的基础上各自进行决策树分类，进而求得相应的信息增益，并以信息增益作为权重指标进一步求得用药规则和患者病历的相应信息增益特征向量，由此将这两个特征向量在全连接层中进行分类预测，输出患者用药合理的概率值。以上所述仅为本发明的示例性实施例而已，并不用以限制本发明，凡在本发明的精神和原则之内，所做的任何修改、等同替换、改进等，均应包含在本发明保护的范围之内。
