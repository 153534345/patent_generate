标题title
一种基于建筑草图轮廓序列的CAD矢量模型生成方法及装置
摘要abst
本发明涉及建筑模型生成技术领域，公开了一种基于建筑草图轮廓序列的CAD矢量模型生成方法及装置。所述基于建筑草图轮廓序列的CAD矢量模型生成方法包括：获取单体化建筑图像；对所述单体化建筑图像进行切片处理，从而获取多条轮廓图；获取经过训练的基于Transformer算法的模型；分别将每条轮廓图输入至所述基于Transformer算法的模型，从而获取每条轮廓图对应的经过校正的轮廓图；将各个经过校正的轮廓图通过提升拉伸方法重建模型。本申请的基于建筑草图轮廓序列的CAD矢量模型生成方法通过经过训练的基于Transformer算法的模型来获取矫正的轮廓图，通过神经网络端到端的执行，大数据驱动方式训练，极大提升了算法的鲁棒性。能生成高质量CAD级建筑模型，且可以参数编辑。
权利要求书clms
1.一种基于建筑草图轮廓序列的CAD矢量模型生成方法，其特征在于，所述基于建筑草图轮廓序列的CAD矢量模型生成方法包括：获取单体化建筑图像；对所述单体化建筑图像进行切片处理，从而获取多条轮廓图；获取经过训练的基于Transformer算法的模型；分别将每条轮廓图输入至所述基于Transformer算法的模型，从而获取每条轮廓图对应的经过校正的轮廓图；将各个经过校正的轮廓图通过提升拉伸方法重建模型。2.根据权利要求1所述的基于建筑草图轮廓序列的CAD矢量模型生成方法，其特征在于，所述获取单体化建筑图像包括：获取倾斜摄影图像信息；根据倾斜摄影图像信息获取单体化建筑图像。3.根据权利要求2所述的基于建筑草图轮廓序列的CAD矢量模型生成方法，其特征在于，所述分别将每条轮廓图输入至所述基于Transformer算法的模型，从而获取每条轮廓图对应的经过校正的轮廓图包括：为每条轮廓图进行如下操作：获取输入至所述基于Transformer算法的模型的轮廓图的融合编码特征；将所述融合编码特征输入至编码器中进行特征转换，从而获取转换特征；将转换特征输入至解码器中，从而获取该转换特征所对应的命令类型预测信息和命令参数信息；根据所述命令类型预测信息和命令参数信息生成经过校正的轮廓图。4.如权利要求3所述的基于建筑草图轮廓序列的CAD矢量模型生成方法，其特征在于，所述基于Transformer算法的模型在进行命令类型预测时，采用如下损失函数：，其中，表示样本i的真实标签、n为总的类别数。5.如权利要求4所述的基于建筑草图轮廓序列的CAD矢量模型生成方法，其特征在于，所述基于Transformer算法的模型在进行命令参数预测时，采用如下损失函数：，，其中，表示样本i的真实标签、/＞表示模型对于样本i的预测标签、S1和S2表示两组3D点云，表示S1中任意一点x到S2的最小距离之和；/＞表示S2中任意一点y到S1的最小距离之和。6.如权利要求3所述的基于建筑草图轮廓序列的CAD矢量模型生成方法，其特征在于，所述获取输入至所述基于Transformer算法的模型的轮廓图的融合编码特征包括：对轮廓图进行划分，划分为64个16×16大小的patch, 然后，对每个小的patch 进行特征编码得到第一特征；结合每个patch在图像中的相对空间位置信息，进行编码得到第二特征；将所述第一特征与第二特征进行融合，从而获取融合编码特征。7.如权利要求5所述的基于建筑草图轮廓序列的CAD矢量模型生成方法，其特征在于，所述命令类型包括直线类型、曲线类型、圆类型、点类型。8.一种基于建筑草图轮廓序列的CAD矢量模型生成装置，其特征在于，所述基于建筑草图轮廓序列的CAD矢量模型生成装置包括：单体化建筑图像获取模块，所述单体化建筑图像获取模块用于获取单体化建筑图像；轮廓图获取模块，所述轮廓图获取模块用于对所述单体化建筑图像进行切片处理，从而获取多条轮廓图；模型获取模块，所述模型获取模块用于获取经过训练的基于Transformer算法的模型；校正的轮廓图获取模块，所述校正的轮廓图获取模块用于分别将每条轮廓图输入至所述基于Transformer算法的模型，从而获取每条轮廓图对应的经过校正的轮廓图；模型重建模块，所述模型重建模块用于将各个经过校正的轮廓图通过提升拉伸方法重建模型。
说明书desc
技术领域本申请涉及建筑模型生成技术领域，尤其涉及一种基于建筑草图轮廓序列的CAD矢量模型生成方法以及基于建筑草图轮廓序列的CAD矢量模型生成装置。背景技术在数字孪生、游戏电影等诸多领域中，都需要大规模城市建筑的高质量建模。随着数据获取技术、计算能力以及三维重建算法的发展，人们可以通过图像或激光扫描序列重建出观测对象的表面三维结构，并通过稠密的点云或三角网格来表达。从离散、稠密的点云和三角网格表示的模型中抽取结构和拓扑信息，并将它们以更紧凑、简洁的形式呈现出来，是三维矢量化建模的核心问题。本质是回归出CAD级参数命令组合出的高质量三模型表达。当前针对图像三维重建模型的CAD矢量化建模需要大量的手工操作，建模成本巨大且效率很低，难以满足城市级规模场景矢量化建模的需求。因此，希望有一种技术方案来解决或至少减轻现有技术的上述不足。发明内容本发明的目的在于提供一种基于建筑草图轮廓序列的CAD矢量模型生成方法来至少解决上述的一个技术问题。本发明提供了下述方案：根据本发明的一个方面，提供一种基于建筑草图轮廓序列的CAD矢量模型生成方法，所述基于建筑草图轮廓序列的CAD矢量模型生成方法包括：获取单体化建筑图像；对所述单体化建筑图像进行切片处理，从而获取多条轮廓图；获取经过训练的基于Transformer算法的模型；分别将每条轮廓图输入至所述基于Transformer算法的模型，从而获取每条轮廓图对应的经过校正的轮廓图；将各个经过校正的轮廓图通过提升拉伸方法重建模型。可选地，所述获取单体化建筑图像包括：获取倾斜摄影图像信息；根据倾斜摄影图像信息获取单体化建筑图像。可选地，所述分别将每条轮廓图输入至所述基于Transformer算法的模型，从而获取每条轮廓图对应的经过校正的轮廓图包括：为每条轮廓图进行如下操作：获取输入至所述基于Transformer算法的模型的轮廓图的融合编码特征；将所述融合编码特征输入至编码器中进行特征转换，从而获取转换特征；将转换特征输入至解码器中，从而获取该转换特征所对应的命令类型预测信息和命令参数信息；根据所述命令类型预测信息和命令参数信息生成经过校正的轮廓图。可选地，所述基于Transformer算法的模型在进行命令类型预测时，采用如下损失函数：，其中，表示样本i的真实标签、n为总的类别数。可选地，所述基于Transformer算法的模型在进行命令参数预测时，采用如下损失函数：，，其中，表示样本i的真实标签、/＞表示模型对于样本i的预测标签、S1和S2表示两组3D点云，/＞表示S1中任意一点x到S2的最小距离之和；/＞表示S2中任意一点y到S1的最小距离之和。可选地，所述获取输入至所述基于Transformer算法的模型的轮廓图的融合编码特征包括：对轮廓图进行划分，划分为64个16×16大小的patch, 然后，对每个小的patch 进行特征编码得到第一特征；结合每个patch在图像中的相对空间位置信息，进行编码得到第二特征；将所述第一特征与第二特征进行融合，从而获取融合编码特征。可选地，所述命令类型包括直线类型、曲线类型、圆类型、点类型。本申请还提供了一种基于建筑草图轮廓序列的CAD矢量模型生成装置，所述基于建筑草图轮廓序列的CAD矢量模型生成装置包括：单体化建筑图像获取模块，所述单体化建筑图像获取模块用于获取单体化建筑图像；轮廓图获取模块，所述轮廓图获取模块用于对所述单体化建筑图像进行切片处理，从而获取多条轮廓图；模型获取模块，所述模型获取模块用于获取经过训练的基于Transformer算法的模型；校正的轮廓图获取模块，所述校正的轮廓图获取模块用于分别将每条轮廓图输入至所述基于Transformer算法的模型，从而获取每条轮廓图对应的经过校正的轮廓图；模型重建模块，所述模型重建模块用于将各个经过校正的轮廓图通过提升拉伸方法重建模型。本申请还提供了一种电子设备，所述电子设备包括：处理器、通信接口、存储器和通信总线，其中，处理器，通信接口，存储器通过通信总线完成相互间的通信；存储器中存储有计算机程序，当计算机程序被处理器执行时，使得处理器执行如上所述的基于建筑草图轮廓序列的CAD矢量模型生成方法的步骤。本申请还提供了一种计算机可读存储介质，所述计算机可读存储介质存储有可由电子设备执行的计算机程序，当计算机程序在电子设备上运行时，能够实现如上所述的基于建筑草图轮廓序列的CAD矢量模型生成方法的步骤。本申请的基于建筑草图轮廓序列的CAD矢量模型生成方法通过经过训练的基于Transformer算法的模型来获取矫正的轮廓图，通过神经网络端到端的执行，大数据驱动方式训练，极大提升了算法的鲁棒性。能生成高质量CAD级建筑模型，且可以参数编辑。附图说明图1是本申请一实施例中的基于建筑草图轮廓序列的CAD矢量模型生成方法的流程示意图；图2是本申请一个实施例提供的一种电子设备结构框图。具体实施方式下面将结合附图对本发明的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。图1是本申请一实施例中的基于建筑草图轮廓序列的CAD矢量模型生成方法的流程示意图。如图1所示的基于建筑草图轮廓序列的CAD矢量模型生成方法包括：步骤1：获取单体化建筑图像；步骤2：对所述单体化建筑图像进行切片处理，从而获取多条轮廓图；步骤3：获取经过训练的基于Transformer算法的模型；步骤4：分别将每条轮廓图输入至所述基于Transformer算法的模型，从而获取每条轮廓图对应的经过校正的轮廓图；步骤5：将各个经过校正的轮廓图通过提升拉伸方法重建模型。本申请的基于建筑草图轮廓序列的CAD矢量模型生成方法通过经过训练的基于Transformer算法的模型来获取矫正的轮廓图，通过神经网络端到端的执行，大数据驱动方式训练，极大提升了算法的鲁棒性。能生成高质量CAD级建筑模型，且可以参数编辑。在本实施例中，提升拉伸方法为现有技术，可以通过extrude函数进行，例如pyvista均具有该功能。在本实施例中，所述获取单体化建筑图像包括：获取倾斜摄影图像信息；根据倾斜摄影图像信息获取单体化建筑图像。在本实施例中，所述分别将每条轮廓图输入至所述基于Transformer算法的模型，从而获取每条轮廓图对应的经过校正的轮廓图包括：为每条轮廓图进行如下操作：获取输入至所述基于Transformer算法的模型的轮廓图的融合编码特征；将所述融合编码特征输入至编码器中进行特征转换，从而获取转换特征；将转换特征输入至解码器中，从而获取该转换特征所对应的命令类型预测信息和命令参数信息；根据所述命令类型预测信息和命令参数信息生成经过校正的轮廓图。在本实施例中，所述基于Transformer算法的模型在进行命令类型预测时，采用如下损失函数：，其中，表示样本i的真实标签、n为总的类别数。在本实施例中，所述基于Transformer算法的模型在进行命令参数预测时，采用如下损失函数：，，其中，表示样本i的真实标签、/＞表示模型对于样本i的预测标签、S1和S2表示两组3D点云，/＞表示S1中任意一点x到S2的最小距离之和；/＞表示S2中任意一点y到S1的最小距离之和。在本实施例中，所述获取输入至所述基于Transformer算法的模型的轮廓图的融合编码特征包括：对轮廓图进行划分，划分为64个16×16大小的patch, 然后，对每个小的patch进行特征编码得到第一特征；结合每个patch在图像中的相对空间位置信息，进行编码得到第二特征；将所述第一特征与第二特征进行融合，从而获取融合编码特征。在本实施例中，所述命令类型包括直线类型、曲线类型、圆类型、点类型。下面以举例的方式对本申请进行进一步详细阐述，可以理解的是，该举例并不构成对本申请的任何限制。获取单体化建筑图像；对所述单体化建筑图像进行切片处理，从而获取多条轮廓图；获取经过训练的基于Transformer算法的模型；分别将每条轮廓图输入至所述基于Transformer算法的模型，从而获取每条轮廓图对应的经过校正的轮廓图；将各个经过校正的轮廓图通过提升拉伸方法重建模型。在本实施例中，对所述单体化建筑图像进行切片处理，从而获取多条轮廓图具体为：通过pyvista切片命令切割建筑ply模型。输出多条轮廓图。在本实施例中，经过训练的基于Transformer算法的模型用于对轮廓图进行命令类型预测和命令参数推断。在本实施例中，基于Transformer算法的模型具体使用方法如下：1，首先，对每张轮廓图，划分为64个16×16大小的patch，然后，对每个小的patch进行特征编码为256维度的特征；2，同时，结合每个patch在图像中的相对空间位置信息，进行编码为256维的特征；3，将两种编码特征相加，输入至标准的Transformer encoder中；4，利用transformer中的 self-attention机制，特征变换，从而获取转换特征；5，我们提出一种可学习的区域CAD命令查询特征编码机制，该编码可以有效的将输入图像整体，学习划分为不同的区域l在PPT中200，即为我们设定的一个超参数，假设每张切片中最多存在200条CAD命令集。其本质上，就是对图像中200个区域进行查询，是否每个区域中存在一条有效的CAD命令；若存在，这条CAD命令的类型是什么类型；这条CAD命令的参数是多少。6，将上述两种特征，输入至decoder中，以根据输入图像整体特征信息，针对每个待查询区域，进行解析、判断，是否该查询区域存在CAD命令；若存在，该CAD命令是什么类型，以及相应的CAD命令参数。7，针对上述任务，Loss损失函数的设计，7.1，本质上，我们不可能每个查询区域都存在一条CAD命令；假设输入切片中真实存在K个CAD命令，而我们查询预测出了200个CAD命令；因此，使用 匈牙利匹配算法，对两个集合进行匹配，针对GT CAD命令集，从预测命令集中 找出一组总匹配损失 最小的预测CAD命令子集；7.2，然后，可以对从200个预测命令集中，挑选出来的K个预测CAD命令，用K个GTCAD命令进行类别以及参数的 监督数据，进行训练；7.3，类别的训练，就用的是交叉熵损失；对单个样本，假设真实分布为，网络输出分布为/＞，总的类别数为n，则在这种情况下，交叉熵损失函数的计算方法为：，其中，表示样本i的真实标签、n为总的类别数。命令参数的训练，用的是L1损失；；其中，表示样本i的真实标签、/＞表示模型对于样本i的预测标签。同时，针对CAD命令的特殊性，设计了loss，称之为“贴合度loss”，这个loss设计的目的，主要是每一个CAD命令的预测，都是预测了类别，以及相应的参数，但这些参数，我们在监督训练的时候，都是孤立监督的，比如，直线，有两个点，即四个数字，需要进行监督训练，但一旦有一个数字预测的比较差，就全盘皆输的局面，这主要就是因为参数之间的关系并没有考虑进去，因此，我们还专门设计这样一个损失函数：针对回归预测的参数，我们结合这条命令本身的GT类型，就可以对其进行采样；同时，我们对这条命令对应的GT命令，也可以把相应的类型以及参数，联合起来，进行采样；然后这两个采样点集利用倒角距离来度量这两个采样点集之间的贴合度，以此设计了这个“贴合度loss”：；其中，S1和S2表示两组3D点云表示S1中任意一点x到S2的最小距离之和；/＞表示S2中任意一点y到S1的最小距离之和。如果该举例较大，则说明两组点云区别较大；如果举例较小，则说明重建效果较好。也可替代为：预测点云上到原始点云最短距离小于0.3的点个数占整个点个数的比例作为分数。以达到针对每条命令中所有参数联合估计的目的，而不是一条命令参数，都只是孤立的对每个参数，单独进行回归学习。这样做的优点：可以有效的进行联合学习，可以有效的抑制，单独学习，所带来的“一颗老鼠屎，坏掉锅汤”的这种不利局面。数据集介绍：通过参数建模系统生成千万级数据对。本方案把建筑矢量化建模转化为CAD命令集预测任务。通过神经网络端到端的执行，大数据驱动方式训练，极大提升了算法的鲁棒性。能生成高质量CAD级建筑模型，且可以参数编辑。本申请还提供了一种基于建筑草图轮廓序列的CAD矢量模型生成装置，所述基于建筑草图轮廓序列的CAD矢量模型生成装置包括单体化建筑图像获取模块、轮廓图获取模块、模型获取模块、校正的轮廓图获取模块以及模型重建模块，其中，单体化建筑图像获取模块用于获取单体化建筑图像；轮廓图获取模块用于对所述单体化建筑图像进行切片处理，从而获取多条轮廓图；模型获取模块用于获取经过训练的基于Transformer算法的模型；校正的轮廓图获取模块用于分别将每条轮廓图输入至所述基于Transformer算法的模型，从而获取每条轮廓图对应的经过校正的轮廓图；模型重建模块用于将各个经过校正的轮廓图通过提升拉伸方法重建模型。图2是本发明一个或多个实施例提供的一种客户端结构框图。如图2所示，本申请还公开了一种电子设备，包括：处理器、通信接口、存储器和通信总线，其中，处理器，通信接口，存储器通过通信总线完成相互间的通信；存储器中存储有计算机程序，当计算机程序被处理器执行时，使得处理器执行基于建筑草图轮廓序列的CAD矢量模型生成方法的步骤。本申请还提供了一种计算机可读存储介质，其存储有可由电子设备执行的计算机程序，当计算机程序在电子设备上运行时，能够实现基于建筑草图轮廓序列的CAD矢量模型生成方法的步骤。上述电子设备提到的通信总线可以是外设部件互连标准总线或扩展工业标准结构总线等。该通信总线可以分为地址总线、数据总线、控制总线等。为便于表示，图中仅用一条粗线表示，但并不表示仅有一根总线或一种类型的总线。电子设备包括硬件层，运行在硬件层之上的操作系统层，以及运行在操作系统上的应用层。该硬件层包括中央处理器、内存管理单元和内存等硬件。该操作系统可以是任意一种或多种通过进程实现电子设备控制的计算机操作系统，例如，Linux操作系统、Unix操作系统、Android操作系统、iOS操作系统或windows操作系统等。并且在本发明实施例中该电子设备可以是智能手机、平板电脑等手持设备，也可以是桌面计算机、便携式计算机等电子设备，本发明实施例中并未特别限定。本发明实施例中的电子设备控制的执行主体可以是电子设备，或者是电子设备中能够调用程序并执行程序的功能模块。电子设备可以获取到存储介质对应的固件，存储介质对应的固件由供应商提供，不同存储介质对应的固件可以相同可以不同，在此不做限定。电子设备获取到存储介质对应的固件后，可以将该存储介质对应的固件写入存储介质中，具体地是往该存储介质中烧入该存储介质对应固件。将固件烧入存储介质的过程可以采用现有技术实现，在本发明实施例中不做赘述。电子设备还可以获取到存储介质对应的重置命令，存储介质对应的重置命令由供应商提供，不同存储介质对应的重置命令可以相同可以不同，在此不做限定。此时电子设备的存储介质为写入了对应的固件的存储介质，电子设备可以在写入了对应的固件的存储介质中响应该存储介质对应的重置命令，从而电子设备根据存储介质对应的重置命令，对该写入对应的固件的存储介质进行重置。根据重置命令对存储介质进行重置的过程可以现有技术实现，在本发明实施例中不做赘述。为了描述的方便，描述以上装置时以功能分为各种单元、模块分别描述。当然在实施本申请时可以把各单元、模块的功能在同一个或多个软件和/或硬件中实现。本技术领域技术人员可以理解，除非另外定义，这里使用的所有术语，具有与本发明所属领域中的普通技术人员的一般理解相同的意义。还应该理解的是，诸如通用字典中定义的那些术语，应该被理解为具有与现有技术的上下文中的意义一致的意义，并且除非被特定定义，否则不会用理想化或过于正式的含义来解释。对于方法实施例，为了简单描述，故将其都表述为一系列的动作组合，但是本领域技术人员应该知悉，本发明实施例并不受所描述的动作顺序的限制，因为依据本发明实施例，某些步骤可以采用其他顺序或者同时进行。其次，本领域技术人员也应该知悉，说明书中所描述的实施例均属于优选实施例，所涉及的动作并不一定是本发明实施例所必须的。通过以上的实施方式的描述可知，本领域的技术人员可以清楚地了解到本申请可借助软件加必需的通用硬件平台的方式来实现。基于这样的理解，本申请的技术方案本质上或者说对现有技术做出贡献的部分可以以软件产品的形式体现出来，该计算机软件产品可以存储在存储介质中，如ROM/RAM、磁碟、光盘等，包括若干指令用以使得一台计算机设备执行本申请各个实施方式或者实施方式的某些部分所述的方法。最后应说明的是：以上各实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述各实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分或者全部技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的范围。
