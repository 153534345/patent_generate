标题title
基于目标跟踪和异常检测的实时跨镜追踪方法
摘要abst
本发明涉及一种基于目标跟踪和异常检测的实时跨镜追踪方法。该方法首先使用YOLOv3目标检测算法对视频图像帧进行检测判定，对被搜索视频图像帧的第一帧进行处理以生成初始边界框。然后使用Re3目标追踪算法来识别图像序列，接着使用DOC异常检测算法来选择每组图像序列的最佳图像代表，最后使用SiamIDL方法对此代表图像进行经典Re‑ID检测。本方法可以同时减小图库的大小并提高其图像质量，显著提高了实时Re‑ID的检测效率。
权利要求书clms
1.基于目标跟踪和异常检测的实时跨镜追踪方法，其特征是，包括以下步骤：S1、将原始视频流分解，生成一组可能含有同一个人的连续图像序列；S2、对图像序列中各幅图像中的行人进行判定，以判断各幅图像中是否存在目标人员，若当前图像中存在目标人员，则将该幅图像标记为有效图像；S3、在各个有效图像中的框选目标人员，生成图像边界框序列，将所有带边界框的图像以列表形式输出为一组轨迹图像片段列表，并将所有完整片段进行保存；S4、使用DOC的异常检测模块对轨迹片段进行分析，对于每张图像异常检测模块可生成一个分数，该分数用于评价与正常图像的接近程度，越接近分数越高，然后使用这个分数来选择图像序列的最佳图像，最佳图像即得分最高的图像；为每个图像序列选择一个最佳的代表图像放入图像搜索库，供后续检测；S5、最佳代表图像进行分析，计算查询该图像中目标人员与图库图像中目标人员之间的相似度得分，输出检测结论。2.根据权利要求1所述的基于目标跟踪和异常检测的实时跨镜追踪方法，其特征是：步骤S2中利用YOLOv3目标检测模块对被搜索的图像序列的第一幅图像进行处理以生成初始边界框，初始边界框用于初始化目标跟踪器，判定有效的图像进入目标追踪模块继续分析，否则目标检测模块继续对下一幅图像进行判定。3.根据权利要求1所述基于目标跟踪和异常检测的实时跨镜追踪方法，其特征是：步骤S3中使用Re3算法的目标追踪模块在有效图像中运行以生成图像边界框序列，然后将结果以列表形式输出为一组轨迹图像片段列表，并将所有完整片段进行保存。4.根据权利要求1所述基于目标跟踪和异常检测的实时跨镜追踪方法，其特征是，在步骤S1中：将原始视频流分解，生成图像序列；依次对图像序列中的每一幅图像进行识别和判断，以判断各幅图像中是否存在行人，若存在行人则提取其识别特征；将存在行人的所有图像从图像序列中分离出来，并根据各个行人的识别特征将存在该行人的图像归集从而得到各个行人的样本图像序列，不存在该行人的图像则不归集。5.根据权利要求4所述基于目标跟踪和异常检测的实时跨镜追踪方法，其特征是：步骤中对分解得到的图像序列中的各个图像中人体特征进行识别，以判断各个图像中是否存在行人；若存在行人则对各个行人的识别特征进行提取，若能够识别到行人的人脸，则提取其面部特征和步态特征，若不能识别到行人的人脸，则提取其背面形体特征和步态特征；若本组图像序列中不存在行人，则对下一组图像序列进行判定。6.根据权利要求5所述基于目标跟踪和异常检测的实时跨镜追踪方法，其特征是：步骤中在归集图像时根据面部特征识别同一行人，根据背面形体特征识别同一行人，再将背朝摄像头的行人的步态特征与面朝摄像头的行人的步态特征进行比对，若步态特征一致，则认为该行人为同一行人，从而将同一行人的正面图像和背面图像归集在一起。7.根据权利要求5所述基于目标跟踪和异常检测的实时跨镜追踪方法，其特征是：所述背面形体特征包括头部宽度与肩部宽度的比值。8.根据权利要求5所述基于目标跟踪和异常检测的实时跨镜追踪方法，其特征是：所述步态特征包括行人头部中心与肩部中心的距离和行走时头顶起伏距离的比值以及行走起伏周期。
说明书desc
技术领域本发明涉及计算机视觉图像处理技术领域，具体涉及一种基于目标跟踪和异常检测的实时跨镜追踪方法。背景技术跨镜追踪是行人重识别技术的通俗说法。具体指的是一种利用计算机视觉方法判断连续图像序列或者视频中是否存在目标人员的技术，该技术可以快速判断和分析该目标是否在多个摄像机镜头画面中出现，同时记录下出现的时间和位置信息。目前已经广泛地应用于安全事件检测、公安办案取证、以及对特定目标人员进行追踪等场景。一个典型的实时Re-ID系统由两个主要模块组成：图库生成器——它提取目标人员的边界框来组成图像库；经典Re-ID模块——用于从图库中的裁剪图像中进行识别查询。然而，目前的实时Re-ID方法存在两个缺陷：通常生成的图库过大，资源消耗严重。图库生成时容易产生大量质量较差的图像，且由此产生的小错误会对检测结果产生较大影响。发明内容基于上述表述，本发明提供了一种基于目标跟踪和异常检测的实时跨镜追踪方法，可以减小图库的大小并提高其图像质量，还能提高实时Re-ID的检测效率。本发明解决上述技术问题的技术方案如下：基于目标跟踪和异常检测的实时跨镜追踪方法，包括以下步骤：S1、将原始视频流分解，生成一组可能含有同一个人的连续图像序列；S2、对图像序列中各幅图像中的行人进行判定，以判断各幅图像中是否存在目标人员，若当前图像中存在目标人员，则将该幅图像标记为有效图像；S3、在各个有效图像中的框选目标人员，生成图像边界框序列，将所有带边界框的图像以列表形式输出为一组轨迹图像片段列表，并将所有完整片段进行保存；S4、对轨迹片段进行分析，为每个图像序列选择一个最佳的代表图像放入图像搜索库；S5、最佳代表图像进行分析，计算查询该图像中目标人员与图库图像中目标人员之间的相似度得分，输出检测结论。作为优选方案：步骤S2中利用YOLOv3目标检测模块对被搜索的图像序列的第一幅图像进行处理以生成初始边界框，初始边界框用于初始化目标跟踪器，判定有效的图像进入目标追踪模块继续分析，否则目标检测模块继续对下一幅图像进行判定。作为优选方案：步骤S3中使用Re3算法的目标追踪模块在有效图像中运行以生成图像边界框序列，然后将结果以列表形式输出为一组轨迹图像片段列表，并将所有完整片段进行保存。作为优选方案：步骤S4中异常检测模块中，使用DOC的异常检测模块对轨迹片段进行分析，为每个图像序列选择一个最佳的代表图像放入图像搜索库，供后续Re-ID模块进行检测。作为优选方案，在步骤S1中：将原始视频流分解，生成图像序列；依次对图像序列中的每一幅图像进行识别和判断，以判断各幅图像中是否存在行人，若存在行人则提取其识别特征；将存在行人的所有图像从图像序列中分离出来，并根据各个行人的识别特征将存在该行人的图像归集从而得到各个行人的样本图像序列，不存在该行人的图像则不归集。作为优选方案：步骤中对分解得到的图像序列中的各个图像中人体特征进行识别，以判断各个图像中是否存在行人；若存在行人则对各个行人的识别特征进行提取，若能够识别到行人的人脸，则提取其面部特征和步态特征，若不能识别到行人的人脸，则提取其背面形体特征和步态特征；若本组图像序列中不存在行人，则对下一组图像序列进行判定。作为优选方案：步骤中在归集图像时根据面部特征识别同一行人，根据背面形体特征识别同一行人，再将背朝摄像头的行人的步态特征与面朝摄像头的行人的步态特征进行比对，若步态特征一致，则认为该行人为同一行人，从而将同一行人的正面图像和背面图像归集在一起。作为优选方案：所述背面形体特征包括头部宽度与肩部宽度的比值。作为优选方案：所述步态特征包括行人头部中心与肩部中心的距离和行走时头顶起伏距离的比值以及行走起伏周期。与现有技术相比，本申请的技术方案具有以下有益技术效果：该方法首先使用YOLOv3目标检测算法对视频图像帧进行检测判定，对被搜索视频图像帧的第一帧进行处理以生成初始边界框。然后使用Re3目标追踪算法来识别图像序列，接着使用DOC异常检测算法来选择每组图像序列的最佳图像代表，最后使用SiamIDL方法对此代表图像进行经典Re-ID检测。本方法可以同时减小图库的大小并提高其图像质量，显著提高了实时Re-ID的检测效率。附图说明图1为实施例一中的方法流程示意图；图2为实施例二中的行人背面示意图。具体实施方式参照图1，一种基于目标跟踪和异常检测的实时跨镜追踪方法，包括以下步骤：步骤一、将原始视频流分解，生成一组可能包含同一行人的连续图像序列。图像序列即按一定的时间间隔从视频流中分离出各个视频帧采集得到的图像集合，图像序列中的图片可以是10张、20张等，视具体需求而定。本实施例中可以采用人工来对图像序列中的视频帧进行模糊判断，目的是判断这一组图像序列中是否包含同一行人。步骤二、对图像序列中各幅图像中的行人进行判定，以判断图像中是否存在目标人员，若当前图像中存在目标人员，则将该图像标记为有效图像。本实施例中采用YOLOv3行人检测模型对图像序列中的行人进行判定。YOLOv3行人检测模型的作用是从图像中寻找预定义的类别，并从诸多候选目标中定位目标对象。本方法中使用TensorFlow中提出的带有Darknet-53的预训练YOLOv3模型，其具备多尺度预测能力，它可以检测到小物体。本实施例中，先是对YOLOv3行人检测模型进行预定义，将模型检测的类别定义为目标人员，将前述连续图像序列中的各幅图像输入到YOLOv3行人检测模型，YOLOv3行人检测模型搜索各幅图像的行人并对各幅图像中的行人进行识别，以检测各幅图像中是否存在目标人员。若图像中存在目标人员，则将该图像标记为有效图像，否则YOLOv3行人检测模型继续对下一幅图像进行判定，经过若干次迭代后，YOLOv3行人检测模型会将所有判定有效的图像选出。YOLOv3行人检测模型对第一幅有效图像中的目标人员进行框选以生成初始边界框，初始边界框用于初始化目标跟踪模型。YOLO模型被称为统一检测器或单阶段检测器，它可直接预测完整图像的边界框和分类概率，并通过卷积神经网络进行单向传递。所有版本的YOLO都将图像划分为网格并预测边界框的位置，每个网格都具有类概率和相关的置信度分数。步骤三、在有效图像中框选目标人员，生成图像边界框序列，将所有带边界框的图像以列表形式输出为一组轨迹图像片段列表，并将所有完整片段进行保存。本实施例中用到了使用Re3算法的目标追踪模型。本方法中使用了R3算法，这是一种精确的通用目标跟踪算法。Re3算法使用卷积层来嵌入目标的外形，循环层来回忆目标的外形和运动，回归层来输出对象的位置。Re3算法初始时需要被跟踪的目标周围的边界框，并在后续帧中产生边界框。本步骤中利用前述初始边界框完成Re3目标追踪模型的初始化，在后续的有效图像中运行Re3目标追踪模型可以自动生成图像边界框序列。然后将Re3目标追踪模型锚定的一组带边框的轨迹图像以列表形式输出为一组轨迹图像片段列表，并将所有完整片段进行保存。步骤四、对轨迹图像片段进行分析，为每个图像序列选择一个最佳的代表图像放入图像搜索库，供后续检测。本实施例中使用了异常检测模型来对轨迹图像片段进行分析。本实施例中的异常检测模型基于DOC的异常检测方法。DOC异常检测方法是以CUHK03数据集的图像作为目标类，VOC 2012数据集的图像作为异常值训练DOC异常检测模型。DOC异常检测模型的特征提取器的主干是在ImageNet上预训练的Inception ResNetV2。DOC异常检测模型的能够识别出与常规值偏离比较明显的数据。我们将DOC方法用于异常检测，因为正常的数据服从高斯分布，而异常的数据不服从高斯分布，那么模型训练的目标就是准确表征“正常”，与模型偏差较大的即异常点。我们只采用正常的数据做训练，那么衡量对象与正常数据的差距，可以将这个过程看成一个单分类问题One-Class Classification。所以DOC异常检测模型是一个单类别分类器，经过训练可以区分Re-ID的好图像和坏图像。对于每张图像，DOC方法可生成一个分数，表示其对Re-ID的适合度。该步骤中，在轨迹图片片段的每一张图像中运行异常检测模块，异常检测模块会对每一张图像产生一个分数，然后使用这个分数来选择图像序列的最佳图像，即得分最高的图像。步骤五、对于最佳图像进行分析，计算最佳图像与图库图像之间的相似度得分，得到检测结论。本步骤中在查询指令开始前，先输入一张确定是目标人员的图片，以此为检测参考，然后开始查询动作，使用SiamIDL的经典Re-ID方法对最佳代表图像进行分析，计算查询图像与图库图像之间的相似度得分，输出检测结论。通过上述方案可以减小图库的大小并提高其图像质量，显著提高实时Re-ID的检测效率。效果验证：评价指标说明为了评估TrADe Re-ID在实时PRID数据集上的性能，我们使用了下列评价指标：指标1、查找成功率。表示当提出查询请求后能正确返回的短视频的比例。当查询经常失败时，就会出现低FR。指标2、真实结果验证率。表示发出警报的比例，查询就在呈现的候选对象中。当监测人员经常受到不合理的干扰时，就会出现低TVR。指标3、平均精度，该指标通过计算TVR与FR曲线下的面积来定义。指标4、FR和TVR的最优F1分数F1*。这里的分数计算方法与机器学习算法中常用的精度和召回率的F分数计算类似。区别在于这里F1*表示最优的F1分数，该值使得实时Re-ID流程能够完美地工作。实验结果说明基于实时prid数据集实验结果如下表。可以看到，相比于仅使用经典的Re-ID方法，本方法能够减小图库体量的优点产生了明显的性能提升。我们还可以看到，本方法的表现几乎总是比仅用SiamIDL时好。这意味着使用异常检测模块选择最佳的图像来表示图像序列对于实时Re-ID来说有明显成效。总的来说，这些结果证实，本方法是解决实时Re-ID问题，优化其性能的一种可行方法。实施例二本实施例与实施例一的区别在于步骤S1的实现方式不同。确切来讲，本实施例中判断一组图像序列中是否包含同一行人是借助自动化程序判断的，而非借助人工进行模糊判断。人工判断不仅工作量大，而且由于人工判断一般是通过面部特征来识别各个行人的，当图像中的行人比较密集、流动性大、且行人出现转身时，人工是经常会丢失同一行人的。这就导致人工模糊判断得到可能包含同一行人的图像序列经常会丢失很多关键图像。本实施例中，在步骤S1中：将原始视频流分解，生成图像序列。依次对图像序列中的每一幅图像进行识别和判断，以判断各幅图像中是否存在行人，若存在行人则提取其识别特征。将存在行人的所有图像从图像序列中分离出来，并根据各个行人的识别特征将存在该行人的图像归集从而得到各个行人的样本图像序列，不存在该行人的图像则不归集。后续可以将各个行人的样本图像序列输入到YOLOv3行人检测模型中进行判定，以判断各段样本图像序列中的行人是否为目标人员。具体的，步骤中对分解得到的图像序列中的各个图像中人体特征进行识别，以判断各个图像中是否存在行人，若存在行人则对各个行人的识别特征进行提取，若能够识别到行人的人脸，则提取其面部特征和步态特征，若不能识别到行人的人脸，则提取其背面形体特征和步态特征。若本组图像序列中不存在行人，则对下一组图像序列进行判定。由上述描述可知，本实施例中行人的识别特征包括面部特征、背面形体特征和步态特征。参照图2，本实施例中的背面形体特征包括头部宽度W1与肩部宽度W2的比值K；步态特征包括行人头部中心O1与肩部中心O2的距离和行走时头顶起伏距离的比值P以及行走起伏周期T。人行走时身高会有起伏，由于每个人都有自己的走路动作习惯且每个人的身体比例是唯一的。所以对于同一行人，其头部中心O1与肩部中心O2的距离和行走时身高起伏距离的比值P、以及一个起伏周期T的时长基本是固定不变的。由于在视频画面中，随着行人与摄像头的距离发生改变，真实的头部宽度、肩部宽度、头肩中心点距离和身高起伏量是很难测准的；但是对于同一行人，其在连续的视频帧中的K值、P值和T值固定的，因此在连续的视频画面中可以将行走时的K值、P值和T值作为识别同一行人的手段。规定每个像素点的长宽均为单位1。对于背朝摄像头的行人，当第一次识别到该行人时可以对其头部进行识别，识别到头部后提取头部轮廓，在头部覆盖的区域中选取横向跨度最大的一行像素点，扫描该行像素点得到该行像素点数量n1；同理，对该行人的肩部进行识别，识别到肩部后提取肩部轮廓，在肩部覆盖的区域中选取横向跨度最大的一行像素点，扫描该行像素点得到该行像素点数量n2。假设行人的头部宽度为W1、肩部宽度为W2，则可以认为W1/W2=n1/n2，即K= n1/n2。同时选取头部横向虚线的中点O1，并选取肩部横向虚线的中点O2，根据O1和O2的像素点坐标计算得出O1和O2的像素距离，即X个像素点。在连续几帧画面中都对O1的坐标进行定位，得出O1在竖直方向上的最大位移，即在竖直方向的像素点跨度；例如O1在竖直方向上的最大像素点跨度为S个像素点，假设行人的头部中心与肩部中心的距离为L1、行人行走的身高起伏距离为L2，则可以认为P=L1/L2=X/S。在连续几帧画面中，获取O1在相邻两次移动至最高位置时的时间点t1和t2，则T=t2-t1。通过上述手段可以获得视频图像中各个行人的K值、P值和T值。将视频流分解成连续的图像序列后，通过对各幅图像中的人体特征进行识别，将存在行人的所有图像从该图像序列中分离出来，再对分离出的所有图像中的各个行人的识别特征进行提取。对于所有行人，若能提取到其面部特征则同时提取其步态特征；对于所有行人，若能提取到其背面形体特征则同时提取其步态特征。步骤中，在归集图像时根据面部特征识别同一行人，根据背面形体特征识别同一行人，再将背朝摄像头的行人的步态特征与面朝摄像头的行人的步态特征进行比对，若步态特征一致，则认为该行人为同一行人，从而将同一行人的正面图像和背面图像归集在一起。再将背朝摄像头的行人的步态特征与面朝摄像头的行人的步态特征进行比对，若步态特征一致，则认为该行人为同一行人。结合面部特征、背面形体特征和步态特征中和判断，针对各个行人将包含该行人的所有图像按照时间线归集从而得到该行人的样本图像序列。如此可以得到各个行人的所有图像，不易出现漏判的情况，使获得的图像序列包含各个行人更全的信息量。后续将获得的样本图像序列输入到行人检测模型中后，可以更有利于行人检测模型判断该样本图像序列中的行人是否为目标人员，实现更好的跨镜追踪效果。通过上述手段实际上是以每个行人为单位，自动从原始图像序列中分离归集包含该行人的图像作为样本图像序列；通过上述手段生成的图像序列具针对性且更准确，改变了传统通过人工判断的方式，可以提高作业效率，降低人工工作量且不会出现漏判的情况。本实施例中，为了进一步提高后续行人检测模块对样本图像序列中行人的识别效率，可以采取以下措施：将样本图像序列输入到行人检测模型之前，从样本图像序列中抽取包含有该行人面部特征的一幅图像，将该图像作为样本图像序列的第一幅图像，从而得到新的样本图像序列。再将新的样本图像序列输入至行人检测模型中进行检测识别。如此将样本图像序列输入到行人检测模型后，行人检测模型可以在对第一幅图像识别时就能识别到该行人的最明显识别特征，可以第一时间判断出该行人是否为模型中预定义的目标人员。以上所述仅为本发明的较佳实施例，并不用以限制本发明，凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
