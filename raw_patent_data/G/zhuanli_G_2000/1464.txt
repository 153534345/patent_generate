标题title
基于高位视频的泊位异常订单处理方法和系统
摘要abst
本发明公开了一种基于高位视频的泊位异常订单处理方法，包括基于高位视频设备上传的入场事件和出场事件进行异常订单识别，并将与入场事件中的泊位信息关联的未结束订单设置为缺少出场记录的异常订单，将与无法与待出场订单匹配的出场事件设置为缺少入场记录的异常订单；然后，在存储的多个场景照片中，为所述缺少出场记录的异常订单选取出场事件照片，为所述缺少入场记录的异常订单选取入场事件照片；由此，可以基于泊位状态变化快速发现异常订单，同时通过为异常订单选取缺失的场景照片，补足其缺失的入场信息或出场信息，进而提供一个闭环的可供使用的异常订单处理方法，避免由于缺失入场信息或出场信息导致的系统异常。
权利要求书clms
1.一种基于高位视频的泊位异常订单处理方法，其特征在于，包括以下步骤：通过监听高位视频设备的实时视频，获取多个场景照片并生成入场事件和出场事件；接收并存储高位视频设备上传的所述入场事件、所述出场事件和所述场景照片；为所述入场事件创建待出场订单；根据所述入场事件中的泊位信息，查找是否存在关联的未结束订单，如果存在则将所述未结束订单设置为缺少出场记录的异常订单；根据所述出场事件中的泊位信息和车牌信息，查找是否存在匹配的待出场订单，如果不存在则为所述出场事件创建缺少入场记录的异常订单；在所述多个场景照片中，为所述缺少出场记录的异常订单和所述缺少入场记录的异常订单分别选取出场事件照片和入场事件照片。2.如权利要求1所述的基于高位视频的泊位异常订单处理方法，其特征在于，接收并存储场景照片的步骤包括：接收来自所述高位视频设备的场景照片；查询所述高位视频设备的已存储的场景照片的最大资源递增值N，其中，在所述最大资源递增值N小于可存储照片最大值时，为接收的场景照片分配照片ID为设备ID_N+1，在所述最大资源递增值N大于或等于可存储照片最大值时，为接收的场景照片分配照片ID为设备ID_0；利用分配的所述照片ID将上传的场景照片存储到对应位置。3.如权利要求1所述的基于高位视频的泊位异常订单处理方法，其特征在于，所述场景照片包括定时场景照片和变化场景照片，通过监听高位视频设备的实时视频，拍摄场景照片的步骤包括：监听视频帧信息，当收到新的视频帧时，判断当前视频帧中的泊位状态占用情况和上一视频帧中的泊位状态占用情况是否相同；在当前视频帧中的泊位状态占用情况和上一视频帧中的泊位状态占用情况相同时，判断当前视频帧的时间和上一张场景照片的时间的间隔是否大于第一预设间隔，其中，第一预设间隔为泊位未发生变化时的最小拍照间隔，如果是，则拍摄定时场景照片；在当前视频帧中的泊位状态占用情况和上一视频帧中的泊位状态占用情况不同时，判断当前视频帧的时间和上一张场景照片的时间的间隔是否大于第二预设间隔，其中，第二预设间隔为泊位发生变化时的最小拍照间隔，如果是，则拍摄变化场景照片。4.如权利要求3所述的基于高位视频的泊位异常订单处理方法，其特征在于，还包括：遍历所有未结束订单；判断是否存在与当前遍历的未结束订单的订单创建时间的间隔大于预设值的场景照片，如果存在，则判断当前遍历的未结束订单对应的泊位在最新的场景照片中的占用状态是否为空，如果为空，则将当前遍历的未结束订单设置为缺少出场记录的异常订单；在多个场景照片中，为所述缺少出场记录的异常订单选取出场事件照片。5.如权利要求1或4所述的基于高位视频的泊位异常订单处理方法，其特征在于，在多个场景照片中，为所述缺少出场记录的异常订单选取出场事件照片的步骤包括：获取所述缺少出场记录的异常订单的入场记录时间和泊位信息；升序遍历大于所述入场记录时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则将这两张场景照片选为所述缺少出场记录的异常订单的出场事件照片。6.如权利要求1所述的基于高位视频的泊位异常订单处理方法，其特征在于，在所述多个场景照片中，为所述缺少入场记录的异常订单选取入场事件照片的步骤包括：获取所述缺少入场记录的异常订单的出场时间和泊位信息；降序遍历小于所述出场时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则选取这两张照片为入场事件照片。7.一种基于高位视频的泊位异常订单处理系统，其特征在于，包括：数据接收存储模块，用于接收并存储高位视频设备上传的入场事件、出场事件和场景照片；订单创建模块，用于为所述入场事件创建待出场订单；异常订单识别模块，用于根据所述入场事件中的泊位信息，查找是否存在关联的未结束订单，如果存在则将所述未结束订单设置为缺少出场记录的异常订单，还用于根据所述出场事件中的泊位信息和车牌信息，查找是否存在匹配的待出场订单，如果不存在则为所述出场事件创建缺少入场记录的异常订单；异常订单处理模块，用于在所述多个场景照片中，为所述缺少出场记录的异常订单和所述缺少入场记录的异常订单分别选取出场事件照片和入场事件照片。8.如权利要求7所述的基于高位视频的泊位异常订单处理系统，其特征在于，所述异常订单识别模块还用于遍历所有未结束订单，判断是否存在与当前遍历的未结束订单的订单创建时间的间隔大于预设值的场景照片，如果存在，则判断当前遍历的未结束订单对应的泊位在最新的场景照片中的占用状态是否为空，如果为空，则将当前遍历的未结束订单设置为缺少出场记录的异常订单。9.如权利要求7所述的基于高位视频的泊位异常订单处理系统，其特征在于，所述异常订单处理模块用于获取所述缺少入场记录的异常订单的出场时间和泊位信息，降序遍历小于所述出场时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则选取这两张照片为入场事件照片；还用于获取所述缺少出场记录的异常订单的入场记录时间和泊位信息，升序遍历大于所述入场记录时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则将这两张场景照片选为所述缺少出场记录的异常订单的出场事件照片。10.一种基于高位视频的泊位异常订单处理装置，其特征在于，包括处理器和存储器，所述存储器存储有计算机程序，所述计算机程序被处理器执行时实现如权利要求1至6中任一项的基于高位视频的泊位异常订单处理方法的步骤。
说明书desc
技术领域本发明涉及智慧停车技术领域，尤其涉及一种基于高位视频的泊位异常订单处理方法和系统。背景技术智慧停车是智能化城市建设中重要的一环，充分利用城市道路的路内停车是实现智慧停车的重要组成部分。通过实时监测路面上的车辆停放状况，可以对车辆进行收费管理。但是现有的路边停车收费管理系统，由于环境和其他一些异常情况容易导致产生一些错漏，发生入场信息丢失或出场信息丢失的情况。而缺失入场和出场信息会导致收费系统无法形成完整的订单链，影响系统的正常运行。因此，需要及时发现并处理这些异常订单以保证收费系统的正常运行。发明内容本发明的主要目的在于提供一种基于高位视频的泊位异常订单处理方法和系统。为实现上述目的，本发明提供一种基于高位视频的泊位异常订单处理方法，包括以下步骤：通过监听高位视频设备的实时视频，获取多个场景照片并生成入场事件和出场事件；接收并存储高位视频设备上传的所述入场事件、所述出场事件和所述场景照片；为所述入场事件创建待出场订单；根据所述入场事件中的泊位信息，查找是否存在关联的未结束订单，如果存在则将所述未结束订单设置为缺少出场记录的异常订单；根据所述出场事件中的泊位信息和车牌信息，查找是否存在匹配的待出场订单，如果不存在则为所述出场事件创建缺少入场记录的异常订单；在所述多个场景照片中，为所述缺少出场记录的异常订单和所述缺少入场记录的异常订单分别选取出场事件照片和入场事件照片。在本发明提供的基于高位视频的泊位异常订单处理方法中，接收并存储场景照片的步骤包括：接收来自所述高位视频设备的场景照片；查询所述高位视频设备的已存储的场景照片的最大资源递增值N，其中，在所述最大资源递增值N小于可存储照片最大值时，为接收的场景照片分配照片ID为设备ID_N+1，在所述最大资源递增值N大于或等于可存储照片最大值时，为接收的场景照片分配照片ID为设备ID_0；利用分配的所述照片ID将上传的场景照片存储到对应位置。在本发明提供的基于高位视频的泊位异常订单处理方法中，所述场景照片包括定时场景照片和变化场景照片，通过监听高位视频设备的实时视频，拍摄场景照片的步骤包括：监听视频帧信息，当收到新的视频帧时，判断当前视频帧中的泊位状态占用情况和上一视频帧中的泊位状态占用情况是否相同；在当前视频帧中的泊位状态占用情况和上一视频帧中的泊位状态占用情况相同时，判断当前视频帧的时间和上一张场景照片的时间的间隔是否大于第一预设间隔，其中，第一预设间隔为泊位未发生变化时的最小拍照间隔，如果是，则拍摄定时场景照片；在当前视频帧中的泊位状态占用情况和上一视频帧中的泊位状态占用情况不同时，判断当前视频帧的时间和上一张场景照片的时间的间隔是否大于第二预设间隔，其中，第二预设间隔为泊位发生变化时的最小拍照间隔，如果是，则拍摄变化场景照片。在本发明提供的基于高位视频的泊位异常订单处理方法中，还包括：遍历所有未结束订单；判断是否存在与当前遍历的未结束订单的订单创建时间的间隔大于预设值的场景照片，如果存在，则判断当前遍历的未结束订单对应的泊位在最新的场景照片中的占用状态是否为空，如果为空，则将当前遍历的未结束订单设置为缺少出场记录的异常订单；在多个场景照片中，为所述缺少出场记录的异常订单选取入场事件照片。在本发明提供的基于高位视频的泊位异常订单处理方法中，在所述多个场景照片中，为所述缺少入场记录的异常订单选取入场事件照片的步骤包括：获取所述缺少入场记录的异常订单的出场时间和泊位信息；降序遍历小于所述出场时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则选取这两张照片为入场事件照片。在本发明提供的基于高位视频的泊位异常订单处理方法中，在所述多个场景照片中，为所述缺少出场记录的异常订单选取出场事件照片的步骤包括：获取所述缺少出场记录的异常订单的入场记录时间和泊位信息；升序遍历大于所述入场记录时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则将这两张场景照片选为所述缺少出场记录的异常订单的出场事件照片。此外，为实现上述目的，本发明还提供一种基于高位视频的泊位异常订单处理系统，包括：数据接收存储模块，用于接收并存储高位视频设备上传的入场事件、出场事件和场景照片；订单创建模块，用于为所述入场事件创建待出场订单；异常订单识别模块，用于根据所述入场事件中的泊位信息，查找是否存在关联的未结束订单，如果存在则将所述未结束订单设置为缺少出场记录的异常订单，还用于根据所述出场事件中的泊位信息和车牌信息，查找是否存在匹配的待出场订单，如果不存在则为所述出场事件创建缺少入场记录的异常订单；异常订单处理模块，用于在所述多个场景照片中，为所述缺少出场记录的异常订单和所述缺少入场记录的异常订单分别选取出场事件照片和入场事件照片。在本发明提供的基于高位视频的泊位异常订单处理系统中，所述异常订单识别模块还用于遍历所有未结束订单，判断是否存在与当前遍历的未结束订单的订单创建时间的间隔大于预设值的场景照片，如果存在，则判断当前遍历的未结束订单对应的泊位在最新的场景照片中的占用状态是否为空，如果为空，则将当前遍历的未结束订单设置为缺少出场记录的异常订单片。在本发明提供的基于高位视频的泊位异常订单处理系统中，所述异常订单处理模块用于获取所述缺少入场记录的异常订单的出场时间和泊位信息，降序遍历小于所述出场时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则选取这两张照片为入场事件照片；还用于获取所述缺少出场记录的异常订单的入场记录时间和泊位信息，升序遍历大于所述入场记录时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则将这两张场景照片选为所述缺少出场记录的异常订单的出场事件照片。本发明还提供一种基于高位视频的泊位异常订单处理装置，包括处理器和存储器，所述存储器存储有计算机程序，所述计算机程序被处理器执行时实现如上所述的基于高位视频的泊位异常订单处理方法的步骤。本发明提供的基于高位视频的泊位异常订单处理系统和方法具有以下有益效果：本发明基于高位视频设备上传的入场事件和出场事件进行异常订单识别，并将与入场事件中的泊位信息关联的未结束订单设置为缺少出场记录的异常订单，将与无法与待出场订单匹配的出场事件设置为缺少入场记录的异常订单；然后，在存储的多个场景照片中，为所述缺少出场记录的异常订单选取出场事件照片，为所述缺少入场记录的异常订单选取入场事件照片；由此，可以基于泊位状态变化快速发现异常订单，同时通过为异常订单选取缺失的场景照片，补足其缺失的入场信息或出场信息，进而提供一个闭环的可供使用的异常订单处理方法，避免由于缺失入场信息或出场信息导致的系统异常。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据提供的附图获得其他的附图：图1所示为本发明一实施例提供的基于高位视频的泊位异常订单处理方法的流程图。具体实施方式为了便于理解本发明，下面将参照相关附图对本发明进行更全面的描述。附图中给出了本发明的典型实施例。但是，本发明可以以许多不同的形式来实现，并不限于本文所描述的实施例。相反地，提供这些实施例的目的是使对本发明的公开内容更加透彻全面。除非另有定义，本文所使用的所有的技术和科学术语与属于本发明的技术领域的技术人员通常理解的含义相同。本文中在本发明的说明书中所使用的术语只是为了描述具体的实施例的目的，不是旨在于限制本发明。本发明总的思路是：针对现有技术中由于环境和其他一些异常情况导致缺失入场和出场信息引起的收费系统无法形成完整的订单链的问题，本发明基于高位视频设备上传的入场事件和出场事件进行异常订单识别，并将与入场事件中的泊位信息关联的未结束订单设置为缺少出场记录的异常订单，将与无法与待出场订单匹配的出场事件设置为缺少入场记录的异常订单；然后，在存储的多个场景照片中，为所述缺少出场记录的异常订单选取出场事件照片，为所述缺少入场记录的异常订单选取入场事件照片；由此，可以基于泊位状态变化快速发现异常订单，同时通过为异常订单选取缺失的场景照片，补足其缺失的入场信息或出场信息，进而提供一个闭环的可供使用的异常订单处理方法，避免由于缺失入场信息或出场信息导致的系统异常。为了更好的理解上述技术方案，下面将结合说明书附图以及具体的实施方式对上述技术方案进行详细的说明，应当理解本发明实施例以及实施例中的具体特征是对本申请技术方案的详细的说明，而不是对本申请技术方案的限定，在不冲突的情况下，本发明实施例以及实施例中的技术特征可以相互组合。图1所示为本发明一实施例提供的基于高位视频的泊位异常订单处理方法的流程图。如图1所示，该基于高位视频的泊位异常订单处理方法包括以下步骤：步骤S1、通过监听高位视频设备的实时视频，获取多个场景照片并生成入场事件和出场事件；具体地，在本发明一实施例中，通过一个高位视频设备监控多个泊位的停车状况，根据高位视频设备的实时视频，可以得到其监控范围内的泊位的入场事件和出场事件。其中，入场事件是指有车辆驶入某个泊位，车辆驶入泊位代表需要开始计费，因此，在通过视频监控到有车辆驶入泊位时，需要向后台发送入场事件以触发订单生成；出场事件是指有车辆驶出某个泊位，车辆驶出泊位表示需要结束计费，因此，在通过视频监控到车辆驶出泊位时，需要向后台发送出场事件以触发订单结束。其中，通过监控视频生成入场事件和出场事件为本领域现有技术，本发明在此不再赘述。具体地，在本发明一实施例中，为了后续将异常订单补充完整，形成一个闭环的订单链条，还需要通过监控高空视频设备的实时视频来获取场景照片。其中，场景照片包括定时场景照片和变化场景照片。变化场景照片是指在两次拍摄间隔中泊位状态发生变化的情况下所拍摄的场景照片，例如，时刻t1拍摄了一张场景照片，如果泊位状态一直变化，即此时可能正在发生车辆入场或出场事件，如果发生变化即拍摄一张照片上传存储会造成资源浪费，因此在经过泊位发生变化时的最小拍照间隔T1后，拍摄一张场景照片来反映泊位的状态变化，这张照片即为变化场景照片。定时场景照片是指在两次拍摄间隔中泊位状态未发生变化的情况下所拍摄的场景照片，例如，时刻t2拍摄了一张场景照片，如果泊位状态一直不发生变化，为了避免遗漏，那么经过泊位未发生变化时的最小拍照间隔T2后，需要拍摄一张场景照片，这张照片即为定时场景照片，此照片与t2时刻拍摄的场景照片完全相同。泊位未发生变化时的最小拍照间隔T2大于泊位发生变化时的最小拍照间隔T1，如果泊位状态变化频繁，那么可以采用较小的T1，以获得更准确的变化场景照片；而如果泊位状态相对稳定，可以适当延长T2，以减少资源消耗。由此，通过变化场景照片准确反映监控泊位的状态变化，通过定时场景照片来确保系统的准确性和稳定性；通过设定合适的拍照间隔，不仅可以避免资源浪费，同时也保证了对泊位状态变化的敏感度。因此，通过监听高位视频设备的实时视频，拍摄场景照片的步骤包括：步骤1：监听视频帧信息，当收到新的视频帧时进行到步骤2。步骤2：判断是否有拍摄过场景照片，如果当前未拍摄过任何场景照片，执行步骤6，否则执行步骤3。步骤3：判断当前帧中泊位状态占用情况和上一帧中的占用情况是否相同，如果不相同执行步骤5，否则执行步骤4。步骤4：判断当前视频帧时间和上一次场景照片时间的间隔是否大于T2，大于T2时执行步骤6，小于T2时跳转步骤1。步骤5：判断当前视频帧时间和上一次场景照片时间的间隔是否大于T1，大于T1时继续执行步骤6，小于T1时跳转步骤1。步骤6：拍摄场景照片，并记录场景照片中的车辆检检测框和泊位状态信息。重复执行步骤1。步骤S2、接收并存储高位视频设备上传的所述入场事件、所述出场事件和所述场景照片；具体地，在本发明一实施例中，后台在收到高位视频设备上传的场景照片时，对所有场景照片通过循环链表的分配图片Key。在存储场景照片的数据库中，为每个高位视频设备分配一个存储空间，即设备1、设备2、设备3...；每个存储空间又分为多个存储单元，1、2、3....Max，其中，存储单元的最大存储值Max为D1*24*60/T1。在接收到来自高位视频设备x的场景照片时，首先，查询根据在高位视频设备x的存储空间中已存储的场景照片的最大资源递增值N；然后比较N与Max，如果N小于Max，那么说明高位视频设备x存储空间并未存满，为接收的场景照片分配照片ID为设备ID_N+1；如果N大于等于Max，那么说明高位视频设备x存储空间已满，为接收的场景照片分配照片ID为设备ID_N+1，为接收的场景照片分配照片ID为设备ID_0；然后，利用分配的照片ID将上传的场景照片存储到对应位置。使用循环链表的方式生产图片资源Key，利用相同Key会覆盖的特性可以免去已过时照片的清理工作，提升系统性能。因此，接收并存储场景照片的步骤包括：步骤1：接收设备场景照片，判断是否是该设备第一张照片，如果是第一张照片则设置当前设备资源递增值N为0，否则查询当前设备资源的递增值N；步骤2：在N小于Max时，设置图片资源Key为设备ID_N+1；在N大于或等于Max时，设置图片资源Key为设备ID_0；步骤3：将图片基础信息记录的ID设置为Key，并存储至数据库；并以资源Key上传图片至对象存储。步骤S3、为所述入场事件创建待出场订单；具体地，在本发明一实施例中，在收到来自高位视频设备的入场事件时，首先为该入场事件创建一个入场订单，即为其创造一个待出场订单，在待出场订单中包含了泊位信息、车牌信息、入场时间以及一张关联的场景照片作为入场事件照片。步骤S4、根据所述入场事件中的泊位信息，查找是否存在关联的未结束订单，如果存在则将所述未结束订单设置为缺少出场记录的异常订单；具体地，在本发明一实施例中，在收到入场事件并为其创建了一个待出场订单后，根据入场事件中的泊位信息在系统的未结束订单中进行搜寻，如果在未结束订单中查找到与该入场事件的泊位信息关联的订单，则说明该未结束订单有异常，即其车辆已经驶出但系统未记录下其驶出的信息导致订单无法结束，因此，将其标记为缺少出场记录的异常订单。通过标记异常订单，系统可以在后续的处理中对其进行特殊处理，例如通知相关人员或自动触发补录出场记录的操作，以确保订单的完整性和准确性。由此，在收到入场事件后，系统通过搜索未结束订单并标记缺少出场记录的异常订单，可以有效地发现并处理系统中存在的订单异常情况，提高系统的可靠性和精确性。步骤S5、根据所述出场事件中的泊位信息和车牌信息，查找是否存在匹配的待出场订单，如果不存在则为所述出场事件创建缺少入场记录的异常订单；具体地，在本发明一实施例中，在收到出场事件后，根据出场事件携带的泊位信息和车牌信息，在未结束的待出场订单中查找是否有与其匹配的订单，如果没有与其匹配的订单，则说明该出场事件对应的车辆在入场时没有被记录到，即在入场时没有为其建立一个入场订单导致此时无法获取到其入场信息造成异常，因此，将其标记为缺少入场记录的异常订单。通过标记异常订单，系统可以在后续处理中对其进行特殊处理，例如通知相关人员或自动触发补录入场记录的操作，以确保订单的完整性和准确性。总之，通过在收到出场事件时搜索未结束订单并标记缺少入场记录的异常订单，可以有效地识别并处理系统中存在的订单异常情况，提高系统的可靠性和精确性。步骤S6、在所述多个场景照片中，为所述缺少出场记录的异常订单和所述缺少入场记录的异常订单分别选取出场事件照片和入场事件照片。具体地，在本发明一实施例中，在初步标记了异常订单之后，需要对异常订单进行信息补录，以保证订单的完整性。在本发明中，利用高位视频设备定时上传的场景照片来对异常订单进行进一步处理，即为缺少出场记录的异常订单根据该未结束订单包含的泊位信息和入场时间为其在关联的场景照片中选择一张出场照片，为缺少入场记录的异常订单根据出场事件包含的泊位信息和出场时间为其在关联的场景照片中选择一张入场照片，以形成一个完整的订单链条，保证系统正常运行。因此，步骤S6包括：获取所述缺少入场记录的异常订单的出场时间和泊位信息；降序遍历小于所述出场时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则选取这两张照片为入场事件照片；获取所述缺少出场记录的异常订单的入场记录时间和泊位信息；升序遍历大于所述入场记录时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则将这两张场景照片选为所述缺少出场记录的异常订单的出场事件照片。进一步地，在本发明一实施例中，如果某个泊位关联有未结束订单，但是该泊位又一直未驶入其他车辆，则如果该未结束订单异常的话，通过上面的方法是没有办法发现的。因此，本发明还包括对多个未结束订单进行周期性遍历，查看未结束订单对应的泊位在最新的场景照片中的占用状态，如果为空闲，则说明该未结束订单为异常订单。同时，由于场景照片上传时间与订单创建时间之间可能存在一个间隔，为了避免发生还未来得及上报的情况，还需要对该时间间隔进行一个处理，例如，订单创建时间为6：00，场景照片上传时间为6：03，那么在这三分钟时间间隔内如果只是基于泊位最新场景照片的占用状态进行判断，该未结束的订单就有会被判定为异常订单。因此，通过设置一个时间延迟，可以避免系统误判，提高异常处理的准确性。因此，对多个未结束订单进行周期性遍历包括：遍历所有未结束订单；判断是否存在与当前遍历的未结束订单的订单创建时间的间隔大于预设值的场景照片，如果存在，则判断当前遍历的未结束订单对应的泊位在最新的场景照片中的占用状态是否为空，如果为空，则将当前遍历的未结束订单设置为缺少出场记录的异常订单；在所述多个场景照片中，为所述缺少出场记录的异常订单选取入场事件照片。相应地，本发明还提供一种基于高位视频的泊位异常订单处理系统，包括：数据接收存储模块，用于接收并存储高位视频设备上传的入场事件、出场事件和场景照片；订单创建模块，用于为所述入场事件创建待出场订单；异常订单识别模块，用于根据所述入场事件中的泊位信息，查找是否存在关联的未结束订单，如果存在则将所述未结束订单设置为缺少出场记录的异常订单，还用于根据所述出场事件中的泊位信息和车牌信息，查找是否存在匹配的待出场订单，如果不存在则为所述出场事件创建缺少入场记录的异常订单；还用于遍历所有未结束订单，判断是否存在与当前遍历的未结束订单的订单创建时间的间隔大于预设值的场景照片，如果存在，则判断当前遍历的未结束订单对应的泊位在最新的场景照片中的占用状态是否为空，如果为空，则将当前遍历的未结束订单设置为缺少出场记录的异常订单；异常订单处理模块，用于在所述多个场景照片中，为所述缺少出场记录的异常订单和所述缺少入场记录的异常订单分别选取出场事件照片和入场事件照片；获取所述缺少入场记录的异常订单的出场时间和泊位信息，降序遍历小于所述出场时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则选取这两张照片为入场事件照片；获取所述缺少出场记录的异常订单的入场记录时间和泊位信息，升序遍历大于所述入场记录时间的多个场景照片，如果当前遍历的场景照片中的泊位状态为占用且紧邻的下一张场景照片中的泊位状态为空闲，则将这两张场景照片选为所述缺少出场记录的异常订单的出场事件照片。本发明实施例还提供了一种基于高位视频的泊位异常订单处理装置，可以包括：存储器，用于存储计算机程序；处理器，用于执行上述存储器存储的计算机程序时可实现如下步骤：接收并存储高位视频设备上传的所述入场事件、所述出场事件和所述场景照片；为所述入场事件创建待出场订单；根据所述入场事件中的泊位信息，查找是否存在关联的未结束订单，如果存在则将所述未结束订单设置为缺少出场记录的异常订单；根据所述出场事件中的泊位信息和车牌信息，查找是否存在匹配的待出场订单，如果不存在则为所述出场事件创建缺少入场记录的异常订单；在所述多个场景照片中，为所述缺少出场记录的异常订单和所述缺少入场记录的异常订单分别选取出场事件照片和入场事件照片。本发明实施例还提供了一种计算机可读存储介质，计算机可读存储介质存储有计算机程序,计算机程序被处理器执行时可实现如下步骤；接收并存储高位视频设备上传的所述入场事件、所述出场事件和所述场景照片；为所述入场事件创建待出场订单；根据所述入场事件中的泊位信息，查找是否存在关联的未结束订单，如果存在则将所述未结束订单设置为缺少出场记录的异常订单；根据所述出场事件中的泊位信息和车牌信息，查找是否存在匹配的待出场订单，如果不存在则为所述出场事件创建缺少入场记录的异常订单；在所述多个场景照片中，为所述缺少出场记录的异常订单和所述缺少入场记录的异常订单分别选取出场事件照片和入场事件照片。该计算机可读存储介质可以包括：U盘、移动硬盘、只读存储器 ＞随机存取存储器、磁碟或者光盘等各种可以存 储程序代码的介质。在此处所提供的说明书中，说明了大量具体细节。然而，能够理解，本发明的实施例可以在没有这些具体细节的情况下实践。在一些实例中，并未详细示出公知的方法、结构和技术，以便不模糊对本说明书的理解。类似地，应当理解，为了精简本公开并帮助理解各个发明方面中的一个或多个，在上面对本发明的示例性实施例的描述中，本发明的各个特征有时被一起分组到单个实施例、图、或者对其的描述中。然而，并不应将该公开的方法解释成反映如下意图：即所要求保护的本发明要求比在每个权利要求中所明确记载的特征更多的特征。更确切地说，如下面的权利要求书所反映的那样，发明方面在于少于前面公开的单个实施例的所有特征。因此，遵循具体实施方式的权利要求书由此明确地并入该具体实施方式，其中每个权利要求本身都作为本发明的单独实施例。本领域那些技术人员可以理解，可以对实施例中的设备中的模块进行自适应性地改变并且把它们设置在与该实施例不同的一个或多个设备中。可以把实施例中的模块或单元或组件组合成一个模块或单元或组件，以及此外可以把它们分成多个子模块或子单元或子组件。除了这样的特征和/或过程或者单元中的至少一些是相互排斥之外，可以采用任何组合对本说明书中公开的所有特征以及如此公开的任何方法或者设备的所有过程或单元进行组合。除非另外明确陈述，本说明书中公开的每个特征可以由提供相同、等同或相似目的的替代特征来代替。此外，本领域的技术人员能够理解，尽管在此的一些实施例包括其它实施例中所包括的某些特征而不是其它特征，但是不同实施例的特征的组合意味着处于本发明的范围之内并且形成不同的实施例。例如，在下面的权利要求书中，所要求保护的实施例的任意之一都可以以任意的组合方式来使用。本发明的各个部件实施例可以以硬件实现，或者以在一个或者多个处理器上运行的软件模块实现，或者以它们的组合实现。本领域的技术人员应当理解，可以在实践中使用微处理器或者数字信号处理器来实现根据本发明实施例中的一些或者全部部件的一些或者全部功能。本发明还可以实现为用于执行这里所描述的方法的一部分或者全部的设备或者装置程序。这样的实现本发明的程序可以存储在计算机可读介质上，或者可以具有一个或者多个信号的形式。这样的信号可以从因特网网站上下载得到，或者在载体信号上提供，或者以任何其他形式提供。应该注意的是上述实施例对本发明进行说明而不是对本发明进行限制，并且本领域技术人员在不脱离所附权利要求的范围的情况下可设计出替换实施例。在权利要求中，不应将位于括号之间的任何参考符号构造成对权利要求的限制。单词“包含”不排除存在未列在权利要求中的元件或步骤。位于元件之前的单词“一”或“一个”不排除存在多个这样的元件。本发明可以借助于包括有若干不同元件的硬件以及借助于适当编程的计算机来实现。在列举了若干装置的单元权利要求中，这些装置中的若干个可以是通过同一个硬件项来具体体现。单词第一、第二、以及第三等的使用不表示任何顺序。可将这些单词解释为名称。
