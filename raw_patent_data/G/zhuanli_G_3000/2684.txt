标题title
拼接图像灰度处理方法、图像拼接方法、装置和介质
摘要abst
本发明属于数据图像处理技术领域，尤其涉及一种拼接图像灰度处理方法、图像拼接方法、装置和介质；拼接图像灰度处理方法包括：获取待拼接图像及重叠区域；统计各个相互重叠的重叠区域的灰度差距的和，得到灰度差距和；判断灰度差距和是否符合灰度阈值；当不符合灰度阈值时，对各待拼接图像进行灰度均衡处理，直至灰度差距和符合灰度阈值，或者对各待拼接图像进行灰度均衡处理的次数达到预设次数。通过判断各个待拼接图像之间的差距，对于不符合灰度阈值的重叠区域对应的各个待拼接图像均进行灰度均衡处理，实现了在拼接前对各个待拼接图像的灰度进行整体处理,使处理后各个待拼接图像的灰度处于相近或相同的灰度区间。
权利要求书clms
1.一种拼接图像灰度处理方法，其特征在于，该方法包括以下步骤：获取待拼接图像，并提取各所述待拼接图像的重叠区域；统计各对相互重叠的待拼接图像重叠区域灰度差距的和，得到灰度差距和；判断所述灰度差距和是否符合灰度阈值；当所述灰度差距和不符合所述灰度阈值时，对各所述待拼接图像进行灰度均衡处理；对经过灰度均衡处理的各所述待拼接图像重新统计灰度差距和，并判断重新统计的灰度差距和是否符合所述灰度阈值；当重新统计的灰度差距和不符合所述灰度阈值时，重复对各所述待拼接图像进行灰度均衡处理，并重新统计灰度差距和，直至所述灰度差距和符合所述灰度阈值，或者直至对各所述待拼接图像进行灰度均衡处理的迭代次数达到预设次数。2.根据权利要求1所述的拼接图像灰度处理方法，其特征在于，所述统计各对相互重叠的待拼接图像重叠区域灰度差距的和，得到灰度差距和，具体包括：将相互重叠的两个所述待拼接图像的重叠区域记为一组，得到待重叠区域组；计算所述待重叠区域组中，各个相对应像素点的灰度差值的和，记为重叠区域灰度值；统计各个所述待重叠区域组的重叠区域灰度值的和，得到所述灰度差距和；或者，所述统计各对相互重叠的待拼接图像重叠区域灰度差距的和，得到灰度差距和，具体包括：将相互重叠的两个所述待拼接图像的重叠区域记为一组，得到待重叠区域组；计算所述待重叠区域组中，各个相对应像素点的灰度差值的和，记为重叠区域灰度值；统计各个所述待重叠区域组的权重；根据统计的各个所述待重叠区域组的权重，统计各个所述待重叠区域组的重叠区域灰度值的和，得到所述灰度差距和。3.根据权利要求2所述的拼接图像灰度处理方法，其特征在于，所述统计各个所述待重叠区域组的权重，包括：根据各个所述待重叠区域组的像素点的数量，分配各个所述待重叠区域组的权重；或者，根据各个所述待重叠区域组在拼接后图像中所占的比例，分配各个所述待重叠区域组的权重；或者，根据各个所述待重叠区域组中的前景在拼接后图像的前景中所占的比例，分配各个所述待重叠区域组的权重。4.根据权利要求2至3中任一项所述的拼接图像灰度处理方法，其特征在于，所述各个相对应像素点的灰度差值的和，为前景所对应的各对位置相匹配的像素点的灰度值差值的和。5.根据权利要求1至3中任一项所述的拼接图像灰度处理方法，其特征在于，所述对各所述待拼接图像进行灰度均衡处理，具体包括以下步骤：根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值；根据所述待拼接图像对应的灰度范围均衡值，得到对该待拼接图像的重叠区域的灰度范围进行拉伸或缩进的灰度均衡系数；根据所述待拼接图像对应的灰度均值均衡值、灰度均衡系数以及该待拼接图像的重叠区域的灰度均值，得到该待拼接图像的灰度校正参数；基于各个所述待拼接图像的灰度均衡系数及灰度校正参数分别对各所述待拼接图像的前景进行处理。6.根据权利要求5所述的拼接图像灰度处理方法，其特征在于，所述根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值，具体包括：将具有同一重叠区域的各个所述待拼接图像划分为一组，得到至少一个待拼接图像组；逐个计算各个所述待拼接图像组的重叠区域的所述灰度范围均衡值以及所述灰度均值均衡值；该灰度范围均衡值为待拼接图像组中各个待拼接图像的重叠区域的灰度范围值的平均值；该灰度均值均衡值为待拼接图像组中各个待拼接图像的重叠区域的灰度均值的平均值；或者，所述根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值，具体包括：将具有同一重叠区域的各个所述待拼接图像划分为一组，得到至少一个待拼接图像组；逐个计算各个所述待拼接图像组的重叠区域的前景的所述灰度范围均衡值以及所述灰度均值均衡值；该灰度范围均衡值为待拼接图像组中各个待拼接图像的重叠区域的前景的灰度范围值的平均值；该灰度均值均衡值为待拼接图像组中各个待拼接图像的重叠区域的前景的灰度均值的平均值；或者，所述根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值，具体包括：根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度范围值的和，得到所述灰度范围均衡值；根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值；或者，所述根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值，具体包括：根据各个所述待拼接图像中重叠区域的前景的尺寸，计算各个所述待拼接图像的重叠区域的前景的灰度范围值的和，得到所述灰度范围均衡值；根据各个所述待拼接图像中重叠区域的前景的尺寸，计算各个所述待拼接图像的重叠区域的前景的灰度均值的总平均值，得到所述灰度均值均衡值。7.根据权利要求6所述的拼接图像灰度处理方法，其特征在于，在一次所述灰度均衡处理中，当一个所述待拼接图像属于多个所述待拼接图像组时，所述灰度均衡处理还包括：提取各个所述待拼接图像组中该待拼接图像的所述灰度均衡系数和所述灰度校正参数；提取各个所述灰度均衡系数的均值作为校正的灰度均衡系数，提取各个所述灰度校正参数的均值作为校正的灰度校正参数；或者，根据该待拼接图像各个所述重叠区域的像素点数量之间的比值，确定各个所述重叠区域的第一权重；基于所述第一权重得到各个灰度均衡系数的和作为校正的灰度均衡系数，基于所述第一权重得到各个灰度校正参数的和作为校正的灰度校正参数；或者，根据该待拼接图像各个所述重叠区域的前景占拼接后图像前景的比值，确定各个所述重叠区域的第二权重；基于所述第二权重得到各个灰度均衡系数的和作为校正的灰度均衡系数，基于所述第二权重得到各个灰度校正参数的和作为校正的灰度校正参数；用校正的灰度均衡系数和校正的灰度校正参数对该待拼接图像的前景进行处理。8.根据权利要求7所述的拼接图像灰度处理方法，其特征在于，根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度范围值的和，得到所述灰度范围均衡值，以及根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值，具体包括：分别提取各个所述待拼接图像的重叠区域的像素点个数，根据像素点个数确定各个所述待拼接图像的各个重叠区域的第三权重；基于所述第三权重计算各个所述待拼接图像的重叠区域的灰度范围值的和，得到所述灰度范围均衡值；基于所述第三权重计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值；或者，分别提取各个所述重叠区域的前景在拼接后图像的前景中所占据的面积，根据所占据的面积确定各个所述待拼接图像的各个重叠区域的第四权重；基于所述第四权重计算各个待拼接图像的重叠区域的灰度范围值的和，得到所述灰度范围均衡值；基于所述第四权重计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值。9.根据权利要求6至8中任一所述的拼接图像灰度处理方法，其特征在于，还包括对各个待拼接图像组中的各个前景已经过所述灰度均衡系数和所述灰度校正参数处理的待拼接图像的背景进行处理，处理方式包括直接变换处理，和/或，拉伸变换处理；所述待拼接图像组包括具有同一重叠区域的各个待拼接图像；所述直接变换处理包括：提取所述待拼接图像的背景中的最大灰度值和前景中的最小灰度值，并根据该最大灰度值和最小灰度值之间的差值，得到背景灰度差值；根据所述背景灰度差值对该待拼接图像的背景进行处理，使该待拼接图像前景与背景之间的灰度值连续；所述拉伸变换处理包括：提取所述待拼接图像的前景中的最小灰度值，以及另一待拼接图像的背景中的最小灰度值对该待拼接图像的背景进行背景拉伸；背景拉伸的公式为：，其中，I为该待拼接图像位置处像素点的灰度值，、/＞分别为该待拼接图像背景的最小灰度值和最大灰度值，/＞为该待拼接图像前景的最小灰度值，/＞为另一待拼接图像背景的最小灰度值。/＞10.根据权利要求9所述的拼接图像灰度处理方法，其特征在于，对所述待拼接图像组中各个待拼接图像的背景进行处理，具体包括：对一张所述待拼接图像进行直接变换处理；基于直接变换处理后的待拼接图像对另一张所述待拼接图像进行拉伸变换处理；或者，对所述待拼接图像组中各个待拼接图像的背景进行处理，具体包括：对一张所述待拼接图像进行直接变换处理；判断经过所述直接变换处理的待拼接图像的背景中的最小灰度值是否小于背景未处理的所述待拼接图像的前景中的最小灰度值；当所述背景中的最小灰度值小于所述前景中的最小灰度值时，基于直接变换处理后的待拼接图像对背景未处理的所述待拼接图像进行拉伸变换处理；当所述背景中的最小灰度值大于所述前景中的最小灰度值时，对背景未处理的所述待拼接图像进行所述直接变换处理，并基于直接变换处理后的待拼接图像对另一张所述待拼接图像进行拉伸变换处理。11.根据权利要求6至9中任一项所述的拼接图像灰度处理方法，其特征在于，所述提取各个待拼接图像的前景与背景，具体为：应用三角阈值分割方法对各个所述待拼接图像分别进行分割。12.根据权利要求1至4、和6至9中任一项所述的拼接图像灰度处理方法，其特征在于，所述待拼接图像的数量为至少三幅；所述重叠区域为至少两个。13.一种图像拼接方法，其特征在于，包括应用如权利要求1至12中任一项所述的拼接图像灰度处理方法对各待拼接图像进行处理。14.根据权利要求13所述的图像拼接方法，其特征在于，包括以下步骤：对各待拼接图像进行重叠区域分析，确定各所述待拼接图像的重叠区域；应用如权利要求1至12中任一项所述的拼接图像灰度处理方法对各所述待拼接图像进行处理；应用直接平均法或加权平均法对处理后的各所述待拼接图像的重叠区域进行融合。15.根据权利要求14所述的图像拼接方法，其特征在于，所述对各待拼接图像进行重叠区域分析，确定各所述待拼接图像的重叠区域，包括：确定各所述待拼接图像的梯度场；基于各所述待拼接图像的梯度场确定各所述待拼接图像的互功率谱；根据各所述互功率谱的傅里叶逆变换，分别提取各所述重叠区域对应的傅里叶逆变换的峰值对应的坐标，作为对应重叠区域的两幅所述待拼接图像之间的偏移量；基于各个所述重叠区域的两幅待拼接图像之间的偏移量，确定各待拼接图像的所述重叠区域。16.一种拼接图像灰度处理装置，其特征在于，该装置包括处理器和存储器，所述存储器中存储有计算机指令，所述处理器用于执行所述存储器中存储的计算机指令，当所述计算机指令被处理器执行时该装置实现如权利要求1至15中任一项所述方法的步骤。17.一种计算机存储介质，其特征在于，其上存储有计算机程序，在该计算机程序被处理器执行时实现如权利要求1至15中任一项所述的方法步骤。
说明书desc
技术领域本发明属于数据图像处理技术领域，尤其涉及一种拼接图像灰度处理方法、图像拼接方法、装置和介质。背景技术图像拼接在数据图像处理中应用广泛。无论是数码相机拍摄的光学图像，还是X射线摄影形成的数据X射线图像，均存在需要将图像进行拼接的情况。比如，由于焦距问题，经常存在一个镜头不能完整拍下整个景物的情况，此时，需要用数码相机分别拍摄景物的各个部分，再将各个部分的图像进行拼接，得到一张完整的景物图像；再比如数字X射线成像，由于其是用探测器接收X射线源发出的X射线而成像的，探测器的大小和X射线源发射发出X射线的有效照射面等均限制着可拍摄对象的尺寸，而常用的探测器尺寸有限、X射线源的有效照射面也有限。因此，当需要拍摄脊柱影像、完整的下肢影像、或全身骨骼影像时，不得不分多次拍摄部分部位，再将各次拍摄的图像进行拼接才能得到完整影像。当前图像拼接的过程为：从位于最上部的两张待拼接图像开始，先对两张待拼接图像进行预处理，减少环境及其他因素对配准图像的影像，提高配准精度；再对两张待拼接图像进行配准，确定两幅待拼接图像的相对平移量；然后将该两幅待拼接图像的重叠部分融合，得到第一融合图像；再将第一融合图像与上部第三张图像进行上述从预处理到融合的步骤，得到第二融合图像；提取下一张相邻图像重复前一步骤直至各待拼接图像拼接完成。应该注意，上面对技术背景的介绍只是为了方便对本发明的技术方案进行清楚、完整的说明，并方便本领域技术人员的理解而阐述的。不能仅仅因为这些方案在本发明的背景技术部分进行了阐述而认为上述技术方案为本领域技术人员所公知。发明内容申请人发现，现有的图像拼接方法中，没有对各个待拼接图像在拼接后的图像中的亮度进行处理，而由于拍摄时曝光参数的不同、所处环境的光照影响或者拍摄对象吸收X射线能力的差异，各个待拼接图像在拼接后图像中所对应的各个区域间经常存在明显的亮度差异，影响了拼接后成像的整体性甚至影响对图像的分析。为了解决上述技术问题，本申请旨在提出一种拼接图像灰度处理方法、图像拼接方法、装置和介质，以对各幅待拼接的图像进行灰度处理，使各个待拼接图像处于相同或相近的灰度范围内，解决现有技术中存在的拼接后图像中各个待拼接图像对应的区域间存在亮度差异，影响成像的整体性甚至影响对图像的分析的技术问题。本发明的技术方案如下：本发明的一个方面，提供了一种拼接图像灰度处理方法，该方法包括以下步骤：获取待拼接图像，并提取各所述待拼接图像的重叠区域；统计各对相互重叠的待拼接图像重叠区域灰度差距的和，得到灰度差距和；判断所述灰度差距和是否符合灰度阈值；当所述灰度差距和不符合所述灰度阈值时，对各所述待拼接图像进行灰度均衡处理；对经过灰度均衡处理的各所述待拼接图像重新统计灰度差距和，并判断重新统计的灰度差距和是否符合所述灰度阈值；当重新统计的灰度差距和不符合所述灰度阈值时，重复对各所述待拼接图像进行灰度均衡处理，并重新统计灰度差距和，直至所述灰度差距和符合所述灰度阈值，或者直至对各所述待拼接图像进行灰度均衡处理的迭代次数达到预设次数。进一步地，所述统计各对相互重叠的待拼接图像重叠区域灰度差距的和，得到灰度差距和，具体包括：将相互重叠的两个所述待拼接图像的重叠区域记为一组，得到待重叠区域组；计算所述待重叠区域组中，各个相对应像素点的灰度差值的和，记为重叠区域灰度值；统计各个所述待重叠区域组的重叠区域灰度值的和，得到所述灰度差距和；或者，所述统计各对相互重叠的待拼接图像重叠区域灰度差距的和，得到灰度差距和，具体包括：将相互重叠的两个所述待拼接图像的重叠区域记为一组，得到待重叠区域组；计算所述待重叠区域组中，各个相对应像素点的灰度差值的和，记为重叠区域灰度值；统计各个所述待重叠区域组的权重；根据统计的各个所述待重叠区域组的权重，统计各个所述待重叠区域组的重叠区域灰度值的和，得到所述灰度差距和。进一步地，所述统计各个所述待重叠区域组的权重，包括：根据各个所述待重叠区域组的像素点的数量，分配各个所述待重叠区域组的权重；或者，根据各个所述待重叠区域组在拼接后图像中所占的比例，分配各个所述待重叠区域组的权重；或者，根据各个所述待重叠区域组中的前景在拼接后图像的前景中所占的比例，分配各个所述待重叠区域组的权重。进一步地，所述各个相对应像素点的灰度差值的和，为前景所对应的各对位置相匹配的像素点的灰度值差值的和。进一步地，所述对各所述待拼接图像进行灰度均衡处理，具体包括以下步骤：根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值；根据所述待拼接图像对应的灰度范围均衡值，得到对该待拼接图像的重叠区域的灰度范围进行拉伸或缩进的灰度均衡系数；根据所述待拼接图像对应的灰度均值均衡值、灰度均衡系数以及该待拼接图像的重叠区域的灰度均值，得到该待拼接图像的灰度校正参数；基于各个所述待拼接图像的灰度均衡系数及灰度校正参数分别对各所述待拼接图像的前景进行处理。进一步地，所述根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值，具体包括：将具有同一重叠区域的各个所述待拼接图像划分为一组，得到至少一个待拼接图像组；逐个计算各个所述待拼接图像组的重叠区域的所述灰度范围均衡值以及所述灰度均值均衡值；该灰度范围均衡值为待拼接图像组中各个待拼接图像的重叠区域的灰度范围值的平均值；该灰度均值均 衡值为待拼接图像组中各个待拼接图像的重叠区域的灰度均值的平均值；或者，将具有同一重叠区域的各个所述待拼接图像划分为一组，得到至少一个待拼接图像组；逐个计算各个所述待拼接图像组的重叠区域的前景的所述灰度范围均衡值以及所述灰度均值均衡值；该灰度范围均衡值为待拼接图像组中各个待拼接图像的重叠区域的前景的灰度范围值的平均值；该灰度均值均衡值为待拼接图像组中各个待拼接图像的重叠区域的前景的灰度均值的平均值；或者，根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度范围值的和，得到所述灰度范围均衡值；根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值；或者，根据各个所述待拼接图像中重叠区域的前景的尺寸，计算各个所述待拼接图像的重叠区域的前景的灰度范围值的和，得到所述灰度范围均衡值；根据各个所述待拼接图像中重叠区域的前景的尺寸，计算各个所述待拼接图像的重叠区域的前景的灰度均值的总平均值，得到所述灰度均值均衡值。进一步地，在一次所述灰度均衡处理中，当一个所述待拼接图像属于多个所述待拼接图像组时，所述灰度均衡处理还包括：提取各个所述待拼接图像组中该待拼接图像的所述灰度均衡系数和所述灰度校正参数；提取各个所述灰度均衡系数的均值作为校正的灰度均衡系数，提取各个所述灰度校正参数的均值作为校正的灰度校正参数；或者，根据该待拼接图像各个所述重叠区域的像素点数量之间的比值，确定各个所述重叠区域的第一权重；基于所述第一权重得到各个灰度均衡系数的和作为校正的灰度均衡系数，基于所述第一权重得到各个灰度校正参数的和作为校正的灰度校正参数；或者，根据该待拼接图像各个所述重叠区域的前景占拼接后图像前景的比值，确定各个所述重叠区域的第二权重；基于所述第二权重得到各个灰度均衡系数的和作为校正的灰度均衡系数，基于所述第二权重得到各个灰度校正参数的和作为校正的灰度校正参数；用校正的灰度均衡系数和校正的灰度校正参数对该待拼接图像的前景进行处理。进一步地，根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度范围值的和，得到所述灰度范围均衡值，以及根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值，具体包括：分别提取各个所述待拼接图像的重叠区域的像素点个数，根据像素点个数确定各个所述待拼接图像的各个重叠区域的第三权重；基于所述第三权重计算各个所述待拼接图像的重叠区域的灰度范围值的和，得到所述灰度范围均衡值；基于所述第三权重计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值；或者，分别提取各个所述重叠区域的前景在拼接后图像的前景中所占据的面积，根据所占据的面积确定各个所述待拼接图像的各个重叠区域的第四权重；基于所述第四权重计算各个待拼接图像的重叠区域的灰度范围值的和，得到所述灰度范围均衡值；基于所述第四权重计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值。进一步地，还包括对各个待拼接图像组中的各个前景已经过所述灰度均衡系数和所述灰度校正参数处理的待拼接图像的背景进行处理，处理方式包括直接变换处理，和/或，拉伸变换处理；所述待拼接图像组包括具有同一重叠区域的各个待拼接图像；所述直接变换处理包括：提取所述待拼接图像的背景中的最大灰度值和前景中的最小灰度值，并根据该最大灰度值和最小灰度值之间的差值，得到背景灰度差值；根据所述背景灰度差值对该待拼接图像的背景进行处理，使该待拼接图像前景与背景之间的灰度值连续；所述拉伸变换处理包括：提取所述待拼接图像的前景中的最小灰度值，以及另一待拼接图像的背景中的最小灰度值对该待拼接图像的背景进行背景拉伸；背景拉伸的公式为：，其中，I为该待拼接图像位置处像素点的灰度值，、别为该待拼接图像背景的最小灰度值和最大灰度值，/＞为该待拼接图像前景的最小灰度值，/＞为另一待拼接图像背景的最小灰度值。进一步地，对所述待拼接图像组中各个待拼接图像的背景进行处理，具体包括：对一张所述待拼接图像进行直接变换处理；基于直接变换处理后的待拼接图像对另一张所述待拼接图像进行拉伸变换处理；或者，对所述待拼接图像组中各个待拼接图像的背景进行处理，具体包括：对一张所述待拼接图像进行直接变换处理；判断经过所述直接变换处理的待拼接图像的背景中的最小灰度值是否小于背景未处理的所述待拼接图像的前景中的最小灰度值；当所述背景中的最小灰度值小于所述前景中的最小灰度值时，基于直接变换处理后的待拼接图像对背景未处理的所述待拼接图像进行拉伸变换处理；当所述背景中的最小灰度值大于所述前景中的最小灰度值时，对背景未处理的所述待拼接图像进行所述直接变换处理，并基于直接变换处理后的待拼接图像对另一张所述待拼接图像进行拉伸变换处理。进一步地，所述提取各个待拼接图像的前景与背景，具体为：应用三角阈值分割方法对各个所述待拼接图像分别进行分割。进一步地，所述待拼接图像的数量为至少三幅；所述重叠区域为至少两个。本发明的另一方面，提供了一种图像拼接方法，包括应用如上任一项所述的拼接图像灰度处理方法对各待拼接图像进行处理。进一步地，所述图像拼接方法，包括以下步骤：对各待拼接图像进行重叠区域分析，确定各所述待拼接图像的重叠区域；应用如上任一项所述的拼接图像灰度处理方法对各所述待拼接图像进行处理；应用直接平均法或加权平均法对处理后的各所述待拼接图像的重叠区域进行融合。进一步地，所述对各待拼接图像进行重叠区域分析，确定各所述待拼接图像的重叠区域，包括：确定各所述待拼接图像的梯度场；基于各所述待拼接图像的梯度场确定各所述待拼接图像的互功率谱；根据各所述互功率谱的傅里叶逆变换，分别提取各所述重叠区域对应的傅里叶逆变换的峰值对应的坐标，作为对应重叠区域的两幅所述待拼接图像之间的偏移量；基于各个所述重叠区域的两幅待拼接图像之间的偏移量，确定各待拼接图像的所述重叠区域。本发明的又一方面，提供了一种拼接图像灰度处理装置，该装置包括处理器和存储器，所述存储器中存储有计算机指令，所述处理器用于执行所述存储器中存储的计算机指令，当所述计算机指令被处理器执行时该装置实现如前所述方法的步骤。本发明的再一方面，还提供了一种计算机存储介质，其上存储有计算机程序，在该计算机程序被处理器执行时实现如前所述的方法步骤。本发明的拼接图像灰度处理方法、图像拼接方法、装置和介质，针对现有技术中存在的拼接后图像中各个待拼接图像对应的区域间存在亮度差异，影响成像的整体性甚至影响对图像的分析的技术问题；采用提取各个所述重叠区域的灰度差距和，根据所述灰度差距和是否符合所述灰度阈值来判断各个所述待拼接图像之间的差距，对于不符合所述灰度阈值的重叠区域对应的各个所述待拼接图像均进行灰度均衡处理，实现了在拼接前对各个待拼接图像的灰度进行整体处理，使处理后各个待拼接图像的灰度处于相近或相同的灰度区间；而且，为了避免过分的灰度处理对各个待拼接图像的质量造成影响，甚至对拼接后图像造成影响，以及减小计算量，本申请仅对重叠区域的灰度差距的和进行判断，通过合适的灰度阈值有效保证了灰度处理后待拼接图像的质量、图像处理的速率以及拼接后图像的质量 。附图说明此处所说明的附图用来提供对本发明的进一步理解，构成本申请的一部分，并不构成对本发明的限定。图1示出了本发明的拼接图像灰度处理方法的一个实施例的流程图；图2示出了本发明的统计各对相互重叠的待拼接图像重叠区域灰度差距的和的一个实施例的流程图；图3示出了本发明的统计各对相互重叠的待拼接图像重叠区域灰度差距的和的另一个实施例的流程图；图4示出了本发明的对各所述待拼接图像进行灰度均衡处理的一个实施例的流程图；图5示出了本发明的对各所述待拼接图像进行灰度均衡处理的另一个实施例的流程图；图6示出了本发明的图像拼接方法获取的拼接后图像与现有技术获取的拼接后图像的示例性对比图。实施方式为使本发明的目的、技术方案和优点更加清楚明白，下面结合实施方式和附图，对本发明做进一步详细说明。在此，本发明的示意性实施方式及其说明用于解释本发明，但并不作为对本发明的限定。在此，还需要说明的是，为了避免因不必要的细节而模糊了本发明，在附图中仅仅示出了与根据本发明的方案密切相关的结构和/或处理步骤，而省略了与本发明关系不大的其他细节。在此，还需要说明的是，在不冲突的情况下，本申请中的实施例及实施例中的特征可以相互结合。如本申请和权利要求书中所示，除非上下文明确提示例外情形，“一”、“一个”、“一种”和/或“该”等词并非特指单数，也可包括复数。一般说来，术语“包括”与“包含”仅提示包括已明确标识的步骤和元素，而这些步骤和元素不构成一个排它性的罗列，方法或者设备也可能包含其它的步骤或元素。本申请中使用了流程图用来说明根据本申请的实施例的系统所执行的操作。应当理解的是，前面或后面操作不一定按照顺序来精确地执行。相反，可以按照倒序或同时处理各个步骤。同时，也可以将其他操作添加到这些过程中，或从这些过程移除某一步或数步操作。图1至图5是本申请的拼接图像灰度处理方法的示例性流程图。该拼接图像灰度处理方法的基本思想在于，在图像拼接前，对一个或多个重叠区域对应的各个待拼接图像的灰度进行判断，通过计算各重叠区域之间灰度差值的和，来确定参与计算的各个图像的整体亮度差距；当各个图像之间的整体亮度差距较大时，对各个待拼接图像进行灰度均衡处理，以减小各个待拼接图像间的亮度差距；当各个图像之间的整体亮度差距较小或处于一定阈值内时，则各待拼接图像在拼接后图像中对应的各个区域间存在明显亮暗区别的可能性更小，拼接后图像亮度更均衡。参见图1所示，为本发明的拼接图像灰度处理方法的一个实施例的流程图。本实施例中的拼接图像灰度处理方法包括以下步骤：S1：获取待拼接图像，并提取各所述待拼接图像的重叠区域；S2：统计各对相互重叠的待拼接图像重叠区域灰度差距的和，得到灰度差距和；S3：判断所述灰度差距和是否符合灰度阈值；S4：当所述灰度差距和不符合所述灰度阈值时，对各所述待拼接图像进行灰度均衡处理；S5：对经过灰度均衡处理的各所述待拼接图像重新统计灰度差距和，并判断重新统计的灰度差距和是否符合所述灰度阈值；S6：当重新统计的灰度差距和不符合所述灰度阈值时，重复对各所述待拼接图像进行灰度均衡处理，并重新统计灰度差距和，直至所述灰度差距和符合所述灰度阈值，或者直至对各所述待拼接图像进行灰度均衡处理的迭代次数达到预设次数。为了确保各个待拼接图像在拼接后图像中对应的各个区域间亮度的均匀性，在统计灰度差距和时优选地，将一张拼接后图像需要的全部待拼接图像均参与计算。本实施例中，上述步骤S1,获取待拼接图像，并提取各个所述待拼接图像的重叠区域，为获取拼接后图像的全部待拼接图像，当拼接后图像为两张图像拼接而成时，获取的待拼接图像为两幅，当拼接后图像为三张以上图像拼接而成时，获取的待拼接图像为三张以上。本实施例尤其适用于处理三张以上的待拼接图像，即待拼接图像为至少三张，此时，重叠区域为至少两个。本发明的拼接图像灰度处理方法，在图像拼接前对各个待拼接图像进行整体判断和整体处理。整体判断：用灰度差距和对一个重叠区域对应的两张待拼接图像之间的灰度差距进行放大、同时再对各个重叠区域经过放大后的灰度差距进行求和。本发明在对一个重叠区域对应的两张待拼接图像之间的灰度差距进行放大时，为了避免待拼接图像本身尺寸大小对该放大结果的影响，也为了避免过分的灰度处理对拼接后图像的质量造成影响，以及减小计算量，采取只统计待拼接图像重叠区域的灰度差值。如图2、3所示，本实施例提供了两种得到所述灰度差距和的方法，其中图2所示的，所述统计各对相互重叠的待拼接图像重叠区域灰度差距的和，得到灰度差距和，具体包括：S201：将相互重叠的两个所述待拼接图像的重叠区域记为一组，得到待重叠区域组；S202：计算所述待重叠区域组中，各个相对应像素点的灰度差值的和，记为重叠区域灰度值；S203：统计各个所述待重叠区域组的重叠区域灰度值的和，得到所述灰度差距和。该方法分别统计各个重叠区域对应的待拼接图像的灰度差值的和，再将各个重叠区域对应的灰度差值的和求和，得到了全部重叠区域对应的灰度差值的总和，即全部重叠区域对应各对像素点差距的总和。重叠区域灰度值为各个位置相对应的像素点灰度差值的绝对值的和。将每个位置相对应的像素点的灰度差值的和进行求和，放大了待重叠区域组的灰度差距，为后续判断是否对待拼接图像进行灰度处理提供了有效依据。由于各个重叠区域的尺寸通常存在差别，为了进一步消除重叠区域尺寸的差别对后续灰度差距和的影响，根据各个重叠区域对拼接后图像的贡献来精确获取各个重叠区域间的总的灰度差距。如图3，本发明的统计各对相互重叠的待拼接图像重叠区域灰度差距的和的另一个实施例的流程图所示，本实施例中所述统计各对相互重叠的待拼接图像重叠区域灰度差距的和，得到灰度差距和，具体包括：S211：将相互重叠的两个所述待拼接图像的重叠区域记为一组，得到待重叠区域组；S212：计算所述待重叠区域组中，各个相对应像素点的灰度差值的和，记为重叠区域灰度值；S213：统计各个所述待重叠区域组的权重；S214：根据统计的各个所述待重叠区域组的权重，统计各个所述待重叠区域组的重叠区域灰度值的和，得到所述灰度差距和。其中，S213所述统计各个所述待重叠区域组的权重，包括：根据各个所述待重叠区域组的像素点的数量，分配各个所述待重叠区域组的权重；此方式中任一待重叠区域的权重为：该待重叠区域组像素点的数量与各个待重叠区域组像素点数量的和的比值；或者，根据各个所述待重叠区域组在拼接后图像中所占的比例，分配各个所述待重叠区域组的权重；此方式中各待重叠区域组的权重的和设为1，各待重叠区域组的权重的比为：各个所述待重叠区域组在拼接图像中所占的比例的比；或者，根据各个所述待重叠区域组中的前景在拼接后图像的前景中所占的比例，分配各个所述待重叠区域组的权重；此方式中各个待重叠区域组的权重的和为1，各个重叠区域组的权重的比为：各个待重叠区域组中的前景在拼接后图像的前景中所占的比例的比。本实施例提供了多种确定各个待重叠区域组的权重的方式，其中前两种是根据整个重叠区域的像素点数量，其方法简单，有利于快速确定各个待重叠区域组的权重；而第三个方法虽然要识别各个待重叠区域组的前景以及拼接后的图像的前景，计算方式较复杂，但是其充分考虑了拼接图像的主要对象——前景，对拼接后图像的重要性，消除了背景对拼接图像的干扰，抓取了各个待拼接图像的重点区域对拼接图像亮度的贡献，使对所述灰度差距和的计算充分考虑各个重叠区域对拼接图像的影响。其与所述各个相对应像素点的灰度差值的和，为前景所对应的各对位置相匹配的像素点的灰度值差值的和，相互配合，通过合适的灰度阈值有效保证了灰度处理后图像的质量、拼接后图像的质量，具有提高本拼接图像灰度处理方法可靠性，保证拼接图像前景质量的优点。本实施例中，待重叠区域组对应的两张待拼接图像的重叠区域的像素点是一一对应的，待重叠区域组由多对位置相互对应的像素点成。步骤S202，计算所述待重叠区域组中，各个相对应像素点的灰度差值的和，记为重叠区域灰度值，包括：分别将各对位置相互对应的两个像素点的灰度值相减以得到各对像素点的灰度差值，再将各对像素点的灰度差值求和，得到实施重叠区域灰度值。当然对于尺寸存在差异、拼接时两张图像重叠区域的像素点不是一一对应关系的待拼接图像，比如一张需要缩放到1/4后才与另一张图像存在相同尺寸的重叠区域的图像，其可以在确定重叠区域时将该需要缩放的图像先缩放到原图的1/4，以实现重叠区域的像素点为一一对应；也可以在确定重叠区域时，将该需要缩放的图像的几个像素点记为一组，使需要缩放的图像的像素点组与另一图像的像素点一一对应。对于一张图像重叠区域的像素点组与另一张图像重叠区域的像素点一一对应的情况，其计算各个相对应像素点的灰度差值的和，可以采取：先根据拼接融合时对图像灰度的处理方式将各个像素点组的灰度分别进行处理得到各组的像素点组灰度值，然后将各组的像素点组灰度值分别与另一图像中对应像素点的灰度值进行相减，得到各对的灰度差值，再将全部灰度差值求和，即得到所述重叠区域灰度值。本实施例的上述步骤对各个待拼接图像之间亮度的差距进行整体评价和判断，当根据各待拼接图像的重叠区域统计的灰度差距和不符合所述灰度阈值时，则需要对各个待拼接图像进行灰度均衡处理。为了保证灰度均衡处理的有效性和不影响待拼接图像本身的特征，需要对各个待拼接图像进行整体处理，处理时还要充分考虑各个待拼接图像本身的特点。本实施例中，所述对各所述待拼接图像进行灰度均衡处理，具体包括以下步骤：S410：根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值；S420：根据所述待拼接图像对应的灰度范围均衡值，得到对该待拼接图像的重叠区域的灰度范围进行拉伸或缩进的灰度均衡系数；S430：根据所述待拼接图像对应的灰度均值均衡值、灰度均衡系数以及该待拼接图像的重叠区域的灰度均值，得到该待拼接图像的灰度校正参数；S440：基于各个所述待拼接图像的灰度均衡系数及灰度校正参数分别对各所述待拼接图像的前景进行处理。本实施例中根据各个所述待拼接图像的重叠区域的灰度范围，确定各个所述待拼接图像的灰度跨度调整的目标值——灰度范围均衡值，再根据所述灰度范围均衡值分别得到各个待拼接图像的灰度均衡系数，经过所述灰度均衡系数的处理可以使各个待拼接图像的灰度跨度值相同或相近。再经过所述灰度校正参数使各个灰度跨度相同或相近即灰度区间长度相同或相近的待拼接图像的前景移动至同一区间范围内。通过所述灰度均衡系数和所述灰度校正参数的处理实现了使各个待拼接图像的灰度区间长度相同，以及灰度区间的上、下限值相近。而且，该灰度均衡系数和灰度校正参数的确定综合考虑了重叠区域对应的各张待拼接图像的特征，使得经过处理后待拼接图像的前景在相近的同时，还能良好保留原图像的特征，有助于提高拼接图像的质量。本实施例中，不同的灰度范围均衡值会影像待拼接图像前景的灰度区间的长度，即灰度的跨度，灰度跨度过大容易造成待拼接图像前景灰度的不连续，而灰度跨度过小会使待拼接图像的前景的灰度压缩在一个很小的区间内，造成各区域的对比度不明显。因此，本实施例提供了多种确定灰度范围均衡值以及灰度均值均衡值的方法。第一种，所述根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值，具体包括：将具有同一重叠区域的各个所述待拼接图像划分为一组，得到至少一个待拼接图像组；逐个计算各个所述待拼接图像组的重叠区域的所述灰度范围均衡值以及所述灰度均值均衡值；该灰度范围均衡值为待拼接图像组中各个待拼接图像的重叠区域的灰度范围值的平均值；该灰度均值均衡值为待拼接图像组中各个待拼接图像的重叠区域的灰度均值的平均值。基于该第一种确定待拼接图像的灰度范围均衡值以及灰度均值均衡值的方法，所述对各所述待拼接图像进行灰度均衡处理，如图4所示。如图4所示，为本发明的对各所述待拼接图像进行灰度均衡处理的一个实施例的流程图；其中，所述对各所述待拼接图像进行灰度均衡处理，具体包括以下步骤：S401：将具有同一重叠区域的各个所述待拼接图像划分为一组，得到至少一个待拼接图像组；S402：逐个计算各个所述待拼接图像组的灰度均值均衡值以及灰度范围均衡值；该灰度范围均衡值为待拼接图像组中各个待拼接图像的重叠区域的灰度范围值的平均值；该灰度均值均衡值为待拼接图像组中各个待拼接图像的重叠区域的灰度均值的平均值；S403：提取各个所述待拼接图像的前景与背景；S404：根据各个待拼接图像的重叠区域的灰度范围值以及各个待拼接图像对应待拼接图像组的灰度范围均衡值，分别得到各个所述待拼接图像的灰度均衡系数；S405：根据各个所述待拼接图像的重叠区域的灰度均值、所述灰度均衡系数，以及对应待拼接图像组的灰度均值均衡值，分别得到各个所述待拼接图像的灰度校正参数；S406：基于各个所述待拼接图像的灰度均衡系数及灰度校正参数分别对各所述待拼接图像的前景进行处理。本实施例提供的灰度均衡处理方法以各个重叠区域为处理单位，将具有同一重叠区域的多张待拼接图像划为一组，记为待拼接图像组，对于每个待拼接图像组分别进行独立处理。处理时，先根据各个待拼接图像的重叠区域的灰度均值和灰度范围值，求得灰度均值均衡值和总灰度范围。灰度均值均衡值为：；其中，为灰度均值均衡值，/＞为一张待拼接图像重叠区域的灰度均值，/＞为另一张待拼接图像的重叠区域的灰度均值。灰度范围均衡值为： ；其中，为灰度范围均衡值；/＞分别为两张待拼接图像的重叠区域的灰度范围值，计算公式/＞为灰度范围值，/＞分别为最大灰度值和最小灰度值。上述步骤S404以及步骤S405具体包括应用以下公式分别求得各个待拼接图像的灰度均衡系数和灰度校正参数：/＞其中，k为灰度均衡系数，b为灰度校正参数，为待拼接图像的重叠区域的灰度范围值；/＞为待拼接图像的重叠区域的灰度均值。对于一个所述待拼接图像组中的两张待拼接图像P1和P2，待拼接图像P1的灰度均衡系数k1为灰度范围均衡值与该张待拼接图像P1的重叠区域的灰度范围值的比值，待拼接图像P1的灰度校正参数b1为灰度均值均衡值减去灰度均衡系数k1与该待拼接图像P1的重叠区域的平均灰度值的乘积；待拼接图像P2的灰度均衡系数k2为灰度范围均衡值与该张待拼接图像P2的重叠区域的灰度范围值的比值，待拼接图像P2的灰度校正参数b2为灰度均值均衡值减去灰度均衡系数k2与该待拼接图像P2的重叠区域的平均灰度值的乘积。上述步骤S406基于所述灰度均衡系数和所述灰度校正参数对所述待拼接图像的前景进行处理，则为根据上述灰度均衡系数和灰度校正参数对待拼接图像的前景各个像素点的灰度值进行处理，可以采取的公式为：；其中，k为灰度均衡系数，b为灰度校正参数，为待拼接图像中坐标位置处像素点的灰度值，I为处理后像素点的灰度值。对于每个待拼接图像组中的各张待拼接图像，通过上述公式均可以获得一组k、b值。当一张待拼接图像上有多个区域分别与其他待拼接图像存在重叠时，该待拼接图像将同时存在于多个待拼接图像组，相应的，经过上述处理后可能存在多对所述灰度均衡系数和所述灰度校正参数，可以用各对所述灰度均衡系数和所述灰度校正参数分别对待拼接图像进行处理。为了快速确定此类待拼接图像灰度均衡处理的参数，也可以采取对各对所述灰度均衡系数和所述灰度校正参数进行校正。在一次所述灰度均衡处理中，对于有多个区域分别与其他待拼接图像重叠的所述待拼接图像，则该待拼接图像同时属于多个所述待拼接图像组。当一个所述待拼接图像属于多个所述待拼接图像组时，本实施例提供的拼接图像灰度处理方法中所述灰度均衡处理还包括：S407: 提取各个所述待拼接图像组中该待拼接图像的所述灰度均衡系数和所述灰度校正参数；S4081:提取各个所述灰度均衡系数的均值作为校正的灰度均衡系数，提取各个所述灰度校正参数的均值作为校正的灰度校正参数；或者，S4082:根据该待拼接图像各个所述重叠区域的像素点数量之间的比值，确定各个所述重叠区域的第一权重；基于所述第一权重得到各个灰度均衡系数的和作为校正的灰度均衡系数，基于所述第一权重得到各个灰度校正参数的和作为校正的灰度校正参数；或者，S4083:根据该待拼接图像各个所述重叠区域的前景占拼接后图像前景的比值，确定各个所述重叠区域的第二权重；基于所述第二权重得到各个灰度均衡系数的和作为校正的灰度均衡系数，基于所述第二权重得到各个灰度校正参数的和作为校正的灰度校正参数；S409:用校正的灰度均衡系数和校正的灰度校正参数对该待拼接图像的前景进行处理。其中，各个所述重叠区域的第一权重的和为1，校正的灰度均衡系数为各个重叠区域的权重与对应灰度均衡系数乘积的和，校正的灰度校正参数为各个重叠区域的权重与对应灰度校正参数乘积的和；各个所述重叠区域的第二权重的和为1，校正的灰度均衡系数为各个重叠区域的权重与对应灰度均衡系数乘积的和，校正的灰度校正参数为各个重叠区域的权重与对应灰度校正参数乘积的和。上述灰度均衡处理方法对各个重叠区域对应的各个待拼接图像分别进行整体处理，各个待拼接图像的处理间基于相同的逻辑、过程以及相同的变化目标，保证了灰度均衡处理的有效性。第二种，所述根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值，具体包括：将具有同一重叠区域的各个所述待拼接图像划分为一组，得到至少一个待拼接图像组；逐个计算各个所述待拼接图像组的重叠区域的前景的所述灰度范围均衡值以及所述灰度均值均衡值；该灰度范围均衡值为待拼接图像组中各个待拼接图像的重叠区域的前景的灰度范围值的平均值；该灰度均值均衡值为待拼接图像组中各个待拼接图像的重叠区域的前景的灰度均值的平均值。该第二种方法是在第一种方法上进行的改进，在该第二种方法计算所述灰度范围均衡值、所述灰度均值均衡值时，都是基于待拼接图像组中待拼接图像的重叠区域的前景进行的；当然，相应的确定所述灰度均衡系数和所述灰度校正参数时，也是用待拼接图图像的重叠区域的前景来进行的。其他处理步骤与第一种方法中相同，此处不再过多赘述。上述第一、二种方法确定的灰度范围均衡值和灰度均值均衡值都是以待拼接图像组为处理单元，各个待拼接图像组之间关联性小、统一性差；且要运算多次以分别获取各个待拼接图像组的灰度范围均衡值和灰度均值均衡值，耗时长，并行运算能力差。本实施例还提供了以下第三种和第四种方法，以获取各个待拼接图像均适用的灰度范围均衡值和灰度均值均衡值。第三种，所述根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值，具体包括：根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度范围值的和，得到所述灰度范围均衡值；根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值；第四种，所述根据各个所述待拼接图像的重叠区域的灰度范围和灰度均值，确定灰度范围均衡值以及灰度均值均衡值，具体包括：根据各个所述待拼接图像中重叠区域的前景的尺寸，计算各个所述待拼接图像的重叠区域的前景的灰度范围值的和，得到所述灰度范围均衡值；根据各个所述待拼接图像中重叠区域的前景的尺寸，计算各个所述待拼接图像的重叠区域的前景的灰度均值的总平均值，得到所述灰度均值均衡值。该第三种方式与第四种方式的区别在于：第三种是根据各个待拼接图像的重叠区域的全部像素点的灰度值来计算的，而第四种是根据各个待拼接图像的重叠区域的前景的像素点的灰度值来计算的。下面以第三种方式为例，对其进行灰度均衡处理的方式进一步地说明。参见图5所示，为本发明的对各所述待拼接图像进行灰度均衡处理的另一个实施例的流程示意图；其中，所述对各所述待拼接图像进行灰度均衡处理，具体包括以下步骤：S411：根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度范围值的和，得到所述灰度范围均衡值；S412：根据各个所述待拼接图像中重叠区域的尺寸，计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值；S413：提取各个所述待拼接图像的前景与背景；S414：根据所述灰度范围均衡值，分别得到对各个所述待拼接图像的重叠区域的灰度范围进行拉伸或缩进的灰度均衡系数；S415：根据所述灰度均值均衡值、各个所述待拼接图像的灰度均衡系数以及重叠区域的灰度均值，分别得到各个所述待拼接图像的灰度校正参数；S416：基于各个所述待拼接图像的灰度均衡系数及灰度校正参数分别对各个所述待拼接图像的前景进行处理。本实施例中上述步骤S411至S412，具体包括：分别提取各个所述待拼接图像的重叠区域的像素点个数，根据像素点个数确定各个所述待拼接图像的各个重叠区域的第三权重，基于所述第三权重计算各个所述待拼接图像的重叠区域的灰度范围值值的和，得到所述灰度范围均衡值；基于所述第三权重计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值；或者，分别提取各个所述重叠区域的前景在拼接后图像的前景中所占据的面积，根据所占据的面积确定各个所述待拼接图像的各个重叠区域的第四权重，基于所述第四权重计算各个待拼接图像的重叠区域的灰度范围值的和，得到所述灰度范围均衡值；基于所述第四权重计算各个所述待拼接图像的重叠区域的灰度均值的总平均值，得到所述灰度均值均衡值。下面以第三权重为例对所述灰度均值均衡值和灰度范围均衡值的统计方式进行简要介绍：对于有a-1个重叠区域， a幅待拼接图像P1至Pa，a-1个所述重叠区域对应的2个所述待拼接图像的重叠区域的像素点数量分别为W 11和W21、W22和W31、…至Wa-1 2和Wa1，a-1个重叠区域对应的2个所述待拼接图像的重叠区域的灰度均值分别为M11和M21、M22和M31、…至Ma-1 2和Ma1；a-1个重叠区域对应的2个所述待拼接图像的重叠区域的灰度范围分别为R11和R21、R22和R31、…至Ra-1 2和Ra1；2a个待拼接图像的重叠区域的第三权重分别为C11和C21、C22和C31、…至Ca-1 2和Ca1；C11+C21+ C22+C31…+ Ca-1 2+Ca1=1；C11:C21: C 22:C 31…: C a-1 2:C a1= W 11:W21:W22:W31…:Wa-1 2:Wa1 ；所述灰度均值均衡值M1= C11* M11+C21* M21+C22* M22+C31* M31…+ Ca-1 2* Ma-1 2+Ca1* Ma1；所述灰度范围均衡值R1=C11* R11+C21* R21+C22* R22+C31* R31…+ Ca-1 2* Ra-1 2+Ca1* Ra1。为了便于统计，上述各参数的两个下角标分别表示将各个待拼接图像按拼接顺序由上到下、或由左到右、或其他排布中的任一顺序排列时，第几张待拼接图像和该待拼接图像中的第几个重叠区域；比如下角标11表示第一张待拼接图像的第一个重叠区域，下角标a-1 2表示第a-1张待拼接图像的第二个重叠区域，下角标a 1表示第a张待拼接图像的第一个重叠区域，第一张带拼接图像和最后一张待拼接图像均只有一个重叠区域。在医疗图像拼接时重叠区域的数量通常为2或3个。当需要拼接的待拼接图像为3幅、重叠区域有2个时，权重则为C11、C21、C22、C31四个，本领域技术人员可以根据待拼接图像的数量和重叠区域的数量设置各个待拼接图像的重叠区域的权重，以及根据上述公式确定所述灰度均值均衡值以及所述灰度范围均衡值，此处不再过多赘述。本实施例中，采取第三权重或第四权重均可以获取所述灰度范围均衡值和所述灰度均值均衡值，第三权重具有计算方式简单，计算步骤少的特点，适用于前景占重叠区域范围较大，或者对每次灰度均衡处理的精度要求不高，或者需要运算速度较快的情况。第四权重计算方式略复杂，需要识别待识别图像的前景以及预先对待拼接图像进行初步拼接获取拼接后图像的前景，适合运算能力高，对灰度均衡处理精度要求高的情况。上述步骤S413至步骤S416的具体步骤与前述步骤S403至步骤S406相比，除了步骤S414及S415中各个待拼接图像共用一组灰度范围均衡值和灰度均值均衡值，而不是像步骤S404及S405中每个待拼接图像组均有一组灰度范围均衡值和灰度均值均衡值以外，其他可以相同，具体运算公式此处不再过多赘述。图5所示的对各所述待拼接图像进行灰度均衡处理的方式，一次获取各个待拼接图像的灰度范围均衡值和灰度均值均衡值，对各个待拼接图像进行处理时均考虑了全部重叠区域的灰度范围和灰度均值的影响，统一性高，经过处理的各个待拼接图像更容易快速实现灰度均衡，即经过较少次的迭代处理就可以使得各个待拼接图像的亮度处于相近或相同的灰度区间内。而且在上述处理过程中，一次灰度均衡处理仅需要计算一次灰度范围均衡值和灰度均值均衡值，可以通过并行运算快速获取各个待拼接图像的灰度均衡系数和灰度校正参数，具有计算量少和能够提升并行运算数量的优点，有利于快速完成灰度均衡处理，提高了对待拼接图像灰度处理的速度。本实施例中所述灰度阈值可以用于确定各待拼接图像亮度的差距，其受待拼接图像所处环境的光亮程度、所处的部位、各重叠区域像素点的数量、重叠区域占拼接后图像的比例等的影响。待拼接图像是脊柱影像或全身骨骼影像、重叠区域像素点数、重叠区域占拼接后图像的比例较大时，所述灰度阈值通常设置的较大，待拼接图像是在光照较强的情况下拍摄的数码图像、重叠区域有存在明显亮暗不同的部分且占像素点数量较多、重叠区域占拼接后图像比例较大时，所述灰度阈值也较大，本领域技术人员可以根据实际需要进行设置，此处不再过多赘述。本实施例中，每经过一次灰度均衡处理后的各个待拼接图像的灰度都将更相近，经过灰度均衡处理次数越多各个待拼接图像亮度越接近，但是，处理次数越多需要的时间越多，需要的计算资源越大，所以也可以在灰度均衡处理的迭代达到预设次数后，即停止进行处理，或完成本次灰度处理，具体预设次数的值，本领域技术人员可以根据实际需要进行设置，此处不再过多赘述。通过上述处理可以将各个待拼接图像的前景图像调整到相同或相近的灰度区间内，缩小了拼接后图像前景的亮度差异。上述方式获取的所述灰度校正参数和所述灰度均衡系数当然也可以直接对所述待拼接图像的背景进行处理。由于所述待拼接图像的背景通常含有较少或不含有特征区域，所以可以将背景图像进行更大程度的拉伸或偏移处理。为了保证待拼接图像的背景与经过上述处理的前景图像的灰度的连续性和整体性，同时，避免未有效进行前景和背景的划分时，对背景处理不恰当引起的背景信息缺失问题，本申请还提供了下述对待拼接图像的背景进行处理的方法。本实施例提供的所述的拼接图像灰度处理方法，还包括对各个待拼接图像组中的各个前景已经过所述灰度均衡系数和所述灰度校正参数处理的待拼接图像的背景进行处理，处理方式包括直接变换处理，和/或，拉伸变换处理；所述待拼接图像组包括具有同一重叠区域的各个待拼接图像；所述直接变换处理包括：提取所述待拼接图像的背景中的最大灰度值和前景中的最小灰度值，并根据该最大灰度值和最小灰度值之间的差值，得到背景灰度差值；根据所述背景灰度差值对该待拼接图像的背景进行处理，使该待拼接图像前景与背景之间的灰度值连续；所述拉伸变换处理包括：提取所述待拼接图像的前景中的最小灰度值，以及另一待拼接图像的背景中的最小灰度值对该待拼接图像的背景进行背景拉伸；背景拉伸的公式为：，其中，I为该待拼接图像位置处像素点的灰度值， 、分别为该待拼接图像背景的最小灰度值和最大灰度值，/＞为该待拼接图像前景的最小灰度值，/＞为另一待拼接图像背景的最小灰度值。本实施例中，基于所述背景中的最大灰度值以及所述前景中的最小灰度值，得到背景灰度差值，根据所述背景灰度差值对该待拼接图像的背景进行处理，具体为：计算背景中的最大灰度值与前景中的最小灰度值的差，得到背景灰度差值；用背景灰度差值对待拼接图像每个背景对应的像素点的灰度值进行补齐。本实施例中，用所述直接变换处理对背景图像进行处理的方式保证了处理后的待拼接图像前景与背景灰度之间的连续性和统一性。该处理方式可以用于对所述待拼接图像组中的各个待拼接图像的背景进行处理，当然也采用上述拉伸变换处理方法对各个待拼接图像的背景进行处理。优选地，本实施例中采用所述直接变换处理和所述拉伸变换处理分别对待拼接图像组中的两张待拼接图像进行处理。具体包括：对一张所述待拼接图像进行直接变换处理；基于直接变换处理后的待拼接图像对另一张所述待拼接图像进行拉伸变换处理。该处理方式有效保证了重叠区域对应的两张待拼接图像背景灰度值的均衡性；进而保证了拼接后图像中各个待拼接图像对应区域之间背景的均衡性。对于灰度范围差距较大的两张所述待拼接图像，可能存在对一张图像进行直接变换处理后，该待拼接图像灰度的最小值并不小于另一张待进行拉伸变换处理的待拼接图像前景的最小灰度值，此时，可以对两张待拼接图像的背景重新进行处理，并将处理方式和顺序均对调。此时，对所述待拼接图像组中各个待拼接图像的背景进行处理，具体包括：对一张所述待拼接图像进行直接变换处理；判断经过所述直接变换处理的待拼接图像的背景中的最小灰度值是否小于背景未处理的所述待拼接图像的前景中的最小灰度值；当所述背景中的最小灰度值小于所述前景中的最小灰度值时，基于直接变换处理后的待拼接图像对背景未处理的所述待拼接图像进行拉伸变换处理；当所述背景中的最小灰度值大于所述前景中的最小灰度值时，对背景未处理的所述待拼接图像进行所述直接变换处理，并基于直接变换处理后的待拼接图像对另一张所述待拼接图像进行拉伸变换处理。经过上述判断进一步确保了对待拼接图像背景处理的有效性，保证了经过处理的各个待拼接图像背景的一致性。本实施例中，所述提取各个待拼接图像的前景与背景，具体为：应用三角阈值分割方法对各个所述待拼接图像分别进行分割。对图像的前景和背景进行分割的方法有多种，本领域技术人员可以根据实际需要进行选择，此处不再过多赘述。本发明提供的灰度均衡处理方式，将待拼接图像的前景和背景分别进行对应处理，在有效保留前景图像特征的同时，不遗漏背景可能存在的特征；在保证前景亮度均匀的同时，保证了背景亮度与前景亮度的统一性。本申请对前景和背景采用不同的灰度处理方式，前景与背景的灰度处理方式之间相互配合，有效保证了处理后各个待拼接图像亮度的统一性，避免因前景和背景亮度差异大而引起的有效信息缺失，同时有效提高了拼接图像质量。当基于本发明的拼接图像灰度处理方法对待拼接图像的灰度进行处理的情况下，在拍摄获取X射线投影图像时，可以根据待拍摄对象的特征调整各次拍摄时的拍摄参数，比如，当要拼接获取完整的下肢图像时，可以采用三次拍摄，第一次拍摄髋部、第二次大腿部位，第三次拍摄小腿和脚部；当拍摄髋部时可以采取强度较高的曝光参数，当拍摄小腿和脚步时可以采取较小的曝光参数，在拍摄大腿时可以采用居中强度的曝光参数。本发明提供的拼接图像灰度处理方法，通过选取合理重叠区域，将重叠区域的灰度差距和与灰度阈值相配合，实现了根据各个待拼接图像的整体亮度情况有效判断是否对待拼接图像的亮度进行处理，对于需要进行灰度处理的待拼接图像，采取前景、背景分别处理，对前景的处理基于属于同一重叠区域的各个待拼接图像的情况整体来进行，对背景的处理基于前景以及属于同一重叠区域的其他待拼接图像的情况来进行，有效确保了处理后图像亮度的统一性，同时提高拼接图像的质量。而且，本申请无论是判断是否进行处理，还是对待拼接图像进行灰度处理的方式，都是从整体上进行，有助于提高图像处理效率。为了快速得到灰度差距和符合条件的待拼接图像，在进行灰度均衡处理时，获取各个重叠区域的灰度均值以及灰度范围均值，根据待拼接图像本身的灰度均值和灰度范围与重叠区域的灰度均值和灰度范围均值对其进行拉伸校正；同时，为了确保各个待拼接图像前景与背景之间的差异，在对前景进行拉伸校正的同时，还对各个待拼接图像的背景进行有效的灰度调整。本申请对各个待拼接图像采取整体判断来确定是否对各个待拼接图像进行灰度均衡处理以及进行灰度均衡处理的程度，采取对待拼接图像的前景与背景分别处理，处理前景时充分考虑各个图像间的灰度均值和灰度范围，对背景的处理依据对前景的处理结果而进行，对于过暗的图像，还能提高背景的亮度，使得因过暗而被错误划入背景的“前景”被重拾，对于过亮的图像，能在降低亮度的同时，保持前景与背景之间的差别。实现了在不影响各个待拼接图像有效信息的情况下，有效提高拼接图像中各个待拼接图像区域亮度的均匀性，提高了拼接图像的质量。现有技术的图像拼接都是一个重叠区域拼接完成后，再将另一个重叠区域拼接到已经完成部分重叠区域拼接的拼接图像上，对于有多张待拼接图像的，需要对图像进行多次处理，处理繁琐、耗时长，增加了图像处理的时间，降低了图像拼接的效率。本申请的另一个实施例还提供了一种图像拼接方法，包括应用如上所述的拼接图像灰度处理方法对各个待拼接图像进行处理。本实施例提供的所述图像拼接方法，包括以下步骤：对各待拼接图像进行重叠区域分析，确定各所述待拼接图像的重叠区域；应用如上所述的拼接图像灰度处理方法对各所述待拼接图像进行处理；应用直接平均法或加权平均法对处理后的各所述待拼接图像的重叠区域进行融合。本实施例中，所述对各待拼接图像进行重叠区域分析，确定各所述待拼接图像的重叠区域，包括：确定各所述待拼接图像的梯度场；基于各所述待拼接图像的梯度场确定各所述待拼接图像的互功率谱；根据各所述互功率谱的傅里叶逆变换，分别提取各所述重叠区域对应的傅里叶逆变换的峰值对应的坐标，作为对应重叠区域的两幅所述待拼接图像之间的偏移量；基于各个所述重叠区域的两幅待拼接图像之间的偏移量，确定各待拼接图像的所述重叠区域。本实施例中确定各待处理图像的梯度场M：其中， 分别是待拼接图像f在x方向、y方向的偏导，在计算偏导时，采用Sobel算子，即/＞，*表示卷积操作。本实施例中所述基于各所述待拼接图像的梯度场确定各所述待拼接图像的互功率谱，包括：对各个所述待拼接图像的梯度场图像进行傅里叶变换，并分别得到各个所述待拼接图像的谱；对属于同一重叠区域的各个所述待拼接图像求互功率谱，得到各个所述重叠区域的互功率谱。本发明先根据梯度场来确定各个待拼接图像的偏移量，使得依据偏移量划定的重叠区域中各个前景对位准确；减小了后续根据灰度差距和判断各个对待拼接图像的灰度差距时各个待拼接图像重叠区域的像素点间位置不对应而引起的错误，确保了灰度处理的精确性、有效性。应用本发明提供的图像拼接方法，对图像整体亮度进行判断和处理，经过处理后的各个待拼接图像可以一起拼接融合，提高了图像拼接的效率。本发明提供的拼接图像灰度处理方法，支持在经过灰度均衡处理后对待拼接图像重新确定重叠区域，有助于多次确定重叠区域，确保拼接位置的准确性。本发明的再一个实施例提供的图像拼接方法，应用如上所述拼接图像灰度处理方法对两个待拼接图像进行处理，并对图像进行拼接。获取拼接后图像如图6b所示。如图6示出了本发明的图像拼接方法获取的拼接后图像与现有技术获取的拼接后图像的示例性对比图。从该图6中可以清楚的看出经过本发明方法拼接的图像均衡性更高，各个待拼接图像对应的拼接后图像中的区域的细节更清晰，图片质量更高。相应地，本发明还公开了一种拼接图像灰度处理装置，该装置可包括处理器和存储器，存储器中存储有计算机指令，处理器用于执行存储器中存储的计算机指令，当计算机指令被处理器执行时该装置实现如上所述方法的步骤。本发明还涉及计算机存储介质，其上存储有计算机程序代码，当程序代码被执行时可以实现本发明的方法的各种实施例，该存储介质可以是有形存储介质，诸如光盘、U盘、软盘、硬盘等。本领域技术人员应该可以明白，结合本文中所公开的实施方式描述的各示例性的组成部分、系统和方法，能够以硬件、软件或者二者的结合来实现。具体究竟以硬件还是软件方式来执行，取决于技术方案的特定应用和设计约束条件。专业技术人员可以对每个特定的应用来使用不同方法来实现所描述的功能，但是这种实现不应认为超出本发明的范围。当以硬件方式实现时，其可以例如是电子电路、专用集成电路、适当的固件、插件、功能卡等等。当以软件方式实现时，本发明的元素是被用于执行所需任务的程序或者代码段。程序或者代码段可以存储在机器可读介质中，或者通过载波中携带的数据信号在传输介质或者通信链路上传送。“机器可读介质”可以包括能够存储或传输信息的任何介质。机器可读介质的例子包括电子电路、半导体存储器设备、ROM、闪存、可擦除ROM、软盘、CD-ROM、光盘、硬盘、光纤介质、射频链路，等等。代码段可以经由诸如因特网、内联网等的计算机网络被下载。还需要说明的是，本发明中提及的示例性实施例，基于一系列的步骤或者装置描述一些方法或系统。但是，本发明不局限于上述步骤的顺序，也就是说，可以按照实施例中提及的顺序执行步骤，也可以不同于实施例中的顺序，或者若干步骤同时执行。本发明中，针对一个实施方式描述和/或例示的特征，可以在一个或更多个其它实施方式中以相同方式或以类似方式使用，和/或与其他实施方式的特征相结合或代替其他实施方式的特征。以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明实施例可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
