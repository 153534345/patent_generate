标题title
一种电抗器表面缺陷检测方法
摘要abst
本发明涉及图像数据处理技术领域，具体涉及一种电抗器表面缺陷检测方法，包括：对电抗器表面灰度图分割获得若干个分割区域，计算每个分割区域的噪声影响程度，计算密度可达距离，根据密度可达距离进行聚类获得每个分割区域的若干个聚类簇，计算每个聚类簇的修正系数，根据修正系数和噪声影响程度获得每个聚类簇的修正噪声影响程度，获得所有分割区域中所有聚类簇的主成分方向，根据所有分割区域中所有聚类簇的主成分方向和修正噪声影响程度进行滤波操作，获得去噪后的电抗器表面灰度图，进行缺陷识别，获得螺纹区域的裂纹缺陷。本发明保留图像中的纹理信息，同时具有很好的去噪效果，能够清晰的识别出缺陷，进而保证了电抗器的出厂质量。
权利要求书clms
1.一种电抗器表面缺陷检测方法，其特征在于，该方法包括以下步骤：采集电抗器表面图像；对电抗器表面灰度图进行分割，获得若干个分割区域；根据每个分割区域的最小外接矩形中像素点与邻域像素点的灰度值的差异，以及最小外接矩形的分布方向，获得每个分割区域的噪声影响程度；将电抗器表面灰度图的灰度范围平均划分为三个区间，根据所有分割区域的噪声影响程度的差异和每个区间对应的所有像素点的分布情况，计算电抗器表面灰度图的密度可达距离；根据密度可达距离对每个分割区域进行聚类，获得每个分割区域的若干个聚类簇；根据延伸后的聚类簇的像素点的数量和所有像素点与邻域像素点的灰度值差异，获得每个聚类簇的修正系数；将每个分割区域中每个聚类簇的修正系数与每个分割区域的噪声影响程度的乘积，记为每个分割区域中每个聚类簇的修正噪声影响程度；对每个分割区域中每个聚类簇的所有像素点的最大差值垂直方向进行分析，获得每个分割区域中每个聚类簇的主成分方向；根据所有分割区域中所有聚类簇的主成分方向和修正噪声影响程度进行滤波操作，获得去噪后的电抗器表面灰度图，进行缺陷识别，获得螺纹区域的裂纹缺陷。2.根据权利要求1所述的一种电抗器表面缺陷检测方法，其特征在于，所述获得每个分割区域的噪声影响程度，包括的具体步骤如下：获得每个分割区域的最小外接矩形，将最小外接矩形的较长的边记为长边，较短的边记为短边，以每个最小外接矩形的长边为横轴、短边为纵轴，构建直角坐标系；任意一个分割区域的噪声影响程度的计算公式如下：式中，表示第/＞个分割区域的噪声影响程度，/＞、/＞分别表示第/＞个分割区域的最小外接矩形的长边和短边的长度，/＞表示第/＞个分割区域的最小外接矩形中横坐标为x、纵坐标为y的像素点的灰度值，/＞表示第/＞个分割区域的最小外接矩形的长边的斜率，表示第/＞个分割区域的最小外接矩形中横坐标为x、纵坐标为y的像素点的八邻域内第i个像素点的灰度值；获得所有分割区域的噪声影响程度，对所有分割区域的噪声影响程度进行线性归一化，将线性归一化后的噪声影响程度作为每个分割区域的噪声影响程度。3.根据权利要求1所述的一种电抗器表面缺陷检测方法，其特征在于，所述计算电抗器表面灰度图的密度可达距离，包括的具体步骤如下：电抗器表面灰度图的密度可达距离的计算公式如下：式中，表示电抗器表面灰度图的密度可达距离，/＞表示从所有分割区域中选择两个分割区域的可能情况的数量，t表示分割区域的数量，/＞、/＞分别表示分割区域a和分割区域b的噪声影响程度，/＞表示取绝对值，/＞表示从第j区间对应的所有像素点中选择两个像素点的可能情况的数量，/＞表示第j区间对应的像素点的数量，/＞表示第j区间对应的所有像素点中像素点m和像素点n的欧氏距离。4.根据权利要求1所述的一种电抗器表面缺陷检测方法，其特征在于，所述获得每个分割区域的若干个聚类簇，包括的具体步骤如下：将电抗器表面灰度图的密度可达距离作为DBSCAN密度聚类的密度可达距离参数，通过DBSCAN密度聚类算法对每个分割区域进行聚类，获得每个分割区域的若干个聚类簇。5.根据权利要求1所述的一种电抗器表面缺陷检测方法，其特征在于，所述获得每个聚类簇的修正系数，包括的具体步骤如下：对获得的每个聚类簇向外延伸5个像素区域，将延伸后的区域作为每个聚类簇对应的区域，任意一个聚类簇的修正系数的计算公式如下：式中，表示第/＞个分割区域中第/＞个聚类簇的修正系数，/＞表示第/＞个分割区域中第/＞个聚类簇的像素点的数量，/＞表示第/＞个分割区域的像素点的数量，/＞表示第/＞个分割区域中第/＞个聚类簇中像素点的数量，/＞表示第/＞个分割区域中第/＞个聚类簇的第q个像素点的灰度值，/＞表示第/＞个分割区域中第/＞个聚类簇的第q个像素点的左侧的像素点的灰度值，/＞表示第/＞个分割区域中第/＞个聚类簇的第q个像素点的右侧的像素点的灰度值，/＞表示第/＞个分割区域中第/＞个聚类簇的第q个像素点的上方的像素点的灰度值，/＞表示第/＞个分割区域中第/＞个聚类簇的第q个像素点的下方的像素点的灰度值，/＞表示以自然常数为底数的指数函数，/＞表示取绝对值。6.根据权利要求1所述的一种电抗器表面缺陷检测方法，其特征在于，所述获得每个分割区域中每个聚类簇的主成分方向，包括的具体步骤如下：将任意一个分割区域中任意一个聚类簇记为目标聚类簇，通过Sobel算子获得目标聚类簇中每个像素点的梯度方向和梯度幅值；将以像素点的梯度方向为方向、以像素点的梯度幅值为模的向量记为像素点的方向向量；将目标聚类簇中的任意一个像素点作为目标像素点，获取目标像素点的梯度方向与目标像素点4邻域内的每个邻域像素点的梯度方向的差值的绝对值，记为目标像素点的梯度方向变化量；将最大的梯度方向变化量对应的邻域像素点的方向向量和目标像素点的方向向量进行加法运算，将获得的向量的方向的垂直方向记为目标像素点的最大差值垂直方向；获得目标聚类簇中所有像素点的最大差值垂直方向，对所有最大差值垂直方向进行主成分分析，获得目标聚类簇的主成分方向。7.根据权利要求1所述的一种电抗器表面缺陷检测方法，其特征在于，所述获得去噪后的电抗器表面灰度图，包括的具体步骤如下：将每个分割区域中每个聚类簇的主成分方向作为滤波方向，将每个分割区域中每个聚类簇的修正噪声影响程度作为滤波权重，根据双边滤波算法对每个分割区域中每个聚类簇对应的区域进行滤波操作，得到去噪后的电抗器表面灰度图。
说明书desc
技术领域本发明涉及图像数据处理技术领域，具体涉及一种电抗器表面缺陷检测方法。背景技术通电抗器也叫电感器，在电路中的应用十分广泛，在电路中因为存在电磁感应的效果，所以存在一定的电感性，能够起到阻止电流变化的作用。一个导体通电时就会在其所占据的一定空间范围产生磁场，电抗器是导线绕成螺线管形式，为了让这只螺线管具有更大的电感，便在螺线管中插入铁心，称铁心电抗器。但是在其生产过程中，表面可能受到硬力的作用，导致其产生裂纹缺陷，影响产品的质量，因此需要在出厂时对电抗器进行缺陷检测，保证产品的质量。但是在识别产品表面的缺陷时，由于采集图像的环境比较复杂，会存在噪声，影响对缺陷的识别，因此需要对图像进行去噪处理。在现有技术中，对图像去噪的方法较多，其中双边滤波算法能够有效的去除噪声的影响，并且保留图像的边缘，去噪后能够很好的保留图像的纹理。但是在进行去噪时，固定的滤波权重会影响算法的去噪效果，因此需要根据图像中细节变化获得合适的合适滤波权重。人为设置的滤波权重的去噪效果不好，需要自适应滤波权重。发明内容本发明提供一种电抗器表面缺陷检测方法，以解决现有的问题。本发明的一种电抗器表面缺陷检测方法采用如下技术方案：本发明一个实施例提供了一种电抗器表面缺陷检测方法，该方法包括以下步骤：采集电抗器表面图像；对电抗器表面灰度图进行分割，获得若干个分割区域；根据每个分割区域的最小外接矩形中像素点与邻域像素点的灰度值的差异，以及最小外接矩形的分布方向，获得每个分割区域的噪声影响程度；将电抗器表面灰度图的灰度范围平均划分为三个区间，根据所有分割区域的噪声影响程度的差异和每个区间对应的所有像素点的分布情况，计算电抗器表面灰度图的密度可达距离；根据密度可达距离对每个分割区域进行聚类，获得每个分割区域的若干个聚类簇；根据延伸后的聚类簇的像素点的数量和所有像素点与邻域像素点的灰度值差异，获得每个聚类簇的修正系数；将每个分割区域中每个聚类簇的修正系数与每个分割区域的噪声影响程度的乘积，记为每个分割区域中每个聚类簇的修正噪声影响程度；对每个分割区域中每个聚类簇的所有像素点的最大差值垂直方向进行分析，获得每个分割区域中每个聚类簇的主成分方向；根据所有分割区域中所有聚类簇的主成分方向和修正噪声影响程度进行滤波操作，获得去噪后的电抗器表面灰度图。进一步地，所述获得每个分割区域的噪声影响程度，包括的具体步骤如下：获得每个分割区域的最小外接矩形，将最小外接矩形的较长的边记为长边，较短的边记为短边，以每个最小外接矩形的长边为横轴、短边为纵轴，构建直角坐标系；任意一个分割区域的噪声影响程度的计算公式如下：式中，表示第个分割区域的噪声影响程度，、分别表示第个分割区域的最小外接矩形的长边和短边的长度，表示第个分割区域的最小外接矩形中横坐标为x、纵坐标为y的像素点的灰度值，表示第个分割区域的最小外接矩形的长边的斜率，表示第个分割区域的最小外接矩形中横坐标为x、纵坐标为y的像素点的八邻域内第i个像素点的灰度值；获得所有分割区域的噪声影响程度，对所有分割区域的噪声影响程度进行线性归一化，将线性归一化后的噪声影响程度作为每个分割区域的噪声影响程度。进一步地，所述计算电抗器表面灰度图的密度可达距离，包括的具体步骤如下：电抗器表面灰度图的密度可达距离的计算公式如下：式中，表示电抗器表面灰度图的密度可达距离，表示从所有分割区域中选择两个分割区域的可能情况的数量，t表示分割区域的数量，、分别表示分割区域a和分割区域b的噪声影响程度，表示取绝对值，表示从第j区间对应的所有像素点中选择两个像素点的可能情况的数量，表示第j区间对应的像素点的数量，表示第j区间对应的所有像素点中像素点m和像素点n的欧氏距离。进一步地，所述获得每个分割区域的若干个聚类簇，包括的具体步骤如下：将电抗器表面灰度图的密度可达距离作为DBSCAN密度聚类的密度可达距离参数，通过DBSCAN密度聚类算法对每个分割区域进行聚类，获得每个分割区域的若干个聚类簇。进一步地，所述获得每个聚类簇的修正系数，包括的具体步骤如下：对获得的每个聚类簇向外延伸5个像素区域，将延伸后的区域作为每个聚类簇对应的区域，任意一个聚类簇的修正系数的计算公式如下：式中，表示第个分割区域中第个聚类簇的修正系数，表示第个分割区域中第个聚类簇的像素点的数量，表示第个分割区域的像素点的数量，表示第个分割区域中第个聚类簇中像素点的数量，表示第个分割区域中第个聚类簇的第q个像素点的灰度值，表示第个分割区域中第个聚类簇的第q个像素点的左侧的像素点的灰度值，表示第个分割区域中第个聚类簇的第q个像素点的右侧的像素点的灰度值，表示第个分割区域中第个聚类簇的第q个像素点的上方的像素点的灰度值，表示第个分割区域中第个聚类簇的第q个像素点的下方的像素点的灰度值，表示以自然常数为底数的指数函数，表示取绝对值。进一步地，所述获得每个分割区域中每个聚类簇的主成分方向，包括的具体步骤如下：将任意一个分割区域中任意一个聚类簇记为目标聚类簇，通过Sobel算子获得目标聚类簇中每个像素点的梯度方向和梯度幅值；将以像素点的梯度方向为方向、以像素点的梯度幅值为模的向量记为像素点的方向向量；将目标聚类簇中的任意一个像素点作为目标像素点，获取目标像素点的梯度方向与目标像素点4邻域内的每个邻域像素点的梯度方向的差值的绝对值，记为目标像素点的梯度方向变化量；将最大的梯度方向变化量对应的邻域像素点的方向向量和目标像素点的方向向量进行加法运算，将获得的向量的方向的垂直方向记为目标像素点的最大差值垂直方向；获得目标聚类簇中所有像素点的最大差值垂直方向，对所有最大差值垂直方向进行主成分分析，获得目标聚类簇的主成分方向。进一步地，所述获得去噪后的电抗器表面灰度图，包括的具体步骤如下：将每个分割区域中每个聚类簇的主成分方向作为滤波方向，将每个分割区域中每个聚类簇的修正噪声影响程度作为滤波权重，根据双边滤波算法对每个分割区域中每个聚类簇对应的区域进行滤波操作，得到去噪后的电抗器表面灰度图。本发明的技术方案的有益效果是：在对电抗器表面进行缺陷检测时，因为图像受到噪声的影响，导致无法准确地分割出完整的缺陷区域，因此通过双边滤波算法对图像进行自适应去噪，本发明根据电抗器表面灰度图的图像特点，对图像进行区域划分，然后根据不同分割区域中的纹理特征，自适应获得每个分割区域的噪声影响程度，考虑到存在裂纹缺陷的分割区域，会造成局部噪声影响程度增大的假象，因此根据裂纹缺陷的特征来对噪声影响程度进行修正，将修正后的噪声影响程度作为权重参数，并且获得最佳的滤波方向，使得对不同区域中的噪声平滑效果更好。使得去噪后的图像即保留图像中的纹理信息，又具有很好的去噪效果，根据去噪后的图像能够清晰的识别出缺陷，进而保证了电抗器的出厂质量。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明的一种电抗器表面缺陷检测方法的步骤流程图；图2为本发明一个实施例提供的一种包含裂纹缺陷的电抗器局部表面图像；图3为本发明一个实施例提供的图2去噪后的图像；图4为本发明一个实施例提供的检测出裂纹缺陷的示意图。具体实施方式为了更进一步阐述本发明为达成预定发明目的所采取的技术手段及功效，以下结合附图及较佳实施例，对依据本发明提出的一种电抗器表面缺陷检测方法，其具体实施方式、结构、特征及其功效，详细说明如下。在下述说明中，不同的“一个实施例”或“另一个实施例”指的不一定是同一实施例。此外，一或多个实施例中的特定特征、结构或特点可由任何合适形式组合。除非另有定义，本文所使用的所有的技术和科学术语与属于本发明的技术领域的技术人员通常理解的含义相同。下面结合附图具体的说明本发明所提供的一种电抗器表面缺陷检测方法的具体方案。请参阅图1，其示出了本发明一个实施例提供的一种电抗器表面缺陷检测方法的步骤流程图，该方法包括以下步骤：S001.采集电抗器表面图像。需要说明的是，本发明的主要目的是为了对电抗器表面进行缺陷识别，因此，需要先采集电抗器表面图像。在本实施例中，因为检测的区域为电抗器的线圈区域，因为在采集时需要将电抗器水平放置，使用CCD工业相机俯视拍摄电抗器的表面，然后对采集的图像进行灰度化处理，获得电抗器表面图像；对图像进行灰度化使用平均值法，平均值法为现有公知技术，在此不再赘述。请参阅图2，其示出了本发明一个实施例提供的一种包含裂纹缺陷的电抗器局部表面图像。由图2可以看出，因为噪声的影响，图像整体颗粒感较为严重，低灰度值的噪点影响裂纹缺陷的识别。至此，获得电抗器表面灰度图。S002.对电抗器表面灰度图进行分割，获得若干个分割区域，计算每个分割区域的噪声影响程度，计算电抗器表面灰度图的密度可达距离，根据密度可达距离对每个分割区域进行聚类，获得每个分割区域的若干个聚类簇，计算每个分割区域中每个聚类簇的修正系数，根据修正系数和噪声影响程度获得每个聚类簇的修正噪声影响程度。需要说明的是，由于采集环境的影响，造成采集的电抗器表面图像存在很多的噪声，影响缺陷检测结果的准确性，因此需要对电抗器表面图像进行去噪处理。双边滤波一种非线性的基于空间分布的高斯滤波函数，双边滤波算法在去噪时对像素点的灰度值和空间距离进行综合考虑，将灰度值和空间距离两种因子相结合并进行折中处理，这样不但能够有效的降低图像中的各类噪声的影响，还可以对图像中的边缘信息进行保护。双边滤波去噪算法是通过高斯核卷积的去噪方法，但是在进行去噪时，因为不同区域的噪声影响程度不同，并且因为原本的纹理会导致局部灰度差异变大，因此根据在相邻像素集模板内根据灰度值的相似性对相邻像素进行筛选，选取灰度值相似的像素组成新的像素集模板，然后根据图像的像素变化获得最佳滤波权重。进一步需要说明的是，图像存在噪声，相当于是在原有的图像上添加了部分像素点，其模型为：噪声图像=原图像+噪声图像，而噪声会改变原有图像的局部灰度，而在本发明中，图像存在的噪声大部分为高斯噪声，也会存在以少部分的椒盐噪声，高斯噪声是灰度值较大的像素点，而椒盐噪声像素点的灰度值有可能较大，有可能较小。并且在采集图像时，线圈上的塑料会发生局部反光，影响噪声的识别，因此根据图像中像素点的分布构建像素投影模型，来分析噪声的分布情况。1.对电抗器表面灰度图进行分割，获得若干个分割区域。需要说明的是，图像的灰度变化在平面上表现为不同像素点的灰度值大小，当图像存在噪声时，噪声像素点是随机分布的，改变图像各个区域像素点灰度值的连续性特征，在本发明中，因为电抗器的表面缠绕的线圈具有纹理特征，不同空间位置上的像素点具有一定的规律性，因此对图像进行区域划分，在进行区域划分时，因为图像存在的纹理特征比较明显，是灰度交替变化的明暗灰度带，每一条灰度带的中间灰度值大，两侧的灰度值小，然后计算每个局部区域的噪声影响程度。在本实施例中，采用分水岭算法对电抗器表面灰度图进行分割，获得若干个分割区域。分水岭算法为现有公知技术，在此不再进行赘述。在本实施例中，分水岭算法的水淹阈值为25，该阈值为经验阈值，实施者可根据不同的实时环境自行设定。2.计算每个分割区域的噪声影响程度。需要说明的是，因为电抗器表面存在裂纹缺陷，因此通过分水岭算法分割后，表面的纹理与裂纹缺陷会混在一起，那么在通过像素点的邻域像素点确定图像的噪声的影响程度时，需要考虑裂纹与纹理的方向。因为在进行去噪时，既要保证图像的细节不会存在损失，又要去噪效果好，因此在根据邻域像素点进行分析时，需要突出裂纹区域的变化。因为电抗器线圈之间的纹理是呈现规律分布的，而裂纹的变化方向是随机的，因此根据最小外接矩形来获得确定像素点的分布方向。在本实施例中，获得每个分割区域的最小外接矩形，将最小外接矩形的较长的边记为长边，较短的边记为短边，以每个最小外接矩形的长边为横轴、短边为纵轴，构建直角坐标系；根据每个分割区域的最小外接矩形中像素点与邻域像素点的灰度值的差异，以及最小外接矩形的分布方向，获得每个分割区域的噪声影响程度，任意一个分割区域的噪声影响程度的计算公式如下：式中，表示第个分割区域的噪声影响程度，、分别表示第个分割区域的最小外接矩形的长边和短边的长度，表示第个分割区域的最小外接矩形中横坐标为x、纵坐标为y的像素点的灰度值，表示第个分割区域的最小外接矩形的长边的斜率，表示第个分割区域的最小外接矩形中横坐标为x、纵坐标为y的像素点的八邻域内第i个像素点的灰度值。获得所有分割区域的噪声影响程度，对所有分割区域的噪声影响程度进行线性归一化，将线性归一化后的噪声影响程度作为每个分割区域的噪声影响程度。因为裂纹的纹理方向是随机的，图像上的纹理方向是固定，因此通过分割区域的所在的最小外接矩形的斜率来表示分割区域中纹理方向，在对图像分割后，每一个分割区域中像素点的灰度变化是连续的，当存在随机噪声时，相邻像素点的灰度值就会发生突变，因此根据邻域像素点的灰度值变化来对噪声的大小进行评价，并且因为裂纹和图像本身的纹理的方向不同，因此在进行差计算时，沿着裂纹方向计算其邻域像素点之间的灰度差值变化较大，而其他纹理的灰度变化较小，因此能够对裂纹区域进行着重评价。3.计算电抗器表面灰度图的密度可达距离，根据密度可达距离对每个分割区域进行聚类，获得每个分割区域的若干个聚类簇。需要说明的是，通过上述计算获得每个区域噪声的影响程度，因为是对每个分割区域进行整体评价，当分割区域存在裂纹缺陷时，也会改变像素点间的灰度连续性，导致相邻像素点间的灰度值发生变化，因此上述获得的噪声影响程度会比实际的值大，因此在根据裂纹的边缘特征变化对噪声的影响程度进行修正。在进行区域分割时，获得的是每一条导线的区域，为了能够准确的描述图像中的噪声影响，在对图像进行分割。因为出现裂纹时，裂纹区域的灰度值会比导线区域的灰度值小，因此对获得的分割区域进行DBSCAN密度聚类，因为密度聚类是根据像素点间的距离进行区域划分的，因此在进行聚类时，对图像的灰度值进行划分，图像的灰度值划分为平均划分为三个区间，然后再进行密度聚类，获得不同的聚类簇，在进行密度聚类时，密度可达距离需要提前设定，但是在本发明中因为噪声的影响，局部区域的噪声影响程度可能较大，因为在进行聚类时会导致密度可达距离设置的较小，从而导致区域的分割不准确，因此需要根据噪声的影响程度来确定密度可达距离。在本实施例中，将电抗器表面灰度图中最小的灰度值与最大的灰度值组成的范围记为电抗器表面灰度图的灰度范围，将灰度范围平均划分为三个区间，分别记为第1区间到第3区间。根据使用分割区域的噪声影响程度的差异和每个区间对应的所有像素点的分布情况，计算电抗器表面灰度图的密度可达距离，电抗器表面灰度图的密度可达距离的计算公式如下：式中，表示电抗器表面灰度图的密度可达距离，表示从所有分割区域中选择两个分割区域的可能情况的数量，t表示分割区域的数量，、分别表示分割区域a和分割区域b的噪声影响程度，表示取绝对值，表示从第j区间对应的所有像素点中选择两个像素点的可能情况的数量，表示第j区间对应的像素点的数量，表示第j区间对应的所有像素点中像素点m和像素点n的欧氏距离。表示两两分割区域的噪声影响程度差异的均值，因为在进行密度聚类时，不同分割区域的噪声影响程度不相同，因此为了能够均衡的对所有分割区域实现聚类，采用平均噪声影响程度来调节密度可达距离。因为密度可达距离时根据像素点间的距离确定，因此在确定密度可达距离时通过计算每个区间中所有像素点的距离均值来表示。设置DBSCAN密度聚类的最小聚类数参数为4，将电抗器表面灰度图的密度可达距离作为DBSCAN密度聚类的密度可达距离参数，通过DBSCAN密度聚类算法对每个分割区域进行聚类，获得每个分割区域的若干个聚类簇。DBSCAN密度聚类算法为现有公知技术，在此不再赘述。4.计算每个分割区域中每个聚类簇的修正系数，根据修正系数和噪声影响程度获得每个聚类簇的修正噪声影响程度。在本实施例中，为了能够更加准确的反映分割区域内聚类簇的联系，对获得的每个聚类簇向外延伸5个像素区域，将延伸后的区域作为每个聚类簇对应的区域，根据延伸后的聚类簇的像素点的数量和所有像素点与邻域像素点的灰度值差异，获得每个聚类簇的修正系数；任意一个聚类簇的修正系数的计算公式如下：式中，表示第个分割区域中第个聚类簇的修正系数，表示第个分割区域中第个聚类簇的像素点的数量，表示第个分割区域的像素点的数量，表示第个分割区域中第个聚类簇中像素点的数量，表示第个分割区域中第个聚类簇的第q个像素点的灰度值，表示第个分割区域中第个聚类簇的第q个像素点的左侧的像素点的灰度值，表示第个分割区域中第个聚类簇的第q个像素点的右侧的像素点的灰度值，表示第个分割区域中第个聚类簇的第q个像素点的上方的像素点的灰度值，表示第个分割区域中第个聚类簇的第q个像素点的下方的像素点的灰度值，表示以自然常数为底数的指数函数，表示取绝对值。反映了像素点与邻域像素点的灰度值的变化情况，如果聚类簇内存在裂纹时，顺着裂纹的方向上灰度值变化是比较相近的，但是在裂纹方向的垂直方向上的像素点的灰度差异较大；当像素点为噪声点时，其周围四邻域内的邻域像素点的灰度值变化是相近的，因为根据邻域像素点的灰度值变化的比值来反映聚类簇是否存在裂纹的影响。当比值接近1时，说明该像素点是受到噪声的影响，当比值差异越大时，则说明是受到裂纹的影响导致的噪声影响程度变大。表示聚类簇区域的相对大小，因为裂纹区域在进行聚类时，其像素点的数量较多，但是噪声像素点是相对独立的，即使部分噪声像素点会被聚成一类，但是其数量也会少于裂纹区域的像素点，因此用像素点数量的比值表示裂纹区域的可能性。根据图像中分割区域中聚类簇的变化特征来对噪声的影响程度进行修正，能够准确的反映局部区域中噪声的分布，使得在进行去噪时，会避免因为原本图像中存在的纹理导致的噪声评价指标的增大，使得在通过双边滤波进行去噪时能够保留图像中存在的纹理细节，并且能够很好的去掉噪声的影响，进而在对电抗器表面裂纹缺陷进行识别时更加的准确。在进行修正时，存在裂纹的可能程度越大，像素点的灰度变化越剧烈，实际上噪声的影响程度较小，因此这里直接根据不同区域的灰度变化获得的修正参数乘以原始的噪声影响程度，即能表示当前区域的噪声影响程度。通过上述方法计算不同区域的噪声影响程度的修正参数，然后对不同区域的噪声影响程度进行修正，将每个分割区域中每个聚类簇的修正系数与每个分割区域的噪声影响程度的乘积记为每个分割区域中每个聚类簇的修正噪声影响程度。S003.获得所有分割区域中所有聚类簇的主成分方向。需要说明的是，通过上述方法计算获得图像中不同区域的噪声影响程度，然后根据图像中的灰度变化方向确定滤波窗口的滑动方向。因为不同的滤波方向对细节的模糊是不一样的，当顺着裂纹方向进行滤波时，裂纹的边缘模糊程度较小，因此根据上述的聚类结果来确定去噪的滤波方向。在本实施例中，将任意一个分割区域中任意一个聚类簇记为目标聚类簇，通过Sobel算子获得目标聚类簇中每个像素点的梯度方向和梯度幅值；将以像素点的梯度方向为方向、以像素点的梯度幅值为模的向量记为像素点的方向向量。将目标聚类簇中的任意一个像素点作为目标像素点，获取目标像素点的梯度方向与目标像素点4邻域内的每个邻域像素点的梯度方向的差值的绝对值，记为目标像素点的梯度方向变化量；将最大的梯度方向变化量对应的邻域像素点的方向向量和目标像素点的方向向量进行加法运算，将获得的向量的方向的垂直方向记为目标像素点的最大差值垂直方向。获得目标聚类簇中所有像素点的最大差值垂直方向，对所有最大差值垂直方向进行主成分分析，获得目标聚类簇的主成分方向；获得所有分割区域中所有聚类簇的主成分方向。需要说明的是，根据主成分分析算法可知，一共获得多个主成分方向，每个主成分方向向量对应一个特征值，本实施例中只保留特征值最大的主成分方向。S004.根据所有分割区域中所有聚类簇的主成分方向和修正噪声影响程度进行滤波操作，获得去噪后的电抗器表面灰度图，进行缺陷识别，获得螺纹区域的裂纹缺陷。将每个分割区域中每个聚类簇的主成分方向作为滤波方向，将每个分割区域中每个聚类簇的修正噪声影响程度作为滤波权重，根据双边滤波算法对每个分割区域中每个聚类簇对应的区域进行滤波操作，得到去噪后的电抗器表面灰度图；双边滤波算法为现有公知技术，在此不再进行赘述。请参阅图3，其示出了本发明一个实施例提供的图2去噪后的图像。由图3可以看出，经过去噪后，图像整体更加光滑，避免了图2中因为噪声影响。去噪后的电抗器表面灰度图进行阈值分割，进行缺陷识别，获得螺纹区域的裂纹缺陷，设定阈值范围为。请参阅图4，其示出了本发明一个实施例提供的检测出裂纹缺陷的示意图，图3经过阈值分割后，可获得图4所示的二值图像，二值图像中对应的像素点即为裂纹缺陷像素点，可直接映射至原图像中，进行对缺陷的定位。在对电抗器表面进行缺陷检测时，因为图像受到噪声的影响，导致无法准确地分割出完整的缺陷区域，因此通过双边滤波算法对图像进行自适应去噪，本发明根据电抗器表面灰度图的图像特点，对图像进行区域划分，然后根据不同分割区域中的纹理特征，自适应获得每个分割区域的噪声影响程度，考虑到存在裂纹缺陷的分割区域，会造成局部噪声影响程度增大的假象，因此根据裂纹缺陷的特征来对噪声影响程度进行修正，将修正后的噪声影响程度作为权重参数，并且获得最佳的滤波方向，使得对不同区域中的噪声平滑效果更好。使得去噪后的图像即保留图像中的纹理信息，又具有很好的去噪效果，根据去噪后的图像能够清晰的识别出缺陷，进而保证了电抗器的出厂质量。需要说明的是：上述本发明实施例先后顺序仅仅为了描述，不代表实施例的优劣。在附图中描绘的过程不一定要求示出的特定顺序或者连续顺序才能实现期望的结果。在某些实施方式中，多任务处理和并行处理也是可以的或者可能是有利的。本说明书中的各个实施例均采用递进的方式描述，各个实施例之间相同相似的部分互相参见即可，每个实施例重点说明的都是与其他实施例的不同之处。
