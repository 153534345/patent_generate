标题title
一种基于随机漫步的菌落自动计数方法及菌落计数器
摘要abst
本发明涉及菌落计数领域，具体涉及一种基于随机漫步的菌落自动计数方法及菌落计数器，所述的方法利用改进后的随机漫步模型对菌落图像进行平滑和增强，比其他预处理方法准确率提高了3％至5％，所述的计数方法计数的菌落尺寸为大于等于0.0085mm2，准确率的加权平均值95.5％，准确率的平均值为96.6％，利用Otsu阈值分割的方法，准确率提高了7％‑10％，本发明所述的菌落自动计数方法能够针对生长速度各异的大多数菌落，具有广泛的应用前景。
权利要求书clms
1.一种基于随机漫步的菌落计数方法，其特征在于，包括如下步骤：录入菌落图像；构建改进的随机漫步模型对步骤录入的菌落图像进行平滑；对步骤所得的平滑后菌落图像利用改进的随机漫步模型进行增强；对步骤所得的菌落图像进行分割；对步骤分割得到的菌落图像进行形态学处理；判断步骤所得的菌落状态：若菌落粘连重叠，则利用距离变换分水岭分割，计数；若菌落不粘连重叠，直接计数；步骤所述构建改进的随机漫步模型对菌落图像进行平滑的步骤如下：S1：取得目标图像Ⅰ，确定参数β和μ；S2：通过高斯函数求得边权重，构建邻接矩阵W；S3：构造对角阵D，其中对角元素为n个像素顶点的度；S4：求解公式，得到f即为平滑结果。2.如权利要求1所述的基于随机漫步的菌落计数方法，其特征在于，步骤所述的改进的随机漫步模型的具体如下：在随机漫步原模型中新增了两个顶点W和B，两个顶点与图中的任何像素点均有边，其权重与像素点的颜色信息有关，定义公式如式和式所示：ωiW＝μIidi；ωiB＝μdi；其中，Ⅰi表示亮度，di表示连接该像素边权重的总和，μ是自由参数；在模型中新添加了包含图像的颜色信息的两个顶点，漫步者从每个像素点位置出发，可达的目标顶点就增加了两个，假设图中某像素点的到达其他像素点的概率为Pn和走向新增节点的概率为Pt，则Pn、Pt值可通过公式和公式计算：改进的随机漫步模型的权重矩阵如式所示：Wsmooth是对称矩阵，连接W点的权重是其中的ωiw。，连接B点的权重是ωiB；右下角的矩阵与传统模型相同，示意相邻像素的权重；定义矩阵Dsmooth如式所示：Dsmooth是对角矩阵，对角线元素是改进模型的顶点的度；改进模型的拉普拉斯矩阵如式表示：其中，D是对角矩阵，它的对角元素是{di,…,dn}，W是原始模型的邻接权重矩阵；Dirichlet积分的离散形式如式所示：ERW＝gTLsmoothgg是含有图像平滑亮度信息的矩阵；最小化上述的能量泛函，需将其分解推导，如式所示：其中，const为一个与f无关的常数，fter和f分别表示两个顶点和图像像素点的亮度颜色；fter是顶点的亮度，为1和0，为初始时状态，简化上面的公式，得到的公式如式所示；f是从各个像素出发最先到达W的概率，也就是说f是平滑后各像素的亮度；而f是ERW最小化的唯一极值点，得到式：-μDI+D-W)f＝0式所得结果，就是平滑结果。3.如权利要求1所述的基于随机漫步的菌落计数方法，其特征在于，步骤所述的图像增强的具体操作步骤如下：S1：步骤得到图像的平滑层，也就是基础层；S2：利用原图像与图像的基础层做差值，得到图像的细节层；S3：将图像的细节层与系数k做乘积，作为增强细节层；S4:将图像的增强细节层与图像的平滑层进行合成，得到细节增强图像。4.如权利要求1所述的基于随机漫步的菌落计数方法，其特征在于，步骤所述的分割为Otsu分割。5.如权利要求1所述的基于随机漫步的菌落计数方法，其特征在于，步骤所述的形态学处理为对菌落图像做出包括膨胀、腐蚀、开、闭在内的形态学操作，使得边缘的同心圆融合成为环，满足菌落计数的要求。6.如权利要求5所述的基于随机漫步的菌落计数方法，其特征在于，步骤所述的菌落图像经形态学处理后得到计数过程中的最小菌落的理论值大小，通过以下公式计算得到：其中Sr为计数区域所对应的真实尺寸面积，P为图像中所有像素的数目，Pse为其中结构元素的像素数目，而Smin则代表过程保留的可以计数的菌落的最小理论值。7.如权利要求1所述的基于随机漫步的菌落计数方法，其特征在于，针对步骤所述的粘连重叠菌落，处理步骤如下：通过式及合适的阈值甄选出粘连重叠目标；将分割区域进行距离变换；根据距离变换，进行分水岭变换分割；达到分割理想效果。8.如权利要求1所述的基于随机漫步的菌落计数方法，其特征在于，步骤所述的分水岭分割具体操作步骤为：首先用一个较大阈值来分割目标图像，将背景与两个目标分开，其间的间隙比较宽；若缓慢地减小阈值，那么目标之间的边界会相向扩展，最后会出现目标相撞的情况；如果不让两个目标相碰或合并，在它们相遇前就给出两个目标的最终边界。9.一种实施权利要求1-8任一项所述的基于随机漫步的菌落计数方法的计数装置，其特征在于，该计数装置包括：光源模块，用于对菌株培养皿进行光照；图像获取模块，用于获取待分析细菌培养皿的拍摄图片；图像处理及控制模块，用于控制光源模块启闭，同时接收来自图像获取模块获取的图片信息，并对其进行分析计算，得到菌落的数量、大小、以及位置；图像存储模块，用于对图像处理模块处理完的图像进行存储，以及被图像处理模块调用；显示模块，用于显示图像信息；电源模块，用于对光源模块、图像获取模块、图像处理模块、以及显示模块供电。
说明书desc
技术领域本发明涉及菌落计数领域，具体涉及一种基于随机漫步的菌落自动计数方法及菌落计数器。背景技术现如今，人们对于生活品质的要求也是越来越高，食品是否安全、药物是否安全有效、生活用水是否安全可靠、生活环境是否存在污染问题等都已经成为大众高度关注的热点问题。这些问题均与微生物污染相关。菌落无疑是微生物界最重要的研究对象，它体现了各个菌种的外部特点与特性，是我们使用与掌握各个菌种的重要参考。在生物实验室中，对于细菌等微生物的研究往往需要在培养皿中培育大量的微生物，在通过控制实验变量来达到理想的实验效果，从而得出理想的实验结论。而大量统计培育出的微生物菌落无疑是对微生物研究人员的巨大考验。对于菌落的数量的统计则是各个研究的基础，现阶段的大多数菌落数量的统计都是靠人工进行的。人工统计的工作量大，需要用肉眼来查数计数，这就需要对于计数人员有着很高的要求。而且大量长时间的统计会导致人的精神不济，视力下降，不仅对于人员造成巨大的负担，也会令实验的统计准确率下降。由于实验的数量巨大，还有很多抽样的统计，这样大规模的统计与计数会对从业研究人员造成巨大的负担，数据也因此受到影响。人工统计总会消耗大量的人力物力却得不到理想的结果。随机漫步的思想最早由Karl Pearson在1905年提出。随机漫步灵感来源于“物理上布朗运动”相关的分子，也是微观粒子的运动形态的一种表述模型。它的核心概念是无法基于已发生的情况或状态来预测将来的发展步骤和方向。它是一种不规则的变动形式，在变动过程当中的每一步都是随机的。通常认为，随机漫步被假定为具有马尔可夫链性质，也即是每一步骤均有“无记忆”的特性，所谓“无记忆”是指每一次变化都不会影响其他的变化的规律。随机漫步算法常用于图像分割，使用随机漫步算法做图像分割的原理是：通过计算漫步者从未标记像素点出发首先到达已标记像素点的概率，概率的大小描述了未标记像素点和已标记像素点的可能划分到同一个区域的可能性，即亲密度。通过聚类算法对图像像素点的亲密度的值来聚类，达到图像分割的目的。信息时代的发展使得图像视频越来越普及，因而也出现了越来越多的菌落图像。菌落图像，结合计算机视觉技术，可以对于菌落计数研究给予有力的支撑。例如发明专利CN115063340A公开了一种菌落计数方法及菌落计数器，对于采集模块拍摄到的菌落图像进行预处理、将预处理后的图像进行分割和确认当前区域是否为菌落等步骤，实现放置即可自动计数，正常情况无需人工干预，但是其图像预处理方法简单，并不能适用于所有的菌落。发明人在研究过程中，对随机漫步模型进行了改进，并利用改进后的随机漫步模型对菌落图像进行平滑和增强；以此为基础，研制出了一种基于随机漫步的菌落计数方法，本发明所述的计数方法中，计数的菌落尺寸为大于等于0.0085mm2，实验准确率的加权平均值为95.5％，准确率的平均值为96.6％；本发明所述的计数方法，适用于背景不均匀、菌落数量较多、菌落变化多的图像，能够对图像的背景和菌落达到有效的分割；本发明所述的计数方法能够针对生长速度各异的大多数菌落；本发明所述的计数方法利用Otsu阈值分割的方法，对于半数以上的图像有着更良好的分割成果，准确率提高了7％至10％；本发明所述的计数方法，利用改进的随机漫步模型的图像增强，比其他预处理方法准确率提高了3％至5％。发明内容针对上述技术问题，本发明提供了一种基于随机漫步的菌落计数方法，包括如下步骤：录入菌落图像；构建改进的随机漫步模型对步骤录入的菌落图像进行平滑；对步骤所得的平滑后菌落图像利用改进的随机漫步模型进行增强；对步骤所得的菌落图像进行分割；对步骤分割得到的菌落图像进行形态学处理；判断步骤所得的菌落状态：若菌落粘连重叠，则利用距离变换分水岭分割，计数；若菌落不粘连重叠，直接计数；步骤所述构建改进的随机漫步模型对菌落图像进行平滑的步骤如下：S1：取得目标图像Ⅰ，确定参数β和μ；S2：通过高斯函数求得边权重，构建邻接矩阵W；S3：构造对角阵D，其中对角元素为n个像素顶点的度；S4：求解公式，得到f即为平滑结果。优选的，步骤所述的改进的随机漫步模型的具体如下：在随机漫步原模型中新增了两个顶点W和B，两个顶点与图中的任何像素点均有边，其权重与像素点的颜色信息有关，定义公式如式和式所示：ωiW＝μIidi；ωiB＝μdi；其中，Ⅰi表示亮度，di表示连接该像素边权重的总和，μ是自由参数。在模型中新添加了包含图像的颜色信息的两个顶点，漫步者从每个像素点位置出发，可达的目标顶点就增加了两个，假设图中某像素点的到达其他像素点的概率为Pn和走向新增节点的概率为Pt，则Pn、Pt值可通过公式和公式计算：/＞改进的随机漫步模型的权重矩阵如式所示：Wsmooth是对称矩阵，连接W点的权重是其中的ωiw。，连接B点的权重是ωiB。右下角的矩阵与传统模型相同，示意相邻像素的权重；定义矩阵Dsmooth如式所示：Dsmooth是对角矩阵，对角线元素是改进模型的顶点的度；改进模型的拉普拉斯矩阵如式表示：其中，D是对角矩阵，它的对角元素是{di,…,dn}，W是原始模型的邻接权重矩阵。Dirichlet积分的离散形式如式所示：EWW＝gTLsmoothgg是含有图像平滑亮度信息的矩阵；最小化上述的能量泛函，需将其分解推导，如式所示：其中，const为一个与f无关的常数，fter和f分别表示两个顶点和图像像素点的亮度颜色；fter是顶点的亮度，为1和0，为初始时状态，简化上面的公式，得到的公式如式所示；f是从各个像素出发最先到达W的概率，也就是说f是平滑后各像素的亮度；而f是ERW最小化的唯一极值点，得到式：-μDI+D-W)f＝0式所得结果，就是平滑结果。优选的，步骤所述的图像增强的具体操作步骤如下：S1：步骤得到图像的平滑层，也就是基础层；S2：利用原图像与图像的基础层做差值，得到图像的细节层；S3：将图像的细节层与系数k做乘积，作为增强细节层；S4:将图像的增强细节层与图像的平滑层进行合成，得到细节增强图像。优选的，步骤所述的分割为Otsu分割。优选的，所述的形态学处理为对菌落图像做出包括膨胀、腐蚀、开、闭在内的形态学操作，使得边缘的同心圆融合成为环，满足菌落计数的要求。优选的，所述菌落图像经形态学处理后得到计数过程中的最小菌落的理论值大小，通过以下公式计算得到：其中Sr为计数区域所对应的真实尺寸面积，P为图像中所有像素的数目，Pse为其中结构元素的像素数目，而Smin则代表过程保留的可以计数的菌落的最小理论值。优选的，针对步骤所述的粘连重叠菌落，处理步骤如下：A1.通过式及合适的阈值甄选出粘连重叠目标；A2.将分割区域进行距离变换；A3.根据距离变换，进行分水岭变换分割；A4.达到分割理想效果。优选的，步骤所述的分水岭分割具体操作步骤为：首先用一个较大阈值来分割目标图像，将背景与两个目标分开，其间的间隙比较宽；若缓慢地减小阈值，那么目标之间的边界会相向扩展，最后会出现目标相撞的情况；如果不让两个目标相碰或合并，在它们相遇前就给出两个目标的最终边界。本发明的第二目的是提供一种实施所述的基于随机漫步的菌落计数方法的计数装置，该计数装置包括：光源模块，用于对菌株培养皿进行光照；图像获取模块，用于获取待分析细菌培养皿的拍摄图片；图像处理及控制模块，用于控制光源模块启闭，同时接收来自图像获取模块获取的图片信息，并对其进行分析计算，得到菌落的数量、大小、以及位置；图像存储模块，用于对图像处理模块处理完的图像进行存储，以及被图像处理模块调用；显示模块，用于显示图像信息；电源模块，用于对光源模块、图像获取模块、图像处理模块、以及显示模块供电。相较于现有技术，本发明的有益效果是：本发明所述的计数方法中，计数的菌落尺寸为大于等于0.0085mm2，实验准确率的加权平均值为95.5％，准确率的平均值为96.6％；本发明所述的计数方法，适用于背景不均匀、菌落数量较多、菌落变化多的图像，能够对图像的背景和菌落达到有效的分割；本发明所述的计数方法能够针对生长速度各异的大多数菌落；本发明所述的计数方法利用Otsu阈值分割的方法，对于半数以上的图像有着更良好的分割成果，准确率提高了7％至10％；本发明所述的计数方法，利用改进的随机漫步模型的图像增强，比其他预处理方法准确率提高了3％至5％。附图说明下面结合附图对本发明的技术方案进行说明。图1基于随机漫步的菌落计数方法流程图图2基于改进随机漫步模型的图像平滑注：a.原图；b.平滑图像图3高通滤波增强与随机漫步增强注：a.高通滤波图像；b.随机漫步增强图像图4不同参数的增强效果图注：a.原图；b.k＝3；c.k＝5；d.k＝13图5全局阈值分割与Otsu阈值分割注：a.菌落灰度图像；b.基本全局阈值分割；c.Otsu阈值分割；d.菌落灰度图像；e.基本全局阈值分割；f.Otsu阈值分割图6平滑与增强图像的Otsu分割注：a.平滑图像的Otsu阈值分割；b.增强图像的Otsu阈值分割图7在算法中的形态学处理过程注：a.通过形态学处理填充孔洞区域；b.腐蚀后处理的图像图8形态学运算注：a.二值图像；b.膨胀运算结果；c.腐蚀运算结果；d.开运算结果；e.闭运算结果；图9判断的粘连重叠菌落的分水岭分割注：a.原图像；b.提取的重叠菌落；c.分水岭分割结果图10由于阈值选取不当所造成的过度分割注：a.原图；b.过度分割图图11菌落计数结果的示意图注：a.实验1；b.实验3；c.实验5图12郭晓敏选取的菌落种类的菌落图像注：a.示意图a的分割结果；b.示意图b的分割结果图13分割结果注：a.示意图a的分割结果；b.示意图b的分割结果图14两种菌落图像的灰度直方图的分布注：a.示意图a的分割结果；b.示意图b的分割结果具体实施方式下面将对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。实施例一、一种基于随机漫步的菌落计数方法流程图如图1所示，具体包括如下步骤：1.录入菌落图像2.构建改进的随机漫步模型对步骤1录入的菌落图像进行平滑所述构建改进的随机漫步模型对菌落图像进行平滑的步骤如下：S1：取得目标图像Ⅰ，确定参数β和μ；S2：通过高斯函数求得边权重，构建邻接矩阵W；S3：构造对角阵D，其中对角元素为n个像素顶点的度；S4：求解公式，得到f即为平滑结果。所述的改进的随机漫步模型的具体如下：在随机漫步原模型中新增了两个顶点W和B，两个顶点与图中的任何像素点均有边，其权重与像素点的颜色信息有关，定义公式如式和式所示：ωiW＝μIidi；ωiB＝μdi；其中，Ⅰi表示亮度，di表示连接该像素边权重的总和，μ是自由参数。在模型中新添加了包含图像的颜色信息的两个顶点，漫步者从每个像素点位置出发，可达的目标顶点就增加了两个，假设图中某像素点的到达其他像素点的概率为Pn和走向新增节点的概率为Pt，则Pn、Pt值可通过公式和公式计算：改进的随机漫步模型的权重矩阵如式所示：Wsmooth是对称矩阵，连接W点的权重是其中的ωiw。，连接B点的权重是ωiB。右下角的矩阵与传统模型相同，示意相邻像素的权重；定义矩阵Dsmooth如式所示：Dsmooth是对角矩阵，对角线元素是改进模型的顶点的度；改进模型的拉普拉斯矩阵如式表示：其中，D是对角矩阵，它的对角元素是{di,…,dn}，W是原始模型的邻接权重矩阵。Dirichlet积分的离散形式如式所示：ERW＝gTLsmoothgg是含有图像平滑亮度信息的矩阵；最小化上述的能量泛函，需将其分解推导，如式所示：其中，const为一个与f无关的常数，fter和f分别表示两个顶点和图像像素点的亮度颜色；fter是顶点的亮度，为1和0，为初始时状态，简化上面的公式，得到的公式如式所示；f是从各个像素出发最先到达W的概率，也就是说f是平滑后各像素的亮度；而f是ERW最小化的唯一极值点，得到式：-μDI+D-W)f＝0式所得结果，就是平滑结果。基于改进随机漫步模型的图像平滑如图2所示，β为20，μ为0.005。a为原图，是一幅典型的实验用的菌落图像，b为平滑后的图像。观察b图不难发现基于改进型的随机漫步模型的平滑对于边缘的保持有着良好的效果，而平滑的效果也比较好，内部纹理细节可以很好的平滑。3.对平滑后菌落图像利用改进的随机漫步模型进行增强具体操作步骤如下：S1：步骤2得到图像的平滑层，也就是基础层；S2：利用原图像与图像的基础层做差值，得到图像的细节层；S3：将图像的细节层与系数k做乘积，作为增强细节层；S4:将图像的增强细节层与图像的平滑层进行合成，得到细节增强图像。将原图像进行三通道高通滤波得到的图像如图3所示，可以清晰地看出随机漫步增强对于原图像的色彩信息保留效果原好于高通滤波增强的图像的效果，所以我们采用了随机漫步增强效果。可以看出，增强的效果直接受参数k影响。随着参数k的值选取的增大，而细节增强的强度也变大。图像增强的确将目标菌落的边缘与背景区域区划增大，但是也导致了图像的噪声增大。图4展示了基于改进随机漫步模型的图像平滑的图像增强示意图。图4b、c、d分别展示了在不同参数影响下的图像增强的效果。通过图4a与图4b的比较，我们可以看出，增强图片明显地将背景图像增强了一点，而对于菌落的边缘也有着显著的增强效果，尤其是对于有粘连区域的边缘增强有明显效果。图4c与图4a比较不难发现，与图4b类似，增强了菌落的边缘，包括粘连菌落的边缘。图4d与图4a比较可以发现，各种菌落的边缘效果增强明显，菌落内的细节纹理，也有大幅度的增强。但是图4d的背景区域有过于明显的亮斑产生，这大大加大了后续分割的难度。通过观察可以发现，对于图4b与图4c，增强的结果基本可以分组分割所需，对于边缘的增强效果明显，而对于背景杂质的增强有限，可以进行分割。但是对于图4d来说，背景的增强过大了，已经出现了大量的亮斑，这种亮斑是由增强带来的，此时由增强所引入的干扰过大，造成无法分割的后果。所以k＝13的增强并不可取，由此可以得知，只有适当地选取参数k，才可以达到理想的增强效果。4.对菌落图像进行分割所述的分割为Otsu分割，计算的步骤如下：记t为目标与背景的分割阈值，目标区域像素占比记为ω0，平均灰度值记为u0；背景的像素占比记为ω1，平均灰度值记为u1；从最小到最大灰度值遍历t，当ti使得g＝ω0/2+ω1/2最大。此时获得的ti即为分割的最佳阈值，其中u为图像的总平均灰度值。该方法的本质就是计算类间方差值，方差是用来衡量灰度的分布均匀性的数据，方差越大，说明目标区域与背景区域的差别越大，当类间方差值最大时，分割准确的概率最大。图5展示了两幅菌落的灰度图像分别通过基本闽值分割与Otsu阈值分割的所得出的效果。通过图5a、b、c可以看出，两种分割的效果均比较理想。通过比较图5b、c，可以看出两者的分割只有在边缘上有着细微的差别。在这种情形下，两种分割方法是都可以使用的，都将目标区域与背景隔离开来，对后续的计数研究都有着有力的支撑，而图5d、e、f则显示出了截然不同的情况。可以观察到图5f的分割结果基本理想，基本将目标区域与背景分离出来，可以通过再操作提取更多数据。图5e的分割结果对于实验来说是不可用的，无法在其中分辨出清晰的目标区域与背景，更无法利用来计数。通过这组实验不难发现，全局阈值分割方法的局限性比较大，只能针对目标与背景灰度差异比较明显的图像，相对简单的情况下才会有比较理想的效果。而Otsu阂值分割则可以应用于大多数情况下，均会有比较理想的效果。通过大量实验的验证，Otsu阈值的分割也比较适合这些类图像的分割。在本文的研究中的实验的数据比较，利用Otsu阈值分割的计数在50％以上的情况下，有着更高的准确率。通过实验的论证，准确率可以提高7到10个百分点。图6a是图4b的Otsu分割结果，图6b是图4c的Otsu分割结果。对比发现虽然两种算法的核心数学思想相同，但是产生的效果却截然不同。图6a展示了平滑图像的分割效果，可以看出，图像中几乎很少有细小的区域，而且大型菌落的内部没有孔洞，粘连菌落的边界效果区分并不明显。图6b为增强图像的分割效果，相较于a图，很多细小区域出现并且清晰，大型菌落内部含有孔洞，粘连菌落的边缘区分效果明显。通过上述分析，从初步分割效果图上来看，平滑的效果图明显优于增强效果图，去除噪声干扰，区域内部整齐，这都是平滑的优势。本申请中对于菌落图像的所有操作的最终目的都是计算图像中的菌落个数。对于计数本身来说，准确率必然是计数的一个最重要最基本的要素。尽管平滑处理的效果图很好，有利于分割，但是由于去掉噪声的同时去除了很多的细小菌落。而这一操作是不可逆的，也就是说无法通过后续处理将那些已经去除掉的菌落重新补充回来，这对于必要数据的保留来说是致命的。虽然增强图像的分割从效果上来说并不如平滑好，但是我们可以通过后续处理来弥补增强图像造成的不足。平滑处理所造成的准确率降低的情况是不可逆的。由此看出，基于改进型随机漫步的平滑处理对于准确率的保持并不算特别的友善，所以我们选择基于改进随机漫步模型的增强处理。通过实验的验证，基于随机漫步模型的图像增强处理可以令计数的准确率得到显著的提高，相较于高斯平滑的处理方式，准确率可以提高三到五个百分点。这个准确率的提高相较于超过百分之八十水平的计数方法来说，属于水平较大的提高。5.菌落图像形态学处理所述的形态学处理为对菌落图像做出包括膨胀、腐蚀、开、闭在内的形态学操作，使得边缘的同心圆融合成为环，满足菌落计数的要求。膨胀与腐蚀从形式上看，膨胀就是对图像进行“加粗”和“拉长”，使图像扩张。腐蚀则是对图像进行“变细”和“变短”，使图像收缩。本质上，膨胀和腐蚀都是利用结构元素对于图像的每个像素进行操作的算法。在结构元素B平移z后形成的击中集合A的所有x所构成的集合称为集合A被集合B膨胀的结果。膨胀的数学表达式如下：在结构元素B平移z后形成的包含于集合A的所有x所组成集合称为集合A被集合B腐蚀的结果。腐蚀的数学表示如下：形态学中的膨胀可以将图像边缘的背景像素合并到一起，使目标区域增大，而在目标区域的内部小于结构元素的孔洞也可以通过膨胀的方法进行填充。形态学中的腐蚀的作用是去掉图像边缘的孤立边界点，可以消除小于结构元素的噪声、毛刺等干扰，从而得到理想的目标区域。膨胀和腐蚀是图像处理中形态学中的两个最基本也是最重要的运算，通过他们的组合可以形成许多其他运算，从而获得相应的算法。需要注意的是，膨胀和腐蚀并不是逆运算。通过图7a与图6b的对比可以发现，合理利用形态学闭合操作，可以顺利的将非预期的孔洞进行填充操作。相较于图6b，填充后的图像中的菌落区域更明显，而且闭合可以更好的分割出来菌落区域，从而准确的进行菌落计数。图7b为7a的腐蚀处理图。由于预处理选择的增强处理，可以看出引入了很多了细小的非目标图像，这就需要利用形态学手段对图像进行处理。图6b则是利用形态学中的腐蚀处理，通过观察两个图的左下方区域，可以明显地看出，通过腐蚀处理，去掉了不满足条件的细小干扰。处理过后的图像几乎就可以满足菌落计数的要求了。菌落计数从实际意义出发，就是对于菌落图像中存在的菌落进行计数，但是菌落图像也是图像，它有着图像的基本属性。图像本身有个特性，图像本身无法表达小于图像最基本单位的信息。所以尽管没有定义，但是菌落图像所代表的菌落是有一定的定义的，这种定义在实际应用中，往往是体现于具体空间尺寸的。例如我们在一幅菌落图像中所能识别的最小菌落只是一个像素所能表示的某一个菌落。但是实际中可能出现比一个像素所代表的菌落更小的菌落，所以这就表明了菌落图像的局限性。对于通过菌落图像的计数应当是有一定的尺寸定义才是合理的。对于菌落来说，其本身属于微生物范畴，所以总会有很小的菌落存在。但是过于小的菌落本身各种生物特性都过低，在大多数实验中的影响很小，所以过于小的菌落在某种意义上可以忽略不计。对于菌落图像计数来说，应当有着一定的尺寸说明来表达被去除的最大面积的菌落区域，也就是计数中可以计入的最小的菌落。腐蚀操作在这里是直接影响所保留菌落的最小的尺度，也就是说对腐蚀的结构元素的选取可以直接影响可计数的最小菌落。所以对于这些关键操作的参数的选取，应当根据计数所定义的尺度来选取与其相匹配的参数。所述菌落图像经形态学处理后得到计数过程中的最小菌落的理论值大小，通过以下公式计算得到：其中Sr为计数区域所对应的真实尺寸面积，P为图像中所有像素的数目，Pse为其中结构元素的像素数目，而Smin则代表过程保留的可以计数的菌落的最小理论值。本次实验选用的结构元素是半径为2的扁平圆形结构元，通过式4.2可以算出，实验中计数的最小菌落的尺寸大于0.0085mm 2。对于一个菌落计数系统，计数最小菌落应为一个计数系统的标准参数，这就是计数系统的最小菌落识别面积。这也是众多菌落图像的计数系统中，被众人忽略的一个重要参数。对于计数系统来说，若没有最小菌落识别面积那是毫无意义的，而式4.2中的Smin就是我们计数系统中的最小菌落识别面积。开运算与闭运算与前面提到的膨胀扩大图像，腐蚀缩小图像不同，开运算可使目标轮廓更加光滑，可以将狭窄的连接断开，去除细小的突出物。闭运算也可以使目标轮廓变得光滑，但不同的是，闭运算会连接上狭小的缺口，填充小洞，填补轮廓缝隙。使用结构元素日对集合A进行开运算，表示为A○B，定义为：由上式可以看出，B对A的开运算就是先用B对A进行腐蚀运算，再用B对其结果作膨胀运算。结构元素B对集合A的闭运算，表示为A·B，定义如下：上式表明，B对A的闭运算就是先用B对A进行膨胀运算，再用B对其结果作腐蚀运算。开运算可以对图像进行平滑处理。通过选取合适的结构元素的开运算可以磨光内孔边缘，闭运算可以连接临近的目标区域，消除图像中细小的孔洞，填平缝隙，物体边缘也会更平滑。根据不同的实际情况，选取合适的形态学运算，通常会得到十分理想的结果。形态学运算如图8所示。如图8，所有形态学运算选取的结构元素均为扁平菱形结构元素，从结构元原点到菱形最远点的距离为4像素单位。图b为膨胀运算结果，通过图a与图b对比可以观察出，右侧的空洞目标区域几乎全部被填满，而且各个目标区域比原图的大小有明显的增大。图c为腐蚀运算，通过图a与图c的对比，细小像素均被剔除，各目标区域均减小，但是形状类型没有大幅度的改变。通过图a与图d的对比，细小像素被剔除，目标区域的边缘变得圆滑，目标区域的大小基本不变化。通过图a与图e对比，目标区域内的孔洞被填充，狭窄的细缝被连接，目标区域大小基本不变，边缘更圆滑，形状特性基本不变。通过图b与图c对比可以看出一个膨胀增大了细小区域，腐蚀去除了细小区域：膨胀增大了目标区域，腐蚀缩小了目标区域。通过图d与图e的比较可以观察出，开运算与闭运算并不会影响目标区域的大小，而且会使目标区域的边界变得更加光滑，圆形度变高。但是开运算会去除小于结构元素的区域，闭运算并不会，开运算会打开细小连接的两个区域，闭运算会联结两个邻近的区域。通过实验我们发现，合理地运用几个形态学基本运算可以得到理想的分割效果。对于不同情况的处理，选择合适的运算或者运算序列是非常必要的。这一实验展示了形态学运算的强大功能。6.判断菌落状态及计数若菌落粘连重叠，则利用距离变换分水岭分割，计数；若菌落不粘连重叠，直接计数；步骤所述的分水岭分割具体操作步骤为：首先用一个较大阈值来分割目标图像，将背景与两个目标分开，其间的间隙比较宽；若缓慢地减小阈值，那么目标之间的边界会相向扩展，最后会出现目标相撞的情况；如果不让两个目标相碰或合并，在它们相遇前就给出两个目标的最终边界。初始阈值选取非常重要。不适当的阈值很容易导致过度分割。应用分水岭分割算法可以用来分割复杂的连通区域，相较于其他形态学分割手段，分水岭分割的效果更加全面，也更加理想，对于粘连菌落这种极度复杂的情况，通过对分水岭分割算法进行合理利用，也可出现理想分割效果。直接利用分水岭变换容易造成过度分割导致了菌落计数的准确率下降。合理的利用距离变换可以使分水岭达到理想效果，从而实现粘连与重叠菌落分割。当分割对象明确时，我们将分割对象提取出来在进行分割可以更好的进行针对分割，达到提高准确率的目的。利用菌落的生长特性，可以得知，几乎所有的菌落生长后的形状都是类圆形。当我们将类圆形作为菌落的基本属性时，可以通过圆形度的值来将单独菌落提取出来。由于菌落只有单独的与粘连重叠两种情况时，单独菌落的提取其实就是粘连重叠菌落的提取。式为圆形度公式，e为圆形度参数，S为区域面积，l为区域周长。将菌落图像分割成各个独立的闭合区域时，对于每个区域进行圆形度计算，当圆形度高于我们自设es时，我们认为这属于类圆形区域，也就是单独菌落区域。当圆形度低于es时，我们认为这属于粘连重叠菌落区域。将这些区域分离，进行单独分割。如图9所示，通过选取的粘连重叠菌落的原图为b，而经过分割后的图像为c。可以明显地看出通过距离变换的协助，我们可以顺利地利用分水岭进行合理分割。将一些粘连重叠的菌落进行分离，从而将粘连重叠菌落进行计数，达到准确计数的目的。所以我们针对粘连重叠菌落的处理步骤如下：1.通过式及合适的阈值甄选出粘连重叠目标；2.将分割区域进行距离变换；3.根据距离变换，进行分水岭变换分割；4.达到分割理想效果。通过上述方式，我们成功地将粘连重叠菌落进行分割，从而提高了菌落计数的准确率。由图10可以看出，分水岭阈值的不适当选择直接导致图像过度分割，这对于分割的结果会造成不可逆的区域信息丢失，这说明了分水岭分割的一大弊端，只有在恰当地选取阈值，同时设置良好的分割参数的基础上通过分水岭阈值分割方法才会得到理想的效果。而如何选取合适的阈值，如何调整分割参数，对于分割算法又提出了一个新的难题。在选取分割算法的过程中不光要注重于分割效果，也要考虑到分割算法复杂程度，因为当算法的复杂性到达一定程度时，也必然导致算法的适应程度的下降，也就是说，当算法的复杂程度过高时，那么该算法的普遍适应率可能大幅度地降低。实施例二、计数系统准确率图11展示了三幅通过本文算法提供的采用本文菌落计数的示意图。通过图示，可以发现我们的算法已经达到目的，能准确地提取图像中各个菌落，并完成计数。三幅图的菌落密度数量包括主体颜色，背景颜色均不相同。对于背景的分布也不尽相同，这无疑是对菌落计数的一个巨大挑战。本文应用先进的随机漫步技术，成功有效地提取了菌落图像中的菌落部分，从而得到良好的结果。对于计数系统来说，准确率是计数系统中最重要的一个指标，而统计一个计数系统的准确率需要大量的数据进行核对与比较。从众多实验中，我们抽取了5组数据，这5组数据包含了菌落数量差别，菌落颜色分布差别，背景差别等，非常具有代表性。表1菌落计数的准确率表1记录了4组实验中得到的结论数据，其中计数的菌落尺寸为大于等于0.0085mm2。不难发现，如实验的一般规律，菌落越多的时候，造成的计数误差可能会增大，但是计数准确率并不会降低。对于算法的准确率我们不应当直接取各个图像计数的平均值来确定算法的准确率。应当采取求其加权平均值的方式来确定准确率。其中P为平均准确率，pi为实验准确率，ki为实验中菌落数，通过求加权平均值的办法可以得到更加准确可信的准确率。通过上述实验，代入式5.1可以得出实验的准确率的加权平均值95.5％，而准确率的平均值为96.6％。尽管准确率的平均值的数值可能较高，但是加权平均值的可信度要更高，也更合理，所以我们认为准确率的加权平均值为准确率的有效值。实施例三、与传统方法的比较选取郭晓敏的实验方法为传统实验方法，作为对照，具体方法见文献。如图12所示，为两幅传统菌落计数选取的菌落种类。图12的两幅菌落图像有着背景区域明显，菌落颜色固定，菌落大小固定等特征。这些特征降低了分割难度，增强了分割效果。我们用本文方法对两幅图分别进行实验。图13为我们方法分割的结果，相较于之前的菌落图像，分割结果有着显著的提高，而且菌落粘连重叠的结果也很少。第一幅图我们计算的结果为41，准确率为100％，误差率为0％；第二幅图的计算结果为22，准确率为100％，误差率0％。图13的示例并非为了说明本文的方法优势更大，只是在实验过程中方法设计过程注意了对于不同种菌落图像的适应，而所举出的例子也是相对复杂的菌落图像。所以对于相对简单的菌落图像，也有着比较理想的准确率。我们再用传统的方法，对于我们实验使用的菌落图像进行计算。表2传统算法的菌落计数的准确率由于预处理选用的高斯平滑，对于本文菌落图像的分割无法完成，对于大多数图像无法计数。如表2，对于相对菌落少的图像，背景相对均匀，菌落的变化少，传统方法还可以进行一定的计数，当处理相对复杂，背景不均匀的图像时，传统方法已无法进行有效分割，图像的背景与菌落未能达到有效分割，从而导致菌落的计数并没有实际的意义。但是对于情况简单的菌落图像，传统方式由于算法简便，对设备要求较低，计算速度较快，还是有一定的意义的。图14显示了两种菌落图像的灰度直方图分布。可以看出就算转换成灰度图像，传统方法选取的菌落图像的灰度值比较集中，边缘值比较少，也就是说目标的菌落与背景差距大，菌落区域与菌落区域基本有一致的特性。本文选取的菌落图像中，灰度图的灰度值分布较广，背景色差也比较大，菌落区域间的一致性特征比较少。这直接导致了两种菌落图像的分割难度不同，本文的菌落图像的分割难度大的多。但是大多数菌落的生长都是随机的，不是所有菌落的生长速度均相同，而菌落大小相同的情况也是极少数。在大多数应用中，应当采用本文这种能够针对大多数情况的方法。其中，利用Otsu阈值分割的方法得到的分割图像进行处理，对于半数以上的图像有着更良好的分割成果，准确率提高了7％至10％。而利用随机漫步模型的图像增强，比其他预处理方法准确率提高了3％至5％。而传统计数方法并没有提出计数分辨率的问题，这使得一个系统的控制量不足，会大大影响计数系统的可靠性。当图像复杂，出现肉眼不可看到的菌落时，系统能否通过定量的控制来调节计数的特性，也是这个系统是否稳定的一个特性。表3两种菌落计数方法的比较/＞表3介绍了两种菌落计数方法的异同点。两种方法各有优劣，大多数情况下本文的算法有着巨大的优势，而传统算法只在少数情况下有着使用的必要。当要计数的菌落形式结构比较简单，而且没有误差分析要求时，传统算法仍有其优势。由于它算法结构简单，所以对于设备硬件的物理配置要求低，更廉价。但不适用于情况复杂，误差分析要求高的时候。本文的实验均是在matlab环境下实现的。实施例四、一种实施所述的基于随机漫步的菌落计数方法的计数装置所述的计数装置包括：光源模块，用于对菌株培养皿进行光照；图像获取模块，用于获取待分析细菌培养皿的拍摄图片；图像处理及控制模块，用于控制光源模块启闭，同时接收来自图像获取模块获取的图片信息，并对其进行分析计算，得到菌落的数量、大小、以及位置；图像存储模块，用于对图像处理模块处理完的图像进行存储，以及被图像处理模块调用；显示模块，用于显示图像信息；电源模块，用于对光源模块、图像获取模块、图像处理模块、以及显示模块供电。利用所述的计数装置对菌落进行全自动的计数。综上所述，本发明提供了一种基于随机漫步的菌落计数方法，本发明所述的计数方法中，计数的菌落尺寸为大于等于0.0085mm2，实验的准确率的加权平均值95.5％，而准确率的平均值为96.6％。尽管准确率的平均值的数值可能较高，但是加权平均值的可信度要更高，也更合理，所以我们认为准确率的加权平均值为准确率的有效值。对于相对菌落少的图像，背景相对均匀，菌落的变化少，传统方法还可以进行一定的计数，当处理相对复杂，背景不均匀的图像时，传统方法已无法进行有效分割，图像的背景与菌落未能达到有效分割，从而导致菌落的计数并没有实际的意义。但是对于情况简单的菌落图像，传统方式由于算法简便，对设备要求较低，计算速度较快。本发明所述的方法能够针对生长速度各异的大多数菌落。利用Otsu阈值分割的方法得到的分割图像进行处理，对于半数以上的图像有着更良好的分割成果，准确率提高了7％至10％。而利用随机漫步模型的图像增强，比其他预处理方法准确率提高了3％至5％。而传统计数方法并没有提出计数分辨率的问题，这使得一个系统的控制量不足，会大大影响计数系统的可靠性。当图像复杂，出现肉眼不可看到的菌落时，系统能否通过定量的控制来调节计数的特性，也是这个系统是否稳定的一个特性。
