标题title
融合几何信息的软注意力网络的血管分割方法
摘要abst
一种融合几何信息的软注意力网络的血管分割方法，利用测地距离图获取血管结构信息，采用水平集函数获取血管图像上各点的位置信息，同时使用Heaviside函数生成血管内各点的权重分布。进一步，通过融合几何信息的方式，将权重分布与注意力分布结合，形成一个软注意力网络模块。将几何信息融入到软注意力网络的血管分割方法，能够很好的抑制分割泄露，解决分割过程中血管不连续的问题，使血管分割更加迅速、精确。
权利要求书clms
1.一种融合几何信息的软注意力网络的血管分割方法，其特征在于，包括：如下步骤：a)收集n名患者的冠状动脉血管图像，得到数据集I，I＝{I1,I2,...,Ii,...,In}，其中Ii为第i名患者的冠状动脉血管图像，i∈{1,2,...,n}；b)对数据集I进行预处理，得到预处理后的数据集If，If＝{If1,If2,...,Ifi,...,Ifn}，其中Ifi为第i名患者的预处理后的冠状动脉血管图像；c)将预处理后的数据集If划分为训练集train、验证集val、测试集test；d)设置由编码器、中间结构层、解码器构成的网络结构，将训练集train中第i名患者的预处理后的冠状动脉血管图像Ifi输入到网络结构的解码器中，输出得到特征图Ifm4；e)将特征图Ifm4输入到网络结构的中间结构层中，输出得到特征图Ifc1；f)将特征图Ifc1输入到解码器中，输出得到分割图像Iend；g)计算损失函数L；h)使用AdamW作为优化器，根据损失函数L使用反向传播来优化步骤d)中网络结构，得到优化后的网络结构；i)将测试集test中第i名患者的预处理后的冠状动脉血管图像输入到优化后的网络结构中，得到分割图像I′end。2.根据权利要求1所述的融合几何信息的软注意力网络的血管分割方法，其特征在于：步骤a)中在使用X射线血管造影图像的自动基于区域的冠状动脉疾病诊断公开挑战赛中收集200名患者的冠状动脉血管图像，得到数据集I；步骤b)中在python中导入Augmentor包，使用Augmentor包对数据集I依次进行旋转、弹性形变、增强亮度、增强对比度操作，得到增强后的数据集I′，I′＝{I′1,I′2,...,I′i,...,I′n}，将增强后的数据集I′进行Overlap-tile策略得到预处理后的数据集If。3.根据权利要求1所述的融合几何信息的软注意力网络的血管分割方法，其特征在于：将预处理后的数据集If按照6:2:2的比例划分为训练集train、验证集val、测试集test。4.根据权利要求1所述的融合几何信息的软注意力网络的血管分割方法，其特征在于，步骤d)包括如下步骤：d-1)编码器由第一卷积单元、第二卷积单元、第一最大池化层、第三卷积单元、第四卷积单元、第二最大池化层、第五卷积单元、第六卷积单元、第三最大池化层、第七卷积单元、第八卷积单元、第四最大池化层构成；d-2)编码器的第一卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将训练集train中第i名患者的预处理后的冠状动脉血管图像Ifi输入第一卷积单元中，输出得到特征图Ifi1-1；d-3)编码器的第二卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifi1-1输入第二卷积单元中，输出得到特征图Ife1；d-4)将特征图Ife1输入到编码器的第一最大池化层中，输出得到特征图Ifm1；d-5)编码器的第三卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm1输入第三卷积单元中，输出得到特征图Ife2-1；d-6)编码器的第四卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ife2-1输入第四卷积单元中，输出得到特征图Ife2；d-7)将特征图Ife2输入到编码器的第二最大池化层中，输出得到特征图Ifm2；d-8)编码器的第五卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm2输入第五卷积单元中，输出得到特征图Ife3-1；d-9)编码器的第六卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ife3-1输入第六卷积单元中，输出得到特征图Ife3；d-10)将特征图Ife3输入到编码器的第三最大池化层中，输出得到特征图Ifm3；d-11)编码器的第七卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm3输入第七卷积单元中，输出得到特征图Ife4-1；d-12)编码器的第八卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ife4-1输入第八卷积单元中，输出得到特征图Ife4；d-13)将特征图Ife4输入到编码器的第四最大池化层中，输出得到特征图Ifm4。5.根据权利要求4所述的融合几何信息的软注意力网络的血管分割方法，其特征在于：步骤d-2)中第一卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-3)中第二卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-4)中第一最大池化层设置池化窗口为2×2；步骤d-5)中第三卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-6)中第四卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-7)中第二最大池化层设置池化窗口为2×2；步骤d-8)中第五卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-9)中第六卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-10)中第三最大池化层设置池化窗口为2×2；步骤d-11)中第七卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-12)中第八卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0，步骤d-13)中第四最大池化层设置池化窗口为2×2。6.根据权利要求4所述的融合几何信息的软注意力网络的血管分割方法，其特征在于，步骤e)包括如下步骤：e-1)中间结构层由第一卷积单元、第二卷积单元构成；e-2)中间结构层的第一卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm4输入到第一卷积单元中，输出得到特征图Ifc1-1；e-3)中间结构层的第二卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifc1-1输入到第二卷积单元中，输出得到特征图Ifc1。7.根据权利要求6所述的融合几何信息的软注意力网络的血管分割方法，其特征在于：步骤e-2)中第一卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤e-3)中第二卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0。8.根据权利要求6所述的融合几何信息的软注意力网络的血管分割方法，其特征在于，步骤f)包括如下步骤：f-1)解码器由第一融合集合信息的软注意力模块、第一上采样层、第一特征融合层、第一卷积单元、第二卷积单元、第二融合几何信息的软注意力模块、第二上采样层、第二特征融合层、第三卷积单元、第四卷积单元、第三融合集合信息的软注意力模块、第三上采样层、第三特征融合层、第五卷积单元、第六卷积单元、第四融合几何信息的软注意力模块、第四上采样层、第四特征融合层、第七卷积单元、第八卷积单元、第九卷积单元、第十卷积单元构成；f-2)解码器的第一融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifc1输入带第一卷积层中，输出得到特征图Ifd1-1-1，将特征图Ife4输入到第二卷积层中，输出得到特征图Ifd1-1-2，将特征图Ifd1-1-1与特征图Ifd1-1-2相加得到特征图Ifd1-1-3，将特征图Ifd1-1-3输入到Relu激活函数中，输出得到特征图Ifd1-1-4，将特征图Ifd1-1-4输入到第三卷积层中，输出得到特征图Ifd1-1-5，将特征图Ifd1-1-5输入到Siogmoid函数中，输出得到特征图Ifd1-1-6，将特征图Ifd1-1-6输入到几何信息计算层中，利用阈值法将Ifd1-1-6分为前景种子点集S1和背景种子点集R1，对前景种子点集S1使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R1使用快速行进算法计算得到测地线距离图Ur，x1为特征图Ifd1-1-6上的特征值，x1∈Ω1，Ω1为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω1上的点在血管内部，表示为当M＞0时表示图像域Ω1上的点在血管外部，表示为/＞当M＝0时表示图像域Ω1上的点在血管壁上，表示为/＞通过公式/＞计算得到水平函数集/＞y1为血管边界上的点，||·||2为欧氏距离，将水平函数集输入平滑Heaviside函数，通过公式/＞计算得到特征图Ifd1-1-7，式中k为常数，将特征图Ifd1-1-6与特征图Ifd1-1-7进行特征融合，得到特征图Ifd1-1-8，将特征图Ifd1-1-8输入到上采样层中，输出得到特征图Ifd1-1-9，将特征图Ife4与特征图Ifd1-1-9进行特征融合，得到特征图Ifd1-1；f-3)将特征图Ifc1解码器的第一上采样层中，输出得到特征图Ifu1；f-4)将特征图Ifu1与特征图Ifd1-1输入到解码器的第一特征融合层中，输出得到特征图Ifd1-2；f-5)解码器的第一卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd1-2输入到第一卷积单元中，输出得到特征图Ifd1-2-1；f-6)解码器的第二卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd1-2-1输入到第二卷积单元中，输出得到特征图Ifd1；f-7)解码器的第二融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifd1输入带第一卷积层中，输出得到特征图Ifd2-1-1，将特征图Ife3输入到第二卷积层中，输出得到特征图Ifd2-1-2，将特征图Ifd2-1-1与特征图Ifd2-1-2相加得到特征图Ifd2-1-3，将特征图Ifd2-1-3输入到Relu激活函数中，输出得到特征图Ifd2-1-4，将特征图Ifd2-1-4输入到第三卷积层中，输出得到特征图Ifd2-1-5，将特征图Ifd2-1-5输入到Siogmoid函数中，输出得到特征图Ifd2-1-6，将特征图Ifd2-1-6输入到几何信息计算层中，利用阈值法将Ifd2-1-6分为前景种子点集S2和背景种子点集R2，对前景种子点集S2使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R2使用快速行进算法计算得到测地线距离图Ur，x2为特征图Ifd2-1-6上的特征值，x2∈Ω2，Ω2为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω2上的点在血管内部，表示为当M＞0时表示图像域Ω2上的点在血管外部，表示为/＞当M＝0时表示图像域Ω2上的点在血管壁上，表示为/＞通过公式/＞计算得到水平函数集/＞y2为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式/＞计算得到特征图Ifd2-1-7，将特征图Ifd2-1-6与特征图Ifd2-1-7进行特征融合，得到特征图Ifd2-1-8，将特征图Ifd2-1-8输入到上采样层中，输出得到特征图Ifd2-1-9，将特征图Ife3与特征图Ifd2-1-9进行特征融合，得到特征图Ifd2-1；f-8)将特征图Ifd2-1解码器的第二上采样层中，输出得到特征图Ifu2；f-9)将特征图Ifu2与特征图Ifd2-1输入到解码器的第二特征融合层中，输出得到特征图Ifd2-2；f-10)解码器的第三卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd2-2输入到第三卷积单元中，输出得到特征图Ifd2-2-1；f-11)解码器的第四卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd2-2-1输入到第四卷积单元中，输出得到特征图Ifd2；f-12)解码器的第三融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifd2输入带第一卷积层中，输出得到特征图Ifd3-1-1，将特征图Ife2输入到第二卷积层中，输出得到特征图Ifd3-1-2，将特征图Ifd3-1-1与特征图Ifd3-1-2相加得到特征图Ifd3-1-3，将特征图Ifd3-1-3输入到Relu激活函数中，输出得到特征图Ifd3-1-4，将特征图Ifd3-1-4输入到第三卷积层中，输出得到特征图Ifd3-1-5，将特征图Ifd3-1-5输入到Siogmoid函数中，输出得到特征图Ifd3-1-6，将特征图Ifd3-1-6输入到几何信息计算层中，利用阈值法将Ifd3-1-6分为前景种子点集S3和背景种子点集R3，对前景种子点集S3使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R3使用快速行进算法计算得到测地线距离图Ur，x3为特征图Ifd3-1-6上的特征值，x3∈Ω3，Ω3为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω3上的点在血管内部，表示为当M＞0时表示图像域Ω3上的点在血管外部，表示为/＞当M＝0时表示图像域Ω3上的点在血管壁上，表示为/＞通过公式/＞计算得到水平函数集/＞y3为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式/＞计算得到特征图Ifd3-1-7，将特征图Ifd3-1-6与特征图Ifd3-1-7进行特征融合，得到特征图Ifd3-1-8，将特征图Ifd3-1-8输入到上采样层中，输出得到特征图Ifd3-1-9，将特征图Ife2与特征图Ifd3-1-9进行特征融合，得到特征图Ifd3-1；f-13)将特征图Ifd3-1解码器的第三上采样层中，输出得到特征图Ifu3；f-14)将特征图Ifu3与特征图Ifd3-1输入到解码器的第三特征融合层中，输出得到特征图Ifd3-2；f-15)解码器的第五卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd3-2输入到第五卷积单元中，输出得到特征图Ifd3-2-1；f-16)解码器的第六卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd3-2-1输入到第四卷积单元中，输出得到特征图Ifd3；f-17)解码器的第四融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifd3输入带第一卷积层中，输出得到特征图Ifd4-1-1，将特征图Ife1输入到第二卷积层中，输出得到特征图Ifd4-1-2，将特征图Ifd4-1-1与特征图Ifd4-1-2相加得到特征图Ifd4-1-3，将特征图Ifd4-1-3输入到Relu激活函数中，输出得到特征图Ifd4-1-4，将特征图Ifd4-1-4输入到第三卷积层中，输出得到特征图Ifd4-1-5，将特征图Ifd4-1-5输入到Siogmoid函数中，输出得到特征图Ifd4-1-6，将特征图Ifd4-1-6输入到几何信息计算层中，利用阈值法将Ifd4-1-6分为前景种子点集S4和背景种子点集R4，对前景种子点集S4使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R4使用快速行进算法计算得到测地线距离图Ur，x4为特征图Ifd4-1-6上的特征值，x4∈Ω4，Ω4为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω4上的点在血管内部，表示为当M＞0时表示图像域Ω4上的点在血管外部，表示为/＞当M＝0时表示图像域Ω4上的点在血管壁上，表示为/＞通过公式/＞计算得到水平函数集/＞y4为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式/＞计算得到特征图Ifd4-1-7，将特征图Ifd4-1-6与特征图Ifd4-1-7进行特征融合，得到特征图Ifd4-1-8，将特征图Ifd4-1-8输入到上采样层中，输出得到特征图Ifd4-1-9，将特征图Ife1与特征图Ifd4-1-9进行特征融合，得到特征图Ifd4-1；f-18)将特征图Ifd4-1解码器的第四上采样层中，输出得到特征图Ifu4；f-19)将特征图Ifu4与特征图Ifd4-1输入到解码器的第四特征融合层中，输出得到特征图Ifd4-2；f-20)解码器的第七卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4-2输入到第七卷积单元中，输出得到特征图Ifd4-2-1；f-21)解码器的第八卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4-2-1输入到第八卷积单元中，输出得到特征图Ifd4；f-22)解码器的第九卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4-1-9输入到第九卷积单元中，输出得到特征图Q；f-23)解码器的第十卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4输入到第十卷积单元中，输出得到分割图像Iend。9.根据权利要求8所述的融合几何信息的软注意力网络的血管分割方法，其特征在于：步骤f-2)中第一融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-3)中第一上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-5)中第一卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-6)中第二卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-7)中第二融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-8)中第二上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-10)中第三卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-11)中第四卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-12)中第三融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-13)中第三上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-15)中第五卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-16)中第六卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-17)中第四融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-18)中第四上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-20)中第七卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-21)中第八卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-22)中第九卷积单元的卷积层的卷积核大小为5×5，stride为1×1，padding为0；步骤f-23)中第十卷积单元的卷积层的卷积核大小为1×1，stride为1×1，padding为0。10.根据权利要求8所述的融合几何信息的软注意力网络的血管分割方法，其特征在于，步骤g)包括如下步骤：g-1)x5为给定的ground truth上的特征值，x5∈Ω5，Ω5为图像域，通过公式计算得到水平函数集/＞为图像域Ω5上的点在血管内部，/＞为图像域Ω5上的点在血管壁上，/＞为图像域Ω5上的点在血管外部，y5为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式/＞计算得到概率图QGT，通过公式/＞计算得到损失函数L1，式中/＞为L1范数；g-2)通过公式计算得到损失函数L2，式中N为第i名患者的预处理后的冠状动脉血管图像Ifi中的像素总量，sj为特征图Q中第j个像素点的像素值，gj为概率图QGT中第j个像素点的像素值；g-3)通过公式L＝L1+L2+LBCE计算得到损失函数L，式中LBCE为交叉熵损失。
说明书desc
技术领域本发明涉及计算机视觉技术领域，具体涉及一种融合几何信息的软注意力网络的血管分割方法。背景技术血管分割是医学图像分析的重要任务之一，它可以帮助医生进行疾病诊断和治疗方案设计。由于血管在医学图像中形态复杂、尺寸各异，且与周围组织之间存在接触和交叉，因此血管分割任务非常具有挑战性。在过去几十年中，许多传统的图像分割方法已被应用于血管分割领域，例如阈值分割、区域生长、边缘检测等方法。然而，这些传统方法往往受限于图像噪声、灰度不均匀性和复杂的血管形态等问题，导致其分割效果不稳定、精度不高。深度学习具有较强的特征学习能力和良好的泛化性能，可以自动学习图像的语义信息，对图像中的目标像素进行准确的分类和分割。Olaf Ronneberger等人.U-Net:Convolutional Networks forBiomedical Image Segmentation.In:Navab,N.,Hornegger,J.,Wells,W.,Frangi,A.Medical Image Computing and Computer-Assisted Intervention–MICCAI2015.MICCAI 2015.Lecture Notes in Computer Science,vol 9351.Springer,Cham.)在U-Net网络的编码器部分采用了卷积神经网络来逐渐降低特征的尺寸和深度，并提取出图像的高层次语义信息。采用跳跃式连接有效的将局部和全局的信息进行结合，帮助网络更好地理解输入图像的上下文，提高分割的准确性。这种设计不仅能有效地避免信息丢失和重复计算，还可以提高网络的鲁棒性和泛化能力，从而降低模型的重复率，提高分割精度。Zhou等人.UNet++:A Nested U-Net Architecture for Medical Image Segmentation.In:,et al.Deep Learning in Medical Image Analysis and Multimodal Learning forClinical Decision Support.DLMIA ML-CDS 2018 2018.Lecture Notes in ComputerScience,vol 11045.Springer,Cham.)在U-Net的基础上重新设计了跳跃路径，减小了编码器和解码器子网络之间的语义差距。其中一个主要问题是U-Net网络可能会产生过多的重叠区域，导致模型的计算复杂度增加，同时也会导致输出结果的重复性较高，降低了模型的效率和准确率。此外，U-Net网络在处理非常大的图像时，也可能会出现存储和计算资源不足的问题，导致训练时长增加，性能下降。为了解决上述问题，研究人员提出了经过改进的U-Net网络结构和算法，以提高模型的效率和准确性。例如，采用新的卷积操作或者批量归一化技术，能够降低网络的计算复杂度和存储需求；使用残差连接或者跳跃连接等技术，可以有效地减少重复率，提高模型的表现。但是对于具有曲面、不规则形状或包含多个物体的图像，U-Net网络往往难以实现准确的分割。血管在医学图像中通常是曲线形状，传统的分割方法受限于图像噪声、复杂的血管形态等问题，导致其分割精度不高，而U-Net在处理这种类型的图像时也会存在一些限制，如分割结果的平滑性不足、边缘位置不准确等问题。发明内容本发明为了克服以上技术的不足，提供了一种提高图像分割精度和速度的融合几何信息的软注意力网络的血管分割方法。本发明克服其技术问题所采用的技术方案是：一种融合几何信息的软注意力网络的血管分割方法，包括：如下步骤：a)收集n名患者的冠状动脉血管图像，得到数据集I，I＝{I1,I2,...,Ii,…,In}，其中Ii为第i名患者的冠状动脉血管图像，i∈{1,2,…,n}；b)对数据集I进行预处理，得到预处理后的数据集If，If＝{If1,If2,…,Ifi,…,Ifn}，其中Ifi为第i名患者的预处理后的冠状动脉血管图像；c)将预处理后的数据集If划分为训练集train、验证集val、测试集test；d)设置由编码器、中间结构层、解码器构成的网络结构，将训练集train中第i名患者的预处理后的冠状动脉血管图像Ifi输入到网络结构的解码器中，输出得到特征图Ifm4；e)将特征图Ifm4输入到网络结构的中间结构层中，输出得到特征图Ifc1；f)将特征图Ifc1输入到解码器中，输出得到分割图像Iend；g)计算损失函数L；h)使用AdamW作为优化器，根据损失函数L使用反向传播来优化步骤d)中网络结构，得到优化后的网络结构；i)将测试集test中第i名患者的预处理后的冠状动脉血管图像输入到优化后的网络结构中，得到分割图像I′end。进一步的。步骤a)中在使用X射线血管造影图像的自动基于区域的冠状动脉疾病诊断公开挑战赛中收集200名患者的冠状动脉血管图像，得到数据集I；步骤b)中在python中导入Augmentor包，使用Augmentor包对数据集I依次进行旋转、弹性形变、增强亮度、增强对比度操作，得到增强后的数据集I′，I′＝{I′1,I′2,…,I′i,…,I′n}，将增强后的数据集I′进行Overlap-tile策略得到预处理后的数据集If。优选的，将预处理后的数据集If按照6:2:2的比例划分为训练集train、验证集val、测试集test。进一步的，步骤d)包括如下步骤：d-1)编码器由第一卷积单元、第二卷积单元、第一最大池化层、第三卷积单元、第四卷积单元、第二最大池化层、第五卷积单元、第六卷积单元、第三最大池化层、第七卷积单元、第八卷积单元、第四最大池化层构成；d-2)编码器的第一卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将训练集train中第i名患者的预处理后的冠状动脉血管图像Ifi输入第一卷积单元中，输出得到特征图Ifi1-1；d-3)编码器的第二卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifi1-1输入第二卷积单元中，输出得到特征图Ife1；d-4)将特征图Ife1输入到编码器的第一最大池化层中，输出得到特征图Ifm1；d-5)编码器的第三卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm1输入第三卷积单元中，输出得到特征图Ife2-1；d-6)编码器的第四卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ife2-1输入第四卷积单元中，输出得到特征图Ife2；d-7)将特征图Ife2输入到编码器的第二最大池化层中，输出得到特征图Ifm2；d-8)编码器的第五卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm2输入第五卷积单元中，输出得到特征图Ife3-1；d-9)编码器的第六卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ife3-1输入第六卷积单元中，输出得到特征图Ife3；d-10)将特征图Ife3输入到编码器的第三最大池化层中，输出得到特征图Ifm3；d-11)编码器的第七卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm3输入第七卷积单元中，输出得到特征图Ife4-1；d-12)编码器的第八卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ife4-1输入第八卷积单元中，输出得到特征图Ife4；d-13)将特征图Ife4输入到编码器的第四最大池化层中，输出得到特征图Ifm4。优选的，步骤d-2)中第一卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-3)中第二卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-4)中第一最大池化层设置池化窗口为2×2；步骤d-5)中第三卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-6)中第四卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-7)中第二最大池化层设置池化窗口为2×2；步骤d-8)中第五卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-9)中第六卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-10)中第三最大池化层设置池化窗口为2×2；步骤d-11)中第七卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-12)中第八卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0，步骤d-13)中第四最大池化层设置池化窗口为2×2。进一步的，步骤e)包括如下步骤：e-1)中间结构层由第一卷积单元、第二卷积单元构成；e-2)中间结构层的第一卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm4输入到第一卷积单元中，输出得到特征图Ifc1-1；e-3)中间结构层的第二卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifc1-1输入到第二卷积单元中，输出得到特征图Ifc1；优选的，步骤e-2)中第一卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤e-3)中第二卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0。进一步的，步骤f)包括如下步骤：f-1)解码器由第一融合集合信息的软注意力模块、第一上采样层、第一特征融合层、第一卷积单元、第二卷积单元、第二融合几何信息的软注意力模块、第二上采样层、第二特征融合层、第三卷积单元、第四卷积单元、第三融合集合信息的软注意力模块、第三上采样层、第三特征融合层、第五卷积单元、第六卷积单元、第四融合几何信息的软注意力模块、第四上采样层、第四特征融合层、第七卷积单元、第八卷积单元、第九卷积单元、第十卷积单元构成；f-2)解码器的第一融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifc1输入带第一卷积层中，输出得到特征图Ifd1-1-1，将特征图Ife4输入到第二卷积层中，输出得到特征图Ifd1-1-2，将特征图Ifd1-1-1与特征图Ifd1-1-2相加得到特征图Ifd1-1-3，将特征图Ifd1-1-3输入到Relu激活函数中，输出得到特征图Ifd1-1-4，将特征图Ifd1-1-4输入到第三卷积层中，输出得到特征图Ifd1-1-5，将特征图Ifd1-1-5输入到Siogmoid函数中，输出得到特征图Ifd1-1-6，将特征图Ifd1-1-6输入到几何信息计算层中，利用阈值法将Ifd1-1-6分为前景种子点集S1和背景种子点集R1，对前景种子点集S1使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R1使用快速行进算法计算得到测地线距离图Ur，x1为特征图Ifd1-1-6上的特征值，x1∈Ω1，Ω1为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω1上的点在血管内部，表示为当M＞0时表示图像域Ω1上的点在血管外部，表示为/＞当M＝0时表示图像域Ω1上的点在血管壁上，表示为/＞通过公式/＞计算得到水平函数集/＞y1为血管边界上的点，||·||2为欧氏距离，将水平函数集输入平滑Heaviside函数，通过公式/＞计算得到特征图Ifd1-1-7，式中k为常数，将特征图Ifd1-1-6与特征图Ifd1-1-7进行特征融合，得到特征图Ifd1-1-8，将特征图Ifd1-1-8输入到上采样层中，输出得到特征图Ifd1-1-9，将特征图Ife4与特征图Ifd1-1-9进行特征融合，得到特征图Ifd1-1；f-3)将特征图Ifc1解码器的第一上采样层中，输出得到特征图Ifu1；f-4)将特征图Ifu1与特征图Ifd1-1输入到解码器的第一特征融合层中，输出得到特征图Ifd1-2；f-5)解码器的第一卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd1-2输入到第一卷积单元中，输出得到特征图Ifd1-2-1；f-6)解码器的第二卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd1-2-1输入到第二卷积单元中，输出得到特征图Ifd1；f-7)解码器的第二融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifd1输入带第一卷积层中，输出得到特征图Ifd2-1-1，将特征图Ife3输入到第二卷积层中，输出得到特征图Ifd2-1-2，将特征图Ifd2-1-1与特征图Ifd2-1-2相加得到特征图Ifd2-1-3，将特征图Ifd2-1-3输入到Relu激活函数中，输出得到特征图Ifd2-1-4，将特征图Ifd2-1-4输入到第三卷积层中，输出得到特征图Ifd2-1-5，将特征图Ifd2-1-5输入到Siogmoid函数中，输出得到特征图Ifd2-1-6，将特征图Ifd2-1-6输入到几何信息计算层中，利用阈值法将Ifd2-1-6分为前景种子点集S2和背景种子点集R2，对前景种子点集S2使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R2使用快速行进算法计算得到测地线距离图Ur，x2为特征图Ifd2-1-6上的特征值，x2∈Ω2，Ω2为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω2上的点在血管内部，表示为当M＞0时表示图像域Ω2上的点在血管外部，表示为/＞当M＝0时表示图像域Ω2上的点在血管壁上，表示为通过公式/＞计算得到水平函数集/＞y2为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式/＞计算得到特征图Ifd2-1-7，将特征图Ifd2-1-6与特征图Ifd2-1-7进行特征融合，得到特征图Ifd2-1-8，将特征图Ifd2-1-8输入到上采样层中，输出得到特征图Ifd2-1-9，将特征图Ife3与特征图Ifd2-1-9进行特征融合，得到特征图Ifd2-1；f-8)将特征图Ifd2-1解码器的第二上采样层中，输出得到特征图Ifu2；f-9)将特征图Ifu2与特征图Ifd2-1输入到解码器的第二特征融合层中，输出得到特征图Ifd2-2；f-10)解码器的第三卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd2-2输入到第三卷积单元中，输出得到特征图Ifd2-2-1；f-11)解码器的第四卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd2-2-1输入到第四卷积单元中，输出得到特征图Ifd2；f-12)解码器的第三融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifd2输入带第一卷积层中，输出得到特征图Ifd3-1-1，将特征图Ife2输入到第二卷积层中，输出得到特征图Ifd3-1-2，将特征图Ifd3-1-1与特征图Ifd3-1-2相加得到特征图Ifd3-1-3，将特征图Ifd3-1-3输入到Relu激活函数中，输出得到特征图Ifd3-1-4，将特征图Ifd3-1-4输入到第三卷积层中，输出得到特征图Ifd3-1-5，将特征图Ifd3-1-5输入到Siogmoid函数中，输出得到特征图Ifd3-1-6，将特征图Ifd3-1-6输入到几何信息计算层中，利用阈值法将Ifd3-1-6分为前景种子点集S3和背景种子点集R3，对前景种子点集S3使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R3使用快速行进算法计算得到测地线距离图Ur，x3为特征图Ifd3-1-6上的特征值，x3∈Ω3，Ω3为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω3上的点在血管内部，表示为当M＞0时表示图像域Ω3上的点在血管外部，表示为/＞当M＝0时表示图像域Ω3上的点在血管壁上，表示为/＞通过公式/＞计算得到水平函数集/＞y3为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式/＞计算得到特征图Ifd3-1-7，将特征图Ifd3-1-6与特征图Ifd3-1-7进行特征融合，得到特征图Ifd3-1-8，将特征图Ifd3-1-8输入到上采样层中，输出得到特征图Ifd3-1-9，将特征图Ife2与特征图Ifd3-1-9进行特征融合，得到特征图Ifd3-1；f-13)将特征图Ifd3-1解码器的第三上采样层中，输出得到特征图Ifu3；f-14)将特征图Ifu3与特征图Ifd3-1输入到解码器的第三特征融合层中，输出得到特征图Ifd3-2；f-15)解码器的第五卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd3-2输入到第五卷积单元中，输出得到特征图Ifd3-2-1；f-16)解码器的第六卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd3-2-1输入到第四卷积单元中，输出得到特征图Ifd3；f-17)解码器的第四融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifd3输入带第一卷积层中，输出得到特征图Ifd4-1-1，将特征图Ife1输入到第二卷积层中，输出得到特征图Ifd4-1-2，将特征图Ifd4-1-1与特征图Ifd4-1-2相加得到特征图Ifd4-1-3，将特征图Ifd4-1-3输入到Relu激活函数中，输出得到特征图Ifd4-1-4，将特征图Ifd4-1-4输入到第三卷积层中，输出得到特征图Ifd4-1-5，将特征图Ifd4-1-5输入到Siogmoid函数中，输出得到特征图Ifd4-1-6，将特征图Ifd4-1-6输入到几何信息计算层中，利用阈值法将Ifd4-1-6分为前景种子点集S4和背景种子点集R4，对前景种子点集S4使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R4使用快速行进算法计算得到测地线距离图Ur，x4为特征图Ifd4-1-6上的特征值，x4∈Ω4，Ω4为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω4上的点在血管内部，表示为当M＞0时表示图像域Ω4上的点在血管外部，表示为/＞当M＝0时表示图像域Ω4上的点在血管壁上，表示为/＞通过公式计算得到水平函数集/＞y4为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式计算得到特征图Ifd4-1-7，将特征图Ifd4-1-6与特征图Ifd4-1-7进行特征融合，得到特征图Ifd4-1-8，将特征图Ifd4-1-8输入到上采样层中，输出得到特征图Ifd4-1-9，将特征图Ife1与特征图Ifd4-1-9进行特征融合，得到特征图Ifd4-1；f-18)将特征图Ifd4-1解码器的第四上采样层中，输出得到特征图Ifu4；f-19)将特征图Ifu4与特征图Ifd4-1输入到解码器的第四特征融合层中，输出得到特征图Ifd4-2；f-20)解码器的第七卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4-2输入到第七卷积单元中，输出得到特征图Ifd4-2-1；f-21)解码器的第八卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4-2-1输入到第八卷积单元中，输出得到特征图Ifd4；f-22)解码器的第九卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4-1-9输入到第九卷积单元中，输出得到特征图Q；f-23)解码器的第十卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4输入到第十卷积单元中，输出得到分割图像Iend。优选的，步骤f-2)中第一融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-3)中第一上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-5)中第一卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-6)中第二卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-7)中第二融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-8)中第二上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-10)中第三卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-11)中第四卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-12)中第三融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-13)中第三上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-15)中第五卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-16)中第六卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-17)中第四融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-18)中第四上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-20)中第七卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-21)中第八卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-22)中第九卷积单元的卷积层的卷积核大小为5×5，stride为1×1，padding为0；步骤f-23)中第十卷积单元的卷积层的卷积核大小为1×1，stride为1×1，padding为0。进一步的，步骤g)包括如下步骤：g-1)x5为给定的ground truth上的特征值，x5∈Ω5，Ω5为图像域，通过公式计算得到水平函数集/＞为图像域Ω5上的点在血管内部，/＞为图像域Ω5上的点在血管壁上，/＞为图像域Ω5上的点在血管外部，y5为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式/＞计算得到概率图QGT，通过公式/＞计算得到损失函数L1，式中/＞为L1范数；g-2)通过公式计算得到损失函数L2，式中N为第i名患者的预处理后的冠状动脉血管图像Ifi中的像素总量，sj为特征图Q中第j个像素点的像素值，gj为概率图QGT中第j个像素点的像素值；g-3)通过公式L＝L1+L2+LBCE计算得到损失函数L，式中LBCE为交叉熵损失。本发明的有益效果是：利用测地距离图获取血管结构信息，采用水平集函数获取血管图像上各点的位置信息，同时使用Heaviside函数生成血管内各点的权重分布。进一步，通过融合几何信息的方式，将权重分布与注意力分布结合，形成一个软注意力网络模块。考虑到血管结构的特点，借用主动轮廓模型的理论，将区域演化融入损失函数中，重新设计了针对性的组合损失函数。在网络进行训练之前，首先对数据集通过旋转、翻转、增强对比度等操作进行数据增强，将增强后的数据集送入网络结构中。使用AdamW作为优化器优化网络。在网络训练完成后，将网络结构中获取的最优权重与偏置量等参数保存。在进行血管分割时，首先从文件中读取最优的权重与偏置量，加载进入网络，然后完成血管分割。这种将几何信息融入到软注意力网络的血管分割方法，能够很好的抑制分割泄露，解决分割过程中血管不连续的问题，使血管分割更加迅速、精确。附图说明图1为本发明的网络结构图；图2为本发明的软注意力模块的结构图；图3为本发明的分割流程图。具体实施方式下面结合附图1、附图2、附图3对本发明做进一步说明。一种融合几何信息的软注意力网络的血管分割方法，包括：如下步骤：a)收集n名患者的冠状动脉血管图像，得到数据集I，I＝{I1,I2,…,Ii,…,In}，其中Ii为第i名患者的冠状动脉血管图像，i∈{1,2,…,n}。b)对数据集I进行预处理，得到预处理后的数据集If，If＝{If1,If2,...,Ifi,...,Ifn}，其中Ifi为第i名患者的预处理后的冠状动脉血管图像。c)将预处理后的数据集If划分为训练集train、验证集val、测试集test。d)设置由编码器、中间结构层、解码器构成的网络结构，将训练集train中第i名患者的预处理后的冠状动脉血管图像Ifi输入到网络结构的解码器中，输出得到特征图Ifm4。e)将特征图Ifm4输入到网络结构的中间结构层中，输出得到特征图Ifc1。f)将特征图Ifc1输入到解码器中，输出得到分割图像Iend。g)计算损失函数L。h)使用AdamW作为优化器，根据损失函数L使用反向传播来优化步骤d)中网络结构，得到优化后的网络结构。具体的根据损失函数L使用反向传播来优化网络结构中的权重weight与偏置量bias，其中初始学习率为0.001。迭代保存网络权重weight与偏置量bias的最优结果，保存训练参数日志，使用bestResult.ph文件保存权重weight与偏置量bias。i)将bestResult.ph文件获取得到的最优权重weight与偏置量bias加载进入网络，读取测试集test集中的第i名患者的预处理后的冠状动脉血管图像进行分割，得到分割图像I′end，并将分隔结果以png格式保存为文件。本发明通过分析传统方法与深度学习方法在血管分割领域各自的优缺点，将两种方法的优点结合在一起，提高了图像分割的精度和速度。通过将血管的几何信息融入深度学习网络中，更好地利用了血管的区域特征和形态特征，从而提升分割的质量。此外，在采用深度学习方法进行图像分割时，通常需要大量的数据进行训练，而利用融合几何信息的方法可以减少训练所需的数据量，提高训练效率。综合来看，融合血管的几何信息可以有效地改进深度学习网络在图像分割中的应用，提高分割的精确性和效率，又解决了深度学习网络需要大量数据集训练，在特征提取过程中缺乏血管几何信息的难题。通过本发明提出的融合几何信息的软注意力模块，将其嵌入U-Net主干网络中，配合本发明改进的损失函数，能够很好的抑制分割泄露，解决分割过程中出现异常值，分割不连续、不完整，分割结果信息单一等问题。实施例1：步骤a)中在使用X射线血管造影图像的自动基于区域的冠状动脉疾病诊断公开挑战赛中收集200名患者的冠状动脉血管图像，得到数据集I；步骤b)中在python中导入Augmentor包，使用Augmentor包对数据集I依次进行旋转、弹性形变、增强亮度、增强对比度操作，得到增强后的数据集I′，I′＝{I′1,I′2,…,I′i,…,I′n}，将增强后的数据集I′进行Overlap-tile策略得到预处理后的数据集If。实施例2：将预处理后的数据集If按照6:2:2的比例划分为训练集train、验证集val、测试集test。实施例3：步骤d)包括如下步骤：d-1)解码器部分为特征提取部分即压缩路径部分，具体的，编码器由第一卷积单元、第二卷积单元、第一最大池化层、第三卷积单元、第四卷积单元、第二最大池化层、第五卷积单元、第六卷积单元、第三最大池化层、第七卷积单元、第八卷积单元、第四最大池化层构成。d-2)编码器的第一卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将训练集train中第i名患者的预处理后的冠状动脉血管图像Ifi输入第一卷积单元中，输出得到特征图Ifi1-1。d-3)编码器的第二卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifi1-1输入第二卷积单元中，输出得到特征图Ife1。d-4)将特征图Ife1输入到编码器的第一最大池化层中，输出得到特征图Ifm1。d-5)编码器的第三卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm1输入第三卷积单元中，输出得到特征图Ife2-1。d-6)编码器的第四卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ife2-1输入第四卷积单元中，输出得到特征图Ife2。d-7)将特征图Ife2输入到编码器的第二最大池化层中，输出得到特征图Ifm2。d-8)编码器的第五卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm2输入第五卷积单元中，输出得到特征图Ife3-1。d-9)编码器的第六卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ife3-1输入第六卷积单元中，输出得到特征图Ife3。d-10)将特征图Ife3输入到编码器的第三最大池化层中，输出得到特征图Ifm3。d-11)编码器的第七卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm3输入第七卷积单元中，输出得到特征图Ife4-1。d-12)编码器的第八卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ife4-1输入第八卷积单元中，输出得到特征图Ife4。d-13)将特征图Ife4输入到编码器的第四最大池化层中，输出得到特征图Ifm4。在该实施例中，优选的，步骤d-2)中第一卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-3)中第二卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-4)中第一最大池化层设置池化窗口为2×2；步骤d-5)中第三卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-6)中第四卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-7)中第二最大池化层设置池化窗口为2×2；步骤d-8)中第五卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-9)中第六卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-10)中第三最大池化层设置池化窗口为2×2；步骤d-11)中第七卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤d-12)中第八卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0，步骤d-13)中第四最大池化层设置池化窗口为2×2。实施例4：步骤e)包括如下步骤：e-1)中间结构层由第一卷积单元、第二卷积单元构成。e-2)中间结构层的第一卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifm4输入到第一卷积单元中，输出得到特征图Ifc1-1。e-3)中间结构层的第二卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifc1-1输入到第二卷积单元中，输出得到特征图Ifc1。步骤e-2)中第一卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤e-3)中第二卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0。实施例5：步骤f)包括如下步骤：f-1)解码器部分为扩展路径部分的，具体的，解码器由第一融合集合信息的软注意力模块、第一上采样层、第一特征融合层、第一卷积单元、第二卷积单元、第二融合几何信息的软注意力模块、第二上采样层、第二特征融合层、第三卷积单元、第四卷积单元、第三融合集合信息的软注意力模块、第三上采样层、第三特征融合层、第五卷积单元、第六卷积单元、第四融合几何信息的软注意力模块、第四上采样层、第四特征融合层、第七卷积单元、第八卷积单元、第九卷积单元、第十卷积单元构成。f-2)解码器的第一融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifc1输入带第一卷积层中，输出得到特征图Ifd1-1-1，将特征图Ife4输入到第二卷积层中，输出得到特征图Ifd1-1-2，将特征图Ifd1-1-1与特征图Ifd1-1-2相加得到特征图Ifd1-1-3，将特征图Ifd1-1-3输入到Relu激活函数中，输出得到特征图Ifd1-1-4，将特征图Ifd1-1-4输入到第三卷积层中，输出得到特征图Ifd1-1-5，将特征图Ifd1-1-5输入到Siogmoid函数中，输出得到特征图Ifd1-1-6，将特征图Ifd1-1-6输入到几何信息计算层中，利用阈值法将Ifd1-1-6分为前景种子点集S1和背景种子点集R1，对前景种子点集S1使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R1使用快速行进算法计算得到测地线距离图Ur，x1为特征图Ifd1-1-6上的特征值，x1∈Ω1，Ω1为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω1上的点在血管内部，表示为当M＞0时表示图像域Ω1上的点在血管外部，表示为/＞当M＝0时表示图像域Ω1上的点在血管壁上，表示为/＞通过公式计算得到水平函数集/＞y1为血管边界上的点，||·||2为欧氏距离，将水平函数集/＞输入平滑Heaviside函数，通过公式/＞计算得到特征图Ifd1-1-7，式中k为常数，将特征图Ifd1-1-6与特征图Ifd1-1-7进行特征融合，得到特征图Ifd1-1-8，将特征图Ifd1-1-8输入到上采样层中，输出得到特征图Ifd1-1-9，将特征图Ife4与特征图Ifd1-1-9进行特征融合，得到特征图Ifd1-1。f-3)将特征图Ifc1解码器的第一上采样层中，输出得到特征图Ifu1。f-4)将特征图Ifu1与特征图Ifd1-1输入到解码器的第一特征融合层中采用concat方法融合特征，输出得到特征图Ifd1-2。f-5)解码器的第一卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd1-2输入到第一卷积单元中，输出得到特征图Ifd1-2-1。f-6)解码器的第二卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd1-2-1输入到第二卷积单元中，输出得到特征图Ifd1。f-7)解码器的第二融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifd1输入带第一卷积层中，输出得到特征图Ifd2-1-1，将特征图Ife3输入到第二卷积层中，输出得到特征图Ifd2-1-2，将特征图Ifd2-1-1与特征图Ifd2-1-2相加得到特征图Ifd2-1-3，将特征图Ifd2-1-3输入到Relu激活函数中，输出得到特征图Ifd2-1-4，将特征图Ifd2-1-4输入到第三卷积层中，输出得到特征图Ifd2-1-5，将特征图Ifd2-1-5输入到Siogmoid函数中，输出得到特征图Ifd2-1-6，将特征图Ifd2-1-6输入到几何信息计算层中，利用阈值法将Ifd2-1-6分为前景种子点集S2和背景种子点集R2，对前景种子点集S2使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R2使用快速行进算法计算得到测地线距离图Ur，x2为特征图Ifd2-1-6上的特征值，x2∈Ω2，Ω2为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω2上的点在血管内部，表示为当M＞0时表示图像域Ω2上的点在血管外部，表示为/＞当M＝0时表示图像域Ω2上的点在血管壁上，表示为通过公式/＞计算得到水平函数集/＞y2为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式/＞计算得到特征图Ifd2-1-7，将特征图Ifd2-1-6与特征图Ifd2-1-7进行特征融合，得到特征图Ifd2-1-8，将特征图Ifd2-1-8输入到上采样层中，输出得到特征图Ifd2-1-9，将特征图Ife3与特征图Ifd2-1-9进行特征融合，得到特征图Ifd2-1。f-8)将特征图Ifd2-1解码器的第二上采样层中，输出得到特征图Ifu2。f-9)将特征图Ifu2与特征图Ifd2-1输入到解码器的第二特征融合层中采用concat方法融合特征，输出得到特征图Ifd2-2。f-10)解码器的第三卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd2-2输入到第三卷积单元中，输出得到特征图Ifd2-2-1。f-11)解码器的第四卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd2-2-1输入到第四卷积单元中，输出得到特征图Ifd2。f-12)解码器的第三融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifd2输入带第一卷积层中，输出得到特征图Ifd3-1-1，将特征图Ife2输入到第二卷积层中，输出得到特征图Ifd3-1-2，将特征图Ifd3-1-1与特征图Ifd3-1-2相加得到特征图Ifd3-1-3，将特征图Ifd3-1-3输入到Relu激活函数中，输出得到特征图Ifd3-1-4，将特征图Ifd3-1-4输入到第三卷积层中，输出得到特征图Ifd3-1-5，将特征图Ifd3-1-5输入到Siogmoid函数中，输出得到特征图Ifd3-1-6，将特征图Ifd3-1-6输入到几何信息计算层中，利用阈值法将Ifd3-1-6分为前景种子点集S3和背景种子点集R3，对前景种子点集S3使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R3使用快速行进算法计算得到测地线距离图Ur，x3为特征图Ifd3-1-6上的特征值，x3∈Ω3，Ω3为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω3上的点在血管内部，表示为当M＞0时表示图像域Ω3上的点在血管外部，表示为/＞当M＝0时表示图像域Ω3上的点在血管壁上，表示为/＞通过公式计算得到水平函数集/＞y3为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式计算得到特征图Ifd3-1-7，将特征图Ifd3-1-6与特征图Ifd3-1-7进行特征融合，得到特征图Ifd3-1-8，将特征图Ifd3-1-8输入到上采样层中，输出得到特征图Ifd3-1-9，将特征图Ife2与特征图Ifd3-1-9进行特征融合，得到特征图Ifd3-1。f-13)将特征图Ifd3-1解码器的第三上采样层中，输出得到特征图Ifu3。f-14)将特征图Ifu3与特征图Ifd3-1输入到解码器的第三特征融合层中采用concat方法融合特征，输出得到特征图Ifd3-2。f-15)解码器的第五卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd3-2输入到第五卷积单元中，输出得到特征图Ifd3-2-1。f-16)解码器的第六卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd3-2-1输入到第四卷积单元中，输出得到特征图Ifd3。f-17)解码器的第四融合集合信息的软注意力模块由第一卷积层、第二卷积层、Relu激活函数、第三卷积层、Siogmoid函数、几何信息计算层、上采样层构成，将特征图Ifd3输入带第一卷积层中，输出得到特征图Ifd4-1-1，将特征图Ife1输入到第二卷积层中，输出得到特征图Ifd4-1-2，将特征图Ifd4-1-1与特征图Ifd4-1-2相加得到特征图Ifd4-1-3，将特征图Ifd4-1-3输入到Relu激活函数中，输出得到特征图Ifd4-1-4，将特征图Ifd4-1-4输入到第三卷积层中，输出得到特征图Ifd4-1-5，将特征图Ifd4-1-5输入到Siogmoid函数中，输出得到特征图Ifd4-1-6，将特征图Ifd4-1-6输入到几何信息计算层中，利用阈值法将Ifd4-1-6分为前景种子点集S4和背景种子点集R4，对前景种子点集S4使用快速行进算法计算得到测地线距离图Ds，对背景种子点集R4使用快速行进算法计算得到测地线距离图Ur，x4为特征图Ifd4-1-6上的特征值，x4∈Ω4，Ω4为图像域，将测地线距离图Ds与测地线距离图Ur对应像素的值相减操作，得到测地线距离图M，当M＜0时表示图像域Ω4上的点在血管内部，表示为当M＞0时表示图像域Ω4上的点在血管外部，表示为/＞当M＝0时表示图像域Ω4上的点在血管壁上，表示为/＞通过公式计算得到水平函数集/＞y4为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式计算得到特征图Ifd4-1-7，将特征图Ifd4-1-6与特征图Ifd4-1-7进行特征融合，得到特征图Ifd4-1-8，将特征图Ifd4-1-8输入到上采样层中，输出得到特征图Ifd4-1-9，将特征图Ife1与特征图Ifd4-1-9进行特征融合，得到特征图Ifd4-1。f-18)将特征图Ifd4-1解码器的第四上采样层中，输出得到特征图Ifu4。f-19)将特征图Ifu4与特征图Ifd4-1输入到解码器的第四特征融合层中采用concat方法融合特征，输出得到特征图Ifd4-2。f-20)解码器的第七卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4-2输入到第七卷积单元中，输出得到特征图Ifd4-2-1。f-21)解码器的第八卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4-2-1输入到第八卷积单元中，输出得到特征图Ifd4。f-22)解码器的第九卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4-1-9输入到第九卷积单元中，输出得到特征图Q；f-23)解码器的第十卷积单元依次由卷积层、BatchNorm层、Dropout层、Relu激活函数构成，将特征图Ifd4输入到第十卷积单元中，输出得到分割图像Iend。在该实施例中，优选的，步骤f-2)中第一融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-3)中第一上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-5)中第一卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-6)中第二卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-7)中第二融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-8)中第二上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-10)中第三卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-11)中第四卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-12)中第三融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-13)中第三上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-15)中第五卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-16)中第六卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-17)中第四融合集合信息的软注意力模块的第一卷积层的卷积核大小为1×1，stride为1×1，padding为0，第二卷积层的卷积核大小为1×1，stride为2×2，padding为0；第三卷积层的卷积核大小为1×1，stride为1×1，padding为0，上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-18)中第四上采样层的反卷积核大小为2×2，stride为2×2，padding为0；步骤f-20)中第七卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-21)中第八卷积单元的卷积层的卷积核大小为3×3，stride为1×1，padding为0；步骤f-22)中第九卷积单元的卷积层的卷积核大小为5×5，stride为1×1，padding为0；步骤f-23)中第十卷积单元的卷积层的卷积核大小为1×1，stride为1×1，padding为0。实施例6：步骤g)包括如下步骤：g-1)x5为给定的ground truth上的特征值，x5∈Ω5，Ω5为图像域，通过公式计算得到水平函数集/＞为图像域Ω5上的点在血管内部，/＞为图像域Ω5上的点在血管壁上，/＞为图像域Ω5上的点在血管外部，y5为血管边界上的点，将水平函数集/＞输入平滑Heaviside函数，通过公式/＞计算得到概率图QGT，通过公式/＞计算得到损失函数L1，式中/＞为L1范数。g-2)通过公式计算得到损失函数L2，式中N为第i名患者的预处理后的冠状动脉血管图像Ifi中的像素总量，sj为特征图Q中第j个像素点的像素值，gj为概率图QGT中第j个像素点的像素值。g-3)通过公式L＝L1+L2+LBCE计算得到损失函数L，式中LBCE为交叉熵损失。最后应说明的是：以上所述仅为本发明的优选实施例而已，并不用于限制本发明，尽管参照前述实施例对本发明进行了详细的说明，对于本领域的技术人员来说，其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
