标题title
一种缺陷识别方法、装置、电子设备及存储介质
摘要abst
本发明涉及一种缺陷识别方法、装置、电子设备及存储介质。本发明所述的标注一致性评价方法包括：获取待检测缺陷的目标图像；将所述目标图像输入训练好的关键点检测模型，得到所述目标图像对应的置信度矩阵；在所述置信度矩阵中选取置信度最大的n个像素点，并获取所述像素点的坐标；以所述n个像素点的坐标为中心，在所述目标图像中截取n个局部图像；将每个所述局部图像输入训练好的语义分割模型，得到所述局部图像中的缺陷位置。本发明所述的标注一致性评价方法，先用关键点检测模型定位出缺陷中心点，再以此为中心截取包含缺陷的局部图像，使得缺陷在局部图像中的面积占比大大提升，从而有利于后续的语义分割模型识别出该缺陷。
权利要求书clms
1.一种缺陷识别方法，其特征在于，包括以下步骤：获取待检测缺陷的目标图像；将所述目标图像输入训练好的关键点检测模型，得到所述目标图像对应的置信度矩阵；在所述置信度矩阵中选取置信度最大的n个像素点，并获取所述像素点的坐标；以所述n个像素点的坐标为中心，在所述目标图像中截取n个局部图像；将每个所述局部图像输入训练好的语义分割模型，得到所述局部图像中的缺陷位置。2.根据权利要求1所述的一种缺陷识别方法，其特征在于，所述关键点检测模型的训练过程包括以下步骤：收集多张包含待识别缺陷的原始图像；对于每一张所述原始图像，使用关键点标注工具，将所述原始图像中的每一个待检验的缺陷标注为一个关键点，得到标注图像；使用多张所述标图像对所述关键点检测模型进行训练，得到训练好的关键点检测模型。3.根据权利要求2所述的一种缺陷识别方法，其特征在于：所述关键点检测模型为DeepPose模型。4.根据权利要求2所述的一种缺陷识别方法，其特征在于，所述语义分割模型的训练过程包括以下步骤：收集多张包含待识别缺陷的原始图像；将多种所述原始图像输入训练好的关键点检测模型，得到所述原始图像对应的置信度矩阵；针对每一个所述原始图像，在所述置信度矩阵中选取置信度最大的n个像素点，并获取所述像素点的坐标；以所述n个像素点的坐标为中心，在所述目标图像中截取n个局部图像；使用分割标注工具，在每一个所述局部图像中标注出待检缺陷的位置，得到标注局部图像；使用多种所述标注局部图像对所述语义分割模型进行训练，得到训练好的语义分割模型。5.根据权利要求4所述的一种缺陷识别方法，其特征在于：所述语义分割模型为deeplapV3算法网络。6.根据权利要求1所述的一种缺陷识别方法，其特征在于：所述局域图像为正方形。7.根据权利要求6所述的一种缺陷识别方法，其特征在于：n为3-5之间的正整数。8.一种缺陷识别装置，其特征在于，包括：目标图像获取模块，用于获取待检测缺陷的目标图像；置信度矩阵获取模块，用于将所述目标图像输入训练好的关键点检测模型，得到所述目标图像对应的置信度矩阵；中心点获取模块，用于在所述置信度矩阵中选取置信度最大的n个像素点，并获取所述像素点的坐标；局部图像截取模块，用于以所述n个像素点的坐标为中心，在所述目标图像中截取n个局部图像；缺陷识别模块，用于将每个所述局部图像输入训练好的语义分割模型，得到所述局部图像中的缺陷位置。9.一种电子设备，其特征在于，包括：至少一个存储器以及至少一个处理器；所述存储器，用于存储一个或多个程序；当所述一个或多个程序被所述至少一个处理器执行，使得所述至少一个处理器实现如权利要求1-7任一所述的一种缺陷识别方法的步骤。10.一种计算机可读存储介质，其特征在于：所述计算机可读存储介质存储有计算机程序，所述计算机程序被处理器执行时实现如权利要求1-7任一所述的一种缺陷识别方法的步骤。
说明书desc
技术领域本发明涉及深度学习技术领域，特别是涉及一种缺陷识别方法、装置、电子设备及存储介质。背景技术工业生产过程中会产生各种类型的缺陷，其会影响产品质量甚或引发安全问题，通常需要用计算式视觉技术将其检测与识别。深度学习的语义分割算法属于像素级的分类算法，它能预测图像中的每个像素是否属于缺陷。由于语义分割是对像素进行分类，可准确输出缺陷位置与面积等工业界所需的数据，且其预测精度高，稳定性强，所以广泛应用于工业外观缺陷检测与识别。但是，语义分割算法也有不足，并非在任何情形下都有很高的识别精度，在工业质检场景下表现得更为明显，原因是在工业质检中工业相机拍摄的图像尺寸通常特别大，而目标缺陷的尺寸却特别小，此时语义分割模型往往难以将小目标缺陷识别出来，造成漏杀。针对小目标缺陷漏杀的问题，常见的解决方案是：1)增加训练数据中正样本的数量；2)增大语义分割算法网络的参数规模，以期让模型具有更强大的学习能力；3)在模型训练过程中使用更多更丰富的数据扩增方法。然而，1)训练数据难以收集，非一时半刻可解决，且经济成本高，另外，增加正样本数量未必能有效解决小目标缺陷漏杀的问题。2)而增大语义分割算法网络的参数规模，意味着需要更多的训练数据，且大网络的模型训练速度慢，需要的硬件资源也更多，此方法成本较高。3)即便在模型训练过程中使用更多更丰富的数据扩增方法，依然治标不治本，难以有效解决小目标缺陷漏杀的问题。发明内容基于此，本发明的目的在于，提供一种缺陷识别方法、装置、电子设备及存储介质，自动计算评价指标，获取多人数据标注结果一致性的信息，可以及时指导改善数据标注的质量，从而提升了模型精度。第一方面，本发明提供一种缺陷识别方法，包括以下步骤：获取待检测缺陷的目标图像；将所述目标图像输入训练好的关键点检测模型，得到所述目标图像对应的置信度矩阵；在所述置信度矩阵中选取置信度最大的n个像素点，并获取所述像素点的坐标；以所述n个像素点的坐标为中心，在所述目标图像中截取n个局部图像；将每个所述局部图像输入训练好的语义分割模型，得到所述局部图像中的缺陷位置。进一步地，所述关键点检测模型的训练过程包括以下步骤：收集多张包含待识别缺陷的原始图像；对于每一张所述原始图像，使用关键点标注工具，将所述原始图像中的每一个待检验的缺陷标注为一个关键点，得到标注图像；使用多张所述标图像对所述关键点检测模型进行训练，得到训练好的关键点检测模型。进一步地，所述关键点检测模型为DeepPose模型。进一步地，所述语义分割模型的训练过程包括以下步骤：收集多张包含待识别缺陷的原始图像；将多种所述原始图像输入训练好的关键点检测模型，得到所述原始图像对应的置信度矩阵；针对每一个所述原始图像，在所述置信度矩阵中选取置信度最大的n个像素点，并获取所述像素点的坐标；以所述n个像素点的坐标为中心，在所述目标图像中截取n个局部图像；使用分割标注工具，在每一个所述局部图像中标注出待检缺陷的位置，得到标注局部图像；使用多种所述标注局部图像对所述语义分割模型进行训练，得到训练好的语义分割模型。进一步地，所述语义分割模型为deeplapV3算法网络。进一步地，所述局域图像为正方形。进一步地，n为3-5之间的正整数。第二方面，本发明还提供一种缺陷识别装置，包括：目标图像获取模块，用于获取待检测缺陷的目标图像；置信度矩阵获取模块，用于将所述目标图像输入训练好的关键点检测模型，得到所述目标图像对应的置信度矩阵；中心点获取模块，用于在所述置信度矩阵中选取置信度最大的n个像素点，并获取所述像素点的坐标；局部图像截取模块，用于以所述n个像素点的坐标为中心，在所述目标图像中截取n个局部图像；缺陷识别模块，用于将每个所述局部图像输入训练好的语义分割模型，得到所述局部图像中的缺陷位置。第三方面，本发明还提供一种电子设备，包括：至少一个存储器以及至少一个处理器；所述存储器，用于存储一个或多个程序；当所述一个或多个程序被所述至少一个处理器执行，使得所述至少一个处理器实现如本发明第一方面任一所述的一种缺陷识别方法的步骤。第四方面，本发明还提供一种计算机可读存储介质，所述计算机可读存储介质存储有计算机程序，所述计算机程序被处理器执行时实现如本发明第一方面任一所述的一种缺陷识别方法的步骤。本发明提供的一种缺陷识别方法、装置、电子设备及存储介质，使用具有全局搜索能力的关键点检测模型来定位缺陷中心点，并把置信度最高的N个点作为存在缺陷的区域，以此大大提升了缺陷的检出率，克服了以往方法可能漏掉小目标缺陷的问题。在原图中构建语义分割模型难以识别小目标缺陷的原因是图像太大而缺陷面积太小，本发明先用关键点检测模型定位出缺陷中心点，再以此为中心截取包含缺陷的正方形图像，使得缺陷在正方形截图中的面积占比大大提升，从而有利于后续的语义分割模型识别出该缺陷，因而大幅提升了语义分割模型对小目标缺陷的检出率。为了更好地理解和实施，下面结合附图详细说明本发明。附图说明图1为本发明提供的一种缺陷识别方法的步骤示意图；图2为一个实施例中对关键点检测模型进行训练及使用的流程示意图；图3为一个实施例中对语义分割模型进行训练及使用的流程示意图；图4为本发明提供的一种缺陷识别装置的结构示意图。具体实施方式为使本申请的目的、技术方案和优点更加清楚，下面将结合附图对本申请实施例方式作进一步地详细描述。应当明确，所描述的实施例仅仅是本申请实施例一部分实施例，而不是全部的实施例。基于本申请实施例中的实施例，本领域普通技术人员在没有作出创造性劳动前提下所获得的所有其它实施例，都属于本申请实施例保护的范围。在本申请实施例使用的术语是仅仅出于描述特定实施例的目的，而非旨在限制本申请实施例。在本申请实施例和所附权利要求书中所使用的单数形式的“一种”、“所述”和“该”也旨在包括多数形式，除非上下文清楚地表示其他含义。还应当理解，本文中使用的术语“和/或”是指并包含一个或多个相关联的列出项目的任何或所有可能组合。下面的描述涉及附图时，除非另有表示，不同附图中的相同数字表示相同或相似的要素。以下示例性实施例中所描述的实施方式并不代表与本申请相一致的所有实施方式。相反，它们仅是如所附权利要求书中所详述的、本申请的一些方面相一致的装置和方法的例子。在本申请的描述中，需要理解的是，术语“第一”、“第二”、“第三”等仅用于区别类似的对象，而不必用于描述特定的顺序或先后次序，也不能理解为指示或暗示相对重要性。对于本领域的普通技术人员而言，可以根据具体情况理解上述术语在本申请中的具体含义。此外，在本申请的描述中，除非另有说明，“多个”是指两个或两个以上。“和/或”，描述关联对象的关联关系，表示可以存在三种关系，例如，A和/或B，可以表示：单独存在A，同时存在A和B，单独存在B这三种情况。字符“/”一般表示前后关联对象是一种“或”的关系。针对背景技术中的问题，本申请实施例提供一种缺陷识别方法，如图1-图3所示，该方法包括以下步骤：S01：获取待检测缺陷的目标图像。在一个具体的应用场景中，目标图像为图像采集设备对待检测缺陷的产品拍摄得到。待检测的缺陷通常是指检测物品表面的瑕疵，如污点、划痕、浅坑、浅瘤、边缘缺陷、图案缺陷、斑点、凹痕、色差、瑕疵、材料不足、材料过多等。具体的，可能包括、电子设备表面的字符识别和字符缺陷检测；.检测液晶屏表面的缺陷，如瑕疵、瑕疵和划痕；在造纸工业中检测造纸过程中的缺陷，例如污点、斑点和杂质；检测印刷品的污渍、色差等缺陷；瓶盖印刷质量检验，产品包装上的条形码和字符识别等。以上缺陷均呈现于产品表面，可通过人眼视觉辨别。进一步的，可通过采集产品表面图像，进行机器视觉检测。S02：将所述目标图像输入训练好的关键点检测模型，得到所述目标图像对应的置信度矩阵。关键点检测模型经过训练，用于识别图像中的缺陷关键点，其输入为待检测缺陷的原图，输出是一个与输入图相同尺寸的置信度矩阵。它每个元素的数值表示输入图中对应像素点属于待检缺陷中心点的置信度，数值越大代表该点是缺陷中心点的可能性越大。S03：在所述置信度矩阵中选取置信度最大的n个像素点，并获取所述像素点的坐标。如上所述，置信度数值越大代表该点是缺陷中心点的可能性越大。因此，可根据实际的工业生产需求，选择合适数量的置信度最大的像素点，用于后续的缺陷检测确认。数量选取过少，容易造成缺陷的错漏，选取过多，则增大计算量，造成资源浪费。在一个具体的实施例中，本发明选择n为3-5之间的正整数。S04：以所述n个像素点的坐标为中心，在所述目标图像中截取n个局部图像。在具体的应用场景中，为了便于截取和计算，一般设定所述局部图像为矩形，更为优选的，所述局域图像为正方形。对于局部图像的边长，可根据待检缺陷的最大尺寸而设定，例如全部设置为200，只要保证正方形区域包含了待检缺陷即可。S05：将每个所述局部图像输入训练好的语义分割模型，得到所述局部图像中的缺陷位置。语义分割是计算机视觉中很重要的一个方向。不同于目标检测和识别，语义分割实现了图像像素级的分类。它能够将一张图片或者视频，按照类别的异同，将图像分为多个块。在一个具体实施例中，本发明使用的语义分割模型，输入是正方形缺陷截图，输出是二值图，其前景指示了待检缺陷的位置。本发明提供的一种缺陷识别方法，不直接使用大图来建立语义分割模型，而是与关键点检测算法结合，利用关键点检测算法全局性搜寻目标物的特点，来提升小目标缺陷的检出率。在一个优选的实施例中，本发明中所述关键点检测模型为DeepPose模型。对于该关键点检测模型的训练过程包括以下步骤：S021：收集多张包含待识别缺陷的原始图像。S022：对于每一张所述原始图像，使用关键点标注工具，将所述原始图像中的每一个待检验的缺陷标注为一个关键点，得到标注图像。S023：使用多张所述标图像对所述关键点检测模型进行训练，得到训练好的关键点检测模型。在另一个优选的实施例中，所述语义分割模型为deeplapV3算法网络。对于该语义分割模型的训练过程包括以下步骤：S031：收集多张包含待识别缺陷的原始图像；S032：将多种所述原始图像输入训练好的关键点检测模型，得到所述原始图像对应的置信度矩阵；S033：针对每一个所述原始图像，在所述置信度矩阵中选取置信度最大的n个像素点，并获取所述像素点的坐标；S034：以所述n个像素点的坐标为中心，在所述目标图像中截取n个局部图像；S035：使用分割标注工具，在每一个所述局部图像中标注出待检缺陷的位置，得到标注局部图像；S03：使用多种所述标注局部图像对所述语义分割模型进行训练，得到训练好的语义分割模型。本申请提供的一种缺陷识别方法，基于上述训练好的关键点检测模型和语义分割模型，将整个处理过程拆分为两个步骤：第一个步骤用关键点检测模型定位出目标所有可能出现的位置，并进行小范围截图；第二个步骤的分割算法负责从步骤一的截图中识别出目标。本申请实施例还提供一种缺陷识别装置，如图4所示，该标注一致性评价装置400包括：图像获取模块401，用于获取多个图像集，每个所述图像集中包括有多个标注图像，每个所述标注图像中包括标注框；标注图像评分模块402，用于针对每一个所述标注图像，对比所述标注框内外两侧像素点的灰度值，获得第一灰度差值，根据所述第一灰度差值得到所述标注图像的评分；评分均值计算模块403，用于针对每一个图像集，根据该图像集中每一个所述标注图像的评分，得到所述图像集的评分均值；差距值计算模块404，用于计算多个所述图像集的评分均值之间的差距值；评价结果确定模块405，用于根据所述差距值，得到不同所述图像集之间的缺陷识别结果。优选的，所述关键点检测模型的训练过程包括以下步骤：收集多张包含待识别缺陷的原始图像；对于每一张所述原始图像，使用关键点标注工具，将所述原始图像中的每一个待检验的缺陷标注为一个关键点，得到标注图像；使用多张所述标图像对所述关键点检测模型进行训练，得到训练好的关键点检测模型。优选的，所述关键点检测模型为DeepPose模型。优选的，所述语义分割模型的训练过程包括以下步骤：收集多张包含待识别缺陷的原始图像；将多种所述原始图像输入训练好的关键点检测模型，得到所述原始图像对应的置信度矩阵；针对每一个所述原始图像，在所述置信度矩阵中选取置信度最大的n个像素点，并获取所述像素点的坐标；以所述n个像素点的坐标为中心，在所述目标图像中截取n个局部图像；使用分割标注工具，在每一个所述局部图像中标注出待检缺陷的位置，得到标注局部图像；使用多种所述标注局部图像对所述语义分割模型进行训练，得到训练好的语义分割模型。优选的，所述语义分割模型为deeplapV3算法网络。优选的，所述局域图像为正方形。优选的，n为3-5之间的正整数。对于装置实施例而言，由于其基本对应于方法实施例，所以相关之处参见方法实施例的部分说明即可。以上所描述的装置实施例仅仅是示意性的，其中所述作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元。所属领域的技术人员可以清楚地了解到，为描述的方便和简洁，上述描述的系统，装置和单元的具体工作过程，可以参考前述方法实施例中的对应过程，在此不再赘述。本申请实施例还提供一种电子设备，包括：至少一个存储器以及至少一个处理器；所述存储器，用于存储一个或多个程序；当所述一个或多个程序被所述至少一个处理器执行，使得所述至少一个处理器实现如前所述的一种缺陷识别方法的步骤。对于设备实施例而言，由于其基本对应于方法实施例，所以相关之处参见方法实施例的部分说明即可。以上所描述的设备实施例仅仅是示意性的，其中所述作为分离部件说明的组件可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部模块来实现本公开方案的目的。本领域普通技术人员在不付出创造性劳动的情况下，即可以理解并实施。本申请实施例还提供一种计算机可读存储介质，所述计算机可读存储介质存储有计算机程序，所述计算机程序被处理器执行时实现如前所述的一种缺陷识别方法的步骤。计算机可用存储介质包括永久性和非永久性、可移动和非可移动媒体，可以由任何方法或技术来实现信息存储。信息可以是计算机可读指令、数据结构、程序的模块或其他数据。计算机的存储介质的例子包括但不限于：相变内存、静态随机存取存储器、动态随机存取存储器、其他类型的随机存取存储器、只读存储器、电可擦除可编程只读存储器、快闪记忆体或其他内存技术、只读光盘只读存储器、数字多功能光盘或其他光学存储、磁盒式磁带，磁带磁磁盘存储或其他磁性存储设备或任何其他非传输介质，可用于存储可以被计算设备访问的信息。本发明提供的一种缺陷识别方法、装置、电子设备及存储介质，使用具有全局搜索能力的关键点检测模型来定位缺陷中心点，并把置信度最高的N个点作为存在缺陷的区域，以此大大提升了缺陷的检出率，克服了以往方法可能漏掉小目标缺陷的问题。在原图中构建语义分割模型难以识别小目标缺陷的原因是图像太大而缺陷面积太小，本发明先用关键点检测模型定位出缺陷中心点，再以此为中心截取包含缺陷的正方形图像，使得缺陷在正方形截图中的面积占比大大提升，从而有利于后续的语义分割模型识别出该缺陷，因而大幅提升了语义分割模型对小目标缺陷的检出率。以上所述实施例仅表达了本发明的几种实施方式，其描述较为具体和详细，但并不能因此而理解为对发明专利范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本发明构思的前提下，还可以做出若干变形和改进，这些都属于本发明的保护范围。
