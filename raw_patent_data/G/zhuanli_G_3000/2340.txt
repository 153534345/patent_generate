标题title
一种基于资源调度的GPU效能提高方法
摘要abst
本发明涉及渲染资源调度领域，尤其涉及一种基于资源调度的GPU效能提高方法，本发明获取特征对象在虚拟场景内的移动路径确定特征对象的移动目标场景，移动目标场景包括所述特征对象移动路径途经的若干虚拟场景，并且，基于移动目标场景中的渲染参数计算渲染复杂参数对应划分移动目标场景的类别，进而，基于特征对象预切换的移动目标场景的类别对GPU的运算节点进行调度，通过上述方法，基于虚拟场景内特征对象的移动路径，提前预测虚拟场景的切换，并提前适应性的基于预切换虚拟场景相关渲染参数调度GPU，提高GPU的利用率，减小在虚拟场景切换时的卡顿、掉帧现象。
权利要求书clms
1.一种基于资源调度的GPU效能提高方法，其特征在于，包括：步骤S1，响应于第一预设条件，获取特征对象在虚拟场景内的移动路径，基于移动路径确定特征对象的移动目标场景，所述特征对象为用户端可操纵在虚拟场景内移动的虚拟单位，路径途经所述移动目标场景为所述特征对象移动路径途经的虚拟场景；步骤S2，基于所述移动目标场景中的渲染参数计算渲染复杂参数，并基于所述特征对象当前所在移动目标场景与预切换的移动目标场景对应渲染复杂参数的差异量判定各移动目标场景的类别，所述渲染参数包括移动目标场景中构成建模物体的多边形数量；步骤S3，基于所述特征对象依据所述移动路线在移动目标场景内移动时距离预切换的移动目标移动场景边界的距离判定是否处于运算调动时刻；步骤S4，响应于第二预设条件，基于所述特征对象预切换的移动目标场景的类别对GPU的运算节点进行调度，包括，在预切换的移动目标场景为第一类别时，增大当前用以渲染虚拟场景的GPU的节点数量；在预切换的移动目标场景为第二类别时，减小当前用以渲染虚拟场景的GPU的节点数量；并且，所述节点数量的增大量或减小量基于表征调整系数所确定，所述表征调整系数基于预切换的移动目标场景对应的渲染复杂参数以及场景切换速率计算所得，所述场景切换速率基于所述特征对象在所述虚拟场景内的移动速率所确定；其中，所述第一预设条件为用户端选定特征对象的移动路径后，所述第二预设条件为判定处于运算调动时刻。2.根据权利要求1所述的基于资源调度的GPU效能提高方法，其特征在于，所述步骤S2中还包括确定预切换的移动目标场景，其中，在所述虚拟单位依照所述移动路径移动并处于任意移动目标场景中时，将所述虚拟单位即将进入的移动目标场景确定为预切换的移动目标场景。3.根据权利要求1所述的基于资源调度的GPU效能提高方法，其特征在于，所述步骤S2中，基于移动目标场景中的渲染参数根据公式计算渲染复杂参数，，公式中，E表示渲染复杂参数，Ne表示虚拟场景中构成建模物体的多边形数量，Ne0表示预设的数量阈值。4.根据权利要求3所述的基于资源调度的GPU效能提高方法，其特征在于，所述步骤S2中，基于相邻移动目标场景对应渲染复杂参数的差异量判定各移动目标场景的类别，其中，计算特征对象当前所在移动目标场景与预切换的移动目标场景对应渲染复杂参数的差异量，将所述差异量与预设的差异量阈值进行对比，在第一对比条件下，判定所述移动目标场景为第一类别；在第二对比条件下，判定所述移动目标场景为第二类别；在不属于第一对比条件以及第二对比条件下，判定所述移动目标场景为第三类别；所述第一对比条件为，所述差异量大于等于所述差异量阈值且特征对象当前所在移动目标场景对应渲染复杂参数小于预切换的移动目标场景对应渲染复杂参数；所述第二对比条件为，所述差异量大于等于所述差异量阈值且特征对象当前所在移动目标场景对应渲染复杂参数大于预切换的移动目标场景对应渲染复杂参数。5.根据权利要求1所述的基于资源调度的GPU效能提高方法，其特征在于，所述步骤S3中，判定是否处于运算调动时刻，其中，将所述距离与预设的边界距离阈值进行对比，若所述距离小于所述边界距离阈值，则判定处于运算调动时刻。6.根据权利要求1所述的基于资源调度的GPU效能提高方法，其特征在于，所述步骤S4中，基于预切换的移动目标场景对应的渲染复杂参数以及场景切换速率根据公式计算表征调整系数，，公式中，C表示表征调整系数，E表示渲染复杂参数，E0表示预设的渲染复杂参数对比阈值，V表示场景切换速率，V0表示预设的场景切换速率对比阈值。7.根据权利要求1所述的基于资源调度的GPU效能提高方法，其特征在于，所述步骤S4中，节点数量的增大量或减小量基于表征调整系数所确定，其中，节点数量的增大量与所述表征调整系数呈正相关；节点数量的减小量与所述表征调整系数呈负相关。8.根据权利要求4所述的基于资源调度的GPU效能提高方法，其特征在于，所述步骤S4中，还包括，在所述特征对象预切换的移动目标场景的类别为第三类别时，不调整用以渲染虚拟场景的GPU的节点数量。9.根据权利要求1所述的基于资源调度的GPU效能提高方法，其特征在于，各所述虚拟场景的边界为预先划定所得。10.根据权利要求9所述的基于资源调度的GPU效能提高方法，其特征在于，各所述移动目标场景对应的渲染参数为预先统计所得。
说明书desc
技术领域本发明涉及渲染资源调度领域，尤其涉及一种基于资源调度的GPU效能提高方法。背景技术GPU可以用于渲染图像和视频，GPU在图形渲染方面的强大计算能力使其能够快速处理复杂的图形数据，包括光照、纹理映射、几何变换等，因此，GPU被广泛应用于游戏开发、电影制作、虚拟现实等领域，以实现高质量的图形渲染效果，由于游戏虚拟场景渲染需要较高的算力，因此，在游戏虚拟场景渲染时如何合理的利用GPU被人们所重视。中国专利申请公开号：CN111143060A，公开了一种GPU资源调度方法、装置及GPU，该方法包括：基于历史实时业务量预估每个时间分区的所需的实时业务POD进程数量的最小阈值和最大阈值；根据最小阈值和最大阈值确定每个时间分区处于运行状态的实时业务POD进程的数量，并定时计算所有处于运行状态的实时业务POD进程所绑定的GPU的平均资源利用率；基于平均资源利用率的大小确定是否需要修改处于运行状态的实时业务POD进程的数量，或是否需要修改最小阈值，或是否需要修改最大阈值。通过根据实时GPU的平均资源利用率的大小修正最小阈值和最大阈值，以及处于运行状态的实时业务POD进程的数量，提高了资源调度机制的准确率和有效性，大幅度提高了GPU资源利用率。但是，现有技术中，还存在以下问题，在实际情况中，在游戏的虚拟场景切换时容易发生卡顿、掉帧，现有技术中，往往基于GPU本身的资源率利用或当前的载荷对GPU进行调度，未考虑基于当前渲染画面内容做出分析，提前预测画面发生切换的情况进而提前调度GPU，减小在虚拟场景切换时的卡顿现象。发明内容为解决在游戏的虚拟场景切换时容易发生卡顿、掉帧问题，本发明提供一种基于资源调度的GPU效能提高方法，其包括：步骤S1，响应于第一预设条件，获取特征对象在虚拟场景内的移动路径，基于移动路径确定特征对象的移动目标场景，所述特征对象为用户端可操纵在虚拟场景内移动的虚拟单位，路径途经所述移动目标场景为所述特征对象移动路径途经的虚拟场景；步骤S2，基于所述移动目标场景中的渲染参数计算渲染复杂参数，并基于所述特征对象当前所在移动目标场景与预切换的移动目标场景对应渲染复杂参数的差异量判定各移动目标场景的类别，所述渲染参数包括移动目标场景中构成建模物体的多边形数量；步骤S3，基于所述特征对象依据所述移动路线在移动目标场景内移动时距离预切换的移动目标移动场景边界的距离判定是否处于运算调动时刻；步骤S4，响应于第二预设条件，基于所述特征对象预切换的移动目标场景的类别对GPU的运算节点进行调度，包括，在预切换的移动目标场景为第一类别时，增大当前用以渲染虚拟场景的GPU的节点数量；在预切换的移动目标场景为第二类别时，减小当前用以渲染虚拟场景的GPU的节点数量；并且，所述节点数量的增大量或减小量基于表征调整系数所确定，所述表征调整系数基于预切换的移动目标场景对应的渲染复杂参数以及场景切换速率计算所得，所述场景切换速率基于所述特征对象在所述虚拟场景内的移动速率所确定；其中，所述第一预设条件为用户端选定特征对象的移动路径后，所述第二预设条件为判定处于运算调动时刻。进一步地，所述步骤S2中还包括确定预切换的移动目标场景，其中，在所述虚拟单位依照所述移动路径移动并处于任意移动目标场景中时，将所述虚拟单位即将进入的移动目标场景确定为预切换的移动目标场景。进一步地，所述步骤S2中，基于移动目标场景中的渲染参数根据公式计算渲染复杂参数，，公式中，E表示渲染复杂参数，Ne表示虚拟场景中构成建模物体的多边形数量，Ne0表示预设的数量阈值。进一步地，所述步骤S2中，基于相邻移动目标场景对应渲染复杂参数的差异量判定各移动目标场景的类别，其中，计算特征对象当前所在移动目标场景与预切换的移动目标场景对应渲染复杂参数的差异量，将所述差异量与预设的差异量阈值进行对比，在第一对比条件下，判定所述移动目标场景为第一类别；在第二对比条件下，判定所述移动目标场景为第二类别；在不属于第一对比条件以及第二对比条件下，判定所述移动目标场景为第三类别；所述第一对比条件为，所述差异量大于等于所述差异量阈值且特征对象当前所在移动目标场景对应渲染复杂参数小于预切换的移动目标场景对应渲染复杂参数；所述第二对比条件为，所述差异量大于等于所述差异量阈值且特征对象当前所在移动目标场景对应渲染复杂参数大于预切换的移动目标场景对应渲染复杂参数。进一步地，所述步骤S3中，判定是否处于运算调动时刻，其中，将所述距离与预设的边界距离阈值进行对比，若所述距离小于所述边界距离阈值，则判定处于运算调动时刻。进一步地，所述步骤S3中，基于预切换的移动目标场景对应的渲染复杂参数以及场景切换速率根据公式计算表征调整系数，，公式中，C表示表征调整系数，E表示渲染复杂参数，E0表示预设的渲染复杂参数对比阈值，V表示场景切换速率，V0表示预设的场景切换速率对比阈值。进一步地，所述步骤S3中，节点数量的增大量或减小量基于表征调整系数所确定，其中，节点数量的增大量与所述表征调整系数呈正相关；节点数量的减小量与所述表征调整系数呈负相关。进一步地，所述步骤S4中，还包括，在所述特征对象预切换的移动目标场景的类别为第三类别时，不调整用以渲染虚拟场景的GPU的节点数量。进一步地，各所述虚拟场景的边界为预先划定所得。进一步地，各所述移动目标场景对应的渲染参数为预先统计所得。与现有技术相比，本发明获取特征对象在虚拟场景内的移动路径确定特征对象的移动目标场景，移动目标场景包括所述特征对象移动路径途经的若干虚拟场景，并且，基于移动目标场景中的渲染参数计算渲染复杂参数对应划分移动目标场景的类别，进而，基于特征对象预切换的移动目标场景的类别对GPU的运算节点进行调度，通过上述方法，基于虚拟场景内特征对象的移动路径，提前预测虚拟场景的切换，并提前适应性的基于预切换虚拟场景相关渲染参数调度GPU，提高GPU的利用率，减小在虚拟场景切换时的卡顿、掉帧现象。尤其，本发明在特征对象确定移动路径后，确定特征对象的移动目标场景，移动目标场景为移动路径所途经的若干虚拟场景，在实际情况中，游戏中存在着若干虚拟场景，虚拟场景的切换伴随着游戏人物的移动，因此，通过用户端控制游戏人物以输入移动路径移动时，由于指令已经下达，便可提前的对途经的各虚拟场景进行预先分析，为后续的GPU调度提供数据支持，便于提前适应性的基于预切换虚拟场景相关渲染参数调度GPU，提高GPU的利用率，减小在虚拟场景切换时的卡顿、掉帧现象。尤其，本发明划分各移动目标场景的类别，在实际情况中，各虚拟场景中的建模物体存在差异，因此各虚拟场景渲染的需求各不相同，在虚拟场景切换时，由“简单场景”切换至“复杂场景”的一瞬由于GPU资源可能基于负载调动或不变更，切换后负载才会增加，进而，GPU调动存在时延，因此在切换后一段时间内可能会存在卡顿、掉帧等不良现象，因此，本发明基于上述情况确定移动目标场景的类别，进而表征出虚拟场景切换的不同情况，在判定处于调动时刻后对GPU进行适应性的调动，进而，提高GPU的利用率，减小在虚拟场景切换时的卡顿、掉帧现象。尤其，本发明确定运算调动时刻，在临近虚拟场景切换时才进行适应性的调度，减少调度对当前渲染场景的影响，进而提高GPU的利用率，减小在虚拟场景切换时的卡顿、掉帧现象。尤其，本发明在确定节点的增大量或减小量时，基于表征调整系数确定增大量以及减小量，表征调整系数中包含了渲染复杂参数以及场景切换速率，渲染复杂参数能够表征渲染的复杂度，进而表征所需消耗的算力，同样的，场景切换速率基于特征对象在虚拟场景中的移动速度所确定，在游戏中，由于特征对象在虚拟场景中的移动速度表征了画面的切换速度，速度越快，画面的切换速率越快，进而渲染虚拟场景所需消耗的算力也会上升，因此本发明基于表征调整系数能够适应性的确定增大量以及减小量，提高GPU的利用率，减小在虚拟场景切换时的卡顿、掉帧现象。附图说明图1为发明实施例的基于资源调度的GPU效能提高方法步骤图；图2为发明实施例的步骤S3以及步骤S4逻辑框图。具体实施方式为了使本发明的目的和优点更加清楚明白，下面结合实施例对本发明作进一步描述；应当理解，此处所描述的具体实施例仅仅用于解释本发明，并不用于限定本发明。下面参照附图来描述本发明的优选实施方式。本领域技术人员应当理解的是，这些实施方式仅仅用于解释本发明的技术原理，并非在限制本发明的保护范围。请参阅图1所示，图1为本发明实施例的基于资源调度的GPU效能提高方法步骤图，图2为发明实施例的步骤S3以及步骤S4逻辑框图，本实施例的基于资源调度的GPU效能提高方法包括，步骤S1，响应于第一预设条件，获取特征对象在虚拟场景内的移动路径，基于移动路径确定特征对象的移动目标场景，所述特征对象为用户端可操纵在虚拟场景内移动的虚拟单位，路径途经所述移动目标场景为所述特征对象移动路径途经的虚拟场景；步骤S2，基于所述移动目标场景中的渲染参数计算渲染复杂参数，并基于所述特征对象当前所在移动目标场景与预切换的移动目标场景对应渲染复杂参数的差异量判定各移动目标场景的类别，所述渲染参数包括移动目标场景中构成建模物体的多边形数量；步骤S3，基于所述特征对象依据所述移动路线在移动目标场景内移动时距离预切换的移动目标移动场景边界的距离判定是否处于运算调动时刻；步骤S4，响应于第二预设条件，基于所述特征对象预切换的移动目标场景的类别对GPU的运算节点进行调度，包括，在预切换的移动目标场景为第一类别时，增大当前用以渲染虚拟场景的GPU的节点数量；在预切换的移动目标场景为第二类别时，减小当前用以渲染虚拟场景的GPU的节点数量；并且，所述节点数量的增大量或减小量基于表征调整系数所确定，所述表征调整系数基于预切换的移动目标场景对应的渲染复杂参数以及场景切换速率计算所得，所述场景切换速率基于所述特征对象在所述虚拟场景内的移动速率所确定；其中，所述第一预设条件为用户端选定特征对象的移动路径后，所述第二预设条件为判定处于运算调动时刻。具体而言，在本实施例中，为便于理解，本发明应用场景可设定在某大型3D游戏中，对于虚拟场景可以为该大型3D游戏中的虚拟场景，特征对象即为该大型3D游戏中的游戏角色。具体而言，对于特征对象在虚拟场景内移动路径的获取方式，不做具体限定，游戏路径可以为游戏角色在对应虚拟场景中移动的路径，本领域技术人员应当理解，游戏路径对应的指令由用户端发出，通过采集用户端的操作数据便可获取移动路径，此处不再赘述。具体而言，对于GPU的具体结构不做具体限定，GPU的架构包含多种，在本实施例中，GPU采用常规架构，可由若干计算节点组成，用以承担不同的计算任务，对计算节点的调度，本质上是对于算力资源的调度，此处不再赘述。本发明在特征对象确定移动路径后，确定特征对象的移动目标场景，移动目标场景为移动路径所途经的若干虚拟场景，在实际情况中，游戏中存在着若干虚拟场景，虚拟场景的切换伴随着游戏人物的移动，因此，通过用户端控制游戏人物以输入移动路径移动时，由于指令已经下达，便可提前的对途经的各虚拟场景进行预先分析，为后续的GPU调度提供数据支持，便于提前适应性的基于预切换虚拟场景相关渲染参数调度GPU，提高GPU的利用率，减小在虚拟场景切换时的卡顿、掉帧现象。具体而言，所述步骤S2中还包括确定预切换的移动目标场景，其中，在所述虚拟单位依照所述移动路径移动并处于任意移动目标场景中时，将所述虚拟单位即将进入的移动目标场景确定为预切换的移动目标场景。具体而言，所述步骤S2中，基于移动目标场景中的渲染参数根据公式计算渲染复杂参数，，公式中，E表示渲染复杂参数，Ne表示虚拟场景中构成建模物体的多边形数量，Ne0表示预设的数量阈值。具体而言，在虚拟场景中，建模物体通常是通过多边形网格来表示的，由若干多边形组成，多边形的数量和复杂度决定了场景中的几何细节和形状的精确程度，多边形数量的增加会导致渲染所需的顶点数据和片元数据增加，从而占用更多的GPU内存和计算资源，在本实施例中由于多边形的数量较多，因此，多边形数量可以是保留一定位数的近似值；预设的数量阈值可以基于若干虚拟场景中多边形数量的平均值△Ne所确定，在本实施例中，所述数量阈值Ne0即为若干虚拟场景中多边形数量的平均值△Ne。具体而言，所述步骤S2中，基于相邻移动目标场景对应渲染复杂参数的差异量判定各移动目标场景的类别，其中，计算特征对象当前所在移动目标场景与预切换的移动目标场景对应渲染复杂参数的差异量，将所述差异量与预设的差异量阈值进行对比，在第一对比条件下，判定所述移动目标场景为第一类别；在第二对比条件下，判定所述移动目标场景为第二类别；在不属于第一对比条件以及第二对比条件下，判定所述移动目标场景为第三类别；所述第一对比条件为，所述差异量大于等于所述差异量阈值且特征对象当前所在移动目标场景对应渲染复杂参数小于预切换的移动目标场景对应渲染复杂参数；所述第二对比条件为，所述差异量大于等于所述差异量阈值且特征对象当前所在移动目标场景对应渲染复杂参数大于预切换的移动目标场景对应渲染复杂参数。在本实施例中差异量阈值△Ne0为预先计算所得，在本实施例中，为体现出虚拟场景切换后带来的差异，设定差异量阈值△Ne0=△Ne×α，α表示差异系数，0.15＜α＜0.3。本发明划分各移动目标场景的类别，在实际情况中，各虚拟场景中的建模物体存在差异，因此各虚拟场景渲染的需求各不相同，在虚拟场景切换时，由“简单场景”切换至“复杂场景”的一瞬由于GPU资源可能基于负载调动或不变更，切换后负载才会增加，进而，GPU调动存在时延，因此在切换后一段时间内可能会存在卡顿、掉帧等不良现象，因此，本发明基于上述情况确定移动目标场景的类别，进而表征出虚拟场景切换的不同情况，在判定处于调动时刻后对GPU进行适应性的调动，进而，提高GPU的利用率，减小在虚拟场景切换时的卡顿、掉帧现象。具体而言，所述步骤S3中，判定是否处于运算调动时刻，其中，将所述距离与预设的边界距离阈值进行对比，若所述距离小于所述边界距离阈值，则判定处于运算调动时刻。在本实施例中，边界距离阈值为预先设定所得，为特征对象在虚拟场景中以当前移动速度移动2秒所能移动的距离。本发明确定运算调动时刻，在临近虚拟场景切换时才进行适应性的调度，减少调度对当前渲染场景的影响，进而提高GPU的利用率，减小在虚拟场景切换时的卡顿、掉帧现象。具体而言，所述步骤S3中，基于预切换的移动目标场景对应的渲染复杂参数以及场景切换速率根据公式计算表征调整系数，，公式中，C表示表征调整系数，E表示渲染复杂参数，E0表示预设的渲染复杂参数对比阈值，V表示场景切换速率，V0表示预设的场景切换速率对比阈值。在本实施例中场景切换速率可以与特征对象在虚拟场景中的移动速率相同；预设的渲染复杂参数对比阈值E0为若干虚拟场景中对应渲染复杂参数的平均值；预设的场景切换速率对比阈值V0为预先统计所得，其中，统计特征对象在虚拟场景中移动时的最快移动速率Vm，设定V0=γ×Vm，γ表示占比系数，0.75＜γ＜0.85。本发明在确定节点的增大量或减小量时，基于表征调整系数确定增大量以及减小量，表征调整系数中包含了渲染复杂参数以及场景切换速率，渲染复杂参数能够表征渲染的复杂度，进而表征所需消耗的算力，同样的，场景切换速率基于特征对象在虚拟场景中的移动速度所确定，在游戏中，由于特征对象在虚拟场景中的移动速度表征了画面的切换速度，速度越快，画面的切换速率越快，进而渲染虚拟场景所需消耗的算力也会上升，因此本发明基于表征调整系数能够适应性的确定增大量以及减小量，提高GPU的利用率，减小在虚拟场景切换时的卡顿、掉帧现象。具体而言，所述步骤S3中，节点数量的增大量或减小量基于表征调整系数所确定，其中，节点数量的增大量与所述表征调整系数呈正相关；节点数量的减小量与所述表征调整系数呈负相关；在本实施例中提供一种确定节点数量的增大量ZI或减小量ZD的确定方式，设定ZI=C×Nz/C0，设定ZD=C0×Nz/C，其中，Nz表示当前节点数量，C0表示预设的表征调整系数对比阈值，C0在区间内设定。具体而言，所述步骤S4中，还包括，在所述特征对象预切换的移动目标场景的类别为第三类别时，不调整用以渲染虚拟场景的GPU的节点数量。第三类别下预切换的移动目标场景与当前移动目标场景对应的渲染复杂参数差异性小或无差异性，调度CPU的节点数量的效果不明显，因此，不调整用以渲染虚拟场景的GPU的节点数量。具体而言，各所述虚拟场景的边界为预先划定所得。具体而言，各所述移动目标场景对应的渲染参数为预先统计所得。本发明的基于资源调度的GPU效能提高方法如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本发明的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的全部或部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台计算机设备执行本发明各个实施例所述方法的全部或部分步骤。而前述的存储介质包括：U盘、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质。至此，已经结合附图所示的优选实施方式描述了本发明的技术方案，但是，本领域技术人员容易理解的是，本发明的保护范围显然不局限于这些具体实施方式。在不偏离本发明的原理的前提下，本领域技术人员可以对相关技术特征做出等同的更改或替换，这些更改或替换之后的技术方案都将落入本发明的保护范围之内。
