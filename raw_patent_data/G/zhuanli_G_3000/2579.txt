标题title
用于直接内存访问读取操作的数据预读方法及介质
摘要abst
本申请提供用于直接内存访问读取操作的数据预读方法及介质。方法包括：通过第一设备发送多个直接内存访问读取报文到第二设备，第一直接内存访问读取报文指示访问第二设备的第二存储器的第一数据空间并且读取第一数据；通过第二设备发送对应的多个直接内存访问应答报文到第一设备，第一直接内存访问应答报文指示第一数据空间中相对于第一数据的剩余数据的数据长度；通过第一设备，基于剩余数据的数据长度，选择性地发起对第一数据的第一直接内存访问读取操作或者对第一数据空间的第二直接内存访问读取操作。如此，提高业务吞吐性能，降低业务传输延时，达到业务处理性能提升的效果。
权利要求书clms
1.一种用于直接内存访问读取操作的数据预读方法，其特征在于，所述数据预读方法包括：通过第一设备，发送多个直接内存访问读取报文到第二设备，其中，第一直接内存访问读取报文是所述多个直接内存访问读取报文中的任一直接内存访问读取报文，所述第一直接内存访问读取报文指示访问所述第二设备的第二存储器的第一数据空间并且读取位于所述第一数据空间的第一数据用于存储在所述第一设备的第一存储器；通过所述第二设备，发送与所述多个直接内存访问读取报文一一对应的多个直接内存访问应答报文到所述第一设备，其中，第一直接内存访问应答报文对应所述第一直接内存访问读取报文，所述第一直接内存访问应答报文指示所述第一数据空间中相对于所述第一数据的剩余数据的数据长度；通过所述第一设备，基于所述第一直接内存访问应答报文所指示的所述第一数据空间中相对于所述第一数据的剩余数据的数据长度，选择性地发起对所述第一数据的第一直接内存访问读取操作或者对所述第一数据空间的第二直接内存访问读取操作。2.根据权利要求1所述的数据预读方法，其特征在于，所述第二直接内存访问读取操作包括对所述第一数据空间执行全量数据读取。3.根据权利要求1所述的数据预读方法，其特征在于，所述第二直接内存访问读取操作包括读取所述第一数据和所述第一数据空间中相对于所述第一数据的所述剩余数据。4.根据权利要求1所述的数据预读方法，其特征在于，通过所述第一设备，基于所述第一直接内存访问应答报文所指示的所述第一数据空间中相对于所述第一数据的所述剩余数据的数据长度，选择性地发起对所述第一数据的所述第一直接内存访问读取操作或者对所述第一数据空间的所述第二直接内存访问读取操作，包括：通过所述第一设备，判断所述剩余数据是否是微量数据，当所述剩余数据不是微量数据时发起对所述第一数据的所述第一直接内存访问读取操作，当所述剩余数据是微量数据时发起对所述第一数据空间的所述第二直接内存访问读取操作。5.根据权利要求4所述的数据预读方法，其特征在于，当所述剩余数据不是微量数据时，所述第二设备不将所述剩余数据发送给所述第一设备。6.根据权利要求4所述的数据预读方法，其特征在于，当所述剩余数据的数据长度小于预设数据长度时，所述第一设备判断所述剩余数据是微量数据。7.根据权利要求4所述的数据预读方法，其特征在于，当所述剩余数据的数据长度小于所述第一直接内存访问读取报文的报文头的数据长度时，所述第一设备判断所述剩余数据是微量数据。8.根据权利要求4所述的数据预读方法，其特征在于，当所述剩余数据的数据长度小于所述第一直接内存访问应答报文的报文头的数据长度时，所述第一设备判断所述剩余数据是微量数据。9.根据权利要求4所述的数据预读方法，其特征在于，当所述剩余数据是微量数据时，所述第一设备所发起的对所述第一数据空间的所述第二直接内存访问读取操作包括对所述剩余数据执行数据预读用于存储在所述第一设备的所述第一存储器。10.根据权利要求1所述的数据预读方法，其特征在于，所述第一数据位于所述第二设备的所述第二存储器的第一内存地址区域，所述第一数据空间是所述第二存储器中的一个或者多个分区，所述一个或者多个分区整体上包括所述第一内存地址区域。11.根据权利要求10所述的数据预读方法，其特征在于，对所述第一数据空间的所述第二直接内存访问读取操作包括对所述一个或者多个分区分别执行全量数据读取。12.根据权利要求4所述的数据预读方法，其特征在于，所述第一设备所发起的对所述第一数据空间的所述第二直接内存访问读取操作包括读取所述第一数据和所述第一数据空间中相对于所述第一数据的所述剩余数据用于存储在所述第一设备的所述第一存储器。13.根据权利要求12所述的数据预读方法，其特征在于，第二直接内存访问读取报文是所述多个直接内存访问读取报文中的相对于所述第一直接内存访问读取报文的下一直接内存访问读取报文，所述第二直接内存访问读取报文指示至少访问所述第二设备的所述第二存储器的所述第一数据空间并且读取位于所述第一数据空间的所述剩余数据中的第二数据，所述第一设备通过存储在所述第一设备的所述第一存储器的所述剩余数据读取所述第二数据。14.根据权利要求13所述的数据预读方法，其特征在于，所述第二直接内存访问读取报文还指示访问所述第二设备的所述第二存储器的不同于所述第一数据空间的第二数据空间并且读取位于所述第二数据空间的第三数据，所述第一设备通过发起对所述第三数据的第三直接内存访问读取操作来读取所述第三数据。15.根据权利要求1至14中任一项所述的数据预读方法，其特征在于，所述第一设备是外设，所述第二设备是主机，所述第一存储器是所述外设的存储器，所述第二存储器是所述主机的内存。16.一种计算机设备，其特征在于，所述计算机设备包括存储器、处理器及存储在所述存储器上并可在所述处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现根据权利要求1至15中任一项所述的方法。17.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质存储有计算机指令，当所述计算机指令在计算机设备上运行时使得所述计算机设备执行根据权利要求1至15中任一项所述的方法。
说明书desc
技术领域本申请涉及计算机技术领域，尤其涉及用于直接内存访问读取操作的数据预读方法及介质。背景技术随着数据中心、云计算等应用的发展，直接内存访问技术被广泛地用于提升输入输出效率和降低内存拷贝开销。为了提升数据处理速度，可以利用远程直接内存访问技术来将数据从一台机器快速移动到远程机器的存储器中且数据传输不涉及到系统内核。从数据生产和数据消费的角度来看，DMA和RDMA都是由数据消费方，例如要消费数据的外设设备，向数据生产方，例如存储了待消费数据的主机，发起DMA读取操作进而获取相应数据进行处理。但是，现有技术中用于数据读取的DMA技术和RDMA技术，在面对海量的数据读取业务请求时，在吞吐量和延时上表现不佳也在业务处理性能的指标上表现不佳，这是因为很多时候发起DMA读取操作以及做出应答所导致的处理带宽、算力和内存开销、业务延时等，超过了通过本次DMA读取操作能带来的收益。为此，本申请提出了用于直接内存访问读取操作的数据预读方法及介质，以便应对现有技术中的技术难题。发明内容第一方面，本申请提供了一种用于直接内存访问读取操作的数据预读方法。所述数据预读方法包括：通过第一设备，发送多个直接内存访问读取报文到第二设备，其中，第一直接内存访问读取报文是所述多个直接内存访问读取报文中的任一直接内存访问读取报文，所述第一直接内存访问读取报文指示访问所述第二设备的第二存储器的第一数据空间并且读取位于所述第一数据空间的第一数据用于存储在所述第一设备的第一存储器；通过所述第二设备，发送与所述多个直接内存访问读取报文一一对应的多个直接内存访问应答报文到所述第一设备，其中，第一直接内存访问应答报文对应所述第一直接内存访问读取报文，所述第一直接内存访问应答报文指示所述第一数据空间中相对于所述第一数据的剩余数据的数据长度；通过所述第一设备，基于所述第一直接内存访问应答报文所指示的所述第一数据空间中相对于所述第一数据的剩余数据的数据长度，选择性地发起对所述第一数据的第一直接内存访问读取操作或者对所述第一数据空间的第二直接内存访问读取操作。通过本申请的第一方面，提高业务吞吐性能，降低业务传输延时，达到业务处理性能提升的效果。在本申请的第一方面的一种可能的实现方式中，所述第二直接内存访问读取操作包括对所述第一数据空间执行全量数据读取。在本申请的第一方面的一种可能的实现方式中，所述第二直接内存访问读取操作包括读取所述第一数据和所述第一数据空间中相对于所述第一数据的所述剩余数据。在本申请的第一方面的一种可能的实现方式中，通过所述第一设备，基于所述第一直接内存访问应答报文所指示的所述第一数据空间中相对于所述第一数据的所述剩余数据的数据长度，选择性地发起对所述第一数据的所述第一直接内存访问读取操作或者对所述第一数据空间的所述第二直接内存访问读取操作，包括：通过所述第一设备，判断所述剩余数据是否是微量数据，当所述剩余数据不是微量数据时发起对所述第一数据的所述第一直接内存访问读取操作，当所述剩余数据是微量数据时发起对所述第一数据空间的所述第二直接内存访问读取操作。在本申请的第一方面的一种可能的实现方式中，当所述剩余数据不是微量数据时，所述第二设备不将所述剩余数据发送给所述第一设备。在本申请的第一方面的一种可能的实现方式中，当所述剩余数据的数据长度小于预设数据长度 时，所述第一设备判断所述剩余数据是微量数据。在本申请的第一方面的一种可能的实现方式中，当所述剩余数据的数据长度小于所述第一直接内存访问读取报文的报文头的数据长度时，所述第一设备判断所述剩余数据是微量数据。在本申请的第一方面的一种可能的实现方式中，当所述剩余数据的数据长度小于所述第一直接内存访问应答报文的报文头的数据长度时，所述第一设备判断所述剩余数据是微量数据。在本申请的第一方面的一种可能的实现方式中，当所述剩余数据是微量数据时，所述第一设备所发起的对所述第一数据空间的所述第二直接内存访问读取操作包括对所述剩余数据执行数据预读用于存储在所述第一设备的所述第一存储器。在本申请的第一方面的一种可能的实现方式中，所述第一数据位于所述第二设备的所述第二存储器的第一内存地址区域，所述第一数据空间是所述第二存储器中的一个或者多个分区，所述一个或者多个分区整体上包括所述第一内存地址区域。在本申请的第一方面的一种可能的实现方式中，对所述第一数据空间的所述第二直接内存访问读取操作包括对所述一个或者多个分区分别执行全量数据读取。在本申请的第一方面的一种可能的实现方式中，所述第一设备所发起的对所述第一数据空间的所述第二直接内存访问读取操作包括读取所述第一数据和所述第一数据空间中相对于所述第一数据的所述剩余数据用于存储在所述第一设备的所述第一存储器。在本申请的第一方面的一种可能的实现方式中，第二直接内存访问读取报文是所述多个直接内存访问读取报文中的相对于所述第一直接内存访问读取报文的下一直接内存访问读取报文，所述第二直接内存访问读取报文指示至少访问所述第二设备的所述第二存储器的所述第一数据空间并且读取位于所述第一数据空间的所述剩余数据中的第二数据，所述第一设备通过存储在所述第一设备的所述第一存储器的所述剩余数据读取所述第二数据。在本申请的第一方面的一种可能的实现方式中，所述第二直接内存访问读取报文还指示访问所述第二设备的所述第二存储器的不同于所述第一数据空间的第二数据空间并且读取位于所述第二数据空间的第三数据，所述第一设备通过发起对所述第三数据的第三直接内存访问读取操作来读取所述第三数据。在本申请的第一方面的一种可能的实现方式中，所述第一设备是外设，所述第二设备是主机，所述第一存储器是所述外设的存储器，所述第二存储器是所述主机的内存。第二方面，本申请实施例还提供了一种计算机设备，所述计算机设备包括存储器、处理器及存储在所述存储器上并可在所述处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现根据上述任一方面的任一种实现方式的方法。第三方面，本申请实施例还提供了一种计算机可读存储介质，所述计算机可读存储介质存储有计算机指令，当所述计算机指令在计算机设备上运行时使得所述计算机设备执行根据上述任一方面的任一种实现方式的方法。第四方面，本申请实施例还提供了一种计算机程序产品，所述计算机程序产品包括存储在计算机可读存储介质上的指令，当所述指令在计算机设备上运行时使得所述计算机设备执行根据上述任一方面的任一种实现方式的方法。附图说明为了更清楚地说明本申请实施例技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图是本申请的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本申请实施例提供的一种第一设备向第二设备发起直接内存访问读取操作的示意图；图2为本申请实施例提供的一种用于直接内存访问读取操作的数据预读方法的流程示意图；图3为本申请实施例提供的一种计算设备的结构示意图。具体实施方式下面将结合附图对本申请实施例作进一步地详细描述。应当理解的是，在本申请的描述中，“至少一个”指一个或一个以上，“多个”指两个或两个以上。另外，“第一”、“第二”等词汇，除非另有说明，否则仅用于区分描述的目的，而不能理解为指示或暗示相对重要性，也不能理解为指示或暗示顺序。图1为本申请实施例提供的一种第一设备向第二设备发起直接内存访问读取操作的示意图。如图1所示，第一设备110向第二设备120发出直接内存访问读取报文130，第二设备120向第一设备110发出直接内存访问应答报文140作为对直接内存访问读取报文130的回应。这样，第一设备110利用直接内存访问技术，基于直接内存访问读取报文130和作为回应的直接内存访问应答报文140，利用一次DMA读取操作和一次DMA应答数据，实现了向第二设备120发起直接内存访问读取操作。第一设备110每一次向第二设备120发起的每一次直接内存访问读取操作，都涉及到一次DMA读取操作和一次DMA应答数据，也涉及到一个直接内存访问读取报文130和一个直接内存访问应答报文140。并且，直接内存访问读取报文130和直接内存访问应答报文140一般是按照标准通信协议并且遵循一定的数据格式。例如，在快捷外设器件互联总线或者PCIE设备之间互访时，所传送的数据报文被封装成传输层包报文，因此直接内存访问读取报文130和直接内存访问应答报文140都具有TLP报文的数据格式，例如都有16字节或者更大的TLP报文头。从数据生产和数据消费的角度来看，第一设备110用于消费数据，例如第一设备110可以是要消费数据的外设设备，第二设备120用于生产数据或者提供待消费数据，例如第二设备120可以是存储了待消费数据的主机。第一设备110一般具有优先的数据存储空间，例如外设设备如笔记本电脑、手机、智能终端等，其自身的内存空间有限并且要尽量利用有限的数据存储空间完成除了存储数据以外的其他任务。而第二设备120一般具有较充裕的数据存储空间，例如数据中心服务器、主机、云计算平台等。因此，待消费的数据一般存储在第二设备120如主机内存中，当第一设备110如外设设备需要消费一定量的数据时，第一设备110通过向第二设备120发起直接内存访问读取操作，以便从第二设备120获取相应的待消费数据进行处理。在多队列的应用场景下，可以安排多个队列用于在第一设备110和第二设备120之间的数据交互，例如第一设备110通过多个队列分别地发起多次的直接内存访问读取操作来获取多个数据。无论是通过单个队列发起的直接内存访问读取操作还是通过多个队列发起的直接内存访问读取操作，每一次的直接内存访问读取操作都涉及到至少一定量的处理带宽、算力、内存方面的损耗也会导致至少一定程度的业务延时。这是因为，每一次的直接内存访问读取操作都包括了，由数据消费方也即第一设备110向数据生产方或者数据提供方也即第二设备120发出直接内存访问读取报文130，以及由第二设备120向第一设备110发出直接内存访问应答报文140作为对直接内存访问读取报文130的回应。继续参阅图1，直接内存访问读取操作是从内存中的特定地址直接读取存储在该特定地址的数据。每一次直接内存访问读取操作都需要发送一次读请求报文以及发送一次应答报文。在多队列应用中，每个队列都是分别通过各自的直接内存访问读取操作来发起操作及获取相应数据。因此，每一次的直接内存访问读取操作都包括了，由数据消费方也即第一设备110向数据生产方或者数据提供方也即第二设备120发出直接内存访问读取报文130，以及由第二设备120向第一设备110发出直接内存访问应答报文140作为对直接内存访问读取报文130的回应。在数据中心、云计算等应用场景中，经常需要面对海量的数据读取业务请求，这些数据读取业务请求很多是利用DMA技术来提升数据处理性能，因此涉及到大量的读请求报文和应答报文。如上所述，取决于具体采用的通信标准协议和接口规范，直接内存访问读取报文130和直接内存访问应答报文140一般是按照一定规则被封装后成为具有一定数据格式的报文数据包并且一般具有固定长度的报文头。例如，直接内存访问读取报文130和直接内存访问应答报文140可以是TLP报文并且具有长度至少在16字节以上的TLP报文头。当通过直接内存访问读取操作获取的是微量数据时，微量数据本身的数据长度可能还不如读请求报文和应答报文各自的报文头长度。也就是说，当直接内存访问读取操作反馈的仅为微量数据时，相比于发起直接内存访问读取操作本身所带来的报文开销、PCIE总线处理带宽、以及业务延时，在业务处理性能上是不划算的。因此，当存在大量的针对微量数据的直接内存访问读取操作时，不利于提升业务处理性能。吞吐量和业务延时是在整体上考量业务处理性能的指标，每多一次对微量数据的读取，就会多一次直接内存访问读取操作和直接内存访问应答数据，而无论直接内存访问读取还是直接内存访问应答的TLP报文，均有16字节以上的长度。因此，为了完成某个任务而发起了多次用于获取待消费数据的读取，其中有些直接内存访问读取操作获取的仅仅是微量数据，这样的对微量数据的读取操作，消耗了PCIE总线收发的处理带宽从而降低了业务吞吐性能，也增加了一次DMA应答的等待时间从而增加了业务延时。当从整体上通过吞吐量和业务延时来评价业务处理性能时，针对微量数据发起的DMA读取操作以及做出应答所导致的处理带宽、算力和内存开销、业务延时等，超过了通过DMA读取操作能带来的收益。因此，当存在大量的针对微量数据的DMA读取操作时，不利于提升业务处理性能。下面结合图2进一步详细说明本申请实施例提供的用于直接内存访问读取操作的数据预读方法对此做出的各项改进。应当理解的是，图1所示的第一设备向第二设备发起直接内存访问读取操作，也可以适用于远程直接内存访问的有关场景。第一设备110可以利用RDMA技术来将数据从相对于第一设备110而言的远程机器也就是第二设备120快速移动到第一设备110，并且数据传输不涉及到系统内核。在RDMA的有关场景下，第一设备110和第二设备120之间的数据交互以及为了实现RDMA数据读取所涉及到的通信流程，要遵循RDMA通信协议，例如第一设备110和第二设备120之间可以建立RDMA连接或者属于同一个RDMA网络。上述的第一设备110向第二设备120发起的每一次的直接内存访问读取操作都涉及到至少一定量的处理带宽、算力、内存方面的损耗也会导致至少一定程度的业务延时；类似地，第一设备110向第二设备120发起的RDMA数据读取操作也会涉及到至少一定量的处理带宽、算力、内存方面的损耗也会导致至少一定程度的业务延时。因此，本申请实施例提供的一种用于直接内存访问读取操作的数据预读方法，可以用于改善在DMA和RDMA的有关场景下的业务处理性能。图2为本申请实施例提供的一种用于直接内存访问读取操作的数据预读方法的流程示意图。如图2所示，数据预读方法包括以下步骤。步骤S202：通过第一设备，发送多个直接内存访问读取报文到第二设备，其中，第一直接内存访问读取报文是所述多个直接内存访问读取报文中的任一直接内存访问读取报文，所述第一直接内存访问读取报文指示访问所述第二设备的第二存储器的第一数据空间并且读取位于所述第一数据空间的第一数据用于存储在所述第一设备的第一存储器。步骤S204：通过所述第二设备，发送与所述多个直接内存访问读取报文一一对应的多个直接内存访问应答报文到所述第一设备，其中，第一直接内存访问应答报文对应所述第一直接内存访问读取报文，所述第一直接内存访问应答报文指示所述第一数据空间中相对于所述第一数据的剩余数据的数据长度。步骤S206：通过所述第一设备，基于所述第一直接内存访问应答报文所指示的所述第一数据空间中相对于所述第一数据的剩余数据的数据长度，选择性地发起对所述第一数据的第一直接内存访问读取操作或者对所述第一数据空间的第二直接内存访问读取操作。参阅上述各个步骤，在步骤S202，通过第一设备，发送多个直接内存访问读取报文到第二设备。这里，可以通过单个队列或者多个队列或者任意其他方式来发送多个直接内存访问读取报文。以图1所示的第一设备110向第二设备120发起直接内存访问读取操作为例，每一次的直接内存访问读取操作都包括了，由数据消费方也即第一设备110向数据生产方或者数据提供方也即第二设备120发出直接内存访问读取报文130，以及由第二设备120向第一设备110发出直接内存访问应答报文140作为对直接内存访问读取报文130的回应。并且，取决于具体采用的通信标准协议和接口规范，直接内存访问读取报文130和直接内存访问应答报文140一般是按照一定规则被封装后成为具有一定数据格式的报文数据包并且一般具有固定长度的报文头。例如，直接内存访问读取报文130和直接内存访问应答报文140可以是TLP报文并且具有长度至少在16字节以上的TLP报文头。这里，第一直接内存访问读取报文是所述多个直接内存访问读取报文中的任一直接内存访问读取报文，所述第一直接内存访问读取报文指示访问所述第二设备的第二存储器的第一数据空间并且读取位于所述第一数据空间的第一数据用于存储在所述第一设备的第一存储器。所述第一直接内存访问读取报文可以是例如图1所示的直接内存访问读取报文130。所述第一直接内存访问读取报文可以是基于具体采用的通信标准协议和接口规范，例如所述第一直接内存访问读取报文可以是TLP报文。直接内存访问读取操作是从内存中的特定地址直接读取存储在该特定地址的数据。每一次直接内存访问读取操作都需要发送一次读请求报文以及发送一次应答报文。在多队列应用中，每个队列都是分别通过各自的直接内存访问读取操作来发起操作及获取相应数据。所述第一直接内存访问读取报文指示访问所述第二设备的第二存储器的第一数据空间并且读取位于所述第一数据空间的第一数据用于存储在所述第一设备的第一存储器。因此，所述第一直接内存访问读取报文指示了所述第二设备的第二存储器的第一数据空间并且读取位于所述第一数据空间的第一数据。接着，在步骤S204，通过所述第二设备，发送与所述多个直接内存访问读取报文一一对应的多个直接内存访问应答报文到所述第一设备。以图1所示的第一设备110向第二设备120发起直接内存访问读取操作为例，在多队列的应用场景下，可以安排多个队列用于在第一设备110和第二设备120之间的数据交互，例如第一设备110通过多个队列分别地发起多次的直接内存访问读取操作来获取多个数据。因此，与所述多个直接内存访问读取报文一一对应的多个直接内存访问应答报文也可以是通过单个队列或者多个队列或者任意其他方式来实现。这里，第一直接内存访问应答报文对应所述第一直接内存访问读取报文，所述第一直接内存访问应答报文指示所述第一数据空间中相对于所述第一数据的剩余数据的数据长度。在步骤S202中，所述第一直接内存访问读取报文指示访问所述第二设备的第二存储器的第一数据空间并且读取位于所述第一数据空间的第一数据用于存储在所述第一设备的第一存储器，因此，所述第一直接内存访问读取报文指示了所述第二设备的第二存储器的第一数据空间并且读取位于所述第一数据空间的第一数据。也就是说，所述第一数据是与所述第一直接内存访问读取报文和所述第一直接内存访问应答报文相关联的直接内存访问读取操作需要获取的待消费数据。在步骤S204，第一直接内存访问应答报文对应所述第一直接内存访问读取报文，所述第一直接内存访问应答报文用于与所述第一直接内存访问读取报文一起完成对第一数据的读取。并且，更进一步地，所述第一直接内存访问应答报文指示所述第一数据空间中相对于所述第一数据的剩余数据的数据长度。这样有利于后续的对数据读取操作的改进。然后，在步骤S206，通过所述第一设备，基于所述第一直接内存访问应答报文所指示的所述第一数据空间中相对于所述第一数据的剩余数据的数据长度，选择性地发起对所述第一数据的第一直接内存访问读取操作或者对所述第一数据空间的第二直接内存访问读取操作。在步骤S204中，通过所述第二设备发送给所述第一设备的第一直接内存访问应答报文，指示了所述第一数据空间中相对于所述第一数据的剩余数据的数据长度，这样的关键信息用于在步骤S206对数据读取操作的改进。具体地，在步骤S206，所述第一设备，基于在步骤S204中从第二设备获取的关键信息，也就是基于所述第一直接内存访问应答报文所指示的所述第一数据空间中相对于所述第一数据的剩余数据的数据长度，可以选择性地发起对所述第一数据的第一直接内存访问读取操作或者对所述第一数据空间的第二直接内存访问读取操作。这意味着，与所述第一直接内存访问读取报文和所述第一直接内存访问应答报文相关联的直接内存访问读取操作，需要获取的待消费数据是所述第一数据，并且，所述第一直接内存访问读取报文指示访问所述第二设备的第二存储器的第一数据空间并且读取位于所述第一数据空间的第一数据用于存储在所述第一设备的第一存储器。第一直接内存访问应答报文对应所述第一直接内存访问读取报文，所述第一直接内存访问应答报文用于与所述第一直接内存访问读取报文一起完成对第一数据的读取。进一步地，通过让所述第一直接内存访问应答报文携带关键信息也即所述第一数据空间中相对于所述第一数据的剩余数据的数据长度，使得第一设备在收到所述第一直接内存访问应答报文之后，可以选择发起只针对所述第一数据的第一直接内存访问读取操作，或者选择发起针对所述第一数据空间的第二直接内存访问读取操作。其中，第一直接内存访问读取操作意味着访问所述第二设备的第二存储器的第一数据空间并且读取位于所述第一数据空间的第一数据。第二直接内存访问读取操作意味着访问所述第二设备的第二存储器的第一数据空间并且读取存储在所述第一数据空间的所有数据，也就是读取第一数据以及读取所述第一数据空间中相对于所述第一数据的剩余数据。所述第一设备基于所述第一直接内存访问应答报文所指示的所述第一数据空间中相对于所述第一数据的剩余数据的数据长度来做出选择，是从整体角度上，采取更有利于提升业务处理性能的措施。其中，在以图1所示的第一设备向第二设备发起直接内存访问读取操作为例的场景中，当存在大量的针对微量数据的DMA读取操作时，不利于提升整体的业务处理性能。具体地，当通过直接内存访问读取操作获取的是微量数据时，微量数据本身的数据长度可能还不如读请求报文和应答报文各自的报文头长度。也就是说，当直接内存访问读取操作反馈的仅为微量数据时，相比于发起直接内存访问读取操作本身所带来的报文长度、PCIE总线处理带宽、以及业务延时，在业务处理性能上是不划算的。每多一次对微量数据的读取，就会多一次直接内存访问读取操作和直接内存访问应答数据，而无论直接内存访问读取还是直接内存访问应答的TLP报文，均有16字节以上的长度。因此，为了完成某个任务而发起了多次用于获取待消费数据的读取，其中有些直接内存访问读取操作获取的仅仅是微量数据，这样的对微量数据的读取操作，消耗了PCIE总线收发的处理带宽从而降低了业务吞吐性能，也增加了一次DMA应答的等待时间从而增加了业务延时。当从整体上通过吞吐量和业务延时来评价业务处理性能时，针对微量数据发起的DMA读取操作以及做出应答所导致的处理带宽、算力和内存开销、业务延时等，超过了通过DMA读取操作能带来的收益。因此，当存在大量的针对微量数据的DMA读取操作时，不利于提升业务处理性能。所述第一设备从整体角度上采取更有利于提升业务处理性能的措施，这意味着尽量避免降低针对微量数据的DMA读取操作的次数和频率。为此，所述第一设备基于所述第一直接内存访问应答报文所指示的所述第一数据空间中相对于所述第一数据的剩余数据的数据长度，可以判断出只针对所述第一数据的第一直接内存访问读取操作和针对所述第一数据空间的第二直接内存访问读取操作之间，哪一个更有利于提升整体业务处理性能如提升吞吐量和降低延时。例如，当所述剩余数据不是微量数据时发起对所述第一数据的所述第一直接内存访问读取操作，当所述剩余数据是微量数据时发起对所述第一数据空间的所述第二直接内存访问读取操作。如此，当所述剩余数据是微量数据时发起对所述第一数据空间的所述第二直接内存访问读取操作，等效于预读了微量数据，这样后续当需要获取被预读的微量数据时，可以不需要发起直接内存访问操作读取微量数据而是利用被预读的微量数据满足数据读取需要，这样就节省了每一次直接内存访问读取操作所导致的处理带宽、算力和内存开销、业务延时等，包括节省了每一次直接内存访问读取操作都需要发送一次读请求报文以及发送一次应答报文所带来的开销，在整体上降低了针对微量数据发起的直接内存访问读取操作的频次。例如，可以截取需要的数据进行处理同时把剩余的微量数据按队列进行存储。当外设设备下次操作数据时，结合存储的微量数据和下一次DMA读取操作获得数据组成新的数据，供外设设备进行处理。如此，通过微量数据的DMA预读操作，在整体上降低了针对微量数据的DMA读取操作的次数和频率，提高业务吞吐性能，降低业务传输延时，达到业务处理性能提升的效果。在一种可能的实施方式中，所述第二直接内存访问读取操作包括对所述第一数据空间执行全量数据读取。如此，通过全量数据读取实现了访问所述第二设备的第二存储器的第一数据空间并且读取存储在所述第一数据空间的所有数据，也就是读取第一数据以及读取所述第一数据空间中相对于所述第一数据的剩余数据。这样等效于预读了微量数据，这样后续当需要获取被预读的微量数据时，可以不需要发起直接内存访问操作读取微量数据而是利用被预读的微量数据满足数据读取需要，这样就节省了每一次直接内存访问读取操作所导致的处理带宽、算力和内存开销、业务延时等，包括节省了每一次直接内存访问读取操作都需要发送一次读请求报文以及发送一次应答报文所带来的开销，在整体上降低了针对微量数据发起的直接内存访问读取操作的频次。在一种可能的实施方式中，所述第二直接内存访问读取操作包括读取所述第一数据和所述第一数据空间中相对于所述第一数据的所述剩余数据。如此，当所述剩余数据是微量数据时发起对所述第一数据空间的所述第二直接内存访问读取操作，等效于预读了微量数据，这样后续当需要获取被预读的微量数据时，可以不需要发起直接内存访问操作读取微量数据而是利用被预读的微量数据满足数据读取需要，这样就节省了每一次直接内存访问读取操作所导致的处理带宽、算力和内存开销、业务延时等，包括节省了每一次直接内存访问读取操作都需要发送一次读请求报文以及发送一次应答报文所带来的开销，在整体上降低了针对微量数据发起的直接内存访问读取操作的频次。在一种可能的实施方式中，通过所述第一设备，基于所述第一直接内存访问应答报文所指示的所述第一数据空间中相对于所述第一数据的所述剩余数据的数据长度，选择性地发起对所述第一数据的所述第一直接内存访问读取操作或者对所述第一数据空间的所述第二直接内存访问读取操作，包括：通过所述第一设备，判断所述剩余数据是否是微量数据，当所述剩余数据不是微量数据时发起对所述第一数据的所述第一直接内存访问读取操作，当所述剩余数据是微量数据时发起对所述第一数据空间的所述第二直接内存访问读取操作。如此，当所述剩余数据是微量数据时发起对所述第一数据空间的所述第二直接内存访问读取操作，等效于预读了微量数据，这样后续当需要获取被预读的微量数据时，可以不需要发起直接内存访问操作读取微量数据而是利用被预读的微量数据满足数据读取需要，这样就节省了每一次直接内存访问读取操作所导致的处理带宽、算力和内存开销、业务延时等，包括节省了每一次直接内存访问读取操作都需要发送一次读请求报文以及发送一次应答报文所带来的开销，在整体上降低了针对微量数据发起的直接内存访问读取操作的频次。在一种可能的实施方式中，当所述剩余数据不是微量数据时，所述第二设备不将所述剩余数据发送给所述第一设备。如此，有利于提升整体业务处理性能。在一种可能的实施方式中，当所述剩余数据的数据长度小于预设数据长度时，所述第一设备判断所述剩余数据是微量数据。如此，通过预设数据长度，所述第一设备基于所述第一直接内存访问应答报文所指示的所述第一数据空间中相对于所述第一数据的剩余数据的数据长度，可以判断出只针对所述第一数据的第一直接内存访问读取操作和针对所述第一数据空间的第二直接内存访问读取操作之间，哪一个更有利于提升整体业务处理性能如提升吞吐量和降低延时。在一种可能的实施方式中，当所述剩余数据的数据长度小于所述第一直接内存访问读取报文的报文头的数据长度时，所述第一设备判断所述剩余数据是微量数据。取决于具体采用的通信标准协议和接口规范，直接内存访问读取报文和直接内存访问应答报文一般是按照一定规则被封装后成为具有一定数据格式的报文数据包并且一般具有固定长度的报文头。例如，直接内存访问读取报文和直接内存访问应答报文可以是TLP报文并且具有长度至少在16字节以上的TLP报文头。因此，通过比较所述剩余数据的数据长度和所述第一直接内存访问读取报文的报文头的数据长度，有助于判断出只针对所述第一数据的第一直接内存访问读取操作和针对所述第一数据空间的第二直接内存访问读取操作之间，哪一个更有利于提升整体业务处理性能如提升吞吐量和降低延时。在一种可能的实施方式中，当所述剩余数据的数据长度小于所述第一直接内存访问应答报文的报文头的数据长度时，所述第一设备判断所述剩余数据是微量数据。通过比较所述剩余数据的数据长度和所述第一直接内存访问应答报文的报文头的数据长度，有助于判断出只针对所述第一数据的第一直接内存访问读取操作和针对所述第一数据空间的第二直接内存访问读取操作之间，哪一个更有利于提升整体业务处理性能如提升吞吐量和降低延时。在一种可能的实施方式中，当所述剩余数据是微量数据时，所述第一设备所发起的对所述第一数据空间的所述第二直接内存访问读取操作包括对所述剩余数据执行数据预读用于存储在所述第一设备的所述第一存储器。这样后续当需要获取被预读的微量数据时，可以不需要发起直接内存访问操作读取微量数据而是利用被预读的微量数据满足数据读取需要，这样就节省了每一次直接内存访问读取操作所导致的处理带宽、算力和内存开销、业务延时等，包括节省了每一次直接内存访问读取操作都需要发送一次读请求报文以及发送一次应答报文所带来的开销，在整体上降低了针对微量数据发起的直接内存访问读取操作的频次。在一种可能的实施方式中，所述第一数据位于所述第二设备的所述第二存储器的第一内存地址区域，所述第一数据空间是所述第二存储器中的一个或者多个分区，所述一个或者多个分区整体上包括所述第一内存地址区域。如此，通过分区进行数据读取，提升整体效率。在一些实施例中，对所述第一数据空间的所述第二直接内存访问读取操作包括对所述一个或者多个分区分别执行全量数据读取。如此，通过分区进行全量数据读取，等效于分区进行微量数据预读，有利于提升整体效率。在一种可能的实施方式中，所述第一设备所发起的对所述第一数据空间的所述第二直接内存访问读取操作包括读取所述第一数据和所述第一数据空间中相对于所述第一数据的所述剩余数据用于存储在所述第一设备的所述第一存储器。如此，当所述剩余数据是微量数据时发起对所述第一数据空间的所述第二直接内存访问读取操作，等效于预读了微量数据，这样后续当需要获取被预读的微量数据时，可以不需要发起直接内存访问操作读取微量数据而是利用被预读的微量数据满足数据读取需要，这样就节省了每一次直接内存访问读取操作所导致的处理带宽、算力和内存开销、业务延时等，包括节省了每一次直接内存访问读取操作都需要发送一次读请求报文以及发送一次应答报文所带来的开销，在整体上降低了针对微量数据发起的直接内存访问读取操作的频次。在一些实施例中，第二直接内存访问读取报文是所述多个直接内存访问读取报文中的相对于所述第一直接内存访问读取报文的下一直接内存访问读取报文，所述第二直接内存访问读取报文指示至少访问所述第二设备的所述第二存储器的所述第一数据空间并且读取位于所述第一数据空间的所述剩余数据中的第二数据，所述第一设备通过存储在所述第一设备的所述第一存储器的所述剩余数据读取所述第二数据。如此，当后续的读取报文如所述第二直接内存访问读取报文需要读取的第二数据是在之前被预读的剩余数据中时，所述第一设备通过所述第一存储器可以满足所述第二直接内存访问读取报文的需要，这样就不需要发起直接内存访问操作读取微量数据而是利用被预读的微量数据满足数据读取需要，从而节省了每一次直接内存访问读取操作所导致的处理带宽、算力和内存开销、业务延时等。在一些实施例中，所述第二直接内存访问读取报文还指示访问所述第二设备的所述第二存储器的不同于所述第一数据空间的第二数据空间并且读取位于所述第二数据空间的第三数据，所述第一设备通过发起对所述第三数据的第三直接内存访问读取操作来读取所述第三数据。如此，可以结合先前被预读的微量数据和下一次DMA读取操作要获得的数据也就是所述第三数据组成新的数据，从而在整体上降低了针对微量数据的DMA读取操作的次数和频率，提高业务吞吐性能，降低业务传输延时，达到业务处理性能提升的效果。在一种可能的实施方式中，所述第一设备是外设，所述第二设备是主机，所述第一存储器是所述外设的存储器，所述第二存储器是所述主机的内存。从数据生产和数据消费的角度来看，第一设备用于消费数据，例如第一设备可以是要消费数据的外设，第二设备用于生产数据或者提供待消费数据，例如第二设备可以是存储了待消费数据的主机。第一设备一般具有优先的数据存储空间，外设如笔记本电脑、手机、智能终端等，其自身的内存空间有限并且要尽量利用有限的数据存储空间完成除了存储数据以外的其他任务。而第二设备一般具有较充裕的数据存储空间，例如数据中心服务器、主机、云计算平台等。因此，待消费的数据一般存储在第二设备如主机内存中，当第一设备如外设需要消费一定量的数据时，第一设备通过向第二设备发起直接内存访问读取操作，以便从第二设备获取相应的待消费数据进行处理。图3是本申请实施例提供的一种计算设备的结构示意图，该计算设备300包括：一个或者多个处理器310、通信接口320以及存储器330。所述处理器310、通信接口320以及存储器330通过总线340相互连接。可选地，该计算设备300还可以包括输入/输出接口350，输入/输出接口350连接有输入/输出设备，用于接收用户设置的参数等。该计算设备300能够用于实现上述的本申请实施例中设备实施例或者系统实施例的部分或者全部功能；处理器310还能够用于实现上述的本申请实施例中方法实施例的部分或者全部操作步骤。例如，该计算设备300执行各种操作的具体实现可参照上述实施例中的具体细节，如处理器310用于执行上述方法实施例中部分或者全部步骤或者上述方法实施例中的部分或者全部操作。再例如，本申请实施例中，计算设备300可用于实现上述装置实施例中一个或者多个部件的部分或者全部功能，此外通信接口320具体可用于为了实现这些装置、部件的功能所必须的通讯功能等，以及处理器310具体可用于为了实现这些装置、部件的功能所必须的处理功能等。应当理解的是，图3的计算设备300可以包括一个或者多个处理器310，并且多个处理器310可以按照并行化连接方式、串行化连接方式、串并行连接方式或者任意连接方式来协同提供处理能力，或者多个处理器310可以构成处理器序列或者处理器阵列，或者多个处理器310之间可以分成主处理器和辅助处理器，或者多个处理器310之间可以具有不同的架构如采用异构计算架构。另外，图3所示的计算设备300，相关的结构性描述及功能性描述是示例性且非限制性的。在一些示例性实施例中，计算设备300可以包括比图3所示的更多或更少的部件，或者组合某些部件，或者拆分某些部件，或者具有不同的部件布置。处理器310可以有多种具体实现形式，例如处理器310可以包括中央处理器、图形处理器、神经网络处理器、张量处理器或数据处理器等一种或多种的组合，本申请实施例不做具体限定。处理器310还可以是单核处理器或多核处理器。处理器310可以由CPU和硬件芯片的组合。上述硬件芯片可以是专用集成电路，可编程逻辑器件或其组合。上述PLD可以是复杂可编程逻辑器件，现场可编程逻辑门阵列，通用阵列逻辑或其任意组合。处理器310也可以单独采用内置处理逻辑的逻辑器件来实现，例如FPGA或数字信号处理器等。通信接口320可以为有线接口或无线接口，用于与其他模块或设备进行通信，有线接口可以是以太接口、局域互联网络等，无线接口可以是蜂窝网络接口或使用无线局域网接口等。存储器330可以是非易失性存储器，例如，只读存储器、可编程只读存储器、可擦除可编程只读存储器、电可擦除可编程只读存储器或闪存。存储器330也可以是易失性存储器，易失性存储器可以是随机存取存储器，其用作外部高速缓存。通过示例性但不是限制性说明，许多形式的RAM可用，例如静态随机存取存储器、动态随机存取存储器、同步动态随机存取存储器、双倍数据速率同步动态随机存取存储器、增强型同步动态随机存取存储器、同步连接动态随机存取存储器和直接内存总线随机存取存储器。存储器330也可用于存储程序代码和数据，以便于处理器310调用存储器330中存储的程序代码执行上述方法实施例中的部分或者全部操作步骤，或者执行上述设备实施例中的相应功能。此外，计算设备300可能包含相比于图3展示的更多或者更少的组件，或者有不同的组件配置方式。总线340可以是快捷外围部件互连标准总线，或扩展工业标准结构总线、统一总线、计算机快速链接、缓存一致互联协议等。总线340可以分为地址总线、数据总线、控制总线等。总线340除包括数据总线之外，还可以包括电源总线、控制总线和状态信号总线等。但是为了清楚说明起见，图3中仅用一条粗线表示，但并不表示仅有一根总线或一种类型的总线。本申请实施例提供的方法和设备是基于同一发明构思的，由于方法及设备解决问题的原理相似，因此方法与设备的实施例、实施方式、示例或实现方式可以相互参见，其中重复之处不再赘述。本申请实施例还提供一种系统，该系统包括多个计算设备，每个计算设备的结构可以参照上述所描述的计算设备的结构。该系统可实现的功能或者操作可以参照上述方法实施例中的具体实现步骤和/或上述装置实施例中所描述的具体功能，在此不再赘述。本申请实施例还提供一种计算机可读存储介质，所述计算机可读存储介质中存储有计算机指令，当所述计算机指令在计算机设备上运行时可以实现上述方法实施例中的方法步骤。所述计算机可读存储介质的处理器在执行上述方法步骤的具体实现可参照上述方法实施例中所描述的具体操作和/或上述装置实施例中所描述的具体功能，在此不再赘述。本领域内的技术人员应明白，本申请的实施例可提供为方法、系统、或计算机程序产品。本申请可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。本申请实施例可以全部或部分地通过软件、硬件、固件或其他任意组合来实现。当使用软件实现时，上述实施例可以全部或部分地以计算机程序产品的形式实现。本申请可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。所述计算机程序产品包括一个或多个计算机指令。在计算机上加载或执行所述计算机程序指令时，全部或部分地产生按照本申请实施例所述的流程或功能。所述计算机可以为通用计算机、专用计算机、计算机网络、或者其他可编程装置。计算机指令可以存储在计算机可读存储介质中，或者从一个计算机可读存储介质向另一个计算机可读存储介质传输，例如，计算机指令可以从一个网站站点、计算机、服务器或数据中心通过有线或无线方式向另一个网站站点、计算机、服务器或数据中心进行传输。计算机可读存储介质可以是计算机能够存取的任何可用介质或者是包含一个或多个可用介质集合的服务器、数据中心等数据存储设备。可用介质可以是磁性介质、光介质、或者半导体介质。半导体介质可以是固态硬盘，也可以是随机存取存储器，闪存，只读存储器，可擦可编程只读存储器，电可擦可编程只读存储器，寄存器或任何其他形式的合适存储介质。本申请是参照根据本申请实施例的方法、设备、和计算机程序产品的流程图和/或方框图来描述。可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。在上述实施例中，对各个实施例的描述都各有侧重，某个实施例中没有详述的部分，可以参见其它实施例的相关描述。显然，本领域的技术人员可以对本申请实施例进行各种改动和变型而不脱离本申请实施例的精神和范围。本申请实施例方法中的步骤可以根据实际需要进行顺序调整、合并或删减；本申请实施例系统中的模块可以根据实际需要进行划分、合并或删减。如果本申请实施例的这些修改和变型属于本申请权利要求及其等同技术的范围之内，则本申请也意图包含这些改动和变型在内。
