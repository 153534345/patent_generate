标题title
一种同场景多风格图像匹配方法、装置及应用
摘要abst
本申请提出了一种同场景多风格图像匹配方法、装置及应用，包括以下步骤：构建图像匹配模型，所述图像匹配模型包括风格编码器、第一和第二风格迁移网络以及匹配度计算网络；通过训练样本中不同天气条件下的多张图像，将两张图像输入风格编码器获取编码信息，若不同，则使用第一和第二风格迁移网络生成新图像，并在匹配度计算网络中判断图像匹配程度；若匹配度超过阈值，则认为两张图像匹配。本方案通过判断图像的风格编码信息，并转变图像的风格来进行图像匹配，从而使得图像匹配的精确程度更高。
权利要求书clms
1.一同场景多风格图像匹配方法，其特征在于，包括以下步骤：构建图像匹配模型，所述图像匹配模型包括风格编码判断网络、结构相同的第一风格迁移网络和第二风格迁移网络以及匹配网络，所述风格编码判断网络包括对应第一输入分支和第二输入分支的两个风格编码器，所述第一风格迁移网络和第二风格迁移网络均包括第一编码分支、第二编码分支以及生成器，所述第一编码分支由线性投影层、语义感知位置编码层以及风格编码器组成，所述第二编码分支由并行的时序特征编码器、深度估计网络以及编码输入端组成；所述编码输入端的输入是经训练后的所述风格编码器输出的对应不同图像风格的风格编码信息，训练好的时序特征编码器将输入特征转换为对应的时间向量，训练好的深度估计网络将输入特征转换为对应的深度图；获取需要进行匹配的第一图像和第二图像，所述第一图像输入所述风格编码判断网络的第一输入分支中经过风格编码器编码后得到第一编码结果，所述第二图像输入所述风格编码判断网络的第二输入分支中经过风格编码器编码后得到第二编码结果，若第一编码结果和第二编码结果相同则通过匹配网络判断第一图像和第二图像的匹配结果；若第一编码结果和第二编码结果不同，将第一图像输入到第一风格迁移网络的第一编码分支中得到第一语义特征，将第二图像及第二编码结果输入到第一风格迁移网络的第二编码分支得到第一特征集合，将所述第二编码分支结果和所述第一语义特征输入到生成器中生成第一合成图，计算所述第一合成图和第二图像的第一相似度；将第二图像输入到第二风格迁移网络的第一编码分支中得到第二语义特征，将第一图像及第一编码结果输入到第二风格迁移网络的第二编码分支得到第二特征集合，将所述第二语义特征和所述第二特征集合输入到生成器中生成第二合成图，计算所述第二合成图和第一图像的第二相似度；若所述第一相似度和所述第二相似度的和大于设定阈值，则判断第一图像和第二图像匹配。2.根据权利要求1所述的一种同场景多风格图像匹配方法，其特征在于，所述风格编码器由注意力模块和多层感知器依次串联组成，所述风格编码器的输入为图像序列特征，将所述输入图像分割为多个图像块，使用线性投影对每一所述图像块进行投影得到图像序列特征，所述风格编码器的输出为与所述输入图像对应的风格编码信息。3.根据权利要求1所述的一种同场景多风格图像匹配方法，其特征在于，在“将第一图像输入到第一风格迁移网络的第一编码分支中得到第一语义特征”步骤中，所述第一编码分支中的语义感知位置编码层获取所述第一图像的语义感知位置编码，所述第一编码分支中的线性投影层获取第一图像的图像序列特征，将所述第一图像的语义感知位置编码以及所述图像序列特征输入到所述第一编码分支中的风格编码器中得到第一语义特征。4.根据权利要求1所述的一种同场景多风格图像匹配方法，其特征在于，在“计算所述第一合成图和第二图像的第一相似度”步骤中,所述匹配网络对所述第一合成图像和所述第二图像进行关键点特征之间的匹配，并通过一个全连接层来输出所述第一合成图像和所述第二图像之间的关键点特征的匹配度作为所述第一相似度。5.根据权利要求1所述的一种同场景多风格图像匹配方法，其特征在于，所述图像匹配模型的训练分为训练阶段1、训练阶段2、训练阶段3以及训练阶段4，通过训练阶段1获取图像匹配模型的对抗损失、重构损失、类内距离损失，通过训练阶段2获取图像匹配模型的匹配损失，通过训练阶段3获取图像匹配模型的循环损失，通过训练阶段4获取图像匹配模型的生成损失，所述图像匹配模型的总体损失为对抗损失、重构损失、类内距离损失、匹配损失、循环损失、生成损失的和，在训练时先保持判别器参数不变，调整所述生成器和所述风格编码器的参数使总体损失最小，再保持生成器和所述风格编码器的参数不变，调整判别器的参数使得总体损失最大直至稳定得到训练好的图像匹配模型。6.根据权利要求1所述的一种同场景多风格图像匹配方法，其特征在于，在“将第二图像及第二编码结果输入到第一风格迁移网络的第二编码分支得到第一特征集合”步骤中，所述第一特征集合包括所述第二编码结果、第二图像的时间向量以及第二图像的深度图。7.根据权利要求1所述的一种同场景多风格图像匹配方法，其特征在于，在“训练好的深度估计网络将输入特征转换为对应的深度图”步骤中，所述深度估计网络对输入图像进行多次下采样得到第一图像数据、第二图像数、第三图像数据、第四图像数据，分别对第一图像数据、第二图像数据、第三图像数据、第四图像数据进行上采样得到第一上采样图像数据、第二上采样图像数据、第三上采样图像数据、第四上采样图像数据，使用上采样图像数据减去对应大小的图像数据得到第一轮廓信息、第二轮廓信息、第三轮廓信息、第四轮廓信息，将所述第四图像数据输入到所述解码器中得到第五深度图像和第四中间特征，对所述第五深度图像进行上采样得到第五深度上采样图像，将所述第四轮廓信息、第五深度上采样图像以及第四中间特征进行特征拼接得到第四轮廓深度特征，对所述第四轮廓深度特征进行卷积后与第四轮廓信息相加得到第四深度图像，将所述第五深度上采样图像与所述第四深度图像相加得到第四输出结果，以此类推得到第一输出结果，所述第一输出结果为与所述输入图像对应的深度特征图。8.一种同场景多风格图像匹配装置，其特征在于，包括：构建模块：构建图像匹配模型，所述图像匹配模型包括风格编码判断网络、结构相同的第一风格迁移网络和第二风格迁移网络以及匹配网络，所述风格编码判断网络包括对应第一输入分支和第二输入分支的两个风格编码器，所述第一风格迁移网络和第二风格迁移网络均包括第一编码分支、第二编码分支以及生成器，所述第一编码分支由线性投影层、语义感知位置编码层以及风格编码器组成，所述第二编码分支由并行的时序特征编码器、深度估计网络以及编码输入端组成；所述编码输入端的输入是经训练后的所述风格编码器输出的对应不同图像风格的风格编码信息，训练好的时序特征编码器将输入特征转换为对应的时间向量，训练好的深度估计网络将输入特征转换为对应的深度图；获取模块：获取需要进行匹配的第一图像和第二图像，所述第一图像输入所述风格编码判断网络的第一输入分支中经过风格编码器编码后得到第一编码结果，所述第二图像输入所述风格编码判断网络的第二输入分支中经过风格编码器编码后得到第二编码结果，若第一编码结果和第二编码结果相同则通过匹配网络判断第一图像和第二图像的匹配结果；第一计算模块：若第一编码结果和第二编码结果不同，将第一图像输入到第一风格迁移网络的第一编码分支中得到第一语义特征，将第二图像及第二编码结果输入到第一风格迁移网络的第二编码分支得到第一特征集合，将所述第二编码分支结果和所述第一语义特征输入到生成器中生成第一合成图，计算所述第一合成图和第二图像的第一相似度；第二计算模块：将第二图像输入到第二风格迁移网络的第一编码分支中得到第二语义特征，将第一图像及第一编码结果输入到第二风格迁移网络的第二编码分支得到第二特征集合，将所述第二语义特征和所述第二特征集合输入到生成器中生成第二合成图，计算所述第二合成图和第一图像的第二相似度；匹配模块：若所述第一相似度和所述第二相似度的和大于设定阈值，则判断第一图像和第二图像匹配。9.一种电子装置，包括存储器和处理器，其特征在于，所述存储器中存储有计算机程序，所述处理器被设置为运行所述计算机程序以执行权利要求1-7任一所述的一种同场景多风格图像匹配方法。10.一种可读存储介质，其特征在于，所述可读存储介质中存储有计算机程序，所述计算机程序包括用于控制过程以执行过程的程序代码，所述过程包括根据权利要求1-7任一所述的一种同场景多风格图像匹配方法。
说明书desc
技术领域本申请涉及深度学习领域，特别是涉及一种同场景多风格图像匹配方法、装置及应用。背景技术随着时代的发展，在生产、生活中会产生大量垃圾，工业革命使得科学技术产生了飞速的发展，随之而来的垃圾也在成指数增长，由此产生的垃圾处理问题也成为人们必须面临和解决的棘手问题，我国环保城市建设发展训练，在日常生活中垃圾的实时处理对城市以及居民生活十分重要。图像匹配是指在两张或多张图像中，寻找相同或相似的部分。这是计算机视觉领域中一个重要的问题，它涉及到图像特征提取、相似度度量、匹配算法等多个方面的内容，图像匹配的应用非常广泛，例如目标跟踪、图像检索、图像拼接、三维重建等。图像匹配的基本思想是通过比较两张图像的特征，找到它们之间的相似性，然后进行匹配，在图像匹配中，特征点是非常重要的概念，因为它们是区分不同图像的关键。一般来说，图像匹配可以分为两个步骤：特征提取和特征匹配。在特征提取中，通常使用SIFT、SURF、ORB等算法来提取关键点和描述子。在特征匹配中，常用的算法有暴力匹配、FLANN匹配、基于RANSAC的匹配等，图像匹配的性能往往受到许多因素的影响，例如图像分辨率、图像噪声、光照变化等，因此，在实际应用中，需要根据具体的场景选择合适的算法，并对算法进行优化。然而，图像匹配在对现实生活中的垃圾处理方面却并未广泛深入的应用，在进行城市垃圾治理时往往需要巡查人员和垃圾清洁员上传同一地点的图像来进行比对，从而判断该地点的垃圾是否已经清理，而判断垃圾是否已经清理的前提是判断巡查人员和垃圾清理员上传的图像是否为同一场景，由于存在光线和天气不同的原因，判断两张图片是否为同一场景时会很容易判断错误。综上所述，亟需一种可以在不同光线和天气情况下可以准确判断两张图像是否为同一个场景的方法。发明内容本申请实施例提供了一种同场景多风格图像匹配方法、装置及应用，通过风格迁移网络来改变图像的风格，使用改变风格的图像来进行匹配可以更好的将不同风格的图像进行匹配，提高图像匹配的准确性。第一方面，本申请实施例提供了一种同场景多风格图像匹配方法，所述方法包括：构建图像匹配模型，所述图像匹配模型包括风格编码判断网络、结构相同的第一风格迁移网络和第二风格迁移网络以及匹配网络，所述风格编码判断网络包括对应第一输入分支和第二输入分支的两个风格编码器，所述第一风格迁移网络和第二风格迁移网络均包括第一编码分支、第二编码分支以及生成器，所述第一编码分支由线性投影层、语义感知位置编码层以及风格编码器组成，所述第二编码分支由并行的时序特征编码器、深度估计网络以及编码输入端组成；所述编码输入端的输入是经训练后的所述风格编码器输出的对应不同图像风格的风格编码信息，训练好的时序特征编码器将输入特征转换为对应的时间向量，训练好的深度估计网络将输入特征转换为对应的深度图；获取需要进行匹配的第一图像和第二图像，所述第一图像输入所述风格编码判断网络的第一输入分支中经过风格编码器编码后得到第一编码结果，所述第二图像输入所述风格编码判断网络的第二输入分支中经过风格编码器编码后得到第二编码结果，若第一编码结果和第二编码结果相同则通过匹配网络判断第一图像和第二图像的匹配结果；若第一编码结果和第二编码结果不同，将第一图像输入到第一风格迁移网络的第一编码分支中得到第一语义特征，将第二图像及第二编码结果输入到第一风格迁移网络的第二编码分支得到第一特征集合，将所述第二编码分支结果和所述第一语义特征输入到生成器中生成第一合成图，计算所述第一合成图和第二图像的第一相似度；将第二图像输入到第二风格迁移网络的第一编码分支中得到第二语义特征，将第一图像及第一编码结果输入到第二风格迁移网络的第二编码分支得到第二特征集合，将所述第二语义特征和所述第二特征集合输入到生成器中生成第二合成图，计算所述第二合成图和第一图像的第二相似度；若所述第一相似度和所述第二相似度的和大于设定阈值，则判断第一图像和第二图像匹配。第二方面，本申请实施例提供了一种同场景多风格图像匹配装置，包括：构建模块：构建图像匹配模型，所述图像匹配模型包括风格编码判断网络、结构相同的第一风格迁移网络和第二风格迁移网络以及匹配网络，所述风格编码判断网络包括对应第一输入分支和第二输入分支的两个风格编码器，所述第一风格迁移网络和第二风格迁移网络均包括第一编码分支、第二编码分支以及生成器，所述第一编码分支由线性投影层、语义感知位置编码层以及风格编码器组成，所述第二编码分支由并行的时序特征编码器、深度估计网络以及编码输入端组成；所述编码输入端的输入是经训练后的所述风格编码器输出的对应不同图像风格的风格编码信息，训练好的时序特征编码器将输入特征转换为对应的时间向量，训练好的深度估计网络将输入特征转换为对应的深度图；获取模块：获取需要进行匹配的第一图像和第二图像，所述第一图像输入所述风格编码判断网络的第一输入分支中经过风格编码器编码后得到第一编码结果，所述第二图像输入所述风格编码判断网络的第二输入分支中经过风格编码器编码后得到第二编码结果，若第一编码结果和第二编码结果相同则通过匹配网络判断第一图像和第二图像的匹配结果；第一计算模块：若第一编码结果和第二编码结果不同，将第一图像输入到第一风格迁移网络的第一编码分支中得到第一语义特征，将第二图像及第二编码结果输入到第一风格迁移网络的第二编码分支得到第一特征集合，将所述第二编码分支结果和所述第一语义特征输入到生成器中生成第一合成图，计算所述第一合成图和第二图像的第一相似度；第二计算模块：将第二图像输入到第二风格迁移网络的第一编码分支中得到第二语义特征，将第一图像及第一编码结果输入到第二风格迁移网络的第二编码分支得到第二特征集合，将所述第二语义特征和所述第二特征集合输入到生成器中生成第二合成图，计算所述第二合成图和第一图像的第二相似度；匹配模块：若所述第一相似度和所述第二相似度的和大于设定阈值，则判断第一图像和第二图像匹配。第三方面，本申请实施例提供了一种电子装置，包括存储器和处理器，其特征在于，所述存储器中存储有计算机程序，所述处理器被设置为运行所述计算机程序以执行一种同场景多风格图像匹配方法。第四方面，本申请实施例提供了一种可读存储介质，其特征在于，所述可读存储介质中存储有计算机程序，所述计算机程序包括用于控制过程以执行过程的程序代码，所述过程包括一种同场景多风格图像匹配方法。本发明的主要贡献和创新点如下：本申请实施例通过构建风格编码器来判断图像的风格编码信息，对同一风格编码信息的图像进行直接比对，对不同风格编码信息的图像采用转换风格的比对方法进行比对，可以提高图像匹配的准确性；本方案通过在风格编码器的输入中添加语义感知位置编码，来使得所述风格编码器输出对应图像的语义特征，再通过将所述语义特征与其他风格图像时间向量、风格编码信息、图像深度进行结合从而完成图像风格的转换，对需要比对的两张图像进行风格转换后比对，可以进一步减小图像匹配的误差。本申请的一个或多个实施例的细节在以下附图和描述中提出，以使本申请的其他特征、目的和优点更加简明易懂。附图说明此处所说明的附图用来提供对本申请的进一步理解，构成本申请的一部分，本申请的示意性实施例及其说明用于解释本申请，并不构成对本申请的不当限定。在附图中：图1是根据本申请实施例的一种同场景多风格图像匹配方法的流程图；图2是根据本申请实施例的一种风格编码器的结构示意图；图3是根据本申请实施例的一种时序特征编码器的结构示意图；图4是根据本申请实施例的一种深度估计网络的训练示意图；图5是根据本申请实施例的一种生成器的结构示意图；图6是根据本申请实施例的一种实例标准化层的结构示意图；图7是根据本申请实施例的一种匹配网络的结构示意图；图8是根据本申请实施例的一种风格编码器和生成器的训练方式示意图；图9是根据本申请实施例的一种判别器的结构示意图；图10是根据本申请实施例的一种进行同场景多风格图像匹配的方法示意图；图11是根据本申请实施例的一种同场景多风格图像匹配装置的结构框图；图12是根据本申请实施例的电子装置的硬件结构示意图。具体实施方式这里将详细地对示例性实施例进行说明，其示例表示在附图中。下面的描述涉及附图时，除非另有表示，不同附图中的相同数字表示相同或相似的要素。以下示例性实施例中所描述的实施方式并不代表与本说明书一个或多个实施例相一致的所有实施方式。相反，它们仅是与如所附权利要求书中所详述的、本说明书一个或多个实施例的一些方面相一致的装置和方法的例子。需要说明的是：在其他实施例中并不一定按照本说明书示出和描述的顺序来执行相应方法的步骤。在一些其他实施例中，其方法所包括的步骤可以比本说明书所描述的更多或更少。此外，本说明书中所描述的单个步骤，在其他实施例中可能被分解为多个步骤进行描述；而本说明书中所描述的多个步骤，在其他实施例中也可能被合并为单个步骤进行描述。实施例一本申请实施例提供了一种同场景多风格图像匹配方法，具体地，参考图1，所述方法包括：构建图像匹配模型，所述图像匹配模型包括风格编码判断网络、结构相同的第一风格迁移网络和第二风格迁移网络以及匹配网络，所述风格编码判断网络包括对应第一输入分支和第二输入分支的两个风格编码器，所述第一风格迁移网络和第二风格迁移网络均包括第一编码分支、第二编码分支以及生成器，所述第一编码分支由线性投影层、语义感知位置编码层以及风格编码器组成，所述第二编码分支由并行的时序特征编码器、深度估计网络以及编码输入端组成；所述编码输入端的输入是经训练后的所述风格编码器输出的对应不同图像风格的风格编码信息，训练好的时序特征编码器将输入特征转换为对应的时间向量，训练好的深度估计网络将输入特征转换为对应的深度图；获取需要进行匹配的第一图像和第二图像，所述第一图像输入所述风格编码判断网络的第一输入分支中经过风格编码器编码后得到第一编码结果，所述第二图像输入所述风格编码判断网络的第二输入分支中经过风格编码器编码后得到第二编码结果，若第一编码结果和第二编码结果相同则通过匹配网络判断第一图像和第二图像的匹配结果；若第一编码结果和第二编码结果不同，将第一图像输入到第一风格迁移网络的第一编码分支中得到第一语义特征，将第二图像及第二编码结果输入到第一风格迁移网络的第二编码分支得到第一特征集合，将所述第二编码分支结果和所述第一语义特征输入到生成器中生成第一合成图，计算所述第一合成图和第二图像的第一相似度；将第二图像输入到第二风格迁移网络的第一编码分支中得到第二语义特征，将第一图像及第一编码结果输入到第二风格迁移网络的第二编码分支得到第二特征集合，将所述第二语义特征和所述第二特征集合输入到生成器中生成第二合成图，计算所述第二合成图和第一图像的第二相似度；若所述第一相似度和所述第二相似度的和大于设定阈值，则判断第一图像和第二图像匹配。在一些实施例中，所述风格编码器由注意力模块和多层感知器依次串联组成，将所述输入图像分割为多个图像块，使用线性投影对每一所述图像块进行投影得到图像序列特征，所述风格编码器根据所述图像序列特征得到编码结果。示例性的，存在第一图像X和第二图像Y，将X和Y分别划分为Z个图像块，并通过线性投影得到两个L×C大小的图像序列特征分别为XZ和YZ，分别将XZ和YZ输入到所述风格编码器中得到第一图像的第一编码结果X1和第二图像的第二编码结果X2，所述第一编码结果和所述第二编码结果代表对应图像的图像风格。具体的，所述风格编码器的结构如图2所示，所述风格编码器中的注意力模块为多头注意力模块，输入的图像序列特征经过标准化之后输入到所述多头注意力模块中得到多头注意力结果，所述多头注意力结果与所述图像序列特征拼接后得到第一拼接结果，对所述第一拼接结果标准化后输入到所述多层感知器中得到多层感知结果，所述多层感知结果与所述第一拼接结果进行拼接得到所述风格编码信息。在一些实施例中，在“训练好的时序特征编码器将输入特征转换为对应的时间向量”步骤中，所述时序特征编码器为一个全连接层，所述时序特征编码器提取输入图像中的时间信息，将其转变为时间向量。具体的，所述时序特征编码器的结构如图3所示，在所述时序特征编码器中通过预训练好的字符识别网络对输入图像的左上角进行识别，并通过独热编码和时间向量转化公式得到时间向量，具体公式如下：其中，k表示输入图像的维度，为输入图像的时间序列特征，sin为周期激活函数，/＞是t2v图像在时间序列特征上的第i个元素，/＞、/＞为可学习参数，其目的是为了捕获图像中的周期性和非周期性信息。具体的，所述字符识别网络由第一卷积层、第一池化层、第二卷积层、第二池化层、第三卷积层依次串联组成，所述字符识别网络的输入为包含时间信息的图像，输出为图像的时间序列。具体的，所述时序特征编码器的输入为标准的时间规模，输出为时间向量，在本方案中所述时序特征编码器的输入为图像的时间信息。在一些实施例中，在“训练好的深度估计网络将输入特征转换为对应的深度图”步骤中，所述深度估计网络对输入图像进行多次下采样得到第一图像数据、第二图像数、第三图像数据、第四图像数据，分别对第一图像数据、第二图像数据、第三图像数据、第四图像数据进行上采样得到第一上采样图像数据、第二上采样图像数据、第三上采样图像数据、第四上采样图像数据，使用上采样图像数据减去对应大小的图像数据得到第一轮廓信息、第二轮廓信息、第三轮廓信息、第四轮廓信息，将所述第四图像数据输入到所述解码器中得到第五深度图像和第四中间特征，对所述第五深度图像进行上采样得到第五深度上采样图像，将所述第四轮廓信息、第五深度上采样图像以及第四中间特征进行特征拼接得到第四轮廓深度特征，对所述第四轮廓深度特征进行卷积后与第四轮廓信息相加得到第四深度图像，将所述第五深度上采样图像与所述第四深度图像相加得到第四输出结果，以此类推得到第一输出结果，所述第一输出结果为与所述输入图像对应的深度特征图。具体的，在所述深度估计网络中编码器采用预训练好的ResNext101，加码器采用ASPP层，所述编码器用来进行图像分类，所述解码器用来获取上下文信息并恢复深度残差。具体的，所述深度估计网络为拉普拉斯金字塔结构。示例性的，所述深度估计网络的训练示意图如图4所示，使用编码器对深度估计网络的输入图像进行下采样得到4个层级的图像数据记为第一图像数据S1、第二图像数据S2、第三图像数据S3、第四图像数据S4，将每个层级的图像重新进行上采样后与对应尺寸图像数据相减后得到4个轮廓信息记为第一轮廓信息L1、第二轮廓信息L2、第三轮廓信息L3、第四轮廓信息L4，第四图像数据S4经过解码器的ASPP层后输入卷积分支和上采样跳跃连接分支分别得到第五深度图像R5和第四中间特征X4，再将第四轮廓信息L4、第四中间特征X4与第五深度上采样图像相加得到第四轮廓深度特征H4，对所述第四深度轮廓特征进行重新卷积后与第四轮廓信息L4相加得到第四深度图像R4，最后将第四深度图R4与第五深度上采样图像相加得到第四输出结果D4，以此类推得到第一输出结果D1，所述第一输出结果D1为输入图像对应的深度特征图。具体的，所述深度估计网络的损失计算公式如下所示：其中，yi表示第i个像素点预测的深度值，表示第i个像素点真实的深度值，n表示有效像素的总数。在一些具体实施例中，所述时序特征编码器和所述深度估计网络是经过预训练完成的。在一些实施例中，在“将第一图像输入到第一风格迁移网络的第一编码分支中得到第一语义特征”步骤中，所述第一编码分支中的语义感知位置编码层获取所述第一图像的语义感知位置编码，所述第一编码分支中的线性投影层获取第一图像的图像序列特征，将所述第一图像的语义感知位置编码以及所述图像序列特征输入到所述第一编码分支中的风格编码器中得到第一语义特征。在一些实施例中，在“将第二图像及第二编码结果输入到第一风格迁移网络的第二编码分支得到第一特征集合”步骤中，所述第一特征集合包括所述第二编码结果、第二图像的时间向量以及第二图像的深度图。在一些实施例中，在“将所述第二编码分支结果和所述第一语义特征输入到生成器中生成第一合成图”步骤中，所述生成器采用编码器-解码器结构，所述编码器由第一生成器卷积层与多个实例标准化层串联组成，所述解码器由多个自适应实例标准化层与第二生成器卷积层串联组成。具体的，所述生成器的结构如图5所示，所述第一生成器卷积层和所述第二生成器卷积层用来对输入内容进行卷积，所述实例标准化层用来对每个训练样本进行规范化。具体的，所述实例标准化层的结构示意图如图6所示，所述实例标准化层由第一分支和第二分支组成，所述第一分支由第一实例层、第一实例归一层、第一实例卷积层、第一平均池化层、第二实例层、第二实例归一层、第二实例卷积层顺序串联，所述第二分支由第三实例卷积层和第二平均池化层串联组成，输入内容分别经过第一分支与第二分支得到第一分支结果和第二分支结果，所述第一分支结果与所述第二分支结果进行拼接后得到所述实例标准化层的输出结果。在一些具体实施例中，生成第二合成图的方法与生成第一合成图的方法相同，本方案在此不再进行赘述。具体的，所述第一合成图是具有第一图像语义信息且具有第二图像的风格编码信息的合成图像，所述第二合成图是具有第二图像语义信息且具有第一图像的风格编码信息的合成图像。在一些实施例中，在“计算所述第一合成图和第二图像的第一相似度”步骤中，所述匹配网络的结构图如图7所示，所述匹配网络对所述第一合成图像和所述第二图像进行关键点特征之间的匹配，并通过一个全连接层来输出所述第一合成图像和所述第二图像之间的关键点特征的匹配度作为所述第一相似度。同样的，通过匹配网络计算出所述第二相似度，若所述第一相似度和所述第二相似度的和大于设定阈值，则判断第一图像和第二图像匹配。在一些实施例中，如图8所示，本方案对风格编码器以及生成器训练方式如下：获取同一场景不同风格的图像作为训练样本，示例性的，可以依据昼夜和天气情况作为不同风格来获取训练样本，将所述训练样本分为16类，分别为：X1、X2、X3、X4、X5、X6、X7、X8、X9、X10、X11、X12、X13、X14、X15、X16，并对图像进行尺寸大小归一化预处理。具体的，可以选取公开数据及KITTI中的道路环境图像数据，将所述道路环境图像数据随机裁剪为W×H像素，然后进行水平翻转，此外，对每张道路环境图像数据的亮度、颜色和gamma值在范围内随机调整。训练阶段1：获取一指定特定风格的指定图像输入到所述训练好的风格编码器、训练好的时序特征编码器、训练好的输入估计网络中得到指定图像风格、指定图像时序特征、指定图像深度图，获取除指定风格外的任意一种目标风格的图像的语义感知位置编码并结合对应的图像送入所述风格编码器中得到目标语义特征，将所述目标语义特征、指定图像风格、指定图像时序特征以及指定图像深度图送入所述生成器中得到生成图像，构建判别器，使用所述判别器来判断所述生成图像与所述指定图像之间的对抗损失、重构损失以及类内距离损失。具体的，所述判别器的结构如图9所示，所述判别器由第一判别器卷积层、多个串联的判别实例标准化层、第一判别归一层、第二判别卷积层、第二判别归一层、判别维度转换层、判别输出层顺序串联组成。具体的，获取一张白天晴天的图像x1，将x1输入到所述训练好的风格编码器、训练好的时序特征编码器、训练好的输入估计网络中得到指定图像风格S1、指定图像时序特征T1、指定图像深度图D1，获取除白天晴天之外的任意一种风格的图像xi，获取xi的语义感知位置编码并结合xi送入所述风格编码器中得到目标语义特征Ci，将所述目标语义特征Ci、指定图像风格S1、指定图像时序特征T1以及指定图像深度图D1送入所述生成器中得到生成图像x1’，将x1’和x1输入到判别器中得到x1’与x1之间的对抗损失LD1、重构损失Lsty1以及类内距离损失Lintra1，以此类推得到。具体的，所述对抗损失LD1的公式如下所示：所述重构损失的公式如下所示：所述类内距离损失Lintra1的公式如下所示：其中，xi’的表达式为：其中，其中，表示xi取自风格i的目标图像集，/＞表示判别器D预测xi来自真实分布/＞的概率，/＞表示将图像按照语义特征Ca和Sb的风格生成图像，/＞表示风格编码器提取图像/＞中的风格编码信息，/＞表示风格编码器提取图像/＞中的语义特征，/＞表示分布函数的期望值，/＞表示L1范数，argmin表示使目标函数取最小值时的变量值，以此类推得到损失/＞。训练阶段2：将所述指定图像和所述生成图像输入到所述匹配网络中分别得到指定图像关键点特征以及生成图像关键点特征，使用所述生成图像关键点特征减去所述匹配图像关键点特征得到匹配损失函数。具体的，获取指定图像x1和生成图像x1’，将x1和x1’输入到所述匹配网络中分别得到指定图像关键点特征K1以及生成图像关键点特征K1’，使用K1’减去K1得到匹配损失函数Lmatch1。具体的，所述匹配损失函数Lmatch1的计算公式如下所示：其中，/＞表示指定图像/＞中的第n个关键点，同理，/＞，/＞表示目标图像/＞中的第n个关键点，以此类推得到匹配损失Lmatchi，/＞。训练阶段3：获取所述生成图像的语义感知位置编码，将所述生成图像与对应的语义感知位置编码输入到风格编码器中得到生成图像语义特征，将指定图像风格、指定图像时序特征、指定图像深度特征以及生成图像语义特征输入到所述生成器中得到第二生成图像，计算指定图像与所述第二生成图像之间的范数距离得到循环损失函数。具体的，获取生成图像x1’的语义感知位置编码，将所述生成图像x1’以及对应的语义感知位置编码输入到风格编码器中得到生成图像语义特征Ci’，将指定图像风格Si、指定图像时序特征Ti、指定图像深度特征Di以及生成图像语义特征Ci’输入到所述生成器中得到第二生成图像x1’’，计算x1和x1’’的范数距离L1得到循环损失Lcyc1。具体的，所述循环损失Lcyc1的计算公式为：其中，以此类推可得到循环损失。训练阶段4：获取任意一指定图像的指定语义特征以及任意两个不同的第一风格编码信息和第二风格编码信息，将第一风格编码信息、与所述第一风格编码信息对应的时序特征、与所述第一风格编码信息对应的深度图以及指定语义特征输入生成器中得到第一生成图像，将与第二风格编码信息、与所述第二风格编码信息对应的时序特征、与所述第二风格编码信息对应的深度图以及指定语义特征输入生成器中得到第二生成图像，计算所述第一生成图像与所述第二生成图像之间范数距离的相反数得到生成损失。具体的，获取任意一指定图像的指定语义特征Ci以及任意两个不同的第一风格编码信息S1和第二风格编码信息S2，将第一风格编码信息S1、与所述第一风格编码信息对应的时序特征T1、与所述第一风格编码信息对应的深度图D1及指定语义特征Ci输入到生成器中得到第一生成图像，将第二风格编码信息S2、与所述第二风格编码信息对应的时序特征T2、与所述第二风格编码信息对应的深度图D2以及指定语义特征Ci输入到生成器中得到第二生成图像，计算所述第一生成图像与所述第二生成图像之间范数距离L1的相反数得到生成损失Lds13，以此类推得到生成损失。具体的，所述生成损失Lds13的计算公式如下所示：其中，，/＞，表示任一指定图像Ci的语义信息。以此类推可得到生成损失。训练阶段5：所述图像匹配模型的总体损失为对抗损失、重构损失、类内距离损失、匹配损失、循环损失、生成损失的和，先保持判别器参数不变，调整所述生成器和所述风格编码器的参数使总体损失最小，再保持生成器和所述风格编码器的参数不变，调整判别器的参数使得总体损失最大直至稳定，得到训练好的图像匹配模型。具体的，总体损失的公式如下所示：其中，为对应损失的常数系数，遍历来对模型进行迭代训练。具体的，本方案使用训练好的图像匹配模型进行图像匹配时的流程图如图10所示。实施例二基于相同的构思，参考图11，本申请还提出了一种同场景多风格图像匹配装置，包括：构建模块：构建图像匹配模型，所述图像匹配模型包括风格编码判断网络、结构相同的第一风格迁移网络和第二风格迁移网络以及匹配网络，所述风格编码判断网络包括对应第一输入分支和第二输入分支的两个风格编码器，所述第一风格迁移网络和第二风格迁移网络均包括第一编码分支、第二编码分支以及生成器，所述第一编码分支由线性投影层、语义感知位置编码层以及风格编码器组成，所述第二编码分支由并行的时序特征编码器、深度估计网络以及编码输入端组成；所述编码输入端的输入是经训练后的所述风格编码器输出的对应不同图像风格的风格编码信息，训练好的时序特征编码器将输入特征转换为对应的时间向量，训练好的深度估计网络将输入特征转换为对应的深度图；获取模块：获取需要进行匹配的第一图像和第二图像，所述第一图像输入所述风格编码判断网络的第一输入分支中经过风格编码器编码后得到第一编码结果，所述第二图像输入所述风格编码判断网络的第二输入分支中经过风格编码器编码后得到第二编码结果，若第一编码结果和第二编码结果相同则通过匹配网络判断第一图像和第二图像的匹配结果；第一计算模块：若第一编码结果和第二编码结果不同，将第一图像输入到第一风格迁移网络的第一编码分支中得到第一语义特征，将第二图像及第二编码结果输入到第一风格迁移网络的第二编码分支得到第一特征集合，将所述第二编码分支结果和所述第一语义特征输入到生成器中生成第一合成图，计算所述第一合成图和第二图像的第一相似度；第二计算模块：将第二图像输入到第二风格迁移网络的第一编码分支中得到第二语义特征，将第一图像及第一编码结果输入到第二风格迁移网络的第二编码分支得到第二特征集合，将所述第二语义特征和所述第二特征集合输入到生成器中生成第二合成图，计算所述第二合成图和第一图像的第二相似度；匹配模块：若所述第一相似度和所述第二相似度的和大于设定阈值，则判断第一图像和第二图像匹配。实施例三本实施例还提供了一种电子装置，参考图12，包括存储器404和处理器402，该存储器404中存储有计算机程序，该处理器402被设置为运行计算机程序以执行上述任一项方法实施例中的步骤。具体地，上述处理器402可以包括中央处理器，或者特定集成电路，或者可以被配置成实施本申请实施例的一个或多个集成电路。其中，存储器404可以包括用于数据或指令的大容量存储器404。举例来说而非限制，存储器404可包括硬盘驱动器、软盘驱动器、固态驱动器、闪存、光盘、磁光盘、磁带或通用串行总线驱动器或者两个或更多个以上这些的组合。在合适的情况下，存储器404可包括可移除或不可移除的介质。在合适的情况下，存储器404可在数据处理装置的内部或外部。在特定实施例中，存储器404是非易失性存储器。在特定实施例中，存储器404包括只读存储器和随机存取存储器。在合适的情况下，该ROM可以是掩模编程的ROM、可编程ROM、可擦除PROM、电可擦除PROM、电可改写ROM或闪存或者两个或更多个以上这些的组合。在合适的情况下，该RAM可以是静态随机存取存储器或动态随机存取存储器，其中，DRAM可以是快速页模式动态随机存取存储器404、扩展数据输出动态随机存取存储器、同步动态随机存取内存等。存储器404可以用来存储或者缓存需要处理和/或通信使用的各种数据文件，以及处理器402所执行的可能的计算机程序指令。处理器402通过读取并执行存储器404中存储的计算机程序指令，以实现上述实施例中的任意一种同场景多风格图像匹配方法。可选地，上述电子装置还可以包括传输设备406以及输入输出设备408，其中，该传输设备406和上述处理器402连接，该输入输出设备408和上述处理器402连接。传输设备406可以用来经由一个网络接收或者发送数据。上述的网络具体实例可包括电子装置的通信供应商提供的有线或无线网络。在一个实例中，传输设备包括一个网络适配器，其可通过基站与其他网络设备相连从而可与互联网进行通讯。在一个实例中，传输设备406可以为射频模块，其用于通过无线方式与互联网进行通讯。输入输出设备408用于输入或输出信息。在本实施例中，输入的信息可以是待匹配图像、图像编码风格等，输出的信息可以是图像的匹配结果等。可选地，在本实施例中，上述处理器402可以被设置为通过计算机程序执行以下步骤：S101、构建图像匹配模型，所述图像匹配模型包括风格编码判断网络、结构相同的第一风格迁移网络和第二风格迁移网络以及匹配网络，所述风格编码判断网络包括对应第一输入分支和第二输入分支的两个风格编码器，所述第一风格迁移网络和第二风格迁移网络均包括第一编码分支、第二编码分支以及生成器，所述第一编码分支由线性投影层、语义感知位置编码层以及风格编码器组成，所述第二编码分支由并行的时序特征编码器、深度估计网络以及编码输入端组成；所述编码输入端的输入是经训练后的所述风格编码器输出的对应不同图像风格的风格编码信息，训练好的时序特征编码器将输入特征转换为对应的时间向量，训练好的深度估计网络将输入特征转换为对应的深度图；S102、获取需要进行匹配的第一图像和第二图像，所述第一图像输入所述风格编码判断网络的第一输入分支中经过风格编码器编码后得到第一编码结果，所述第二图像输入所述风格编码判断网络的第二输入分支中经过风格编码器编码后得到第二编码结果，若第一编码结果和第二编码结果相同则通过匹配网络判断第一图像和第二图像的匹配结果；S103、若第一编码结果和第二编码结果不同，将第一图像输入到第一风格迁移网络的第一编码分支中得到第一语义特征，将第二图像及第二编码结果输入到第一风格迁移网络的第二编码分支得到第一特征集合，将所述第二编码分支结果和所述第一语义特征输入到生成器中生成第一合成图，计算所述第一合成图和第二图像的第一相似度；S104、将第二图像输入到第二风格迁移网络的第一编码分支中得到第二语义特征，将第一图像及第一编码结果输入到第二风格迁移网络的第二编码分支得到第二特征集合，将所述第二语义特征和所述第二特征集合输入到生成器中生成第二合成图，计算所述第二合成图和第一图像的第二相似度；S105、若所述第一相似度和所述第二相似度的和大于设定阈值，则判断第一图像和第二图像匹配。需要说明的是，本实施例中的具体示例可以参考上述实施例及可选实施方式中所描述的示例，本实施例在此不再赘述。通常，各种实施例可以以硬件或专用电路、软件、逻辑或其任何组合来实现。本发明的一些方面可以以硬件来实现，而其他方面可以以可以由控制器、微处理器或其他计算设备执行的固件或软件来实现，但是本发明不限于此。尽管本发明的各个方面可以被示出和描述为框图、流程图或使用一些其他图形表示，但是应当理解，作为非限制性示例，本文中描述的这些框、装置、系统、技术或方法可以以硬件、软件、固件、专用电路或逻辑、通用硬件或控制器或其他计算设备或其某种组合来实现。本发明的实施例可以由计算机软件来实现，该计算机软件由移动设备的数据处理器诸如在处理器实体中可执行，或者由硬件来实现，或者由软件和硬件的组合来实现。包括软件例程、小程序和/或宏的计算机软件或程序可以存储在任何装置可读数据存储介质中，并且它们包括用于执行特定任务的程序指令。计算机程序产品可以包括当程序运行时被配置为执行实施例的一个或多个计算机可执行组件。一个或多个计算机可执行组件可以是至少一个软件代码或其一部分。另外，在这一点上，应当注意，如图12中的逻辑流程的任何框可以表示程序步骤、或者互连的逻辑电路、框和功能、或者程序步骤和逻辑电路、框和功能的组合。软件可以存储在诸如存储器芯片或在处理器内实现的存储块等物理介质、诸如硬盘或软盘等磁性介质、以及诸如例如DVD及其数据变体、CD等光学介质上。物理介质是非瞬态介质。本领域的技术人员应该明白，以上实施例的各技术特征可以进行任意的组合，为使描述简洁，未对上述实施例中的各个技术特征所有可能的组合都进行描述，然而，只要这些技术特征的组合不存在矛盾，都应当认为是本说明书记载的范围。以上实施例仅表达了本申请的几种实施方式，其描述较为具体和详细，但并不能因此而理解为对本申请范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本申请构思的前提下，还可以做出若干变形和改进，这些都属于本申请的保护范围。因此，本申请的保护范围应以所附权利要求为准。
