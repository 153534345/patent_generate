标题title
一种变网格多尺度混合式资料同化方法
摘要abst
本发明公开一种变网格多尺度混合式资料同化方法，属于资料同化技术领域，采用自适应网格化策略，使用多级连续由粗到细的网格分别调整由大到小不同空间尺度的海气状态场，有效降低了完成遥相关同化的计算需求；并辅之以集合最优插值方法从而使同化模块提供与模式相一致的极细分辨率支持，另外，创新发明四重子域叠加求解法，在保证资料同化可靠的前提下，使网格划分逻辑更为简单；可以支持很高的计算并行度，计算效率高且能够很好的解决子域优化问题，有效实现超高分辨率大区域计算中不同尺度下的资料同化，具有广泛的推广及实用价值。
权利要求书clms
1.一种变网格多尺度混合式资料同化方法，其特征在于，包括以下步骤：步骤A、将模式状态由原始模式网格缩变至尺度网格C，记为/＞，并构建如下代价函数：，式中，表示雅可比行列式，/＞表示尺度，M为尺度l的数目，/＞表示模式状态，/＞，/＞，，/＞和/＞ 分别对应的表示尺度/＞的状态增量，空间滤波算子，背景误差协方差，观测误差和观测更新残差，H表示差值算子；步骤B、定义不同尺度下的观测响应特征距为尺度特征a，根据不同尺度特征a，选择不同的变换网格计算状态增量/＞；其中创建两种变换网格，分别称为尺度网格C和子域网格S，对于统一尺度下的尺度网格C和S，S的分辨率高于C的分辨率；对尺度a进行判断，当尺度特征a所划分格点数能够保同化工作在一个进程上完成时，选择尺度网格C进行资料同化；当尺度特征a所划分格点数不能使同化工作在一个进程上完成时，选择利用子域网格S进行资料同化；步骤C、将状态增量 变换为初始网格上的/＞；三维变分求解：将模式状态从原始网格保真变换到尺度网格，或先变换到尺度网格C再进一步变换到子域网格，当/＞确定后，计算此时对应的观测更新残差/＞，并进行代价函数最小化求解，得到的状态增量/＞在尺度网格C或子域网格S上，将被逆变回原始模式网格得到当前尺度下的模式状态增量/＞，然后开始下一尺度的优化过程；依次在不同的尺度上完成三维变分求解后，最终在模式原始分辨率下进行一次集合最优插值同化，集合最优插值结果为最终尺度的同化结果，最终的模拟状态更新量为：完成当前状态更新，当模式运行到某一时刻需要再次进行资料同化时，重复步骤A-C，完成对该时刻进行模式状态资料同化。2.根据权利要求1所述的变网格多尺度混合式资料同化方法，其特征在于：所述步骤A中所构建的代价函数为资料同化的关键，变网格多尺度混合式资料同化的原理为：由=1到=M 依次对所创建的代价函数进行最小化求解，通过空间滤波算子/＞收集观测更新残差并进行空间滤波，再将结果反馈至状态增量/＞所在的格点；对代价函数的最小化求解是通过空间滤波算子计算后在尺度网格上进行；/＞由元素/＞组成，每个元素代表第j个观测更新差值对第i个状态的权重；，其中，Ω表示局域化函数，/＞为尺度/＞下的观测响应特征距，记为尺度特征a，/＞为第j个观测点与第i个模式格点间的距离，K为总观测数目。3.根据权利要求1所述的变网格多尺度混合式资料同化方法，其特征在于：所述步骤B中，当尺度特征a大于尺度网格C的分辨率时，将所有观测点到状态点距离小于2a的观测资料进行尺度网格C下的状态同化，观测更新残差表示如下：，其中，表示观测资料，/＞表示尺度/＞的差值算子，/＞表示/＞=1的模式状态，将其带入步骤A中的代价函数计算状态增量/＞。4.根据权利要求3所述的变网格多尺度混合式资料同化方法，其特征在于：所述步骤B中，在子域网格S下进行状态同化时，基于四重叠加法进行子域剖分求解，首先对尺度网格C进行四次类似的子域剖分，四次子域剖分各错开半个子域网格S长度，在子域网格S下对此模拟点状态的进行观测更新残差的计算，进而将其带入步骤A中的代价函数计算状态增量/＞。5.根据权利要求1所述的变网格多尺度混合式资料同化方法，其特征在于：所述步骤B中，尺度网格C的维度为，子域网格S的维度为，v表示原始网格状态矢量的长度，，/＞和/＞分别为原始网格覆盖范围在纬向和经向的平均跨越距离，s由超算平台的并行计算能力决定。6.根据权利要求1所述的变网格多尺度混合式资料同化方法，其特征在于：所述步骤C中，通过步骤B中对状态增量是在尺度网格C及子域网格S上求解后，需要对多尺度模式状态c进行优化，优化公式如下：，，，其中，表示尺度/＞的网格C缩变算子，/＞表示网格S缩变算子，/＞原始网格状态，/＞表示缩变至网格C或S时的模式状态，上标/＞，/＞,*P都表示当前尺度，N表示不同尺度，*表示S网格上四重叠加法。
说明书desc
技术领域本发明属于资料同化技术领域，具体涉及一种变网格多尺度混合式资料同化方法，用于超高分辨率大区域计算中不同尺度下的资料同化。背景技术观测信息相较于瞬时万变的自然世界，在时间和空间上是零散的，无法呈现和代表真实的三维连续演变的海洋环境状态。资料同化现在已经发展成为能够有效利用大量多源非常规资料的一种新颖技术手段，是一种能够有机结合数值模式和观测这两种海洋学研究基本手段的方法。海洋资料同化用海洋数值模式不断吸收、消化观测信息，从而使模式状态越来越接近真实状态。通过引入资料同化，不仅能够有效地提高海洋模拟效果，减少海洋和气候预报初始条件的不确定性，还能够为缺少海洋观测的深海和边缘海提供再分析资料，为海洋观测计划和数值预报模式物理量及参数等提供设计依据。因此海洋资料同化在现代物理海洋学的研究中占据了非常重要的地位。近十年来，资料同化技术取得了快速的发展，从早期比较简单的客观分析法发展到现在能够同化大量非常规资料的四维变分和集合卡尔曼滤波等。由于高分辨率和超高分辨率海洋数值模式的兴起，多尺度海洋同化正在成为当前该领域重要研究方向之一。多尺度同化是基于流体运动的多尺度性质研发的，在不同大小的时空尺度模态上分别提取观测信息的同化方法，可以通过多尺度协调修正来提高数值模拟的信息融合精度以及提高模式预报技巧。超高分辨率的出现给资料同化领域也带来新的挑战：一个是对同化的计算效率提升的要求达到了新的高度，另一个是观测条件的不完备导致新的多尺度相互作用之间相互协调性出现问题。为了满足越来越高分辨率模型数据处理的需求，亟待提出一种新的资料同化方法，在保证同化效果的同时，优化超高分辨率大区域计算中海洋资料同化的计算效率，并进一步改善当前经验条件下的多尺度科学划分问题，以及不同尺度下的观测资料集应如何选取问题。发明内容本发明为解决现有超高分辨率模式同化方法计算效率低、以及存在多尺度相互作用协调性差等问题，提出一种变网格多尺度混合式资料同化方法，通过将多尺度混合同化和变网格相结合，实现超高分辨率模式下不同尺度模式的同化需求。本发明是采用以下的技术方案实现的：一种变网格多尺度混合式资料同化方法，包括以下步骤：步骤A、将模式状态由原始模式网格缩变至尺度网格C，记为/＞，并构建如下代价函数：，式中，/＞表示雅可比行列式，/＞表示尺度，M为尺度l的数目，/＞表示模式状态，/＞，/＞，/＞，/＞和/＞ 分别对应的表示尺度/＞的状态增量，空间滤波算子，背景误差协方差，观测误差和观测更新残差，H表示差值算子；变网格多尺度混合式资料同化的原理为：由/＞=1 到/＞=M 依次对所创建的代价函数进行最小化求解，通过空间滤波算子/＞收集观测更新残差/＞并进行空间滤波，再将结果反馈至状态增量/＞所在的格点，对代价函数的最小化求解是通过空间滤波算子/＞计算后在尺度网格上进行；/＞由元素/＞组成，每个元素代表第j个观测更新差值对第i个状态的权重；/＞，其中，Ω表示局域化函数，为尺度/＞下的观测响应特征距，将其定义为尺度特征a，/＞为第j个观测点与第i个模式格点间的距离，K为总观测数目；步骤B、根据不同尺度特征a，选择不同的变换网格计算状态增量，其中创建两种变换网格，分别称为尺度网格C和子域网格S；尺度网格C的维度为，子域网格S的维度为，v表示原始网格状态矢量的长度，/＞，/＞和/＞分别为原始网格覆盖范围在纬向和经向的平均跨越距离，s由超算平台的并行计算能力决定；步骤B1、判断尺度特征a的大小：当尺度特征a足够大，能够保证同化工作可以在一个进程上完成时，选择尺度网格C进行资料同化，例如根据当前的计算能力，C网格的格点数一般为160×160，尺度特征a足够大可被160×160格点表征时，此时可以在一个进程内完成同化，此时选择网格C进行同化；当尺度特征a过小，到了缩变的C网格也无法放到一个进程上完成时，再进一步划分网格，变成子域网格S，此时选择利用子域网格S进行资料同化，执行步骤B3；步骤B2、在尺度网格C下进行状态同化：将所有观测点到状态点距离小于2a的观测资料进行尺度网格C下的状态同化，观测更新残差表示如下：，其中，表示观测资料，/＞表示尺度/＞的差值算子，/＞表示/＞=1的模式状态，将其带入代价函数计算状态增量/＞；步骤B3、在子域网格S下进行状态同化：基于四重叠加法进行子域剖分求解，对尺度网格C进行四次类似的子域剖分，四次子域剖分各错开半个子域网格S长度，在子域网格S下对此模拟点状态的进行观测更新残差的计算，进而将其带入代价函数计算状态增量/＞；步骤C、将状态增量 变换为初始网格上的/＞；将模式状态从原始网格保真变换到尺度网格，或先变换到尺度网格C再进一步变换到子域网格，当/＞确定后，计算观测更新残差/＞；在这里，通过步骤B对状态增量是在尺度网格C及子域网格S上求解后，需要对多尺度模式状态/＞进行优化，优化公式如下：，，，其中， 表示尺度/＞的网格C缩变算子，/＞表示网格S缩变算子，上标t表示不同的进程，/＞原始网格状态，/＞表示缩变至网格C或S时的模式状态，上标/＞、/＞,*P等都表示当前尺度，N表示不同尺度，*表示S网格上四重叠加法。进行观测更新残差求解以及代价函数最小化求解，得到的状态增量/＞在尺度网格或子域网格上，将被逆变回原始模式网格得到当前尺度下的模式状态增量/＞，再开始下一尺度的优化过程；依次在不同的尺度上完成三维变分求解后，最终在模式原始分辨率下进行一次集合最优插值同化，集合最优插值结果为最终尺度的同化结果，最终的模拟状态更新量为：，完成当前状态更新，当模式运行到某一时刻需要再次进行资料同化时，重复步骤A-C，完成对该时刻进行模式状态资料同化。与现有技术相比，本发明的优点和积极效果在于：本方案能够处理多类型观测数据以产生相干的多空间尺度分析增量；采用自适应网格化策略，使用多级连续由粗到细的网格分别调整由大到小不同空间尺度的海气状态场，有效降低了完成遥相关同化的计算需求；并辅之以集合最优插值方法从而使同化模块提供与模式相一致的极细分辨率支持。并创新发明四重子域叠加求解法，在保证资料同化可靠的前提下，使网格划分逻辑更为简单；可以支持很高的计算并行度，计算效率高且能够很好的解决子域优化问题。附图说明图1为本发明实施例所述资料同化方法流程示意图；图2为发明实施例所述子域四重叠加法示意图，a为使用一重子域划分进行优化求解后的状态修正量，b为使用四重子域划分求解后，由中央区域合成的状态修正量，c、d、e、f为同一尺度网格的四重不同子域划分；图3为本发明实施例四重叠加法与环式传统缓冲边界法计算量的对比示意图。具体实施方式为了能够更加清楚地理解本发明的上述目的、特征和优点，下面结合附图及实施例对本发明做进一步说明。在下面的描述中阐述了很多具体细节以便于充分理解本发明，但是，本发明还可以采用不同于在此描述的其他方式来实施，因此，本发明并不限于下面公开的具体实施例。针对海洋模式分辨率越来越高、新型超级计算机众核异构化趋势所带来的对计算并行度的客观需求，提高并行度需要将模式空间划分成小块进行同化处理，但海洋场本身是自相关场，不同空间点间存在大尺度的遥相关性。如果只是对小区域块分别进行数据同化处理，则不在同块中的点之间的协同优化就无法实施，而如果对整个场进行协同优化，又受制于模式分辨率要求速度上无法承受。本实施例提出一种变网格多尺度混合式资料同化方法，该方法将原始模式状态矢量按空间尺度进行划分，分别进行优化后再将优化结果合成，结合图1对其资料同化原理进行详细说明。比如，在某一特定海洋模式运行过程中，被模拟的海洋状态随时间步长不断发生变化，当时间步长来到某一时刻，而此时刻刚好具有观测资料时，便可对该时刻的海洋状态进行资料同化，使得被模拟的海洋状态更加贴近真实情况。在进行资料同化过程中需要考虑不同空间点间存在大尺度的遥相关性，因此在MMH-DA过程中，具体步骤包括：步骤A、将背景的海洋或大气模式状态由原始模式网格缩变至尺度网格C，记为；MMH-DA主体为多尺度三维变分同化，由大空间尺度  =1 到小空间尺度 /＞ =M 依次对创建的代价函数进行最小化求解：式中，是一种数学运算符号，表示雅可比行列式，/＞表示尺度，M为尺度/＞的数目，/＞表示模式状态，/＞，/＞，/＞，/＞和/＞分别对应的为尺度l的状态增量，空间滤波算子，背景误差协方差，观测误差和观测更新残差，H表示差值算子。MMH-DA通过空间滤波算子收集观测更新残差/＞并进行空间滤波，再将结果反馈至状态增量/＞所在的格点。对代价函数的最小化求解是通过/＞计算后在模式网格上进行的。/＞由元素/＞组成，每个元素代表了第j个观测更新差值对第i个状态的权重，由Gaspari和Cohn在1999年设计的局域化函数Ω得到，/＞ 和Ω 的计算公式如下： 其中，为尺度/＞下的观测响应特征距，在本实施例中同时将其定义为尺度特征a，b为观测点与模式格点间的距离，K为总观测数目。步骤B、根据海洋或大气不同尺度特征a，选择不同的尺度网格计算状态增量；本实施例创建了两种变换网格以对原问题进行计算分解，分别称为尺度网格C和子域网格S。结合图2所示，尺度网格C和S在每个尺度都不相同，但对于统一尺度下的尺度网格C和S，总有S的分辨率要高于C的分辨率。尺度网格C的维度为，子域网格S的维度为。v为原始网格状态矢量的长度，，/＞和/＞分别为原始网格覆盖范围在纬向和经向的平均跨越距离，尺度特征a在单向包含4个点，因此尺度网格C在当前尺度下能够分辨波长大于1/2a以上的波。s=322，一般主要由同化系统使用的超算平台的并行计算能力决定，系统加速比越高则底数可以越小，但一般情况下底数在8~64之间。当a很大时， C分辨率远低于原始网格，覆盖全部模拟范围；当a很小时， C分辨率接近原始网格，但分化为322个小的S区域求解，此时状态场的遥相关特征已经在粗C、大a对应尺度的优化中得到解决，所以可以由S的结果拼合成整域上的超高分辨率优化结果。这种变网格技术的使用保证了对模拟状态的直接优化，且使得整个变分求解过程能够保持非常高的并行度，适合当前超算系统超高并行度众核异构的发展趋势，计算非常高效可以满足亚中尺度海洋模拟和相应业务化预测对超高分辨率的现实要求。步骤B1、判断尺度特征a大小；传统三维变分同化对原始模式网格下的模式状态进行优化，模式状态矢量由温、盐、涡度等多变量构成，矢量长度为107以上，相应的背景误差协方差的数量级更是达到了1014，这客观上是传统三维变分方法无法应对的。尺度特征a是MMH-DA方法下最重要的核心参数，不但决定了多尺度方法的尺度，也决定了变网格时每级尺度网格与原模式网格的缩减比。由公式和公式可知，因为每级尺度下的a是不同的，所以大尺度下每个状态点可以收集更大范围的观测更新残差，并按局域化函数Ω对这些观测更新残差进行空间滤波处理。本实施例根据不同尺度特征a，选择不同的尺度网格进行计算，其中创建两种变换网格，分别称为尺度网格C和子域网格S，对于统一尺度下的尺度网格C和S，S的分辨高于C的分辨率；当尺度特征a足够大，使得同化工作可以在一个进程上完成时，执行步骤B2，例如根据当前的计算能力，C网格的格点数一般为160×160，当尺度特征a可被160×160格点表征时，此时可以在一个进程内完成同化，此时选择网格C进行同化；当尺度特征a过小，到了缩变的C网格也无法放到一个进程上完成时，即C网格的格点数在160×160，无法刻画尺度特征a时，再进一步划分网格，变成子域网格S，此时选择利用子域网格S进行资料同化，执行步骤B3，具体的：步骤B2、在尺度网格C下进行状态同化。所有到待更新的状态点距离小于2a的观测资料都被考虑在尺度网格C下对此模拟点状态的进行同化。观测更新残差由下式决定，当对第一个尺度进行求解时，/＞就是观测与背景模拟结果间的差异： 然后利用公式计算状态增量。步骤B3、在子域网格S下进行状态同化；首先将尺度网格C上的模式状态进一步分解到四个子域网格S上进行求解，每个子域网格都由单一程序进行负责。分解了的c决定了每个子域中只包含极小区域的观测更新残差/＞。此时相邻子域边界处的点在同化过程中由滤波算子L所收集的/＞完全不同，这会带来非常严重的优化求解偏差。如图2中的c中所示，各子域S网格点数为32´32，尺度特征距a跨4个格点。图2中的c、d、e、f中以黑实线划分的每个子域可以分为方块型的中央区域和包围中央区域的边缘区域。单纯拿图2中的c来讲，这个图就是一个子域网格，可以理解为，完整的图2中的c是C网格，然后通过细线划分成了24个小网格，然后cdef这四个不同的子域网格每个划分中都错开了半个子域网格的长度，cdef就是一个状态通过不同的划分方式形成了四个子域。中央区域的格点能收集到全部需要的观测更新残差，而边缘区域的格点只能收集到部分需要的/＞；对于属于不同子域的两相邻格点，由于其优化过程中使用了分别属于两个子域的完全不同且不全面的/＞，所以造成了最终优化结果上图a中明显的不连续现象。通常为解决这种问题，可以给各子域外围加上宽度为2a的一圈缓冲边界，但由于同化求解的计算过程不同于普通模式动力学积分使用的有限差分等方法，所以本实施例在MMH-DA中创新性地研发全新的四重叠加法进行子域剖分求解。四重叠加法进行子域剖分求解的具体原理如下：为对尺度网格进行四次类似的子域剖分，四次子域剖分各错开半个子域长度，结果四重子域剖分下的全部中央区恰好可以拼接成完整的尺度网格。这种四重叠加法保持了高的计算并行度，得到的求解结果可以非常好的克服一重子域优化中的问题。而且，在子域较小的情况下，四重叠加法的计算消耗要低于缓冲边界法，如图3所示，当子域单向长度约＜9a时，四重叠加法优于传统缓冲边界法。在子域网格S下对此模拟点状态的进行观测更新残差的计算，计算公式同样使用公式。然后利用公式计算状态增量/＞。本实施例在优化大尺度遥相关问题时，对原始网格“缩变”从而降低网格数，在优化小尺度细节问题时，进行切片同化提升并行度。因此不论优化的是大尺度遥相关问题，还是小尺度局地问题，最终每个计算单元计算的矩阵大小是类似的。这种变网格方式与传统的先进行模态分解，再对模态进行同化的方法有相同的目标，但具体实施原理并不相同，大尺度缩变网格的生成更有自由度。步骤C、状态增量变换为初始网格上的/＞。公式之中的状态增量是在尺度网格C及子域网格S上求解，不直接等同于原始模式网格下的状态增量/＞。本实施例需优化的多尺度模式状态/＞需要将每一轮同化的结果考虑进去后再缩变至尺度网格C或尺度网格S，由下式决定：，， 在每个尺度的最优化过程的开始，当前模式状态将从原始网格保真变换到尺度网格，或先变换到尺度网格再进一步变换到子域网格。经过公式与公式计算后，得到的状态增量/＞在尺度网格或子域网格上，将通过公式被逆变回原始模式网格得到当前尺度下的模式状态增量/＞中等号右边的S项），再开始下一尺度的优化过程。依次在所有尺度上进行完三维变分求解后，最终在模式原始分辨率下，进行一次集合最优插值同化。集合最优插值同化分区进行，每区外围留有180km的环叠区。集合最优插值结果为最终尺度的同化结果。与其它多尺度同化结果合成从而得到最终的模拟状态更新量如下： 进而完成当前状态更新，当模式运行到某一时刻需要再次进行资料同化时重复步骤A-C，完成对该模式状态的资料同化。本实施例中，MMH-DA同时还是一种混合式同化方法，使用三维变分方法进行较大尺度下的数据资料同化，在极小尺度转为集合最优插值方法以利用集合得到的模式背景误差并尽可能保留状态场微观峰值强度。在各尺度的最优化求解过程中将模式原始网格分别变换为尺度网格和子域网格这两种新的网格。在大尺度下的同化中将原始模式网格变为分辨率较粗的尺度网格，进行广域的最优化求解，以得到稀疏观测下考虑了物理场遥相关的模式状态矢量修正值，改善局部观测缺失造成的牛眼问题；而小尺度的同化中将原始模式网格先变为分辨率较细的尺度网格，再将细尺度网格分解为相互叠加的小子域块求解以降低单位区域的同化状态矢量大小，大幅度提高计算效率。通过两种新网格的分解叠加可以极大地提高多尺度资料同化系统的计算并行度，更好地适应海洋模式分辨率不断提高，超算平台高并行度、众核异构的发展趋势。以上所述，仅是本发明的较佳实施例而已，并非是对本发明作其它形式的限制，任何熟悉本专业的技术人员可能利用上述揭示的技术内容加以变更或改型为等同变化的等效实施例应用于其它领域，但是凡是未脱离本发明技术方案内容，依据本发明的技术实质对以上实施例所作的任何简单修改、等同变化与改型，仍属于本发明技术方案的保护范围。
