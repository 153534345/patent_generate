标题title
一种有中心偏移的钻孔内壁环形图像无失真展开方法
摘要abst
本发明公开了一种有中心偏移的钻孔内壁环形图像无失真展开方法，将摄像头放入孔洞中并向内推进；从采集视频中的选取两帧图像图一和图二，将图二中轴心角二调整至与图一中的轴心角一的角度相同；将轴心角一和轴心角二均调整至角度为零；调整后的图一和图二计算运动半径比一，同理得到运动半径比二；根据运动半径比一得到轴心距半径比一，同理得到轴心距半径比二；根据轴心距半径比一和轴心距半径比二矫正得到图三和图四；得到矫正后无畸变图像展开得到无失真展开图像。本发明采用上述内容的一种有中心偏移的钻孔内壁环形图像无失真展开方法，通过运动轨迹来计算每一帧图片的矫正参数，利用边缘而非中心的像素，精度高鲁棒性强。
权利要求书clms
1.一种有中心偏移的钻孔内壁环形图像无失真展开方法，其特征在于：S1、将摄像头放入孔洞中并向内推进，进行视频采集；S2、从S1中得到的采集视频中的选取两帧图像图一和图二，将图二中轴心角二调整至与图一中的轴心角一的角度相同；S3、将S2中的轴心角一和调整后的轴心角二均调整至角度为零；S4、根据S3调整后的图一和图二计算运动半径比一，同理得到运动半径比二；S5、根据S4中的运动半径比一得到轴心距半径比一，同理得到轴心距半径比二；S6、根据S5中的轴心距半径比一和轴心距半径比二计算后对图一和图二进行矫正得到图三和图四；S7、将S6中的图三与图一对应，图四与图二对应得到矫正后无畸变图像；S8、根据极坐标公式将S7中无畸变图像展开得到无失真展开图像。2.根据权利要求1所述的一种有中心偏移的钻孔内壁环形图像无失真展开方法，其特征在于：S2中，若轴心角二与轴心角一角度不同，由图一图二得到相角图一，相角图一中的相角一和相角二得到相角差与轴心角差相等，将图二根据轴心角差进行旋转。3.根据权利要求1所述的一种有中心偏移的钻孔内壁环形图像无失真展开方法，其特征在于：S3中，若轴心角一和轴心角二不为零，由图一和旋转后的图二得到相角图二，相角图二中的所有轨迹线相交时，通过轨迹线最多的一点为控制点，以控制点为圆心得到检测圆一，由检测圆一上像素灰度值最大的两个点得到轴心角三，将图一和旋转后的图二根据轴心角三进行旋转。4.根据权利要求1所述的一种有中心偏移的钻孔内壁环形图像无失真展开方法，其特征在于：S4中，选取旋转后图一中的任意一点并计算该点的运动半径比，由旋转后图一中所有点计算得到的运动半径比得到运动半径比图一，同理得到运动半径比图二。5.根据权利要求1所述的一种有中心偏移的钻孔内壁环形图像无失真展开方法，其特征在于：S5中，在运动半径比图一和运动半径比图二中筛选相同像素灰度值的点分别得到圆环一和圆环二，根据圆环一的圆心和半径得到轴心距半径比一，同理得到轴心距半径比二。6.根据权利要求1所述的一种有中心偏移的钻孔内壁环形图像无失真展开方法，其特征在于：S6中，根据轴心距半径比一和轴心距半径比二得到矫正后的半径一和角度一，由角度一和半径一得到矫正后的图三和图四。7.根据权利要求1所述的一种有中心偏移的钻孔内壁环形图像无失真展开方法，其特征在于：图一和图二中均以图像中心为原点，x轴为过原点向右的直线，轴心角为图像中心与孔洞中心的连线与x轴的夹角，偏移轴为图像中心与孔洞中心的连接，偏移轴的长度为轴心距。8.根据权利要求4所述的一种有中心偏移的钻孔内壁环形图像无失真展开方法，其特征在于：运动半径比一为选取旋转后图一中的一点到控制点的距离与该点的运动轨迹终点到控制点的距离的比值。9.根据权利要求5所述的一种有中心偏移的钻孔内壁环形图像无失真展开方法，其特征在于：轴心距半径比一为圆环一的圆心到图像中心的距离与半径的比值。
说明书desc
技术领域本发明涉及钻孔图像分析技术领域，特别是涉及一种有中心偏移的钻孔内壁环形图像无失真展开方法。背景技术数字岩心是图像处理领域与石油、煤炭等地质领域的交叉学科，数字岩心技术是利用计算机图像处理技术，将岩心微观结构以图像的形式刻画出来，并通过数学建模、定量分析和模拟地层的各种特性，为石油煤炭等勘探开发、地质科学勘探提供基础研究数据。数字岩心技术通常需要先对岩体进行钻孔，然后将广角摄像头深入钻孔中采集视频，而后将采集得到的广角图像展开并拼接为全景图像，这样可以直观的得到岩体内部的情况，为煤矿巷道、隧道等地下空间掘进工作面的支护液压支架的疏密选择提供安全决策依据。由于在实际采集钻孔图像中很难保证采集时摄像头与孔洞中心光轴重合，即镜头的中心并不能保证与钻孔的中心重合，通常存在中心偏移。使得采集到的图像会出现一些非线性畸变，这些畸变会导致后续拼接的图像不够准确，使想要获取真实的岩体内部状况变得困难。如果不进行矫正，得到的地质学信息误差会非常大。矫正的前提以及核心难点是要求解单帧图像摄像头光轴和钻孔中心轴的距离和钻孔半径的比值，以及两个光轴的连线与成像后的图像正方向的夹角。目前存在的求解方法有两种，一种是通过在摄像头上增加额外的传感器，例如激光传感器，它可以发射激光，激光打到钻孔内壁上会形成一个激光环，计算激光环与标准圆的偏差即可获得摄像头光轴与钻孔内壁的距离，来得到待矫正的参数。另一种是直接通过形态学的方法，例如使用霍夫变换或最小二乘法等算法拟合中心圆，其依赖的原理是同深度的圆环的灰度值近似，得到了图像上圆环圆心的位置，即可求解圆心和图像中心的夹角与距离。但是，通常只会根据灰度值来计算中心圆区域的像素，而中间的像素数量较少，同时在复杂场景下，灰度值也难以表征同一深度的圆环。形态学方法计算的畸变矫正参数存在偏移角误差极大的情况，矫正参数的精确度低。发明内容本发明的目的是提供一种有中心偏移的钻孔内壁环形图像无失真展开方法，解决形态学方法中计算畸变矫正参数存在误差的问题。为实现上述目的，本发明提供了一种有中心偏移的钻孔内壁环形图像无失真展开方法，S1、将摄像头放入孔洞中并向内推进，进行视频采集；S2、从S1中得到的采集视频中的选取两帧图像图一和图二，将图二中轴心角二调整至与图一中的轴心角一的角度相同；S3、将S2中的轴心角一和调整后的轴心角二均调整至角度为零；S4、根据S3调整后的图一和图二计算运动半径比一，同理得到运动半径比二；S5、根据S4中的运动半径比一得到轴心距半径比一，同理得到轴心距半径比二；S6、根据S5中的轴心距半径比一和轴心距半径比二计算后对图一和图二进行矫正得到图三和图四；S7、将S6中的图三与图一对应，图四与图二对应得到矫正后无畸变图像；S8、根据极坐标公式将S7中无畸变图像展开得到无失真展开图像。优选的，S2中，若轴心角二与轴心角一角度不同，由图一图二得到相角图一，相角图一中的相角一和相角二得到相角差与轴心角差相等，将图二根据轴心角差进行旋转。优选的，S3中，若轴心角一和轴心角二不为零，由图一和旋转后的图二得到相角图二，相角图二中的所有轨迹线相交时，通过轨迹线最多的一点为控制点，以控制点为圆心得到检测圆一，由检测圆一上像素灰度值最大的两个点得到轴心角三，将图一和旋转后的图二根据轴心角三进行旋转。优选的，S4中，选取旋转后图一中的任意一点并计算该点的运动半径比，由旋转后图一中所有点计算得到的运动半径比得到运动半径比图一，同理得到运动半径比图二。优选的，S5中，在运动半径比图一和运动半径比图二中筛选相同像素灰度值的点分别得到圆环一和圆环二，根据圆环一的圆心和半径得到轴心距半径比一，同理得到轴心距半径比二。优选的，S6中，根据轴心距半径比一和轴心距半径比二得到矫正后的半径一和角度一，由角度一和半径一得到矫正后的图三和图四。优选的，图一和图二中均以图像中心为原点，x轴为过原点向右的直线，轴心角为图像中心与孔洞中心的连线与x轴的夹角，偏移轴为图像中心与孔洞中心的连接，偏移轴的长度为轴心距。优选的，运动半径比一为选取旋转后图一中的一点到控制点的距离与该点的运动轨迹终点到控制点的距离的比值。优选的，轴心距半径比一为圆环一的圆心到图像中心的距离与半径的比值。S1中，摄像头运动过程中的图像会出现以下四种情况，由简单到复杂如下所示：两帧图像之间轴心距相等且不为0，轴心角都等于0；两帧图像之间轴心距不等且不为0，轴心角都等于0；两帧图像之间轴心距不等且不为0，轴心角相等且不为0；两帧图像之间轴心距不等且不为0，轴心角不等且不为0。由到中依次降级解决问题时，采用S2-S8中的步骤进行解决，根据问题情况的不同，使用S2-S8中相对应的矫正步骤矫正。因此，本发明采用上述成分的一种有中心偏移的钻孔内壁环形图像无失真展开方法，其有益效果为：1、利用边缘而非中心的像素，比使用中间像素的精度高，且不会出现偏移角误差极大的情况；2、通过图像中任一点的运动轨迹皆可得到轴心距和轴心角，并且不受到灰度值混乱等复杂因素的影响，极大的提高精度；3、成本低，不依赖于独立的硬件，即时摄像头性能差也可高效利用所有图像信息求取平均值，得到精准结果；4、计算时取多个值进行计算并剔除异常值，增强算法的鲁棒性，提升准确度；5、通过采集的视频的帧与帧之间的相对运动来计算每一帧图片的矫正参数，对失真变形图像进行矫正，展开后得到完整的无失真内壁展开图像；6、本发明同样适用于内孔直径确定的内窥镜成像技术，在不透明酒瓶、汽车发动机内孔、市政管道巡检等领域都能适用。下面通过附图和实施例，对本发明的技术方案做进一步的详细描述。附图说明图1是本发明一种有中心偏移的钻孔内壁环形图像无失真展开方法流程图；图2是本发明一种有中心偏移的钻孔内壁环形图像无失真展开方法中图一的示意图；图3是本发明一种有中心偏移的钻孔内壁环形图像无失真展开方法中图二的示意图；图4是本发明一种有中心偏移的钻孔内壁环形图像无失真展开方法中场1-2的示意图；图5是本发明一种有中心偏移的钻孔内壁环形图像无失真展开方法中相角图一的示意图；图6是本发明一种有中心偏移的钻孔内壁环形图像无失真展开方法模长图的示意图；图7是本发明一种有中心偏移的钻孔内壁环形图像无失真展开方法中旋转后的图二的示意图；图8是本发明一种有中心偏移的钻孔内壁环形图像无失真展开方法中矫正后图三的示意图；图9是本发明一种有中心偏移的钻孔内壁环形图像无失真展开方法S6中计算示意图；图10是本发明一种有中心偏移的钻孔内壁环形图像无失真展开方法S6中计算示意图；图11是本发明一种有中心偏移的钻孔内壁环形图像无失真展开方法S8中计算示意图。具体实施方式以下通过附图和实施例对本发明的技术方案作进一步说明。除非另外定义，本发明使用的技术术语或者科学术语应当为本发明所属领域内具有一般技能的人士所理解的通常意义。本发明中使用的“第一”、“第二”以及类似的词语并不表示任何顺序、数量或者重要性，而只是用来区分不同的组成部分。“包括”或者“包含”等类似的词语意指出现该词前面的元件或者物件涵盖出现在该词后面列举的元件或者物件及其等同，而不排除其他元件或者物件。“连接”或者“相连”等类似的词语并非限定于物理的或者机械的连接，而是可以包括电性的连接，不管是直接的还是间接的。“上”、“下”、“左”、“右”等仅用于表示相对位置关系，当被描述对象的绝对位置改变后，则该相对位置关系也可能相应地改变。实施例1S1、将摄像头放入孔洞中并向内推进。S2、从S1中得到的采集视频中的选取两帧图像图一和图二，图一为前一时刻的帧，图二为后一时刻的帧。利用光流法求得各个点由图二相对图一的运动轨迹图，即为图二相对图一的运动向量场，记为场1-2。光流法为现有技术中的计算方法，此处不详细描述。场1-2拆分为行偏移图和列偏移图，行偏移图中的像素灰度值为场1-2中点的行偏移值，列偏移图中的像素灰度值为场1-2中点的列偏移值。由行偏移值和列偏移值可得到该点的正切值，将正切值带入反正切函数即可得到该点的相角。全部点的相角得到相角图一。将行偏移图和列偏移图转换为距离，得到的模长图一上的点即为该点运动轨迹的距离。将图二中轴心角二调整至与图一中的轴心角一的角度相同，若轴心角二与轴心角一的角度不同，则图二相对图一发生旋转。以图像中心为圆心，任意长度为半径做检测圆，得到检测圆上的点到圆心的相角一。再将该点运动轨迹的终点到圆心的相角二与相角一作差得到相角差，该相角差即为轴心角一和轴心角二之间的轴心角差。多选取不同直径得到不同的检测圆，进而得到对应的轴心角差，取多个轴心角差的平均值，根据轴心角差平均值对图二进行旋转。S3、将S2中的轴心角一和轴心角二均调整至角度为零。根据旋转后的图二与图一重新计算向量运动场，记为场1-21。根据场1-21重新得到相角图二和模长图二，相角图二中的所有轨迹线相交时，通过轨迹线最多的一点为控制点。根据相角图二中任意点的坐标和像素灰度值来确定一条轨迹线，相角图二中的像素灰度值为该点位移的相角，根据直线上一点的坐标和直线的斜率可确定该轨迹线的方程。选取轨迹线相交最多的一点为控制点，进而得到控制点的坐标。以控制点为圆心，在模长图二中生成检测圆一，得到检测圆一上像素灰度值最大的两个点，即位移最长的两个点。这两点关于偏移轴对称，则轴心角三为两点得到相角和的一半。通过设置不同半径的检测圆一，得到若干轴心角三，剔除异常值后取平均值。将图一和旋转后的图二再根据轴心角三旋转，得到旋转后的图一和二次旋转的图二。此时，偏移轴与x轴正向对齐，由左向右为x轴正方向。S4、根据S3调整后的图一和图二计算运动半径比一，同理得到运动半径比二。由旋转后的图一和二次旋转的图二得到旋转后的图一中任一点的运动半径比一，运动半径比一为选取旋转后图一中的一点到控制点的距离与该点的运动轨迹终点到控制点的距离的比值。由图二及其下一帧的图三根据S2和S3调整后得到调整后图二中任意一点的运动半径比二。并且，根据运动半径比一得到运动半径比图一，根据运动半径比二得到运动半径比图二。若控制点与图像中心重合，则旋转后的图一与二次旋转的图二中轴心距相等，此时，只得到运动半径比图一即可。S5、根据S4中的运动半径比一和运动半径比二分别得到轴心距半径比一和轴心距半径比二。由于同一运动轨迹上的点在物理空间上为同一深度圆环上的点，且运动半径比为定值并与物理深度有关。因此，可精准得到物理空间中轴心距半径比。由运动半径比图一中筛选相同像素灰度值的点，得到相同深度的圆环一，可由圆环一的半径和相同像素灰度值的点得到圆心坐标，轴心距半径比一为圆环一的圆心到图像中心的距离与半径的比值。可多得出几组圆环一的半径和圆心位置，并得到若干轴心距半径比一，对不同圆环一的轴心距半径比一取平均值。同理，由运动半径比图二得到轴心距半径比二的平均值。S6、根据S5中的轴心距半径比一和轴心距半径比二计算后对图一和图二进行矫正得到图三和图四。矫正的半径：由于物理空间中轴心距的存在，由轴心距半径比可得到每一组点矫正后到圆心的距离，且轴心距半径比与物理空间中的轴心距半径比相等。矫正后的圆心与图像中心重合后，可得到该点到图像中心的半径值。如图9所示，左边为物理空间平面中的圆环，右边为图像平面中的圆环。物理空间中的某点Ar，若不存在镜头偏移时，其在图像中的点应为Ap1；若存在镜头偏移时其在图像中的点应为Ap2。其中：Or1-Op1为镜头在孔洞中心的轴；Or2-Op2为偏移轴；矫正后的半径Ap1Op1记为r1；矫正前的半径Ap2Op2记为r2。ArOr2可以通过余弦公式转为ArOr1和Or1Or2的函数，其是和轴心距半径比相关的，因此，可利用轴心距半径比即可得到矫正前后的半径比。矫正后的角度：由于物理空间中轴心距的存在，由轴心距半径比即可得到矫正前的角度和矫正后的角度的函数关系。物理空间中的点到孔洞中心的相角和图一中对应的点到图像中心的相角之间存在相角差，可由余弦公式求得相角差。相角差所在的三角形中，轴心距为该三角形中的一条边，另外两条边为孔洞的半径，将矫正后的半径带入得到轴心距半径比与角度的关系。如图10所示，其为某一层圆环的图像，以孔洞中心O1到图像中心O2为x轴正方向建立坐标系。对∠α使用余弦公式可知：对∠β使用余弦公式可知：其中：A点为图像圆环上的某一点；角A-O2-X轴正向我们记为∠α；角A-O1-X轴正向我们记为∠β；O1O2为轴心距；AO1为孔洞半径。由于AO2未知，由轴心距半径比可知O1O2和AO1。将∠β的余弦公式带入∠α的余弦公式得到∠β与∠α的函数关系。S7、将S6中的图三与图一对应，图四与图二对应得到矫正后无畸变图像。已知矫正后的半径和角度，根据极坐标公式，通过极坐标展开可以建立矩形图像上点的映射，矩形图像上对应点的坐标为，矩形的宽为2*Π*Rmax，矩形的高为Rmax-Rmin。其中：为圆心坐标；Rmax是圆环的最大半径；Rmin是圆环的最小半径。上述S8中的展开公式并不唯一，仅为其中一种展开方式，通过公式将圆环坐标和矩形坐标一一对应。无畸变图像展开后，将圆环的全景图像展开为方便拼接和观察的矩形图像，最后得到的就是无失真的展开图像。最后应说明的是：以上实施例仅用以说明本发明的技术方案而非对其进行限制，尽管参照较佳实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对本发明的技术方案进行修改或者等同替换，而这些修改或者等同替换亦不能使修改后的技术方案脱离本发明技术方案的精神和范围。
