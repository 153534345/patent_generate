标题title
一种融合高低频特征信息的低光图像增强方法及装置
摘要abst
本发明公开了一种融合高低频特征信息的低光图像增强方法及装置，属于计算机视觉领域和图像处理领域。本发明方法包括：S1、采集RGB格式的正常光‑低光图像对；S2、对采集到的低光图像分解为光照分量Ilow和反射分量Rlow；S3、对得到的光照分量和反射分量分解为三级拉普拉斯金字塔；S4、分别对光照分量和反射分量的三级拉普拉斯金字塔图像依次输入到三个分支网络中得到增强后的光照分量和反射分量；S5、对和进行逐通道逐像素相乘操作得到低光增强后的正常光图像；其推理步骤包括上述步骤S2‑S5。本发明利用双通道注意力下的拉普拉斯多尺度特征提取块LRMSDA，实现能有效抑制噪声和增强纹理细节的高质量低光图像增强。
权利要求书clms
1.一种融合高低频特征信息的低光图像增强方法，其特征在于，包括如下步骤：S1：采集RGB格式的正常光-低光图像对，图像信息分别记为、/＞；S2：对采集到的低光图像分解为光照分量Ilow和反射分量Rlow；S3：对分解得到的光照分量I和反射分量R进一步分解为三级拉普拉斯金字塔，分别记为、/＞；S4：分别将光照分量I和反射分量R的三级拉普拉斯金字塔、/＞输入到带有LRMSDA模块的三个U-Net分支网络N1、N2、N3中，得到增强后的光照分量/＞和反射分量/＞；其中三个U-Net分支网络N1、N2、N3包括编码器、LRMSDA模块、解码器；LRMSDA模块包括拉普拉斯多尺度特征提取单元、双注意力单元；所述双注意力单元包括通道注意力分支和空间注意力分支；S5：对增强后的光照分量和反射分量/＞进行逐通道逐像素相乘操作得到低光增强后的正常光图像。2.根据权利要求1所述的低光图像增强方法，其特征在于，所述S2是使用经典Retinex-Net分解；经典Retinex-Net分解网络是一个以Sigmoid层结束的两分支全卷积神经网络，这两个分支分别用于估计正常光照图与低光图像的光照分量I和反射分量R。3.根据权利要求1所述的低光图像增强方法，其特征在于，所述S3中对分解得到的光照分量Ilow和反射分量Rlow进一步分解为三级拉普拉斯金字塔的公式为：、/＞；其中Ik、Rk分别表示原始输入的光照分量I或反射分量R下采样调整到/＞比例的版本；/＞表示对图像进行两倍上采样。4.根据权利要求1所述的低光图像增强方法，其特征在于，所述拉普拉斯多尺度特征提取单元首先将潜在特征进一步分解为3个拉普拉斯残差序列，对于每一个序列使用不同数量的卷积层来提取多尺度上下文信息。5.根据权利要求1所述的低光图像增强方法，其特征在于，所述通道注意力分支首先将特征图通过全局平均池化对全局上下文进行编码从而得到特征描述子；特征描述子/＞进一步通过两个卷积层、Sigmoid算子产生激活算子；最后使用激活算子/＞重新标定输入特征图/＞得到通道注意力分支的输出/＞。6.根据权利要求1所述的低光图像增强方法，其特征在于，所述空间注意力分支首先将特征图沿信道维度独立地应用全局平均池化和最大池化操作并将输出串联形成特征图/＞，对特征图/＞进行卷积和Sigmoid激活得到空间注意力映射/＞，随后使用空间注意力映射/＞重新标定输入特征图得到空间注意力分支的输出/＞；最后将通道注意力分支的输出/＞与空间注意力分支的输出/＞进行通道拼接后经过卷积层再与原始输入特征图/＞进行相加操作作为双注意力单元的最终输出。7.根据权利要求1所述的低光图像增强方法，其特征在于，所述S4中带有LRMSDA模块的U-Net网络损失函数设计如下：；其中，表示重建损失，/＞、/＞分别表示通过步骤S4和相应的正常光图像/＞分解为光照分量Inormal和反射分量Rnormal后获得的第k个拉普拉斯金字塔中的增强组合结果输出，在每个金字塔级别计算的损失由Tk归一化，Tk表示/＞中的像素总数，表示l2损失；/＞表示拉普拉斯损失，目的是保持增强结果的局部清晰度，/＞、/＞分别表示通过步骤S4恢复的拉普拉斯残差图像和正常光图像/＞分解为光照分量Inormal和反射分量Rnormal后在第k拉普拉斯金字塔层中的残差图像；表示颜色损失，目的是为了保证由预测增强结果的R、G、B通道组成的颜色向量与相应正常光图像的方向一致，其中Hk和Wk分别是第k个拉普拉斯金字塔增强结果的高度与宽度，i表示/＞的像素位置，/＞表示向量内积；wd、wl、wc表示每个损失项目的权重值。8.根据权利要求1所述的低光图像增强方法，其特征在于，所述S4中对增强后的三级残差图像进行跨金字塔层逐步组合得到增强后的图像金字塔，记为/＞；过程表示如下：/＞，其中/＞为最终增强图像。9.一种融合高低频特征信息的低光图像增强装置，其特征在于，包括如下模块：图像采集模块，用于采集正常光-低光图像对；基于Retinex的图像分解模块，用于将所述图像采集模块采集到的低光图像分解为光照分量和反射分量；基于拉普拉斯残差的图像分解模块，用于将光照分量和反射分量分解为三级拉普拉斯金字塔；低光增强网络模块，用于将所述光照分量和反射分量的三级拉普拉斯金字塔图像输入并跨金字塔层逐步组合得到增强后的光照分量和反射分量/＞；重构模块，用于将所述增强后的光照分量和反射分量/＞进行逐通道逐像素相乘操作得到低光增强后的正常光图像。10.根据权利要求9所述的低光图像增强装置，其特征在于，所述低光图像增强装置，能够实施权利要求1-8任一所述的低光图像增强方法。
说明书desc
技术领域本发明涉及一种融合高低频特征信息的低光图像增强方法及装置，属于计算机视觉领域和图像处理领域。背景技术低光图像是由成像设备在昏暗的光照条件下拍摄得到的，照明不足导致图像存在可见度差、对比度低、意外噪声等问题，进一步损害许多为正常光图像设计的计算机视觉系统的性能。因此，作为低级视觉任务，将低光图像转换为正常曝光的高质量图像尤其重要。传统方法在处理暗光图像时主要分为两类，第一类建立在直方图均衡技术的基础上，第二类基于Retinex理论，将图像建模分解为两个组成部分，即照明分量和反射分量。虽然传统方法在某些情况下可能得到不错的结果，但是仍然受到反射和照明分解模型限制，即很难设计出能够应用于各种场景的图像分解的约束模型。近年来，由于基于深度神经网络的生成模型的丰富可能性，微光图像增强问题被重新表述为图像到图像的转换问题，即增强结果可以在不需要任何物理假设的情况下恢复。尽管基于DNN的各种模型极大地提高了恢复结果的视觉质量，但它们在高频纹理特征的处理上依旧存在不足。发明内容针对上述现有技术缺陷，本发明提出一种融合高低频特征信息的低光图像增强方法及装置，本发明使用多尺度深度堆叠拉普拉斯分离低频照度特征和高频纹理特征，在UNet上使用基于双通道注意力下的拉普拉斯多尺度特征提取块LRMSDA，更进一步增强网络对低频照度特征和高频纹理信息的感知与融合，在低光图像增强中能有效抑制噪声和增强纹理细节。本发明采用的技术方案如下：一种融合高低频特征信息的低光图像增强方法，其特征在于，包括如下步骤：S1：采集RGB格式的正常光-低光图像对，图像信息分别记为、/＞；S2：对采集到的低光图像分解为光照分量Ilow和反射分量Rlow；S3：对分解得到的光照分量I和反射分量R进一步分解为三级拉普拉斯金字塔，分别记为、/＞；S4：分别将光照分量I和反射分量R的三级拉普拉斯金字塔、输入到带有LRMSDA模块的三个U-Net分支网络N1、N2、N3中，得到增强后的光照分量/＞和反射分量/＞；/＞S5：对增强后的光照分量和反射分量/＞进行逐通道逐像素相乘操作得到低光增强后的正常光图像。在一种实施方式中，所述S2是使用经典Retinex-Net分解。经典Retinex-Net分解网络是一个以Sigmoid层结束的两分支全卷积神经网络，这两个分支分别用于估计正常光照图与低光图像的光照分量I和反射分量R。在一种实施方式中，所述S3中对分解得到的光照分量Ilow和反射分量Rlow进一步分解为三级拉普拉斯金字塔的公式为：、/＞；其中Ik、Rk分别表示原始输入的光照分量I或反射分量R下采样调整到/＞比例的版本；/＞表示对图像进行两倍上采样。在一种实施方式中，所述S4中的三个U-Net分支网络N1、N2、N3包括编码器、LRMSDA模块、解码器。所述编码器、解码器为经典U-Net结构。在一种实施方式中，所述LRMSDA模块包括拉普拉斯多尺度特征提取单元、双注意力单元。在一种实施方式中，所述拉普拉斯多尺度特征提取单元首先将潜在特征进一步分解为3个拉普拉斯残差序列，对于每一个序列使用不同数量的卷积层来提取多尺度上下文信息。在一种实施方式中，所述双注意力单元包括通道注意力分支和空间注意力分支。所述通道注意力分支首先将特征图通过全局平均池化对全局上下文进行编码从而得到特征描述子/＞；特征描述子/＞进一步通过两个卷积层、Sigmoid算子产生激活算子/＞；最后使用激活算子/＞重新标定输入特征图/＞得到通道注意力分支的输出/＞；所述空间注意力分支首先将特征图沿信道维度独立地应用全局平均池化和最大池化操作并将输出串联形成特征图/＞，对特征图/＞进行卷积和Sigmoid激活得到空间注意力映射，随后使用空间注意力映射/＞重新标定输入特征图/＞得到空间注意力分支的输出/＞；最后将通道注意力分支的输出/＞与空间注意力分支的输出/＞进行通道拼接后经过卷积层再与原始输入特征图/＞进行相加操作作为双注意力单元的最终输出。在一种实施方式中，S4中带有LRMSDA模块的U-Net网络损失函数设计如下：其中，表示重建损失，/＞、/＞分别表示通过步骤S4和相应的正常光图像/＞分解为光照分量Inormal和反射分量Rnormal后获得的第k个拉普拉斯金字塔中的增强组合结果输出，在每个金字塔级别计算的损失由Tk归一化，Tk表示/＞中的像素总数，/＞表示l2损失；/＞表示拉普拉斯损失，目的是保持增强结果的局部清晰度，/＞、/＞分别表示通过步骤S4恢复的拉普拉斯残差图像和正常光图像/＞分解为光照分量Inormal和反射分量Rnormal后在第k拉普拉斯金字塔层中的残差图像；表示颜色损失，目的是为了保证由预测增强结果的R、G、B通道组成的颜色向量与相应正常光图像的方向一致，其中Hk和Wk分别是第k个拉普拉斯金字塔增强结果的高度与宽度，i表示/＞的像素位置，/＞表示向量内积；wd、wl、wc表示每个损失项目的权重值。在一种实施方式中，所述S4中对增强后的三级残差图像进行跨金字塔层逐步组合得到增强后的图像金字塔，记为/＞；过程表示如下：，其中/＞为最终增强图像。在一种实施方式中，推理步骤包括上述步骤S2-S5。本发明还提供一种融合高低频特征信息的低光图像增强装置，包括如下模块：图像采集模块，用于采集正常光-低光图像对；基于Retinex的图像分解模块，用于将所述图像采集模块采集到的低光图像分解为光照分量和反射分量；基于拉普拉斯残差的图像分解模块，用于将光照分量和反射分量分解为三级拉普拉斯金字塔；低光增强网络模块，用于将所述光照分量和反射分量的三级拉普拉斯金字塔图像输入并跨金字塔层逐步组合得到增强后的光照分量和反射分量/＞；重构模块，用于将所述增强后的光照分量和反射分量/＞进行逐通道逐像素相乘操作得到低光增强后的正常光图像。所述融合高低频特征信息的低光图像增强装置，能够实施上述融合高低频特征信息的低光图像增强方法。本发明具有以下有益效果：本发明充分考虑低光图像的性质，将传统方法Retinex理论与深度神经网络进行结合恢复出正常曝光的高质量图像。在图像空间和特征空间中利用拉普拉斯金字塔来分别调整低频全局光照与恢复高频局部细节。将拉普拉斯金字塔应用于特征空间使得基于多尺度结构中高阶残差间丰富联系的优化变得更加容易，从而在网络训练阶段得以相对较小的损失稳定收敛。针对低光图像增强的任务，在传统的U-Net结构上提出了改进，其在编码器和解码器阶段均增加了额外的基于双通道注意力下的拉普拉斯多尺度特征提取块LRMSDA，丰富了不同分辨率图像中的上下文信息。附图说明图1是本发明一种融合高低频特征信息的低光图像增强装置的结构示意图；图2是本发明一种融合高低频特征信息的低光图像增强方法的流程示意图；图3是本发明一种融合高低频特征信息的低光图像增强网络的总体结构示意图；图4是本发明带有LRMSDA模块的U-Net网络结构示意图；图5是本发明LRMSDA模块结构示意图。具体实施方式以下结合附图对本发明方案进行详细说明。如图1所示，本实施例提供一种融合高低频特征信息的低光图像增强装置，包括以下模块：图像采集模块，用于采集同个场景下的正常光-低光图像对，得到的图像格式为PNG，排列方式为RGB；基于Retinex的图像分解模块，用于将采集到的低光图像分解为光照分量和反射分量；基于拉普拉斯残差的图像分解模块，用于将光照分量和反射分量分解为三级拉普拉斯金字塔、/＞。低光增强网络模块，用于将三级拉普拉斯金字塔图像、/＞分别进行低光增强恢复并逐步组合得到增强后的光照分量/＞和反射分量/＞；重构模块，用于将增强后的光照分量和反射分量/＞进行逐通道逐像素相乘操作得到低光增强后的正常光图像。如图2所示，本实施例提供一种融合高低频特征信息的低光图像增强方法，包括如下步骤：S1：采集RGB格式的正常光-低光图像对，该正常光图像具有高细节度、高对比度、高清晰度等特点，图像信息分别记为、/＞。S2：对采集到的低光图像使用经典Retinex-Net分解为光照分量Ilow和反射分量Rlow；其中Retinex-Net网络是一个以Sigmoid层结束的两分支全卷积神经网络，这两个分支分别用于估计正常光照图与低光图像的光照分量I和反射分量R，分别记为与。其均由4个Conv-ReLU与1个Conv-Sigmoid堆叠组成，输入尺寸为的正常光照图与低光图像，输出尺寸为/＞的光照分量与尺寸为的反射分量。所述Retinex-Net网络的损失函数为：其中为重建损失，N表示像素个数，表示正常光照图像在像素i点的反射分量和光照分量，/＞表示低光图像在像素i点的反射分量和光照分量，该损失函数表征分解后重建图像与真实图像之间逐像素的平方误差；/＞为反射率损失，该损失函数根据Retinex理论约束反射率一致性；/＞为反射率的初始化先验条件，其中/＞表示取正常光照图/＞的RGB三个颜色通道之间的最大值；/＞为颜色损失，用来确保预测的反射分量R的RGB通道组成的颜色向量与相应的真实图具有相同的方向，其中k=1，2，3表示RGB三通道，/＞分别表示损失函数的权重值。S3：对分解得到的光照分量I和反射分量R进一步分解为三级拉普拉斯金字塔，分别记为、/＞。对分解得到的光照分量Ilow和反射分量Rlow进一步分解为三级拉普拉斯金字塔的公式为：/＞、/＞。其中Ik、Rk分别表示原始输入光照分量Ilow和反射分量Rlow通过torch.nn.functional.interpolate API使用双线性采样模式将图像下采样调整到/＞比例的版本。/＞表示通过torch.nn.functional.interpolate API使用双线性采样模式对图像分量进行两倍上采样。S4：分别将光照分量I和反射分量R的三级拉普拉斯金字塔、依次输入到三个U-Net分支网络N1、N2、N3中得到增强后的光照分量/＞和反射分量/＞。对于分支网络N1，首先将/＞与/＞输入进带有LRMSDA模块的U-Net网络中得到增强后的/＞与/＞，随后对/＞与/＞进行双线性上采样操作得到/＞与/＞，进而对与/＞进行拉普拉斯操作得到/＞与/＞并与/＞、/＞进行通道拼接以此将较粗层次的信息传递到下一个分支，用于更精细的特征重构，最后对/＞与再次进行双线性上采样与拉普拉斯操作得到/＞与/＞。对于分支网络N2，输入/＞与/＞、/＞与/＞通道拼接后的特征图得到增强后的/＞与/＞，随后对/＞与/＞进行双线性上采样操作得到/＞与/＞。对于分支N3，输入/＞、、/＞以及/＞、/＞、/＞通道拼接后的特征图得到增强后的/＞与/＞。对增强后的/＞、/＞、/＞、/＞、/＞、/＞进行金字塔逐步组合得到增强后的光照分量/＞和反射分量/＞。具体地，所述LRMSDA模块包括拉普拉斯多尺度特征提取单元、双注意力单元。所述拉普拉斯多尺度特征提取单元首先将潜在特征进一步分解为3个拉普拉斯残差序列，对于每一个序列使用不同数量的卷积层来提取多尺度上下文信息。在一种实施方式中，所述双注意力单元包括通道注意力分支和空间注意力分支。所述通道注意力分支首先将特征图通过全局平均池化对全局上下文进行编码从而得到特征描述子/＞；特征描述子/＞进一步通过两个卷积层、Sigmoid算子产生激活算子/＞；最后使用激活算子/＞重新标定输入特征图/＞得到通道注意力分支的输出/＞；所述空间注意力分支首先将特征图沿信道维度独立地应用全局平均池化和最大池化操作并将输出串联形成特征图/＞，对特征图/＞进行卷积和Sigmoid激活得到空间注意力映射，随后使用空间注意力映射/＞重新标定输入特征图/＞得到空间注意力分支的输出/＞；最后将通道注意力分支的输出/＞与空间注意力分支的输出/＞进行通道拼接后经过卷积层再与原始输入特征图/＞进行相加操作作为双注意力单元的最终输出。S4中带有LRMSDA模块的U-Net网络损失函数设计如下：其中，表示重建损失，/＞、/＞分别表示通过步骤S4和相应的正常光图像/＞分解为光照分量Inormal和反射分量Rnormal后获得的第k个拉普拉斯金字塔中的增强组合结果输出，在每个金字塔级别计算的损失由Tk归一化，Tk表示/＞中的像素总数，/＞表示l2损失；/＞表示拉普拉斯损失，目的是保持增强结果的局部清晰度，/＞、/＞分别表示通过步骤S4恢复的拉普拉斯残差图像和正常光图像/＞分解为光照分量Inormal和反射分量Rnormal后在第k拉普拉斯金字塔层中的残差图像；表示颜色损失，目的是为了保证由预测增强结果的R、G、B通道组成的颜色向量与相应正常光图像的方向一致，其中Hk和Wk分别是第k个拉普拉斯金字塔增强结果的高度与宽度，i表示/＞的像素位置，/＞表示向量内积；wd、wl、wc表示每个损失项目的权重值。所述S4中对增强后的三级残差图像进行跨金字塔层逐步组合得到增强后的图像金字塔，记为/＞；过程表示如下：/＞，其中为最终增强图像。S5：对增强后的光照分量和反射分量/＞进行逐通道逐像素相乘操作得到低光增强后的正常光图像。如图4所示，本实施例提供带有LRMSDA模块的U-Net网络结构，其由编码器、LRMSDA模块、解码器组成。具体包括编码器的4个下采样层、解码器的4个上采样层、7个LRMSDA模块。经典的U-Net模型首先采用4个下采样层的编码器将尺寸为的反射分量或光照分量编码为尺寸为/＞的特征图；然后采用4个上采样层的解码器将尺寸为/＞的特征图解码为尺寸为/＞的增强后的反射分量或光照分量。而带有LRMSDA模块的U-Net网络结构在每次下采样与下采样之前将特征图输入进LRMSDA模块，LRMSDA模块输入与输出的特征图尺寸一致。如图5所示，本实施例提供LRMSDA模块，包括拉普拉斯多尺度特征提取单元、双注意力单元。其中拉普拉斯多尺度特征提取单元将输入特征图分解为三级拉普拉斯金字塔，分解公式与步骤S3一致。分别对三级拉普拉斯金字塔特征图从大尺度到小尺度依次进行1个、2个、3个卷积核为3*3的卷积操作，得到三个输出的特征图并进行两倍上采样以及相加操作重构为一个特征图。此特征图依次经过两个卷积层、PReLU激活函数后分别输入到通道注意力分支与空间注意力分支。其中通道注意力分支首先对输入特征图进行并行的全局平均池化与全局最大池化操作后将二者的输出进行通道拼接后依次经过卷积层、Sigmoid激活函数最后与原始输入通道注意力分支的特征图进行相乘操作得到通道注意力分支的输出Out1。其中空间注意力分支首先对输入特征图进行全局平均池化操作并以此经过卷积层、PReLU激活函数、卷积层、Sigmoid激活函数得到的输出与原始输入空间注意力分支的特征图进行相乘操作得到空间注意力分支的输出Out2。最后将Out1与Our2进行通道拼接后经过卷积层并与拉普拉斯分解前的特征图进行相加操作得到最终LRMSDA模块的输出。定量实验检测：本发明中，对低光图像增强常用的经典模型在LOL数据集上进行了并行实验来验证本发明的图像处理效果。采用图像增强领域常用的峰值信噪比和结构相似性来作为评价指标。PSNR用于比较所需信号强度与背景噪声的强度，其值越大图像噪音越小，图像质量越高；SSIM反应的是两幅图像间的相似度，SSIM值越高，说明两幅图像越相似。其中参与对比的包括经典的LIME、Retinex-Net、EnlightenGAN、MBLLEN模型，结果如表1所示。表1综上所述，本实施例提供的方法，将传统Retinex理论与深度神经网络进行结合，使用多尺度深度堆叠拉普拉斯分离低频照度特征和高频纹理特征，在UNet上使用基于双通道注意力下的拉普拉斯多尺度特征提取块LRMSDA更进一步增强网络对低频照度特征和高频纹理信息的感知与融合，实现能有效抑制噪声和增强纹理细节的高质量低光图像增强。以上所述，仅为本发明的具体实施方式，并非对本发明做任何形式上的限制。应当指出，所用的正常光图像采集设备不对本发明构成限制，图像分辨率不对本发明构成限制，图像内容不对本发明构成限制。本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，可轻易想到变化或替换，都应涵盖在本发明公开的保护范围之内。
