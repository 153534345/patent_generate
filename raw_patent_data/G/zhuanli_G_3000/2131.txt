标题title
一种基于分层深度神经网络的微量元素含量预测方法
摘要abst
本发明公开了一种基于分层深度神经网络的微量元素含量预测方法，该方法包括获取土壤样品集，构造元素集；构造基于分层深度神经网络的微量元素含量预测模型；对基于分层深度神经网络的微量元素含量预测模型进行训练；微量元素含量的预测分析。本发明运算过程简单，科学合理，流程简单，便于操作，成本较低，预测准确率高，结果直观，可以解决X荧光能谱峰值重叠干扰、以及传统仪预测方法不准确等问题，减少了环境本底的影响，降低了由统计涨落造成的误差，能有效快速地对待测物所含微量元素进行定量预测。
权利要求书clms
1.一种基于分层深度神经网络的微量元素含量预测方法，其特征在于，该方法包括如下步骤：S1)获取土壤样品集，并基于所述土壤样品确定元素集，利用ED-XRF荧光光谱仪识别所述土壤样品集中待测样品中与所述元素集中对应的元素峰值信息和含量信息，得到各元素的实测组分值和含量值；S2)构造基于分层深度神经网络的微量元素含量预测模型，确定模型的输入与输出；S3)对基于分层深度神经网络的微量元素含量预测模型进行训练，得到训练好的基于分层深度神经网络的微量元素含量预测模型；S4)对测试样本中微量元素含量进行预测分析，将微量元素的组分和含量数据输入到训练好的基于分层深度神经网络的微量元素含量预测模型中，完成对测试样本中微量元素含量的分析预测。2.根据权利要求1所述的基于分层深度神经网络的微量元素含量预测方法，其特征在于，所述获取土壤样品集，并基于所述土壤样品确定元素集包括以下步骤：S11)确定标准样品集，假定标准样品集中有n份待测样品，即n份土壤样本，取经过ED-XRF荧光光谱仪能够识别的全部元素的并集，构成这n份待测样品所含有的元素集，即得标准样品集中有含量的元素集A；S12)读入元素峰值信息和含量信息，取任一待测样品为待识别样品，使用ED-XRF荧光光谱仪测试其元素集A中对应的元素峰值信息和含量信息，获得各元素的实测组分值X和含量值Y；S13)划分训练集和测试集，将获取的n份土壤样本划分为训练样本和测试样本，随机划分r份土壤样本对应的数据作为训练集，其余n-r份土壤样本作为测试集，并对各土壤样本的X射线荧光光谱数据进行预处理。3.根据权利要求2所述的基于分层深度神经网络的微量元素含量预测方法，其特征在于，所述步骤S2)包括以下子步骤：S21)确定基于分层深度神经网络的微量元素含量预测模型的输入，将需要定量分析的某个元素称为目标元素，将对目标元素产生干扰的元素称为干扰元素，将所述元素集A中所研究的所有目标元素及对其产生干扰元素组成的实测组分值矩阵Xac作为基于分层深度神经网络的微量元素含量预测模型的输入，其中，所述实测组分值矩阵Xac是一个包含a份待测样品，每份待测样品由c个元素的组分值组成的矩阵；S22)确定基于分层深度神经网络的微量元素含量预测模型的输出，将目标元素的元素含量组成的实测含量值矩阵Yam作为基于分层深度神经网络的微量元素含量预测模型的输出，其中，所述实测含量值矩阵Yam是一个包含a份待测样品，每份待测样品由m个目标元素浓度值组成的矩阵；S23)构造分层深度神经网络，该网络依次包括输入层、隐藏层、输出层，其中，输入层1个，隐含层9个，输出层1个；S24)将训练样本数据作为分层深度神经网络输入层的输入，将该输入层的输出数据输入到第一层隐含层，分层深度神经网络第一个隐含层为FC1，第二个隐含层为FC2，第三个隐含层为FC3，第四个隐含层为FC4，第五个隐含层为FC5，第六个隐含层为FC6，第七个隐含层为FC7，第八个隐含层为FC8，第九个隐含层为FC9；S25)将上一层隐含层的输出作为下一层隐含层的输入，经FC1和FC2计算后，传播分为两条路径，通过分支路径传播到FC3，获得第一个预测值向量“输出1”，同时通过主干路径上的残差块向下传播到FC4，将FC2和FC4进行跳跃连接，即将FC2和FC4结果相加传播到FC5，传播再次分为两条路径，通过分支路径传播到FC6，获得第二个预测值向量“输出2”，同时通过主干路径上的残差块向下传播到FC7，将FC5和FC7进行跳跃连接，即将FC5和FC7结果相加传播到FC8，传播再次分为两条路径，通过分支路径传播到FC9，获得第三个预测值向量“输出3”，共获得三个预测值向量“输出1”、“输出2”和“输出3”；S26)将三个预测值向量“输出1”、“输出2”和“输出3”作为输出层的输入，按照0.3、0.3和0.4的权重比例将“输出1”、“输出2”和“输出3”进行加权求和作为预测结果，并在输出层输出最终预测值。4.根据权利要求3所述的基于分层深度神经网络的微量元素含量预测方法，其特征在于，所述步骤S3)包括以下子步骤：S31)采用均方根传递方法对所述基于分层深度神经网络的微量元素含量预测模型的梯度进行t轮训练，使用了小批量随机梯度按微分平方加权平均来自使用调整模型的学习率，分层深度神经网络的权重w和偏置b的计算表达式如下：式中，w为分层深度神经网络的权重，b为分层深度神经网络的偏置，loss为所述基于分层深度神经网络的微量元素含量预测模型的损失函数，为在第t轮训练时损失函数对第s个隐含层的权重w求偏导，/＞为在第t-1轮训练时损失函数对第s个隐含层的权重w求偏导，/＞为第t轮训练时损失函数对第s个隐含层的偏置b求偏导，/＞为第t-1轮训练时损失函数对第s个隐含层的偏置b求偏导，/＞为损失函数在前t轮迭代过程中第s个隐含层的权重累积的梯度动量，/＞为损失函数在前t轮迭代过程中第s个隐含层的偏置累积的梯度动量，1≤s≤9且s为整数，α和β为常数，||·||2表示范数的平方，ws,t为第t轮迭代过程中第s个隐含层的权重，bs,t为第t轮迭代过程中第s个隐含层的偏置；S32)将训练集的数据输入基于分层深度神经网络的微量元素含量预测模型进行参数调整，对基于分层深度神经网络的微量元素含量预测模型进行训练；S33)根据元素含量预测值与元素含量真实值之差作为损失值，平均绝对误差损失函数来优化模型中的网络权重和偏置，经过迭代训练获取最优网络权重和偏置，并由此得到训练好的基于分层深度神经网络的微量元素含量预测模型。5.根据权利要求4所述的基于分层深度神经网络的微量元素含量预测方法，其特征在于，所述步骤S4)包括以下子步骤：S41)输入矩阵从输入层传播到第一个隐含层以后，后续的隐含层不断传递的同时也在不断的学习训练，每个隐含层R中的元素都是输入量经过激励函数f进行非线性变换得到的，最后将变换后的隐含层数据传送到输出层，输出层元素预测结果的计算表达式如下：式中，为目标元素含量预测矩阵，/＞为第1个目标元素的含量预测值，/＞为第m个目标元素的含量预测值，f为激励函数，R2为第2个隐含层的输出，w3为第2个隐含层神经元与第3个隐含层神经元的连接权重，b3为第2个隐含层神经元与第3个隐含层神经元之间的偏置。R5为第5个隐含层的输出，w6为第5个隐含层神经元与第6个隐含层神经元的连接权重，b6为第5个隐含层神经元与第6个隐含层神经元之间的偏置。R8为第8个隐含层的输出，w9为第8个隐含层神经元与第9个隐含层神经元的连接权重，b9为第8个隐含层神经元与第9个隐含层神经元之间的偏置；S42)将测试集中的测试样本输入到训练好的基于分层深度神经网络的微量元素含量预测模型中，对测试样本土壤微量元素含量进行分析预测。6.根据权利要求5所述的基于分层深度神经网络的微量元素含量预测方法，其特征在于，所述n＝59，m＝3。7.根据权利要求6所述的基于分层深度神经网络的微量元素含量预测方法，其特征在于，所述α＝0.001，β＝0.9。8.根据权利要求9所述的基于分层深度神经网络的微量元素含量预测方法，其特征在于，所述标准样品集中的待测样品包括GSS系列土壤成分分析标准物质、GBW系列土壤成分分析标准物质和GSD水系沉积物成分分析标准物质。9.根据权利要求8所述的一种基于分层深度神经网络的微量元素含量预测方法，其特征在于，所述目标元素包括铬、锰、铜。
说明书desc
技术领域本发明涉及元素检测领域，特别涉及一种基于分层深度神经网络的微量元素含量预测方法。背景技术随着能谱科学研究的逐步发展，在线定量检测技术成为了新的发展趋势。X射线荧光光谱仪通过测量和分析样品产生的XRF来获得物质组成的元素信息。该技术具有快速、无损、低成本、非破坏性、处理和操作简单等优势，可以同时对待测物中的多种元素组分进行快速准确的测定等优点，在土壤污染控制、矿产勘探、计算机断层扫描等领域有着广泛的应用。在利用XRF光谱仪对样品进行检测的过程中，X射线与样品的相互作用导致元素的特征峰叠加在背景之上，从而出现元素谱线之间谱峰重叠、元素信息的不确定性等问题。在谱线重叠干扰的情况下，如何提高微量元素定量分析精度成为了本发明研究的重点。而目前国内学者大多使用传统机器学习方法进行元素含量的预测，模型可处理数据规模小且泛化能力不足。将分层深度神经网络应用于元素的定量分析，解决了传统X荧光光谱仪计算不准确且缺乏数据检验的问题，旨在为X荧光光谱仪结果的定量分析提供一种可供选择的检验方法。发明内容针对上述现有技术中存在的问题，本发明提供了一种基于分层深度神经网络算法预测待测物所含元素含量的方法，该方法以全连接层为基本结构，使用残差连接方法在不相交层之间建立连接，通过样品元素的峰值特征信息与元素含量之间的关系来构造分层深度神经网络含量预测模型，最终实现定量预测物质所含元素的含量信息，提升定量分析结果的准确性，减少过拟合，防止梯度消失。为实现上述目的，本发明提出了一种基于分层深度神经网络的微量元素含量预测方法，该方法由基于分层深度神经网络的微量元素含量预测模型实现，包括以下步骤：S1：获取土壤样品集，并基于所述土壤样品确定元素集，利用ED-XRF荧光光谱仪识别所述土壤样品集中待测样品中与所述元素集中对应的元素峰值信息和含量信息，得到各元素的实测组分值和含量值；S2：构造基于分层深度神经网络的微量元素含量预测模型，确定模型的输入与输出；其中，分层深度神经网络是一个网络结构，而基于分层深度神经网络的微量元素含量预测模型是基于上述分层深度神经网络结构，在结构中给定输入输出并进行网络训练，最终实现预测元素含量，这样的一个过程称为基于分层深度神经网络的微量元素含量预测模型。S3：对基于分层深度神经网络的微量元素含量预测模型进行训练，得到训练好的基于分层深度神经网络的微量元素含量预测模型；S4：微量元素含量的预测分析，将测试样本中微量元素的组分和含量数据输入到训练好的基于分层深度神经网络的微量元素含量预测型中，完成对测试样本的微量元素含量的分析预测。所述获取土壤样品集，并基于所述土壤样品确定元素集包括以下步骤：确定标准样品集，假定标准样品集中有n份待测样品，取经过ED-XRF荧光光谱仪能够识别的全部元素的并集，构成这n份待测样品所含有的元素集，即得标准样品集中有含量的元素集A；读入元素峰值信息和含量信息：取任一待测样品为待识别样品，使用能量色散型X射线荧光光谱仪测试其元素集A中对应的元素峰值信息和含量信息，获得各元素的实测组分值X和含量值Y；划分训练集和测试集，将获取的n份土壤样本划分为训练样本和测试样本，随机划分r份样本对应的数据作为训练集，其余n-r份样本作为测试集，并对样本的X射线荧光光谱数据进行预处理。所述步骤S2包括以下步骤：确定基于分层深度神经网络的微量元素含量预测模型的输入，将需要定量分析的某个元素称为目标元素，将对目标元素产生干扰的元素称为干扰元素，将所述元素集A中所研究的所有目标元素及对其产生干扰元素组成的实测组分值矩阵Xac作为基于分层深度神经网络的微量元素含量预测模型的输入。其中，所述实测组分值矩阵Xac是一个包含a份待测样品，每份待测样品由c个元素的组分值组成的矩阵；确定基于分层深度神经网络的微量元素含量预测模型的输出，将目标元素的元素含量组成的实测含量值矩阵Yam作为基于分层深度神经网络的微量元素含量预测模型的输出。其中，所述实测含量值矩阵Yam是一个包含a份待测样品，每份待测样品由m个目标元素浓度值组成的矩阵；构造分层深度神经网络，该网络依次包括输入层、隐藏层、输出层。其中，输入层1个，隐含层9个，输出层1个；将训练集中的训练样本数据作为分层深度神经网络输入层的输入，将该输入层的输出数据输入到第一层隐含层，分层深度神经网络第一个隐含层为FC1，第二个隐含层为FC2，第三个隐含层为FC3，第四个隐含层为FC4，第五个隐含层为FC5，第六个隐含层为FC6，第七个隐含层为FC7，第八个隐含层为FC8，第九个隐含层为FC9；将上一层隐含层的输出作为下一层隐含层的输入，经FC1和FC2计算后，传播分为两条路径。通过分支路径传播到FC3，获得第一个预测值向量“输出1”，同时通过主干路径上的残差块向下传播到FC4。将FC2和FC4进行跳跃连接，即将FC2和FC4结果相加传播到FC5。传播再次分为两条路径，通过分支路径传播到FC6，获得第二个预测值向量“输出2”，同时通过主干路径上的残差块向下传播到FC7。将FC5和FC7进行跳跃连接，即将FC5和FC7结果相加传播到FC8。传播再次分为两条路径，通过分支路径传播到FC9，获得第三个预测值向量“输出3”，共获得三个预测值向量“输出1”、“输出2”和“输出3”；将三个预测值向量“输出1”、“输出2”和“输出3”作为输出层的输入，按照0.3、0.3和0.4的权重比例将“输出1”、“输出2”和“输出3”进行加权求和作为预测结果，并在输出层输出最终预测值。所述步骤S3包括以下步骤：采用均方根传递方法对所述基于分层深度神经网络的微量元素含量预测模型的梯度进行t轮训练，使用了小批量随机梯度按微分平方加权平均来自使用调整模型的学习率，分层深度神经网络的权重w和偏置b的计算表达式如下：式中，w为分层深度神经网络的权重，b为分层深度神经网络的偏置，loss为所述基于分层深度神经网络的微量元素含量预测模型的损失函数，为在第t轮训练时损失函数对第s个隐含层的权重w求偏导，/＞为在第t-1轮训练时损失函数对第s个隐含层的权重w求偏导，/＞为第t轮训练时损失函数对第s个隐含层的偏置b求偏导，/＞为第t-1轮训练时损失函数对第s个隐含层的偏置b求偏导，/＞为损失函数在前t轮迭代过程中第s个隐含层的权重累积的梯度动量，/＞为损失函数在前t轮迭代过程中第s个隐含层的偏置累积的梯度动量，α和β为常数，通常取α＝0.001，β＝0.9，||·||2表示范数的平方，ws,t为第t轮迭代过程中第s个隐含层的权重，bs,t为第t轮迭代过程中第s个隐含层的偏置；将训练集的数据输入基于分层深度神经网络的微量元素含量预测模型进行参数调整，对所述基于分层深度神经网络的微量元素含量预测模型进行训练；根据元素含量预测值与元素含量真实值之差作为损失值，平均绝对误差损失函数来优化模型中的网络权重和偏置，经过迭代训练获取最优网络权重和偏置，并由此得到训练好的基于分层深度神经网络的微量元素含量预测模型。所述微量元素含量预测分析包括以下步骤：输入矩阵从输入层到第一个隐含层以后，后续的隐含层不断传递的同时也在不断的学习训练，每个隐含层R中的元素都是输入量经过激励函数f进行非线性变换得到的，最后将FC1-FC9九个隐含层都经过变换后的隐含层数据传送到输出层，输出层元素预测结果的计算表达式如下：式中，为目标元素含量预测矩阵，/＞为第1个目标元素的含量预测值，/＞为第m个目标元素的含量预测值，f为激励函数，R2为第2个隐含层的输出，w3为第2个隐含层神经元与第3个隐含层神经元的连接权重，b3为第2个隐含层神经元与第3个隐含层神经元之间的偏置。R5为第5个隐含层的输出，w6为第5个隐含层神经元与第6个隐含层神经元的连接权重，b6为第5个隐含层神经元与第6个隐含层神经元之间的偏置。R8为第8个隐含层的输出，w9为第8个隐含层神经元与第9个隐含层神经元的连接权重，b9为第8个隐含层神经元与第9个隐含层神经元之间的偏置；将测试集数据输入到训练好的基于分层深度神经网络的微量元素含量预测模型中，对测试样本土壤微量元素含量进行分析预测。本发明公开了一种基于分层深度神经网络的微量元素含量预测方法，该方法通过分层深度神经网络建立样品元素的峰值特征信息与元素含量之间的关系来预测元素含量，科学合理，流程简单，便于操作，成本较低，结果直观，通俗易懂；本发明的运算方式具有高检测精度，高预测准确率等特点，解决X荧光能谱峰值重叠干扰、以及传统仪器测量方法不准确等问题，减少了环境本底的影响，特征提取过程简单且泛化力更强，对于土壤污染中微量元素的检测具有重要的实际意义。附图说明图1为本发明一种基于分层深度神经网络的微量元素含量预测方法流程图；图2为本发明实施例中分层深度神经网络结构的原理图；图3为本发明实施例中基于分层深度神经网络的Cr元素含量预测结果图。具体实施方式下面结合附图对本发明的具体实施方式以及工作原理作进一步详细说明。本实施例提供了一种基于分层深度神经网络的微量元素含量预测方法，工作流程如图1所示，获得标准土壤样品中元素信息的具体步骤如下：步骤1：确定土壤样品集，设所述土壤样品集中有n份土壤样品，分别为样品1、样品2……样品59。取光谱仪能够识别的元素的全部元素，构成该土壤样品所含有的元素集A，最终得到A1～A59共59个元素集，即取A1～A59的并集即得土壤样品集中有含量的元素集A，元素集A为元素周期表中12～92号元素的元素库。步骤2：采用59个国家标准样品作为标样，包括GSS系列土壤成分分析标准物质、GBW系列土壤成分分析标准物质和GSD水系沉积物成分分析标准物质，分别为GSS-1～GSS-27、GSS-32、GBW08301、GBW0070003～GBW0070006、GSD-2a～GSD-33。通过XRF荧光光谱仪可以同时得到样品的XRF光谱图及样品中所含元素组分值X和含量值Y。步骤3：划分训练集和测试集，将获取的59份获取土壤样本划分为训练样本和测试样本，随机划分47份样本对应的数据作为训练集，其余12份样本作为测试集，并对样本的X射线荧光光谱数据进行预处理；步骤4：确定基于分层深度神经网络的微量元素含量预测模型的输入，本实施例中主要研究的是土壤中铬、锰、铜三种微量元素。将目标元素及其干扰元素组成的实测组分值矩阵作为分层深度神经网络模型的输入，即输入矩阵Xac为59×10的组分数据矩阵。步骤5：确定基于分层深度神经网络的微量元素含量预测模型的输出，将目标元素的含量矩阵作为分层深度神经网络模型的输出，即输出矩阵Yam为59×3的含量数据矩阵；步骤6：构造分层深度神经网络，该网络依次包括输入层、隐藏层、输出层。其中，输入层1个，隐含层9个，输出层1个；步骤7：将训练样本数据作为分层深度神经网络输入层的输入，将该输入层的输出数据输入到第一层隐含层，分层深度神经网络第一个隐含层为FC1，第二个隐含层为FC2，第三个隐含层为FC3，第四个隐含层为FC4，第五个隐含层为FC5，第六个隐含层为FC6，第七个隐含层为FC7，第八个隐含层为FC8，第九个隐含层为FC9；步骤8：将上一层隐含层的输出作为下一层隐含层的输入，经FC1和FC2计算后，传播分为两条路径。通过分支路径传播到FC3，获得第一个预测值向量“输出1”，同时通过主干路径上的残差块向下传播到FC4。将FC2和FC4进行跳跃连接，即将FC2和FC4结果相加传播到FC5。传播再次分为两条路径，通过分支路径传播到FC6，获得第二个预测值向量“输出2”，同时通过主干路径上的残差块向下传播到FC7。将FC5和FC7进行跳跃连接，即将FC5和FC7结果相加传播到FC8。传播再次分为两条路径，通过分支路径传播到FC9，获得第三个预测值向量“输出3”，共获得三个预测值向量“输出1”、“输出2”和“输出3”；步骤9：将三个预测值向量“输出1”、“输出2”和“输出3”作为输出层的输入，按照0.3、0.3和0.4的权重比例将“输出1”、“输出2”和“输出3”进行加权求和作为预测结果。步骤10：采用均方根传递方法对所述基于分层深度神经网络的微量元素含量预测模型的梯度进行t轮训练，使用了小批量随机梯度按微分平方加权平均来自使用调整模型的学习率，分层深度神经网络的权重w和偏置b的计算表达式如下：式中，w为分层深度神经网络的权重，b为分层深度神经网络的偏置，loss为所述基于分层深度神经网络的微量元素含量预测模型的损失函数，为在第t轮训练时损失函数对第s个隐含层的权重w求偏导，/＞为在第t-1轮训练时损失函数对第s个隐含层的权重w求偏导，/＞为第t轮训练时损失函数对第s个隐含层的偏置b求偏导，/＞为第t-1轮训练时损失函数对第s个隐含层的偏置b求偏导，/＞为损失函数在前t轮迭代过程中第s个隐含层的权重累积的梯度动量，/＞为损失函数在前t轮迭代过程中第s个隐含层的偏置累积的梯度动量，α和β为常数，通常取α＝0.001，β＝0.9，||·||2表示范数的平方，ws,t为第t轮迭代过程中第s个隐含层的权重，bs,t为第t轮迭代过程中第s个隐含层的偏置；步骤11：将训练集的数据输入分层深度神经网络含量预测模型进行参数调整，对分层深度神经网络模型进行训练；步骤12：根据元素含量预测值与元素含量真实值之差作为损失值，平均绝对误差损失函数来优化模型中的网络权重和偏置，经过迭代训练获取最优网络权重和偏置，并由此得到训练好的基于分层深度神经网络的微量元素含量预测模型；步骤13：输入矩阵从输入层到第一个隐含层以后，后续的隐含层不断传递的同时也在不断的学习训练，每个隐含层R中的元素都是输入量经过激励函数f进行非线性变换得到的，最后将变换后的隐含层数据传送到输出层，输出层元素预测结果的计算表达式如下：式中，为目标元素含量预测矩阵，/＞为第1个目标元素的含量预测值，/＞为第m个目标元素的含量预测值，f为激励函数，R2为第2个隐含层的输出，w3为第2个隐含层神经元与第3个隐含层神经元的连接权重，b3为第2个隐含层神经元与第3个隐含层神经元之间的偏置。R5为第5个隐含层的输出，w6为第5个隐含层神经元与第6个隐含层神经元的连接权重，b6为第5个隐含层神经元与第6个隐含层神经元之间的偏置。R8为第8个隐含层的输出，w9为第8个隐含层神经元与第9个隐含层神经元的连接权重，b9为第8个隐含层神经元与第9个隐含层神经元之间的偏置；步骤14：将测试集数据输入到多层深度神经网络模型中，对测试样本土壤微量元素含量进行分析预测。将传统的深度神经网络方法和基于分层深度神经网络方法的标准土壤样品元素决定系数R2结果对比，对比详细信息见表1。以Cr元素为例，其含量预测结果如图3所示。表1标准土壤样品测试集元素含量预测的决定系数R2结果比较相较于传统的深度神经网络方法，基于分层深度神经网络的微量元素含量预测结果更接近于元素含量的真实值。说明分层深度神经网络算法有效解决了谱线重叠的问题，提高了元素定量分析结果的准确性，体现了本发明方法的优越性。以上所述，仅为本发明的具体实施方式，本说明书中所公开的任一特征，除非特别叙述，均可被其他等效或具有类似目的的替代特征加以替换；所公开的所有特征、或所有方法或过程中的步骤，除了互相排斥的特征和/或步骤以外，均可以任何方式组合；本领域的技术人员根据本发明技术方案的技术特征所做出的任何非本质的添加、替换，均属于本发明的保护范围。
