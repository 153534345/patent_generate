标题title
一种爆珠生产质量视觉检测方法
摘要abst
本发明涉及图像处理技术领域，具体涉及一种爆珠生产质量视觉检测方法，包括：获取爆珠分布灰度图像和爆珠分布二值图，得到连通域中心点的坐标信息，根据连通域中心点的坐标信息得到爆珠分布二值图中连通域之间的平均距离，得到最优分割阈值，根据最优分割阈值得到爆珠区域和背景区域，对背景区域和爆珠区域的像素点灰度值进行增强处理，得到增强之后的爆珠分布灰度图像，根据增强之后的爆珠分布灰度图像完成爆珠的气泡缺陷检测。本发明通过寻找最佳阈值将图像中爆珠特征和背景特征进行区分，分别进行不同的灰度级变换，相比于现有线性变换方法不仅增强了爆珠的灰度特征也抑制了背景灰度特征对图像的干扰。
权利要求书clms
1.一种爆珠生产质量视觉检测方法，其特征在于，该方法包括以下步骤：获取爆珠分布灰度图像，根据爆珠分布灰度图像获取每个分割阈值下的爆珠分布二值图；获取每个分割阈值下的爆珠分布二值图中的若干个连通域，根据连通域中像素点的坐标信息得到连通域中心点的坐标信息，根据连通域中心点的坐标信息得到每个分割阈值下的爆珠分布二值图中连通域之间的平均距离，根据所有分割阈值下的爆珠分布二值图中连通域之间的平均距离得到最优分割阈值；根据最优分割阈值得到爆珠分布灰度图像中的爆珠区域和背景区域，对背景区域行处理得到增强之后的背景区域，将爆珠区域的灰度值范围内任意一个灰度值记为目标灰度值，根据爆珠分布灰度图像中目标灰度值的像素点与其四邻域像素点灰度值的差异值的均值，得到目标灰度值的灰度值差异程度；构建线性变换公式，根据目标灰度值的灰度值差异程度得到线性变换公式中的待定变换系数，根据构建线性变换公式对爆珠区域内像素点灰度值进行线性变换，得到增强之后的爆珠区域，根据增强之后的背景区域和增强之后的爆珠区域得到增强之后的爆珠分布灰度图像；根据增强之后的爆珠分布灰度图像完成爆珠的气泡缺陷检测。2.根据权利要求1所述一种爆珠生产质量视觉检测方法，其特征在于，所述根据爆珠分布灰度图像获取每个分割阈值下的爆珠分布二值图，包括的具体步骤如下：在的整数区间中将每一个整数作为爆珠分布灰度图像的分割阈值进行二值分割，得到若干张爆珠分布二值图。3.根据权利要求1所述一种爆珠生产质量视觉检测方法，其特征在于，所述根据连通域中像素点的坐标信息得到连通域中心点的坐标信息，包括的具体步骤如下：；；式中，为第i个连通域中第j个像素点的横坐标，/＞为第i个连通域中第j个像素点的纵坐标，/＞为第i个连通域中像素点的总个数，/＞为第i个连通域中心点的横坐标，/＞为第i个连通域中心点的纵坐标。4.根据权利要求1所述一种爆珠生产质量视觉检测方法，其特征在于，所述根据连通域中心点的坐标信息得到每个分割阈值下的爆珠分布二值图中连通域之间的平均距离，包括的具体步骤如下：；式中，为爆珠分布二值图中第i个连通域与沿x轴正方向最相邻连通域中心点的横坐标差值的绝对值，/＞为爆珠分布二值图中第i个连通域与沿y轴正方向最相邻连通域中心点的纵坐标差值的绝对值，/＞为爆珠分布二值图中连通域的总个数，/＞为爆珠分布二值图中连通域之间的平均距离。5.根据权利要求1所述一种爆珠生产质量视觉检测方法，其特征在于，所述根据所有分割阈值下的爆珠分布二值图中连通域之间的平均距离得到最优分割阈值，包括的具体步骤如下：选取所有爆珠分布二值图中连通域之间的平均距离的最小值对应的分割阈值作为最优分割阈值。6.根据权利要求1所述一种爆珠生产质量视觉检测方法，其特征在于，所述根据最优分割阈值得到爆珠分布灰度图像中的爆珠区域和背景区域，包括的具体步骤如下：将爆珠分布灰度图像中灰度值在之间划分为爆珠区域，T为最优分割阈值，将灰度值在/＞之间划分为背景区域。7.根据权利要求1所述一种爆珠生产质量视觉检测方法，其特征在于，所述对背景区域行处理得到增强之后的背景区域，包括的具体步骤如下：将背景区域的像素点灰度值全部置为255，得到增强之后的背景区域。8.根据权利要求1所述一种爆珠生产质量视觉检测方法，其特征在于，所述根据爆珠分布灰度图像中目标灰度值的像素点与其四邻域像素点灰度值的差异值的均值，得到目标灰度值的灰度值差异程度，包括的具体步骤如下：；式中，为爆珠分布灰度图像中目标灰度值的第/＞个像素点与其四邻域像素点灰度值的差异值的均值，所述差异值为第/＞个像素点与其四邻域像素点灰度值差值的绝对值，/＞为爆珠分布灰度图像中目标灰度值的像素点总个数，/＞为目标灰度值的灰度值差异程度。9.根据权利要求1所述一种爆珠生产质量视觉检测方法，其特征在于，所述根据目标灰度值的灰度值差异程度得到线性变换公式中的待定变换系数，包括的具体步骤如下：将目标灰度值的灰度值差异程度的倒数作为线性变换公式中的待定变换系数。10.根据权利要求1所述一种爆珠生产质量视觉检测方法，其特征在于，所述根据增强之后的爆珠分布灰度图像完成爆珠的气泡缺陷检测，包括的具体步骤如下：在增强之后的爆珠分布灰度图像中，选取第u行的所有爆珠区域，记为第u行的爆珠区域集合，分别计算第u行的爆珠区域集合中每一个爆珠区域的灰度均值，将爆珠区域的灰度均值的最大值记为max，最小值记为min，计算第u行的爆珠区域集合中所有爆珠区域的灰度均值，记为TH；在第u行的所有爆珠区域中将灰度值在之间的爆珠区域记为/＞，将灰度值在之间的爆珠区域记为/＞，获取增强之后的爆珠分布灰度图像所有行的/＞和/＞，/＞表示存在气泡缺陷的爆珠，/＞表示正常爆珠。
说明书desc
技术领域本发明涉及图像处理技术领域，具体涉及一种爆珠生产质量视觉检测方法。背景技术随着科技的进步，自动化检测技术在爆珠生产质量检测中得到越来越广泛的应用。例如，采用计算机视觉技术和图像处理算法，可以自动检测和分析爆珠的形状、大小、颜色等特征，提高检测效率和准确性。爆珠是一颗液体小胶珠，它包裹了不同类型香料的液体，可以为使用者提供特殊的口感和娱乐性，由于爆珠体积较小，因此在生产过程中不可避免会产生各种缺陷和瑕疵。比较明显的人眼可观察的有气泡、凹陷、划痕等。其中气泡缺陷是由于爆珠壳体破裂或壳体渗透所致。目前爆珠生产行业使用较多的检测方法为人工筛选检测，人工检测容易受到外界干扰，检测效率和准确率难以得到保证。本发明通过图像增强技术，对增强后的图像进行灰度值异变检测自动识别出有气泡缺陷的爆珠，由于采集的爆珠图像由于颜色不同或者其它原因，在灰度图中会产生和背景灰度值相似的像素点，因此直接对全图进行线性增强不仅会增强爆珠的灰度特征，也会将背景部分进行增强，影响后续对爆珠的识别效果。发明内容本发明提供一种爆珠生产质量视觉检测方法，以解决现有的问题。本发明的一种爆珠生产质量视觉检测方法采用如下技术方案：本发明一个实施例提供了一种爆珠生产质量视觉检测方法，该方法包括以下步骤：获取爆珠分布灰度图像，根据爆珠分布灰度图像获取每个分割阈值下的爆珠分布二值图；获取每个分割阈值下的爆珠分布二值图中的若干个连通域，根据连通域中像素点的坐标信息得到连通域中心点的坐标信息，根据连通域中心点的坐标信息得到每个分割阈值下的爆珠分布二值图中连通域之间的平均距离，根据所有分割阈值下的爆珠分布二值图中连通域之间的平均距离得到最优分割阈值；根据最优分割阈值得到爆珠分布灰度图像中的爆珠区域和背景区域，对背景区域行处理得到增强之后的背景区域，将爆珠区域的灰度值范围内任意一个灰度值记为目标灰度值，根据爆珠分布灰度图像中目标灰度值的像素点与其四邻域像素点灰度值的差异值的均值，得到目标灰度值的灰度值差异程度；构建线性变换公式，根据目标灰度值的灰度值差异程度得到线性变换公式中的待定变换系数，根据构建线性变换公式对爆珠区域内像素点灰度值进行线性变换，得到增强之后的爆珠区域，根据增强之后的背景区域和增强之后的爆珠区域得到增强之后的爆珠分布灰度图像；根据增强之后的爆珠分布灰度图像完成爆珠的气泡缺陷检测。进一步地，所述根据爆珠分布灰度图像获取每个分割阈值下的爆珠分布二值图，包括的具体步骤如下：在的整数区间中将每一个整数作为爆珠分布灰度图像的分割阈值进行二值分割，得到若干张爆珠分布二值图。进一步地，所述根据连通域中像素点的坐标信息得到连通域中心点的坐标信息，包括的具体步骤如下：；；式中，为第i个连通域中第j个像素点的横坐标，为第i个连通域中第j个像素点的纵坐标，为第i个连通域中像素点的总个数，为第i个连通域中心点的横坐标，为第i个连通域中心点的纵坐标。进一步地，所述根据连通域中心点的坐标信息得到每个分割阈值下的爆珠分布二值图中连通域之间的平均距离，包括的具体步骤如下：；式中，为爆珠分布二值图中第i个连通域与沿x轴正方向最相邻连通域中心点的横坐标差值的绝对值，为爆珠分布二值图中第i个连通域与沿y轴正方向最相邻连通域中心点的纵坐标差值的绝对值，为爆珠分布二值图中连通域的总个数，为爆珠分布二值图中连通域之间的平均距离。进一步地，所述根据所有分割阈值下的爆珠分布二值图中连通域之间的平均距离得到最优分割阈值，包括的具体步骤如下：选取所有爆珠分布二值图中连通域之间的平均距离的最小值对应的分割阈值作为最优分割阈值。进一步地，所述根据最优分割阈值得到爆珠分布灰度图像中的爆珠区域和背景区域，包括的具体步骤如下：将爆珠分布灰度图像中灰度值在之间划分为爆珠区域，T为最优分割阈值，将灰度值在之间划分为背景区域。进一步地，所述对背景区域行处理得到增强之后的背景区域，包括的具体步骤如下：将背景区域的像素点灰度值全部置为255，得到增强之后的背景区域。进一步地，所述根据爆珠分布灰度图像中目标灰度值的像素点与其四邻域像素点灰度值的差异值的均值，得到目标灰度值的灰度值差异程度，包括的具体步骤如下：；式中，为爆珠分布灰度图像中目标灰度值的第个像素点与其四邻域像素点灰度值的差异值的均值，所述差异值为第个像素点与其四邻域像素点灰度值差值的绝对值，为爆珠分布灰度图像中目标灰度值的像素点总个数，为目标灰度值的灰度值差异程度。进一步地，所述根据目标灰度值的灰度值差异程度得到线性变换公式中的待定变换系数，包括的具体步骤如下：将目标灰度值的灰度值差异程度的倒数作为线性变换公式中的待定变换系数。进一步地，所述根据增强之后的爆珠分布灰度图像完成爆珠的气泡缺陷检测，包括的具体步骤如下：在增强之后的爆珠分布灰度图像中，选取第u行的所有爆珠区域，记为第u行的爆珠区域集合，分别计算第u行的爆珠区域集合中每一个爆珠区域的灰度均值，将爆珠区域的灰度均值的最大值记为max，最小值记为min，计算第u行的爆珠区域集合中所有爆珠区域的灰度均值，记为TH；在第u行的所有爆珠区域中将灰度值在之间的爆珠区域记为，将灰度值在之间的爆珠区域记为，获取增强之后的爆珠分布灰度图像所有行的和，表示存在气泡缺陷的爆珠，表示正常爆珠。本发明的技术方案的有益效果是：首先获取原灰度图的二值图像，由于大津法分割时不考虑像素点之间的空间关系，而爆珠图像之间有明显的空间特征，所以大津法分割的图像结果不准确。所以本发明使用不同阈值进行分割得到不同的二值化图像，根据图像中爆珠的分布特征分析不同二值化图像中各个连通域中心点之间的距离来找到最优分割阈值T。使用最优阈值T将原图像直方图分为背景区和爆珠区两部分。对两部分分别进行灰度值调整达到图像增强的效果。现有方法对图像进行增强通常使用全局的线性增强方法，该方法在增强爆珠的同时也增强了背景像素，不利于后续对爆珠的检测。本发明通过寻找阈值T将图像中爆珠特征和背景特征进行区分，分别进行不同的灰度值变换，相比于现有线性变换方法不仅增强了爆珠的灰度特征也抑制了背景灰度特征对图像的干扰。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明一个实施例所提供的一种爆珠生产质量视觉检测方法的步骤流程图；图2为本发明的白色平板光源示意图；图3为本发明的爆珠分布灰度图像；图4为本发明的增强之后的爆珠分布灰度图像。具体实施方式为了更进一步阐述本发明为达成预定发明目的所采取的技术手段及功效，以下结合附图及较佳实施例，对依据本发明提出的一种爆珠生产质量视觉检测方法，其具体实施方式、结构、特征及其功效，详细说明如下。在下述说明中，不同的“一个实施例”或“另一个实施例”指的不一定是同一实施例。此外，一个或多个实施例中的特定特征、结构或特点可由任何合适形式组合。除非另有定义，本文所使用的所有的技术和科学术语与属于本发明的技术领域的技术人员通常理解的含义相同。下面结合附图具体的说明本发明所提供的一种爆珠生产质量视觉检测方法的具体方案。请参阅图1，其示出了本发明一个实施例提供的一种爆珠生产质量视觉检测方法的步骤流程图，该方法包括以下步骤：步骤S001、采集爆珠分布图像，获取爆珠分布灰度图像。需要说明的是，本实施例对爆珠外观检测需要相应的检测设备对爆珠进行质量筛选，检测设备包括：下料单元、图像采集单元以及剔除单元，本实施例主要处理分析的图像采集单元，所述图像采集单元包括白色平板光源和工业相机，请参阅图2，图2为本实施例的白色平板光源示意图，图2中包含白色平板光源和工业相机的镜头，白色平板光源可以解决爆珠在采集过程中的反光、阴影等问题，白色平板光源采用平板底部打光的方式。具体的，通过检测设备的图像采集单元采集得到爆珠分布图像，需要说明的是，爆珠分布是在白色平板光源上按照行列均值分布的，因此采集得到的爆珠分布图像中爆珠也是按照行列均值分布的，由于爆珠的颜色通常有很多种，为了便于分析，对爆珠分布图像进行灰度化得到爆珠分布灰度图像，请参阅图3，图3为本实施例的爆珠分布灰度图像，具体灰度化的方法为加权平均法，按照一定的权值对R、G、B三个分量加权求均值，由于人眼对绿色比较敏感，因此对G分量的系数设置为0.58，B分量的系数设置为0.12，R分量的系数设置为0.3。至此，得到了爆珠分布灰度图像。步骤S002、获取爆珠分布二值图，根据连通域中像素点的坐标信息得到连通域中心点的坐标信息，根据连通域中心点的坐标信息得到爆珠分布二值图中连通域之间的平均距离，根据爆珠分布二值图中连通域之间的平均距离得到最优分割阈值。需要说明的是，由于大津法分割图像是基于图像的灰度信息采用最大类间方差来确定最优阈值，而不考虑像素之间的空间关系。由于采集到的爆珠分布图像之间有明显的距离特征，因此采用大津法进行分割会导致分割结果不准确，所以需要根据爆珠之间的距离特征来判断二值分割的最优阈值。具体的，在的整数区间中将每一个整数作为爆珠分布灰度图像的分割阈值进行二值分割，得到若干张爆珠分布二值图，爆珠分布二值图中灰度值为0的区域为可能的爆珠区域，灰度值为1的区域为可能的背景区域。需要说明的是，通过对不同的爆珠分布二值图分析，分割效果越好，爆珠分布二值图中任意两个爆珠中心点之间的水平方向距离和竖直方向距离越近，因此可以根据爆珠分布二值图中爆珠之间的水平距离和竖直距离来寻找最优的分割阈值。具体的，以任意一张爆珠分布二值图为例，利用邻接组合法对爆珠分布二值图进行连通域识别，得到爆珠分布二值图中的若干个连通域。对爆珠分布二值图构建坐标系，以爆珠分布二值图左上角为坐标原点，水平向右为x轴正方向，垂直向下为y轴正方向，获取每一个连通域中像素点的坐标值，根据连通域中像素点的坐标信息得到连通域中心点的坐标信息，具体如下：；；式中，为第i个连通域中第j个像素点的横坐标，为第i个连通域中第j个像素点的纵坐标，为第i个连通域中像素点的总个数，为第i个连通域中心点的横坐标，为第i个连通域中心点的纵坐标，同理可以获取所有连通域中心点的横纵坐标。对于每个连通域，可以用连通域中所有像素点的横坐标和纵坐标的平均值来表示中心点的坐标。具体的，根据连通域中心点的坐标信息得到爆珠分布二值图中连通域之间的平均距离，具体如下：；式中，为爆珠分布二值图中第i个连通域与沿x轴正方向最相邻连通域中心点的横坐标差值的绝对值，需要说明的是，对于爆珠分布二值图中最右侧连通域计算与其左侧最相邻连通域中心点的横坐标差值的绝对值，为爆珠分布二值图中第i个连通域与沿y轴正方向最相邻连通域中心点的纵坐标差值的绝对值，为爆珠分布二值图中连通域的总个数，为爆珠分布二值图中连通域之间的平均距离。进一步地，上述是以任意一张爆珠分布二值图为例进行分析的，同理可以获得所有爆珠分布二值图中连通域之间的平均距离，爆珠分布二值图中连通域之间的平均距离的值越小表示图像的分割效果最好，选取所有爆珠分布二值图中连通域之间的平均距离的最小值对应的分割阈值作为最优分割阈值。至此，得到了最优分割阈值。步骤S003、根据最优分割阈值得到爆珠区域和背景区域。需要说明的是，大多数爆珠的灰度值和背景部分灰度值有明显的差别，但是还有部分爆珠的灰度值和背景部分灰度值比较接近，在灰度图上不容易判断背景和爆珠的灰度值临界点。所以根据二值化的最优分割阈值来对背景区域和爆珠区域进行划分。具体的，将爆珠分布灰度图像中灰度值在之间划分为爆珠区域，T为最优分割阈值，将灰度值在之间划分为背景区域。至此，得到了爆珠区域和背景区域。步骤S004、对背景区域和爆珠区域的像素点灰度值进行增强处理，得到增强之后的爆珠分布灰度图像。具体的，由于背景区域的像素点灰度值比较统一，为了将其和爆珠区域像素点灰度值比较明显的区分出来，将背景区域的像素点灰度值全部置为255，得到增强之后的背景区域。需要说明的是，由于图像中不同爆珠的像素点灰度值也有差距，有些爆珠的像素点灰度值偏低，有些爆珠的像素点灰度值偏高和背景部分灰度值比较接近。所以对爆珠区域的像素点进行不同程度的线性变换来达到对每个爆珠都进行比较好的增强。具体的，将中任意一个灰度值记为目标灰度值，根据爆珠分布灰度图像中目标灰度值的像素点与其四邻域像素点灰度值的差异值的均值，得到灰度值差异程度，具体如下：；式中，为爆珠分布灰度图像中目标灰度值的第个像素点与其四邻域像素点灰度值的差异值的均值，所述差异值为第个像素点与其四邻域像素点灰度值差值的绝对值，为爆珠分布灰度图像中目标灰度值的像素点总个数，为爆珠分布灰度图像中目标灰度值的像素点与邻域像素点的灰度值差异程度，简记为目标灰度值的灰度值差异程度。具体的，构建线性变换公式，对目标灰度值的像素点进行线性变换，具体如下：；式中，为爆珠分布灰度图像中目标灰度值，为目标灰度值线性变换之后的灰度值，为线性变换公式中的待定变换系数。具体的，的值越大表示当前灰度值像素点与其周围像素点灰度值差异越大，即对应的线性变换k值就相对应的小一点。的值越小表示当前灰度值像素点与其周围像素点灰度值差异越小，说明其可能和背景部分的像素点灰度值比较接近，即对应的线性变换k值就相对应的大一点，即的值和k值呈反比关系，则，为目标灰度值的灰度值差异程度，为线性变换公式中的待定变换系数。具体的，上述是以内任意一个灰度值为例进行分析的，即目标灰度值，将爆珠分布灰度图像中像素点灰度值在所有灰度值进行线性变换，得到增强之后的爆珠区域，需要说明的是，不同的灰度值对应的k可能是不同的，因为各自灰度值对应的不同，最终根据增强之后的背景区域和增强之后的爆珠区域得到增强之后的爆珠分布灰度图像，请参阅图4，图4为本实施例的增强之后的爆珠分布灰度图像，需要特别说明的是，灰度值为0的像素点在爆珠分布灰度图像上显示为黑色，所以对灰度值为0像素点不进行线性变换处理。至此，得到增强之后的爆珠分布灰度图像。步骤S005、根据增强之后的爆珠分布灰度图像完成爆珠的气泡缺陷检测。具体的，再次说明，采集得到的爆珠分布图像中爆珠也是按照行列均值分布的，则增强之后的爆珠分布灰度图像中爆珠也是按照行列均值分布的。在增强之后的爆珠分布灰度图像中，选取第u行的所有爆珠区域，记为第u行的爆珠区域集合，分别计算第u行的爆珠区域集合中每一个爆珠区域的灰度均值，将爆珠区域的灰度均值的最大值记为max，最小值记为min，计算第u行的爆珠区域集合中所有爆珠区域的灰度均值，记为TH；在第u行的所有爆珠区域中将灰度值在之间的爆珠区域记为，将灰度值在之间的爆珠区域记为，同理获取增强之后的爆珠分布灰度图像所有行的和，表示存在气泡缺陷的爆珠，表示正常爆珠，完成对爆珠的气泡缺陷检测。后续可通过剔除单元将存在气泡缺陷的爆珠进行剔除，得到正常爆珠，并通过下料单元对白色平板光源重新补充爆珠，进行相同的检测。至此，本实施例完成。以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
