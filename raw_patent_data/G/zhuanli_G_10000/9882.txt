标题title
一种动作捕捉系统及方法
摘要abst
本发明提供一种动作捕捉系统及方法，该系统包括至少一个动作捕捉装置，人体目标检测器，人体目标跟踪器，人体动作姿态计算器，人体定位计算器，自定位计算器以及人体定位转换器。采用本发明提供的动作捕捉方法最少需要两个光学相机即可准确实现在地面坐标系中人体的定位和动作姿态解算，在室内和室外拍摄场景受限的情况下也能保证动作捕捉结果的精度，极大提升了动作捕捉技术的实用性、便捷性、准确性、稳定性和适用性。
权利要求书clms
1.一种动作捕捉系统及方法，其特征在于，包括：动作捕捉装置，此装置包括至少两个图像采集传感器，所述动作捕捉装置通过所述图像采集传感器提供图像；人体目标检测器，其包括至少一个人体关节点检测器和至少一个人体标记点检测器，所述人体关节点检测器用于对所述动作捕捉设备采集的图像中的人体进行检测，得到图像上人体的2D关节特征点集，所述人体标记点检测器用于对所述动作捕捉设备采集的图像中的人物进行检测，得到图像上人物表面的2D标记特征点集；人体目标跟踪器，其包括至少一个人体关节点跟踪器和至少一个人体标记点跟踪器，所述人体关节点跟踪器用于对所述人体关节点检测器检测的2D关节特征点集进行跟踪，得到人体不同时刻的2D关节特征点集信息，所述人体标记点跟踪器用于对所述人体标记点检测器检测的2D标记特征点集进行跟踪，得到人体不同时刻各关节的2D标记特征点集信息；人体动作姿态计算器，用于对所述人体目标检测器检测的人体进行动作姿态解算，得到人体各关节的空间姿态角和3D坐标；人体定位计算器，其包括至少一个人体标记点定位器和至少一个人体关节点位置优化器以及至少一个人体关节点定位器，所述人体标记点定位器用于计算人体所有标记特征点在第一坐标系下的3D坐标，所述人体关节点位置优化器用于对所述人体动作姿态计算器计算得到的人体关节点的空间位姿进行优化，所述人体关节点定位器计算人体各关节在所述第一坐标系下的3D坐标；自定位计算器，用于所述动作捕捉装置自身的定位计算，即计算所述动作捕捉装置在第二坐标系下的3D坐标以及姿态角；人体定位转换器，用于将人体空间位姿从所述第一坐标系下转换到所述第二坐标系中。2.根据权利要求1所述的系统，其特征在于，所述动作捕捉装置是一种便携装置，便于安装和拆卸。3.根据权利要求1所述的系统，其特征在于，还包括一种用于交换数据的无线通信装置。4.根据权利要求1所述的系统，其特征在于，所述动作捕捉装置包括至少一种光源，用于照亮场景、环境或者动作捕捉目标。5.根据权利要求1所述的系统，其特征在于，所述动作捕捉装置包括至少一个电子芯片处理器，所述电子芯片处理器执行如下功能的全部或者一个子集：人体目标检测器，人体目标跟踪器，人体动作姿态计算器，人体定位计算器，自定位计算器，人体定位转换器。6.根据权利要求1所述的系统，其特征在于，所述动作捕捉装置包括至少一种惯性传感器，可提供位姿信息，用于辅助所述动作捕捉装置进行自定位。7.根据权利要求1所述的系统，其特征在于，所述动作捕捉装置包括至少一种深度图像传感器，可提供位姿信息，用于辅助所述动作捕捉装置进行自定位。8.一种动作捕捉方法，其特征在于，包含如下步骤：1)通过动作捕捉装置获得至少两个图像采集传感器采集的图像序列；2)通过人体目标检测器，对所述图像采集传感器获取的每帧图像进行人体检测及人体标记点检测，得到图像上人体的区域分割、2D关节特征点集和2D标记特征点集；3)通过人体目标跟踪器，分别对所述人体目标检测得到的2D关节特征点集和2D标记特征点集进行跟踪，得到在不同视角所有时刻同一人体的2D关节特征点集和不同视角所有时刻同一人体关节部位的2D标记特征点集；4)通过人体动作姿态解算器，利用单帧图像对人体3D模型和动作姿态进行回归计算，得到第一坐标系下人体模型和各关节的空间姿态角；5)通过自定位计算器，利用所述采集图像传感器在空间不同视角下采集的多帧图像进行空间自定位计算，获取所述动作捕捉装置在第二坐标系中的位姿，包括3D坐标以及姿态角；6)通过人体定位计算器，对检测到的人物进行空间定位计算，获取人体各关节和人体表面特征点在所述第一坐标系下的3D坐标；7)通过人体定位转换器，利用所述动作捕捉装置在所述第二坐标系中的位姿将人体空间位姿从所述第一坐标系下转换到第二坐标系中。9.根据权利要求8所述的方法，其特征在于，所述图像中人体上相对固定布置一种或几种空间几何形状和尺寸已知的标记点或标记图案，用于求取或辅助求取人体各关节在所述第一坐标系下的3D坐标。10.根据权利要求8所述的方法，其特征在于，所述人体定位器采用立体视觉原理通过同一时刻两个以上图像采集传感器对人体表面标记点进行三维重建，得到标记点的空间位置。11.根据权利要求8所述的方法，其特征在于，所述人体定位计算，利用所述人体标记点定位器得到的标记点定位结果和所述人体关节点位置优化器得到的人体3D模型和各关节的空间姿态，即可获取人体各关节在所述第一坐标系下的3D坐标。12.根据权利要求11所述的方法，其特征在于，所述人体关节点位置优化器，利用所述至少两个图像采集传感器采集的不同视角的人体关节点跟踪结果和自定位计算结果，得到优化后的人体各关节点在所述第一坐标系下的空间姿态和3D位置。13.根据权利要求11所述的方法，其特征在于，所述人体关节点位置优化器，利用所述人体标记点定位器得到的标记点定位结果，获取人体各关节在所述第一坐标系下的3D坐标。14.根据权利要求8所述的方法，其特征在于，所述人体目标跟踪，对所述人体目标检测得到的2D关节特征点集和2D标记特征点集进行不同视角的跟踪，得到不同视角下同一时刻的同名标识点。15.根据权利要求8所述的方法，其特征在于，进一步包括提取图像上场景中的自然纹理特征2D点集，采用SFM原理进行所述自定位计算。16.根据权利要求15所述的方法，其特征在于，所述图像上场景中固定布置一种或几种标记点或标记图案，提供特征信息用于所述自定位计算。17.根据权利要求8或14所述的方法，其特征在于，利用所述人体目标检测得到的人体区域分割结果，滤除人体区域内的2D特征干扰，提供背景有效特征信息用于所述自定位计算。18.根据权利要求8所述的方法，其特征在于，采用所述动作捕捉装置中的一种或多种惯性传感器，提供位姿信息，实现自定位计算。19.根据权利要求8所述的方法，其特征在于，采用所述动作捕捉装置上的一种或多种深度图像传感器，通过3D特征配准至所述第二坐标系，实现自定位计算。
说明书desc
技术领域本发明属于人体动作捕捉技术领域，具体涉及一种便携式多目相机动作捕捉系统及方法。背景技术人体动作捕捉是将计算机采集到的人体图像序列通过视觉原理计算出人体的动作轨迹和空间姿态等信息。根据原理不同将动作捕捉技术分为标记点式和无标记点式两大类。标记点是标记点式动作捕捉系统的重要组成部分，用于标记人体关节或目标物体，通过对标记点的采集和计算获取人体关节的动作信息，具有高速、高精度、高可靠性的特点。标记点式动作捕捉是多相机动作捕捉中采用最为广泛的方法，根据标记点形态不同分为二维标记和三维标记两大类，实际根据应用场景不同各有侧重，三维标记点通常应用在室内动作捕捉场景，二维标记点常用在户外动作捕捉场景。目前，多相机标记点动作捕捉技术在影视CG制作、工业测量、虚拟现实、机器人等领域得到广泛的应用。近年来，得益于深度学习算法的突破，动作捕捉技术得到有效简化，只使用单相机就可以基于2D图像/视频直接生成3D人体模型数据，使得单相机AI动作捕捉算法在娱乐消费、虚拟现实、体育训练等领域有广阔的应用空间。多相机动作捕捉系统为了精确计算标记点的空间位置，拍摄时需要在不同位置架设多台图像采集传感器，通过增加捕获视角提高标记点的重建质量，在室外等光照变化复杂的情况下也能适用，但是因需图像采集传感器太多，其在拍摄空间受限时无法使用。单相机动作捕捉算法只依靠2D图像生成3D人体模型，其生成的人体3D模型只能粗略给出人体关节的空间姿态和3D位置，空间姿态不够准确，并且3D位置无法表达人体在地面坐标系中的真实位置，因此难以满足高精度动作捕捉系统的应用，比如影视CG制作等。发明内容与单相机动作捕捉系统相比，便携式多目动作捕捉系统具有可以单帧定位相机位姿并进行人体动作姿态优化的优势，并且多目动作捕捉系统还自带尺度信息。本发明以双目结构便携式动作捕捉系统为例，利用双目系统上述优势和单相机AI动作捕捉结果，在计算人体各关节的空间姿态和3D位置时是非常有益并且可行的。同时，可供选择地，将人体标记点作为辅助信息进一步提升动作捕捉系统的精度和稳定度。本发明的目的是提供一种动作捕捉系统，此系统能在标记点式和无标记点式两种情况下都能准确计算人体各关节的空间姿态和3D坐标。本发明的另一个目的是提供一种动作捕捉方法。本发明的具体技术方案如下。一种动作捕捉系统，所述系统包含：动作捕捉装置，此装置包括至少两个图像采集传感器，所述动作捕捉装置通过所述图像采集传感器提供图像；人体目标检测器，其包括至少一个人体关节点检测器和至少一个人体标记点检测器，所述人体关节点检测器用于对所述动作捕捉设备采集的图像中的人体进行检测，得到图像上人体的2D关节特征点集，所述人体标记点检测器用于对所述动作捕捉设备采集的图像中的人物进行检测，得到图像上人物表面的2D标记特征点集；人体目标跟踪器，其包括至少一个人体关节点跟踪器和至少一个人体标记点跟踪器，所述人体关节点跟踪器用于对所述人体关节点检测器检测的2D关节特征点集进行跟踪，得到人体不同时刻的2D关节特征点集信息，所述人体标记点跟踪器用于对所述人体标记点检测器检测的2D标记特征点集进行跟踪，得到人体不同时刻各关节的2D标记特征点集信息；人体动作姿态计算器，用于对所述人体目标检测器检测的人体进行动作姿态解算，得到人体各关节的空间姿态角和3D坐标；人体定位计算器，其包括至少一个人体标记点定位器和至少一个人体关节点位置优化器以及至少一个人体关节点定位器，所述人体标记点定位器用于计算人体所有标记特征点在第一坐标系下的3D坐标，所述人体关节点位置优化器用于对所述人体动作姿态计算器计算得到的人体关节点的空间位姿进行优化，所述人体关节点定位器计算人体各关节在所述第一坐标系下的3D坐标；自定位计算器，用于所述动作捕捉装置自身的定位计算，即计算所述动作捕捉装置在第二坐标系下的3D坐标以及姿态角；人体定位转换器，用于将人体空间位姿从所述第一坐标系下转换到所述第二坐标系中。进一步，所述动作捕捉装置是一种便携装置，便于安装和拆卸。进一步，还包括一种用于交换数据的无线通信装置。进一步，所述动作捕捉装置包括至少一种光源，用于照亮场景、环境或者动作捕捉目标。进一步，所述动作捕捉装置包括至少一个电子芯片处理器，所述电子芯片处理器执行如下功能的全部或者一个子集：人体目标检测器，人体目标跟踪器，人体动作姿态计算器，人体定位计算器，自定位计算器，人体定位转换器。进一步，所述动作捕捉装置包括至少一种惯性传感器，可提供位姿信息，用于辅助所述动作捕捉装置进行自定位。进一步，所述动作捕捉装置包括至少一种深度图像传感器，可提供位姿信息，用于辅助所述动作捕捉装置进行自定位。本发明还提出一种动作捕捉方法。其包含如下步骤：1)通过动作捕捉装置获得至少两个图像采集传感器采集的图像序列；2)通过人体目标检测器，对所述图像采集传感器获取的每帧图像进行人体检测及人体标记点检测，得到图像上人体的区域分割、2D关节特征点集和2D标记特征点集；3)通过人体目标跟踪器，分别对所述人体目标检测得到的2D关节特征点集和2D标记特征点集进行跟踪，得到在不同视角所有时刻同一人体的2D关节特征点集和不同视角所有时刻同一人体关节部位的2D标记特征点集；4)通过人体动作姿态解算器，利用单帧图像对人体3D模型和动作姿态进行回归计算，得到第一坐标系下人体模型和各关节的空间姿态角；5)通过自定位计算器，利用所述采集图像传感器在空间不同视角下采集的多帧图像进行空间自定位计算，获取所述动作捕捉装置在第二坐标系中的位姿，包括3D坐标以及姿态角；6)通过人体定位计算器，对检测到的人物进行空间定位计算，获取人体各关节和人体表面特征点在所述第一坐标系下的3D坐标；7)通过人体定位转换器，利用所述动作捕捉装置在所述第二坐标系中的位姿将人体空间位姿从所述第一坐标系下转换到第二坐标系中。进一步，所述图像中人体上相对固定布置一种或几种空间几何形状和尺寸已知的标记点或标记图案，用于求取或辅助求取人体各关节在所述第一坐标系下的3D坐标。进一步，所述人体定位器采用立体视觉原理通过同一时刻两个以上图像采集传感器对人体表面标记点进行三维重建，得到标记点的空间位置。进一步，所述人体定位计算，利用所述人体标记点定位器得到的标记点定位结果和所述人体关节点位置优化器得到的人体3D模型和各关节的空间姿态，即可获取人体各关节在所述第一坐标系下的3D坐标。进一步，所述人体关节点位置优化器，利用所述至少两个图像采集传感器采集的不同视角的人体关节点跟踪结果和自定位计算结果，得到优化后的人体各关节点在所述第一坐标系下的空间姿态和3D位置。进一步，所述人体关节点位置优化器，利用所述人体标记点定位器得到的标记点定位结果，获取人体各关节在所述第一坐标系下的3D坐标。进一步，所述人体目标跟踪，对所述人体目标检测得到的2D关节特征点集和2D标记特征点集进行不同视角的跟踪，得到不同视角下同一时刻的同名标识点。进一步，包括提取图像上场景中的自然纹理特征2D点集，采用SFM原理进行所述自定位计算。进一步，所述图像上场景中固定布置一种或几种标记点或标记图案，提供特征信息用于所述自定位计算。进一步，利用所述人体目标检测得到的人体区域分割结果，滤除人体区域内的2D特征干扰，提供背景有效特征信息用于所述自定位计算。进一步，采用所述动作捕捉装置中的一种或多种惯性传感器，提供位姿信息，实现自定位计算。进一步，采用所述动作捕捉装置上的一种或多种深度图像传感器，通过3D特征配准至所述第二坐标系，实现自定位计算。本发明的有益效果，本发明使用两个光学相机即可准确实现在地面坐标系中人体的定位和动作姿态解算，在室内和室外拍摄场景受限的情况下也能保证动作捕捉结果的精度，极大提升了动作捕捉技术的实用性、便捷性、准确性、稳定性和适用性。附图说明图1为本发明动作捕捉系统框图。具体实施方式下面结合附图，对本发明进一步详细说明。参考图1，本发明动作捕捉系统框图，所述动作捕捉系统以10表示。此系统包含一个动作捕捉装置12，包含两个图像采集传感器设备13和14。图像采集传感器13和14同步采集和传送待测场景的图像集15和16到人体目标检测器20中。两个图像集15和16分别具有自己的投影中心，并且大部分时刻有共同的观测人物目标。包含在图像中的相关信息由在人物表面反射的图像采集传感器投影图像和关节位置特征以及关节标记特征产生，所述关节位置特征和关节标记特征用于计算图像采集传感器设备间的相对位置和人体关节的空间位置。因为在给定帧中的所有图像是被同时捕获的并且包括关节位置特征、关节标记特征，所以关节位置特征、关节标记特征的同步是固有的。关节标记特征固定在人体关节上，从而所述关节标记特征在该人体上保持静止不动的同时该人物可以在关于物体坐标系的空间内移动。这使得人物可以在其表面被图像采集传感器设备扫描的同时在空间内移动。人体目标检测器20包含一个人体关节点检测器21和一个人体标记点检测器22，从每一帧图像中提取人体关节位置特征和关节标记特征点。对每一帧图像，均输出2D关节特征点集23和2D关节标记点集24。这些点和特征在图像中基于他们的内在特性被标识。人体关节位置特征是人体各关节连接处的像素表达，是人体关节姿态的物理特征在图像空间的描述，可以使用2D人体姿态估计方法:172-186.)在图像中检测人体关节特征点的2D位置。人体关节标记特征是固定在人体关节部位附近的已知固定尺寸的标记图案，是动作捕捉技术中用来标记关节位置和姿态的辅助信息，可以使用基于图像几何特征和灰度特征的目标检测和边缘提取的方法获取图像中人体关节标记特征点的2D位置。人体目标跟踪器30包含一个人体关节点跟踪器31和一个人体标记点跟踪器32，分别对2D关节特征点集23和2D关节标记点集24进行跟踪得到不同视角和不同时刻同一人体的2D关节特征信息集33和2D关节标记信息集34。根据人体动作时序的连续性和空间的唯一性，对2D关节特征点集23中每一时刻的2D点进行时域和空域跟踪，时域跟踪可以使用最近邻方法，空域跟踪可以基于对极约束原理，确定同一人体在不同视角和所有时刻的所有2D关节特征信息集33。2D关节标记点集与2D关节特征点集位置高度相关，由2D关节特征信息集33和对极约束原理，可以使用距离评价准则或者点和平面的相对关系以及预置的标记点排布规则确定每一2D关节标记点的人体关节和关节内跟踪结果34。人体动作姿态计算器40根据2D关节特征信息集33得到每一帧图像的人体区域，对图像中的人体区域部分和2D关节特征信息集33通过端到端的神经网络进行回归计算得到人体3D模型结果41，即人体各关节的空间姿态角、体型和人体3D模型。人体定位计算器50包含一个人体标记点定位器51、一个人体关节点位置优化器52和一个人体关节点定位器53。人体标记点定位器51采用双目重建原理，根据自定位计算器60得到的结果61计算得到2D关节标记点信息集34中每一2D点在动作装置坐标系下的3D关节标记点结果54。人体关节点位置优化器52根据自定位计算器60得到的动作捕捉装置内图像采集传感器参数结果61采用立体视觉三角测量原理和对极约束原理，对人体动作姿态计算器得到的人体3D模型结果41进行多视角优化，得到准确的人体3D模型结果55和人体3D模型)，优化目标函数为E＝EJ+λθEθ+λαEα+λβEβ，对于各关节部分优化目标函数选取合适的权重。人体关节点定位器53根据人体3D关节标记点结果54对人体3D模型结果55进行人体位置和尺度优化并变换为动作捕捉装置坐标系下的各关节3D坐标56，也可以直接对人体3D关节标记点结果54进行关节位置标定得到以在动作捕捉装置坐标系下的3D关节标记点表示的人体各关节3D坐标57。自定位计算器60根据所述图像采集传感器获取的图像背景中相对地面固定的自然纹理特征点或人工标记点得到动作捕捉装置内图像采集传感器间的位姿关系61和动作捕捉装置在地面坐标系中的位姿62。根据标定板双目标定方法计算动作捕捉装置中图像采集传感器间的位姿关系61。根据人体目标检测器20得到的人体区域分割结果，滤除人体区域部分的2D标记特征干扰，提取背景中相对地面固定的自然纹理特征，用以计算动作捕捉装置在地面坐标系下的位姿。具体原理为：通过SIFT等特征提取算法提取图像中非人体区域的图像特征，用kdtree模型计算单帧图像对的匹配特征点，对每一单帧图像对计算对极几何估计F矩阵并通过随机采样一致性算法优化改善匹配对，这样背景中相对地面固定的自然纹理特征可以在匹配对中链式传递下去。然后根据Bundle Adjustment方法计算动作捕捉装置在地面坐标系下的位姿。BA计算分为三个过程：纯动作BA，通过最小化背景自然纹理特征点xi和匹配的地面坐标系下的3D点Xi的重投影误差优化动作捕捉装置中图像采集传感器的旋转矩阵R和位置t；局部BA：根据局部关键帧KL和图像对可共见的背景自然纹理特征点PL优化局部视野范围内动作捕捉装置中图像采集传感器的旋转矩阵R和位置t；全局BA，根据所有图像对的背景自然纹理特征点优化动作捕捉装置中图像采集传感器的旋转矩阵R和位置t，最终得到动作捕捉装置在地面坐标系下的位姿62。人体定位转换器70，通过3D坐标系转换将动作捕捉装置坐标系下的人体各关节3D结果56和57转换为地面坐标系下的各关节3D结果71和72。根据框图所示，通过不同的数字信号连接而彼此通信的离散部件组，对于本领域普通技术人员来说容易理解。由于一些部件是通过给定的硬件或软件系统的函数或操作而执行功能的，并且所示的许多数据通信通道通过在计算机操作系统或应用程序中的数据通信系统而执行功能，所以优选实施例是由硬件和软件部件的组合而构成的。因此，提供所示的结构以便有效地说明本优选实施例。本领域普通技术人员可以理解标记特征点，这些标记特征点被放置在人体表面上以供扫描，也可以通过其他方式提供由传感器设备检测的目标。可以理解对于本领域的技术人员来说在本系统基础上可能存在多种的改进类型。因而，上述描述和相关的附图只是本发明的示意而不局限于此。也可以理解本发明覆盖任何基于本发明的改进，使用和调整。通常来说，本发明的原理以及基于本申请所公开的实施例和公知的或惯用技术的其他改进系统或者可以应用前述系统的本质特征的其他系统都受到所附权利要求书的保护。
