标题title
一种基于非同步多相机的扑翼飞行器巡航控制系统
摘要abst
本发明公开了一种基于非同步多相机的扑翼飞行器巡航控制系统，包括非同步多目视觉模块、控制模块和扑翼飞行器；所述扑翼飞行器上固定多个反光球，所述非同步多目视觉模块包括多个红外相机，通过捕获多个所述反光球的图像解算出所述扑翼飞行器的位置和姿态信息；所述控制模块包括上位机，根据得到的所述扑翼飞行器的位置和姿态信息以及设计的巡航控制方法，对所述扑翼飞行器下发控制指令。本发明解决了多相机的非同步问题，降低了立体视觉系统的搭建条件，实现了扑翼飞行器的闭环控制，适用范围广。
权利要求书clms
1.一种基于非同步多相机的扑翼飞行器巡航控制系统，其特征在于，包括非同步多目视觉模块、控制模块和扑翼飞行器；所述扑翼飞行器上固定多个反光球，所述反光球为红外反光标记球，所述扑翼飞行器通过手动控制模式起飞；所述非同步多目视觉模块包括多个红外相机，所述红外相机周围有一圈红外光源，所述反光球通过反射红外光使所述红外相机捕获其图像，所述非同步多目视觉模块根据捕获的多个所述反光球的图像解算出所述扑翼飞行器的位置和姿态信息；所述控制模块包括上位机，用于将控制模式切换为巡航模式，根据得到的所述扑翼飞行器的位置和姿态信息以及设计的巡航控制方法，对所述扑翼飞行器下发控制指令。2.根据权利要求1所述的基于非同步多相机的扑翼飞行器巡航控制系统，其特征在于，所述非同步多目视觉模块包括多个红外相机、固定在所述扑翼飞行器上的多个反光球、路由器和立体视觉平台；所述扑翼飞行器包括飞控板、舵机、电机和无线串口模块A；所述控制模块包括上位机和无线串口模块B；其中，所述红外相机与所述路由器采用TCP/IP协议通过无线方式进行通信，所述路由器与所述立体视觉平台采用TCP/IP协议通过无线方式进行通信，所述立体视觉平台与所述上位机通信，所述立体视觉平台连接显示界面，所述上位机与所述飞控板通过所述无线串口模块A和所述无线串口模块B通信，所述舵机和所述电机连接所述飞控板。3.根据权利要求1所述的基于非同步多相机的扑翼飞行器巡航控制系统，其特征在于，所述反光球的个数不少于4个。4.根据权利要求2所述的基于非同步多相机的扑翼飞行器巡航控制系统，其特征在于，所述非同步多目视觉模块中的红外相机内嵌Linux内核，能够记录每次捕获的图像对应的时间戳，并将每一帧的图像和时间戳打包发送到所述立体视觉平台；所述红外相机还用于对图像进行预处理，根据提取算法得到图像中各反光球的像素坐标，并将各反光球的像素坐标传输到所述立体视觉平台；所述立体视觉平台用于向不同的红外相机下发时钟信息，进行时钟的同步。5.根据权利要求4所述的基于非同步多相机的扑翼飞行器巡航控制系统，其特征在于，所述立体视觉平台还用于：以频率较低的第一红外相机为基准，通过时间戳在第二红外相机中寻找与其最接近的两帧图像，这里对两帧图像之间反光球的运动进行近似处理，在红外相机频率大于预设频率时，将其视为匀速直线运动，通过这两帧图像信息进行插值：其中，是第一红外相机中某一帧对应的时间戳，通过在第二红外相机捕捉的图像中寻找时间戳满足的相邻两帧图像，和分别对应第二红外相机的第N帧和第N+1帧图像信息和；图像信息是指各反光球在各红外相机中的像素坐标，通过上式进行插值拟合出一个和第一红外相机中时刻图像信息时间对应的第二红外相机反光球信息。6.根据权利要求5所述的基于非同步多相机的扑翼飞行器巡航控制系统，其特征在于，在进行插值之前，所述立体视觉平台还用于：计算第一红外相机中时刻对应的图像帧中反光球的个数，若反光球个数不等于设置的数目，则忽略此帧图像信息，进行下一帧图像的同步处理；反之，进行下一步操作；根据时间戳在第二红外相机的图像序列中寻找最接近的相邻两帧图像，同样判断这两帧图像中反光球的个数是否等于设置的数目，若两帧图像中反光球的个数都等于设置的数目，则进行插值拟合。7.根据权利要求5所述的基于非同步多相机的扑翼飞行器巡航控制系统，其特征在于，所述立体视觉平台还用于：当处理完基准红外相机的某一帧图像后，将获取的拟合匹配图像帧进行标志点三维重建，得到各个标志点的位置信息，再对各个标志点进行刚体位姿估计，从而得到扑翼飞行器的位置和姿态信息。8.根据权利要求1所述的基于非同步多相机的扑翼飞行器巡航控制系统，其特征在于，所述控制模块将控制模式切换为巡航模式，具体包括：设置巡航轨迹圆的圆心和半径；计算判断红外相机的公共视场是否满足设置的轨迹的需求，满足则进行下一步，否则重新设置巡航轨迹圆的圆心和半径；设置成功后，切断手动控制模式，由上位机对扑翼飞行器进行控制。9.根据权利要求2所述的基于非同步多相机的扑翼飞行器巡航控制系统，其特征在于，所述飞控板用于对上位机传输过来的控制指令进行解析，并输出PWM值来控制电机转速和舵机角度；其中，电机转速用于控制扑翼飞行器的扑动频率，进而调整飞行高度；舵机角度用于控制扑翼飞行器的尾翼角度，从而控制扑翼飞行器的转向。10.根据权利要求9所述的基于非同步多相机的扑翼飞行器巡航控制系统，其特征在于，所述控制模块采用两个控制环对扑翼飞行器进行巡航飞行控制，两个控制环分别为高度环和位置环；所述高度环通过PID控制器调节扑翼飞行器的扑动频率，所述位置环通过外环L1制导律解算出需要的加速度大小，再通过内环PID控制器控制扑翼飞行器的尾翼相位差。
说明书desc
技术领域本发明涉及机器视觉和扑翼飞行器控制技术领域，特别涉及一种基于非同步多相机的扑翼飞行器巡航控制系统。背景技术近年来，立体视觉已被广泛应用于机器人定位、三维测量及场景建模等领域。当前大部分研究集中于同步双目/多目相机系统，但是这些方法不能直接用于非同步双目/多目相机进行三维重建。非同步产生的原因主要有两种：一是相机帧率不同造成的非同步拍摄问题；二是在传输和接收相机数据时的时延问题，无法保证每一帧的时间对应关系。解决非同步问题可以拓宽立体视觉的使用范围，将有线数据传输方式改成无线数据传输方式，简化立体视觉系统。并且，不同频率的相机也可以用于立体视觉系统的构建，降低系统对硬件的属性要求。此外，扑翼飞行器作为当前的研究热点，其通过模仿自然界中鸟类或昆虫的飞行方式进行飞行，具有良好的隐蔽性，在军事领域应用前景广阔。此外，扑翼飞行器低功耗特点也使其在民用领域有一定的发展前景。目前，扑翼飞行器的控制方法主要还是人为遥控，这种方式需要操控者高度专注。因此，为了在室内方便快捷地开展扑翼飞行器控制算法的实验验证，设计一种基于非同步多相机的扑翼飞行器巡航控制系统是非常有意义的。发明内容本发明的目的在于提供一种基于非同步多相机的扑翼飞行器巡航控制系统，解决多相机的非同步问题，降低立体视觉系统的搭建条件，实现扑翼飞行器的闭环控制，控制扑翼飞行器完成巡航任务。为解决上述技术问题，本发明的实施例提供如下方案：一种基于非同步多相机的扑翼飞行器巡航控制系统，包括非同步多目视觉模块、控制模块和扑翼飞行器；所述扑翼飞行器上固定多个反光球，所述反光球为红外反光标记球，所述扑翼飞行器通过手动控制模式起飞；所述非同步多目视觉模块包括多个红外相机，所述红外相机周围有一圈红外光源，所述反光球通过反射红外光使所述红外相机捕获其图像，所述非同步多目视觉模块根据捕获的多个所述反光球的图像解算出所述扑翼飞行器的位置和姿态信息；所述控制模块包括上位机，用于将控制模式切换为巡航模式，根据得到的所述扑翼飞行器的位置和姿态信息以及设计的巡航控制方法，对所述扑翼飞行器下发控制指令。优选地，所述非同步多目视觉模块包括多个红外相机、固定在所述扑翼飞行器上的多个反光球、路由器和立体视觉平台；所述扑翼飞行器包括飞控板、舵机、电机和无线串口模块A；所述控制模块包括上位机和无线串口模块B；其中，所述红外相机与所述路由器采用TCP/IP协议通过无线方式进行通信，所述路由器与所述立体视觉平台采用TCP/IP协议通过无线方式进行通信，所述立体视觉平台与所述上位机通信，所述立体视觉平台连接显示界面，所述上位机与所述飞控板通过所述无线串口模块A和所述无线串口模块B通信，所述舵机和所述电机连接所述飞控板。优选地，所述反光球的个数不少于4个。优选地，所述非同步多目视觉模块中的红外相机内嵌Linux内核，能够记录每次捕获的图像对应的时间戳，并将每一帧的图像和时间戳打包发送到所述立体视觉平台；所述红外相机还用于对图像进行预处理，根据提取算法得到图像中各反光球的像素坐标，并将各反光球的像素坐标传输到所述立体视觉平台；所述立体视觉平台用于向不同的红外相机下发时钟信息，进行时钟的同步。优选地，所述立体视觉平台还用于：以频率较低的第一红外相机为基准，通过时间戳在第二红外相机中寻找与其最接近的两帧图像，这里对两帧图像之间反光球的运动进行近似处理，在红外相机频率大于预设频率时，将其视为匀速直线运动，通过这两帧图像信息进行插值：其中，是第一红外相机中某一帧对应的时间戳，通过在第二红外相机捕捉的图像中寻找时间戳满足的相邻两帧图像，和分别对应第二红外相机的第N帧和第N+1帧图像信息和；图像信息是指各反光球在各红外相机中的像素坐标，通过上式进行插值拟合出一个和第一红外相机中时刻图像信息时间对应的第二红外相机反光球信息。优选地，在进行插值之前，所述立体视觉平台还用于：计算第一红外相机中时刻对应的图像帧中反光球的个数，若反光球个数不等于设置的数目，则忽略此帧图像信息，进行下一帧图像的同步处理；反之，进行下一步操作；根据时间戳在第二红外相机的图像序列中寻找最接近的相邻两帧图像，同样判断这两帧图像中反光球的个数是否等于设置的数目，若两帧图像中反光球的个数都等于设置的数目，则进行插值拟合。优选地，所述立体视觉平台还用于：当处理完基准红外相机的某一帧图像后，将获取的拟合匹配图像帧进行标志点三维重建，得到各个标志点的位置信息，再对各个标志点进行刚体位姿估计，从而得到扑翼飞行器的位置和姿态信息。优选地，所述控制模块将控制模式切换为巡航模式，具体包括：设置巡航轨迹圆的圆心和半径；计算判断红外相机的公共视场是否满足设置的轨迹的需求，满足则进行下一步，否则重新设置巡航轨迹圆的圆心和半径；设置成功后，切断手动控制模式，由上位机对扑翼飞行器进行控制。优选地，所述飞控板用于对上位机传输过来的控制指令进行解析，并输出PWM值来控制电机转速和舵机角度；其中，电机转速用于控制扑翼飞行器的扑动频率，进而调整飞行高度；舵机角度用于控制扑翼飞行器的尾翼角度，从而控制扑翼飞行器的转向。优选地，所述控制模块采用两个控制环对扑翼飞行器进行巡航飞行控制，两个控制环分别为高度环和位置环；所述高度环通过PID控制器调节扑翼飞行器的扑动频率，所述位置环通过外环L1制导律解算出需要的加速度大小，再通过内环PID控制器控制扑翼飞行器的尾翼相位差。本发明实施例提供的技术方案带来的有益效果至少包括：本发明提供的基于非同步多相机的扑翼飞行器巡航控制系统解决了多相机的非同步问题，降低了立体视觉系统的搭建条件，既适用于相机与上位机的无线通信方案又适用于有线通信方案。并且，本发明中的非同步多目视觉模块对相机的帧率不做要求，适用于不同帧率的相机。本发明提供了一种扑翼飞行器自主巡航控制方案，即通过在扑翼飞行器上放置红外反光标记球，非同步多目视觉模块通过立体几何原理重建出各个反光球的空间位置；再通过刚体的位姿估计算法解算出扑翼飞行器的飞行姿态，并用界面显示出扑翼飞行器飞行位姿；同时将位姿信息输入到上位机控制模块，根据设定的巡航控制方法，计算得到所需的扑翼飞行器电机和舵机的控制量；最终通过无线串口将控制信号发送给扑翼飞行器，扑翼飞行器根据控制信号完成相应电机和舵机的调节，实现高度和位置的调整，从而进行扑翼飞行器的闭环控制，实现扑翼飞行器的巡航任务。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明实施例提供的基于非同步多相机的扑翼飞行器巡航控制系统的结构示意图；图2是本发明实施例提供的扑翼飞行器巡航控制系统的实物示意图；图3是本发明实施例提供的非同步双目立体视觉算法流程图；图4是本发明实施例提供的非同步多目立体视觉算法流程图；图5是本发明实施例提供的扑翼飞行器巡航高度环控制算法流程图；图6是本发明实施例提供的扑翼飞行器巡航位置环控制算法流程图。具体实施方式为使本发明的目的、技术方案和优点更加清楚，下面将结合附图对本发明实施方式作进一步地详细描述。本发明的实施例提供了一种基于非同步多相机的扑翼飞行器巡航控制系统，如图1所示，所述扑翼飞行器巡航控制系统包括非同步多目视觉模块、控制模块和扑翼飞行器；其中，扑翼飞行器上固定多个反光球，这里的反光球是指红外反光标记球，扑翼飞行器通过手动控制模式起飞；非同步多目视觉模块包括多个红外相机，红外相机周围有一圈红外光源，反光球通过反射红外光使红外相机捕获其图像，非同步多目视觉模块根据捕获的多个反光球的图像解算出扑翼飞行器的位置和姿态信息；控制模块包括上位机，用于将控制模式切换为巡航模式，根据得到的扑翼飞行器的位置和姿态信息以及设计的巡航控制方法，对扑翼飞行器下发控制指令。具体地，非同步多目视觉模块包括多个红外相机、固定在扑翼飞行器上的多个反光球、路由器和立体视觉平台；扑翼飞行器包括飞控板、舵机、电机和无线串口模块A；控制模块包括上位机和无线串口模块B；其中，红外相机与路由器采用TCP/IP协议通过无线方式进行通信，路由器与立体视觉平台采用TCP/IP协议通过无线方式进行通信，立体视觉平台与上位机通过有线或无线方式通信，立体视觉平台连接显示界面，上位机与飞控板通过无线串口模块A和无线串口模块B通信，舵机和电机连接飞控板。所述系统的应用过程如下：S1：在扑翼飞行器上固定多个反光球；S2：采用手动控制模式人为操控扑翼飞行器起飞；S3：通过非同步多目视觉模块获取扑翼飞行器的位置和姿态信息；S4：利用上位机切换为巡航模式，切断手动遥控器信号，上位机通过非同步多目视觉模块得到扑翼飞行器的位置和姿态信息，根据设计的巡航控制方法，对扑翼机下发控制指令；S5：扑翼飞行器接收控制指令并执行，若不切换控制模式，扑翼飞行器将一直进行自主巡航飞行，当切换为手动控制模式后，扑翼飞行器便可人为操控。图2是本发明实施例提供的基于非同步多相机的扑翼飞行器巡航控制系统实物示意图。本发明的被控主体特指扑翼飞行器，针对扑翼飞行器特殊的飞行模式进行设计，本发明中的扑翼飞行器由一个电机提供飞行升力，两个舵机分别控制左右两个尾翼的摆动产生相位差，从而实现扑翼飞行器的转向。其中扑翼飞行器部分采用以飞控板为核心的飞行控制系统表示。为了简化扑翼飞行器部分，飞控板上仅搭载无线通信模块用于接收控制指令。本实施例中的飞控板使用STM32芯片作为处理单元，无线通信模块、电机和舵机由飞控板控制。无线通信模块接收从上位机无线通信模块传输过来的控制指令，飞控板负责解析控制指令，并将其转换成电机和舵机的PWM控制信号，控制扑翼飞行器电机和舵机的转动，通过不停接收上位机传输的控制指令并执行，实现闭环控制。控制模块的功能主要是通过上位机来切换扑翼飞行器的控制方式，当扑翼飞行器处于红外相机的公共视场内时，通过选择巡航模式，正确设置轨迹圆圆心和半径，扑翼飞行器进行自主控制。当任务执行完毕时，由上位机切换为手动控制模式，扑翼飞行器恢复人为操控模式。具体地，所述控制模块的切换流程包括：设置巡航轨迹圆的圆心和半径；计算判断红外相机的公共视场是否满足设置的轨迹的需求，满足则进行下一步，否则重新设置巡航轨迹圆的圆心和半径；设置成功后，切断手动控制模式，由上位机对扑翼飞行器进行控制。当红外相机的帧率不同时，非同步多目视觉模块接收到红外相机捕获的图像信息时，无法保证接收到的不同红外相机的图像是同一时刻的，当红外相机的帧率相差较大时，通过立体视觉方法解算反光球的位置会产生较大误差，这对扑翼飞行器控制的准确性会造成极大的影响；其次，如果不使用同步触发器来触发红外相机，同样会造成非同步多目视觉模块接收到各红外相机的图像不是同一时刻捕获的；最后，红外相机也可能存在某一次触发未启动图像的捕获，造成某一帧图像的缺失。为了解决以上问题，本发明设计了非同步多目视觉模块，在各个红外相机捕获每一帧图像同时，记录这一时刻的时间。具体地，本发明所述非同步多目视觉模块使用的红外相机内嵌了Linux内核，可以通过系统记录每次捕获的图像对应的时间戳，并将每一帧的图像信息和时间戳发送到立体视觉平台。另外，红外相机也能对图像进行预处理，可以直接根据相应的提取算法得到图像中各反光球的像素坐标，并直接将各反光球的像素坐标传输到立体视觉平台，减少传输数据量，提高传输的效率。所使用的传输协议为TCP/IP协议，其能够保证所有的信息完整无误的发送到立体视觉平台。图3是本发明实施例提供的非同步双目立体视觉算法流程图，针对双目相机进行非同步问题的处理。由于每个红外相机的时钟可能有所误差，首先需要立体视觉平台向不同红外相机下发时钟信息，进行时钟的同步。当各个红外相机时钟同步后，开始捕获图像信息并和时间戳打包发送到立体视觉平台。立体视觉平台以频率较低的第一红外相机为基准，通过时间戳在第二红外相机中寻找与其最接近的两帧图像，这里对两帧图像之间反光球的运动进行近似处理，在红外相机频率大于预设频率时，将其视为匀速直线运动，通过这两帧图像信息进行插值：其中，是第一红外相机中某一帧对应的时间戳，通过在第二红外相机捕捉的图像中寻找时间戳满足的相邻两帧图像，和分别对应第二红外相机的第N帧和第N+1帧图像信息和；图像信息是指各反光球在各红外相机中的像素坐标，通过上式进行插值拟合出一个和第一红外相机中时刻图像信息时间对应的第二红外相机反光球信息。在实际中，存在红外反光球超出某个红外相机的视场的情况，红外相机会丢失反光球的信息，故对于上述插值方法需要进一步改进。优选地，本发明在扑翼飞行器上安放的反光球个数不少于4个，这里取n等于4。首先，计算第一红外相机中时刻对应的图像帧中反光球的个数，若反光球个数不等于4，直接忽略此帧图像信息，进行下一帧图像的同步处理。反之，进行下一步操作。根据时间戳在第二红外相机的图像序列中寻找最接近的相邻两帧图像，同样判断这两帧图像中反光球的个数是否等于4，若两帧图像中反光球的个数都等于4，则对其按照上述方法进行插值拟合。需要说明的是，在进行插值前，需要对符合条件的图像帧的像点坐标进行预处理。对图像帧的像点进行排序，也就是和实际点进行匹配。通过设计反光球的摆放位置，根据匹配方法区分四个反光球在图像帧中对应的像素坐标，并将其进行顺序排列，以便于插值的计算。若第二红外相机中时间最接近的相邻两帧图像只有一帧图像中反光球的个数等于4，则将此帧作为和第一红外相机中时刻图像对应的同步图像；若两帧都不满足反光球个数为4，忽略第一红外相机此帧图像信息，进行下一帧处理。当处理完基准红外相机的某一帧图像后，将获取的拟合匹配图像帧进行标志点三维重建，得到各个标志点的位置信息，再对各个标志点进行刚体位姿估计，得到扑翼飞行器的位置和姿态信息。由于扑翼飞行器的飞行半径较大，两个红外相机的视场无法满足其进行巡航飞行，故需要增加红外相机的个数，所有红外相机组成的公共视场大小需要满足扑翼飞行器的飞行区域，特别的，公共视场指的是至少两个红外相机能够捕捉到的区域。图4是本发明实施例提供的非同步多目立体视觉算法流程图，针对多相机的非同步问题进行处理。参考两相机的同步方案，由于每个红外相机的时钟可能有所误差，立体视觉平台向不同红外相机下发时钟信息，进行时钟的同步。当各个红外相机时钟同步后，开始捕获图像信息并和时间戳打包发送到立体视觉平台。对于获取的图像帧处理，首先确定所有红外相机中频率最低的红外相机，以此红外相机捕捉的图像帧作为基准。同样，按时间序列选取基准红外相机的图像帧，在多相机时不要求基准红外相机的图像帧中像点的个数满足4，直接在所有红外相机的图像序列中寻找时间最接近的两帧图像，类比两相机的处理方式，从其余红外相机中得到拟合或者近似的匹配图像帧，只要能够在至少两个红外相机中拟合出对应时间戳的图像匹配帧，就可以根据立体视觉原理进行标志点的三维重建，当更多红外相机中拟合出对应时间戳的图像匹配帧时，就可以提高重建的精度。另外，当在所有红外相机中都无法得到至少两个匹配帧时，则进行基准红外相机图像序列下一帧的非同步图像处理。此时基准红外相机的作用就是提供用于参考的时间戳。当处理完基准红外相机的某一帧图像后，将获取的拟合匹配图像帧进行标志点三维重建，得到各个标志点的位置信息，再对各个标志点进行刚体位姿估计，得到扑翼飞行器的位置和姿态信息。进一步地，扑翼飞行器的飞控板用于对上位机传输过来的控制指令进行解析，并输出PWM值来控制电机转速和舵机角度；其中，电机转速用于控制扑翼飞行器的扑动频率，进而调整飞行高度；舵机角度用于控制扑翼飞行器的尾翼角度，从而控制扑翼飞行器的转向。其中，控制模块采用两个控制环对扑翼飞行器进行巡航飞行控制，两个控制环分别为高度环和位置环；高度环通过PID控制器调节扑翼飞行器的扑动频率，位置环通过外环L1制导律解算出需要的加速度大小，再通过内环PID控制器控制扑翼飞行器的尾翼相位差。具体地，图5为扑翼飞行器巡航飞行的高度控制环示意图。当扑翼飞行器进入巡航飞行模式后，控制器由两个控制环组成。首先是对于扑翼飞行器高度的控制，通过非同步多目视觉模块实时获取扑翼飞行器的高度信息，然后与预期高度做差得到误差值，采用PID控制方法，计算出当前需要的油门量，通过转换关系得到电机PWM输出值，上位机通过无线串口模块将控制信号发送到扑翼飞行器上，通过电机PWM控制电机的转速，进而控制扑翼飞行器的扑动频率，从而对飞行器的高度进行调整，使其维持在预设高度附近。高度控制环PID控制器输出量为：其中为高度误差，，，分别为比例系数、积分系数和微分参数。油门量的输出为：其中，为当前计算得到的油门量，为上一时刻的油门量。当对扑翼飞行器的高度进行控制后，如图6所示，需要进一步设计位置控制环。特别的，此控制环是将飞行器的位姿信息投影在预设圆轨迹的高度平面上，而后进行相应的控制，相当于在平面上控制扑翼飞行器进行绕圆飞行。同样通过非同步多目视觉模块获得扑翼飞行器的位置信息。通过相邻两次立体重建的结果得到某时刻近似的速度。同理，也可以得到加速度。将位置和速度投影到预设的飞行轨迹平面，使用L1制导律得到需设置的加速度，加速度的调节由扑翼飞行器尾翼的相位差进行控制，将加速度转换成两个尾翼的相位差，进而得到两个尾翼对应舵机的PWM值。本发明实施例中的扑翼飞行器两个尾翼初始位置呈倾斜摆放，主要用于控制飞行器的转向，将加速度与舵机的相位差的关系通过内环PID控制器进行控制。上位机同样通过无线串口模块将两个舵机的PWM值发送给扑翼飞行器，调整其向心加速度，使飞行器在跟踪平面上跟踪圆轨迹。其中根据L1制导律得到的加速度为：其中，为速度，为实际位置和期望位置的距离，为设定轨迹的半径。，其中，和为L1制导律中需要调节的两个参数，分别代表周期和阻尼比。位置控制环PID控制器输出量为：其中为加速度误差，，，分别为比例系数、积分系数和微分参数。尾翼的相位差的输出为：其中，为当前计算得到的尾翼的相位差，为上一时刻的相位差。通过平均分配相位差到两个舵机上，再转换成对应的PWM值，从而控制扑翼飞行器的转向。上述实施方式中，通过高度环和位置环的控制，即可完成扑翼飞行器巡航的飞行模式。综上所述，本发明实施例中，首先利用时间戳匹配拟合图像点的方法解决多相机的非同步问题，捕捉红外反光球像素坐标后通过立体视觉原理得到扑翼飞行器的位置和姿态信息；再根据控制模块设计的高度环和位置环计算出扑翼飞行器电机和舵机需要的控制量，最后通过无线串口模块将控制信号发送至扑翼飞行器实现巡航飞行。以上所述仅为本发明的较佳实施例，并不用以限制本发明，凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
