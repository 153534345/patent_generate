标题title
一种光学遥感卫星影像云检测方法
摘要abst
本申请公开了一种光学遥感卫星影像云检测方法，该方法包括：将采集的原始光学遥感卫星影像依次进行辐射校正、传感器校正、抽稀采样、几何校正以及灰度拉伸得到校正后的影像，确定原始光学遥感卫星影像所处的时相以及确定其所对应的亮度阈值、色调阈值和深度学习模型；根据亮度阈值和色调阈值从校正后的影像中确定出初始云区，根据深度学习模型对初始云区进行精细化处理得到精细云区；根据预设图形图像学方法对精细云区进行优化处理得到优化后云区，根据优化后云区生成云掩模二值图、云掩模矢量文件和云检测报告。本申请解决了现有技术中云判精度较低以及极端错误率较高的技术问题。
权利要求书clms
1.一种光学遥感卫星影像云检测方法，其特征在于，包括：采集原始光学遥感卫星影像，将所述原始光学遥感卫星影像依次进行辐射校正、传感器校正、10:1抽稀采样、几何校正以及灰度拉伸得到校正后的影像，其中，所述校正后的影像为带地理坐标的jpg缩略影像；确定所述原始光学遥感卫星影像所处的时相，根据所述时相确定其所对应的亮度阈值、色调阈值和深度学习模型；根据所述亮度阈值和所述色调阈值从所校正后的影像中确定出初始云区，根据所述深度学习模型对所述初始云区进行精细化处理得到精细云区；根据预设图形图像学方法对所述精细云区进行优化处理得到优化后云区，根据所述优化后云区生成云掩模二值图、云掩模矢量文件和云检测报告。2.如权利要求1所述的方法，其特征在于，采集原始光学遥感卫星影像之前，还包括：从数据库中确定出任一时相所对应的影像样本，并根据预设的高斯混合模型分析方法构建亮度-色度二维高斯混合模型；通过所述亮度-色度二维高斯混合模型对二维直方图进行拟合确定出所述任一时相所对应的亮度阈值和色调阈值；从所述影像样本中提取正样本和负样本的特征，通过学习所述特征进行训练得到所述任一时相所对应的深度学习模型；根据所述任一时相所对应的亮度阈值、色调阈值以及深度学习模型构建时相与亮度阈值、色调阈值以及深度学习模型之间的映射关系；根据所述时相确定其所对应的亮度阈值、色调阈值和深度学习模型，包括：根据所述时相以及所述映射关系确定其所对应的亮度阈值、色调阈值和深度学习模型。3.如权利要求2所述的方法，其特征在于，根据预设的高斯混合模型分析方法构建亮度-色度二维高斯混合模型，包括：通过预设窗口尺寸的滤波器对所述二维直方图进行平滑处理得到处理后的直方图，采用预设等权重平分方法从所述处理后的直方图中获取各分量均值、标准差和权重的初始值；根据预设EM准则以及所述初始值对分量进行迭代调整并及时约减，并通过从小到大逐步试探的方式确定分量的数目以及所述亮度-色度二维高斯混合模型。4.如权利要求3所述的方法，其特征在于，通过所述亮度-色度二维高斯混合模型对二维直方图进行拟合确定出所述任一时相所对应的亮度阈值和色调阈值，包括：通过所述亮度-色度二维高斯混合模型进行二维直方图拟合确定出每个分量对应的亮度均值、色度均值、亮度标准差、色度标准差；根据所述每个分量对应的亮度均值、色度均值、所述亮度标准差、所述色度标准差以及预设的约束条件分别确定出云和晴空所对应的高斯分量，根据所述高斯分量确定出所述任一时相所对应的亮度阈值和色调阈值。5.如权利要求1～4任一项所述的方法，其特征在于，根据所述亮度阈值和所述色调阈值从所述校正后的影像中确定出初始云区，包括：根据所述亮度阈值从所述校正后的影像中确定出亮度值大于所述亮度阈值的至少一个第一像元，根据所述至少一个第一像元确定去第一云区；根据所述色调阈值从所述校正后的影像中确定出色调值大于所述色调阈值的至少一个第二像元，根据所述至少一个第二像元确定去第二云区；确定所述第一云区和所述第二云区相交的区域，将所述区域作为所述初始云区。6.如权利要求1～4任一项所述的方法，其特征在于，根据所述深度学习模型对所述初始云区进行精细化处理得到精细云区，包括：根据所述深度学习模型确定出所述初始云区中沙地、高亮地物、建筑物以及冰雪所对应的像元，进而确定除所述精细云区。7.如权利要求1～4任一项所述的方法，其特征在于，根据预设图形图像学方法对所述精细云区进行优化处理得到优化后云区，包括：根据所述预设图形图像学方法对所述精细云区进行云区膨胀处理将边缘薄云扩充到云区中得到处理后云区；将所述处理后云区进行云区开操作填补云缝得到开操作后的云区，其中，所述开操作后的云区趋于联通成多个整块；将所述开操作后的云区进行云区闭操作处理优化云区边缘轮廓得到所述优化后云区。
说明书desc
技术领域本申请涉及光学遥感卫星影像处理技术领域，尤其涉及一种光学遥感卫星影像云检测方法。背景技术随着光学遥感卫星影像信息化、智能化处理要求的不断提高，光学遥感卫星影像云检测成为光学遥感卫星影像处理过程中的一个重要环节。目前，光学遥感卫星影像云检测的方法主要分为两类：一种是基于灰度分割、光谱学和图形图像学等的传统类云检算法；另一类是基于全卷积神经网络、残差网络和多隐层特征学习等的深度学习类算法。目前，专利号申请号CN201510708444.5《多光谱遥感卫星影像自动云检测方法及系统》中提出一种多光谱遥感卫星影像自动云检测方法及系统，包括数据准备，云层粗提取，在影像强度信息通道上，使用直方图均衡化和双边滤波相结合的方式进行纹理信息提取，利用二维Otsu阈值对纹理信息图进行分割，利用分割后所得二值细节图对粗检结果进行误差剔除，将原影像的强度信息作为向导图，在误差剔除后粗检结果的基础上利用边缘种子膨胀的方式对云层进行精确提取。在《光学遥感卫星影像云检测方法及应用》中提出了一种单幅光学遥感卫星影像快速自动云检测方法。使用高斯混合模型对影像直方图进行自动拟合，通过分析高斯混合模型中各分量的参数特征和临近关系，自适应地计算云与晴空之间的亮度阈值，然后通过形态学运算与分析，消除阈值分割结果中的噪声，并优化调整云的轮廓，填充小面积云缝，使云区趋于连通的整体。在《基于神经网络的国产高分光学遥感图像云检测》中提出图像上云的柔性边界特征、内部亮度非均匀性以及薄云存在的色差问题提出了自适应分割算法ASLIC与用于特征提取与分类的DCNN网络，实现了ASLIC+DCNN的云检测目标。但是，上述现有技术存在如下问题：第一方面，在云检测过程中均没有考虑光学遥感卫星影像的质量和格式对云检测精度和效率的影响，或在云检测过程中没有考虑不同季节影像的辐射差异对云判精度的影响，导致云检测的精度和效率较低；另一方面，在云检测过程中可能会存在错判，云判精度较低以及极端错误率较高。发明内容本申请解决的技术问题是：针对现有技术中云判精度较低以及极端错误率较高。本申请提供了一种光学遥感卫星影像云检测方法，本申请实施例所提供的方案中，在对光学遥感卫星影像进行云检测过程中，一方面，通过对原始光学遥感卫星影像进行辐射校正，根据校正后的影像进行云检测，辐射校正可消除由于探元响应的不一致性对云判准确性的影响，进而提高云判准确性；另一方面，根据原始光学遥感卫星影像所处的时相确定其所对应的亮度阈值、色调阈值和深度学习模型，避免在不同时相影像的辐射差异对云判精度的影响，进而提高了云判精度；第三方面，通过将传统类云检算法和深度学习类算法相结合来确定云区，可以互为验证剔除云区中的错判，进而提升云判精度，降低极端错误率。第一方面，本申请实施例提供一种光学遥感卫星影像云检测方法，该方法包括：采集原始光学遥感卫星影像，将所述原始光学遥感卫星影像依次进行辐射校正、传感器校正、10:1抽稀采样、几何校正以及灰度拉伸得到校正后的影像，其中，所述校正后的影像为带地理坐标的jpg缩略影像；根据所述亮度阈值和所述色调阈值从所校正后的影像中确定出初始云区，根据所述深度学习模型对所述初始云区进行精细化处理得到精细云区；根据预设图形图像学方法对所述精细云区进行优化处理得到优化后云区，根据所述优化后云区生成云掩模二值图、云掩模矢量文件和云检测报告。可选地，采集原始光学遥感卫星影像之前，还包括：从数据库中确定出任一时相所对应的影像样本，并根据预设的高斯混合模型分析方法构建亮度-色度二维高斯混合模型；通过所述亮度-色度二维高斯混合模型对二维直方图进行拟合确定出所述任一时相所对应的亮度阈值和色调阈值；从所述影像样本中提取正样本和负样本的特征，通过学习所述特征进行训练得到所述任一时相所对应的深度学习模型；根据所述任一时相所对应的亮度阈值、色调阈值以及深度学习模型构建时相与亮度阈值、色调阈值以及深度学习模型之间的映射关系；根据所述时相确定其所对应的亮度阈值、色调阈值和深度学习模型，包括：根据所述时相以及所述映射关系确定其所对应的亮度阈值、色调阈值和深度学习模型。可选地，根据预设的高斯混合模型分析方法构建亮度-色度二维高斯混合模型，包括：通过预设窗口尺寸的滤波器对所述二维直方图进行平滑处理得到处理后的直方图，采用预设等权重平分方法从所述处理后的直方图中获取各分量均值、标准差和权重的初始值；根据预设EM准则以及所述初始值对分量进行迭代调整并及时约减，并通过从小到大逐步试探的方式确定分量的数目以及所述亮度-色度二维高斯混合模型。可选地，通过所述亮度-色度二维高斯混合模型对二维直方图进行拟合确定出所述任一时相所对应的亮度阈值和色调阈值，包括：通过所述亮度-色度二维高斯混合模型进行二维直方图拟合确定出每个分量对应的亮度均值和、色度均值、亮度标准差、色度标准差；根据所述每个分量对应的亮度均值、色度均值、所述亮度标准差、所述色度标准差以及预设的约束条件分别确定出云和晴空所对应的高斯分量，根据所述高斯分量确定出所述任一时相所对应的亮度阈值和色调阈值。可选地，根据所述亮度阈值和所述色调阈值从所述校正后的影像中确定出初始云区，包括：根据所述亮度阈值从所述校正后的影像中确定出亮度值大于所述亮度阈值的至少一个第一像元，根据所述至少一个第一像元确定去第一云区；根据所述色调阈值从所述校正后的影像中确定出色调大于所述色调阈值的至少一个第二像元，根据所述至少一个第二像元确定去第二云区；确定所述第一云区和所述第二云区相交的区域，将所述区域作为所述初始云区。可选地，根据所述深度学习模型对所述初始云区进行精细化处理得到精细云区，包括：根据所述深度学习模型确定出所述初始云区中沙地、高亮地物、建筑物以及冰雪所对应的像元，进而确定除所述精细云区。可选地，根据预设图形图像学方法对所述精细云区进行优化处理得到优化后云区，包括：根据所述预设图形图像学方法对所述精细云区进行云区膨胀处理将边缘薄云扩充到云区中得到处理后云区；将所述处理后云区进行云区开操作填补云缝得到开操作后的云区，其中，所述开操作后的云区趋于联通成多个整块；将所述开操作后的云区进行云区闭操作处理优化云区边缘轮廓得到所述优化后云区。与现有技术相比，本申请实施例所提供的方案具有如下有益效果：1、本申请实施例所提供的方案中，在对光学遥感卫星影像进行云检测过程中，一方面，通过对原始光学遥感卫星影像进行辐射校正、传感器校正、10:1抽稀采样、几何校正以及灰度拉伸，根据校正后的影像进行云检测，消除由于探元响应的不一致性对云判准确性的影响，进而提高云判准确性；另一方面，根据原始光学遥感卫星影像所处的时相确定其所对应的亮度阈值、色调阈值和深度学习模型，避免在不同时相影像的辐射差异对云判精度的影响，进而提高了云判精度；第三方面，通过将传统类云检算法和深度学习类算法相结合来确定云区，可以互为验证剔除云区中的错判，进而提升云判精度，降低极端错误率。2、本申请实施例所提供的方案中，在对原始光学遥感卫星影像进行辐射校正之后，进一步对辐射校正后的影像进行传感器校正，进而保证用于云检测的影像所生成的云掩模数据与原始光学遥感卫星影像具有相同的内部几何精度。3、本申请实施例所提供的方案中，通过对传感器校正后的影像进行稀释采样，得到传感器校正后的缩略影像，进而减小由于得到的传感器校正后的影像的尺寸，降低了云检测所耗时的时长，进而提高云检测效率。4、本申请实施例所提供的方案中，通过对传感器校正后的缩略影像进行几何校正，得到几何校正后的缩略影像。其中，几何校正后的缩略影像为带地理坐标的jpg缩略影像，进而保证用于云检测的影像所生成的云掩模数据与原始光学遥感卫星影像具有相同的外部几何精度。5、本申请实施例所提供的方案中，通过对几何校正后的缩略影像进行灰度拉伸。灰度拉伸后的影像其辐射特性更符合人眼和机器视觉特性，便于人眼和计算机对影像进行判读，可进一步提升云检准确率，降低极端错误率。附图说明图1为本申请实施例所提供的一种光学遥感卫星影像云检测方法的流程示意图；图2为本申请实施例所提供的一种云掩模二值图、云掩模矢量以及云检测报告示意图。具体实施方式本申请实施例提供的方案中，所描述的实施例仅是本申请一部分实施例，而不是全部的实施例。基于本申请中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其它实施例，都属于本申请保护的范围。以下结合说明书附图对本申请实施例所提供的一种光学遥感卫星影像云检测方法做进一步详细的说明，该方法具体实现方式可以包括以下步骤：步骤101，采集原始光学遥感卫星影像，将所述原始光学遥感卫星影像依次进行辐射校正、传感器校正、10:1抽稀采样、几何校正以及灰度拉伸得到校正后的影像，其中，所述校正后的影像为带地理坐标的jpg缩略影像。在本申请实施例所提供的方案中，原始光学遥感卫星影像是指0级卫星影像，即原始的、未经任何处理的卫星影像。由于原始光学遥感卫星影像未经过任何处理，可能会存亮度较暗或探元响应不一致，进而影响后续云检测过程中云判断的准确性和精度。因此，本申请实施例所提供的方案中，在进行云检测之前需要对原始光学遥感卫星影像进行辐射校正处理得到校正后的影像，进而消除探元响应的不一致性对云判准确度的影响，提高了云判准确度。进一步，在对原始光学遥感卫星影像进行辐射校正之后，为了保证后续用于云检测的影响生成的云掩模数据与原始光学遥感卫星影像具有相同的内部几何精度，还需要对辐射校正的影像进行进一步处理。具体的，将所述辐射校正后的影像进行传感器校正处理得到传感器校正后的影像。通过对辐射校正后的影像进行传感器校正，进而保证用于云检测的影像所生成的云掩模数据与原始光学遥感卫星影像具有相同的内部几何精度。进一步，为了提高云检测效率，将所述辐射校正后的影像进行传感器校正处理得到传感器校正后的影像之后，还包括：根据预设抽稀采样比例对所述传感器校正后的影像进行抽稀采样处理得到采样后的影像。具体的，在本申请实施例所提供的方案中，在对所述辐射校正后的影像进行传感器校正处理得到传感器校正后的影像之后，由于得到的传感器校正后的影像的尺寸较大，因此直接根据传感器校正后的影像进行云检测，会使得检测耗时较长，进而导致云检测效率较低。为了提高云检测效率，需要对传感器校正后的影像进行采样处理。在本申请实施例所提供的方案中，对传感器校正后的影像进行采样处理的方式有多种，例如，稀疏采样，其采样的比例为10:1。进一步，为了保证用于云检测的影像所生成的云掩模数据与原始光学遥感卫星影像具有相同的外部几何精度，在一种可能实现的方式中，根据预设抽稀采样比例对所述传感器校正后的影像进行抽稀采样处理得到采样后的影像之后，还包括：将所述采样后的影像进行几何校正处理得到几何校正后的影像；根据所述几何校正后的影像生成校正后的缩略影像，其中，所述校正后的缩略影像为带地理坐标的jpg缩略影像。具体的，在本申请实施例所提供的方案中，将采样后的影像进行几何校正处理得到几何校正后的影像之后，将几何校正后的影像取直方图累计面积5％-95％的值域部分线性拉甚至0-255DN。根据长期在轨统计结果，直方图累计面积5％-95％的值域部分为直方图的主体宽度，直方图累计面积小于5％一般为低端噪声，高于95％一般为饱和溢出。拉伸后影像的亮度和对比度有较大提高。最后将拉伸后的影像1：1生成带地理坐标的jpg缩略影像，然后将jpg缩略影像用于云检测。进一步，由于光学遥感卫星在生成影像时，不同光学遥感卫星影像成像的时相不尽相同，其中，时相包括春、夏、秋、冬四种，而不同时相影像的辐射特性存在一定的差异，如果在不同时相时采用相同的亮度阈值、色调阈值和深度学习模型，可能会影响云判精度。因此，在本申请实施例所提供的方案中，为了提高云判精度，在进行云检测之前，还需要根据原始光学遥感卫星影像所处的时相，实时确定其所对应的亮度阈值、色调阈值和深度学习模型。具体的，根据原始光学遥感卫星影像所处的时相确定其所对应的亮度阈值、色调阈值和深度学习模型的方式有多种，下面以其中一种为例进行说明。在一种可能实现的方式中，采集原始光学遥感卫星影像之前，还包括：从数据库中确定出任一时相所对应的影像样本，并根据预设的高斯混合模型分析方法构建亮度-色度二维高斯混合模型；通过所述亮度-色度二维高斯混合模型对二维直方图进行拟合确定出所述任一时相所对应的亮度阈值和色调阈值；从所述影像样本中提取正样本和负样本的特征，通过学习所述特征进行训练得到所述任一时相所对应的深度学习模型；根据所述任一时相所对应的亮度阈值、色调阈值以及深度学习模型构建时相与亮度阈值、色调阈值以及深度学习模型之间的映射关系；根据所述时相确定其所对应的亮度阈值、色调阈值和深度学习模型，包括：根据所述时相以及所述映射关系确定其所对应的亮度阈值、色调阈值和深度学习模型。进一步，在一种可能实现的方式中，根据预设的高斯混合模型分析方法构建亮度-色度二维高斯混合模型，包括：通过预设窗口尺寸的滤波器对所述二维直方图进行平滑处理得到处理后的直方图，采用预设等权重平分方法从所述处理后的直方图中获取各分量均值、标准差和权重的初始值；根据预设EM准则以及所述初始值对分量进行迭代调整并及时约减，并通过从小到大逐步试探的方式确定分量的数目以及所述亮度-色度二维高斯混合模型。进一步，在一种可能实现的方式中，通过所述亮度-色度二维高斯混合模型对二维直方图进行拟合确定出所述任一时相所对应的亮度阈值和色调阈值，包括：通过所述亮度-色度二维高斯混合模型进行二维直方图拟合确定出每个分量对应的亮度均值和、色度均值、亮度标准差、色度标准差；根据所述每个分量对应的亮度均值、色度均值、所述亮度标准差、所述色度标准差以及预设的约束条件分别确定出云和晴空所对应的高斯分量，根据所述高斯分量确定出所述任一时相所对应的亮度阈值和色调阈值。具体的，为了便于理解下面分别时相的划分原理、每个时相亮度阈值以及灰度阈值和深度学习模型的确定过程进行简要介绍。1)时相的划分过程具体的，由于一年之中太阳直射点在赤道、北回归线、赤道、南回归线之间变化，地球上同一地理位置一年四季的太阳高度角变化较大。且遥感相机探测器的辐射特性也会随时间呈缓慢变化。故一年之中遥感相机在成像参数设置不变的情况下，特别是冬夏两季，对地球上同一地理位置所成影像的辐射特性会有较大变化。为了保证云检测的准确度，需要将一年划分成若干时相。每个时相内，同一地理位置太阳高度角变化在一个较小的固定范围内，且遥感相机辐射特性几乎不变。每个时相均确定一套亮度阈值、灰度阈值和深度学习模型。具体的，拟以春分日、夏至日、秋分日和冬至日四天为每个时相的中心点，将一年划分为四个时相，每个时相为91天或92天。由于春分日、夏至日、秋分日和冬至日在每年不固定，即春分日在3月19-22日之间，夏至日在6月21-22日之间，秋分日在9月22-24日之间，冬至日在12月21-23日之间。为方便计算，以每年的3月21、6月21日、9月21日和12月21日为四个时相的中心点。第一时相定义为每年的2月4日至5月5日，共91天；第二时相定义为每年的5月6日至8月4日，共91天；第三时相定义为每年的8月5日至11月3日，共91天；第四时相定义为11月4日至次年的2月3日，共92天。2)每个时相亮度阈值、灰度阈值和深度学习模型的确定过程具体的，同上所述，同一个时相范围内，地球上同一地理位置太阳高度角变化在一个较小的固定范围内。每个时相时间跨度为91天或92天，遥感相机探测器的辐射特性通常可以视为不变。即卫星在同一个时相范围内所成影像在亮度和色调维度上应比较一致；而在不同时相，特别是第二时相与第四时相所成影像在亮度和色调维度上应反差较大。例如，将每年的2月4日至5月5日所成影像作为样本，计算第一时相的亮度阈值、灰度阈值和深度学习模型；将每年的5月6日至8月4日所成影像作为样本，计算第二时相的亮度阈值、灰度阈值和深度学习模型；以此类推。具体的，亮度阈值、灰度阈值和深度学习模型的具体计算过程如下所示：亮度阈值和灰度阈值的具体确定过程：与大部分晴空场景相比，云层在影像上呈现高亮、白色的特征，使用亮度和色度阈值可实现二者的区分，阈值的计算一般基于影像灰度直方图。可以将基于高斯混合模型的阈值分析方法拓展到二维空间，得到“亮度-色度”二维阈值向量，实现针对多光谱影像的更为准确的云层提取。对于全色影像，由一维高斯混合模型求得亮度阈值，那么对于含有n个波段的多光谱影像，一个自然的思路是构建n维高斯混合模型，求得一个n维亮度阈值向量。但已知在可见光光谱范围内，云的反射率较高且趋近一致，在近红外光谱范围内，云的反射率开始降低，与晴空场景的区分度也随之较低。为了提高检测准确率并精简模型，我们将n维模型简化为亮度和色度二维：其中亮度定义为可见光各波段的最小亮度值，如下式；色度定义为可见光各波段最大与最小亮度值的差值，如下式。l＝minc＝max-min其中，l表示亮度；c表示色度；R、G、B分别代表某一像元在红、绿、蓝波段上的DN值。进一步，可以合理地推测，表征云的像元应该有着较大的l值和较小的c值。采用上面定义的公式，更能够凸显云和晴空场景的区分性。然后，通过下式使用“亮度-色度”二维高斯混合模型对二维直方图进行拟合：其中，h表示二维直方图；GMM表示二维高斯混合模型；M为高斯混合模型中分量的数目；pm表示第m个分量对应的波形函数；μlm表示亮度均值；μcm表示色度均值；σlm表示亮度标准差；σcm色度标准差；τm表示第m个分量的权重。二维高斯混合模型拟合的过程与一维高斯混合模型方法相似，将一维拓展至二维空间即可。即：首先使用窗口为5×5的高斯滤波器对二维直方图进行平滑预处理；然后在二维空间中，通过等权重平分的方式获取各分量均值、标准差和权重的初始值；接着按照EM准则对分量进行迭代调整并及时约减，并通过从小到大“逐步试探”的方式确定分量的数目，最终获得拟合程度大于92％的二维高斯混合模型。对于任意二维高斯分布pm，若其亮度均值和亮度标准差构造的点在式和式构造的直线的右上方，且其高频区间在色度维度上的映射低于色度经验值0.1。即pm同时满足式和式，则将其判定为云，否则判定为晴空。然后，以二维空间里两类高斯分量之间的相交线作为云和晴空之间的阈值向量。深度学习模型的确定过程采用主成分分析PCA非监督预训练网络结构，在主成分分析小化重构误差原则下，获取待检测影像中正样本和负样本的特征，通过学习得到含有训练样本统计特性的滤波器；其次，为减少采样过程中影像特征的缺失，在最大池化模型和平均模型的基础上，根据插值原理采用自适应池化模型，得到深度学习模型。在进行云检测之前，首先判断待检测影像的时相，然后依据时相调取相应的亮度阈值、灰度阈值和深度学习模型对其进行云检测。步骤102，根据所述亮度阈值和所述色调阈值从所校正后的影像中确定出初始云区，根据所述深度学习模型对所述初始云区进行精细化处理得到精细云区。在本申请实施例所提供的方案中，在确定原始光学遥感卫星影像的时相所对应的亮度阈值、色调阈值和深度学习模型之后，根据该亮度阈值、色调阈值和深度学习模型从校正后的影像中确定出云区。具体的，根据该亮度阈值、色调阈值和深度学习模型从校正后的影像中确定出云区的过程包括云区粗提取和云区像元精化两步。为了便于理解下面分别对每一步的过程进行简要介绍。一、云区粗提取具体的，在本申请实施例所提供的方案中，根据亮度阈值和色调阈值进行云区粗提取的方式有多种，下面以其中一种为例进行说明。在一种可能实现的方式中，根据所述亮度阈值和所述色调阈值从所校正后的影像中确定出初始云区，包括：根据所述亮度阈值从所述校正后的影像中确定出亮度值大于所述亮度阈值的至少一个第一像元，根据所述至少一个第一像元确定去第一云区；根据所述色调阈值从所述校正后的影像中确定出色调大于所述色调阈值的至少一个第二像元，根据所述至少一个第二像元确定去第二云区；确定所述第一云区和所述第二云区相交的区域，将所述区域作为所述初始云区。二、云区像元精化具体的，在本申请实施例所提供的方案中，根据深度学习模型对初始云区像元精化的方式有多种，下面以其中一种为例进行说明。在一种可能实现的方式中，根据所述深度学习模型对所述初始云区进行精细化处理得到精细云区，包括：根据所述深度学习模型确定出所述初始云区中沙地、高亮地物、建筑物以及冰雪所对应的像元，进而确定除所述精细云区。具体的，在本申请实施例所提供的方案中，剔除高亮地位、建筑物以及冰雪的过程如下所示：①、排除高亮地物影响：基于Gabor特征显著性、云块面积阈值、云块多边形特征与深度学习相结合识别建筑物、裸地等噪声，予以排除。②、排除冰雪影像：基于深度学习排除冰雪影响。某些特定条件下，也可通过云块地理信息进一步排除常年积雪。步骤103，根据预设图形图像学方法对所述精细云区进行优化处理得到优化后云区，根据所述优化后云区计算得到云含量。在一种可能实现方式中，根据预设图形图像学方法对所述精细云区进行优化处理得到优化后云区，包括：根据所述预设图形图像学方法对所述精细云区进行云区膨胀处理将边缘薄云扩充到云区中得到处理后云区；将所述处理后云区进行云区开操作填补云缝得到开操作后的云区，其中，所述开操作后的云区趋于联通成多个整块；将所述开操作后的云区进行云区闭操作处理优化云区边缘轮廓得到所述优化后云区。为了便于理解上述根据预设图形图像学方法对所述精细云区进行优化处理得到优化后云区的过程各步骤进行简要介绍：①、云区条件膨胀：带限定条件的云区膨胀，一定程度上扩充云区，将边缘薄云包含进来。②、云区开操作：填补云缝，使云区趋于联通成几大整块，方便后续使用。③、云区闭操作：优化云区边缘轮廓，使之趋于自然。步骤104，根据所述优化后云区生成云掩模二值图、云掩模矢量文件和云检测报告。具体的，在本申请实施例所提供的方案中，云检测报告包括但不限制于：①云检测运行起始时间、②云检测运行结束时间、③云检测用时、④被检测影像有效像元数、⑤被检测影像云区像元数、⑥被检测影像云含量、⑦被检测影像云含量置信度。参见图2所示，为本申请实施例所提供的一种云掩模二值图、云掩模矢量以及云检测报告示意图。进一步，为了验证本申请实施例所提供的卫星影像云检测方法的效果，下面以高景一号01星数据为例对本申请实施例所提供方案的效果进行说明。例如，在高景一号卫星地面数据处理系统在2020年1-10月份成像的数据中随机选取4000余景影像数据，包含裸地、植被、农耕地、城区、水体、沙漠、全云等景物。具体的，参见表1，为现有云判系统准确率和极端错误率的结果；参见表2，为本申请实施例所提供的云判系统准确率和极端错误率的结果。表1表2参见上述表1和表2，本申请实施例所提供的方案与高景一号卫星原云判系统相比，基于本申请实施例所提供的方案改造的云判系统准确率由71.85％提升至92.68％，极端错误率由10.25％降低至2.95％。云判精度有较大提高。本申请实施例所提供的方案中，在对光学遥感卫星影像进行云检测过程中，一方面，通过对原始光学遥感卫星影像进行辐射校正、传感器校正、10:1抽稀采样、几何校正以及灰度拉伸，根据校正后的影像进行云检测，消除由于探元响应的不一致性对云判准确性的影响，进而提高云判准确性；另一方面，根据原始光学遥感卫星影像所处的时相确定其所对应的亮度阈值、色调阈值和深度学习模型，避免在不同时相影像的辐射差异对云判精度的影响，进而提高了云判精度；第三方面，通过将传统类云检算法和深度学习类算法相结合来确定云区，可以互为验证剔除云区中的错判，进而提升云判精度，降低极端错误率。本领域内的技术人员应明白，本申请的实施例可提供为方法、系统、或计算机程序产品。因此，本申请可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本申请可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本申请是参照根据本申请实施例的方法、设备、和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。显然，本领域的技术人员可以对本申请进行各种改动和变型而不脱离本申请的精神和范围。这样，倘若本申请的这些修改和变型属于本申请权利要求及其等同技术的范围之内，则本申请也意图包含这些改动和变型在内。
