标题title
基于霍尔电流传感器的电流检测修正方法
摘要abst
本发明公开了一种基于霍尔电流传感器的电流检测修正方法，本发明的设计构思在于，结合影响霍尔电流传感器检测精度的因素以及电动汽车上电、下电阶段霍尔电流传感器的输出，对特定型号的霍尔电流传感器其自身附带的输出电压与原边电流的特性关系，进行多轮优化，得到最优的输出电压与原边电流的对应关系，然后利用该优化后的目标关系与行车实测值，得到准确度大幅提升的所需测量的电流值。
权利要求书clms
1.一种基于霍尔电流传感器的电流检测修正方法，其特征在于，包括：根据目标霍尔电流传感器的类型，确定所述目标霍尔电流传感器的输出电压与原边电流的原始关系；结合影响霍尔电流传感器检测精准度的硬件因素，在所述原始关系中引入中间参数，得到霍尔电流传感器的输出电压与原边电流的初步优化关系；在车辆处于下电阶段，检测在高压未上电条件下的所述目标霍尔电流传感器的第一输出电压，并根据所述第一输出电压以及所述目标霍尔电流传感器的额定输出电压，求取下电偏差因子；在车辆处于上电阶段，检测当车辆的低压负载处于工作状态时的所述目标霍尔电流传感器的第二输出电压，并根据所述第二输出电压以及所述第一输出电压，求取上电偏差因子；基于所述下电偏差因子以及所述上电偏差因子，对所述初步优化关系进行二次优化，得到所述目标霍尔电流传感器的输出电压与原边电流的目标优化关系；在车辆运行过程中，获取所述目标霍尔电流传感器的输出电压实测值；根据所述输出电压实测值以及所述目标优化关系，得到目标电流检测值。2.根据权利要求1所述的基于霍尔电流传感器的电流检测修正方法，其特征在于，所述中间参数包括：偏置电压、基于所述偏置电压及测量电路总电阻得到的偏置电流；其中，所述测量电路总电阻与所述目标霍尔电流传感器的输入电压具有第一线性关系，所述偏置电压与所述目标霍尔电流传感器的输入电压具有第二线性关系。3.根据权利要求2所述的基于霍尔电流传感器的电流检测修正方法，其特征在于，所述第二线性关系的获得方法包括：预先利用标准电源，模拟所述目标霍尔电流传感器在预设电压值范围内的若干个输入电压，其中所述预设电压值范围基于所述目标霍尔电流传感器的额定输入电压确定；在原边电流为0A时，测出对应于若干个输入电压的若干个输出电压；根据模拟出的若干个输入电压以及对应测得的若干个输出电压，求取表征所述第二线性关系的参数。4.根据权利要求3所述的基于霍尔电流传感器的电流检测修正方法，其特征在于，所述第一线性关系的获得方法包括：预先利用标准电源，模拟所述目标霍尔电流传感器在预设电压值范围内的若干个输入电压，其中所述预设电压值范围基于所述目标霍尔电流传感器的额定输入电压确定；在相同的预设原边电流值条件下，测出对应于若干个输入电压的若干个输出电压；其中，所述预设原边电流值为非0值；根据模拟出的若干个输入电压以及对应测得的若干个输出电压，求取表征所述第一线性关系的参数。5.根据权利要求1所述的基于霍尔电流传感器的电流检测修正方法，其特征在于，所述下电偏差因子为所述目标霍尔电流传感器的额定输出电压与所述第一输出电压的比值。6.根据权利要求1所述的基于霍尔电流传感器的电流检测修正方法，其特征在于，所述上电偏差因子为所述第一输出电压减去所述第二输出电压的差值。7.根据权利要求1～6任一项所述的基于霍尔电流传感器的电流检测修正方法，其特征在于，在求取上电偏差因子时，执行预设的高压上电延迟机制。
说明书desc
技术领域本发明涉及新能源汽车技术领域，尤其涉及一种基于霍尔电流传感器的电流检测修正方法。背景技术随着电动汽车的普及，电动汽车的续航能力被普遍关注，如何准确便捷地评估电动汽车的剩余电量成为关键。现有最简单有效的方法是采用电流积分的方式进行电动汽车SOC计算。目前电动汽车采用电流积分主要应用高精度霍尔电流传感器对电动汽车的主回路电流进行采集，依靠霍尔电流传感器自身的精度保证电流积分的高准确性。然而，即便同一批次的霍尔电流传感器的精度也会存在或大或小的区别，导致标定设备时对标定结果产生影响，对其测量结果也存在一定的影响。并且，在电动汽车上安装霍尔电流传感器时，因其工作原理是电磁感应，在电动汽车上很多部件都会对其进行电磁干扰，特别在动力电池和高压配电盒内，其安装环境的影响量不可忽略。综上，在电动汽车上使用霍尔电流传感器进行电流采集时，其检测值的准确度存在波动，因此有必要对基于霍尔电流传感器的电流测量值进行优化。发明内容鉴于上述，本发明旨在提供一种基于霍尔电流传感器的电流检测修正方法，以解决前述问题。本发明采用的技术方案如下：一种基于霍尔电流传感器的电流检测修正方法，其中包括：根据目标霍尔电流传感器的类型，确定所述目标霍尔电流传感器的输出电压与原边电流的原始关系；结合影响霍尔电流传感器检测精准度的硬件因素，在所述原始关系中引入中间参数，得到霍尔电流传感器的输出电压与原边电流的初步优化关系；在车辆处于下电阶段，检测在高压未上电条件下的所述目标霍尔电流传感器的第一输出电压，并根据所述第一输出电压以及所述目标霍尔电流传感器的额定输出电压，求取下电偏差因子；在车辆处于上电阶段，检测当车辆的低压负载处于工作状态时的所述目标霍尔电流传感器的第二输出电压，并根据所述第二输出电压以及所述第一输出电压，求取上电偏差因子；基于所述下电偏差因子以及所述上电偏差因子，对所述初步优化关系进行二次优化，得到所述目标霍尔电流传感器的输出电压与原边电流的目标优化关系；在车辆运行过程中，获取所述目标霍尔电流传感器的输出电压实测值；根据所述输出电压实测值以及所述目标优化关系，得到目标电流检测值。在其中至少一种可能的实现方式中，所述中间参数包括：偏置电压、基于所述偏置电压及测量电路总电阻得到的偏置电流；其中，所述测量电路总电阻与所述目标霍尔电流传感器的输入电压具有第一线性关系，所述偏置电压与所述目标霍尔电流传感器的输入电压具有第二线性关系。在其中至少一种可能的实现方式中，所述第二线性关系的获得方法包括：预先利用标准电源，模拟所述目标霍尔电流传感器在预设电压值范围内的若干个输入电压，其中所述预设电压值范围基于所述目标霍尔电流传感器的额定输入电压确定；在原边电流为0A时，测出对应于若干个输入电压的若干个输出电压；根据模拟出的若干个输入电压以及对应测得的若干个输出电压，求取表征所述第二线性关系的参数。在其中至少一种可能的实现方式中，所述第一线性关系的获得方法包括：预先利用标准电源，模拟所述目标霍尔电流传感器在预设电压值范围内的若干个输入电压，其中所述预设电压值范围基于所述目标霍尔电流传感器的额定输入电压确定；在相同的预设原边电流值条件下，测出对应于若干个输入电压的若干个输出电压；其中，所述预设原边电流值为非0值；根据模拟出的若干个输入电压以及对应测得的若干个输出电压，求取表征所述第一线性关系的参数。在其中至少一种可能的实现方式中，所述下电偏差因子为所述目标霍尔电流传感器的额定输出电压与所述第一输出电压的比值。在其中至少一种可能的实现方式中，所述上电偏差因子为所述第一输出电压减去所述第二输出电压的差值。在其中至少一种可能的实现方式中，在求取上电偏差因子时，执行预设的高压上电延迟机制。本发明的设计构思在于，结合影响霍尔电流传感器检测精度的因素以及电动汽车上电、下电阶段霍尔电流传感器的输出，对特定型号的霍尔电流传感器其自身附带的输出电压与原边电流的特性关系，进行多轮优化，得到最优的输出电压与原边电流的对应关系，然后利用该优化后的目标关系与行车实测值，得到准确度大幅提升的所需测量的电流值。附图说明为使本发明的目的、技术方案和优点更加清楚，下面将结合附图对本发明作进一步描述，其中：图1为本发明实施例提供的基于霍尔电流传感器的电流检测修正方法的流程图。具体实施方式下面详细描述本发明的实施例，实施例的示例在附图中示出，其中自始至终相同或类似的标号表示相同或类似的元件或具有相同或类似功能的元件。下面通过参考附图描述的实施例是示例性的，仅用于解释本发明，而不能解释为对本发明的限制。本发明提出了一种基于霍尔电流传感器的电流检测修正方法的实施例，具体来说，如图1所示，可以包括：步骤S1、根据目标霍尔电流传感器的类型，确定所述目标霍尔电流传感器的输出电压与原边电流的原始关系；步骤S2、结合影响霍尔电流传感器检测精准度的硬件因素，在所述原始关系中引入中间参数，得到霍尔电流传感器的输出电压与原边电流的初步优化关系；步骤S3、在车辆处于下电阶段，检测在高压未上电条件下的所述目标霍尔电流传感器的第一输出电压，并根据所述第一输出电压以及所述目标霍尔电流传感器的额定输出电压，求取下电偏差因子；步骤S4、在车辆处于上电阶段，检测当车辆的低压负载处于工作状态时的所述目标霍尔电流传感器的第二输出电压，并根据所述第二输出电压以及所述第一输出电压，求取上电偏差因子；步骤S5、基于所述下电偏差因子以及所述上电偏差因子，对所述初步优化关系进行二次优化，得到所述目标霍尔电流传感器的输出电压与原边电流的目标优化关系；步骤S6、在车辆运行过程中，获取所述目标霍尔电流传感器的输出电压实测值；步骤S7、根据所述输出电压实测值以及所述目标优化关系，得到目标电流检测值。在实际操作中，所述中间参数可以包括：偏置电压、基于所述偏置电压及测量电路总电阻得到的偏置电流；其中，所述测量电路总电阻与所述目标霍尔电流传感器的输入电压具有第一线性关系，所述偏置电压与所述目标霍尔电流传感器的输入电压具有第二线性关系。进一步地，所述第二线性关系的获得方法可以参考如下：预先利用标准电源，模拟所述目标霍尔电流传感器在预设电压值范围内的若干个输入电压，其中所述预设电压值范围基于所述目标霍尔电流传感器的额定输入电压确定；在原边电流为0A时，测出对应于若干个输入电压的若干个输出电压；根据模拟出的若干个输入电压以及对应测得的若干个输出电压，求取表征所述第二线性关系的参数。同理地，所述第一线性关系的获得方法可以参考如下：预先利用标准电源，模拟所述目标霍尔电流传感器在预设电压值范围内的若干个输入电压，其中所述预设电压值范围基于所述目标霍尔电流传感器的额定输入电压确定；在相同的预设原边电流值条件下，测出对应于若干个输入电压的若干个输出电压；其中与获得第二线性关系不同的是，所述预设原边电流值为非0值；根据模拟出的若干个输入电压以及对应测得的若干个输出电压，求取表征所述第一线性关系的参数。除此之外，所述下电偏差因子则可以具体是指所述目标霍尔电流传感器的额定输出电压与所述第一输出电压的比值。进一步地，所述上电偏差因子则可以是所述第一输出电压减去所述第二输出电压的差值。更为优选地，在前文提及的求取上电偏差因子时，可以考虑执行预设的高压上电延迟机制，也即是在高压上电瞬间预留一定的测量时间。为了便于理解前文所述实施例及其优选方案，这里可以参考如下具体的说明示例：可以根据电动汽车电流采集需求，确定目标霍尔电流传感器的规格、型号及精度等。目前电动汽车常采用电流积分方法计算其SOC，其电流一般通过霍尔电流传感器进行测量，故霍尔电流传感器精度影响着电流积分的结果，故选型时应满足电动汽车电流积分需求，原则上电流传感器精度越高越好，因此，可以选取闭环式霍尔电流传感器。关于霍尔电流传感器的量程，则应覆盖电动汽车长时间不同工况下高压主回路中通过的电流，不能超量程使用。电动汽车大功率部件有电机和快充，以大者计算电流，并使其处于霍尔电流传感器量程的60％-80％以内，并兼顾小电流测量。如动力电池额定电压384V，容量240Ah，快充以0.8C充电，电机功率40kW，可得快充电流240×0.8＝192A，电机工作电流40kW÷384V×1000＝104.17A，以大者确定霍尔电流传感器规格192÷80％＝240，就近选取规格为250A或300A的霍尔电流传感器。在目标霍尔电流传感器定型后，基于其原理，若原边电流Ip发生变化，气隙处磁场平衡被破坏，导致副边补偿电流Is变化，使磁场重新达到平衡：此式中：Is为副边补偿电流；Ip为原边电流；N为副边补偿线圈绕磁环匝数，即为霍尔电流传感器的缩放比例，可从霍尔电流传感器中得到此常数。且基于原理，输出电压VOUT与测量电阻RM正相关，故有：在实际操作中，为使霍尔电流传感器测量更加准确，需考虑线阻、霍尔电流传感器中三极管的应用以及副边补偿电流Is方向变化等因素，由此，本发明提出优选设置一个偏置电流Iz以实现上述目的，最终副边线圈通过的电流Isz为副边补偿电流Is和偏置电流Iz的向量和。为后问描述方便，以副边补偿电流Is和偏置电流Iz方向相同为例，故总电流Isz＝Is+Iz。由此，可以得到初步优化后的输出电压：式中：RMZ为测量电路两端内电路的总电阻，在确定的霍尔电流传感器中为定值；Iz为考虑三极管开启、线阻分压等因素的偏置电流；uz为考虑三极管开启、线阻分压等因素的偏置电压。在上式中，总电阻RMZ与输入电压VC正相关。具体来说，测量同一原边电流Ip时，且偏置电压不变时，因原边电流Ip不变，补偿电流Is也不变。当外部给定输入电压VC变化时，通过总电阻RMZ的电流没变，但其分压因输入电压的增大而增大，减小而减小，由此得到第一线性关系，可表达为：RMZ＝k1VC+m1式中：k1、m1为常数，与霍尔电流传感器本身特性相关，后文将做说明；VC为霍尔电流传感器的系统输入电压。此外，在式中，偏置电压uz与输入电压VC正相关。具体来说，测量同一原边电流Ip时，且总电阻RMZ保持不变时，因原边电流Ip不变，补偿电流Is也不变。但是输入电压VC的变化导致总电阻RMZ两端电压变化，使得总电流Isz变化，但是补偿电流Is不变，故偏置电流Iz变化，即偏置电压uz变化。故偏置电压随着输入电压VC的增大而增大，减小而减小，由此得到第二线性关系，可表达为：uz＝k2VC+m2式中：k2、m2为常数，与霍尔电流传感器本身特性相关，后文将做说明；uz为偏置电压。经由上述引入的参数，可以对式进行二次优化更新，可得：由式可知，最终输出电压VOUT与原边电流Ip、输入电压VC相关，测量同一原边电流Ip时，输出电压VOUT受输入电压VC的准确度影响，因变量VOUT是自变量VC的一次函数，斜率为。为了保证输出电压VOUT的准确性，在电动汽车中使用霍尔电流传感器测量电流时，由于外部输入电压VC′与霍尔电流传感器的额定电压VC0存在差异，输出电压VOUT需根据外部实际输入电压VC′进行修正。关于前述第一、第二线性关系，可以进一步参考如下：可以使用标准电源模拟霍尔电流传感器的额定输入电压VC0，测量原边电流Ip为0A时，此时对应的输出电压为VOUT0。。更佳地，可以使用标准电源模拟霍尔电流传感器输入电压范围VC0±u，将电压u进行n等分，分别模拟为测量同一原边电流Ip0，可得到对应的输出电压VOUT分别为VOUT-n、VOUT-、...、VOUT-2、VOUT-1、VOUT0、VOUT1、VOUT2、...、VOUT、VOUTn，再根据最小二乘法进行函数拟合，可得到：令：可得：k2＝c1，m2＝c2，c1、c2为常数。同理地，可以使用标准电源模拟霍尔电流传感器输入电压范围VC0±u，将电压u进行n等分，分别模拟为测量同一原边电流Ipt，可得到对应的输出电压VOUT分别为V′OUT-n、V′OUT-、...、V′OUT-2、V′OUT-1、V′OUT0、V′OUT1、V′OUT2、...、V′OUT、V′OUTn，再根据最小二乘法进行函数拟合，可得到：令可得：c3、c4为常数。联立式，因为N、c1、c2、c3、c4为常数，Ipt、N为确定值，故可得到k2＝c1、m2＝c2。最终可确定第一、第二线性关系，并用于优化所述原始关系。接着，确定电动汽车下电偏差。在实际操作中，可以将目标霍尔电流传感器放置在电动汽车环境中，使钥匙处于OFF档，此时高压输入电流为0A，测得在电动汽车高压未上电环境下，此时的第一输出电压VOUTC1。由于VOUTC1影响着霍尔电流传感器输入电流测量的准确性，为保证此时的输出电压和外部校准标准状态一致，可以确定第一修正因子k：并且，可以确定电动汽车低压上电偏差。在实际操作中可以将钥匙拧至ACC档，高压输入电流仍为0A，但电动汽车的低压负载处于工作状态，霍尔电流传感器的磁场有了变化，导致输出电压随之变化，此时的第二输出电压值VOUTC2，同样地，为保证此时的输出电压和外部校准标准状态一致，可以得到第二修正因子a为VOUTC1-VOUTC2。最后，综合第一、第二修正因子对前述初步优化关系进行再一次优化，可更新为这样，在进行电动汽车电流实测时，可以利用霍尔电流传感器的实际输出电压与该最优的关系表达，测得其中的Ip即为精准的所需电流值。关于前述修正因子的获得，还可以参考如下示例：例如，某型号霍尔电流传感器，额定输入电压5V,量程IpN为300A，准确度为1级，得到其输出电压关系为：在外部标准状态下，用5V的标准电源输入，原边电流IP为0A时，输出电压VOUT0为2.5V；在钥匙OFF档时，原边电流IP为0A时，输出电压VOUTC1为2.49V；在钥匙ACC档时，原边电流IP为0A时，输出电压VOUTC2为2.48V，可得到：a＝VOUTC1-VOUTC2＝2.49V-2.48V＝0.01V综上所述，本发明的设计构思在于，结合影响霍尔电流传感器检测精度的因素以及电动汽车上电、下电阶段霍尔电流传感器的输出，对特定型号的霍尔电流传感器其自身附带的输出电压与原边电流的特性关系，进行多轮优化，得到最优的输出电压与原边电流的对应关系，然后利用该优化后的目标关系与行车实测值，得到准确度大幅提升的所需测量的电流值。本发明实施例中，“至少一个”是指一个或者多个，“多个”是指两个或两个以上。“和/或”，描述关联对象的关联关系，表示可以存在三种关系，例如，A和/或B，可以表示单独存在A、同时存在A和B、单独存在B的情况。其中A，B可以是单数或者复数。字符“/”一般表示前后关联对象是一种“或”的关系。“以下至少一项”及其类似表达，是指的这些项中的任意组合，包括单项或复数项的任意组合。例如，a，b和c中的至少一项可以表示：a，b，c，a和b，a和c，b和c或a和b和c，其中a，b，c可以是单个，也可以是多个。以上依据图式所示的实施例详细说明了本发明的构造、特征及作用效果，但以上仅为本发明的较佳实施例，需要言明的是，上述实施例及其优选方式所涉及的技术特征，本领域技术人员可以在不脱离、不改变本发明的设计思路以及技术效果的前提下，合理地组合搭配成多种等效方案；因此，本发明不以图面所示限定实施范围，凡是依照本发明的构想所作的改变，或修改为等同变化的等效实施例，仍未超出说明书与图示所涵盖的精神时，均应在本发明的保护范围内。
