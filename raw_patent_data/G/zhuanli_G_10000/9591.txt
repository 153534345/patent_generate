标题title
一种基于陀螺仪辅助测量伺服电机角度的方法
摘要abst
本发明公开了一种基于陀螺仪辅助测量伺服电机角度的方法，包括：获取伺服电机k时刻的编码器角度和k时刻的陀螺仪角速度，将k时刻的陀螺仪角速度转换为k时刻的陀螺仪角度；设置变化率超阈值和差值阈值，计算k时刻的编码器角度与k‑1时刻的实际输出角度的变化率和k时刻的编码器角度与k时刻的陀螺仪角度的差值，当变化率大于变化率阈值且差值大于差值阈值时，将k时刻的陀螺仪角度作为k时刻伺服电机的实际输出角度；否则将k时刻的编码器角度与k时刻的陀螺仪角度进行卡尔曼角度融合，将融合结果作为k时刻的实际输出角度。本发明提高了测量过程的可靠性和测量结果的准确性，保证伺服电极正常运行的同时实现高精度转速控制。
权利要求书clms
1.一种基于陀螺仪辅助测量伺服电机角度的方法，其特征在于，所述方法包括：S1：伺服电机开机运行，获取伺服电机k时刻的编码器角度和k时刻的陀螺仪角速度；S2：将k时刻的陀螺仪角速度转换为k时刻的陀螺仪角度；S3：设置伺服电机k-1时刻的实际输出角度，计算k时刻的编码器角度与k-1时刻的实际输出角度的变化率；S4：设置变化率阈值，比较变化率与变化率阈值的大小；若变化率大于变化率阈值，则计算k时刻的编码器角度和k时刻的陀螺仪角度的差值，执行步骤S5；否则执行步骤S6；S5：设置差值阈值，比较差值与差值阈值的大小；若差值大于差值阈值，则将k时刻的陀螺仪角度作为伺服电机k时刻的实际输出角度；否则进行步骤S6；S6：将k时刻的编码器角度与k时刻的陀螺仪角度进行卡尔曼角度融合，将卡尔曼角度融合结果作为伺服电机k时刻的实际输出角度。2.根据权利要求1所述的基于陀螺仪辅助测量伺服电机角度的方法，其特征在于，利用伺服电机原有的编码器获取伺服电机的编码器角度。3.根据权利要求2所述的基于陀螺仪辅助测量伺服电机角度的方法，其特征在于，所述伺服电机原有的编码器为光电编码器或磁编码器。4.根据权利要求1所述的基于陀螺仪辅助测量伺服电机角度的方法，其特征在于，利用陀螺仪获得伺服电机的陀螺仪角速度，具体方法为：利用陀螺仪检测伺服电机转轴的旋转，输出检测信号转换值；根据陀螺仪的灵敏度对应表确认当前陀螺仪的灵敏度；根据信号转换值和灵敏度计算陀螺仪角速度：陀螺仪角速度＝信号转换值/灵敏度。5.根据权利要求1所述的基于陀螺仪辅助测量伺服电机角度的方法，其特征在于，设置采样周期，每间隔一个采样周期，获取一次伺服电机的编码器角度和伺服电机的陀螺仪角速度；所述采样周期根据陀螺仪的采样频率确定，具体为：式中，B表示采样周期，f表示陀螺仪的采样频率。6.根据权利要求5所述的基于陀螺仪辅助测量伺服电机角度的方法，其特征在于，所述步骤S2中，将k时刻的陀螺仪角速度转换为k时刻的陀螺仪角度的具体方法为：Uk＝uk*B式中，Uk表示k时刻的陀螺仪角度，uk表示k时刻的陀螺仪角速度，B表示采样周期。7.根据权利要求6所述的基于陀螺仪辅助测量伺服电机角度的方法，其特征在于，所述S3中，计算k时刻的编码器角度与k-1时刻的实际输出角度的变化率的具体方法为：式中，αk表示k时刻的编码器角度与k-1时刻偏伺服电机的实际输出角的变化率，zk表示k时刻的原编码器角度，表示k-1时刻的实际输出角度。8.根据权利要求7所述的基于陀螺仪辅助测量伺服电机角度的方法，其特征在于，所述步骤S6中，卡尔曼角度融合的具体步骤为；S6.1：预测伺服电机k时刻的输出角度：其中，A表示状态转移矩阵，B表示采样周期，表示k时刻的预测输出角度，表示k-1时刻的实际输出角度，uk表示k时刻的陀螺仪角速度；S6.2：预测伺服电机k时刻的误差协方差矩阵：Pk|k-1＝APk-1AT+Q其中，Pk|k-1表示k时刻的预测误差协方差矩阵，Pk-1表示k-1时刻的误差协方差矩阵，T表示求转置操作，Q表示陀螺仪角速度的噪声协方差矩阵；S6.3：根据k时刻的预测误差协方差矩阵计算卡尔曼增益：其中，Kk表示卡尔曼增益，H表示转换矩阵，R表示编码器的噪声协方差矩阵；S6.4：根据k时刻的预测输出角度和卡尔曼增益计算k时刻的最优预测输出角度：其中，时刻的最优预测输出角度，zk表示k时刻的编码器角度；S6.5：将k时刻的最优预测输出角度作为k时刻的实际输出角度。9.根据权利要求8所述的基于陀螺仪辅助测量伺服电机角度的方法，其特征在于，卡尔曼角度融合还包括以下步骤：S6.6：更新k时刻的误差协方差矩阵：Pk＝Pk|k-1其中，Pk表示k时刻的误差协方差矩阵，I表示单位矩阵；S6.7：更新时刻，将k时刻的实际输出角度作为下一次卡尔曼角度融合时的k-1时刻的实际输出角度，将k时刻的误差协方差矩阵作为下一次的卡尔曼角度融合时的k-1时刻的误差协方差矩阵，重复步骤S6.1-S6.6，实现连续的卡尔曼角度融合。10.根据权利要求1所述的基于陀螺仪辅助测量伺服电机角度的方法，其特征在于，所述方法还包括：S7：将伺服电机k时刻的实际输出角度返回步骤S3作为下一次计算时的伺服电机k-1时刻的实际输出角度，重复步骤S1-S6，实现对伺服电机实际输出角度的实时连续测量，直至伺服电机关机。
说明书desc
技术领域本发明涉及电机设备的领域，更具体地，涉及一种基于陀螺仪辅助测量伺服电机角度的方法。背景技术近年来，随着电力电子、工业机器人控制技术的快速发展，生产对伺服电机转速的高精度控制测量的要求不断提高。由于伺服电机拥有交流电机结构简单、维护方便等特点的同时，又具备效率高、调速性能好等优点，而被广泛应用。一般无刷直流电动机调速系统中，通常在电动机转轴上安装光电编码器、磁编码器进行测速，但光电编码器、磁编码器都容易受外界环境的干扰。光电编码器具有检测分辨率高优点，但在高粉尘环境下分辨率容易受到影响，并且光源灯泡寿命短、使用环境要求高；磁编码器具有灵敏度高、传送无抖动、使用寿命长的优点，但存在一定程度的磁不敏感区，在高磁环境中会降低电机运行的可靠性。陀螺仪通过测量物体一段时间内旋转的角度，再与测量时间相乘，获得物体的转速。利用陀螺仪测量转速时，虽然噪声小，精度高，但陀螺仪输出角度时由转速累加获得，长时间测量时，由于误差累计会出现较大的偏差，准确性差。2019年7月23日公开的中国专利CN110043430A提供了一种应用陀螺仪传感器测量风机轮毂转速的方法，包括如下步骤：将陀螺仪传感器安装于风机轮毂上；陀螺仪传感器在轮毂旋转的过程中实时检测X，Y，Z三个轴旋转的角速度Axz，Ayz和Axy；根据勾股定理，可以得到轮毂总的实时角速度；该发明仅利用陀螺仪传感器测量风机轮毂的转速，长时间测量会导致误差累计，使转速出现较大的偏差，测量结果的准确性差。发明内容本发明为克服上述现有技术对伺服电机进行测速时，准确性与可靠性差的缺陷，提供一种基于陀螺仪辅助测量伺服电机角度的方法，通过测量伺服电机的角度实现对伺服电机转速的测量，提高了测量结果的准确性和测量过程的可靠性，实现了对伺服电机的高精度转速控制，保证了伺服电机的正常运行。为解决上述技术问题，本发明的技术方案如下：本发明提供一种基于陀螺仪辅助测量伺服电机角度的方法，所述方法包括：S1：伺服电机开机运行，获取伺服电机k时刻的编码器角度和k时刻的陀螺仪角速度；S2：将k时刻的陀螺仪角速度转换为k时刻的陀螺仪角度；S3：设置伺服电机k-1时刻的实际输出角度，计算k时刻的编码器角度与k-1时刻的实际输出角度的变化率；S4：设置变化率阈值，比较变化率与变化率阈值的大小；若变化率大于变化率阈值，则计算k时刻的编码器角度和k时刻的陀螺仪角度的差值，执行步骤S5；否则执行步骤S6；S5：设置差值阈值，比较差值与差值阈值的大小；若差值大于差值阈值，则将k时刻的陀螺仪角度作为伺服电机k时刻的实际输出角度；否则进行步骤S6；S6：将k时刻的编码器角度与k时刻的陀螺仪角度进行卡尔曼角度融合，将卡尔曼角度融合结果作为伺服电机k时刻的实际输出角度。本发明在采样周期内获取伺服电机的编码器角度和陀螺仪角速度，并将陀螺仪角速度转化为陀螺仪角度；比较伺服电机k时刻编码器角度和伺服电机k-1时刻的实际输出角度的变化率，若k时刻的编码器角度突变，且与k时刻的陀螺仪角度差值很大时，认为编码器角度受外界影响出现错误，将k时刻的陀螺仪角度作为伺服电机k时刻的实际输出角度；否则对k时刻的编码器角度与k时刻的陀螺仪角度进行卡尔曼角度融合，将融合结果作为伺服电机k时刻的实际输出角度。优选地，利用伺服电机原有的编码器获取伺服电机的编码器角度。优选地，所述原有的编码器为光电编码器或磁编码器。优选地，利用陀螺仪获得伺服电机的陀螺仪角速度，具体方法为：利用陀螺仪检测伺服电机转轴的旋转，输出检测信号转换值；根据陀螺仪的灵敏度对应表确认当前陀螺仪的灵敏度；根据信号转换值和灵敏度计算陀螺仪角速度：陀螺仪角速度＝信号转换值/灵敏度。优选地，设置采样周期，每间隔一个采样周期，获取一次伺服电机的编码器角度和伺服电机的陀螺仪角速度；所述采样周期根据陀螺仪的采样频率确定，具体为：式中，B表示采样周期，f表示陀螺仪的采样频率。优选地，所述步骤S2中，将k时刻的陀螺仪角速度转换为k时刻的陀螺仪角度的具体方法为：Uk＝uk*B式中，Uk表示k时刻的陀螺仪角度，uk表示k时刻的陀螺仪角速度，B表示采样周期。优选地，所述S3中，计算k时刻的编码器角度与k-1时刻的实际输出角度的变化率的具体方法为：式中，αk表示k时刻的编码器角度与k-1时刻偏伺服电机的实际输出角的变化率，zk表示k时刻的原编码器角度，表示k-1时刻的实际输出角度。优选地，所述步骤S6中，卡尔曼角度融合的具体步骤为；S6.1：预测伺服电机k时刻的输出角度：其中，A表示状态转移矩阵，B表示采样周期，表示k时刻的预测输出角度，表示k-1时刻的实际输出角度，uk表示k时刻的陀螺仪角速度；S6.2：预测伺服电机k时刻的误差协方差矩阵：Pk|k-1＝APk-1AT+Q其中，Pk|k-1表示k时刻的预测误差协方差矩阵，Pk-1表示k-1时刻的误差协方差矩阵，T表示求转置操作，Q表示陀螺仪角速度的噪声协方差矩阵；S6.3：根据k时刻的预测误差协方差矩阵计算卡尔曼增益：其中，Kk表示卡尔曼增益，H表示转换矩阵，R表示编码器的噪声协方差矩阵；S6.4：根据k时刻的预测输出角度和卡尔曼增益计算k时刻的最优预测输出角度：其中，时刻的最优预测输出角度，zk表示k时刻的编码器角度；S6.5：将k时刻的最优预测输出角度作为k时刻的实际输出角度。优选地，卡尔曼角度融合的还包括以下步骤：S6.6：更新k时刻的误差协方差矩阵：Pk＝Pk|k-1其中，Pk表示k时刻的最优预测输出角度下的误差协方差矩阵，I表示单位矩阵；S6.7：更新时刻，将k时刻的实际输出角度作为下一次卡尔曼角度融合时的k-1时刻的实际输出角度，将k时刻的误差协方差矩阵作为下一次的卡尔曼角度融合时的k-1时刻的误差协方差矩阵，重复步骤S6.1-S6.6，实现连续的卡尔曼角度融合。优选地，所述方法还包括：S7：将伺服电机k时刻的实际输出角度返回步骤S3作为下一次计算时的伺服电机k-1时刻的实际输出角度，重复步骤S1-S6，实现对伺服电机实际输出角度的实时连续测量，直至伺服电机关机。与现有技术相比，本发明技术方案的有益效果是：本发明在采样周期内获取伺服电机的编码器角度和陀螺仪角速度，并将陀螺仪角速度转化为陀螺仪角度；比较伺服电机k时刻编码器角度和伺服电机k-1时刻的实际输出角度的变化率，若k时刻的编码器角度突变，且与k时刻的陀螺仪角度差值很大时，认为编码器角度受外界影响出现错误，将k时刻的陀螺仪角度作为伺服电机k时刻的实际输出角度，保证了测量过程的可靠性和伺服电机的正常运行；否则将k时刻的编码器角度与k时刻的陀螺仪角度进行卡尔曼角度融合，将融合结果作为伺服电机k时刻的实际输出角度，消除了长时间测量时陀螺仪角度的累积误差，保证了测量结果的准确性，实现了对伺服电机的高精度转速控制。附图说明图1为实施例所述的一种基于陀螺仪辅助测量伺服电机角度的方法的流程图。具体实施方式附图仅用于示例性说明，不能理解为对本专利的限制；为了更好说明本实施例，附图某些部件会有省略、放大或缩小，并不代表实际产品的尺寸；对于本领域技术人员来说，附图中某些公知结构及其说明可能省略是可以理解的。下面结合附图和实施例对本发明的技术方案做进一步的说明。实施例本实施例提供一种基于陀螺仪辅助测量伺服电机角度的方法，如图1所示，所述方法包括：S1：伺服电机开机运行，获取伺服电机k时刻的编码器角度和k时刻的陀螺仪角速度；S2：将k时刻的陀螺仪角速度转换为k时刻的陀螺仪角度；S3：设置伺服电机k-1时刻的实际输出角度，计算k时刻的编码器角度与k-1时刻的实际输出角度的变化率；S4：设置变化率阈值，比较变化率与变化率阈值的大小；若变化率大于变化率阈值，则计算k时刻的编码器角度和k时刻的陀螺仪角度的差值，执行步骤S5；否则执行步骤S6；S5：设置差值阈值，比较差值与差值阈值的大小；若差值大于差值阈值，则将k时刻的陀螺仪角度作为伺服电机k时刻的实际输出角度；否则进行步骤S6；S6：将k时刻的编码器角度与k时刻的陀螺仪角度进行卡尔曼角度融合，将卡尔曼角度融合结果作为伺服电机k时刻的实际输出角度；S7：将伺服电机k时刻的实际输出角度返回步骤S3作为下一次计算时的伺服电机k-1时刻的实际输出角度，重复步骤S1-S6，实现对伺服电机实际输出角度的实时连续测量，直至伺服电机关机。利用伺服电机原有的编码器获取伺服电机的编码器角度，所述原有的编码器为光电编码器或磁编码器。利用陀螺仪获得伺服电机的陀螺仪角速度，具体方法为：利用陀螺仪检测伺服电机转轴的旋转，获得检测信号转换值；根据陀螺仪的灵敏度对应表确认当前陀螺仪的灵敏度；根据信号转换值和灵敏度计算陀螺仪角速度：陀螺仪角速度＝信号转换值/灵敏度。下表为陀螺仪的灵敏度对应表，表中第三行第四列为陀螺仪的量程，四五行第四列为陀螺仪的灵敏度，最后一列为量程和灵敏度的单位；以陀螺仪量程±250°/s为例，对应FS-SEL＝0的情况；FS-SEL＝0时，陀螺仪的灵敏度为131LSB/。假设当量程为±1000°/s时，陀螺仪检测伺服电机转轴，获得的信号转换值为200，从下表中可知，陀螺仪的灵敏度为32.8LSB/，此时陀螺仪的角速度＝200/32.8＝6.09756°/s，信号转换值可以为负值，出现负值时，说明设备从现有的方向向相反的方向转动。设置采样周期，每间隔一个采样周期，获取一次伺服电机的编码器角度和伺服电机的陀螺仪角速度；所述采样周期根据陀螺仪的采样频率确定，具体为：式中，B表示采样周期，f表示陀螺仪的采样频率。所述步骤S2中，将k时刻的陀螺仪角速度转换为k时刻的陀螺仪角度的具体方法为：Uk＝uk*B式中，Uk表示k时刻的陀螺仪角度，uk表示k时刻的陀螺仪角速度，B表示采样周期。所述S3中，计算k时刻的编码器角度与k-1时刻的实际输出角度的变化率的具体方法为：式中，αk表示k时刻的编码器角度与k-1时刻偏伺服电机的实际输出角的变化率，zk表示k时刻的原编码器角度，表示k-1时刻的实际输出角度。所述步骤S6中，卡尔曼角度融合的具体步骤为；S6.1：预测伺服电机k时刻的输出角度：其中，A表示状态转移矩阵，B表示采样周期，表示k时刻的预测输出角度，表示k-1时刻的实际输出角度，uk表示k时刻的陀螺仪角速度；S6.2：预测伺服电机k时刻的误差协方差矩阵：Pk|k-1＝APk-1AT+Q其中，Pk|k-1表示k时刻的预测误差协方差矩阵，Pk-1表示k-1时刻的误差协方差矩阵，T表示求转置操作，Q表示陀螺仪角速度的噪声协方差矩阵；S6.3：根据k时刻的预测误差协方差矩阵计算卡尔曼增益：其中，Kk表示卡尔曼增益，H表示转换矩阵，R表示编码器的噪声协方差矩阵；S6.4：根据k时刻的预测输出角度和卡尔曼增益计算k时刻的最优预测输出角度：其中，时刻的最优预测输出角度，zk表示k时刻的编码器角度；S6.5：将k时刻的最优预测输出角度作为k时刻的实际输出角度。S6.6：更新k时刻的误差协方差矩阵：Pk＝Pk|k-1其中，Pk表示k时刻的最优预测输出角度下的误差协方差矩阵，I表示单位矩阵；S6.7：更新时刻，将k时刻的实际输出角度作为下一次卡尔曼角度融合时的k-1时刻的实际输出角度，将k时刻的误差协方差矩阵作为下一次的卡尔曼角度融合时的k-1时刻的误差协方差矩阵，重复步骤S6.1-S6.6，实现连续的卡尔曼角度融合。在具体实过程中，在采样周期内获取伺服电机的编码器角度和陀螺仪角速度，并将陀螺仪角速度转化为陀螺仪角度；比较k时刻编码器角度和k-1时刻的实际输出角度的变化率，k时刻编码器角度突变，且与k时刻的陀螺仪角度差值很大时，认为编码器角度受外界影响出现错误，将k时刻的陀螺仪角度作为伺服电机k时刻的实际输出角度，保证了测量过程的可靠性；否则将k时刻的编码器角度与k时刻的陀螺仪角度进行卡尔曼滤波，作为伺服电机k时刻的实际输出角度，消除了长时间测量时陀螺仪角度的累积误差，保证了测量结果的准确性。将k时刻的实际输出角度作为下一次计算时的k-1时刻的实际输出角度，重复以上步骤，实现对伺服电机实际输出角度的实时连续测量。本实施例可在高尘、高磁等恶劣环境下获取伺服电机准确的实际输出角度，保证伺服电机正常运行，实现了对伺服电机高精度的转速控制。显然，本发明的上述实施例仅仅是为清楚地说明本发明所作的举例，而并非是对本发明的实施方式的限定。对于所属领域的普通技术人员来说，在上述说明的基础上还可以做出其它不同形式的变化或变动。这里无需也无法对所有的实施方式予以穷举。凡在本发明的精神和原则之内所作的任何修改、等同替换和改进等，均应包含在本发明权利要求的保护范围之内。
