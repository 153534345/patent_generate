标题title
一种基于双目视觉的岩体爆破块度自动分析装置及方法
摘要abst
本发明公布了一种基于双目视觉的岩体爆破块度自动分析装置及方法，主要包括基础模块、相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块、岩石块度统计模块。由基础模块控制硬件部分并联合其他模块构成整体系统框架，通过基础模块中的设备指标配置单元进行配置设备信息及参数。该系统识别完岩块图像后，用户可以通过控制器查看并显示岩体块度的分布信息。本发明提供了基于自动化监测、数字技术以及双目视觉图像处理等技术进行图像数据实时采集和岩块分布分析，实时性和可靠性良好，有利于对现场岩块分布进行实时检测。
权利要求书clms
1.一种基于双目视觉的岩体爆破块度自动分析装置，具有摄像头、处理器、存储器、显示器和控制器，其特征在于：所述处理器内含基础模块、相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块、岩石块度统计模块和公共数据存储区；所述基础模块包括双目图像采集模块、图像存储模块、图像拷贝模块、信息显示模块、设备指标配置模块和设备控制模块；所述双目图像采集模块接收摄像头获得的图像，并存入存储器中，所述图像存储模块与存储器相连，所述信息显示模块与显示器相连，所述设备控制模块和控制器相连接，所述图像拷贝模块连接基础模块、相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块和岩石块度统计模块，在基础模块中与存储器相连接，所述设备指标配置模块分别与摄像头、存储器、显示器、控制器相连，用于控制设备输或输出的数据模式，以及系统相关参数、单位及指标；所述图像存储模块分别与相机深度转换模块、岩块深度图提取模块、岩块分割模块相连接，图像存储模块和设备指标配置模块分别与单体岩块实际大小估测模块相连接；信息显示模块分别与相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块和岩石块度统计模块相连，用于为各模块提供显示事件；所述相机深度转换模块的畸变矫正单元与图像存储模块相连，用于对采集的原始图像进行畸变矫正；相机深度转换模块与岩块分割模块相连接；相机深度转换模块的一个输出端与岩块深度图提取模块相连接，相机深度转换模块的一个输入端与单体岩块实际大小估测模块相连接；相机深度转换模块的一个输出端与图像拷贝模块相连接，岩块深度图提取模块的一个输出端与信息显示模块相连，用于提供显示事件，显示当前双目图像计算得到的视差图；所述岩块深度图提取模块与图像存储模块相连接，岩块深度图提取模块的一个输出端与岩块分割模块相连接，岩块深度图提取模块的一个输入端与相机深度转换模块的一个输出端相连接，岩块深度图提取模块的一个输出端与信息显示模块相连，用于提供显示事件，显示当前双目图像计算得到的视差图；所述岩块分割模块与图像存储模块相连，岩块分割模块的一个输入端与岩块深度图提取模块的一个输出端相连，岩块分割模块的一个输出端与单体岩块实际大小估测模块的一个输入端相连，岩块分割模块与岩石块度统计模块相连，岩块分割模块一个输出端与信息显示模块相连，用于提供显示事件，显示岩块实际分割状况；所述单体岩块实际大小估测模块分别图像存储模块和设备指标配置模块，单体岩块实际大小估测模块与岩石块度统计模块相连接，单体岩块实际大小估测模块与相机深度转换模块相连接，用于获取图像坐标转世界坐标的参数；单体岩块实际大小估测模块的一个输入端与岩块分割模块的一个输出端相连，用于接收单一岩块信息进行实际大小估测；单体岩块实际大小估测一个输出端与信息显示模块相连，用于提供显示事件，显示当前岩块的实际大小估测状况；所述岩石块度统计模块分别与图像存储模块、岩块分割模块相连，用于接收全部岩块信息进行大小分布统计；岩石块度统计模块与单体岩块实际大小估测模块相连，用于计算单个岩块的实际大小信息；岩石块度统计模块与信息显示模块相连，用于提供显示事件，显示当前所有岩块的实际大小分布状况；所述公共数据存储区分别与相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块和岩石块度统计模块相连，用于存储各模块提交的裂隙特征数据信息包，所述公共数据存储区还与基础模块相连接，用于存储和初始化固化的设备默认参数。2.根据权利要求1所述的一种基于双目视觉的岩体爆破块度自动分析装置，其特征在于：所述相机深度转换模块包括畸变矫正单元、视差坐标变换单元和世界坐标计算单元；所述畸变矫正单元与岩块深度图提取模块相连，所述畸变矫正单元用于输入图像数据并对初始畸变图像进行矫正，将矫正后图像数据输出给岩块深度图模块进行像素级深度估计；所述视差坐标变换单元与世界坐标计算单元相连接，所述视差坐标变换单元用于输入视差及图像坐标；所述世界坐标计算单元用于输出世界坐标；所述岩块深度图提取模块包括特征扫描单元、特征匹配单元和视差计算单元；所述特征扫描单元、特征匹配单元和视差计算单元依次连接，用于提供数据传递通道；所述特征扫描单元用于输入双目图像数据并输出视差图，所述视差计算单元用于计算最佳匹配的视差值；所述特征匹配单元用于计算特征数据的匹配度，并收集视差计算单元返回的视差值构建视差图；视差计算单元与特征匹配单元相连，用于计算最佳匹配特征的视差值；所述特征匹配单元与岩块分割模块相连，将提取到的视差图传递给岩块分割模块进行后续分割；所述岩块分割模块包括岩块粗分割单元、噪声滤除单元和岩块整合单元；所述岩块粗分割单元通过噪声滤除单元和岩块整合单元连接，岩块粗分割单元用于输入深度图像数据，噪声滤除单元用于将非岩块的噪声小区域滤除，岩块整合单元用于输出全部岩块信息；所述单体岩块实际大小估测模块包括轮廓深度统计单元、轮廓宽度统计单元和实际大小计算单元；所述轮廓深度统计单元通过轮廓宽度统计单元与实际大小计算单元相连接；所述轮廓深度统计单元用于输入单个岩块信息，所述实际大小计算单元用于输出岩块实际大小；所述岩石块度统计模块包括块度提取单元、块度分布统计单元和信息整合单元；所述块度提取单元、块度分布统计单元和信息整合单元依次相连，所述块度提取单元用于输入单个岩块信息，所述信息整合单元用于输出岩块份布信息。3.根据权利要求1所述的一种基于双目视觉的岩体块度自动分析装置的分析方法，其特征在于包括以下步骤：步骤1：根据所需参数，进行设备指标配置和设备初始化，其中参数包括摄像头获取的图像大小、镜头畸变矫正系数；配置结束后，摄像头，显示器及其他设备均按所需参数正常工作；启动双目图像采集模块，将岩块图像按照相应格式采集到图像存储模块；步骤2：图像存储模块将步骤1中摄像头采集到的岩块图像传输至相机深度转换模块，相机深度转换模块从基础模块中获取配置信息，对图像进行畸变矫正；步骤3：相机深度转换模块将步骤2中畸变矫正后的图像传输给岩块深度图提取模块，岩块深度图提取模块对岩块进行视差图计算，并将原始双目图像融合为一副图像，然后利用图像拷贝模块对视差图与融合图像进行备份；步骤4：岩块深度图提取模块将步骤3中的视差图像传输给岩块分割模块进行岩块分割，岩块分割模块利用图像拷贝单元对分割图进行备份，并将所有岩块的信息打包；步骤5：岩块分割模块将步骤4中得到的所有岩块信息包，输入单体岩块实际大小估测模块，单体岩块实际大小估测模块从基础模块中获取配置信息，分别对单一的岩块进行实际大小估测，将每个岩块的实际大小信息提取并打包入岩块信息中；步骤6：单体岩块实际大小估测模块将步骤5中更新后的所有岩块信息包，传递给岩石块度统计模块，岩石块度统计模块通过统计所有岩块的信息,并进行重新整合，形成实际大小分布的直方图；步骤7：将步骤5中岩块分割模块更新后的所有岩块信息包，传递给岩石块度统计模块，并结合步骤3中得到的融合图像备份及分割图备份，在融合图像上，对不同大小的岩块进行按颜色标记。4.根据权利要求3所述的一种基于双目视觉的岩体块度自动分析装置的分析方法，其特征在于所述步骤1包括以下步骤：步骤1.1：从设备公共数据存储区中导入默认摄像头配置参数，对摄像头进行参数初始化初始化；步骤1.2：从设备公共数据存储区中导入默认配置镜头矫正参数以及视差变换参数，对畸变矫正及视差参数进行初始化；步骤1.3：从设备公共数据存储区中导入显示参数，对显示器进行初始化；步骤1.4：从将上述参数信息上报信息显示模块，弹出配置信息并咨询是否修改；步骤1.5：若未修改则直接进入系统，若修改则将参数提交至公共数据存储区，并重复步骤1.1～步骤1.4。5.根据权利要求3所述的一种基于双目视觉的岩体块度自动分析装置的分析方法，其特征在于所述步骤2包括以下步骤：步骤2.1：初始化图像采集单元，并控制其采集一帧双目图像后停止工作，然后将图像保存到存储单元中，并提交给畸变矫正单元；步骤2.2：畸变矫正单元从设备指标配置模块中取得步骤1.2中初始化的畸变矫正参数；对步骤2.1得到的图像所有坐标进行坐标畸变矫正，矫正公式如下，其中k1、k2、k3是矫正参数，x，y是原始坐标，r是该坐标到图像中心的像素欧式距离r2＝x2+y2：步骤2.3：畸变矫正单元获取步骤2.3中矫正过的坐标，对步骤2.1得到的图像进行坐标重映射，得到矫正图像后存入存储器中；步骤2.4：畸变矫正单元将矫正后的图像输出，提交给岩块深度图提取模块。6.根据权利要求3所述的一种双目视觉的岩体块度自动分析装置的分析方法，其特征在于所述步骤3包括以下步骤：步骤3.1：特征扫描单元从图像存储模块中获得矫正后的一帧岩块双目图像，分别对左右视图进行边缘特征检测，作为初始特征图；步骤3.2：从设备指标配备模块中获取抑制阈值，通过该阈值的判断将初始特征图中所有较小的边缘特征剔除，全部剔除后该图作为横向视差特征匹配导向图；步骤3.3：将步骤3.2中得到的导向图中未被剔除的所有点坐标作为有效点坐标，并对其按行打包，提交至信息包并传送至特征匹配单元；步骤3.4：获取步骤3.3中得到的每行点坐标，对查询其导向图的值并每行进行梯度排序，将顺序值也提交至信息包；步骤3.5：从公共数据区获取最大检测窗口及特征描述窗口大小，并从上述步骤3.4中得到消息包中提取每行检测点的坐标，分别提取其特征描述子，在检测窗口内对其描述子进行按梯度降序的匹配，寻找其最佳匹配点，将两者中心颜色值取平均放入融合图，并将坐标提交至视差计算单元；步骤3.6：将步骤3.5匹配到的最佳匹配点坐标与匹配源点坐标做差，并将值放入视差图中；步骤3.7：将上述所有导向点填充结束后，进行保边滤波，并对非导向图上的点进行线性插值计算其深度，并放入视差图中，并对其融合图也做线性插值填充；步骤3.8：将上述视差图与融合图提交图像拷贝模块，备份到存储器中；步骤3.9：触发显示视差图事件时，将显示备份视差图；触发显示融合图事件时，将显示融合后的图像。7.根据权利要求3所述的一种双目视觉的岩体块度自动分析装置的分析方法，其特征在于所述步骤4包括以下步骤：步骤4.1：岩块粗分割单元从存储器中获得视差图，进行极小值滤波，再使用高斯滤波进行平滑滤除高频信号，并保存为预分割图像；步骤4.2：将步骤4.1中的预分割图像输入岩块粗分割单元，对其求梯度图，从公共数据存储区中获取预分割阈值，对梯度图进行二值化分割，提取出其低值区域，并计算区域均值作为初始均值保存；步骤4.3：对步骤4.2提取的并对其进行边界深度递减合并，每次取出边界中较小者合并到该区域上，并重新计算该区域的均值，直到图像被完全分割，得到粗分割二值图，通过图像拷贝模块将其备份到存储器中；步骤4.4：将上述各区域最终均值与初始均值比较，将小于额定变化值的区域过滤，提取大于额定变化的区域作为岩块候选区；步骤4.5：对步骤4.4得到的候选区进行区域面积计算，将少于额定面积的区域作为噪声剔除，作为岩块最终分割结果；步骤4.6：将步骤4.5得到的岩块结果保存，并对其进行边界跟踪提取轮廓坐标以及深度值，与结果一起打包到岩块信息包中，并提交公共数据存储区；步骤4.7：触发显示分割图事件时，将显示备份分割图。8.根据权利要求3所述的一种双目视觉的岩体块度自动分析装置的分析方法，其特征在于所述步骤5包括以下步骤：步骤5.1：轮廓深度统计单元从设备指标配置模块中导入视差变换参数，将上述步骤4.6提取的轮廓坐标及深度值导入视差坐标变换单元，求得该点在相机坐标下的实际坐标；步骤5.2：对上述步骤5.1计算得到x-z平面投影坐标进行最小二乘直线拟合，并将直线方程保存，所用直线方程如下：z＝kx+b步骤5.3：轮廓宽度统计单元从存储器中获取上述步骤4.3计算得到粗分割二值图，求取每个轮廓外接矩形框并记录，并求取轮廓内部所占面积，并利用该图作为掩模，获取该岩块每个深度图上的深度值zu，利用上述步骤5.2所求方程求得对应底部深度zd，得到该坐标的相对深度zxy＝zu-zd，利用积分求得岩块体积：式中，fx和fy是在该位置处的分辨率；步骤5.4：将上述步骤5.3求得的体积乘两倍作为块度，同外接矩形框和轮廓面积一起打包到岩块信息包中，并提交公共数据存储区。9.根据权利要求3所述的一种双目视觉的岩体块度自动分析装置的分析方法，其特征在于所述步骤6包括以下步骤：块度提取单元从信息包中获得每个岩块的体积，输入到块度分布统计单元中，进行频数分布直方图统计，并将其归一化后输入到信息整合单元中，将信息包与直方图整合为一个新的包，输出。10.根据权利要求3所述的一种双目视觉的岩体块度自动分析装置的分析方法，其特征在于所述步骤7包括以下步骤：步骤7.1：块度提取单元将每个岩块的体积送入块度分布统计单元，统计所有岩块的体积分布直方图；步骤7.2：块度分布统计单元将直方图信息送入信息整合单元，将步骤5.4提交的信息包与该直方图一起打包输出；步骤7.3：点击显示块度分布直方图时，将显示当前图像的块度分布直方图。
说明书desc
技术领域本发明涉及岩土工程领域岩体爆破块度检测，尤其是涉及一种基于双目视觉的岩体爆破块度自动分析装置及方法。背景技术在岩石爆破工程中，块度是评价其效果的重要参数之一，将直接影响装运，机械破碎等后续作业。对于爆破岩体块度的检测，具有工序复杂，人工测量成本高，误差大，要查看现场某个岩块块度大小，需要进行非常复杂的工作。目前，对于岩体块度检测的岩块大小信息获取常采用直接测量方法或者传统筛分法等，比如直接测量方法是在测试的岩块堆上设置若干条直线带，然后观测各岩块占直线的长度，并计算各级岩块分布。这种方法有很多缺陷，一方面由于以直线带为主要工具，对岩块进行目测估计，存在着个体测量误差；另一方面技术人员可能会对数据的误读和误录，使得岩块记录长度与其实际长度产生较大的偏差，或者对数据记录格式的不正确，导致后续分析工作变得困难。发明内容本发明要解决的技术问题是提供一种基于双目视觉的岩体爆破块度自动分析装置及方法，该装置能够实时获取爆堆块度分布信息，为开展复杂环境下爆堆块度分析提供技术手段，为爆破参数设计及优化提供参考和依据。为了解决现有技术存在的问题，本发明采用的技术方案如下：一种基于双目视觉的岩体爆破块度自动分析装置，具有摄像头、处理器、存储器、显示器和控制器，所述处理器内含基础模块、相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块、岩石块度统计模块和公共数据存储区；所述基础模块包括双目图像采集模块、图像存储模块、图像拷贝模块、信息显示模块、设备指标配置模块和设备控制模块；所述双目图像采集模块接收摄像头获得的图像，并存入存储器中，所述图像存储模块与存储器相连，所述信息显示模块与显示器相连，所述设备控制模块和控制器相连接，所述图像拷贝模块连接基础模块、相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块和岩石块度统计模块，在基础模块中与存储器相连接，所述设备指标配置模块分别与摄像头、存储器、显示器、控制器相连，用于控制设备输或输出的数据模式，以及系统相关参数、单位及指标；所述图像存储模块分别与相机深度转换模块、岩块深度图提取模块、岩块分割模块相连接，图像存储模块和设备指标配置模块分别与单体岩块实际大小估测模块相连接；信息显示模块分别与相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块和岩石块度统计模块相连，用于为各模块提供显示事件；所述相机深度转换模块的畸变矫正单元与图像存储模块相连，用于对采集的原始图像进行畸变矫正；相机深度转换模块与岩块分割模块相连接；相机深度转换模块的一个输出端与岩块深度图提取模块相连接，相机深度转换模块的一个输入端与单体岩块实际大小估测模块相连接；相机深度转换模块的一个输出端与图像拷贝模块相连接，岩块深度图提取模块的一个输出端与信息显示模块相连，用于提供显示事件，显示当前双目图像计算得到的视差图；所述岩块深度图提取模块与图像存储模块相连接，岩块深度图提取模块的一个输出端与岩块分割模块相连接，岩块深度图提取模块的一个输入端与相机深度转换模块的一个输出端相连接，岩块深度图提取模块的一个输出端与信息显示模块相连，用于提供显示事件，显示当前双目图像计算得到的视差图；所述岩块分割模块与图像存储模块相连，岩块分割模块的一个输入端与岩块深度图提取模块的一个输出端相连，岩块分割模块的一个输出端与单体岩块实际大小估测模块的一个输入端相连，岩块分割模块与岩石块度统计模块相连，岩块分割模块一个输出端与信息显示模块相连，用于提供显示事件，显示岩块实际分割状况；所述单体岩块实际大小估测模块分别图像存储模块和设备指标配置模块，单体岩块实际大小估测模块与岩石块度统计模块相连接，单体岩块实际大小估测模块与相机深度转换模块相连接，用于获取图像坐标转世界坐标的参数；单体岩块实际大小估测模块的一个输入端与岩块分割模块的一个输出端相连，用于接收单一岩块信息进行实际大小估测；单体岩块实际大小估测一个输出端与信息显示模块相连，用于提供显示事件，显示当前岩块的实际大小估测状况；所述岩石块度统计模块分别与图像存储模块、岩块分割模块相连，用于接收全部岩块信息进行大小分布统计；岩石块度统计模块与单体岩块实际大小估测模块相连，用于计算单个岩块的实际大小信息；岩石块度统计模块与信息显示模块相连，用于提供显示事件，显示当前所有岩块的实际大小分布状况。所述公共数据存储区分别与相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块和岩石块度统计模块相连，用于存储各模块提交的裂隙特征数据信息包，所述公共数据存储区还与基础模块相连接，用于存储和初始化固化的设备默认参数。进一步地，所述相机深度转换模块包括畸变矫正单元、视差坐标变换单元和世界坐标计算单元；所述畸变矫正单元与岩块深度图提取模块相连，所述畸变矫正单元用于输入图像数据并对初始畸变图像进行矫正，将矫正后图像数据输出给岩块深度图模块进行像素级深度估计；所述视差坐标变换单元与世界坐标计算单元相连接，所述视差坐标变换单元用于输入视差及图像坐标；所述世界坐标计算单元用于输出世界坐标；所述岩块深度图提取模块包括特征扫描单元、特征匹配单元和视差计算单元；所述特征扫描单元、特征匹配单元和视差计算单元依次连接，用于提供数据传递通道；所述特征扫描单元用于输入双目图像数据并输出视差图，所述视差计算单元用于计算最佳匹配的视差值；所述特征匹配单元用于计算特征数据的匹配度，并收集视差计算单元返回的视差值构建视差图；视差计算单元与特征匹配单元相连，用于计算最佳匹配特征的视差值；所述特征匹配单元与岩块分割模块相连，将提取到的视差图传递给岩块分割模块进行后续分割；所述岩块分割模块包括岩块粗分割单元、噪声滤除单元和岩块整合单元；所述岩块粗分割单元通过噪声滤除单元和岩块整合单元连接，岩块粗分割单元用于输入深度图像数据，噪声滤除单元用于将非岩块的噪声小区域滤除，岩块整合单元用于输出全部岩块信息。所述单体岩块实际大小估测模块包括轮廓深度统计单元、轮廓宽度统计单元和实际大小计算单元；所述轮廓深度统计单元通过轮廓宽度统计单元与实际大小计算单元相连接；所述轮廓深度统计单元用于输入单个岩块信息，所述实际大小计算单元用于输出岩块实际大小；所述岩石块度统计模块包括块度提取单元、块度分布统计单元和信息整合单元；所述块度提取单元、块度分布统计单元和信息整合单元依次相连，所述块度提取单元用于输入单个岩块信息，所述信息整合单元用于输出岩块份布信息。一种基于双目视觉的岩体块度自动分析装置的分析方法，包括以下步骤：步骤1：根据所需参数，进行设备指标配置和设备初始化，其中参数包括摄像头获取的图像大小、镜头畸变矫正系数；配置结束后，摄像头，显示器及其他设备均按所需参数正常工作；启动双目图像采集模块，将岩块图像按照相应格式采集到图像存储模块；步骤2：图像存储模块将步骤1中摄像头采集到的岩块图像传输至相机深度转换模块，相机深度转换模块从基础模块中获取配置信息，对图像进行畸变矫正；步骤3：相机深度转换模块将步骤2中畸变矫正后的图像传输给岩块深度图提取模块，岩块深度图提取模块对岩块进行视差图计算，并将原始双目图像融合为一副图像，然后利用图像拷贝模块对视差图与融合图像进行备份；步骤4：岩块深度图提取模块将步骤3中的视差图像传输给岩块分割模块进行岩块分割，岩块分割模块利用图像拷贝单元对分割图进行备份，并将所有岩块的信息打包；步骤5：岩块分割模块将步骤4中得到的所有岩块信息包，输入单体岩块实际大小估测模块，单体岩块实际大小估测模块从基础模块中获取配置信息，分别对单一的岩块进行实际大小估测，将每个岩块的实际大小信息提取并打包入岩块信息中；步骤6：单体岩块实际大小估测模块将步骤5中更新后的所有岩块信息包，传递给岩石块度统计模块，岩石块度统计模块通过统计所有岩块的信息,并进行重新整合，形成实际大小分布的直方图；步骤7：将步骤5中岩块分割模块更新后的所有岩块信息包，传递给岩石块度统计模块，并结合步骤3中得到的融合图像备份及分割图备份，在融合图像上，对不同大小的岩块进行按颜色标记。进一步地，所述步骤1包括以下步骤：步骤1.1：从设备公共数据存储区中导入默认摄像头配置参数，对摄像头进行参数初始化初始化；步骤1.2：从设备公共数据存储区中导入默认配置镜头矫正参数以及视差变换参数，对畸变矫正及视差参数进行初始化；步骤1.3：从设备公共数据存储区中导入显示参数，对显示器进行初始化；步骤1.4：从将上述参数信息上报信息显示模块，弹出配置信息并咨询是否修改；步骤1.5：若未修改则直接进入系统，若修改则将参数提交至公共数据存储区，并重复步骤1.1～步骤1.4。进一步地，所述步骤2包括以下步骤：步骤2.1：初始化图像采集单元，并控制其采集一帧双目图像后停止工作，然后将图像保存到存储单元中，并提交给畸变矫正单元；步骤2.2：畸变矫正单元从设备指标配置模块中取得步骤1.2中初始化的畸变矫正参数；对步骤2.1得到的图像所有坐标进行坐标畸变矫正，矫正公式如下，其中k1、k2、k3是矫正参数，x，y是原始坐标，r是该坐标到图像中心的像素欧式距离r2＝x2+y2：步骤2.3：畸变矫正单元获取步骤2.3中矫正过的坐标，对步骤2.1得到的图像进行坐标重映射，得到矫正图像后存入存储器中；步骤2.4：畸变矫正单元将矫正后的图像输出，提交给岩块深度图提取模块。进一步地，所述步骤3包括以下步骤：步骤3.1：特征扫描单元从图像存储模块中获得矫正后的一帧岩块双目图像，分别对左右视图进行边缘特征检测，作为初始特征图；步骤3.2：从设备指标配备模块中获取抑制阈值，通过该阈值的判断将初始特征图中所有较小的边缘特征剔除，全部剔除后该图作为横向视差特征匹配导向图；步骤3.3：将步骤3.2中得到的导向图中未被剔除的所有点坐标作为有效点坐标，并对其按行打包，提交至信息包并传送至特征匹配单元；步骤3.4：获取步骤3.3中得到的每行点坐标，对查询其导向图的值并每行进行梯度排序，将顺序值也提交至信息包；步骤3.5：从公共数据区获取最大检测窗口及特征描述窗口大小，并从上述步骤3.4中得到消息包中提取每行检测点的坐标，分别提取其特征描述子，在检测窗口内对其描述子进行按梯度降序的匹配，寻找其最佳匹配点，将两者中心颜色值取平均放入融合图，并将坐标提交至视差计算单元；步骤3.6：将步骤3.5匹配到的最佳匹配点坐标与匹配源点坐标做差，并将值放入视差图中；步骤3.7：将上述所有导向点填充结束后，进行保边滤波，并对非导向图上的点进行线性插值计算其深度，并放入视差图中，并对其融合图也做线性插值填充；步骤3.8：将上述视差图与融合图提交图像拷贝模块，备份到存储器中；步骤3.9：触发显示视差图事件时，将显示备份视差图；触发显示融合图事件时，将显示融合后的图像。进一步地，所述步骤4包括以下步骤：步骤4.1：岩块粗分割单元从存储器中获得视差图，进行极小值滤波，再使用高斯滤波进行平滑滤除高频信号，并保存为预分割图像；步骤4.2：将步骤4.1中的预分割图像输入岩块粗分割单元，对其求梯度图，从公共数据存储区中获取预分割阈值，对梯度图进行二值化分割，提取出其低值区域，并计算区域均值作为初始均值保存；步骤4.3：对步骤4.2提取的并对其进行边界深度递减合并，每次取出边界中较小者合并到该区域上，并重新计算该区域的均值，直到图像被完全分割，得到粗分割二值图，通过图像拷贝模块将其备份到存储器中；步骤4.4：将上述各区域最终均值与初始均值比较，将小于额定变化值的区域过滤，提取大于额定变化的区域作为岩块候选区；步骤4.5：对步骤4.4得到的候选区进行区域面积计算，将少于额定面积的区域作为噪声剔除，作为岩块最终分割结果；步骤4.6：将步骤4.5得到的岩块结果保存，并对其进行边界跟踪提取轮廓坐标以及深度值，与结果一起打包到岩块信息包中，并提交公共数据存储区；步骤4.7：触发显示分割图事件时，将显示备份分割图。进一步地，所述步骤5包括以下步骤：步骤5.1：轮廓深度统计单元从设备指标配置模块中导入视差变换参数，将上述步骤4.6提取的轮廓坐标及深度值导入视差坐标变换单元，求得该点在相机坐标下的实际坐标；步骤5.2：对上述步骤5.1计算得到x-z平面投影坐标进行最小二乘直线拟合，并将直线方程保存，所用直线方程如下：z＝kx+b步骤5.3：轮廓宽度统计单元从存储器中获取上述步骤4.3计算得到粗分割二值图，求取每个轮廓外接矩形框并记录，并求取轮廓内部所占面积，并利用该图作为掩模，获取该岩块每个深度图上的深度值zu，利用上述步骤5.2所求方程求得对应底部深度zd，得到该坐标的相对深度zxy＝zu-zd，利用积分求得岩块体积：式中，fx和fy是在该位置处的分辨率。步骤5.4：将上述步骤5.3求得的体积乘两倍作为块度，同外接矩形框和轮廓面积一起打包到岩块信息包中，并提交公共数据存储区。进一步地，所述步骤6包括以下步骤：块度提取单元从信息包中获得每个岩块的体积，输入到块度分布统计单元中，进行频数分布直方图统计，并将其归一化后输入到信息整合单元中，将信息包与直方图整合为一个新的包，输出。进一步地，所述步骤7包括以下步骤：步骤7.1：块度提取单元将每个岩块的体积送入块度分布统计单元，统计所有岩块的体积分布直方图；步骤7.2：块度分布统计单元将直方图信息送入信息整合单元，将步骤5.4提交的信息包与该直方图一起打包输出；步骤7.3：点击显示块度分布直方图时，将显示当前图像的块度分布直方图。本发明所具有的优点和有益效果是：本发明由基础模块控制硬件部分并联合其他模块构成整体系统框架，通过基础模块中的设备指标配置单元进行配置设备信息及参数，将基础模块、相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块和岩石块度统计模块有机的结合起来，将各部分功能模块进行集成，更加方便实现各部分功能的改进和完善。该系统识别完岩块图像后，用户可以通过控制器查看并显示岩体块度的分布信息。本发明中采用双目视觉技术进行岩石块度分析，从而可以保证岩石块度分析的稳定性。本发明采用自动化监测设备、无线传输技术、非接触视频测量技术以及图像视觉算法技术，实现了数据和图像的实时采集以及反馈分析。本发明提供了基于自动化监测、数字技术以及双目视觉图像处理等技术进行图像数据实时采集和岩块分布分析，实时性和可靠性良好，有利于对现场岩块分布进行实时检测。附图说明图1为基础模块结构框图；图2为相机深度转换模块结构框图；图3为岩块深度图提取模块结构框图；图4为岩块分割模块结构框图；图5为单体岩块实际大小估测模块结构框图；图6为岩石块度统计模块结构框图；图7为本发明一种基于双目视觉的岩体爆破块度自动分析装置数据流向结构框图；图8为本发明一种基于双目视觉的岩体块度自动分析装置结构示意图；图9为本发明一种基于双目视觉的岩体爆破块度自动分析方法提供的视差图计算流程示意图；图10为本发明一种基于双目视觉的岩体爆破块度自动分析方法提供的岩块分割算法流程示意图。具体实施方式为使本发明的技术方案和优点更加清楚，下面结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚完整的描述：在本实施方式中，体积单位为立方厘米，若采用其他单位则需要采用设备指标配置模块1-4进行配置及单位转换。在本实施方式中，直方图分布采用百分比制，若采用其他单位如个数，则需要采用设备指标配置单元1-4进行配置及单位转换。如图8所示，本发明一种基于双目视觉的岩体爆破块度自动分析装置，具有摄像头8-1、处理器8-2、存储器8-3、显示器8-5和控制器8-6，如图7所示，所述处理器8-2内含基础模块1、相机深度转换模块2、岩块深度图提取模块3、岩块分割模块4、单体岩块实际大小估测模块5、岩石块度统计模块6和公共数据存储区7。如图1所示，所述基础模块1包括双目图像采集模块1-1、图像存储模块1-2、图像拷贝模块1-3、信息显示模块1-5、设备指标配置模块1-4和设备控制模块1-6，所述基础模块用于图像采集、缓存、控制和配置设备基础信息；所述双目图像采集模块1-1接收摄像头8-1获得的图像，并存入存储器8-3中，所述图像存储模块1-2与存储器8-3相连，所述信息显示模块1-5与显示器8-5相连，所述设备控制模块1-6和控制器8-6相连接，所述图像拷贝模块1-3连接基础模块、相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块和岩石块度统计模块，并在基础模块内部与存储器8-3相连接，所述设备指标配置模块1-4分别与摄像头8-1、存储器8-3、显示器8-5、控制器8-6相连，用于控制设备输入或输出的数据模式，以及系统相关参数、单位及指标；所述图像存储模块与相机深度转换模块相连，图像存储模块与岩块深度图提取模块相连，图像存储模块与岩块分割模块相连，图像存储模块和设备指标配置模块分别与单体岩块实际大小估测模块相连；信息显示模块与相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块和岩石块度统计模块分别相连，用于为各模块提供显示事件。所述相机深度转换模块的畸变矫正单元与图像存储模块相连，用于对采集的原始图像进行畸变矫正；相机深度转换模块与岩块分割模块相连；相机深度转换模块的一个输出端与岩块深度图提取模块相连，相机深度转换模块的一个输入端与单体岩块实际大小估测模块相连；相机深度转换模块的一个输出端与图像拷贝模块相连，岩块深度图提取模块的一个输出端与信息显示模块相连，用于提供显示事件，显示当前双目图像计算得到的视差图；所述岩块深度图提取模块与图像存储模块相连，岩块深度图提取模块的一个输出端与岩块分割模块相连，岩块深度图提取模块的一个输入端与相机深度转换模块的一个输出端相连，岩块深度图提取模块的一个输出端与信息显示模块相连，用于提供显示事件，显示当前双目图像计算得到的视差图。所述岩块分割模块与图像存储模块相连，岩块分割模块的一个输入端与岩块深度图提取模块的一个输出端相连，岩块分割模块的一个输出端与单体岩块实际大小估测模块的一个输入端相连，岩块分割模块与岩石块度统计模块相连，岩块分割模块一个输出端与信息显示模块相连，用于提供显示事件，显示岩块实际分割状况。所述单体岩块实际大小估测模块分别图像存储模块和设备指标配置模块，单体岩块实际大小估测模块与岩石块度统计模块相连接，单体岩块实际大小估测模块与相机深度转换模块相连接，用于获取图像坐标转世界坐标的参数；单体岩块实际大小估测模块的一个输入端与岩块分割模块的一个输出端相连接，用于接收单一岩块信息进行实际大小估测；单体岩块实际大小估测一个输出端与信息显示模块相连，用于提供显示事件，显示当前岩块的实际大小估测状况。所述岩石块度统计模块与图像存储模块，岩石块度统计模块与岩块分割模块相连接，用于接收全部岩块信息进行大小分布统计；岩石块度统计模块与单体岩块实际大小估测模块相连接，用于计算单个岩块的实际大小信息；岩石块度统计模块还与信息显示模块相连，用于提供显示事件，显示当前所有岩块的实际大小分布状况。所述公共数据存储区分别与相机深度转换模块、岩块深度图提取模块、岩块分割模块、单体岩块实际大小估测模块和岩石块度统计模块相连，用于存储各模块提交的裂隙特征数据信息包，所述公共数据存储区还与基础模块相连接，用于存储和初始化固化的设备默认参数。如图2所示，所述相机深度转换模块包括畸变矫正单元2-1、视差坐标变换单元2-2和世界坐标计算单元2-3；所述畸变矫正单元与岩块深度图提取模块相连，所述畸变矫正单元用于输入图像数据并对初始畸变图像进行矫正，将矫正后数据输出给岩块深度图模块进行像素级深度估计；所述视差坐标变换单元与世界坐标计算单元相连，所述视差坐标变换单元用于输入视差及图像坐标；所述世界坐标计算单元用于输出世界坐标；如图3所示，所述岩块深度图提取模块包括特征扫描单元3-1、特征匹配单元3-2和视差计算单元3-3；所述特征扫描单元、特征匹配单元和视差计算单元依次连接，用于提供数据传递通道；所述特征扫描单元用于输入双目图像数据并输出视差图，所述视差计算单元用于计算最佳匹配的视差值；所述特征匹配单元用于计算特征数据的匹配度，并收集视差计算单元返回的视差值构建视差图；视差计算单元与特征匹配单元相连，用于计算最佳匹配特征的视差值；所述特征匹配单元与岩块分割模块相连，将提取到的视差图传递给岩块分割模块进行后续分割。如图4所示，所述岩块分割模块包括岩块粗分割单元4-1、噪声滤除单元4-2和岩块整合单元4-3；所述岩块粗分割单元通过噪声滤除单元和岩块整合单元相连，岩块粗分割单元用于输入深度图像数据，噪声滤除单元用于将非岩块的噪声小区域滤除，岩块整合单元用于输出全部岩块信息。如图5所示，所述单体岩块实际大小估测模块包括轮廓深度统计单元5-1、轮廓宽度统计单元5-2和实际大小计算单元5-3；所述轮廓深度统计单元通过轮廓宽度统计单元与实际大小计算单元相连；所述轮廓深度统计单元用于输入单个岩块信息，所述实际大小计算单元用于输出岩块实际大小。如图6所示，所述岩石块度统计模块包括块度提取单元6-1、块度分布统计单元6-2和信息整合单元6-3；所述块度提取单元、块度分布统计单元和信息整合单元依次相连，所述块度提取单元用于输入单个岩块信息，所述信息整合单元用于输出岩块份布信息。一种基于双目视觉的岩体块度自动分析装置的分析方法，包括以下步骤：步骤1：根据所需参数，进行设备指标配置和设备初始化，其中参数包括摄像头获取的图像大小、镜头畸变矫正系数；配置结束后，摄像头，显示器及其他设备均按所需参数正常工作；启动双目图像采集模块，将岩块图像按照相应格式采集到图像存储模块；步骤2：图像存储模块将步骤1中摄像头采集到的岩块图像传输至相机深度转换模块，相机深度转换模块从基础模块中获取配置信息，对图像进行畸变矫正；步骤3：相机深度转换模块将步骤2中畸变矫正后的图像传输给岩块深度图提取模块，岩块深度图提取模块对岩块进行视差图计算，并将原始双目图像融合为一副图像，然后利用图像拷贝模块对融合图像进行备份；步骤4：岩块深度图提取模块将步骤3中畸变矫正后的视差图像传输给岩块分割模块进行岩块分割，岩块分割模块利用图像拷贝单元对分割图进行备份，并将所有岩块的信息打包；步骤5：岩块分割模块将步骤4中得到的所有岩块信息包，输入单体岩块实际大小估测模块，单体岩块实际大小估测模块从基础模块中获取配置信息，分别对单一的岩块进行实际大小估测，将每个岩块的实际大小信息提取并打包入岩块信息中；步骤6：单体岩块实际大小估测模块将步骤5中更新后的所有岩块信息包，传递给岩石块度统计模块，岩石块度统计模块通过统计所有岩块的信息,并进行重新整合，形成实际大小分布的直方图；步骤7：将上述步骤5中岩块分割模块更新后的所有岩块信息包，传递给岩石块度统计模块，并结合上述步骤3中得到的融合图像备份及分割图备份，在融合图像上，对不同大小的岩块进行按颜色标记。所述步骤1包括以下步骤：步骤1.1：从设备公共数据存储区中导入默认摄像头配置参数，对摄像头进行参数初始化；步骤1.2：从设备公共数据存储区中导入默认配置镜头矫正参数以及视差变换参数，对畸变矫正及视差参数进行初始化；步骤1.3：从设备公共数据存储区中导入显示参数，对显示器进行初始化；步骤1.4：从将上述参数信息上报信息显示模块，弹出配置信息并咨询是否修改；步骤1.5：若未修改则直接进入系统，若修改则将参数提交至公共数据存储区，并重复步骤1.1～步骤1.4。所述步骤2包括以下步骤：步骤2.1：初始化图像采集单元，并控制其采集一帧双目图像后停止工作，然后将图像保存到存储单元1-2中，并提交给畸变矫正单元2-1；步骤2.2：畸变矫正单元从设备指标配置模块中取得步骤1.2中初始化的畸变矫正参数；对步骤2.1得到的图像所有坐标进行坐标畸变矫正，矫正公式如下，其中k1、k2、k3是矫正参数，x，y是原始坐标，r是该坐标到图像中心的像素欧式距离r2＝x2+y2：步骤2.3：畸变矫正单元获取步骤2.3中矫正过的坐标，对步骤2.1得到的图像进行坐标重映射，得到矫正图像后存入存储器8-3中；步骤2.4：畸变矫正单元将矫正后的图像输出，提交给岩块深度图提取模块。如图9所示，所述步骤3包括以下步骤：步骤3.1：特征扫描单元3-1从图像存储模块1-2中获得矫正后的一帧岩块双目图像，分别对左右视图进行边缘特征检测，作为初始特征图；步骤3.2：从设备指标配备模块中获取抑制阈值，通过该阈值的判断将初始特征图中所有较小的边缘特征剔除，全部剔除后该图作为横向视差特征匹配导向图；步骤3.3：将步骤3.2中得到的导向图中未被剔除的所有点坐标作为有效点坐标，并对其按行打包，提交至信息包并传送至特征匹配单元；步骤3.4：获取步骤3.3中得到的每行点坐标，对查询其导向图的值并每行进行梯度排序，将顺序值也提交至信息包；步骤3.5：从公共数据区获取最大检测窗口及特征描述窗口大小，并从上述步骤3.4中得到消息包中提取每行检测点的坐标，分别提取其特征描述子，在检测窗口内对其描述子进行按梯度降序的匹配，寻找其最佳匹配点，将两者中心颜色值取平均放入融合图，并将坐标提交至视差计算单元；步骤3.6：将上述步骤3.5匹配到的最佳匹配点坐标与匹配源点坐标做差，并将值放入视差图中；步骤3.7：将上述所有导向点填充结束后，进行保边滤波，并对非导向图上的点进行线性插值计算其深度，并放入视差图中，并对其融合图也做线性插值填充；步骤3.8：将上述视差图与融合图提交图像拷贝模块，备份到存储器8-3中；步骤3.9：触发显示视差图事件时，将显示备份视差图；触发显示融合图事件时，将显示融合后的图像。如图10所示，所述步骤4包括以下步骤：步骤4.1：岩块粗分割单元从存储器8-3中获得视差图，进行极小值滤波，再使用高斯滤波进行平滑滤除高频信号，并保存为预分割图像；步骤4.2：将步骤4.1中的预分割图像输入岩块粗分割单元，对其求梯度图，从公共数据存储区中获取预分割阈值，对梯度图进行二值化分割，提取出其低值区域，并计算区域均值作为初始均值保存；步骤4.3：对步骤4.2提取的并对其进行边界深度递减合并，每次取出边界中较小者合并到该区域上，并重新计算该区域的均值，直到图像被完全分割，得到粗分割二值图，通过图像拷贝模块将其备份到存储器8-3中；步骤4.4：将上述各区域最终均值与初始均值比较，将小于额定变化值的区域过滤，提取大于额定变化的区域作为岩块候选区；步骤4.5：对步骤4.4得到的候选区进行区域面积计算，将少于额定面积的区域作为噪声剔除，作为岩块最终分割结果。步骤4.6：将步骤4.5得到的岩块结果保存，并对其进行边界跟踪提取轮廓坐标以及深度值，与结果一起打包到岩块信息包中，并提交公共数据存储区。步骤4.7：触发显示分割图事件时，将显示备份分割图；所述步骤5包括以下步骤：步骤5.1：轮廓深度统计单元从设备指标配置模块中导入视差变换参数，将上述步骤4.6提取的轮廓坐标及深度值导入视差坐标变换单元，求得该点在相机坐标下的实际坐标；步骤5.2：对上述步骤5.1计算得到x-z平面投影坐标进行最小二乘直线拟合，并将直线方程保存，所用直线方程如下：z＝kx+b步骤5.3：轮廓宽度统计单元从存储器8-3中获取上述步骤4.3计算得到粗分割二值图，求取每个轮廓外接矩形框并记录，并求取轮廓内部所占面积，并利用该图作为掩模，获取该岩块每个深度图上的深度值zu，利用上述步骤5.2所求方程求得对应底部深度zd，得到该坐标的相对深度zxy＝zu-zd，利用积分求得岩块体积：式中，fx和fy是在该位置处的分辨率。步骤5.4：将上述步骤5.3求得的体积乘两倍作为块度，同外接矩形框和轮廓面积一起打包到岩块信息包中，并提交公共数据存储区。所述步骤6还包括以下步骤：块度提取单元从信息包中获得每个岩块的体积，输入到块度分布统计单元中，进行频数分布直方图统计，并将其归一化后输入到信息整合单元中，将信息包与直方图整合为一个新的包，输出。所述步骤7包括以下步骤：步骤7.1：块度提取单元将每个岩块的体积送入块度分布统计单元，统计所有岩块的体积分布直方图；步骤7.2：块度分布统计单元将直方图信息送入信息整合单元，将上述步骤5.4提交的信息包与该直方图一起打包输出；步骤7.3：点击显示块度分布直方图时，将显示当前图像的块度分布直方图。以上所述，仅为本发明较佳的具体实施方式，但本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，根据本发明的技术方案及其发明构思加以等同替换或改变，都应涵盖在本发明的保护范围之内。
