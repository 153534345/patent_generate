标题title
一种基于图像识别的水文长序列数据提取方法
摘要abst
本发明提出了一种基于图像识别的水文长序列数据提取方法，通过图像识别，对水文数据的图像文件进行矫正和数字化处理，提取图像文件中水文数据曲线的关键点及其在图表中横纵坐标，生成数据集。与现有技术相比，本发明克服了水文历史长序列数据获取困难的问题，避免了搜集、查阅和录入水文年鉴数据的繁琐工作；在水文年鉴或者长序列观测数据无法获得时，可通过文献或报告中的水文序列图像，便捷的提取数据，理论意义明确，操作简单易行，可为水文模型的率定和分析提供可用的数据，容易在水文建模中应用。
权利要求书clms
1.一种基于图像识别的水文长序列数据提取方法，其特征在于，包括以下步骤：S1、图像的准备与旋转纠正：S2、导入旋转纠正的图像并生成数字矩阵；S3、对图像进行去噪处理；S4、确定图像的横纵坐标范围与图像裁剪；S5、扫描图像并提取图像中关键点坐标数值；S6、循环进行步骤S5，记录所有关键点坐标数值，得到图像的水文序列曲线的数字化识别结果；S7、生成数据坐标值折线图，手动调整异常点。2.根据权利要求1所述的方法，其特征在于：步骤S1更具体为：搜集待数字化的水文长序列数据图表的图像，并将所述图像转换为可处理的格式；接着将图像进行旋转纠正。3.根据权利要求2所述的方法，其特征在于：所述图像上包括横纵坐标轴、坐标刻度、横纵坐标最大值以及水文序列曲线，且坐标原点从点开始；所述图像旋转纠正的原则为：横向坐标轴为水平直线，纵向坐标轴为垂直直线。4.根据权利要求3所述的方法，其特征在于：步骤S2更具体为：基于PythonOpenCV编程，将旋转纠正后的图像读入到Python程序中，并将读入的图像转换成灰度图；接着将灰度图转化为大小为N×M的数字矩阵P；其中，N为数字矩阵P行的总数，其与导入图像的所有像素点的行总数相等；M为数字矩阵P列的总数，其与导入图片的所有像素点的列总数相等；数字矩阵P内元素的数值等于导入图像每个像素点的颜色值。5.根据权利要求4所述的方法，其特征在于：步骤S3更具体为：根据图像中水文序列曲线、横纵坐标轴的位置上像素点的颜色值，即步骤S2中数字矩阵P内元素的数值，确定像素点颜色值的阈值，将数字矩阵中小于该阈值的元素赋值为0，从而剔除图像中的噪声点；同时剔除横纵坐标轴的标题、坐标轴下的刻度数字以及图例文字，对应位置的矩阵元素赋值为0，得到数字矩阵P′。6.根据权利要求5所述的方法，其特征在于：步骤S4更具体为：确定图像的横纵坐标范围与图像裁剪；接着通过计算机程序的循环计算，遍历图像中的每个像素点，识别坐标轴原点以及横纵坐标轴的端点；具体包括以下步骤：S41、从数字矩阵P′的最后一行和第一列开始进行矩阵元素的循环遍历，当识别到数字矩阵元素数值第一个大于零的a点，记录该点在数字矩阵中所在的行编号ar和列编号ac；继续行和列的循环遍历，当识别到数字矩阵元素数值第一个等于零的b点，记录该点在数字矩阵中所在的行编号br和列编号bc；取a点和b点行编号的平均值，作为图像坐标轴原点的行编号Or，取a点和b点列编号的平均值，作为图像坐标轴原点的列编号Oc；S42、从数字矩阵P′的最后一行和最后一列开始进行矩阵元素的循环遍历，当识别到数字矩阵元素数值第一个大于零的c点，记录该点在数字矩阵中所在的行编号cr和列编号cc；将列编号cc作为图像横坐标轴的终点的列编号，记为Xc；S43.从数字矩阵P′的第一行和第一列开始进行数字矩阵元素的循环遍历，当识别到数字矩阵元素数值第一个大于零的d点，记录该点在数字矩阵中所在的行编号dr和列编号dc；将行编号dr作为图表纵坐标轴的终点的行编号，记为Yr；S44.提取图像数字矩阵P′中，，，四个行列编号点范围内的元素数值，赋值给新的数字矩阵P″，实现图像作图区域的图像截取。7.根据权利要求6所述的方法，其特征在于：步骤S5更具体为：遍历数字矩阵P″中的每个元素，识别图像作图区域中水文序列曲线上的关键点在数字矩阵中的行列号，将其作为该点的横纵坐标，并计算相应的坐标数值。8.根据权利要求7所述的方法，其特征在于：所述步骤S5具体包括以下步骤：S51、从数字矩阵P″的最后一行和第一列开始进行数字矩阵元素的循环遍历；首先从左到右进行列循环遍历，循环步长为L，即每隔L个像素点读取一次列的编号，且每隔L个像素点设置一个关键点；所述列的编号为wc，Ln，其计算公式为：wc，Ln＝n×L 其中，n表示读取列的次数；然后在每次读取列的编号后，在wc，Ln列自下而上开始行循环，循环步长为1个像素，即1行，遍历wc，Ln列所在的所有行，识别该列第一个不为零的元素，并记录该元素所在的行的编号，记为wr，n1；继续自下而上的行的循环遍历，识别该列最后一个不为零的元素，并记录该元素所在的行的编号，记为wr，n2；取wr，n1和wr，n2的平均值作为wc，Ln列上水文序列曲线上关键点的行编号，记为wr，n；S52、根据图像提取水文序列曲线对应的横纵坐标最大值，分别记为XMax和YMax；根据公式、计算数字矩阵P″每一行以及每一列所代表的水文数据数值：其中，Δx表示水文序列曲线的x坐标数值变化量；Δy表示水文序列曲线的y坐标数值变化量；PM为数字矩阵P″的总列数；PN位数字矩阵P″的总行数。接着根据公式、计算以为行、列编号的水文序列曲线上关键点的水文坐标数值：wx，n＝Δx·wc，Lnwy，n＝Δy·wr，n其中，wx，n表示水文序列曲线关键点的x坐标数值，wy，n表示水文序列曲线关键点的y坐标数值。9.根据权利要求7所述的方法，其特征在于：步骤S6更具体为：循环进行步骤S5，直至wc，Ln等于数字矩阵P″的总列数PM；记录所有点的数据坐标值，得到水文序列曲线的数字化识别结果，其中，10.根据权利要求9所述的方法，其特征在于：步骤S7更具体为：生成数据坐标值的折线图，并与初始的水文长序列数据图像进行叠加，通过目视的方法判断识别的准确度；根据图像对比，手动调整的横纵坐标值，剔除识别的异常点。
说明书desc
技术领域本发明涉及水文技术领域，具体涉及一种基于图像识别的水文长序列数据提取方法。背景技术长历史序列的水文数据，包括河流的径流和水位数据等，是流域水文模拟和水资源分析评价的基础。通常情况下，可通过水利部门每年发布的水文年鉴获取流域的水文数据，包括河流水文观测站点的日径流量、日水位等等。然而，水文年鉴的发行量有限，历史水文年鉴大多为纸质版，需要将纸质版的数据表格进行电子化或者数字化，以获取历史的长序列水文数据，工作量较大、耗时长。此外，历史的水文观测数据以及水文年鉴大都存储于各流域或地方的水文局，大部分数据不对外公开发布，获取水文数据的难度较大、成本昂贵，尤其是长历史序列连续数据的获取，是流域水文计算的难点。发明内容为解决背景技术中水文观测数据存储区域分散、获取难度大、获取成本昂贵的问题，本发明提供一种基于图像识别的水文长序列数据提取方法，该方法可通过文献或报告中的水文序列图像，便捷的提取数据，且准确性高。为实现上述目的，本发明的基于图像识别的水文长序列数据提取方法的技术方案如下：一种基于图像识别的水文长序列数据提取方法，包括以下步骤：S1、图像的准备与旋转纠正：S2、导入旋转纠正的图像并生成数字矩阵；S3、对图像进行去噪处理；S4、确定图像的横纵坐标范围与图像裁剪；S5、扫描图像并提取图像中关键点坐标数值；S6、循环进行步骤S5，记录所有关键点坐标数值，得到图像的水文序列曲线的数字化识别结果；S7、生成数据坐标值折线图，手动调整异常点。进一步地，步骤S1更具体为：搜集待数字化的水文长序列数据图表的图像，并将所述图像转换为可处理的格式；接着将图像进行旋转纠正。进一步地，所述图像上包括横纵坐标轴、坐标刻度、横纵坐标最大值以及水文序列曲线，且坐标原点从点开始；所述图像旋转纠正的原则为：横向坐标轴为水平直线，纵向坐标轴为垂直直线。进一步地，步骤S2更具体为：基于Python OpenCV编程，将旋转纠正后的图像读入到Python程序中，并将读入的图像转换成灰度图；接着将灰度图转化为大小为N×M的数字矩阵P；其中，N为数字矩阵P行的总数，其与导入图像的所有像素点的行总数相等；M为数字矩阵P列的总数，其与导入图片的所有像素点的列总数相等；数字矩阵P内元素的数值等于导入图像每个像素点的颜色值。进一步地，步骤S3更具体为：根据图像中水文序列曲线、横纵坐标轴的位置上像素点的颜色值，即步骤S2中数字矩阵P内元素的数值，确定像素点颜色值的阈值，将数字矩阵中小于该阈值的元素赋值为0，从而剔除图像中的噪声点；同时剔除横纵坐标轴的标题、坐标轴下的刻度数字以及图例文字，对应位置的矩阵元素赋值为0，得到数字矩阵P′。进一步地，步骤S4更具体为：确定图像的横纵坐标范围与图像裁剪；接着通过计算机程序的循环计算，遍历图像中的每个像素点，识别坐标轴原点以及横纵坐标轴的端点；具体包括以下步骤：S41、从数字矩阵P′的最后一行和第一列开始进行矩阵元素的循环遍历，当识别到数字矩阵元素数值第一个大于零的a点，记录该点在数字矩阵中所在的行编号ar和列编号ac；继续行和列的循环遍历，当识别到数字矩阵元素数值第一个等于零的b点，记录该点在数字矩阵中所在的行编号br和列编号bc；取a点和b点行编号的平均值，作为图像坐标轴原点的行编号Or，取a点和b点列编号的平均值，作为图像坐标轴原点的列编号Oc；S42、从数字矩阵P′的最后一行和最后一列开始进行矩阵元素的循环遍历，当识别到数字矩阵元素数值第一个大于零的c点，记录该点在数字矩阵中所在的行编号cr和列编号cc；将列编号cc作为图像横坐标轴的终点的列编号，记为Xc；S43.从数字矩阵P′的第一行和第一列开始进行数字矩阵元素的循环遍历，当识别到数字矩阵元素数值第一个大于零的d点，记录该点在数字矩阵中所在的行编号dr和列编号dc；将行编号dr作为图表纵坐标轴的终点的行编号，记为Yr；S44.提取图像数字矩阵P′中,,,四个行列编号点范围内的元素数值，赋值给新的数字矩阵P″，实现图像作图区域的图像截取。进一步地，步骤S5更具体为：遍历数字矩阵P″中的每个元素，识别图像作图区域中水文序列曲线上的关键点在数字矩阵中的行列号，将其作为该点的横纵坐标，并计算相应的坐标数值。进一步地，所述步骤S5具体包括以下步骤：S51、从数字矩阵P″的最后一行和第一列开始进行数字矩阵元素的循环遍历；首先从左到右进行列循环遍历，循环步长为L，即每隔L个像素点读取一次列的编号，且每隔L个像素点设置一个关键点；所述列的编号为wc,Ln，其计算公式为：wc,Ln＝n×L其中，n表示读取列的次数；然后在每次读取列的编号后，在wc,Ln列自下而上开始行循环，循环步长为1个像素，即1行，遍历wc,Ln列所在的所有行，识别该列第一个不为零的元素，并记录该元素所在的行的编号，记为wr,n1；继续自下而上的行的循环遍历，识别该列最后一个不为零的元素，并记录该元素所在的行的编号，记为wr,n2；取wr,n1和wr,n2的平均值作为wc,Ln列上水文序列曲线上关键点的行编号，记为wr,n；S52、根据图像提取水文序列曲线对应的横纵坐标最大值，分别记为XMax和Ymax；根据公式、计算数字矩阵P″每一行以及每一列所代表的水文数据数值：其中，Δx表示水文序列曲线的x坐标数值变化量；Δy表示水文序列曲线的y坐标数值变化量；PM为数字矩阵P″的总列数；PN位数字矩阵P″的总行数。接着根据公式、计算以为行、列编号的水文序列曲线上关键点的水文坐标数值：wx,n＝Δx·wc,Lnwy,n＝Δy·wr,n其中，wx,n表示水文序列曲线关键点的x坐标数值，wy,n表示水文序列曲线关键点的y坐标数值。进一步地，步骤S6更具体为：循环进行步骤S5，直至wc,Ln等于数字矩阵P″的总列数PM；记录所有点的数据坐标值，得到水文序列曲线的数字化识别结果，其中，进一步地，步骤S7更具体为：生成数据坐标值的折线图，并与初始的水文长序列数据图像进行叠加，通过目视的方法判断识别的准确度；根据图像对比，手动调整的横纵坐标值，剔除识别的异常点。与现有技术相比，本发明的优点及有益效果为：本发明采用图像识别的方法对水文长序列图像进行数字化处理，提取水文序列曲线中关键点的坐标值，获取历史水文数据，避免了搜集、查阅和录入水文年鉴数据的繁琐工作。在水文年鉴或者长序列观测数据无法获得时，可通过文献或报告中的水文序列图像，便捷地提取数据。另外，该方法可直接进行水文序列曲线的识别，数据获取更加便捷，实用性更强。附图说明图1为本发明基于图像识别的水文长序列数据提取方法的流程图；图2为水文数据关键点的识别效果图；图3为识别的水文数据的效果示意图。具体实施方式附图仅用于示例性说明，不能理解为对本专利的限制。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都应当属于本发明保护的范围。下面结合图1至3和实施例对本发明的技术方案做进一步的说明。一种基于图像识别的水文长序列数据提取方法，如图1所示，具体包括以下步骤：S1、图像的准备与旋转纠正：选择广东东江流域博罗水文站1962年-2010年每月的径流量序列图作为识别对象，接着将图像转换为TIF格式。其中，所述图像上包括横纵坐标轴、坐标刻度、横纵坐标最大值以及水文序列曲线，且坐标原点从点开始。接着利用图片编辑软件对图片进行旋转或变形，使图像的横向坐标轴为水平直线，纵向坐标轴为垂直直线。S2、导入旋转纠正的图像并生成数字矩阵；基于Python OpenCV编程，将旋转纠正后的图像读入到Python程序中，并将读入的图像转换成灰度图；接着将灰度图转化为大小为615×2197的数字矩阵，矩阵总行数为615，其与导入图像的所有像素点的行总数相等；总列数为2197，其与导入图片的所有像素点的列总数相等。矩阵内元素的数值等于导入图像每个像素点的颜色值。S3、对图像进行去噪处理；将图片转化为灰度图像后，图像曲线为黑色，其颜色最大值为255，根据图像中水文序列曲线、横纵坐标轴的位置上像素点的颜色值，即S2步骤中数据矩阵P中对应行列的元素数值，确定像素点颜色值的阈值为200，接着提取颜色值200以上的像素点，颜色值小于200的像素点赋值为0，从而剔除图像中的噪声点；同时，剔除横纵坐标轴的标题、坐标轴下的刻度数字以及图例文字，对应位置的矩阵元素赋值为0，得到矩阵。S4、确定图像的横纵坐标范围与图像裁剪；确定图像的横纵坐标范围与图像裁剪；接着通过计算机程序的循环计算，遍历图像中的每个像素点，识别坐标轴原点以及横纵坐标轴的端点；具体包括以下步骤：S41、从数字矩阵P′的最后一行和第一列开始进行矩阵元素的循环遍历，当识别到数字矩阵元素数值第一个大于零的a点，记录该点在数字矩阵中所在的行编号ar和列编号ac；继续行和列的循环遍历，当识别到数字矩阵元素数值第一个等于零的b点，记录该点在数字矩阵中所在的行编号br和列编号bc；取a点和b点行编号的平均值，作为图像坐标轴原点的行编号Or，取a点和b点列编号的平均值，作为图像坐标轴原点的列编号Oc；S42、从数字矩阵P′的最后一行和最后一列开始进行矩阵元素的循环遍历，当识别到数字矩阵元素数值第一个大于零的c点，记录该点在数字矩阵中所在的行编号cr和列编号cc；将列编号cc作为图像横坐标轴的终点的列编号，记为Xc；S43.从数字矩阵P′的第一行和第一列开始进行数字矩阵元素的循环遍历，当识别到数字矩阵元素数值第一个大于零的d点，记录该点在数字矩阵中所在的行编号dr和列编号dc；将行编号dr作为图表纵坐标轴的终点的行编号，记为Yr；S44.提取图像数字矩阵P′中,,,四个行列编号点范围内的元素数值，赋值给新的数字矩阵P″，实现图像作图区域的图像截取。基于上述方法，在本实施例中，新的数字矩阵大小为426×2020。S5、扫描图像并提取图像中关键点坐标数值；遍历数字矩阵P″中的每个元素，识别图像作图区域中水文序列曲线上的关键点在数字矩阵中的行列号，将其作为该点的横纵坐标，并计算相应的坐标数值。具体包括以下步骤：S51、从数字矩阵P″的最后一行和第一列开始进行数字矩阵元素的循环遍历；首先从左到右进行列循环遍历，循环步长为L，即每隔L个像素点读取一次列的编号，且每隔L个像素点设置一个关键点，在本实施例中，步长取值为2；所述列的编号为wc,Ln，其计算公式为：wc,Ln＝n×L其中，n表示读取列的次数；然后在每次读取列的编号后，在wc,Ln列自下而上开始行循环，循环步长为1个像素，即1行，遍历wc,Ln列所在的所有行，识别该列第一个不为零的元素，并记录该元素所在的行的编号，记为wr,n1；继续自下而上的行的循环遍历，识别该列最后一个不为零的元素，并记录该元素所在的行的编号，记为wr,n2；取wr,n1和wr,n2的平均值作为wc,Ln列上水文序列曲线上关键点的行编号，记为wr,n；S52、根据图像提取水文序列曲线对应的横纵坐标最大值，分别记为XMax和Ymax；根据公式、计算数字矩阵P″每一行以及每一列所代表的水文数据数值：其中，Δx表示水文序列曲线的x坐标数值变化量；Δy表示水文序列曲线的y坐标数值变化量；；PM为数字矩阵P″的总列数；PN位数字矩阵P″的总行数。接着根据公式、计算以为行、列编号的水文序列曲线上关键点的水文坐标数值：wx,n＝Δx·wc,Lnwy,n＝Δy·wr,n其中，wx,n表示水文序列曲线关键点的x坐标数值，wy,n表示水文序列曲线关键点的y坐标数值。S6、循环进行步骤S5，记录所有关键点坐标数值，得到图像的水文序列曲线的数字化识别结果；循环进行步骤S5，直至wc,Ln等于数字矩阵P″的总列数PM；记录所有点的数据坐标值，得到水文序列曲线的数字化识别结果，共识别关键点坐标1010个。其中，S7、生成数据坐标值折线图，手动调整异常点。生成数据坐标值的折线图，并与初始的水文长序列数据图像进行叠加，通过目视的方法判断识别的准确度；根据图像对比，手动调整的横纵坐标值，剔除识别的异常点，提高准度。与现有技术相比，本实施例的有益效果为：本发明采用图像识别的方法对水文长序列图像进行数字化处理，提取水文序列曲线中关键点的坐标值，获取历史水文数据，避免了搜集、查阅和录入水文年鉴数据的繁琐工作，克服了水文历史长序列数据获取困难的问题；同时，该方法可为水文模型的率定和分析提供可用的数据，容易在水文建模中应用。在水文年鉴或者长序列观测数据无法获得时，可通过文献或报告中的水文序列图像，便捷地提取数据。另外，该方法可直接进行水文序列曲线的识别，数据获取更加便捷，实用性更强。值得说明的是，以上实施例仅用以说明本发明的技术方案而非限制，尽管参照较佳实施例对本发明进行了详细说明，本领域的普通技术人员应当理解，可以对本发明的技术方案进行修改或者等同替换，而不脱离本发明技术方案的宗旨和范围，其均应涵盖在本发明的权利要求范围当中。
