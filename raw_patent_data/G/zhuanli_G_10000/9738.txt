标题title
一种打印系统的工作方法
摘要abst
本发明公开了一种打印系统的工作方法，包括：智能物联平台接收打印请求，判断打印请求的类型，如果为第一打印请求则向打印机发送第一打印指令，如果为第二打印请求则向打印机发送第二打印指令，当打印机接收到第一打印指令时，打印包含图形码的小票；当打印机接收到第二打印指令时，打印不含图形码的小票。通过本公开，商户可以选择是否打印包含图形码的小票，节约资源和成本。
权利要求书clms
1.一种打印系统的工作方法，其特征在于，包括：步骤s1：智能物联平台接收业务平台发送的打印请求，解析所述打印请求获取解析数据，根据所述解析数据判断所述打印请求的类型，当所述打印请求为第一打印请求时，执行步骤s2；当所述打印请求为第二打印请求时，执行步骤s4；步骤s2：所述智能物联平台组织第一数据，向第一服务器发送所述第一数据，当接收到所述第一服务器返回的发票URL时，所述智能物联平台组织第二数据，根据所述发票URL以及所述第二数据生成第一打印指令，向打印机发送所述第一打印指令；步骤s3：当所述打印机接收到所述第一打印指令时，解析所述第一打印指令获取所述发票URL以及所述第二数据，根据所述发票URL以及所述第二数据组织打印内容，根据所述打印内容打印包含图形码的小票，结束；步骤s4：所述智能物联平台组织第二数据，根据所述第二数据生成第二打印指令，向所述打印机发送所述第二打印指令；步骤s5：当所述打印机接收到所述第二打印指令时，解析所述第二打印指令获取所述第二数据，根据所述第二数据组织打印内容，根据所述打印内容打印不含图形码的小票；判断是否接收到打印发票指令，如果是，向所述智能物联平台发送打印发票请求，执行步骤s2；否则，结束。2.如权利要求1所述的工作方法，其特征在于，所述步骤s1具体包括：所述智能物联平台接收所述打印请求，解析所述打印请求获取所述解析数据，根据所述解析数据中的第一标识判断打印请求的类型，如果为第一打印请求，执行步骤s2；如果为第二打印请求，执行步骤s4。3.如权利要求2所述的工作方法，其特征在于，所述第一打印请求具体为：打印包含图形码的小票请求；所述第二打印请求具体为：打印不含图形码的小票请求。4.如权利要求2所述的工作方法，其特征在于，所述步骤s1中所述智能物联平台接收所述打印请求，解析所述打印请求获取所述解析数据之后，根据所述解析数据中的第一标识判断打印请求类型之前，还包括：所述智能物联平台判断所述解析数据中是否包含发票URL，如果是，生成所述第一打印指令，向所述打印机发送所述第一打印指令；否则，判断所述打印请求的类型。5.如权利要求1所述的方法，其特征在于，所述步骤s2具体为：所述智能物联平台组织开发票所需数据，向第一服务器发送所述开发票所需数据，当接收到第一服务器返回的发票URL时，所述智能物联平台组织开具小票所需数据，根据所述发票URL以及所述开具小票所需数据生成所述第一打印指令，向所述打印机发送所述第一打印指令。6.如权利要求1所述的方法，其特征在于，所述步骤s3具体为：当所述打印机接收所述第一打印指令时，解析所述第一打印指令获取所述发票URL以及所述开具小票所需数据，根据所述发票URL以及所述开具小票所需数据组织打印内容，根据所述打印内容打印包含图形码的小票，结束。7.一种智能物联平台的工作方法，其特征在于，包括：步骤A1：智能物联平台接收到打印请求，解析打印请求得到解析数据，根据所述解析数据判断所述打印请求的类型，如果为第一打印请求或者打印发票请求，执行步骤A2；如果为第二打印请求，执行步骤A3；步骤A2：所述智能物联平台组织第一数据，向第一服务器发送所述第一数据，当接收到所述第一服务器返回的发票URL时，组织第二数据，根据所述发票URL和所述第二数据生成第一打印指令，向打印机发送所述第一打印指令；步骤A3：所述智能物联平台组织第二数据，根据所述第二数据生成第二打印指令，向所述打印机发送所述第二打印指令。8.如权利要求7所述的方法，其特征在于，所述步骤A1中所述根据所述解析数据判断所述打印请求的类型具体包括：步骤A1-1：所述智能物联平台接收打印请求，解析所述打印请求获得解析数据，根据所述解析数据中的所述打印请求的接收渠道判断打印请求的类型，如果所述打印请求来自打印机，则所述打印请求为打印发票请求；如果所述打印请求来自业务平台，则打印请求为第一打印请求或者第二打印请求；步骤A1-2：所述智能物联平台根据解析数据中的第一标识判断打印请求的类型，当所述第一标识为第一预设值时，所述打印请求为第一打印请求；当所述第一标识为第二预设值时，所述打印请求为第二打印请求。9.如权利要求7所述的方法，其特征在于，所述步骤A2具体为：所述智能物联平台组织开发票所需数据，向第一服务器发送所述开发票所需数据，当接收到所述第一服务器返回的发票URL时，组织开具小票所述数据，根据所述发票URL和所述开具小票所需数据生成第一打印指令，向所述打印机发送所述第一打印指令。10.如权利要求7所述的方法，其特征在于，所述步骤A3具体为：所述智能物联平台组织开具小票所需数据，根据所述开具小票所需数据生成第二打印指令，向所述打印机发送所述第二打印指令。11.如权利要求7所述的方法，其特征在于，所述第一打印请求为打印包含图形码的小票请求；所述第二打印请求为打印不含图形码的小票请求。12.一种打印机的工作方法，其特征在于，包括：步骤B1：打印机等待并接收指令，当接收到的指令为第一打印指令时，执行步骤B2；当接收到的指令为第二打印指令时，执行步骤B3；当接收到的指令为打印发票指令时，执行步骤B4；步骤B2：所述打印机解析所述第一打印指令获取发票URL和第二数据，根据所述发票URL和所述第二数据组织打印内容，打印包含图形码的小票，返回步骤B1；步骤B3：所述打印机解析第二打印指令获取第二数据，根据所述第二数据组织打印内容，打印不含图形码的小票，返回步骤B1；步骤B4：所述打印机判断缓存中是否存在打印数据，如果是，执行步骤B5；否则，提示无订单；返回步骤B1；步骤B5：所述打印机判断所述缓存中的打印数据中是否包含发票URL，如果是，打印包含图形码的小票，返回步骤B1；否则，执行步骤B6；步骤B6：所述打印机根据缓存中的所述打印数据的唯一标识，生成打印发票请求，向智能物联平台发送所述打印发票请求，返回步骤B1。13.如权利要求12所述的方法，其特征在于，步骤B5具体包括：所述打印机根据所述打印数据中的第一参数判断所述打印数据中是否存在发票URL，如果所述打印数据中存在所述第一参数，则所述打印数据中包含发票URL，打印包含图形码的小票，返回步骤B1；如果所述打印数据中不存在所述第一参数，则所述打印数据中不包含发票URL，执行步骤B6。14.如权利要求12所述的方法，其特征在于，当所述打印机检测出脉冲中断时，接收到的所述打印指令为所述打印发票指令。15.一种智能物联平台，其特征在于，所述智能物联平台包括至少一个处理器、存储器及存储在所述存储器上并可被所述至少一个处理器执行的指令，所述至少一个处理器执行所述指令以实现权利要求1至11任一项信息处理的实现方法。16.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质包括计算机程序，当所述计算机程序在智能物联平台上运行时，使得所述智能物联平台执行如权利要求1至11任一项所述的方法步骤。17.一种打印机，其特征在于，所述打印机包括至少一个处理器、存储器及存储在所述存储器上并可被所述至少一个处理器执行的指令，所述至少一个处理器执行所述指令以实现权利要求12至14任一项信息处理的实现方法。18.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质包括计算机程序，当所述计算机程序在打印机上运行时，使得所述打印机执行如权利要求12至14任一项所述的方法步骤。
说明书desc
技术领域本发明提供了一种打印系统的工作方法，属于信息技术领域。现有技术目前，当前技术中有两种开票模式：一种为PC机上开票终端手动输入开票信息开票；另一种为电子发票提取地址开票；而这两种开票方式中，第一种增加了商户操作的复杂性，不方便；第二种方式中，商户无法根据消费者的需求来选择是否打印发票，增加了商户选择是否开发票的复杂度和经济成本。发明内容根据本发明的技术方案，提供了一种打印系统的工作方法，包括：步骤s1：智能物联平台接收业务平台发送的打印请求，解析打印请求获取解析数据，根据解析数据判断打印请求的类型，当打印请求为第一打印请求时，执行步骤s2；当打印请求为第二打印请求时，执行步骤s4；步骤s2：智能物联平台组织第一数据，向第一服务器发送第一数据，当接收到第一服务器返回的发票URL时，智能物联平台组织第二数据，根据发票URL以及第二数据生成第一打印指令，向打印机发送第一打印指令；步骤s3：当打印机接收到第一打印指令时，解析第一打印指令获取发票URL以及第二数据，根据发票URL以及第二数据组织打印内容，根据打印内容打印包含图形码的小票，结束；步骤s4：智能物联平台组织第二数据，根据第二数据生成第二打印指令，向打印机发送第二打印指令；步骤s5：当打印机接收到第二打印指令时，解析第二打印指令获取第二数据，根据第二数据组织打印内容，根据打印内容打印不含图形码的小票；判断是否接收到打印发票指令，如果是，向智能物联平台发送打印发票请求，执行步骤s2；否则，结束。根据本发明的另一种方案，提供一种智能物联平台的工作方法，包括：步骤A1：智能物联平台接收到打印请求，解析打印请求得到解析数据，根据解析数据判断打印请求的类型，如果为第一打印请求或者打印发票请求，执行步骤A2；如果为第二打印请求，执行步骤A3；步骤A2：智能物联平台组织第一数据，向第一服务器发送第一数据，当接收到第一服务器返回的发票URL时，组织第二数据，根据发票URL和第二数据生成第一打印指令，向打印机发送第一打印指令；步骤A3：智能物联平台组织第二数据，根据第二数据生成第二打印指令，向打印机发送第二打印指令。根据本发明的另一种方案，提供一种打印机的工作方法，其特征在于，包括：步骤B1：打印机等待并接收指令，当接收到的指令为第一打印指令时，执行步骤B2；当接收到的指令为第二打印指令时，执行步骤B3；当接收到的指令为打印发票指令时，执行步骤B4；步骤B2：打印机解析第一打印指令获取发票URL和第二数据，根据发票URL和第二数据组织打印内容，打印包含图形码的小票，返回步骤B1；步骤B3：打印机解析第二打印指令获取第二数据，根据第二数据组织打印内容，打印不含图形码的小票，返回步骤B1；步骤B4：打印机判断缓存中是否存在打印数据，如果是，执行步骤B5；否则，提示无订单；返回步骤B1；步骤B5：打印机判断缓存中的打印数据中是否包含发票URL，如果是，打印包含图形码的小票，返回步骤B1；否则，执行步骤B6；步骤B6：打印机根据缓存中的打印数据的唯一标识，生成打印发票请求，向智能物联平台发送打印发票请求，返回步骤B1。使用本发明提供的技术方案，打印发票可以由商户或者用户操作，商户可以根据实际情况及用户不同的诉求，灵活控制开发票频率和数量，降低了商户开票操作的复杂度和经济成本。附图说明图1为根据本发明实施例一提供的一种打印系统的工作方法流程图；图2为根据本发明实施例二提供的一种智能物联平台的工作方法的流程图；图3为根据本发明实施例三提供的一种打印机的工作方法的流程图；图4为根据本发明实施例四提供的一种打印系统的工作方法的流程图；图5为根据本发明实施例五提供一种打印系统的工作方法的流程图。具体实施方式本申请提出了一种信息处理的实现方法、装置及系统，下面结合附图，对本申请具体实施方式进行详细说明。所述实施例的示例在附图中示出。下面通过参考附图描述的实施例是示例性的，仅用于解释本申请，而不能解释为对本申请的限制。本技术领域技术人员可以理解，除非另外定义，这里使用的所有术语，具有与本申请所属领域中的普通技术人员的一般理解相同的意义。还应该理解的是，诸如通用字典中定义的那些术语，应该被理解为具有与现有技术的上下文中的意义一致的意义，并且除非像这里一样被特定定义，否则不会用理想化或过于正式的含义来解释。为使本发明的目的、技术方案和优点更加清楚，下面结合附图对本发明实施方式作进一步地详细描述。实施例一根据本发明实施例一，提供一种打印系统的工作方法，包括：步骤s1：智能物联平台接收业务平台发送的打印请求，解析打印请求获取解析数据，根据解析数据判断打印请求的类型，当打印请求为第一打印请求时，执行步骤s2；当打印请求为第二打印请求时，执行步骤s4；步骤s2：智能物联平台组织第一数据，向第一服务器发送第一数据，当接收到第一服务器返回的发票URL时，智能物联平台组织第二数据，根据发票URL以及第二数据生成第一打印指令，向打印机发送第一打印指令；步骤s3：当打印机接收到第一打印指令时，解析第一打印指令获取发票URL以及第二数据，根据发票URL以及第二数据组织打印内容，根据打印内容打印包含图形码的小票，结束；步骤s4：智能物联平台组织第二数据，根据第二数据生成第二打印指令，向打印机发送第二打印指令；步骤s5：当打印机接收到第二打印指令时，解析第二打印指令获取第二数据，根据第二数据组织打印内容，根据打印内容打印不含图形码的小票；判断是否接收到打印发票指令，如果是，向智能物联平台发送打印发票请求，执行步骤s2；否则，结束；可选地，步骤s1具体包括：智能物联平台接收打印请求，解析打印请求获取解析数据，根据解析数据中的第一标识判断打印请求的类型，如果为第一打印请求，执行步骤s2；如果为第二打印请求，执行步骤s4。可选地，第一打印请求具体为：打印包含图形码的小票请求；第二打印请求具体为：打印不含图形码的小票请求。可选地，第一打印请求具体为：打印包含开发票二维码的小票请求；第二打印请求具体为：打印不含开发票二维码的小票请求。可选地，步骤s1中智能物联平台接收打印请求，解析打印请求获取解析数据之后，根据解析数据中的第一标识判断打印请求类型之前，还包括：智能物联平台判断解析数据中是否包含发票URL，如果是，生成第一打印指令，向打印机发送第一打印指令；否则，判断打印请求的类型。可选地，步骤s2具体为：智能物联平台组织开发票所需数据，向第一服务器发送开发票所需数据，当接收到第一服务器返回的发票URL时，智能物联平台组织开具小票所需数据，根据发票URL以及开具小票所需数据生成第一打印指令，向打印机发送第一打印指令。可选地，步骤s3具体为：当打印机接收到第一打印指令时，解析第一打印指令获取发票URL以及开具小票所需数据，根据发票URL以及开具小票所需数据组织打印内容，根据打印内容打印包含图形码的小票，结束。实施例二根据本发明实施例二，提供一种智能物联平台的工作方法，包括：步骤A1：智能物联平台接收到打印请求，解析打印请求得到解析数据，根据解析数据判断打印请求的类型，如果为第一打印请求或者打印发票请求，执行步骤A2；如果为第二打印请求，执行步骤A3；步骤A2：智能物联平台组织第一数据，向第一服务器发送第一数据，当接收到第一服务器返回的发票URL时，组织第二数据，根据发票URL和第二数据生成第一打印指令，向打印机发送第一打印指令；步骤A3：智能物联平台组织第二数据，根据第二数据生成第二打印指令，向打印机发送第二打印指令。可选地，步骤A1中根据解析数据判断打印请求的类型具体包括：步骤A1-1：智能物联平台接收打印请求，解析打印请求获得解析数据，根据解析数据中打印请求的接收渠道判断打印请求的类型，如果打印请求接收于打印机，则打印请求为打印发票请求；如果打印请求接收于业务平台，则打印请求为第一打印请求或者第二打印请求；步骤A1-2：智能物联平台根据解析数据中的第一标识判断打印请求的类型，当第一标识为第一预设值时，打印请求为第一打印请求；当第一标识为第二预设值时，打印请求为第二打印请求。可选地，步骤A2具体为：智能物联平台组织开发票所需数据，向第一服务器发送开发票所需数据，当接收到第一服务器返回的发票URL时，组织开具小票所需数据，根据发票URL和开据消费小票所需数据生成第一打印指令，向打印机发送第一打印指令。可选地，第一服务器为发票服务器。可选地，步骤A3具体为：智能物联平台组织开具小票所需数据，根据开具小票所需数据生成第二打印指令，向打印机发送第二打印指令。可选地，第一打印请求为打印包含图形码的小票请求；第二打印请求为打印不含图形码的小票。实施例三根据本发明实施例三，提供一种打印机的工作方法，包括：步骤B1：打印机等待并接收指令，当接收到的指令为第一打印指令时，执行步骤B2；当接收到的指令为第二打印指令时，执行步骤B3；当打印指令为打印发票指令时，执行步骤B4；步骤B2：打印机解析第一打印指令获取发票URL和第二数据，根据发票URL和第二数据组织打印内容，打印包含图形码的小票，返回步骤B1；步骤B3：打印机解析第二打印指令获取第二数据，根据第二数据组织打印内容，打印不含图形码的小票，返回步骤B1；步骤B4：打印机判断缓存中是否存在打印数据，如果是，执行步骤B5；否则，提示无订单；返回步骤B1；步骤B5：打印机判断缓存中的打印数据中是否包含发票URL，如果是，打印包含图形码的小票，返回步骤B1；否则，执行步骤B6；步骤B6：打印机根据缓存中的打印数据的唯一标识，生成打印发票请求，向智能物联平台发送打印发票请求，返回步骤B1。可选地，步骤B5具体包括：打印机根据判断打印数据中第一参数判断打印数据中是否存在发票URL，如果打印数据中存在第一参数，则打印数据中包含发票URL，打印包含图形码的小票，返回步骤B1；如果打印数据中不存在第一参数，则打印数据中不包含发票URL，执行步骤B6。可选地，当打印机检测出脉冲中断时，接收到的打印指令为打印发票指令。实施例四根据本发明实施例四，提供一种打印系统的工作方法，用于包括业务平台、智能物联平台以及打印机的系统中，包括：步骤s101：业务平台接收用户发送的支付请求，判断用户支付是否成功，如果是，执行步骤s102；否则，向用户返回支付失败响应，结束；步骤s102：业务平台生成打印请求，向智能物联平台发送打印请求；可选地，业务平台生成的打印请求中包含：业务系统标识APPkey、请求唯一标识号、打印机SN编号，第一标识以及打印明细等内容；其中，第一标识具体为“是否直接开发票标识”，可以为用户支付时选择，也可以为业务平台预置，还可以为商户设置；步骤s103：智能物联平台接收业务平台发送的打印请求，解析打印请求获取解析数据，根据解析数据判断打印请求的类型，如果为第一打印请求，执行步骤s104；如果为第二打印请求，执行步骤s107；可选地，步骤s103具体为：智能物联平台接收打印请求，解析打印请求获取解析数据业务系统标识APPkey、请求唯一标号、打印机SN编号、第一标识以及打印内容明细，根据解析数据中的第一标识判断打印请求的类型，如果为第一打印请求，执行步骤s104；如果为第二打印请求，执行步骤s107；例如：步骤s103具体为：智能物联平台接收打印请求，解析打印请求获取解析数据{"appkey":"CD3D8B7E9246586545452","pushId":"21040216203151732767727","storeNumber":"A市B区","amount":"12.5元","payType":"扫码","shopName":"C公司","shopNumber":"C6782D7B5B6DFFB0E8581BE3030BD4F1","detail":,,,,],"totalmoney":"12.5","deviceCode":"2014024800087","ordertime":"2021-4-2 16:20:31","pushTime":"2021-04-02 16:20:31","oprSource":"1"}，根据解析数据中的第一标识"oprSource"判断打印请求的类型，当"oprSource"为0时，打印请求为第一打印请求；当"oprSource"为1时，打印请求为第二打印请求；其中，第一打印请求具体为：打印带开发票二维码的小票请求；第二打印请求具体为：打印不带开发票二维码的小票请求；可选地，步骤s103中判断打印请求类型之前，还包括：智能物联平台判断接收到的打印请求中是否包括发票URL，如果是，生成包含发票URL和小票内容明细的第一打印指令，直接向打印机发送第一打印指令；否则，判断打印请求的类型；例如，当智能物联平台判断解析接收到的打印请求，得到解析结果数据为{"appkey":"CD3D8B7E9246586545452","pushId":"21040216203151732767727","storeNumber":"A市B区","amount":"12.5元","payType":"扫码","shopName":"C公司","shopNumber":"C6782D7B5B6DFFB0E8581BE3030BD4F1","detail":,,,,],"totalmoney":"12.5","deviceCode":"2014024800087","ordertime":"2021-4-2 16:20:31","invoice_qr_code":"http://i.baiwang.com/fd=D269348481927482039&amp;c=O26934875193566291901165413","pushTime":"2021-04-02 16:20:31","oprSource":"1"}时，则打印请求中包括开票URL，向打印机发送包含发票URL和小票内容明细的第一打印指令；其中，invoice_qr_code 即为发票URL；步骤s104：智能物联平台根据第一服务器的要求组织第一数据，向第一服务器发送第一数据；可选地，第一数据包括：商户ID、订单编号，实际支付金额；例如，发送给开票服务器的第一数据为：{"externalStoreOrganId":"69548254778DSD78D","outerOrderId":"feitian9527","accountMoney":"168.5","registerUserParam":{"password":"1234567","sex":"MALE","name":"Mist","mobile":"13000000000"},"address":"测试商户地址","companyOrganName":"C公司","storeOrganName":"测试门店名称"}；步骤s105：智能物联平台等待接收第一服务器返回的发票URL，当接收到第一服务器返回的发票URL时，根据打印模板拼装带二维码的小票数据，生成第一打印指令，向打印机发送第一打印指令；其中，用户可以扫小票上的二维码以达到开发票的目的；可选地，第一打印指令包含消息ID、下发打印指令时间、发票URL以及小票内容明细；例如，第一打印指令为：{"pushId":"21040217133831632739891","amount":"0.1元","storeNumber":"A市B区","payType":"扫码","invoice_qr_code":"http://i.baiwang.com/fd=D269348481927482039&amp;c=O26934875193566291901165413","shopName":"C公司","shopNumber":"C6782D7B5B6DFFB0E8581BE3030BD4F1","deviceCode":"2014024800087","pushTime":"2021-04-02 17:14:40"}；可选地，当智能物联平台接收到第一服务器返回的发票URL时，还包括：将发票URL返回给商户系统；步骤s106：当打印机接收到第一打印指令时，解析第一打印指令获取发票URL以及小票内容明细，根据发票URL以及小票内容明细组织打印内容，打印包含二维码的小票，结束；可选地，步骤s106具体为：当打印机接收到第一打印指令时，解析第一打印指令获取包含店铺名称、终端设备编号、支付总金额、支付方式、操作时间、开发票二维码的打印内容，根据获取到的打印内容打印带有二维码的小票，结束。其中，第一打印指令具体为打印带有开发票二维码的小票指令。步骤s107：智能物联平台组织第二数据，根据开具小票所需数据生成第二打印指令，向打印机发送第二打印指令；可选地，步骤s107具体为：智能物联平台组织开具小票所需数据，根据开具小票所需数据生成包含消息ID、下发打印指令时间以及小票内容明细的第二打印指令，向打印机发送第二打印指令；例如，智能物联平台组织开具小票所需数据，生成第二打印指令{"pushId":"21040217133831632739891","amount":"0.1元","storeNumber":"A市B区","payType":"扫码","shopName":"C公司","shopNumber":"C6782D7B5B6DFFB0E8581BE3030BD4F1","deviceCode":"2014024800087","pushTime":"2021-04-02 17:14:40"}，向打印机发送第二打印指令；步骤s108：打印机接收第二打印指令，解析第二打印指令获取开具小票所需数据，根据开具小票所需数据组织打印内容，根据打印内容打印不含二维码的小票；等待接收开发票指令，判断是否接收到开发票指令，如果是，执行步骤s109；否则，结束；步骤s109：打印机向智能物联平台发送开发票请求；可选地，步骤s109具体为：打印机向智能物联平台发送包含设备物理Mac、设备SN编号、请求编号的开发票请求；例如，步骤s109为：打印机向智能物联平台发送包含设备物理Mac、设备SN编号、请求编号的开发票请求{"data":"4CACFA941E8540C28B0C5BC0211212079107832E92256F6C97D8CDB62D634ECB6E1541D5FC46F0D9DC93AD38409E1B35","pushId":"21040217133831632739891","mac":"998E8C647BF5D1D117A6E0551FA0164B845683699DD2A8781C5C0D138D016E89","device_code":"2014024800087","method":"/baiwang/invoice"} ；可选地，打印机接收打印发票请求后，判断当前订单小票是否带有发票URL，如果是，直接打印包含开发票二维码的小票；否则，向智能物联平台发送开发票请求；步骤s110：智能物联平台接收开发票请求，根据第一服务器的要求组织第一数据，将第一数据发送给第一服务器；等待接收第一服务器返回的发票URL，当接收到第一服务器返回的发票URL时，根据打印模板组织包含二维码的小票数据，根据组织的小票数据和发票URL生成第一打印指令，向打印机发送第一打印指令；可选地，当智能物联平台接收到第一服务器返回的发票URL时，还包括：将发票URL返回给商户系统；步骤s111：打印机接收第一打印指令，解析第一打印指令获取发票URL和小票数据，根据发票URL和小票数据组织打印内容，根据打印内容打印包含二维码的小票，结束。可选地，步骤s111具体为：打印机接收包含发票URL和小票明细内容的第一打印指令，解析第一打印指令获取包含店铺名称、终端设备编号、支付总金额、支付方式、操作时间、开发票二维码的打印内容，根据获取的打印内容打印包含开发票二维码的小票，结束。实施例五根据本发明实施例五，提供一种打印系统的工作方法，用于包括银行服务器、智能物联平台、开票服务器以及打印机的系统中，包括：步骤s201：银行服务器判断用户的支付操作是否成功，如果是，执行步骤s202；否则，向用户返回操作失败响应，结束；步骤s202：银行服务器根据智能物联平台要求生成打印请求，向智能物联平台发送打印请求；可选地，银行服务器根据第一标识生成打印请求，第一标识可以为用户支付时选择，可以为银行服务器预置，还可以为商户设置；可选地，打印请求包括：支付金额、支付方式、时间、需打印的明细等内容；可选地，银行服务器还可以根据商户的操作选择用户之前消费订单，并生成打印请求，向智能物联平台发送打印请求。步骤s203：智能物联平台接收银行服务器发送的打印请求，解析打印请求获取解析数据，根据解析数据判断打印请求的类型，如果为第一打印请求，执行步骤s204； 如果为第二打印请求，执行步骤s208；可选地，步骤s203 具体为：智能物联平台接收打印请求，解析打印请求获取包含业务系统标识APPkey、请求唯一标号、打印机SN编号、第一标识以及小票内容明细的解析数据，根据解析数据中的第一标识判断打印请求的类型，如果为第一打印请求，执行步骤s204；如果为第二打印请求，执行步骤s208；例如：步骤s203具体为：智能物联平台接收打印请求，解析打印请求获取解析数据{"appkey":"CD3D8B7E9246586545452","pushId":"21040216203151732767727","storeNumber":"A市B区","amount":"12.5元","payType":"扫码","shopName":"C公司","shopNumber":"C6782D7B5B6DFFB0E8581BE3030BD4F1","detail":,,,,],"totalmoney":"12.5","deviceCode":"2014024800087","ordertime":"2021-4-2 16:20:31","pushTime":"2021-04-02 16:20:31","oprSource":"1"}，根据解析数据中的第一标识"oprSource"判断打印请求的类型，当"oprSource"为0时，打印请求为第一打印请求；当"oprSource"为1时，打印请求为第二打印请求；其中，第一打印请求具体为：打印带开发票二维码的小票请求；第二打印请求具体为：打印不带开发票二维码的小票请求。步骤s204：智能物联平台根据第一服务器的要求组织第一数据，向第一服务器发送第一数据；可选地，步骤s204具体为：智能物联平台根据第一服务器的要求组织包含商户ID、订单编号、支付金额的第一数据，向第一服务器发送第一数据；例如：向第一服务器发送的第一数据为：{"externalStoreOrganId":"69548254778DSD78D","outerOrderId":"feitian9527","accountMoney":"168.5","registerUserParam":{"password":"1234567","sex":"MALE","name":"Mist","mobile":"13000000000"},"address":"测试商户地址","companyOrganName":"C公司","storeOrganName":"测试门店名称"}；步骤s205：第一服务器接收第一数据，根据第一数据生成发票URL，并向智能物联平台返回生成的发票URL；步骤s206：智能物联平台接收第一服务器返回的发票URL，根据打印模板组织带开发票二维码的小票数据，生成第一打印指令；向打印机发送第一打印指令；可选地，步骤s206具体为：智能物联平台接收第一服务器返回的发票URL，根据打印模板组织带开发票二维码的小票数据，生成包含消息ID、下发打印指令时间、发票URL以及小票内容明细的第一打印指令；向打印机发送第一打印指令；其中，带开发票二维码的小票打印之后，用户可以扫小票上的二维码以达到开发票的目的；例如，第一打印指令为：{"pushId":"21040217133831632739891","amount":"0.1元","storeNumber":"A市B区","payType":"扫码","invoice_qr_code":"http://i.baiwang.com/fd=D269348481927482039&amp;c=O26934875193566291901165413","shopName":"飞天诚信","message":"/FXYWgAHpAKqAQQABAAAAKoCBABkAAAAqgiQAhEA……","shopNumber":"C6782D7B5B6DFFB0E8581BE3030BD4F1","deviceCode":"2014024800087","pushTime":"2021-04-02 17:14:40"}；可选地，当智能物联平台接收到服务器返回的发票URL时，还包括：将发票URL返回给商户系统；步骤s207：当打印机接收到第一打印指令，解析第一打印指令获取打印内容，打印带有开发票二维码的小票，结束；其中，第一打印指令具体为打印带有开发票二维码的小票指令。步骤s208：智能物联平台组织第二数据，生成第二打印指令，向打印机发送第二打印指令；可选地，步骤s208具体为：智能物联平台组织第二数据，根据第二数据生成包含消息ID、下发打印指令时间以及小票内容明细的第二打印指令，向打印机发送第二打印指令；例如，智能物联平台组织第二数据，根据第二数据生成第二打印指令{"pushId":"21040217133831632739891","amount":"0.1元","storeNumber":"A市B区","payType":"扫码","shopName":"C公司","shopNumber":"C6782D7B5B6DFFB0E8581BE3030BD4F1","message":"/FXYWgAHpAKqAQQABAAAAKoCBABkAAAAqgiQAhEA……","deviceCode":"2014024800087","pushTime":"2021-04-02 17:14:40"}，向打印机发送第二打印指令；步骤s209：当打印机接收第二打印指令时，解析第二打印指令，获取打印内容，打印不带开发票二维码的小票；等待接收打印发票指令，判断是否接收到打印发票指令，如果是，生成打印发票请求，并向智能物联平台发送打印发票请求；否则，结束；可选地，步骤s209具体为：当打印机接收第二打印指令时，解析第二打印指令，获取包含店铺名称、终端设备编号、支付金额、支付方式、操作时间的打印内容，打印不带开发票二维码的小票；等待接收打印发票指令，判断是否接收到打印发票指令，如果是，生成打印发票请求，并向智能物联平台发送打印发票请求；否则，结束；例如：打印机接收第二打印指令，解析第二打印指令获取打印内容为：；步骤s210：智能物联平台接收到打印发票请求，根据开票服务器的要求组织第一数据，向开票服务器发送第一数据；可选地，步骤s210具体为：智能物联平台接收到打印发票请求，根据第一服务器的要求组织包含商户ID、订单编号、支付金额的第一数据，向第一服务器发送第一数据；例如：智能物联平台根据第一服务器组织的第一数据为：{"externalStoreOrganId":"69548254778DSD78D","outerOrderId":"feitian9527","accountMoney":"168.5","registerUserParam":{"password":"1234567","sex":"MALE","name":"Mist","mobile":"13000000000"},"address":"测试商户地址","companyOrganName":"C公司","storeOrganName":"测试门店名称"}；步骤s211：开票服务器接收第一数据，根据第一数据生成发票URL，向智能物联平台返回发票URL；步骤s212：智能物联平台接收发票URL，根据打印模板组织带二维码的小票数据，生成第三打印指令，将第三打印指令发送给打印机；可选地，步骤s212具体为：智能物联平台接收发票URL，根据打印模板组织带二维码的小票数据，生成包含消息ID、下发打印指令时间、发票URL以及小票内容明细的第三打印指令，将第三打印指令发送给打印机；例如：步骤s212为：智能物联平台接收发票URL{"appkey":"CD3D8B7E9246586545452","devicesn":"2014024800087","message":198000,"method":"push","nonce":"1ec45f1f548f44b38f42708454c3146f","push_template":431,"sign":"5hfJNZqvXOlchVDGi7NbhiJ5DCcTlaVbstNXHisjbgU=","ticket_template":"1000155","ticketinfo":"{\"List\":1,\"actualAmount\":\"1980.00\",\"address\":\"C市B淀区F大厦\",\"amount\":\"1980.00\",\"menu\":,],\"orderNo\":\"T269938382729982621\",\"orderSource\":\"IoT后台原生_WEB\",\"printTimeString\":\"2021-05-13 15:56:44\",\"qrTextAbove\":\"\",\"qrTextBelow\":\"\",\"qrUrl\":\"http://i.baiwang.com/fc=T26993838272998262181114557&amp;d=ORG348073522276544362\",\"receiptDesc\":\"\",\"storeOrganName\":\"C公司\",\"submitTimeString\":\"2021-04-02 17:14:40\"}","timestamp":"20210402155644"}，根据打印模板拼装带开发票二维码的小票数据，生成第三打印指令{"pushId":"21040217133831632856395","amount":"0.1元","storeNumber":"A市B区","payType":"扫码","invoice_qr_code":"http://i.baiwang.com/fd=D269348481927482039&amp;c=O26934875193566291901165413","shopName":"C公司","message":"/FXYWgAHpAKqAQQABAAAAKoCBABkAAAAqgiQAhEA……","shopNumber":"C6782D7B5B6DFFB0E8581BE3030BD4F1","deviceCode":"2014024800087","pushTime":"2021-04-02 17:14:40"}，将第三打印指令发送给打印机；步骤s213：打印机接收第三打印指令，解析第三打印指令获取带开发票二维码的小票数据，打印小票，结束。例如：步骤s213为：打印机接收第三打印指令，解析第三打印指令中的message获取带开发票二维码的小票数据；打印小票，结束。在上述实施例中，可以全部或部分地通过软件、硬件、固件或者其任意组合来实现。当使用软件程序实现时，可以全部或部分地以计算机程序产品的形式来实现。该计算机程序产品包括一个或多个计算机程序。在打印机上加载和执行计算机程序时，全部或部分地产生按照本申请实施例所述的流程或功能。该计算机程序可以存储在计算机可读存储介质中，或者从一个计算机可读存储介质向另一个计算机可读存储介质传输，例如，所述计算机指令可以从一个基站、车载终端、服务器或者数据中心通过有线)或无线方式向另一个基站、车载终端、服务器或数据中心进行传输。所述计算机可读存储介质可以是打印机能够存取的任何可用介质或者是包含一个或多个可以用介质集成的服务器、数据中心等数据存储设备。所述可用介质可以是磁性介质，光介质、 或者半导体介质)等。本实施例中，打印机可以包括前面实施例八中公开的各个模块。
