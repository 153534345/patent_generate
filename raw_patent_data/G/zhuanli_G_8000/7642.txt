标题title
一种高精度电流检测方法及其芯片模组
摘要abst
本发明公开了一种高精度电流检测方法及其芯片模组，高精度电流检测方法包括至少两个保护开关，在至少一个保护开关上并联设置采样桥臂，采样桥臂包括串联连接的至少一个电流采样开关和至少一个信号处理单元，电流采样开关至少为相互并联的两个和/或对应的保护开关至少为相互并联的两个；电流采样开关使用镜像电流法获取电流采样信号Is；信号处理单元根据电流采样信号Is生成保护开关电流信号Ip。采用本发明所公开的高精度电流检测方法，信噪比得到进一步提升，对运放的需求也会有所降低，同时也提升了采样精度。在大电流工况下也可以在满足采样精度的情况下降低导通损耗，又可以降低系统成本。
权利要求书clms
1.一种高精度电流检测方法，所述高精度电流检测方法用于在具备至少一个保护开关的电流回路中进行电流检测，其特征在于，包括如下步骤：在至少一个所述保护开关上并联设置采样桥臂，所述采样桥臂包括串联连接的至少一个电流采样开关和至少一个信号处理单元；所述电流采样开关至少为两个，和/或，对应的保护开关至少为相互并联的两个；所述信号处理单元用于处理电流采样信号Is以及调节电流采样开关和/或保护开关的开关状态；所述电流采样开关使用镜像电流源法获取电流采样信号Is；预设至少一个采样比例参数调节阈值；对第一电流回路参数进行采样，所述第一电流回路参数用于表示电流回路的负荷高低状态；判断第一电流回路参数与采样比例参数调节阈值的大小关系，根据判断结果调节电流采样开关和/或保护开关的开关状态；根据电流采样信号Is计算电流信号Ip，通过公式和公式计算保护开关电流信号Ip：Q＝Rs/Rp；Ip＝Q·Is；其中：Rp为导通的保护开关的总等效电阻，Rs为导通的采样开关的总等效电阻，Q为采样比例参数。2.根据权利要求1所述的高精度电流检测方法，其特征在于，所述信号处理单元通过调节电流采样开关和/或保护开关的开关状态使采样比例参数Q随电流回路负荷的升高而阶梯式下降。3.根据权利要求1所述的高精度电流检测方法，其特征在于，在至少两个并联的保护开关上分别设置采样桥臂，所述采样桥臂的信号输出端相互电连接。4.根据权利要求1所述的高精度电流检测方法，其特征在于，在至少两个并联的保护开关上设置采样桥臂，所述采样桥臂包括与保护开关对应的电流采样开关以及至少一个信号处理单元，所述电流采样开关的一端与信号处理单元的一个输入端电连接，至少两个所述电流采样开关与同一个信号处理单元电连接。5.根据权利要求1所述的高精度电流检测方法，其特征在于，所述保护开关和对应的电流采样开关集成在同一芯片内。6.一种采用权利要求1至5任一项所述的高精度电流检测方法的芯片模组，其特征在于，包括：至少一个保护开关，至少一个电流采样开关以及至少一个信号处理单元；所述电流采样开关与信号处理单元的一个输入端电连接；至少一个所述保护开关的两端分别与信号处理单元的另一个输入端、电流采样开关电连接。7.根据权利要求6所述的芯片模组，其特征在于，还包括：计量单元，所述计量单元用于接收由电流采样信号Is转化得的电压采样信号Vs，并且根据采样比例参数Q将采样电压信号Vs转换为保护开关电流信号Ip的计量值；所述信号处理单元包括运算器、第一电流回路参数传输端口和控制器；所述运算器用于维持电流采样开关和对应的保护开关两端的压差相同；所述第一电流回路参数传输端口用于接收或者输出第一电流回路参数；所述控制器用于调节电流采样开关和/或保护开关的开闭；所述控制器分别与运算器、第一电流回路参数传输端口电连接；所述计量单元与控制器电连接。8.根据权利要求7所述的芯片模组，其特征在于，所述计量单元与第一电流回路参数传输端口电连接，所述第一电流回路参数传输端口向计量单元输出第一电流回路参数；所述计量单元根据第一电流回路参数获得对应的采样比例参数Q，并且将采样电压信号Vs转换为保护开关电流信号Ip的计量值。9.根据权利要求7所述的芯片模组，其特征在于，所述信号处理单元还包括辅助开关单元，所述辅助开关单元用于根据第一电流回路参数调节解耦电阻值，使所述解耦电阻值与第一电流回路参数所对应的采样比例参数Q的乘积为恒定值；所述控制器与辅助开关单元电连接；所述辅助开关单元与计量单元电连接；所述计量单元接收由电流采样信号Is与解耦电阻值相乘转化得的电压采样信号Vs。10.根据权利要求9所述的芯片模组，其特征在于，还包括至少一个未在其上并联设置采样桥臂的第一保护开关；所述第一电流回路参数传输端口与第一保护开关的两端电连接，所述第一电流回路参数传输端口用于接收第一保护开关两端的电压差作为第一电流回路参数。11.根据权利要求9所述的芯片模组，其特征在于，所述电流回路为电池充电电流回路；所述第一电流回路参数传输端口与电池电连接，所述第一电流回路参数传输端口用于接收电池电压差作为第一电流回路参数。12.根据权利要求10所述的芯片模组，其特征在于，所述第一保护开关、保护开关和采样桥臂对应集成在同一采样芯片内。13.根据权利要求12所述的芯片模组，其特征在于，所述采样芯片至少为两个，至少两个所述采样芯片并联连接，所述计量单元接收各个采样芯片的采样电压信号Vs。14.根据权利要求12所述的芯片模组，其特征在于，还包括主板，所述采样芯片和计量单元设置在主板上表面，所述主板下表面设置有功率电极，所述主板与采样芯片、计量单元、功率电极电连接。15.根据权利要求12所述的芯片模组，其特征在于，还包括主板，所述采样芯片和计量单元内埋设置在主板内，所述主板下表面设置有功率电极，所述主板与采样芯片、计量单元、功率电极电连接。16.根据权利要求12所述的芯片模组，其特征在于，还包括主板，所述采样芯片内埋设置在主板内，所述主板下表面设置有功率电极，所述计量单元设置在主板上表面，所述主板与采样芯片、计量单元、功率电极电连接。17.一种如权利要求9所述的芯片模组的阶跃式采样电流解耦方法，其特征在于，包括如下步骤：S1：根据保护开关数目n设置对应数目的辅助开关单元；所述保护开关和辅助开关单元的关系满足公式：其中：Rp1、Rp2……Rpn为第1、2……n个所述保护开关的总等效电阻，R1、R2……Rn为第1、2……n个辅助开关单元的采样阻值，j为整数，1＜j＜n-1；预设个从小到大的第一阈值至第阈值；S2：获取所述第一电流回路参数，判断所述第一电流回路参数与第一阈值至第阈值的大小关系；S3：若第一电流回路参数低于第一阈值，开通第1个保护开关以及全部辅助开关单元；若第一电流回路参数高于第阈值并且低于第j阈值，开通第1个至第j个保护开关以及第1个至第个辅助开关单元，其中j为整数，1＜j＜n-1；若第一电流回路参数高于第阈值，开通全部保护开关以及第1个辅助开关单元；S4：以开通的辅助开关单元的总等效电阻作为解耦电阻值，输出辅助开关单元两端电压值作为采样电压信号Vs。
说明书desc
技术领域本发明属于半导体技术领域，尤其涉及一种高精度电流检测方法及其芯片模组。背景技术对于锂离子电池，其理想的工作范围受限很大并不宽泛，过压、过流和过温状态下会给锂离子电池带来一系列的安全隐患。因此，锂离子电池在应用过程中必须进行管理，尤其在动力电池的应用场景下。为了能更好更安全的发挥电池特性，一般需要通过精确量测电池的电压，电流以及温度等参数，通过一系列复杂算法来计算和预估电池的状态，这就对采样的精度提出了很高的要求。现有技术中电压和温度采样通过高精度的ADC已经可以得到和好的效果，但对于电流采样，现有技术中的一种方案是读取采样电阻两端电压来反映电流。由于采样电阻是串联在电流通路中，那么为了减小采样电阻引起的损耗，采样电阻通常不能选的太大，这就导致了小电流时采样信号很小，如图1B所示，导致采样误差很大。另外采样电阻阻值会随温度变化，导致在不同温度的采样误差。电量计是通过对电流进行积分来计算，假设长期有小电流通过采集不到或者采样不准的话，电量就会严重不准。为了解决以上问题现有技术的另一种方案是镜像电流源的电流采样方法。如图1A所示，保护开关S1和S2集成在一个芯片上，并在S1或S2上集成电流采样开关S21和信号处理单元。采样开关S21面积Ms远小于S2的面积，例如S2的面积Mp为采样开关S21面积Ms的Q倍，Q为采样比例参数，例如Q＝5000，那么对应的采样开关的导通电阻Rs为S2导通电阻Rp的5000倍，那么电流采样信号Is为保护开关电流信号Ip的1/5000，如下式所示：Q＝Rs/Rp；Ip＝Q·Is。因为电流采样开关和保护开关集成在同一芯片内，且采用相同工艺，所以电流采样开关S21和保护开关S2性能一致，采样信号不受温度等因素的影响。因为保护开关S2是电池保护电路中必须存在的器件，通过这种集成电流采样开关的镜像电流源方式采样电流，也不会带来额外的采样损耗。镜像电流源的电流采样方法的信号噪声主要来自于信号处理单元当中运算器输入端的残余压差，而采样比例参数Q在制作芯片时需考虑器件耐压性能使得其设置范围受限制，因此对于较小的保护开关电流信号Ip，电流采样信号Is也相应较小而信噪比较低。因此，如何在节约成本的同时提高采样精度、提高信噪比是一个亟待解决的问题。发明内容有鉴于此，本发明的目的之一在于提供一种高精度电流检测方法，在节约成本的同时，大幅减小了采样损耗，最大化提高了采样精度和信噪比。为实现上述目的，本发明第一方面提供了一种高精度电流检测方法，所述高精度电流检测方法用于在具备至少一个保护开关的电流回路中进行电流检测，其特征在于，包括如下步骤：在至少一个所述保护开关上并联设置采样桥臂，所述采样桥臂包括串联连接的至少一个电流采样开关和至少一个信号处理单元；所述电流采样开关至少为两个，和/或，对应的保护开关至少为相互并联的两个；所述信号处理单元用于处理电流采样信号Is以及调节电流采样开关和/或保护开关的开关状态；所述电流采样开关使用镜像电流源法获取电流采样信号Is；预设至少一个采样比例参数调节阈值；对第一电流回路参数进行采样，所述第一电流回路参数用于表示电流回路的负荷高低状态；判断第一电流回路参数与采样比例参数调节阈值的大小关系，根据判断结果调节电流采样开关和/或保护开关的开关状态；根据电流采样信号Is计算电流信号Ip，通过公式和公式计算保护开关电流信号Ip：Q＝Rs/Rp；Ip＝Q·Is；其中：Rp为导通的保护开关的总等效电阻，Rs为导通的采样开关的总等效电阻，Q为采样比例参数；优选的，所述信号处理单元通过调节电流采样开关和/或保护开关的开关状态使采样比例参数Q随电流回路负荷的升高而阶梯式下降。优选的，在至少两个并联的保护开关上分别设置采样桥臂，所述采样桥臂的信号输出端相互电连接。优选的，在至少两个并联的保护开关上设置采样桥臂，所述采样桥臂包括与保护开关对应的电流采样开关以及至少一个信号处理单元，所述电流采样开关的一端与信号处理单元的一个输入端电连接，至少两个所述电流采样开关与同一个信号处理单元电连接。优选的，所述保护开关和对应的电流采样开关集成在同一芯片内。本发明第二方面提供了一种采用上述高精度电流检测方法的芯片模组，包括：至少一个保护开关，至少一个电流采样开关以及至少一个信号处理单元；所述电流采样开关与信号处理单元的一个输入端电连接；至少一个所述保护开关的两端分别与信号处理单元的另一个输入端、电流采样开关电连接。优选的，还包括：计量单元，所述计量单元用于接收由电流采样信号Is转化得的电压采样信号Vs，并且根据采样比例参数Q将采样电压信号Vs转换为保护开关电流信号Ip的计量值；所述信号处理单元包括运算器、第一电流回路参数传输端口和控制器；所述运算器用于维持电流采样开关和对应的保护开关两端的压差相同；所述第一电流回路参数传输端口用于接收或者输出第一电流回路参数；所述控制器用于调节电流采样开关和/或保护开关的开闭；所述控制器分别与运算器、第一电流回路参数传输端口电连接；所述计量单元与控制器电连接。优选的，所述计量单元与第一电流回路参数传输端口电连接，所述第一电流回路参数传输端口向计量单元输出第一电流回路参数；所述计量单元根据第一电流回路参数获得对应的采样比例参数Q，并且将采样电压信号 Vs转换为保护开关电流信号Ip的计量值。优选的，所述信号处理单元还包括辅助开关单元，所述辅助开关单元用于根据第一电流回路参数调节解耦电阻值，使所述解耦电阻值与第一电流回路参数所对应的采样比例参数Q的乘积为恒定值；所述控制器与辅助开关单元电连接；所述辅助开关单元与计量单元电连接；所述计量单元接收由电流采样信号Is与解耦电阻值相乘转化得的电压采样信号Vs。优选的，还包括至少一个未在其上并联设置采样桥臂的第一保护开关；所述第一电流回路参数传输端口与第一保护开关的两端电连接，所述第一电流回路参数传输端口用于接收第一保护开关两端的电压差作为第一电流回路参数。优选的，所述电流回路为电池充电电流回路；所述第一电流回路参数传输端口与电池电连接，所述第一电流回路参数传输端口用于接收电池电压差作为第一电流回路参数。优选的，所述第一保护开关、保护开关和采样桥臂对应集成在同一采样芯片内。优选的，所述采样芯片至少为两个，至少两个所述采样芯片并联连接，所述计量单元接收各个采样芯片的采样电压信号Vs。优选的，还包括主板，所述采样芯片和计量单元设置在主板上表面，所述主板下表面设置有功率电极，所述主板与采样芯片、计量单元、功率电极电连接。优选的，还包括主板，所述采样芯片和计量单元内埋设置在主板内，所述主板下表面设置有功率电极，所述主板与采样芯片、计量单元、功率电极电连接。优选的，还包括主板，所述采样芯片内埋设置在主板内，所述主板下表面设置有功率电极，所述计量单元设置在主板上表面，所述主板与采样芯片、计量单元、功率电极电连接。本发明第三方面提供了一种上述的芯片模组的阶跃式采样电流解耦方法，包括如下步骤：S1：根据保护开关数目n设置对应数目的辅助开关单元；所述保护开关和辅助开关单元的关系满足公式：其中：Rp1、Rp2……Rpn为第1、2……n个所述保护开关的总等效电阻，R1、R2……Rn为第1、2……n个辅助开关单元的采样阻值，j为整数，1＜j＜n-1；预设个从小到大的第一阈值至第阈值；S2：获取所述第一电流回路参数，判断所述第一电流回路参数与第一阈值至第阈值的大小关系；S3：若第一电流回路参数低于第一阈值，开通第1个保护开关以及全部辅助开关单元；若第一电流回路参数高于第阈值并且低于第j阈值，开通第1个至第j个保护开关以及第1个至第个辅助开关单元，其中j为整数，1＜j＜n-1；若第一电流回路参数高于第阈值，开通全部保护开关以及第1个辅助开关单元；S4：以开通的辅助开关单元的总等效电阻作为解耦电阻值，输出辅助开关单元两端电压值作为采样电压信号Vs。本发明具有如下有益效果：因为电流采样开关和保护开关集成在同一芯片内，且采用相同工艺，所以电流采样开关和保护开关性能一致，采样信号不受温度等因素的影响。因为保护开关是电池保护电路中必须存在的器件，通过这种集成电流采样开关的镜像电流源方式采样电流，也不会带来额外的采样损耗。采用本发明所公开的高精度电流检测方法，信噪比得到进一步提升，对运放的需求也会有所降低，同时也提升了采样精度。在大电流工况下也可以在满足采样精度的情况下降低导通损耗，又可以降低系统成本。分布式电流采样方案采样增益在不同电流等级是不同的，电流采样增益随着电流变化呈现阶跃式变化，本发明在小电流时期采样电流的精度明显得到提升。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1A为现有技术中的采样电路的电路图；图1B为现有技术中的采样电流的示意图；图2A和图2B为本发明一实施例所公开的高精度电流检测方法的电路图及其对应的芯片集成示意图；图3A和图3B为本发明另一实施例所公开的高精度电流检测方法的电路图及其对应的芯片集成示意图；图4A至图4C为本发明另一实施例所公开的高精度电流检测方法的电路图及其对应的芯片集成示意图；图5A和图5B本发明另一实施例所公开的高精度电流检测方法的电路图及其对应的芯片集成示意图；图6A和图6B本发明另一实施例所公开的高精度电流检测方法的电路图及其对应的芯片集成示意图；图7A为本发明实施例所公开的阶跃式采样电流的解耦方法的电流采样增益的示意图；图7B为本发明实施例所公开的阶跃式采样电流的解耦方法的电路图；图7C为本发明实施例所公开的阶跃式采样电流的解耦方法应用在电池充电场景中的电路图；图8A图8B为本发明实施例所公开的阶跃式采样电流的解耦方法的采样芯片的集成示意图；图8C为本发明实施例所公开的阶跃式采样电流的解耦方法的多个采样芯片并联应用的电路图；图9A至图9C为本发明实施例所公开的阶跃式采样电流的解耦方法的电路元件设置在主板上的示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。本发明实施例公开了一种高精度电流检测方法，该高精度电流检测方法用于在具备至少一个保护开关的电流回路中进行电流检测，包括如下步骤：在至少一个保护开关上并联设置采样桥臂，采样桥臂包括串联连接的至少一个电流采样开关和至少一个信号处理单元；电流采样开关至少为两个，和/或，对应的保护开关至少为相互并联的两个；信号处理单元用于处理电流采样信号Is以及通过调节电流采样开关和/ 或保护开关的开关状态使采样比例参数Q随电流回路负荷的升高而阶梯式下降；电流采样开关使用镜像电流源法获取电流采样信号Is；预设至少一个采样比例参数调节阈值；对第一电流回路参数进行采样，第一电流回路参数用于表示电流回路的负荷高低状态；判断第一电流回路参数与采样比例参数调节阈值的大小关系，根据判断结果调节电流采样开关和/或保护开关的开关状态；根据电流采样信号Is计算电流信号Ip，通过公式和公式计算保护开关电流信号Ip：Q＝Rs/Rp；Ip＝Q·Is；其中：Rp为导通的保护开关的总等效电阻，Rs为导通的采样开关的总等效电阻，Q为采样比例参数。较佳地，保护开关和对应的电流采样开关集成在同一芯片内。因为电流采样开关和保护开关集成在同一芯片内，且采用相同工艺，所以电流采样开关和保护开关性能一致，采样信号不受温度等因素的影响。因为保护开关是电池保护电路中必须存在的器件，通过这种集成电流采样开关的镜像电流源方式采样电流，也不会带来额外的采样损耗。下面通过不同的实施例进行更为详细描述。需要说明的是，虽然说明书附图中均包含了第一保护开关S1，但第一保护开关S1并非本发明的核心，本发明的核心在于保护开关S2及其衍生、电流采样开关及其衍生、以及信号处理单元，说明书附图仅为示例作用。为了提升轻载电流采样精度，本发明提出了分布式镜像电流采样方法，如图2A、图2B 所示，保护开关S2分成保护开关S21和S22等，每部分开关都分别集成电流采样开关S211和S221。在小电流工况时，只开通保护开关S21，通过电流采样开关S211采样，因为保护开关只导通了部分开关，比如1/2，采样信号幅值是全部开关开通时的2倍，信噪比得到进一步提升，对运放的需求也会有所降低，同时也提升了采样精度。在大电流工况时，所有保护开关开通，在满足采样精度的情况下降低导通损耗。在其他的一些实施例中，为了进一步提升轻载电流采样精度，至少两个并联的保护开关上分别设置采样桥臂，采样桥臂的信号输出端相互电连接，如图3A、图3B所示，保护开关S2分成子开关S21，S22，S23，每部分开关都分别集成电流采样开关S211，S221和 S231。小电流工况时只开通S21，通过采样开关S211采样，因为保护开关只导通了部分开关，比如1/3，采样信号幅值是全部开关开通时的3倍，信噪比得到进一步提升，对运放的需求也会有所降低，同时也提升了采样精度。在大电流工况时，所有开关开通，在满足采样精度的情况下降低导通损耗。为了方便说明，以下实施例均以保护开关S2分成子开关S21，S22，S23为例进行说明，但本发明并不仅限于此，保护开关S2可根据实际需求分成大于等于2个保护开关，而且保护开关也不限于均分，或者每部分的导通电阻相等，可以根据实际需求去分配每部分保护开关的大小。在其他的一些实施例中，在至少两个并联的保护开关上设置采样桥臂，采样桥臂包括分别与保护开关对应的电流采样开关以及至少一个信号处理单元，电流采样开关的一端与信号处理单元的一个输入端电连接，至少两个电流采样开关与同一个信号处理单元电连接。如图4A所示，为了提升采样精度，对运放性能的要求也提高，相应的增加了系统成本，采样桥臂共用同一个信号处理单元，只采用一个运放实现高精度电流采样，三个电流采样开关S211，S221和S231输出并联接到运放的反相输入端。在小电流工况时只开通保护开关S21，通过电流采样开关S211采样电流，因为保护开关只导通了部分开关，比如 1/3，采样信号幅值是全部开关开通时的3倍，信噪比得到进一步提升，对运放的需求也会有所降低，同时也提升了采样精度。在大电流工况时，所有开关开通，在满足采样精度的情况下降低导通损耗。既可以保证电流采样精度，又可以降低系统成本。需要注意的是，上述实施例中第一保护开关S1和保护开关S2都集成在同一个芯片中，但根据实际情况需要，第一保护开关S1和保护开关S2还可以分别设置在两个芯片中。更进一步，至少两个保护开关设置有采样桥臂时，各个保护开关也可以在不同的芯片中，如图4B、图4C所示的各个保护开关S21，S22和S23等。在其他实施例中，在至少两个并联的保护开关上设置采样桥臂，并联的保护开关由同一个电流采样开关进行采样。如图5A、图5B所示，电流采样开关也可以合并为一个，减少因为在芯片内部做功能分割造成的面积浪费，保护开关S2分成保护开关S21，S22和S23等，三个保护开关共用电流采样开关S2。小电流工况时只开通S21，通过电流采样开关S2采样，因为保护开关只导通了部分开关，比如1/3，采样信号幅值是全部开关开通时的3倍，信噪比得到进一步提升，对运放的需求也会有所降低，同时也提升了采样精度。在大电流工况时，所有开关开通，在满足采样精度的情况下降低导通损耗，在其他实施例中，采样桥臂还包括至少一个电流采样开关组，电流采样开关组包括并联的至少两个电流采样开关；至少一个信号处理单元；信号处理单元与电流采样开关组串联连接。如图6A、图6B所示，可以设置多个电流采样开关与一个保护开关并联采用分布式镜像电流采样方法，通过多个采样开关分时工作增加轻载采样精度。比如，在小电流工况时打开全部采样开关，采样电流Is是只开一个采样开关时采样电流的3倍，同样可以达到提升小电流情况下的采样精度的需求。如图7B所示，电流采样开关合并为一个，保护开关S2分成保护开关S21，S22和S23等，三个保护开关共用电流采样开关S2。在小电流工况时，只开通保护开关S21，通过电流采样开关S2采样，因为主保护开关只导通了部分开关，比如1/3，采样信号幅值是全部开关开通时的3倍，信噪比得到进一步提升，对运放的需求也会有所降低，同时也提升了采样精度。在大电流工况时，所有开关开通，在满足采样精度的情况下降低导通损耗。需要注意的是，当电流小到一定程度时，采样电流会出现不准的问题，此时保持保护开关S21的压降比较大的状态即可。此外根据实际情况需要，还可以设置第一保护开关S1，只有保护开关S2和/或其对应的保护开关S21、S22、S23等，S21、S22、S23的面积依次为5至10倍为佳。本发明实施例还公开了一种阶跃式采样电流的解耦方法，包括如下步骤：S1：根据保护开关数目n设置对应数目的辅助开关单元；所述保护开关和辅助开关单元的关系满足公式：其中：Rp1、Rp2……Rpn为第1、2……n个所述保护开关的总等效电阻，R1、R2……Rn为第1、2……n个辅助开关单元的采样阻值，j为整数，1＜j＜n-1；预设个从小到大的第一阈值至第阈值；S2：获取所述第一电流回路参数，判断所述第一电流回路参数与第一阈值至第阈值的大小关系；S3：若第一电流回路参数低于第一阈值，开通第1个保护开关以及全部辅助开关单元；若第一电流回路参数高于第阈值并且低于第j阈值，开通第1个至第j个保护开关以及第1个至第个辅助开关单元，其中j为整数，1＜j＜n-1；若第一电流回路参数高于第阈值，开通全部保护开关以及第1个辅助开关单元；S4：以开通的辅助开关单元的总等效电阻作为解耦电阻值，输出辅助开关单元两端电压值作为采样电压信号Vs。分布式电流采样方案采样增益在不同电流等级是不同的，如图7A所示，电流从0到I1，电流采样增益为k1，电流从I1到I2，电流采样增益为k2，电流从I2到I3，电流采样增益为k3，电流采样增益随着电流变化呈现阶跃式变化。小电流电流采样增益大，小电流 0-I1时期采样电流信号和大电流I2-I3时期采样电流信号基本一样大，相比传统方案，本发明小电流时期采样电流的精度明显得到提升。本实施例以n＝3为例，如图7B所示。信号处理单元检测第一保护开关S1的压降，根据S1的导通压降，控制保护开关S21，S22和S23，以及辅助采样开关M1，M2和M3的开通和关断，从而得到单调的采样电压。比如，当S1的导通压降比较小时，比如低于第1 阈值，控制保护开关S21，辅助开关M1，M2和M3同时导通采样电阻R1，R2和R3并联，采样电压Vs＝K1×Ip×；当S1的导通压降增加，比如增加到高于第一阈值并且低于第二阈值时，控制保护开关S21和S22，辅助开关M1和M2同时导通，采样电阻R1和R2并联，采样电压Vs＝K2×Ip/；当S1的导通压降继续增加，比如增加到高于第二阈值时，控制保护开关S21，S22和S23，辅助开关M1同时导通，采样电阻为R1，采样电压Vs＝K3×Ip×R1。当K1＝3×K3，K2＝2×K3，R1＝R2＝R3时，采样电压Vs＝K3×Ip×R1，跟流过的电流呈线性关系。本案并不限定K1＝3×K3，K2＝2×K3，R1＝R2＝R3，只要控制K1， K2，K3，R1，R2和R3之间的对应关系确保采样电压和流过的电流呈线性关系即可。而且保护开关S1压降，只是作为电流采样开关的切换判断逻辑，采样精度并不需要很高。在其他的一些实施例中，如图7C所示，正常状况下电池充电会分为两个阶段，恒流预充，恒流充电或恒压充电两种状态，恒流预充阶段电池电压很低，比如低于3V，这是会用小电流恒流预充，这个阶段电流比较小，比如只有100mA；当电池电压达到3V，开始恒流充电模式，这是充电电流比较大，比如大于2A；当电池电压达到4.2V，开始恒压充电，这时的充电电流逐渐减小。我们也可以通过检测电池电压来决定保护开关的开通逻辑，比如，当电池电压小于3V时，控制保护开关S21，辅助开关M1，M2和M3同时导通采样电阻R1，R2和R3并联，采样电压Vs＝K1×Ip×；当电池电压大于4.2V时，控制保护开关S21和S22，辅助开关M1和M2同时导通，采样电阻R1和R2并联，采样电压Vs＝K2×Ip/；当电池电压在大于3V小于4.2V时，控制主开关S21，S22和S23，辅助开关M1同时导通，采样电阻为R1，采样电压Vs＝K3×Ip×R1。当K1＝3×K3， K2＝2×K3，R1＝R2＝R3时，采样电压Vs＝K3×Ip×R1，跟流过的电流呈线性关系。本案并不限定K1＝3×K3，K2＝2×K3，R1＝R2＝R3，只要控制K1，K2，K3，R1，R2和R3之间的对应关系确保采样电压和流过的电流呈线性关系即可。前面实施例，都是送全范围采样信号给计量单元ADC，ADC用于接收由电流采样信号 Is转化得的电压采样信号Vs，并且根据采样比例参数Q将采样电压信号Vs转换为保护开关电流信号Ip的计量值，这样ADC要很高位数，才能照顾全范围精度。为此，在其他实施例中，信号处理单元还包括：运算器、预精度采样信号接收端口及控制器，运算器用于接收电流采样信号Is并且计算保护开关电流信号Ip，预精度采样信号接收端口用于接收第一电流回路参数，控制器根据第一电流回路参数调节高精度采样增益，并将高精度采样增益输出至计量单元；控制器分别与运算器、预精度采样信号接收端口电连接；计量单元与信号转换单元电连接，信号转换单元与控制器电连接；信号转换单元将保护开关电流信号Ip转化为采样电压信号Vs，计量单元接收采样电压信号Vs并根据高精度采样增益将其转换为计量值。本实施例提出将采样芯片以数字信号比如I/O口或者I2C将K值切换状态传输至计量单元，其中K值为采样比例参数Q的倒数，由计量器内部程序来进行识别采样的K值，来减少ADC的位数，如图8A所示，根据S1的压降控制开关S21、S22和S23的开通和关断，同时将控制信号通过I/O口送到ADC，识别采样电路对应的电流增益，从而转换成和实际电流的呈线性的采样信号。由于保护开关和电流采样控制单元之间有很多信号需要传递，不但因为很多的互联浪费PCB资源，而且采样信号容易被干扰，针对这个问题，本实施例提出用一个硅片实现采样芯片和计量单元集成，如图8B所示，这样就可以使用半导体工艺进行互联，较少互联导致的空间占用。在其他的一些实施例中，如图8C所示，还可以在一个IC晶片或者封装体内部分不同 K级进行切换采样后，多个这样的晶片或者封装体并联进行电流扩展。比如第一采样芯片和第二采样芯片并联。并联后的电流汇报可以直接电流源汇集后，在电阻上形成电压，送给ADC采样。如果M1和M2为同型号各自采样精度为100uA，那么并联后，采样精度变为200uA。也可以根据电流大小，切换M1和M2。比如电流小的关断M1，电流大时都导通。并报告开通数量给采样，以便Digital修正等效采样增益，来实现大电流下的高精度采样依旧为100uA。由于电池保护空间狭小，留给保护开关和电流采样开关的封装体很有限，缺点是会导致封装体出Pin增加不少。本实施例提出使用半导体封装技术，制作芯片模组，如图9A和图9B所示，采样芯片和计量单元通过半导体Bump工艺出Pin，进行高精度焊接在BMS主板上表面，BMS主板下表面设置有功率电极，主板与采样芯片、计量单元、功率电极电连接。在其他的一些实施例中，如图9C所示，还可以通过内埋工艺，将采样芯片内埋在BMS 主板之中，并通过激光或者蚀刻打孔技术高精度引出电极。计量单元可以在主板表面，也可以一起内埋。综上，电流采样的瓶颈是高精度运放的放大精度。本发明所公开的诸多实施例的核心本质是，使用一个高精度运放，接受不同放大倍数但幅值相当的电流采样信号，以保障在各范围，均让运放工作在比较舒服的状态下。以现有技术为例，在接受单独电流采样信号的时候，电流汇报精度比较稳定的范围为30％～100％负载，做得好的为20％～100％负载，做得比较优秀的是10％～100％负载。也就是说，每级切换的MOS电流容量差在 3倍、5倍乃至10倍为佳。作为细节的描述，即S22的Rdson是S21的 Rdson的3倍、5倍乃至10倍为佳，S23的Rdson是S22的Rdson的3 倍、5倍乃至10倍为佳。这样就可以在切换后，保障运放入口的电流采样信号强度是相当的。比如现有技术中较为优秀的，实现1mA的精度时，采样电阻为 1mOhm，也就是1uV精度。也就是运放的精度是1uV。MOS内阻1mOhm时，可以采样到1mA；需要更低电流时，将MOS内阻切到10mOhm的，就可以实现1uV100uA采样。以手机电池为例，当下最大电流需求为24A，损耗高达0.576W，影响客户感受及需要大尺寸的电阻，影响BMS体积，牺牲电池容量。若要精度100uA，则电阻10mOhm，损耗5.76W，这在手机场合是完全不可接受的，因此不可实现100uA精度。本发明所公开的诸多实施例可以将采样电阻完全去除，仅仅通过保护MOS的内阻切换，就可以实现低至100uA甚至更低，高至24A甚至更高的全范围高精度采样。对所公开的实施例的上述说明，使本领域专业技术人员能够实现或使用本发明。对这些实施例的多种修改对本领域的专业技术人员来说将是显而易见的，本文中所定义的一般原理可以在不脱离本发明的精神或范围的情况下，在其它实施例中实现。因此，本发明将不会被限制于本文所示的这些实施例，而是要符合与本文所公开的原理和新颖特点相一致的最宽的范围。
