标题title
基于智能温度感知的超声刀血管自适应剪切方法及系统
摘要abst
本发明揭示了一种基于智能温度感知进行血管密闭及切开的超声软组织切割止血手术方法和系统。该系统包括发生器、换能器和超声刀头，发生器在工作时实时收集手术器械的反馈参数，然后通过温度分布函数模型根据这些反馈参数和器械特征参数预估手术部位的实时温度，发生器根据第一自适应能量控制算法来控制血管手术部位的温度位于第一温度范围来完成血管密闭过程，然后根据第二自适应能量控制算法来控制血管的温度位于第二温度范围来完成血管干燥凝固和切开过程，精准可靠。
权利要求书clms
1.一种基于智能温度感知的超声刀血管自适应剪切方法，其特征在于，包括如下步骤，S1、根据温度分布函数模型预估超声刀杆实时温度Test；S2、判断所述实时温度Test所处温度范围；S3、根据判断结果，调节施加到超声刀换能器的功率水平以控制超声刀电流输出，进而控制温度变化速率。2.根据权利要求1所述的方法，其特征在于，所述温度分布函数模型为神经网络算法模型，包括前馈神经网络、记忆神经网络、注意力神经网络的一种或多种算法模型组合，模型训练方法为监督学习、半监督学习、无监督学习和强化学习的一种或多种组合。3.根据权利要求2所述的方法，其特征在于，所述模型训练方法具体为从训练集中提取输入特征，输入至所述神经网络算法模型中计算每个神经元的中间值和梯度值，模型的损失函数可以为均方误差MSE或者平均绝对误差MAE，并利用梯度下降法进行权重更新，重复以上过程直到模型达到预定的停止条件，达到停止条件后停止训练并保存模型。4.根据权利要求3所述的方法，其特征在于，所述温度分布函数模型由层和相应的神经元及权重构成，权重参数和应用程序保存在发生器内存中，内存为Flash、EEPROM或者其他非易失存储设备，应用程序在处理器中运行，所述处理器或为存在于所述发生器中的ARM、DSP、FPGA、CPU、GPU或者ASIC芯片，或为通过网络连接的远程服务器。5.根据权利要求1所述的方法，其特征在于，所述步骤S1中，“根据温度分布函数模型预估超声刀杆实时温度”具体包括，向所述温度分布函数模型输入特征参数，所述特征参数包括工作反馈参数，物理结构特征参数，环境参数的一种或多种组合。6.根据权利要求5所述的方法，其特征在于，所述工作反馈参数包括实时电压U、实时电流I、功率P、阻抗R、实时谐振频率f、实时电压电流相位差θ的一种或几种参数；所述物理结构特征参数包括超声刀刀杆材料、刀杆长度的一种或几种参数；所述环境参数包括环境温度、环境湿度的一种或几种参数。7.根据权利要求1所述的方法，其特征在于，所述步骤S2中，“判断实时温度所处温度范围”具体包括，预设三个温度阈值，从低到高分别为第一温度阈值T1、第二温度阈值T2、第三温度阈值T3；预设温度范围，低于所述第一温度阈值T1为第一温度范围，所述第一温度阈值T1和第二温度阈值T2之间为第二温度范围，所述第二温度阈值T2和第三温度阈值T3之间为第三温度范围；确定实时温度Test所处温度范围。8.根据权利要求7所述的方法，其特征在于，所述步骤S3中，当判断得到所述实时温度Test所处第一温度范围时，在第一电流值输出范围内自适应调整超声刀换能器的功率水平使超声刀杆在保持第一温度变化速率的基础上达到第二温度阈值T2；当判断得到所述实时温度Test所处第二温度范围时，在第二电流值输出范围内自适应调整超声刀换能器的功率水平使超声刀杆在保持第二温度变化速率的基础上达到第三温度阈值T3；当判断得到所述实时温度Test所处第三温度范围时，在第三电流值输出范围内自适应调整超声刀换能器的功率水平使超声刀保持第三温度变化速率，持续时间t1。9.根据权利要求8所述的方法，其特征在于，所述第一电流值、第二电流值、第三电流值为一个定值或一个数值范围；所述第一电流输出值大于所述第二电流输出值，所述第二电流输出值大于所述第三电流输出值。10.根据权利要求9所述的方法，其特征在于，所述第一、第二、第三温度变化速率均为0～50℃/s之内，且所述第一温度变化速率最大。11.根据权利要求10所述的方法，其特征在于，所述超声刀杆在保持第三温度变化速率的基础上升温不超过200℃，所述第三温度范围对应血管的最适宜闭合温度范围。12.根据权利要求11所述的方法，其特征在于，当超声刀杆在保持第三温度变化速率的基础上升温一段时间t1后，调节施加到超声刀换能器的功率水平以控制超声刀的电流输出值，使超声刀杆在保持第四温度变化速率的基础上升温并保持在第四温度范围内。13.根据权利要求12所述的方法，其特征在于，所述第四温度范围不超过300℃，所述第四温度范围对应于血管干燥和切割温度范围。14.一种基于智能温度感知的超声刀血管自适应剪切系统，其特征在于，包括实时温度预估单元，用于根据温度分布函数模型预估超声刀杆实时温度Test；处理单元，用于判断所述实时温度Test所处温度范围；调节单元，用于根据判断结果，调节施加到超声刀换能器的功率水平以控制超声刀电流输出，进而控制温度变化速率。15.一种基于智能温度感知的超声刀血管自适应剪切控制的发生器，其特征在于，包括控制电路，所述控制电路耦接到存储器，所述控制电路被配置为能够：根据温度分布函数模型预估超声刀杆实时温度Test；判断所述实时温度Test所处温度范围；根据判断结果，调节施加到超声刀换能器的功率水平以控制超声刀电流输出，进而控制温度变化速率。16.一种基于智能温度感知的超声刀血管自适应剪切控制的超声刀外科器械，其特征在于，包括超声机电系统，所述超声机电系统包括经由超声波导联接到超声刀的超声换能器；以及发生器，所述发生器被配置为向所述超声换能器供应功率，其中所述发生器包括控制电路，所述控制电路被配置为能够：根据温度分布函数模型预估超声刀杆实时温度Test；判断所述实时温度Test所处温度范围；根据判断结果，调节施加到超声刀换能器的功率水平以控制超声刀电流输出，进而控制温度变化速率。
说明书desc
技术领域本发明涉及医疗器械领域，尤其涉及一种超声手术刀的控制方法及系统，特别为一种基于智能温度感知的超声刀血管自适应剪切方法及系统、及设置有该系统的发生器、超声刀外科器械。背景技术软组织超声切割止血手术系统，是指将通过压电转换器获得的超声振动进一步放大，并由超声刀杆将放大后的超声振动用于对软组织的切割和凝闭的器械。临床用这种器械可在较低温度和较少出血的情况下实现病灶切除，并能确保最小的组织侧向热损伤。随着微创外科手术的普及，超声手术刀已经成为一种常规手术器械。超声刀系统主要由发生器、换能器和超声刀杆组成，如图1所示，超声刀的换能器11和超声刀外壳12配接在一起，套管13位于超声刀外壳12的远端，位于最远端的超声刀杆14在套管13内部与换能器11耦接在一起，换能器11通过线缆15与发生器连接。发生器中超声频率的电流传导至换能器，换能器将电能转化为前后振动的机械能，通过超声刀杆的传递和放大使超声刀杆末端以一定频率振动，摩擦产生的热量导致与刀尖接触的组织细胞内水汽化，蛋白质氢键断裂，细胞崩解重新融合，组织凝固后被切开。在闭合血管时，刀尖与组织蛋白接触，通过机械振动产生热量，导致组织内胶原蛋白变性，在刀尖钳口压力作用下上下两侧血管壁融合在一起，并在高温下干燥凝固形成一个坚固的闭合区域达到止血目的。一般来讲，控制合适的温度范围可以将血管切割过程分为血管密闭和切开两个阶段，先控制输出相对较低功率水平让血管处于合适的温度范围保证血管能够较好的融合而不被切开，研究表明当血管温度处于110℃～180℃时可以完成最佳的熔合效果，继而提高输出功率水平控制血管处于200℃以上的高温来实现血管的快速干燥凝固和切开过程。鉴于此，有必要设计一种能智能控制超声刀杆温度及换能器功率水平的自适应剪切方法。发明内容本发明为了解决上述技术问题，提供了一种基于智能温度感知的超声刀血管自适应剪切方法及系统、及设置有该系统的发生器、超声刀外科器械。为解决以上技术问题，本发明的技术方案为：一种基于智能温度感知的超声刀血管自适应剪切方法，包括如下步骤，S1、根据温度分布函数模型预估超声刀杆实时温度Test；S2、判断所述实时温度Test所处温度范围；S3、根据判断结果，调节施加到超声刀换能器的功率水平以控制超声刀电流输出，进而控制温度变化速率。优选的，所述温度分布函数模型为神经网络算法模型，包括前馈神经网络、记忆神经网络、注意力神经网络的一种或多种算法模型组合，模型训练方法为监督学习、半监督学习、无监督学习和强化学习的一种或多种组合。优选的，所述模型训练方法具体为从训练集中提取输入特征，输入至所述神经网络算法模型中计算每个神经元的中间值和梯度值，模型的损失函数可以为均方误差MSE或者平均绝对误差MAE，并利用梯度下降法进行权重更新，重复以上过程直到模型达到预定的停止条件，达到停止条件后停止训练并保存模型。优选的，所述温度分布函数模型由层和相应的神经元及权重构成，权重参数和应用程序保存在发生器内存中，内存为Flash、EEPROM或者其他非易失存储设备，应用程序在处理器中运行，所述处理器或为存在于所述发生器中的ARM、DSP、FPGA、CPU、GPU或者ASIC芯片，或为通过网络连接的远程服务器。优选的，所述步骤S1中，“根据温度分布函数模型预估超声刀杆实时温度”具体包括，向所述温度分布函数模型输入特征参数，所述特征参数包括工作反馈参数，物理结构特征参数，环境参数的一种或多种组合。优选的，所述工作反馈参数包括实时电压U、实时电流I、功率P、阻抗R、实时谐振频率f、实时电压电流相位差θ的一种或几种参数；所述物理结构特征参数包括超声刀刀杆材料、刀杆长度的一种或几种参数；所述环境参数包括环境温度、环境湿度的一种或几种参数。优选的，所述步骤S2中，“判断实时温度所处温度范围”具体包括，预设三个温度阈值，从低到高分别为第一温度阈值T1、第二温度阈值T2、第三温度阈值T3；预设温度范围，低于所述第一温度阈值T1为第一温度范围，所述第一温度阈值T1和第二温度阈值T2之间为第二温度范围，所述第二温度阈值T2和第三温度阈值T3之间为第三温度范围；确定实时温度Test所处温度范围。优选的，所述步骤S3中，当判断得到所述实时温度Test所处第一温度范围时，在第一电流值输出范围内自适应调整超声刀换能器的功率水平使超声刀杆在保持第一温度变化速率的基础上达到第二温度阈值T2；当判断得到所述实时温度Test所处第二温度范围时，在第二电流值输出范围内自适应调整超声刀换能器的功率水平使超声刀杆在保持第二温度变化速率的基础上达到第三温度阈值T3；当判断得到所述实时温度Test所处第三温度范围时，在第三电流值输出范围内自适应调整超声刀换能器的功率水平使超声刀保持第三温度变化速率，持续时间t1。优选的，所述第一电流值、第二电流值、第三电流值为一个定值或一个数值范围；所述第一电流输出值大于所述第二电流输出值，所述第二电流输出值大于所述第三电流输出值。优选的，所述第一温度变化速率、第二温度变化速率、第三温度变化速率均为0～50℃/s之内，且所述第一温度变化速率最大。优选的，所述超声刀杆在保持第三温度变化速率的基础上升温不超过200℃，所述第三温度范围对应血管的最适宜闭合温度范围。优选的，当超声刀杆在保持第三温度变化速率的基础上升温一段时间t1后，调节施加到超声刀换能器的功率水平以控制超声刀的电流输出值，使超声刀杆在保持第四温度变化速率的基础上升温并保持在第四温度范围内。优选的，所述第四温度范围不超过300℃，优选为200℃～300℃，所述第四温度范围对应于血管干燥和切割温度范围。本发明还揭示了一种基于智能温度感知的超声刀血管自适应剪切系统，包括：实时温度预估单元，用于根据温度分布函数模型预估超声刀杆实时温度Test；处理单元，用于判断所述实时温度Test所处温度范围；调节单元，用于根据判断结果，调节施加到超声刀换能器的功率水平以控制超声刀电流输出，进而控制温度变化速率。本发明还揭示了一种基于智能温度感知的超声刀血管自适应剪切控制的发生器，包括：控制电路，所述控制电路耦接到存储器，所述控制电路被配置为能够：根据温度分布函数模型预估超声刀杆实时温度Test；判断所述实时温度Test所处温度范围；根据判断结果，调节施加到超声刀换能器的功率水平以控制超声刀电流输出，进而控制温度变化速率。本发明还揭示了一种基于智能温度感知的超声刀血管自适应剪切控制的超声刀外科器械，包括：超声机电系统，所述超声机电系统包括经由超声波导联接到超声刀的超声换能器；以及发生器，所述发生器被配置为向所述超声换能器供应功率，其中所述发生器包括控制电路，所述控制电路被配置为能够：根据温度分布函数模型预估超声刀杆实时温度Test；判断所述实时温度Test所处温度范围；根据判断结果，调节施加到超声刀换能器的功率水平以控制超声刀电流输出，进而控制温度变化速率。本发明的有益效果主要体现在：超声刀杆工作时刀杆实际温度为沿着刀杆的一维空间分布，其上温度分布由超声刀杆实时工作反馈参数、物理结构特征参数以及周围环境参数集合决定，每个温度分布对应于温度分布函数的一个解，利用机器学习算法可以逼近该函数；超声刀杆工作时根据其实时谐振频率、电压、电流、阻抗、功率及外形和环境等特征参数，输入机器学习算法模型就可以估计出超声刀刀杆的实时温度分布，进而根据估计的温度进行功率控制，准确有效。将实时特征参数集输入至少一种机器学习算法模型可以进行超声刀刀杆包括刀尖温度估计；根据第一能量控制算法调整输出功率水平保持目标温度控制在第一温度范围内，完成血管密闭过程；根据第二能量控制算法调整输出功率水平保持目标温度控制在第二温度范围内，从而完成血管干燥凝固和切开过程。附图说明图1是现有技术中超声刀的结构配置示意图；图2是本发明基于温度分布函数模型预估超声刀杆实时温度的流程图；图3是本发明基于智能温度感知的超声刀血管自适应剪切方法的流程示意图；图4是本发明基于智能温度感知的超声刀的第一自适应能量控制算法的流程图；图5是本发明基于智能温度感知的超声刀的第二自适应能量控制算法的流程图；图6是本发明基于智能温度感知的超声刀血管自适应剪切中预估目标温度变化的一种实施例的曲线图。具体实施方式以下将结合附图所示的具体实施方式对本发明进行详细描述。但这些实施方式并不限于本发明，本领域的普通技术人员根据这些实施方式所做出的结构、方法、或功能上的变换均包含在本发明的保护范围内。超声刀系统在工作过程中利用锁相算法改变换能器的工作频率使换能器工作在最大工作效率状态，也就是谐振状态。在谐振状态下，声波在超声刀刀杆上传播必须满足驻波条件，假设超声刀刀杆长度为L，声波波长为λ，声速为v，谐振频率为f，则在谐振状态下必须满足以下工作条件：其中n为正整数。假设声波周期为τ，则满足以下公式：可以得到：实际工作中热量沿着超声刀刀杆的设置方向扩散，因此在超声刀刀杆不同位置温度可能不同，不同位置温度t表示为：t＝T T为刀杆上的一个位置温度分布函数，l的范围为0～L，超声刀杆刀尖一侧顶点位置为坐标原点。温度可以影响刀杆的杨氏模量，最终影响声波速度，刀杆上不同位置的声速v可以表示为温度的函数：v＝V) 公式可以表示为：公式可以表示为：公式为一个积分方程，对于确定时间点，f为确定的谐振频率，温度T受电压、电流、功率、阻抗、刀杆形状、环境参数等参数影响。在n、f和L确定的情况下积分方程的温度分布函数T可能有无穷多个解，对于不同的刀杆，会有更多种不同的温度分布。鉴于此，本发明揭示了一种机器学习算法模型，具体为神经网络算法模型，人工神经网络算法模型是一种受人脑神经系统启发而构造的数学模型，与生物神经元类似，由多个节点互相连接而成，可以用来对数据之间的复杂关系进行建模。不同节点之间的连接被赋予不同的权重，每个权重代表一个节点对另外一个节点的影响大小。每个节点代表一种特定函数，来自其他节点的信息经过其相应的权重综合计算，输入到一个激活函数中并得到一个新的活性值。激活函数用来引入非线性元素，增加神经网络的表达能力，常用的激活函数有Sigmoid，Tanh，ReLU等。从系统观点来看，人工神经元是由大量神经元通过极其丰富和完善的连接而构成的自适应非线性动态系统。目前最常用的神经网络学习算法为反向传播算法，优化方法为梯度下降算法。理论上，一个两层的神经网络就可以逼近任意的函数，增加网络层数可以让神经网络在相同的神经元数量下具有更强的表示能力。目前比较常用的神经网络模型有前馈神经网络模型、记忆神经网络模型及注意力神经网络模型等：多层感知机和卷积神经网络为前馈神经网络模型；循环神经网络为记忆神经网络模型，常用的RNN模型包括门控神经单元和长短期记忆神经网络；注意力神经网络模型包括Transformer等。记忆神经网络模型在前馈神经网络基础上增加了记忆能力，常用来处理时序数据，常用的记忆神经网络包括RNN、GRU、LSTM等。GRU和LSTM具有长期的记忆能力，能够处理长时间序列。本发明温度分布函数模型可以基于机器学习算法模型包括神经网络算法模型中的一种或者多种算法模型组合。输入特征包括工作反馈参数，物理结构特征参数，环境参数的一种或多种组合。所述工作反馈参数包括但不限于实时电压U、实时电流I、功率P、阻抗R、实时谐振频率f；所述物理结构特征参数包括但不限于超声刀杆材料、长度；所述环境参数包括但不限于环境温度、环境湿度。输入特征越完备，神经网络模型的逼近能力越强。本发明模型中，电压U和电流I由发生器实时采样得到，实时功率P和阻抗R可以由以下公式计算得到：P＝U×I 实时频率f由以下公式计算得到：f＝k× 其中，k由实时电压U和电流I的一个函数关系确定：k＝K θ为实时电压电流相位差，计算公式为：θ＝θU-θI 电压相位θU和电流相位θI由发生器实时采样得到，θ0为一个常数。电压电流传感器采样频率可以为实际信号频率的64倍或者128倍等，输出电压U、输出电流I，谐振频率f、频率一阶导数df、阻抗R和相位θ、功率P等参数由采样值经过FFT等数学运算得到。超声刀刀杆材料、长度等物理结构特征参数可以保存在超声刀或者发生器的存储芯片中，发生器直接读取相应的存储芯片可以得到这些特征参数，环境参数可以通过传感器进行实时测量得到。本发明模型训练方法可以为监督学习、半监督学习、无监督学习和强化学习等方式。监督学习需要采集模型的所有输入特征信息以及训练标签，可以以一定的时间间隔采集，时间间隔可以为1ms或者10ms，并测量实时温度作为监督训练标签，实时剪切温度点可以采用嵌入或者外部的温度传感器或者红外测温仪来测量得到，采集大量标记数据得到作为训练数据集S。模型监督学习实现的一种神经网络模型训练过程可以为：从训练数据集S中取输入特征，并输入神经网络模型计算每个神经元的中间值和梯度值，模型的损失函数可以为均方误差MSE或者平均绝对误差MAE，并利用梯度下降法进行权重更新，重复以上过程直到模型达到预定的停止条件，比如预测精度达到目标值或者损失不再减小，达到停止条件后停止训练并保存模型，这个模型即可以表示所有目标超声刀工作时刀杆包括刀尖上的温度分布的函数。训练好的模型由各个层和相应的神经元及权重构成，权重参数和应用算法程序保存在发生器内存中，内存可以为Flash、EEPROM或者其他非易失存储设备中，应用程序在处理器中运行，处理器可以为存在于发生器中的ARM、DSP、FPGA、CPU、GPU或者ASIC芯片，也可以为通过网络连接的远程服务器。本发明温度分布函数模型预估温度方法如图2所示，将实时超声刀特征参数集X输入模型，模型根据输入的特征集合可以找到最可能的刀杆温度分布，温度Test可以由在该温度分布中得到，Test即为预估的超声刀杆实时温度。如图3所示，本发明揭示了一种基于智能温度感知的超声刀血管自适应剪切方法，包括如下步骤：S1、根据温度分布函数模型预估超声刀杆实时温度Test；S2、判断所述实时温度Test所处温度范围；S3、根据判断结果，调节施加到超声刀换能器的功率水平以控制超声刀电流输出，进而控制温度变化速率。结合图4和图5揭示的一种实施例，本发明能基于预估的实时温度控制超声刀换能器的输出功率水平来实现血管的密闭和切开过程。首先发生器根据第一能量控制算法来控制血管手术部位的温度位于第一温度范围来完成血管密闭过程，第一温度范围可以为0℃～200℃内的一个合适温度范围，第一能量控制算法一种实现方式如图4所示，通过温度估计模型预估实时温度值，根据该温度值控制输出能量。具体来讲，首先当判断得到所述实时温度Test所处第一温度范围时，在第一电流值输出范围内自适应调整超声刀换能器的功率水平使超声刀杆在保持第一温度变化速率的基础上达到第二温度阈值T2，第一电流范围可以对应于较大电流值，实现较大功率水平输出，用来达到快速去除血管表层水分，并快速升温的目的。当判断得到所述实时温度Test所处第二温度范围时，即达到第一温度阈值T1且低于第二温度阈值T2时，可以在第二电流值输出范围内自适应调整超声刀换能器的功率水平使超声刀杆在保持第二温度变化速率的基础上达到第三温度阈值T3，从而逐步提高血管温度值，使血管组织内胶原蛋白逐步变性。当判断得到所述实时温度Test所处第三温度范围时，即达到第二温度阈值T2且低于第三温度阈值T3时，可以在第三电流值输出范围内自适应调整超声刀换能器的功率水平使超声刀保持第三温度变化速率，持续时间t1，从而实现两侧血管壁完全熔合。以上温度范围可以为0～200℃内的合适温度范围，温度变化速率可以为0～50℃/s内的合适速率，且所述第一温度变化速率最大。所述超声刀杆在保持第三温度变化速率的基础上升温不超过200℃，所述第三温度范围对应血管的最适宜闭合温度范围。所述第一电流值、第二电流值、第三电流值为一个定值或一个数值范围；所述第一电流输出值大于所述第二电流输出值，所述第二电流输出值大于所述第三电流输出值。血管密闭完成后采用第二能量控制算法实现切开过程，一种控制过程如图5所示。当估计目标温度达到密闭结束温度阈值或者超出预定时间阈值后可以判断血管密闭完成。在确认血管密闭完成后，即当超声刀杆在保持第三温度变化速率的基础上升温一段时间t1后，调节施加到超声刀换能器的功率水平以控制超声刀的电流输出值，将电流值调整到一个较大的第四电流范围，从而保证达到一个较大的功率水平，使超声刀杆在保持第四温度变化速率的基础上升温并保持在第四温度范围内，从而实现血管的快速干燥凝固并切开。所述第四温度范围不超过300℃，可以为200℃～300℃，所述第四温度范围对应于血管干燥和切割温度范围。以上控制过程只是根据温度分布函数模型实现血管剪切过程的一种具体实施方式，也可以将控制过程合为一个或者分成多个控制过程，均在本发明范围内。根据上述过程进行血管剪切的一条温度变化曲线如图6所示，该温度为神经网络模型估计的位于刀尖特定区域的最大温度。简单来说目的在于在三个温度范围内均需要根据实时温度变化速率实时自适应上下调整功率水平，来维持目标温度变化速率，温升速率过大的时候降低电流大小，温升速率过小的时候提升电流大小。首先以较大功率水平开始密闭过程，温度快速上升，在时间t1达到温度阈值T1；然后以第二电流范围调整输出功率水平，在时间t2达到温度阈值T2；然后以第三电流范围调整输出功率水平，在时间t3达到温度阈值T3，此时完成血管密闭过程；最后以第四电流水平调整输出功率水平，完成血管干燥凝固和切开过程。以上仅是本发明的优选实施方式，应当指出的是，上述优选实施方式不应视为对本发明的限制，本发明的保护范围应当以权利要求所限定的范围为准。对于本技术领域的普通技术人员来说，在不脱离本发明的精神和范围内，还可以做出若干改进和润饰，这些改进和润饰也应视为本发明的保护范围。
