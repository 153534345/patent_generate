标题title
一种基于Civil3D的筑坝结构及施工图创建方法
摘要abst
本发明公开了一种基于Civil3D的筑坝结构及施工图创建方法，包括以下步骤：定义初始结构点，以所述初始结构点为起点，搭建右半边坝顶结构框架；以坝顶最外侧端点为起始点，搭建侧边护坡结构框架；判断所述侧边护坡结构框架的底部与地面的关系；若所述侧边护坡结构框架的底部位于地面以上，则进行坝底铺排；若所述侧边护坡结构框架的底部位于地面以下，则不进行坝底铺排；当不进行坝底铺排时，在所述侧边护坡结构框架的底部上方进行挖方处理，得到筑坝断面结构框架，能够实现根据输入参数，自动创建筑坝结构框架，且无需手动修改和返工，从而提高筑坝结构框架的创建效率和质量。
权利要求书clms
1.一种基于Civil3D的筑坝结构及施工图创建方法，其特征在于，包括以下步骤：定义初始结构点，以所述初始结构点为起点，搭建右半边坝顶结构框架；以坝顶最外侧端点为起始点，搭建侧边护坡结构框架；判断所述侧边护坡结构框架的底部与地面的关系；若所述侧边护坡结构框架的底部位于地面以上，则进行坝底铺排；若所述侧边护坡结构框架的底部位于地面以下，则不进行坝底铺排；当不进行坝底铺排时，在所述侧边护坡结构框架的底部上方进行挖方处理，得到筑坝断面结构框架；在Civi3D软件中点击筑坝设计按钮，选择筑坝布置线；根据所述筑坝断面结构框架输入筑坝设计参数，所述设计参数包括坝顶高程、设计纵坡、坝顶宽度、迎水坡坡比，背水坡坡比、最小坝高、偏移设定、采样线间距和采样线宽度；通过拾取绘图基点自动生成排列整齐的筑坝纵断面剖面图、横断面剖面图以及平面布置图和工程量明细表，完成筑坝作业。2.根据权利要求1所述的一种基于Civil3D的筑坝结构及施工图创建方法，其特征在于，所述搭建筑坝结构框架包括以下步骤：以坝顶的宽度和厚度作为控制条件，定义坝顶结构点P1、P2、P4和P4；指定坝顶宽度的偏移目标，依次连接P1、P2、P3和P4，得到所述坝顶结构框架。3.根据权利要求2所述的一种基于Civil3D的筑坝结构及施工图创建方法，其特征在于，还包括以下步骤：填充所述坝顶结构框架；在所述坝顶结构框架的结构线处预留坝顶宽度标注结构线和标注接口，在坝顶结构框架的中心线处预留标高及标注接口。4.根据权利要求1所述的一种基于Civil3D的筑坝结构及施工图创建方法，其特征在于，所述搭建侧边护坡结构框架包括以下步骤：以坝顶最外侧端点为起始点，沿参数边坡坡度斜向下引出直线至端点P7，端点P7与所述坝顶最外侧端点的垂直高度差为参数侧边护坡的高度；指定端点P7的偏移目标，以参数侧边护坡厚度为控制条件，定义结构点P5和P6，依次连接坝顶最外侧端点、P5、P6和P7，得到所述侧边护坡结构框架。5.根据权利要求4所述的一种基于Civil3D的筑坝结构及施工图创建方法，其特征在于，还包括以下步骤：填充所述侧边护坡结构框架；在端点P7处预留设计水位标准结构线和标注接口；在边坡处预留边坡坡度标注接口。6.根据权利要求4所述的一种基于Civil3D的筑坝结构及施工图创建方法，其特征在于，所述进行坝底铺排包括以下步骤：若端点P7位于地面以上且到地面的距离大于底部铺排的高度，则从端点P7出发，以负的边坡坡度向下引出直线至与地面相交，将交点定义为虚拟结构点AP1；判断坝底坡脚线是否偏移；若坝底坡脚线偏移，则将偏移点垂直投影至地面，并将偏移点向上平移一个铺排厚度，将平移后的偏移点作为坝底铺排起点的上边界点，连接端点P7和所述上边界点；将从边坡坡度向下引出的直线的延长线与地面的交点作为坝底铺排起点的下边界点；以铺排宽度和铺排偏移作为铺排外侧点的控制条件，填充坝底铺排形状；若坝底坡脚线无偏移，则将虚拟结构点AP1作为坝底铺排起点的下边界点，以铺排宽度和铺排偏移作为铺排外侧点的控制条件，将坝底铺排起点的上边界点作为下边线平移一个铺排厚度后与坝身破线的交点，连接端点P7与坝底铺排起点的上边界点，填充坝底铺排形状。7.根据权利要求6所述的一种基于Civil3D的筑坝结构及施工图创建方法，其特征在于，所述进行坝底铺排还包括以下步骤：若端点P7位于地面以上且到地面的距离小于等于底部铺排的高度，则从端点P7引出坡度为负的坡线至与地面相交，并将交点作为坝底铺排起点的下边界点；若坝底坡脚线偏移，则将偏移点垂直投影至地面，并将偏移点向上平移一个铺排厚度，将平移后的偏移点作为坝底铺排起点的上边界点，连接端点P7和所述上边界点；将从边坡坡度向下引出的直线的延长线与地面的交点作为坝底铺排起点的下边界点；以铺排宽度和铺排偏移作为铺排外侧点的控制条件，填充坝底铺排形状。8.根据权利要求6或7所述的一种基于Civil3D的筑坝结构及施工图创建方法，其特征在于，所述进行坝底铺排还包括以下步骤：若坝底坡脚线偏移，在坝底铺排的下方预留铺排宽度标注结构线及标注接口，在坝身下方预留坝身半边宽度标注结构线及标注接口；若坝底坡脚线无偏移，在坝底铺排下方预留铺排宽度标注结构线及标注接口，在坝身下方预留坝身半边宽度标注结构线及标注接口。9.根据权利要求4所述的一种基于Civil3D的筑坝结构及施工图创建方法，其特征在于，还包括：为所述筑坝断面结构框架预留标签标注接口，包括以下步骤：判断所述筑坝断面结构框架的方向；若为左半边筑坝断面结构框架，则在左半边坝底铺排排体三分之二处预留一个排体材质及厚度的标签标注，在距离中心线三分之一的地面处预留一个地面线标签标注，在坝顶护坡三分之二处预留一个水流流向标注；若为右半边筑坝断面结构框架，则判断坝体的类型；若坝体为填方坝，则在端点P7点处预留一个设计水位的标签标注；获取用户输入的水流方向，根据用户输入的水流方向标注水流方向标签。10.根据权利要求1所述的一种基于Civil3D的筑坝结构及施工图创建方法，其特征在于，还包括为所述筑坝断面结构框架预留工程量计算接口，包括以下步骤：判断坝体的形状轮廓；若坝体的形状轮廓为两侧回填，则预留坝体回填量的计算接口；若坝体的形状轮廓为两侧开挖，则预留坝体回填量及开挖量的计算接口；若坝体的形状轮廓为左挖右填，则在所述筑坝断面结构框架的左侧预留回填量和开挖量的计算接口，在所述筑坝断面结构框架的右侧预留回填量的计算接口；若坝体的形状轮廓为右挖左填，则在所述筑坝断面结构框架的右侧预留回填量和开挖量的计算接口，在所述筑坝断面结构框架的左侧预留回填量的计算接口。11.根据权利要求1所述的一种基于Civil3D的筑坝智能设计方法，其特征在于，所述在Civi3D软件中点击筑坝设计按钮包括以下步骤：在所述筑坝设计按钮中绑定任务；在绑定的任务中添加筑坝布置线选择操作、筑坝设计参数输入操作和绘图基点拾取操作。12.根据权利要求11所述的一种基于Civil3D的筑坝智能设计方法，其特征在于，在所述筑坝设计按钮中绑定任务包括以下步骤：S1：在VisualStudio中新建form弹窗，在form弹窗中布置Button按钮、CheckBox按钮、ListBox按钮、DataGridView按钮、DataSet按钮、Label按钮、TextBox按钮；S2：分别对所述Button按钮、CheckBox按钮、ListBox按钮、DataGridView按钮、DataSet按钮、Label按钮和TextBox按钮的弹窗。13.根据权利要求12所述的一种基于Civil3D的筑坝智能设计方法，其特征在于，所述S2包括以下步骤：定义筑坝名称；选择筑坝布置线，确认坝体走向，创建筑坝线路，将所述筑坝名称传递给筑坝线路，作为筑坝线路名称；将所述筑坝的名称传递给纵断面，作为纵断面名称；将曲面传给纵断面，作为纵断面剖切的地面；获取所述form弹窗中输入的坝顶高程及比降数值，传递给筑坝设计纵断面，并将所述筑坝名称传递给筑坝设计纵断面，作为筑坝设计纵断面名称；拾取插入点，作为纵断面放置位置；通过后台程序创建筑坝道路、采样线、横断面、挖方曲面、填方曲面、坝底线曲面、筑坝填方体积曲面和筑坝挖方体积曲面，并输出工程量统计信息。14.根据权利要求13所述的一种基于Civil3D的筑坝智能设计方法，其特征在于，所述创建筑坝道路的方法为：设置筑坝道路模型生成桩号范围为全部桩号且步长为5，设置图层为DL；所述创建采样线的方法为：获取筑坝名称，作为采样线编组名称；获取所述筑坝道路，作为采样道路；获取地形曲面，作为采样地形；获取采样间距输入参数，作为采样间距；获取采样宽度输入参数，作为采样宽度；获取设置好的采样线显示样式，作为采样线显示样式；获取设置好的采样线标签样式，作为采样线标签样式，完成采样线创建；所述创建横断面的方法为：获取筑坝线路，作为采样线路；获取采样线编组，作为采样编组；获取筑坝名称，作为横断面图名称；获取横断面图样式，作为横断面图样式；获取设置好的横断面图纸样式，作为横断面图排列样式；获取标注栏样式，作为横断面图标注栏样式；获取拾取的插入点，将插入点向下垂直移动100个单位，作为横断面图插入位置，完成横断面创建。15.根据权利要求13所述的一种基于Civil3D的筑坝智能设计方法，其特征在于，所述创建挖方曲面、填方曲面、坝底线曲面、筑坝填方体积曲面和筑坝挖方体积曲面的方法为：获取筑坝名称，创建新三角网曲面，将新三角网曲面名称命名为“筑坝名称+挖方”，将筑坝结构点中预留的用于计算挖方的代码传递给新三角网曲面，完成挖方曲面创建；获取筑坝名称，创建新三角网曲面，将新三角网曲面名称命名为“筑坝名称+填方”，把筑坝结构点中预留的用于计算填方的代码传递给新三角网曲面，完成填方曲面创建；获取筑坝名称，创建新三角网曲面，将新三角网曲面名称命名为“筑坝名称+坝底”，把筑坝结构点中预留的坝底连线代码传递给新三角网曲面，完成坝底线曲面创建；新建三角网体积曲面，把坝底线曲面传递给新三角网体积曲面三维曲面作为基准曲面，把填方曲面传递给新三角网体积曲面作为对照曲面，完成筑坝填方体积曲面创建；新建三角网体积曲面，把地形曲面传递给新三角网体积曲面作为基准曲面，把挖方曲面传递给新三维作为对照曲面，完成筑坝挖方体积曲面创建。
说明书desc
技术领域本发明涉及航道整治技术领域，具体而言，涉及一种基于Civil3D的筑坝结构及施工图创建方法。背景技术传统航道整治设计没有专业的辅助工具，信息化水平低，工程设计人员需要花费大量时间进行手动剖切断面和统计工程量，不仅分工协作困难，图纸绘制和工程量计算误差大、易出错，而且方案变更工作量大、优化困难，不利于设计信息在施工后期维养阶段的传导。落后的航道整治设计技术与日益发展的水运建设速度严重不匹配。目前国内绘制断面和计算工程量的方式主要有3种：一是手动绘制断面，手动填充计算工程量；二是依靠Civil3D软件剖切断面，手动调整到满足施工图要求，手动添加标签标注，该方法统计的工程量只有填方，没有保证最小坝高的挖方部分，因此也缺少该部分填方量，统计的工程量不准确；三是依靠飞时达等土方统计软件，同样存在统计工程量不准确的问题。有鉴于此，特提出本申请。发明内容本发明所要解决的技术问题是：现有的手动创建筑坝结构框架的方法效率低且出错率高，目的在于提供一种基于Civil3D的筑坝结构及施工图创建方法，能够实现根据输入参数，自动创建筑坝结构框架，且无需手动修改和返工，从而提高筑坝结构框架的创建效率和质量。本发明通过下述技术方案实现：一种基于Civil3D的筑坝结构及施工图创建方法，包括以下步骤：定义初始结构点，以所述初始结构点为起点，搭建右半边坝顶结构框架；以坝顶最外侧端点为起始点，搭建侧边护坡结构框架；判断所述侧边护坡结构框架的底部与地面的关系；若所述侧边护坡结构框架的底部位于地面以上，则进行坝底铺排；若所述侧边护坡结构框架的底部位于地面以下，则不进行坝底铺排；当不进行坝底铺排时，在所述侧边护坡结构框架的底部上方进行挖方处理，得到筑坝断面结构框架；在Civi3D软件中点击筑坝设计按钮，选择筑坝布置线；根据所述筑坝断面结构框架输入筑坝设计参数，所述设计参数包括坝顶高程、设计纵坡、坝顶宽度、迎水坡坡比，背水坡坡比、最小坝高、偏移设定、采样线间距和采样线宽度；通过拾取绘图基点自动生成排列整齐的筑坝纵断面剖面图、横断面剖面图以及平面布置图和工程量明细表，完成筑坝作业。进一步的，所述搭建筑坝结构框架包括以下步骤：以坝顶的宽度和厚度作为控制条件，定义坝顶结构点P1、P2、P4和P4；指定坝顶宽度的偏移目标，依次连接P1、P2、P3和P4，得到所述坝顶结构框架。进一步的，基于Civil3D的筑坝结构及施工图创建方法，还包括以下步骤：填充所述坝顶结构框架；在所述坝顶结构框架的结构线处预留坝顶宽度标注结构线和标注接口，在坝顶结构框架的中心线处预留标高及标注接口。进一步的，所述搭建侧边护坡结构框架包括以下步骤：以坝顶最外侧端点为起始点，沿参数边坡坡度斜向下引出直线至端点P7，端点P7与所述坝顶最外侧端点的垂直高度差为参数侧边护坡的高度；指定端点P7的偏移目标，以参数侧边护坡厚度为控制条件，定义结构点P5和P6，依次连接坝顶最外侧端点、P5、P6和P7，得到所述侧边护坡结构框架。进一步的，基于Civil3D的筑坝结构及施工图创建方法，还包括以下步骤：填充所述侧边护坡结构框架；在端点P7处预留设计水位标准结构线和标注接口；在边坡处预留边坡坡度标注接口。进一步的，所述进行坝底铺排包括以下步骤：若端点P7位于地面以上且到地面的距离大于底部铺排的高度，则从端点P7出发，以负的边坡坡度向下引出直线至与地面相交，将交点定义为虚拟结构点AP1；判断坝底坡脚线是否偏移；若坝底坡脚线偏移，则将偏移点垂直投影至地面，并将偏移点向上平移一个铺排厚度，将平移后的偏移点作为坝底铺排起点的上边界点，连接端点P7和所述上边界点；将从边坡坡度向下引出的直线的延长线与地面的交点作为坝底铺排起点的下边界点；以铺排宽度和铺排偏移作为铺排外侧点的控制条件，填充坝底铺排形状；若坝底坡脚线无偏移，则将虚拟结构点AP1作为坝底铺排起点的下边界点，以铺排宽度和铺排偏移作为铺排外侧点的控制条件，将坝底铺排起点的上边界点作为下边线平移一个铺排厚度后与坝身破线的交点，连接端点P7与坝底铺排起点的上边界点，填充坝底铺排形状。进一步的，所述进行坝底铺排还包括以下步骤：若端点P7位于地面以上且到地面的距离小于等于底部铺排的高度，则从端点P7引出坡度为负的坡线至与地面相交，并将交点作为坝底铺排起点的下边界点；若坝底坡脚线偏移，则将偏移点垂直投影至地面，并将偏移点向上平移一个铺排厚度，将平移后的偏移点作为坝底铺排起点的上边界点，连接端点P7和所述上边界点；将从边坡坡度向下引出的直线的延长线与地面的交点作为坝底铺排起点的下边界点；以铺排宽度和铺排偏移作为铺排外侧点的控制条件，填充坝底铺排形状。进一步的，所述进行坝底铺排还包括以下步骤：若坝底坡脚线偏移，在坝底铺排的下方预留铺排宽度标注结构线及标注接口，在坝身下方预留坝身半边宽度标注结构线及标注接口；若坝底坡脚线无偏移，在坝底铺排下方预留铺排宽度标注结构线及标注接口，在坝身下方预留坝身半边宽度标注结构线及标注接口。进一步的，基于Civil3D的筑坝结构及施工图创建方法还包括：为所述筑坝断面结构框架预留标签标注接口，包括以下步骤：判断所述筑坝断面结构框架的方向；若为左半边筑坝断面结构框架，则在左半边坝底铺排排体三分之二处预留一个排体材质及厚度的标签标注，在距离中心线三分之一的地面处预留一个地面线标签标注，在坝顶护坡三分之二处预留一个水流流向标注；若为右半边筑坝断面结构框架，则判断坝体的类型；若坝体为填方坝，则在端点P7点处预留一个设计水位的标签标注；获取用户输入的水流方向，根据用户输入的水流方向标注水流方向标签。基于Civil3D的筑坝结构及施工图创建方法，还包括为所述筑坝断面结构框架预留工程量计算接口，包括以下步骤：判断坝体的形状轮廓；若坝体的形状轮廓为两侧回填，则预留坝体回填量的计算接口；若坝体的形状轮廓为两侧开挖，则预留坝体回填量及开挖量的计算接口；若坝体的形状轮廓为左挖右填，则在所述筑坝断面结构框架的左侧预留回填量和开挖量的计算接口，在所述筑坝断面结构框架的右侧预留回填量的计算接口；若坝体的形状轮廓为右挖左填，则在所述筑坝断面结构框架的右侧预留回填量和开挖量的计算接口，在所述筑坝断面结构框架的左侧预留回填量的计算接口。进一步的，所述在Civi3D软件中点击筑坝设计按钮包括以下步骤：在所述筑坝设计按钮中绑定任务；在绑定的任务中添加筑坝布置线选择操作、筑坝设计参数输入操作和绘图基点拾取操作。进一步的，在所述筑坝设计按钮中绑定任务包括以下步骤：S1：在VisualStudio中新建form弹窗，在form弹窗中布置Button按钮、CheckBox按钮、ListBox按钮、DataGridView按钮、DataSet按钮、Label按钮、TextBox按钮等一系列参数输入栏、选择栏和过滤栏；S2：分别对所述Button按钮、CheckBox按钮、ListBox按钮、DataGridView按钮、DataSet按钮、Label按钮、TextBox按钮等一系列参数输入栏、选择栏和过滤栏进行功能绑定和生成对应的弹窗。进一步的，所述S2包括以下步骤：定义筑坝名称；选择筑坝布置线，确认坝体走向，创建筑坝线路，将所述筑坝名称传递给筑坝线路，作为筑坝线路名称；将所述筑坝的名称传递给纵断面，作为纵断面名称；将曲面传给纵断面，作为纵断面剖切的地面；获取所述form弹窗中输入的坝顶高程及比降数值，传递给筑坝设计纵断面，并将所述筑坝名称传递给筑坝设计纵断面，作为筑坝设计纵断面名称；拾取插入点，作为纵断面放置位置；通过后台程序创建筑坝道路、采样线、横断面、挖方曲面、填方曲面、坝底线曲面、筑坝填方体积曲面和筑坝挖方体积曲面，并输出工程量统计信息。进一步的，所述创建筑坝道路的方法为：设置筑坝道路模型生成桩号范围为全部桩号且步长为5，设置图层为DL；所述创建采样线的方法为：获取筑坝名称，作为采样线编组名称；获取所述筑坝道路，作为采样道路；获取地形曲面，作为采样地形；获取采样间距输入参数，作为采样间距；获取采样宽度输入参数，作为采样宽度；获取设置好的采样线显示样式，作为采样线显示样式；获取设置好的采样线标签样式，作为采样线标签样式，完成采样线创建；所述创建横断面的方法为：获取筑坝线路，作为采样线路；获取采样线编组，作为采样编组；获取筑坝名称，作为横断面图名称；获取横断面图样式，作为横断面图样式；获取设置好的横断面图纸样式，作为横断面图排列样式；获取标注栏样式，作为横断面图标注栏样式；获取拾取的插入点，将插入点向下垂直移动100个单位，作为横断面图插入位置，完成横断面创建。进一步的，所述创建挖方曲面、填方曲面、坝底线曲面、筑坝填方体积曲面和筑坝挖方体积曲面的方法为：获取筑坝名称，创建新三角网曲面，将新三角网曲面名称命名为“筑坝名称+挖方”，将筑坝结构点中预留的用于计算挖方的代码传递给新三角网曲面，完成挖方曲面创建；获取筑坝名称，创建新三角网曲面，将新三角网曲面名称命名为“筑坝名称+填方”，把筑坝结构点中预留的用于计算填方的代码传递给新三角网曲面，完成填方曲面创建；获取筑坝名称，创建新三角网曲面，将新三角网曲面名称命名为“筑坝名称+坝底”，把筑坝结构点中预留的坝底连线代码传递给新三角网曲面，完成坝底线曲面创建；新建三角网体积曲面，把坝底线曲面传递给新三角网体积曲面三维曲面作为基准曲面，把填方曲面传递给新三角网体积曲面作为对照曲面，完成筑坝填方体积曲面创建；新建三角网体积曲面，把地形曲面传递给新三角网体积曲面作为基准曲面，把挖方曲面传递给新三维作为对照曲面，完成筑坝挖方体积曲面创建。本发明与现有技术相比，具有如下的优点和有益效果：通过对Civil3D软件进行二次开发，一次性解决了常规及非常规情况下筑坝结构框架的自动创建和标签、标准的自动添加，以及工程量自动计算，且输出的筑坝结构框架达到施工图要求，无需手动修改及返工，实现提高工作效率的同时降低错误率。附图说明为了更清楚地说明本发明示例性实施方式的技术方案，下面将对实施例中所需要使用的附图作简单地介绍，应当理解，以下附图仅示出了本发明的某些实施例，因此不应被看作是对范围的限定，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他相关的附图。图1为本发明实施例提供的右半边筑坝结构框架示意图；图2为本发明实施例提供的坝底坡脚线偏移情况下的右半边筑坝结构示意图；图3为本发明实施例提供的坝底坡脚线无偏移情况下的右半边筑坝结构示意图；图4为本发明实施例提供的端点P7位于地面以上且到地面的距离小于等于底部铺排的高度情况下右半边筑坝结构示意图；图5为本发明实施例提供的挖方情况下的右半边筑坝结构示意图。具体实施方式为使本发明的目的、技术方案和优点更加清楚明白，下面结合实施例和附图，对本发明作进一步的详细说明，本发明的示意性实施方式及其说明仅用于解释本发明，并不作为对本发明的限定。实施例传统航道整治设计没有专业辅助工具，信息化水平低，工程设计人员需要花费大量时间手动剖切断面、EXCEL公式法统计工程量，不仅分工协作困难，图纸绘制和工程量计算误差大、容易出错，而且方案变更工作量大、方案优化困难，不利于设计信息在施工及后期维养阶段的传导。为解决现有的手动创建筑坝结构框架的方法效率低且出错率高的问题，本实施例提供一种基于Civil3D的筑坝结构及施工图创建方法，借助VB语言完成部件编辑器pkt可视化程序开发，该程序的编写主要包括各种千变万化的筑坝标准横断面结构体、标签标注的设置及接口预留、工程量的统计接口预留等部分；对照pkt可视化程序中预留的标签标注接口，结合施工图标签标注的需求以及图纸的显示样式、打印样式等各种需求，完成满足筑坝施工图出图要求的dwg模板的制定。为进一步提高效率，精简用户对Civil3D软件的学习培训时间，达到专业工程师无需培训或者简短培训就能独立完成智能设计的较高要求，引入C#程序，结合Civil3D软件预留的API接口，对底层数据库进行开发，把所有参数和拾取对象操作都做成界面按钮，程序后台进行一系列复杂的收集、判断、调用、创建、计算和输出，最终达到智能设计的目的。根据筑坝的功能及作用，常见的筑坝种类主要分为以下几种：丁坝、勾头丁坝、丁顺坝、顺坝、堵坝、格坝、锁坝、潜坝、边滩守护工程等。各种坝体可能会遇到的结构形式又有以下几种：坝头火柴头形加宽，坝头镰刀型形加宽，坝身加宽，有最小坝高，无最小坝高，有压顶，无压顶，有边坡护坡，无边坡护坡，常规坝高，浅坝，高坝，左侧浅坝右侧高坝，右侧浅坝左侧高坝，有护底，无护底，坝体在地面以上，坝体在地面以下，坝体在左岸，坝体在右岸等20余种。根据上述各种不同情况下断面形式，理顺各种复杂的逻辑关系，设置不同断面参数及偏移目标，指导筑坝构件的编写。坝体结构类似于道路，结构上又有很大不同。首先，坝体的终止处有圆台形坝头和坝身衔接，坝身左右两侧坡度不同，坝头坡度和坝身左右两侧坡度亦不同，要保证各不同坡度之间平顺衔接；其次，在地面高程高于坝顶高程时，必须保证坝身有最小坝高，并对开挖的部分做回填；再次，对于有铺排的坝体或护滩带，在满足只有填方铺排的同时，处理好挖方不铺排处整体铺排的连贯性与合理性。基于Civil3D的筑坝结构及施工图创建方法，包括以下步骤：步骤1：在部件即Autodesk Subassembly Composer中新建一个格式为pkt的空白文档，在参数设置界面定义筑坝横断面名字。步骤2：在参数设置界面定义设计输入参数，分别为坝顶半边、最小坝高、边坡坡度、铺排宽度、铺排厚度、侧边护坡厚度、坡脚挖方坡度、水流方向、整治水位与设计水位差、压顶厚度等。步骤3：在参数设置界面定义目标参数，分别为地面目标、坝顶偏移目标、护坡偏移目标、铺排偏移目标、坡比过度偏移目标等。步骤4：在部件编写界面空白处，并定义一个初始点。步骤5：定义初始结构点，以所述初始结构点为起点，搭建右半边坝顶结构框架。如图1所示，以参数坝顶宽和坝顶厚作为控制条件先定义4个坝顶结构点P1～P4，给坝顶宽度指定偏移目标，并用实线连接起来，填充坝顶结构，为以后设置材质及计算材质工程量做准备。在坝顶结构线处预留坝顶宽度标注结构线和代码，在坝顶中心线处预留标高及标注。步骤6：以坝顶最外侧端点为起始点，搭建侧边护坡结构框架。如图1所示，从坝顶最外侧端点出发，以负的参数边坡坡度向下引距离为参数侧边护坡高的直线，给P7点指定偏移目标，再以参数侧边护坡厚度为控制条件，沿水平方向向内侧定义3个结构点P5-P7，绘制四边形，并填充，为以后设置材质及计算材质工程量做准备。在P7点处预留设计水位标注结构线和代码，在边坡处预留边坡坡度标注。步骤7：判断P7与地面的关系，若P7点在地面以上，且到地面的距离大于底部铺排的高度，则是正常的填方，需要铺排；若P7点到地面的距离小于等于底部铺排的高度，则是浅填方，需要铺排，此时，坝底铺排的结构形式需要特殊处理；若P7点在地面以下，为了保证坝身的连续性，此时需要挖方，坝身埋进地面后再做回填，以保证最小坝高，坝底无需铺排。其中，正常填方情况下，从P7点出发，以负的参数边坡坡度向下引直线，与地面的交点定义为虚拟结构点AP1。判断坝底坡脚线有没有偏移，若有偏移，将偏移点垂直投影到地面上，在偏移点处向上走一个铺排厚度，作为铺排的起点上边界点，连接P7和该上边界点，延长线与地面的交点作为铺排起点下边界点，铺排外侧点用参数铺排宽度和铺排偏移来控制，最后填充铺排形状，并在铺排下方预留铺排宽度标注结构线及代码，在坝身下方预留坝身半边宽度标注结构线及代码，如图2所示。若无偏移，则AP1即为铺排起点下边界点，铺排外侧点用参数铺排宽度和铺排偏移来控制，铺排起点上边界点为下边线平移一个铺排厚度后与坝身坡线的交点，连接P7和该上边界点，最后填充铺排形状，并在铺排下方预留铺排宽度标注结构线及代码，在坝身下方预留坝身半边宽度标注结构线及代码，如图3所示。对坝底铺排的结构形式进行特殊处理的方法为：从P7点引坡度为负的边坡坡度的坡线，与地面的交点作为坝底铺排的起点下边界点，若无偏移，则AP1即为铺排起点下边界点，铺排外侧点用参数铺排宽度和铺排偏移来控制，铺排起点上边界点为下边线平移一个铺排厚度后与坝身坡线的交点，连接P7和该上边界点，最后填充铺排形状，并在铺排下方预留铺排宽度标注结构线及代码，在坝身下方预留坝身半边宽度标注结构线及代码，参考图4。步骤8：为了保证最小坝高，当不进行坝底铺排时，在所述侧边护坡结构框架的底部上方进行挖方处理。此种情况一般出现在坝头，需要埋置与地下，或者地面很高处，无铺排。自P7点以挖方坡度向上引直线，与地面的交点及为挖方终止点，然后再回填坝身以外的开挖部分，在挖方线处预留挖方边坡坡度标注代码，在坝身下方预留坝身半边宽度标注结构线及代码，如图5。截至步骤8得到筑坝断面结构框架。从步骤9开始为对筑坝断面结构框架进行标注。首先判断是在左边还是在右边，有些需要左右两边对称标注，有些需要只标注左边，有些需要只标注右边，有些需要只标注中点处。步骤9：若在左边，在左边坝底铺排排体2/3处预留一个排体材质及厚度的标签标注，在距离中心线1/3的地面处预留一个地面线标签标注，在坝顶护坡2/3处预留一个水流流向标注。第12-1步，若为左半边筑坝断面结构框架，则在左半边坝底铺排排体三分之二处预留一个排体材质及厚度的标签标注，在距离中心线三分之一的地面处预留一个地面线标签标注，在坝顶护坡三分之二处预留一个水流流向标注；若为右半边筑坝断面结构框架，则判断坝体的类型；若坝体为填方坝，则在端点P7点处预留一个设计水位的标签标注；判断水流方向标注。若用户选择了左流向，对应的为左侧半边，或者为右侧半边，标签均标注为左流向；若用户选择了右流向，对应的为左侧半边，或者为右侧半边，标签均标注为右流向；若用户未选择流向，程序报错。步骤10：计算工程量。判断坝体左右两边形状轮廓，分为两侧回填、两侧开挖、左填右挖、左挖右填4种情况。若坝体的形状轮廓为两侧回填，则需要计算回填量，预留坝身节点代码，工程量为坝身组成的面和地面的布尔运算值；若坝体的形状轮廓为两侧开挖，则需要计算回填量和开挖量，预留坝身节点代码和开挖代码，开挖工程量为坝底和开挖节点组成的面和地面的布尔运算值，回填量为坝体量+坝身后方回填量；若坝体的形状轮廓为左挖右填，则左边需要计算回填量和开挖量，预留坝身节点代码和开挖代码，开挖工程量为坝底和开挖节点组成的面和地面的布尔运算值，回填量为坝体量及坝身后方回填量；右边需要计算回填量，预留坝身节点代码，工程量为坝身组成的面和地面的布尔运算值；若坝体的形状轮廓为右挖左填，则右边需要计算回填量和开挖量，预留坝身节点代码和开挖代码，开挖工程量为坝底和开挖节点组成的面和地面的布尔运算值，回填量为坝体量及坝身后方回填量；左边需要计算回填量，预留坝身节点代码，工程量为坝身组成的面和地面的布尔运算值。步骤11：在Civi3D软件中点击筑坝设计按钮，选择筑坝布置线。步骤12：根据所述筑坝断面结构框架输入筑坝设计参数，所述设计参数包括坝顶高程、设计纵坡、坝顶宽度、迎水坡坡比，背水坡坡比、最小坝高、偏移设定、采样线间距和采样线宽度；步骤13：通过拾取绘图基点自动生成排列整齐的筑坝纵断面剖面图、横断面剖面图以及平面布置图和工程量明细表，完成筑坝作业。其中，步骤11所述的在Civi3D软件中点击筑坝设计按钮包括以下步骤：在所述筑坝设计按钮中绑定任务；在绑定的任务中添加筑坝布置线选择操作、筑坝设计参数输入操作和绘图基点拾取操作。即包括：S1：在VisualStudio中新建form弹窗，在form弹窗中布置Button按钮、CheckBox按钮、ListBox按钮、DataGridView按钮、DataSet按钮、Label按钮、TextBox按钮等一系列参数输入栏、选择栏和过滤栏；S2：分别对所述Button按钮、CheckBox按钮、ListBox按钮、DataGridView按钮、DataSet按钮、Label按钮、TextBox按钮等一系列参数输入栏、选择栏和过滤栏进行功能绑定和生成对应的弹窗。具体的，S2又包括以下步骤：定义筑坝名称；选择筑坝布置线，确认坝体走向，创建筑坝线路，将所述筑坝名称传递给筑坝线路，作为筑坝线路名称；将所述筑坝的名称传递给纵断面，作为纵断面名称；将曲面传给纵断面，作为纵断面剖切的地面；获取所述form弹窗中输入的坝顶高程及比降数值，传递给筑坝设计纵断面，并将所述筑坝名称传递给筑坝设计纵断面，作为筑坝设计纵断面名称；拾取插入点，作为纵断面放置位置；通过后台程序创建筑坝道路、采样线、横断面、挖方曲面、填方曲面、坝底线曲面、筑坝填方体积曲面和筑坝挖方体积曲面，并输出工程量统计信息。上述S2的具体操作步骤中，创建筑坝道路的方法为：设置筑坝道路模型生成桩号范围为全部桩号且步长为5，设置图层为DL；创建采样线的方法为：获取筑坝名称，作为采样线编组名称；获取所述筑坝道路，作为采样道路；获取地形曲面，作为采样地形；获取采样间距输入参数，作为采样间距；获取采样宽度输入参数，作为采样宽度；获取设置好的采样线显示样式，作为采样线显示样式；获取设置好的采样线标签样式，作为采样线标签样式，完成采样线创建；创建横断面的方法为：获取筑坝线路，作为采样线路；获取采样线编组，作为采样编组；获取筑坝名称，作为横断面图名称；获取横断面图样式，作为横断面图样式；获取设置好的横断面图纸样式，作为横断面图排列样式；获取标注栏样式，作为横断面图标注栏样式；获取拾取的插入点，将插入点向下垂直移动100个单位，作为横断面图插入位置，完成横断面创建。创建挖方曲面、填方曲面、坝底线曲面、筑坝填方体积曲面和筑坝挖方体积曲面的方法分别为：获取筑坝名称，创建新三角网曲面，将新三角网曲面名称命名为“筑坝名称+挖方”，将筑坝结构点中预留的用于计算挖方的代码传递给新三角网曲面，完成挖方曲面创建；获取筑坝名称，创建新三角网曲面，将新三角网曲面名称命名为“筑坝名称+填方”，把筑坝结构点中预留的用于计算填方的代码传递给新三角网曲面，完成填方曲面创建；获取筑坝名称，创建新三角网曲面，将新三角网曲面名称命名为“筑坝名称+坝底”，把筑坝结构点中预留的坝底连线代码传递给新三角网曲面，完成坝底线曲面创建；新建三角网体积曲面，把坝底线曲面传递给新三角网体积曲面三维曲面作为基准曲面，把填方曲面传递给新三角网体积曲面作为对照曲面，完成筑坝填方体积曲面创建；新建三角网体积曲面，把地形曲面传递给新三角网体积曲面作为基准曲面，把挖方曲面传递给新三维作为对照曲面，完成筑坝挖方体积曲面创建。综上，通过部件及模板的二次开发，一次性解决了常规及非常规情况下平面图自动布置、横断面图自动出图、纵断面自动出图、自动添加标签、标注、计算工程量、校核工程量、设计变更、GIS展示及三维BIM设计等一系列复杂的问题，且能达到施工图要求，无需手动修改及返工，工程量经手动绘制并剖切横断面验证精确无误。以上所述的具体实施方式，对本发明的目的、技术方案和有益效果进行了进一步详细说明，所应理解的是，以上所述仅为本发明的具体实施方式而已，并不用于限定本发明的保护范围，凡在本发明的精神和原则之内，所做的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
