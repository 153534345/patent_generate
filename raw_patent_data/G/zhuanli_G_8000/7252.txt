标题title
一种低功耗模式下控制设备的数据同步方法及系统
摘要abst
本发明公开了一种低功耗模式下控制设备的数据同步方法及系统，该方法包括：控制设备处于低功耗模式下，接收受控设备蓝牙广播的状态标识符；根据所述状态标识符判断所述控制设备是否满足数据同步条件；若根据状态标识符判断控制设备满足数据同步条件，唤醒设置于受控设备中的WiFi模块，以利用WiFi模块同步受控设备的状态数据。通过本发明的方案，解决了现有控制设备在低功耗模式下不能同步受控设备状态的问题，实现了控制设备在低功耗模式下状态数据的实时同步，提升了控制设备智能化体验。
权利要求书clms
1.一种低功耗模式下控制设备的数据同步方法及系统，其特征在于，包括：控制设备处于低功耗模式下，接收受控设备蓝牙广播的状态标识符；根据所述状态标识符判断所述控制设备是否满足数据同步条件；若根据所述状态标识符判断所述控制设备满足数据同步条件，唤醒设置于所述受控设备中的WiFi模块，以利用所述WiFi模块同步所述受控设备的状态数据。2.根据权利要求1所述的方法，其特征在于，所述控制设备与所述受控设备未发生通信时长超过设定时长阈值，所述控制设备进入休眠状态，即低功耗模式。3.根据权利要求1所述的方法，其特征在于，所述控制设备处于低功耗模式下，接收受控设备蓝牙广播的状态标识符包括：接收所述受控设备通过蓝牙广播的状态标识符，所述状态标识符为所述受控设备的状态发生改变时生成；所述状态标识符包括：所述受控设备的状态标志标识符、设备标识符和控制标识符。4.根据权利要求1所述的方法，其特征在于，所述根据所述状态标识符判断所述控制设备是否满足数据同步条件包括：判断所述控制设备当前的所述状态标志标识符与上次接收所述状态标志标识符是否一致；若一致，则不予处理，若不一致则进一步判断所述控制设备的所述设备标识符与接收到的所述设备标识符是否一致；若判断所述设备标识符不一致，则判断所述控制设备满足数据同步条件；若判断所述设备标识符一致且所述控制标识符为语音控制，则判断所述控制设备满足数据同步条件。5.根据权利要求1所述的方法，其特征在于，所述控制设备唤醒WiFi模块同步所述受控设备的状态数据包括：检测所述WiFi模块的上电状态；若所述WiFi模块未上电，则上电唤醒所述WiFi模块，并控制所述WiFi模块同步所述受控设备的状态数据；若所述WiFi模块已上电，则直接控制所述WiFi模块同步所述受控设备的状态数据。6.根据权利要求1所述的方法，其特征在于，所述利用所述WiFi模块同步所述受控设备的状态数据之后，所述方法还包括：根据所述受控设备的状态数据显示所述受控设备的实时状态。7.根据权利要求1所述的方法，其特征在于，所述受控设备包括但不限于空调、电视和冰箱。8.一种控制设备，其包括一个或多个处理器以及存储有程序指令的非暂时性计算机可读存储介质，当所述一个或多个处理器执行所述程序指令时，所述一个或多个处理器用于实现根据权利要求1-6任意一项所述的方法。9.一种非暂时性计算机可读存储介质，其上存储有程序指令，当所述程序指令被一个或多个处理器执行时，所述一个或多个处理器用于实现根据权利要求1-6中任一项所述的方法。10.一种数据同步系统，包括受控设备以及权利要求8所述的控制设备。
说明书desc
技术领域本发明涉及智能控制领域，更具体地涉及一种低功耗模式下控制设备的数据同步方法及系统。背景技术WiFi遥控器基于WiFi直连通信技术，具有传输大量通信数据的优势，可普遍推广应用在控制、语音、图像等智能通信传输领域。基于WiFi直连通信的遥控器可直接实现遥控器与空调间的直连控制，其本身可支持遥控器和空调间的双向通信。相较传统遥控器，WiFi遥控器可实现空调状态的同步，但考虑到遥控器的功耗问题，现有遥控器同步空调状态的方案为：默认长时间不使用遥控器时，熄灭遥控器屏幕并关闭遥控器WiFi电源，用户按键后亮起屏幕的同时给遥控器WiFi供电，WiFi上电后立即进行空调状态的同步。上述低功耗情形下的遥控器同步方案存在问题。即，遥控器不能实时同步空调状态。此问题会造成以下异常：①遥控器WiFi上电后同步空调状态不成功，造成遥控器之后使用的空调状态不一致；②遥控器WiFi工作过程中，其它用户通过面板或APP等改变空调状态后，造成遥控器使用的空调状态不一致；③遥控器语音控制后，实际识别控制端在服务器，遥控器无法及时获取遥控器语音控制后的空调状态。发明内容本发明实现主要涉及一种低功耗模式下控制设备的数据同步方法及系统。主要通过控制设备蓝牙接收受控设备广播的状态标识后，唤醒并通知控制设备的WiFi模块与受控设备进行状态同步，从而实现低功耗场景下的受控设备实时状态同步，达到轻量化、智能化的控制体验。根据本发明的第一方面，提供了一种低功耗模式下控制设备的数据同步方法，包括：控制设备处于低功耗模式时，接收受控设备蓝牙广播的状态标识符；若根据所述状态标识符判断所述控制设备满足数据同步条件，唤醒设置于所述受控设备中的WiFi模块，以利用所述WiFi模块同步所述受控设备的状态数据。可选地，由于所述控制设备与所述受控设备未发生通信时长超过设定时长阈值，所述控制设备进入休眠状态，即低功耗模式。可选地，所述控制设备接收受控设备的状态标识符包括：接收所述受控设备通过蓝牙广播的状态标识符，所述状态标识符为所述受控设备的状态发生改变时生成；所述状态标识符包括：所述受控设备的状态标志标识符、设备标识符和控制标识符。可选地，所述根据所述状态标识符判断所述控制设备是否满足数据同步条件包括：判断所述控制设备当前的所述状态标志标识符与上次接收所述状态标志标识符是否一致；若一致，则不予处理，若不一致则进一步判断所述控制设备的所述设备标识符与接收到的所述设备标识符是否一致；若判断所述设备标识符不一致，则判断所述控制设备满足数据同步条件，若判断所述设备标识符一致且所述控制标识符为语音控制，则判断所述控制设备满足数据同步条件。可选地，所述控制设备唤醒WiFi模块同步所述受控设备的状态数据包括：检测所述WiFi模块的上电状态；若所述WiFi模块未上电，则上电唤醒所述WiFi模块，并控制所述WiFi模块同步所述受控设备的状态数据；若所述WiFi模块已上电，则直接控制所述WiFi模块同步所述受控设备的状态数据。可选地，所述利用所述WiFi模块同步所述受控设备的状态数据之后，所述方法还包括：根据所述受控设备的状态数据显示所述受控设备的实时状态。可选地，所述受控设备包括但不限于空调、电视和冰箱。根据本发明的第二方面，提供了一种控制设备，其包括一个或多个处理器以及存储有程序指令的非暂时性计算机可读存储介质，当所述一个或多个处理器执行所述程序指令时，所述一个或多个处理器用于实现根据第一方面任意一项所述的方法。根据本发明的第三方面，一种非暂时性计算机可读存储介质，其上存储有程序指令，当所述程序指令被一个或多个处理器执行时，所述一个或多个处理器用于实现根据第一方面中任一项所述的方法。根据本发明的第四方面，一种数据同步系统，包括受控设备以及第二方面所述的控制设备，或具有根据第三方面所述的非暂时性计算机可读存储介质。本发明专利提供了一种低功耗模式下控制设备的数据同步方法，实现了控制设备在低功耗模式下的实时数据同步，提升了控制设备智能化的体验。附图说明为了更清楚地说明本发明的技术方案，下面将对实施例描述中所需要使用的附图进行简单介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员而言，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1示出了本发明实施例的数据同步系统结构示意图；图2示出了本发明实施例的控制设备数据同步方法的流程示意图；图3示出了本发明实施例的控制设备的结构示意图；图4示出了本发明实施例的空调遥控器数据同步方法的流程示意图；图5示出了本发明实施例的空调器与遥控器数据同步的流程示意图。具体实施方式如在本文中所使用的，词语“第一”、“第二”等可以用于描述本发明的示例性实施例中的元件。这些词语只用于区分一个元件与另一元件，并且对应元件的固有特征或顺序等不受该词语的限制。除非另有定义，本文中使用的所有术语具有与本发明所属技术领域的普通技术人员通常理解的含意相同的含意。如在常用词典中定义的那些术语被解释为具有与相关技术领域中的上下文含意相同的含意，而不被解释为具有理想或过于正式的含意，除非在本发明中被明确定义为具有这样的含意。本领域的技术人员将理解的是，本文中描述的且在附图中说明的本发明的装置和方法是非限制性的示例性实施例，并且本发明的范围仅由权利要求书限定。结合一个示例性实施例所说明或描述的特征可与其他实施例的特征组合。这种修改和变化包括在本发明的范围内。下文中，将参考附图详细描述本发明的示例性实施例。在附图中，省略相关已知功能或配置的详细描述，以避免不必要地遮蔽本发明的技术要点。另外，通篇描述中，相同的附图标记始终指代相同的电路、模块或单元，并且为了简洁，省略对相同电路、模块或单元的重复描述。此外，应当理解一个或多个以下方法或其方面可以通过至少一个控制系统、控制单元或控制器执行。术语“控制单元”，“控制器”,“控制模块”或者“主控模块”可以指代包括存储器和处理器的硬件设备，术语“空调”可以指代类似于制冷设备。存储器或者计算机可读存储介质配置成存储程序指令，而处理器具体配置成执行程序指令以执行将在以下进一步描述的一个或更多进程。而且，应当理解，正如本领域普通技术人员将意识到的，以下方法可以通过包括处理器并结合一个或多个其他部件来执行。本发明实施例提供了一种数据同步系统，如图1所示，本发明实施例的数据同步系统包括控制设备和受控设备，控制设备可以为遥控器，受控设备可以为空调器、智能电视机、智能电冰箱等，控制设备可以与受控设备建立无线连接，以控制受控设备的运行状态以及运行参数。实施例一本发明实施例提供了一种低功耗模式下控制设备的数据同步方法，如图2所示，本发明实施例的低功耗模式下控制设备的数据同步方法至少可以包括以下步骤S201,S202,S203。S201，控制设备接收受控设备蓝牙广播的状态标识符。如图3所示，控制设备设置有主控模块、WiFi模块、蓝牙模块、显示模块和电源模块等。主控模块通过按键直接更改受控设备的参数；WiFi模块可以让控制设备与受控设备通过WiFi直连技术相连接，可用于大量数据的快速传输；蓝牙模块在控制设备上电后即开始工作；显示模块用于对受控设备状态数据的显示；电源模块用于保障控制设备所有功能模块的供电。控制设备和受控设备未发生通信时长超过设定时长阈值，控制设备进入休眠模式，即低功耗模式。此时将停止对WiFi模块、显示模块的供电，即将显示模块关闭，通讯只保留蓝牙模块的运行，从而保证更低的耗电，更长的续航，使得控制设备维持在低功耗的状态。受控设备在状态发生改变后，会生成状态标识符并通过蓝牙广播。在低功耗模式下，控制设备会实时接收受控设备发出的状态标识符。这里的状态标识符包括：受控设备的状态标志标识符、与受控设备上次相连的控制设备的设备标识符和受控设备的控制标识符。S202，根据状态标识符判断控制设备是否满足数据同步条件。在控制设备接收到受控设备的状态标识符之后，判断控制设备当前的状态标志标识符与上次接收到的状态标志标识符是否一致，若一致，则不予处理；若不一致，进一步判断设备标识符是否与控制设备的设备标识符一致，若判断设备标识符不一致，则判断所述控制设备满足数据同步条件，若判断设备标识符一致，则继续判断控制标识符是语音控制还是按键控制，若确认为语音控制，则控制设备满足数据同步条件。优选的，设备标识符用设备的MAC地址表示。S203，控制设备唤醒WiFi模块同步受控设备的状态数据。控制设备确认可以进行数据同步后，会检测设置于控制设备中的WiFi模块的上电状态，若WiFi模块未上电，则上电唤醒以利用WiFi模块同步受控设备的状态数据；若WiFi模块已上电，则直接控制WiFi模块同步受控设备的状态数据。同时根据受控设备的状态数据显示受控设备的实时状态。控制设备在长时间没有被操作时，即与受控设备未发生通信时长超过设定时长阈值，控制设备会进入休眠状态，即低功耗模式。此时控制设备的WiFi模块和显示模块会断电，从而关闭无线通信功能和屏幕显示功能，保证控制设备的低能耗，长续航。通讯功能只保留蓝牙模块等待接收受控设备的状态数据，主控模块保持对按键的检测和蓝牙模块通讯的控制。由于受控设备除了当前控制设备作为控制终端，还可以具有其它控制设备作为辅助控制终端。当受控设备同时连接超过两台控制终端时，任何一台控制终端均可以改变受控设备的工作状态和/或参数，将当前控制受控设备的控制终端作为活跃控制设备。当辅助控制终端控制受控设备的工作模式和/或参数发生更改时，受控设备会记录当前发生的状态变化数据，并生成状态标识符数据。这里的状态标识符数据包括：受控设备的状态标志标识符、活跃控制设备的设备标识符和受控设备的控制标识符。更进一步地，受控设备的状态标志标识符记录当前控制设备的工作模式，比如自动模式、手动模式，若当前设备为空调，此标识符可为制冷模式、制热模式、除雾模式和智能模式等；若当前设备为智能冰箱，此标识符可为冷冻模式、冷藏模式和新鲜模式等；若当前设备为智能电视，此标识符可为影院模式、体育模式、游戏模式、少儿模式等。活跃控制设备的设备标识符为控制设备的唯一身份标识码，优选地，将设备的MAC地址作为控制设备的设备标识符。受控设备的控制标识符为受控设备在当前状态标志标识符所代表的模式下，所记录经由活跃控制设备对受控设备的控制模式，此模式主要包括按键模式和语音模式。按键模式为控制设备直接将操作指令发送给受控设备，语音模式为控制设备的麦克风采集用户的语音信号，然后通过语音识别服务器将音频信号解析为可被受控设备接收并响应的控制指令，然后发送至受控设备完成语音控制命令的下达。受控设备在生成状态标识符数据之后，会通过蓝牙广播的方式向外发送。由于当前处于低功耗模式下的控制设备的蓝牙模块处于工作状态，会接收到受控设备所发出的状态标识符数据。控制设备将接收到的状态标识符数据解析为状态标志标识符、设备标识符和控制标识符。然后进行逐个判断以决定是否满足数据同步条件。判断当前受控设备的状态标志标识符与上次接收到的状态标志标识符是否一致，若一致，说明受控设备的状态参数未发生改变，则不予处理；若不一致，说明受控设备的状态已被修改为新的工作模式，需要进一步判断当前控制设备的设备标识符是否与接收到的设备标识符一致，若不一致，说明当前控制设备与受控设备上次发生通讯的控制设备不是同一个设备，则控制设备满足数据同步条件，若一致，则说明与受控设备上次发生通讯的控制设备即为当前的控制设备，继续判断控制标识符为语音控制或按键控制，若为按键控制，则控制设备直接唤醒WiFi模块和显示模块，通过按键命令控制受控设备，而不需要数据同步。若为语音控制，则控制设备满足数据同步条件。在控制设备经过数据同步条件的验证成功之后，即可与受控设备进行数据同步。首先控制设备会检测所述WiFi模块的上电状态；若WiFi模块未上电，则上电唤醒WiFi模块，并控制WiFi模块通过WiFi直连的方式与受控设备建立无线连接，从而同步受控设备的状态数据。若WiFi模块已上电，则直接控制WiFi模块与受控设备建立无线连接，同步受控设备的状态数据。数据同步时，将已同步的状态数据实时显示在控制设备的屏幕上。实施例二本发明实施例提供了一种空调遥控器在低功耗模式下的数据同步方法，如图4所示，低功耗模式下的数据同步方法包括S401,S402,S403三个步骤：S401，遥控器接收空调器的状态标识符。除了遥控器之外，空调器可能还同时连接有其它控制终端，比如手机、PAD或电脑。当空调器同时连接超过两台控制终端时，任何一台控制终端均可以改变空调的工作状态和/或参数，将当前控制空调器的控制终端作为活跃控制终端，以手机为例，通过手机中设置的APP，可以修改空调器的工作模式、目标温度、风力大小、风口朝向等参数，修改完成后空调器会由于自身状态的改变而将当前被设置的参数信息封装为状态标识符，包括空调器的状态标志标识符、活跃控制终端的设备标识符和空调器的控制标识符等。其中，状态标志标识符为表示空调器工作状态的值，如制冷模式、制热模式、除雾模式和智能模式等。设备标识符为空调控制终端的MAC地址；控制标识符为空调器所能使用的控制模式，用枚举类型的值所表示，通常为按键模式和语音模式，这是由于目前广泛使用的空调遥控器的控制模式为按键模式和语音模式。空调器的状态标识符数据通过蓝牙模块广播向外发送。S402，根据状态标识符判断遥控器是否满足数据同步条件。在遥控器接收到空调器的状态标识符之后，判断当前空调器的状态标志标识符与上次接收到的状态标志标识符是否一致，若一致，说明空调器的状态和/或参数维持不变，则不予处理；若不一致，则进一步判断设备标识符是否与遥控器的设备标识符一致，若不一致，说明当前遥控器与空调器上次发生通讯的控制终端不是同一个设备，则遥控器满足数据同步条件，若一致，说明与空调器上次发生通讯的控制终端即为当前遥控器，则判断控制标识符为语音控制或按键控制，若为按键控制，则遥控器直接唤醒WiFi模块和显示模块，通过按键命令控制空调，而不需要数据同步。若为语音控制，则遥控器满足数据同步条件。S403，遥控器唤醒WiFi模块同步空调器的状态数据。遥控器确认可以进行数据同步后，会检测设置于空遥控器中的WiFi模块的上电状态，若WiFi模块未上电，则上电唤醒以利用WiFi模块同步空调器的状态数据；若WiFi模块已上电，则直接控制WiFi模块同步空调器的状态数据。同时根据空调器的状态数据显示空调器的实时状态。整个过程可具体地举例为：空调器当前状态为自动模式，遥控器30秒没使用后，自动进入休眠状态。此时用户通过APP改变空调器状态为制冷模式，空调器蓝牙广播此状态改变，遥控器蓝牙接收后唤醒遥控器WiFi实时同步空调器状态。之后用户按键唤醒遥控器屏幕后，遥控器可直接显示空调器当前最新状态为制冷模式。此时用户再使用APP改变空调器状态为制热，空调器蓝牙广播此状态改变，遥控器蓝牙接收后通知遥控器WiFi实时同步空调器状态，WiFi立即同步后，遥控器屏幕实时显示最新状态为制热模式。实施例三本发明实施例提供了一种空调遥控器在低功耗模式下的数据同步系统，系统组成包括空调器和遥控器，系统运行流程如图5所示，主要包括A,B,C,D共4个步骤：A.空调器广播状态标识符。除了遥控器之外，空调器同时连接有其它可以控制空调器状态的辅助控制终端，当空调器同时连接超过两台控制终端时，任何一台控制终端均可以改变空调器的工作状态和/或参数，将当前控制空调器的控制终端作为活跃控制终端。当空调器收到控制终端的工作模式和/或参数的修改命令后，即时生成空调器的状态标识符数据，这里的状态标识符数据包括空调器的状态标志标识符、活跃控制终端的设备标识符和空调器控制标识符。然后通过蓝牙广播的方式将状态标识符数据向外发送。B.遥控器接收状态标识符。遥控器由于与空调器未通信时长超过设定超时阈值，进入低功耗模式，此模式下遥控器的WiFi模块和显示模块均断电，只保留主控模块和蓝牙模块工作。遥控器的蓝牙模块接收到由空调器发出的状态标识符。C.遥控器判断是否符合数据同步条件。遥控器从当前接收到的空调器的状态标识符中解析到状态标志标识符、设备标识符和控制标识符数据。判断当前的状态标志标识符与上次接收到的状态标志标识符是否一致，若一致，说明空调器的状态和/或参数维持不变，则不予处理；若不一致，则进一步判断设备标识符是否与遥控器的设备标识符一致，若不一致，说明当前遥控器与空调器上次发生通讯的控制终端不是同一个设备，则遥控器满足数据同步条件，若一致，说明与空调器上次发生通讯的控制终端即为当前遥控器，则继续判断控制标识符为语音控制或按键控制，若为按键控制，则遥控器直接唤醒WiFi模块和显示模块，通过按键命令控制空调，而不需要数据同步。若为语音控制，则遥控器满足数据同步条件。D.遥控器同步空调器的状态数据。遥控器将接收到的状态标识符经过数据同步条件的验证成功后，上电唤醒WiFi模块，与空调器通过WiFi直连技术完成状态数据的同步。同时给显示模块上电，将已同步的数据实时显示。综上，本领域技术人员容易理解的是，在不冲突的前提下，上述各有利方式可以自由地组合、叠加。以上所述仅为本发明的实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的权利要求范围之内。
