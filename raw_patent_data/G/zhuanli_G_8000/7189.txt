标题title
一种USB设备移出识别电路、方法及供电系统
摘要abst
本发明涉及一种USB设备移出识别电路、方法及供电系统，属于USB设备移出识别技术领域，包括识别控制模块、电流检测模块和DPDM检测模块，先使能电流检测模块检测USB接口的输出电流，当输出电流低于预设电流门限时，判断USB接口处于设备移出状态或者设备连接不抽电状态。再使能DPDM检测模块，判断DP引脚和DM引脚是否存在外接驱动，从而对设备移出状态和设备连接不抽电状态这两种状态进行甄别，从而能够准确区分USB接口处于设备移出状态还是设备连接不抽电状态。
权利要求书clms
1.一种USB设备移出识别电路，其特征在于，包括：识别控制模块、电流检测模块和DPDM检测模块；所述电流检测模块用于检测USB接口的输出电流，并将所述输出电流与预设电流门限进行比较，得到比较信号；所述USB接口能够与USB设备电连接，为所述USB设备充电；所述识别控制模块分别与所述电流检测模块和所述DPDM检测模块通信连接；所述识别控制模块用于接收所述比较信号，并在所述输出电流低于所述预设电流门限时，控制所述DPDM检测模块工作；所述DPDM检测模块与所述USB接口的DP引脚和DM引脚电连接；所述DPDM检测模块用于检测所述DP引脚和所述DM引脚是否有外接驱动，得到检测结果；所述识别控制模块用于根据所述检测结果确定所述USB接口所处状态；所述状态包括设备移出状态和设备连接不抽电状态。2.根据权利要求1所述的USB设备移出识别电路，其特征在于，所述识别控制模块还用于在所述输出电流低于所述预设电流门限的持续时间达到预设时间后，控制所述DPDM检测模块工作。3.根据权利要求1所述的USB设备移出识别电路，其特征在于，所述DPDM检测模块包括上拉电压源、DP弱上拉电路、DP弱下拉电路、第一电压比较器、DM弱上拉电路、DM弱下拉电路和第二电压比较器；所述DP弱上拉电路一端与所述上拉电压源相连接，另一端与所述DP引脚相连接；所述DP弱下拉电路一端与所述DP引脚相连接，另一端接地；所述第一电压比较器的同相输入端与所述DP引脚相连接，反相输入端在所述DP弱上拉电路使能时连接第一预设参考电压，在所述DP弱下拉电路使能时连接第二预设参考电压；若所述DP引脚的电压在所述DP弱上拉电路使能时高于所述第一预设参考电压，且所述DP引脚的电压在所述DP弱下拉电路使能时低于所述第二预设参考电压，则所述DP引脚没有外接驱动；所述DM弱上拉电路一端与所述上拉电压源相连接，另一端与所述DM引脚相连接；所述DM弱下拉电路一端与所述DM引脚相连接，另一端接地；所述第二电压比较器的同相输入端与所述DM引脚相连接，反相输入端在所述DM弱上拉电路使能时连接所述第一预设参考电压，在所述DM弱下拉电路使能时连接所述第二预设参考电压；若所述DM引脚的电压在所述DM弱上拉电路使能时高于所述第一预设参考电压，且所述DM引脚的电压在所述DM弱下拉电路使能时低于所述第二预设参考电压，则所述DM引脚没有外接驱动。4.根据权利要求3所述的USB设备移出识别电路，其特征在于，所述DP弱上拉电路包括串联连接的第一开关和第一电阻；所述DP弱下拉电路包括串联连接的第二开关和第二电阻；所述DM弱上拉电路包括串联连接的第三开关和第三电阻；所述DM弱下拉电路包括串联连接的第四开关和第四电阻；所述识别控制模块还用于控制所述第一开关导通，使所述DP弱上拉电路使能；所述识别控制模块还用于控制所述第二开关导通，使所述DP弱下拉电路使能；所述识别控制模块还用于控制所述第三开关导通，使所述DM弱上拉电路使能；所述识别控制模块还用于控制所述第四开关导通，使所述DM弱下拉电路使能。5.根据权利要求1所述的USB设备移出识别电路，其特征在于，所述识别控制模块还用于在所述DP引脚和所述DM引脚均没有外接驱动时，确定所述USB接口处于设备移出状态；在所述DP引脚和所述DM引脚至少一个有外接驱动时，确定所述USB接口处于设备连接不抽电状态。6.一种应用权利要求1-5任一项所述的USB设备移出识别电路的USB设备移出识别方法，其特征在于，包括：控制电流检测模块检测USB接口的输出电流，并接收所述电流检测模块将所述输出电流与预设电流门限进行比较所得到的比较信号；根据所述比较信号，判断所述输出电流是否低于所述预设电流门限；若是，控制DPDM检测模块工作，并接收所述DPDM检测模块检测所述USB接口的DP引脚和DM引脚是否有外接驱动的检测结果；根据所述检测结果确定所述USB接口所处状态；所述状态包括设备移出状态和设备连接不抽电状态。7.根据权利要求6所述的USB设备移出识别方法，其特征在于，在控制DPDM检测模块工作之前，还包括：判断所述输出电流低于所述预设电流门限的持续时间是否达到预设时间；若是，则控制DPDM检测模块工作。8.根据权利要求6所述的USB设备移出识别方法，其特征在于，所述控制DPDM检测模块工作，并接收所述DPDM检测模块检测所述USB接口的DP引脚和DM引脚是否有外接驱动的检测结果具体包括：控制DPDM检测模块中的DP弱上拉电路使能，并接收所述DPDM检测模块中的第一电压比较器输出的所述USB接口的DP引脚的电压是否高于第一预设参考电压的第一比较结果；控制所述DPDM检测模块中的DP弱下拉电路使能，并接收所述第一电压比较器输出的所述DP引脚的电压是否低于第二预设参考电压的第二比较结果；控制所述DPDM检测模块中的DM弱上拉电路使能，并接收所述DPDM检测模块中的第二电压比较器输出的所述USB接口的DM引脚的电压是否高于所述第一预设参考电压的第三比较结果；控制所述DPDM检测模块中的DM弱下拉电路使能，并接收所述第二电压比较器输出的所述DM引脚的电压是否低于所述第二预设参考电压的第四比较结果；所述第一比较结果、所述第二比较结果、所述第三比较结果和所述第四比较结果组成检测结果；若所述第一比较结果和所述第二比较结果均为是，则所述DP引脚没有外接驱动，否则，则所述DP引脚有外接驱动；若所述第三比较结果和所述第四比较结果均为是，则所述DM引脚没有外接驱动；否则，则所述DM引脚有外接驱动。9.根据权利要求6所述的USB设备移出识别方法，其特征在于，所述根据所述检测结果确定所述USB接口所处状态具体包括：根据所述检测结果，判断所述DP引脚和所述DM引脚是否均没有外接驱动；若是，则确定所述USB接口处于设备移出状态；否则，则确定所述USB接口处于设备连接不抽电状态。10.一种USB设备移出识别供电系统，其特征在于，包括若干个权利要求1-5任一项所述的USB设备移出识别电路；所述USB设备移出识别电路的识别控制模块用于在确定USB接口所处状态后，根据所述状态采取不同的控制策略对所述USB接口所属的供电设备进行控制；所述状态包括设备移出状态和设备连接不抽电状态。
说明书desc
技术领域本发明涉及USB设备移出识别技术领域，特别是涉及一种USB设备移出识别电路、方法及供电系统。背景技术随着手机、平板、无线耳机、智能手表和笔记本电脑等一系列便携式电子产品的快速普及，USB充电技术也迎来了飞速的发展。USB设备的插拔状态识别技术，是USB充电技术领域内的一项关键技术，精准的USB设备的插拔状态识别，为充电系统的能耗管理、快充控制、多口功率分配和防过充保护等智能管理手段提供了便利。目前，通常采用检测输出电流的方式识别USB设备是否移出。当USB输出口的电流低于某一预设电流门限时，则判断USB设备已经移出，然后关闭USB输出口的供电输出，开启设备接入检测，等待新的一次接入识别。但是，在某些应用场景中，USB输出口的电流低于某一预设电流门限并不代表USB设备已经移出，有可能是USB设备已经充满电但仍然连接在USB输出口，也有可能是USB设备基于其应用或者安全考虑采取了暂时不抽电的控制策略。因此，亟需一种有效的USB设备移出识别技术，能够准确区分USB接口处于设备移出状态还是设备连接不抽电状态。发明内容本发明的目的是提供一种USB设备移出识别电路、方法及供电系统，能够准确区分USB接口处于设备移出状态还是设备连接不抽电状态。为实现上述目的，本发明提供了如下方案：第一方面，本发明用于提供一种USB设备移出识别电路，包括：识别控制模块、电流检测模块和DPDM检测模块；所述电流检测模块用于检测USB接口的输出电流，并将所述输出电流与预设电流门限进行比较，得到比较信号；所述USB接口能够与USB设备电连接，为所述USB设备充电；所述识别控制模块分别与所述电流检测模块和所述DPDM检测模块通信连接；所述识别控制模块用于接收所述比较信号，并在所述输出电流低于所述预设电流门限时，控制所述DPDM检测模块工作；所述DPDM检测模块与所述USB接口的DP引脚和DM引脚电连接；所述DPDM检测模块用于检测所述DP引脚和所述DM引脚是否有外接驱动，得到检测结果；所述识别控制模块用于根据所述检测结果确定所述USB接口所处状态；所述状态包括设备移出状态和设备连接不抽电状态。在一些实施例中，所述识别控制模块还用于在所述输出电流低于所述预设电流门限的持续时间达到预设时间后，控制所述DPDM检测模块工作。在一些实施例中，所述DPDM检测模块包括上拉电压源、DP弱上拉电路、DP弱下拉电路、第一电压比较器、DM弱上拉电路、DM弱下拉电路和第二电压比较器；所述DP弱上拉电路一端与所述上拉电压源相连接，另一端与所述DP引脚相连接；所述DP弱下拉电路一端与所述DP引脚相连接，另一端接地；所述第一电压比较器的同相输入端与所述DP引脚相连接，反相输入端在所述DP弱上拉电路使能时连接第一预设参考电压，在所述DP弱下拉电路使能时连接第二预设参考电压；若所述DP引脚的电压在所述DP弱上拉电路使能时高于所述第一预设参考电压，且所述DP引脚的电压在所述DP弱下拉电路使能时低于所述第二预设参考电压，则所述DP引脚没有外接驱动；所述DM弱上拉电路一端与所述上拉电压源相连接，另一端与所述DM引脚相连接；所述DM弱下拉电路一端与所述DM引脚相连接，另一端接地；所述第二电压比较器的同相输入端与所述DM引脚相连接，反相输入端在所述DM弱上拉电路使能时连接所述第一预设参考电压，在所述DM弱下拉电路使能时连接所述第二预设参考电压；若所述DM引脚的电压在所述DM弱上拉电路使能时高于所述第一预设参考电压，且所述DM引脚的电压在所述DM弱下拉电路使能时低于所述第二预设参考电压，则所述DM引脚没有外接驱动。在一些实施例中，所述DP弱上拉电路包括串联连接的第一开关和第一电阻；所述DP弱下拉电路包括串联连接的第二开关和第二电阻；所述DM弱上拉电路包括串联连接的第三开关和第三电阻；所述DM弱下拉电路包括串联连接的第四开关和第四电阻；所述识别控制模块还用于控制所述第一开关导通，使所述DP弱上拉电路使能；所述识别控制模块还用于控制所述第二开关导通，使所述DP弱下拉电路使能；所述识别控制模块还用于控制所述第三开关导通，使所述DM弱上拉电路使能；所述识别控制模块还用于控制所述第四开关导通，使所述DM弱下拉电路使能。在一些实施例中，所述识别控制模块还用于在所述DP引脚和所述DM引脚均没有外接驱动时，确定所述USB接口处于设备移出状态；在所述DP引脚和所述DM引脚至少一个有外接驱动时，确定所述USB接口处于设备连接不抽电状态。第二方面，本发明用于提供一种应用上述的USB设备移出识别电路的USB设备移出识别方法，包括：控制电流检测模块检测USB接口的输出电流，并接收所述电流检测模块将所述输出电流与预设电流门限进行比较所得到的比较信号；根据所述比较信号，判断所述输出电流是否低于所述预设电流门限；若是，控制DPDM检测模块工作，并接收所述DPDM检测模块检测所述USB接口的DP引脚和DM引脚是否有外接驱动的检测结果；根据所述检测结果确定所述USB接口所处状态；所述状态包括设备移出状态和设备连接不抽电状态。在一些实施例中，在控制DPDM检测模块工作之前，还包括：判断所述输出电流低于所述预设电流门限的持续时间是否达到预设时间；若是，则控制DPDM检测模块工作。在一些实施例中，所述控制DPDM检测模块工作，并接收所述DPDM检测模块检测所述USB接口的DP引脚和DM引脚是否有外接驱动的检测结果具体包括：控制DPDM检测模块中的DP弱上拉电路使能，并接收所述DPDM检测模块中的第一电压比较器输出的所述USB接口的DP引脚的电压是否高于第一预设参考电压的第一比较结果；控制所述DPDM检测模块中的DP弱下拉电路使能，并接收所述第一电压比较器输出的所述DP引脚的电压是否低于第二预设参考电压的第二比较结果；控制所述DPDM检测模块中的DM弱上拉电路使能，并接收所述DPDM检测模块中的第二电压比较器输出的所述USB接口的DM引脚的电压是否高于所述第一预设参考电压的第三比较结果；控制所述DPDM检测模块中的DM弱下拉电路使能，并接收所述第二电压比较器输出的所述DM引脚的电压是否低于所述第二预设参考电压的第四比较结果；所述第一比较结果、所述第二比较结果、所述第三比较结果和所述第四比较结果组成检测结果；若所述第一比较结果和所述第二比较结果均为是，则所述DP引脚没有外接驱动，否则，则所述DP引脚有外接驱动；若所述第三比较结果和所述第四比较结果均为是，则所述DM引脚没有外接驱动；否则，则所述DM引脚有外接驱动。在一些实施例中，所述根据所述检测结果确定所述USB接口所处状态具体包括：根据所述检测结果，判断所述DP引脚和所述DM引脚是否均没有外接驱动；若是，则确定所述USB接口处于设备移出状态；否则，则确定所述USB接口处于设备连接不抽电状态。第三方面，本发明用于提供一种USB设备移出识别供电系统，包括若干个上述的USB设备移出识别电路；所述USB设备移出识别电路的识别控制模块用于在确定USB接口所处状态后，根据所述状态采取不同的控制策略对所述USB接口所属的供电设备进行控制；所述状态包括设备移出状态和设备连接不抽电状态。根据本发明提供的具体实施例，本发明公开了以下技术效果：本发明用于提供一种USB设备移出识别电路、方法及供电系统，包括识别控制模块、电流检测模块和DPDM检测模块，先使能电流检测模块检测USB接口的输出电流，当输出电流低于预设电流门限时，判断USB接口处于设备移出状态或者设备连接不抽电状态。再使能DPDM检测模块，判断DP引脚和DM引脚是否存在外接驱动，从而对设备移出状态和设备连接不抽电状态这两种状态进行甄别，从而能够准确区分USB接口处于设备移出状态还是设备连接不抽电状态。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例1所提供的常见的USB设备接入检测电路及其工作原理的示意图；图2为本发明实施例1所提供的Type-A转Type-C线缆应用场景误触发接入识别的示意图；图3为本发明实施例1所提供的USB设备移出识别电路的结构及连接示意图；图4为本发明实施例1所提供的电流检测模块的电路图；图5为本发明实施例1所提供的DPDM检测模块的电路图；图6为本发明实施例2所提供的USB设备移出识别方法的方法流程图；图7为本发明实施例2所提供的USB设备移出识别方法的控制流程图；图8为本发明实施例3所提供的供电系统的功能模块示意图。符号说明：1-识别控制模块；2-电流检测模块；3-DPDM检测模块。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。本发明的目的是提供一种USB设备移出识别电路、方法及供电系统，能够准确区分USB接口处于设备移出状态还是设备连接不抽电状态。为使本发明的上述目的、特征和优点能够更加明显易懂，下面结合附图和具体实施方式对本发明作进一步详细的说明。实施例1：目前，当USB输出口的电流低于某一预设电流门限时，则判断USB设备已经移出，但在某些应用场景中，USB输出口的电流低于某一预设电流门限并不代表USB设备已经移出，有可能是USB设备已经充满电但仍然连接在USB接口，也有可能是USB设备基于其应用或者安全考虑采取了暂时不抽电的控制策略。比如说，在移动电源、户外电源等便携式储能应用中，若充电设备充满但仍然连接在USB接口，此时需要关闭该USB接口的供电输出，进入低功耗模式，以延长储能系统的续航时间。在多口充电器的应用中，尤其是多口共享单路电源的应用，当两路或两路以上USB接口同时连接着充电设备时，若其中一路充电设备充满，此时需要关闭该充满通路的USB接口供电输出，使得其他USB接口的充电设备能够进入快速充电或者获取更大的充电功率。在防过充的应用中，当充电设备充满电时，需要把USB接口的供电输出关闭，避免设备持续充电导致电池寿命降低及其他安全隐患。在上述这些应用场景中，若采用传统的电流检测方式识别USB设备移出，无法区分出是设备真实移出，还是设备充满电仍连接在USB接口。此时，如果仅以电流低于某一个预设电流门限作为判断，直接关闭USB接口供电输出，会存在一系列的充电体验问题。此外，若设备充满电仍连接在USB接口，此时关闭USB接口的供电输出，使能接入检测电路，往往会误触发新的一次设备接入识别，导致重新开启USB接口供电通路，无法达到充满关断的目的。在采用Type-A转Type-C线缆给Type-C口设备充电的场景中，这种接入检测的误触发更容易发生。原因如下：常见的USB接口设备接入检测方法如图1所示，是在VBUS引脚连接一个预设弱驱动电压VSET，该预设弱驱动电压VSET高于所预设的参考电压VREF，通过比较器将VBUS引脚电压与预设参考电压VREF进行比较，比较器的输出信号为PLUGIN。当充电设备接入时，充电设备的输入电阻R2和输入电容C2会产生下拉，把VBUS引脚的电压瞬间拉到低于预设参考电压VREF，通过识别VBUS引脚电压拉低的动作，即可判断充电设备的接入。但是，手机、平板和笔记本电脑等充电设备的Type-C口一般是DRP角色。如图2所示，当这些充电设备所连接的USB接口的VBUS电压消失后，这些设备的CC1和CC2引脚会进入Tongle状态，周期性地上拉和下拉。Type-A转Type-C线缆中VBUS和CC引脚之间串接有56k电阻。当充电设备Tongle到Rp时，会通过56k电阻把USB接口的VBUS拉高；充电设备Tongle到Rd时，会通过56k电阻把USB接口的VBUS拉低。这样的拉高和拉低过程，会触发USB接口的设备接入识别。另外，有些充电设备在充电过程中，若其检测点的温度达到一个特定值时，会采取暂停充电的策略，以保证充电安全和体验；也有些充电设备会智能识别用户的使用习惯，充电到大约80%电量时暂停充电，等用户将要拔出充电设备时，再提前把电量充满，这样可以避免设备的电池长时间处于满电状态，能达到延长电池使用寿命的效果。如果供电系统仅以输出电流低于某一个预设电流门限作为充电设备移出的判断，关闭了供电输出，会导致这类设备无法充满电。基于上述内容，为了能够更灵活的满足需求，亟需一种有效的USB设备移出识别技术，能够准确区分USB接口处于设备移出状态还是设备连接不抽电状态。本实施例用于提供一种USB设备移出识别电路，其设置于通过USB接口为充电设备供电的供电设备中，如图3所示，包括：识别控制模块1、电流检测模块2和DPDM检测模块3。电流检测模块2用于检测USB接口的输出电流，并将输出电流与预设电流门限进行比较，得到比较信号，并将比较信号反馈给识别控制模块1，比较信号即为输出电流是否低于预设电流门限的比较结果。USB接口能够与USB设备电连接，为USB设备充电。电流检测模块2可与USB接口的输出功率路径电连接，具体与USB接口的VBUS引脚或GND引脚电连接，以实现电流检测。作为一种可选的实施方式，如图4所示，其为电流检测模块2的一种可选的实现方式的电路图，电流检测模块2包括串接在VBUS上的检流电阻Rcs、电阻R1、运算放大器OP、调整管M1、电阻R2以及电压比较器CMP。检流电阻Rcs一端连接电阻R1，另一端连接运算放大器OP的反相输入端，检流电阻Rcs用于将VBUS上的电流信息Iout转换成电压信号Vcs。电阻R1的另一端连接运算放大器OP的同相输入端。调整管M1的第一端连接运算放大器OP的同相输入端，第二端连接运算放大器OP的输出端，第三端连接电阻R2的一端。电阻R2的另一端接地。调整管M1和电阻R2的连接点连接电压比较器CMP的反相输入端，电压比较器CMP的同相输入端连接参考电压VREF。运算放大器OP和调整管M1组成的反馈环路，使得运算放大器OP的同相输入端和反相输入端电压相等，于是，电阻R1两端的电压差等于Vcs，由于流经电阻R1和电阻R2的电流相等，所以检流输出电压Vcso实现了对Vcs的R2/R1倍放大，即；电压比较器CMP的同相输入端连接参考电压VREF，反相输入端连接检流输出电压Vcso，实现两者的比较。其中，参考电压VREF与预设电流门限相对应。若参考电压VREF比检流输出电压Vcso高，电压比较器输出的比较信号low_current为高电平信号“1”，代表USB接口输出电流低于预设电流门限；若参考电压VREF比检流输出电压Vcso低，电压比较器输出的比较信号low_current为低电平信号“0”，代表USB接口输出电流高于预设电流门限。上述电路结构仅是电流检测模块2的一个实现方式，本实施例还可采用其他的实现方式，例如检流电阻Rcs换成VBUS通路开关MOS，或者通过MOS镜像实现电流信息采集，均可以实现采集输出电流，并将输出电流与预设电流门限比较输出比较信号的等同效果，均属于本发明保护的范围内。需要说明的是，在不采用串接在VBUS上的检流电阻Rcs这一方式检测电流时，本实施例的识别电路只需设置DP引脚、DM引脚和GND引脚，这三个引脚通过USB线缆与充电设备所连的USB接口的DP引脚、DM引脚和GND引脚一一对应连接。在采用串接在VBUS上的检流电阻Rcs这一方式检测电流时，本实施例的识别电路还需设置VBUS引脚，通过检流电阻Rcs，连接到USB接口的VBUS引脚。当采用电流检测模块2与USB接口的GND引脚电连接，以实现电流检测时，可将检流电阻Rcs串接在GND上，充电电流先经过USB接口的GND引脚，再经过检流电阻Rcs，回流到识别电路的GND。识别控制模块1分别与电流检测模块2和DPDM检测模块3通信连接。识别控制模块1用于接收比较信号，并在输出电流低于预设电流门限时，启动DPDM检测模块3，控制DPDM检测模块3工作。可选的，本实施例的识别控制模块1还可以使能电流检测模块2检测USB接口的输出电流，以启动电流检测模块2。优选的，为了避免输出电流短时间跳变导致的识别错误，本实施例的识别控制模块1用于在输出电流低于预设电流门限的持续时间达到预设时间后，才控制DPDM检测模块3工作，即在输出电流低于预设电流门限并维持一个预设时间T后，才判断USB接口处于设备移出状态或者设备连接不抽电状态。本实施例的预设时间T可以选择为几秒，几十秒，几分钟甚至几十分钟。DPDM检测模块3与USB接口的DP引脚和DM引脚电连接，DPDM检测模块3用于检测DP引脚和DM引脚是否有外接驱动，得到检测结果，并将检测结果反馈给识别控制模块1。外接驱动是指充电设备跟USB接口连接时，会在DP引脚，DM引脚或者DP、DM两个引脚施加一定强度的驱动，该外接驱动可以是电阻上拉、电阻下拉或者特定的驱动电压。识别控制模块1用于根据检测结果确定USB接口所处状态，状态包括设备移出状态和设备连接不抽电状态。具体的，识别控制模块1还用于在DP引脚和DM引脚均没有外接驱动时，则判断USB设备已经移出USB接口，确定USB接口处于设备移出状态；在DP引脚和DM引脚两个引脚中至少一个有外接驱动时，则判断USB设备虽然不抽电但仍连接在USB接口，确定USB接口处于设备连接不抽电状态。本实施例的USB接口可以是Type-A或者Type-C等类型的接口。如图5所示，本实施例的DPDM检测模块3包括上拉电压源Vup、DP弱上拉电路、DP弱下拉电路、第一电压比较器CMP1、DM弱上拉电路、DM弱下拉电路和第二电压比较器CMP2。DP弱上拉电路一端与上拉电压源Vup相连接，另一端与DP引脚相连接。DP弱下拉电路一端与DP引脚相连接，另一端接地。第一电压比较器CMP1的同相输入端与DP引脚相连接，反相输入端在DP弱上拉电路使能时连接第一预设参考电压VREF1，比较判断DP引脚的电压是否高于第一预设参考电压VREF1，得到判断信号det-dp；在DP弱下拉电路使能时连接第二预设参考电压VREF2，比较判断DP引脚的电压是否低于第二预设参考电压VREF2，得到判断信号det-dp。若DP引脚的电压在DP弱上拉电路使能时高于第一预设参考电压，且DP引脚的电压在DP弱下拉电路使能时低于第二预设参考电压，则DP引脚没有外接驱动；否则，则DP引脚有外接驱动。DM弱上拉电路一端与上拉电压源Vup相连接，另一端与DM引脚相连接。DM弱下拉电路一端与DM引脚相连接，另一端接地。第二电压比较器CMP2的同相输入端与DM引脚相连接，反相输入端在DM弱上拉电路使能时连接第一预设参考电压VREF1，比较判断DM引脚的电压是否高于第一预设参考电压VREF1，得到判断信号det-dm；在DM弱下拉电路使能时连接第二预设参考电压VREF2，比较判断DM引脚的电压是否低于第二预设参考电压VREF2，得到判断信号det-dm。若DM引脚的电压在DM弱上拉电路使能时高于第一预设参考电压，且DM引脚的电压在DM弱下拉电路使能时低于第二预设参考电压，则DM引脚没有外接驱动；否则，则DM引脚有外接驱动。其中，上拉电压源Vup的电压高于第一预设参考电压VREF1，第一预设参考电压VREF1高于第二预设参考电压VREF2。可选的，DP弱上拉电路包括串联连接的第一开关S1和第一电阻Rup1，DP弱下拉电路包括串联连接的第二开关S2和第二电阻Rdn1，DM弱上拉电路包括串联连接的第三开关S3和第三电阻Rup2，DM弱下拉电路包括串联连接的第四开关S4和第四电阻Rdn2。本实施例还可包括第五开关S5，其分别连接第一电压比较器CMP1和第二电压比较器CMP2的反相输入端，用于选择VREF1或者VREF2作为参考电压进行比较。Rup1、Rdn1、Rup2和Rdn2均可为1MΩ，VREF1可为3.675V，VREF2可为0.325V，Vup可为5V。识别控制模块1还用于控制第一开关S1导通，使DP弱上拉电路使能，即，使能DP弱上拉，此时第五开关S5连接第一预设参考电压VREF1，比较判断DP引脚的电压是否高于第一预设参考电压VREF1。识别控制模块1还用于控制第二开关S2导通，使DP弱下拉电路使能，即，使能DP弱下拉，此时第五开关S5连接第二预设参考电压VREF2，比较判断DP引脚的电压是否低于第二预设参考电压VREF2。若两个比较判断结果都为“是”，则代表DP引脚没有外接驱动；否则，则代表DP引脚有外接驱动。识别控制模块1还用于控制第三开关S3导通，使DM弱上拉电路使能，即，使能DM弱上拉，此时第五开关S5连接第一预设参考电压VREF1，比较判断DM引脚的电压是否高于第一预设参考电压VREF1。识别控制模块1还用于控制第四开关S4导通，使DM弱下拉电路使能，即，使能DM弱下拉，此时第五开关S5连接第二预设参考电压VREF2，比较判断DM引脚的电压是否低于第二预设参考电压VREF2。若两个比较判断结果都为“是”，则代表DM引脚没有外接驱动；否则，则代表DM引脚有外接驱动。本实施例所提供的USB设备移出识别电路，包括电流检测模块2、DPDM检测模块3以及识别控制模块1，第一步使能电流检测模块2检测USB接口的输出电流，当输出电流低于预设电流门限时，判断USB接口处于设备移出状态或者设备连接不抽电状态；第二步使能DPDM检测模块3，判断DP引脚和DM引脚是否存在外接驱动，从而对设备移出状态和设备连接不抽电状态这两种状态进行甄别，从而能够准确区分USB接口处于设备移出状态还是设备连接不抽电状态。实施例2：本实施例用于提供一种应用实施例1所述的USB设备移出识别电路的USB设备移出识别方法，如图6所示，包括：S1：控制电流检测模块检测USB接口的输出电流，并接收所述电流检测模块将所述输出电流与预设电流门限进行比较所得到的比较信号；S2：根据所述比较信号，判断所述输出电流是否低于所述预设电流门限；S3：若是，控制DPDM检测模块工作，并接收所述DPDM检测模块检测所述USB接口的DP引脚和DM引脚是否有外接驱动的检测结果；优选的，在控制DPDM检测模块工作之前，还包括：判断输出电流低于预设电流门限的持续时间是否达到预设时间，若是，则控制DPDM检测模块工作，从而可以避免输出电流短时间跳变导致的识别错误。S3可以包括：控制DPDM检测模块中的DP弱上拉电路使能，并接收DPDM检测模块中的第一电压比较器输出的USB接口的DP引脚的电压是否高于第一预设参考电压的第一比较结果；控制DPDM检测模块中的DP弱下拉电路使能，并接收第一电压比较器输出的DP引脚的电压是否低于第二预设参考电压的第二比较结果；控制DPDM检测模块中的DM弱上拉电路使能，并接收DPDM检测模块中的第二电压比较器输出的USB接口的DM引脚的电压是否高于第一预设参考电压的第三比较结果；控制DPDM检测模块中的DM弱下拉电路使能，并接收第二电压比较器输出的DM引脚的电压是否低于第二预设参考电压的第四比较结果；第一比较结果、第二比较结果、第三比较结果和第四比较结果组成检测结果，若第一比较结果和第二比较结果均为是，则DP引脚没有外接驱动，否则，则DP引脚有外接驱动；若第三比较结果和第四比较结果均为是，则DM引脚没有外接驱动；否则，则DM引脚有外接驱动。S4：根据所述检测结果确定所述USB接口所处状态；所述状态包括设备移出状态和设备连接不抽电状态。S4可以包括：根据检测结果，判断DP引脚和DM引脚是否均没有外接驱动；若是，则确定USB接口处于设备移出状态；否则，则确定USB接口处于设备连接不抽电状态。更为具体的，如图7所示，本实施例的USB设备移出识别方法包括以下步骤：步骤701，检测USB接口输出电流。步骤702，比较判断USB接口输出电流是否低于预设电流门限。若输出电流不低于预设电流门限，则返回步骤701；若输出电流低于预设电流门限，则执行步骤703。步骤703，判断输出电流是否低于预设电流门限并维持预设时间T。若在预设时间T之内，电流已经恢复到预设电流门限以上，则返回步骤701；若输出电流在预设时间T内，一直都低于预设电流门限，则判断为处于设备移出或者设备连接但不抽电两种状态之一，进一步执行步骤704。步骤704，使能DP和DM引脚的弱上拉。步骤705，比较判断DP和DM引脚的电压是否都高于第一预设参考电压。若DP和DM两者的电压都高于第一预设参考电压，则执行步骤706；若DP和DM的电压，至少有一个不高于第一预设参考电压，则认为DP或DM引脚存在外接驱动，则执行步骤709。步骤706，使能DP和DM引脚的弱下拉。步骤707，比较判断DP和DM引脚的电压是否都低于第二预设参考电压。若DP和DM两者的电压都低于第二预设参考电压，则执行步骤708；若DP和DM的电压，至少有一个不低于第二预设参考电压，则认为DP或DM引脚存在外接驱动，则执行步骤709。步骤708，判断处于设备移出状态。步骤709，判断处于设备连接不抽电状态。需要说明的是，本实施例的USB设备移出识别方法的流程并不限于图6和图7所示的流程图，根据不同的需求，所示流程图中的步骤可以增加、改变顺序、修改或者移除，比如，步骤704、705、706和707可以拆分成多个子步骤，针对DP和DM引脚分别做检测判断，或者调整成不同的检测顺序。本实施例所提供的USB设备移出识别方法，第一步使能电流检测模块检测USB接口的输出电流，当输出电流低于预设电流门限时，判断USB接口处于设备移出状态或者设备连接不抽电状态。第二步使能DPDM检测模块，通过判断DP和DM引脚电压是否能够上拉到第一预设参考电压以上，以及是否能够下拉到第二预设参考电压以下，从而检测DP和DM引脚是否存在外接驱动。若DP和DM都没有外接驱动，则判断USB设备已经移出；若DP和DM两者至少有一个引脚存在外接驱动，则判断USB设备虽然不抽电但仍连接在USB接口，从而能够准确区分USB接口处于设备移出状态还是设备连接不抽电状态。实施例3：本实施例用于提供一种USB设备移出识别供电系统，如图8所示，所述供电系统包括若干个实施例1所述的USB设备移出识别电路，并采用实施例2的USB设备移出识别方法对一个或多个USB接口进行供电管理，具体的，USB设备移出识别电路的识别控制模块用于在确定USB接口所处状态后，根据状态采取不同的控制策略对USB接口所属的供电设备进行控制，所述状态包括设备移出状态和设备连接不抽电状态，即在甄别出设备移出或设备连接不抽电的两种不同状态后，分别采取不同的控制策略。本实施例的供电系统可为移动电源、户外电源、多口充电器或者防过充充电管理装置等，控制策略可以为，针对设备移出状态直接关闭供电通路，针对设备连接不抽电状态延迟关闭供电通路；也可以为，针对设备移出状态关闭供电通路并使能设备接入检测，针对设备连接不抽电状态关闭供电通路但不使能设备插入检测；也可以为，针对设备连接不抽电状态先关闭供电通路，特定时间后重新开启供电通路。本实施例所提供的供电系统采用了上述USB设备移出识别电路和方法，并在甄别出设备移出或设备连接不抽电的两种不同状态后，分别采取不同的控制策略，能够灵活、有效地根据识别结果采取合适的控制策略，优化用户使用体验。本说明书中各个实施例采用递进的方式描述，每个实施例重点说明的都是与其他实施例的不同之处，各个实施例之间相同相似部分互相参见即可。本文中应用了具体个例对本发明的原理及实施方式进行了阐述，以上实施例的说明只是用于帮助理解本发明的方法及其核心思想；同时，对于本领域的一般技术人员，依据本发明的思想，在具体实施方式及应用范围上均会有改变之处。综上所述，本说明书内容不应理解为对本发明的限制。
