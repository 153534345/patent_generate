标题title
一种管道或容器内外壁三维轮廓和图像数据的存储方法
摘要abst
本发明公开了一种管道或容器内外壁三维轮廓和图像数据的存储方法，包括以下步骤：创建数据文件，写入文件头；沿管道中心轴或容器水平中心轴分割，将管道或容器内壁分割成若干段，沿管壁或容器壁环向分割，将管道或容器内外壁分割成若干个小块，得出管道或容器内外壁三维轮廓、图像数据相关的数据块；写入管道或容器内外壁三维轮廓、图像数据相关的数据块和管道或容器的其他信息，直到写入全部相关数据。本发明可以获取并存储长达数百公里的管道或高精度的管状容器的三维轮廓和图像数据，这些数据可供以下测量活动使用：1、管状容积计算；2、管道或容器空洞探查；3、容器或管道缺陷判断；4、压力管道单线图绘制等。
权利要求书clms
1.一种管道或容器内外壁三维轮廓和图像数据的存储方法，其特征在于，包括以下步骤：a、创建数据文件，写入文件头；b、沿容器水平中心轴或管道中心轴分割，将管道或容器内壁分割成若干段，沿管道或容器环向分割，将管道或容器内外壁分割成若干个小块，得出管道或容器内外壁三维轮廓、图像数据相关的数据块；c、写入管道或容器内外壁三维轮廓、图像数据相关的数据块和其他信息，直到写入全部相关数据。2.根据权利要求1所述管道或容器内外壁三维轮廓和图像数据的存储方法，其特征在于，步骤a中，文件由文件头和若干个数据库组成，文件头出现在文件开头部分。3.根据权利要求2所述管道或容器内外壁三维轮廓和图像数据的存储方法，其特征在于，步骤a中，文件包含任意数目和任意文件格式支持的数据块类型，并且顺序不限。4.根据权利要求3所述管道或容器内外壁三维轮廓和图像数据的存储方法，其特征在于，步骤a中，如果前后两个数据库定义的内容有冲突，以后一个数据块包含的内容为准。5.根据权利要求4所述管道或容器内外壁三维轮廓和图像数据的存储方法，其特征在于，步骤a中，文件的最后一个数据库不指定数据块的长度，此时数据块长度部分填入为0，以文件末尾作为数据块结束的标志。6.根据权利要求5所述管道或容器内外壁三维轮廓和图像数据的存储方法，其特征在于，步骤a中，文件描述的管道是直管、弯管、分支管道或变径管道。7.根据权利要求1所述管道或容器内外壁三维轮廓和图像数据的存储方法，其特征在于，步骤b中，“沿容器水平中心轴或管道中心轴分割，将管道或容器内壁分割成若干段”的具体步骤如下：定义容器沿水平中心轴方向，设定左侧端面为D1，设定右侧端面为D2；b1-1、根据精度要求，将管道中心轴或容器水平中心轴分割成等长小线段的数目M，将管道中心轴或容器水平中心轴分割成M条等长的小线段Si，Si为曲线线段或其他线段，其中，i∈；b1-2、设定Si的两个端点为Ai和Bi,其中Ai是沿着中心轴距离管道中心轴起点或容器端面D1更近的点，以 Ai为起点，Bi为终点的向量作为中心轴Ai和Bi处的方向NAi和NBi，其中，i∈；b1-3、求过Ai且与NAi垂直的平面SAi，以及求过Bi且与NBi垂直的平面SBi，其中，i∈；b1-4、管道或容器内外壁在平面SAi和SBi之间的部分，设定为SIi和SOi，其中，i∈；b1-5、经过以上步骤，管道或容器内壁就被分割成了M段，记为SIi,其中，i∈ ，管道或容器外壁也被分割成了M段，设定为SOi,其中，i∈。8.根据权利要求7所述管道或容器内外壁三维轮廓和图像数据的存储方法，其特征在于，步骤b中，“沿管壁或容器壁环向分割，将管道或容器内外壁分割成若干个小块”的具体步骤如下：b2-1、取以过小线段Si两个端点的直线Li为轴，由N个平面组成的共线均匀平面束SLi，不同的共线平面束SLi之间无特殊约束关系，其中，i∈；b2-2、SLi将SIi和SOi分割成N块，记为SIij和SOij,其中，i∈,j∈；b2-3、经过以上步骤，管道或容器内外壁就分别被分割成了M乘以N个小块。9.根据权利要求8所述管道或容器内外壁三维轮廓和图像数据的存储方法，其特征在于，还包括“定义管道或容器的三维坐标系”的步骤，具体如下：b3-1、设定i=0,则Ai=A0、NAi=NA0、SAi=SA0、SLi=SL0，以A0为坐标原点，以NA0的方向为Z轴正方向，以平面SA0为XY平面;b3-2、在组成平面束SL0的N个平面中，选择任意一个平面，并以该平面与平面SA0相交的直线为X轴；b3-3、在已确定的直角坐标系原点A0、Z轴正方向NA0，以及X轴的基础上，任意选择X轴正方向和Y轴正方向，建立直角坐标系，同一个数据块中的数据，都在同一个坐标系中。
说明书desc
技术领域本发明涉及数据存储领域，特别是涉及一种管道或容器内外壁三维轮廓和图像数据的存储方法。背景技术在管道或容器测绘检测过程当中，管道或容器的内壁和外壁的三维轮廓、外观图像都是非常重要的数据。将这些数据合理有效地存储，对于保存查看管道或容器检测初期状态及周期运行后情况对比具有十分重要的意义。除了三维轮廓和图像数据外，管道或容器所在的地理位置信息，数据采集的时间信息，也是非常重要的关联数据，也应同时予以保存。现有的图像数据存储格式，例如JPEG、BMP等图像格式，仅适合于保存管道或容器内壁表面或外壁表面的纹理信息，不能保存三维轮廓数据。现有PLY、PCD等点云数据文件格式虽然能够保存点的三维坐标及其对应的RGB颜色信息，但是没有明确定义三维空间中点的拓扑结构。如果仅仅定义点云的长宽，类似于借用图像格式的alpha通道来保存深度值的深度图，也不能很好地同时保存管道或容器的轮廓和外观数据。目前针对管道或容器外观的检测，包含内外壁三维轮廓和图像纹理信息的采集和处理，日益增多，但是还没有出现专门用于保存管道或容器内外壁三维轮廓和图像纹理的文件格式。发明内容基于此，针对上述问题，有必要提出一种管道或容器内外壁三维轮廓和图像数据的存储方法，不仅可以表示不同尺度的管道或容器数据，还可以表示管道或容器空洞。本发明的技术方案是：一种管道或容器内外壁三维轮廓和图像数据的存储方法，包括以下步骤：a、创建数据文件，写入文件头；b、沿容器水平中心轴或管道中心轴分割，将管道或容器内壁分割成若干段，沿管道或容器环向分割，将管道或容器内外壁分割成若干个小块，得出管道或容器内外壁三维轮廓、图像数据相关的数据块；c、写入管道或容器内外壁三维轮廓、图像数据相关的数据块和其他信息，直到写入全部相关数据。在进一步技术方案中，步骤a中，文件由文件头和若干个数据库组成，文件头出现在文件开头部分。在进一步技术方案中，步骤a中，文件包含任意数目和任意文件格式支持的数据块类型，并且顺序不限。在进一步技术方案中，步骤a中，如果前后两个数据库定义的内容有冲突，以后一个数据块包含的内容为准。在进一步技术方案中，步骤a中，文件的最后一个数据库不指定数据块的长度，此时数据块长度部分填入为0，以文件末尾作为数据块结束的标志。在进一步技术方案中，步骤a中，文件描述的管道是直管、弯管、分支管道或变径管道。在进一步技术方案中，步骤b中，“沿容器水平中心轴或管道中心轴分割，将管道或容器内壁分割成若干段”的具体步骤如下：定义容器沿水平中心轴方向，设定左侧端面为D1，设定右侧端面为D2；b1-1、根据精度要求，将管道中心轴或容器水平中心轴分割成等长小线段的数目M，将管道中心轴或容器水平中心轴分割成M条等长的小线段Si，Si为曲线线段或其他线段，其中，i∈；b1-2、设定Si的两个端点为Ai和Bi,其中Ai是沿着中心轴距离管道中心轴起点或容器端面D1更近的点，计算Ai和Bi处中心轴的方向距离NAi和NBi，其中，i∈；b1-3、求过Ai且与NAi垂直的平面SAi，以及求过Bi且与NBi垂直的平面SBi，其中，i∈；b1-4、管道或容器内外壁在平面SAi和SBi之间的部分，设定为SIi和SOi，其中，i∈；b1-5、经过以上步骤，管道或容器内壁就被分割成了M段，记为SIi,其中，i∈，管道或容器外壁也被分割成了M段，设定为SOi,其中，i∈。在进一步技术方案中，步骤b中，“沿管壁或容器壁环向分割，将管道或容器内外壁分割成若干个小块”的具体步骤如下：b2-1、取以过小线段Si两个端点的直线Li为轴，由N个平面组成的共线均匀平面束SLi，不同的共线平面束SLi之间无特殊约束关系，其中，i∈；b2-2、SLi将SIi和SOi分割成N块，记为SIij和SOij,其中，i∈,j∈；b2-3、经过以上步骤，管道或容器内外壁就分别被分割成了M乘以N个小块。在进一步技术方案中，还包括“定义管道或容器的三维坐标系”的步骤，具体如下：b3-1、设定i=0,则Ai=A0、NAi=NA0、SAi=SA0、SLi=SL0，以A0为坐标原点，以NA0的方向为Z轴正方向，以平面SA0为XY平面;b3-2、在组成平面束SL0的N个平面中，选择任意一个平面，并以该平面与平面SA0相交的直线为X轴；b3-3、在已确定的直角坐标系原点A0、Z轴正方向NA0，以及X轴的基础上，任意选择X轴正方向和Y轴正方向，建立直角坐标系，同一个数据块中的数据，都在同一个坐标系中。本发明的有益效果是：可以获取并存储长达数百公里的管道或高精度的管状容器的三维轮廓和图像数据，这些数据可供以下测量活动使用：1、管状容积计算；2、管道或容器空洞探查；3、容器或管道缺陷判断；4、压力管道单线图绘制等。具体实施方式下面对本发明的实施例进行详细说明。实施例：一种管道或容器内外壁三维轮廓和图像数据的存储方法，包括以下步骤：a、创建数据文件，写入文件头；b、沿容器水平中心轴或管道中心轴分割，将管道或容器内壁分割成若干段，沿管道或容器环向分割，将管道或容器内外壁分割成若干个小块，得出管道或容器内外壁三维轮廓、图像数据相关的数据块；c、写入管道或容器内外壁三维轮廓、图像数据相关的数据块和其他信息，直到写入全部相关数据。步骤a中，文件由文件头和若干个数据库组成，文件头出现在文件开头部分。步骤a中，文件包含任意数目和任意文件格式支持的数据块类型，并且顺序不限。步骤a中，如果前后两个数据库定义的内容有冲突，以后一个数据块包含的内容为准。步骤a中，文件的最后一个数据库不指定数据块的长度，此时数据块长度部分填入为0，以文件末尾作为数据块结束的标志。步骤a中，文件描述的管道是直管、弯管、分支管道或变径管道。步骤b中，“沿容器水平中心轴或管道中心轴分割，将管道或容器内壁分割成若干段”的具体步骤如下：定义容器沿水平中心轴方向，设定左侧端面为D1，设定右侧端面为D2；b1-1、根据精度要求，将管道中心轴或容器水平中心轴分割成等长小线段的数目M，将管道中心轴或容器水平中心轴分割成M条等长的小线段Si，Si为曲线线段或其他线段，其中，i∈；b1-2、设定Si的两个端点为Ai和Bi,其中Ai是沿着中心轴距离管道中心轴起点或容器端面D1更近的点，计算Ai和Bi处中心轴的方向距离NAi和NBi，其中，i∈；b1-3、求过Ai且与NAi垂直的平面SAi，以及求过Bi且与NBi垂直的平面SBi，其中，i∈；b1-4、管道或容器内外壁在平面SAi和SBi之间的部分，设定为SIi和SOi，其中，i∈；b1-5、经过以上步骤，管道或容器内壁就被分割成了M段，记为SIi,其中，i∈，管道或容器外壁也被分割成了M段，设定为SOi,其中，i∈。步骤b中，“沿管壁或容器壁环向分割，将管道或容器内外壁分割成若干个小块”的具体步骤如下：b2-1、取以过小线段Si两个端点的直线Li为轴，由N个平面组成的共线均匀平面束SLi，不同的共线平面束SLi之间无特殊约束关系，其中，i∈；b2-2、SLi将SIi和SOi分割成N块，记为SIij和SOij,其中，i∈,j∈；b2-3、经过以上步骤，管道或容器内外壁就分别被分割成了M乘以N个小块。在进一步实施例中，还包括“定义管道或容器的三维坐标系”的步骤，具体如下：b3-1、设定i=0,则Ai=A0、NAi=NA0、SAi=SA0、SLi=SL0，以A0为坐标原点，以NA0的方向为Z轴正方向，以平面SA0为XY平面;b3-2、在组成平面束SL0的N个平面中，选择任意一个平面，并以该平面与平面SA0相交的直线为X轴；b3-3、在已确定的直角坐标系原点A0、Z轴正方向NA0，以及X轴的基础上，任意选择X轴正方向和Y轴正方向，建立直角坐标系，同一个数据块中的数据，都在同一个坐标系中。本发明可以获取并存储长达数百公里的管道或高精度的管状容器的三维轮廓和图像数据，这些数据可供以下测量活动使用：1、管状容积计算；2、管道或容器空洞探查；3、容器或管道缺陷判断；4、压力管道单线图绘制等。文件内容见下表：文件头定义见下表：数据块定义见下表：可以选择的数据块类型：数据块：管道或容器内壁三维轮廓。数据块类型ID的结构见下表：上表中，按照数据块类型ID编码规则举例:字节1值为1时，表示本数据块保存管道或容器内壁数据。字节2值为8时，表示本数据块三维坐标数据以double类型保存。字节3值为1时，表示本数据块存储的颜色精度范围为0-255。字节4值为3，所以表示本数据块写入管道或容器Ai三维坐标、距离、法线向量。管道或容器内壁数据段内容和字节数见下表：上表中，r表示SIij中心点到管道或容器中心轴的距离，r为0表示管壁或容器壁为空洞，n表示SIij中心点的法向量。关于扩展名：本发明所述的存储方法在存储文件时使用的文件扩展名为：ptg或pgt,字母p、t、g分别表示英文单词pipe、texture、geometry。数据块类型ID编码规则：字节1用于表示本数据块对应的管壁或容器壁类型：字节1的值∈，1表示管道或容器内壁数据、2表示管道或容器外壁数据、3表示管道或容器内壁和外壁数据。字节2用于表示本数据块存储的三维坐标数据精度类型：字节2的值∈，值为4表示三维坐标精度为float类型、值为8表示double类型。字节3用于表示本数据块存储的颜色精度值：字节3的值∈，值为1表示颜色精度范围为0-255，值为2表示颜色精度范围为0-65535，值为4表示颜色精度范围采用float类型。字节4用于表示数据块存储的数据内容：字节4的值有如下9种,其中1-4种为0、r、g、rgb，5-9种为r、n、g、rgb之间的或运算值。1、0：仅包含Ai三维坐标2、r: Ai、距离；3、g: Ai、颜色灰度；4、rgb : Ai、rgb颜色；5、r | g: Ai、距离、颜色灰度；6、r | rgb: Ai、距离、rgb颜色；7、r | n: Ai、距离、法线向量；8、r | n | g: Ai、距离、法线向量、颜色灰度；9、r | n | rgb: Ai、距离、法线向量、rgb颜色。具体表示见下表：管道或容器内壁数据块，管道或容器外壁数据块，管道或容器内外壁数据块的数据段定义包括管道或容器内外壁分块方法、坐标系选取方以及数据段数据结构。以上所述实施例仅表达了本发明的具体实施方式，其描述较为具体和详细，但并不能因此而理解为对本发明专利范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本发明构思的前提下，还可以做出若干变形和改进，这些都属于本发明的保护范围。
