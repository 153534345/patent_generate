标题title
基于自适应隐藏层BP神经网络的锂电池状况预测方法
摘要abst
本发明提供了一种基于自适应隐藏层BP神经网络的锂电池状况预测方法，属于锂电池技术领域。该方法将充电时间引入了BP神经网络的训练，提高了锂电池SOH估计的精度；利用隐藏层自适应设置建立精确的神经网络模型，使网络在数据集变化的情形下快速且精确地实现了锂电池SOH预测，所提方法具有应用范围广、预测精度高、跟踪性强等优点，同时降低了传统BP神经网络对网络初始结构设置的依赖，有效提高了模型的准确性。
权利要求书clms
1.一种基于自适应隐藏层BP神经网络的锂电池状况预测方法，所述锂电池状况为锂电池健康状况，其特征在于，包括以下步骤：步骤1，将锂电池充放电循环n次，并对n次充放电循环中的锂电池进行采样，将采样数据组成锂电池充放电数据集；从该充放电数据集中提取以下与锂电池健康状况相关的锂电池采样参数并记为采样健康参数：n次充放电循环中的采样端电压、n次充放电循环中的采样端电流、n次充放电循环中的采样锂电池温度、n次充放电循环中的采样锂电池充电时间和n次充放电循环中的采样锂电池容量，即得到五组采样健康参数，将五组中的任意一组记为采样健康参数组j，j＝1,2,3,4,5；将n次充放电循环中的任意一次循环记为循环i，i＝1,2,...n；以采样健康参数组j作为列向量，构建健康参数数据矩阵，并记为健康矩阵Hn×5，其表达式如下：其中，Vi为循环i中测得的采样端电压；Ii为循环i中测得的采样端电流；Ti为循环i中测得的采样锂电池温度；ti为循环i中测得的采样锂电池充电时间；Ci为循环i中测得的采样锂电池充电容量。步骤2，对5组列向量进行归一化处理，得到归一化处理后的以下数据：n个归一化处理后的锂电池端电压，并将循环i中的锂电池端电压记为端电压n个归一化处理后的端电流，并将循环i中的端电流记为端电流n个归一化处理后的锂电池温度，并将循环i中的锂电池温度记为锂电池温度n个归一化处理后的锂电池充电时间，并将循环i中的锂电池充电时间记为锂电池充电时间n个归一化处理后的锂电池充电容量，并将循环i中的锂电池充电容量记为锂电池充电容量将n个端电压n个端电流n个锂电池温度和n个锂电池充电时间组成输入数据集Xn×4，n个锂电池充电容量组成输出数据集Yn×1。步骤3，将输入数据集Xn×4分成两组，依次为输入训练集Xtrain和输入测试集Xtest；将输出数据集Yn×1分为两组，依次为输出训练集Ytrain和输出测试集Ytest；其中，两个训练集占原数据集的比例均为给定的预设值γ，γ＝50％～90％；设输出训练集Ytrain中共包括m个数据，并将m个数据中的任意一个记为输出训练值yf，f＝1,2,...,m，m＜n。步骤4，建立三层BP神经网络A并进行训练。步骤4.1，所述三层BP神经网络A的结构包括输入层、隐藏层和输出层；所述输入层包括4个输入层单元，所述输出层仅包括1个输出层单元；输入层和隐藏层之间为全连接，隐藏层和输出层之间为全连接；所述隐藏层单元数由经验公式和自适应调节公式确定，其中经验公式用来估计隐藏层单元数的最大值，所述经验公式为：其中，h为隐藏层单元数，h为整数，r为输入层单元数，s为输出层单元数，a为一个小于等于10的常数，即隐藏层单元数h≤12；步骤4.2，按照每次增加1个单元的方式共设置12个训练隐藏层单元数h’，其中，第1个训练隐藏层单元数h’为1；将12个训练隐藏层单元数h’逐次代入步骤4.1建立的BP神经网络A，即得到12个训练隐藏层，然后进行训练，直至训练隐藏层单元数h’为12时结束；其中一次训练的过程如下：将输入训练集Xtrain输入包括训练隐藏层的BP神经网络A进行训练，得到一个输出预测值的集合其中为输出预测值，输出预测值的集合与输出训练集Ytrain维度保持一致，将输出预测值与输出训练值yf代入平均绝对值误差公式计算得到训练误差MAE，所述平均绝对值误差公式的表达式为：12次训练结束后，将第12次训练的训练隐藏层单元数h’记为新隐藏层单元数hnew，与新隐藏层单元数hnew对应的训练误差MAE记为新误差MAEnew，将前11个训练误差MAE中的最小值记为最小误差MAEpre，并将与最小误差MAEpre对应的训练隐藏层单元数h’记为最小误差隐藏层单元数hpre；根据自适应调节公式确定最佳隐藏层单元数hbest，所述自适应调节公式的表达式如下：将最佳隐藏层单元数hbest作为隐藏层单元数代入步骤4.1得到的BP神经网络A，三层BP神经网络A的结构搭建完毕。步骤5，将步骤3获得的输入训练集Xtrain和输出训练集Ytrain加入步骤4建立好的BP神经网络A，对BP神经网络A的权值和阈值进行训练，完成BP神经网络A的最终训练，并记为BP神经网络B。步骤6，将步骤3获得的输入测试集Xtest和输出测试集Ytest加入到步骤5训练好的BP神经网络B中进行测试，并实现对锂电池健康状态的预测。2.根据权利要求1所述的一种基于自适应隐藏层BP神经网络的锂电池状况预测方法，其特征在于，所述步骤4建立三层BP神经网络A并进行训练中，训练BP神经网络的目标为10-6，隐层激活函数为poslin，输出层激活函数为purelin，训练函数为trainlm，学习率为0.0001。
说明书desc
技术领域本发明涉及锂电池技术领域，尤其涉及一种基于自适应隐藏层BP神经网络的锂电池状况预测方法，所述锂电池状况为锂电池健康状况。背景技术近年来，锂离子电池技术的高速发展带动着交通工具电气化的飞速发展，电动汽车的普及率在快速提升。目前，为了减少排放温室气体和节约不可再生能源，许多国家出台了相关政策推动电动汽车的发展。电池管理系统是保障锂电池地安全性和可靠性的重要系统，其中最为重要的是电池充电状态估计和健康状况估计。为了保证电池的健康运行，防止电池突然故障而引发一系列本可以避免的灾难，准确的SOH估计是至关重要的。电池的SOH变化可以反映在电池内部的参数的变化上，如容量的减少和欧姆内阻的增加。目前对锂电池的SOH估计方法大致可分为以下2种：1、基于模型的方法，包含基于电化学模型和基于等效电路模型两种方法。基于电化学模型法虽然拥有很高的预测精确度，但是由于其需要考虑到锂电池复杂的老化机理，其模型结构非常复杂难以搭建，并且此类方法计算量大，通常需要结合其他的人工智能算法。基于等效模型方法结构简单易于搭建，但是代价是其存在误差大，精度不高，鲁棒性差等问题。2、数据驱动法，包含机器学习、人工智能算法等，此类方法将锂电池看作一个黑箱模型，从大量的数据中挖掘电池性能演变的规律。但此类方法的需要大量的数据训练，数据的精确程度和算法的结构决定了健康状况估计的正确率，寻找合适的算法和对原始数据的正确处理是数据驱动法估计锂电池 SOH的关键问题。中国发明专利申请文献公开了一种锂电池健康状态预测方法。该方法主要包括：采用一种布谷鸟算法改进的BP神经网络表征电动汽车锂电池的结构特性，针对该数据驱动方法建立电池健康状况预测模型，对电池组的容量参数进行跟踪预测，得到锂电池某一时刻下的容量估计值，将该容量估计值与实际值进行比较，实现对电动汽车锂电池健康状况的预测。虽然布谷鸟搜索网络最优初始值的方法能够有效避免模型陷入局部最优的问题，但是其隐藏层设置为一个定值，当输入训练集数量下降时其精确度会受到一定的影响，存在鲁棒性比较差的特点。发明内容本发明要解决的技术问题为针对现有技术中存在的神经网络结构在训练集数量减少或者电池种类变化的情况下，保持原有结构设置会导致精确度无法达到最佳的问题，提供了一种自适应隐藏层设置的BP神经网络对锂电池健康状况进行预测，具有应用范围广、预测精度高、跟踪性强等优点，同时降低了传统BP神经网络对网络初始结构设置的依赖，有效提高了模型的准确性。为解决发明的技术问题，所采用的技术方案为：基于自适应隐藏层BP神经网络的锂电池状况预测方法，所述锂电池状况为锂电池健康状况，包括以下步骤：步骤1，将锂电池充放电循环n次，并对n次充放电循环中的锂电池进行采样，将采样数据组成锂电池充放电数据集；从该充放电数据集中提取以下与锂电池健康状况相关的锂电池采样参数并记为采样健康参数：n次充放电循环中的采样端电压、n次充放电循环中的采样端电流、n次充放电循环中的采样锂电池温度、n次充放电循环中的采样锂电池充电时间和n次充放电循环中的采样锂电池容量，即得到五组采样健康参数，将五组中的任意一组记为采样健康参数组j，j＝1,2,3,4,5；将n次充放电循环中的任意一次循环记为循环i，i＝1,2,...n；以采样健康参数组j作为列向量，构建健康参数数据矩阵，并记为健康矩阵Hn×5，其表达式如下：其中，Vi为循环i中测得的采样端电压；Ii为循环i中测得的采样端电流； Ti为循环i中测得的采样锂电池温度；ti为循环i中测得的采样锂电池充电时间；Ci为循环i中测得的采样锂电池充电容量。步骤2，对5组列向量进行归一化处理，得到归一化处理后的以下数据：n个归一化处理后的锂电池端电压，并将循环i中的锂电池端电压记为端电压n个归一化处理后的端电流，并将循环i中的端电流记为端电流 n个归一化处理后的锂电池温度，并将循环i中的锂电池温度记为锂电池温度n个归一化处理后的锂电池充电时间，并将循环i中的锂电池充电时间记为锂电池充电时间n个归一化处理后的锂电池充电容量，并将循环i中的锂电池充电容量记为锂电池充电容量将n个端电压n个端电流n个锂电池温度和n个锂电池充电时间组成输入数据集Xn×4，n个锂电池充电容量组成输出数据集Yn×1。步骤3，将输入数据集Xn×4分成两组，依次为输入训练集Xtrain和输入测试集Xtest；将输出数据集Yn×1分为两组，依次为输出训练集Ytrain和输出测试集Ytest；其中，两个训练集占原数据集的比例均为给定的预设值γ，γ＝50％～90％；设输出训练集Ytrain中共包括m个数据，并将m个数据中的任意一个记为输出训练值yf，f＝1,2,...,m，m＜n。步骤4，建立三层BP神经网络A并进行训练。步骤4.1，所述三层BP神经网络A的结构包括输入层、隐藏层和输出层；所述输入层包括4个输入层单元，所述输出层仅包括1个输出层单元；输入层和隐藏层之间为全连接，隐藏层和输出层之间为全连接；所述隐藏层单元数由经验公式和自适应调节公式确定，其中经验公式用来估计隐藏层单元数的最大值，所述经验公式为：其中，h为隐藏层单元数，h为整数，r为输入层单元数，s为输出层单元数，a为一个小于等于10的常数，即隐藏层单元数h≤12；步骤4.2，按照每次增加1个单元的方式共设置12个训练隐藏层单元数h’，其中，第1个训练隐藏层单元数h’为1；将12个训练隐藏层单元数h’逐次代入步骤4.1建立的BP神经网络A，即得到12个训练隐藏层，然后进行训练，直至训练隐藏层单元数h’为12时结束；其中一次训练的过程如下：将输入训练集Xtrain输入包括训练隐藏层的BP神经网络A进行训练，得到一个输出预测值的集合其中为输出预测值，输出预测值的集合与输出训练集Ytrain维度保持一致，将输出预测值与输出训练值 yf代入平均绝对值误差公式计算得到训练误差MAE，所述平均绝对值误差公式的表达式为：12次训练结束后，将第12次训练的训练隐藏层单元数h’记为新隐藏层单元数hnew，与新隐藏层单元数hnew对应的训练误差MAE记为新误差MAEnew，将前11个训练误差MAE中的最小值记为最小误差MAEpre，并将与最小误差 MAEpre对应的训练隐藏层单元数h’记为最小误差隐藏层单元数hpre；根据自适应调节公式确定最佳隐藏层单元数hbest，所述自适应调节公式的表达式如下：将最佳隐藏层单元数hbest作为隐藏层单元数代入步骤4.1得到的BP神经网络A，三层BP神经网络A的结构搭建完毕。步骤5，将步骤3获得的输入训练集Xtrain和输出训练集Ytrain加入步骤4建立好的BP神经网络A，对BP神经网络A的权值和阈值进行训练，完成BP 神经网络A的最终训练，并记为BP神经网络B。步骤6，将步骤3获得的输入测试集Xtest和输出测试集Ytest加入到步骤5 训练好的BP神经网络B中进行测试，并实现对锂电池健康状态的预测。优选地，所述步骤4建立三层BP神经网络A并进行训练中，训练BP神经网络的目标为10-6，隐层激活函数为poslin，输出层激活函数为purelin，训练函数为trainlm，学习率为0.0001。本发明基于自适应隐藏层BP神经网络的锂电池状况预测方法，在数据集变化的情形下快速且精确地实现了锂电池SOH预测，其有益效果包括：1、不固定电池地种类和训练网络的数据集数量，能够实时地改变网络地结构以适应训练集的变化。2、加入了充电时间作为输入参数，有效地提升了锂电池SOH预测地精确度。3、降低了计算复杂性，缩短了计算时间，提高了应用的范围，具有精度高和跟踪性强的优点。附图说明图1是本发明基于自适应隐藏层BP神经网络的锂电池状况预测方法中构建的BP神经网络结构图；图2是本发明基于自适应隐藏层BP神经网络的锂电池状况预测方法的流程图；图3是本发明实施例在相同数据集训练下与未进行自适应隐藏层设置的 BP神经网络锂电池状况预测结果对比图。图4是本发明实施例在不同电池数据集训练下与未进行自适应隐藏层设置的BP神经网络锂电池状况预测结果对比图。具体实施方式下面结合附图对本发明的技术方案做进一步的详细说明。本发明基于自适应隐藏层BP神经网络的锂电池状况预测方法，所述锂电池状况为锂电池健康状况，其流程见图2，由该图可见，本发明预测方法的步骤如下：步骤1，将锂电池充放电循环n次，并对n次充放电循环中的锂电池进行采样，将采样数据组成锂电池充放电数据集；从该充放电数据集中提取以下与锂电池健康状况相关的锂电池采样参数并记为采样健康参数：n次充放电循环中的采样端电压、n次充放电循环中的采样端电流、n次充放电循环中的采样锂电池温度、n次充放电循环中的采样锂电池充电时间和n次充放电循环中的采样锂电池容量，即得到五组采样健康参数，将五组中的任意一组记为采样健康参数组j，j＝1,2,3,4,5；将n次充放电循环中的任意一次循环记为循环i，i＝1,2,...n；以采样健康参数组j作为列向量，构建健康参数数据矩阵，并记为健康矩阵Hn×5，其表达式如下：其中，Vi为循环i中测得的采样端电压；Ii为循环i中测得的采样端电流； Ti为循环i中测得的采样锂电池温度；ti为循环i中测得的采样锂电池充电时间；Ci为循环i中测得的采样锂电池充电容量。步骤2，对5组列向量进行归一化处理，得到归一化处理后的以下数据：n个归一化处理后的锂电池端电压，并将循环i中的锂电池端电压记为端电压n个归一化处理后的端电流，并将循环i中的端电流记为端电流 n个归一化处理后的锂电池温度，并将循环i中的锂电池温度记为锂电池温度n个归一化处理后的锂电池充电时间，并将循环i中的锂电池充电时间记为锂电池充电时间n个归一化处理后的锂电池充电容量，并将循环i中的锂电池充电容量记为锂电池充电容量将n个端电压n个端电流n个锂电池温度和n个锂电池充电时间组成输入数据集Xn×4，n个锂电池充电容量组成输出数据集Yn×1。步骤3，将输入数据集Xn×4分成两组，依次为输入训练集Xtrain和输入测试集Xtest；将输出数据集Yn×1分为两组，依次为输出训练集Ytrain和输出测试集Ytest；其中，两个训练集占原数据集的比例均为给定的预设值γ，γ＝50％～90％；设输出训练集Ytrain中共包括m个数据，并将m个数据中的任意一个记为输出训练值yf，f＝1,2,...,m，m＜n。步骤4，建立三层BP神经网络A并进行训练。步骤4.1，所述三层BP神经网络A的结构包括输入层、隐藏层和输出层；所述输入层包括4个输入层单元，所述输出层仅包括1个输出层单元；输入层和隐藏层之间为全连接，隐藏层和输出层之间为全连接；所述隐藏层单元数由经验公式和自适应调节公式确定，其中经验公式用来估计隐藏层单元数的最大值，所述经验公式为：其中，h为隐藏层单元数，h为整数，r为输入层单元数，s为输出层单元数，a为一个小于等于10的常数，即隐藏层单元数h≤12；步骤4.2，按照每次增加1个单元的方式共设置12个训练隐藏层单元数h’，其中，第1个训练隐藏层单元数h’为1；将12个训练隐藏层单元数h’逐次代入步骤4.1建立的BP神经网络A，即得到12个训练隐藏层，然后进行训练，直至训练隐藏层单元数h’为12时结束；其中一次训练的过程如下：将输入训练集Xtrain输入包括训练隐藏层的BP神经网络A进行训练，得到一个输出预测值的集合其中为输出预测值，输出预测值的集合与输出训练集Ytrain维度保持一致，将输出预测值与输出训练值 yf代入平均绝对值误差公式计算得到训练误差MAE，所述平均绝对值误差公式的表达式为：12次训练结束后，将第12次训练的训练隐藏层单元数h’记为新隐藏层单元数hnew，与新隐藏层单元数hnew对应的训练误差MAE记为新误差MAEnew，将前11个训练误差MAE中的最小值记为最小误差MAEpre，并将与最小误差 MAEpre对应的训练隐藏层单元数h’记为最小误差隐藏层单元数hpre；根据自适应调节公式确定最佳隐藏层单元数hbest，所述自适应调节公式的表达式如下：将最佳隐藏层单元数hbest作为隐藏层单元数代入步骤4.1得到的BP神经网络A，三层BP神经网络A的结构搭建完毕。步骤5，将步骤3获得的输入训练集Xtrain和输出训练集Ytrain加入步骤4建立好的BP神经网络A，对BP神经网络A的权值和阈值进行训练，完成BP 神经网络A的最终训练，并记为BP神经网络B。步骤6，将步骤3获得的输入测试集Xtest和输出测试集Ytest加入到步骤5 训练好的BP神经网络B中进行测试，并实现对锂电池健康状态的预测。在本实施例中，所述步骤4建立三层BP神经网络A并进行训练中，训练BP神经网络的目标为10-6，隐层激活函数为poslin，输出层激活函数为 purelin，训练函数为trainlm，学习率为0.0001。为了验证本发明的效果，进行了仿真。图1是按照本发明建立的BP神经网络的结构图。在本实施例中，首先构建了输入层、隐藏层和输出层组成的三层BP神经网络A，输入层和隐藏层之间为全连接，隐藏层和输出层之间为全连接。其中，所述输入层包括4个输入层单元，所述输出层仅包括1个输出层单元，隐藏层单元通过训练和测试得到。在本实施例中使用两个不同的电池数据集进行仿真验证，两个电池数据集记为数据集A和数据集B。图3是本发明实施例仿真结果比较图1。在该仿真中，数据取自数据集A，预设值γ1＝50％，在本实施例中，最佳隐藏层单元数hbest1＝7。该图的横坐标为数据集A充放电循环，纵坐标为数据集A对应充放电循环中的锂电池容量。实际值曲线为根据数据集A原始数据绘制的曲线，自适应BP神经网络曲线为根据本发明预测方法进行训练和测试结果绘制的曲线，神经网络曲线为根据传统BP神经网络训练和测试结果绘制的曲线，所述传统BP神经网络为未进行自适应隐藏层设置的BP神经网络。由图3可以看出，本发明所提出的预测方法得到的锂电池健康状况更贴近于实际值，即精确度更高。图4是本发明实施例仿真结果比较图2。在该仿真中，数据取自数据集B，预设值γ2＝50％，在本实施例中，最佳隐藏层单元数hbest2＝9。该图的横坐标为数据集B充放电循环，纵坐标为数据集B对应充放电循环中的锂电池容量。实际值曲线为根据数据集B原始数据绘制的曲线，自适应BP神经网络曲线为根据本发明预测方法进行训练和测试结果绘制的曲线，BP神经网络曲线为根据传统BP神经网络训练和测试结果绘制的曲线，所述传统BP神经网络为未进行自适应隐藏层设置的BP神经网络。由图4可以看出，本发明所提出的预测方法得到的锂电池健康状况更贴近于实际值，即精确度更高。
