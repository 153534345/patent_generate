标题title
数据巡检方法及装置、介质、SSD设备
摘要abst
本发明涉及一种数据巡检方法及装置、介质、SSD设备，方法包括：在一个巡检周期中，若检测到第一存储单元中的数据发生错误，则进行数据纠错和确定各个存储状态的误判概率；确定第一存储单元中数据的数据特性；若数据特性为冷数据，则判断第一存储单元中数据的驻留时间是否超出驻留时间阈值；若是，则进行状态映射，得到状态映射表，按照状态映射表进行转码；计算在状态映射后对应的比特误码率；判断比特误码率是否大于第一误码率阈值；若是，则采用第一编码方案对转码后的数据进行编码处理，将编码后的数据存储至第二存储单元中，将第一存储单元标记为垃圾回收状态。本发明可以降低比特误码率。
权利要求书clms
1.一种数据巡检方法，其特征在于，包括：在一个巡检周期中，若检测到第一存储单元中的数据发生错误，则对所述第一存储单元中的数据进行纠错处理以及确定所述第一存储单元的各个存储状态的误判概率；确定所述第一存储单元中数据的数据特性；若所述数据特性为冷数据，则判断所述第一存储单元中数据的驻留时间是否超出驻留时间阈值；若是，则根据所述各个存储状态的误判概率进行状态映射，得到状态映射表，并按照所述状态映射表对纠错处理后的数据进行转码，得到转码后的数据；其中，所述状态映射表中包括各个数据状态和各个格雷码之间的映射关系，且数量越多的数据状态与误判概率越低的存储状态所对应的格雷码具有映射关系；根据所述各个存储状态的误判概率，计算在状态映射后对应的比特误码率；判断所述比特误码率是否大于第一误码率阈值；若大于所述第一误码率阈值，则采用第一编码方案对转码后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。2.根据权利要求1所述的方法，其特征在于，所述根据所述各个存储状态的误判概率进行状态映射之前，所述方法还包括：更新所述驻留时间阈值，以使所述驻留时间阈值增大;根据更新后的驻留时间阈值、所述第二存储单元的PE次数和所述第一存储单元在上一个巡检周期中的读取次数，确定对应的误判概率表，从所述对应的误判概率表中获取各个存储状态对应的误判概率；对应的，所述根据所述各个存储状态的误判概率进行状态映射，包括：根据从所述对应的误判概率表中获取的各个存储状态对应的误判概率进行状态映射；对应的，所述根据所述各个存储状态的误判概率，计算在状态映射后对应的比特误码率，包括：根据从所述对应的误判概率表中获取的各个存储状态对应的误判概率，计算在状态映射后对应的比特误码率。3.根据权利要求1或2所述的方法，其特征在于，所述状态映射表为第二状态映射表；对应的，所述根据所述各个存储状态的误判概率进行状态映射，包括：按照数据单元类型将纠错处理后的数据进行分组，得到多个数据组；其中，每一个数据组中包含的比特数和所述数据单元类型相匹配；统计所述多个数据组中每一个数据状态的数量，并将各个数据状态按照数量的第一顺序方向进行排序，得到数据状态序列；将所述各个存储状态按照误判概率的第二顺序方向进行排序，得到存储状态序列；其中，所述存储状态的数量和所述数据状态的数量相等，所述第一顺序方向和所述第二顺序方向相反；将所述数据状态序列中的每一个数据状态和所述存储状态序列中对应位置的存储状态进行一一映射，得到第一状态映射表；获取当前所采用的格雷码映射表；其中，所述格雷码映射表中包括各个存储状态和各个格雷码之间的映射关系；根据所述第一状态映射表和所述格雷码映射表，生成第二状态映射表；其中，所述第二状态映射表中包括各个数据状态和各个格雷码之间的映射关系。4.根据权利要求3所述的方法，其特征在于，所述根据所述各个存储状态的误判概率，计算在状态映射后对应的比特误码率，包括：根据所述多个数据组中各个数据状态的数量、所述各个存储状态的误判概率、所述第一状态映射表以及所述数据单元类型，计算所述比特误码率。5.根据权利要求4所述的方法，其特征在于，采用第一计算式计算所述比特误码率，所述第一计算式包括：RBER = /a式中，RBER为所述比特误码率，Ki为第i个存储状态的误判概率，Ni为第i个存储状态在所述第一状态映射表中对应的数据状态的数量，M为数据状态的数量，a为所述数据单元类型的一个数据单元中的比特数量。6.根据权利要求1所述的方法，其特征在于，还包括：若所述驻留时间未超出所述驻留时间阈值，则采用第一编码方案对纠错处理后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。7.根据权利要求1所述的方法，其特征在于，还包括：若所述比特误码率小于等于所述第一误码率阈值，则采用第二编码方案对纠错处理后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态；其中，所述第二编码方案的码率高于所述第一编码方案的码率。8.根据权利要求7所述的方法，其特征在于，还包括：：若所述数据特性为热数据，则判断所述第一存储单元在存储所述数据时所采用的编码方案是否为第一编码方案；若是，则采用所述第二编码方案对纠错处理后的数据进行编码，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态；其中，所述第二编码方案的码率高于所述第一编码方案的码率。9.根据权利要求8所述的方法，其特征在于，还包括：若所述第一存储单元在存储所述数据时所采用的编码方案为所述第二编码方案，则判断所述第一存储单元在状态映射前的比特误码率是否大于第二误码率阈值；若大于所述第二误码率阈值，则缩短数据巡检周期，采用所述第二编码方案对纠错处理后的数据进行编码，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。10.根据权利要求9所述的方法，其特征在于，还包括：若所述第一存储单元在状态映射前的比特误码率小于等于所述第二误码率阈值，则采用所述第二编码方案对纠错处理后的数据进行编码，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。11.根据权利要求3所述的方法，其特征在于，所述统计所述多个数据组中每一个数据状态的数量，包括：从所述多个数据组中抽样选取预设数量的数据组；统计所述预设数量的数据组中每一个数据状态的数量；将所述预设数量的数据组中每一个数据状态的数量作为所述多个数据组中该数据状态的数量。12.根据权利要求3所述的方法，其特征在于，所述统计所述多个数据组中每一个数据状态的数量之前，所述方法还包括：统计所述纠错处理后的数据中比特1和比特0各自的数量；判断比特1的数量和比特0的数量是否满足预设条件；其中，所述预设条件用于表征比特1和比特0之间的数量差距超过预设差距；若满足所述预设条件，则按照所述数据状态中包含的预设比特值的数量从大到小的顺序将各个数据状态进行排序，得到数据状态序列，并跳转到步骤“将所述各个存储状态按照误判概率的第二顺序方向进行排序”；其中，所述预设比特值为比特1和比特0中数量较多的比特值；若不满足所述预设条件，则执行“统计所述多个数据组中每一个数据状态的数量”的步骤。13.根据权利要求12所述的方法，其特征在于，所述预设条件包括：其中，f为所述纠错处理后的数据中比特1的数量，f为所述纠错处理后的数据中比特0的数量，T为所述预设差距对应的阈值。14.根据权利要求1所述的方法，其特征在于，所述确定所述第一存储单元中数据的数据特性，包括：判断所述第一存储单元的读取次数是否超过预设次数阈值或者所述读取次数和驻留时间的比值是否超过预设比值阈值；若是，则所述第一存储单元中的数据为热数据；否则，所述第一存储单元中的数据为冷数据。15.一种数据巡检装置，其特征在于，包括：数据纠错模块，用于：在一个巡检周期中，若检测到第一存储单元中的数据发生错误，则对所述第一存储单元中的数据进行纠错处理以及确定所述第一存储单元的各个存储状态的误判概率；状态映射模块，用于确定所述第一存储单元中数据的数据特性；若所述数据特性为冷数据，则判断所述第一存储单元中数据的驻留时间是否超出驻留时间阈值；若是，则根据所述各个存储状态的误判概率进行状态映射，得到状态映射表，并按照所述状态映射表对纠错处理后的数据进行转码，得到转码后的数据；其中，所述状态映射表中包括各个数据状态和各个格雷码之间的映射关系，且数量越多的数据状态与误判概率越低的存储状态所对应的格雷码具有映射关系；第一计算模块，用于根据所述各个存储状态的误判概率，计算在状态映射后对应的比特误码率；数据编码模块，用于判断所述比特误码率是否大于第一误码率阈值；若大于所述第一误码率阈值，则采用第一编码方案对转码后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。16.一种计算机可读存储介质，其上存储有计算机程序，其特征在于，该计算机程序被处理器执行时实现如权利要求1-14任一项所述方法的步骤。17.一种SSD设备，其特征在于，包括存储控制器，所述存储控制器包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现如权利要求1-14任一项所述方法的步骤。
说明书desc
技术领域本发明涉及数据存储技术领域，尤其是涉及一种数据巡检方法及装置、介质、SSD设备。背景技术随着全球互联网程度的不断提高，全球对数据存储的需求也日益增大。当前计算机服务器的主流存储器件主要分为两种：机械硬盘和固态硬盘。固态硬盘和机械硬盘都是用于数据存储的硬件，其本质上的区别在于其存储介质不同。传统的机械硬盘以机械磁盘为存储介质，通过磁臂和磁头、磁盘之间的机械构造进行数据存储和读取。而固态硬盘是以NAND闪存作为存储介质，通过存储器内部的电荷数即存储颗粒中的通断电来进行数据的读取和写入，进而实现数据存储。由于机械结构存在的性能瓶颈，当前大多数机械硬盘的读取性能相对于固态硬盘较差。随着固态硬盘小型化、性价比不断提升，越来越多的企业消费者和个人消费者采用固态硬盘进行数据的存储。当前的SSD存储器中往往采用NAND颗粒进行存储，根据NAND颗粒每个存储颗粒可存储的比特数可将NAND颗粒分为SLC、MLC、 TLC、QLC四种类型。NAND颗粒通过电压表示存储状态，受驻留和读干扰的影响，存储电压在存储数据的过程中存在电压漂移，从而导致比特误码率的升高。进一步，NAND颗粒的各个存储状态在上述过程中电压漂移的程度略有差异。以TLC为例，存储状态P7较易受到驻留的影响，存储状态P0/P1较易受到读干扰的影响。因此存储颗粒中的各个存储状态的误判概率差异较大，例如，保留会导致存储状态P7的误判概率远大于其他状态，而读干扰效应会导致存储状态P0/P1的误判概率明显提升。同时，不同存储颗粒厂商的存储颗粒的各个存储状态的误判概率也存在差别。目前，在获取主机的写数据请求时，对原始数据进行编码后直接存储至存储颗粒，存储过程中存储颗粒采用格雷码进行映射。在获取主机的读数据请求时，将存储颗粒中的数据读取出来之后进行解码，然后发给主机。参见图1，一共有8个存储状态P0~P7，例如，从图1中可以看出格雷码011对应存储状态P1,也就是说，当存储电压在V1~V2范围内时，可以认为此时对应的存储状态为P1，存储颗粒就会输出格雷码011。现有技术在存储数据时往往采用固定映射的方式，从而导致某些场景下比特误码率较高，进而造成解码器的计算负荷大、读取数据延迟大。例如，极端情况下，如果数据中大部分为110，按照现有技术会将大量数据存储至存储状态P7。在驻留时间作用下，存储状态P7的误判概率逐渐增大，从而导致比特误码率较高。另一方面，以3D NAND为基础的固态硬盘，其存储的数据可靠性受到写入次数、保持时间、读干扰等因素的影响，当错误累计到一定程度后，会触发数据刷新机制。数据刷新的过程通常包括：数据恢复、数据搬迁和垃圾回收。其中，在数据恢复阶段中存储器控制器从原存储单元中读取数据并通过ECC解码获得正确的数据。数据搬迁阶段，存储器控制器将恢复后的数据重新写入其他存储单元中。垃圾回收阶段，存储器控制器将原存储单元标记为待回收状态或直接擦除后写入其他新数据。目前，在将数据写入其它存储单元时采用的编码方案一般是固定的，由于没有因为具体的情况而灵活变通，因此也会增加比特误码率。发明内容为了解决上述技术问题或者至少部分地解决上述技术问题，本发明提供了一种数据巡检方法及装置、介质、SSD设备。第一方面，本发明实施例提供一种数据巡检方法，包括：在一个巡检周期中，若检测到第一存储单元中的数据发生错误，则对所述第一存储单元中的数据进行纠错处理以及确定所述第一存储单元的各个存储状态的误判概率；确定所述第一存储单元中数据的数据特性；若所述数据特性为冷数据，则判断所述第一存储单元中数据的驻留时间是否超出驻留时间阈值；若是，则根据所述各个存储状态的误判概率进行状态映射，得到状态映射表，并按照所述状态映射表对纠错处理后的数据进行转码，得到转码后的数据；其中，所述状态映射表中包括各个数据状态和各个格雷码之间的映射关系，且数量越多的数据状态与误判概率越低的存储状态所对应的格雷码具有映射关系；根据所述各个存储状态的误判概率，计算在状态映射后对应的比特误码率；判断所述比特误码率是否大于第一误码率阈值；若大于所述第一误码率阈值，则采用第一编码方案对转码后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。第二方面，本发明实施例提供一种数据巡检装置，包括：数据纠错模块，用于：在一个巡检周期中，若检测到第一存储单元中的数据发生错误，则对所述第一存储单元中的数据进行纠错处理以及确定所述第一存储单元的各个存储状态的误判概率；状态映射模块，用于确定所述第一存储单元中数据的数据特性；若所述数据特性为冷数据，则判断所述第一存储单元中数据的驻留时间是否超出驻留时间阈值；若是，则根据所述各个存储状态的误判概率进行状态映射，得到状态映射表，并按照所述状态映射表对纠错处理后的数据进行转码，得到转码后的数据；其中，所述状态映射表中包括各个数据状态和各个格雷码之间的映射关系，且数量越多的数据状态与误判概率越低的存储状态所对应的格雷码具有映射关系；第一计算模块，用于根据所述各个存储状态的误判概率，计算在状态映射后对应的比特误码率；数据编码模块，用于判断所述比特误码率是否大于第一误码率阈值；若大于所述第一误码率阈值，则采用第一编码方案对转码后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。第三方面，本发明实施例提供一种计算机可读存储介质，其上存储有计算机程序，该计算机程序被处理器执行时实现如第一方面提供的所述方法的步骤。第四方面，本发明实施例提供一种SSD设备，包括存储控制器，所述存储控制器包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现如第一方面提供的方法的步骤。本发明实施例提供的数据巡检方法及装置、介质、SSD设备，在每一个巡检周期中，当发现第一存储单元中的数据发生错误时，对第一存储单元中的数据进行纠错处理，同时确定各个存储状态的误判概率，然后确定数据对应的数据特性。当数据特性为冷数据时，若数据的驻留时间超出预设驻留时间阈值，则根据各个存储状态的误判概率进行状态映射，根据得到的状态映射表将数据进行转码。若在状态映射后对应的比特误码率大于第一误码率阈值，则采用第一编码方案对转码后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。也就是说，针对冷数据，如果驻留时间超过驻留时间阈值，说明数据发生错误可能是由于驻留时间过程引起的，此时通过状态映射的方式，将数量较多的数据状态和误判概率较低的存储状态对应的格雷码进行对应，这样可以降低存储过程中的比特误码率。同时如果状态映射后的比特误码率仍高于第一误码率阈值，说明误码率还是较高，此时采用纠错能力较强的编码方案对转码后的数据进行编码，因为纠错能力较强，因此使得数据的存放时间更少，减少数据巡检的次数。附图说明此处的附图被并入说明书中并构成本说明书的一部分，示出了符合本发明的实施例，并与说明书一起用于解释本发明的原理。为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，对于本领域普通技术人员而言，在不付出创造性劳动性的前提下，还可以根据这些附图获得其他的附图。图1为本发明一个实施例中存储状态、格雷码、存储电压之间的映射示意图；图2为本发明一个实施例中数据巡检方法的流程示意图；图3为本发明一个实施例中数据巡检方法的流程示意图；图4是本发明一个实施例中各个存储状态的误判概率的对比示意图；图5是针对不同类型的数据采用本发明实施例和现有技术所产生的比特误码率的对比示意图；图6是本发明一个实施例中状态映射处理装置的结构框图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明的一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。第一方面，本发明实施例提供一种数据巡检方法。参见图2和图3，该方法包括如下步骤S100~S400:S100、在一个巡检周期中，若检测到第一存储单元中的数据发生错误，则对所述第一存储单元中的数据进行纠错处理以及确定所述第一存储单元的各个存储状态的误判概率；可理解的是，本发明实施例提供的方法可以由存储器控制器执行，存储器控制器会周期性的检测第一存储单元中的数据是否发生错误，如果发现错误，可以将第一存储单元中的数据输入到ECC解码器中，ECC便会输出正确的数据，同时ECC解码器还会输出各个存储状态的误判概率。S200、确定所述第一存储单元中数据的数据特性；若所述数据特性为冷数据，则判断所述第一存储单元中数据的驻留时间是否超出驻留时间阈值；若是，则根据所述各个存储状态的误判概率进行状态映射，得到状态映射表，并按照所述状态映射表对纠错处理后的数据进行转码，得到转码后的数据；其中，所述状态映射表中包括各个数据状态和各个格雷码之间的映射关系，且数量越多的数据状态与误判概率越低的存储状态所对应的格雷码具有映射关系；在步骤S200中首先确定数据对应的数据特性，数据特性包括热数据、冷数据。判断方式有多种，例如，通过读取次数进行判断，再例如，通过读取次数和驻留时间的比值进行判断。在具体实施时，S200中所述确定所述第一存储单元中数据的数据特性，可以具体包括：判断所述第一存储单元的读取次数是否超过预设次数阈值或者所述读取次数和驻留时间的比值是否超过预设比值阈值；若是，则所述第一存储单元中的数据为热数据；否则，所述第一存储单元中的数据为冷数据。针对热数据和冷数据需要进行不同的处理，针对热数据需要尽可能的缩短读取延迟，尽可能减少编码时的操作，具体的处理方式会在下文中会详细说明，这里先对冷数据的处理进行说明。针对冷数据，首先判断第一存储单元中的数据的驻留时间是否超出预设驻留时间阈值，如果超出驻留时间阈值，则认为第一存储单元中的数据发生错误是由于驻留时间过长引起的，同时认为该数据有很大概率会存储更长的时间，因此需要尽可能增强ECC纠错能力，故后续在编码时尽可能采用纠错能力较强的编码方案，即第一编码方案。除此之外，还需尽可能降低读取时的比特误码率，具体可以通过重新进行状态映射的方式来降低比特误码率。在驻留时间超出驻留时间阈值时，根据所述各个存储状态的误判概率进行状态映射，得到状态映射表，并按照所述状态映射表对纠错处理后的数据进行转码，得到转码后的数据。由于状态映射表中存储的是数据状态与格雷码之间的映射关系，因此在转码时会将纠错处理后的数据对应的各个数据状态转化为对应的格雷码。同时由于数量越多的数据状态与误判概率越低的存储状态所对应的格雷码具有映射关系，即数据状态的数量越多，对应的存储状态的误判概率越低，也就是说，数量较多的数据状态存储在误判概率较低的存储状态中，这样可以大大减少比特误码率。在具体实施时，可以对上述驻留时间阈值进行更新，具体的，在执行步骤“根据所述各个存储状态的误判概率进行状态映射”之前，本发明实施例提供的方法还可以包括如下步骤：更新所述驻留时间阈值，以使所述驻留时间阈值增大;根据更新后的驻留时间阈值、所述第二存储单元的PE次数和所述第一存储单元在上一个巡检周期中的读取次数，确定对应的误判概率表，从所述对应的误判概率表中获取各个存储状态对应的误判概率；例如，通过步进的方式增加驻留时间阈值。可理解的是，不同档位的驻留时间阈值、PE次数、读取次数对应不同的误判概率表，每一个误判概率表中均包括各个存储状态的误判概率。在更新驻留时间阈值之后，依据更新后的驻留时间阈值、所述第二存储单元的PE次数和所述第一存储单元在上一个巡检周期中的读取次数，查找对应的误判概率表。第二存储单元为数据待存储的存储单元。可理解的是，在更新驻留时间阈值以及重新确定各个存储状态的误判概率的情况下，在S200中进行状态映射时，可以根据从所述对应的误判概率表中获取的各个存储状态对应的误判概率进行状态映射。而且，在S300中计算在状态映射后对应的比特误码率时，可以根据从所述对应的误判概率表中获取的各个存储状态对应的误判概率，计算在状态映射后对应的比特误码率。当然，如果不进行更新驻留时间阈值以及重新确定各个存储状态的误判概率时，直接采用S100中ECC解码器输出的各个存储状态的误判概率进行状态映射即可，同时直接根据S100中输出的各个存储状态的误判概率计算比特误码率即可。可理解的是，如果在所述数据存储在第一存储单元之前已经进行过状态映射，而且各个存储状态的误判概率的大小顺序与本次数据巡检过程中各个存储状态的误判概率的大小顺序不变，可以不进行状态映射操作。在具体实施时，本发明实施例还可以包括：若所述驻留时间未超出所述驻留时间阈值，则采用第一编码方案对纠错处理后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。可理解的是，如果驻留时间小于等于驻留时间阈值，说明数据出现错误并不是由于驻留时间过长引起的，因此不必重新进行状态映射，直接采用纠错能力较强的第一编码方案对纠错处理后的数据进行编码即可。将编码后的数据存储在第二存储单元种，将第一存储单元标记为垃圾回收状态。S300、根据所述各个存储状态的误判概率，计算在状态映射后对应的比特误码率；可理解的是，在状态映射后，各个存储状态和各个数据状态之间具有对应关系，因此可以基于数据状态的分布情况和存储状态的误判概率进行点乘求和，得到比特误码率。在具体实施时，S300可以具体包括：根据所述多个数据组中各个数据状态的数量、所述各个存储状态的误判概率、所述第一状态映射表以及所述数据单元类型，计算所述比特误码率。进一步的，可以采用第一计算式计算所述比特误码率，所述第一计算式包括：RBER = /a式中，RBER为所述比特误码率，Ki为第i个存储状态的误判概率，Ni为第i个存储状态在所述第一状态映射表中对应的数据状态的数量，M为数据状态的数量，a为所述数据单元类型的一个数据单元中的比特数量。举例来说，纠错处理后的数据的各个数据状态的分布为：{110:N1，111:N2，011:N3，101:N4，001:N5，100:N6，010:N7，000:N8}；N1~N8表示这8种数据状态的数量。8种存储状态的误判概率如下：{ P2:K1, P3:K2, P4:K3, P5:K4, P6:K5, P0:K6, P1:K7, P7:K8 }。其中K1-K8表示8个存储状态的误判概率。第一状态映射表为：{110:P2，111:P3，011:P4，101:P5，001:P6，100:P0，010:P1，000:NP7}；计算得到的比特误码率为：RBER = /3；其中，分母3是因为当前采用的TLC的一个存储状态表示3bit值。S400、判断所述比特误码率是否大于第一误码率阈值；若大于所述第一误码率阈值，则采用第一编码方案对转码后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。可理解的是，在进行状态映射后的比特误码率应该是较之前有所降低的，但如果状态重映射之后的比特误码率仍大于第一误码率阈值，说明比特误码率还是比较高的，此时需要采用纠错能力较强的第一编码方案进行编码。当然，如果所述比特误码率小于等于所述第一误码率阈值，说明此时的比特误码率是可以接收到的，因此可以采用第二编码方案对纠错处理后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态；其中，所述第二编码方案的码率高于所述第一编码方案的码率。第一编码方案的码率高于第一编码方案的码率，即第一编码方案的纠错能力要高于第二编码方案的码率。在所述比特误码率小于等于所述第一误码率阈值时，采用纠错能力较弱的第二编码方案进行编码即可。其中，将第一存储单元标记为垃圾回收状态是为了等待存储器控制器对第一存储单元进行擦写操作。在具体实施时，S200还可以包括：若所述数据特性为热数据，则判断所述第一存储单元在存储所述数据时所采用的编码方案是否为第一编码方案；若是，则采用所述第二编码方案对纠错处理后的数据进行编码，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态；其中，所述第二编码方案的码率高于所述第一编码方案的码率。也就是说，如果经过判断为热数据，此时判断第一存储单元在之前存储该数据时采用的编码方案是纠错能力较强的第一编码方案还是纠错能力较弱的第二编码方案。如果是纠错能力较强的第一编码方案，此时需要更换为纠错能力较弱的第二编码方案，然后利用纠错能力交弱的第二编码方案对纠错后的数据进行编码，这样可以减少编码时的操作。除了更换为纠错能力较弱的第二编码方案之外，还可以将数据巡检的周期缩短，因为周期越长，数据发生错误的概率越高。进一步的，S200还可以包括：若所述第一存储单元在存储所述数据时所采用的编码方案为所述第二编码方案，则判断所述第一存储单元在状态映射前的比特误码率是否大于第二误码率阈值；若大于所述第二误码率阈值，则缩短数据巡检周期，采用所述第二编码方案对纠错处理后的数据进行编码，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。也就是说，针对热数据，如果第一存储单元在之前存储该数据时采用的是纠错能力较弱的第二编码方案，此时判断比特误码率是否高于第二误码率阈值。如果大于第二误码率阈值，则比特误码率还是比较高的，此时缩短巡检周期，并采用纠错能力较弱的第二编码方案对纠错处理后的数据进行编码，尽可能的降低发生错误的概率、减少编码时的操作。当然，本发明实施例提供的方法还可以包括：若所述第一存储单元在状态映射前的比特误码率小于等于所述第二误码率阈值，则采用所述第二编码方案对纠错处理后的数据进行编码，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。也就是说，如果比特误码率小于等于所述第二误码率阈值，说明比特误码率是比较低的，在可接受的范围内，仅需要采用纠错能力较弱的第二编码方案进行编码即可，不必缩短数据巡检周期。由于针对热数据，不必进行状态映射，此时的比特误码率为依据当前的各个存储状态的概率和纠错处理后的数据中的各个数据状态的数量计算得到，计算方法可以参见第一计算式。因此为了与S300中的比特误码率进行区分，称之为状态映射前的比特误码率。可见，针对热数据，采用的是纠错能力较弱的第二编码方案进行编码，同时在某些情况下也可以缩短数据巡检周期，减少错误的发生概率。在上文中，有的情况下采用第二编码方案，有的情况下采用的是第一编码方案。第一编码方案相对于第二编码方案增加了几个校验比特，例如，第二编码方案的校验比特为N个，在此基础上增加了M个校验比特，得到第一编码方案的校验比特N+M。当需要将第一编码方案替换为第二编码方案时，将后M个校验比特标记为无效即可。例如，raptor-like编码方案。其中，纠错能力更强的ECC编码矩阵的特征之一是其编码后的码率更低。第一编码方案可以采用一种特殊结构的LDPC。这种码的校验矩阵具有特殊的结构，通常称为raptor-like结构：其中，C为核心矩阵，对应码率为R1的校验矩阵，即第二编码方案的校验矩阵。Z是0矩阵；E是一个稀疏矩阵；I是单位对角阵，行数和E的相等。实际上，E和I组成了一个单奇偶校验码。完整的H对应码率为R2的校验矩阵，即第一编码方案的校验矩阵。使用这种结构的校验矩阵的好处是，当需要采用第二编码方案时不需要重新编码，只要根据E和I就可以获得新增的校验比特，将新增的校验比特标记为无效，这样可以进一步减少编码时间。下面对状态映射的过程进行描述，为了便于区分，将上文中提到的状态映射表称为第二状态映射表。具体的，S200中进行状态映射的过程包括如下步骤S210~S260：S210、按照数据单元类型将纠错处理后的数据进行分组，得到多个数据组；其中，每一个数据组中包含的比特数和所述数据单元类型相匹配；分组之后得到的每一个数据组中包含的比特数和数据单元类型相匹配。由于数据单元类型包括SLC、MLC、TLC、QLC。在SLC类型的一个数据单元中包含一个比特，在MLC类型的一个数据单元中包含2个比特，在TLC类型的一个数据单元中包含3个比特，而在QLC类型的一个数据单元中包含4个比特。可见，所谓的匹配是指一个数据中包含的比特的数量和一个数据单元中包含的比特的数量相等。例如，本发明实施例中存储单元类型为TLC，则将纠错处理后的数据中每3个比特划分为一个数据组，即一个数据组中包含3个比特。在具体实施时，在S210之后，在下文中的S220之前，本发明实施例提供的方法还可以包括如下步骤a1~a4：a1、统计所述纠错处理后的数据中比特1和比特0各自的数量；即，针对纠错处理后的数据，统计比特0的数量和比特1的数量。a2、判断比特1的数量和比特0的数量是否满足预设条件；其中，所述预设条件用于表征比特1和比特0之间的数量差距超过预设差距；可理解的是，如果两个比特值的数量满足预设条件，则说明比特1和比特0的数量有很大的差距，例如，比特1的数量远大于比特0的数量，或者，比特0的数量远大于比特1的数量。在具体实施时，所述预设条件可以包括：其中，f为所述纠错处理后的数据中比特1的数量，f为所述纠错处理后的数据中比特0的数量，T为所述预设差距对应的阈值。a3、若满足所述预设条件，则按照所述数据状态中包含的预设比特值的数量从大到小的顺序将各个数据状态进行排序，得到数据状态序列，并跳转到步骤“将所述各个存储状态按照误判概率的第二顺序方向进行排序”；其中，所述预设比特值为比特1和比特0中数量较多的比特值；a4、若不满足所述预设条件，则执行“统计所述多个数据组中每一个数据状态的数量”的步骤。可理解的是，如果满足预设条件，则存在两种情况，一种是比特1的数量远大于比特0的数量，此时预设比特值为1。一种是比特0的数量远大于比特1的数量，此时预设比特值为0。例如，若满足上述预设条件，且f＞f，将数据状态按照比特值1的数量从多到少进行排序，得到数据状态序列为：{111，110，011，101，001，100，010，000}。再例如，若满足上述预设条件，且f＜f，将数据状态按照比特值0的数量从多到少进行排序，得到的数据状态序列为{000，001，010，100，011，101，110，111}。也就是说，如果满足上述预设条件，则按照数据状态中包含的预设比特值的数量来确定数据状态序列，然后直接跳转到S230中继续执行即可。如果不满足上述预设条件，则需要按照下文中的S220确定数据状态序列。可理解的是，如果两个数据状态中包含的预设比特值的数量是相等的，此时两个数据状态的先后顺序可以随机。可理解的是，在满足预设条件时，按照数据状态中包含的预设比特值的数量来确定数据状态序列的方式可以称之为直接映射法。这种方式可以省去步骤S220中的统计步骤，因此可以减少计算量。同时，在实际中造成比特误码率高的往往是存储状态的误判概率最高的存储状态，即最差的存储状态。因此尽量减少最差的存储状态存储的数据组的数量，使得最优的存储状态存储尽可能多的数据组，这样可以大大降低比特误码率。因此在上述直接映射法中，如果在待处理数据中比特1的数量远大于0时，将包含1最多的数据状态排列在最前面，将包含0最多的数据状态排列在最后面，这样当将数据状态序列和存储状态序列进行一一映射时，包含1最多的数据状态和最优的存储状态对应，包含0最多的数据状态和最差的存储状态对应，这样在数据存储时，由于比特1的数量较多，比特0的数量较少，可以使得数量较少的数据组被存储到较差的存储状态中，数量较多的数据组被存储到较优的存储状态中，进而减少比特误码率。S220、统计所述多个数据组中每一个数据状态的数量，并将各个数据状态按照数量的第一顺序方向进行排序，得到数据状态序列；例如，数据单元类型为TLC，则一共有8个数据状态。数据单元类型为QLC，则一共有16个数据状态。可见，不同的数据单元类型具有不同数量的数据状态。其中，第一顺序方向可以为从大到小，也可以为从小到大。下文中提到的第二顺序方向和第一顺序方向相反，因此当第一顺序方向为从大到小时，第二顺序方向为从小到大。当第一顺序方向为从小到大时，第二顺序方向为从大到小。例如，数据单元类型为TLC，这8种数据状态分别为：110、111、011、101、001、100、101、000。针对各个数据组，统计这8种数据状态的数量，然后按照数量从多到少进行排序，得到上述数据状态序列。例如，将8种数据状态按照数量从多到少的顺序排序后，可以得到的数据状态序列为：{110，111，011，101，001，100，010，000}。在具体实施时，S220中所述统计所述多个数据组中每一个数据状态的数量，可以包括：S221、从所述多个数据组中抽样选取预设数量的数据组；S222、统计所述预设数量的数据组中每一个数据状态的数量；S223、将所所述预设数量的数据组中每一个数据状态的数量作为所述多个数据组中该数据状态的数量。例如，一共有10000个数据组，仅选取其中1000个数据组。针对这1000个数据组，统计各个数据状态各自的数量，以此来代表10000个数据组中各个数据状态各自的数量。可理解的是，在步骤S220中可以对全量数据统计每一个数据状态的数量，也可以采用抽样的方式统计一部分数据中每一个数据状态的数量，然后用这一部分数据中每一个数据状态的数量来代表全量数据中每一个数据状态的数量。S230、将所述各个存储状态按照误判概率的第二顺序方向进行排序，得到存储状态序列；其中，所述存储状态的数量和所述数据状态的数量相等，所述第一顺序方向和所述第二顺序方向相反；其中，针对数据单元类型为TLC的存储颗粒，存储状态也包括8种，例如参见图1中示出的P0~P7。在该步骤中，将各个存储状态按照误判概率的高低进行排序，例如，误判概率越低，存储状态越靠前。例如，排序后得到的存储状态序列为：{ P2, P3, P4, P5, P6, P0,P1, P7 }。S240、将所述数据状态序列中的每一个数据状态和所述存储状态序列中对应位置的存储状态进行一一映射，得到第一状态映射表；例如，数据状态序列为：{110，111，011，101，001，100，010，000}，存储状态序列为：{ P2, P3, P4, P5, P6, P0, P1, P7 }，将两个序列映射之后得到的第一状态映射表为：{110：P2, 111:P3, 011:P4, 101:P5, 001:P6, 100:P0, 010:P1, 000:P7}。S250、获取当前所采用的格雷码映射表；其中，所述格雷码映射表中包括各个存储状态和各个格雷码之间的映射关系；例如，参见图1中的格雷码映射表为：{P7：110, P0 ：111，P1：011,P3: 101,P2：001,P4：100,P6：010,P5：000}。S260、根据所述第一状态映射表和所述格雷码映射表，生成第二状态映射表；其中，所述第二状态映射表中包括各个数据状态和各个格雷码之间的映射关系。例如，第一状态映射表为：{110：P2, 111:P3, 011:P4, 101:P5, 001:P6, 100:P0, 010:P1, 000:P7}，格雷码映射表为：{P7：110, P0 ：111，P1：011,P3: 101,P2：001,P4：100,P6：010,P5：000}，第二状态映射表可以参见下表1：表 数据状态110111011101001100010000存储比特001101100000010111011110通过以上描述，可以针对纠错处理后的数据生成对应的第二状态映射表。其中的第一状态映射表可以用于状态映射后的比特误码率的计算。在状态映射时，首先按照数据单元类型将数据进行分组，得到多个数据组，统计所述多个数据组中每一个数据状态的数量，将各个数据状态按照数量的第一顺序方向进行排序，得到数据状态序列；将存储颗粒的各个存储状态按照误判概率的第二顺序方向进行排序，得到存储状态序列；将所述数据状态序列中的每一个数据状态和所述存储状态序列中对应位置的存储状态进行一一映射，得到第一状态映射表。然后获取所述存储颗粒采用的格雷码映射表，再根据所述第一状态映射表和所述格雷码映射表，生成第二状态映射表。可知在第一状态映射表中，误判概率最低的存储状态和数量最多的数据状态对应，误判概率最高的存储状态和数量最少的数据状态对应，这样可以使得数量较多的数据状态对应的格雷码存储在误判概率较低的存储状态中，数量较少的数据状态对应的格雷码存储在误判概率较高的存储状态中，这样相对于现有技术中固定映射的方式可以降低数据整体的比特误码率，进而可以减轻解码器的纠错负荷，缩短数据读取的延迟等。举例来说，参见图4，为各个存储状态的误判概率，基于图6生成存储状态序列，进而形成第二状态映射表。基于该第二状态映射表进行数据巡检时产生的比特误码率，相对于现有技术中仅通过格雷码映射表进行数据巡检时产生的比特误码率有不同程度的下降。例如，针对图5中12种不同类型的数据进行读写或巡检，发现比特误码率都会下降。本发明实施例提供的方法，在每一个巡检周期中，当发现第一存储单元中的数据发生错误时，对第一存储单元中的数据进行纠错处理，同时确定各个存储状态的误判概率，然后确定数据对应的数据特性。当数据特性为冷数据时，若数据的驻留时间超出预设驻留时间阈值，则根据各个存储状态的误判概率进行状态映射，根据得到的状态映射表将数据进行转码。若在状态映射后对应的比特误码率大于第一误码率阈值，则采用第一编码方案对转码后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。也就是说，针对冷数据，如果驻留时间超过驻留时间阈值，说明数据发生错误可能是由于驻留时间过程引起的，此时通过状态映射的方式，将数量较多的数据状态和误判概率较低的存储状态对应的格雷码进行对应，这样可以降低存储过程中的比特误码率。同时如果状态映射后的比特误码率仍高于第一误码率阈值，说明误码率还是较高，此时采用纠错能力较强的编码方案对转码后的数据进行编码，因为纠错能力较强，因此使得数据的存放时间更少，减少数据巡检的次数。第二方面，本发明实施例提供一种数据巡检装置。参见图6，本装置包括：数据纠错模块，用于：在一个巡检周期中，若检测到第一存储单元中的数据发生错误，则对所述第一存储单元中的数据进行纠错处理以及确定所述第一存储单元的各个存储状态的误判概率；状态映射模块，用于确定所述第一存储单元中数据的数据特性；若所述数据特性为冷数据，则判断所述第一存储单元中数据的驻留时间是否超出驻留时间阈值；若是，则根据所述各个存储状态的误判概率进行状态映射，得到状态映射表，并按照所述状态映射表对纠错处理后的数据进行转码，得到转码后的数据；其中，所述状态映射表中包括各个数据状态和各个格雷码之间的映射关系，且数量越多的数据状态与误判概率越低的存储状态所对应的格雷码具有映射关系；第一计算模块，用于根据所述各个存储状态的误判概率，计算在状态映射后对应的比特误码率；第一编码模块，用于判断所述比特误码率是否大于第一误码率阈值；若大于所述第一误码率阈值，则采用第一编码方案对转码后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。在一个实施例中，装置还包括：概率更新模块，用于：在所述状态映射模块根据所述各个存储状态的误判概率进行状态映射之前，更新所述驻留时间阈值，以使所述驻留时间阈值增大;根据更新后的驻留时间阈值、所述第二存储单元的PE次数和所述第一存储单元在上一个巡检周期中的读取次数，确定对应的误判概率表，从所述对应的误判概率表中获取各个存储状态对应的误判概率；对应的，所述状态映射模块具体用于：根据从所述对应的误判概率表中获取的各个存储状态对应的误判概率进行状态映射；对应的，所述第一计算模块具体用于：根据从所述对应的误判概率表中获取的各个存储状态对应的误判概率，计算在状态映射后对应的比特误码率。在一个实施例中，所述状态映射表为第二状态映射表；所述状态映射模块包括：数据分组单元，用于按照数据单元类型将纠错处理后的数据进行分组，得到多个数据组；其中，每一个数据组中包含的比特数和所述数据单元类型相匹配；第一排序单元，用于统计所述多个数据组中每一个数据状态的数量，并将各个数据状态按照数量的第一顺序方向进行排序，得到数据状态序列；第二排序单元，用于将所述各个存储状态按照误判概率的第二顺序方向进行排序，得到存储状态序列；其中，所述存储状态的数量和所述数据状态的数量相等，所述第一顺序方向和所述第二顺序方向相反；第一映射单元，用于将所述数据状态序列中的每一个数据状态和所述存储状态序列中对应位置的存储状态进行一一映射，得到第一状态映射表；表格获取单元，用于获取当前所采用的格雷码映射表；其中，所述格雷码映射表中包括各个存储状态和各个格雷码之间的映射关系；第二映射单元，用于根据所述第一状态映射表和所述格雷码映射表，生成第二状态映射表；其中，所述第二状态映射表中包括各个数据状态和各个格雷码之间的映射关系。在一个实施例中，第一计算模块用于：根据所述多个数据组中各个数据状态的数量、所述各个存储状态的误判概率、所述第一状态映射表以及所述数据单元类型，计算所述比特误码率。进一步的，第一计算模块用于：采用第一计算式计算所述比特误码率，所述第一计算式包括：RBER = /a式中，RBER为所述比特误码率，Ki为第i个存储状态的误判概率，Ni为第i个存储状态在所述第一状态映射表中对应的数据状态的数量，M为数据状态的数量，a为所述数据单元类型的一个数据单元中的比特数量。在一个实施例中，装置还包括：第二编码模块，用于：若所述驻留时间未超出所述驻留时间阈值，则采用第一编码方案对纠错处理后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。在一个实施例中，装置还包括：第三编码模块，用于：若所述比特误码率小于等于所述第一误码率阈值，则采用第二编码方案对纠错处理后的数据进行编码处理，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态；其中，所述第二编码方案的码率高于所述第一编码方案的码率。在一个实施例中，装置还包括：第四编码模块，用于：若所述数据特性为热数据，则判断所述第一存储单元在存储所述数据时所采用的编码方案是否为第一编码方案；若是，则采用所述第二编码方案对纠错处理后的数据进行编码，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态；其中，所述第二编码方案的码率高于所述第一编码方案的码率。进一步的，第四编码模块还用于：若所述第一存储单元在存储所述数据时所采用的编码方案为所述第二编码方案，则判断所述第一存储单元在状态映射前的比特误码率是否大于第二误码率阈值；若大于所述第二误码率阈值，则缩短数据巡检周期，采用所述第二编码方案对纠错处理后的数据进行编码，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。进一步的，第四编码模块还用于：若所述第一存储单元在状态映射前的比特误码率小于等于所述第二误码率阈值，则采用所述第二编码方案对纠错处理后的数据进行编码，将编码后的数据存储至第二存储单元中，并将所述第一存储单元标记为垃圾回收状态。在一个实施例中，第一排序单元包括：抽样子单元，用于从所述多个数据组中抽样选取预设数量的数据组；统计子单元，用于统计所述预设数量的数据组中每一个数据状态的数量；确定子单元，用于将所所述预设数量的数据组中每一个数据状态的数量作为所述多个数据组中该数据状态的数量。在一个实施例中，所述装置还包括：直接映射模块，用于在第一排序单元统计所述多个数据组中每一个数据状态的数量之前，统计所述纠错处理后的数据中比特1和比特0各自的数量；判断比特1的数量和比特0的数量是否满足预设条件；其中，所述预设条件用于表征比特1和比特0之间的数量差距超过预设差距； 若满足所述预设条件，则按照所述数据状态中包含的预设比特值的数量从大到小的顺序将各个数据状态进行排序，得到数据状态序列，并跳转到第二排序单元；其中，所述预设比特值为比特1和比特0中数量较多的比特值；若不满足所述预设条件，则执行第一排序单元中的步骤。进一步的，所述预设条件包括：其中，f为所述纠错处理后的数据中比特1的数量，f为所述纠错处理后的数据中比特0的数量，T为所述预设差距对应的阈值。在一个实施例中，状态映射模块具体用于：判断所述第一存储单元的读取次数是否超过预设次数阈值或者所述读取次数和驻留时间的比值是否超过预设比值阈值；若是，则所述第一存储单元中的数据为热数据；否则，所述第一存储单元中的数据为冷数据。可理解的是，本发明实施例提供的装置中有关内容的解释、具体实施方式、有益效果、举例等内容可以参见第一方面提供的方法中的相应部分，此处不再赘述。第三方面，本发明实施例提供一种计算机可读存储介质，其上存储有计算机程序，该计算机程序被处理器执行时实现第一方面提供的方法的步骤。具体地，可以提供配有存储介质的系统或者装置，在该存储介质上存储着实现上述实施例中任一实施例的功能的软件程序代码，且使该系统或者装置的计算机读出并执行存储在存储介质中的程序代码。在这种情况下，从存储介质读取的程序代码本身可实现上述实施例中任何一项实施例的功能，因此程序代码和存储程序代码的存储介质构成了本发明的一部分。此外，应该清楚的是，不仅可以通过执行计算机所读出的程序代码，而且可以通过基于程序代码的指令使计算机上操作的操作系统等来完成部分或者全部的实际操作，从而实现上述实施例中任意一项实施例的功能。此外，可以理解的是，将由存储介质读出的程序代码写到插入计算机内的扩展板中所设置的存储器中或者写到与计算机相连接的扩展模块中设置的存储器中，随后基于程序代码的指令使安装在扩展板或者扩展模块上的CPU等来执行部分和全部实际操作，从而实现上述实施例中任一实施例的功能。可理解的是，本发明实施例提供的计算机可读介质中有关内容的解释、具体实施方式、有益效果、举例等内容可以参见第一方面提供的方法中的相应部分，此处不再赘述。第四方面，本发明实施例提供一种SSD设备，SSD设备包括存储控制器，所述存储控制器包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现第一方面提供的方法的步骤。可理解的是，本发明实施例提供的SSD设备中有关内容的解释、具体实施方式、有益效果、举例等内容可以参见第一方面提供的方法中的相应部分，此处不再赘述。本说明书中的各个实施例均采用递进的方式描述，各个实施例之间相同相似的部分互相参见即可，每个实施例重点说明的都是与其他实施例的不同之处。尤其，对于装置实施例而言，由于其基本相似于方法实施例，所以描述的比较简单，相关之处参见方法实施例的部分说明即可。本领域技术人员应该可以意识到，在上述一个或多个示例中，本发明所描述的功能可以用硬件、软件、挂件或它们的任意组合来实现。当使用软件实现时，可以将这些功能存储在计算机可读介质中或者作为计算机可读介质上的一个或多个指令或代码进行传输。以上所述的具体实施方式，对本发明的目的、技术方案和有益效果进行了进一步详细说明，所应理解的是，以上所述仅为本发明的具体实施方式而已，并不用于限定本发明的保护范围，凡在本发明的技术方案的基础之上，所做的任何修改、等同替换、改进等，均应包括在本发明的保护范围之内。
