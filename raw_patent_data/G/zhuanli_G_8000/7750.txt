标题title
基于图像处理的酒盒缺陷检测方法
摘要abst
本发明涉及图像处理技术领域，具体涉及一种基于图像处理的酒盒缺陷检测方法，该方法对覆膜表面图像进行动态模糊检测，获取存在动态模糊的覆膜表面图像的动态偏移类型和动态偏移方向；基于动态偏移方向获取目标拖影边缘，计算目标拖影边缘上的每个像素点的运动模糊距离，在运动模糊距离的范围内，根据目标拖影边缘上每个像素点与原像素点之间相邻两个像素点的灰度差值，得到模糊核中的每个元素值；结合运动模糊距离、动态偏移方向和元素值，对覆膜表面图像进行图像去模糊，得到清晰覆膜表面图像，进而检测清晰覆膜表面图像中的缺陷区域；通过获取模糊核，使得去模糊结果后得到的图像更加清楚，增强了酒盒纸板的缺陷检测结果的准确性。
权利要求书clms
1.基于图像处理的酒盒缺陷检测方法，其特征在于，该方法包括以下步骤：采集酒盒纸板的覆膜表面图像，对所述覆膜表面图像进行动态模糊检测，当所述覆膜表面图像存在动态模糊时，获取不存在模糊的标准覆膜表面图像，对比标准覆膜表面图像和所述覆膜表面图像获取动态偏移类型，并获取所述动态偏移类型下所述覆膜表面图像的动态偏移方向；基于动态偏移方向获取所述覆膜表面图像的目标拖影边缘，以所述目标拖影边缘上的每个像素点分别为起始点，从起始点开始，分别计算动态偏移方向上相邻两个像素点的灰度差异，对应得到每个起始点的运动模糊距离；在所述运动模糊距离的范围内，根据每个起始点与其对应原像素点之间相邻两个像素点的灰度差值，分别得到模糊核中的每个元素值；将运动偏移方向的反方向作为模糊核的模糊方向、运动模糊距离作为模糊核的最大模糊尺寸，结合所述模糊方向、所述最大模糊尺寸和模糊核中的每个元素值，对所述覆膜表面图像进行图像去模糊，得到清晰覆膜表面图像；对所述清晰覆膜表面图像进行缺陷检测，得到缺陷区域。2.如权利要求1所述的基于图像处理的酒盒缺陷检测方法，其特征在于，所述动态偏移类型的获取方法，包括：基于酒盒纸板在上下左右4个正方向上的边缘，分别获取所述覆膜表面图像和标准覆膜表面图像在4个正方向上的边缘线，分别计算所述覆膜表面图像和标准覆膜表面图像在同一正方向所对应边缘线上每个相同位置对应像素点的灰度值的差值绝对值，当所有像素点的差值绝对值都相等时，确认是平移偏移运动，当差值绝对值不完全相等时，确认是旋转偏移运动。3.如权利要求1所述的基于图像处理的酒盒缺陷检测方法，其特征在于，所述目标拖影边缘的获取方法，包括：获取与动态偏移方向相反的所述覆膜表面图像的最末端边缘线，作为所述目标拖影边缘。4.如权利要求1所述的基于图像处理的酒盒缺陷检测方法，其特征在于，所述运动模糊距离的方法，包括：从起始点开始，将动态偏移方向上两个相邻的像素点作为一组相邻像素点，分别计算每组相邻像素点的灰度差值绝对值，得到灰度差值绝对值的方差；利用以e为底数的指数函数对方差进行归一化处理，得到归一化值，当归一化值大于或等于阈值时，将方差对应的相邻像素点的总组数加一得到所述运动模糊距离。5.如权利要求1所述的基于图像处理的酒盒缺陷检测方法，其特征在于，所述元素值的获取方法，包括：在所述运动模糊距离的范围内，分别将起始点与其对应原像素点之间的两个相邻的像素点作为一组相邻像素点，计算每组相邻像素点的灰度差值绝对值；计算相邻组的灰度差值绝对值的比值，得到平均比值，将平均比值作为所述元素值。
说明书desc
技术领域本发明涉及图像处理技术领域，具体涉及一种基于图像处理的酒盒缺陷检测方法。背景技术在纸质酒盒的生产中，覆膜工艺是提升酒盒美观度、档次感以及增强包装防水性、耐用性的关键工艺，但自动覆膜机在对酒盒纸板上胶、烘道和热压时，会因为覆膜温度、覆膜压力、覆膜速度过高或过低，造成褶皱、气泡、发翘、色泽不均匀等缺陷。现有利用工业CCD视觉检测系统来检测包装盒生产中的外观缺陷问题，但由于相机采集的图像受到图像质量的限制，却往往不能获取准确的缺陷图像，进而无法为覆膜工艺的优化改进提供可靠的数据参考。发明内容为了解决上述技术问题，本发明的目的在于提供一种基于图像处理的酒盒缺陷检测方法，所采用的技术方案具体如下：采集酒盒纸板的覆膜表面图像，对所述覆膜表面图像进行动态模糊检测，当所述覆膜表面图像存在动态模糊时，获取不存在模糊的标准覆膜表面图像，对比标准覆膜表面图像和所述覆膜表面图像获取动态偏移类型，并获取所述动态偏移类型下所述覆膜表面图像的动态偏移方向；基于动态偏移方向获取所述覆膜表面图像的目标拖影边缘，以所述目标拖影边缘上的每个像素点分别为起始点，从起始点开始，分别计算动态偏移方向上相邻两个像素点的灰度差异，对应得到每个起始点的运动模糊距离；在所述运动模糊距离的范围内，根据每个起始点与其对应原像素点之间相邻两个像素点的灰度差值，分别得到模糊核中的每个元素值；将运动偏移方向的反方向作为模糊核的模糊方向、运动模糊距离作为模糊核的最大模糊尺寸，结合所述模糊方向、所述最大模糊尺寸和模糊核中的每个元素值，对所述覆膜表面图像进行图像去模糊，得到清晰覆膜表面图像；对所述清晰覆膜表面图像进行缺陷检测，得到缺陷区域。进一步的，所述动态偏移类型的获取方法，包括：基于酒盒纸板在上下左右4个正方向上的边缘，分别获取所述覆膜表面图像和标准覆膜表面图像在4个正方向上的边缘线，分别计算所述覆膜表面图像和标准覆膜表面图像在同一正方向所对应边缘线上每个相同位置对应像素点的灰度值的差值绝对值，当所有像素点的差值绝对值都相等时，确认是平移偏移运动，当差值绝对值不完全相等时，确认是旋转偏移运动。进一步的，所述目标拖影边缘的获取方法，包括：获取与动态偏移方向相反的所述覆膜表面图像的最末端边缘线，作为所述目标拖影边缘。进一步的，所述运动模糊距离的方法，包括：从起始点开始，将动态偏移方向上两个相邻的像素点作为一组相邻像素点，分别计算每组相邻像素点的灰度差值绝对值，得到灰度差值绝对值的方差；利用以e为底数的指数函数对方差进行归一化处理，得到归一化值，当归一化值大于或等于阈值时，将方差对应的相邻像素点的总组数加一得到所述运动模糊距离。进一步的，所述元素值的获取方法，包括：在所述运动模糊距离的范围内，分别将起始点与其对应原像素点之间的两个相邻的像素点作为一组相邻像素点，计算每组相邻像素点的灰度差值绝对值；计算相邻组的灰度差值绝对值的比值，得到平均比值，将平均比值作为所述元素值。本发明实施例至少具有如下有益效果：本发明通过对酒盒纸板采集的覆膜表面图像进行动态模糊检测，令存在动态模糊的覆膜表面图像与标准覆膜表面图像进行对比，使得覆膜表面图像的动态偏移类型的确认结果更加准确；检测覆膜表面图像的动态偏移方向，确认目标拖影边缘，根据目标拖影边缘上每个像素点与其对应原像素点之间相邻两个像素点的灰度差值确认模糊核的最大模糊尺寸和模糊方向，进而根据目标拖影边缘上每个像素点与其对应原像素点之间的相似性获取模糊核内对应的元素值，以保证相似性越大，元素值越大，结合最大模糊尺寸、模糊方向和模糊核内的所有元素值对覆膜表面图像进行去模糊处理，使得去模糊结果后得到的图像更加清楚，增强了酒盒纸板的缺陷检测结果的准确性。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案和优点，下面将对实施例或现有技术描述中所需要使用的附图作简单的介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其它附图。图1为本发明一个实施例提供的一种基于图像处理的酒盒缺陷检测方法的步骤流程图。具体实施方式为了更进一步阐述本发明为达成预定发明目的所采取的技术手段及功效，以下结合附图及较佳实施例，对依据本发明提出的一种基于图像处理的酒盒缺陷检测方法，其具体实施方式、结构、特征及其功效，详细说明如下。在下述说明中，不同的“一个实施例”或“另一个实施例”指的不一定是同一实施例。此外，一或多个实施例中的特定特征、结构或特点可由任何合适形式组合。除非另有定义，本文所使用的所有的技术和科学术语与属于本发明的技术领域的技术人员通常理解的含义相同。本发明所针对的场景为：将酒盒平铺进行覆膜，覆膜完成后将酒盒通过传送带传至下一道工序，在传送过程中利用CCD视觉检测系统对存在缺陷的酒盒进行剔除。下面结合附图具体的说明本发明所提供的一种基于图像处理的酒盒缺陷检测方法的具体方案。请参阅图1，其示出了本发明一个实施例提供的一种基于图像处理的酒盒缺陷检测方法的步骤流程图，该方法包括以下步骤：步骤S001，采集酒盒纸板的覆膜表面图像，对覆膜表面图像进行动态模糊检测，当覆膜表面图像存在动态模糊时，获取不存在模糊的标准覆膜表面图像，对比标准覆膜表面图像和覆膜表面图像获取动态偏移类型，并获取动态偏移类型下覆膜表面图像的动态偏移方向。具体的，当酒盒纸板在传送带上经过相机下方时，利用CCD工业相机对酒盒纸板进行表面图像采集，由于自动化生产中的覆膜时间固定，因此传送带上酒盒纸板的间隔也固定，故设置CCD工业相机的拍摄周期，即可获得每个酒盒纸板的覆膜表面图像。其中，CCD工业相机的拍摄周期的获取方法为：将传送带上相邻酒盒纸板的间隔距离与传送带的运行速度之间的比值作为拍摄周期。由于传送带运转时会产生机器振动，因此传送带上的酒盒纸板在图像采集瞬间会由于机器振动而发生偏移；CCD工业相机采用全局曝光，在传送带上的酒盒纸板因为振动偏移相对于CCD工业相机存在相对运动时，曝光时间和运动速度不匹配就会发生运动模糊，造成部分成像结果存在明显的拖影，也即是酒盒纸板的覆膜表面图像会存在图像模糊现象。评价图像模糊的算法很多，最常用的检测图像模糊的算法是直接调用拉普拉斯算子检测图像的边缘。拉普拉斯算子突出显示图像中包含快速梯度变化的区域，让图像的单一通道和一个3*3的内核进行卷积，然后取卷积结果的方差，如果方差很低，这表明图像中几乎没有边缘，而图像越模糊，边缘就越少。因此利用拉普拉斯算子检测覆膜表面图像是否是模糊图像，当覆膜表面图像是模糊图像时，确认酒盒纸板在图像采集时发生了运动偏移，导致覆膜表面图像出现了动态模糊，反之，不存在动态模糊。需要说明的是，拉普拉斯算子为公知技术，本方案不再赘述。当确认酒盒纸板的覆膜表面图像存在动态模糊时，获取不存在模糊的标准覆膜表面图像，对比标准覆膜表面图像和覆膜表面图像获取动态偏移类型。由于传送带的振动是瞬间发生的，而不是持续振动，因此酒盒纸板在相机的曝光瞬间，由于振动只会产生单次位移，瞬间振动不可能产生多次位移，也即不会来回摆动，但位移方向随机，且有可能整体平移，也有可能局部位移，将局部位移看作旋转运动。相机曝光时间内发生传送带振动，酒盒纸板从原始位置偏移到另一位置，而产生的拖影最末端的边缘应在酒盒纸板的原始位置。若酒盒发生的是平移偏移运动，酒盒纸板所在原始位置的每个原像素点应与当前拖影末端对应位置的边缘像素点之间的灰度变化差异均相同；若发生旋转偏移运动，则原始位置的每个原像素点与当前拖影末端对应位置的边缘像素点之间灰度变化差异各不相同。由于自动化流水线上的酒盒纸板在覆膜时，其摆放位置已经经过调正，所以覆膜结束后在传送带上的位置也几乎固定且摆放位置方正，故获取标准位置对应的标准覆膜表面图像，也即是不存在运动模糊的覆膜表面图像。考虑到酒盒纸板接近矩形，因此获取酒盒纸板在四个正方向上的边缘，也即是上下左右4个正方向，通过对比边缘确认动态偏移类型：首先分别获取覆膜表面图像和标准覆膜表面图像在4个正方向上的边缘线，分别计算覆膜表面图像和标准覆膜表面图像在同一正方向所对应边缘线上每个相同位置对应像素点的灰度值的差值绝对值，当所有的差值绝对值都相等时，确认酒盒纸板发生的是平移偏移运动，当差值绝对值不完全相等时，则发生的是旋转偏移运动，其中，旋转偏移运动是指酒盒纸板是以小于90度的偏移角度进行旋转运动的。在确认了覆膜表面图像的动态偏移类型后，获取该动态偏移类型下的动态偏移方向。现有技术中提取运动模糊图像的运动方向的方法有很多，如对运动模糊图像进行方向性的高通滤波，也即是方向微分，当滤波方向为运动模糊方向时，由于此方向下运动模糊图像对应的高频成分最少，高通滤波使运动模糊图像的能量损失最大，得到的微分图像的灰度值绝对值之和必然最小，所以方向微分得到的灰度值绝对值之和中的最小值所对应的方向即为运动模糊图像方向，则获取覆膜表面图像的运动模糊图像方向，运动模糊图像方向也即是动态偏移方向。需要说明的是，获取运动模糊图像的运动模糊方向的方法为公知技术，本方案中不再赘述。步骤S002，基于动态偏移方向获取覆膜表面图像的目标拖影边缘，以目标拖影边缘上的每个像素点分别为起始点，从起始点开始，分别计算动态偏移方向上相邻两个像素点的灰度差异，对应得到每个起始点的运动模糊距离；在运动模糊距离的范围内，根据每个起始点与其对应原像素点之间每两个相邻像素点的灰度差值，分别得到模糊核中的每个元素值。具体的，本发明认为在模糊图像中，每个发生相对运动的像素点与其运动拖影像素点相似，该相似大小与运动模糊距离有关，若运动模糊距离越大，则原像素点与其对应拖影像素点的相似度越低，运动模糊距离越近，则相似度越高；且运动模糊距离对缺陷的检测结果有直接的影响关系，运动模糊距离越大，在模糊图像上直接提取的缺陷大小就会越大，越偏离真实值，因此需要得到动态模糊的运动模糊距离，用于后续推理模糊核结构，得到效果较好的去模糊处理结果，以帮助分割真实的酒盒缺陷特征。运动模糊方向与酒盒的偏移方向相反，因此根据覆膜表面图像的动态偏移方向，获取与动态偏移方向相反的覆膜表面图像的最末端边缘线，作为目标拖影边缘。动态模糊是相对运动产生的位置信息混叠，该混叠方向与运动模糊方向相反，酒盒纸板原位置的拖影像素点，与其所属列或行的像素点之间存在灰度连续均匀变化的特性，沿着动态偏移方向分析相邻像素点的灰度差异，计算数学期望，进而逐列或逐行推出最大列宽范围或最大行宽范围，也即是运动模糊距离。以目标拖影边缘上的每个像素点分别为起始点，从起始点开始，分别计算动态偏移方向上相邻两个像素点的灰度差异，对应得到每个起始点的运动模糊距离，其中以一个起始点为例，则起始点的运动模糊距离的计算公式为：其中，代表覆膜表面图像中像素点的坐标；I代表灰度值，代表从起始点开始，沿着动态偏移方向上第s组相邻像素点的灰度差值绝对值，一组为两个相邻的像素点；代表坐标为的像素点z的灰度值；代表坐标为的像素点的灰度值；代表向着动态偏移方向相邻一个像素单位距离；代表运动模糊距离；代表起始点对应动态偏移方向上相邻像素点的组数；代表自然数；代表灰度差值绝对值的均值。是指根据每组的灰度差值绝对值计算灰度差值绝对值的方差，方差越小，表示沿着动态偏移方向上的任意一组相邻像素点叠加的模糊灰度值都相似；利用以e为底数的指数函数对方差进行归一化处理，方便对比和度量，方差越小，指数越大，当方差为0时，为1；当指数函数时，代表动态偏移方向上相邻像素点仍具有相似性，仍未脱离运动模糊距离；而当方差变大，指数函数时，则代表起始点对应的像素点已经运动至最大模糊距离。代表运动模糊距离，在保证，即方差极小的前提下，取的符合方差要求的最后一组相邻像素点的组序号N，也即是相邻像素点的总组数，令最后一组的组序号加一得到运动模糊距离。需要说明的是，0.8是本方案中设定的经验阈值，可自行调整。利用上述运动模糊距离的计算公式获取目标拖影边缘上每个像素点的运动模糊距离D，也即是模糊核对于每个像素点进行去模糊时的最大运动长度。需要说明的是，在平移偏移运动下，目标拖影边缘上每个像素点的运动模糊距离D是相同的；而在旋转偏移运动下，目标拖影边缘上每个像素点的运动模糊距离D是不同的。模糊图像的去模糊方法通常是利用一个模糊核与原图像进行卷积，得到的图像即为清晰图像。而模糊核对原图像进行卷积计算时，模糊核中的元素值相当于原图像中像素点的加权值，因此在运动模糊距离的范围内，根据目标拖影边缘上每个像素点与其对应原像素点之间每两个相邻像素点的灰度差值，分别得到模糊核中的每个元素值。目标拖影边缘上的像素点越趋近于原像素点，则该像素点与原像素点的相似性越高，也即动态去模糊过程中模糊核在图像上滑动时，偏向原图像这一侧的模糊核内的元素值越大，也即权重越高。由于模糊核内的元素值也即是对原图像进行卷积时的加权系数，因此目标拖影边缘上的像素点越趋近于原像素点，与原像素点的相似性越高，故以目标拖影边缘上的一个像素点为例，获取该像素点在运动模糊距离的范围内对应模糊核中的元素值，则元素值的计算公式为：其中，为模糊核内的元素值；为运动模糊距离范围内相邻像素点的总组数。为第s组相邻像素点的灰度差值绝对值与运动模糊距离范围内第s+1组相邻像素点的灰度差值绝对值的比值，而表示对运动模糊距离范围内所有相邻组的比值进行平均比值的获取，也即是，则其代表每偏移一个像素单位时的灰度变化的幅度比例，比值越大，幅度比例越大。需要说明的是，灰度变化体现的是与原像素点的相似性，那么灰度变化的幅度与模糊核内的元素值同样相关，模糊核内的元素值越大，则代表卷积时，该元素值所对应的像素点对卷积结果的影响越大，且该元素值所对应的像素点在模糊核内为偏向原像素点的一侧，进而卷积结果与原像素点相似性越高，因此元素值为模糊核内由偏向原像素点一侧向着拖影末端方向的元素值均匀递减的递减幅度。利用上述元素值的计算公式，能够得到目标拖影边缘上每个像素点在运动模糊距离的范围内对应模糊核中的元素值，进而得到模糊核中的所有元素值。步骤S003，将运动偏移方向的反方向作为模糊核的模糊方向、运动模糊距离作为模糊核的最大模糊尺寸，结合模糊方向、最大模糊尺寸和模糊核中的每个元素值，对覆膜表面图像进行图像去模糊，得到清晰覆膜表面图像；对清晰覆膜表面图像进行缺陷检测，得到缺陷区域。具体的，根据步骤S001得到的运动偏移方向、步骤S002得到的运动模糊距离和模糊核中的每个元素值，确认模糊核结构，即将运动偏移方向的反方向作为模糊核的模糊方向、运动模糊距离作为模糊核的最大模糊尺寸。基于确认的模糊核结构，利用非盲区卷积对覆膜表面图像进行去模糊操作，得到清晰的覆膜表面图像，也即是清晰覆膜表面图像，然后利用Canny算子检测清晰覆膜表面图像中的缺陷区域。需要说明的是，去模糊后的覆膜表面图像的边缘都变的很清晰，使得Canny算子检测出的缺陷也非常清晰，进而就能够根据清晰的边缘线提取出完整的缺陷区域。综上所述，本发明提供了一种基于图像处理的酒盒缺陷检测方法，该方法对酒盒纸板的覆膜表面图像进行动态模糊检测，通过对比标准覆膜表面图像，获取存在动态模糊的覆膜表面图像的动态偏移类型和动态偏移方向；基于动态偏移方向获取目标拖影边缘，计算目标拖影边缘上的每个像素点的运动模糊距离，在运动模糊距离的范围内，根据目标拖影边缘上每个像素点与原像素点之间相邻两个像素点的灰度差值，得到模糊核中的每个元素值；结合运动模糊距离、动态偏移方向和元素值，对覆膜表面图像进行图像去模糊，得到清晰覆膜表面图像，进而检测清晰覆膜表面图像中的缺陷区域；通过获取模糊核，使得去模糊结果后得到的图像更加清楚，增强了酒盒纸板的缺陷检测结果的准确性。需要说明的是：上述本发明实施例先后顺序仅仅为了描述，不代表实施例的优劣。且上述对本说明书特定实施例进行了描述。另外，在附图中描绘的过程不一定要求示出的特定顺序或者连续顺序才能实现期望的结果。在某些实施方式中，多任务处理和并行处理也是可以的或者可能是有利的。本说明书中的各个实施例均采用递进的方式描述，各个实施例之间相同相似的部分互相参见即可，每个实施例重点说明的都是与其他实施例的不同之处。以上所述仅为本发明的较佳实施例，并不用以限制本发明，凡在本发明的原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
