标题title
一种支持虚拟帧缓冲的LCD控制电路及其控制方法
摘要abst
本发明提供一种支持虚拟帧缓冲的LCD控制电路及其控制方法，该电路包括外部处理器、LCD控制器，LCD控制器包括寄存器访问接口、内存映射接口以及LCD时序控制单元，LCD时序控制单元用于产生LCD屏幕时序信息，LCD时序控制单元的输出连接到外部LCD屏幕的图像寄存器，寄存器访问接口、内存映射接口分别与外部处理器连接，其中，通过寄存器访问接口或内存映射接口，将LCD需要显示的配置信息提供给LCD控制器，LCD控制器根据LCD的配置信息产生控制LCD的时序信号。应用本发明可以解决现有技术中设备功能单一、内存成本大，成本高等问题，从而达到在不增加内存的情况下支持帧缓冲的目的，可以极大的推动低成本、低复杂度的物联网显示节点的发展。
权利要求书clms
1.一种支持虚拟帧缓冲的LCD控制电路，其特征在于，包括：外部处理器、LCD控制器，所述LCD控制器包括寄存器访问接口、内存映射接口、一用于数据传输的LCD时序控制单元，所述LCD时序控制单元用于产生LCD屏幕时序信息，所述LCD时序控制单元的输出连接到外部LCD屏幕的图像寄存器，所述寄存器访问接口、内存映射接口分别与所述外部处理器连接，其中，通过所述寄存器访问接口或内存映射接口，将LCD需要显示的配置信息提供给所述LCD控制器，所述LCD控制器根据LCD的配置信息产生控制LCD的时序信号。2.根据权利要求1所述的LCD控制电路，其特征在于：所述寄存器访问接口用于向所述外部处理器提供通过寄存器访问的方式显示图像；通过所述寄存器访问接口配置、使能虚拟帧缓冲后，所述外部处理器通过虚拟帧缓冲并读写图像数据。3.根据权利要求1所述的LCD控制电路，其特征在于：所述内存映射接口用于将所述LCD控制器控制LCD显示的控制逻辑，转换成虚拟帧缓冲的形式，使得CPU以及运行在CPU上的程序以访问连续内存的形式，进行LCD显示。4.一种支持虚拟帧缓冲的LCD控制电路的控制方法，其特征在于，该LCD控制电路是采用如权利要求1至3任一项所述的一种支持虚拟帧缓冲的LCD控制电路，该方法包括：在虚拟内存空间中分配一块不占用物理内存的区域作为虚拟帧缓冲区，其中，在对虚拟帧缓冲进行读写操作的时候，会被LCD控制器转换成对LCD图形数据的读写操作；配置寄存器的初始化参数，通过寄存器访问接口配置LCD显示的参数信息，并通过LCD时序控制单元控制LCD屏幕完成上述配置；使能虚拟帧缓冲，在虚拟帧缓冲区处接收帧缓冲器访问；根据LCD显示的参数信息，解析对应的总线地址的读写数据；循环向虚拟帧缓冲对应的地址写入图像数据；进行参数配置后，将虚拟帧缓冲转换为LCD时序控制单元所需的时序信号，并将显示数据传输到LCD屏幕中。5.根据权利要求4所述的控制方法，其特征在于：在将显示数据写入到LCD屏幕，进行预测后，以矩形框的形式写入后续的数据，直到地址发生换行为止。6.根据权利要求4所述的控制方法，其特征在于：所述使能虚拟帧缓冲包括：CPU通过所述寄存器访问接口将相应寄存器中的相应位写1，在LCD控制器接收到指令后，通过硬件控制逻辑使能虚拟帧缓冲。7.根据权利要求4所述的控制方法，其特征在于：所述解析对应的总线地址的读写数据，包括：将LCD的显示参数转换成一个长宽信息固定的虚拟帧缓冲，当对该虚拟帧缓冲进行读写操作的时候，由LCD控制器转换成对LCD制定区域的读写操作，进而产生相应的对LCD的控制时序。8.根据权利要求4至7任一项所述的控制方法，其特征在于：在向虚拟帧缓冲写入图像数据的时候，LCD时序控制单元接收LCD屏幕提供的帧同步或行同步信号，在LCD的消隐期刷新图像数据。9.根据权利要求4至7任一项所述的控制方法，其特征在于：在系统资源允许的情况下，提供真实的帧缓冲，通过寄存器访问接口将图像数据从帧缓冲中搬移到LCD图像中。10.根据权利要求4至7任一项所述的控制方法，其特征在于：LCD时序控制单元用于产生控制LCD屏幕的协议时序，该协议时序包括以下：8-bits,9-bits,16-bits,18-bits interface with 8080-series MCU；6-bits,16-bits,18-bits RGB interface；3-pin/4-pin serial interface。
说明书desc
技术领域本发明涉及芯片设计技术领域，具体涉及一种支持虚拟帧缓冲的LCD控制电路以及应用该电路的控制方法。背景技术在嵌入式图形显示领域，普遍以帧缓冲的形式进行显示控制，这样可以减小开发的复杂度，并提升对上层显示框架的兼容性，具体如图1所示。这种显示方式，要求嵌入式设备能提供足够大的内存，以320x320x16-bit的LCD屏幕为例，就需要差不多1MB的内存空间。对于物联网节点设备来说，它们的功能大多比较单一，因而对成本、体积都比较敏感，此时要求内置足够大的内存，是难以接受的。与此同时，大多数的LCD屏幕中，都会内置一个用于缓存图像数据的内存空间，如果MCU的LCD控制器，能够利用该空间，就可以做到在不增加内存的情况下支持帧缓冲，这将极大的推动低成本、低复杂度的物联网显示节点的发展。发明内容为了克服现有技术的不足，本发明的目的在于提供一种支持虚拟帧缓冲的LCD控制电路及其控制方法，该电路和方法可以解决现有技术中设备功能单一、内存成本大，成本高等问题，从而达到在不增加内存的情况下支持帧缓冲的目的，可以极大的推动低成本、低复杂度的物联网显示节点的发展。为解决上述问题，本发明所采用的技术方案如下：一种支持虚拟帧缓冲的LCD控制电路，包括：外部处理器、LCD控制器，所述LCD控制器包括寄存器访问接口、内存映射接口、一用于数据传输的LCD时序控制单元，所述LCD时序控制单元用于产生LCD屏幕时序信息，所述LCD时序控制单元的输出连接到外部LCD屏幕的图像寄存器，所述寄存器访问接口、内存映射接口分别与所述外部处理器连接，其中，通过所述寄存器访问接口或内存映射接口，将LCD需要显示的配置信息提供给所述LCD控制器，所述LCD控制器根据LCD的配置信息产生控制LCD的时序信号。进一步的方案是，所述寄存器访问接口用于向所述外部处理器提供通过寄存器访问的方式显示图像；通过所述寄存器访问接口配置、使能虚拟帧缓冲后，所述外部处理器通过虚拟帧缓冲并读写图像数据。更进一步的方案是，所述内存映射接口用于将所述LCD控制器控制LCD显示的控制逻辑，转换成虚拟帧缓冲的形式，使得CPU以及运行在CPU上的程序以访问连续内存的形式，进行LCD显示。一种支持虚拟帧缓冲的LCD控制电路的控制方法，该LCD控制电路是采用上述的一种支持虚拟帧缓冲的LCD控制电路，该方法包括；在内存中分配一块区域作为虚拟帧缓冲区，并在内存中分配一块区域作为帧缓冲区，其中，在对虚拟帧缓冲进行读写操作的时候，会被LCD控制器转换成对LCD图形数据的读写操作；配置寄存器的初始化参数，通过寄存器访问接口配置LCD显示的参数信息，并通过LCD时序控制单元控制LCD屏幕完成上述配置；使能虚拟帧缓冲，在虚拟帧缓冲区处接收帧缓冲器访问；根据LCD显示的参数信息，解析对应的总线地址的读写数据；循环向虚拟帧缓冲对应的地址写入图像数据；进行参数配置后，将虚拟帧缓冲转换为LCD时序控制单元所需的时序信号，并将显示数据传输到LCD屏幕中。进一步的方案是，在将显示数据写入到LCD屏幕，进行预测后，以矩形框的形式写入后续的数据，直到地址发生换行为止。更进一步的方案是，所述使能虚拟帧缓冲包括：CPU通过所述寄存器访问接口将相应寄存器中的相应位写1，在LCD控制器接收到指令后，通过硬件控制逻辑使能虚拟帧缓冲。更进一步的方案是，所述解析对应的总线地址的读写数据，包括：将LCD的显示参数转换成一个长宽信息固定的虚拟帧缓冲，当对该虚拟帧缓冲进行读写操作的时候，由LCD控制器转换成对LCD制定区域的读写操作，进而产生相应的对LCD的控制时序。更进一步的方案是，在向虚拟帧缓冲写入图像数据的时候，LCD时序控制单元接收LCD屏幕提供的帧同步或行同步信号，在LCD的消隐期刷新图像数据。更进一步的方案是，在系统资源允许的情况下，提供真实的帧缓冲，通过寄存器访问接口将图像数据从帧缓冲中搬移到LCD图像中。更进一步的方案是，LCD时序控制单元用于产生控制LCD屏幕的协议时序，该协议时序包括以下：8-bits,9-bits,16-bits,18-bits interface with 8080-series MCU；6-bits,16-bits,18-bits RGB interface；3-pin/4-pin serial interface。因此，相比现有技术，本发明具有以下有益效果：1、本发明可以产生LCD屏幕所需的时序，并将显示数据传输到LCD屏幕中。2、本发明可以虚拟出一个可以由MCU通过总线访问的存储空间，用于模拟帧缓冲。3、MCU及其上运行的代码，直接使用帧缓冲显示图像数据，在不增加成本的情况下，兼容常规的显示框架。下面结合附图和具体实施方式对本发明作进一步详细说明。附图说明图1是现有技术嵌入式图形显示电路以帧缓冲的形式进行显示控制的原理图。图2是现有技术内置用于缓存图像数据的内存空间的原理图。图3是本发明一种支持虚拟帧缓冲的LCD控制电路实施例的原理图。图4是本发明一种支持虚拟帧缓冲的LCD控制电路的控制方法实施例的流程图。图5是本发明一种支持虚拟帧缓冲的LCD控制电路的控制方法实施例中通过虚拟帧缓冲显示图像的的流程图。具体实施方式一种支持虚拟帧缓冲的LCD控制电路实施例：参见图3，一种支持虚拟帧缓冲的LCD控制电路，包括：外部处理器1、LCD控制器2，LCD控制器2包括寄存器访问接口3、内存映射接口5、一用于数据传输的LCD时序控制单元4，LCD时序控制单元4用于产生LCD屏幕时序信息，LCD时序控制单元4的输出连接到外部LCD屏幕6的图像寄存器GRAM，寄存器访问接口3、内存映射接口5分别与外部处理器1连接，其中，通过寄存器访问接口3或内存映射接口5，将LCD需要显示的配置信息提供给LCD控制器2，LCD控制器2根据LCD的配置信息产生控制LCD的时序信号。在本实施例中，寄存器访问接口3用于向外部处理器1提供通过寄存器访问的方式显示图像；通过寄存器访问接口3配置、使能虚拟帧缓冲后，外部处理器1通过虚拟帧缓冲并读写图像数据。在本实施例中，内存映射接口5用于将LCD控制器2控制LCD显示的控制逻辑，转换成虚拟帧缓冲的形式，使得CPU以及运行在CPU上的程序以访问连续内存的形式，进行LCD显示。其中，寄存器访问接口3是通过CPU中的外设总线，将需要配置的数值写入到设备的寄存器中，设备的硬件逻辑再根据这些写入的值，如使能与否、大小、等等，控制硬件，使其表现为期望的行为。其中，寄存器访问接口3是通过固定大小的寄存器控制设备。内存映射接口5是把设备的内部资源直接以总线的形式，让CPU访问，这样CPU就可以连续访问这些资源，更加高效。其中，通过寄存器访问接口3或内存映射接口5，把LCD需要显示的配置、数据提供给LCD控制器2，LCD控制器2将根据这些信息产生控制LCD的信号。一种支持虚拟帧缓冲的LCD控制电路的控制方法实施例一种支持虚拟帧缓冲的LCD控制电路的控制方法，该LCD控制电路是采用上述的一种支持虚拟帧缓冲的LCD控制电路，如图4和图5所示，该方法包括；首先，执行步骤S1，在虚拟内存空间中分配一块不占用物理内存的区域作为虚拟帧缓冲区，其中，在对虚拟帧缓冲进行读写操作的时候，会被LCD控制器2转换成对LCD图形数据的读写操作。具体的，本实施例的真实帧缓冲对应有实际的物理内存，例如SRAM中的一段存储区域；本实施例的虚拟帧缓冲没有实际的物理内存，对其进行读写操作的时候，会被LCD控制器2转成对LCD图形数据的读写。然后，执行步骤S2，配置寄存器的初始化参数，通过寄存器访问接口3配置LCD显示的参数信息，并通过LCD时序控制单元4控制LCD屏幕6完成上述配置。接着，执行步骤S3，使能虚拟帧缓冲，在虚拟帧缓冲区处接收帧缓冲器访问；根据LCD显示的参数信息，解析对应的总线地址的读写数据；然后，执行步骤S4，循环向虚拟帧缓冲对应的地址写入图像数据；然后，执行步骤S5，在进行参数配置后，将虚拟帧缓冲转换为LCD时序控制单元4所需的时序信号，并将显示数据传输到LCD屏幕6中。其中，由LCD控制器2控制LCD显示有关的参数配置，该参数配置包括此次送显的起始坐标、图像格式等。在将显示数据写入到LCD屏幕6，进行预测后，以矩形框的形式写入后续的数据，直到地址发生换行为止。其中，CPU或软件通过虚拟帧缓冲写入图像数据时，一般都是连续操作，写入一幅图像数据。此时硬件可以默认操作时联系，提前进行地址的增加等预测，直到软件突然改变此次联系的操作，跳到另外的位置重新写入。在本实施例中，使能虚拟帧缓冲包括：CPU通过寄存器访问接口3将相应寄存器中的相应位写1，在LCD控制器2接收到指令后，通过硬件控制逻辑使能虚拟帧缓冲。可见，CPU通过上述的寄存器接口，将相应寄存器中的相应位写1，LCD控制器2硬件接收到指令后，通过硬件的控制逻辑，使能虚拟帧缓冲。在本实施例中，解析对应的总线地址的读写数据，包括：将LCD的显示参数转换成一个长宽信息固定的虚拟帧缓冲，当对该虚拟帧缓冲进行读写操作的时候，由LCD控制器2转换成对LCD制定区域的读写操作，进而产生相应的对LCD的控制时序。可见，LCD的显示参数，包括LCD的大小、像素、图像格式等，这些信息可以转换成一个长宽信息固定的虚拟帧缓冲。当软件对虚拟帧缓冲操作的时候，如向第N字节的位置写入M字节的数据时，硬件可以根据上述方式转换成信息，转换成对LCD制定区域的写入操作，进而产生相应的对LCD的控制时序。在向虚拟帧缓冲写入图像数据的时候，LCD时序控制单元4接收LCD屏幕6提供的帧同步或行同步信号，在LCD的消隐期刷新图像数据。在系统资源允许的情况下，提供真实的帧缓冲，通过寄存器访问接口3将图像数据从帧缓冲中搬移到LCD图像中。在本实施例中，LCD时序控制单元4用于产生控制LCD屏幕6的协议时序，该协议时序包括以下：a)支持如下协议8-bits,9-bits,16-bits,18-bits interface with 8080-series MCU；6-bits,16-bits,18-bits RGB interface；3-pin/4-pin serial interface。b)支持不同的分辨率和显示模式。c)可接收LCD提供的帧同步或行同步信号，并在使用真实缓冲区的情况下，在LCD的消隐期刷新图像数据，避免画面撕裂。在本实施例中，寄存器访问接口3用于向MCU提供通过寄存器访问的方式显示图像，其包括：a)包括LCD显示参数配置、图像数据刷新、等操作。b)可以通过寄存器访问接口3配置虚拟缓冲区的大小、使能与否等。c)如果系统的资源允许，可以提供真实的帧缓冲，可以通过寄存器访问接口3将图像数据从帧缓冲中搬移到LCD屏幕6中。如果通过寄存器访问接口3配置、使能虚拟帧缓冲后，MCU可以通过虚拟帧缓冲，读写图像数据，相关的流程如图5所示。因此，相比现有技术，本发明具有以下有益效果：1、本发明可以产生LCD屏幕6所需的时序，并将显示数据传输到LCD屏幕6中。2、本发明可以虚拟出一个可以由MCU通过总线访问的存储空间，用于模拟帧缓冲。3、MCU及其上运行的代码，直接使用帧缓冲显示图像数据，在不增加成本的情况下，兼容常规的显示框架。上述实施方式仅为本发明的优选实施方式，不能以此来限定本发明保护的范围，本领域的技术人员在本发明的基础上所做的任何非实质性的变化及替换均属于本发明所要求保护的范围。
