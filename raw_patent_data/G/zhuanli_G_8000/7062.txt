标题title
基于时序内容感知注意力机制的视频目标分割方法
摘要abst
本发明公开了一种基于时序内容感知注意力机制的视频目标分割方法，针对全局匹配式注意力机制的巨大计算量的问题，本发明利用时序连贯性假设，通过学习当前帧和过去帧之间的多组光流场，根据光流场的位置映射关系对过去帧进行采样，得到和待匹配特征相关的特征向量。最后在待匹配特征和采样得到的过去帧特征向量之间进行匹配，即是在整个图像的局部进行相似性区域匹配，降低了匹配的计算量，并且相似特征是根据当前帧特征作为参考得到的，不仅运行速度快且由于去除了无关的噪声特征，匹配精度也更高。
权利要求书clms
1.基于时序内容感知注意力机制的视频目标分割方法，包括以下步骤：1)视频目标分割系统训练步骤：1-1)接收训练样本视频以及视频中的每一帧的目标掩码；1-2)将视频中第i帧作为过去帧以及对应的目标掩码沿通道维度拼接后输入至特征提取网络的编码器B，编码器B输出第i帧的特征；1-3)将第i+1帧视作当前帧输入至特征提取网络的编码器A，编码器A输出第i+1帧特征；1-4)将第i+1帧特征和第i帧特征送入时序内容感知的注意力模块，时序内容感知的注意力模块输出第i+1帧的时序内容感知特征；1-5)将第i+1帧的时序内容感知特征输入至解码器，解码器输出第i+1帧的目标掩码；1-6)将第i+1帧和第i+1帧的感兴趣目标掩码沿通道维度拼接后输入至特征提取网络的编码器B，编码器B输出更新后的第i+1帧的特征；1-7)判断是否满足已输出训练样本视频中所有帧的目标掩码或已达到视频目标分割系统中损失函数的收敛条件，如是，则完成对视频目标分割系统的训练，否则，更新i＝i+1，将更新后的第i帧的特征作为视频中第i帧后返回步骤2)；其中，步骤1-4)时序内容感知的注意力模块接收到第i+1帧特征和第i帧特征时的具体处理方式为：先对第i+1帧特征和第i帧特征进行光流预测处理得到当前帧特征和过去帧特征之间的光流场，利用当前帧特征和过去帧特征之间的光流场在第i帧特征中使用双线性插值抽取特征向量；再将抽取的特征向量与第i+1帧特征进行匹配得到第i+1帧的时序内容感知特征；2)视频目标分割系统测试步骤：将待处理视频输入训练完成的视频目标分割系统，视频目标分割系统输出视频中感兴趣目标区域。
说明书desc
技术领域本发明涉及机器学习技术，特别涉及基于机器学习的视频目标分割技术。背景技术视频目标分割是一个计算机视觉中一个基础的任务。视频目标分割任务要求给视频中的每一帧图像上的每一个像素赋予一个标签，也就是将前景对象与背景区域进行二值标记分离，需要用到模式识别，机器学习等领域的知识。视频目标分割对于视频编辑，目标跟踪，场景理解等广泛应用有着十分重要的意义。随着计算机科学技术、深度学习的发展以及现实生活的需要，视频目标分割在近几年吸引了众多研究者的目光，同时取得了很大的研究进展。视频目标分割任务从监督的程度可以分为三大类：无监督式、半监督式以及交互式视频目标分割。无监督式视频目标分割需要寻找并分割视频中的主要目标，这意味着算法需要自行决定哪个物体才是主要的。半监督式视频目标分割任务给出带有掩模信息的第一帧或者关键帧。交互式视频目标分割通过人手工用鼠标描绘出目标的视频分割大致轮廓，第二步再利用视频分割算法进行视频分割。而目前基于注意力机制的视频目标分割算法，在时序特征匹配环节，执行的是全局匹配，即当前帧的特征依次和过去帧所有特征进行匹配，因此具有很大的计算量，导致模型运行速度慢。发明内容本发明所要解决的技术问题是，提供一种基于时序内容感知来调整匹配位置，执行局部匹配的视频目标分割方法。本发明为解决上述技术问题所采用的技术方案是，基基于时序内容感知注意力机制的视频目标分割方法，包括以下步骤：1)视频目标分割系统训练步骤：1-1)接收训练样本视频以及视频中的每一帧的目标掩码；1-2)将视频中第i帧作为过去帧以及对应的目标掩码沿通道维度拼接后输入至特征提取网络的编码器B，编码器B输出第i帧的特征；1-3)将第i+1帧视作当前帧输入至特征提取网络的编码器A，编码器A输出第i+1帧特征；1-4)将第i+1帧特征和第i帧特征送入时序内容感知的注意力模块，时序内容感知的注意力模块输出第i+1帧的时序内容感知特征；1-5)将第i+1帧的时序内容感知特征输入至解码器，解码器输出第i+1帧的目标掩码；1-6)将第i+1帧和第i+1帧的感兴趣目标掩码沿通道维度拼接后输入至特征提取网络的编码器B，编码器B输出更新后的第i+1帧的特征；1-7)判断是否满足已输出训练样本视频中所有帧的目标掩码或已达到视频目标分割系统中损失函数的收敛条件，如是，则完成对视频目标分割系统的训练，否则，更新 i＝i+1，将更新后的第i帧的特征作为视频中第i帧后返回步骤2)；其中，步骤1-4)时序内容感知的注意力模块接收到第i+1帧特征和第i帧特征时的具体处理方式为：先对第i+1帧特征和第i帧特征进行光流预测处理得到当前帧特征和过去帧特征之间的光流场，利用当前帧特征和过去帧特征之间的光流场在第i帧特征中使用双线性插值抽取特征向量；再将抽取的特征向量与第i+1帧特征进行匹配得到第 i+1帧的时序内容感知特征；2)视频目标分割系统测试步骤：将待处理视频输入训练完成的视频目标分割系统，视频目标分割系统输出视频中感兴趣目标区域。针对全局匹配式注意力机制的巨大计算量的问题，去除了时序特征匹配的冗余计算，即当前帧目标特征仅和过去帧中相同目标特征进行匹配，并不和过去帧所有特征进行匹配。本发明利用时序连贯性假设，通过学习当前帧和过去帧之间的多组光流场，根据光流场的位置映射关系对过去帧进行采样，得到和待匹配特征相关的特征向量。最后在待匹配特征和采样得到的过去帧特征向量之间进行匹配，即是在整个图像的局部进行相似性区域匹配，降低了匹配的计算量，并且相似特征是根据当前帧特征作为参考得到的，不仅运行速度快且由于去除了无关的噪声特征，匹配精度也更高。本发明的有益效果是，基于时序内容感知调整匹配位置，执行局部匹配，有效提高了时序特征匹配部分的运行速度，提高了匹配精度。附图说明图1是基于时序内容感知注意力机制的视频目标分割示意图。图2是基于时序内容感知注意力机制模块的具体结构。图3是预测时序特征之间光流场的模块具体结构。具体实施方式要完成发明方法的视频目标分割系统的具体结构如图1所示，包括特征提取网络、时序内容感知注意力模块、解码器。特征提取网络包括针对当前帧的编码器A和针对过去帧的编码器B。视频目标分割系统的整个训练流程是：1)收集视频，并提供视频中的每一帧的目标掩码；2)将第一帧图像视为过去帧以及对应的目标掩码沿通道维度拼接，送入处理编码器B中，得到第一帧的特征；3)将第二帧视作当前帧，即待处理的帧，将其送入处理当前帧的编码器A中，得到第二帧特征；4)将第二帧特征和第一帧特征送入时序内容感知的注意力模块中，得到第二帧的时序内容感知特征，将第二帧的时序内容感知特征送到解码器中，得到第二帧的感兴趣目标掩码；5)将第二帧图像和第二帧的感兴趣目标掩码，沿通道维度拼接，送到处理过去帧的编码器B中，重新获得第二帧的特征；6)将第三帧视作当前帧，将重新获得第二帧的特征作为过去帧，采用步骤2)-5)的方法，得到第三帧的预测目标掩码，并采用步骤5)的方法重新得到第三帧特征过去帧；7)重复步骤6)，直至对视频中所有帧预测目标掩码；并使用Binary CrossEntropy 损失函数收敛，完成对视频目标分割系统的训练。当前帧图像经过编码器A，得到当前帧特征，此时已经有使用编码器B的得到的过去帧特征，将这两个特征沿通道拼接，送到时序内容感知注意力模块中，得到时序特征，接着使用解码器将时序特征映射到输出目标掩码。之后还需要将当前帧图像和目标掩码拼接，经过编码器B，得到新的过去帧特征，用于预测下一帧。所述特征提取网络由两个编码器组成，其中编码器A提取当前帧特征，另一个编码器B提取过去帧以及其预测掩码的过去帧特征。时序内容感知注意力模块的输入是由特征提取网络得到的当前帧特征和过去帧特征，沿通道维度拼接。时序内容感知注意力模块的具体结构如附图2，首先经过光流预测模块，根据光流采集过去帧特征上的和当前帧特征相似的特征，组成相似特征集合。如图3所示，光流预测模块包括2个通道拼接模块C，6个3*3的卷积Conv模块，当前帧特征和过去帧特征经过第一个通道拼接模块后输出至一个3*3Conv，再分为4路经过并行的4个3*3Conv，其中有3个 3*3Conv为空洞卷积，空洞卷积率D分别为2、4、8，并行的4个3*3Conv的输出经过第二个通道拼接模块输出当前帧特征和过去帧特征之间的光流场。之后，利用当前帧特征和过去帧特征之间的光流场在过去帧特征中使用双线性插值抽取特征向量；再将抽取的特征向量与当前帧特征进行匹配得到当前帧的时序内容感知特征。匹配模块进行当前帧特征和相似特征集合之间进行匹配。具体来说，时序内容感知注意力模块依次预测当前帧特征和过去帧特征之间的光流场，得到了每个当前帧特征向量在过去帧特征的位置。由于该位置是小数，因此使用双线性插值抽取出该位置的特征向量。对所有的过去帧特征都执行该操作，得到了当前帧特征在所有过去帧的相似特征集合。相似特征集合的大小远远低于所有的过去帧特征数量，因此使用该特征集合和当前帧进行匹配，降低了匹配的计算量，并且相似特征是根据当前帧特征作为参考得到的，因此该匹配是时序内容感知的自适应局部匹配，不仅运行速度快且没有丢失精度。解码器利用注意力模块输出的时序特征作为输入，输出当前帧的目标预测掩码。特征匹配的过程，待匹配特征先和过去帧的采样特征向量计算点积相似性，然后这些相似性值经过softmax归一化，归一化得到的概率值用于加权对应的被采样特征向量，得到待匹配位置的时序特征。通过对上述每一个待匹配特征执行相同的操作，得到了一个和当前帧特征同样大小的时序特征。时序特征会进入解码器，预测当前帧感兴趣目标的掩码。相似特征集合的大小远远低于所有的过去帧特征数量，因此使用该特征集合和当前帧进行匹配，降低了匹配的计算量，并且相似特征是根据当前帧特征作为参考得到的，因此该匹配是时序内容感知的自适应局部匹配，不仅运行速度快且没有丢失精度。解码器利用注意力模块输出的时序特征作为输入，输出当前帧的目标预测掩码。具体的，特征提取网络中的两个编码器由ResNet50构成，其中编码器B的输入数据具有4个通道。解码器有两个2倍上采样模块堆叠而成，上采样模块由2倍上采样插值层、卷积层、BatchNorm，ReLU层组成。在测试步骤中，将待处理的视频输入至训练完成的视频目标分割系统即可得到视频中感兴趣目标区域。
