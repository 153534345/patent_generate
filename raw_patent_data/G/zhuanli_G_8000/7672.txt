标题title
胶囊接缝图像获取方法、装置、存储介质和计算设备
摘要abst
本申请涉及胶囊检测领域，提供一种胶囊接缝图像获取方法、装置、存储介质和计算设备。该方法包括：获取第一图像分量，所述第一图像分量包括胶囊接缝处的预设通道的图像分量；所述第一图像分量中，胶囊接缝处的所述预设通道的图像分量发生阶跃性变化；根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，其中，所述第二图像分量至少包括增强胶囊接缝特征；对所述第二图像分量进行降噪和补偿，得到目标图像分量，其中，所述目标图像分量包括胶囊接缝处的完整轮廓。通过获取胶囊接缝处发生阶跃性变化的图像分量，能够克服其对比度不高、特征不明显的问题，准确获取其完整轮廓，更加准确检测是否存在插劈缺陷。
权利要求书clms
1.一种胶囊接缝图像获取方法，所述胶囊的胶囊帽和胶囊体的插接处颜色一致，该方法包括：获取第一图像分量，其中，所述第一图像分量包括胶囊接缝处的预设通道的图像分量；所述第一图像分量中，胶囊接缝处的所述预设通道的图像分量发生阶跃性变化；根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，其中，所述第二图像分量至少包括增强胶囊接缝特征；对所述第二图像分量进行降噪和补偿，得到目标图像分量，其中，所述目标图像分量包括所述胶囊接缝处的完整轮廓。2.如权利要求1所述的胶囊接缝图像获取方法，其中，所述预设通道包括亮度通道；所述获取第一图像分量之前，所述方法还包括：获取待检测胶囊图像；根据预设规则从所述待检测胶囊图像中获取第一图像，其中，所述第一图像包括胶囊接缝处的图像，所述预设规则基于多个规格的胶囊参数以及预设检测冗余量确定；将所述第一图像转换至预设颜色模型，获取所述第一图像分量。3.如权利要求2所述的胶囊接缝图像获取方法，其中，所述胶囊参数包括多个规格的胶囊的总长度、胶囊帽长度和胶囊体长度，所述预设检测冗余量包括胶囊接缝处占胶囊总体的比例以及图像采集冗余角度。4.如权利要求1所述的胶囊接缝图像获取方法，其中，根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，包括：根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行求导，并对求导结果取绝对值，得到所述第二图像分量。5.如权利要求4所述的胶囊接缝图像获取方法，其中，采用索贝尔算子与所述第一图像分量进行矩阵计算，以模拟近似所述根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行求导的过程，得到与所述求导结果近似的第二图像分量。6.如权利要求1所述的胶囊接缝图像获取方法，其中，所述对所述第二图像分量进行降噪和补偿包括自适应阈值化处理、全局阈值化处理、滤波处理和形态学处理中的至少一项。7.如权利要求6所述的胶囊接缝图像获取方法，其中，所述对所述第二图像分量进行降噪和补偿，得到目标图像分量，包括：对所述第二图像分量分别进行自适应阈值化处理和全局阈值化处理，并根据自适应阈值化处理结果和全局阈值化处理结果取交集，得到候选目标图像分量；对所述候选目标图像分量进行滤波处理和形态学处理中的至少一项，得到所述目标图像分量；其中，在进行形态学处理时至少包括形态学闭运算。8.一种胶囊接缝图像获取装置，所述胶囊的胶囊帽和胶囊体的插接处颜色一致，该装置包括：获取模块，被配置为获取第一图像分量，其中，所述第一图像分量包括胶囊接缝处的预设通道的图像分量，所述胶囊的胶囊帽和胶囊体的插接处颜色一致；处理模块，被配置为根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，其中，所述第二图像分量至少包括增强胶囊接缝特征；以及对所述第二图像分量进行降噪和补偿，得到目标图像分量，其中，所述目标图像分量包括所述胶囊接缝处的完整轮廓。9.一种计算机可读存储介质，其包括指令，当其在计算机上运行时，使得计算机执行如权利要求1-7中任一项所述的方法。10.一种计算设备，包括存储器，处理器及存储在存储器上并可在处理器上运行的计算机程序，其中，所述处理器执行所述计算机程序时实现如权利要求1-7中任一项所述的方法。
说明书desc
技术领域本申请涉及胶囊检测领域，更具体地涉及一种胶囊接缝图像获取方法、装置、存储介质和计算设备。背景技术目前，针对胶囊的表面缺陷，国内大部分制药厂商都采用人工肉眼观察的方法，找出缺陷的胶囊。这种人工检测的方式不但效率低、成本高，而且由于人自身一些固有因素，使得检测的准确率不能得到可靠保证。因此，有部分厂商开始引入机器视觉检测设备，在胶囊制备的最终环节设置自动外观缺陷检测。机器视觉有着比人工肉眼更高的精度与效率,且胶囊不会受人工检测的二次污染，提高了胶囊的生产效率和生产质量。胶囊缺陷的种类很多，其中插劈缺陷是胶囊生产制备中最常见的缺陷之一。由于胶囊生产制备的工艺是：先将空胶囊的体和帽拔开，填充进药粉后再将体和帽锁合，锁合的过程难免出现偏差，这种偏差导致了插劈缺陷的产生。如果胶囊体和胶囊帽是两种不同颜色，这种缺陷的特征比较明显，即便是人也能一眼就发现；但是如果二者是同一颜色，靠人眼分辨插劈缺陷且跟上流水线的速度成为了不可能，对机器视觉而言也是一大难题。现有的技术在针对胶囊体和胶囊帽是同一颜色的插劈缺陷检测时，采取了两种策略。第一种策略假定插劈缺陷一定会带来胶囊尺寸或形态上的变化，通过检测胶囊的宽度、高度以及形状实现插劈缺陷的筛查。第二种策略假定能够从发生插劈的侧面观察胶囊，且发生插劈的结构完全探出了胶囊区域，此时该胶囊的形态已经与正常胶囊有较大区别，可以较容易的检测出缺陷。然而，因为实际上胶囊本身尺寸就存在±0.5mm的公差，不能断定插劈胶囊一定会带来尺寸上的变化；同时，插劈缺陷也不可能每次都能够从侧面被观察到，发生插劈的结构也存在紧紧贴在胶囊表面的可能性。传统的人工检测的方式，除了使用肉眼观察以外，还借助一种筛板。这种筛板上，分布着很多根据胶囊直径特制的圆孔，其直径通常会比胶囊的标准直径大几十到几百微米。因此，只有与胶囊的标准直径差别不大的胶囊，才能顺利的通过筛板。但是，这种方式需要大量的人工干预，且速度受机械结构限制，效率低下；其准确性也受制于机械加工精度等因素。采用机器视觉的方法，上文已经提到。第一种策略，通过计算胶囊的长度、宽度、外轮廓形状等信息，对尺寸、形状超差的胶囊进行筛除，从而达到插劈胶囊被准确剔除的效果。但是，根据胶囊规格参考标准，胶囊体、胶囊帽以及套合长都存在±0.3~0.5mm偏差范围。在实际生产中，制药厂商允许的偏差范围可能会更大。因此，必须对允许通过的胶囊尺寸，在标准值上下留出一定的余量，否则，有可能会严重影响制药工厂的正常生产。在此基础上，带有插劈缺陷的胶囊，其尺寸有可能仍落在正常的范围以内，那么该胶囊就被判断成为了一个合格胶囊，即——存在漏检风险。第二种策略，基于两个假定。第一个假定是一定能从插劈缺陷的侧面对其进行观察，第二个假定是发生插劈的结构完全探出了胶囊区域。假如对每个胶囊的拍摄次数足够多，那么第一个假定理论上可以被满足，但是这会带来计算量增高的问题。对于第二个假定，插劈缺陷的发生多种多样，最终形态也是千变万化，存在插劈结构完全探出的，也存在完全贴合在胶囊表面上的。可见，第二种策略只能检测到插劈结构完全探出的缺陷胶囊，对另一部分插劈结构完全贴合在胶囊表面上的缺陷胶囊束手无策。发明内容在本上下文中，本申请的实施例期望提供一种胶囊接缝图像获取方法、装置、存储介质和计算设备，通过获取胶囊接缝处的完整轮廓，可以对接缝处的插劈缺陷进行更加准确地检测，使各种类型的胶囊插劈缺陷尽可能多地被检测到，降低漏检的可能性。在本申请的第一方面中，提供了一种胶囊接缝图像获取方法，所述胶囊的胶囊帽和胶囊体的插接处颜色一致，该方法包括：获取第一图像分量，其中，所述第一图像分量包括胶囊接缝处的预设通道的图像分量；所述第一图像分量中，胶囊接缝处的所述预设通道的图像分量发生阶跃性变化；根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，其中，所述第二图像分量至少包括增强胶囊接缝特征；对所述第二图像分量进行降噪和补偿，得到目标图像分量，其中，所述目标图像分量包括所述胶囊接缝处的完整轮廓。在本申请的一个实施例中，所述预设通道包括亮度通道；所述获取第一图像分量之前，所述方法还包括：获取待检测胶囊图像；根据预设规则从所述待检测胶囊图像中获取第一图像，其中，所述第一图像包括胶囊接缝处的图像，所述预设规则基于多个规格的胶囊参数以及预设检测冗余量确定；将所述第一图像转换至预设颜色模型，获取所述第一图像分量。在本申请的一个实施例中，所述胶囊参数包括多个规格的胶囊的总长度、胶囊帽长度和胶囊体长度，所述预设检测冗余量包括胶囊接缝处占胶囊总体的比例以及图像采集冗余角度。在本申请的一个实施例中，根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，包括：根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行求导，并对求导结果取绝对值，得到所述第二图像分量。在本申请的一个实施例中，采用索贝尔算子与所述第一图像分量进行矩阵计算，以模拟近似所述根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行求导的过程，得到与所述求导结果近似的第二图像分量。在本申请的一个实施例中，所述对所述第二图像分量进行降噪和补偿包括自适应阈值化处理、全局阈值化处理、滤波处理和形态学处理中的至少一项。在本申请的一个实施例中，所述对所述第二图像分量进行降噪和补偿，得到目标图像分量，包括：对所述第二图像分量分别进行自适应阈值化处理和全局阈值化处理，并根据自适应阈值化处理结果和全局阈值化处理结果取交集，得到候选目标图像分量；对所述候选目标图像分量进行滤波处理和形态学处理中的至少一项，得到所述目标图像分量；其中，在进行形态学处理时至少包括形态学闭运算。在本申请的第二方面中，提供了一种胶囊接缝图像获取装置，所述胶囊的胶囊帽和胶囊体的插接处颜色一致，该装置包括：获取模块，被配置为获取第一图像分量，其中，所述第一图像分量包括胶囊接缝处的预设通道的图像分量；所述第一图像分量中，胶囊接缝处的所述预设通道的图像分量发生阶跃性变化；处理模块，被配置为根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，其中，所述第二图像分量至少包括增强胶囊接缝特征；以及对所述第二图像分量进行降噪和补偿，得到目标图像分量，其中，所述目标图像分量包括所述胶囊接缝处的完整轮廓。在本申请的第三方面中，提供了计算机可读存储介质，其包括指令，当其在计算机上运行时，使得计算机执行如第一方面所述的方法。在本申请的第四方面中，提供了一种计算设备，包括存储器，处理器及存储在存储器上并可在处理器上运行的计算机程序，其中，所述处理器执行所述计算机程序时实现第一方面所述的方法。根据本申请实施例的胶囊接缝图像获取方法、装置、存储介质和计算设备，能够应用于同色胶囊的缺陷检测，首先获取第一图像分量，其中，所述第一图像分量包括胶囊接缝处的预设通道的图像分量；所述第一图像分量中，胶囊接缝处的所述预设通道的图像分量发生阶跃性变化；然后根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，其中，所述第二图像分量至少包括增强胶囊接缝特征；接下来对所述第二图像分量进行降噪和补偿，得到目标图像分量，其中，所述目标图像分量包括所述胶囊接缝处的完整轮廓。然后可以基于所述目标图像分量进行胶囊缺陷检测。本申请通过获取胶囊接缝处发生阶跃性变化的图像分量，能够更好地克服胶囊接缝处对比度不高、特征不明显的问题，可以较为准确地获取胶囊接缝处的完整轮廓，从而可以基于完整轮廓对胶囊接缝处是否发生插劈缺陷进行更加准确地检测，降低漏检率。附图说明通过参考附图阅读下文的详细描述，本申请示例性实施例的上述以及其他目的、特征和优点将变得易于理解。在附图中，以示例性而非限制性的方式示出了本申请的若干实施例，其中：图1为一个图像采集设备基于待检测胶囊采集到的具有插劈缺陷的胶囊和正常胶囊的原始图像示意图；图2为本申请一实施例的实施胶囊接缝图像获取方法的一种通信系统图；图3为本申请一实施例的胶囊接缝图像获取方法的流程示意图；图4为本申请一实施例的待检测胶囊图像在亮度通道的灰度值变化示意图；图5为本申请一实施例的包括完整胶囊的第一图像分量的示意图；图6为本申请一实施例的仅包括胶囊接缝处的第一图像分量的示意图；图7为图6的灰度值变化示意图；图8为图6经过显著化处理后的示意图；图9为图8经过自适应阈值化处理后的示意图；图10为图8经过全局阈值化处理后的示意图；图11为图9和图10融合后的示意图；图12为图11经过滤波处理后的示意图；图13为图11经过滤波处理后产生分段的示意图；图14为图12经过形态学闭运算后的示意图；图15为本申请一实施例的胶囊接缝图像获取装置的结构示意图；图16为本申请实一实施例的存储介质的示意图；图17为本申请一实施例的计算设备的结构示意图。在附图中，相同或对应的标号表示相同或对应的部分。具体实施方式下面将参考若干示例性实施例来描述本申请的原理和精神。应当理解，给出这些实施例仅仅是为了使本领域技术人员能够更好地理解进而实现本申请，而并非以任何方式限制本申请的范围。相反，提供这些实施例是为了使本申请更加透彻和完整，并且能够将本申请的范围完整地传达给本领域的技术人员。本领域技术人员知道，本申请的实施例可以实现为一种系统、装置、设备、方法或计算机程序产品。因此，本申请可以具体实现为以下形式，即：完全的硬件、完全的软件，或者硬件和软件结合的形式。根据本申请的实施例，提出了一种胶囊接缝图像获取方法、装置、存储介质和计算设备，可应用于胶囊检测系统，该胶囊检测系统可包括图像采集装置和胶囊接缝图像获取装置，图像采集装置和胶囊接缝图像获取装置可以集成部署，也可分离式部署。该图像采集装置至少用于基于待检测胶囊进行图像采集，得到待检测胶囊图像。该胶囊接缝图像获取装置用于对所述待检测胶囊图像进行处理，得到胶囊接缝处的完整轮廓。其中，图像采集装置可为图像采集设备，例如摄像头或扫描仪；胶囊接缝图像获取装置可为对所述待检测胶囊图像进行处理，得到胶囊接缝处的完整轮廓的图像处理程序，所述胶囊接缝图像获取装置还可为部署了图像处理程序的终端设备或服务器。此外，附图中的任何元素数量均用于示例而非限制，以及任何命名都仅用于区分，而不具有任何限制含义。下面参考本申请的若干代表性实施例，详细阐释本申请的原理和精神。发明概述本发明人发现，如果胶囊具有插劈缺陷，那么胶囊帽和胶囊体插接后形成的接缝处的轮廓与正常胶囊不同；参照图1，图1a所示的胶囊存在插劈缺陷，其接缝处的轮廓存在缺失，与正常胶囊的轮廓不同；图1b所示的胶囊不存在缺陷。然而由于同色胶囊的胶囊帽和胶囊体插接处颜色一致，难以准确获取胶囊接缝处的轮廓，从而无法准确进行胶囊插劈缺陷检测。参照图1，图像采集设备直接采集到的胶囊图像中，胶囊帽和胶囊体插接后形成的接缝处难以辨认，即胶囊图像中的胶囊接缝处对比度不高、特征不明显。考虑到，任何彩色图像均是由很多像素组成的，每个像素都是由颜色的组合组成的，更准确地说，就是原色；而且，虽然胶囊帽和胶囊体插接处的颜色一致，然而，两者并不是一体成型的，在空间上存在交叉，即在图像上必定会有与周围不同的表现。由此，本发明人在各个颜色空间、颜色模型对胶囊图像进行了分析，发现在一些通道中，胶囊图像分量中的胶囊接缝处会发生阶跃性变化，即与周围的图像分量表现出明显差异，因此，本申请中根据胶囊接缝处会发生阶跃性变化的胶囊图像分量获取胶囊接缝处的完整轮廓，然后可以基于胶囊接缝处的完整轮廓进行缺陷检测。在介绍了本申请的基本原理之后，下面具体介绍本申请的各种非限制性实施例。应用场景总览一些实施方式中，图像采集装置和胶囊接缝图像获取装置分离式部署，参照图2，本申请实施例提供的胶囊接缝图像获取方法可基于图2所示的一种通信系统实现。该通信系统可以包括图像采集设备01和服务器02。该图像采集设备01可以是摄像头，其可以采集待检测胶囊的图像。该服务器02可以是胶囊接缝图像获取装置，其中可以部署有图像处理程序。服务器02可以从图像采集设备01接收待检测胶囊的图像，然后对所述待检测胶囊图像进行处理，得到胶囊接缝处的完整轮廓。需要说明的是，本申请实施例涉及的服务器可以是独立的物理服务器，也可以是多个物理服务器构成的服务器集群或者分布式系统，还可以是提供云服务、云数据库、云计算、云函数、云存储、网络服务、云通信、中间件服务、域名服务、安全服务、CDN、以及大数据和人工智能平台等基础云计算服务的云服务器。本申请实施例涉及的终端设备，可以是指向用户提供语音和/或数据连通性的设备，具有无线连接功能的手持式设备、或连接到无线调制解调器的其他处理设备。例如移动电话和具有移动终端的计算机，例如，可以是便携式、袖珍式、手持式、计算机内置的或者车载的移动装置，它们与无线接入网交换语音和/或数据。例如，个人通信业务电话、无绳电话、会话发起协议话机、无线本地环路站、个人数字助理等设备。示例性方法下面结合图2的应用场景，参考图3来描述根据本申请示例性实施例的用于获取胶囊接缝图像的方法。需要注意的是，上述应用场景仅是为了便于理解本申请的精神和原理而示出，本申请的实施例在此方面不受任何限制。相反，本申请的实施例可以应用于适用的任何场景。参照图3，图3为本申请提供的一种胶囊接缝图像获取的流程示意图。该方法可由胶囊接缝图像获取装置执行，对待检测胶囊图像进行处理，得到胶囊接缝处的完整轮廓，所述胶囊的胶囊帽和胶囊体的插接处颜色一致。所述胶囊接缝图像获取方法包括：步骤S110，获取第一图像分量。其中，所述第一图像分量包括胶囊接缝处的预设通道的图像分量。根据发明概述部分对本申请技术原理的阐述可知，本申请旨在探寻胶囊接缝处与其周边部位在图像表现上的差异，以便完整提取胶囊接缝处的完整轮廓，从而进行胶囊缺陷检测。本申请的一个实施例中，在获取到待检测胶囊图像之后，可以将所述待检测胶囊转换到各个颜色空间中，然后分别分析待检测胶囊图像在个颜色空间的表现，具体来说，所述颜色空间可以包括RGB颜色空间、XYZ颜色空间、Lab颜色空间和HSV颜色空间。考虑到，本申请实施例意图检测出同色胶囊的胶囊接缝处是否存在插劈缺陷，而同色胶囊的不同部位在很多通道的表现大体上均趋于一致，难以将胶囊接缝处与周边部位区分；然而，虽然胶囊帽和胶囊体插接处的颜色一致，然而，两者并不是一体成型的，在空间上存在交叉，即在图像上必定会有与周围不同的表现，例如存在阴影，由此，胶囊接缝处的亮度通道的图像分量可能与周边部位表现不一致。参照图4，图4为一个待检测胶囊图像在亮度通道的变化图，其中，横坐标为Distance距离，表示胶囊竖直状态下从胶囊顶到胶囊底部的变化，纵坐标为Gray Value灰度值，表示待检测胶囊图像从胶囊顶部到胶囊底部的亮度通道的灰度值变化；可以看出，图4中，距离胶囊顶部5-10像素的中间间距处的灰度值发生了阶跃性变化，根据胶囊的整体形态可知，5-10像素的中间间距处为胶囊接缝处，即胶囊接缝处的亮度通道的图像分量发生了阶跃性变化。由此，在本申请的一个实施例中，所述预设通道可以是亮度通道，获取第一图像分量可以是获取待检测胶囊图像的亮度通道的图像分量。在本申请的一个实施例中，可以将待检测胶囊图像直接转换到HSV颜色空间，然后获取待检测胶囊图像在亮度通道V的图像分量，即所述第一图像分量，参照图5，获取到的第一图像分量还是完整的待检测胶囊。考虑到，待检测胶囊图像是待检测胶囊一个侧面的完整图像，所述侧面是指以类似正视图、左视图、右视图或后视图的视角采集的一面完整胶囊图像，然而实际进行缺陷检测时，只需要基于胶囊接缝处的图像进行检测，其他部位的图像可以不进行任何处理。由此，为了节省计算资源和时间，可以从待检测胶囊图像中获取胶囊接缝处的图像，只对胶囊接缝处的图像进行处理，在本申请的一个实施例中，所述获取第一图像分量之前，所述方法还包括：获取待检测胶囊图像；根据预设规则从所述待检测胶囊图像中获取第一图像，其中，所述第一图像包括胶囊接缝处的图像，所述预设规则基于多个规格的胶囊参数以及预设检测冗余量确定；将所述第一图像转换至预设颜色模型，获取所述第一图像分量。在本申请实施例中，所述预设规则可以是根据多个规格的胶囊参数以及预设检测冗余量确定，所述胶囊参数包括多个规格的胶囊的总长度、胶囊帽长度和胶囊体长度，所述预设检测冗余量包括胶囊接缝处占胶囊总体的比例以及图像采集冗余角度。具体来说，每种型号胶囊的体和帽的尺寸都是固定的，也就是说，每种型号胶囊对应的接缝位置也是相对固定的，由此，可以根据标准规格，确定胶囊接缝处的大致位置，从而获取第一图像。各个型号胶囊的规格如表1所示：根据表1的参数，本申请一个实施例可以估算出每种规格的胶囊的接缝位置。大体上，接缝处的高度占胶囊总高度的十分之一左右，其Y方向的范围在0.4~0.6内波动。考虑到胶囊分多次从不同的角度被拍摄，以拍摄四次为例，即每次拍摄处理。为确保胶囊的所有位置都被检测，可以留出30°的余量，即每次检测处理120°的区域。120°区域投影到平面上的宽度占胶囊总宽度的比例为：；即，每次采集的待检测胶囊图像大致上是完整胶囊沿轴线展开后的0.866，然后可以获取待检测胶囊图像竖直方向上中间位置的十分之一为胶囊接缝处的图像。由此，根据预设规则从所述待检测胶囊图像中获取第一图像，可以获取待检测胶囊图像中胶囊接缝处的图像，从图1所示的取待检测胶囊图像中获取到的胶囊接缝处的图像，然后基于胶囊接缝处的图像获取第一图像分量，第一图像分量仅包括胶囊接缝处在预设通道的图像分量，具体效果可以参照图6。可以理解的是，在本申请的一个实施例中，也可以先基于待检测胶囊图像获取完整胶囊的预设通道的图像分量，然后再获取仅包括胶囊接缝处的第一图像分量。步骤S120，根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，其中，所述第二图像分量至少包括增强胶囊接缝特征。在本申请实施例中，可以继续对仅包括胶囊接缝处的第一图像分量进行分析，参照图7，图7为胶囊接缝处的亮度通道的图像分量的灰度值沿着Y轴的变化情况图中横坐标为15的位置即对应着胶囊接缝处的最中间位置。从图7中可以看出，灰度曲线有着一定的特征。首先其存在着一个局部最小值，即接缝中心所对应的波谷位置，并且，在到达局部最小之前，灰度曲线的变化率较大，换言之，导数较大。因此，在本申请的一个实施例中，为了更加完整、准确且高效地提取出胶囊接缝处的轮廓，可以通过对图像求导，从而显著化接缝位置的特征。具体的，本申请一个实施例中可以只沿Y轴方向对图像进行求导，需要注意的是，对图像求导的计算会产生负数，为方便机器视觉进行观察，本实施例对求导的结果取了绝对值。即在本实施例中，可以根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行求导，并对求导结果取绝对值，得到所述第二图像分量。可以理解的是，虽然本申请实施例以胶囊帽和胶囊体的插接方向为例进行了图像的求导，以显著化第一图像分量，但是本申请并不限于此，例如还可以是胶囊体和胶囊帽的插接方向。本申请的实质是在胶囊的由胶囊帽至胶囊体的方向上对图像求导，即寻找并突出完整胶囊的图像分量阶跃性变化之处的特征。考虑到图像本身实际上是矩阵，为离散信号，难以进行传统意义上的求导，在本申请的一个实施例中使用Sobel算子来得到近似的结果，具体来首，采用索贝尔算子与所述第一图像分量进行矩阵计算，以模拟近似所述根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行求导的过程，得到与所述求导结果近似的第二图像分量。具体结果可以参照图8，从图8中可以看到，接缝区域被显著化，图像中央较亮的条带即为胶囊接缝处被加强后的特征表达，即所述增强胶囊接缝特征。考虑到，尽管胶囊接缝处的特征被加强，但同样的，噪声也相应的被加强。从图8中可以看出，虽然胶囊接缝处看起来更显著，但是整个图像也变得更加嘈杂了。这会一定程度上影响算法的鲁棒性，为解决这一问题，本申请实施例中执行步骤S130，对所述第二图像分量进行降噪和补偿，得到目标图像分量，其中，所述目标图像分量包括所述胶囊接缝处的完整轮廓。具体来说，对所述第二图像分量进行降噪和补偿包括自适应阈值化处理、全局阈值化处理、滤波处理和形态学处理中的至少一项。在本申请的一个实施例中，所述对所述第二图像分量进行降噪和补偿，得到目标图像分量，包括：对所述第二图像分量分别进行自适应阈值化处理和全局阈值化处理，并根据自适应阈值化处理结果和全局阈值化处理结果取交集，得到候选目标图像分量；即本申请实施例中采用两种不同方式的阈值化并将结果融合的方式，进一步加强胶囊接缝处的特征。自适应阈值化处理也称为基于移动平均的可变阈值处理，采用这种方式可以减少光照偏差。所述自适应阈值化处理以Z字形模式逐行执行，令表示步骤k+1扫描序列中遇到的点的灰度，这个新点处的移动平均为式中，n是用于计算平均的点数，m=Z1。使用这种移动移动平均的局部阈值化处理，本申请实施例得到的图像结果如图9所示。在本申请实施例中，未经阈值化处理的图像可以称之为f，f经过自适应阈值化处理之后，可以记为f1。全局阈值化处理从移动平均的计算公式中可以看出，这一过程为完全的自动过程，结果均为自动计算得出，可能无法对各种具体场景进行精细化针对性处理。为保证处理的可控性，本申请的一个实施例中还加入经验控制因素，即全局阈值化处理。对待处理的图像f，设置一个用于分割模式的阈值T，处理后的图像f2为：当T是一个适合于整个图像的常数时，上式中给出的处理称为全局阈值化处理。通过经验确定一个合理的T，本申请实施例得到的图像结果如图10所示。结果融合本申请实施例中使用两种阈值化，分别得到了通过移动平均自动计算得出的自适应阈值化结果，以及全局阈值控制的全局阈值化结果。然后对这两种结果取交集，以将二者融合，得到一个二者互相约束的效果。这一操作可以用按位与操作来完成，即融合之后得到所述候选目标图像分量，融合结果如图11所示。可以看出，融合结果中还是存在一定的椒盐噪声。由此，本申请的一个实施例中还可以选用一合适滤波器对其进行进一步过滤。即，在本申请的一个实施例中，还对所述候选目标图像分量进行滤波处理。经过对比发现，中值滤波器对这种噪声尤其有效。中值滤波器是一种统计排序滤波器，在图像的邻域内对所有像素值进行排序，取其中值为滤波器的输出。当一个邻域内用很多相同的值时，这些值往往会被组合在一起并被取为中值，所以中值滤波器的主要功能是迫使各个点更像它们的邻点。m×m中值滤波器迫使亮于或暗于相邻像素的孤立像素族的值是邻域中这些像素灰度的中值。通过多次应用中值滤波，得到的结果如图12所示。根据图12可见，中值滤波的结果已经趋于完美，但是这种完美可能仅限于大部分情况。当胶囊接缝处的特征十分不明显时，中值滤波有可能破坏接缝的骨架，将其分解为多个小段，如图13所示。出现图13所示的这种情况对提取出胶囊接缝处的完整轮廓会产生不利影响，考虑到胶囊接缝处本身不会是图13所示的多个小段，即并非其本身就是如此模样，由此可以断定其为算法计算导致，因为自然界不存在这么细小的突变，接缝不可能在几十个微米内不存在后又突然出现。为补偿图13所示的这种情况，在本申请的一个实施例中，还对所述候选目标图像分量进行形态学处理中，以得到所述目标图像分量；其中，所述形态学处理在所述滤波处理之后；其中，在进行形态学处理时至少包括形态学闭运算。形态学操作多种多样，包括膨胀、腐蚀、开运算、闭运算等等。其中闭运算可以平滑轮廓，弥合狭窄的断裂和细长的沟壑，消除小孔，并填补轮廓中的缝隙。结构元B对集合A的闭运算定义为A∙B=⊝B上式说，结构元B对集合A的闭运算是：首先B对A膨胀，接着B对膨胀结果腐蚀。可以证明，对一个集合多次进行开运算或闭运算，结果不会变化。由此，本申请的一个实施例中，可以构造一合适的结构元B，例如考虑到胶囊接缝的整体形状为长条状，本申请实施例可以构造矩形结构元B，以更加高效地对图13所示的结果进行闭运算，得到图14所示的目标图像分量。可以理解的是，虽然本申请实施例中以矩形结构元为例构造了结构元B，但并不限于此，本领域的技术人员还可以构造圆形结构元或十字形结构元。根据图14所示的胶囊接缝处的特征可见，胶囊接缝处的完整轮廓清晰、准确，可以被完整的提取出来。在得到包括胶囊接缝处完整轮廓的目标图像分量之后，可以对其轮廓、面积、尺寸等信息进行分析，从而进一步判断有可能存在的缺陷。本申请通过获取胶囊接缝处发生阶跃性变化的图像分量，能够更好地克服胶囊接缝处对比度不高、特征不明显的问题，可以较为准确地获取胶囊接缝处的完整轮廓，从而可以基于完整轮廓对胶囊接缝处是否发生插劈缺陷进行更加准确地检测，降低漏检率。示例性装置在介绍了本申请示例性实施例的方法之后，接下来，参考图15对本申请示例性实施例的胶囊接缝图像获取装置进行介绍，所述胶囊的胶囊帽和胶囊体的插接处颜色一致，该装置30包括：获取模块301，被配置为获取第一图像分量，其中，所述第一图像分量包括胶囊接缝处的预设通道的图像分量，所述胶囊的胶囊帽和胶囊体的插接处颜色一致；处理模块302，被配置为根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，其中，所述第二图像分量至少包括增强胶囊接缝特征；以及对所述第二图像分量进行降噪和补偿，得到目标图像分量，其中，所述目标图像分量包括所述胶囊接缝处的完整轮廓。在本申请的一个实施例中，所述预设通道包括亮度通道；所述获取模块301，还被配置为获取待检测胶囊图像；以及根据预设规则从所述待检测胶囊图像中获取第一图像，其中，所述第一图像包括胶囊接缝处的图像，所述预设规则基于多个规格的胶囊参数以及预设检测冗余量确定；以及将所述第一图像转换至预设颜色模型，获取所述第一图像分量。在本申请的一个实施例中，所述胶囊参数包括多个规格的胶囊的总长度、胶囊帽长度和胶囊体长度，所述预设检测冗余量包括胶囊接缝处占胶囊总体的比例以及图像采集冗余角度。在本申请的一个实施例中，所述处理模块302，还被配置为根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行求导，并对求导结果取绝对值，得到所述第二图像分量。在本申请的一个实施例中，采用索贝尔算子与所述第一图像分量进行矩阵计算，以模拟近似所述根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行求导的过程，得到与所述求导结果近似的第二图像分量。在本申请的一个实施例中，所述对所述第二图像分量进行降噪和补偿包括自适应阈值化处理、全局阈值化处理、滤波处理和形态学处理中的至少一项。在本申请的一个实施例中，所述处理模块302，还被配置为对所述第二图像分量分别进行自适应阈值化处理和全局阈值化处理，并根据自适应阈值化处理结果和全局阈值化处理结果取交集，得到候选目标图像分量；以及对所述候选目标图像分量进行滤波处理和形态学处理中的至少一项，得到所述目标图像分量；其中，在进行形态学处理时至少包括形态学闭运算。本申请通过获取胶囊接缝处发生阶跃性变化的图像分量，能够更好地克服胶囊接缝处对比度不高、特征不明显的问题，可以较为准确地获取胶囊接缝处的完整轮廓，从而可以基于完整轮廓对胶囊接缝处是否发生插劈缺陷进行更加准确地检测，降低漏检率。示例性介质在介绍了本申请示例性实施例的方法和装置之后，接下来，参考图16对本申请示例性实施例的计算机可读存储介质进行说明，其示出的计算机可读存储介质为光盘40，其上存储有计算机程序，所述计算机程序在被处理器运行时，会实现上述方法实施例中所记载的各步骤，例如，获取第一图像分量，其中，所述第一图像分量包括胶囊接缝处的预设通道的图像分量；所述第一图像分量中，胶囊接缝处的所述预设通道的图像分量发生阶跃性变化；根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，其中，所述第二图像分量至少包括增强胶囊接缝特征；对所述第二图像分量进行降噪和补偿，得到目标图像分量，其中，所述目标图像分量包括所述胶囊接缝处的完整轮廓。各步骤的具体实现方式在此不再重复说明。需要说明的是，所述计算机可读存储介质的例子还可以包括，但不限于相变内存、静态随机存取存储器、动态随机存取存储器、其他类型的随机存取存储器、只读存储器、电可擦除可编程只读存储器、快闪记忆体或其他光学、磁性存储介质，在此不再一一赘述。示例性计算设备在介绍了本申请示例性实施例的方法、介质和装置之后，接下来，参参考图17对本申请示例性实施例的用于胶囊接缝图像获取的计算设备进行介绍。图17示出了适于用来实现本申请实施例的示例性计算设备50的框图，该计算设备50可以是计算机系统或服务器。图17显示的计算设备50仅仅是一个示例，不应对本申请实施例的功能和使用范围带来任何限制。如图17所示，计算设备50的组件可以包括但不限于：一个或者多个处理器或者处理单元501，系统存储器502，连接不同系统组件的总线503。计算设备50典型地包括多种计算机系统可读介质。这些介质可以是任何能够被计算设备50访问的可用介质，包括易失性和非易失性介质，可移动的和不可移动的介质。系统存储器502可以包括易失性存储器形式的计算机系统可读介质，例如随机存取存储器5021和/或高速缓存存储器5022。计算设备50可以进一步包括其它可移动/不可移动的、易失性/非易失性计算机系统存储介质。仅作为举例，ROM5023可以用于读写不可移动的、非易失性磁介质。尽管未在图17中示出，可以提供用于对可移动非易失性磁盘读写的磁盘驱动器，以及对可移动非易失性光盘读写的光盘驱动器。在这些情况下，每个驱动器可以通过一个或者多个数据介质接口与总线503相连。系统存储器502中可以包括至少一个程序产品，该程序产品具有一组程序模块，这些程序模块被配置以执行本申请各实施例的功能。具有一组程序模块5024的程序/实用工具5025，可以存储在例如系统存储器502中，且这样的程序模块5024包括但不限于：操作系统、一个或者多个应用程序、其它程序模块以及程序数据，这些示例中的每一个或某种组合中可能包括网络环境的实现。程序模块5024通常执行本申请所描述的实施例中的功能和/或方法。计算设备50也可以与一个或多个外部设备504通信。这种通信可以通过输入/输出接口505进行。并且，计算设备50还可以通过网络适配器506与一个或者多个网络，广域网和/或公共网络，例如因特网）通信。如图17所示，网络适配器506通过总线503与计算设备50的其它模块通信。应当明白，尽管图17中未示出，可以结合计算设备50使用其它硬件和/或软件模块。处理单元501通过运行存储在系统存储器502中的程序，从而执行各种功能应用以及数据处理，例如，获取第一图像分量，其中，所述第一图像分量包括胶囊接缝处的预设通道的图像分量；所述第一图像分量中，胶囊接缝处的所述预设通道的图像分量发生阶跃性变化；根据胶囊帽和胶囊体的插接方向对所述第一图像分量进行显著化处理，得到第二图像分量，其中，所述第二图像分量至少包括增强胶囊接缝特征；对所述第二图像分量进行降噪和补偿，得到目标图像分量，其中，所述目标图像分量包括所述胶囊接缝处的完整轮廓。各步骤的具体实现方式在此不再重复说明。应当注意，尽管在上文详细描述中提及了胶囊接缝图像获取装置的若干单元/模块或子单元/子模块，但是这种划分仅仅是示例性的并非强制性的。实际上，根据本申请的实施方式，上文描述的两个或更多单元/模块的特征和功能可以在一个单元/模块中具体化。反之，上文描述的一个单元/模块的特征和功能可以进一步划分为由多个单元/模块来具体化。此外，尽管在附图中以特定顺序描述了本申请方法的操作，但是，这并非要求或者暗示必须按照该特定顺序来执行这些操作，或是必须执行全部所示的操作才能实现期望的结果。附加地或备选地，可以省略某些步骤，将多个步骤合并为一个步骤执行，和/或将一个步骤分解为多个步骤执行。虽然已经参考若干具体实施方式描述了本申请的精神和原理，但是应该理解，本申请并不限于所申请的具体实施方式，对各方面的划分也不意味着这些方面中的特征不能组合以进行受益，这种划分仅是为了表述的方便。本申请旨在涵盖所附权利要求的精神和范围内所包括的各种修改和等同布置。
