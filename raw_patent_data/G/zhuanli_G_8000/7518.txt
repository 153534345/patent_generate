标题title
一种解决PCIE热插拔槽位无法识别设备的方法和装置
摘要abst
本发明提供一种解决PCIE热插拔槽位无法识别设备的方法、系统、设备和存储介质，方法包括：在CPLD和芯片之间设置逻辑缓存器，并通过所述CPLD控制所述逻辑缓存器；响应于服务器第一次带卡开机，确认PCIE设备在位，控制热插拔槽位正常上电；响应于进行PCIE设备热插拔，通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电；以及响应于服务器不带卡开机，通过CPLD开启所述逻辑缓存器，并保持PCIE槽位处于不上电状态。本发明可以解决PCIE热插拔槽位无法识别设备的问题，提高了服务器设计的通用性和有效性。
权利要求书clms
1.一种解决PCIE热插拔槽位无法识别设备的方法，其特征在于，包括如下步骤：在CPLD和芯片之间设置逻辑缓存器，并通过所述CPLD控制所述逻辑缓存器；响应于服务器第一次带卡开机，确认PCIE设备在位，控制热插拔槽位正常上电；响应于进行PCIE设备热插拔，通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电；以及响应于服务器不带卡开机，通过CPLD开启所述逻辑缓存器，并保持PCIE槽位处于不上电状态。2.根据权利要求1所述的方法，其特征在于，所述确认PCIE设备在位包括：通过CPLD使得所述逻辑缓存器使能信号失效，使电源使能信号不生效，并检测到预设信号为低电平确认PCIE设备在位。3.根据权利要求1所述的方法，其特征在于，所述控制热插拔槽位正常上电包括：响应于识别PCIE设备，通过所述CPLD使能所述逻辑缓存器使能信号，并使电源信号生效。4.根据权利要求1所述的方法，其特征在于，所述通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电包括：通过CPLD将热拔出信息通知主板以移除拔出PCIE设备的资源，或者通过CPLD将热插入信息通知主板以增加插入PCIE设备的资源。5.根据权利要求1所述的方法，其特征在于，所述通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电包括：通过CPLD开启所述逻辑缓存器，并输出低电平电源信号以控制PCIE设备下电；或者通过CPLD关断所述逻辑缓存器，并输出高电平电源信号以控制PCIE设备上电。6.根据权利要求1所述的方法，其特征在于，所述保持PCIE槽位处于不上电状态包括：通过CPLD检测预测信号是否为高电平，响应于CPLD检测到预测信号为高电平，控制PCIE槽位处于不上电状态。7.根据权利要求1所述的方法，其特征在于，方法还包括：响应于开机完成进行热插入，将预测信号拉低以检测PCIE设备在位。8.一种解决PCIE热插拔槽位无法识别设备的系统，其特征在于，包括：设置模块，配置用于在CPLD和芯片之间设置逻辑缓存器，并通过所述CPLD控制所述逻辑缓存器；控制模块，配置用于响应于服务器第一次带卡开机，确认PCIE设备在位，控制热插拔槽位正常上电；插拔模块，配置用于响应于进行PCIE设备热插拔，通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电；以及保持模块，配置用于响应于服务器不带卡开机，通过CPLD开启所述逻辑缓存器，并保持PCIE槽位处于不上电状态。9.一种计算机设备，其特征在于，包括：至少一个处理器；以及存储器，所述存储器存储有可在所述处理器上运行的计算机指令，所述指令由所述处理器执行时实现权利要求1-7任意一项所述方法的步骤。10.一种计算机可读存储介质，所述计算机可读存储介质存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现权利要求1-7任意一项所述方法的步骤。
说明书desc
技术领域本发明涉及服务器领域，更具体地，特别是指一种解决PCIE热插拔槽位无法识别设备的方法、系统、设备和存储介质。背景技术随着社会发展的越来越快，人们对数据的安全可靠要求越来越高。服务器作为数据的载体，要保证数据安全可靠，需要长期稳定不间断地运行；当服务器上的PCIE设备出现故障需要更换时，如果断电处理，将无法保证服务器不间断运行；服务器上支持HOT-PLUG的PCIE槽位设置，应用越来越广泛；当服务器的PCIE设备出现故障时，可以单独断开故障PCIE槽位的供电，更换新的PCIE设备后，可以恢复该槽位的供电，重新加载驱动让PCIE设备再次工作，可以保证服务器整机不间断可靠运行。在服务器设计时，经常遇到在支持HOT-PLUG的PCIE槽位因上电使能信号在开机上电期间不稳定，导致PCIE设备上电异常，PCIE设备无法识别的情况，无法实现热插拔。现有服务器设计对于HOT-PLUG上电使能信号直接发给CPLD，控制PCIE设备的上电，如果PWREN信号不稳定，PCIE设备可能会出现上电异常。PWREN信号在上电期间的不稳定差异较大，接收PWREN信号的CPLD需要针对性的修改方案来解决该问题，实现复杂、不统一、灵活性差，影响了后期的维护。发明内容有鉴于此，本发明实施例的目的在于提出一种解决PCIE热插拔槽位无法识别设备的方法、系统、计算机设备及计算机可读存储介质，本发明通过在现有技术的芯片和CPLD之间增加逻辑缓存器，通过CPLD控制逻辑缓存器的开启和关断从而解决了PCIE热插拔槽位无法识别设备的问题，提高了服务器设计的通用性和有效性。基于上述目的，本发明实施例的一方面提供了一种解决PCIE热插拔槽位无法识别设备的方法，包括如下步骤：在CPLD和芯片之间设置逻辑缓存器，并通过所述CPLD控制所述逻辑缓存器；响应于服务器第一次带卡开机，确认PCIE设备在位，控制热插拔槽位正常上电；响应于进行PCIE设备热插拔，通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电；以及响应于服务器不带卡开机，通过CPLD开启所述逻辑缓存器，并保持PCIE槽位处于不上电状态。在一些实施方式中，所述确认PCIE设备在位包括：通过CPLD使得所述逻辑缓存器使能信号失效，使电源使能信号不生效，并检测到预设信号为低电平确认PCIE设备在位。在一些实施方式中，所述控制热插拔槽位正常上电包括：响应于识别PCIE设备，通过所述CPLD使能所述逻辑缓存器使能信号，并使电源信号生效。在一些实施方式中，所述通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电包括：通过CPLD将热拔出信息通知主板以移除拔出PCIE设备的资源，或者通过CPLD将热插入信息通知主板以增加插入PCIE设备的资源。在一些实施方式中，所述通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电包括：通过CPLD开启所述逻辑缓存器，并输出低电平电源信号以控制PCIE设备下电；或者通过CPLD关断所述逻辑缓存器，并输出高电平电源信号以控制PCIE设备上电。在一些实施方式中，所述保持PCIE槽位处于不上电状态包括：通过CPLD检测预测信号是否为高电平，响应于CPLD检测到预测信号为高电平，控制PCIE槽位处于不上电状态。在一些实施方式中，方法还包括：响应于开机完成进行热插入，将预测信号拉低以检测PCIE设备在位。本发明实施例的另一方面，提供了一种解决PCIE热插拔槽位无法识别设备的系统，包括：设置模块，配置用于在CPLD和芯片之间设置逻辑缓存器，并通过所述CPLD控制所述逻辑缓存器；控制模块，配置用于响应于服务器第一次带卡开机，确认PCIE设备在位，控制热插拔槽位正常上电；插拔模块，配置用于响应于进行PCIE设备热插拔，通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电；以及保持模块，配置用于响应于服务器不带卡开机，通过CPLD开启所述逻辑缓存器，并保持PCIE槽位处于不上电状态。本发明实施例的又一方面，还提供了一种计算机设备，包括：至少一个处理器；以及存储器，所述存储器存储有可在所述处理器上运行的计算机指令，所述指令由所述处理器执行时实现如上方法的步骤。本发明实施例的再一方面，还提供了一种计算机可读存储介质，计算机可读存储介质存储有被处理器执行时实现如上方法步骤的计算机程序。本发明具有以下有益技术效果：通过在现有技术的芯片和CPLD之间增加逻辑缓存器，通过CPLD控制逻辑缓存器的开启和关断从而解决了PCIE热插拔槽位无法识别设备的问题，提高了服务器设计的通用性和有效性。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的实施例。图1为本发明提供的解决PCIE热插拔槽位无法识别设备的方法的实施例的示意图；图2为本发明提供的解决PCIE热插拔槽位无法识别设备的系统的实施例的示意图；图3为本发明提供的解决PCIE热插拔槽位无法识别设备的计算机设备的实施例的硬件结构示意图；图4为本发明提供的解决PCIE热插拔槽位无法识别设备的计算机存储介质的实施例的示意图。具体实施方式为使本发明的目的、技术方案和优点更加清楚明白，以下结合具体实施例，并参照附图，对本发明实施例进一步详细说明。需要说明的是，本发明实施例中所有使用“第一”和“第二”的表述均是为了区分两个相同名称非相同的实体或者非相同的参量，可见“第一”“第二”仅为了表述的方便，不应理解为对本发明实施例的限定，后续实施例对此不再一一说明。本发明实施例的第一个方面，提出了一种解决PCIE热插拔槽位无法识别设备的方法的实施例。图1示出的是本发明提供的解决PCIE热插拔槽位无法识别设备的方法的实施例的示意图。如图1所示，本发明实施例包括如下步骤：S1、在CPLD和芯片之间设置逻辑缓存器，并通过所述CPLD控制所述逻辑缓存器；S2、响应于服务器第一次带卡开机，确认PCIE设备在位，控制热插拔槽位正常上电；S3、响应于进行PCIE设备热插拔，通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电；以及S4、响应于服务器不带卡开机，通过CPLD开启所述逻辑缓存器，并保持PCIE槽位处于不上电状态。现有技术中，HOT-PLUG PCIE设备上电的逻辑控制为：主板的CPU通过VPP信号传递给9555芯片解析成PWREN后，直接传递给CPLD控制PCIE设备VR的上电，当PWREN信号本身不稳定时，会造成PCIE设备的异常掉电，导致无法正常识别。所以需要解决PWREN信号的不稳定带来的影响，即带卡上电过程中，通过CPLD控制该PWREN信号是否生效，来排除PWREN信号本身的不稳定带来的影响。在CPLD和芯片之间设置逻辑缓存器，并通过所述CPLD控制所述逻辑缓存器。在现有技术的9555芯片与CPLD之间新增logic buffer，通过CPLD控制logicbuffer的开启和关断，进而控制PWREN信号是否生效。响应于服务器第一次带卡开机，确认PCIE设备在位，控制热插拔槽位正常上电。在一些实施方式中，所述确认PCIE设备在位包括：通过CPLD使得所述逻辑缓存器使能信号失效，使电源使能信号不生效，并检测到预设信号为低电平确认PCIE设备在位。当服务器第一次带卡开机时，CPLD会使BUFFER_EN信号失效，Logic buffer断开，PWREN不生效，此时CPLD检测到预设信号PRSNT2#拉低，即确认PCIE设备在位，控制HOT-PLUG槽位正常上电。在一些实施方式中，所述控制热插拔槽位正常上电包括：响应于识别PCIE设备，通过所述CPLD使能所述逻辑缓存器使能信号，并使电源信号生效。当PCIE设备被正常识别后，PWREN信号稳定后，CPLD使能BUFFER_EN信号，PWREN信号生效。响应于进行PCIE设备热插拔，通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电。在一些实施方式中，所述通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电包括：通过CPLD将热拔出信息通知主板以移除拔出PCIE设备的资源，或者通过CPLD将热插入信息通知主板以增加插入PCIE设备的资源。在一些实施方式中，所述通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电包括：通过CPLD开启所述逻辑缓存器，并输出低电平电源信号以控制PCIE设备下电；或者通过CPLD关断所述逻辑缓存器，并输出高电平电源信号以控制PCIE设备上电。当进行PCIE设备热插拔时，CPLD将热拔出信息通知系统，系统首先移除该PCIE设备拥有的总线资源、Memory资源等，保证没有流程再访问该PCIE设备。由于该过程PWREN信号稳定，CPLD开启Logic buffer，输出PWREN_L信号到CPLD，CPLD通过判断PWREN_L的逻辑电平，进而控制PCIE设备的下电动作，热插入流程与热拔出相反。响应于服务器不带卡开机，通过CPLD开启所述逻辑缓存器，并保持PCIE槽位处于不上电状态。在一些实施方式中，所述保持PCIE槽位处于不上电状态包括：通过CPLD检测预测信号是否为高电平，响应于CPLD检测到预测信号为高电平，控制PCIE槽位处于不上电状态。当不带卡开机时，CPLD会使能BUFFER_EN，即Logic buffer开启；但CPLD检测到PRSNT2#信号置高不生效，CPLD不会控制PCIE槽位上电，所以PWREN在上电期间即使信号不稳定也不会影响上电时序。在一些实施方式中，方法还包括：响应于开机完成进行热插入，将预测信号拉低以检测PCIE设备在位。当开机后，PWREN信号稳定，进行热插入时，PRSNT2#被拉低，检测到PCIE设备在位，可以正常进行热插拔操作。需要特别指出的是，上述解决PCIE热插拔槽位无法识别设备的方法的各个实施例中的各个步骤均可以相互交叉、替换、增加、删减，因此，这些合理的排列组合变换之于解决PCIE热插拔槽位无法识别设备的方法也应当属于本发明的保护范围，并且不应将本发明的保护范围局限在实施例之上。基于上述目的，本发明实施例的第二个方面，提出了一种解决PCIE热插拔槽位无法识别设备的系统。如图2所示，系统200包括如下模块：设置模块，配置用于在CPLD和芯片之间设置逻辑缓存器，并通过所述CPLD控制所述逻辑缓存器；控制模块，配置用于响应于服务器第一次带卡开机，确认PCIE设备在位，控制热插拔槽位正常上电；插拔模块，配置用于响应于进行PCIE设备热插拔，通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电；以及保持模块，配置用于响应于服务器不带卡开机，通过CPLD开启所述逻辑缓存器，并保持PCIE槽位处于不上电状态。在一些实施方式中，所述控制模块配置用于：通过CPLD使得所述逻辑缓存器使能信号失效，使电源使能信号不生效，并检测到预设信号为低电平确认PCIE设备在位。在一些实施方式中，所述控制模块配置用于：响应于识别PCIE设备，通过所述CPLD使能所述逻辑缓存器使能信号，并使电源信号生效。在一些实施方式中，所述插拔模块配置用于：通过CPLD将热拔出信息通知主板以移除拔出PCIE设备的资源，或者通过CPLD将热插入信息通知主板以增加插入PCIE设备的资源。在一些实施方式中，所述插拔模块配置用于：通过CPLD开启所述逻辑缓存器，并输出低电平电源信号以控制PCIE设备下电；或者通过CPLD关断所述逻辑缓存器，并输出高电平电源信号以控制PCIE设备上电。在一些实施方式中，所述保持模块配置用于：通过CPLD检测预测信号是否为高电平，响应于CPLD检测到预测信号为高电平，控制PCIE槽位处于不上电状态。在一些实施方式中，系统还包括检测模块，配置用于：响应于开机完成进行热插入，将预测信号拉低以检测PCIE设备在位。基于上述目的，本发明实施例的第三个方面，提出了一种计算机设备，包括：至少一个处理器；以及存储器，存储器存储有可在处理器上运行的计算机指令，指令由处理器执行以实现如下步骤：S1、在CPLD和芯片之间设置逻辑缓存器，并通过所述CPLD控制所述逻辑缓存器；S2、响应于服务器第一次带卡开机，确认PCIE设备在位，控制热插拔槽位正常上电；S3、响应于进行PCIE设备热插拔，通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电；以及S4、响应于服务器不带卡开机，通过CPLD开启所述逻辑缓存器，并保持PCIE槽位处于不上电状态。在一些实施方式中，所述确认PCIE设备在位包括：通过CPLD使得所述逻辑缓存器使能信号失效，使电源使能信号不生效，并检测到预设信号为低电平确认PCIE设备在位。在一些实施方式中，所述控制热插拔槽位正常上电包括：响应于识别PCIE设备，通过所述CPLD使能所述逻辑缓存器使能信号，并使电源信号生效。在一些实施方式中，所述通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电包括：通过CPLD将热拔出信息通知主板以移除拔出PCIE设备的资源，或者通过CPLD将热插入信息通知主板以增加插入PCIE设备的资源。在一些实施方式中，所述通过CPLD控制所述逻辑缓存器开启或者关断以控制PCIE设备的上下电包括：通过CPLD开启所述逻辑缓存器，并输出低电平电源信号以控制PCIE设备下电；或者通过CPLD关断所述逻辑缓存器，并输出高电平电源信号以控制PCIE设备上电。在一些实施方式中，所述保持PCIE槽位处于不上电状态包括：通过CPLD检测预测信号是否为高电平，响应于CPLD检测到预测信号为高电平，控制PCIE槽位处于不上电状态。在一些实施方式中，步骤还包括：响应于开机完成进行热插入，将预测信号拉低以检测PCIE设备在位。如图3所示，为本发明提供的上述解决PCIE热插拔槽位无法识别设备的计算机设备的一个实施例的硬件结构示意图。以如图3所示的装置为例，在该装置中包括一个处理器301以及一个存储器302。处理器301和存储器302可以通过总线或者其他方式连接，图3中以通过总线连接为例。存储器302作为一种非易失性计算机可读存储介质，可用于存储非易失性软件程序、非易失性计算机可执行程序以及模块，如本申请实施例中的解决PCIE热插拔槽位无法识别设备的方法对应的程序指令/模块。处理器301通过运行存储在存储器302中的非易失性软件程序、指令以及模块，从而执行服务器的各种功能应用以及数据处理，即实现解决PCIE热插拔槽位无法识别设备的方法。存储器302可以包括存储程序区和存储数据区，其中，存储程序区可存储操作系统、至少一个功能所需要的应用程序；存储数据区可存储根据解决PCIE热插拔槽位无法识别设备的方法的使用所创建的数据等。此外，存储器302可以包括高速随机存取存储器，还可以包括非易失性存储器，例如至少一个磁盘存储器件、闪存器件、或其他非易失性固态存储器件。在一些实施例中，存储器302可选包括相对于处理器301远程设置的存储器，这些远程存储器可以通过网络连接至本地模块。上述网络的实例包括但不限于互联网、企业内部网、局域网、移动通信网及其组合。一个或者多个解决PCIE热插拔槽位无法识别设备的方法对应的计算机指令303存储在存储器302中，当被处理器301执行时，执行上述任意方法实施例中的解决PCIE热插拔槽位无法识别设备的方法。执行上述解决PCIE热插拔槽位无法识别设备的方法的计算机设备的任何一个实施例，可以达到与之对应的前述任意方法实施例相同或者相类似的效果。本发明还提供了一种计算机可读存储介质，计算机可读存储介质存储有被处理器执行时执行解决PCIE热插拔槽位无法识别设备的方法的计算机程序。如图4所示，为本发明提供的上述解决PCIE热插拔槽位无法识别设备的计算机存储介质的一个实施例的示意图。以如图4所示的计算机存储介质为例，计算机可读存储介质401存储有被处理器执行时执行如上方法的计算机程序402。最后需要说明的是，本领域普通技术人员可以理解实现上述实施例方法中的全部或部分流程，可以通过计算机程序来指令相关硬件来完成，解决PCIE热插拔槽位无法识别设备的方法的程序可存储于一计算机可读取存储介质中，该程序在执行时，可包括如上述各方法的实施例的流程。其中，程序的存储介质可为磁碟、光盘、只读存储记忆体或随机存储记忆体等。上述计算机程序的实施例，可以达到与之对应的前述任意方法实施例相同或者相类似的效果。以上是本发明公开的示例性实施例，但是应当注意，在不背离权利要求限定的本发明实施例公开的范围的前提下，可以进行多种改变和修改。根据这里描述的公开实施例的方法权利要求的功能、步骤和/或动作不需以任何特定顺序执行。此外，尽管本发明实施例公开的元素可以以个体形式描述或要求，但除非明确限制为单数，也可以理解为多个。应当理解的是，在本文中使用的，除非上下文清楚地支持例外情况，单数形式“一个”旨在也包括复数形式。还应当理解的是，在本文中使用的“和/或”是指包括一个或者一个以上相关联地列出的项目的任意和所有可能组合。上述本发明实施例公开实施例序号仅仅为了描述，不代表实施例的优劣。本领域普通技术人员可以理解实现上述实施例的全部或部分步骤可以通过硬件来完成，也可以通过程序来指令相关的硬件完成，程序可以存储于一种计算机可读存储介质中，上述提到的存储介质可以是只读存储器，磁盘或光盘等。所属领域的普通技术人员应当理解：以上任何实施例的讨论仅为示例性的，并非旨在暗示本发明实施例公开的范围被限于这些例子；在本发明实施例的思路下，以上实施例或者不同实施例中的技术特征之间也可以进行组合，并存在如上的本发明实施例的不同方面的许多其它变化，为了简明它们没有在细节中提供。因此，凡在本发明实施例的精神和原则之内，所做的任何省略、修改、等同替换、改进等，均应包含在本发明实施例的保护范围之内。
