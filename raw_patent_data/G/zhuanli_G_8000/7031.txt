标题title
一种基于Hough梯度法的电解电容定位方法
摘要abst
本发明公开了一种基于Hough梯度法的电解电容定位方法，首先将彩色的电解电容图像转化为灰度图像，然后将灰度图像进行中值滤波，接着通过直方图均衡化增强图像，然后通过Canny边缘检测算法提取图像边缘，最后通过改进的Hough梯度法定位电解电容顶部圆图像。本发明在保证图像处理速度的基础上，提高了定位精度，是一种良好有效的电解电容定位方法。
权利要求书clms
1.一种基于Hough梯度法的电解电容定位方法，其特征在于，包括以下步骤：步骤1、对图像进行灰度化处理，将彩色的电解电容图像转化为灰度图像；步骤2、利用中值滤波对灰度图像的噪声进行抑制；步骤3、将中值滤波处理后的图像进行直方图均衡化处理以增强图像；步骤4、对直方图均衡化处理后的图像采用Canny边缘检测算法提取图像边缘；步骤5、使用改进的Hough梯度法从边缘图像中检测圆以完成图像定位。2.根据权利要求1所述的基于Hough梯度法的电解电容定位方法，其特征在于，步骤2中所述的中值滤波，其计算式为：g＝median式中，g为滤波后的图像，f为原图像，median表示像素点邻域像素值的中值。3.根据权利要求1所述的基于Hough梯度法的电解电容定位方法，其特征在于，步骤3中所述的直方图均衡化处理，其计算式为：式中，sk为均衡化后更像素的灰度级，pr为原图像概率密度函数，rj为像素点的归一化值，k为归一化前的灰度级，M为最大灰度级。4.根据权利要求1所述的基于Hough梯度法的电解电容定位方法，其特征在于，步骤4中所述的Canny边缘检测算法，包括以下步骤：使用高斯平滑滤波器卷积降噪，滤波器方程式如下：式中H表示高斯滤波器模板的元素值，i，j为模板元素坐标，k为正整数，σ为标准差；检测图像中的水平、垂直和对角边缘，计算公式如下：式中，G和θ分别表示像素点的梯度和方向，Gx、Gy分别为边缘检测算子返回水平和垂直方向的一阶导数值；比较当前像素与沿正负梯度方向上的两个像素的梯度强度，如果当前像素最大，则该像素保留为边缘点，否则该像素点被抑制；设定滞后阈值范围，若某一像素位置的幅值超过高阈值，该像素被保留为边缘像素；若某一像素位置的幅值小于低阈值，该像素被排除；若某一像素位置的幅值在两个阈值之间，仅当该像素连接到一个高于阈值的像素时被保留。5.根据权利要求1所述的基于Hough梯度法的电解电容定位方法，其特征在于：步骤5中所述的改进的Hough梯度法包括以下步骤：计算圆心位置的偏差值δg的关系为：δg＝r·Δθg式中，δg为圆心位置的偏差值，r是真实圆O的半径，Δθg为梯度误差；偏离区域设为梯度误差极值区域P1，若边缘任意一点的梯度直线通过区域P1，则认定该点是目标圆上的点；从边缘点沿着梯度和梯度的反方向作梯度直线，对于梯度直线上的一个像素点，每当一条梯度直线经过该点，该点在累加器中被累加一次，记录累加值Ai同时标记边缘图像中每一个非0像素点的位置；在Hough空间内对所有累加器中的像素进行非极大值抑制，同时设定阈值Th1，当Ai≥Th1且大于所有邻域点累加值，该点确定为候选圆心，然后对所有候选点按照累加值降序排列；计算圆弧轮廓区域l相对于圆的形变程度为Ki：式中，Ki为形变程度，di为圆弧轮廓区域l上的点到真实圆心的距离，r为真实圆O的半径；计算形变误差极值区域的半径rδ：rδ≥Ki·r令所有圆心位于形变误差极值区域P2的边缘点都为候选圆心的目标圆上的点，由此克服形变误差带来的圆心偏差；计算某一个候选圆心到所有边缘非0像素点的距离dij，设定半径取值范围rmin和rmax，保留所有rmin≤dij≤rmax的距离值dij，对所有边缘非0像素点的距离dij进行排序，寻找数值相同的距离dij，并计算相同值的数量Bi，取Bi极大值对应的距离dij，即认为该值是该候选圆心对应的圆半径；对所有候选圆心重复步骤和步骤，得到所有候选圆心对应的圆半径；计算所有圆心之间的距离di，设定阈值Th2，保留所有di≥Th2的圆心和半径，作为最终的检测结果在图像中标记。
说明书desc
技术领域本发明涉及一种PCB表面元器件的数字图像处理方法，尤其涉及一种基于Hough梯度法的电解电容定位方法。背景技术PCB表面元器件的定位是PCB装配缺陷检测前的准备工作。在机器视觉中，ROI是根据目标特征的不同框选出需要处理的区域，ROI所选择区域的准确度决定了图像处理的质量，元器件定位的目的是生成准确的ROI。目前大部分光学检测设备中的ROI是由操作人员手动绘制生成，这会影响模板的制作效率和检测精度。一些企业采用PCB源文件导入生成的方法，通过PCB源文件获取元器件的坐标和尺寸参数，经处理后在模板和待测图像中自动生成ROI。这种方法大大提升了ROI的生成效率和精度，但在缺少PCB源文件或源文件信息不完整的情况下，此方法无法使用。电解电容是一种立插式的圆柱形元器件，它的特点是图像信息大部分在电解电容圆柱本体的侧面，采集的图像只能展示顶部的信息，顶部图像是一个圆，因此需对顶部的圆形图像进行定位。但是由于所拍摄PCB板图像的曝光、拍摄角度偏差、元器件高度差所导致的清晰度限制，现有的图像处理方法很难精准地确定电解电容位置。发明内容发明目的：本发明提出一种基于Hough梯度法的电解电容定位方法，针对模板PCB表面装配的电解电容，能够在缺少PCB源文件的情况下自动定位并选取合适的元器件区域，生成ROI，为后续的缺陷检测做准备。技术方案：本发明所采用的技术方案是一种基于Hough梯度法的电解电容定位方法，包括以下步骤：步骤1、对图像进行灰度化处理，将彩色的电解电容图像转化为灰度图像；步骤2、利用中值滤波对灰度图像的噪声进行抑制；其中，所述的中值滤波，其计算式为：g＝median式中，g为滤波后的图像，f为原图像，median表示像素点邻域像素值的中值。步骤3、将中值滤波处理后的图像进行直方图均衡化处理以增强图像；所述的直方图均衡化处理，其计算式为：式中，sk为均衡化后各像素的灰度级，pr为原图像概率密度函数，rj为像素点的归一化值，k表示归一化前的灰度级，M为最大灰度级，一般取256。步骤4、对直方图均衡化处理后的图像采用Canny边缘检测算法提取图像边缘；所述的Canny边缘检测算法，包括以下步骤：使用高斯平滑滤波器卷积降噪，滤波器方程式如下：式中H表示高斯滤波器模板中的元素值，i，j为模板元素坐标，k为正整数，σ为标准差；检测图像中的水平、垂直和对角边缘，计算公式如下：式中，G和θ分别表示像素点的梯度和方向，Gx、Gy分别为边缘检测算子返回水平和垂直方向的一阶导数值；比较当前像素与沿正负梯度方向上的两个像素的梯度强度，如果当前像素最大，则该像素保留为边缘点，否则该像素点被抑制；设定滞后阈值范围，若某一像素位置的幅值超过高阈值，该像素被保留为边缘像素；若某一像素位置的幅值小于低阈值，该像素被排除；若某一像素位置的幅值在两个阈值之间，该像素仅仅连接到一个高于阈值的像素时被保留。步骤5、使用改进的Hough梯度法从边缘图像中检测圆以完成图像定位。所述的改进的Hough梯度法包括以下步骤：计算圆心位置的偏差值δg的关系为：δg＝r·Δθg式中，δg为圆心位置的偏差值，r是真实圆O的半径，Δθg为梯度误差；偏离区域设为梯度误差极值区域P1，若边缘任意一点的梯度直线通过区域P1，则认定该点是目标圆上的点；从边缘点沿着梯度和梯度的反方向作梯度直线，对于梯度直线上的一个像素点，每当一条梯度直线经过该点，该点在累加器中被累加一次，记录累加值Ai同时标记边缘图像中每一个非0像素点的位置；在Hough空间内对所有累加器中的像素进行非极大值抑制，同时设定阈值Th1，当Ai≥Th1且大于所有邻域点累加值，该点确定为候选圆心，然后对所有候选点按照累加值降序排列；计算圆弧轮廓区域l相对于圆的形变程度为Ki：式中，Ki为形变程度，di为圆弧轮廓区域l上的点到真实圆心的距离，r为真实圆O的半径；计算形变误差极值区域的半径rδ：rδ≥Ki·r令所有圆心位于形变误差极值区域P2的边缘点都为候选圆心的目标圆上的点，由此克服形变误差带来的圆心偏差；计算某一个候选圆心到所有边缘非0像素点的距离dij，设定半径取值范围rmin和rmax，保留所有rmin≤dij≤rmax的距离值dij，对所有边缘非0像素点的距离dij进行排序，寻找数值相同的距离dij，并计算相同值的数量Bi，取Bi极大值对应的距离dij，即认为该值是该候选圆心对应的圆半径；对所有候选圆心重复步骤和步骤，得到所有候选圆心对应的圆半径；计算所有圆心之间的距离di，设定阈值Th2，保留所有di≥Th2的圆心和半径，作为最终的检测结果在图像中标记。有益效果：相比于现有技术，本发明具有以下优点：本发明利用Canny边缘检测算子来提取图像边缘，能够更为精确地提取图像边缘，并通过引入误差极值的概念解决了Hough梯度算法产生的梯度误差和形变误差的问题，更精确地提取目标圆的圆心和半径。利用本发明进行电解电容定位时，计算量少，定位速率快，误检数少，定位时间短。附图说明图l是本发明所述的电解电容定位方法总流程图；图2是将彩色的电解电容图像进行灰度化处理后的灰度图像；图3是经过中值滤波后的图像；图4是直方图均衡前的灰度图像和直方图；图5是经过直方图均衡后的灰度图像和直方图；图6是经过Canny算法后T1＝15，T2＝5的边缘提取图和T1＝60，T2＝20的边缘提取图；图7是标准Hough变换法的定位结果图，Hough梯度法的定位结果图和经过改进后的Hough梯度法后的定位结果图。具体实施方式下面结合附图和实施例对本发明的技术方案作进一步的说明。如图1所示，为本发明所述的基于Hough梯度法的电解电容定位方法的总流程图。本发明首先对图像进行灰度化处理，将彩色的电解电容图像转化为灰度图像，然后利用中值滤波在尽量保留图像细节特征的条件下对目标图像的噪声进行抑制，然后将中值滤波处理后的图像进行直方图均衡化处理，以此来增强图像。接着对直方图均衡化处理后的图像采用Canny边缘检测算法，提取图像边缘，最后使用改进的Hough梯度法从边缘图像中检测圆以完成图像定位。实验硬件使用的是联想笔记本电脑，硬件配置为Intel Core i5-4200H，主频2.80GHz，内存8G，软件环境是Visual Studio 2019平台。如图2所示，首先将彩色的电解电容图像转化为灰度图像。然后对灰度图像进行中值滤波操作，图3为经过中值滤波后的图像。用像素点邻域像素值的中值来代替该像素点的像素值。如下式所示：g＝median式中，g为滤波后的图像，f为原图像。将中值滤波后的图像进行直方图均衡化处理，以此来增强图像。它的原理是通过拉伸像素强度的分布范围来增强图像对比度，离散化后的数学表达式如下式所示：式中，sk为均衡化后各像素的灰度级，pr为原图像概率密度函数，rj为像素点的归一化值，k表示归一化前的灰度级，M为最大灰度级，一般取256。如图4所示为直方图均衡化处理前的灰度图像和直方图，可以看出灰度值较为集中，图5为经过直方图均衡化处理后的灰度图像和直方图，灰度值扩展到了0-255，增强了图像对比度。使用Canny边缘检测算子提取边缘图，具体步骤如下：取k＝2，使用大小为5×5的高斯滤波器核进行卷积降噪，令i＝j＝2，其生成方程式如下：式中H表示高斯滤波器模板中的元素值，i，j为模板元素坐标，k为正整数，σ为标准差；计算梯度强度和方向，边缘检测算子返回水平Gx和垂直Gy方向的一阶导数值，由此可以确定像素点的梯度G和方向θ，计算公式如下：由于仅仅基于梯度值提取的边缘依然模糊，所以需要通过非极大值抑制的方式帮助将局部最大值之外的所有梯度值抑制为0。Canny使用的滞后阈值需要两个阈值。图5a是均衡化处理后的原图，对该图使用Canny边缘检测算子提取边缘图，如图6所示，给T1值15，T2赋值5得到图6a所示的边缘提取图，给T1赋值60，T2赋值20，得到图6b所示的的边缘提取图。使用改进的Hough梯度法从边缘图像中检测圆以完成图像定位，其具体步骤如下：计算图像中每一个非零点的局部梯度，设对图像边缘进行局部梯度计算产生的误差为Δθg，进行圆检测后得到的候选圆心O1，与真实圆心O的偏差值为δg。一般情况下，Δθg的值较小，Δθg与δg的关系为：δg＝r·Δθg式中，r是半径，因此可以通过梯度误差Δθg求出圆心位置的偏差值δg的大小。在对边缘图像进行梯度运算时，不同的边缘检测算子有不同的梯度误差。定义偏离区域为梯度误差极值区域P1，若边缘任意一点的梯度直线通过区域P1，则认定该点是圆心O的目标圆上的点，由此克服梯度误差带来的圆心偏差。从边缘点Ci沿着梯度和梯度的反方向作梯度直线Li，对于梯度直线上的一个像素点，每当一条梯度直线经过该点，该点在累加器中被累加一次，记录累加值Ai同时标记边缘图像中每一个非0像素点的位置。在Hough空间内对所有累加器中的像素进行非极大值抑制，同时设定阈值Th1＝150，当Ai≥Th1且大于所有邻域点累加值，该点确定为候选圆心Oj，然后对所有候选点按照累加值降序排列。现定义圆弧轮廓区域l相对于圆O的形变程度为Ki：式中，di为l上的点到圆心O的距离，r为圆O的半径。定义形变误差极值区域P2，令rδ表示形变误差极值区域的半径，则有：rδ≥Ki·r通过和可知：通过定义极值区域后，在图像空间到参数空间的映射中，大部分边缘点都成为候选圆的目标点，但在极值区域会存在一些不需要的边缘点所映射出来的圆心，这导致这些边缘点同样被归于目标点，因此需要对极值区域的半径rδ设定范围。现定义误差极值δT：δT＝Ki·rKi表示边缘点形变程度的大小，当Ki的值越大，则引入误差极值概念的Hough梯度法对形变圆的容纳程度更高，反之，则对形变圆的容纳程度更低。应当考虑梯度误差极值和形变误差极值两方面的情况，因此δT＞δg，一般情况下，取值δT＝0.1r。针对本文的研究对象，电解电容的半径大小在5mm～12mm之间，因此引入误差极值δT的范围在0.5mm～1.2mm之间。计算某一个候选圆心到所有边缘非0像素点的距离dij，设定半径取值范围rmin和rmax，保留所有rmin≤dij≤rmax的距离值dij，本例中取rmin＝50，rmax＝120。对dij进行排序，寻找数值相同的dij，并计算相同值的数量Bi，取Bi极大值对应的dij，即认为该值是该圆心对应的圆半径。对所有候选圆心重复步骤，得到所有候选圆心对应的圆半径。计算所有圆心之间的距离di，设定阈值Th2＝10，保留所有di≥Th2的圆心和半径，作为最终的检测结果在图像中标记。经过上述步骤的操作后，最终的电解电容定位图如图7所示，图7a是标准Hough变换法的检测结果图，能够明显的看见存在许多交织在一起的圆，同时还存在一些误检圆，识别精度不高；图7b是Hough梯度法的检测结果图，虽然精确度相较于标准Hough变换提升了许多，但任然存在部分区域内聚集较多圆的情况；图7c是本发明改进后的Hough梯度法的检测结果图，改进后的算法能够精确的定位出电解电容金属表面的位置并标注，相比于普通Hough梯度法，去除了因为非圆轮廓边缘引起的伪目标现象。三种定位算法的比较如表1所示，其中定位时间取多次实验的平均值，Hough梯度法的定位速度明显快于标准Hough变换法，改进后的Hough梯度法在保证定位速度的基础上，提高了定位精度，是一种效果良好的定位算法。表1三种定位算法比较
