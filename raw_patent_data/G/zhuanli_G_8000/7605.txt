标题title
多传感器数据同步采集装置及采集方法
摘要abst
本发明公开了一种基于ZYNQ的多传感器数据同步采集装置及采集方法，该装置采用ZYNQ系列SOC作为主控芯片，集成多个测绘领域常用传感器如惯性测量单元、激光雷达、GNSS接收机以及相机。利用SOC上的FPGA及ARM资源，本发明设计了多个传感器的数据同步采集方法，该方法通过高精度时间基准模块、相机授时模块、激光雷达授时模块、GNSS接收机授时模块、惯性测量单元授时模块以及数据接收与整合模块综合作用而实现，对多传感器的数据采集进行时间同步控制，极大提高了数据采集的实时性和时间准确性。
权利要求书clms
1.一种基于ZYNQ的多传感器数据同步采集装置，其特征在于，所述数据同步采集装置包括硬件设备载板和多种硬件设备，硬件设备载板由电路板构成，用于集成多种硬件设备；所述硬件设备均与硬件设备载板相连，包括：主控芯片，用于控制多传感器数据同步采集装置工作，主控芯片分为FPGA端与ARM端；激光雷达，用于采集三维距离数据的传感器；惯性测量单元，用于采集数据同步采集装置运动过程中角速度和加速度数据的传感器；GNSS接收机，用于采集数据同步采集装置实时位置数据的传感器，并且用于提供PPS秒脉冲信号；相机，用于采集图像数据的传感器；板载差分晶振，用于为数据同步采集装置提供高精度时间信息；无线数传电台，用于实现数据同步采集装置远程通讯；本地磁盘，用于储存数据同步采集装置采集到的多传感器数据；高精度时间基准模块，用于为数据同步采集装置提供高精度时间；相机授时模块，用于实现相机的数据采集和授时；激光雷达授时模块，用于实现激光雷达的数据采集和授时；GNSS接收机授时模块，用于实现GNSS接收机的数据采集和授时；惯性测量单元授时模块，用于实现惯性测量单元的数据采集和授时；数据接收与整合模块，用于实现同步完成后多传感器数据的接收和整合；其中，基于多传感器数据同步采集装置的多传感器数据同步采集方法的过程如下：S1、高精度时间基准模块启动，接收GNSS接收机发送的PPS秒脉冲信号与$GPRMC报文数据，同时接收板载差分晶振发送的脉冲信号，高精度时间基准模块内部解析$GPRMC报文数据提取UTC时间信息，同时对PPS秒脉冲信号和板载差分晶振发送的脉冲信号进行脉冲计数，将脉冲计数值与UTC时间信息进行整合计算得到数据同步采集装置运行的实时高精度时间；S2、相机授时模块启动，接收板载差分晶振发送的脉冲信号与高精度时间基准模块计算得到的实时高精度时间，对板载差分晶振发送的脉冲信号进行分频后输出至相机以触发相机采集图像数据，同时相机授时模块内部计算得到触发相机采集数据的时刻作为图像数据对应的时间数据，将图像数据对应的时间数据储存于主控芯片的ARM端；S3、激光雷达授时模块启动，接收GNSS接收机发送的$GPRMC报文数据与PPS秒脉冲信号，同时将PPS秒脉冲信号转发给激光雷达，在激光雷达授时模块内部对PPS秒脉冲信号进行监测同时缓存$GPRMC报文数据，当激光雷达授时模块监测到PPS秒脉冲上升沿后延时200ms后以9600bps波特率发送$GPRMC报文数据至激光雷达；S4、GNSS接收机授时模块启动，接收GNSS接收机发送的$GPRMC报文数据，解析报文中UTC时间信息与定位信息，将两者打包后储存于主控芯片的ARM端；S5、惯性测量单元授时模块启动，接收板载差分晶振发送的脉冲信号与高精度时间基准模块计算得到的实时高精度时间，对板载差分晶振发送的脉冲信号进行分频后输出至惯性测量单元以触发惯性测量单元采集数据，惯性测量单元完成数据采集后，惯性测量单元授时模块内部通过SPI协议读取数据，同时内部计算得到触发惯性测量单元采集数据的时刻作为惯性测量单元数据对应的时间戳，将时间戳与对应惯性测量单元数据储存于主控芯片的ARM端；S6、数据接收与整合模块启动，接收经过相机授时模块、激光雷达授时模块、GNSS接收机授时模块、惯性测量单元授时模块授时后的传感器数据，对数据进行压缩后储存于本地磁盘中。2.根据权利要求1中所述的基于ZYNQ的多传感器数据同步采集装置，其特征在于，所述主控芯片为Xilinx公司的ZYNQ SOC系列，型号为XCZU3EG；所述激光雷达型号为VLP-16；所述GNSS接收机型号为NovAtel OEM-718D；所述惯性测量单元型号为ADIS16480；所述相机型号为迈德威视MVSUA202GC-T；所述板载差分晶振型号为SIT9121AI；所述无线数传电台型号为Microhard pMDDL2450。3.根据权利要求1中所述的基于ZYNQ的多传感器数据同步采集装置，其特征在于，所述惯性测量单元与主控芯片的FPGA端通过SPI协议进行数据通讯，相机通过USB3.0协议与主控芯片的ARM端进行数据通讯，激光雷达通过100Mbps以太网协议与主控芯片的ARM端进行数据通讯，GNSS接收机通过UART协议与主控芯片的FPGA端进行数据通讯，无线数传电台通过100Mbps以太网协议与主控芯片的ARM端进行数据通讯。4.根据权利要求1中所述的基于ZYNQ的多传感器数据同步采集装置，其特征在于，所述高精度时间基准模块利用主控芯片的FPGA端自定义IP核实现，该高精度时间基准模块以GNSS接收机的PPS秒脉冲信号以及板载差分晶振的脉冲信号作为输入，内置PPS秒脉冲计数器与板载差分晶振脉冲计数器，对PPS秒脉冲和板载差分晶振的脉冲信号的上升沿进行累加计数，经过内部处理后输出10ns级别精度的时间基准，该时间基准作为数据同步采集装置运行的实时时间基准以及为其他传感器提供授时的时间基准。5.根据权利要求1中所述的基于ZYNQ的多传感器数据同步采集装置，其特征在于，所述相机授时模块利用主控芯片的FPGA端自定义IP核实现，该相机授时模块以板载差分晶振的脉冲信号以及高精度时间基准模块提供的时间信息作为输入，对相机输出20Hz的脉冲信号进行主动触发采集数据，并准确记录触发采集数据的时刻并由AXI总线传输至主控芯片的ARM端储存，该触发采集数据的时刻由UTC时间表示，单位为μs，相机采集到的图像数据由USB3.0协议直接传输至主控芯片的ARM端保存。6.根据权利要求1中所述的基于ZYNQ的多传感器数据同步采集装置，其特征在于，所述惯性测量单元授时模块利用主控芯片的FPGA端自定义IP核实现，该惯性测量单元授时模块以板载差分晶振的脉冲信号以及高精度时间基准模块提供的时间信息作为输入，对惯性测量单元输出2000Hz的脉冲信号进行主动触发，并通过SPI协议接收惯性测量单元输出的数据且准确记录数据采集的时刻，该时刻由UTC时间表示，单位为μs。将数据以及采集时间通过AXI总线发送至主控芯片的ARM端保存。7.根据权利要求1中所述的基于ZYNQ的多传感器数据同步采集装置，其特征在于，所述激光雷达授时模块利用主控芯片的FPGA端自定义IP核实现，该激光雷达授时模块以GNSS接收机获取到的$GPRMC报文数据以及PPS秒脉冲信号作为输入，根据激光雷达的授时要求产生RS232电平的PPS秒脉冲信号以及UART协议RS232电平的$GPRMC报文输出至激光雷达，其中UART协议RS232电平的$GPRMC报文数据在PPS信号的上升沿之后的200ms后发送，激光雷达成功授时后在主控芯片的ARM端通过100Mbps以太网接口UDP协议接收激光雷达数据并保存。8.根据权利要求1中所述的基于ZYNQ的多传感器数据同步采集装置，其特征在于，所述GNSS接收机授时模块利用主控芯片的FPGA端自定义IP核实现，该GNSS接收机授时模块通过UART协议TTL电平来接收GNSS接收机获取到的$GPRMC报文数据，解析报文中的UTC时间以及定位数据，将定位数据与UTC时间相互关联后通过AXI总线发送至主控芯片的ARM端保存。9.根据权利要求1中所述的基于ZYNQ的多传感器数据同步采集装置，其特征在于，所述数据接收与整合模块利用主控芯片的ARM端编程实现，该数据接收与整合模块采用多线程运行模式，同时接收来自授时后的多个传感器的数据，将数据进行整合后储存于本地磁盘。
说明书desc
技术领域本发明涉及多传感器数据采集及移动测绘技术领域，特别涉及一种基于ZYNQ实现的多传感器数据同步采集装置及采集方法。背景技术多传感器数据同步采集技术是移动测量的关键技术之一，同步采集是指各传感器的多源数据统一于同一时间基准，保证各传感器数据同步，同步采集装置是多传感器互相联系的纽带，移动测量系统中的多传感器集成到同步采集装置上，进行采集工作。随着影像测绘技术、激光扫描技术、以及惯性导航技术的发展，传统的、单一的空间数据采集系统已经迅速地被多传感器集成采集系统所取代，传统的人工测量方式已经不能满足现代地理空间数据的采集需求，地形信息数据已经从传统地图数据发展到了真三维、街景等新的数据形式，集成多种传感器的移动测量系统已经成为现代地理空间系统数据采集的趋势。以往，多传感器数据同步采集装置的主控芯片多采用x86或ARM架构的SOC，而该类SOC的特点在于其串行计算能力较强，但并发处理能力较弱，同时，使用该类SOC的采集装置一般搭载非实时操作系统，这使得多传感器数据采集的时间同步难以保证。当前，随着测绘技术的应用推广，对多传感器数据采集系统的采集精度和实时性都有了很高的要求，这也使得多传感器采集装置的主控芯片需要有更强大的并发和实时处理能力。Xilinx公司推出ZYNQ系列的SOC以ARM架构为主导，同时SOC内部也集成了FPGA资源，而FPGA的特点在于其并发处理能力强，且可严格保证程序执行的实时性。将多传感器数据信号接口集成于ZYNQ的FPGA端，利用FPGA的并发处理能力和实时性对多传感器进行实时的数据采集和同步控制，而在ARM端实现多传感器数据的整合、储存功能。ARM和FPGA结合带来的诸多优点使得ZYNQ 系列SOC在多传感器数据同步采集装置的设计中得到了广泛的应用。发明内容本发明的目的在于克服现有多传感器采集系统的采集实时性和同步性不足的问题，提供一种多传感器数据同步采集装置及采集方法。该系统的主控芯片2采用了ZYNQ系列SOC，可实现多数常用传感器的同步采集控制，利用主控芯片2上FPGA端3强大的并行和实时处理能力，将传感器接入FPGA端3进行数据采集，利用主控芯片2上ARM端4集成现有的多种硬件资源，实现将采集到的数据进行整合、储存。该装置高度集成，可装载于各类高速移动的测绘装置如测绘车、测绘无人机等，为测绘系统提供高精度数据源。本发明的目的通过下述硬件平台方案实现：一种基于ZYNQ的多传感器数据同步采集装置，所述数据同步采集装置包括硬件设备载板1和多种硬件设备，其中，硬件设备载板1由电路板构成，用于集成多种硬件设备；所述硬件设备均与硬件设备载板1相连，包括：主控芯片2，分为FPGA 端3与ARM端4；激光雷达5，用于采集三维距离数据的传感器；惯性测量单元6，用于采集本装置运动过程中角速度和加速度数据的传感器；GNSS接收机7，用于采集本装置实时位置数据的传感器，并且用于提供PPS秒脉冲信号；相机8，用于采集图像数据的传感器；板载差分晶振9，用于为本装置提供高精度时间信息；无线数传电台10，用于本装置装置远程通讯；本地磁盘11，用于储存本装置采集到的多传感器数据；高精度时间基准模块12，用于为本装置提供高精度时间；相机授时模块13，用于实现相机的数据采集和授时；激光雷达授时模块14，用于实现激光雷达5的数据采集和授时；GNSS接收机授时模块15，用于实现GNSS接收机7的数据采集和授时；惯性测量单元授时模块16，用于实现惯性测量单元6的数据采集和授时；数据接收与整合模块17，用于实现同步完成后多传感器数据的接收和整合；其中，基于多传感器数据同步采集装置的多传感器数据同步采集方法的过程如下：S1、高精度时间基准模块12启动，接收GNSS接收机7发送的PPS 秒脉冲信号与$GPRMC报文数据，同时接收板载差分晶振9发送的脉冲信号，高精度时间基准模块12内部解析$GPRMC报文数据提取UTC时间信息，同时对PPS秒脉冲信号和板载差分晶振9发送的脉冲信号进行脉冲计数，将脉冲计数值与UTC时间信息进行整合计算得到数据同步采集装置运行的实时高精度时间；S2、相机授时模块13启动，接收板载差分晶振9发送的脉冲信号与高精度时间基准模块12计算得到的实时高精度时间，对板载差分晶振9发送的脉冲信号进行分频后输出至相机8以触发相机8采集图像数据，同时相机授时模块13内部计算得到触发相机8采集数据的时刻作为图像数据对应的时间数据，将图像数据对应的时间数据储存于主控芯片2的ARM端4；S3、激光雷达授时模块14启动，接收GNSS接收机7发送的$GPRMC 报文数据与PPS秒脉冲信号，同时将PPS秒脉冲信号转发给激光雷达5，在激光雷达授时模块14内部对PPS秒脉冲信号进行监测同时缓存 $GPRMC报文数据，当激光雷达授时模块14监测到PPS秒脉冲上升沿后延时200ms后以9600bps波特率发送$GPRMC报文数据至激光雷达5；S4、GNSS接收机授时模块15启动，接收GNSS接收机7发送的 $GPRMC报文数据，解析报文中UTC时间信息与位置信息，将两者打包后储存于主控芯片2的ARM端4；S5、惯性测量单元授时模块16启动，接收板载差分晶振9发送的脉冲信号与高精度时间基准模块12计算得到的实时高精度时间，对板载差分晶振9发送的脉冲信号进行分频后输出至惯性测量单元6以触发惯性测量单元6采集数据，惯性测量单元6完成数据采集后，惯性测量单元授时模块16内部通过SPI协议读取数据，同时内部计算得到触发惯性测量单元6采集数据的时刻作为惯性测量单元数据对应的时间戳，将时间戳与对应惯性测量单元数据储存于主控芯片2的ARM端4；S6、数据接收与整合模块17启动，接收经过相机授时模块13、激光雷达授时模块14、GNSS接收机授时模块15、惯性测量单元授时模块16 授时后的传感器数据，对数据进行压缩后储存于本地磁盘11中。进一步地，所述主控芯片2为Xilinx公司的ZYNQ SOC系列，型号为XCZU3EG，集成双核1.3GHz的ARM Cortex-A53架构的CPU和 154K可编程逻辑单元的FPGA资源，内置USB3.0、Serial ATA、 1000Mbps以太网高速通讯接口控制器，同时内置I2C、SPI、UART低速串行通讯接口控制器。进一步地，所述激光雷达5型号为VLP-16，内部支持PPS+$GPRMC 授时模式，且扫描频率为20Hz；所述GNSS接收机7型号为NovAtel OEM- 718D，其内部PPS秒脉冲信号的时间精度为20ns RMS；所述惯性测量单元6型号为ADIS16480，支持主动触发数据采集模式；所述相机8型号为迈德威视MVSUA202GC-T，支持主动触发数据采集模式；所述板载差分晶振9型号为SIT9121AI，频率为100MHz，频率稳定度为±10ppm；所述无线数传电台10型号为Microhard pMDDL2450。进一步地，无线数传电台10使用100Mbps以太网连接到主控芯片2 的ARM端4以作为测绘仪远程通讯工具，同时将其接收到的差分定位数据通过UART协议的串口发送给GNSS接收机7，协助GNSS接收机7实现差分定位功能。进一步地，GNSS接收机7使用UART协议传输报文数据，由于高精度时间基准模块12的建立以及多个传感器的授时由FPGA端3实现，而这些功能的实现需要使用到GNSS接收机7获取到的时间报文信息，故将 GNSS接收机7的数据通道接入FPGA端3，在FPGA端3使用自定义IP 实现UART协议的驱动，实时接收GNSS接收机7获取到的时间及定位报文数据。进一步地，激光雷达5使用100Mbps以太网传输数据，但同时需要使用PPS信号与UART协议的UTC时间报文数据进行授时，故激光雷达 5数据通道接入ARM端4的100Mbps以太网接口，而授时通道接入FPGA 端3，由FPGA端3为其发送PPS信号与UTC时间报文数据。进一步地，惯性测量单元6使用SPI协议传输数据，同时其具备外部信号触发采集功能，因此在FPGA端3发送定频率的脉冲触发信号至惯性测量单元6使其采集数据，并自定义IP实现SPI协议驱动，用于接收惯性测量单元6采集到的数据。进一步地，相机8使用USB3.0协议传输图像数据，同时其也具备外部信号触发采集功能，但由于在ARM端4较易实现USB3.0驱动，故其触发信号由FPGA端3给出，而图像数据接收由ARM端4的USB3.0驱动完成。进一步地，FPGA端3与ARM端4通过主控芯片2内置的AXI协议的总线进行数据交互。最终，FPGA端3采集到的所有传感器数据均由 AXI总线发送至ARM端4，由ARM端4的数据接收与整合模块17进行整合、储存和下传。进一步地，所述高精度时间基准模块12用于为本装置的多种传感器授时提供高精度的时间基准。该模块利用FPGA端3自定义IP核实现。该模块输入GNSS接收机7产生的PPS秒脉冲信号和$GPRMC报文数据以及板载差分晶振9产生的高频率脉冲信号，其中$GPRMC报文数据中可以提取到当前的UTC时间信息，而PPS秒脉冲的上升沿即表示了UTC 时间中的一个整秒时刻。GNSS接收机7在成功搜到4颗及以上卫星时，其PPS秒脉冲信号不断受到GNSS卫星时间修正，具有很高的长期稳定度，而板载差分晶振9可输出100MHz的高频脉冲信号，其在短时间内具有很高的时间精确度。进一步地，基于多传感器数据同步采集装置的多传感器数据同步采集方法的过程中对于S1步骤有以下更详尽的描述：高精度时间基准模块12将根据上述输入的数据信息进行计算，得到本装置运行的实时时间基准。首先该模块进行初始化，包括两个步骤，步骤一为创建板载差分晶振脉冲计数器和秒级时间计数器，其中板载差分晶振脉冲计数器用于对板载差分晶振9输入的脉冲进行计数，而秒级计数器则用于对PPS秒脉冲进行计数，步骤二为接收$GPRMC报文并解析其中UTC时间的时分秒时间信息并将时分秒信息转化为总秒数以此初始化秒级时间计时器。然后该模块对板载差分晶振9输入的脉冲进行计数，以获取单位为10ns的时间计数值，同时该模块将持续监测输入的PPS秒脉冲信号的跳变沿，当PPS秒脉冲产生上升沿时，说明一个完整UTC时间的秒时刻开始，此时将板载差分晶振脉冲计数器清零，同时将秒级时间计数器累加一秒，板载差分晶振脉冲计数器将从零开始继续计时。最后将板载差分晶振脉冲计数器与秒级时间计数器进行整合累加，秒级时间计数器的计数值表示了当前UTC时间的秒级总时间，而板载差分晶振脉冲计数器得到的就是当前秒时刻开始到下一秒时刻开始之间经过的时间，由于计数值理论单位为10ns，从理论上得到10ns精度的UTC总时间基准。由于PPS秒脉冲信号在GNSS接收机7成功搜星的情况下没有累计误差，因此该模块通过使用PPS秒脉冲信号来不断校准板载差分晶振9的方式消除板载差分晶振脉冲计数器的累计误差，另外，由于该模块运行于 FPGA端3，因此该模块的运行具备硬实时性和并行性，板载差分晶振脉冲计数器和秒级时间计数器同时并行运行并实时计算总时间，最终得到了实时的10ns精度的UTC总时间基准。该时间基准作为数据同步采集装置运行的实时时间基准以及为其他传感器提供授时的时间基准。进一步地，所述相机授时模块13，将用于采集相机8的图像数据并为相机8的图像数据授时。该模块输入高精度时间基准模块12提供的高精度的时间信息以及板载差分晶振9输出的高频脉冲信号，通过对高频脉冲信号分频产生用于触发相机8采集数据的脉冲信号，同时通过高精度时间基准模块12提供的高精度的时间信息来准确记录触发相机8采集数据的时刻来实现对相机8的图像数据授时。进一步地，基于多传感器数据同步采集装置的多传感器数据同步采集方法的过程中对于S2步骤有以下更详尽的描述：相机授时模块13启动后，将对板载差分晶振9输出的高频脉冲信号进行分频得到10Hz的脉冲信号输出至相机8，相机8在收到10Hz脉冲信号的上升沿时开始采集图像数据，同时该模块实时监测10Hz的脉冲信号的上升沿，当上升沿到来时利用高精度时间基准模块12提供的高精度的时间信息来记录上升沿的时刻，记录完毕后将该时刻对应的时间数据通过AXI总线发送至ARM端4， ARM端4在收到时间数据后启动USB3.0驱动以接收相机8采集到的图像数据，以此完成一次相机8数据的采集与授时。相机授时模块13运行于FPGA端3，因此该模块的运行具备硬实时性和并行性，且该模块可输出10Hz的脉冲触发信号以稳定触发相机8采集数据，同时该模块可实时监测脉冲上升沿产生的时刻，该时刻对应了相机 8开始采集图像数据的时刻。由此，该模块从技术方案和工作原理上实现了采集相机8的图像数据并为相机8的图像数据授时的功能。进一步地，所述激光雷达授时模块14，将用于为激光雷达5的三维距离数据授时。该模块将输入GNSS接收机7所提供的$GPRMC报文数据与 PPS秒脉冲信号，输出符合激光雷达5授时要求的授时信号以完成授时。根据激光雷达5的数据手册，对激光雷达5授时需要同时使用PPS秒脉冲信号和$GPRMC报文数据，且对PPS信号和报文数据间的发送时序和电平有具体的要求，激光雷达5接收5V电平逻辑的PPS信号与$GPRMC报文数据，$GPRMC报文数据需要在PPS信号上升沿之后的至少50ms后发送，且需要在下一个PPS上升沿到来前的300ms内发送完毕，PPS信号的高电平时间保持在10μs至200ms之间，另外$GPRMC报文数据通过9600bps 波特率的UART协议发送，且根据UART协议可知此处5V电平代表逻辑 0而0V电平代表了逻辑1。由于FPGA端3为1.8V电平逻辑而授时信号为5V电平逻辑，因此使用MAX13035EETE型号的电平逻辑转换芯片对授时信号进行电平转换，同时在该模块内对发送$GPRMC报文数据的信号通路进行电平反转，以适配授时信号逻辑电平的要求。进一步地，基于多传感器数据同步采集装置的多传感器数据同步采集方法的过程中对于S3步骤有以下更详尽的描述：激光雷达授时模块14启动，该模块首先监测来自GNSS接收机7的PPS脉冲信号上升沿，同时通过UART协议来接收$GPRMC报文数据并缓存进入数据队列，然后当模块监测到PPS信号的上升沿时，根据激光雷达5的授时要求，为保证授时成功，模块将开始进行延时操作，等待延时200ms后将从$GPRMC报文的缓存数据队列中拿出最新且完整的一帧$GPRMC报文，设置9600bps的波特率，使用UART协议将其发送给激光雷达5，完成一次授时。激光雷达 5完成授时后，其数据及时间戳可从UDP数据包中获取，利用ARM端4 的100Mbps以太网接口接收UDP数据包，储存于本地磁盘11。激光雷达授时模块14启动运行于FPGA端3，因此该模块的运行具备硬实时性和并行性，且该模块将对输入的GNSS接收机7的PPS脉冲信号和$GPRMC报文数据进行计算与处理，输出符合激光雷达5授时要求的授时信号。由此，该模块从技术方案和工作原理上实现了激光雷达5的三维距离数据授时的功能。进一步地，所述GNSS接收机授时模块15将用于采集GNSS接收机 7的位置数据以及为该数据授时。该模块将输入GNSS接收机7发送的 $GPRMC报文数据并解析其中的位置信息与时间信息。当GNSS接收机7 成功搜星时，其$GPRMC报文数据中将包含UTC时间信息，且该UTC时间的更新与PPS秒脉冲信号同步，即PPS秒脉冲信号的上升沿代表了该 UTC时间的一个秒时刻的开始，因此该UTC时间信息可以作为其对应的 $GPRMC报文数据中位置信息的时间戳。进一步地，基于多传感器数据同步采集装置的多传感器数据同步采集方法的过程中对于S4步骤有以下更详尽的描述：GNSS接收机授时模块15启动，该模块利用UART协议接收$GPRMC报文，然后在模块内对$GPRMC报文进行解析，提取其中的位置信息数据与对应的UTC时间信息数据，将两种数据整合后通过AXI总线发送至ARM端4，ARM端4在接收到数据后保存至本地磁盘11，完成一次数据的采集。GNSS接收机授时模块15运行于FPGA端3，因此该模块的运行具备硬实时性和并行性，进一步，该模块对于$GPRMC报文的接收将不会产生遗漏与延迟，且可准确解析$GPRMC报文中的位置及时间信息数据。由此，该模块从技术方案和工作原理上实现了采集GNSS接收机7的位置数据以及为该数据授时的功能。进一步的，所述的惯性测量单元授时模块16，将用于采集惯性测量单元6的角速度与加速度数据并为这些数据授时。该模块输入高精度时间基准模块12提供的高精度的时间信息以及板载差分晶振9输出的高频脉冲信号，通过对高频脉冲信号分频产生用于触发惯性测量单元6采集数据的脉冲信号，同时通过高精度时间基准模块12提供的高精度的时间信息来准确记录触发惯性测量单元6采集数据的时刻来实现对惯性测量单元6的数据授时。进一步地，基于多传感器数据同步采集装置的多传感器数据同步采集方法的过程中对于S5步骤有以下更详尽的描述：惯性测量单元授时模块 16启动，首先该模块将对板载差分晶振9输出的高频脉冲信号进行分频得到2000Hz的脉冲信号输出至惯性测量单元6，惯性测量单元6在接收到脉冲信号的上升沿时开始采集数据，同时该模块实时监测2000Hz的脉冲信号的上升沿并在上升沿到来时利用高精度时间基准模块12提供的高精度的时间信息准确记录上升沿产生的时刻，惯性测量单元6在完成数据采集后将对该模块发送表示数据采集完毕的脉冲信号，该信号被该模块接收后，该模块将通过SPI协议从惯性测量单元6的寄存器中读取采集到的数据，该数据与触发该数据对应的脉冲信号的上升沿时刻一一对应，完成一次惯性测量单元6数据的采集与授时。惯性测量单元授时模块16运行于FPGA端3，因此该模块的运行具备硬实时性和并行性，且该模块可输出2000Hz的脉冲触发信号以稳定触发惯性测量单元6采集数据，同时该模块可实时监测脉冲上升沿产生的时刻，该时刻对应了惯性测量单元6开始采集数据的时刻。由此，该模块从技术方案和工作原理上实现了采集惯性测量单元6的数据并为数据授时的功能。本发明相对于现有的多传感器采集装置具有如下优点和效果：1、本发明利用主控芯片2的FPGA端3自行设计构建了高精度时间基准模块，该模块利用GNSS接收机7的PPS秒脉冲信号和板载差分晶振 9构建了时间基准，用于对多传感器进行授时，该时间基准具备高精度、实时性且无累计误差的特点。2、本发明对于相机8和惯性测量单元6的数据采集均采取了利用 FPGA端进行硬件主动触发且主动记录触发时刻的方式进行，相对于常规的软件触发采集，硬件触发采集的时延极低且可准确记录触发时刻。对于激光雷达5的数据，本发明自行设计FPGA端3的IP核以实现符合激光雷达5授时要求的授时信号，对激光雷达5进行主动授时，保证了激光雷达5数据时间的同步性和精确性。3、本发明的多传感器数据同步采集装置结合了主控芯片2中FPGA端 3和ARM端4两种计算资源，利用FPGA端3软件运行的高并发与硬实时性和ARM端4功能完备的驱动系统，自行设计了高精度时间基准模块 12、相机授时模块13、激光雷达授时模块14、GNSS接收机授时模块15、惯性测量单元授时模块16以及数据接收与整合模块17，上述模块综合作用，对多传感器进行同步控制和数据采集，保证了多传感器数据采集的精确性和实时性，ARM端与FPGA端的结合，优势互补，从根本上解决了常规纯软件采集系统中采集数据时间精确度低的问题。4、本发明的多传感器数据同步采集装置具备可拓展性，可拓展性体现在该装置中多数传感器的授时及数据采集模块均接入到了主控芯片2的 FPGA端3，而FPGA的一大特点即为硬件可灵活编程，通过自行设计FPGA 上运行的IP核，可适配使用各类不同协议进行数据传输的传感器。如UDP、 SPI、UART、IIC、MIPI协议等，均可通过FPGA编程自行实现，这样灵活的设计方式使得本采集装置可拓展集成其他所需要的传感器。附图说明此处所说明的附图用来提供对本发明的进一步理解，构成本申请的一部分，本发明的示意性实施例及其说明用于解释本发明，并不构成对本发明的不当限定。在附图中：图1是本发明公开的一种基于ZYNQ实现的多传感器数据同步采集装置的结构图；图2是本发明公开的一种基于ZYNQ实现的多传感器数据同步采集装置中硬件设备集成示意图；图3是本发明公开的一种基于ZYNQ实现的多传感器数据同步采集装置运行时的各类信号和数据流向示意图；图4是本发明公开的一种基于ZYNQ实现的多传感器数据同步采集装置中高精度时间基准模块工作流程图；图5是本发明公开的一种基于ZYNQ实现的多传感器数据同步采集装置中相机授时模块工作流程图；图6是本发明公开的一种基于ZYNQ实现的多传感器数据同步采集装置中惯性测量单元授时模块工作流程图；图7是本发明公开的一种基于ZYNQ实现的多传感器数据同步采集装置中激光雷达授时信号示意图；图8是本发明公开的一种基于ZYNQ实现的多传感器数据同步采集装置中激光雷达授时模块工作流程图；图9是本发明公开的一种基于ZYNQ实现的多传感器数据同步采集装置中相机数据序列号与对应时间戳的关系图；图10是本发明公开的一种基于ZYNQ实现的多传感器数据同步采集装置中相机采集的每组数据的时间间隔分布图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。实施例1本实施例公开了一种基于ZYNQ的多传感器数据同步采集装置及采集方法，图1为本装置结构图，如图1所示，基于ZYNQ的多传感器数据同步采集装置，包括：硬件设备载板1，由电路板构成，用于集成多种硬件设备2，保证硬件设备电气系统的稳定运行；硬件设备2，包括：主控芯片2，与硬件设备载板1相连，用于控制多传感器数据同步采集装置工作，为Xilinx公司的ZYNQ SOC系列，型号为XCZU3EG，其集成了双核1.3GHz的ARMCortex-A53架构的CPU和 154K可编程逻辑单元的FPGA资源，内置如USB3.0、Serial ATA、1000Mbps以太网等高速通讯接口控制器，也内置如I2C、SPI、UART等低速串行通讯接口控制器；激光雷达5，其型号为VLP-16，其内部支持 PPS+$GPRMC授时模式，与硬件设备载板1相连，用于采集数据的传感器；惯性测量单元6，其型号为ADIS16480，支持主动触发数据采集模式，与硬件设备载板1相连，用于采集数据的传感器；GNSS接收机7，其型号为NovAtelOEM-718D，与硬件设备载板1相连，用于采集数据的传感器，并且可用于提供PPS秒脉冲信号；相机8，型号为迈德威视 MVSUA202GC-T，支持主动触发数据采集模式，用于采集数据的传感器；板载差分晶振9，焊接于硬件设备载板1之上，其型号为SIT9121AI，其频率为100MHz，频率稳定度为±10ppm，用于为多传感器数据同步采集装置提供高精度时间信息，辅助多传感器数据同步采集；无线数传电台10，与硬件设备载板1相连，其型号为MicrohardpMDDL2450，用于多传感器数据同步采集装置远程通讯；本地磁盘11，与硬件设备载板1相连，用于储存多传感器数据同步采集装置采集到的多传感器数据。图2为本装置硬件设备集成示意图，如图2所示，其中虚线表示了时间同步信号，而实线表示数据流。硬件设备2将根据如下方式集成至硬件设备载板1：无线数传电台10将使用100Mbps的以太网与主控芯片2的ARM端 4相连，以用于远程控制本装置以及为GNSS接收机7提供差分定位数据，以实现GNSS接收机7的RTK定位功能；GNSS接收机7使用UART协议传输报文数据，将GNSS接收机7的数据通道接入FPGA端3，在FPGA端3使用自定义IP实现UART协议的驱动，实时接收GNSS接收机7获取到的时间及定位报文数据；激光雷达5使用100Mbps以太网UDP协议传输数据，同时需要使用PPS信号与UART协议的UTC时间报文数据进行授时，激光雷达5的数据通道通过100Mbps以太网接入ARM端4，而授时通道接入FPGA端3；惯性测量单元6使用SPI协议传输数据且具备外部脉冲信号触发采集功能，在FPGA端3自定义IP实现SPI协议驱动以接收惯性测量单元6的数据；相机8使用USB3.0协议传输数据，同时其也具备外部脉冲信号触发采集功能，其触发信号由FPGA端3给出，而数据接收由ARM端4的USB3.0驱动完成；主控芯片2上的FPGA端3 和ARM端4的数据交互通过主控芯片2内置AXI总线实现，在FPGA端 3实现的各类传感器同步控制模块采集到传感器数据后将通过AXI总线传输至ARM端4保存。图3为本装置运行时的各类信号和数据流向示意图，以下将基于该图描述多传感器数据同步采集装置的采集方法的过程：首先本装置上电后GNSS接收机7开始启动并进行搜星过程，在成功获取卫星信号后GNSS接收机7可输出准确的定位报文数据以及无积分误差的PPS秒脉冲信号，PPS秒脉冲信号的一个上升沿即表示了UTC时间中的一个整秒时刻。接着高精度时间基准模块12开始运行，图4为高精度时间基准模块工作流程图，该模块进行两步初始化，第一步为创建板载差分晶振脉冲计数器以及PPS秒脉冲计数器，两个计数器分别对板载差分晶振9的脉冲以及PPS的秒脉冲进行计数，第二步为接收GNSS接收机7的 $GPRMC报文并解析其中的UTC时间信息，根据UTC时间的时分秒信息将其换算为总秒数以初始化PPS秒脉冲计数器的值。然后该模块对板载差分晶振9输入的脉冲进行计数，同时监测PPS秒脉冲信号的上升沿，当 PPS秒脉冲信号的上升沿到来时，PPS秒脉冲信号计数值加1，同时清空板载差分晶振脉冲计数器以表示当前一个整秒时刻已经到来。PPS秒脉冲计数器的值表示了当前UTC时间的秒级总时间，而板载差分晶振脉冲计数器的值表示了当前秒开始到下一秒开始之间经过的时间，最后将板载差分晶振脉冲计数器的值与PPS秒脉冲计数器的值进行单位换算后累加，得到当前UTC总时间基准。接着高精度时间基准模块建立完毕后，各类传感器授时模块同时开始工作，如下为各传感器授时模块的具体工作过程。相机授时模块13具体工作过程：如图5所示为相机授时模块工作流程图，相机授时模块13输入板载差分晶振9产生的脉冲信号，将其进行分频后得到10Hz的脉冲信号，将该脉冲信号输出至相机8以在脉冲信号的上升沿触发相机8采集图像数据，同时该模块利用高精度时间基准模块12 的时间信息，准确记录脉冲信号的上升沿时刻，称为时间数据。在得到时间数据后将其通过AXI总线发送至ARM端4指定的内存地址空间，ARM 端4收到上升沿时刻的时间数据后启动USB3.0驱动以接收相机8采集到的图像数据，将图像数据与时间数据整合后保存至本地磁盘11，完成一次采集过程。惯性测量单元授时模块16具体工作过程：如图6所示为惯性测量单元授时模块工作流程图。惯性测量单元授时模块16首先配置惯性测量单元6工作于外部脉冲触发采集模式，然后将输入的板载差分晶振9产生的脉冲信号进行分频后得到2000Hz的脉冲信号并输出至惯性测量单元6，同时该模块利用高精度时间基准模块12的时间信息准确记录脉冲信号上升沿的时刻。惯性测量单元6在感知到脉冲信号的上升沿时开始采集数据，等待数据采集完毕后，惯性测量单元6对该模块返回一个脉冲信号，该模块感知到脉冲信号后通过SPI协议接收惯性测量单元6采集到的数据，并将数据对应的脉冲上升沿时刻一同通过AXI总线发送至ARM端4，ARM 端4在接收到数据后保存，完成一次采集过程。激光雷达授时模块14具体工作过程：激光雷达5的授时信号要求如图7所示，可知激光雷达5需要PPS秒脉冲信号以及$GPRMC报文数据进行授时，且授时信号之间的时序有着明确的要求，图8为激光雷达授时模块工作流程图。该模块输入GNSS接收机7的PPS秒脉冲信号以及 $GPRMC报文，首先该模块对$GPRMC报文数据在模块内利用数据队列进行缓存处理，同时该模块监测PPS秒脉冲信号，在秒脉冲信号的上升沿到来时开始延时，等待延时200ms后，将最新一帧的$GPRMC报文数据从数据队列中取出并设置9600bps的波特率，通过UART协议发送至激光雷达5完成激光雷达5的授时。GNSS接收机授时模块15具体工作过程：该模块通过UART协议实时接收GNSS接收机7发送的$GPRMC数据报文，并解析报文中的位置信息以及时间信息，将其进行整合后发送至ARM端保存，完成一次授时过程。最后，当各传感器授时模块对传感器数据进行授时后，位于ARM端 4的数据接收与整合模块17开始运行，该模块将采用多线程编程，同时相机授时模块13、激光雷达授时模块14、GNSS接收机授时模块15、惯性测量单元授时模块16授时后的传感器数据进行接收与整合，将数据储存于本地磁盘11。综上所述，本发明使用Xilinx公司的ZYNQ系列SOC作为主控芯片，该芯片集成了FPGA与ARM两类计算资源，将多传感器时间同步控制软件集成于ZYNQ的FPGA端，利用FPGA的并发处理能力和硬实时性对多传感器进行时间同步控制，同时利用ARM端集成的丰富硬件资源配合功能完备的Linux系统，实现数据的灵活整合、处理和下传。实施例2本实施例公开了通过基于ZYNQ的多传感器数据同步采集装置对相机8进行数据采集与授时的实际实验及结果分析，以本实施例补充说明本发明的实际技术效果。依据实施例1，等待高精度时间基准模块12建立完毕后，本装置中的相机授时模块13开始运行，并以理论10Hz脉冲频率对相机8进行触发以及对相机数据进行授时，图9是在一次实际采集过程中所获得的相机8数据序列号与对应时间戳的关系图，其中数据序列号是根据本装置采集到的图像数据到达ARM端4的实际时间先后次序排序所得，而时间戳则表示了图像数据对应的时间数据。由图9可以看出，随着相机8数据不断采集，其数据对应的时间戳不断延续，呈现线性变化，说明相机授时模块13稳定工作且成功对相机数据进行了授时。进一步地，为了验证相机授时模块13对相机数据授时的有效性，相邻两个序列号的图像数据为一组数据，一组数据中的两帧数据的时间差称为该组数据的时间间隔，则图10是相机采集的每组数据的时间间隔分布图，由图也可以看出，每组数据的时间间隔稳定在100000μs和100002μs之间，并无漂移趋势，说明±10ppm频率稳定度的板载差分晶振9可正常工作且相机授时模块13对相机数据的授时是有效的。上述实施例为本发明较佳的实施方式，但本发明的实施方式并不受上述实施例的限制，其他的任何未背离本发明的精神实质与原理下所作的改变、修饰、替代、组合、简化，均应为等效的置换方式，都包含在本发明的保护范围之内。
