标题title
一种通用的商品价签图像识别方法及处理设备
摘要abst
本发明公开一种通用的商品价签图像识别方法及处理设备，涉及图像识别技术领域，解决了商品价签识别方法难以适用不同价签样式的技术问题。该方法包括以下步骤：获取商品价签的原始图像，得到至少一个待识别价签图像；通过价格文本块检测模型对待识别价签图像中的价格进行识别，得到商品的第一价格信息；通过价签模板库匹配待识别价签图像，对价格字段框、非价格字段框的文本块进行识别，得到商品的第二价格信息及非价格信息；以第一价格信息或第二价格信息作为商品的价格信息，与非价格信息一起生成商品价签图像的识别信息。本发明可识别任意样式商品价签的价格信息，通过价签模板库匹配可识别价格以外的其他字段信息，通用性好，效率高。
权利要求书clms
1.一种通用的商品价签图像识别方法，其特征在于，包括以下步骤：S100：获取包含有至少一个商品价签的原始图像，通过价签检测模型获取全部的原始价签图像的顶点，经过透视变换进行矫正后得到至少一个待识别价签图像；S200：通过价格文本块检测模型对所述待识别价签图像中的价格进行识别，若识别出价格文本信息，得到商品的第一价格信息；S300：通过价签模板库匹配所述待识别价签图像，经处理后获得所述待识别价签图像的价格字段框和非价格字段框，对所述价格字段框、非价格字段框的文本块进行识别，得到商品的第二价格信息及非价格信息；S400：以所述第一价格信息或第二价格信息作为商品的价格信息，与所述非价格信息一起生成商品价签图像的识别信息。2.根据权利要求1所述的一种通用的商品价签图像识别方法，其特征在于，所述S100中，所述价签检测模型通过以下方法得到：获取包含有至少一个商品价签的多个所述原始图像，对每个所述原始图像中的每个所述商品价签进行顶点的标注，并使用深度学习目标检测方法进行模型训练得到所述价签检测模型；所述S200中，所述价格文本块检测模型通过以下方法得到：采集多个所述原始价签图像，在商品价格位置进行价格文本块的矩形框标注，并使用深度学习目标检测方法进行模型训练得到所述价格文本块检测模型。3.根据权利要求1所述的一种通用的商品价签图像识别方法，其特征在于，所述S200具体包括以下步骤：S210：通过价格文本块检测模型获取所述待识别价签图像的价格文本框，并进行检测；S220：若检测结果为空，则当前的所述待识别价签图像无价格识别结果，否则保留置信度最大的所述价格文本框，执行S230；S230：从所述价格文本框中提取价格文本块图像进行OCR识别，得到价格识别结果，作为商品的所述第一价格信息。4.根据权利要求1所述的一种通用的商品价签图像识别方法，其特征在于，所述S300具体包括以下步骤：S310：从所述价签模板库中确定与所述待识别价签图像相匹配的价签模板，得到目标价签模板；S320：计算将所述目标价签模板与所述待识别价签图像对齐的缩放比例，将所述价签模板上各字段的矩形框进行坐标缩放变换，获得所述待识别价签图像的所述价格字段框、非价格字段框；S330：分别提取所述价格字段框、非价格字段框的文本块图像进行OCR识别，获得商品的所述第二价格信息及非价格信息。5.根据权利要求4所述的一种通用的商品价签图像识别方法，其特征在于，所述S310步骤中，所述目标价签模板通过以下方法确定：S311：若所述待识别价签图像为设定场景，直接从所述价签模板库中选择相匹配的价签模板作为所述目标价签模板，否则执行S312；S312：将所述待识别价签图像分别与所述价签模板库中的全部价签模板计算图像相似度，如最高的图像相似度大于设定阈值，则其对应的所述价签模板为所述目标价签模板。6.根据权利要求5所述的一种通用的商品价签图像识别方法，其特征在于，所述S310步骤中，所述价签模板库中的所述价签模板通过以下方法确定：选择每个厂商每种样式的规整原始价签图像作为标准的价签模板图像，并对每一个字段的内容进行矩形框位置标注，得到所述价签模板。7.根据权利要求5所述的一种通用的商品价签图像识别方法，其特征在于，所述S312中，当最高的图像相似度小于或等于所述设定阈值，所述待识别价签图像无法正常识别时，对所述待识别价签图像进行人工审核，判断是否达到识别要求；若是，对所述待识别价签图像的每一个字段的内容进行矩形框位置标注，得到新的价签模板并送入所述价签模板库，再重新进行识别；否则，重新采集所述待识别价签图像所对应商品价签的原始图像，执行所述S100步骤。8.根据权利要求1所述的一种通用的商品价签图像识别方法，其特征在于，所述S300中，所述非价格字段框包括名称字段框、产地字段框、规格字段框中的至少一种。9.根据权利要求1所述的一种通用的商品价签图像识别方法，其特征在于，所述S400中，商品的价格信息通过以下方法确定：当所述第一价格信息、第二价格信息同时存在时，以所述第一价格信息作为商品的价格信息；当所述价格文本块检测模型未检测得到所述第一价格信息时，以所述第二价格信息作为商品的价格信息。10.一种处理设备，其特征在于，包括：一个或多个处理器；存储器，用于存储一个或多个计算机程序，一个或多个所述处理器用于执行所述存储器存储的一个或多个计算机程序，以使一个或多个所述处理器执行如权利要求1-9任一项所述的一种通用的商品价签图像识别方法。
说明书desc
技术领域本发明涉及图像识别技术领域，尤其涉及一种通用的商品价签图像识别方法及处理设备。背景技术在实体零售过程中，厂商往往需要进行市场稽查或者对零售户销售情况进行监督，其中一项要求是判断陈列的价签是否与商品对应，因此需要对价签内容进行识别。现有的方案一般是厂商雇佣客户经理巡店进行人工现场确认，或者由客户经理或者店员拍照上传至厂商平台进行后台人工审核，但是由于价签数量非常多，所以人工成本较高且容易出错。由此出现了一种基于图像识别的替代方案，客户经理或者店员将商品的及对应的价签照片上传至厂商平台，由图像识别算法进行价签识别，省去人工参与。但对于算法提供商而言，由于面对的是很多不同的厂商，不同厂商的价签样式和识别需求又不尽相同，有的只需要识别价格，有的还需要识别商品名称、产地甚至更多的字段，因此很难设计一种通用的识别方法实现对所有价签的识别。由于商品价签样式的多样性和复杂性，训练一个多类目标检测模型同时检测所有的字段文本块几乎是不可能的，而如果采用传统的OCR检测识别+后处理的方案，对哪些文本块属于哪个字段的难度也是显而易见的，从而大大影响商品价签识别的准确性和效率。在实现本发明过程中，发明人发现现有技术中至少存在如下问题：现有的商品价签识别方法难以适用不同商品不同类型的价签样式，导致识别的准确率和效率较低。发明内容本发明的目的在于提供一种通用的商品价签图像识别方法及处理设备，以解决现有技术中存在的商品价签识别方法难以适用不同商品不同类型的价签样式，导致识别的准确率和效率较低的技术问题。本发明提供的诸多技术方案中的优选技术方案所能产生的诸多技术效果详见下文阐述。为实现上述目的，本发明提供了以下技术方案：本发明提供的一种通用的商品价签图像识别方法，包括以下步骤：S100：获取包含有至少一个商品价签的原始图像，通过价签检测模型获取全部的原始价签图像的顶点，经过透视变换进行矫正后得到至少一个待识别价签图像；S200：通过价格文本块检测模型对所述待识别价签图像中的价格进行识别，若识别出价格文本信息，得到商品的第一价格信息；S300：通过价签模板库匹配所述待识别价签图像，经处理后获得所述待识别价签图像的价格字段框和非价格字段框，对所述价格字段框、非价格字段框的文本块进行识别，得到商品的第二价格信息及非价格信息；S400：以所述第一价格信息或第二价格信息作为商品的价格信息，与所述非价格信息一起生成商品价签图像的识别信息。优选的，所述S100中，所述价签检测模型通过以下方法得到：获取包含有至少一个商品价签的多个所述原始图像，对每个所述原始图像中的每个所述商品价签进行顶点的标注，并使用深度学习目标检测方法进行模型训练得到所述价签检测模型；所述S200中，所述价格文本块检测模型通过以下方法得到：采集多个所述原始价签图像，在商品价格位置进行价格文本块的矩形框标注，并使用深度学习目标检测方法进行模型训练得到所述价格文本块检测模型。优选的，所述S200具体包括以下步骤：S210：通过价格文本块检测模型获取所述待识别价签图像的价格文本框，并进行检测；S220：若检测结果为空，则当前的所述待识别价签图像无价格识别结果，否则保留置信度最大的所述价格文本框，执行S230；S230：从所述价格文本框中提取价格文本块图像进行OCR识别，得到价格识别结果，作为商品的所述第一价格信息。优选的，所述S300具体包括以下步骤：S310：从所述价签模板库中确定与所述待识别价签图像相匹配的价签模板，得到目标价签模板；S320：计算将所述目标价签模板与所述待识别价签图像对齐的缩放比例，将所述价签模板上各字段的矩形框进行坐标缩放变换，获得所述待识别价签图像的价格字段框、非价格字段框；S330：分别提取所述价格字段框、非价格字段框的文本块图像进行OCR识别，获得商品的所述第二价格信息及非价格信息。优选的，所述S310步骤中，所述目标价签模板通过以下方法确定：S311：若所述待识别价签图像为设定场景，直接从所述价签模板库中选择相匹配的价签模板作为所述目标价签模板，否则执行S312；S312：将所述待识别价签图像分别与所述价签模板库中的全部价签模板计算图像相似度，如最高的图像相似度大于设定阈值，则其对应的所述价签模板为所述目标价签模板。优选的，所述S310步骤中，所述价签模板库中的所述价签模板通过以下方法确定：选择每个厂商每种样式的规整原始价签图像作为标准的价签模板图像，并对每一个字段的内容进行矩形框位置标注，得到所述价签模板。优选的，所述S312中，当最高的图像相似度小于或等于所述设定阈值，所述待识别价签图像无法正常识别时，对所述待识别价签图像进行人工审核，判断是否达到识别要求；若是，对所述待识别价签图像的每一个字段的内容进行矩形框位置标注，得到新的价签模板并送入所述价签模板库，再重新进行识别；否则，重新采集所述待识别价签图像所对应商品价签的原始图像，执行所述S100步骤。优选的，所述S300中，所述非价格字段框包括名称字段框、产地字段框、规格字段框中的至少一种。优选的，所述S400中，商品的价格信息通过以下方法确定：当所述第一价格信息、第二价格信息同时存在时，以所述第一价格信息作为商品的价格信息；当所述价格文本块检测模型未检测得到所述第一价格信息时，以所述第二价格信息作为商品的价格信息。一种处理设备，包括：一个或多个处理器；存储器，用于存储一个或多个计算机程序，一个或多个所述处理器用于执行所述存储器存储的一个或多个计算机程序，以使一个或多个所述处理器执行以上任一项所述的一种通用的商品价签图像识别方法。实施本发明上述技术方案中的一个技术方案，具有如下优点或有益效果：本发明通过价格文本块检测模型可以识别任意样式商品价签的价格信息，易用性和适用性强，同时，通过价签模板库匹配，可以对指定或特定样式的商品价签识别出价格以外的其他字段信息，实现了对不同商品不同样式的商品价签信息识别，从而提高了识别效率和准确率，通用性好。附图说明为了更清楚地说明本发明实施例的技术方案，下面将对实施例描述中所需要使用的附图作简单的介绍，显而易见，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图，附图中：图1是常见的商标价签样式示意图；图2是本发明实施例一中通用的商品价签图像识别方法的流程图；图3是本发明实施例一中S200步骤的具体流程图；图4是本发明实施例一中S300步骤的具体流程图；图5是本发明实施例一中S310步骤的具体流程图。具体实施方式为了使本发明的目的、技术方案及优点更加清楚明白，下文将要描述的各种示例性实施例将要参考相应的附图，这些附图构成了示例性实施例的一部分，其中描述了实现本发明可能采用的各种示例性实施例。除非另有表示，不同附图中的相同数字表示相同或相似的要素。以下示例性实施例中所描述的实施方式并不代表与本公开相一致的所有实施方式。应明白，它们仅是与如所附权利要求书中所详述的、本发明公开的一些方面相一致的流程、方法和装置等的例子，还可使用其他的实施例，或者对本文列举的实施例进行结构和功能上的修改，而不会脱离本发明的范围和实质。在本发明的描述中，需要理解的是，术语“中心”、“纵向”、“横向”等指示的是基于附图所示的方位或位置关系，仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的元件必须具有的特定的方位、以特定的方位构造和操作。术语“第一”、“第二”等仅用于描述目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量。术语“多个”的含义是两个或两个以上。术语“相连”、“连接”应做广义理解，例如，可以是固定连接、可拆卸连接、一体连接、机械连接、电连接、通信连接、直接相连、通过中间媒介间接相连，可以是两个元件内部的连通或两个元件的相互作用关系。术语“和/或”包括一个或多个相关的所列项目的任意的和所有的组合。对于本领域的普通技术人员而言，可以根据具体情况理解上述术语在本发明中的具体含义。为了说明本发明所述的技术方案，下面通过具体实施例来进行说明，仅示出了与本发明实施例相关的部分。实施例一：如图2所示，本发明提供了一种通用的商品价签图像识别方法，包括以下步骤。S100：获取包含有至少一个商品价签的原始图像，通过价签检测模型获取全部的原始价签图像的顶点，由于原始图像在拍摄过程中存在透视，尤其是原始图像中存在多个商品价签时，部分商品价签的透视效果更为明显，这种透视会影响到商品价签图像识别的准确性，经过透视变换进行矫正后，得到至少一个待识别价签图像，此时的待识别价签图像为规整的平视图像，便于准确识别。S200：通过价格文本块检测模型对待识别价签图像中的价格进行识别，价格文本块检测模型只对商品价签中的价格位置进行的标注，从而只获取商品的价格信息，若识别出价格文本信息，得到商品的第一价格信息。价格是商品价签中最重要，同时也是最显眼的信息，训练一个通用的价格文本块检测模型容易实现，且大多数商品价签中只有价格为数字信息，无其他数字信息，从而价格文本块检测模型不易受不同样式商品价签的影响，只需要一次训练即可识别几乎所有样式商品价签的价格，算法易用性和适用性强。S300：通过价签模板库匹配待识别价签图像，经处理后获得待识别价签图像的价格字段框和非价格字段框，对价格字段框、非价格字段框的文本块进行识别，得到商品的第二价格信息及非价格信息，即通过价签模板各个字段位置对价签各个字段的信息进行识别。S400：以第一价格信息或第二价格信息作为商品的价格信息，与非价格信息一起生成商品价签图像的识别信息。本发明通过价格文本块检测模型可以识别任意样式商品价签的价格信息，易用性和适用性强，同时，通过价签模板库匹配，可以对指定或特定样式的商品价签识别出价格以外的其他字段信息，实现了对不同商品不同样式的商品价签信息识别，提高了识别效率和准确率，通用性好。作为可选的实施方式，S100中，价签检测模型通过以下方法得到：获取包含有至少一个商品价签的多个原始图像，原始图像选取过程中，应选择不同的光照角度、拍摄角度、商品类型等，一个原始图像中一般有多个商品，从而对应多个商品价签，在同一个原始图像中最好还包括多种类型的商品价签样式，从而提高样本的代表性，使最终训练得到的价签检测模型能够检测识别出不同类型不同场景下的商品价签，提高识别的准确率。对每个原始图像中的每个商品价签进行顶点的标注，即对每个商品价签都进行顶点的标注，从而确定商品价签的轮廓，商品价签一般为长方形，进行标注的顶点数量优选为4个，确定4个顶点后即确认了商品价签的形状，具体的标注实现手段可为人工标注或自动标注，并使用深度学习目标检测方法进行模型训练得到价签检测模型。在模型训练过程中，具体的深度学习目标检测方法可以为centernet、yolo等，根据需要进行选择。S200中，价格文本块检测模型通过以下方法得到：采集多个原始价签图像，原始价签图像可通过S100中的原始图像中获取，也可以对商品价签进行单独拍摄得到，同样，为提高原始价签图像的代表性，选择多种不同格式的商品价签，以提高价格文本块检测模型识别的准确率，在商品价格位置进行价格文本块的矩形框标注，即只标注出价格数字所对应的矩形框，并使用深度学习目标检测方法进行模型训练得到价格文本块检测模型。在模型训练过程中，具体的深度学习目标检测方法也可以为centernet、yolo等，根据需要进行选择。作为可选的实施方式，S200用于只获取商品价签中的价格信息，如图3所示，具体包括以下步骤。S210：通过价格文本块检测模型获取待识别价签图像的价格文本框，并进行检测；S220：若检测结果为空，则当前的待识别价签图像无价格识别结果，对该待识别价签图像，可在标注后放入价格文本块检测模型的训练样本中，模型重新训练后即可实现对该待识别价签图像。若检测结果不为空，即待识别价签图像有价格识别结果时，保留置信度最大的价格文本框，执行S230；S230：从价格文本框中提取价格文本块图像进行OCR识别，获取到价格识别结果，作为商品的第一价格信息。OCR识别可以使用任意的通用OCR识别模型，也可根据商品价签的特定场景做进一步优化。作为可选的实施方式，如图4所示，S300具体包括以下步骤。S310：从价签模板库中确定与待识别价签图像相匹配的价签模板，得到目标价签模板；S320：计算将目标价签模板与待识别价签图像对齐的缩放比例，将价签模板上各字段的矩形框进行坐标缩放变换，获得待识别价签图像的价格字段框、非价格字段框；S330：分别提取价格字段框、非价格字段框的文本块图像进行OCR识别，获得商品的第二价格信息及非价格信息。作为可选的实施方式，S310步骤中，如图5所示，目标价签模板通过以下方法确定。S311：若待识别价签图像为设定场景，直接从价签模板库中选择相匹配的价签模板作为目标价签模板，这个时候，待识别价签图像所对应的价签模板是已知的，进行直接指定即可，省去了计算图像相似度的步骤，效率更高，否则执行S312；S312：将待识别价签图像分别与价签模板库中的全部价签模板计算图像相似度，如最高相似度大于设定阈值，则其对应的价签模板为目标价签模板。图像相似度的计算可以采用现有技术，如直方图比较、Harris算法、GLOH算法、SIFT算法等，根据需要选择即可，阈值也可结合不同的图像相似度计算方法、不同使用场景，根据需要进行设置。作为可选的实施方式，S310步骤中，价签模板库中的价签模板通过以下方法确定：选择每个厂商每种样式的规整原始价签图像作为标准的价签模板图像，每个厂商每种样式，确保了价签模板库中价签模板的多样性，提高识别的成功率，规整原始价签图像指不存在透视、遮挡、不清晰等瑕疵情况，从而使得价签模板的标注更为准确，更容易与待识别价签图像进行匹配，并对每一个字段的内容进行矩形框位置标注，从而可以得到多个字段的信息，得到价签模板。作为可选的实施方式，S312中，当最高的图像相似度小于或等于设定阈值，待识别价签图像无法正常识别时，主要有两种原因，一是待识别价签图像有瑕疵，需要重新获取原始价签图像，二是价签模板库中没有相匹配的模板，需要更新价签模板库。因此，对待识别价签图像进行人工审核，判断是否达到识别要求，即人能否快速识别出待识别价签图像中各个字段的信息，如果由于光照、遮挡原因人都无法识别，则需要重新获取清晰的原始价签图像。若待识别价签图像达到识别要求，价签模板库中没有相匹配的模板，对待识别价签图像的每一个字段的内容进行矩形框位置标注，得到新的价签模板并送入价签模板库，再重新进行识别，从而价签模板库中拥有该种样式的商品价签，再次对该待识别价签图像进行识别时就能够从价签模板库中得到相应的匹配结果因此，针对每种样式的商品价签只需要进行一次标注，可以将本发明的方法快速迁移到更多使用场景，适配更多用户的识别需求。若待识别价签图像不能满足识别要求时，重新采集待识别价签图像所对应商品价签的原始图像，执行S100步骤，重新采集时，避免出现光照、遮挡等因素的干扰，使待识别价签图像能够进行识别。作为可选的实施方式，S300中，非价格字段框包括名称字段框、产地字段框、规格字段框中的至少一种，其中商品名称、产地一般为价格以外最需要关注的字段信息，规格为商品的尺寸、型号、编号信息等，可根据不同的商品价签进行选择设置。当然，非价格字段还可以根据不同样式的商品标签或实际使用需要增加适当的字段，以拓展商品标签识别的功能，此处不再赘述。作为可选的实施方式，S400中，商品的价格信息通过以下方法确定：当第一价格信息、第二价格信息同时存在时，以第一价格信息作为商品的价格信息；当价格文本块检测模型未检测得到第一价格信息时，以第二价格信息作为商品的价格信息。从而价格信息优选为第一价格信息，第一价格信息为单独识别，确保了价格信息识别结果的准确性，也可以降低运算量。实施例仅是一个特例，并不表明本发明就这样一种实现方式。实施例二：本发明还提供一种处理设备实施例，包括一个或多个处理器及存储器；其中，所述存储器用于存储一个或多个计算机程序，所述一个或多个处理器用于执行存储器存储的一个或多个计算机程序，以使处理器执行上述的通用的商品价签图像识别方法实施例的特征/步骤。该设备可以识别任意样式商品价签的价格信息，易用性和适用性强，同时，通过价签模板库匹配，可以对指定或特定样式的商品价签识别出价格以外的其他字段信息，实现了对不同商品不同样式的商品价签信息识别，从而提高了识别效率和准确率，通用性好。以上所述仅为本发明的较佳实施例而已，本领域技术人员知悉，在不脱离本发明的精神和范围的情况下，可以对这些特征和实施例进行各种改变或等同替换。另外，在本发明的教导下，可以对这些特征和实施例进行修改以适应具体的情况及材料而不会脱离本发明的精神和范围。因此，本发明不受此处所公开的具体实施例的限制，所有落入本申请的权利要求范围内的实施例都属于本发明的保护范围。
