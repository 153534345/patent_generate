标题title
电动汽车与非车载充电机充电通信协议框架及其实现方法
摘要abst
本发明公开了一种电动汽车与非车载充电机充电通信协议框架及其实现方法，包括多个有序功能模块：版本协商、功能协商、参数配置、鉴权、预约、充电系统自检、预充及能量传输、充电结束；充电通信协议由框架内的所有必须项功能模块以及零个或多个可选项功能模块组成，同时支持可重载功能模块的一个或多个应用实例；不同版本的通信协议可以支持不同的可选项功能模块以及可重载功能模块的不同应用实例；遵循某个特定版本通信协议的车辆/充电机可以根据自身实现条件和需求，实现该版本通信协议支持的全部/部分功能；通过版本协商、功能协商，以及可选功能模块和可重载功能模块的灵活配置，实现充电通信协议对兼容性、扩展性、灵活性的需求。
权利要求书clms
1.一种电动汽车与非车载充电机充电通信协议框架，其特征在于：包括：版本协商模块、功能协商模块、参数配置模块、鉴权模块、预约模块、充电系统自检模块、预充及能量传输模块、充电结束模块所述；所述版本协商模块用于当车桩插枪完成及通信链路建立以后，充电机将自身支持的通信协议版本号发送给车辆，车辆将该版本号与其自身支持的版本号进行比对并返回协商结果：如果车辆返回协商成功，双方进入功能协商模块的信息交互过程；如果车辆返回“继续协商”并发送期望的版本号，双方将继续进行协商；如果车辆返回协商失败，双方退出充电通信过程；所述功能协商模块用于充电机将自身支持的功能模块及充电机支持的实例信息发送给车辆，车辆根据自身支持的功能模块及实例信息，并按照自定义的优先策略返回协商结果，每个功能模块只能返回一个实例信息；如果功能协商成功，双方进入参数配置模块，否则退出充电通信过程；所述参数配置模块用于充电机和车辆进行基本充电参数的匹配；如果基本充电参数匹配成功，双方进入鉴权模块，否则退出充电通信过程；所述鉴权模块用于车辆对充电机的身份进行单向识别和确认；充电机对车辆的身份进行单向识别和确认；充电机和车辆对彼此身份进行双向的识别和确认；如果身份鉴权成功双方进入预约模块，否则退出充电通信过程；所述预约模块用于仅车辆侧预约充电时间，由充电机侧确认后启动充电；仅充电机侧预约充电时间，由车辆侧确认后启动充电；车辆和充电机侧同时预约，双方协商后确认启动充电时间；如果预约成功，待预约充电时间到达后进入充电系统自检模块，否则退出充电通信过程；所述充电系统自检模块用于实现充电机在绝缘检测，短路检测，粘连检测操作过程中以及车辆电子锁的状态信息的交互和确认；如果充电系统自检成功，则进入预充和能量传输模块，否则退出充电通信过程；所述预充和能量传输模块用于交互避免充电机对电池组造成冲击所执行的相关操作过程中的信息，所述能量传输包括启动至结束充电的全过程；如果充电结束，退出充电通信过程或进入充电结束模块；所述充电结束模块用于充电机和车辆在能量传输结束后进行充电过程统计相关信息的交互；充电结束模块信息交互完成后，充电过程结束。2.根据权利要求1所述的电动汽车与非车载充电机充电通信协议框架，其特征在于：所述功能协商模块进行信息交互的前提是版本协商成功；所述参数配置模块进行信息交互的前提是功能协商成功；所述鉴权模块进行信息交互的前提是充电参数匹配成功；如果有鉴权模块，所述预约模块进行信息交互的前提是充电参数匹配成功且身份鉴权成功；如果有鉴权和/或预约模块，所述充电系统自检模块进行信息交互的前提是充电参数匹配成功且鉴权和/或预约成功；所述预充和能量传输模块进行信息交互的前提是充电系统自检成功；所述充电结束模块进行信息交互的前提是充电机或车辆主动结束充电。3.根据权利要求1所述的电动汽车与非车载充电机充电通信协议框架，其特征在于：所述鉴权模块、所述预约模块、所述充电结束模块均为通信协议框架的可选项。4.根据权利要求1所述的电动汽车与非车载充电机充电通信协议框架，其特征在于：所述鉴权模块、预约模块、充电系统自检模块、预充及能量传输模块、充电结束模块均为可重载功能模块，不同版本通信协议框架中的可重载功能模块对应不同应用实例。5.根据权利要求1所述的电动汽车与非车载充电机充电通信协议框架，其特征在于：所述鉴权模块的应用实例包括扫码/刷卡鉴权、VIN码鉴权、数字签名鉴权、云端交互鉴权、混合交互鉴权；预约模块的应用实例包括车端预约、桩端预约；充电系统自检模块应用实例包括常规充电充电系统自检、常规放电充电系统自检；预充及和能量传输模块的应用实例包括常规充电预约及能量传输、常规放电预约及能量传输、常规充放电切换预约及能量传输；充电结束模块的应用实例包括充电电量及时间统计充电结束、自定义信息统计充电结束。6.一种电动汽车与非车载充电机充电通信协议框架实现方法，其特征在于：包括步骤如下：步骤S1）车辆和充电机建立通信链接，进行版本协商功能模块信息交互，如果版本协商成功，进入S2，协商失败或协商超时进入S9；步骤S2）车辆和充电机进入功能协商功能模块信息交互，如果功能协商成功，进入S3，协商失败或协商超时进入S9；步骤S3）车辆和充电机进入参数配置功能模块的信息交互，如果参数匹配成功，进入S4，匹配失败或超时进入S9；步骤S4）车辆和充电机进入鉴权功能模块的“扫码/刷卡”FDC的信息交互，如果鉴权成功，进入S5，鉴权失败或超时进入S9；步骤S5）车辆和充电机在S2的功能协商结果为“无预约”，预约功能模块无信息交互，双方跳过该功能模块，进入S6；步骤S6）车辆和充电机进入充电系统自检模块的“常规充电”FDC的信息交互，如果自检成功，进入S7，自检失败或超时进入S9；步骤S7）车辆和充电机进入预充及能量传输的“常规充电”FDC的信息交互，充电结束后进入S8；步骤S8）车辆和充电机在S2的功能协商结果为无“充电结束”，充电结束功能模块无信息交互，双方跳过该功能模块，进入S9；步骤S9）车辆和充电机退出充电通信过程。7.根据权利要求6所述的电动汽车与非车载充电机充电通信协议框架实现方法，其特征在于：所述步骤S1具体步骤如下：充电机向车辆发送其支持的最高协议版本号，如果车辆支持该版本并确定以该版本进行通信，返回 “协商成功”信息给充电机；如果车辆不支持该版本且该版本低于车辆支持的最低版本，返回“协商失败”信息给充电机；如果车辆不支持该版本且该版本高于车辆支持的最低版本，将返回“继续协商”信息，连同期望的版本号一起返回给充电机；充电机接收到“继续协商”信息后，如果当前发送版本已是充电机支持的最低版本，继续发送当前版本，等待超时协商失败；如果充电机支持车辆期望的版本，则发送该版本号，协商成功；如果充电机不支持车辆期望的版本，则发送比当前版本低的最高版本，继续协商。8.根据权利要求6所述的电动汽车与非车载充电机充电通信协议框架实现方法，其特征在于：所述步骤S2具体步骤如下：充电机向车辆发送充电机实现的所有可重载功能模块的编码及应用实例编码，车辆接收后检查并确定最终的协商结果：如果在某个FC上双方能实现同一个FDC，则在该FC上协商成功；如果在某个FC上双方没有共同支持的FDC，则在该FC上协商失败；如果在某个FC上的支持多个共同FDC，由车辆按照自身的优先策略选择一个FDC并返回协商结果；只有当充电机和车辆在必须项功能模块上有共同的FDC，才能进行充电。9.根据权利要求6所述的电动汽车与非车载充电机充电通信协议框架实现方法，其特征在于：所述步骤S3具体步骤如下：充电机向车辆发送基本充电参数，车辆接收后回复充电保护阈值，同时按照以下原则检查充电参数是否匹配：整车充电系统当前电压低于充电机的最低输出电压；整车充电系统当前电压高于充电机的最高输出电压；通过以上参数配置，满足基本充电功能，充电配置成功；所述步骤S4具体步骤如下：充电机发送“充电机鉴权参数报文”，车辆回复“车辆鉴权等待报文”，并在规定时间内等待充电机完成扫码或刷卡，同时返回“充电机鉴权成功”信息；通过以上鉴权，充电机和车辆车桩之间身份鉴权成功，进入下一个步骤。10.根据权利要求6所述的电动汽车与非车载充电机充电通信协议框架实现方法，其特征在于：所述步骤S6具体步骤如下：充电机执行粘连检测、短路检测、绝缘检测操作，并将检测状态信息发送给车辆，车辆也将其电子锁的状态信息发送给充电机；通过充电系统自检，充电机自检成功，车辆电子锁锁止完好，双方进入下一个步骤；所述步骤S7具体步骤如下：在能量传输过程，充电机按车辆发送的需求电压、电流进行充电输出，同时充电机调整动态输出能力并告知车辆，车辆据此调整充电需求，完成充电过程；在能量传输过程中，无论是正常中止充电，还是异常中止充电，都进入S8。
说明书desc
技术领域本发明涉及一种电动汽车与非车载充电机充电通信协议框架及其实现方法，属于电动汽车通信控制技术领域。背景技术在电动汽车直流充电过程中，电动汽车与非车载传导式充电机按照所遵循的通信协议交互充电能力、充电需求，充电状态信息等，保证充电过程的有序进行，因此电动汽车与非车载充电机之间的充电通信协议是直流充电不可或缺的重要组成部分。目前国际主流的直流充电系统包括中国的GB2015，日本的CHAdeMO，欧美的CCS系统，不同系统遵循的充电通信协议各不相同，各有特点：日本采用CHAdeMO 2.0，属于轻量级通信协议，只定义了最基本的充电交互信息，实现简单，当前主要的问题是有新增充电功能时，不易扩展。欧美CCS系统采用ISO 15118通信协议框架，该框架不仅支持传导充电，还包括交流充电、无线充电、受电弓等各种应用，框架适用范围广，但也因为要适应不同的应用，修订频繁，协议版本众多，且因为其版本协商策略支持不同协议版本的车辆和充电机进行充电，协议兼容性问题严重。GB2015采用GB/T27930通信协议标准，按照常规的充电要求来定义充电信息交互过程，缺乏对新功能新应用的扩展；另外GB/T27930没有有效的版本协商策略，充电双方获取的版本信息不对称，车辆无法完成对充电机的版本识别，协议升级困难。电动汽车产业的蓬勃发展带来越来越多新场景新应用需求，如大功率充电、预约充电、放电等，原来基于单一服务方式的充电通信协议也逐步暴露出越来越多的不足。通过梳理国际上三种直流充电通信协议存在的优缺点，提出ChaoJi充电通信协议框架，满足当前新场景新需求对充电通信协议在兼容性，扩展性，灵活性上的需求。发明内容目的：为了克服现有技术中存在的不足，本发明提供一种电动汽车与非车载充电机充电通信协议框架及其实现方法。技术方案：为解决上述技术问题，本发明采用的技术方案为：一种电动汽车与非车载充电机充电通信协议框架，包括：版本协商模块、功能协商模块、参数配置模块、鉴权模块、预约模块、充电系统自检模块、预充及能量传输模块、充电结束模块。所述版本协商模块用于当车桩插枪完成及通信链路建立以后，充电机将自身支持的通信协议版本号发送给车辆，车辆将该版本号与其自身支持的版本号进行比对并返回协商结果：如果车辆返回协商成功，双方进入功能协商模块的信息交互过程；如果车辆返回“继续协商”并发送期望的版本号，双方将继续进行协商；如果车辆返回协商失败，双方退出充电通信过程。所述功能协商模块用于充电机将自身支持的功能模块及充电机支持的实例信息发送给车辆，车辆根据自身支持的功能模块及实例信息，并按照自定义的优先策略返回协商结果，每个功能模块只能返回一个实例信息。如果功能协商成功，双方进入参数配置模块，否则退出充电通信过程。所述参数配置模块用于充电机和车辆进行基本充电参数的匹配。如果基本充电参数匹配成功，双方进入鉴权模块，否则退出充电通信过程。所述鉴权模块用于车辆对充电机的身份进行单向识别和确认；充电机对车辆的身份进行单向识别和确认；充电机和车辆对彼此身份进行双向的识别和确认。如果身份鉴权成功双方进入预约模块，否则退出充电通信过程。所述预约模块用于仅车辆侧预约充电时间，由充电机侧确认后启动充电；仅充电机侧预约充电时间，由车辆侧确认后启动充电；车辆和充电机侧同时预约，双方协商后确认启动充电时间。如果预约成功，待预约充电时间到达后进入充电系统自检模块，否则退出充电通信过程。所述充电系统自检模块用于实现充电机在绝缘检测，短路检测，粘连检测操作过程中以及车辆电子锁的状态信息的交互和确认。如果充电系统自检成功，则进入预充和能量传输模块，否则退出充电通信过程。所述预充和能量传输模块用于交互避免充电机对电池组造成冲击所执行的相关操作过程中的信息，所述能量传输包括启动至结束充电的全过程；如果充电结束，退出充电通信过程或进入充电结束模块。所述充电结束模块用于充电机和车辆在能量传输结束后进行充电过程统计相关信息的交互。充电结束模块信息交互完成后，充电过程结束。作为优选方案，所述功能协商模块进行信息交互的前提是版本协商成功，所述参数配置模块进行信息交互的前提是功能协商成功，所述鉴权模块进行信息交互的前提是充电参数匹配成功，所述预约模块进行信息交互的前提是充电参数匹配成功且身份鉴权成功，所述充电系统自检模块进行信息交互的前提是充电参数匹配成功且鉴权和/或预约成功，所述预充和能量传输模块进行信息交互的前提是充电系统自检成功，所述充电结束模块进行信息交互的前提是充电机或车辆主动结束充电。作为优选方案，所述鉴权模块、所述预约模块、所述充电结束模块均为通信协议框架的可选项。作为优选方案，所述鉴权模块、预约模块、充电系统自检模块、预充及能量传输模块、充电结束模块均为可重载功能模块，不同版本通信协议框架中的可重载功能模块对应不同应用实例。作为优选方案，鉴权模块的应用实例包括扫码/刷卡鉴权、VIN码鉴权、数字签名鉴权、云端交互鉴权、混合交互鉴权；预约模块的应用实例包括车端预约、桩端预约；充电系统自检模块应用实例包括常规充电充电系统自检、常规放电充电系统自检；预充及和能量传输模块的应用实例包括常规充电预约及能量传输、常规放电预约及能量传输、常规充放电切换预约及能量传输；充电结束模块的应用实例包括充电电量及时间统计充电结束、自定义信息统计充电结束。一种电动汽车与非车载充电机充电通信协议框架实现方法，包括步骤如下：S1)车辆和充电机建立通信链接，进行版本协商功能模块信息交互，如果版本协商成功，进入S2，协商失败或协商超时进入S9。S2)车辆和充电机进入功能协商功能模块信息交互，如果功能协商成功，进入S3，协商失败或协商超时进入S9。S3)车辆和充电机进入参数配置功能模块的信息交互，如果参数匹配成功，进入S4，匹配失败或超时进入S9。S4)车辆和充电机进入鉴权功能模块的“扫码/刷卡”FDC的信息交互，如果鉴权成功，进入S5，鉴权失败或超时进入S9；S5)车辆和充电机在S2的功能协商结果为“无预约”，预约功能模块无信息交互，双方跳过该功能模块，进入S6；S6)车辆和充电机进入充电系统自检模块的“常规充电”FDC的信息交互，如果自检成功，进入S7，自检失败或超时进入S9；S7)车辆和充电机进入预充及能量传输的“常规充电”FDC的信息交互，充电结束后进入S8；S8)车辆和充电机在S2的功能协商结果为无“充电结束”，充电结束功能模块无信息交互，双方跳过该功能模块，进入S9；S9)车辆和充电机退出充电通信过程。作为优选方案，所述步骤S1具体步骤如下：充电机向车辆发送其支持的最高协议版本号，如果车辆支持该版本并确定以该版本进行通信，返回“协商成功”信息给充电机。如果车辆不支持该版本且该版本低于车辆支持的最低版本，返回“协商失败”信息给充电机。如果车辆不支持该版本且该版本高于车辆支持的最低版本，将返回“继续协商”信息，连同期望的版本号一起返回给充电机。充电机接收到“继续协商”信息后，如果当前发送版本已是充电机支持的最低版本，继续发送当前版本，等待超时协商失败。如果充电机支持车辆期望的版本，则发送该版本号，协商成功。如果充电机不支持车辆期望的版本，则发送比当前版本低的最高版本，继续协商。作为优选方案，所述步骤S2具体步骤如下：充电机向车辆发送充电机实现的所有可重载功能模块的编码及应用实例编码，车辆接收后检查并确定最终的协商结果：如果在某个FC上双方能实现同一个FDC，则在该FC上协商成功；如果在某个FC上双方没有共同支持的FDC，则在该FC上协商失败；如果在某个FC上的支持多个共同FDC，由车辆按照自身的优先策略选择一个FDC并返回协商结果。只有当充电机和车辆在必须项功能模块上有共同的FDC，才能进行充电。作为优选方案，所述步骤S3具体步骤如下：充电机向车辆发送基本充电参数，车辆接收后回复充电保护阈值，同时按照以下原则检查充电参数是否匹配：整车充电系统当前电压低于充电机的最低输出电压；整车充电系统当前电压高于充电机的最高输出电压。通过以上参数配置，满足基本充电功能，充电配置成功。作为优选方案，所述步骤S4具体步骤如下：充电机发送“充电机鉴权参数报文”，车辆回复“车辆鉴权等待报文”，并在规定时间内等待充电机完成扫码或刷卡，同时返回“充电机鉴权成功”信息。通过以上鉴权，充电机和车辆车桩之间身份鉴权成功，进入下一个步骤。作为优选方案，所述步骤S6具体步骤如下：充电机执行粘连检测、短路检测、绝缘检测操作，并将检测状态信息发送给车辆，车辆也将其电子锁的状态信息发送给充电机。通过充电系统自检，充电机自检成功，车辆电子锁锁止完好，双方进入下一个步骤。作为优选方案，所述步骤S7具体步骤如下：在能量传输过程，充电机按车辆发送的需求电压、电流进行充电输出，同时充电机调整动态输出能力并告知车辆，车辆据此调整充电需求，完成充电过程。在能量传输过程中，无论是正常中止充电，还是异常中止充电，都进入S8。有益效果：本发明提供的电动汽车与非车载充电机充电通信协议框架及其实现方法，包括多个有序功能模块：版本协商、功能协商、参数配置、鉴权、预约、充电系统自检、预充及能量传输、充电结束；充电通信协议由框架内的所有必须项功能模块以及零个或多个可选项功能模块组成，同时支持可重载功能模块的一个或多个应用实例；不同版本的通信协议可以支持不同的可选项功能模块以及可重载功能模块的不同应用实例；遵循某个特定版本通信协议的车辆/充电机可以根据自身实现条件和需求，实现该版本通信协议支持的全部/部分功能；通过版本协商、功能协商，以及可选功能模块和可重载功能模块的灵活配置，实现充电通信协议对兼容性、扩展性、灵活性的需求。其优点如下：第一，协议配置的灵活性：通信协议可自由配置可选功能模块及可重载功能模块的不同实例；第二，功能实现的灵活性：支持某个特定版本通信协议的车辆和充电机，不需要实现协议内的所有功能，可以根据应用条件和需求实现所有/部分功能；第三，支持多样化的充电方案：功能模块的可重载特性，使同一功能模块的不同实现方案成为可能，支持市场应用的多样化和灵活性，协议框架更具扩展性；第四，有效的版本协商原则：将版本协商作为通信协议的第一个功能模块，只有当车辆和充电机支持同一协议版本，才允许双方遵循该版本规定的内容进行充电和信息交互，保证充电兼容性；第五，交互内容的同步性：车辆和充电机通过功能协商，告知对方各自能实现的功能模块及应用实例，保证通信过程中功能实现及交互信息的一致性。附图说明图1为本发明的电动汽车与非车载充电机充电通信协议框架示意图。图2为版本协商功能模块的通信流程。图3为功能协商功能模块的通信流程。图4为参数配置功能模块的通信流程。图5为“扫码/刷卡”鉴权的通信流程。图6为“常规充电”充电系统自检的通信流程。图7为“常规充电”预充及能量传输的通信流程。具体实施方式下面结合具体实施例对本发明作更进一步的说明。如图1所示，一种电动汽车与非车载充电机充电通信协议框架，包括：版本协商模块、功能协商模块、参数配置模块、鉴权模块、预约模块、充电系统自检模块、预充及能量传输模块、充电结束模块。其中版本协商、功能协商、参数配置、充电系统自检、预充及能量传输模块是一个完整的充电通信协议框架必不可少的部分，其他的模块可根据当前市场需求和应用在充电通信协议框架中选择具有。版本协商模块用于充电机和车辆之间进行通信协议版本号信息交互，车桩插枪完成及通信链路建立以后，充电机首先将自身支持的通信协议版本号发送给车辆，车辆将该版本号与其自身支持的版本号进行比对并返回协商结果：如果车辆返回协商成功，双方进入功能协商模块的信息交互过程；如果车辆返回“继续协商”并发送期望的版本号，双方将继续进行协商；如果车辆返回协商失败，双方退出充电通信过程。功能协商模块进行信息交互的前提是版本协商成功，该模块用于充电机和车辆进行可重载功能模块以及可重载功能模块支持的实例的协商。充电机首先将自身支持的功能模块及充电机支持的实例信息发送给车辆，车辆根据自身支持的功能模块及实例，并按照自定义的优先策略返回协商结果，所述优先策略为当车辆支持充电机发送的某个模块的多个实例时，选择执行某个实例的优先级策略，每个功能模块只能返回一个实例。如果功能协商成功，双方进入参数配置模块，否则退出充电通信过程。参数配置模块进行信息交互的前提是功能协商成功，该模块用于充电机和车辆进行基本充电参数的匹配。如果充电参数匹配成功，双方进入鉴权模块，否则退出充电通信过程。鉴权模块进行信息交互的前提是充电参数匹配成功，该模块为可选项，用于车辆对充电机的身份进行单向识别和确认、充电机对车辆的身份进行单向识别和确认、充电机和车辆对彼此身份进行双向的识别和确认，目的是为了充电授权和费用结算。如果身份鉴权成功双方进入预约模块，否则退出充电通信过程。预约模块进行信息交互的前提是充电参数匹配成功且身份鉴权成功，该模块为可选项，用于仅车辆侧预约充电时间，由充电机侧确认后启动充电；仅充电机侧预约充电时间，由车辆侧确认后启动充电；车辆和充电机侧同时预约，双方协商后确认启动充电时间。如果预约成功，待预约充电时间到达后进入充电系统自检模块，否则退出充电通信过程。充电系统自检模块进行信息交互的前提是充电参数匹配成功且鉴权和/或预约成功，用于实现充电机在绝缘检测，短路检测，粘连检测操作过程中以及车辆电子锁的状态信息的交互和确认。如果充电系统自检成功，则进入预充和能量传输模块，否则退出充电通信过程。预充和能量传输模块进行信息交互的前提是充电系统自检成功，该模块用于交互避免充电机对电池组造成冲击所执行的相关操作过程中的信息，能量传输包括启动至结束充电的全过程；如果充电结束，退出充电通信过程或进入充电结束模块。充电结束模块进行信息交互的前提是充电机或车辆主动结束充电，该模块为可选项，用于充电机和车辆在能量传输结束后进行充电过程统计相关信息的交互。充电结束模块信息交互完成后，充电过程结束。版本协商、功能协商、参数配置功能模块的信息交互原则、报文定义、信息交互过程固定不变，只有一个应用实例，其他可重载功能模块可以有多个应用实例，用以实现当前功能的不同实现方式：“鉴权模块”可重载功能模块的应用实例包括扫码/刷卡鉴权、VIN码鉴权、数字签名鉴权、云端交互鉴权、混合交互鉴权；“预约模块”可重载功能模块的应用实例包括车端预约、桩端预约；“充电系统自检模块”可重载功能模块的应用实例包括常规充电充电系统自检、常规放电充电系统自检；“预充和能量传输模块”可重载功能模块的应用实例包括常规充电预约及能量传输、常规放电预约及能量传输、常规充放电切换预约及能量传输；“充电结束模块”可重载功能模块的应用实例包括充电电量及时间统计充电结束、自定义信息统计充电结束。需要注意的是，通信协议版本不同，支持的可选项功能模块以及可重载功能模块的应用实例不一定相同，充电机和车辆通过版本协商获取对方支持的协议版本，跳转至某个相同版本的通信协议的通信过程。此外，遵循特定版本通信协议的车辆/充电机也可以根据自身实现条件和需求，选择实现该版本通信协议支持的全部/部分功能，并通过功能协商，实现充电功能的一致性和同步。本发明的一个具体实施例：车辆支持版本号为V2.0，V2.1的通信协议，充电机支持版本号为V2.1，V2.2的通信协议，如表1所示为各个版本的通信协议支持的可选项目功能模块及可重载功能模块的应用实例，表2为车辆和充电机实现的功能。表1不同版本通信协议支持的功能表2车辆和充电机在当前通信协议版本中实现的功能注：□为未实现该功能，为实现该功能。一种电动汽车与非车载充电机充电通信协议框架实现方法，包括步骤如下：S1)车辆和充电机建立通信链接，首先进行版本协商功能模块信息交互，如果版本协商成功，进入S2，协商失败或协商超时进入S9。版本协商过程如图2所示，充电机首先向车辆发送其支持的最高协议版本号，且遵循以下协商原则：如果车辆支持该版本并确定以该版本进行通信，返回“协商成功”信息给充电机；如果车辆不支持该版本且该版本低于车辆支持的最低版本，返回“协商失败”信息给充电机；如果车辆不支持该版本且该版本高于车辆支持的最低版本，将返回“继续协商”信息，连同期望的版本号一起返回给充电机；充电机接收到“继续协商”信息后：如果当前发送版本已是充电机支持的最低版本，继续发送当前版本，等待超时协商失败；如果充电机支持车辆期望的版本，则发送该版本号，协商成功；如果充电机不支持车辆期望的版本，则发送比当前版本低的最高版本，继续协商。通过以上版本协商，充电机和车辆的版本协商成功，结果为V2.1。S2)车辆和充电机进入功能协商功能模块信息交互，如果功能协商成功，进入S3，协商失败或协商超时进入S9；功能协商过程如图3所示，充电机首先向车辆发送其实现的所有可重载功能模块的编码及应用实例编码，车辆接收后检查并确定最终的协商结果：如果在某个FC上双方能实现同一个FDC，则在该FC上协商成功；如果在某个FC上双方没有共同支持的FDC，则在该FC上协商失败；如果在某个FC上的支持多个共同FDC，由车辆按照自身的优先策略选择一个FDC并返回协商结果。需要注意的是，只有当充电机和车辆在必须项功能模块上有共同的FDC，才能进行充电。通过以上功能协商，充电机和车辆的协商结果为：“扫码/刷卡鉴权，无预约、常规充电充电系统自检、常规充电预充及能量传输”，功能协商成功。S3)车辆和充电机进入参数配置功能模块的信息交互，如果参数匹配成功，进入S4，匹配失败或超时进入S9；参数配置过程如图4所示，充电机首先向车辆发送基本充电参数，车辆接收后回复充电保护阈值，同时按照以下原则检查充电参数是否匹配：整车充电系统当前电压低于充电机的最低输出电压；整车充电系统当前电压高于充电机的最高输出电压。通过以上参数配置，满足基本充电功能，充电配置成功。S4)车辆和充电机进入鉴权功能模块的“扫码/刷卡”FDC的信息交互，如果鉴权成功，进入S5，鉴权失败或超时进入S9；“扫码/刷卡”鉴权过程如图5所示，充电机首先发送“充电机鉴权参数报文”，车辆回复“车辆鉴权等待报文”，并在规定时间内等待充电机完成扫码或刷卡，同时返回“充电机鉴权成功”信息。通过“扫码/刷卡”鉴权，充电机和车辆车桩之间身份鉴权成功，进入下一个步骤。S5)车辆和充电机在S2的功能协商结果为“无预约”，预约功能模块无信息交互，双方跳过该功能模块，进入S6；S6)车辆和充电机进入充电系统自检模块的“常规充电”FDC的信息交互，如果自检成功，进入S7，自检失败或超时进入S9；“常规充电”充电系统自检过程如图6所示，充电机执行粘连检测、短路检测、绝缘检测操作，并将检测状态信息发送给车辆，车辆也将其电子锁的状态信息发送给充电机。通过“常规充电”充电系统自检，充电机自检成功，车辆电子锁锁止完好，双方进入下一个步骤。S7)车辆和充电机进入预充及能量传输的“常规充电”FDC的信息交互，充电结束后进入S8；“常规充电”预充及能量传输过程如图7所示，在能量传输过程，充电机按车辆发送的需求电压、电流进行充电输出，同时充电机调整动态输出能力并告知车辆，车辆据此调整充电需求，完成充电过程。在能量传输过程中，无论是正常中止充电还是异常中止充电，都进入S8。S8)车辆和充电机在S2的功能协商结果为无“充电结束”，充电结束功能模块无信息交互，双方跳过该功能模块，进入S9；S9)车辆和充电机退出充电通信过程。本发明将充电通信协议框架包括定义为多个有序功能模块的组合，充电通信协议由框架内的所有必须项功能模块以及零个或多个可选项功能模块组成，通过功能模块的可重载特性实现功能的不同应用实例；不同的可选项功能模块以及可重载功能模块的不同应用实例组成了不同版本的通信协议，允许遵循某个特定版本通信协议的车辆/充电机根据自身实现条件和需求，选择实现该版本支持的全部/部分功能。通过版本协商、功能协商，以及可选功能模块和可重载功能模块的灵活配置，实现充电通信协议对兼容性、扩展性、灵活性的需求。以上所述仅是本发明的优选实施方式，应当指出：对于本技术领域的普通技术人员来说，在不脱离本发明原理的前提下，还可以做出若干改进和润饰，这些改进和润饰也应视为本发明的保护范围。
