标题title
多层图像显示方法和显示引擎
摘要abst
本发明公开了一种多层图像显示方法和显示引擎，以目标图像中的像素行为单位，根据所述像素行上目标像素点的渲染图层对所述像素行进行片段划分；对于每个片段，在其渲染图层所对应的源图中提取所述片段的源图映射信息，根据所述预设插值算法和所述片段的源图映射信息生成相应片段上所有目标像素点的像素信息。本发明方案只需对实际显示图层的相关像素信息进行读取、缩放，解决了现有的多层图像显示技术因需要对每个图层的源图进行缩放后再叠加显示所带来的耗时长、效率低的问题，能够有效减少CPU资源的占用，释放内存带宽。
权利要求书clms
1.一种多层图像显示方法，其特征在于，该方法包括以下步骤：以目标图像中的像素行为单位，根据所述像素行上目标像素点的渲染图层对所述像素行进行片段划分，每个片段有且只有一个渲染图层，且横向相邻的两个片段具有不同的渲染图层，所述渲染图层为所述目标像素点处位于最上层的图层；对于每个片段，在其渲染图层所对应的源图中提取所述片段的源图映射信息，所述片段的源图映射信息包括根据预设插值算法生成相应片段上目标像素点所需的源图像素信息；根据所述预设插值算法和所述片段的源图映射信息生成相应片段上所有目标像素点的像素信息；以目标图像中的像素行为单位，按行显示目标像素点。2.根据权利要求1所述的多层图像显示方法，其特征在于，获取所述目标像素点的渲染图层包括根据所述目标像素点的坐标和各图层在所述目标图像中的显示区域确定所述目标像素点处存在的所有图层的步骤。3.根据权利要求1所述的多层图像显示方法，其特征在于，提取所述片段的源图映射信息，包括以下步骤：对于某一片段，提取其上首目标像素点所对应的源图像素信息；对于所述某一片段上其他目标像素点，若某一目标像素点相对于其在先横向相邻目标像素点对应的源图像素信息存在重合部分，则提取所述某一目标像素点对应的源图像素信息时，复用重合部分，仅提取与其在先横向相邻目标像素点对应的源图像素信息中不重合的部分。4.根据权利要求1所述的多层图像显示方法，其特征在于，提取所述片段的源图映射信息，包括以下步骤：对于某一片段，提取其上首目标像素点所对应的源图像素信息；对于所述某一片段上其他目标像素点，根据在后目标像素点映射到源图像素点的坐标相对于在其先横向相邻目标像素点映射到源图像素点的坐标确定横向步进距离；若所述某一片段中横向相邻目标像素点对应的横向步进距离小于或等于预设横向取值步进长度，则周期性提取数量为横向取值步进长度的源图像素信息，直至相应片段的源图映射信息提取完毕；若所述某一片段中横向相邻目标像素点对应的横向步进距离大于所述预设横向取值步进长度，按照所述片段上目标像素点的顺序依次提取各目标像素点所需的源图像素信息。5.根据权利要求1或4所述的多层图像显示方法，其特征在于，提取所述片段的源图映射信息，还包括以下步骤：将具有相同片段分布的相邻像素行分为一组，所述相同片段分布是指片段个数和长度均相同；对于同一组中纵向相邻的片段，若在后片段的源图映射信息与其在先纵向相邻片段的源图映射信息存在重合部分，则提取在后片段的源图映射信息时复用所述重合部分，仅提取两者中不重合部分。6.根据权利要求1或4所述的多层图像显示方法，其特征在于，提取同一片段组中在后片段的源图映射信息，包括以下步骤：根据所述在后片段中目标像素点映射到源图像素点的坐标相对于其在先纵向相邻片段中目标像素点映射到源图像素点的坐标确定纵向步进距离；若纵向步进距离小于所述预设插值算法对应的纵向步进阈值，则提取所述在后片段的源图映射信息时，仅提取源图中相对于在先纵向相邻片段的源图映射信息中在纵向上偏移纵向步进距离的源图像素信息。7.一种多层图像显示引擎，其特征在于，所述显示引擎包括：数据提取模块，用于根据接收到的数据提取指令，以目标图像中的像素行为单位，提取每个片段的源图映射信息；所述片段有且只有一个渲染图层，且横向相邻的两个片段具有不同的渲染图层，所述渲染图层为所述目标像素点处位于最上层的图层，所述片段的源图映射信息包括根据预设插值算法生成相应片段上目标像素点所需的源图像素信息；数据存储模块，用于存储所述数据提取模块从内存中所提取的源图像素信息；数据缩放模块，用于以目标图像中的像素行为单位，从所述数据存储模块中调取片段中各目标像素点对应的源图像素信息，并根据所述预设插值算法生成各目标像素点的像素信息。8.根据权利要求7所述的多层图像显示引擎，其特征在于，所述数据提取模块包括：数据提取指令接收单元，接收所述数据提取指令；数据提取单元，根据所述数据提取指令从内存中提取每个片段的源图映射信息，包括：对于某一片段，提取其上首目标像素点所对应的源图像素信息；对于所述某一片段上其他目标像素点，若某一目标像素点相对于其在先横向相邻目标像素点对应的源图像素信息存在重合部分，则提取所述某一目标像素点对应的源图像素信息时，仅提取与其在先横向目标像素点对应的源图信息中不重合的部分。9.根据权利要求7所述的多层图像显示引擎，其特征在于，所述数据提取模块包括：数据提取指令接收单元，接收所述数据提取指令；数据提取单元，根据所述数据提取指令从内存中提取每个片段的源图映射信息，包括：对于某一片段，提取其上首目标像素点所对应的源图像素信息；对于所述某一片段上其他目标像素点，根据在后目标像素点映射到源图像素点的坐标相对于在其先横向相邻目标像素点映射到源图像素点的坐标确定横向步进距离；若所述某一片段中横向相邻目标像素点对应的横向步进距离小于或等于预设横向取值步进长度，则周期性提取数量为横向取值步进长度的源图像素信息，直至相应片段的源图映射信息提取完毕；若所述某一片段中横向相邻目标像素点对应的横向步进距离大于所述预设横向取值步进长度，按照所述片段上目标像素点的顺序依次提取各目标像素点所需的源图像素信息。10.根据权利要求7或8所述的多层图像显示引擎，其特征在于，所述数据提取单元根据所述数据提取指令从内存中提取每个片段的源图映射信息，还包括：将具有相同片段分布的相邻像素行分为一组，所述相同片段分布是指片段个数和长度均相同；对于同一组中纵向相邻的片段，若在后片段的源图映射信息与其在先纵向相邻片段的源图映射信息存在重合部分，则提取所述在后片段的源图映射信息时仅从内存中提取两者中不重合部分。11.根据权利要求10所述的多层图像显示引擎，其特征在于，所述数据提取单元根据所述数据提取指令从内存中提取所述在后片段的源图映射信息，包括：根据所述在后片段中目标像素点映射到源图像素点的坐标相对于其在先纵向相邻片段中目标像素点映射到源图像素点的坐标确定纵向步进距离；若纵向步进距离小于所述预设插值算法对应的纵向步进阈值，则提取在所述后片段的源图映射信息时，仅提取源图中相对于在先纵向相邻片段的源图映射信息中在纵向上偏移纵向步进距离的源图像素信息。12.根据权利要求11所述的多层图像显示引擎，其特征在于，所述数据缩放模块包括缩放指令接收单元和运算单元组；所述缩放指令接收单元，用于接收缩放指令，并根据所述缩放指令将片段上各目标像素点映射到源图像素点的坐标发送给所述运算单元组；将所述缩放指令中数据调取相关的指令发送给所述数据调取单元；所述运算单元组从所述数据存储模块中提取每个目标像素点所对应的源图像素信息，根据各目标像素点映射到源图像素点的坐标生成所述预设插值算法所需的行系数和列系数，再根据源图像像素信息最终生成各目标像素点的像素信息。13.根据权利要求12所述的多层图像显示引擎，其特征在于，对于同一纵向相邻片段组，所述运算单元组周期性存储所述在先纵向相邻片段中目标像素点对应的行系数，用于生成在后纵向相邻片段中目标像素点的像素信息时进行复用。
说明书desc
技术领域本发明涉及图像显示领域，尤其涉及一种多层图像显示方法和显示引擎。背景技术现有技术的图像显示引擎在实现多层图像混合显示时，需要先将所有待显示的源图缩放，然后再根据图像显示需求依次对不同层次的缩放图像进行叠加。如图1所示多层图像叠加后的目标图像，需要Pic0至Pic3四张源图，现有的图像显示方法首先确定目标图像所需的源图信息，包括：源图的格式信息、尺寸信息，以及各源图缩放后的缩放图像信息，包括：缩放图像的尺寸、缩放图像的显示区域以及图层覆盖关系。由于显示引擎没有足够的存储空间，对这四张源图进行缩放时，需要先从内存中读取源图信息，进行缩放后再重新写入内存以供后序的叠加处理，这个过程需要多次读写内存，占据较多的内存带宽。另外，在对源图进行缩放的过程中，需要CPU或硬件加速单元进行插值运算，在多层图像显示时，势必会存在缩略图像叠加、像素点覆盖，现有方法需要对所有待显示的源图进行缩放，即便是在目标图像中被大范围覆盖的图像，如Pic0，其对应的源图也会全部缩放，占据较多的CPU资源和内存读写带宽。因此，现有的多层图像显示方法因需要对每个图层的源图进行缩放后再叠加显示，耗时长、效率低。发明内容有鉴于此，为了解决现有技术中多层图像显示耗时长、效率低的问题，本发明提供一种多层图像显示方法，采用直接渲染方式，只需对实际显示图层的相关像素信息进行读取、缩放，减少了CPU资源的占用，释放了内存带宽。为了解决上述问题，本发明的多层图像显示方法，该方法包括以下步骤：以目标图像中的像素行为单位，根据所述像素行上目标像素点的渲染图层对所述像素行进行片段划分，每个片段有且只有一个渲染图层，且横向相邻的两个片段具有不同的渲染图层，所述渲染图层为所述目标像素点处位于最上层的图层；对于每个片段，在其渲染图层所对应的源图中提取所述片段的源图映射信息，所述片段的源图映射信息包括根据预设插值算法生成相应片段上目标像素点所需的源图像素信息；根据所述预设插值算法和所述片段的源图映射信息生成相应片段上所有目标像素点的像素信息；以目标图像中的像素行为单位，按行显示目标像素点。其中，获取所述目标像素点的渲染图层包括根据所述目标像素点的坐标和各图层在所述目标图像中的显示区域确定所述目标像素点处存在的所有图层的步骤。作为一种实施方式，提取所述片段的源图映射信息，包括以下步骤：对于某一片段，提取其上首目标像素点所对应的源图像素信息；对于所述某一片段上其他目标像素点，若某一目标像素点相对于其在先横向相邻目标像素点对应的源图像素信息存在重合部分，则提取所述某一目标像素点对应的源图像素信息时，复用重合部分，仅提取与其在先横向相邻目标像素点对应的源图像素信息中不重合的部分。作为另一种实施方式，为了兼顾图像显示引擎的存储空间较小的通常情况，提取所述片段的源图映射信息，包括以下步骤：对于某一片段，提取其上首目标像素点所对应的源图像素信息；对于所述某一片段上其他目标像素点，根据在后目标像素点映射到源图像素点的坐标相对于在其先横向相邻目标像素点映射到源图像素点的坐标确定横向步进距离；若所述某一片段中横向相邻目标像素点对应的横向步进距离小于或等于预设横向取值步进长度，则周期性提取数量为横向取值步进长度的源图像素信息，直至相应片段的源图映射信息提取完毕；若所述某一片段中横向相邻目标像素点对应的横向步进距离大于所述预设横向取值步进长度，按照所述片段上目标像素点的顺序依次提取各目标像素点所需的源图像素信息。进一步，为了降低对内存带宽的占用，提取所述片段的源图映射信息，还包括以下步骤：将具有相同片段分布的相邻像素行分为一组，所述相同片段分布是指片段个数和长度均相同；对于同一组中纵向相邻的片段，若在后片段的源图映射信息与其在先纵向相邻片段的源图映射信息存在重合部分，则提取在后片段的源图映射信息时复用所述重合部分，仅提取两者中不重合部分。作为一种实施方式，提取同一片段组中在后纵向相邻片段的源图映射信息，包括以下步骤：根据所述在后片段中目标像素点映射到源图像素点的坐标相对于其在先纵向相邻片段中目标像素点映射到源图像素点的坐标确定纵向步进距离；若纵向步进距离小于所述预设插值算法对应的纵向步进阈值，则提取所述在后片段的源图映射信息时，仅提取源图中相对于在先纵向相邻片段的源图映射信息中在纵向上偏移纵向步进距离的源图像素信息。相应地，本发明还提供了一种多层图像显示引擎，所述显示引擎包括：数据提取模块，用于根据接收到的数据提取指令，以目标图像中的像素行为单位，提取每个片段的源图映射信息；所述片段有且只有一个渲染图层，且横向相邻的两个片段具有不同的渲染图层，所述渲染图层为所述目标像素点处位于最上层的图层，所述片段的源图映射信息包括根据预设插值算法生成相应片段上目标像素点所需的源图像素信息；数据存储模块，用于存储所述数据提取模块从内存中所提取的源图像素信息；数据缩放模块，用于以目标图像中的像素行为单位，从所述数据存储模块中调取片段中各目标像素点对应的源图像素信息，并根据所述预设插值算法生成各目标像素点的像素信息。作为一种实施方式，所述数据提取模块包括：数据提取指令接收单元，接收所述数据提取指令；数据提取单元，根据所述数据提取指令从内存中提取每个片段的源图映射信息，包括：对于某一片段，提取其上首目标像素点所对应的源图像素信息；对于所述某一片段上其他目标像素点，若某一目标像素点相对于其在先横向相邻目标像素点对应的源图像素信息存在重合部分，则提取所述某一目标像素点对应的源图像素信息时，仅提取与其在先横向目标像素点对应的源图信息中不重合的部分。作为另一种实施方式，所述数据提取模块包括：数据提取指令接收单元，接收所述数据提取指令；数据提取单元，根据所述数据提取指令从内存中提取每个片段的源图映射信息，包括：对于某一片段，提取其上首目标像素点所对应的源图像素信息；对于所述某一片段上其他目标像素点，根据在后目标像素点映射到源图像素点的坐标相对于在其先横向相邻目标像素点映射到源图像素点的坐标确定横向步进距离；若所述某一片段中横向相邻目标像素点对应的横向步进距离小于或等于预设横向取值步进长度，则周期性提取数量为横向取值步进长度的源图像素信息，直至相应片段的源图映射信息提取完毕；若所述某一片段中横向相邻目标像素点对应的横向步进距离大于所述预设横向取值步进长度，按照所述片段上目标像素点的顺序依次提取各目标像素点所需的源图像素信息。进一步，所述数据提取单元根据所述数据提取指令从内存中提取每个片段的源图映射信息，还包括：将具有相同片段分布的相邻像素行分为一组，所述相同片段分布是指片段个数和长度均相同；对于同一组中纵向相邻的片段，若在后片段的源图映射信息与其在先相邻片段的源图映射信息存在重合部分，则提取在后片段的源图映射信息时仅提取两者中不重合部分。其中，所述数据提取单元根据所述数据提取指令从内存中提取所述在后片段的源图映射信息，包括：根据所述在后片段中目标像素点映射到源图像素点的坐标相对于其在先纵向相邻片段中目标像素点映射到源图像素点的坐标确定纵向步进距离；若纵向步进距离小于所述预设插值算法对应的纵向步进阈值，则提取在所述后片段的源图映射信息时，仅提取源图中相对于在先纵向相邻片段的源图映射信息中在纵向上偏移纵向步进距离的源图像素信息。其中，所述数据缩放模块包括缩放指令接收单元和运算单元组，所述缩放指令接收单元，用于接收缩放指令，并根据所述缩放指令将片段上各目标像素点映射到源图像素点的坐标发送给所述运算单元组；将所述缩放指令中数据调取相关的指令发送给所述数据调取单元；所述运算单元组从所述数据存储模块中提取每个目标像素点所对应的源图像素信息，根据各目标像素点映射到源图像素点的坐标生成所述预设插值算法所需的行系数和列系数，再根据源图像像素信息最终生成各目标像素点的像素信息。进一步，为了降低显示引擎的远算量，对于同一纵向相邻片段组，所述运算单元组周期性存储所述在先纵向相邻片段中目标像素点对应的行系数，用于生成在后纵向相邻片段中目标像素点的像素信息时进行复用。与现有技术相比，本发明具有以下优势：本发明中的多层图像显示方法和多层图像显示引擎，根据目标图像确定所需的源图中相关像素点的信息，仅对相关像素点的信息进行缩放处理，降低内存带宽占用，减少处理所需要的时间，提高叠加显示效率；基于图像显示时按行扫描数据，本发明方法以行为单位提取数据，将每个像素行按照目标像素点处的映射图层将像素行进行片段划分，避免从内存中重复提取相同的像素信息，生成各像素行中目标像素点所需的源图像素信息只需要从内存中提取一次，降低内存带宽的占用；将具有相同片段分布的纵向相邻像素行进行分组，对于同一分组中的各像素行，不同行渲染用到源图中相同的像素信息也只需要读取一次，进一步减少内存带宽使用，降低图像信息输入到显示的延时。附图说明图1是多层图像叠加后的目标图像显示示意图；图2是本发明中多层图像显示方法的流程图；图3是本发明中多层图像显示方法的片段划分示意图；图4是本发明中多层图像显示方法的片段分组示意图；图5是本发明中多层图像显示引擎的模块示意图。具体实施方式下面结合实施例对本发明作更进一步的说明。需要说明的是，本发明在未做特别说明的情况下，所涉及数值，例如：预设插值算法对应的源图像素矩阵大小、横向步进阈值、纵向步进阈值、横向步进距离、横向取值步进长度、纵向步进距离等的单位均为像素。实施例1如图2所示，本发明中多层图像显示方法包括以下步骤：以目标图像中的像素行为单位，根据最上层图层的显示区域将各像素行进行片段划分。如图3所示，目标图像由P0至P3四个图像叠加而成，对图层按照从底层到上层的顺序编号，P0图像所在的图层为L0，P1图像所在的图层为L1，P2图像所在的图层为L2；P3图像所在的图层为L3；P0图像位于目标图像的底层，部分像素被位于其上各图层的图像覆盖；而位于图层L1的P1图像中部分像素被位于其上图层的P2图像、P3图像覆盖；除了位于最上层L3的P3图像未被覆盖外，其余图层的图像至少部分像素被覆盖。需要说明的是，在多个图像叠加显示的应用场景中，P0至P3较多情况下为其源图的缩放图像，极少数情况下为源图，无论是源图还是缩放图像均适用本发明方法，本发明中为了简化描述对同一图像的源图和缩放图像采用同一标识。下文将先基于P0至P3为缩放图像介绍本发明方案。本发明针对源图图像透明度为0的情况进行介绍。以目标图像的像素行为单位，对于某一像素行，其中的某些目标像素点处可能存在多个图层的叠加，因缩放图像的透明度为0，则该目标像素点处最终显示的是最上层图层中相应位置的像素点，该目标像素点由最上层图层中的像素点缩放得到，为了便于描述，将该目标像素点处最上层图层称为渲染图层。作为片段划分的一种实施方式，该实施方式包括以下步骤：1）以目标图像的像素行为单位，获取每个像素点处的渲染图层。以像素行为单位，依次遍历每个像素点，通过判断该像素点是否位于某一图层的显示范围来确定该像素点处是否存在相应图层的像素点，并记录该像素点处的最上层图层作为渲染图层。具体实现时，当目标图像确定时，其对应的源图信息以及源图对应的缩放图像信息是很容易通过软件获取的，源图信息包括：源图标识、源图尺寸，缩放图像信息包括：缩放图像在目标图像中的尺寸、缩放图像在目标图像中的起始位置、缩放图像所在的图层。缩放图像所在图层的显示范围由缩放图像在目标图像中的尺寸、缩放图像在目标图像中的起始位置决定。如图3所示，目标图像中的像素点d，其位于P0、P1、P2缩放图像的显示范围亦即位于图层L0、L1、L2的显示范围，故该像素点处存在图层L0、L1、L2的像素点，以最上层图层L2作为渲染图层。2）根据像素点的渲染图层对像素行进行片段划分，使得某一片段有且仅有一个渲染图层，且横向相邻的两个片段具有不同的渲染图层，便于高效获取渲染所需的像素信息。具体实现时，以像素行为单位，若某一像素点的渲染图层与其相邻像素点的渲染图层相同，则该像素点与其相邻像素点属于同一片段，否则属于不同片段。以图3中的目标图像为例，像素行line0中所有像素点的渲染图层均为L0，故该像素行line0中只具有一个片段seg00；像素行line1中，在像素点a之前的所有像素点的渲染图层均为L0，像素点a至像素点b前一像素点的渲染图层均为L1，像素点b直至该像素行最后一个像素点c的渲染图层均为L0，故像素行line1中存在三个片段，分别为片段seg10、seg11、seg12；同理，像素行line2中，片段seg20有且仅有一个渲染图层L0，片段seg21有且仅有一个渲染图层L1，片段seg22有且仅有一个渲染图层L2，片段seg23有且仅有一个渲染图层L0，片段seg20、seg21横向相邻，片段seg21、seg22横向相邻以及片段seg22、seg23横向相邻，任意两个横向相邻片段具有不同的渲染图层。需要说明的是，上述像素行line0、line1、line2只是为了列举不同像素行片段构成情况而做的区分描述，并不代表像素行之间的位置关系。作为片段划分的另一种实施方式，当目标图像确定时，其上各缩放图像的起始位置以及显示范围以及图层也同时确定，可以确定各缩放图像的边界横、纵坐标，对于某一像素行，可以根据各缩放图像的纵向边界的纵坐标判断该像素行是否与各缩放图像存在交叉像素点，可以根据各缩放图像的横向边界的横坐标判断该像素行与各缩放图像交叉点处的横坐标。对于某一像素行，其与各缩放图像的交叉点，根据相邻交叉点处的最上层图层便可将该像素行进行片段划分。例如：像素行line5与缩放图P0的交叉点为X00 、X01，与缩放图P1的交叉点为X10 、X11，与缩放图P2的交叉点为X20 、X21，与缩放图P3的交叉点为X30 、X31，根据图层关系，根据各交叉点横坐标的大小依次获取交叉点的处的最上层图层，可以获知交叉点X00的最上层图层为L0，交叉点X10的最上层图层为L1，交叉点X20的最上层图层为L2，交叉点X30的最上层图层为L3，交叉点X11的最上层图层为L3，交叉点X21的最上层图层为L3，交叉点X31的最上层图层为L3，交叉点X01的最上层图层为L0，因此，交叉点X00与交叉点X10之间片段为seg50，交叉点X10与交叉点X20之间片段为seg51，交叉点X20与交叉点X30之间片段为seg52，交叉点X30与交叉点X31之间片段为seg53，交叉点X31与交叉点X01之间片段为seg54。以目标图像的像素行为单位，根据预设的插值算法和每个片段的渲染图层获取片段的源图映射信息，本发明中片段的源图映射信息包括了生成相应片段上各目标像素点所需的源图像素信息。采用不同的插值算法，所需获取的源图像素信息不同。常见的插值算法有双线性插值算法，渲染某个目标像素点需要一个2x2的源图像像素矩阵；双三次插值算法，渲染某个目标像素点需要一个4x4的源图像像素矩阵；线性插值算法，渲染某个目标像素点需要一个1x2的源图像像素矩阵和最近临域插值算法，渲染某个目标像素点需要一个源图像像素信息。像素行分片完成后，像素行上每个片段在目标图像上的起始像素位置、末端像素位置、片段的长度便可以确定。下文将以双三次插值算法为例介绍渲染所需的源图像素信息，本发明方法也同样适用其他的常见插值算法，区别主要在于生成某个目标像素点所需的源图像素矩阵的大小不同。根据双三次插值算法，渲染像素行中的某个像素点需要4x4的像素矩阵，矩阵的大小由算法决定，为了便于后续描述，将矩阵的行宽称为横向步进阈值，将矩阵的列宽称为纵向步进阈值。以图4中line3中片段seg33上起始像素点e为例，设其在目标图像上的坐标为，将该坐标映射到源图中的坐标假设为，Xs、Ys为浮点数取整后的结果，则渲染像素点所需的源图像素矩阵A为：。根据上文介绍双三次插值算法的取值窗口为4x4，作为取值的一种实施方式，根据片段上像素点的坐标移动取值窗口，依次获取每个像素点渲染所需的源图像素矩阵。若相邻像素点所需的源图像素矩阵重合，则这种取值方式将会获取较多的重复数据，而且内存的运算量较大，所占用的内存带宽也较大。作为取值的第二种实施方式，对片段中某一目标像素点，若该目标像素点所需的源图像素矩阵中与其在先相邻目标像素点所需的源图像素矩阵存在重合，则获取生成该像素点所需的源图像素信息时仅获取不重合部分。这种方式对提取的数据进行复用，减少内存带宽的占用。如图4所示，对于像素点e所在片段seg33上的其他像素点，纵坐标相同，映射到源图中的纵坐标均为Ys，只有映射到源图中的横坐标在发生变化，以像素点e为例，若其相邻像素点映射到源图的坐标也为，则其相邻像素点对应的取值窗口与像素点e对应的取值窗口重合，则无需重复提取数据；若相邻像素点映射到源图的坐标为，则其相邻像素点对应的取值窗口相较于像素点e对应的取值窗口右移一位，渲染该相邻像素点所需的源图像素矩阵B为：，从内存中提取该相邻像素点所需的源图数据只需在像素点e的基础上再提取右侧一列坐标位置处的像素数据即可；若相邻像素点映射到源图的坐标为，则其相邻像素点对应的取值窗口相较于像素点e对应的取值窗口右移四位，两者不存在重合，渲染该相邻像素点所需的源图像素矩阵C为：，需要从内存中完整地提取该相邻像素点所需的源图数据。概言之，对于同一片段上的某个像素点映射到源图中的像素点坐标为，若假设其横向相邻像素点映射到源图的坐标为，dx表示横向相邻像素点映射到源图中像素点在横轴方向上的横向步进距离，也表示同一片段上相邻像素点取值窗口的横向位移。比较横向步进距离dx与横向步进阈值4，显然，当dx＜4时，同一片段上相邻像素点取值窗口存在重合，提取横向相邻目标像素点所需的源图像素信息只需从内存中提取其相较于前一目标像素点取值窗口不重合部分的数据，即dx列数据；当dx＞=4时，同一片段上相邻像素点取值窗口不存在重合，相邻像素点需从内存中提取其取值窗口内的所有像素点信息，即4列数据。上述第二种实施方式，在获取片段的源图映射信息时，考虑到同一片段上的横向相邻目标像素点所需的源图像素矩阵可能存在重合的情况，对于纵向相邻片段上的目标像素点，也可能存在相应源图像素矩阵存在重合的情况。如图4所示，该图中对像素行进行了纵向放大，像素行line3和像素行line4为相邻像素行，两个像素行存在相同分布的片段，像素行line3中的片段seg30和像素行line4中的片段seg40为纵向相邻片段，二者具有相同的渲染图层，同理，像素行line3中的片段seg31、seg32、seg33、seg34分别与像素行 line4中的seg41、seg42、seg43、seg44为纵向相邻片段，具有相同的渲染图层。以图4中片段seg33中的像素点e和片段43中与其相邻的目标像素点f为例，两者的横坐标相同，假设像素点e在目标图像上的坐标为，该坐标映射到源图中的坐标为，目标像素点f映射到源图中的坐标为，比较纵向步进距离dy与纵向步进阈值4，若dy＜4，以dy=1为例，则目标像素点f所需要的源图像素矩阵D为：，明显的，对比渲染像素点e所需的源图像素矩阵A，渲染像素点f所需的像素点信息只需再从内存中读取最后一行的像素数据即可，前面三行数据不需要重复读取；若dy＞=4，以dy=4为例，则像素点f所需要的源图像素矩阵E为：，对比渲染像素点e所需的源图像素矩阵A，渲染像素点f所需要的像素点信息需要从内存中完整的提取。因此，考虑到纵向目标像素点所需的源图像素信息复用，作为一种实施方式，对像素行进行分组，分组规则为：若某一像素行与其相邻像素行中片段的个数相同，且不同像素行中纵向相邻片段的渲染图层相同，则相应像素行为一组。对于纵向相邻片段上的某个像素点映射到源图中的像素点坐标为，若假设其纵向相邻像素点映射到源图的坐标为，dy表示纵向相邻像素点映射到源图中像素点在纵轴上的纵向步进距离，也表示纵向相邻片段上相邻像素点取值窗口的纵向位移。显然，当dy＜4时，纵向片段上相邻像素点取值窗口存在重合，纵向相邻像素点只需从内存中提取相较于其相邻像素点中取值窗口不重合部分的数据，即dy行数据；当dy＞=4时，纵向相邻片段上相邻像素点取值窗口不存在重合，相邻像素点需从内存中提取其取值窗口内的所有像素点信息，即4行数据。简而言之，提取同一片段组中在后纵向相邻片段的源图映射信息时，根据在后片段中目标像素点映射到源图像素点的坐标相对于其在先纵向相邻片段中目标像素点映射到源图像素点的坐标确定纵向步进距离；若纵向步进距离小于预设插值算法对应的纵向步进阈值，则提取在后片段的源图映射信息时，仅提取源图中相对于在先纵向相邻片段的源图映射信息中在纵向上偏移纵向步进距离的源图像素信息。本发明在提取目标图像上像素点对应的源图像素信息时对像素信息进行了复用，从内存中提取数据时，无需重复提取相同的数据，故而节约了内存带宽。作为一种实施方式，在存储数据时，以目标图像中像素点的坐标作为区分标识对每个目标像素点所需的源图像素信息进行存储，以便于后续利用预设的插值算法生成相应的目标像素点。根据所述预设插值方式和所述片段的源图映射信息生成相应片段上所有目标像素点的像素信息。如上所述，预设插值算法可以是双线性插值算法、双三次插值算法、线性插值算法和最近临域插值算法，这是都是图像缩放处理时常用的插值算法。仍以双三次插值算法为例，双三次插值需要用到邻域4x4的像素； 插值的计算在硬件内部分成行卷积和列卷积，具体实现时，先计算行卷积，得到每行的卷积结果Cr0、Cr1、Cr2、Cr3，如下所示：Cr0 = a0*P00 + a1*P01 + a2*P02 + a3*P03Cr1 = a0*P10 + a1*P11 + a2*P12 + a3*P13Cr2 = a0*P20 + a1*P21 + a2*P22 + a3*P23Cr3 = a0*P30 + a1*P31 + a2*P32 + a3*P33再计算列卷积：Cc = b0* Cr0 + b1* Cr1 + b2* Cr2 + b3* Cr2，上述卷积结果Cc就是目标图像上相应坐标的像素信息。根据BiCubic函数，上述系数a0-a3仅与目标像素点映射到源图像素点的横坐标有关，系数b0-b3仅与目标像素点映射到源图像素点的纵坐标有关。以目标图像中的像素行为单位，按行显示目标像素点。上述方案中步骤中从内存提取源图像素信息的步骤与步骤中根据提取的源图像素信息生成目标像素点的像素信息可以同步进行，这样的方案需要协调内存和图像显示引擎的处理速度，本发明利用软、硬件结合方式实现，通过软件下发指令，硬件实现部分计算和存储功能，根据指令从内存中读取数据并进行插值运算，将复杂运算从CPU中卸载，可以进一步提升处理速度，减少CPU的资源占用。上文重点介绍了目标图像中各图层显示的图像为缩放图像时根据预设插值算法从提取源图像素信息的方式，当目标图像中某一图层显示的是源图时，目标图像上该图层若为渲染图层时，则无论采用何种插值算法，目标像素点映射到源图中的像素点的像素信息即可直接作为该目标像素点的像素信息，即生成该目标像素点所需的像素信息就是该目标像素点映射到源图中像素点的像素信息。对于本领域技术人员来说，可以将此种情况作为预设插值算法的一种特例，适用本发明中多层图像显示方法。实施例2根据上文描述，当目标图像确定时，其对应的源图信息以及源图对应的缩放图像信息是很容易通过软件获取的，在此基础上可以进一步获取横向步进距离和纵向步进距离，确定片段以及片段组中目标像素点所需像素矩阵的重合情况。实施例1中按照目标像素点所需的源图像素信息从内存中提取数据，显然属于从内存中间隔取数据，然而从内存中间隔取数据的效率要远低于续取数据的效率。若先从内存中续取片段的源图映射信息则只需知道片段中首目标像素点和尾目标像素点所对应的源图像素信息地址即可，可以进一步有效降低计算量以及与内存的交互。本发明实施例2综合考虑显示引擎的存储空间与内存间的交互将提取数据的步骤更加细化。实施例2中的多层图像显示方法也包括图2中所示的步骤，只是在实施例1的基础上，配合相应硬件实现对步骤中从内存提取源图像素信息的步骤进行了修改，先从内存中提取一部分数据存储在显示引擎中，随后步骤生成目标像素点时直接从显示引擎的存储模块中读取数据，既可以兼顾显示引擎存储空间小的问题，又可以减少与内存交互，减少内存资源的占用。步骤中提取某一片段的源图映射信息，包括以下步骤：21）根据该片段中首目标像素点和尾目标像素点在源图中对应的像素位置和预设插值方式确定该片段的源图映射信息存储的起始位置和数据长度。当某一片段确定时，其上首目标像素点、尾目标像素点在目标图像中的坐标便可以确定，该片段所在的渲染图层、对应的源图和缩放图像也可确定，可进一步确定首目标像素点、尾目标像素点在源图上对应的像素位置；进而根据预设插值方式确定生成首目标像素点所需的像素矩阵以及生成尾目标像素点所生成的像素矩阵，根据源图的存储格式、存储源图每个像素点所需的最小位宽、数据存储方式便可确定存储每个像素信息所需要的空间，最终确定该片段的源图映射信息在内存中所存储的起始位置和数据长度。22）根据横向步进阈值和显示引擎的存储空间预先设置横向取值步进长度，根据横向步进距离与预设横向取值步进长度的关系，确定将像素数据从内存提取至显示引擎存储模块的方式。若某一片段中横向相邻目标像素点在源图上的横向步进距离小于或等于预设横向取值步进长度，则表明生成横向相邻目标像素点所需的源图像素矩阵可能存在重合部分，即便是不重合，两者间距也相对较小，若提取两相邻目标像素点所需的像素矩阵中多余的像素点不占据显示引擎太多的存储空间，而且相比于按照目标像素点提取像素矩阵的间隔取数据，整块续取的效率会高很多。在这种情况下，则每次从内存中提取横向固定数量的像素信息，直至相应片段的源图映射信息提取完毕，这种提取方式能够较快地从内存中获取数据，减少内存的占用，同时可以兼顾显示引擎的存储空间。若某一片段中横向相邻目标像素点在源图上的横向步进距离大于预设横向取值步进长度，则生成横向相邻目标像素点所需的源图像素矩阵不重合，且两者间距较大，若提取两相邻目标像素点所需的像素矩阵中多余的像素点将过多占用显示引擎的存储空间。在这种情况下，按照所述片段上目标像素点的顺序提取各目标像素点所需的源图像素信息，能够更好地兼顾数据提取效率和显示引擎的存储空间。具体实现时，仍以双三次插值算法为例，根据上文描述，横向步进阈值为4，结合显示引擎的存储空间将横向取值步进长度预设为32，即从源图中每次提取固定长度为32个源图像素的像素信息，以图4为例，若像素点e映射到源图中的像素点坐标为，若假设其横向相邻像素点映射到源图的坐标为，即横向步进距离dx=5,则每次从内存中提取32个源图像素的像素信息，直至该片段的源图映射信息提取完毕。实施例3为了实现实施例1、2中的多层图像显示方法，本发明还提供一种显示引擎，完成插值计算和对行结果的存储，实现硬件加速，不重复读取数据，节省内存带宽。如图5所示，本发明中的显示引擎包括数据提取模块、数据存储模块和数据缩放模块；数据提取模块用于接收指令输入设备发送的数据提取指令，并根据数据提取指令从内存中提取与源图像素信息相关的数据，输入设备可以是鼠标、键盘等，用户通过鼠标或者键盘设置目标图像中各图层对应的源图、各图层的大小，通过软件提取这些信息生成相应的指令信息；数据存储模块用于存储所述数据提取模块从内存中提取的片段的源图映射信息；数据缩放模块，用于以目标图像中的像素行为单位，从所述数据存储模块中调取片段中各目标像素点对应的源图像素信息，并通过预设插值算法生成各目标像素点的像素信息，最终输出至显示设备进行显示。数据提取模块包括：数据提取指令接收单元和数据提取单元，数据提取指令接收单元接收指令输入设备发送的数据提取指令，本实施例中将数据提取指令可以设置为循环指令，该循环指令以像素行为单位，以片段为最小单元，数据提取指令根据实施例1和实施例2中显示方法各实施方式的不同而略有差异；数据提取单元根据数据提取指令按照实施例1或实施例2中步骤的描述从内存中提取源图像素信息。源图的格式与目标图像的格式可能不一致，为了能够兼容更多的图像格式，数据提取模块还可进一步包括数据处理单元，用于对需要进行格式转换的数据进行格式转换，例如，色彩空间、采样格式的转换；相应的，数据提取指令中也包括源图的格式，数据处理单元将内存数据提取单元所提取的数据进行预处理后再发送至数据存储模块进行存储。数据缩放模块包括缩放指令接收单元和运算单元组，运算单元组用于进行卷积运算和相关数据存储，包括列系数生成单元、行系数生成单元、数据调取单元、行卷积运算单元和列卷积运算单元；缩放指令接收单元，用于接收指令输入设备发送的数据缩放指令，本实施例中可以将数据缩放指令设置为循环指令，为了协调数据存取和缩放处理的速度，可以在图像显示引擎中设置同步机制，数据缩放指令以像素行为单位，以片段为最小单元，数据缩放指令根据实施例1、2中显示方法的不同而略有差异；缩放指令接收单元根据指令将目标像素点映射到源图像素点的横坐标loc_x发送给行系数生成单元，行系数生成单元根据预设插值算法计算所需的行系数Coff_x；缩放指令接收单元根据指令将目标像素点映射到源图像素点的的纵坐标loc_y发送给列系数生成单元，列系数生成单元根据预设插值算法计算所需的列系数Coff_y；数据调取单元接收到缩放指令接收单元发送的数据调取指令Data_cmd后从数据存储模块中调取每个目标像素点所需的源图像素信息；行卷积运算单元根据行系数生成单元计算的行系数和像素点信息计算每行的卷积结果；列卷积运算单元根据每行的卷积结果和源图像素信息计算列卷积结果。上述数据提取指令和数据缩放指令中，包含数据提取、缩放所需的相关内容，包括但不限于像素行中各片段的源图映射信息在内存中的起始地址、片段的源图映射信息的纵向位置、片段的源图映射信息的横向长度、源图的宽度、缩放模式、片段在目标图像上的起始坐标、片段长度、需要更新的行数、片段映射到源图图像的起始坐标、相邻目标像素点映射到源图像素点的横向步进距离和纵向步进距离、相邻目标像素点需要更新的行数、相邻像素点需要更新的列数等。本领域技术人员在知晓本发明方法方案的基础上，结合具体实现场景，可以对上述内容做适应性调整。本实施例中为了进一步提高显示引擎的处理效率，在列卷积运算单元中还对每行的卷积结果进行缓存，以便于纵向相邻片段中生成目标像素点像素信息时复用行卷积结果。以图4为例，对于同一片段组中纵向相邻目标像素点e、f，位于同一横坐标上，映射到源图上像素点的横坐标也相同，生成两相邻目标像素点所需像素矩阵中各像素点的横坐标也相同，由实施例1中的描述可知，行系数Coff_x仅与横坐标相关，故而同一片段组中纵向相邻目标像素点对应的行系数相同，若相邻像素点的纵向步进距离小于纵向步进阈值，则所需的像素矩阵存在重合，还可进一步复用行卷积结果，以dy=1为例，如果生成line3上的目标像素点e的像素信息时计算了行方向的卷积结果为：Cr0 = a0*P00 + a1*P01 + a2*P02 + a3*P03，Cr1 = a0*P10 + a1*P11 + a2*P12 + a3*P13，Cr2 = a0*P20 + a1*P21 + a2*P22 + a3*P23，Cr3 = a0*P30 + a1*P31 + a2*P32 + a3*P33，P00~P33为生成目标像素点e所需的源图像素矩阵A中各像素点的源图像素信息，而生成line4上的目标像素点f的像素信息时，计算需要用到行方向的卷积结果为：Cr1 = a0*P10 + a1*P11 + a2*P12 + a3*P13，Cr2 = a0*P20 + a1*P21 + a2*P22 + a3*P23，Cr3 = a0*P30 + a1*P31 + a2*P32 + a3*P33，Cr4 = a0*P40 + a1*P41 + a2*P42 + a3*P43，P10~P43为生成目标像素点f所需的源图像素矩阵D中各像素点的坐标，考虑到行卷积结果Cr1、Cr2 、Cr3已经存储，因此只需要调取第四行的数据做卷积获得Cr4即可，减少运算单元组的运算量。以上详细描述了本发明的优选实施方式，但是，本发明并不限于上述实施方式中的具体细节，在本发明的技术构思范围内，可以对本发明的技术方案进行多种等同变换，这些等同变换均属于本发明的保护范围。
