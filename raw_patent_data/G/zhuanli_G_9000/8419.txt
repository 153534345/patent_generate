标题title
靶场中虚拟机快速启动的调度与物理机扩容方法及系统
摘要abst
本发明公开了靶场中虚拟机快速启动的调度与物理机扩容方法及系统。本发明为集群中每个物理机以及创建虚拟机依赖的镜像文件编号，将集群中所有物理机编号设定在一个数值范围内，在请求启动虚拟机时，根据镜像编号计算得到一个寻址数值，基于该寻址数值确定物理机编号，并进行资源判断以决定最终创建虚拟机的物理机。本发明可以将同一类型的镜像大概率调度到相同的物理机执行虚拟化，从而避免了无规则的随机调度带来的流量风暴，指定镜像在某个物理机上多次虚拟化不需要重复下载镜像文件，相比随机调度优化了用户体验。本发明可针对热点镜像进行扩容，保证新增物理机大概率只执行当前热点镜像的虚拟化，不影响其他镜像的正常使用。
权利要求书clms
1.一种靶场中虚拟机快速启动的调度方法，其特征在于，包括如下步骤：为集群中每个物理机生成唯一编号，为虚拟机创建依赖的镜像文件生成唯一编号；其中物理机的编号为数值编号，集群中所有物理机的编号覆盖在设定的取模范围内，按照编号从小到大的顺序保存在机器列表中；接收到启动虚拟机的请求时，根据依赖镜像文件的编号计算其哈希值并取模得到一个寻址数值；从机器列表中寻找第一个大于等于所述寻址数值的物理机编号，若对应的物理机剩余资源满足创建虚拟机的要求，则在该物理机上创建虚拟机；否则在机器列表中向后循环遍历，直到找到剩余资源满足创建虚拟机的要求的物理机，并在该物理机上创建虚拟机；如果物理机上没有缓存依赖的镜像文件，则下载并缓存；若机器列表中所有物理机均不满足要求，则提示启动错误。2. 根据权利要求1所述的靶场中虚拟机快速启动的调度方法，其特征在于，设集群规模为N，取模范围为X，令M=X/N的向下取整值，则集群中N个物理机的编号分别为。3.根据权利要求1所述的靶场中虚拟机快速启动的调度方法，其特征在于，镜像文件的编号为全局唯一的随机编号，通过哈希算法映射到一个数值区间。4.一种靶场中物理机扩容方法，其特征在于，包括如下步骤：采用根据权利要求1所述的靶场中虚拟机快速启动的调度方法，将虚拟机调度到物理机；根据热点镜像文件的编号计算其哈希值并取模得到一个寻址数值Q，从机器列表中寻找第一个大于等于Q的物理机编号R；计算待插入的物理机编号P=×S+Q+1的向下取整值，将新增物理机的编号配置为P；其中S为之间的比例值。5.根据权利要求4所述的靶场中物理机扩容方法，其特征在于，根据编号为R的物理机上资源占用情况对新增物理机的资源进行配置。6.一种靶场中物理机扩容方法，其特征在于，包括如下步骤：采用根据权利要求1所述的靶场中虚拟机快速启动的调度方法，将虚拟机调度到物理机；获取负载最高的物理机的编号F；从机器列表中获取F的前一个物理机编号G；计算待插入的物理机编号P=×S+G) mod X的向下取整值，将新增物理机的编号配置为P；其中X为取模范围，S为之间的比例值。7.一种靶场中虚拟机快速启动的调度系统，其特征在于，包括：配置模块，用于为集群中每个物理机生成唯一编号，为虚拟机创建依赖的镜像文件生成唯一编号；其中物理机的编号为数值编号，集群中所有物理机的编号覆盖在设定的取模范围内，按照编号从小到大的顺序保存在机器列表中；以及，调度模块，用于接收到启动虚拟机的请求时，根据依赖镜像文件的编号计算其哈希值并取模得到一个寻址数值；从机器列表中寻找第一个大于等于所述寻址数值的物理机编号，若对应的物理机剩余资源满足创建虚拟机的要求，则在该物理机上创建虚拟机；否则在机器列表中向后循环遍历，直到找到剩余资源满足创建虚拟机的要求的物理机，并在该物理机上创建虚拟机；如果物理机上没有缓存依赖的镜像文件，则下载并缓存；若机器列表中所有物理机均不满足要求，则提示启动错误。8.根据权利要求7所述的靶场中虚拟机快速启动的调度系统，其特征在于，还包括：第一扩容配置模块，用于根据热点镜像文件的编号计算其哈希值并取模得到一个寻址数值Q，从机器列表中寻找第一个大于等于Q的物理机编号R；计算待插入的物理机编号P=×S+Q+1的向下取整值，将新增物理机的编号配置为P；其中S为之间的比例值。9.根据权利要求7所述的靶场中虚拟机快速启动的调度系统，其特征在于，还包括：第二扩容配置模块，用于获取负载最高的物理机的编号F；从机器列表中获取F的前一个物理机编号G；计算待插入的物理机编号P=×S+G) mod X的向下取整值，将新增物理机的编号配置为P；其中X为取模范围，S为之间的比例值。10.一种计算机系统，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，其特征在于，所述计算机程序被加载至处理器时实现根据权利要求1-3任一项所述的靶场中虚拟机快速启动的调度方法，或者根据权利要求4-6任一项所述的靶场中物理机扩容方法。
说明书desc
技术领域本发明涉及一种靶场中虚拟机快速启动的调度、物理机扩容方法及系统，属于虚拟网络平台、计算机软件领域。背景技术网络靶场是通过虚拟化技术，模拟仿真出真实网络空间攻防作战环境，能够支撑作战能力研究和武器装备验证的试验平台。靶场的虚拟化主要是靶场中网络节点的实例化过程，实例化每个网络节点即利用特定的镜像在某个物理机上创建出一个可用的虚拟机。从虚拟化的角度而言，靶场的架构如图1所示。其中，控制系统：接收用户的操作指令，如靶场实例化请求，该请求可以分解为若干个虚拟机的创建请求；调度节点：接收控制系统的虚拟机创建请求，并决策得出该请求由某个具体的计算节点执行的结论；计算节点：实际执行负责创建虚拟机任务的物理节点；镜像文件统一存储：虚拟机的创建依赖特定的镜像，镜像文件统一存储于此处。目前，靶场中常见的虚拟机的创建过程如图2所示：1、接收用户根据某个镜像A创建虚拟机的指令；2、调度节点尝试随机选取一个物理资源满足该创建请求的计算节点B，如果找不到这样的计算节点，转跳步骤3；否则转跳步骤4；3、弹出虚拟机启动错误的指令，结束虚拟机的创建请求；4、计算节点B首先查看本次创建请求依赖的镜像A是否存在，如果不存在，执行步骤5；否则转跳步骤6；5、从镜像文件统一存储中心下载镜像A；6、在计算节点B执行实际的虚拟机创建动作，直至虚拟机创建并启动完成。现有方案存在如下问题：1、指定镜像虚拟化的调度策略与镜像自身不相关，对于镜像而言调度到某个物理机执行虚拟化的过程是随机的，实际虚拟化前需要从镜像中心下载镜像文件到本地，镜像文件大小一般都在好几个G，各个物理机随机的镜像下载容易导致网络中流量成为瓶颈；2、因为调度策略和镜像不相关，虚拟机的启动更容易调度到还未下载镜像的物理服务器，该物理服务器需要先下载镜像才能执行实际虚拟化，下载镜像过程耗时较长，用户使用体验不佳；3、对于频繁使用的热点镜像，无法对其增加硬件设备，从而针对性优化。发明内容发明目的：针对上述现有技术存在的问题，本发明目的在于提供一种靶场中虚拟机快速启动的调度、物理机扩容方法及系统，以避免镜像的随机调度带来的网络流量风暴，加快虚拟机启动过程，同时还能支持对物理资源进行针对性优化、扩容。技术方案：为实现上述发明目的，本发明采用如下技术方案：一种靶场中虚拟机快速启动的调度方法，包括如下步骤：为集群中每个物理机生成唯一编号，为虚拟机创建依赖的镜像文件生成唯一编号；其中物理机的编号为数值编号，集群中所有物理机的编号覆盖在设定的取模范围内，按照编号从小到大的顺序保存在机器列表中；接收到启动虚拟机的请求时，根据依赖镜像文件的编号计算其哈希值并取模得到一个寻址数值；从机器列表中寻找第一个大于等于所述寻址数值的物理机编号，若对应的物理机剩余资源满足创建虚拟机的要求，则在该物理机上创建虚拟机；否则在机器列表中向后循环遍历，直到找到剩余资源满足创建虚拟机的要求的物理机，并在该物理机上创建虚拟机；如果物理机上没有缓存依赖的镜像文件，则下载并缓存；若机器列表中所有物理机均不满足要求，则提示启动错误。作为优选，设集群规模为N，取模范围为X，令M=X/N的向下取整值，则集群中N个物理机的编号分别为。作为优选，镜像文件的编号为全局唯一的随机编号，通过哈希算法映射到一个数值区间。本发明提供的一种靶场中物理机扩容方法，包括如下步骤：采用所述的靶场中虚拟机快速启动的调度方法，将虚拟机调度到物理机；根据热点镜像文件的编号计算其哈希值并取模得到一个寻址数值Q，从机器列表中寻找第一个大于等于Q的物理机编号R；计算待插入的物理机编号P=×S+Q+1的向下取整值，将新增物理机的编号配置为P；其中S为之间的比例值。作为优选，根据编号为R的物理机上资源占用情况对新增物理机的资源进行配置。本发明提供的另一种靶场中物理机扩容方法，包括如下步骤：采用所述的靶场中虚拟机快速启动的调度方法，将虚拟机调度到物理机；获取负载最高的物理机的编号F；从机器列表中获取F的前一个物理机编号G；计算待插入的物理机编号P=×S+G) mod X的向下取整值，将新增物理机的编号配置为P；其中X为取模范围，S为之间的比例值。基于相同的发明构思，本发明提供的一种靶场中虚拟机快速启动的调度系统，包括：配置模块，用于为集群中每个物理机生成唯一编号，为虚拟机创建依赖的镜像文件生成唯一编号；其中物理机的编号为数值编号，集群中所有物理机的编号覆盖在设定的取模范围内，按照编号从小到大的顺序保存在机器列表中；以及，调度模块，用于接收到启动虚拟机的请求时，根据依赖镜像文件的编号计算其哈希值并取模得到一个寻址数值；从机器列表中寻找第一个大于等于所述寻址数值的物理机编号，若对应的物理机剩余资源满足创建虚拟机的要求，则在该物理机上创建虚拟机；否则在机器列表中向后循环遍历，直到找到剩余资源满足创建虚拟机的要求的物理机，并在该物理机上创建虚拟机；如果物理机上没有缓存依赖的镜像文件，则下载并缓存；若机器列表中所有物理机均不满足要求，则提示启动错误。进一步地，所述系统还包括：第一扩容配置模块，用于根据热点镜像文件的编号计算其哈希值并取模得到一个寻址数值Q，从机器列表中寻找第一个大于等于Q的物理机编号R；计算待插入的物理机编号P=×S+Q+1的向下取整值，将新增物理机的编号配置为P；其中S为之间的比例值。进一步地，所述系统还包括：第二扩容配置模块，用于获取负载最高的物理机的编号F；从机器列表中获取F的前一个物理机编号G；计算待插入的物理机编号P=×S+G) mod X的向下取整值，将新增物理机的编号配置为P；其中X为取模范围，S为之间的比例值。基于相同的发明构思，本发明提供的一种计算机系统，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，所述计算机程序被加载至处理器时实现所述的虚拟机快速启动的调度方法，或者所述的物理机扩容方法。有益效果：与现有技术相比，本发明具有如下优点：1、本发明通过为虚拟机依赖的镜像和物理机设置编号，将物理机和镜像进行编号关联，根据预设编号寻址规则，在物理资源充足的情况下，指定镜像只会在特定的物理机启动，避免了镜像的随机调度，以及因此带来的网络流量风暴。2、指定镜像在某个物理机上多次虚拟化不需要重复下载镜像文件，相比随机调度优化了用户体验。根据本发明的寻址规则，在安装物理机的时候，可以在本地预先加载特定的镜像，从而加快镜像虚拟化过程。3、对于频繁虚拟化的热点镜像，在物理资源不足、需要新增物理机的情况下，可根据当前集群的物理机编号规则以及镜像编号，给新增物理机设置合理的编号，从而保证新增物理机大概率只执行当前热点镜像的虚拟化，不影响其他镜像的正常使用。附图说明图1为网络靶场节点示意图。图2为现有靶场虚拟机启动流程图。图3为本发明实施例中虚拟机快速启动流程图。具体实施方式下面将结合附图和具体实施例，对本发明的技术方案进行清楚、完整的描述。本发明实施例提供的一种基于主动编号的靶场中虚拟机快速启动的调度方法，可以将同一类型的镜像大概率调度到相同的物理机执行虚拟化，从而避免了无规则的随机调度带来的流量风暴，指定镜像在某个物理机上多次虚拟化不需要重复下载镜像文件，相比随机调度优化了用户体验。具体地，本发明实施例的调度方法包括如下步骤：在集群初始部署阶段，为集群中每个物理机以及虚拟机创建依赖的镜像文件生成唯一编号。具体过程如下：根据实际物理集群以及镜像数量规模，设置合理的哈希取模范围X。为集群中每个物理机生成唯一编号，生成规则如下：假设当前物理集群规模为N，M=X/N的向下取整值，集群中N个物理机的编号分别为。靶场控制节点缓存所有物理机编号和实际物理机的对应关系。为每个镜像文件设置独立编号，需要保证编号的全局唯一性。在虚拟机启动阶段，根据预设编号寻址规则，将特定的镜像文件调度到特定物理机启动，以避免随机调度带来的问题。具体过程如下：接收用户启动虚拟机的请求，该请求中要求启动的虚拟机依赖镜像A。控制节点根据镜像A的编号计算其哈希值H，哈希值H处于一个足够大的区间，可覆盖所有镜像，如在区间内，该哈希值对X取模，即H1= 。寻找机器列表中第一个位于H1之后的机器编号。该编号是大于等于H1的第一个机器编号，如果没有大于等于H1的机器编号则取列表中第一个机器编号，即M。如果该编号对应的物理机Z剩余物理资源满足创建虚拟机的要求，转跳步骤；否则转跳步骤。在找到的物理机上执行创建虚拟机请求。如果当前机器没有缓存镜像A，首先从镜像文件统一存储服务器下载镜像。然后执行实际的虚拟机实际创建，结束虚拟机创建流程。在机器列表中继续向后循环遍历所有机器，如果能找到某个剩余资源满足创建虚拟机的物理机Y，转跳步骤；否则弹出虚拟机启动错误指令，结束虚拟机创建流程。在上述调度方法的基础上，本发明实施例提供的靶场中物理机扩容方法，主要有如下两种情况：A：某些热点镜像需要频繁的创建虚拟机，从内存、磁盘和CPU三个维度而言，该镜像可能要求的某个指标过大，其他指标要求很低。可为该类型的镜像单独配置特殊类型物理机，针对上述例子，物理机的CPU、内存要求很低，磁盘要求很高。对于热点镜像的情况，本实施例新增物理机的方法主要包括如下步骤：计算热点镜像的编号的哈希值对X的取模值，记为Q。从机器列表中寻找第一个不小于Q的物理机编号R。计算待插入的物理机编号P=×S+Q+1的向下取整值。其中S为之间的比例值，控制本次新增物理机影响的镜像范围百分比，如希望影响的镜像数量为10%，则令S=0.1即可。B：集群硬件达到指定阈值，需要增加新的硬件设备。对于此情况，本实施例新增物理机的方法主要包括如下步骤：获取机器列表中负载最高的物理机的编号，记为F。获取F的前一个物理机编号，记为G，G= mod X)。新加入的物理机编号处于G、F中间位置，计算待插入的物理机编号P=×S +G) mod X的向下取整值，S=0.5时则，P位于G、F正中间位置。基于相同的发明构思，本发明实施例公开的一种靶场中虚拟机快速启动的调度系统，主要包括配置模块和调度模块。配置模块用于为集群中每个物理机生成唯一编号，为虚拟机创建依赖的镜像文件生成唯一编号，集群中所有物理机的编号覆盖在设定的取模范围内，按照编号从小到大的顺序保存在机器列表中；调度模块，用于接收到启动虚拟机的请求时，根据依赖镜像文件的编号计算其哈希值并取模得到一个寻址数值；从机器列表中寻找第一个大于等于所述寻址数值的物理机编号，若对应的物理机剩余资源满足创建虚拟机的要求，则在该物理机上创建虚拟机；否则在机器列表中向后循环遍历，直到找到剩余资源满足创建虚拟机的要求的物理机，并在该物理机上创建虚拟机；如果物理机上没有缓存依赖的镜像文件，则下载并缓存；若机器列表中所有物理机均不满足要求，则提示启动错误。进一步地，调度系统还可包括第一扩容配置模块和第二扩容配置模块。第一扩容配置模块，用于根据热点镜像文件的编号计算其哈希值并取模得到一个寻址数值Q，从机器列表中寻找第一个大于等于Q的物理机编号R，计算待插入的物理机编号P=×S+Q+1的向下取整值，将新增物理机的编号配置为P；第二扩容配置模块，用于获取负载最高的物理机的编号F；从机器列表中获取F的前一个物理机编号G；计算待插入的物理机编号P= ×S +G) mod X的向下取整值，将新增物理机的编号配置为P。基于相同的发明构思，本发明实施例公开的一种计算机系统，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，该计算机程序被加载至处理器时实现上述的靶场中虚拟机快速启动的调度方法，或者物理机扩容方法。
