标题title
人像浮雕数据集构建方法
摘要abst
本发明公开了人像浮雕数据集构建方法，属于人像浮雕模型技术领域，要解决的技术问题为如何构具有完整头部特征的高质量人像浮雕数据样本。包括如下步骤：基于3D人像雕塑获取人像法图、遮罩图和线条图，构建并训练网络模型；对于参考图像，提取特征精确定位的线条图，提取头发丝线条图，并通过MODNet网络提取遮罩图，合并头发丝线条图及特征精确定位的线条图得到最终线条图，将遮罩图和最终线条图输入训练后的网络模型，输出整体人像法图；对于参考图像，通过ResUnet网络得到具有精细几何细节的人脸法图，并将整体人像法图和人脸法图融合；将纹理法向迁移至融合后整体人像法图；进行浮雕深度重建，得到人像浮雕模型。
权利要求书clms
1.人像浮雕数据集构建方法，其特征在于包括如下步骤：基于3D人像雕塑获取人像法图、遮罩图和线条图，以所述遮罩图和线条图为输入、并以所述人像法图为输出，构建并训练网络模型，所述网络模型为编码-解码结构的网络模型；获取人像图像为参考图像；对于参考图像，进行滤波处理、提取特征精确定位的线条图，进行双边滤波及滤波提取边缘、提取头发丝线条图，并通过MODNet网络提取遮罩图，合并所述头发丝线条图及特征精确定位的线条图得到最终线条图，将所述遮罩图和最终线条图输入所述训练后的网络模型，输出整体人像法图；对于参考图像，通过ResUnet网络进行人像图像到人脸法图的映射，得到具有精细几何细节的人脸法图，并将整体人像法图和人脸法图融合，得到融合后整体人像法图；对于参考图像，获取每个像素的纹理法向，并通过向量旋转法将纹理法向迁移至所述融合后整体人像法图，得到最终人像法图；对所述最终人像法图进行浮雕深度重建，得到人像浮雕模型。2.根据权利要求1所述的人像浮雕数据集构建方法，其特征在于基于3D人像雕塑获取人像法图、遮罩图和线条图，包括如下步骤：获取多个不同身份、发型和表情的3D人像雕塑；对于每个3D人像雕塑，进行多角度采样；对于每个采样角度生成人像法图、遮罩图和线条图，所述线条图为Apparent Ridges线条图。3.根据权利要求1所述的人像浮雕数据集构建方法，其特征在于以所述遮罩图和线条图为输入、并以所述人像法图为输出，训练网络模型时，基于所述遮罩图、线条图和人像法图构建训练样本，以训练样本顶点法向和网络预测顶点法向的平均夹角定义损失函数，所述损失函数表示为：其中，Ni表示训练样本顶点法向，N′i表示网络预测顶点法向，M表示法向顶点的数量。4.根据权利要求1所述的人像浮雕数据集构建方法，其特征在于对于参考图像，通过ETF流的滤波框架进行滤波处理、提取特征精确定位的线条图，包括如下步骤：对单张的参考图像进行RGB图像去噪，得到去噪后参考图像；对于去噪后参考图像，通过ETF流的滤波框架进行边缘切流处理，得到特征精确定位的线条图；所述ETF流的滤波框架包括FDoG滤波器和FBL滤波器，所述FDoG滤波器用于进行线条绘制，所述FBL滤波器用于对线条进行区域平滑处理。5.根据权利要求1所述的人像浮雕数据集构建方法，其特征在于对于参考图像，进行双边滤波及滤波提取边缘、提取头发丝线条图，包括如下步骤：对单张的参考图像进行RGB图像去噪，得到去噪后参考图像；将去噪后参考图像转换至Lab颜色空间，得到颜色量化的参考图像；对于颜色量化的参考图像，在梯度方向和切线方向上进行双边滤波，得到双边滤波后参考图像，并通过分离的FDOG滤波器对双边滤波后参考图像进行滤波提取边缘，将提取的边缘叠加至颜色量化的参考图像；对于颜色量化的参考图像，在梯度方向上通过ETF流的DOG滤波器进行滤波，并沿着沿着从平滑的结构张量导出的流场应用平滑，创建平滑且连贯的直线和曲线段，得到头发丝线条图。6.根据权利要求1所述的人像浮雕数据集构建方法，其特征在于将整体人像法图和人脸法图融合融，包括如下步骤：将整体人像法图和人脸法图的顶点法向量差值作为边界条件，通过第一方程估算全部人像顶点的法向量差值ΔN，所述第一方程为：L·ΔN＝0其中，L为拉普拉斯-贝尔特拉米矩阵，ΔN∈Rn×3为法向量的差值矩阵，n为顶点个数；将所述法向量差值添加至所述整体人像法图得到融合后整体人像法图。7.根据权利要求1所述的人像浮雕数据集构建方法，其特征在于对于参考图像中每个像素，所述纹理法向定义为：其中，gx和gy表示纹理梯度，参数f用于控制纹理细节强度。8.根据权利要求7所述的人像浮雕数据集构建方法，其特征在于通过向量旋转法将纹理法向迁移至所述融合后整体人像法图，包括如下步骤：设定纹理法向量为nd、全局法向量为nb、纹理法向量与z轴nz＝之间的夹角为θd、全局法向量与z轴之间的夹角为θb；以向量nz×nb为旋转轴，将nb旋转角度max{θd,90-θb}，得到新的像素法向。9.根据权利要求1所述的人像浮雕数据集构建方法，其特征在于通过最小化能量方程，对最终人像附图的浮雕深度进行重建，得到最终的人像浮雕浮雕模型，所述最小化能量方程表示为：其中，所述最小化能量方程第一项使得预测的深度梯度G尽可能接近已知梯度，第一项将预测的浮雕深度H限制在目标深度h内。10.根据权利要求9所述的人像浮雕数据集构建方法，其特征在于所述最小化能量方程等价于求解如下等价方程：ΔH+μ·H＝div G+μ·h其中，ΔH表示深度的拉普拉斯值；梯度G＝＝，其中，Nx、Ny及Nz表示顶点法向的三个分量；散度参数μ用于平衡两个能量项。
说明书desc
技术领域本发明涉及人像浮雕模型技术领域，具体地说是人像浮雕数据集构建方法。背景技术人像浮雕是一种风格化的雕塑艺术形式，在印章、纪念币、建筑、工艺品等方面应用广泛。传统手工雕刻和软件建模人像浮雕需要专业技能，且费时费力。随着人工智能技术的发展，从单张图片实现人像浮雕的端到端建模已经成为可能，但实现深度神经网络的有监督训练，数据集的构建至关重要。目前，学术界和工业界尚未出现足够样本数量的人像浮雕数据集。基于上述分析，如何构建具有完整头部特征的高质量人像浮雕数据样本，是需要解决的技术问题。发明内容本发明的技术任务是针对以上不足，提供人像浮雕数据集构建方法，来解决如何构建具有完整头部特征的高质量人像浮雕数据样本的问题。本发明的人像浮雕数据集构建方法，包括如下步骤：基于3D人像雕塑获取人像法图、遮罩图和线条图，以所述遮罩图和线条图为输入、并以所述人像法图为输出，构建并训练网络模型，所述网络模型为编码-解码结构的网络模型；获取人像图像为参考图像；对于参考图像，进行滤波处理、提取特征精确定位的线条图，进行双边滤波及滤波提取边缘、提取头发丝线条图，并通过MODNet网络提取遮罩图，合并所述头发丝线条图及特征精确定位的线条图得到最终线条图，将所述遮罩图和最终线条图输入所述训练后的网络模型，输出整体人像法图；对于参考图像，通过ResUnet网络进行人像图像到人脸法图的映射，得到具有精细几何细节的人脸法图，并将整体人像法图和人脸法图融合，得到融合后整体人像法图；对于参考图像，获取每个像素的纹理法向，并通过向量旋转法将纹理法向迁移至所述融合后整体人像法图，得到最终人像法图；对所述最终人像法图进行浮雕深度重建，得到人像浮雕模型。作为优选，基于3D人像雕塑获取人像法图、遮罩图和线条图，包括如下步骤：获取多个不同身份、发型和表情的3D人像雕塑；对于每个3D人像雕塑，进行多角度采样；对于每个采样角度生成人像法图、遮罩图和线条图，所述线条图为 ApparentRidges线条图。作为优选，以所述遮罩图和线条图为输入、并以所述人像法图为输出，训练网络模型时，基于所述遮罩图、线条图和人像法图构建训练样本，以训练样本顶点法向和网络预测顶点法向的平均夹角定义损失函数，所述损失函数表示为：其中，Ni表示训练样本顶点法向，Ni'表示网络预测顶点法向，M表示法向顶点的数量。作为优选，对于参考图像，通过ETF流的滤波框架进行滤波处理、提取特征精确定位的线条图，包括如下步骤：对单张的参考图像进行RGB图像去噪，得到去噪后参考图像；对于去噪后参考图像，通过ETF流的滤波框架进行边缘切流处理，得到特征精确定位的线条图；所述ETF流的滤波框架包括FDoG滤波器和FBL滤波器，所述FDoG 滤波器用于进行线条绘制，所述FBL滤波器用于对线条进行区域平滑处理。作为优选，对于参考图像，进行双边滤波及滤波提取边缘、提取头发丝线条图，包括如下步骤：对单张的参考图像进行RGB图像去噪，得到去噪后参考图像；将去噪后参考图像转换至Lab颜色空间，得到颜色量化的参考图像；对于颜色量化的参考图像，在梯度方向和切线方向上进行双边滤波，得到双边滤波后参考图像，并通过分离的FDOG滤波器对双边滤波后参考图像进行滤波提取边缘，将提取的边缘叠加至颜色量化的参考图像；对于颜色量化的参考图像，在梯度方向上通过ETF流的DOG滤波器进行滤波，并沿着沿着从平滑的结构张量导出的流场应用平滑，创建平滑且连贯的直线和曲线段，得到头发丝线条图。作为优选，将整体人像法图和人脸法图融合融合后整体人像法图，包括如下步骤：将整体人像法图和人脸法图的顶点法向量差值作为边界条件，通过第一方程估算全部人像顶点的法向量差值ΔN，所述第一方程为：L·ΔN＝O其中，L为拉普拉斯-贝尔特拉米矩阵，ΔN∈Rn×3为法向量的差值矩阵， n为顶点个数；将所述法向量差值添加至所述整体人像法图得到融合后整体人像法图。作为优选，对于参考图像中每个像素，所述纹理法向定义为：其中，gx和gy表示纹理梯度，参数f用于控制纹理细节强度。作为优选，通过向量旋转法将纹理法向迁移至所述融合后整体人像法图，包括如下步骤：设定纹理法向量为nd、全局法向量为nb、纹理法向量与z轴nz＝之间的夹角为θd、全局法向量与z轴之间的夹角为θb；以向量nz×nb为旋转轴，将nb旋转角度max{θd,90-θb}，得到新的像素法向。作为优选，通过最小化能量方程，对最终人像附图的浮雕深度进行重建，得到最终的人像浮雕浮雕模型，所述最小化能量方程表示为：其中，所述最小化能量方程第一项使得预测的深度梯度G尽可能接近已知梯度，第一项将预测的浮雕深度H限制在目标深度h内。作为优选，所述最小化能量方程等价于求解如下等价方程：ΔH+μ·H＝div G+μ·h其中，ΔH表示深度的拉普拉斯值；梯度G＝＝，其中，Nx、Ny及Nz表示顶点法向的三个分量；散度参数μ用于平衡两个能量项。本发明的人像浮雕数据集构建方法具有以下优点：1、通过3D人像雕塑获取的线条图、遮罩图和人像法图训练网络模型，获取人像图像的线条图和遮罩图为输入，通过训练后的网络模型预测整体人像法图，并通过ResUnet网络预测具有精细几何细节的人脸法图，将整体人像法图和人脸法图融合为融合后整体人像法图，并对融合后整体人像法图进行纹理细节增强，得到最终人像法图，对最终人像法图进行浮雕深度重建，从而得到人像浮雕模型，该模型样本数量大、范围广泛；2、该人像法图是通过人像法图融合以及纹理细节增强得到的，具有完整、高质量的头部特征；重建后的人像浮雕既保留了法图细节特征和纹理特征，又具有合理的深度层次感。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域的普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。下面结合附图对本发明进一步说明。图1为实施例1人像浮雕数据集构建方法的流程框图；图2为实施例1人像浮雕数据集构建方法中3D人像雕塑模型的结构示意图；图3为实施例1人像浮雕数据集构建方法中网络模型的结构示意图；图4为实施例1人像浮雕数据集构建方法中人像雕塑提取的线条图、预测法图和真实法图；图5为实施例1人像浮雕数据集构建方法中基于线条图的人像法图预测；其中，参考图像从参考图像提取的人像线条图通过网络预测的人像法图；图6为实施例1人像浮雕数据集构建方法中法向增强的人像法图预测；其中，参考人像线条图生成的人像法图由文献生成的人脸法图人脸融合后的人像法图纹理细节增强后的人像法图；图7实施例1人像浮雕数据集构建方法重建的人像浮雕模型样本及其参考图像。具体实施方式下面结合附图和具体实施例对本发明作进一步说明，以使本领域的技术人员可以更好地理解本发明并能予以实施，但所举实施例不作为对本发明的限定，在不冲突的情况下，本发明实施例以及实施例中的技术特征可以相互结合。本发明实施例提供人像浮雕数据集构建方法，用于解决如何构具有完整头部特征的高质量人像浮雕数据样本的技术问题。实施例：本发明的人像浮雕数据集构建方法，包括如下步骤：S100、基于3D人像雕塑获取人像法图、遮罩图和线条图，以遮罩图和线条图为输入、并以人像法图为输出，构建并训练网络模型，网络模型为编码-解码结构的网络模型；S200、获取人像图像为参考图像；S300、对于参考图像，进行滤波处理、提取特征精确定位的线条图，进行双边滤波及滤波提取边缘、提取头发丝线条图，并通过MODNet网络提取遮罩图，合并头发丝线条图及特征精确定位的线条图得到最终线条图，将遮罩图和最终线条图输入所述训练后的网络模型，输出整体人像法图；S400、对于参考图像，通过ResUnet网络进行人像图像到人脸法图的映射，得到具有精细几何细节的人脸法图，并将整体人像法图和人脸法图融合，得到融合后整体人像法图；S500、对于参考图像，获取每个像素的纹理法向，并通过向量旋转法将纹理法向迁移至融合后整体人像法图，得到最终人像法图；S600、对最终人像法图进行浮雕深度重建，得到人像浮雕模型。步骤S100基于3D人像雕塑获取人像法图、遮罩图和线条图，包括如下步骤：获取多个不同身份、发型和表情的3D人像雕塑；对于每个3D人像雕塑，进行多角度采样，对于每个采样角度生成人像法图、遮罩图和线条图，该线条图为Apparent Ridges线条图。本实施例中为了构建用于网络训练的样本数据，收集了77个具有各种身份、发型和表情的高质量3D人像雕塑，如图1所示。每个3D人像雕塑依次进行每隔5度的多角度采样，采样范围为左右摆角-80度到80度、上下摆角-5度到20度，采样数量为198。对于每一个采样方向，生成人像法图和遮罩图，同时生成Apparent Ridges线条图，如图2所示。77个人像雕塑共得到15246张人像法图、遮罩图和线条图，图像分辨率为360x360。其中，训练样本数量为13000 个，测试样本数量为2246个。其中，通过如下方法生成遮罩图：在三维浏览环境中，每旋转到一个采样角度，将模型顶点的法向分量转化为RGB三通道。三维环境中的背景为黑色，模型顶点设定为白色，所以可以自动生成黑白遮罩图。生成Apparent Ridges线条图的具体方法为：在三维物体上捕捉与视点相关的线条。对于三维物体表面的一个局部三角面片，当法线相对于视点位置以局部最大速率变化时，在其内部绘制一条线，这些线被称为“Apparent Ridges”。步骤S100为基于3D模型训练网络模型，该网络模型为编码-解码结构的模型，用于实现线条图到人像法图的预测。如图2所示。以两个通道的遮罩图和线条图为输入，输出三通道的人像法图。网络训练时，为了使预测法向保留更多的几何细节，基于遮罩图、线条图和人像法图构建训练样本，以训练样本顶点法向和网络预测顶点法向的平均夹角定义损失函数，损失函数表示为：其中，Ni表示训练样本顶点法向，Ni'表示网络预测顶点法向，M表示法向顶点的数量。网络训练后，使用2246个测试样本对预测质量进行评价，以平均角度误差、平均角度误差小于20度、25度和30度的像素百分比作为评价依据，结果分别为11.92度、84.86％、91.11％和94.67％，网络预测的法图和数据集内真实法图的对比效果如图3所示。步骤S300通过训练后网络模型预测人像法图，在法图预测前需要提取参考人像线条图。首先，对于参考图像，通过ETF流的滤波框架进行滤波处理、提取特征精确定位的线条图。具体的包括如下步骤：对单张的参考图像进行RGB图像去噪，得到去噪后参考图像；对于去噪后参考图像，通过ETF流的滤波框架进行边缘切流处理，得到特征精确定位的线条图。ETF流的滤波框架包括FDoG滤波器和FBL滤波器，该FDoG滤波器用于进行线条绘制，所述FBL滤波器用于对线条进行区域平滑处理。即该方法中方法生成一个特征精确定位的线条图，先将单张RGB图片去噪，然后经过边缘切流处理，建立一个平滑连贯且保留特征的边缘流场。ETF本质上是一个用来处理向量数据的双边滤波器，在每一个滤波器的中心像素点上，使用非线性平滑向量保留显著边缘，并且让弱边缘能够改变自己的方向以跟随相邻的主要边缘。然后使用基于ETF流的过滤框架，捕捉场景中重要的形状边界，并用一组平滑连贯的线条显示。基于ETF流的过滤框架包括FDoG滤波器进行线绘制和FBL滤波器进行区域平滑。 FDoG滤波器采用基于DoG边缘模型，沿ETF流引导DoG滤波器提高生成线的质量，即沿边缘流移动时，在梯度方向上应用一个线性 DoG滤波器，沿着流程累积各个滤波器的响应。FBL滤波器是基于ETF的线性双边滤波器，目的是实现线条的区域平滑，从区域内部移除不重要的细节，同时保留重要形状。其关键是使用两个权重参数，一个在空间域，一个在颜色域，在相似的颜色之间执行平滑。然后，对于参考图像，进行双边滤波及滤波提取边缘、提取头发丝线条图。具体的包括如下步骤：对单张的参考图像进行RGB图像去噪，得到去噪后参考图像；将去噪后参考图像转换至Lab颜色空间，得到颜色量化的参考图像；对于颜色量化的参考图像，在梯度方向和切线方向上进行双边滤波，得到双边滤波后参考图像，并通过分离的FDOG滤波器对双边滤波后参考图像进行滤波提取边缘，将提取的边缘叠加至颜色量化的参考图像；对于颜色量化的参考图像，在梯度方向上通过ETF流的DOG滤波器进行滤波，并沿着沿着从平滑的结构张量导出的流场应用平滑，创建平滑且连贯的直线和曲线段，得到头发丝线条图。此方法首先将去噪后的图片在RGB颜色空间中计算平滑的结构张量来估计图片线条的局部方向，为避免在颜色和亮度突处产生噪声，将输入图片转换到Lab颜色空间。然后使用分离定向对齐双边滤波得到颜色简化的图片，即通过分离的实现来近似双边滤波器，先在梯度方向滤波，然后在切线方向滤波，在平滑图片的同时保留边缘。使用分离的FDOG滤波器对双边滤波后的结果进行滤波提取边缘，将提取的边缘叠加在颜色量化的输出上。为了提取显著的重要边缘，首先在梯度方向上应用基于ETF流的DOG滤波器，然后沿着从平滑的结构张量导出的流场应用平滑，创建平滑且连贯的直线和曲线段。对于参考图像，生成人像遮罩图时，将照片背景与前景人像分离。使用 MODNet网络将trimap-free的人像抠图目标分为语义估计、细节预测、语义与细节融合这3个子任务进行协同训练。通过低分辨率的语义估计捕捉人像主体，输出粗略的前景蒙版，通过高分辨率的细节预测提取人像边缘细节，得到精细的前景边界，最后通过语义与细节融合将前两个分支的特征进行融合，得到最终的人像分割结果。由于特征线的稀疏性和光照信息的缺失，预测法图中人脸几何细节和纹理特征尚未达到最佳效果，本部分通过两个步骤进一步提高人像法图的质量： 人脸法向增强。眼睛、胡须和身体部分的纹理细节增强。首先，执行步骤S400进行法向增强，该方法使用基于深度学习技术从单个彩色图像中估计面部法线，生成具有合理深度和几何纹理细节的人像面部法向图。该方法选用了新的学习构架，结合了跨模态学习的健壮性和跳过连接的细节传递能力，使用ResUnet网络进行端到端的训练框架，学习从彩色图像到人脸法向的映射。其中跨模态建模使用两个具有共享隐空间的编码器-解码器网络，在训练期间通过图像编码器到彩色图像解码器和法向编码器到法向解码器的跳过连接的调整，允许利用成对和不成对的图片和法向数据进行图片到法向的转换。通过ResUnet网络生成一个适应不同光照条件的整体人像法图，如图6c所示，为了实现人脸法图的无缝融合，将整体人像法图和人脸法图的顶点法向量差值作为边界条件，通过第一方程估算全部人像顶点的法向量差值ΔN，第一方程为：L·ΔN＝O其中，L为拉普拉斯-贝尔特拉米矩阵，ΔN∈Rn×3为法向量的差值矩阵， n为顶点个数；将法向量差值添加至整体人像法图得到融合后整体人像法图。如图6d所示，融合后的人脸法图质量得到了很大改善。然后执行步骤S500添加法向纹理细节增强眼睛、胡须和身体部分的锐度。对于参考图像中以上部分的每个像素，其纹理法向定义为：其中，gx和gy表示纹理梯度，参数f用于控制纹理细节强度。在此基础上，通过向量旋转法将纹理法向迁移至融合后整体人像法图，包括如下步骤：设定纹理法向量为nd、全局法向量为nb、纹理法向量与z轴 nz＝之间的夹角为θd、全局法向量与z轴之间的夹角为θb；以向量nz×nb为旋转轴，将nb旋转角度max{θd,90-θb}，得到新的像素法向。通过该操作，使得眼睛、胡须和身体部分的纹理细节得到进一步增强，如图6e所示。得到最终的人像法图后，执行步骤S600对人像法图进行深度重建。本实施例通过最小化以下能量方程，实现人像法图到浮雕深度的重建，最小化能量方程表示为：其中，所述最小化能量方程第一项使得预测的深度梯度G尽可能接近已知梯度，第一项将预测的浮雕深度H限制在目标深度h内。最小化能量方程等价于求解如下等价方程：ΔH+μ·H＝div G+μ·h其中，ΔH表示深度的拉普拉斯值；梯度G＝＝，其中，Nx、Ny及Nz表示顶点法向的三个分量；散度参数μ用于平衡两个能量项，默认情况下，μ＝0.01，h＝0.03。重建的人像浮雕模型样本及其参考图像如图7所示。本实施例的人像浮雕模型构建方法，通过3D模型获取的线条图、遮罩图和人像法图训练网络模型，获取人像图像的线条图和遮罩图为输入，通过训练后的网络模型预测整体人像法图，并通过ResUnet网络预测具有精细几何细节的人脸法图，将整体人像法图和人脸法图融合为融合后整体人像法图，并对融合后整体人像法图进行纹理细节增强，得到最终人像法图，对最终人像法图进行浮雕深度重建，从而得到人像浮雕模型，该模型样本数量大、范围广泛。上文通过附图和优选实施例对本发明进行了详细展示和说明，然而本发明不限于这些已揭示的实施例，基与上述多个实施例本领域技术人员可以知晓，可以组合上述不同实施例中的代码审核手段得到本发明更多的实施例，这些实施例也在本发明的保护范围之内。
