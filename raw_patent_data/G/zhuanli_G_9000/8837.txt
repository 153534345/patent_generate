标题title
一种户外场景图像预测方法
摘要abst
本发明涉及一种户外场景图像预测方法，对于户外场景，将相机固定在同一位置处，场景的反射角将由入射光方向和场景点的三维空间位置决定，并将户外光照分解为太阳光和天空光，方法如下：对预处理后图像进行光照分解，得到天空光基图像的初始值；提取目标图像的阴影区域，求解一系列拍摄图像的天空光强系数；设计损失函数，得到满足要求的基图像；利用图像阳光区域的色调一致性准则，获得三通道的天空光基图像；计算气溶胶MTFa和湍流MTFe；求取大气作用后的退化效果；获得预测模型，计算得到同时刻后一天的预测图像。
权利要求书clms
1.一种户外场景图像预测方法，对于户外场景，将相机固定在同一位置处，场景的反射角将由入射光方向和场景点的三维空间位置决定，并将户外光照分解为太阳光和天空光，方法如下：步骤1对预处理后图像进行光照分解，根据采集到的数量T的预处理后的图像I1,I2,I3,...,IT，预处理后图像大小为m×n，xi和xj为图像像素的行列坐标，通过均值求解计算得到天空光基图像Csky的初始值Csky,0；步骤2提取目标图像的阴影区域Is，假定天空光基图像的强度系数Lsky＝1，由式求解一系列拍摄图像的天空光强系数Lsky：步骤3设计损失函数β如式，利用最小二乘法更新Csky，并将更新后的值代入式计算Lsky，通过数次迭代，得到满足要求的Csky和Lsky；步骤4根据光强度系数关系Lsky+Lsun＝1，求取太阳光强度系数Lsun，代入式计算Csun；步骤5利用图像阳光区域的色调一致性准则，将天空光基图像计算值与真实值相差的比例因子分别设为εR，εG，εB，太阳光基图像计算值与真实值相差的比例因子分别为μR，μG，μB，三个颜色通道分别对应不同的辐射光波长，由式和式更新RGB三通道天空光和太阳光的光强度系数为重复步骤4，更新得到RGB三通道太阳光基图像Csun,R，Csun,G，Csun,B，式中，Csky,R，Csky,G，Csky,B表示RGB三通道的天空光基图像：步骤6利用包括pm2.5浓度、pm10浓度、相对湿度RH和拍摄季节在内的气象要素计算大气能见度Rm；之后，设粒子直径大小为α，辐射光波长为λ，由vc＝α/λ，Qe＝3.912/Rm得到截止频率vc和衰减系数Qe，并根据公式计算气溶胶MTFa式中，v表示空间角频率，Aa和Sa分别表示气溶胶粒子的吸收和散射系数，两者之和为衰减系数Qe，R表示光程即观察距离；步骤7利用式计算中间系数TCSA，表示气溶胶横截面积，由式得到折射率结构常数将值代入式计算湍流MTFe：式中，RH为相对湿度，SF为太阳光辐射通量，W为时间权值参量，WS为风速，T为温度，μ表示比例系数，当拍摄为近场情况时取为1，远场情况为0.5，D表示光圈直径；步骤8对于天空光基图像，将大气作用看作气溶胶MTFa和湍流MTFe效果的叠加，两者相乘，获得大气作用的总调制传递函数MTF，并由傅里叶逆变换计算大气点扩展函数，最后将其与天空光基图像进行卷积运算以求取大气作用后的退化效果Iout；步骤9获得预测模型，计算得到同时刻后一天的预测图像。2.根据权利要求1所述的图像预测方法，其特征在于，步骤2采用浮动阈值法提取目标图像的阴影区域Is。
说明书desc
技术领域本发明涉及一种场景图像预测方法，特别涉及一种户外场景图像预测方法。背景技术场景预测作为科技预测的一个重要组成部分，涵盖内容较广，包括场景语义预测、场景天气预测、场景交通预测、场景图像预测等多个方面。其中，场景图像预测依据图像与时间、外部影响因素之间的相互联系和发展变化规律实现场景预测，在景象匹配制导、智能驾驶、虚拟现实等领域具有重要的应用价值。对于户外场景图像预测，其预测比常规图像预测更复杂、多变、不可控，造成该类型预测的难度显著增大。目前，户外场景预测的研究较少，户外环境要素的考虑也较为片面，因此户外场景图像预测的方法和技术亟待深入探讨和研究。目前对天气和场景图像关系的研究多是基于物理模型的图像复原方法，对退化图像进行恢复和重建。董慧颖等人提出了一种抗天气干扰的图像采集装置，先利用摄像机拍摄模拟图像，由模数转换器转换为数字信号传至计算机，将拍摄时间、气象参数、光圈直径和光程等要素共同作为处理模块的输入，计算图像的调制传递函数，对拍摄的图像滤波复原并输出。该设计方案实现了图像采集信号的实时性，但所提方法未考虑到光照变化的影响，考虑的影响因素相对少一些。章勇勤等人提出一种退化图像的复原方法，先建立图像退化过程的数学模型，再利用奇异值分解和矩阵变化等方式求解模型参数，再根据所得参数信息对阴雨天退化图像进行复原。该方法涉及一种恶劣天气下的退化图像复原方法，可对由大气能见度变化影响的户外图像进行复原校正，但该方法未对不同天气状况下的计算过程进行细分修正，且户外环境中除能见度外的影响因素并未考虑，方法的鲁棒性有待提高。除此，学者还依据图像和外界天气的关系模拟不同天气下的场景图像变化。张真提出了一种在影片中模拟自然天气真实效果的图像处理方法，使用图样模拟、环境模拟和天气模拟三个模块，在影片中呈现雨滴等坠落物的模拟层次感、地面淤积和光线的效果，仿真生成天气效果，但是方法未考虑太阳位置变化产生的影响，只模拟了场景图像由光照引起的亮度变化。张林等人提出了一种自动化的大气退化现象仿真方案，利用脚本程序获取游戏中的场景图像，并根据不同退化仿真模型实现包括雾、薄雾、自然霾、霾与亚洲尘暴在内的五种大气退化效果。该方法对不同类型的天气模型进行了细分，但使用的数据属于游戏场景，与现实户外环境存在差异，且图像质量评价为主观性评价，具有随机性。针对场景图像预测，一些学者利用时间序列图像作为样本，使用深度学习的方法学习样本图像的特征，计算图像的未来状态信息，实现场景动态目标的预测，但是该方法的预测时间较短，通常为一秒至几十秒，预测精度随图像帧数的增加而下降，适用于室内或环境变化差异较小的户外场景。Finn等人提出无监督动作条件预测模型，将图像中目标的外观信息和模型预测的运动信息相结合，可预测十多帧后的机器人交互场景图像。Vondrick 等人训练深层网络结构，学习图像的高级视觉特征，可预测未来五秒的日常生活场景图像。 Wichers等人提出分层的长时无监督预测架构，引入对抗性损失函数，联合训练编码器、预测器和解码器，可预测未来20秒左右的人体运动姿态场景图像。总的来说，现有的相关研究往往对外界环境要素考虑较为片面，图像预测时间较短，不能满足实际户外场景图像的预测要求。参考文献：董慧颖,董涛,王欣威,专利名称：一种抗天气干扰图像采集装置，申请号：CN200520093027.6章勇勤,苗卉,宋怡彪等,专利名称：退化图像复原方法及系统，申请号：CN201210039582.5张真,专利名称：在影片中模拟自然天气真实效果的图像处理方法，申请号：CN200810184107.0张林,赵世雨,张天骏等,专利名称：大气退化现象中的图像仿真方法，申请号：CN202010331525.9Finn C,Goodfellow I,Levine S.Unsupervised learning for physicalinteraction through video prediction.Advances in neural informationprocessing systems,2016,29:64-72.Vondrick C,Pirsiavash H,Torralba A.Generating videos with scenedynamics. Advances in neural information processing systems,2016,29:613-621.Wichers N,Villegas R,Erhan D.Hierarchical long-term videoprediction without supervision.International Conference on MachineLearning.PMLR,2018:6038-6046.Liu Y,Qin X,Xu S,et al.Light source estimation of outdoor scenesfor mixed reality.The Visual Computer,2009,25:637-646.宋明,韩素芹,张敏等，天津大气能见度与相对湿度和PM10及PM2.5的关系.气象与环境学报,2013,29:34-41.Kim I I,Mcarthur B,Korevaar E J.Comparison of laser beampropagation at 785 nm and 1550nm in fog and haze for optical wirelesscommunications.Proceedings of SPIE-The International Society for OpticalEngineering,2001,4214:26-37.Sadot,Dan.Prediction of overall atmospheric modulation transferfunction with standard weather parameters:comparison with measurements withtwo imaging systems.Optical Engineering,1995,34:3239-3248.Yitzhaky Y,Dror I,Kopeika N S.Restoration of atmosphericallyblurred images according to weather-predicted atmospheric modulation transferfunctions.Optical Engineering, 1997,36:3064-3072.程金兰,周成平,丁明跃,蔡超.不同天气条件下户外场景图像生成方法研究.红外与激光工程,2001:134-138.发明内容本发明的目的是提供一种可以实现场景未来一天内的户外场景图像预测方法。本发明采集物理位置固定的连续时间间隔图像，融合外界环境的多要素信息，构建光照和大气对图像作用的物理模型，在此基础上可以实现场景未来一天内的预测。该方法所需的数据集简单，且无需场景的几何、反射率等先验知识，具有可移植性强，适用范围广等优点。技术方案如下：一种户外场景图像预测方法，对于户外场景，将相机固定在同一位置处，场景的反射角将由入射光方向和场景点的三维空间位置决定，并将户外光照分解为太阳光和天空光，方法如下：步骤1对预处理后图像进行光照分解，根据采集到的数量T的预处理后的图像 I1,I2,I3,...,IT，预处理后图像大小为m×n，xi和xj为图像像素的行列坐标，通过均值求解计算得到天空光基图像Csky的初始值Csky,0；步骤2提取目标图像的阴影区域Is，假定天空光基图像的强度系数Lsky＝1，由式求解一系列拍摄图像的天空光强系数Lsky：步骤3设计损失函数β如式，利用最小二乘法更新Csky，并将更新后的值代入式计算Lsky，通过数次迭代，得到满足要求的Csky和Lsky；步骤4根据光强度系数关系Lsky+Lsun＝1，求取太阳光强度系数Lsun，代入式计算Csun；步骤5利用图像阳光区域的色调一致性准则，将天空光基图像计算值与真实值相差的比例因子分别设为εR，εG，εB，太阳光基图像计算值与真实值相差的比例因子分别为μR，μG，μB，三个颜色通道分别对应不同的辐射光波长，由式和式更新RGB三通道天空光和太阳光的光强度系数为和重复步骤4，更新得到RGB三通道太阳光基图像Csun,R，Csun,G，Csun,B，式中， Csky,R，Csky,G，Csky,B表示RGB三通道的天空光基图像：步骤6利用包括pm2.5浓度、pm10浓度、相对湿度RH和拍摄季节在内的气象要素计算大气能见度Rm；之后，设粒子直径大小为α，辐射光波长为λ，由vc＝α/λ，Qe＝3.912/Rm得到截止频率vc和衰减系数Qe，并根据公式计算气溶胶 MTFa：式中，v表示空间角频率，Aa和Sa分别表示气溶胶粒子的吸收和散射系数，两者之和为衰减系数Qe，R表示光程即观察距离；步骤7利用式计算中间系数TCSA，表示气溶胶横截面积，由式得到折射率结构常数将值代入式计算湍流MTFe：式中，RH为相对湿度，SF为太阳光辐射通量，W为时间权值参量，WS为风速，T 为温度，μ表示比例系数，当拍摄为近场情况时取为1，远场情况为0.5，D表示光圈直径；步骤8对于天空光基图像，将大气作用看作气溶胶MTFa和湍流MTFe效果的叠加，两者相乘，获得大气作用的总调制传递函数MTF，并由傅里叶逆变换计算大气点扩展函数，最后将其与天空光基图像进行卷积运算以求取大气作用后的退化效果Iout；步骤9获得预测模型，计算得到同时刻后一天的预测图像。步骤2可采用浮动阈值法提取目标图像的阴影区域Is。与现有的一些技术相比，本发明具有如下的优点：1)对于现有天气和图像之间的关系模型，往往没有考虑光照位置这一影响要素，一般着重于大气粒子浓度、水平能见度、温湿度等大气要素改变所产生的影响。本发明融合了多种环境要素信息，引入光照变量，实现场景图像在一天内的预测，考虑的因素更加全面，也提高了图像预测的精度。2)对于图像预测技术，现有的研究成果较少，场景图像预测技术多数局限于深度学习的方法，模型属于“黑盒”。本发明基于物理模型提供了一种有效思路，将拍摄图像、环境要素、拍摄时刻信息作为输入条件，实现户外场景的预测功能，方法的物理意义明确，且对于样本数据的选择更加宽泛。3)对于一些深度学习方法，可通过大量样本数据的训练得到适用于图像预测的模型，但该类方法的预测时间较短，通常为一秒至几十秒。本发明可以增加图像预测时间的长度，将预测时间扩展至一天。附图说明图1为本发明的一种户外场景图像预测的作用原理示意图；图2为本发明的一种户外场景图像预测的算法流程框图；图3为本发明的户外场景图像预测的效果示意图。附图标记：、预处理后图像，、天空光基图像，、太阳光基图像，、大气总作用MTF曲面，、大气退化后天空光基图像，、算法预测生成图像，、标准参考比对图像，、预测误差图像具体实施方式下面结合附图和实施实例对本发明技术方案进行详细描述。如图1所示，为本发明的一种户外场景图像预测的作用原理示意，该系统工作原理描述如下：原始图像和天气数据分别由位置固定的定时相机和气象站获取，图像通过预处理模块，依次进行畸变校正和颜色平衡操作，并通过光照模块将其分解成太阳光和天空光两部分图像。同时，利用已知的天气要素信息分别计算气溶胶作用和湍流作用的MTF，进一步计算大气总MTF和PSF，并通过卷积运算将大气作用加载到天空光图像中，得到大气影响下的天空光图像效果。相邻天同一时刻的太阳位置近似相同，可将相邻天内的太阳光基图像看作一致，利用测量得到的光照参数计算得到新的太阳光强度，结合退化的天空光图像，计算预测重建图像。为了探究外界环境和图像之间的作用关系，增加预测时间长度，本发明提出的基于多要素融合的户外场景图像预测方法，构建光照和大气关于图像的物理模型，将采集的图像、时间、天气要素作为输入条件，实现场景预测功能。采取的整体方案分成数据采集和数据处理两部分，采集信息包括图像和天气数据，处理过程包括图像的预处理模块、光照模块和大气模块三部分。其中，图像数据由物理空间位置固定的定时相机拍摄户外场景得到，天气数据由气象站对外界环境的天气参量感知处理得到。预处理模块主要包括图像的畸变校正和白平衡处理，先利用相机标定得到相机的内外参矩阵以及畸变参数，对图像的径向畸变进行校正，此后再根据灰度世界算法消除光源颜色对场景图像的影响，还原场景的真实色调。对于户外场景，假定场景静止，将相机固定在同一位置处，场景的反射角将由入射光方向和场景点的三维空间位置决定，并将户外光照分解为太阳光和天空光，得到场景中一个三维点X的光亮度U为：其中，λ表示辐射光的波长，t表示时间信息，Usky和Usun分别表示分解得到的天空光亮度和太阳光亮度，入射光强度Lsky和Lsun为权重系数，p表示场景点的双向反射分布函数，Ssky和Ssun分别表示场景点对于天空光和太阳光的遮挡系数，θi和分别表示入射光线方向以及光源对场景点所张立体角，Ω为光源对场景点所张立体角的总大小。接收的光亮度经过相机成像函数可转换为图像像素强度，将空间三维点X转化为图像坐标值x，同时将式中由场景几何、材料特质以及遮挡函数共同作用所生成的图像作为基图像，分别构成天空光基图像Csky和太阳光基图像Csun，从而将户外场景图像改写成光强度系数和基图像的线性加权和，则相机拍摄的场景图像I可由式所示：I＝LskyCsky+LsunCsun大气模块是将大气作用看作气溶胶M1和湍流M2效果的叠加，利用截止频率vc和衰减系数Qe计算气溶胶调制传递函数，利用测量的环境要素 e1,e2,e3,...,en,以及相机拍摄时刻τ计算湍流MTF，将两者乘积作为大气总MTF，并由傅里叶逆变换计算大气点扩展函数，最后将其与图像进行卷积运算以求取大气作用后的退化效果Iout。将大气作用前的图像记作Iin，则模型公式如式所示：Iout＝Iin*iFFT·M2)由此，令ξ为图像的预测时间，ξ-1为预测当天的相邻前一天，f1和f2分别为光照分解产生的天空光和太阳光基图像，g为大气对场景图像的总影响，h为图像的预处理过程，Iori为原始拍摄图像，则预测后的图像Ipred可概括为：Ipred＝Lsky·g)+Lsun·f2 如图2所示，为本发明的一种户外场景图像预测的算法流程框图，说明如下：步骤1对预处理后图像进行光照分解，根据一定数量T的图像I1,I2,I3,...,IT，预处理后图像大小为m×n，xi和xj为图像像素的行列坐标，可通过均值求解计算得到天空光基图像Csky的初始值Csky,0，公式如下：步骤2采用浮动阈值法提取目标图像的阴影区域Is，假定基图像的天空光强度系数Lsky＝1，由下式求解一系列拍摄图像的天空光强系数Lsky：步骤3如式所示，设计损失函数β，利用最小二乘法更新Csky，并将更新后的值代入式计算Lsky，通过数次迭代，得到满足要求的Csky和 Lsky。步骤4根据光强度系数关系Lsky+Lsun＝1，求取太阳光强度系数Lsun，代入式计算Csun。步骤5利用图像阳光区域的色调一致性准则，将天空光基图像计算值与真实值相差的比例因子分别设为εR，εG，εB，太阳光基图像计算值与真实值相差的比例因子分别为μR，μG，μB，三个颜色通道分别对应不同的辐射光波长λ，由式和式更新RGB三通道天空光和太阳光的光强度系数为和重复步骤4，更新得到RGB三通道太阳光基图像Csun,R，Csun,G，Csun,B。式中，Csky,R，Csky,G，Csky,B表示RGB三通道的天空光基图像。步骤6利用气象要素包括pm2.5浓度、pm10浓度、相对湿度RH和拍摄季节计算大气能见度Rm，如式所示，其中字母a～f表示公式的拟合系数。之后，假定粒子直径大小为α，辐射光波长为λ，由vc＝α/λ，Qe＝3.912/Rm得到截止频率vc和衰减系数Qe，并根据公式计算气溶胶MTFa。Rm＝a+b·exp+d·exp+f·RHg式中，v表示空间角频率，Aa和Sa分别表示气溶胶粒子的吸收和散射系数，两者之和为衰减系数Qe，R表示光程即观察距离。步骤7利用式计算中间系数TCSA，表示气溶胶横截面积，由式得到折射率结构常数Cn2，将值代入式计算湍流MTFe。式中，RH为相对湿度，SF为太阳光辐射通量，W为时间权值参量，WS为风速，T 为温度，μ表示比例系数，当拍摄为近场情况时取为1，远场情况为0.5，D表示光圈直径。步骤8将步骤6和步骤7的结果应用于天空光基图像，如式所示，式中M1和M2即表示MTFa和MTFe，得到大气作用后的图像变化情况。步骤9将步骤5和步骤8所得结果代入至式，即可求解预测模型，得到同时刻后一天的预测图像。如图3所示，为本发明的户外场景图像预测的效果示意图，附图标记中分别给出了各子图代表的含义。对比子图表示的内容，可以发现，在场景图像的预测过程中，主要误差来自于行人、云等不可控的干扰因素，其次还有一部分误差在于相邻两天同时刻的太阳位置仍存在差异，因此相邻天内同时刻的太阳光基图像并不完全等同，其中该图像的预测误差如子图 所示。该图像预测方法融合外界环境的多要素信息，创新性地将光照作用和大气作用相结合，构建对应的物理模型，通过采集的数据集验证预测算法的可靠性。对于以往的相关研究，通常存在预测时间较短、考虑因素不全面的问题，在实际户外环境中的应用十分受限。本发明针对户外场景图像的预测需求，很好地提供了一种有效实用的解决方案，可以将时间样本图像序列和外界环境要素信息作为输入条件，操作简便，无需提供场景的先验知识，且预测精度较高。以上所述的实施例仅用于说明本发明的技术思想及特点，其目的在于使本领域内的技术人员能够理解本发明的内容并据以实施，不能仅以本实施例来限定本发明的专利范围，即凡本发明所揭示的精神所作的同等变化或修饰，仍落在本发明的专利范围内。
