标题title
一种ONU设备升级方法及相关设备
摘要abst
本发明公开了一种ONU设备升级方法及相关设备。该方法包括：ONU根据第一报文判断OLT是否具有续传数据能力，如果具有续传数据能力，查询上次中断升级的位置，并根据中断位置生成第二报文发送至OLT，OLT根据中断位置，将升级文件中的待续传部分发与ONU升级，通过本实施例提供的方法，在ONU设备升级中断时，无需重新下载升级文件，可针对断点位置进行续传，节省了升级时间。
权利要求书clms
1.一种ONU设备升级方法，其特征在于，包括：接收所属的OLT下发的第一报文，其中，所述第一报文中包括升级消息，所述升级消息包括设备信息；基于所述设备信息判断所述OLT是否有续传数据功能；在所述OLT具有所述续传数据功能的情况下，基于所述升级消息获取所述ONU的历史升级信息，并根据所述历史升级信息生成第二报文并发送至所述OLT，以使所述OLT根据所述第二报文向所述ONU发送第三报文，所述第三报文为基于所述历史升级信息确定的升级文件中的待续传部分。2.如权利要求1所述的方法，其特征在于，还包括：在所述OLT不具有所述续传数据功能的情况下，向所述OLT发送第四报文，所述第四报文包括所述升级文件的重传请求。3.如权利要求1所述的方法，其特征在于，所述设备信息储存在开启软件下载消息的消息体中。4.如权利要求1所述的方法，其特征在于，所述历史升级信息储存在开始软件下载响应消息的消息体中。5.如权利要求1所述的方法，其特征在于，所述历史信息包括中断标识信息和断点位置信息；所述并根据所述历史升级信息生成第二报文并发送至所述OLT，包括：根据中断标识信息和断点位置信息生成第二报文并发送至所述OLT。6.如权利要求5所述的方法，其特征在于，所述断点位置信息包括窗口索引和分节索引。7.如权利要求1所述的方法，其特征在于，还包括：在OMCI协议的G.988规范的开始软件下载响应消息体中增加上次升级意外停止原因标识并插入窗口索引和分节索引字段。8.一种ONU设备升级装置，其特征在于，包括：接收单元，用于接收所属的OLT下发的第一报文，其中，所述第一报文中包括升级消息，所述升级消息包括设备信息；判断单元，用于基于所述设备信息判断所述OLT是否有续传数据功能；升级单元，用于在所述OLT具有所述续传数据功能的情况下，基于所述升级消息获取所述ONU的历史升级信息，并根据所述历史升级信息生成第二报文并发送至所述OLT，以使所述OLT根据所述第二报文向所述ONU发送第三报文，所述第三报文为基于所述历史升级信息确定的升级文件中的待续传部分。9.一种电子设备，包括：储存器、处理器以及存储在所述存储器中并可在所述处理器上运行的计算机程序，其特征在于，所述处理器用于执行存储器中存储的计算机程序时实现如权利要求1-7中任一项所述的ONU设备升级方法的步骤。10.一种计算机可读存储介质，其上存储有计算机程序，其特征在于：所述计算机程序被处理器执行时实现如权利要求1-7中任一项所述的ONU设备升级方法。
说明书desc
技术领域本说明书涉及无源光网络领域，更具体地说，本发明涉及一种ONU设备升级方法及相关设备。背景技术无源光网络系统一般由OLT和ONU组成。在无源光网络系统中，OLT通过OMCI协议管理ONU设备，包括数据流业务配置状态获取以及升级等。基于OMCI协议的升级过程由ITU-T G.988规范定义，G.988协议作为一个标准的协议，OLT和ONU设备都应该遵守此协议。但规范对整个升级流程定义的内容并没有对升级文件下载过程中出现中断情况的处理，无法在ONU设备升级中断时，再续传未下载的数据。因此，有必要提出一种ONU设备升级方法，以至少部分地解决现有技术中存在的问题。发明内容在发明内容部分中引入了一系列简化形式的概念，这将在具体实施方式部分中进一步详细说明。本发明的发明内容部分并不意味着要试图限定出所要求保护的技术方案的关键特征和必要技术特征，更不意味着试图确定所要求保护的技术方案的保护范围。为至少部分地解决上述问题，第一方面，本发明提出一种ONU设备升级方法，上述方法包括：接收所属的OLT下发的第一报文，其中，上述第一报文中包括升级消息，上述升级消息包括设备信息；基于上述设备信息判断上述OLT是否有续传数据功能；在上述OLT具有上述续传数据功能的情况下，基于上述升级消息获取上述ONU的历史升级信息，并根据上述历史升级信息生成第二报文并发送至上述OLT，以使上述OLT根据上述第二报文向上述ONU发送第三报文，上述第三报文为基于上述历史升级信息确定的升级文件中的待续传部分。可选的，还包括：在上述OLT不具有上述续传数据功能的情况下，向上述OLT发送第四报文，上述第四报文包括上述升级文件的重传请求。可选的，上述设备信息储存在开启软件下载消息的消息体中。可选的，其特征在于，上述历史升级信息储存在开始软件下载响应消息的消息体中。可选的，其特征在于，上述历史信息包括中断标识信息和断点位置信息；上述并根据上述历史升级信息生成第二报文并发送至上述OLT，包括：根据中断标识信息和断点位置信息生成第二报文并发送至上述OLT。可选的，其特征在于，上述断点位置信息包括窗口索引和分节索引。可选的，还包括：在OMCI协议的G.988规范的开始软件下载响应消息体中增加上次升级意外停止原因标识并插入窗口索引和分节索引字段。第二方面，本发明还提出一种ONU设备升级装置，包括：接收单元，用于接收所属的OLT下发的第一报文，其中，所述第一报文中包括升级消息，所述升级消息包括设备信息；判断单元，用于基于所述设备信息判断所述OLT是否有续传数据功能；升级单元，用于在所述OLT具有所述续传数据功能的情况下，基于所述升级消息获取所述ONU的历史升级信息，并根据所述历史升级信息生成第二报文并发送至所述OLT，以使所述OLT根据所述第二报文向所述ONU发送第三报文，所述第三报文为基于所述历史升级信息确定的升级文件中的待续传部分。第三方面，一种电子设备，包括：储存器、处理器以及存储在上述存储器中并可在上述处理器上运行的计算机程序，上述处理器用于执行存储器中存储的计算机程序时实现如上述的第一方面任一项的ONU设备升级方法的步骤。第四方面，本发明还提出一种计算机可读存储介质，其上存储有计算机程序，上述计算机程序被处理器执行时实现第一方面上述任一项的ONU设备升级方法。综上，本方案通过OLT下发的第一报文，ONU可根据第一报文中的设备信息对所对应的OLT设备是否具有续传数据功能做出判断，如果有续传功能，那么查询ONU的升级记录，并将断点的位置记录下来，生成第二报文发与OLT，OLT根据断点的位置将其余未传输的文件传给ONU，以供ONU完成升级，通过此方法可针对ONU升级中断的现象，在断点处续传文件，这样节省了ONU的升级时间，也为意外中断升级提供了另一种解决方案。本发明的ONU设备升级方法，本发明的其它优点、目标和特征将部分通过下面的说明体现，部分还将通过对本发明的研究和实践而为本领域的技术人员所理解。附图说明通过阅读下文优选实施方式的详细描述，各种其他的优点和益处对于本领域普通技术人员将变得清楚明了。附图仅用于示出优选实施方式的目的，而并不认为是对本说明书的限制。而且在整个附图中，用相同的参考符号表示相同的部件。在附图中：图1为本申请实施例提供的一种ONU设备升级方法流程示意图；图2为本申请实施例提供的一种ONU设备升级装置结构示意图；图3为本申请实施例提供的一种ONU设备升级电子设备结构示意图。具体实施方式本申请实施例提供了ONU设备升级方法及相关设备，基于ITU-T G.988规范协议进行补充，通过查询ONU中的历史升级信息，确定升级中断位置，OLT根据ONU确定的断点位置续传剩余升级文件，供ONU继续升级。本申请的说明书和权利要求书及上述附图中的术语第一、第二、第三、第四等是用于区别类似的对象，而不必用于描述特定的顺序或先后次序。应该理解这样使用的数据在适当情况下可以互换，以便这里描述的实施例能够以除了在这里图示或描述的内容以外的顺序实施。此外，术语包括和具有以及他们的任何变形，意图在于覆盖不排他的包含，例如，包含了一系列步骤或单元的过程、方法、系统、产品或设备不必限于清楚地列出的那些步骤或单元，而是可包括没有清楚地列出的或对于这些过程、方法、产品或设备固有的其它步骤或单元。下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本申请一部分实施例，而不是全部的实施例。请参阅图1，为本申请实施例提供的一种ONU设备升级方法流程示意图，具体可以包括：S110、接收所属的OLT下发的第一报文，其中，上述第一报文中包括升级消息，上述升级消息包括设备信息；具体的，OLT可以同时控制多个ONU，OLT向对应的ONU下发包含升级消息的报文，升级消息中包括着设备信息，设备信息包括此OLT设备是否支持续传数据。S120、基于上述设备信息判断上述OLT是否有续传数据功能；具体的，根据上述的设备信息判断OLT是否具有续传功能，其设备信息可以设置在某个消息的字段中，例如0代表不具有续传功能，1代表具有续传功能。S130、在上述OLT具有上述续传数据功能的情况下，基于上述升级消息获取上述ONU的历史升级信息，并根据上述历史升级信息生成第二报文并发送至上述OLT，以使上述OLT根据上述第二报文向上述ONU发送第三报文，上述第三报文为基于上述历史升级信息确定的升级文件中的待续传部分。具体的，当OLT设备具有续传功能的情况下，ONU查询其设备内存中的文件，并确定上次升级是否意外中断，如果是，将升级文件中断的位置记录下来，并根据此中断位置生成第二报文，发送至OLT，OLT接收到报文后根据中断的位置信息，将后续待续传文件打包至第三报文中，发送至ONU。综上，ONU根据第一报文判断OLT是否具有续传数据能力，如果具有续传数据能力，查询上次中断升级的位置，并根据中断位置生成第二报文发送至OLT，OLT根据中断位置，将升级文件中的待续传部分发与ONU升级，通过本实施例提供的方法，在ONU设备升级中断时，无需重新下载升级文件，可针对断点位置进行续传，节省了升级时间。在一些示例中，还包括：在上述OLT不具有上述续传数据功能的情况下，向上述OLT发送第四报文，上述第四报文包括上述升级文件的重传请求。具体的，当ONU接收到第一报文时，通过识别设备信息，发现此OLT设备不具有重传能力时，向所述的OLT发送第四报文以请求重新下传升级文件，以完成ONU设备的升级。可以理解的是开发者可以也可以通过设置设备信息使ONU设备强制不进行续传，从头开始更新。例如：正常情况下其设备信息的值为1，表示此台设备具有续传数据的能力，可能由于上次升级文传输错误，防止ONU基于断点续传上次文件，开发者可以将设备信息的值强制设置为0，以使ONU设备强制从头下载最新的升级文件。综上，当ONU通过设备信息查询OLT不具备续传数据的能力时，ONU会请求OLT从头传输升级文件，通过开发者手动修改设备信息，也可完成ONU设备强制从头升级。在一些示例中，上述设备信息储存在开启软件下载消息的消息体中。具体的，在基于OMCI协议的升级的过程中，OLT会向ONU下发开启软件下载消息，通过在开启软件下载消息的17字节中加入强制标识，长度1个字节，从而判断此OLT设备是否具有续传数据功能，例如第17字节的值为0时，此时代表该设备不具备数据续传数据功能，在值为1时代表该设备具有数据续传功能，ONU设备查询开启软件下载消息中第17字节的数值，从而确定该OLT设备是否具有续传数据，向OLT发送报文请求从断点继续传升级文件或请求重传升级文件以完成ONU设备的升级。在一些示例中，其特征在于，上述历史升级信息储存在开始软件下载响应消息的消息体中。具体的，在ONU接收到第一报文中的开启软件下载消息后，查询设备信息后，发现此OLT设备具有数据续传功能，ONU设备查询内存上的升级文件，确定上次升级中断的断点，并将断点信息写入下载响应消息的消息体中，并生成第二报文发送至OLT，OLT根据下载响应消息的消息体中记录的断点位置，将剩余的待续传的升级文件发送给ONU，以完成ONU设备的升级。在一些示例中，其特征在于，上述历史信息包括中断标识信息和断点位置信息；上述并根据上述历史升级信息生成第二报文并发送至上述OLT，包括：根据中断标识信息和断点位置信息生成第二报文并发送至上述OLT。具体的，历史信息中包括中断标识信息和断点位置信息，中断标识信息可以包括：0000对应的状态为--命令处理成功；0001对应的状态为--命令处理错误；0010对应的状态为--不支持命令；0011对应的状态为--参数错误；0100对应的状态为--未知管理实体；0101对应的状态为--未知受管实体实例；0110对应的状态为--设备忙；0111对应的状态为--上次升级意外停止；只有在中断标识信息为0111时，标识上次升级意外停止，此时OLT根据断点位置向ONU传输升级文件的待续传部分。在一些示例中，其特征在于，上述断点位置信息包括窗口索引和分节索引。具体的，一个升级文件可分为多个窗口，每个窗口包含多个分节,在ONU设备升级过程中，通过基本消息格式进行信息交互；基本消息格式中每个分节有31个字节。在升级中断时，可以通过记录窗口索引和分节索引准确定位断点的位置，OLT能够根据断点的位置发送确定升级文件中的待续传部分，并发送至ONU完成更新。在一些示例中，还包括：在OMCI协议的G.988规范的开始软件下载响应消息中增加上次升级意外停止原因标识并插入窗口索引和分节索引字段。具体的，实施例是基于OMCI协议的G.988规范提出的ONU设备升级方法，针对新拓展的断点续传功能在G.988规范的开始软件下载响应消息中，增加上次升级意外停止原因标识，以及插入窗口索引和分节索引字段完成功能的扩展，具体可在G.988规范中的开始软件下载响应的消息体中第9字节，增加0111对应的状态为上次升级意外停止，以扩充升级停止的标志，10字节添加分节索引，11-12字节添加窗口索引，10-12字节用来存储断点的分节索引和窗口索引，17字节增加强制标志字段用来表征OLT设备是否具有数据续传能力。请参阅图2，本申请实施例中ONU设备升级装置的一个实施例，可以包括：接收单元21，用于接收所属的OLT下发的第一报文，其中，所述第一报文中包括升级消息，所述升级消息包括设备信息；判断单元22，用于基于所述设备信息判断所述OLT是否有续传数据功能；升级单元23，用于在所述OLT具有所述续传数据功能的情况下，基于所述升级消息获取所述ONU的历史升级信息，并根据所述历史升级信息生成第二报文并发送至所述OLT，以使所述OLT根据所述第二报文向所述ONU发送第三报文，所述第三报文为基于所述历史升级信息确定的升级文件中的待续传部分。借由上述技术方案，本申请实施例还提供了一种ONU设备升级装置，主要解决在于在ONU升级中断时，升级文件续传问题。本方案通过OLT下发的第一报文，ONU可根据第一报文中的设备信息对所对应的OLT设备是否具有续传数据功能做出判断，如果有续传功能，那么查询ONU的升级记录，并将断点的位置记录下来，生成第二报文发与OLT，OLT根据断点的位置将其余为传输的文件传给ONU，以供ONU完成升级，通过此方法可针对ONU升级中断的现象，在断点处续传文件，这样节省了ONU的升级时间，也为意外中断升级提供了另一种解决方案。本申请实施例还提供了一种存储介质，其上存储有程序，该程序运行时控制该存储介质所在设备执行时实现以下ONU设备升级方法：接收所属的OLT下发的第一报文，其中，上述第一报文中包括升级消息，上述升级消息包括设备信息；基于上述设备信息判断上述OLT是否有续传数据功能；在上述OLT具有上述续传数据功能的情况下，基于上述升级消息获取上述ONU的历史升级信息，并根据上述历史升级信息生成第二报文并发送至上述OLT，以使上述OLT根据上述第二报文向上述ONU发送第三报文，上述第三报文为基于上述历史升级信息确定的升级文件中的待续传部分。可选的，还包括：在上述OLT不具有上述续传数据功能的情况下，向上述OLT发送第四报文，上述第四报文包括上述升级文件的重传请求。可选的，上述设备信息储存在开启软件下载消息的消息体中。可选的，其特征在于，上述历史升级信息储存在开始软件下载响应的消息体中。可选的，其特征在于，上述历史信息包括中断标识信息和断点位置信息；上述并根据上述历史升级信息生成第二报文并发送至上述OLT，包括：根据中断标识信息和断点位置信息生成第二报文并发送至上述OLT。可选的，其特征在于，上述断点位置信息包括窗口索引和分节索引。可选的，还包括：在OMCI协议的G.988规范的开始软件下载响应消息体中增加上次升级意外停止原因标识，以及插入窗口索引和分节索引字段。。如图3所示，本申请实施例还提供一种电子设备300，包括存储器310、处理器320及存储在存储器320上并可在处理器上运行的计算机程序311，处理器320执行计算机程序311时实现上述ONU设备升级的任一方法的步骤。由于本实施例所介绍的电子设备为实施本申请实施例中一种ONU设备升级装置所采用的设备，故而基于本申请实施例中所介绍的方法，本领域所属技术人员能够了解本实施例的电子设备的具体实施方式以及其各种变化形式，所以在此对于该电子设备如何实现本申请实施例中的方法不再详细介绍，只要本领域所属技术人员实施本申请实施例中的方法所采用的设备，都属于本申请所欲保护的范围。在具体实施过程中，该计算机程序311被处理器执行时可以实现图1对应的实施例中任一实施方式。需要说明的是，在上述实施例中，对各个实施例的描述都各有侧重，某个实施例中没有详细描述的部分，可以参见其它实施例的相关描述。本领域内的技术人员应明白，本申请的实施例可提供为方法、系统、或计算机程序产品。因此，本申请可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本申请可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本申请是参照根据本申请实施例的方法、设备、和计算机程序产品的流程图和/或方框图来描述。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式计算机或者其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。本申请实施例还提供了一种计算机程序产品，该计算机程序产品包括计算机软件指令，当计算机软件指令在处理设备上运行时，使得处理设备执行如图1对应实施例中的ONU设备升级的流程。计算机程序产品包括一个或多个计算机指令。在计算机上加载和执行计算机程序指令时，全部或部分地产生按照本申请实施例的流程或功能。计算机可以是通用计算机、专用计算机、计算机网络、或者其他可编程装置。计算机指令可以存储在计算机可读存储介质中，或者从一个计算机可读存储介质向另一计算机可读存储介质传输，例如，计算机指令可以从一个网站站点、计算机、服务器或数据中心通过有线)或无线方式向另一个网站站点、计算机、服务器或数据中心进行传输。计算机可读存储介质可以是计算机能够存储的任何可用介质或者是包含一个或多个可用介质集成的服务器、数据中心等数据存储设备。可用介质可以是磁性介质，、光介质、或者半导体介质)等。所属领域的技术人员可以清楚地了解到，为描述的方便和简洁，上述描述的系统，装置和单元的具体工作过程，可以参考前述方法实施例中的对应过程，在此不再赘述。在本申请所提供的几个实施例中，应该理解到，所揭露的系统，装置和方法，可以通过其它的方式实现。例如，以上所描述的装置实施例仅仅是示意性的，例如，单元的划分，仅仅为一种逻辑功能划分，实际实现时可以有另外的划分方式，例如多个单元或组件可以结合或者可以集成到另一个系统，或一些特征可以忽略，或不执行。另一点，所显示或讨论的相互之间的耦合或直接耦合或通信连接可以是通过一些接口，装置或单元的间接耦合或通信连接，可以是电性，机械或其它的形式。作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部单元来实现本实施例方案的目的。另外，在本申请各个实施例中的各功能单元可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中。上述集成的单元既可以采用硬件的形式实现，也可以采用软件功能单元的形式实现。集成的单元如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本申请的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的全部或部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台计算机设备执行本申请各个实施例方法的全部或部分步骤。而前述的存储介质包括：U盘、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质。以上，以上实施例仅用以说明本申请的技术方案，而非对其限制；尽管参照前述实施例对本申请进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修该，或者对其中部分技术特征进行等同替换；而这些修该或者替换，并不使相应技术方案的本质脱离本申请各实施例技术方案的精神和范围。
