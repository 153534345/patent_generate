标题title
一种适用于多旋翼飞行器飞控系统的测试系统和测试方法
摘要abst
本发明公布了一种适用于多旋翼飞行器飞控系统的测试系统和测试方法，该测试系统包括飞行动力学模块、传感器模块、仿真模型集成模块、测试实例模块和数据分析模块，上述五个模块构成闭环数据流，且飞行动力学模块、传感器模块、仿真模型集成模块及测试实例模块均运行在实时嵌入式单片机中。该测试方法通过在实时计算机上部署多旋翼飞行动力学模型和传感器模型，可以在仿真环境下实时运行飞行控制系统，搭建适用于不同构型的多旋翼飞行器飞行控制系统的测试系统和方法，具有更好的通用性，保证了后续多旋翼飞行器实际飞行过程中的安全性；而且，利用本发明的测试方法能够大大缩短飞行器的研发周期。
权利要求书clms
1.一种适用于多旋翼飞行器飞控系统的测试系统，其特征在于，包括飞行动力学模块、传感器模块、仿真模型集成模块、测试实例模块和数据分析模块，上述五个模块构成闭环数据流，且所述飞行动力学模块、传感器模块、仿真模型集成模块及测试实例模块均运行在实时嵌入式单片机中；所述测试实例模块生成激励信号发送给待测飞行控制器；所述仿真模型集成模块将待测飞行控制器的控制信号发送至飞行动力学模块；所述飞行动力学模块产生多旋翼飞行器角运动和线运动信息并发送至传感器模块；所述传感器模块将带有噪声的飞行器角运动和线运动信息发送至飞行控制器；所述数据分析模块接受待测飞行控制器反馈的期望信号和反馈信号。2.采用如权利要求1所述的测试系统对多旋翼飞行器飞控系统进行测试的方法，其特征在于，包括如下步骤：S1、建立多旋翼飞行器的飞行动力学模型：利用多旋翼飞行器的三维数字模型，确定其飞行动力学模型的输入参数，计算动力学模块和运动学模块；S2、分别建立加速度计、陀螺仪、磁力计、气压计及GPS的传感器数字模型；S3、将建立的多旋翼数字化模型部署到待测的飞行控制器平台，进行仿真模型集成；S4、输入测试实例，比较仿真测试结果和待测飞行控制器硬件平台输出的结果；S5、根据测试结果修正多旋翼飞行器控制系统控制逻辑。3.根据权利要求2所述的测试方法，其特征在于，所述步骤S1中，输入参数包括：飞行器总质量、X轴转动惯量、Y轴转动惯量、Z轴转动惯量、XY轴惯性积、XZ轴惯性积、YZ轴惯性积、横向通道上的旋翼中心和机体中心距离、横向通道上的旋翼中心和机体中心距离、单个旋翼产生的最大升力、单个旋翼产生的最大扭矩、机身阻力系数、机身阻尼力矩系数。4.根据权利要求2所述的测试方法，其特征在于，所述步骤S1中，动力学模块的计算过程为：其中，表示多旋翼飞行器的重量，分别表示多旋翼飞行器机体坐标系下的三个线速度，分别表示多旋翼飞行器绕着机体坐标系的三个角速度，、、、、及分别表示的导数；其中，输出变量、、、分别为机体坐标系下的总拉力和绕着三个主轴的力矩，具体地：，输入参数为每个电机PWM归一化后的值，表示多旋翼飞行器电机的数量，为多旋翼飞行器每个旋翼产生滚转力矩的滚转系数，为多旋翼飞行器每个旋翼产生俯仰力矩的俯仰系数，多旋翼飞行器每个旋翼产生偏航力矩的偏航系数。5.根据权利要求4所述的测试方法，其特征在于，所述步骤S1中，运动学模块的计算过程为： ，其中，、、为惯性坐标系下的三维位置坐标，、、为飞行器的欧拉角姿态表示，表示从机体坐标系到惯性坐标系的转换矩阵。6.根据权利要求2所述的测试方法，其特征在于，所述步骤S2中，包括：建立三轴加速度计的计算模型，计算步骤为：，其中，为加速度计模型的输出，为加速度计的高斯白噪声，为重力常量，表示机体坐标系下的线加速度，表示机体坐标系下的角速度向量，表示机体坐标系下的线速度，表示惯性坐标系到机体坐标系的转化矩阵；建立三轴陀螺仪的计算模型，计算步骤为：，其中，为陀螺仪模型的输出，为陀螺仪的高斯白噪声，为机体坐标系下的角速度向量；建立三轴磁力计的计算模型，计算步骤为：，其中，为磁力计模型的输出，为磁力计的高斯白噪声，为惯性坐标系到机体坐标系的转化矩阵；建立气压计的计算模型，计算步骤为：，其中，为气压计模型的输出，为气压计的高斯白噪声，为多旋翼飞行器的实际高度；建立GPS的计算模型，计算步骤为：，其中，为GPS模型的输出，为GPS的高斯白噪声，为多旋翼飞行器的实际位置。7.根据权利要求2所述的测试方法，其特征在于，所述步骤S3中，仿真模型具体的集成过程为：将步骤S1和步骤S2得到的模型转化为C/C++代码，并将模型代码部署到实时微控制器中，然后将控制器作为实际飞行器控制系统的一部分来进行测试。8.根据权利要求2所述的测试方法，其特征在于，所述步骤S4中，首先测试姿态控制模式控制逻辑是否正确，然后测试位置控制模式控制逻辑是否正确。9.根据权利要求8所述的测试方法，其特征在于，所述姿态控制模式控制逻辑包括：俯仰通道、滚转通道及偏航通道的控制逻辑；位置控制模式控制逻辑包括：水平纵向通道、水平横向通道及高度通道的控制逻辑。10.根据权利要求2所述的测试方法，其特征在于，所述步骤S5中，如果待测试的期望信号和实际反馈的期望信号的变化规律一致，则控制逻辑正确，测试通过；否则返回步骤S4，修正飞行控制器的飞行控制逻辑。
说明书desc
技术领域本发明涉及一种测试系统及测试方法，具体涉及一种适用于多旋翼飞行器飞控系统的快速测试系统及测试方法；属于飞控系统相关技术领域。背景技术在一些新构型飞行器飞行控制系统的设计研发流程中，测试和验证通常安排在流程后期，因而难以识别及纠正设计阶段存在的错误。如果在多旋翼飞行器控制系统研发后期发现设计逻辑上的错误，可能需要数周乃至数月耗费巨资返工，并且会因此导致延迟。如果直接在原型机上测试新开发的飞行控制系统，极大概率会发生炸机事故，造成不必要的财产损失，存在重大安全隐患问题。鉴于上述原因，如何安全快速高效地对飞行器控制系统进行测试和评估、并降低研发成本、提高研发效率是亟待解决的一个问题。发明内容为解决现有技术的不足，本发明的目的在于提供一种适用于多旋翼飞行器控制系统的快速测试方法，通过逻辑测试以保证飞行控制系统的安全性能。为了实现上述目标，本发明采用如下的技术方案：本发明首先公布了一种适用于多旋翼飞行器飞控系统的测试系统，其包括飞行动力学模块、传感器模块、仿真模型集成模块、测试实例模块和数据分析模块，上述五个模块构成闭环数据流，且所述飞行动力学模块、传感器模块、仿真模型集成模块及测试实例模块均运行在实时嵌入式单片机中；所述测试实例模块生成激励信号发送给飞行控制器；所述仿真模型集成模块将飞行控制器的控制信号发送至飞行动力学模块；所述飞行动力学模块产生多旋翼飞行器角运动和线运动信息并发送至传感器模块；所述传感器模块将带有噪声的飞行器角运动和线运动信息发送至飞行控制器；所述数据分析模块接受飞行控制器反馈的期望信号和反馈信号。本发明还公布了采用如前所述的测试系统对多旋翼飞行器飞控系统进行测试的方法，包括如下步骤：S1、建立多旋翼飞行器的飞行动力学模型：利用多旋翼飞行器的三维数字模型，确定其飞行动力学模型的输入参数，计算动力学模块和运动学模块；S2、分别建立加速度计、陀螺仪、磁力计、气压计及GPS的传感器数字模型；S3、将建立的多旋翼数字化模型部署到待测的飞行控制器平台，进行仿真模型集成；S4、输入测试实例，比较仿真测试结果和待测飞行控制器硬件平台输出的结果；S5、根据测试结果修正多旋翼飞行器控制系统控制逻辑。优选地，前述步骤S1中，输入参数包括：飞行器总质量、X轴转动惯量、Y轴转动惯量、Z轴转动惯量、XY轴惯性积、XZ轴惯性积、YZ轴惯性积、横向通道上的旋翼中心和机体中心距离、横向通道上的旋翼中心和机体中心距离、单个旋翼产生的最大升力、单个旋翼产生的最大扭矩、机身阻力系数、机身阻尼力矩系数。优选地，前述步骤S1中，动力学模块的计算过程为：，其中，表示多旋翼飞行器的重量，分别表示多旋翼飞行器机体坐标系下的三个线速度，分别表示多旋翼飞行器绕着机体坐标系的三个角速度。、、、、及分别表示的导数；输出变量、、、分别为机体坐标系下的总拉力和绕着三个主轴的力矩，具体地：，输入参数为每个电机PWM归一化后的值，表示多旋翼飞行器电机的数量，为多旋翼飞行器每个旋翼产生滚转力矩的滚转系数，为多旋翼飞行器每个旋翼产生俯仰力矩的俯仰系数，多旋翼飞行器每个旋翼产生偏航力矩的偏航系数。更优选地，前述步骤S1中，运动学模块的计算过程为： ，其中，、、为惯性坐标系下的三维位置坐标，、、为飞行器的欧拉角姿态表示，表示从机体坐标系到惯性坐标系的转换矩阵。再优选地，前述步骤S2具体包括：建立三轴加速度计的计算模型，计算步骤为：，其中，为加速度计模型的输出，为加速度计的高斯白噪声，为重力常量，表示机体坐标系下的线加速度，表示机体坐标系下的角速度向量，表示机体坐标系下的线速度，表示惯性坐标系到机体坐标系的转化矩阵；建立三轴陀螺仪的计算模型，计算步骤为：，其中，为陀螺仪模型的输出，为陀螺仪的高斯白噪声，为机体坐标系下的角速度向量；建立三轴磁力计的计算模型，计算步骤为：，其中，为磁力计模型的输出，为磁力计的高斯白噪声，为惯性坐标系到机体坐标系的转化矩阵；建立气压计的计算模型，计算步骤为：，其中，为气压计模型的输出，为气压计的高斯白噪声，为多旋翼飞行器的实际高度。建立GPS的计算模型，计算步骤为：，其中，为GPS模型的输出，为GPS的高斯白噪声，为多旋翼飞行器的实际位置。更优选地，在前述步骤S3中，仿真模型具体的集成过程为：将步骤S1和步骤S2得到的模型转化为C/C++代码，并将模型代码部署到实时微控制器中，然后将控制器作为实际飞行器控制系统的一部分来进行测试。进一步优选地，在前述步骤S4中，首先测试姿态控制模式控制逻辑是否正确，然后测试位置控制模式控制逻辑是否正确。所述姿态控制模式控制逻辑包括：俯仰通道、滚转通道及偏航通道的控制逻辑；位置控制模式控制逻辑包括：水平纵向通道、水平横向通道及高度通道的控制逻辑。更进一步优选地，前述步骤S5中，如果待测试的期望信号和实际反馈的期望信号的变化规律一致，则证明该通道的控制逻辑正确，如果变化规律完全相反，则需要返回步骤S4，修正飞行控制器的飞行控制逻辑。本发明的有益之处在于：该方法通过在实时计算机上部署多旋翼飞行动力学模型和传感器模型，可以在仿真环境下实时运行飞行控制系统；然后输入测试实例，比较仿真测试结果和待测飞行控制器硬件平台输出的结果，最后根据测试结果修正多旋翼飞行器控制系统控制逻辑。该方法中只需替换步骤S1中的动力分配模块，即可搭建适用于不同构型的多旋翼飞行器飞行控制系统测试，具有更好的通用性；通过该逻辑测试的飞行控制系统的安全性能得到了提高，保证了后续多旋翼飞行器实际飞行过程中的安全性。本发明可以在同一台实时计算机部署飞行控制系统和飞行动力学模型以及传感器模型，而传统的硬件在环仿真中的做法需要多台实时计算机，因此本发明的方法更为简单、方便，能够节约研发成本；该测试过程还可以与制造部门并发进行，无需等到新构型多旋翼飞行器样机研制后再进行测试，因此采用本发明中的测试方法能够大大缩短飞行器的研发周期。附图说明图1是本发明的一个实施例提供的多旋翼飞行器控制系统测试方法的流程示意图；图2是本发明的一个实施例提供的位置控制模式水平纵向通道测试结果示意图。具体实施方式以下结合附图和具体实施例对本发明作具体的介绍。参见图1，本发明的测试系统非常逼近真实环境，其包括：飞行动力学模块、传感器模块、仿真模型集成模块、测试实例模块和数据分析模块，还包括待测飞行控制器，除数据分析模块外，其余四个模块都是运行在实时嵌入式单片机中。其中，测试实例模块生成激励信号发送给待测飞行控制器；飞行控制器通过仿真模型集成模块发送控制信号至飞行动力学模块；飞行动力学模块产生多旋翼飞行器角运动和线运动信息发送至传感器模块；传感器模块将带有噪声的飞行器角运动和线运动信息发送至飞行控制器；飞行控制器将期望信号和反馈信号发送至数据分析模块，形成整个闭环数据流。本发明通过构建如上的测试系统，将飞控测试与样机制造并发进行，对飞控系统进行仿真环境下的模拟测试，以验证/修正飞控逻辑，完整的飞行控制系统逻辑测试包含姿态环和位置环的测试，这样能够显著节约研发周期。其中，整个测试系统的搭建过程为下述的步骤S1-S3，测试实施过程为下述的步骤S4-S5。S1、建立多旋翼飞行器的飞行动力学模型：利用多旋翼飞行器的三维数字模型，确定其飞行动力学模型的输入参数，计算其动力学模型的动力学模块和运动学模块。具体地，输入参数包括：飞行器总质量、X轴转动惯量、Y轴转动惯量、Z轴转动惯量、XY轴惯性积、XZ轴惯性积、YZ轴惯性积、横向通道上的旋翼中心和机体中心距离、横向通道上的旋翼中心和机体中心距离、单个旋翼产生的最大升力、单个旋翼产生的最大扭矩、机身阻力系数、机身阻尼力矩系数。从飞行控制系统接收到多旋翼飞行器动力学模型的输入信号为每个电机的PWM波信号。n 型旋翼中由每个电机PWM 信号到生成的多旋翼总拉力和力矩的计算步骤为：其中输入参数为每个电机PWM归一化后的值，表示多旋翼飞行器电机的数量，为多旋翼飞行器每个旋翼产生滚转力矩的滚转系数，为多旋翼飞行器每个旋翼产生俯仰力矩的俯仰系数，多旋翼飞行器每个旋翼产生偏航力矩的偏航系数， 输出变量、、、分别为机体坐标系下的总拉力和绕着三个主轴的力矩。接着，计算多旋翼飞行器动力学模型的动力学模块，其计算步骤为：其中，表示多旋翼飞行器的重量，分别表示多旋翼飞行器机体坐标系下的三个线速度，分别表示多旋翼飞行器绕着机体坐标系的三个角速度。、、、、及分别表示的导数。然后，计算多旋翼飞行器动力学模型的运动学模块，其计算步骤为：其中，、、为惯性坐标系下的三维位置坐标，、、为飞行器的欧拉角姿态表示，表示从机体坐标系到惯性坐标系的转换矩阵。S2、建立加速度计、陀螺仪、磁力计、气压计及GPS的传感器数字模型。首先，建立三轴加速度计的计算模型，计算步骤为：，其中，为加速度计模型的输出，为加速度计的高斯白噪声，为重力常量，表示机体坐标系下的线加速度，表示机体坐标系下的角速度向量，表示机体坐标系下的线速度，表示惯性坐标系到机体坐标系的转化矩阵。接着，建立三轴陀螺仪的计算模型，其计算步骤为：，其中，为陀螺仪模型的输出，为陀螺仪的高斯白噪声，为机体坐标系下的角速度向量。然后，建立三轴磁力计的计算模型，其计算步骤为：，其中，为磁力计模型的输出，为磁力计的高斯白噪声，为惯性坐标系到机体坐标系的转化矩阵。接着，建立气压计的计算模型，其计算步骤为：，其中，为气压计模型的输出，为气压计的高斯白噪声，为多旋翼飞行器的实际高度。最后，建立GPS的计算模型，其计算步骤为：，其中，这里的为GPS模型的输出，为GPS的高斯白噪声，为多旋翼飞行器的实际位置。S3、将建立的多旋翼数字化模型部署到待测的飞行控制器平台，即图1中的，为仿真模型集成过程。具体实施过程为：首先在台式计算机上进行系统级仿真，验证建立的多旋翼模型飞行动力学模型的性能参数，记录输入和输出数据，需注意必须保证模型在环仿真的测试结果正确，才能进入下一步在实时计算机环境运行建立的飞行动力学模型和传感器模型。具体地，将步骤S1和步骤S2得到的模型转化为C/C++代码，并将模型代码部署到实时微控制器中，然后将控制器作为实际飞行器控制系统的一部分进行测试。其中，飞行控制器和飞行动力学模型的接口为：，传感器模型和飞行控制器的接口为：其中，表示飞行控制器，其下标acc表示加速度计、gyr表示陀螺仪、mag表示磁力计、bar表示气压计、gps表示GPS定位模块；sensor表示传感器，其下表含义与上类似。表示将加速度传感器的数据传输到飞行控制器的加速度计计算模块，其它类似。这样一来，飞行控制器、飞行动力学模型、传感器模型三者构成了一个闭合回路，三者都是运行在实时计算机中，使得飞行控制器更加接近真实环境，模拟结果更加准确可靠。S4、输入测试实例，比较仿真测试结果和待测飞行控制器硬件平台输出的结果。首先，测试姿态控制模式控制逻辑是否正确。初始条件设置为：其中， 表示多旋翼飞行器初始高度为10米，表示初始俯仰角为0，表示初始滚转角为0，表示初始偏航角为0，表示初始第个电机的控制信号PWM为1500。测试姿态控制模式俯仰通道的步骤为：将实时飞行控制系统输入信号设置为=±30°，然后在飞行数据记录模块记录实时姿态角数据：，记录时间为10s，得到的数据命名为TestAttPitch。测试姿态控制模式滚转通道的步骤为：将实时飞行控制系统输入信号设置为=±30°，然后在飞行数据记录模块记录实时姿态角数据：，记录时间为10s，得到的数据命名为TestAttRoll。测试姿态控制模式偏航通道的步骤为：将实时飞行控制系统输入信号设置为=±30°，然后在飞行数据记录模块记录实时姿态角数据：，记录时间为10s，得到的数据命名为TestAttYaw。然后，测试位置控制模式控制逻辑是否正确。初始条件设置为：其中， 表示多旋翼飞行器初始高度为10米，、表示初始水平位置为0，表示初始俯仰角为0，表示初始滚转角为0，表示初始偏航角为0，表示初始第个电机的控制信号PWM为1500。测试位置控制模式水平纵向通道的步骤为：将实时飞行控制系统输入信号设置为，表示期望的纵向水平位移在正负一米内变化，然后在飞行数据记录模块记录实时位置和姿态角数据：、、、、、，记录时间为120s，得到的数据命名为TestPosNorth。测试位置控制模式水平横向通道的步骤为：将实时飞行控制系统输入信号设置为，表示期望的横向水平位移在正负一米内变化，然后在飞行数据记录模块记录实时位置和姿态角数据：、、、、、，记录时间为120s，得到的数据命名为TestPosEast。测试位置控制模式高度通道的步骤为：将实时飞行控制系统输入信号设置为=35，表示期望的高度为35m，然后在飞行数据记录模块记录实时位置和姿态角数据：、、、、、，记录时间为15s，得到的数据命名为TestPosHeight。S5、该步骤为图1中的飞控逻辑判断模块，实施方式为分析步骤S4得到的测试数据库，具体由前面步骤S4得到的TestAttPitch、TestAttRoll、TestAttYaw、TestPosNorth、TestPosEast、TestPosHeight数据包构成。该步骤的实质是根据测试结果修正多旋翼飞行器控制系统控制逻辑，然后返回步骤S4反复迭代。如果待测试的期望信号和实际反馈的期望信号的变化规律一致，则证明该通道的控制逻辑正确，如果变化规律完全相反，则需要返回步骤S4，修正飞行控制器的飞行控制逻辑。为了更好地理解本发明，以姿态控制模式的滚转通道为例进行说明：首先比较期望滚转角信号和实际反馈的滚转角信号在10s内的走向趋势，如果实际反馈的滚转角信号和期望滚转角信号的变化规律一样，则证明姿态模式下滚转通道的控制逻辑正确；如果变化规律完全相反，则需要返回步骤S4，修正飞行控制器的飞行控制逻辑。其他通道以及其他模式下的各个通道飞行控制逻辑测试类似，在此不再赘述。图2为本实施例提供的一个飞行器控制系统水平位置控制器测试结果示意图，黑色实线代表期望水平位置信号，黑色虚线代表真实多旋翼水平位置，可以看到二者变化的趋势大体一致，表明所测试的水平位置控制器逻辑设计正确；如果二者的变化趋势差别很大或完全相反，则说明测试的控制器逻辑设计错误，需要飞行器飞行控制系统设计人员进行修正，修正之后再重新进行测试，直到二者的变化趋势基本一致，结束该测试实例。由此可见，本发明的测试方法能够适应飞行器的飞控系统测试需求，使飞行器的性能得到提高，保证飞行器在后续实际飞行过程中的安全性，并且该测试方法能够与制造部门并发进行，可大大缩短研发周期并降低研发成本。以上显示和描述了本发明的基本原理、主要特征和优点。本行业的技术人员应该了解，上述实施例不以任何形式限制本发明，凡采用等同替换或等效变换的方式所获得的技术方案，均落在本发明的保护范围内。
