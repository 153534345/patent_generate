标题title
一种锥束CT系统和轴对称外形样品的几何误差校正方法
摘要abst
本申请属于锥束CT技术领域，具体公开一种锥束CT系统和轴对称外形样品的几何误差校正方法，包括：获取轴对称外形样品的投影图像，基于获取的投影图像构建二值图像；对二值图像进行Radon变换，求解样品形态的旋转误差，并基于旋转误差反向旋转校正投影图像；基于反向校正后的投影图像对称性，求解样品横向偏移误差，并基于横向偏移误差反向平移校正投影图像。本方法不需要使用标定体模，扫描流程得以简化，省去了设计、加工标定体模的成本，无需反复重建图像以动态调整几何参数，计算效率得以大幅提升，对样品仅有外形轴对称的要求，适用范围广泛。
权利要求书clms
1.一种锥束CT系统和轴对称外形样品的几何误差校正方法，其特征在于，包括：获取轴对称外形样品的投影图像，基于获取的投影图像构建二值图像；对二值图像进行Radon变换，求解样品形态的旋转误差，并基于旋转误差反向旋转校正投影图像；基于反向校正后的投影图像的对称性，求解样品横向偏移误差，并基于横向偏移误差反向平移校正投影图像。2.根据权利要求1所述的一种锥束CT系统和轴对称外形样品的几何误差校正方法，其特征在于，获取轴对称外形样品的投影图像，其类间方差计算公式为：，其中，为前景的像素所占的比例，为背景的像素所占的比例，为前景的平均灰度值，为背景的平均灰度值，为像素个数，为前景和背景的分割阈值，为灰度值小于的像素个数，为灰度值大于的像素个数；遍历计算得到类间方差最大的灰度值。3.根据权利要求2所述的一种锥束CT系统和轴对称外形样品的几何误差校正方法，其特征在于，基于获取的投影图像构建二值图像的方法包括：令中灰度值大于的像素在中灰度值为1，中灰度值小于的像素在中灰度值为0，将投影图像转换为二值图像。4.根据权利要求1所述的一种锥束CT系统和轴对称外形样品的几何误差校正方法，其特征在于，对二值图像进行Radon变换的方法包括：设定倾斜的角度范围为，则Radon变换的结果：；其中，表示将二值图像反方向旋转角度，方法是以图像的中心为坐标原点，记旋转后的图像为，对中的任一点坐标，在中找到一点与之对应：，当和不为整数时，通过双线性插值可求出；所述双线性插值计算方法为：记与x相邻的两个整数分别是和，；与y相邻的两个整数分别是和，；则：；令，则表示将图像按列求和，方法是，其中，；获取Radon变换的结果集合，查找集合中零元素数量最多的数组，得到旋转误差；记，对求解一阶差分，则：，计算得到中第一个非零元素的位置索引和最后一个非零元素的位置索引，则探测器的横向偏移误差，其中，为探测器中心列的位置索引。
说明书desc
技术领域本申请属于锥束CT技术领域，具体地说涉及一种锥束CT系统和轴对称外形样品的几何误差校正方法。背景技术锥束CT系统的组装、使用过程中会不可避免地引入几何误差，这些几何误差改变了三维物体与二维投影图像之间的映射关系，不正确的几何映射会导致重建图像上出现几何伪影，降低重建图像的质量，影响基于重建图像的测量的精度。通常，探测器绕法线的旋转误差和横向偏移误差对重建图像的影响是最大的，因此，必须标定出旋转误差和横向偏移误差，并对其进行校正。目前，常用的几何标定方法包括离线标定方法和在线标定方法。离线标定方法根据一组已知空间坐标的标定点及其投影坐标之间的联系来求解锥束CT系统的几何参数。因此，离线标定方法离不开标定体模，通常需要先扫描体模完成几何标定，再扫描样品，不仅流程繁琐，还难以保证体模和样品的摆放位置一致。另外，高精度的体模的加工成本不菲，不同锥束CT系统适用的体模也不统一，对于一些特殊的锥束CT系统，由于一些客观条件的限制，更是难以设计体模。在线标定方法通常从几何参数与重建图像的一些质量评价指标之间的联系着手，构建目标函数，通过求解目标函数优化问题，达到标定几何参数的目的。通常，在线标定方法需要反复地重建图像以动态调整几何参数，繁重的计算负担限制了在线标定方法的使用。因此，现有技术还有待于进一步发展和改进。发明内容针对现有技术的种种不足，为了解决上述问题，现提出一种锥束CT系统和轴对称外形样品的几何误差校正方法。本申请提供如下技术方案：一种锥束CT系统和轴对称外形样品的几何误差校正方法，包括：获取轴对称外形样品的投影图像，基于获取的投影图像构建二值图像；对二值图像进行Radon变换，求解样品形态的旋转误差，并基于反向旋转校正投影图像；基于反向校正后的投影图像的对称性，求解样品横向偏移误差，并基于反向平移校正投影图像。进一步的，获取轴对称外形样品的投影图像，其类间方差计算公式为：，其中，为前景的像素所占的比例，为背景的像素所占的比例，为前景的平均灰度值，为背景的平均灰度值，为像素个数，为前景和背景的分割阈值，为灰度值小于的像素个数，为灰度值大于的像素个数；遍历计算得到类间方差最大的灰度值。进一步的，基于获取的投影图像构建二值图像的方法包括：令中灰度值大于的像素在中灰度值为1，中灰度值小于的像素在中灰度值为0，将投影图像转换为二值图像。进一步的，对二值图像进行Radon变换的方法包括：设定倾斜的角度范围为，则Radon变换的结果：，其中，表示将二值图像反方向旋转角度，方法是以图像的中心为坐标原点，记旋转后的图像为，对中的任一点坐标，在中找到一点与之对应：，当和不为整数时，通过双线性插值可求出；所述双线性插值计算方法为：记与x相邻的两个整数分别是和，；与y相邻的两个整数分别是和，；则：；令，则表示将图像按列求和，方法是，其中，；获取Radon变换的结果集合，查找集合中零元素数量最多的数组，得到旋转误差；记，对求解一阶差分，则：，计算得到中第一个非零元素的位置索引和最后一个非零元素的位置索引，则探测器的横向偏移误差，其中，为探测器的中心列的索引。一种计算机可读存储介质，其上存储有计算机程序，该程序被处理器执行时实一种锥束CT系统和轴对称外形样品的几何误差校正方法。一种电子终端，包括：处理器及存储器；所述存储器用于存储计算机程序，所述处理器用于执行所述存储器存储的计算机程序，以使所述终端执行一种锥束CT系统和轴对称外形样品的几何误差校正方法。有益效果：1、扫描样品前不用先扫描标定体模，扫描流程得以简化，省去了设计、加工标定体模的成本；适用于无法使用标定体模的情形；2、从样品的投影图像直接解析求解几何误差，无需建立几何误差与重建图像质量之间的联系，无需反复重建图像以动态调整几何参数，计算效率得以大幅提升；3、对样品品质要求低，只要求样品的外形轴对称就可使用本方法，不要求样品均质，也不要求样品内部结构轴对称，这样的样品在实际的锥束CT应用场景中很多；4、本申请的校正方法不仅仅适用于圆轨迹锥束CT系统，也适用于螺旋轨迹锥束CT系统；5、增加了适用范围，无需假设扫描过程中旋转中心固定不动，适用于扫描过程中旋转中心发生移动或扫描的角度范围受限的情形。附图说明图1本发明提出的投影图像自校正算法流程图。具体实施方式下面结合附图和实施例对本申请作进一步的详细说明。可以理解的是，此处所描述的具体实施例仅仅用于解释相关发明，而非对该发明的限定。另外还需要说明的是，为便于描述，附图中仅示出了与有关发明相关的部分。需要说明的是，在不冲突的情况下，本申请中的实施例及实施例中的特征可以相互组合。下面将参考附图并结合实施例来详细说明本申请。典型的锥束CT系统中，SOD表示源到旋转轴的距离，SDD表示源到探测器的距离，当待扫描样品的外形轴对称时，提出一种投影图像自校正算法，它从投影图像自动求解对图像重建影响最大的和。轴对称外形样品在CT应用场景中是非常常见的。较之传统离线标定方法，PISC算法无需使用体模，扫描便捷，节约成本；较之传统在线标定方法，PISC算法无需迭代优化目标函数，避免反复重建图像的沉重计算负担。如图1所示，PISC算法具体包括如下三步：S1、获取轴对称外形样品的投影图像，基于获取的投影图像构建二值图像；通过选取合适的图像阈值，对每幅投影图像进行二值化操作，使得图像上只保留样品的形态特征。S2、对二值图像进行Radon变换，求解样品形态的旋转误差，并基于反向旋转校正投影图像；在二值图像上，体现为样品形态的倾斜，使用Radon变换逐角度搜索的方法可以求解，依据的原理是：当搜索角度恰好为时，Radon变换所得的数组中零元素的数量最多，通过将投影图像反方向旋转，完成探测器倾斜校正。S3、基于反向校正后的投影图像对称性，求解样品横向偏移误差，并基于反向平移校正投影图像；对于完成了校正的二值图像，根据样品形态的对称性，体现为形态中心列与图像中心列的差值，通过将投影图像反方向平移，完成探测器横向偏移校正。上述三个步骤的实施顺序不可变换。S1的具体实现为：设在第个扫描角度下采集到的投影图像为，共包含N个像素，所有像素的平均灰度值为；将前景和背景的分割阈值记作，可统计灰度值小于的像素个数为，大于的像素个数为；则中属于前景的像素所占的比例为，前景的平均灰度为；属于背景的像素所占的比例为，背景的平均灰度为。定义类间方差为，使用遍历的方法求出最大的灰度值即为。构建与同尺寸的二值图像，中灰度值为1的像素对应中灰度值大于的像素，中灰度值为0的像素对应中灰度值小于的像素。S2的具体实现为：根据二值图像上样品形态的倾斜情况，先粗略估计再在内以为步长对依次进行Radon变换，则：，式中，表示Radon变换的结果，表示将二值图像反方向旋转角度，令，则表示将图像按列求和，因此，即先将反方向旋转角度，再按列求和的结果，是一个数组。对求得的集合，查找其中零元素数量最多的数组为，则样品形态的倾斜角度即旋转误差。将投影图像反方向旋转就完成了校正，用表示经校正的投影图像。上述的具体实现为：以图像的中心为坐标原点，记旋转后的图像为，对中的任一点坐标，可以在中找到一点与之对应：，由于表示图像矩阵第x行、第y列元素的值，因此作为索引的x和y必须为整数才能被查找到，但经过旋转操作后，得到的x和y可能会是浮点数，为了能被查找到，需要将有理数换算为整数，这就需要用到插值计算，双线性插值是常见的插值计算方法，具有计算精度高、计算速度快的特点，双线性插值法的原理是将某点相邻的四个点、、、的值，按照一定比例赋给，从而找到与原有理数值最近的替代整数。即当x和y不为整数时，可通过双线性插值可求出，使。上述双线性插值的具体实现为：记与x相邻的两个整数分别是和，；与y相邻的两个整数分别是和，；则：，记，则：。S3的具体实现为：由于S2中数组中的第一个和最后一个非零元素的位置，标识着对称样品轮廓上最外侧的位置，比起直接求该数组的第一个和最后一个非零元素的位置，对数组求一阶差分，再对一阶差分的结果求解第一个和最后一个非零元素的位置会更稳定，因为一阶差分运算本身有减轻数据之间不规律波动的作用，用表示将求一阶差分的结果，令和分别表示中第一个和最后一个非零元素的位置索引，则样品的对称轴的位置索引可表示为。记探测器的中心列的索引为，该中心列的索引是根据探测器获取的已知量。由于理想情况下样品的对称轴应与探测器中心列重合，因此探测器的横向偏移为。将经校正的投影图像反方向平移就完成了校正，用表示经校正的投影图像。上述求一阶差分的具体实现为：记，则：。PISC算法本质上是一种在线标定方法，因此它不依赖标定体模，同时，PISC算法的原理是从样品的形态特征着手，从投影图像解析求解几何误差，无需进行计算负担繁重的目标函数求解过程，计算效率大幅提升，并且，PISC算法根据每幅投影图像分别求解几何误差，避免了扫描过程中旋转中心固定不动的假设，从而适用于扫描过程中旋转中心发生移动的情况。本发明实施例二提供了一种设备，包括存储器和处理器，存储器用于存储程序，存储器可通过总线与处理器连接。存储器可以是非易失存储器，例如硬盘驱动器和闪存，存储器中存储有软件程序和设备驱动程序。软件程序能够执行本发明实施例提供的上述方法的各种功能；设备驱动程序可以是网络和接口驱动程序。处理器用于执行软件程序，该软件程序被执行时，能够实现本发明实施例一提供的方法。本发明实施例三提供了一种包含指令的计算机程序产品，当计算机程序产品在计算机上运行时，使得计算机执行本发明实施例一提供的方法。本发明实施例四提供了一种计算机可读存储介质，计算机可读存储介质上存储有计算机程序，计算机程序被处理器执行时实现本发明实施例一提供的方法。专业人员应该还可以进一步意识到，结合本文中所公开的实施例描述的各示例的单元及算法步骤，能够以电子硬件、计算机软件或者二者的结合来实现，为了清楚地说明硬件和软件的可互换性，在上述说明中已经按照功能一般性地描述了各示例的组成及步骤。这些功能究竟以硬件还是软件方式来执行，取决于技术方案的特定应用和设计约束条件。专业技术人员可以对每个特定的应用来使用不同方法来实现所描述的功能，但是这种实现不应认为超出本发明的范围。结合本文中所公开的实施例描述的方法或算法的步骤可以用硬件、处理器执行的软件模块，或者二者的结合来实施。软件模块可以置于随机存储器、内存、只读存储器、电可编程ROM、电可擦除可编程ROM、寄存器、硬盘、可移动磁盘、CD-ROM、或技术领域内所公知的任意其它形式的存储介质中。以上的具体实施方式，对本发明的目的、技术方案和有益效果进行了进一步详细说明，所应理解的是，以上仅为本发明的具体实施方式而已，并不用于限定本发明的保护范围，凡在本发明的精神和原则之内，所做的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
