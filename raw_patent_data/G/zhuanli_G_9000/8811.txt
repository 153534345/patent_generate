标题title
一种乐观的不需要回退的拜占庭容错共识方法
摘要abst
本发明公开了一种乐观的不需要回退的拜占庭容错共识方法，所述方法包括主节点发起提案，所有节点对提案进行第一轮投票，主节点根据第一轮的投票结果判断系统的情况是否为乐观情况，在乐观和非乐观情况下采用不同的共识方法对提案进行共识；所有节点对主节点发来的提案请求进行验证，并根据消息类型执行相应的操作；在这个过程中，若节点发现主节点存在拜占庭行为，则广播视图更改请求以选举新的主节点。本发明可在区块链应用中可应用于共识层作为共识协议，其实现方法简单，通用性强，且有效降低了带宽的消耗，具有高效、高鲁棒性等优点。
权利要求书clms
1.一种乐观的不需要回退的拜占庭容错共识方法，其特征在于，包括以下步骤：客户端C在区块链系统中发起交易并发送请求M＝＜REQUEST，TX，σc＞，σc←Sign给主节点Sp，同时客户端C设定计时器，其中，σ表示签名，下标表示签名者，Sign是签名函数，TX为客户端请求执行的交易；主节点Sp收到请求M并验证σc签名后，广播＜PRE-PREPARE，M，sn，v，σp＞，σp←Sign，sn，v＞)给所有节点Si，i＝1，...，；节点只处理视图编号与节点所处视图编号一致的信息，同时主节点Sp设定计时器并等待节点发来的投票信息，其中，为区块链系统中节点个数，包括至多f个拜占庭节点和至少个正确节点；v是节点Sp所处视图的视图编号，sn是主节点分配给请求M的编号；节点Si收到步骤中发来的＜PRE-PREPARE，M，sn，v，σp＞，验证σp后对其进行投票发送＜PREPARE，H，sn，v，σi＞，σi←Sign，sn，v＞)给主节点Sp；主节点Sp根据收到的投票信息数量判断是否为乐观情况并广播信息告诉其他节点，其中，若主节点Sp收到一致的投票信息数量为，则为乐观情况，若主节点Sp收到一致的投票信息数量为～3f，则为一般情况；若步骤中判断为一般情况节点Si根据主节点Sp广播的信息进行第二轮投票，若为乐观情况，节点Si根据主节点Sp广播的信息直接执行请求并将结果反馈给客户端C；第二轮投票后主节点Sp依据投票结果判断是否可以执行请求，若可以广播信息告诉其他节点，其他节点根据主节点Sp广播的信息直接执行请求并将结果反馈给客户端C；在步骤～执行过程中，若节点发现主节点存在拜占庭行为，则广播视图更改请求信息以选举新的主节点，在新的主节点下完成后续共识。2.根据权利要求1所述的乐观的不需要回退的拜占庭容错共识方法，其特征在于，所述步骤通过以下子步骤来实现：判断系统状态：主节点Sp在计时器结束前，一旦收到来自个不同节点签名的一致的投票信息，则认为系统状态为乐观情况；若主节点Sp在计时器结束时只收到～3f个不同节点签名的一致的投票信息＜PREPARE，H，sn，v，σi＞，则认为系统状态为一般情况；其中，一致的投票信息为H，sn，v相同且签名正确的〈PREPARE，H，sn，v，σi＞；主节点Sp根据系统状态广播信息告诉其他节点：乐观情况下，主节点Sp将收到的个不同节点签名进行聚合Aggre为签名聚合函数，并广播信息给所有节点Si；一般情况下，主节点Sp将收到的～3f个不同节点签名中的个签名进行聚合并广播信息给所有节点Si。3.根据权利要求2所述的乐观的不需要回退的拜占庭容错共识方法，其特征在于，所述步骤具体为：若节点Si收到步骤中主节点Sp发送的信息验证签名后直接执行其对应的请求，并发送＜REPLY，res，sn，v，σi”＞，σi”←Sign，sn，v)给客户端C，其中，res为执行请求的结果。若节点Si收到步骤中主节点Sp发送的信息验证签名后，对其对应的请求进行第二轮投票，发送＜COMMIT，H，sn，v，σi’＞，σi’←Sign，sn，v，COMMIT＞)给主节点Sp。主节点Sp一旦收到发来的个不同节点签名的一致的投票信息〈COMMIT，H，sn，v，σi’＞，则认为该请求可以被执行，主节点Sp将个不同节点签名聚合并广播信息给所有节点Si。若节点Si收到主节点Sp发送的验证两个聚合签名后直接执行该请求，并发送＜REPLY，res，sn，v，σi”＞，σi”←Sign，sn，v＞)给客户端C。4.根据权利要求1-3任一项所述的乐观的不需要回退的拜占庭容错共识方法其特征在于，所述若节点发现主节点存在拜占庭行为，则广播视图更改请求信息以选举新的主节点通过以下子步骤来实现：检测拜占庭行为：如果客户端C在规定时间内没有收到至少个不同节点签名的一致的结果信息，则广播信息M＝＜REQUEST，TX，σc＞给所有节点Si，当节点Si收到该信息后开启计时器，若计时器结束前Si没有收到主节点Sp发来的对应请求M的任何信息或在验证Sp发送的信息的签名时发现拜占庭行为，Si广播视图更改请求信息〈REQ-VIEW-CHANGE，v，σrvi＞，σrvi←Sign以请求选举新的主节点；节点Si一但收到个不同节点签名的一致的视图更改请求信息＜REQ-VIEW-CHANGE，v，σrvi＞，则广播一条携带本地消息日志L的信息＜VIEW-CHANGE，v+1，L，σLi＞，σLi←Sign＞)表示已准备好选举新的主节点；其中L包含节点收到的所有PRE-PREPARE、PREPARED、COMMITTED信息；构造新的消息日志：节点Si一旦收到个不同节点签名的一致的〈VIEW-CHANGE，v+1，L，σLi＞，则该节点根据收到的个消息日志和以下规则构造新的消息日志a、若消息日志中存在步骤或步骤中广播的COMMITTED信息，则将该信息对应的PRE-PREPARE信息添加到中，并且将其标记为“待执行”；b、若消息日志中存在个M，sn，v都一致且签名正确的步骤中广播的PRE-PREPARE信息，同时存在步骤中广播的拥有相同sn且签名正确的PREPARED信息，但其对应的PRE-PREPARE信息不同于这个一致的PRE-PREPARE信息，则选择拥有视图编号较大的信息对应的PRE-PREPARE信息添加到中，并且将其标记为“待投票”；c、若消息日志中只存在个一致的且签名正确的步骤中广播的PRE-PREPARE信息，则将该PRE-PREPARE信息添加到中，并且将其标记为“待投票”；d、若消息日志中只存在签名正确的步骤中广播的PREPARED信息，则将该信息对应的PRE-PREPARE信息添加到中，并且将其标记为“待投票”；最先构造完成的节点作为新的主节点Sp’并且广播给所有节点Si；视图更换：若节点Si收到步骤广播的消息验证签名并用构造的方法验证后，根据以下规则对消息日志中的信息进行处理：a、针对标记为“待执行”的PRE-PREPARE信息，直接执行其对应的交易请求并发送〈REPLY，res，sn，v+1，σi”’＞，σi”’←Sign，sn，v+1)给客户端C，其中，res为执行请求的结果。b、针对标记为“待投票”的PRE-PREPARE信息，更换到新的视图v+1，并对其对应的请求进行第二轮投票，发送＜COMMIT，H，sn，v+1，σi’＞，σi’←Sign，sn，v+1，COMMIT＞)给主节点Sp’，主节点根据第二轮投票继续判断是否可以执行请求，若可以广播信息告诉其他节点，其他节点根据主节点Sp广播的信息直接执行请求并将结果反馈给客户端C。
说明书desc
技术领域本发明涉及区块链技术领域，尤其涉及一种乐观的不需要回退的拜占庭容错共识方法。背景技术实用拜占庭容错共识算法由米格尔·卡斯特罗和芭芭拉·利斯科夫于1999年提出，解决了原始拜占庭容错算法效率不高的问题，该方法通过两轮投票使所有节点达成共识，由于节点的投票行为需要广播信息，通信复杂度过高，因此一般系统在达到100左右的节点个数时，性能急剧下降。聚合签名技术可以将多个签名合并成一个签名，并且对聚合签名只需进行一次验证操作，使用该技术，可以将收到的多个投票信息的签名进行聚合，聚合后的签名即可作为多个节点签名的证明。利用该特性可以一定程度上降低通信复杂度，但是想要节点达成共识，仍然需要进行两轮的投票。投机拜占庭容错共识算法由罗摩克里希纳·科特拉于2007年提出，该算法使用聚合签名技术效降低通信复杂度，并针对无拜占庭错误场景对算法进行优化，投机地采用更简单地共识算法快速达成共识，而不需要总是进行两轮投票，但是当快速共识失效时，需要对系统的状态进行回退操作。现有的拜占庭容错算法要么需要两轮投票，要么采用投机执行的方法来减少投票轮数，而引入了需要状态回退操作的问题，如何提高共识过程的效率，仍是一个有待解决的问题。发明内容本发明的目的在于针对现有技术的不足，提供一种乐观的不需要回退的拜占庭容错共识方法。本发明的目的是通过以下技术方案来实现的：一种乐观的不需要回退的拜占庭容错共识方法，包括以下步骤：客户端C在区块链系统中发起交易并发送请求M＝＜REQUEST,TX,σc＞,σc←Sign给主节点Sp，同时客户端C设定计时器，其中，σ表示签名，下标表示签名者，Sign是签名函数，TX为客户端请求执行的交易；主节点Sp收到请求M并验证σc签名后，广播＜PRE-PREPARE,M,sn,v,σp＞,σp←Sign,sn,v＞)给所有节点Si，i＝1,…,；节点只处理视图编号与节点所处视图编号一致的信息，同时主节点Sp设定计时器并等待节点发来的投票信息。其中，为区块链系统中节点个数，包括至多f个拜占庭节点和至少个正确节点；v是节点Sp所处视图的视图编号，sn是主节点分配给请求M的编号；节点Si收到步骤中发来的＜PRE-PREPARE,M,sn,v,σp＞，验证σp后对其进行投票发送＜PREPARE,H,sn,v,σi＞,σi←Sign,sn,v＞)给主节点Sp；主节点Sp根据收到的投票信息数量判断是否为乐观情况并广播信息告诉其他节点，其中，若主节点Sp收到一致的投票信息数量为，则为乐观情况，若主节点Sp收到一致的投票信息数量为～3f，则为一般情况；若步骤中判断为一般情况节点Si根据主节点Sp广播的信息进行第二轮投票，若为乐观情况，节点Si根据主节点Sp广播的信息直接执行请求并将结果反馈给客户端C；第二轮投票后主节点Sp依据投票结果判断是否可以执行请求，若可以广播信息告诉其他节点，其他节点根据主节点Sp广播的信息直接执行请求并将结果反馈给客户端C。在步骤～执行过程中，若节点发现主节点存在拜占庭行为，则广播视图更改请求信息以选举新的主节点，在新的主节点下完成后续共识。进一步地，所述步骤通过以下子步骤来实现：判断系统状态：主节点Sp在计时器结束前，一旦收到来自个不同节点签名的一致的投票信息，则认为系统状态为乐观情况；若主节点Sp在计时器结束时只收到～3f个不同节点签名的一致的投票信息＜PREPARE,H,sn,v,σi＞，则认为系统状态为一般情况；其中，一致的投票信息为H,sn,v相同且签名正确的＜PREPARE,H,sn,v,σi＞。主节点Sp根据系统状态广播信息告诉其他节点：乐观情况下，主节点Sp将收到的个不同节点签名进行聚合Aggre为签名聚合函数，并广播信息给所有节点Si；一般情况下，主节点Sp将收到的～3f个不同节点签名中的个签名进行聚合并广播信息给所有节点Si。进一步地，所述步骤具体为：若节点Si收到步骤中主节点Sp发送的信息验证签名后直接执行其对应的请求，并发送＜REPLY,res,sn,v,σi”＞,σi”←Sign,sn,v)给客户端C，其中，res为执行请求的结果；若节点Si收到步骤中主节点Sp发送的信息验证签名后，对其对应的请求进行第二轮投票，发送＜COMMIT,H,sn,v,σi’＞,σi’←Sign,sn,v,COMMIT＞)给主节点Sp；主节点Sp一旦收到发来的个不同节点签名的一致的投票信息＜COMMIT,H,sn,v,σi’＞，则认为该请求可以被执行，主节点Sp将个不同节点签名聚合并广播信息给所有节点Si；若节点Si收到主节点Sp发送的验证两个聚合签名后直接执行该请求，并发送＜REPLY,res,sn,v,σi”＞，σi”←Sign,sn,v＞)给客户端C。进一步地，所述若节点发现主节点存在拜占庭行为，则广播视图更改请求信息以选举新的主节点通过以下子步骤来实现：检测拜占庭行为：如果客户端C在规定时间内没有收到至少个不同节点签名的一致的结果信息，则广播信息M＝＜REQUEST,TX,σc＞给所有节点Si，当节点Si收到该信息后开启计时器，若计时器结束前Si没有收到主节点Sp发来的对应请求M的任何信息或在验证Sp发送的信息的签名时发现拜占庭行为，Si广播视图更改请求信息＜REQ-VIEW-CHANGE,v,σrvi＞,σrvi←Sign以请求选举新的主节点；节点Si一但收到个不同节点签名的一致的视图更改请求信息＜REQ-VIEW-CHANGE,v,σrvi＞，则广播一条携带本地消息日志L的信息＜VIEW-CHANGE,v+1,L,σLi＞,σLi←Sign＞)表示已准备好选举新的主节点；其中L包含节点收到的所有PRE-PREPARE、PREPARED、COMMITTED信息；构造新的消息日志：节点Si一旦收到个不同节点签名的一致的＜VIEW-CHANGE,v+1,L,σLi＞，则该节点根据收到的个消息日志和以下规则构造新的消息日志a、若消息日志中存在步骤或步骤中广播的COMMITTED信息，则将该信息对应的PRE-PREPARE信息添加到中，并且将其标记为“待执行”；b、若消息日志中存在个M,sn,v都一致且签名正确的步骤中广播的PRE-PREPARE信息，同时存在步骤中广播的拥有相同sn且签名正确的PREPARED信息，但其对应的PRE-PREPARE信息不同于这个一致的PRE-PREPARE信息，则选择拥有视图编号较大的信息对应的PRE-PREPARE信息添加到中，并且将其标记为“待投票”；c、若消息日志中只存在个一致的且签名正确的步骤中广播的PRE-PREPARE信息，则将该PRE-PREPARE信息添加到中，并且将其标记为“待投票”；d、若消息日志中只存在签名正确的步骤中广播的PREPARED信息，则将该信息对应的PRE-PREPARE信息添加到中，并且将其标记为“待投票”；最先构造完成的节点作为新的主节点Sp’并且广播给所有节点Si；视图更换：若节点Si收到步骤广播的消息验证签名并用构造的方法验证后，根据以下规则对消息日志中的信息进行处理：a、针对标记为“待执行”的PRE-PREPARE信息，直接执行其对应的交易请求并发送＜REPLY,res,sn,v+1,σi”’＞,σi”’←Sign,sn,v+1)给客户端C，其中，res为执行请求的结果；b、针对标记为“待投票”的PRE-PREPARE信息，更换到新的视图v+1，并对其对应的请求进行第二轮投票，发送＜COMMIT,H,sn,v+1,σi’＞,σi’←Sign,sn,v+1,COMMIT＞)给主节点Sp’，主节点根据第二轮投票继续判断是否可以执行请求，若可以广播信息告诉其他节点，其他节点根据主节点Sp广播的信息直接执行请求并将结果反馈给客户端C。本发明的有益效果是，在系统中不存在拜占庭行为时，即乐观情况下只需要进行一轮投票即可使节点达成共识，有效降低了确认延迟，系统中信息量会大幅度减少，吞吐量会有明显提升。并且在一般情况下不需要进行状态的回退，仅需在第一轮投票的基础上进行第二轮投票，实现方法简单，不容易出错，代码质量能得到保证。附图说明图1是该发明在乐观情况下的通信模式。图2是该发明在一般情况下的通信模式。具体实施方式下面根据附图详细说明本发明。本发明乐观的不需要回退的拜占庭容错共识方法，包括以下步骤：主节点广播提案。设系统中有个节点，包括至多f个拜占庭节点和至少个正确节点，使用BLS签名算法对消息进行签名，实现聚合签名。客户端C发送请求M＝＜REQUEST,TX,σc＞是客户端的签名信息，Sign是签名函数，TX为客户端请求执行的交易)给主节点Sp，同时客户端C设定计时器，主节点Sp收到M并验证σc后，广播＜PRE-PREPARE,M,sn,v,σp＞给所有节点Si，其中σp←Sign,sn,v＞)是主节点Sp的签名信息，同时主节点Sp设定计时器并等待节点发来的投票信息为哈希函数，所有节点对每一个收到的消息都进行视图编号判断，节点只处理视图编号与节点所处视图编号一致的信息)。第一轮投票使用)。节点Si收到步骤中发来的＜PRE-PREPARE,M,sn,v,σp＞，验证σp后对其进行投票发送＜PREPARE,H,sn,v,σi＞给主节点Sp,sn,v＞)是节点Si的签名信息)。主节点Sp根据收到的投票信息数量判断是否为乐观情况并广播信息告诉其他节点。该步骤是本发明的核心，分为以下子步骤。判断系统状态。第一轮投票后，主节点在规定的时间内会收到节点发来的投票信息。主节点Sp在计时器结束前，一旦收到来自个不同节点签名的一致的投票信息＜PREPARE,H,sn,v,σi＞,sn,v相同，并且签名正确)，则认为系统状态为乐观情况。若主节点Sp在计时器结束时没有收到来自个，但收到～3f个不同节点签名的一致的投票信息＜PREPARE,H,sn,v,σi＞,sn,v相同，并且签名正确)，则认为系统状态为一般情况。若主节点Sp在计时器结束时收到少于个不同节点签名的一致的投票信息＜PREPARE,H,sn,v,σi＞，则不做处理。主节点根据系统状态执行对应操作。乐观情况下，主节点Sp将签名进行聚合个签名的集合，Aggre为签名聚合函数)，并广播信息给所有节点Si。一般情况下，主节点Sp将签名进行聚合～3f个签名中的个签名的集合，Aggre为签名聚合函数)，并广播信息给所有节点Si。节点根据步骤中发来的信息判断进行第二轮的投票或执行请求。该步骤是本发明的核心，具体如下：若节点Si收到步骤中主节点Sp发送的信息则验证签名后直接执行其对应的请求，并发送＜REPLY,res,sn,v,σi”＞给客户端C,sn,v)，res为执行请求的结果)，如图1所示。若节点Si收到步骤中主节点Sp发送的信息则验证签名后，对其对应的请求进行第二轮投票，如图2所示，发送＜COMMIT,H,sn,v,σi’＞,sn,v,COMMIT＞))给主节点Sp。主节点判断第二轮投票后是否可以执行请求：主节点Sp一旦收到个不同节点签名的一致的第二轮投票信息＜COMMIT,H,sn,v,σi’＞，则认为该请求可以被执行，主节点Sp将签名聚合个签名的集合)，并广播信息给所有节点Si中PREPARED信息中的聚合签名)。若节点Si收到主节点Sp发送的验证签名后直接执行该请求，并发送＜REPLY,res,sn,v,σi”＞给客户端C,sn,v)，res为执行请求的结果)。整个过程中若节点发现主节点存在拜占庭行为，则广播视图更改请求信息以选举新的主节点。该步骤是本发明的核心，分为以下子步骤。检测拜占庭行为。如果客户端C在规定时间内没有收到至少个不同节点签名的一致的信息＜REPLY,res,sn,v,σi”＞，则广播信息M＝＜REQUEST,TX,σc＞给所有节点Si，当节点Si收到该信息后开启计时器，若计时器结束时Si没有收到主节点Sp发来对应该请求的任何信息，则认为当前主节点Sp存在拜占庭行为，Si广播视图更改请求信息＜REQ-VIEW-CHANGE,v,σi＞以请求选举新的主节点。若在验证Sp发送的信息的签名时发现拜占庭行为即验证不通过，同样发送＜REQ-VIEW-CHANGE,v,σrvi＞)。节点Si一但收到个不同节点签名的一致的视图更改请求信息＜REQ-VIEW-CHANGE,v,σrvi＞，则广播一条携带本地消息日志L的信息＜VIEW-CHANGE,v+1,L,σLi＞表示已准备好选举新的主节点＞))。构造消息日志。节点Si一旦收到个不同节点签名的一致的＜VIEW-CHANGE,v+1,L,σLi＞，则该节点根据收到的个消息日志和以下规则构造新的消息日志a、若消息日志中存在步骤或步骤中广播的COMMITTED信息，则将该信息对应的PRE-PREPARE信息添加到中，并且将其标记为“待执行”。b、若消息日志中存在个一致的且签名正确的步骤中广播的PRE-PREPARE信息，同时存在步骤中广播的拥有相同sn且签名正确的PREPARED信息，但其对应的PRE-PREPARE信息不同于这个一致的PRE-PREPARE信息，则选择拥有视图编号较大的信息对应的PRE-PREPARE信息添加到中，并且将其标记为“待投票”。c、若消息日志中只存在个一致的且签名正确的步骤中广播的PRE-PREPARE信息，则将该PRE-PREPARE信息添加到中，并且将其标记为“待投票”。d、若消息日志中只存在签名正确的步骤中广播的PREPARED信息，则将该信息对应的PRE-PREPARE信息添加到中，并且将其标记为“待投票”。最先构造完成的节点作为新的主节点Sp’并且广播给所有节点Si视图更换。若节点Si收到步骤广播的消息验证签名并用构造的方法验证后，根据以下规则对消息日志中的信息进行处理：a、针对标记为“待执行”的PRE-PREPARE信息，直接执行其对应的交易请求并发送＜REPLY,res,sn,v+1,σi”’＞给客户端C，其中σi”’←Sign,sn,v+1＞)，res为执行请求的结果)。b、针对标记为“待投票”的PRE-PREPARE信息，更换到新的视图v+1，并对其对应的请求进行第二轮投票，发送＜COMMIT,H,sn,v+1,σi’＞给主节点Sp’,sn,v+1,COMMIT＞))，然后主节点判断第二轮投票后是否可以执行请求，若可以则广播信息告诉其他节点，其他节点根据主节点Sp广播的信息直接执行请求并将结果反馈给客户端C。安全性证明要证明该方法的安全性，即证明：如果正确的节点Si在视图v中以编号sn执行交易请求TX，则不会有正确的节点Sj在视图v’≥v中以编号sn执行不同于TX的交易请求TX’。假设正确节点Si在视图v以编号sn执行了交易请求TX，则Si可能收到具体实施方式中步骤或步骤中广播的COMMITTED信息：若Si在视图v收到步骤中广播的则个节点在视图v收到了交易请求TX对应的PRE-PREPARE信息，下面分别分析正确节点Sj在视图v和视图v’≥v的表现：当正确节点Sj处于视图v时，因为正确节点Sj已经收到当前主节点Sp发送的编号为sn的交易请求TX对应的PRE-PREPARE信息，所以Sj不会接受当前主节点Sp发送的拥有相同的sn但不同于TX的交易请求TX’对应的PRE-PREPARE信息。因此，在相同视图下，正确节点Sj不会以编号sn执行不同于TX的交易请求TX’。正确节点Sj在切换到下一个视图之前，要求新的主节点Sp’收到至少个VIEW-CHANGE信息，其中包含至少个正确节点的消息日志，在新的主节点Sp’构造新的消息日志时，可能对应上述步骤构造消息日志步骤中的情况，如果出现情况则正确节点Sj会在切换到下一个视图之前以编号sn执行TX；如果出现情况，由于在视图v’≥v中至多有2f个节点对编号同为sn的TX’进行投票，即不会形成对应TX’的PREPARED信息，更不会生成对应TX’的COMMITTED信息，因此在新的视图中正确节点Sj不会以编号sn执行不同于TX的交易请求TX’，而会根据NEW-VIEW信息继续对TX进行投票和执行。若Si在视图v收到步骤中广播的信息则至少个节点在视图v收到了一致的PRE-PREPARE和PREPRAED信息，其中包含至少个正确节点，下面分别分析正确节点Sj在视图v和视图v’≥v的表现：当正确节点Sj处于视图v时，因为已经至少有个正确节点接受了当前主节点Sp发送的编号为sn的交易请求TX对应的PRE-PREPARE信息，并且不会接受当前主节点Sp发送的拥有相同的sn但不同于TX的交易请求TX’对应的PRE-PREPARE信息，所以至多有2f个节点对编号为sn的交易请求TX’进行投票，所以不会形成对应TX’的PREPARED信息，更不会形成对应TX’的COMMITTED信息，即在相同视图下，正确节点Sj不会以编号sn执行不同于TX的交易请求TX’。正确节点Sj在切换到下一个视图之前，因为至少有一个正确节点记录了PREPARED信息到消息日志中，所以新的主节点Sp’构造新的消息日志时，可能对应上述步骤构造消息日志步骤中的情况，如果出现情况则Sj会在切换到下一个视图之前以编号sn执行TX；如果出现情况，由于在视图v’≥v中至多有2f个节点对编号同为sn但不同于TX的TX’进行投票，所以不会形成对应TX’的PREPARED信息，更不会形成对应TX’的COMMITTED信息。因此在新的视图中正确节点Sj不会以编号sn执行不同于TX的交易请求TX’，而会根据NEW-VIEW信息继续对TX进行投票和执行。可用性证明证明可用性，即证明：若客户端C在区块链系统中发起交易请求TX，则客户端最终会收到至少个关于TX的一致的执行结果。我们约定一旦客户端收到个一致的执行结果，则视该笔交易请求完成。如果在视图v中，主节点Sp是正确节点，并且网络状况不是异步网络，则称当前视图是稳定的。下面从视图处于的状态来分析和证明可用性：当视图为稳定状态时，正确的主节点Sp广播PRE-PREPARE信息后，经过足够长的时间的等待，一定会生成一个相应的COMMITTED信息，最终所有正确节点会执行该COMMITTED信息对应的交易请求，并反馈给客户端C。当视图为不稳定状态时，客户端发起的交易请求长时间得不到完成会引起视图切换，我们假设个节点广播了VIEW-CHANGE信息，下面从新的主节点Sp’是否为正确节点分析和证明可用性：新的主节点Sp’是正确节点，并且所有正确节点都收到了正确的NEW-VIEW信息，所有正确节点将成功切换到新的稳定的视图。新的主节点Sp’是错误节点，并且所有正确节点都没有收到正确NEW-VIEW信息，则引起新的视图切换。新的主节点Sp’是错误节点，并且只有一部分正确节点收到正确的NEW-VIEW信息，在这种情况下，若错误节点遵循共识方法规则，可使这部分收到正确的NEW-VIEW信息的正确节点进入不稳定的视图；若错误节点没有遵循共识方法规则，正确节点最终会发起新的视图切换请求，即不论错误节点是否遵循共识方法规则，都会引起新的视图切换。在情况中，新的视图更换请求发起，会再次让系统进入的状态之一。由于至多有f个错误节点，所以至多进行次视图切换，就会选到一个正确的节点作为新的主节点，从而切换到稳定的视图。因此，系统最终将达到情况，即进入一个稳定的视图，从而保证可用性。
