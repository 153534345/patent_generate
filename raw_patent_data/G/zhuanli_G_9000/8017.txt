标题title
一种UWB的NLOS信号识别采集方法及系统
摘要abst
本发明公开了一种UWB的NLOS信号识别采集系统及方法，通过本发明可及时采集NLOS算法失败的例子，从而使训练集不断补充，模型自动进化，形成良性循环，越是频繁发生问题，NLOS算法进化越快，最终可以准确区分各种情况下的NLOS，从而使UWB整体定位精度和可靠性大大提高，成为成熟的商用产品；同时可增加测试、研发的效率，最后实现减少售后成本、降低项目失败的风险。
权利要求书clms
1.一种UWB的NLOS信号识别采集方法，其特征在于，所述方法包括以下步骤：S1 NLOS判定模块与NLOS辅助判定模块分别独立完成对当前定位结果是否为NLOS的判定以及概率；S2如果二者判定结果不一致，并且NLOS辅助判定模块的正确概率明显大于NLOS判定模块正确概率，系统自动进入数据采集模式；S3上位机/server端自动发送指令，通知嵌入式设备进入数据采集上报模式；S4数据采集达到要求后，系统进入特征训练模式并生成预测模型；S5通过对模型精简生成精简的参数；S6根据精简模型生成嵌入式设备可用的代码及参数；S7嵌入式代码及参数下载到嵌入式设备；S8嵌入式设备中解析接收的代码及参数；S9嵌入式设备端替换已有参数，生成新的执行逻辑；S10对比代码替换前后的NLOS结果并记录本次修正的效果。2.根据权利要求1所述的UWB的NLOS信号识别采集方法，其特征在于，所述步骤S1包括以下：通过外部辅助定位系统，辅助系统定位结果与UWB定位结果对比，如果差值超过某个阈值，则NLOS的可能性增加；或通过特定窗口历史定位结果，如果当前结果明显与历史结果差异很大，间隔时间很小，超过当前应用场景下最大可能移动速度等限制；或通过辅助IMU手段的惯性导航获取的新位置与通过UWB获取的位置差异很大，间隔时间很小，超过当前应用场景下最大可能移动速度等限制；其中，采用以上手段之一或其组合。3.根据权利要求2所述的UWB的NLOS信号识别采集方法，其特征在于，所述外部辅助定位系统可为激光雷达、视觉装置。4.根据权利要求1所述的UWB的NLOS信号识别采集方法，其特征在于，所述步骤S9包括嵌入式代码NLOS判定代码使用逻辑条件实现，条件及其阈值均使用变量，变量的结果通过解析指令中的参数列表获取，从而达到动态效果。5.一种实现如权利要求1所述的UWB的NLOS信号识别采集方法的系统，其特征在于，所述上位机/server端包括NLOS辅助判定模块、数据采集/训练/预测模式开关控制模块、特征训练、模型生成模块、精简模型转换模块、嵌入式代码及参数生成模块、嵌入式代码及参数下载模块和NLOS结果对比模块。6.根据权利要求1所述的UWB的NLOS信号识别采集系统，其特征在于，所述嵌入式设备包括指令接收模块、数据上报模块、嵌入式代码及参数解析模块和嵌入式代码动态执行逻辑模块。
说明书desc
技术领域本发明涉及室内精确定位的技术领域，具体涉及一种UWB的NLOS信号识别采集方法及系统。背景技术基于位置的服务LBS已经给人类生活带来了巨大变化，但是目前仍有技术上的瓶颈，这些瓶颈主要在于室内定位。脉冲UWB技术利用纳秒至亚纳秒级的窄脉冲信号测距。最初UWB主要应用于军事雷达，由于其在抗干扰等方面的优势，非常适合于室内高精度定位场景，近些年UWB技术发展迅速，Deca公司2013年推出了DW系列UWB定位芯片，使得基于UWB设备的定位技术研究变得便利，此后出现了大量关于UWB测距、定位方面的科学文献，尤其是苹果推出了基于UWB的AirTag后，UWB技术在全世界的发展非常迅速，不久的将来很有可能成为手机中的标配，由于巨大的商业前景，预期在近几年内，UWB的应用市场会发生爆发式增长。通常，在LOS环境下UWB定位精度很高，商用芯片通常在10cm左右，这可以满足室内定位的绝大多数场景需求。但是，在NLOS环境下，定位精度会受到明显影响，这是目前UWB定位技术中的一个重要问题。其次，NLOS的识别准确率依赖于不同场景下NLOS数据集是否有代表性以及数据集是否完整，因此NLOS的数据采集对算法及其结果至关重要。然而，通常情况下NLOS是有可能在不经意间发生，或者说，NLOS可能是在大多数LOS环境下偶发的，这种情况下的NLOS与故意制造出来的NLOS场景可能并不相同，从而导致识别错误，由于此时数据的标定是很困难的，因此数据集中很难精确包含足够的有代表性的这种导致错误的NLOS数据。再次，通常机器学习的过程是把数据采集、训练和预测分开处理，确认有效后进行模型简化并实际应用到产品中，这个完整过程是分开多个步骤，期间涉及在不同终端环境下的编码调试，下载程序等流程，时间成本较高，效率较低，算法验证实时性不足。最后，如果产品量产并远程部署，实际环境下偶然发生的NLOS问题将非常棘手，这种情况发生时，程序漏判NLOS情况，用户使用时产生较大定位误差，最终反馈到方案商，工程师去现场尝试复现问题抓取log，解决问题并升级版本，这个过程的费时费力且部署量越大所需成本越高。发明内容针对现有技术的存在的问题，本发明旨在提供一种UWB的NLOS信号识别采集方法及系统，利用本发明，实现了：1、自动判定NLOS预测失败是否已发生2、自动切换数据采集/训练/预测模式3、自动对新采集的数据进行训练、生成模型4、自动对模型简化生成高效运行且嵌入式代码可用的参数5、自动生成嵌入式代码，下载更新到嵌入式硬件设备，并使代码在MCU无需重启的前提下动态生效6、记录对比程序更新前后NLOS识别错误发生概率是否变化，并对个别失效案例，通过自动抓取的log，交由开发人员深入分析，改进模型和系统以上所有自动实现部分均支持手动模式，方便测试工程师灵活高效地测试和采集数据，以及开发工程师调试。为了实现上述目的，本发明采用如下技术方案：一种UWB的NLOS信号识别采集方法，所述方法包括以下步骤：S1NLOS判定模块与NLOS辅助判定模块分别独立完成对当前定位结果是否为NLOS的判定以及概率；S2如果二者判定结果不一致，并且NLOS辅助判定模块的正确概率明显大于NLOS判定模块正确概率，系统自动进入数据采集模式；S3上位机/server端自动发送指令，通知嵌入式设备进入数据采集上报模式；S4数据采集达到要求后，系统进入特征训练模式并生成预测模型；S5通过对模型精简生成精简的参数；S6根据精简模型生成嵌入式设备可用的代码及参数；S7嵌入式代码及参数下载到嵌入式设备；S8嵌入式设备中解析接收的代码及参数；S9嵌入式设备端替换已有参数，生成新的执行逻辑；S10对比代码替换前后的NLOS结果并记录本次修正的效果。需要说明的是，所述步骤S1包括以下：通过外部辅助定位系统，辅助系统定位结果与UWB定位结果对比，如果差值超过某个阈值，则NLOS的可能性增加；或通过特定窗口历史定位结果，如果当前结果明显与历史结果差异很大，间隔时间很小，超过当前应用场景下最大可能移动速度等限制；或通过辅助IMU手段的惯性导航获取的新位置与通过UWB获取的位置差异很大，间隔时间很小，超过当前应用场景下最大可能移动速度等限制；其中，采用以上手段之一或其组合。需要说明的是，所述外部辅助定位系统可为激光雷达、视觉装置。需要说明的是，所述步骤S9包括嵌入式代码NLOS判定代码使用逻辑条件实现，条件及其阈值均使用变量，变量的结果通过解析指令中的参数列表获取，从而达到动态效果。本发明还提供一种实现UWB的NLOS信号识别采集方法的系统，所述上位机/server端包括NLOS辅助判定模块、数据采集/训练/预测模式开关控制模块、特征训练、模型生成模块、精简模型转换模块、嵌入式代码及参数生成模块、嵌入式代码及参数下载模块和NLOS结果对比模块。需要说明的是，所述嵌入式设备包括指令接收模块、数据上报模块、嵌入式代码及参数解析模块和嵌入式代码动态执行逻辑模块。本发明的有益效果在于，系统可通过及时采集NLOS算法失败的例子，从而使训练集不断补充，模型自动进化，形成良性循环，越是频繁发生问题，NLOS算法进化越快，最终可以准确区分各种情况下的NLOS，从而使UWB整体定位精度和可靠性大大提高，成为成熟的商用产品；同时可增加测试、研发的效率，最后实现减少售后成本、降低项目失败的风险。具体实施方式以下将对本发明作进一步的描述，需要说明的是，以下实施例以本技术方案为前提，给出了详细的实施方式和具体的操作过程，但本发明的保护范围并不限于本实施例。需要指出的是，在本发明中，利用机器学习过程及其算法属于本领域技术人员的基本常识，因此在本发明中不再陈述。本发明为一种UWB的NLOS信号识别采集方法，所述方法包括以下步骤：S1NLOS判定模块与NLOS辅助判定模块分别独立完成对当前定位结果是否为NLOS的判定以及概率；S2如果二者判定结果不一致，并且NLOS辅助判定模块的正确概率明显大于NLOS判定模块正确概率，系统自动进入数据采集模式；S3上位机/server端自动发送指令，通知嵌入式设备进入数据采集上报模式；S4数据采集达到要求后，系统进入特征训练模式并生成预测模型；S5通过对模型精简生成精简的参数；S6根据精简模型生成嵌入式设备可用的代码及参数；S7嵌入式代码及参数下载到嵌入式设备；S8嵌入式设备中解析接收的代码及参数；S9嵌入式设备端替换已有参数，生成新的执行逻辑；S10对比代码替换前后的NLOS结果并记录本次修正的效果。需要指出的是，在本发明中，判定一个信号是否是NLOS是非常关键的因素。本发明中采用内部即本身算法和外部判定。由于这两种方法都有一定的误判性，错误的引入会产生错误的学习。所以引入一个NLOS是有帮助的，而误引入可能是具有破坏性的。所以当判定性是高概率时，确定引入；当不太确定时，宁可放弃。譬如当两个模块都认为是，则引入。如果两个认为都不是，则不引入。如果其中一个认为是，另一个认为不是，这需要一个概率判定，如：认为是的概率为90％或更高，则引入，如果低于90％则放弃。但上述陈述仅作为参考，并不用于限定本发明的技术方案，具体的概率阙值应由实验而定。进一步的，本发明的所述步骤S1包括以下：通过外部辅助定位系统，辅助系统定位结果与UWB定位结果对比，如果差值超过某个阈值，则NLOS的可能性增加；或通过特定窗口历史定位结果，如果当前结果明显与历史结果差异很大，间隔时间很小，超过当前应用场景下最大可能移动速度等限制；或通过辅助IMU手段的惯性导航获取的新位置与通过UWB获取的位置差异很大，间隔时间很小，超过当前应用场景下最大可能移动速度等限制；其中，采用以上手段之一或其组合。进一步的，本发明的所述外部辅助定位系统可为激光雷达、视觉装置。进一步的，本发明的所述步骤S9包括嵌入式代码NLOS判定代码使用逻辑条件实现，条件及其阈值均使用变量，变量的结果通过解析指令中的参数列表获取，从而达到动态效果。另外，本发明还提供一种实现UWB的NLOS信号识别采集方法的系统，所述上位机/server端包括NLOS辅助判定模块、数据采集/训练/预测模式开关控制模块、特征训练、模型生成模块、精简模型转换模块、嵌入式代码及参数生成模块、嵌入式代码及参数下载模块和NLOS结果对比模块。进一步的，本发明的所述嵌入式设备包括指令接收模块、数据上报模块、嵌入式代码及参数解析模块和嵌入式代码动态执行逻辑模块。对于本领域的技术人员来说，可以根据以上的技术方案和构思，给出各种相应的改变和变形，而所有的这些改变和变形，都应该包括在本发明权利要求的保护范围之内。
