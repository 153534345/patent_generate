标题title
用于重建三维人脸图像的方法、装置、电子设备和介质
摘要abst
本公开提供了一种用于重建三维人脸图像的方法，涉及图像处理技术领域，尤其涉及虚拟数字人、增强现实、虚拟现实、混合现实、扩展现实、元宇宙领域。实现方案为：获取人脸的视频数据，包括人脸的多个帧，多个帧中每一帧的每个像素均包括深度信息；对于多个帧中的每一帧：基于该帧中每个像素的深度信息，确定该帧对应的单帧三维点云；并且从该帧的RGB图像中提取多个图像关键点；基于多个帧中每一帧对应的单帧三维点云，生成三维人脸点云；以及基于多个帧中的至少两帧中每一帧的多个图像关键点，对三维人脸点云进行优化，以得到目标三维人脸图像。
权利要求书clms
1.一种用于重建三维人脸图像的方法，所述方法包括：获取人脸的视频数据，所述视频数据包括所述人脸的多个帧，所述多个帧中每一帧的每个像素均包括深度信息；对于所述多个帧中的每一帧：基于该帧中每个像素的深度信息，确定该帧对应的单帧三维点云；并且从该帧的RGB图像中提取多个图像关键点；基于所述多个帧中每一帧对应的单帧三维点云，生成三维人脸点云；以及基于所述多个帧中的至少两帧中每一帧的多个图像关键点，对所述三维人脸点云进行优化，以得到目标三维人脸图像。2.根据权利要求1所述的方法，其中，所述多个图像关键点包括用于标记所述人脸的第一区域的结构关键点，所述人脸在所述第一区域发生的形状和/或角度变化符合预设条件。3.根据权利要求2所述的方法，其中，所述基于所述多个帧中的至少两帧中每一帧的多个图像关键点，对所述三维人脸点云进行优化，包括：从所述多个帧中至少选择第一帧和第二帧，其中，所述第一帧的多个图像关键点中至少包括第一结构关键点，所述第一结构关键点与所述第二帧的多个图像关键点中的第二结构关键点相对应；分别确定所述第一结构关键点和所述第二结构关键点在所述三维人脸点云中的三维坐标；以及基于所述第一结构关键点的三维坐标和所述第二结构关键点的三维坐标之间的第一差值，对所述三维人脸点云进行优化。4.根据权利要求3所述的方法，其中，所述多个图像关键点还包括所述人脸的语义关键点，所述语义关键点用于指示人脸预设部位的语义信息，并且其中，所述第一帧的多个图像关键点还包括第一语义关键点，所述第二帧的多个图像关键点还包括第二语义关键点，其中，所述第一语义关键点和所述第二语义关键点具有相同的语义信息，其中，所述方法还包括：分别确定所述第一语义关键点和所述第二语义关键点在所述三维人脸点云中的三维坐标；以及所述基于所述第一结构关键点的三维坐标和所述第二结构关键点的三维坐标之间的第一差值，对所述三维人脸点云进行优化，包括：基于所述第一差值和第二差值，对所述三维人脸点云进行优化，所述第二差值为所述第一语义关键点的三维坐标和所述第二语义关键点的三维坐标之间的差值。5.根据权利要求4所述的方法，其中，所述基于所述第一差值和第二差值，对所述三维人脸点云进行优化，包括：为所述第一差值分配第一权重，以调整所述第一差值；为所述第二差值分配第二权重，以调整所述第二差值；以及基于经调整的第一差值和经调整的第二差值，对所述三维人脸点云进行优化。6.根据权利要求5所述的方法，其中，所述第一权重小于所述第二权重。7.一种用于重建三维人脸图像的装置，所述装置包括：获取单元，用于获取人脸的视频数据，所述视频数据包括所述人脸的多个帧，所述多个帧中每一帧的每个像素均包括深度信息；确定单元，用于对于所述多个帧中的每一帧，基于该帧中每个像素的深度信息，确定该帧对应的单帧三维点云；提取单元，用于对于所述多个帧中的每一帧，从该帧的RGB图像中提取多个图像关键点；生成单元，用于基于所述多个帧中每一帧对应的单帧三维点云，生成三维人脸点云；以及优化单元，用于基于所述多个帧中的至少两帧中每一帧的多个图像关键点，对所述三维人脸点云进行优化，以得到目标三维人脸图像。8.根据权利要求7所述的装置，其中，所述多个图像关键点包括用于标记所述人脸的第一区域的结构关键点，所述人脸在所述第一区域发生的形状和/或角度变化符合预设条件。9.根据权利要求8所述的装置，其中，所述优化单元包括：选择子单元，用于从所述多个帧中至少选择第一帧和第二帧，其中，所述第一帧的多个图像关键点中至少包括第一结构关键点，所述第一结构关键点与所述第二帧的多个图像关键点中的第二结构关键点相对应；确定子单元，用于分别确定所述第一结构关键点和所述第二结构关键点在所述三维人脸点云中的三维坐标；以及优化子单元，用于基于所述第一结构关键点的三维坐标和所述第二结构关键点的三维坐标之间的第一差值，对所述三维人脸点云进行优化。10.根据权利要求9所述的装置，其中，所述多个图像关键点还包括所述人脸的语义关键点，所述语义关键点用于指示人脸预设部位的语义信息，并且其中，所述第一帧的多个图像关键点还包括第一语义关键点，所述第二帧的多个图像关键点还包括第二语义关键点，其中，所述第一语义关键点和所述第二语义关键点具有相同的语义信息，其中，所述确定子单元还被配置用于分别确定所述第一语义关键点和所述第二语义关键点在所述三维人脸点云中的三维坐标；以及所述优化子单元还被配置用于基于所述第一差值和第二差值，对所述三维人脸点云进行优化，所述第二差值为所述第一语义关键点的三维坐标和所述第二语义关键点的三维坐标之间的差值。11.根据权利要求10所述的装置，其中，所述优化子单元还被配置为：为所述第一差值分配第一权重，以调整所述第一差值；为所述第二差值分配第二权重，以调整所述第二差值；以及基于经调整的第一差值和经调整的第二差值，对所述三维人脸点云进行优化。12.根据权利要求11所述的装置，其中，所述第一权重小于所述第二权重。13.一种电子设备，包括：至少一个处理器；以及与所述至少一个处理器通信连接的存储器；其中，所述存储器存储有可被所述至少一个处理器执行的指令，所述指令被所述至少一个处理器执行，以使所述至少一个处理器能够执行权利要求1-6中任一项所述的方法。14.一种存储有计算机指令的非瞬时计算机可读存储介质，其中，所述计算机指令用于使所述计算机执行根据权利要求1-6中任一项所述的方法。15.一种计算机程序产品，包括计算机程序，其中，所述计算机程序在被处理器执行时实现权利要求1-6中任一项所述的方法。
说明书desc
技术领域本公开涉及图像处理技术领域，尤其涉及虚拟数字人、增强现实、虚拟现实、混合现实、扩展现实、元宇宙技术领域，具体涉及一种用于重建三维人脸图像的方法、装置、电子设备、计算机可读存储介质和计算机程序产品。背景技术当前，各种元宇宙、数字人、增强现实、虚拟现实应用场景离不开三维数字资产，而RGBD三维人脸重建正是获取数字资产的一项重要技术。现有的RGBD人脸重建技术尚且存在一些技术瓶颈，比如，人脸配准困难或者数据噪声较大等，这些问题限制了人脸重建的精度和效率。在此部分中描述的方法不一定是之前已经设想到或采用的方法。除非另有指明，否则不应假定此部分中描述的任何方法仅因其包括在此部分中就被认为是现有技术。类似地，除非另有指明，否则此部分中提及的问题不应认为在任何现有技术中已被公认。发明内容本公开提供了一种用于重建三维人脸图像的方法、装置、电子设备、计算机可读存储介质和计算机程序产品。根据本公开的一个方面，提供了一种用于重建三维人脸图像的方法，包括：获取人脸的视频数据，所述视频数据包括所述人脸的多个帧，所述多个帧中每一帧的每个像素均包括深度信息；对于所述多个帧中的每一帧：基于该帧中每个像素的深度信息，确定该帧对应的单帧三维点云；并且从该帧的RGB图像中提取多个图像关键点；基于所述多个帧中每一帧对应的单帧三维点云，生成三维人脸点云；以及基于所述多个帧中的至少两帧中每一帧的多个图像关键点，对所述三维人脸点云进行优化，以得到目标三维人脸图像。根据本公开的一个方面，还提供了一种用于重建三维人脸图像的装置，包括：获取单元，用于获取人脸的视频数据，所述视频数据包括所述人脸的多个帧，所述多个帧中每一帧的每个像素均包括深度信息；确定单元，用于对于所述多个帧中的每一帧，基于该帧中每个像素的深度信息，确定该帧对应的单帧三维点云；提取单元，用于对于所述多个帧中的每一帧，从该帧的RGB图像中提取多个图像关键点；生成单元，用于基于所述多个帧中每一帧对应的单帧三维点云，生成三维人脸点云；以及，优化单元，用于基于所述多个帧中的至少两帧中每一帧的多个图像关键点，对所述三维人脸点云进行优化，以得到目标三维人脸图像。根据本公开的一个方面，还提供了一种电子设备，包括：至少一个处理器；以及与所述至少一个处理器通信连接的存储器；其中，所述存储器存储有可被所述至少一个处理器执行的指令，所述指令被所述至少一个处理器执行，其中，所述处理器被配置为执行所述计算机程序以实现上述的方法的步骤。根据本公开的一个方面，还提供了一种存储有计算机指令的非瞬时计算机可读存储介质，其中，所述计算机程序被处理器执行时实现上述方法的步骤。根据本公开的一个方面，还提供了一种计算机程序产品，包括计算机程序，其中，所述计算机程序被处理器执行时实现上述方法的步骤。根据本公开的一个或多个实施例，可以通过融合特征关键点优化的RGBD人脸重建的方法，提升三维人脸重建的精度。应当理解，本部分所描述的内容并非旨在标识本公开的实施例的关键或重要特征，也不用于限制本公开的范围。本公开的其它特征将通过以下的说明书而变得容易理解。附图说明附图示例性地示出了实施例并且构成说明书的一部分，与说明书的文字描述一起用于讲解实施例的示例性实施方式。所示出的实施例仅出于例示的目的，并不限制权利要求的范围。在所有附图中，相同的附图标记指代类似但不一定相同的要素。图1示出了根据本公开的一些实施例可以在其中实施本文描述的各种方法的示例性系统的示意图；图2示出了根据本公开的实施例的用于重建三维人脸图像的方法的流程图；图3示出了根据本公开的示例性实施例的语义关键点的分布示意图；图4示出了根据本公开的实施例的点云联合优化的流程图；图5示出了根据本公开的实施例的重建三维人脸图像的装置的结构框图；以及图6示出了可以实现根据本公开的一些实施例的示例性电子设备的结构框。具体实施方式以下结合附图对本公开的示范性实施例做出说明，其中包括本公开实施例的各种细节以助于理解，应当将它们认为仅仅是示范性的。因此，本领域普通技术人员应当认识到，可以对这里描述的实施例做出各种改变和修改，而不会背离本公开的范围。同样，为了清楚和简明，以下的描述中省略了对公知功能和结构的描述。在本公开中，除非另有说明，否则使用术语“第一”、“第二”等来描述各种要素不意图限定这些要素的位置关系、时序关系或重要性关系，这种术语只是用于将一个要素与另一要素区分开。在一些示例中，第一要素和第二要素可以指向该要素的同一实例，而在某些情况下，基于上下文的描述，它们也可以指代不同实例。在本公开中对各种所述示例的描述中所使用的术语只是为了描述特定示例的目的，而并非旨在进行限制。除非上下文另外明确地表明，如果不特意限定要素的数量，则该要素可以是一个也可以是多个。此外，本公开中所使用的术语“和/或”涵盖所列出的项目中的任何一个以及全部可能的组合方式。下面将结合附图详细描述本公开的实施例。图1示出了根据本公开的一些实施例可以将本文描述的各种方法和装置在其中实施的示例性系统100的示意图。参考图1，该系统100包括一个或多个客户端设备101、102、103、104、105和106、服务器120以及将一个或多个客户端设备耦接到服务器120的一个或多个通信网络110。客户端设备101、102、103、104、105和106可以被配置为执行一个或多个应用程序。在本公开的一些实施例中，服务器120可以运行使得能够执行用于三维图像重建的方法的一个或多个服务或软件应用。在某些实施例中，服务器120还可以提供其他服务或软件应用，这些服务或软件应用可以包括非虚拟环境和虚拟环境。在某些实施例中，这些服务可以作为基于web的服务或云服务提供，例如在软件即服务模型下提供给客户端设备101、102、103、104、105和/或106的用户。在图1所示的配置中，服务器120可以包括实现由服务器120执行的功能的一个或多个组件。这些组件可以包括可由一个或多个处理器执行的软件组件、硬件组件或其组合。操作客户端设备101、102、103、104、105和/或106的用户可以依次利用一个或多个客户端应用程序来与服务器120进行交互以利用这些组件提供的服务。应当理解，各种不同的系统配置是可能的，其可以与系统100不同。因此，图1是用于实施本文所描述的各种方法的系统的一个示例，并且不旨在进行限制。用户可以使用客户端设备101、102、103、104、105和/或106来提交原始图像数据。客户端设备可以提供使客户端设备的用户能够与客户端设备进行交互的接口。客户端设备还可以经由该接口向用户输出信息。在一些实施例中，客户端也可以单独运行使得能够执行用于三维图像重建的方法的一个或多个服务或软件应用。尽管图1仅描绘了六种客户端设备，但是本领域技术人员将能够理解，本公开可以支持任何数量的客户端设备。客户端设备101、102、103、104、105和/或106可以包括各种类型的计算机设备，例如便携式手持设备、通用计算机、工作站计算机、可穿戴设备、智能屏设备、自助服务终端设备、服务机器人、游戏系统、瘦客户端、各种消息收发设备、传感器或其他感测设备等。这些计算机设备可以运行各种类型和版本的软件应用程序和操作系统，例如MICROSOFT Windows、APPLE iOS、类UNIX操作系统、Linux或类Linux操作系统；或包括各种移动操作系统，例如MICROSOFT WindowsMobile OS、iOS、Windows Phone、Android。便携式手持设备可以包括蜂窝电话、智能电话、平板电脑、个人数字助理等。可穿戴设备可以包括头戴式显示器和其他设备。游戏系统可以包括各种手持式游戏设备、支持互联网的游戏设备等。客户端设备能够执行各种不同的应用程序，例如各种与Internet相关的应用程序、通信应用程序、短消息服务应用程序，并且可以使用各种通信协议。网络110可以是本领域技术人员熟知的任何类型的网络，其可以使用多种可用协议中的任何一种来支持数据通信。仅作为示例，一个或多个网络110可以是局域网、基于以太网的网络、令牌环、广域网、因特网、虚拟网络、虚拟专用网络、内部网、外部网、区块链网络、公共交换电话网、红外网络、无线网络和/或这些和/或其他网络的任意组合。服务器120可以包括一个或多个通用计算机、专用服务器计算机服务器、UNIX服务器、中端服务器)、刀片式服务器、大型计算机、服务器群集或任何其他适当的布置和/或组合。服务器120可以包括运行虚拟操作系统的一个或多个虚拟机，或者涉及虚拟化的其他计算架构。在各种实施例中，服务器120可以运行提供下文所描述的功能的一个或多个服务或软件应用。服务器120中的计算单元可以运行包括上述任何操作系统以及任何商业上可用的服务器操作系统的一个或多个操作系统。服务器120还可以运行各种附加服务器应用程序和/或中间层应用程序中的任何一个，包括HTTP服务器、FTP服务器、CGI服务器、JAVA服务器、数据库服务器等。在一些实施方式中，服务器120可以包括一个或多个应用程序，以分析和合并从客户端设备101、102、103、104、105和/或106的用户接收的数据馈送和/或事件更新。服务器120还可以包括一个或多个应用程序，以经由客户端设备101、102、103、104、105和/或106的一个或多个显示设备来显示数据馈送和/或实时事件。在一些实施方式中，服务器120可以为分布式系统的服务器，或者是结合了区块链的服务器。服务器120也可以是云服务器，或者是带人工智能技术的智能云计算服务器或智能云主机。云服务器是云计算服务体系中的一项主机产品，以解决传统物理主机与虚拟专用服务器服务中存在的管理难度大、业务扩展性弱的缺陷。系统100还可以包括一个或多个数据库130。在某些实施例中，这些数据库可以用于存储数据和其他信息。例如，数据库130中的一个或多个可用于存储诸如音频文件和视频文件的信息。数据库130可以驻留在各种位置。例如，由服务器120使用的数据库可以在服务器120本地，或者可以远离服务器120且可以经由基于网络或专用的连接与服务器120通信。数据库130可以是不同的类型。在某些实施例中，由服务器120使用的数据库例如可以是关系数据库。这些数据库中的一个或多个可以响应于命令而存储、更新和检索到数据库以及来自数据库的数据。在某些实施例中，数据库130中的一个或多个还可以由应用程序使用来存储应用程序数据。由应用程序使用的数据库可以是不同类型的数据库，例如键值存储库，对象存储库或由文件系统支持的常规存储库。图1的系统100可以以各种方式配置和操作，以使得能够应用根据本公开所描述的各种方法和装置。根据本公开的一个方面，提供一种用于重建三维人脸图像的方法。图2示出了根据本公开的实施例的用于重建三维人脸图像的方法200的流程图。在步骤S201中，获取人脸的视频数据，所述视频数据包括所述人脸的多个帧，所述多个帧中每一帧的每个像素均包括深度信息。在一些实施例中，人脸的视频数据例如可以通过经过标定的RGBD相机拍摄获得。RGBD视频数据包括使用RGBD相机拍摄人脸的带有红色、绿色和蓝色三通道彩色图像以及深度信息的多个帧。示例性的，拍摄所述人脸得到的多个帧可以是使用RGBD相机拍摄一段覆盖人脸各视角的视频中的各帧。示例性的，所述多个帧也可以是对人脸面部的一部分的特写，例如某些器官的轮廓或位置等。此外，经标定的RGBD相机的内部参数是已知的，这些内参可以包括：水平焦距、垂直焦距和光心位置等。在步骤S202中，对于所述多个帧中的每一帧：基于该帧中每个像素的深度信息，确定该帧对应的单帧三维点云。RGBD视频数据中的每一帧包括RGB数据和深度数据。结合RGBD相机的内参可以基于每一帧的RGB数据和深度信息计算出单帧三维点云。示例性的，可以使用如下公式计算所述多帧图像中的任一帧的单帧三维点云：z＝d其中，fx为RGBD相机的水平焦距，fy为相机的垂直焦距，为相机的光心位置，为待计算像素在RGB图像中的二维坐标，d为该像素对应的深度信息，为该像素对应的点云元素的三维坐标。按照上述方式，可以计算出所述多个帧每一帧所对应的单帧三维点云。在步骤S203中，对于所述多个帧中的每一帧：还可以从该帧的RGB图像中提取多个图像关键点，所述图像关键点是图像中可以表征人脸结构信息的特征点，包括但不限于用来表征例如法令纹、泪沟、苹果肌的轮廓、鼻侧壁与面颊之间的交界处等人脸结构的转折处。在步骤S204中，基于所述多个帧中每一帧对应的单帧三维点云，生成三维人脸点云。示例性的，可以使用ICP算法生成所述三维人脸点云，所述ICP算法通过点云预处理、匹配、加权、剔除不合理点位等步骤处理单帧三维点云，处理后即可得到三维人脸点云。可以使用ICP算法计算各帧得到点云间的位姿关系并对多帧点云进行融合对齐；具体的，所述ICP算法首先对一幅所述点云图中的每个点，在另一幅点云图中计算匹配点，匹配所述每个点间的匹配误差，计算位姿，然后将所述位姿作用于点云，再重新计算匹配点，如此迭代，直到迭代次数达到阈值，或者得到一个相对满意的结果。需要指出的是，此时获得的三维人脸点云仍可能精度不够、误差较大，需要通过下面的步骤继续处理。在步骤S205中，基于所述多个帧中的至少两帧中每一帧的多个图像关键点，对所述三维人脸点云进行优化，以得到目标三维人脸图像。由于在拍摄视频的过程中相机和人脸之间的相对运动，每一帧所包括的图像关键点的数量可能不同；类似的，同一个图像关键点在不同帧上的位置也可能不同，这些位置不同的点可以被认为是相互对应的图像关键点。例如，相互对应的图像关键点例如可以是用来表征法令纹的关键点。如果用来表征法令纹的是一组关键点，则相互对应的关键点可以是不同帧中的该组关键点中的同一特定点。对所述三维人脸点云进行优化可以是基于上述至少两帧中的多个图像关键点进行点云联合优化，所述点云联合优化通过将上述至少两帧中的对应的图像关键点进行匹配对齐，优化每帧的位姿和点云的深度，得到一个准确的人脸点云。可以理解，优化的目标可以是将上述至少两帧中的对应的图像关键点的三维坐标之间的差值最小化。示例性的，可以使用光束法平差模型进行优化。优选的，所选择的至少两帧是相邻的两个帧。此外，基于本公开，可以实现逐帧处理，即，依次对相邻的两个帧进行上述操作。根据本公开的方案通过确定不同图像帧中的相应的图像关键点，进而基于这些图像关键点对图像帧进行匹配，从而能够降低相关技术中深度测量偏差所引起的人脸点云融合和重建的偏差，提高了人脸三维点云的精度。可以理解，在获得了准确的人脸点云后，可以使用例如泊松重建等算法生成人脸三维面片模型，在此不做赘述。根据一些实施例，所述多个图像关键点包括用于标记所述人脸的第一区域的结构关键点，所述人脸在所述第一区域发生的形状和/或角度变化符合预设条件。在本公开中，结构关键点涉及图像中的结构信息，可以用于标记人脸上产生明显角度变化和/或形状变化的人脸区域，例如，鼻侧壁和脸颊之间的交界处、苹果肌的轮廓、法令纹、泪沟等等。可以理解，形状和/或角度所发生的变化应该符合预设条件，从而避免提取出过多的无效结构关键点。应当理解，根据本公开的结构关键点不同于本领域常规技术手段中基于常用人脸关键点标注方案所获得的人脸关键点。根据本公开的结构关键点并不关注语义信息，而是涉及图像中的结构信息。示例性的，在例如结构关键点用于标记鼻侧壁和脸颊之间交界区域的情况下，结构关键点可以表现为鼻侧壁与面颊的交界线上的多个点；在例如结构关键点用于标记苹果肌轮廓区域的情况下，结构关键点可以表现为其连线构成围绕苹果肌轮廓的多个点；在例如结构关键点用于标记法令纹区域的情况下，结构关键点可以表现为沿法令纹分布的多个点。可理解的，上述示例中的第一区域中人脸均发生了较为显著的结构性的变化，例如第一区域中的人面部拟合得到的多个平面之间的角度产生了大于一定预设角度的变化。可见，不同的人脸图像可能对应完全不同的结构关键点。由于深度相机本身的深度测量存在一定误差，人脸配准不准，直接使用ICP算法计算出的点云位置关系通常精度不高。现有技术中的例如68点标注方案，不能准确反映人脸中的上述的个性化结构变化。通过引入反映人脸图像中结构信息的结构关键点，可以更有效地约束深度测量误差，进而提高三维点云的精度。作为一种实施方式，可以使用superpoint关键点提取算法提取原始RGB图像上的结构关键点；具体的，所述superpoint关键点提取算法的核心原理主要涉及两部分，一是检测关键点，二是superpoint网络，输出关键点。作为另一种实施方式，也可以训练神经网络，用于提取结构关键点，其中，用于训练该神经网络的样本图像例如是人脸的二维RGB图像，而标签数据包括在相应的样本图像上标注出的结构关键点。示例性的，结构关键点可以选取几十至几百个，在此不做限定。作为示例的，标签数据中标注出的结构关键点满足上述条件。根据一些实施例，所述基于所述多个帧中的至少两帧中每一帧的多个图像关键点，对所述三维人脸点云进行优化，可以包括：从所述多个帧中至少选择第一帧和第二帧，其中，所述第一帧的多个图像关键点中至少包括第一结构关键点，所述第一结构关键点与所述第二帧的多个图像关键点中的第二结构关键点相对应。其中，第一结构关键点和第二结构关键点为相对应的所述结构关键点。优选的，所选择的第一帧和第二帧是相邻的两个帧。此外，基于本公开，可以实现逐帧处理，即，依次对相邻的两个帧进行上述操作。在确定第一帧和第二帧后，分别确定所述第一结构关键点和所述第二结构关键点在所述三维人脸点云中的三维坐标。根据相应的图像帧和相机参数，将第一结构关键点和第二结构关键点投影到三维人脸点云中，可以得到相应的图像关键点所对应的3D图像关键点。如前文所述，通过标定好的相机参数，根据待计算像素的二维坐标信息，带入公式即可计算出所述三维人脸点云的三维坐标，此处不再赘述。随后，基于所述第一结构关键点的三维坐标和所述第二结构关键点的三维坐标之间的第一差值，对所述三维人脸点云进行优化，以得到目标三维人脸图像。对所述三维人脸点云进行优化可以理解为点云联合优化，所述点云联合优化需在获取所述第一结构关键点的三维坐标和所述第二结构关键点的三维坐标后，将所述第一帧和第二帧中的对应的图像关键点进行匹配对齐，优化每帧的位姿和点云的深度，得到一个准确的人脸点云。可以理解，优化的目标是将所述差值最小化。示例性的，可以使用光束法平差模型进行优化。根据一些实施例，所述多个图像关键点还包括所述人脸的语义关键点，所述语义关键点包括用于指示人脸预设部位的语义信息，所述人脸预设部位可以包括所述人脸的五官和轮廓，并且其中，所述第一帧的多个图像关键点还包括第一语义关键点，所述第二帧的多个图像关键点还包括第二语义关键点，其中，所述第一语义关键点和所述第二语义关键点均为所述语义关键点并且具有相同的语义信息，其中，所述方法还包括：分别确定所述第一语义关键点和所述第二语义关键点在所述三维人脸点云中的三维坐标；以及所述基于所述第一结构关键点的三维坐标和所述第二结构关键点的三维坐标之间的第一差值，对所述三维人脸点云进行优化，包括：基于所述第一差值和第二差值，对所述三维人脸点云进行优化，所述第二差值为所述第一语义关键点的三维坐标和所述第二语义关键点的三维坐标之间的差值。其中，语义关键点作为另一种人脸图像上的特征点，其与结构关键点不同，语义关键点包含用于指示人脸预设部位的语义信息，所述人脸预设部位可以是人脸部的鼻子、眼睛、眉毛等人脸五官的位置以及人脸轮廓等。在一些实施例中，可以使用三维密集脸对齐算法提取原始RGB图像上的语义关键点。3DDFA算法的核心原理是3D辅助短视频合成，可以模拟平面内和平面外的人脸移动，提取一幅静态RGB图像上的语义关键点，同时可以保存所述语义关键点进行基于C++编程语言编写的3D渲染或进一步处理。示例性的，3DDFA需要在视频上运行，提供相邻帧间稳定的3D重建结果。这里的稳定是指在视频的相邻帧中，重建的三维图像的变化应该与真实物体的细粒度移动保持一致。此外，也可以使用dlib人脸关键点提取算法提取原始人脸RGB图像上的语义关键点。dlib人脸关键点提取算法的核心原理是输入标注语义关键点的RGB图像数据，将所述语义关键点做平均，作为初始人脸形状，基于所述初始形状再进行残差计算拟合人脸关键点，与3DDFA算法类似，dlib人脸关键点提取算法支持基于python编程语言的进一步处理。根据本公开的语义关键点是基于本领域常用技术手段中的常用标注方案进行标注所得到的人脸关键点，其中，常用标注方案例如可以包括68点标注方案、106点标注方案、186点标注方案等。每个人脸关键点都具有固定的语义信息。图3示出了语义关键点的一种示例性分布，具体示出了一种68点标注方案，在脸部标记出的68个关键点表征人脸部的预先确定的相应部位，例如点40所具有的语义信息为人脸的右侧内眼角。当然，由其他数量的关键点构成的采集方案也是可以想到的，但是应当理解，其他方案中的语义关键点也都类似的具有预定义的语义信息。语义关键点作为一种图像关键点，可以有效约束ICP对齐误差，通过所述人脸关键点的粗对齐可以给ICP提供较为准确的初值。此外，后序进行点云联合优化可以进一步提高点云对齐精度。具体的，如前所述，类似于第一和第二结构关键点，可以获得第一和第二语义关键点的三维坐标，并基于第一和第二语义关键点分别具有的语义信息，确定第一和第二语义关键点之间确切的对应关系。在这种情形下，优化的目标可以是将第一差值和第二差值的和最小化。由此，通过同时提取语义关键点和结构关键点，可以取得以下效果，一方面：基于语义关键点，为点云提供语义信息，从而克服噪声对ICP算法计算出的对其结果造成的影响，使三维点云的精度更加稳定；另一方面，基于结构关键点，为点云联合优化提供结构信息，从而降低深度相机本身的深度测量的误差，提高三维点云的精度。根据一些实施例，基于所述第一语义关键点的三维坐标和所述第二语义关键点的三维坐标之间的第二差值和所述第一差值，对所述三维人脸点云进行优化，包括：为所述第一差值分配第一权重，以调整所述第一差值；为所述第二差值分配第二权重，以调整所述第二差值；以及基于经调整的第一差值和经调整的第二差值，对所述三维人脸点云进行优化。由此，通过为语义关键点和结构关键点赋予不同的权重，从而调整二者对优化过程的作用程度，进一步提升三维人脸点云的精度。根据一些实施例，所述第一权重小于所述第二权重。由此，通过对具有语义信息的关键点赋予较高权重，有助于提高三维点云的精度。示例性的，所述权重乘以前述差值可以作为待优化的损失函数，即，优化的目标为经调整后的差值的和。示例性的，可以使用列文伯格-马夸尔特优化算法进行优化，所述LM优化算法是一种非线性优化算法，可以看作是梯度下降和高斯牛顿法的结合，其综合了梯度下降对初值不敏感和高斯牛顿在最优值附近收敛速度快的特点。通过此方法，逐帧多次迭代后误差足够小优化收敛，此时优化得到的人脸点云即是最终输出点云。图4示出了点云联合优化的一种实施方式。如图4所示，步骤S401，所述点云联合优化的输入参数包括四个：多帧对齐融合得到的初始三维人脸点云、所有图像帧、每帧图像对应的2D人脸关键点和每帧图像对应的2D图像关键点，所述输入参数在上文均有提及，此处不再赘述。步骤S402，关键点投影。示例性的，所述关键点投影可以根据图像帧和对应的相机参数，将每一帧的人脸关键点和图像关键点都投影到三维人脸点云中，可以得到每一帧对应的3D人脸关键点和3D图像关键点。步骤S403，所述迭代优化的对象为3D人脸点云的坐标，基于相应图像关键点的三维坐标的差值，对所述三维人脸点云进行优化；示例性的，所述优化损失函数为人脸点云到3D人脸关键点和3D图像关键点的L2距离乘以各自的权重；迭代优化的目标是让所述损失函数尽量小，多次迭代后误差足够小，此时优化得到的人脸点云即是标注人脸点云。根据本公开的一个方面，还提供一种重建三维人脸图像装置500，如图5所示，所述重建三维人脸图像装置500可包括：获取单元501、确定单元502、提取单元503、生成单元504和优化单元505。所述获取单元501用于获取人脸的视频数据，所述视频数据包括所述人脸的多个帧，所述多个帧中每一帧的每个像素均包括深度信息。所述确定单元502用于对于所述多个帧中的每一帧，基于该帧中每个像素的深度信息，确定该帧对应的单帧三维点云。所述提取单元503用于对于所述多个帧中的每一帧，从该帧的RGB图像中提取多个图像关键点。所述生成单元504用于基于所述多个帧中每一帧对应的单帧三维点云，生成三维人脸点云。所述优化单元505用于基于所述多个帧中的至少两帧中每一帧的多个图像关键点，对所述三维人脸点云进行优化，以得到目标三维人脸图像。根据一些实施方式，所述多个图像关键点包括用于标记所述人脸的第一区域的结构关键点，所述人脸在所述第一区域发生的形状和/或角度变化符合预设条件。根据一些实施方式，所述优化单元包括：选择子单元，用于从所述多个帧中至少选择第一帧和第二帧，其中，所述第一帧的多个图像关键点中至少包括第一结构关键点，所述第一结构关键点与所述第二帧的多个图像关键点中的第二结构关键点相对应；确定子单元，用于分别确定所述第一结构关键点和所述第二结构关键点在所述三维人脸点云中的三维坐标；以及优化子单元，用于基于所述第一结构关键点的三维坐标和所述第二结构关键点的三维坐标之间的第一差值，对所述三维人脸点云进行优化。根据一些实施方式，所述多个图像关键点还包括所述人脸的语义关键点，所述语义关键点包括用于指示人脸预设部位的语义信息，所述人脸预设部位可以包括所述人脸的五官和轮廓，并且其中，所述第一帧的多个图像关键点还包括第一语义关键点，所述第二帧的多个图像关键点还包括第二语义关键点，其中，所述第一语义关键点和所述第二语义关键点均为所述语义关键点并且具有相同的语义信息，其中，所述确定子单元还被配置用于分别确定所述第一语义关键点和所述第二语义关键点在所述三维人脸点云中的三维坐标；以及所述优化子单元还被配置用于基于所述第一差值和第二差值，对所述三维人脸点云进行优化，所述第二差值为所述第一语义关键点的三维坐标和所述第二语义关键点的三维坐标之间的差值。根据一些实施方式，所述优化子单元还被配置为：为所述第一差值分配第一权重，以调整所述第一差值；为所述第二差值分配第二权重，以调整所述第二差值；以及基于经调整的第一差值和经调整的第二差值，对所述三维人脸点云进行优化。根据一些实施方式，所述第二权重小于所述第一权重。根据本公开的实施例，还提供了一种电子设备、一种可读存储介质和一种计算机程序产品。参考图6，现将描述可以作为本公开的服务器或客户端的电子设备600的结构框图，其是可以应用于本公开的各方面的硬件设备的示例。电子设备旨在表示各种形式的数字电子的计算机设备，诸如，膝上型计算机、台式计算机、工作台、个人数字助理、服务器、刀片式服务器、大型计算机、和其它适合的计算机。电子设备还可以表示各种形式的移动装置，诸如，个人数字处理、蜂窝电话、智能电话、可穿戴设备和其它类似的计算装置。本文所示的部件、它们的连接和关系、以及它们的功能仅仅作为示例，并且不意在限制本文中描述的和/或者要求的本公开的实现。如图6所示，电子设备600包括计算单元601，其可以根据存储在只读存储器602中的计算机程序或者从存储单元608加载到随机访问存储器603中的计算机程序，来执行各种适当的动作和处理。在RAM603中，还可存储电子设备600操作所需的各种程序和数据。计算单元601、ROM 602以及RAM 603通过总线604彼此相连。输入/输出接口605也连接至总线604。电子设备600中的多个部件连接至I/O接口605，包括：输入单元606、输出单元607、存储单元608以及通信单元609。输入单元606可以是能向电子设备600输入信息的任何类型的设备，输入单元606可以接收输入的数字或字符信息，以及产生与电子设备的用户设置和/或功能控制有关的键信号输入，并且可以包括但不限于鼠标、键盘、触摸屏、轨迹板、轨迹球、操作杆、麦克风和/或遥控器。输出单元607可以是能呈现信息的任何类型的设备，并且可以包括但不限于显示器、扬声器、视频/音频输出终端、振动器和/或打印机。存储单元608可以包括但不限于磁盘、光盘。通信单元609允许电子设备600通过诸如因特网的计算机网络和/或各种电信网络与其他设备交换信息/数据，并且可以包括但不限于调制解调器、网卡、红外通信设备、无线通信收发机和/或芯片组，例如蓝牙TM设备、802.11设备、WiFi设备、WiMax设备、蜂窝通信设备和/或类似物。计算单元601可以是各种具有处理和计算能力的通用和/或专用处理组件。计算单元601的一些示例包括但不限于中央处理单元、图形处理单元、各种专用的人工智能计算芯片、各种运行机器学习模型算法的计算单元、数字信号处理器、以及任何适当的处理器、控制器、微控制器等。计算单元601执行上文所描述的各个方法和处理，例如用于重建三维人脸图像的方法。例如，在一些实施例中，用于重建三维人脸图像的方法可被实现为计算机软件程序，其被有形地包含于机器可读介质，例如存储单元608。在一些实施例中，计算机程序的部分或者全部可以经由ROM 602和/或通信单元609而被载入和/或安装到电子设备600上。当计算机程序加载到RAM 603并由计算单元601执行时，可以执行上文描述的用于重建三维人脸图像的方法的一个或多个步骤。备选地，在其他实施例中，计算单元601可以通过其他任何适当的方式而被配置为执行用于重建三维人脸图像的方法。本文中以上描述的系统和技术的各种实施方式可以在数字电子电路系统、集成电路系统、场可编程门阵列、专用集成电路、专用标准产品、芯片上系统的系统、复杂可编程逻辑设备、计算机硬件、固件、软件、和/或它们的组合中实现。这些各种实施方式可以包括：实施在一个或者多个计算机程序中，该一个或者多个计算机程序可在包括至少一个可编程处理器的可编程系统上执行和/或解释，该可编程处理器可以是专用或者通用可编程处理器，可以从存储系统、至少一个输入装置、和至少一个输出装置接收数据和指令，并且将数据和指令传输至该存储系统、该至少一个输入装置、和该至少一个输出装置。用于实施本公开的方法的程序代码可以采用一个或多个编程语言的任何组合来编写。这些程序代码可以提供给通用计算机、专用计算机或其他可编程数据处理装置的处理器或控制器，使得程序代码当由处理器或控制器执行时使流程图和/或框图中所规定的功能/操作被实施。程序代码可以完全在机器上执行、部分地在机器上执行，作为独立软件包部分地在机器上执行且部分地在远程机器上执行或完全在远程机器或服务器上执行。在本公开的上下文中，机器可读介质可以是有形的介质，其可以包含或存储以供指令执行系统、装置或设备使用或与指令执行系统、装置或设备结合地使用的程序。机器可读介质可以是机器可读信号介质或机器可读储存介质。机器可读介质可以包括但不限于电子的、磁性的、光学的、电磁的、红外的、或半导体系统、装置或设备，或者上述内容的任何合适组合。机器可读存储介质的更具体示例会包括基于一个或多个线的电气连接、便携式计算机盘、硬盘、随机存取存储器、只读存储器、可擦除可编程只读存储器、光纤、便捷式紧凑盘只读存储器、光学储存设备、磁储存设备、或上述内容的任何合适组合。为了提供与用户的交互，可以在计算机上实施此处描述的系统和技术，该计算机具有：用于向用户显示信息的显示装置或者LCD监视器)；以及键盘和指向装置，用户可以通过该键盘和该指向装置来将输入提供给计算机。其它种类的装置还可以用于提供与用户的交互；例如，提供给用户的反馈可以是任何形式的传感反馈；并且可以用任何形式来接收来自用户的输入。可以将此处描述的系统和技术实施在包括后台部件的计算系统、或者包括中间件部件的计算系统、或者包括前端部件的计算系统、或者包括这种后台部件、中间件部件、或者前端部件的任何组合的计算系统中。可以通过任何形式或者介质的数字数据通信来将系统的部件相互连接。通信网络的示例包括：局域网、广域网、互联网和区块链网络。计算机系统可以包括客户端和服务器。客户端和服务器一般远离彼此并且通常通过通信网络进行交互。通过在相应的计算机上运行并且彼此具有客户端-服务器关系的计算机程序来产生客户端和服务器的关系。服务器可以是云服务器，也可以为分布式系统的服务器，或者是结合了区块链的服务器。应该理解，可以使用上面所示的各种形式的流程，重新排序、增加或删除步骤。例如，本公开中记载的各步骤可以并行地执行、也可以顺序地或以不同的次序执行，只要能够实现本公开公开的技术方案所期望的结果，本文在此不进行限制。虽然已经参照附图描述了本公开的实施例或示例，但应理解，上述的方法、系统和设备仅仅是示例性的实施例或示例，本发明的范围并不由这些实施例或示例限制，而是仅由授权后的权利要求书及其等同范围来限定。实施例或示例中的各种要素可以被省略或者可由其等同要素替代。此外，可以通过不同于本公开中描述的次序来执行各步骤。进一步地，可以以各种方式组合实施例或示例中的各种要素。重要的是随着技术的演进，在此描述的很多要素可以由本公开之后出现的等同要素进行替换。
