标题title
基于卷积神经网络的表面缺陷区域分割方法及装置
摘要abst
本申请涉及一种基于卷积神经网络的表面缺陷区域分割方法及装置，基于卷积神经网络的表面缺陷区域分割方法包括获取源软件代码，根据源软件代码构造代码属性图，将代码属性图输入预设基于图神经网络的源代码缺陷检测模型，预设基于图神经网络的源代码缺陷检测模型用于生成自适应接收路径，并根据自适应接收路径输出检测结果，可以减少无关代码信息的影响，提高代码漏洞检测的效率。
权利要求书clms
1.一种基于卷积神经网络的表面缺陷区域分割方法，其特征在于，包括：提取输入图像对应的不同尺度的特征图；根据所述不同尺度的特征图获取所述输入图像的不同层次的图像结构信息与场景信息；根据所述不同层次的图像结构信息与场景信息输出表面缺陷区域分割结果。2.根据权利要求1所述的基于卷积神经网络的表面缺陷区域分割方法，其特征在于，所述提取输入图像对应的不同尺度的特征图，包括：将所述输入的图像输入预训练的ResNet网络提取到不同尺度的底层特征图；将所述不同尺度的底层特征图输入通道特征金字塔，所述通道特征金字塔用于对所述不同尺度的底层特征图的N/4个通道利用33卷积操作进行处理，N/4个通道利用55卷积操作处理，N/2个通道利用77卷积操作进行处理；将所述通道特征金字塔理后的特征图进行跳跃连接拼接得到多尺度的特征图。3.根据权利要求1所述的基于卷积神经网络的表面缺陷区域分割方法，其特征在于，所述根据所述不同尺度的特征图获取所述输入图像的不同层次的图像结构信息与场景信息，包括：将不同尺度的特征图输入动态上下文聚合模块得到不同结构层的掩码图；将所述掩码图作矩阵转置操作；根据所述特征图和矩阵转置操作后的掩码图相乘得到上下文信息向量；将所述上下文信息向量重新映射到所述掩码图得到精细化图像解译信息；根据所述精细化图像解译信息得到图像结构信息与场景信息的特征向量。4.根据权利要求3所述的基于卷积神经网络的表面缺陷区域分割方法，其特征在于，所述将不同尺度的特征图输入动态上下文聚合模块得到不同结构层的掩码图，包括：对所述不同尺度的特征图进行11卷积操作得到中间特征图；将所述中间特征图输入动态上下文聚合模块；若动态上下文聚合模块的层数大于1，将上一层动态上下文聚合模块的输出特征图与当前层输出特征拼接，对拼接后特征图进行33卷积、11卷积与Softmax函数处理，得到动态上下文聚合模块的不同结构层的掩码图。5.根据权利要求4所述的基于卷积神经网络的表面缺陷区域分割方法，其特征在于，所述将不同尺度的特征图输入动态上下文聚合模块得到不同结构层的掩码图，还包括：若动态上下文聚合模块的层数为1，对所述中间特征图进行33卷积、11卷积与Softmax函数处理，得到动态上下文聚合模块的掩码图。6.根据权利要求4所述的基于卷积神经网络的表面缺陷区域分割方法，其特征在于，所述上下文信息向量包括多个类别对应的上下文信息，所述将所述上下文信息向量重新映射到所述掩码图得到精细化图像解译信息，包括：计算所述上下文信息向量中多个类别对应的上下文信息的平均值，得到精细化图像解译信息。7.根据权利要求6所述的基于卷积神经网络的表面缺陷区域分割方法，其特征在于，所述根据所述不同层次的图像结构信息与场景信息输出表面缺陷区域分割结果，包括：通过递归方式重复获取多个精细化图像解译信息对应的特征图；对所述多个精细化图像解译信息对应的特征图进行上采样操作得到表面缺陷区域分割结果。8.一种基于卷积神经网络的表面缺陷区域分割装置，其特征在于，包括：提取模块，用于提取输入图像对应的不同尺度的特征图；获取模块，用于根据所述不同尺度的特征图获取所述输入图像的不同层次的图像结构信息与场景信息；输出模块，用于根据所述不同层次的图像结构信息与场景信息输出表面缺陷区域分割结果。
说明书desc
技术领域本申请属于缺陷检测技术领域，具体涉及一种基于卷积神经网络的表面缺陷区域分割方法及装置。背景技术工业生产过程中，需要对相关产品进行表面缺陷检测。举例而言，在钢材的生产加工过程中，容易受到原材料、轧制设备、工人操作技术等众多因素的影响，导致孔洞、擦伤、夹杂、划痕、锟印等多种缺陷的产生，这些缺陷的存在影响钢材外观的同时还会对它的抗腐蚀性、耐磨性和疲劳强度等性能造成影响，严重降低钢材质量，因此需要在生产加工过程中及时、准确的检测出钢材表面缺陷，以便分析其产生的原因，进而消除缺陷产生的根源。随着深度学习技术的快速发展，基于深度学习的工件表面缺陷区域分割方法近年来取得了巨大的成就。现有基于深度学习的工件表面缺陷区域分割方法基于多尺度池化和卷积操作进行缺陷区域分割，但由于其只集中于对图像中缺陷区域全局上下文信息的聚合，在图像复杂时，由于上下文信息包括的场景信息不全面，常造成工件表面缺陷区域分割不准确。发明内容为至少在一定程度上克服现有基于深度学习的工件表面缺陷区域分割方法只集中于对图像中缺陷区域全局上下文信息的聚合，在图像复杂时，由于上下文信息包括的场景信息不全面造成工件表面缺陷区域分割不准确的问题，本申请提供一种基于卷积神经网络的表面缺陷区域分割方法及装置。第一方面，本申请提供一种基于卷积神经网络的表面缺陷区域分割方法，包括：提取输入图像对应的不同尺度的特征图；根据所述不同尺度的特征图获取所述输入图像的不同层次的图像结构信息与场景信息；根据所述不同层次的图像结构信息与场景信息输出表面缺陷区域分割结果。进一步的，所述提取输入图像对应的不同尺度的特征图，包括：将所述输入的图像输入预训练的ResNet网络提取到不同尺度的底层特征图；将所述不同尺度的底层特征图输入通道特征金字塔，所述通道特征金字塔用于对所述不同尺度的底层特征图的N/4个通道利用33卷积操作进行处理，N/4个通道利用55卷积操作处理，N/2个通道利用77卷积操作进行处理；将所述通道特征金字塔理后的特征图进行跳跃连接拼接得到多尺度的特征图。进一步的，所述根据所述不同尺度的特征图获取所述输入图像的不同层次的图像结构信息与场景信息，包括：将不同尺度的特征图输入动态上下文聚合模块得到不同结构层的掩码图；将所述掩码图作矩阵转置操作；根据所述特征图和矩阵转置操作后的掩码图相乘得到上下文信息向量；将所述上下文信息向量重新映射到所述掩码图得到精细化图像解译信息；根据所述精细化图像解译信息得到图像结构信息与场景信息的特征向量。进一步的，所述将不同尺度的特征图输入动态上下文聚合模块得到不同结构层的掩码图，包括：对所述不同尺度的特征图进行11卷积操作得到中间特征图；将所述中间特征图输入动态上下文聚合模块；若动态上下文聚合模块的层数大于1，将上一层动态上下文聚合模块的输出特征图与当前层输出特征拼接，对拼接后特征图进行33卷积、11卷积与Softmax函数处理，得到动态上下文聚合模块的不同结构层的掩码图。进一步的，所述将不同尺度的特征图输入动态上下文聚合模块得到不同结构层的掩码图，还包括：若动态上下文聚合模块的层数为1，对所述中间特征图进行33卷积、11卷积与Softmax函数处理，得到动态上下文聚合模块的掩码图。进一步的，所述上下文信息向量包括多个类别对应的上下文信息，所述将所述上下文信息向量重新映射到所述掩码图得到精细化图像解译信息，包括：计算所述上下文信息向量中多个类别对应的上下文信息的平均值，得到精细化图像解译信息。进一步的，所述根据所述不同层次的图像结构信息与场景信息输出表面缺陷区域分割结果，包括：通过递归方式重复获取多个精细化图像解译信息对应的特征图；对所述多个精细化图像解译信息对应的特征图进行上采样操作得到表面缺陷区域分割结果。第二方面，本申请提供一种基于卷积神经网络的表面缺陷区域分割装置，包括：提取模块，用于提取输入图像对应的不同尺度的特征图；获取模块，用于根据所述不同尺度的特征图获取所述输入图像的不同层次的图像结构信息与场景信息；输出模块，用于根据所述不同层次的图像结构信息与场景信息输出表面缺陷区域分割结果。本申请的实施例提供的技术方案可以包括以下有益效果：本发明实施例提供的基于卷积神经网络的表面缺陷区域分割方法及装置，通过提取输入图像对应的不同尺度的特征图，根据不同尺度的特征图获取输入图像的不同层次的图像结构信息与场景信息，根据不同层次的图像结构信息与场景信息输出表面缺陷区域分割结果，在不引入额外监督的前提下实现了上下文信息的分层动态聚合，通过获取输入图像的不同层次的图像结构信息与场景信息，提高了工件表面缺陷区域分割的精确度。应当理解的是，以上的一般描述和后文的细节描述仅是示例性和解释性的，并不能限制本申请。附图说明此处的附图被并入说明书中并构成本说明书的一部分，示出了符合本申请的实施例，并与说明书一起用于解释本申请的原理。图1为本申请一个实施例提供的一种基于卷积神经网络的表面缺陷区域分割方法的流程图。图2为本申请另一个实施例提供的一种基于卷积神经网络的表面缺陷区域分割方法的流程图。图3为本申请一个实施例提供的另一种基于卷积神经网络的表面缺陷区域分割方法的流程图。图4为本申请一个实施例提供的另一种基于卷积神经网络的表面缺陷区域分割方法的流程图。图5为本申请一个实施例提供的另一种基于卷积神经网络的表面缺陷区域分割方法的流程图。图6为本申请一个实施例提供的一种基于卷积神经网络的表面缺陷区域分割装置的功能结构图。具体实施方式为使本申请的目的、技术方案和优点更加清楚，下面将对本申请的技术方案进行详细的描述。显然，所描述的实施例仅仅是本申请一部分实施例，而不是全部的实施例。基于本申请中的实施例，本领域普通技术人员在没有做出创造性劳动的前提下所得到的所有其它实施方式，都属于本申请所保护的范围。图1为本申请一个实施例提供的基于卷积神经网络的表面缺陷区域分割方法的流程图，如图1所示，该基于卷积神经网络的表面缺陷区域分割方法，包括：S11：提取输入图像对应的不同尺度的特征图；S12：根据不同尺度的特征图获取输入图像的不同层次的图像结构信息与场景信息；S13：根据不同层次的图像结构信息与场景信息输出表面缺陷区域分割结果。传统基于深度学习的工件表面缺陷区域分割方法基于多尺度池化和卷积操作进行缺陷区域分割，但由于其只集中于对图像中缺陷区域全局上下文信息的聚合，在图像复杂时，由于上下文信息包括的场景信息不全面，常造成工件表面缺陷区域分割不准确。本实施例中，通过提取输入图像对应的不同尺度的特征图，根据不同尺度的特征图获取输入图像的不同层次的图像结构信息与场景信息，根据不同层次的图像结构信息与场景信息输出表面缺陷区域分割结果，在不引入额外监督的前提下实现了上下文信息的分层动态聚合，通过获取输入图像的不同层次的图像结构信息与场景信息，提高了工件表面缺陷区域分割的精确度。图2为本申请另一个实施例提供的一种基于卷积神经网络的表面缺陷区域分割方法的流程图，如图2所示，该基于卷积神经网络的表面缺陷区域分割方法，包括：S201：将输入的图像输入预训练的ResNet网络提取到不同尺度的底层特征图；对于输入的图像，利用预训练的ResNet网络提取不同尺度的特征图，输出底层特征图。S202：将不同尺度的底层特征图输入通道特征金字塔，通道特征金字塔用于对不同尺度的底层特征图的N/4个通道利用33卷积操作进行处理，N/4个通道利用55卷积操作处理，N/2个通道利用77卷积操作进行处理；S203：将通道特征金字塔理后的特征图进行跳跃连接拼接得到多尺度的特征图。对于底层特征图，其中R为特征图，C为通道数，H为图像高度、W为图像宽度，作为通道特征金字塔的输入，通道特征金字塔流程如图3所示，将底层特征图的N/4个通道利用33卷积操作进行处理，之后的N/4个通道利用55卷积操作处理，对于剩下的N/2个通道利用77卷积操作进行处理，对于处理后的特征图使用跳跃连接拼接后作为最终的输出特征图，通过多通道的特征金字塔处理，在控制计算量的前提下，有效提取了多尺度的特征图。本申请通过设计网络，学习输入图像的分层上下文的多尺度金字塔表示，来捕获图像的结构信息与包含场景的结构层次。S204：将不同尺度的特征图输入动态上下文聚合模块得到不同结构层的掩码图；一些实施例中，将不同尺度的特征图输入动态上下文聚合模块得到不同结构层的掩码图，包括：对不同尺度的特征图进行11卷积操作得到中间特征图；将中间特征图输入动态上下文聚合模块；动态上下文聚合模块流程如图4所示。若动态上下文聚合模块的层数大于1，将上一层动态上下文聚合模块的输出特征图与当前层输出特征拼接，对拼接后特征图进行33卷积、11卷积与Softmax函数处理，得到动态上下文聚合模块的不同结构层的掩码图。或者，若动态上下文聚合模块的层数为1，对中间特征图进行33卷积、11卷积与Softmax函数处理，得到动态上下文聚合模块的掩码图。本申请利用多个分层动态上下文聚合模块通过递归的方式提取输入图像的不同层次的场景信息，分层动态上下文聚合模块处理流程如图4所示。对于主干网络输出的特征图，首先利用卷积减小通道数，获得特征图。之后将特征图与作为第一层动态上下文聚合模块的输入。对于n=1的动态上下文聚合模块，首先对特征图先后利用卷积、卷积与Softmax函数处理。对于n＞1的动态上下文聚合模块，将第n-1层动态上下文聚合模块的输出特征图获与特征图拼接后，再利用卷积、卷积与Softmax函数处理。最终获得该层的掩码图,其中代表需要预测的类别数。S205：将掩码图作矩阵转置操作；S206：根据特征图和矩阵转置操作后的掩码图相乘得到上下文信息向量；将获得的掩码图作矩阵转置操作，并于特征图作矩阵乘法，获得上下文信息向量，计算公式为：。S207：将上下文信息向量重新映射到掩码图得到精细化图像解译信息；向量包含了个类别对应的上下文信息，计算向量的平均值得到，；其中，i代表第i个目标类别，j代表j为输入图像中的一个像素,代表第n层的精细化图像解译信息。之后将n个向量合并，获得输出的上下文信息向量。一些实施例中，上下文信息向量包括多个类别对应的上下文信息，将上下文信息向量重新映射到所述掩码图得到精细化图像解译信息，包括：计算上下文信息向量中多个类别对应的上下文信息的平均值，得到精细化图像解译信息。根据精细化图像解译信息得到图像结构信息与场景信息的特征向量。将获得的上下文信息向量重新映射到掩码图中，获得输出特征向量,特征向量即为第n层的动态上下文聚合模块输出。S208：通过递归方式重复获取多个精细化图像解译信息对应的特征图；S209：对多个精细化图像解译信息对应的特征图进行上采样操作得到表面缺陷区域分割结果,整体流程如图5所示。现有基于多尺度池化和卷积操作的精细化图像解译方法集中于对图像中全局上下文信息的聚合，而忽略了场景的结构层次和对象，图像的层次结构由场景和一系列对象组成，因此图像的层次结构有助于理解包含复杂场景图像的上下文信息理解与精细化图像解译。本实施例中，利用多个动态上下文聚合模块，在不引入额外监督的前提下实现了上下文信息的分层动态聚合，通过对输入图像进行递归的精细化图像解译，提高了工件表面缺陷区域分割的精确度。本发明实施例提供一种基于卷积神经网络的表面缺陷区域分割装置，如图6所示的功能结构图，该基于卷积神经网络的表面缺陷区域分割装置包括：提取模块61，用于提取输入图像对应的不同尺度的特征图；获取模块62，用于根据不同尺度的特征图获取所述输入图像的不同层次的图像结构信息与场景信息；输出模块63，用于根据不同层次的图像结构信息与场景信息输出表面缺陷区域分割结果。本实施例中，通过提取模块提取输入图像对应的不同尺度的特征图；获取模块根据不同尺度的特征图获取所述输入图像的不同层次的图像结构信息与场景信息；输出模块根据不同层次的图像结构信息与场景信息输出表面缺陷区域分割结果，可以在不引入额外监督的前提下实现了上下文信息的分层动态聚合，通过获取输入图像的不同层次的图像结构信息与场景信息，提高了工件表面缺陷区域分割的精确度。可以理解的是，上述各实施例中相同或相似部分可以相互参考，在一些实施例中未详细说明的内容可以参见其他实施例中相同或相似的内容。需要说明的是，在本申请的描述中，术语“第一”、“第二”等仅用于描述目的，而不能理解为指示或暗示相对重要性。此外，在本申请的描述中，除非另有说明，“多个”的含义是指至少两个。流程图中或在此以其他方式描述的任何过程或方法描述可以被理解为，表示包括一个或更多个用于实现特定逻辑功能或过程的步骤的可执行指令的代码的模块、片段或部分，并且本申请的优选实施方式的范围包括另外的实现，其中可以不按所示出或讨论的顺序，包括根据所涉及的功能按基本同时的方式或按相反的顺序，来执行功能，这应被本申请的实施例所属技术领域的技术人员所理解。应当理解，本申请的各部分可以用硬件、软件、固件或它们的组合来实现。在上述实施方式中，多个步骤或方法可以用存储在存储器中且由合适的指令执行系统执行的软件或固件来实现。例如，如果用硬件来实现，和在另一实施方式中一样，可用本领域公知的下列技术中的任一项或他们的组合来实现：具有用于对数据信号实现逻辑功能的逻辑门电路的离散逻辑电路，具有合适的组合逻辑门电路的专用集成电路，可编程门阵列，现场可编程门阵列等。本技术领域的普通技术人员可以理解实现上述实施例方法携带的全部或部分步骤是可以通过程序来指令相关的硬件完成，所述的程序可以存储于一种计算机可读存储介质中，该程序在执行时，包括方法实施例的步骤之一或其组合。此外，在本申请各个实施例中的各功能单元可以集成在一个处理模块中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个模块中。上述集成的模块既可以采用硬件的形式实现，也可以采用软件功能组件的形式实现。所述集成的模块如果以软件功能组件的形式实现并作为独立的产品销售或使用时，也可以存储在一个计算机可读取存储介质中。上述提到的存储介质可以是只读存储器，磁盘或光盘等。在本说明书的描述中，参考术语“一个实施例”、“一些实施例”、“示例”、“具体示例”、或“一些示例”等的描述意指结合该实施例或示例描述的具体特征、结构、材料或者特点包含于本申请的至少一个实施例或示例中。在本说明书中，对上述术语的示意性表述不一定指的是相同的实施例或示例。而且，描述的具体特征、结构、材料或者特点可以在任何的一个或多个实施例或示例中以合适的方式结合。尽管上面已经示出和描述了本申请的实施例，可以理解的是，上述实施例是示例性的，不能理解为对本申请的限制，本领域的普通技术人员在本申请的范围内可以对上述实施例进行变化、修改、替换和变型。需要说明的是，本发明不局限于上述最佳实施方式，本领域技术人员在本发明的启示下都可得出其他各种形式的产品，但不论在其形状或结构上作任何变化，凡是具有与本申请相同或相近似的技术方案，均落在本发明的保护范围之内。
