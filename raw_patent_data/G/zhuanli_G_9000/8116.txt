标题title
一种基于区块链的可审计数据共享方法
摘要abst
本发明涉及一种基于区块链的可审计数据共享方法，属于应用密码学技术领域。本方法实现了基于属性的访问控制的去中心的第三方文件共享；能够让网络系统安全对第三方服务集群依赖程度低，仅需服务集群中任意一个服务器保持诚实，即可保证文档不被攻击方获取。同时，实现了服务集群的本地计算的正确性可审计，每一个服务器的本地计算通过零知识证明技术生成证明记录在区块链账本中。本方法令文档共享中的行为公开可审计，每一次成功的文档共享在区块链账本均留有足够的永久可审计记录，这些记录公开、不可被篡改，显著提高了系统的可信程度。
权利要求书clms
1.一种基于区块链的可审计数据共享方法，网络系统包括数据提供方、数据接收方、数据存储平台、区块链平台，以及由服务器组成的服务集群和属性授权方；其中，数据提供方通过系统指定访问控制策略，向特定的数据接收方共享数据，并保证每次数据文件的传递过程公开可审计；其特征在于，包括以下步骤：步骤1：服务集群中的所有服务器约定所用椭圆曲线，并生成自己的公私钥对；然后，将每个服务器的公钥进行加和得到服务集群的公钥，并公开椭圆曲线参数和服务集群公钥；之后，数据接收方使用椭圆曲线参数生成自己的公私钥对，并向属性授权方注册属性证书；步骤2：数据提供方在椭圆曲线上生成随机点，由随机点映射出一个随机数作为文件的对称密钥，并对文件进行加密得到文件密文；之后，使用服务集群公钥对随机点进行加密，得到随机点密文；步骤3：数据提供方计算文件与文件密文哈希值，制定基于属性的访问控制策略，与随机点密文一同上传至区块链平台；然后，将文件密文哈希值与文件密文一同上传至数据存储平台；步骤4：数据接收方在区块链平台上请求对文件访问；智能合约判定其权限后，将此次请求发布；之后，数据接收方从数据存储平台获取文件密文；步骤5：服务集群中的各个服务器分别转化随机点密文，并生成相应的计算正确性证明，之后将转化结果与计算正确性证明发布至区块链平台；步骤6：数据接收方从区块链平台查询随机点密文转化结果；智能合约聚合各服务器的转化结果，并将新的随机点密文返回给数据接收方；步骤7：数据接收方使用自己的私钥解密新的随机点密文，得到随机点；然后，从随机点映射得到文件的对称密钥，并用此密钥解密文件密文，得到文件原文。2.如权利要求1所述的一种基于区块链的可审计数据共享方法，其特征在于，步骤1中，服务集群约定的椭圆曲线参数包括椭圆曲线Gp及其生成元B，其中，a、b分别表示包含p个元素的素数域Fp中的两个元素，作为椭圆曲线方程的两个参数；服务器公私钥对生成的方法为：每个服务器Si生成随机数私钥ski和对应公钥pki，pki=B，其中，B表示椭圆曲线上生成元B的ski倍点；服务集群公钥生成的方法为：各服务器公钥进行加和，得到服务集群公钥pkΣ=Σpki；数据接收方公私钥对生成方法为：数据接收方生成随机数私钥skr，以及对应公钥pkr，pkr=B；属性证书注册的方法为：数据接收方向属性授权方注册得到自己的属性证书Cert，证书中包含其具备的属性列表，属性列表中包括i个属性：Attr1，Attr2，…，Attri，Attri表示数据接收方的第i个属性条目。3.如权利要求1所述的一种基于区块链的可审计数据共享方法，其特征在于，步骤B中，随机点生成方法为：数据提供方生成临时随机数rt，将其倍乘生成元B，得到随机点rP，rP＝B＝，其中，x、y分别表示随机点rP的坐标；随机点加密的方法为：数据提供方生成加密随机数r，使用服务集群公钥pk∑对随机点进行加密，得到密文其中，C1、C2分别表示密文左侧点、密文右侧点；随机数映射的方法为：数据提供方所传递的随机数由映射函数f指定，其中，f为椭圆曲线上点到数值的映射，即：随机数M＝f；文件加密的方法为：数据提供方使用随机数M对文件F进行对称加密，得到文件密文C；对称加密可选择任意对称加密机制。4.如权利要求1所述的一种基于区块链的可审计数据共享方法，其特征在于，步骤4中，数据接收方请求对文件访问的方法为：数据接收方通过文件密文哈希值H指定请求的文件，调用智能合约在请求对文件的访问；智能合约判定权限的方法为：智能合约从数据接收方的属性证书Cert中提取其拥有的属性Attr1，Attr2，…，Attri，Attri表示数据接收方的第i个属性条目；之后依据数据提供方制定的文件访问策略Plc，检查其是否匹配；如果匹配，则将其请求发布在区块链上，否则返回错误。5.如权利要求1所述的一种基于区块链的可审计数据共享方法，其特征在于，步骤5中，服务器转化随机点密文的方法为：每个服务器Si对密文进行转化，生成自己的转化随机数ri；然后，使用接收方的公钥pkr计算转化结果=，其中，r·pki=r·B·ski=C1·ski，Ci,1表示服务器Si转化得到的结果密文左侧点，Ci,2表示服务器Si转化得到的结果密文右侧点，r表示数据提供方生成的加密随机数，B表示生成元B的ri倍点；生成计算正确性证明的方法为：每个服务器Si使用零知识证明方式，生成对转化结果计算的正确性零知识证明π，π=PK{:Ci,1=B, pki=B, ri·pkr-C1·ski=Ci,2}，其中，服务器Si转化随机数ri和私钥ski为隐藏变量，结果密文左侧点Ci,1、生成元B、服务器公钥pki、接收方公钥pkr、密文左侧点C1、结果密文右侧点Ci,2为公开变量，且隐藏变量与公开变量满足PK{}中的约束关系；将转化结果与计算正确性证明发布至区块链平台的方法为：服务器调用智能合约上传转化结果与正确性证明π；智能合约在验证证明正确性后，将该转化结果与正确性证明发布在区块链上。6.如权利要求1所述的一种基于区块链的可审计数据共享方法，其特征在于，步骤6中，查询方法为：数据接收方调用结果查询智能合约，请求随机点密文转化结果；智能合约聚合各服务器的转化结果的方法为：智能合约读取服务集群中各服务器上传的转化结果，并将其与原始密文相加，得到新的随机点密文：==，r´=Σri，其中，C1´表示新密文左侧点，C2´表示新密文右侧点，r´表示各服务器生成的随机数的加和。7.如权利要求1所述的一种基于区块链的可审计数据共享方法，其特征在于，步骤7中，随机点解密的方法为：对于转化的新的随机点密文==，接收方使用本人私钥skr倍乘密文左侧点C1´，得到skr·r´·B=r´·pkr，使用右侧点减去该结果，得到随机点skr·r´·B=r´·pkr，B为生成元；随机数映射的方法为：数据接收方对得到的随机点rp，使用约定的映射函数f得到传递的随机数m，m=f，m作为文件密文C的对称密钥，文件解密的方法为：数据提供方使用随机数m对文件密文C进行解密，得到文件密文F，解密机制为步骤B中选择的对称加密机制。
说明书desc
技术领域本发明涉及一种基于区块链的可审计数据共享方法，属于应用密码学技术领域。背景技术在各类工业和民用设备、产品的全生命周期中，涉及产品的监管、设计、生产、使用、维修等多个环节和部门。在各个阶段，各专业部门作业产生大量的多媒体数据文档，如产品预研报告、设计图纸、使用记录、维修文档等。无论是对于监管部门对武器产品进行全生命周期的监管，还是不同部门间的生产、维护协同作业，这些数据文档都具有重大意义。然而，这些数据文档往往由各自的生产单位单独保存，需要通过数据共享的方式在不同部门实体间流通才能发挥作用。作为高度敏感的数据，这些数据文档的机密性应当得到保证，数据的生产单位应能指定访问控制的策略，使得只有符合策略的实体才能获得相应的数据文档。目前，数据共享通常是通过基于属性加密和代理重加密等技术手段实现。然而，这两种技术虽然在一定程度上保护了数据的机密性，但仍然存在数据泄露风险，侵犯数据提供方的权益。例如，当数据提供方为一位请求者生成重加密密钥，或者将一位请求者的属性纳入加密策略中后，服务提供方可能与数据请求者合谋，在数据提供方不知情的情况下获取更多的数据，从而逃避支付与监管。为保障数据共享服务的安全可靠，需要一种能够最大程度降低对提供服务的第三方依赖的数据共享技术。现有的第三方数据共享技术，无法对服务提供方进行有效监督。同时，基于属性加密和代理重加密为基础的数据共享方式，也无法完全防御服务提供方与敌手的联合攻击。发明内容本发明的目的是为了克服现有技术存在的缺陷，为保障数据共享服务的安全可靠，创造性地提出一种基于区块链的可审计数据共享方法。本方法将对第三方的诚实假设，降低至对若干服务提供方任一实体的诚实假设，从而显著提高了系统的可信程度。本方法采用以下技术方式实现。一种基于区块链的可审计数据共享方法，网络系统包括数据提供方、数据接收方、数据存储平台、区块链平台，以及由若干服务器组成的服务集群和属性授权方。其中，数据提供方通过系统指定访问控制策略，向特定的数据接收方共享数据，并保证每次数据文件的传递过程公开可审计。本方法包括以下步骤：步骤1：服务集群中的所有服务器约定所用椭圆曲线，并生成自己的公私钥对。然后，将每个服务器的公钥进行加和得到服务集群的公钥，并公开椭圆曲线参数和服务集群公钥。之后，数据接收方使用椭圆曲线参数生成自己的公私钥对，并向属性授权方注册属性证书。步骤2：数据提供方在椭圆曲线上生成随机点，由随机点映射出一个随机数作为文件的对称密钥，并对文件进行加密得到文件密文。之后，使用服务集群公钥对随机点进行加密，得到随机点密文。步骤3：数据提供方计算文件与文件密文哈希值，制定基于属性的访问控制策略，与随机点密文一同上传至区块链平台。然后，将文件密文哈希值与文件密文一同上传至数据存储平台。步骤4：数据接收方在区块链平台上请求对文件访问。智能合约判定其权限后，将此次请求发布。之后，数据接收方从数据存储平台获取文件密文。步骤5：服务集群中的各个服务器分别转化随机点密文，并生成相应的计算正确性证明，之后将转化结果与计算正确性证明发布至区块链平台。步骤6：数据接收方从区块链平台查询随机点密文转化结果。智能合约聚合各服务器的转化结果，并将新的随机点密文返回给数据接收方。步骤7：数据接收方使用自己的私钥解密新的随机点密文，得到随机点。然后，从随机点映射得到文件的对称密钥，并用此密钥解密文件密文，得到文件原文。有益效果本发明方法，对比现有技术，具有以下优点：1.本方法实现了基于属性的访问控制的去中心的第三方文件共享。2.本方法能够让网络系统安全对第三方服务集群依赖程度低，仅需服务集群中任意一个服务器保持诚实，即可保证文档不被攻击方获取。3.本方法令服务集群的本地计算的正确性可审计，每一个服务器的本地计算通过零知识证明技术生成证明记录在区块链账本中，这些证明可被任意第三方验证其计算的正确性。4.本方法令文档共享中的行为公开可审计，每一次成功的文档共享在区块链账本均留有足够的永久可审计记录，这些记录公开、不可被篡改。附图说明图1是本发明方法的流程图。具体实施方式下面结合附图对本发明的具体实施过程做进一步详细说明。如图1所示，一种基于随机数传递的文件共享方法，包括以下步骤：步骤1：服务集群中的所有服务器约定所用椭圆曲线，并生成自己的公私钥对。然后，将每个服务器的公钥进行加和，得到服务集群的公钥，并公开椭圆曲线参数和服务集群公钥。之后，数据接收方使用椭圆曲线参数生成自己的公私钥对，并向属性授权方注册属性证书。其中，服务集群约定的椭圆曲线，可以是SM2椭圆曲线公钥密码算法推荐曲线。公开的椭圆曲线参数包括椭圆曲线Gp及其生成元B，其中，a、b分别表示包含p个元素的素数域Fp中的两个元素，作为椭圆曲线方程的两个参数。服务器公私钥对生成的方法为：每个服务器Si生成随机数私钥ski和对应公钥pki，pki=B，其中，B表示椭圆曲线上生成元B的ski倍点。服务集群公钥生成的方法为：各服务器公钥进行加和，得到服务集群公钥pkΣ=Σpki。数据接收方公私钥对生成方法为：数据接收方生成随机数私钥skr，以及对应公钥pkr，pkr=B。属性证书注册的方法为：数据接收方向属性授权方注册得到自己的属性证书Cert，证书中包含其具备的属性列表，属性列表中包括i个属性：Attr1，Attr2，…，Attri，Attri表示数据接收方的第i个属性条目。步骤2：数据提供方在椭圆曲线上生成随机点，由随机点映射出一个随机数作为文件的对称密钥，并对文件进行加密得到文件密文。之后，使用服务集群公钥对随机点进行加密，得到随机点密文。具体地，随机点生成方法为：数据提供方生成临时随机数rt，将其倍乘生成元B，得到随机点rP，rP=B=，其中，x、y分别表示随机点rP的坐标。随机点加密的方法为：数据提供方生成加密随机数r，使用服务集群公钥pkΣ对随机点进行加密，得到密文。，其中，C1、C2分别表示密文左侧点、密文右侧点。随机数映射的方法为：数据提供方所传递的随机数由映射函数f指定，其中，f为椭圆曲线上点到数值的映射，即：随机数m=f。函数f可以是任意临时约定的由所选椭圆曲线上点到具体数值的映射。文件加密的方法为：数据提供方使用随机数m对文件F进行对称加密，得到文件密文C。对称加密可选择任意对称加密机制。随机点加密的方法为：数据提供方生成加密随机数r，使用服务集群公钥pkΣ对随机点进行加密，得到密文。，其中，C1、C2分别表示密文左侧点、密文右侧点。步骤3：数据提供方使用哈希函数计算文件哈希值H及文件密文哈希值H，并制定基于属性的访问控制策略Plc，与随机点密文一同上传至区块链平台。然后，将文件密文哈希值与文件密文一同上传至数据存储平台。步骤4：数据接收方在区块链平台上请求对文件访问。智能合约判定其权限后，将此次请求发布。之后，数据接收方通过文件密文哈希值H从数据存储平台获取文件密文C。具体地，数据接收方请求对文件访问的方法为：数据接收方通过文件哈希值H指定请求的文件，调用智能合约在请求对文件的访问。智能合约判定权限的方法为：智能合约从数据接收方的属性证书Cert中提取其拥有的属性Attr1，Attr2，…，Attri，之后依据数据提供方制定的文件访问策略Plc，检查其是否匹配。如果匹配，则将其请求发布在区块链上，否则返回错误。步骤5：服务集群中的各个服务器分别转化随机点密文，并生成相应的计算正确性证明，之后将转化结果与计算正确性证明发布至区块链平台。具体地，服务器转化随机点密文的方法为：每个服务器Si对密文进行转化，生成自己的转化随机数ri。然后，使用接收方的公钥pkr计算转化结果=，其中，r·pki=r·B·ski=C1·ski，Ci,1表示服务器Si转化得到的结果密文左侧点，Ci,2表示服务器Si转化得到的结果密文右侧点，r表示数据提供方生成的加密随机数，B表示生成元B的ri倍点。生成计算正确性证明的方法为：每个服务器Si使用零知识证明方式，生成对转化结果计算的正确性零知识证明π，π=PK{:Ci,1=B, pki=B, ri·pkr-C1·ski=Ci,2}，其中，服务器Si转化随机数ri和私钥ski为隐藏变量，结果密文左侧点Ci,1、生成元B、服务器公钥pki、接收方公钥pkr、密文左侧点C1、结果密文右侧点Ci,2为公开变量，且隐藏变量与公开变量满足PK{}中的约束关系。将转化结果与计算正确性证明发布至区块链平台的方法为：服务器调用智能合约上传转化结果与正确性证明π。智能合约在验证证明正确性后，将该转化结果与正确性证明发布在区块链上。步骤6：数据接收方从区块链平台查询随机点密文转化结果。智能合约聚合各服务器的转化结果，并将新的随机点密文返回给数据接收方。具体地，查询方法为：数据接收方调用结果查询智能合约，请求随机点密文转化结果。智能合约聚合各服务器的转化结果的方法为：智能合约读取服务集群中各服务器上传的转化结果，并将其与原始密文相加，得到新的随机点密文：==，r´=Σri，其中，C1´表示新密文左侧点，C2´表示新密文右侧点，r´表示各服务器生成的随机数的加和。步骤7：数据接收方使用自己的私钥解密新的随机点密文，得到随机点。然后，从随机点映射得到文件的对称密钥，并用此密钥解密文件密文，得到文件原文。具体地，随机点解密的方法为：对于转化的新的随机点密文=，接收方使用本人私钥skr倍乘密文左侧点C1´，得到skr·r´·B=r´·pkr，使用右侧点减去该结果，得到随机点rp，rp=C2´-r´·pkr。随机数映射的方法为：数据接收方对得到的随机点rp，使用约定的映射函数f得到传递的随机数m，m=f，m作为文件密文C的对称密钥。文件解密的方法为：数据提供方使用随机数m对文件密文C进行解密，得到文件密文F。解密机制为步骤B中选择的对称加密机制 。
