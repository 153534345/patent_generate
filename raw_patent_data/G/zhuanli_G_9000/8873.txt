标题title
一种基于MPI和多线程的QPSK解相位模糊器
摘要abst
本发明提供一种基于MPI和多线程的QPSK解相位模糊器，包括并列设置的n个MPI进程，每个MPI进程均包括依次连接的解调码同步模块和解模糊模块，解调码同步模块用于接收QPSK信号并解调同步生成I路码同步数据和Q路码同步数据输出至解模糊模块；解模糊模块包括并列设置的4个数据译码组合线程、4个共享缓存和4个帧同步线程，每个数据译码组合线程均与1个共享缓存和1个帧同步线程依次连接，每个帧同步线程均与4个数据译码组合线程连接。本发明实现了多线程并行的两级解模糊的软件框架、基于OpenMP的多Sections实现自定义线程动态调度模型。在提升解模糊实时性的同时保证了数据完整性，自定义线程动态调度模型可根据数据码率动态调整工作线程数量。
权利要求书clms
1.一种基于MPI和多线程的QPSK解相位模糊器，其特征在于：包括并列设置的n个MPI进程，n≥1；每个MPI进程均包括依次连接的解调码同步模块和解模糊模块，所述解调码同步模块用于接收QPSK信号并解调同步生成I路码同步数据和Q路码同步数据输出至所述解模糊模块；所述解模糊模块包括并列设置的4个数据译码组合线程、4个共享缓存和4个帧同步线程，每个所述数据译码组合线程均与1个所述共享缓存和1个所述帧同步线程依次连接，每个所述帧同步线程均与4个所述数据译码组合线程连接；所述数据译码组合线程用于接收所述I路码同步数据和所述Q路码同步数据并进行Gray译码、IQ组合及码型变换生成译码组合数据写入所述共享缓存，所述共享缓存用于存储所述译码组合数据，所述帧同步线程用于从所述共享缓存中读取所述译码组合数据并进行帧同步处理，所述帧同步线程用于完成所述帧同步处理后生成帧同步锁定消息并同时发送给4个所述数据译码组合线程，所述数据译码组合线程用于接收所述帧同步锁定消息并判断是否是本数据译码组合线程对应的所述帧同步锁定消息，如果判断为是，则所述数据译码组合线程继续进行数据组合和译码工作，如果判断为否，则停止数据组合和译码工作直至接收到本数据译码组合线程对应的所述帧同步锁定消息。2.根据权利要求1所述的一种基于MPI和多线程的QPSK解相位模糊器，其特征在于：n与所述QPSK信号的路数相同；被激活的所述MPI进程始终从进程0开始，按进程号顺序激活；所述MPI进程在同一台机器上创建。3.根据权利要求1所述的一种基于MPI和多线程的QPSK解相位模糊器，其特征在于：所述数据译码组合线程包括OpenMP Sections软件架构，所述OpenMP Sections软件架构用于将所述I路码同步数据和所述Q路码同步数据进行分段覆盖操作。4.根据权利要求3所述的一种基于MPI和多线程的QPSK解相位模糊器，其特征在于：所述数据译码组合线程用于将所述I路码同步数据和所述Q路码同步数据进行分段处理且各数据段长度相同、相邻数据段保持一段覆盖区，每个所述OpenMP Sections软件架构的Section处理一个数据段的Gray译码、数据组合和码型变换，所述数据译码组合线程拷贝每个Section的输出数据到统一的结果缓冲区且后一段数据处理得到的结果覆盖前一段数据对应的尾部。5.根据权利要求4所述的一种基于MPI和多线程的QPSK解相位模糊器，其特征在于：所述输出数据的长度相同并且是字节整数倍，所述覆盖区包括M个字节，M为2的k次幂，k≥1。6.根据权利要求1所述的一种基于MPI和多线程的QPSK解相位模糊器，其特征在于：所述数据译码组合线程使用pthread进行创建。7.根据权利要求1所述的一种基于MPI和多线程的QPSK解相位模糊器，其特征在于：所述IQ组合用于将Gray译码后的I路码同步数据和Q路码同步数据组合成I+Q数据、I-Q数据、Q+I数据和Q-I数据；所述码型变换用于将所述I+Q数据、所述I-Q数据、所述Q+I数据和所述Q-I数据进行码型变换生成所述译码组合数据并写入所述共享缓存。8.根据权利要求1所述的一种基于MPI和多线程的QPSK解相位模糊器，其特征在于：所述Gray译码包括符合CCSDS标准的Gray0译码方式、Gray1译码方式、Gray2译码方式、Gray3译码方式、Gray4译码方式、Gray5译码方式、Gray6译码方式和Gray7译码方式。9.根据权利要求1所述的一种基于MPI和多线程的QPSK解相位模糊器，其特征在于：所述码型变换包括NRZ-L码型、NRZ-M码型、NRZ-S码型、BIΦ-L码型、BIΦ-S码型和BIΦ-M码型。10.根据权利要求1所述的一种基于MPI和多线程的QPSK解相位模糊器，其特征在于：所述帧同步锁定消息包括发送所述帧同步锁定消息的所述帧同步线程的序号和帧同步标志位。
说明书desc
技术领域本发明涉及电数字数据处理技术领域，具体涉及一种基于MPI和多线程的QPSK解相位模糊器。背景技术卫星通信的带宽和功率均受限，因此常采用恒定包络类型调制作为传输体制。QPSK是恒定包括类型调制中最典型的一种，广泛应用于包括民用无线通信、卫星导航及深空通信。接收方进行解调译码时，需进行载波恢复、码同步、解相位模糊等操作恢复载波，通常使用4次方环，costas环等非线性载波恢复方法，从而带来了相位模糊，其相位模糊可能为0°、90°、180°或270°四重相位模糊。目前，应用于通信系统中的基带设备中实现QPSK解调相位解模糊功能的方法是基于FPGA编程，通过帧同步识别帧头数据来判断解调数据此时属于哪种相位模糊状态。传统工程实践方法需要依次对四种相位模糊的数据进行判断，假设解调数据的相位，将数据进行帧同步，如果帧同步失败则再换下一种相位进行判断。此过程中会造成解调数据的损失和信息的浪费，这在深空通信中是不可接受的。发明内容本发明是为了解决QPSK解调相位解模糊的计算性能差和数据不完整性问题，提供一种基于MPI和多线程的QPSK解相位模糊器，利用MPI和多线程并行执行数据译码组合和帧同步，以多核多路CPU的计算能力和多个共享内存空间为代价，保证了正确的输入序列数据完整性，不需要多次串行尝试每个输入序列译码结果是否能帧同步，再确定正确的输入序列，利用纯软件实现信号软解调，有效提升计算性能并保持数据的完整性。本发明提供一种基于MPI和多线程的QPSK解相位模糊器，包括并列设置的n个MPI进程，n≥1；每个MPI进程均包括依次连接的解调码同步模块和解模糊模块，解调码同步模块用于接收QPSK信号并解调同步生成I路码同步数据和Q路码同步数据输出至解模糊模块；解模糊模块包括并列设置的4个数据译码组合线程、4个共享缓存和4个帧同步线程，每个数据译码组合线程均与1个共享缓存和1个帧同步线程依次连接，每个帧同步线程均与4个数据译码组合线程连接；数据译码组合线程用于接收I路码同步数据和Q路码同步数据并进行Gray译码、IQ组合及码型变换生成译码组合数据写入共享缓存，共享缓存用于存储译码组合数据，帧同步线程用于从共享缓存中读取译码组合数据并进行帧同步处理，帧同步线程用于完成帧同步处理后生成帧同步锁定消息并同时发送给4个数据译码组合线程，数据译码组合线程用于接收帧同步锁定消息并判断是否是本数据译码组合线程对应的帧同步锁定消息，如果判断为是，则数据译码组合线程继续进行数据组合和译码工作，如果判断为否，则停止数据组合和译码工作直至接收到本数据译码组合线程对应的帧同步锁定消息。本发明所述的一种基于MPI和多线程的QPSK解相位模糊器，作为优选方式，n与QPSK信号的路数相同；被激活的MPI进程始终从进程0开始，按进程号顺序激活；MPI进程在同一台机器上创建。本发明所述的一种基于MPI和多线程的QPSK解相位模糊器，作为优选方式，数据译码组合线程包括OpenMP Sections软件架构，OpenMP Sections软件架构用于将I路码同步数据和Q路码同步数据进行分段覆盖操作。本发明所述的一种基于MPI和多线程的QPSK解相位模糊器，作为优选方式，数据译码组合线程用于将I路码同步数据和Q路码同步数据进行分段处理且各数据段长度相同、相邻数据段保持一段覆盖区，每个OpenMP Sections软件架构的Section处理一个数据段的Gray译码、数据组合和码型变换，数据译码组合线程拷贝每个Section的输出数据到统一的结果缓冲区且后一段数据处理得到的结果覆盖前一段数据对应的尾部。本发明所述的一种基于MPI和多线程的QPSK解相位模糊器，作为优选方式，输出数据的长度相同并且是字节整数倍，覆盖区包括M个字节，M为2的k次幂，k≥1。本发明所述的一种基于MPI和多线程的QPSK解相位模糊器，作为优选方式，数据译码组合线程使用pthread进行创建。本发明所述的一种基于MPI和多线程的QPSK解相位模糊器，作为优选方式，IQ组合用于将Gray译码后的I路码同步数据和Q路码同步数据组合成I+Q数据、I-Q数据、Q+I数据和Q-I数据；码型变换用于将I+Q数据、I-Q数据、Q+I数据和Q-I数据进行码型变换生成译码组合数据并写入共享缓存。本发明所述的一种基于MPI和多线程的QPSK解相位模糊器，作为优选方式，Gray译码包括符合CCSDS标准的Gray0译码方式、Gray1译码方式、Gray2译码方式、Gray3译码方式、Gray4译码方式、Gray5译码方式、Gray6译码方式和Gray7译码方式。本发明所述的一种基于MPI和多线程的QPSK解相位模糊器，作为优选方式，码型变换包括NRZ-L码型、NRZ-M码型、NRZ-S码型、BIΦ-L码型、BIΦ-S码型和BIΦ-M码型。本发明所述的一种基于MPI和多线程的QPSK解相位模糊器，作为优选方式，帧同步锁定消息包括发送帧同步锁定消息的帧同步线程的序号和帧同步标志位。本发明的技术方案是：MPI进程并行软件框架实现本发明的MPI进程并行软件框架由针对不同QPSK码同步数据I、Q序列进行译码组合和帧同步的线程对组成。该步骤内的MPI进程并行软件框架实现过程如下：、对于n路QPSK解调数据进行解模糊时，激活n个MPI进程，每个MPI进程内启动2个pthread线程，一共2n个pthread线程。其中pthread线程0～pthread线程n-1属于第一级处理模块，执行Gray译码、数据组合和码型变换，输入I、Q路数据经过Gray译码后，组合成I+Q、I-Q、Q+I、Q-I的形式经过码型变换后写入对应的共享缓存1～共享缓存4中。、pthread线程n～pthread线程2n-1属于第二级处理模块，分别从共享缓存1～共享缓存4中读出数据，并进行帧同步处理。当某个帧同步pthread线程进入到帧同步锁定状态时，将锁定消息通过全局变量的形式发送给该MPI进程内所有pthread线程。、数据译码组合线程接收到帧同步锁定消息后，判断是否是本线程对应的组合数据结果已经帧同步成功。如果判断为是则继续进行数据译码组合工作，如果判断为否，则停止数据译码组合工作，与对应的帧同步线程同时等待下一次复位命令后再启动工作。创建的MPI进程是否被激活并启动工作，取决于输入QPSK数据的路数设置。被激活的MPI进程始终从进程0开始。MPI进程需在同一台机器上创建，使得MPI进程间可以共享内存缓冲区。数据译码组合模块中，输入为I、Q两路数据，Gray码译码采用符合CCSDS标准的Gray0～Gray7共八种译码方式；码型变换采用符合IRIGB-106标准的NRZ-L、NRZ-M、NRZ-S、BIΦ-L、BIΦ-S、BIΦ-M共六种码型。数据译码组合模块中，输入为I、Q两路数据，按图2所示方式组成I+Q、I-Q、Q+I和Q-I四种组合方式。多OpenMP Sections实现数据分段覆盖并行译码组合本发明通过OpenMP多Sections实现数据分段覆盖并行对数据进行译码组合的处理过程如下：、将输入的I、Q数据流进行分段处理，各数据段长度相同，相邻数据段保持一段覆盖区，如图3所示。、设置OpenMP Sections软件架构，如图4所示。每个Section处理一个数据段的Gray译码、数据组合和码型变换。、拷贝每个Section输出的结果到统一的结果缓冲区，后一段数据处理得到的结果要覆盖前一段数据对应的尾部。覆盖区长度设置需满足输出数据长度是字节整数倍。且为保证每块数据尾部输出结果的准确性，覆盖区至少有2个字节的数据需要被后一段的数据所覆盖。本发明包括n个MPI解模糊进程，4n个共享缓存，4n个数据译码组合线程、4n个帧同步线程；数据译码组合线程、共享缓存和帧同步线程一一对应；每个MPI解模糊进程包含4个数据译码组合线程和4个帧同步线程。数据译码组合线程用于对I、Q路码同步数据进行Gray译码、IQ组合及码型变换，将译码组合数据写入对应的共享缓存；帧同步线程从对应的共享缓存中读出译码组合后数据，并进行帧同步处理，一旦完成帧同步，则将帧同步锁定消息同时发送给4个数据译码组合线程；帧同步锁定消息包括发送该消息的帧同步线程序号、帧同步标志位；数据译码组合线程，接收到帧同步锁定消息后，判断是否是本数据译码组合线程对应的译码组合数据结果已经完成帧同步，如果判断为是，则继续进行数据组合和译码工作，如果判断为否，停止数据组合和译码工作。MPI进程个数等于需要解相位模糊的QPSK信号的路数，最小值为1。被激活的MPI进程始终从进程0开始，按进程号顺序激活。MPI进程需在同一台机器上创建。进入到数据译码组合线程的数据形式为QPSK码同步后的I、Q两路数据。数据译码组合线程使用pthread进行创建，创建顺序可以不依据其线程编号顺序。每个译码组合线程内使用OpenMP Sections实现数据分段覆盖并行译码组合。每个Section的数据长度相同，且相邻Section的数据有M个字节重复。M最小为2，且M取值应为2的n次幂。本发明实现了多线程并行的两级解模糊的软件框架、基于OpenMP的多Sections实现自定义线程动态调度模型。在提升解模糊实时性的同时保证了数据完整性，自定义线程动态调度模型可根据数据码率动态调整工作线程数量。本发明具有以下优点：本发明根据MPI+多线程并行执行不同输入数据的译码组合和帧同步，使得解相位模糊过程不丢失数据；本发明利用数据缓存将数据译码组合摸块和帧同步模块分成二级处理，有利于适应不同码速率和帧长；本发明利用MPI形式激活多进程，有利于适应不同路数的QPSK解调信号的解模糊；MPI多进程并行处理，不同路QPSK解调信号之间不会相互干扰；本发明利用OpenMP的多Sections对数据进行分段覆盖操作，可动态调整一次并行解模糊的数据吞吐量，从而达到工程应用实时性的要求。附图说明图1为一种基于MPI和多线程的QPSK解相位模糊器软件框架示意图；图2为一种基于MPI和多线程的QPSK解相位模糊器解调数据组合输入序列关系图；图3为一种基于MPI和多线程的QPSK解相位模糊器解调数据分块示意图；图4为一种基于MPI和多线程的QPSK解相位模糊器OpenMP多Sections示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。实施例1如图1所示，一种基于MPI和多线程的QPSK解相位模糊器，包括并列设置的n个MPI进程，n≥1；每个MPI进程均包括依次连接的解调码同步模块和解模糊模块，解调码同步模块用于接收QPSK信号并解调同步生成I路码同步数据和Q路码同步数据输出至解模糊模块；解模糊模块包括并列设置的4个数据译码组合线程、4个共享缓存和4个帧同步线程，每个数据译码组合线程均与1个共享缓存和1个帧同步线程依次连接，每个帧同步线程均与4个数据译码组合线程连接；数据译码组合线程用于接收I路码同步数据和Q路码同步数据并进行Gray译码、IQ组合及码型变换生成译码组合数据写入共享缓存，共享缓存用于存储译码组合数据，帧同步线程用于从共享缓存中读取译码组合数据并进行帧同步处理，帧同步线程用于完成帧同步处理后生成帧同步锁定消息并同时发送给4个数据译码组合线程，数据译码组合线程用于接收帧同步锁定消息并判断是否是本数据译码组合线程对应的帧同步锁定消息，如果判断为是，则数据译码组合线程继续进行数据组合和译码工作，如果判断为否，则停止数据组合和译码工作直至接收到本数据译码组合线程对应的帧同步锁定消息；n与QPSK信号的路数相同；被激活的MPI进程始终从进程0开始，按进程号顺序激活；MPI进程在同一台机器上创建；数据译码组合线程使用pthread进行创建；如图2所示，IQ组合用于将Gray译码后的I路码同步数据和Q路码同步数据组合成I+Q数据、I-Q数据、Q+I数据和Q-I数据；码型变换用于将I+Q数据、I-Q数据、Q+I数据和Q-I数据进行码型变换生成译码组合数据并写入共享缓存；如图3-4所示，数据译码组合线程包括OpenMP Sections软件架构，OpenMPSections软件架构用于将I路码同步数据和Q路码同步数据进行分段覆盖操作；数据译码组合线程用于将I路码同步数据和Q路码同步数据进行分段处理且各数据段长度相同、相邻数据段保持一段覆盖区，每个OpenMP Sections软件架构的Section处理一个数据段的Gray译码、数据组合和码型变换，数据译码组合线程拷贝每个Section的输出数据到统一的结果缓冲区且后一段数据处理得到的结果覆盖前一段数据对应的尾部；输出数据的长度相同并且是字节整数倍，覆盖区包括M个字节，M为2的k次幂，k≥1；Gray译码包括符合CCSDS标准的Gray0译码方式、Gray1译码方式、Gray2译码方式、Gray3译码方式、Gray4译码方式、Gray5译码方式、Gray6译码方式和Gray7译码方式；码型变换包括NRZ-L码型、NRZ-M码型、NRZ-S码型、BIΦ-L码型、BIΦ-S码型和BIΦ-M码型；帧同步锁定消息包括发送帧同步锁定消息的帧同步线程的序号和帧同步标志位。实施例2一种基于MPI和多线程的QPSK解相位模糊器，包括MPI多进程软件框架、基于pthread的多线程实现数据译码组合和帧同步异步架构。如图1所示，本发明的一种基于MPI+多线程的QPSK解相位模糊器的具体实现步骤如下：MPI进程并行软件框架实现本发明的MPI进程并行软件框架由针对不同QPSK码同步数据I、Q序列进行译码组合和帧同步的线程对组成。该步骤内的MPI进程并行软件框架实现过程如下：、对于n路QPSK解调数据进行解模糊时，激活n个MPI进程，每个MPI进程内启动2个pthread线程，一共2n个pthread线程。其中pthread线程0～pthread线程n-1属于第一级处理模块，执行Gray译码、数据组合和码型变换，输入I、Q路数据经过Gray译码后，组合成I+Q、I-Q、Q+I、Q-I的形式经过码型变换后写入对应的共享缓存1～共享缓存4中。、pthread线程n～pthread线程2n-1属于第二级处理模块，分别从共享缓存1～共享缓存4中读出数据，并进行帧同步处理。当某个帧同步pthread线程进入到帧同步锁定状态时，将锁定消息通过全局变量的形式发送给该MPI进程内所有pthread线程。、数据译码组合线程接收到帧同步锁定消息后，判断是否是本线程对应的组合数据结果已经帧同步成功。如果判断为是则继续进行数据译码组合工作，如果判断为否，则停止数据译码组合工作，与对应的帧同步线程同时等待下一次复位命令后再启动工作。创建的MPI进程是否被激活并启动工作，取决于输入QPSK数据的路数设置。被激活的MPI进程始终从进程0开始。MPI进程需在同一台机器上创建，使得MPI进程间可以共享内存缓冲区。数据译码组合模块中，输入为I、Q两路数据，Gray码译码采用符合CCSDS标准的Gray0～Gray7共八种译码方式；码型变换采用符合IRIGB-106标准的NRZ-L、NRZ-M、NRZ-S、BIΦ-L、BIΦ-S、BIΦ-M共六种码型。数据译码组合模块中，输入为I、Q两路数据，按图2所示方式组成I+Q、I-Q、Q+I和Q-I四种组合方式。多OpenMP Sections实现数据分段覆盖并行译码组合本发明的通过OpenMP多Sections实现数据分段覆盖并行对数据进行译码组合的处理过程如下：、将输入的I、Q数据流进行分段处理，各数据段长度相同，相邻数据段保持一段覆盖区，如图3所示。、设置OpenMP Sections软件架构，如图4所示。每个Section处理一个数据段的Gray译码、数据组合和码型变换。、拷贝每个Section输出的结果到统一的结果缓冲区，后一段数据处理得到的结果要覆盖前一段数据对应的尾部。覆盖区长度设置需满足输出数据长度是字节整数倍。且为保证每块数据尾部输出结果的准确性，覆盖区至少有2个字节的数据需要被后一段的数据所覆盖。以上所述，仅为本发明较佳的具体实施方式，但本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，根据本发明的技术方案及其发明构思加以等同替换或改变，都应涵盖在本发明的保护范围之内。
