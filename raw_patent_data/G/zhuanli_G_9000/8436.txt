标题title
一种基于多模块卷积特征融合的医学图像分类方法
摘要abst
本发明公开了一种基于多模块卷积特征融合的医学图像分类方法，所述方法包括如下步骤：步骤一、图像预处理；步骤二、网络模型分模块卷积设计；步骤三、多模块特征融合；步骤四、基于多模块融合特征的特征提取；步骤五、经平均池化层输出分类结果。本发明的分类方法全部采用卷积方式提取特征，参数量较少，运行速度较快，适应医学影像数据少量样本的特征，不需要更新过多的权重参数，同时经实验验证此方法性能优异。此方法不仅适用于二分类任务，同时适用于多分类任务，可以根据任务需要，灵活调整各模块输出通道数，以改进分类效果。
权利要求书clms
1.一种基于多模块卷积特征融合的医学图像分类方法，其特征在于所述方法包括如下步骤：步骤一、图像预处理任意尺寸的二维医学图像经预处理模块，将图像大小转化为224×224，同时，在预处理模块中识别当前网络模型使用状态，若当前网络模型为训练阶段，则进行图像数据增强操作；若当前网络模型为测试阶段，则不进行图像数据增强操作；步骤二、网络模型分模块卷积设计多模块卷积网络模型架构包含如下5个模块：模块1：包括第一层Conv3-64和第二层Dwconv3-64，其中：经预处理模块，第一层Conv3-64的输入数据维度为N×3×224×224，即输入图像的高度和宽度均为224，每批次加载的数据量大小为N，色彩通道是RGB，输出维度为N×64×224×224的特征图至第二层Dwconv3-64；第二层Dwconv3-64输出维度为N×64×224×224的特征图A，特征图A经最大池化层输出维度为N×64×112×112的特征图，输入模块2；第一层Conv3-64的输出和第二层Dwconv3-64的输出均使用标准卷积层Conv1-32连接，输出维度均为N×32×224×224的特征图，对输出的特征图进行求和操作∑，得到维度为N×32×224×224的信息融合后的特征图，信息融合后的特征图再经标准卷积层Conv1-X进行特征提取，输出维度为N×X×224×224的特征图，特征图经卷积核大小为32×32的平均池化层输出维度为N×X×7×7的特征图B；模块2：包括第三层Conv3-128和第四层Dwconv3-128，其中：第三层Conv3-128输入维度为N×64×112×112的特征图，输出维度为N×128×112×112的特征图至第四层Dwconv3-128；第四层Dwconv3-128输出维度为N×128×112×112的特征图C，特征图C经最大池化层输出维度为N×128×56×56的特征图，输入模块3；第三层Conv3-128的输出和第四层Dwconv3-128的输出均使用标准卷积层Conv1-32连接，输出维度均为N×32×112×112的特征图，对输出的特征图进行求和操作∑，得到维度为N×32×112×112的信息融合后的特征图，信息融合后的特征图再经标准卷积层Conv1-X进行特征提取，输出维度为N×X×112×112的特征图，特征图经卷积核大小为16×16的平均池化层输出维度为N×X×7×7的特征图D；模块3：包括第五层Conv3-256、第六层Dwconv3-256和第七层Dwconv3-256，第五层Conv3-256输入维度为N×128×56×56的特征图，输出维度为N×256×56×56的特征图至第六层Dwconv3-256；第六层Dwconv3-256输出维度为N×256×56×56的特征图至第七层Dwconv3-256；第七层Dwconv3-256输出维度为N×256×56×56的特征图E，特征图E经最大池化层输出维度为N×256×28×28的特征图，输入模块4；第五层Conv3-256的输出、第六层Dwconv3-256和第七层Dwconv3-256的输出均使用标准卷积层Conv1-32连接，输出维度均为N×32×56×56的特征图，对输出的特征图进行求和操作∑，得到维度为N×32×56×56的信息融合后的特征图，信息融合后的特征图再经标准卷积层Conv1-X进行特征提取，输出维度为N×X×56×56的特征图，特征图经卷积核大小为8×8的平均池化层输出维度为N×X×7×7的特征图F；模块4：包括第八层Conv3-512、第九层Dwconv3-512和第十层Dwconv3-512，其中：第八层Conv3-512输入维度为N×256×28×28的特征图，输出维度为N×512×28×28的特征图至第九层Dwconv3-512；第九层Dwconv3-512输出维度为N×512×28×28的特征图至第十层Dwconv3-512；第十层Dwconv3-512输出维度为N×512×28×28的特征图G，特征图G经最大池化层输出维度为N×512×14×14的特征图，输入模块5；第八层Conv3-512的输出、第九层Dwconv3-512和第十层Dwconv3-512的输出均使用标准卷积层Conv1-32连接，输出维度均为N×32×28×28的特征图，对输出的特征图进行求和操作∑，得到维度为N×32×28×28的信息融合后的特征图，信息融合后的特征图再经标准卷积层Conv1-X进行特征提取，输出维度为N×X×28×28的特征图，特征图经卷积核大小为4×4的平均池化层输出维度为N×X×7×7的特征图H；模块5：包括第十一层Conv3-512、第十二层Dwconv3-512和第十三层Dwconv3-512，其中：第十一层Conv3-512输入维度为N×512×14×14的特征图，输出维度为N×512×14×14的特征图至第十二层Dwconv3-512；第十二层Dwconv3-512输出维度为N×512×14×14的特征图至第十三层Dwconv3-512；第十三层Dwconv3-512输出维度为N×512×14×14的特征图I；第十一层Conv3-512的输出、第十二层Dwconv3-512和第十三层Dwconv3-512的输出均使用标准卷积层Conv1-32连接，输出维度均为N×32×14×14的特征图，对输出的特征图进行求和操作∑，得到维度为N×32×14×14的信息融合后的特征图，信息融合后的特征图再经标准卷积层Conv1-X进行特征提取，输出维度为N×X×14×14的特征图，特征图经卷积核大小为2×2的平均池化层输出维度为N×X×7×7的特征图J；步骤三、多模块特征融合使用concat方式进行多模块特征融合：将模块1输出的N×X×7×7特征图B、模块2输出的N×X×7×7特征图D、模块3输出的N×X×7×7特征图F、模块4输出的N×X×7×7特征图H和模块5输出的N×X×7×7特征图J按通道融合为N×5X×7×7特征图；步骤四、基于多模块融合特征的特征提取使用标准卷积层Conv1-nclass对步骤三融合的N×5X×7×7特征图进行特征提取，得到N×nclass×7×7的特征图；步骤五、经平均池化层输出分类结果使用卷积核大小为7×7的平均池化层，经降维输出N×nclass的分类结果，经softmax可输出类别的预测概率。2.根据权利要求1所述的基于多模块卷积特征融合的医学图像分类方法，其特征在于所述图像数据增强操作为旋转、翻转、亮度调节、添加高斯噪声中的一种或几种。3.根据权利要求1所述的基于多模块卷积特征融合的医学图像分类方法，其特征在于所述模块1～模块5均由标准卷积层、深度可分离卷积层和平均池化层组成，模块与模块之间使用最大池化层连接。4.根据权利要求1或3所述的基于多模块卷积特征融合的医学图像分类方法，其特征在于所述最大池化层使用2×2的卷积核，步长stride为2。5.根据权利要求1所述的基于多模块卷积特征融合的医学图像分类方法，其特征在于所述网络模型使用的激活函数为ReLU函数。6.根据权利要求1所述的基于多模块卷积特征融合的医学图像分类方法，其特征在于所述16≤X≤64。
说明书desc
技术领域本发明属于人工智能技术领域，涉及一种医学图像分类方法，具体涉及一种基于多模块卷积特征融合的医学图像分类方法。背景技术深度学习技术使机器能够分析各种训练图像，并使用反向传播算法自动提取特征表达式。它可以解决许多图像理解和分析问题，如语义分割、图像识别和分类。目前，卷积神经网络正逐渐成为医学图像筛查分类中的标准技术，其应用非常广泛，例如皮肤癌的分类、肺结节的识别、甲状腺疾病的诊断等。医学图像存在样本量少、数据分布不均衡等特点，因此对有限样本进行特征提取是有效识别的关键。目前医学图像分类识别中，较多使用经典的CNN模型，准确率有待进一步提高。发明内容本发明的目的是提供一种基于多模块卷积特征融合的医学图像分类方法，以充分提取图像的关键特征，提高医学图像识别的准确率。本发明的目的是通过以下技术方案实现的：一种基于多模块卷积特征融合的医学图像分类方法，包括如下步骤：步骤一、图像预处理任意尺寸的二维医学图像经预处理模块，将图像大小转化为224×224，同时，在预处理模块中识别当前网络模型使用状态，若当前网络模型为训练阶段，则进行图像数据增强操作，如旋转、翻转、亮度调节、添加高斯噪声等中的一种或几种；若当前网络模型为测试阶段，则不进行此操作；步骤二、网络模型分模块卷积设计多模块卷积网络模型架构包含如下5个模块：模块1：包括第一层Conv3-64和第二层Dwconv3-64，其中：经预处理模块，第一层Conv3-64的输入数据维度为N×3×224×224，即输入图像的高度和宽度均为224，每批次加载的数据量大小为N，色彩通道是RGB，输出维度为N×64×224×224的特征图至第二层Dwconv3-64；第二层Dwconv3-64输出维度为N×64×224×224的特征图A，特征图A经最大池化层输出维度为N×64×112×112的特征图，输入模块2；第一层Conv3-64的输出和第二层Dwconv3-64的输出均使用标准卷积层Conv1-32连接，输出维度均为N×32×224×224的特征图，对输出的特征图进行求和操作∑，得到维度为N×32×224×224的信息融合后的特征图，信息融合后的特征图再经标准卷积层Conv1-X进行特征提取，X为变量，根据学习类别数适应调整，建议取值范围：16≤X≤64，输出维度为N×X×224×224的特征图，特征图经卷积核大小为32×32的平均池化层输出维度为N×X×7×7的特征图B；模块2：包括第三层Conv3-128和第四层Dwconv3-128，其中：第三层Conv3-128输入维度为N×64×112×112的特征图，输出维度为N×128×112×112的特征图至第四层Dwconv3-128；第四层Dwconv3-128输出维度为N×128×112×112的特征图C，特征图C经最大池化层输出维度为N×128×56×56的特征图，输入模块3；第三层Conv3-128的输出和第四层Dwconv3-128的输出均使用标准卷积层Conv1-32连接，输出维度均为N×32×112×112的特征图，对输出的特征图进行求和操作∑，得到维度为N×32×112×112的信息融合后的特征图，信息融合后的特征图再经标准卷积层Conv1-X进行特征提取，输出维度为N×X×112×112的特征图，特征图经卷积核大小为16×16的平均池化层输出维度为N×X×7×7的特征图D；模块3：包括第五层Conv3-256、第六层Dwconv3-256和第七层Dwconv3-256，第五层Conv3-256输入维度为N×128×56×56的特征图，输出维度为N×256×56×56的特征图至第六层Dwconv3-256；第六层Dwconv3-256输出维度为N×256×56×56的特征图至第七层Dwconv3-256；第七层Dwconv3-256输出维度为N×256×56×56的特征图E，特征图E经最大池化层输出维度为N×256×28×28的特征图，输入模块4；第五层Conv3-256的输出、第六层Dwconv3-256和第七层Dwconv3-256的输出均使用标准卷积层Conv1-32连接，输出维度均为N×32×56×56的特征图，对输出的特征图进行求和操作∑，得到维度为N×32×56×56的信息融合后的特征图，信息融合后的特征图再经标准卷积层Conv1-X进行特征提取，输出维度为N×X×56×56的特征图，特征图经卷积核大小为8×8的平均池化层输出维度为N×X×7×7的特征图F；模块4：包括第八层Conv3-512、第九层Dwconv3-512和第十层Dwconv3-512，其中：第八层Conv3-512输入维度为N×256×28×28的特征图，输出维度为N×512×28×28的特征图至第九层Dwconv3-512；第九层Dwconv3-512输出维度为N×512×28×28的特征图至第十层Dwconv3-512；第十层Dwconv3-512输出维度为N×512×28×28的特征图G，特征图G经最大池化层输出维度为N×512×14×14的特征图，输入模块5；第八层Conv3-512的输出、第九层Dwconv3-512和第十层Dwconv3-512的输出均使用标准卷积层Conv1-32连接，输出维度均为N×32×28×28的特征图，对输出的特征图进行求和操作∑，得到维度为N×32×28×28的信息融合后的特征图，信息融合后的特征图再经标准卷积层Conv1-X进行特征提取，输出维度为N×X×28×28的特征图，特征图经卷积核大小为4×4的平均池化层输出维度为N×X×7×7的特征图H；模块5：包括第十一层Conv3-512、第十二层Dwconv3-512和第十三层Dwconv3-512，其中：第十一层Conv3-512输入维度为N×512×14×14的特征图，输出维度为N×512×14×14的特征图至第十二层Dwconv3-512；第十二层Dwconv3-512输出维度为N×512×14×14的特征图至第十三层Dwconv3-512；第十三层Dwconv3-512输出维度为N×512×14×14的特征图I；第十一层Conv3-512的输出、第十二层Dwconv3-512和第十三层Dwconv3-512的输出均使用标准卷积层Conv1-32连接，输出维度均为N×32×14×14的特征图，对输出的特征图进行求和操作∑，得到维度为N×32×14×14的信息融合后的特征图，信息融合后的特征图再经标准卷积层Conv1-X进行特征提取，输出维度为N×X×14×14的特征图，特征图经卷积核大小为2×2的平均池化层输出维度为N×X×7×7的特征图J；步骤三、多模块特征融合使用concat方式进行多模块特征融合：将模块1输出的N×X×7×7特征图B、模块2输出的N×X×7×7特征图D、模块3输出的N×X×7×7特征图F、模块4输出的N×X×7×7特征图H和模块5输出的N×X×7×7特征图J按通道融合为N×5X×7×7特征图；步骤四、基于多模块融合特征的特征提取使用标准卷积层Conv1-nclass对步骤三融合的N×5X×7×7特征图进行特征提取，得到N×nclass×7×7的特征图；步骤五、经平均池化层输出分类结果使用卷积核大小为7×7的平均池化层，经降维输出N×nclass的分类结果，经softmax可输出类别预测概率。相比于现有技术，本发明具有如下优点：1、本发明的分类方法全部采用卷积方式提取特征，参数量较少，运行速度较快，适应医学影像数据少量样本的特征，不需要更新过多的权重参数，同时经实验验证此方法性能优异。2、此方法不仅适用于二分类任务，同时适用于多分类任务，可以根据任务需要，灵活调整各模块输出通道数，以改进分类效果。3、此方法最后一层使用平均池化层，便于对网络学习到的特征进行提取，进行类激活热图的可视化。附图说明图1为本发明提出的网络模型结构；图2为四位置解剖结构示例；图3为类激活热图示例。具体实施方式下面结合附图对本发明的技术方案作进一步的说明，但并不局限于此，凡是对本发明技术方案进行修改或者等同替换，而不脱离本发明技术方案的精神和范围，均应涵盖在本发明的保护范围中。本发明提供了一种基于多模块卷积特征融合的医学图像分类方法，包括如下步骤：步骤一、图像预处理任意尺寸的二维医学图像经预处理模块，将图像大小转化为224×224，同时，在预处理模块中识别当前网络模型使用状态，若当前网络模型为训练阶段，则进行图像数据增强操作，如旋转、翻转、亮度调节、添加高斯噪声等；若当前网络模型为测试阶段，则不进行此操作。步骤二、网络模型分模块卷积设计如图1所示，网络模型架构包含5个模块，每个模块都由标准卷积层、深度可分离卷积层和平均池化层组成，模块与模块之间使用最大池化层连接，最大池化层使用2×2的卷积核，步长stride为2；模型使用的激活函数为ReLU函数。若分类数量nclass＜＝16，可令Conv1-X为Conv1-16；若nclass＞16，可增加Conv1-X的通道深度，选择X＞20。实施过程以Conv1-X为Conv1-16为例进行说明，当Conv1-X为Conv1-16时，模型总参数量为5.2MB，计算量FLOPs约为83.8GB。网络的默认输入数据维度为N×3×224×224，N为加载的每批数据量的大小，输入图像的高度和宽度均为224，色彩通道是RGB。模块1：Conv3-64是第一个卷积层，即使用的卷积核滑动窗口为3×3×3，步长stride为1，padding为1。由卷积通用公式、公式，可以得到最后输出的特征图高度和宽度均为224，同时这个卷积层要求最后输出深度为64的特征图，因此经Conv3-64得到输出的特征图的维度为N×64×224×224。第二层Dwconv3-64表示深度可分离卷积，将卷积过程分为逐通道卷积与逐点1×1卷积两步，逐通道卷积对应64个3×3卷积核，得到N×64×224×224大小的输出。再使用逐点1×1卷积，融合不同通道间的特征，将输入特征图N×64×224×224，输出维度为N×64×224×224的特征图A。第一层Conv3-64的输出和第二层Dwconv3-64的输出均使用标准卷积层Conv1-32连接，输出特征图大小均为N×32×224×224。然后，对输出的特征图进行求和操作∑，得到的信息融合后的特征图N×32×224×224。再经标准卷积层Conv1-16进行特征提取，输出特征图的维度为N×16×224×224。特征图经卷积核大小为32×32的平均池化层输出维度为N×16×7×7的特征图B。其中，W和H分别表示图像的宽度和高度，下标input表示输入图像的相关参数；下标output表述输出图像的相关参数，下标filter表示卷积核的相关参数；S表示卷积核的步长；P表示图像边缘增加的边界像素层数。模块1输出的特征图A经最大池化层维度为N×64×112×112，输入模块2。模块2：Conv3-128为第三个卷积层，使用的卷积核大小为3×3，步长为1，padding为1，得到输出的特征图的维度为N×128×112×112。第四层使用深度可分离卷积层Dwconv3-128，逐通道卷积对应128个3×3卷积核，得到N×128×112×112大小的输出；再使用逐点1×1卷积，融合不同通道间的特征，输出维度为N×128×112×112的特征图C。第三层Conv3-128的输出和第四层Dwconv3-128的输出均使用标准卷积层Conv1-32连接，输出特征图大小均为N×32×112×112。然后，对输出的特征图进行求和操作∑，得到的信息融合后的特征图N×32×112×112。再经标准卷积层Conv1-16进行特征提取，输出特征图的维度为N×16×112×112。特征图经卷积核大小为16×16的平均池化层输出维度为N×16×7×7的特征图D。模块2输出的特征图C经最大池化层维度为N×128×56×56，输入模块3。模块3：Conv3-256为第五个卷积层，使用的卷积核大小为3×3，步长为1，padding为1，得到输出的特征图的维度为N×256×56×56。第六层使用深度可分离卷积层Dwconv3-256，逐通道卷积对应256个3×3卷积核，得到N×256×56×56大小的输出；再使用逐点1×1卷积，融合不同通道间的特征，输出维度为N×256×56×56的特征图至第七层。第七层仍使用深度可分离卷积层Dwconv3-256，得到输出维度为N×256×56×56的特征图E。第五层Conv3-256的输出、第六层Dwconv3-256和第七层Dwconv3-256的输出均使用标准卷积层Conv1-32连接，输出特征图大小均为N×32×56×56。然后，对输出的特征图进行求和操作∑，得到的信息融合后的特征图N×32×56×56。再经标准卷积层Conv1-16进行特征提取，输出特征图的维度为N×16×56×56。特征图经卷积核大小为8×8的平均池化层输出维度为N×16×7×7的特征图F。模块3输出的特征图E经最大池化层维度为N×256×28×28，输入模块4。模块4：Conv3-512为第八个卷积层，使用的卷积核大小为3×3，步长为1，padding为1，得到输出的特征图的维度为N×512×28×28。第九层使用深度可分离卷积层Dwconv3-512，逐通道卷积对应512个3×3卷积核，得到N×512×28×28大小的输出；再使用逐点1×1卷积，融合不同通道间的特征，输出维度为N×512×28×28的特征图至第十层。第十层仍使用深度可分离卷积层Dwconv3-512，得到输出维度为N×512×28×28的特征图G。第八层Conv3-512的输出、第九层Dwconv3-512和第十层Dwconv3-512的输出均使用标准卷积层Conv1-32连接，输出特征图大小均为N×32×28×28。然后，对输出的特征图进行求和操作∑，得到的信息融合后的特征图N×32×28×28。再经标准卷积层Conv1-16进行特征提取，输出特征图的维度为N×16×28×28。特征图经卷积核大小为4×4的平均池化层输出维度为N×16×7×7的特征图H。模块4输出的特征图G经最大池化层维度为N×512×14×14，输入模块5。模块5：模块5的标准卷积层和深度可分离卷积层与模块4基本相同。Conv3-512为第十一个卷积层，使用的卷积核大小为3×3，步长为1，padding为1，得到输出的特征图的维度为N×512×14×14。第十二层使用深度可分离卷积层Dwconv3-512，逐通道卷积对应512个3×3卷积核，得到N×512×14×14大小的输出；再使用逐点1×1卷积，融合不同通道间的特征，输出维度为N×512×14×14的特征图至第十三层。第十三层仍使用深度可分离卷积层Dwconv3-512，得到输出维度为N×512×14×14的特征图I。第十一层Conv3-512的输出、第十二层Dwconv3-512和第十三层Dwconv3-512的输出均使用标准卷积层Conv1-32连接，输出特征图大小均为N×32×14×14。然后，对输出的特征图进行求和操作∑，得到的信息融合后的特征图N×32×14×14。再经标准卷积层Conv1-16进行特征提取，输出特征图的维度为N×16×14×14。特征图经卷积核大小为2×2的平均池化层输出维度为N×16×7×7的特征图J。步骤三、多模块特征融合使用concat方式进行多模块特征融合：将模块1输出的N×16×7×7特征图B、模块2输出的N×16×7×7特征图D、模块3输出的N×16×7×7特征图F、模块4输出的N×16×7×7特征图H和模块5输出的N×16×7×7特征图J按通道融合为N×80×7×7特征图。步骤四、基于多模块融合特征的特征提取使用标准卷积层Conv1-nclass将输入维度N×80×7×7，提取特征得到N×nclass×7×7的特征图。步骤五、经平均池化层输出分类结果使用卷积核大小为7×7的平均池化层，降维输出N×nclass分类结果。经softmax可输出类别的预测概率。实施例：使用本发明提出的方法对贲门、胃角前壁、胃角后壁、幽门进行解剖位置识别，即nclass＝4。位置示例图像如图2所示。数据集分为训练集和测试集，每批次加载的数据量大小N取16。训练集含贲门320张、胃角前壁634张、胃角后壁634张、幽门324张共计1912张；测试集含贲门101张、胃角前壁245张、胃角后壁262张、幽门133张共计741张。如表1所示，模型对4个解剖位置的识别准确率均＞99％。表1解剖位置识别评价指标本发明提出的网络模型最后一层为平均池化层，因此无需更改模型，直接进行梯度的反向传播，即可获取类激活热图，如图3所示。
