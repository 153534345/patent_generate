标题title
一种多传感器融合的机器人定位方法、系统及装置
摘要abst
本发明公开了一种多传感器融合的机器人定位方法，包括以下步骤：S1：通过惯性测量单元、里程计、单线激光雷达的数据信息建立离线二维栅格地图；S2：将离线二维栅格地图坐标系与全局坐标系建立变换关系；S3：设定机器人初始化状态信息，获取单线激光雷达、光流传感器、差分GPS的输出信息；S4：根据光流传感器的输出信息，计算得到机器人的运动的速度信息和姿态信息；本发明通过机器人定位方法和系统，设置包括惯性测量单元、里程计、单线激光雷达、光流传感器和差分GPS的定位传感器，对机器人进行综合数据采集，实现了兼顾定位精度前提下的低成本，具有高可靠性，在单一传感器失效的情况下，仍旧能提供稳定准确的定位结果输出。
权利要求书clms
1.一种多传感器融合的机器人定位方法，其特征在于，包括以下步骤：S1：通过惯性测量单元、里程计、单线激光雷达的数据信息建立离线二维栅格地图；S2：将离线二维栅格地图坐标系与全局坐标系建立变换关系；S3：设定机器人初始化状态信息，获取单线激光雷达、光流传感器、差分GPS的输出信息；S4：根据光流传感器的输出信息，计算得到机器人的运动的速度信息和姿态信息；S5：将单线激光雷达的数据同离线二维栅格地图进行匹配，得到机器人当前的位置信息和姿态信息；S6：将差分GPS得到的全局坐标系下的机器人位置信息通过步骤S2中标定到的变换关系转换到离线二维栅格地图坐标系下；S7：采用全向运动模型来预测当前机器人的位置信息、姿态信息和速度信息的预测值；S8：基于步骤S7中的机器人状态信息的预测值，采用扩展卡尔曼滤波融合定位传感器得到的观测值，得到机器人当前状态信息的最优估计，并将此估计值作为最终机器人当前的定位信息。2.根据权利要求1所述的一种多传感器融合的机器人定位方法，其特征在于，步骤S4中，机器人当前的位置信息和姿态信息的具体获得方法为：S41：通过垂直往下安装的光流传感器获得图像的不同时刻的帧数据，得到像素的移动速度；S42：将像素的移动速度转换成机器人的运动的速度信息和姿态信息。3.根据权利要求2所述的一种多传感器融合的机器人定位方法，其特征在于，步骤S42的具体实现方法为：基于离线二维栅格地图坐标系与全局坐标系的变换关系以及像素坐标系到光流传感器坐标系的变换关系，得到：其中，为离线二维栅格地图坐标系与光流传感器坐标系的变换矩阵，和为机器人在离线二维栅格地图坐标系下的变化量，和为相机焦距f除以dx、dy得到的值，dx、dy为感光芯片上像素的实际物理大小，、为像素坐标系下的变化量，、为像素坐标系下的原点，为光流传感器坐标系下的坐标，离线二维栅格地图坐标系下的变化量除以对应的变化时间得到机器人运动的速度信息。4.根据权利要求1或2或3所述的一种多传感器融合的机器人定位方法，其特征在于，步骤S5中，采用自适应蒙特卡罗定位方法实现基于单线激光雷达数据在离线二维栅格地图下的机器人定位匹配。5.一种多传感器融合的机器人定位系统，适用于如权利要求1至4任一项所述的一种多传感器融合的机器人定位方法，其特征在于，包括：地图构建模块和实时定位模块；所述地图构建模块根据惯性测量数据、里程数据和二维点云数据生成离线二维栅格地图；在离线二维栅格地图的数据采集过程中采用闭环的约束修正位姿和地图信息；所述实时定位模块：用于获取惯性测量单元、里程计、单线激光雷达、光流传感器和差分GPS的输出信息。6.根据权利要求5所述的一种多传感器融合的机器人定位系统，其特征在于，所述实时定位模块包括：初始化定位单元，用于获取机器人启动后初始化位姿信息；数据接收及预处理单元，用于获取惯性测量单元、里程计、单线激光雷达、光流传感器和差分GPS的输出信息，并处理光流传感器得到的数据，计算得到机器人运动的速度信息和姿态信息，将差分GPS得到的全局坐标系下的机器人位置信息转换到地图坐标系下；机器人位姿预测值计算单元，用于采用全向运动模型来预测当前机器人的位置信息、姿态信息和速度信息的预测值；机器人位姿观测值计算单元，用于实时将单线激光雷达的数据同离线的二维栅格地图进行匹配，得到机器人当前的位置信息和姿态信息；扩展卡尔曼滤波单元，基于机器人状态信息的预测值，采用扩展卡尔曼滤波融合惯性测量单元、里程计、单线激光雷达、光流传感器和差分GPS的输出信息，得到机器人当前状态信息的估计值，并将估计值作为机器人当前最终的定位信息。7.一种多传感器融合的机器人定位装置，应用于如权利要求5所述的一种多传感器融合的机器人定位系统，其特征在于，包括：惯性测量单元，用于获取机器人的惯性测量数据；里程计，用于获取机器人的里程数据；单线激光雷达，用于获取机器人平台周围环境的二维点云数据；光流传感器，通过计算像素的光流变化，得到机器人在平面上两个方向上的位移变化的数据；差分GPS，获取机器人全局坐标系下的位置关系。
说明书desc
技术领域本发明涉及机器人技术领域，尤其涉及一种多传感器融合的机器人定位方法、系统及装置。背景技术随着人工智能技术和传感器技术等的飞速发展，机器人领域的整体技术水平不断提升。各种类型的机器人越来越多的出现在各个领域，不断提升对应领域的自动化水平。而机器人的定位技术作为机器人的核心组成部分，其性能很大程度上直接影响了机器人整体的性能。传统的机器人定位技术主要包括面向室内的机器人定位和面向室外的机器人定位。CN105411490B提出一种“移动机器人的实时定位方法及移动机器人”。其采用里程计、陀螺仪、双目相机融合的方案。先通过里程计和陀螺仪的输出融合得到一个初步的位姿信息，然后将其作为预测输入结合双目相机获取的场景信息运行SLAM算法得到一个优化后的定位信息。该方案在室内小场景下基本能满足定位需求，但其缺陷非常的明显：1. 适用的场景比较有限，在室外场景、室内高动态室内场景、室内低纹理或是重复纹理场景下，双目的SLAM算法很难获取有效的位姿估计。2. 在线跑SLAM算法对机器人平台的计算和功耗压力非常大，进而增加了定位方案的成本。3. 无法解决类似里程计打滑等传感器异常的情况。CN107340522A提出“一种激光雷达定位的方法、装置及系统”，其采用三维激光雷达、惯性测量单元、里程计融合的方案。先采用三个传感器的数据做融合获得当前场景的三维点云地图，然后采用卡尔曼滤波方法结合惯性测量单元和里程计得到的位姿递推值和三维激光雷达的实时数据与三维点云地图匹配得到的位姿观测值得到最优位姿估计。该方案采用三维激光雷达来进行数据融合可以一定程度上适应室外场景的机器人定位需求，但其存在如下的缺陷点：1.方案的成本太高，包括昂贵的三维激光雷达的使用成本，稠密的三维点云地图的存储成本，实时点云数据与三维点云地图之间匹配的计算成本。2.无法解决类似里程计打滑等传感器异常的情况。发明内容本发明主要解决现有的技术中对于机器人的定位方法可靠性差的问题；提供一种多传感器融合的机器人定位方法，实现了低成本、高可靠性、室内外均能正常工作的机器人实时定位功能。本发明的上述技术问题主要是通过下述技术方案得以解决的：一种多传感器融合的机器人定位方法，包括以下步骤：S1：通过惯性测量单元、里程计、单线激光雷达的数据信息建立离线二维栅格地图；S2：将离线二维栅格地图坐标系与全局坐标系建立变换关系；S3：设定机器人初始化状态信息，获取单线激光雷达、光流传感器、差分GPS的输出信息；S4：根据光流传感器的输出信息，计算得到机器人的运动的速度信息和姿态信息；S5：将单线激光雷达的数据同离线二维栅格地图进行匹配，得到机器人当前的位置信息和姿态信息；S6：将差分GPS得到的全局坐标系下的机器人位置信息通过步骤S2中标定到的变换关系转换到离线二维栅格地图坐标系下；S7：采用全向运动模型来预测当前机器人的位置信息、姿态信息和速度信息的预测值；S8：基于步骤S7中的机器人状态信息的预测值，采用扩展卡尔曼滤波融合定位传感器得到的观测值，得到机器人当前状态信息的最优估计，并将此估计值作为最终机器人当前的定位信息。作为优选，步骤S4中，机器人当前的位置信息和姿态信息的具体获得方法为：S41：通过垂直往下安装的光流传感器获得图像的不同时刻的帧数据，得到像素的移动速度；S42：将像素的移动速度转换成机器人的运动的速度信息和姿态信息。作为优选，步骤S42的具体实现方法为：基于离线二维栅格地图坐标系与全局坐标系的变换关系以及像素坐标系到光流传感器坐标系的变换关系，得到：其中，为离线二维栅格地图坐标系与光流传感器坐标系的变换矩阵，和为机器人在离线二维栅格地图坐标系下的变化量，和为相机焦距f除以dx、dy得到的值，dx、dy为感光芯片上像素的实际物理大小，、为像素坐标系下的变化量，、为像素坐标系下的原点，为光流传感器坐标系下的坐标，离线二维栅格地图坐标系下的变化量除以对应的变化时间得到机器人运动的速度信息。作为优选，步骤S5中，采用自适应蒙特卡罗定位方法实现基于单线激光雷达数据在离线二维栅格地图下的机器人定位匹配。一种多传感器融合的机器人定位系统，包括：地图构建模块和实时定位模块；所述地图构建模块根据惯性测量数据、里程数据和二维点云数据生成离线二维栅格地图；在离线二维栅格地图的数据采集过程中采用闭环的约束修正位姿和地图信息；所述实时定位模块：用于获取惯性测量单元、里程计、单线激光雷达、光流传感器和差分GPS的输出信息。作为优选，所述的实时定位模块包括：初始化定位单元，用于获取机器人启动后初始化位姿信息；数据接收及预处理单元，用于获取惯性测量单元、里程计、单线激光雷达、光流传感器和差分GPS的输出信息，并处理光流传感器得到的数据，计算得到机器人运动的速度信息和姿态信息，将差分GPS得到的全局坐标系下的机器人位置信息转换到地图坐标系下；机器人位姿预测值计算单元，用于采用全向运动模型来预测当前机器人的位置信息、姿态信息和速度信息的预测值；机器人位姿观测值计算单元，用于实时将单线激光雷达的数据同离线的二维栅格地图进行匹配，得到机器人当前的位置信息和姿态信息；扩展卡尔曼滤波单元，基于机器人状态信息的预测值，采用扩展卡尔曼滤波融合惯性测量单元、里程计、单线激光雷达、光流传感器和差分GPS的输出信息，得到机器人当前状态信息的估计值，并将估计值作为机器人当前最终的定位信息。一种多传感器融合的机器人定位装置，包括：惯性测量单元，用于获取机器人的惯性测量数据；里程计，用于获取机器人的里程数据；单线激光雷达，用于获取机器人平台周围环境的二维点云数据；光流传感器，通过计算像素的光流变化，得到机器人在平面上两个方向上的位移变化的数据；差分GPS，获取机器人全局坐标系下的位置关系。本发明的有益效果是：通过机器人定位方法和系统，设置包括惯性测量单元、里程计、单线激光雷达、光流传感器和差分GPS的定位传感器，对机器人进行综合数据采集，实现了兼顾定位精度前提下的低成本，包括低硬件成本和低储存和计算成本；具有高可靠性，在单一传感器失效的情况下，仍旧能提供稳定准确的定位结果输出；应用范围广，室内外均可正常运行。附图说明图1是本发明实施例的机器人定位方法的流程示意图。图2是本发明实施例的机器人定位系统的结构框图。图中1、地图构建模块，2、实时定位模块，3、初始化定位单元，4、数据接收及预处理单元，5、机器人位姿预测值计算单元，6、机器人位姿观测值计算单元，7、扩展卡尔曼滤波单元。具体实施方式为了使本发明的目的、技术方案及优点更加清楚明白，通过下述实施例并结合附图，对本发明实施例中的技术方案的进一步详细说明。应当理解，此处所描述的具体实施例仅用以解释本发明，并不用于限定发明。实施例：一种多传感器融合的机器人定位方法，如图1所示，包括以下步骤：S1：通过惯性测量单元、里程计、单线激光雷达的数据信息建立离线二维栅格地图；具体的实现为：通过惯性测量单元获取机器人的惯性测量数据、通过里程计获取机器人的里程数据、通过单线激光雷达获取机器人平台周围环境的二维点云数据，生成离线二维栅格地图。并在地图的采集的过程中，采用闭环数据采集的方式，用于在离线二维栅格地图的过程中采用闭环的约束修正位姿和地图信息；生成的离线二维栅格地图包括栅格化处理，空间域滤波以及去噪点等地图后处理操作。S2：将离线二维栅格地图坐标系与全局坐标系建立变换关系；标定得到两个坐标系的变换矩阵为。S3：设定机器人初始化状态信息，获取单线激光雷达、光流传感器、差分GPS的输出信息；机器人初始化状态信息可通过机器人启动时直接获取得到，惯性测量单元、里程计、单线激光雷达、光流传感器和差分GPS的输出频率对应为100hz、100hz、10hz、60hz和1hz。S4：根据光流传感器的输出信息，计算得到机器人的运动的速度信息和姿态信息；机器人当前的位置信息和姿态信息的具体获得方法为：S41：通过垂直往下安装的光流传感器获得图像的不同时刻的帧数据，得到像素的移动速度；S42：将像素的移动速度转换成机器人的运动的速度信息和姿态信息；步骤S42的具体实现方法为：像素坐标系到光流传感器坐标系的变换公式为： 此处u、v为像素坐标系下的坐标，和为相机焦距f除以dx、dy得到的值，dx、dy为感光芯片上像素的实际物理大小，为光流传感器坐标系下的坐标。对公式进行转换得到：对公式进行微分操作有：设定地图坐标系到光流传感器坐标系之间的变换矩阵为，则机器人在地图坐标系下的变化量为：基于公式即可获得基于光流传感器在地图坐标系下的位姿态的变化量，和为机器人在离线二维栅格地图坐标系下的变化量，、为像素坐标系下的变化量，、为像素坐标系下的原点，变化量除以对应的变化时间即可得到运动的速度信息。S5：将单线激光雷达的数据同离线二维栅格地图进行匹配，得到机器人当前的位置信息和姿态信息；采用自适应蒙特卡罗定位方法实现基于单线激光雷达数据在离线二维栅格地图下的机器人定位匹配，或采用KLD采样的定位方法进行机器人的定位匹配。S6：实时将差分GPS得到的全局坐标系下的机器人位置信息通过步骤S2中标定到的变换关系转换到离线二维栅格地图坐标系下。S7：采用全向运动模型来预测当前机器人的位置信息、姿态信息和速度信息的预测值。S8：基于步骤S7中的机器人状态信息的预测值，采用扩展卡尔曼滤波融合定位传感器得到的观测值，得到机器人当前状态信息的最优估计，并将此估计值作为最终机器人当前的定位信息；此处的观测值包括直接或间接来自惯性测量单元、里程计、单线激光雷达、光流传感器、差分GPS的测量值。如图2所示，本发明还提供一种多传感器融合的机器人定位系统，包括地图构建模块1和实时定位模块2。地图构建模块用于通过惯性测量单元获取机器人的惯性测量数据、通过里程计获取机器人的里程数据、通过单线激光雷达获取机器人平台周围环境的二维点云数据，生成离线二维栅格地图。并在地图的采集的过程中，采用闭环数据采集的方式，用于在离线二维栅格地图的过程中采用闭环的约束修正位姿和地图信息。实时定位模块用于获取惯性测量单元、里程计、单线激光雷达、光流传感器、差分GPS的输出信息。实时处理光流传感器得到的数据，并计算得到机器人的运动的速度信息和姿态信息。实时将单线激光雷达的数据同离线的二维栅格地图进行匹配，得到机器人当前的位置信息和姿态信息。实时将差分GPS得到的全局坐标系下的机器人位置信息通过标定到的变换关系转换到地图坐标系下。采用全向运动模型来预测当前机器人的位置信息、姿态信息、速度信息的预测值。基于机器人状态信息的预测值，采用扩展卡尔曼滤波融合各传感器得到的观测值，得到机器人当前状态信息的最优估计，并将此估计值作为最终机器人当前的定位信息。定位模块包括初始化定位单元3、数据接收及预处理单元4、机器人位姿预测值计算单元5、机器人位姿观测值计算单元6和扩展卡尔曼滤波单元7。初始化定位单元用于获取机器人启动后初始化位姿信息。数据接收及预处理单元用于获取惯性测量单元、里程计、单线激光雷达、光流传感器、差分GPS的输出信息，并实时处理光流传感器得到的数据，并计算得到机器人的运动的速度信息和姿态信息。实时将差分GPS得到的全局坐标系下的机器人位置信息转换到地图坐标系下。机器人位姿预测值计算单元用于采用全向运动模型来预测当前机器人的位置信息、姿态信息、速度信息的预测值。机器人位姿观测值计算单元用于实时将单线激光雷达的数据同离线的二维栅格地图进行匹配，得到机器人当前的位置信息和姿态信息。扩展卡尔曼滤波单元用于基于机器人状态信息的预测值，采用扩展卡尔曼滤波融合各传感器得到的观测值，得到机器人当前状态信息的最优估计，并将此估计值作为最终机器人当前的定位信息。本发明还提供一种多传感器融合的机器人定位装置，包括惯性测量单元、里程计、单线激光雷达、光流传感器和差分GPS，惯性测量单元，用于获取机器人的惯性测量数据；里程计，用于获取机器人的里程数据；单线激光雷达，用于获取机器人平台周围环境的二维点云数据；光流传感器，通过计算像素的光流变化，得到机器人在平面上两个方向上的位移变化的数据；差分GPS，获取机器人全局坐标系下的位置关系。惯性测量单元、里程计、单线激光雷达、光流传感器和差分GPS均与处理器连接，处理器包括机器人定位系统的地图构建模块和实时定位模块，处理器基于惯性测量单元、里程计、单线激光雷达的数据生成离线二维栅格地图。并根据惯性测量单元数据、里程计数据、单线激光雷达实时二维点云数据与离线二维栅格地图匹配的结果、光流传感器的数据、差分GPS装置的数据生成当前机器人的位姿信息。还设置有存储器，用于存储离线二维栅格地图、各传感器的测量数据、机器人状态预测值、机器人状态观测值和机器人当前定位信息。本发明设置了光流传感器对机器人的速度信息和姿态信息进行采集，结合其余的定位传感器进行多传感器的融合定位，当出现其他定位传感器故障时，光流传感器工作依然可以实现机器人的定位，同时，光流传感器能很好的适应光线、季节等环境变化的影响，不会因为光线的因素导致精度降低，保证精度的前提下实现了机器人定位的硬件成本、软件成本和存储成本的降低。以上所述的实施例只是本发明的一种较佳的方案，并非对本发明作任何形式上的限制，在不超出权利要求所记载的技术方案的前提下还有其它的变体及改型。
