标题title
一种证照OFD版式文件快速转图片的方法、系统及装置
摘要abst
本发明公开了一种证照OFD版式文件快速转图片的方法、系统及装置，属于电子证照OFD图片转换技术领域，该方法基于MapReduce模块并行处理大规模数据集，采用MapReduce框架实现对证照OFD版式文件的多任务转换，根据不同证照类型自定义清晰度，实现输入端为不同证照类型OFD版式文件，输出端对应输出相应证照类型的证照图片文件；该方法的实现包括：数据录入模块，数据处理模块，包括用于并行处理数据的MapReduce并行处理子模块和用于OFD版式文件转轻量级图片的数据转换子模块；数据存储模块。本发明能够在短时间完成大量OFD文件转轻量级图片的效果，促进了电子证照系统的应用服务水平。
权利要求书clms
1.一种证照OFD版式文件快速转图片的方法，其特征在于，基于MapReduce模块并行处理大规模数据集，采用MapReduce框架实现对证照OFD版式文件的多任务转换，根据不同证照类型自定义清晰度，实现输入端为不同证照类型OFD版式文件，输出端对应输出相应证照类型的证照图片文件；该方法的实现包括：数据录入模块，用于完成证照OFD版式文件数据的输入；数据处理模块，包括用于并行处理数据的MapReduce并行处理子模块和用于OFD版式文件转轻量级图片的数据转换子模块；数据存储模块，用于转换完后的数据存储，包括数据保存和方法评价。2.根据权利要求1所述的一种证照OFD版式文件快速转图片的方法，其特征在于，所述数据录入模块完成数据录入的过程如下：、获取证照类型的证照类型代码；、根据证照类型代码获取证照的证照标识；、获取存储MONGDB数据的表名称以及表字段，并根据证照标识获取该类证照的证照版式文件的索引信息；、通过表结构中的索引字段完成数据文件流的读入；、将文件流转换为证照版式OFD文件存储到服务器。3.根据权利要求1或2所述的一种证照OFD版式文件快速转图片的方法，其特征在于，所述数据转换子模块实现OFD版式文件转轻量级图片的过程如下：、构建OFDReader类，完成OFD版式文件的读取；、构建Ofd2Img类，并完成数据转换类的初始化；、对ofd版式文件的每页文件进行遍历，使用Ofd2Img类完成数据文件的转换，并根据不同证照类型设置不同的dpi；、构建图片输出类ImageIO，完成对输出文件的保存，并关闭相关的文件流。4.根据权利要求3所述的一种证照OFD版式文件快速转图片的方法，其特征在于，所述MapReduce并行处理子模块包括map阶段和Reduce阶段，Map阶段是对任务的拆解阶段，包含多个map任务，Map阶段可以输入多个数据块，即分片，将多个电子证照版式文件同时作为一个数据块，每个map任务负责处理一个含有多个证照类型的电子证照版式文件的数据块：map任务收到含有电子版式文件分片数据后，默认把分片的每一个电子证照版式数据文件作为一条记录，完成每条记录的依次处理，最终输出多个含有录入电子证照版式文件以及输出轻量级图片数据的键值对；Reduce阶段是对结果的重新组合，按照设定者的需求完成数据重新输出，每个reduce任务处理能够处理绑定电子证照版式文件以及输出轻量级图片数据的键值对，对于同一类键值reduce阶段最终只输出一个结果；在进入Reduce阶段前，map任务产生的数据还要经过shuffle处理，实现包括分区、排序、合并操作；Reduce阶段完成后，结果输出到分布式文件存储系统上保存起来；所述reduce任务阶段的存在由项目需求而制定，可存在一个，或存在多个，或在某些特殊场景下，将该阶段省去。5.根据权利要求4所述的一种证照OFD版式文件快速转图片的方法，其特征在于，由于map任务把多个不同证照类型的OFD电子证照版式文件数据分片分成了多个记录，因此每个map任务都可能输出多个不同证照类型的OFD电子证照版式文件数据以及与其对应的轻量级电子证照图片的键值对，根据键是否相同，把这些键值对划分到不同电子证照类型：键相同，属于同一电子证照版式文件类型，键不同，则属于另一类电子证照版式文件类型；一类电子证照版式文件对应一类分区，一类分区则对应一个reduce任务，不同分区之间电子证照类型不同，每个reduce任务则对应了不同证照类型，各证照类型代码不同，则不同的证照类型数据则进入了不同的reduce任务，保证同一类键值对都送给了同一个reduce任务，完成数据的处理。6.根据权利要求4所述的一种证照OFD版式文件快速转图片的方法，其特征在于，所述数据保存的过程如下：、获取reduce步骤后的结果数据；、获取保存版式文件图片的mongdb配置信息；、将结果数据依次存入mongdb，并记录数据在mongdb图片库中的索引；、将索引存入数据库，方便数据的查询操作；、将产生的临时文件，包括源证照版式文件以及reduce产生的结果文件进行删除，释放空间。7.根据权利要求6所述的一种证照OFD版式文件快速转图片的方法，其特征在于，所述方法评价对reduce阶段产生的结果文件，每个证照类型按抽样检测的方法对结果数据进行检测，包括数据大小、数据的内容转换是否正常以及转换后的版式文件的图片是否清晰，并使用合格率、转换效率以及响应速度进行数据转换成果的评估。8.根据权利要求4所述的一种证照OFD版式文件快速转图片的方法，其特征在于，该方法的实现方式如下：、获取数据，首先根据电子证照附件索引数据表，能够完成电子证照OFD版式文件从MONGDB库中读取并存储到服务器上，并同时读取电子证照OFD版式文件所对应的电子证照类型代码，为MapReduce构建键值对提供基础数据支撑；、构建数据转换程序，并根据不同的证照类型完成不同DPI的设置，既保证转换结果的清晰度，也保证减小数据占用磁盘空间大小；、将转换程序融合到MapReduce多任务处理程序，完成数据的处理；、数据转换结果的入库以及临时文件的删除，将转换后的OFD版式文件存入mongdb，并将mongdb返回的索引数据入库，对转换前后的临时文件进行删除操作。9.一种证照OFD版式文件快速转图片的系统，其特征在于，基于MapReduce模块并行处理大规模数据集，采用MapReduce框架实现对证照OFD版式文件的多任务转换，根据不同证照类型自定义清晰度，实现输入端为不同证照类型OFD版式文件，输出端对应输出相应证照类型的证照图片文件；包括：数据录入模块，用于完成证照OFD版式文件数据的输入；数据处理模块，包括用于并行处理数据的MapReduce并行处理子模块和用于OFD版式文件转轻量级图片的数据转换子模块；数据存储模块，用于转换完后的数据存储，包括数据保存和方法评价；该系统通过权利要求1至8任一所述的方法实现证照OFD版式文件快速转图片。10.一种证照OFD版式文件快速转图片的装置，其特征在于，包括：至少一个存储器和至少一个处理器；所述至少一个存储器，用于存储机器可读程序；所述至少一个处理器，用于调用所述机器可读程序，执行权利要求1至8任一所述的方法。
说明书desc
技术领域本发明涉及电子证照OFD图片转换技术领域，具体地说是一种证照OFD版式文件快速转图片的方法、系统及装置。背景技术目前，电子证照OFD图片的提供基本都是在使用的时候，通过程序实时生成，在遇到较大的证照附件时需要一定的时间等待转换，在APP端加载耗时，影响客户体验。部分电子证照系统采用第三方转换接口，转换效率低，而且无法控制转换清晰度以及大小，并且容易出问题，排查问题较复杂，需要双方系统人员共同排查，耗时耗力，影响工作效率。OFD版式文件在第三方浏览器上展示需要插件，并且无法兼容所有的浏览器，另外，可通过购买相关服务完成OFD版式文件的展示，但是这大大增加了应用成本。发明内容本发明的技术任务是针对以上不足之处，提供一种证照OFD版式文件快速转图片的方法、系统及装置，能够在短时间完成大量OFD文件转轻量级图片的效果，对接系统也能够更方便快速地解析证照版式图片文件，促进了电子证照系统的应用服务水平。本发明解决其技术问题所采用的技术方案是：一种证照OFD版式文件快速转图片的方法，基于MapReduce模块并行处理大规模数据集，采用MapReduce框架实现对证照OFD版式文件的多任务转换，根据不同证照类型自定义清晰度，实现输入端为不同证照类型OFD版式文件，输出端对应输出相应证照类型的证照图片文件；该方法的实现包括：数据录入模块，用于完成证照OFD版式文件数据的输入；数据处理模块，包括用于并行处理数据的MapReduce并行处理子模块和用于OFD版式文件转轻量级图片的数据转换子模块；数据存储模块，用于转换完后的数据存储，包括数据保存和方法评价。本方法基于Hadoop的MapReduce模块完成多任务并行处理转换的机制，实现了对证照的版式文件快速转换，支持根据不同证照类型自定义清晰度参数，快速完成OFD版式文件的数据转换，能够大大提高版式文件相关接口的响应速度，提高用户使用体验。其中数据处理模块主要分为两部分：第一部分是数据转换子模块，即在不影响使用者阅读使用的前提下，将OFD版式文件转换为轻量级图片，这不仅节省了空间，也不会影响OFD版式文件的使用。另一部分是Hadoop MapReduce并行处理子模块，目前大多数电子证照系统很少考虑OFD版式文件在第三方对接的展示的问题，所以目前证照版式文件大都以OFD格式存在，每个地市项目证照数据一般在500万以上，省级项目则在几千万以上，有的项目甚至上亿。要完成证照OFD版式文件的快速转换，必须依靠强大的数据处理模型，多任务、多进程快速完成相应的版式文件数据处理。使用本方法进行OFD版式文件快速转图片，最终图片结果能够用于证照OFD版式文件共享与应用，方便了其他系统或者APP的对接。证照附件以轻量级的图片形式存在，能够有效地提高证照版式文件的共享接口的响应速度，能够促进证照版式文件共享与应用。优选的，所述数据录入模块完成数据录入的过程如下：、获取证照类型的证照类型代码；、根据证照类型代码获取证照的证照标识；、获取存储MONGDB数据的表名称以及表字段，并根据证照标识获取该类证照的证照版式文件的索引信息；、通过表结构中的索引字段完成数据文件流的读入；、将文件流转换为证照版式OFD文件存储到服务器。因为证照OFD文件数量多而且每个文件的大小以及总存储大小也不确定，而因MongoDB使用分片技术具有易扩展性、高性能实时的插入性以及存储动态性等，很多电子证照系统选择Mongdb对电子证照OFD版式文件进行存储。本方法中构建的电子证照OFD版式文件录入模块，可直接读取Mongdb中的数据，完成数据的录入。优选的，所述数据转换子模块实现OFD版式文件转轻量级图片的过程如下：、构建OFDReader类，完成OFD版式文件的读取；、构建Ofd2Img类，并完成数据转换类的初始化；、对ofd版式文件的每页文件进行遍历，使用Ofd2Img类完成数据文件的转换，并根据不同证照类型设置不同的dpi，既保证清晰度，也尽量减少转换后图片所占用磁盘空间；、构建图片输出类ImageIO，完成对输出文件的保存，并关闭相关的文件流。将服务器上的OFD版式文件进行转换,并完成数据从OFD版式文件到轻量级图片文件的转换。使得输出文件不仅包含OFD版式文件的所有信息，而且转换出的图片文件在保证清晰度的前提下，文件大小尽量小，能够尽可能地降低存储成本。优选的，所述MapReduce并行处理子模块包括map阶段和Reduce阶段，Map阶段是对任务的拆解阶段，包含多个map任务，Map阶段可以输入多个数据块，即分片，将多个电子证照版式文件同时作为一个数据块，每个map任务负责处理一个含有多个证照类型的电子证照版式文件的数据块：map任务收到含有电子版式文件分片数据后，默认把分片的每一个电子证照版式数据文件作为一条记录，完成每条记录的依次处理，最终输出多个含有录入电子证照版式文件以及输出轻量级图片数据的键值对；Reduce阶段是对结果的重新组合，按照设定者的需求完成数据重新输出，每个reduce任务处理能够处理绑定电子证照版式文件以及输出轻量级图片数据的键值对，对于同一类键值reduce阶段最终只输出一个结果；在进入Reduce阶段前，map任务产生的数据还要经过shuffle处理，实现包括分区、排序、合并操作；Reduce阶段完成后，结果输出到分布式文件存储系统上保存起来；所述reduce任务阶段的存在由项目需求而制定，可存在一个，或存在多个，或在某些特殊场景下，将该阶段省去。进一步的，由于map任务把多个不同证照类型的OFD电子证照版式文件数据分片分成了多个记录，因此每个map任务都可能输出多个不同证照类型的OFD电子证照版式文件数据以及与其对应的轻量级电子证照图片的键值对，根据键是否相同，把这些键值对划分到不同电子证照类型：键相同，属于同一电子证照版式文件类型，键不同，则属于另一类电子证照版式文件类型。因为map任务结束可能产生多个不同电子证照类型的键值对，不同的键值对通过分区处理并跟reduce任务进行匹配，一类电子证照版式文件则对应一类分区，一类分区则对应一个reduce任务，不同分区之间电子证照类型不同，每个reduce任务则对应了不同证照类型，他们的证照类型代码不同，则不同的证照类型数据则进入了不同的reduce任务，也保证同一类键值对都送给了同一个reduce任务，完成数据的处理。map任务的个数由输入OFD电子证照版式文件数据分片的个数决定，reduce任务的个数则可根据输入的证照类型数进行指定。分片是一个很灵活的量词，我们可以把它定义为一个文件，也可是一个文件的部分数据，本方法中指的是由若干不同证照类型组成的OFD电子证照版式数据文件。优选的，所述数据保存的过程如下：、获取reduce步骤后的结果数据；、获取保存版式文件图片的mongdb配置信息；、将结果数据依次存入mongdb，并记录数据在mongdb图片库中的索引；、将索引存入数据库，方便数据的查询操作；、将产生的临时文件，包括源证照版式文件以及reduce产生的结果文件进行删除，释放空间。进一步的，所述方法评价对reduce阶段产生的结果文件，每个证照类型按抽样检测的方法对结果数据进行检测，包括数据大小、数据的内容转换是否正常以及转换后的版式文件的图片是否清晰，并使用合格率、转换效率以及响应速度进行数据转换成果的评估。合格率是对于OFD版式文件数据转换轻量级图片结果准确率的评价指标，代表的是合格的样本与抽样样本总数的比值；当该比值较低时，则需要检测即数据大小合适、数据的内容转换正常以及转换后的版式文件的图片清晰这个三个方面的问题，针对不同的问题需要调整相应的逻辑提高相应的合格率。转换效率是对于OFD版式文件数据转换轻量级图片结果的转化速度的评价指标，即针对100万电子证照版式文件数据，使用本方法完成数据转换时间与电子证照系统普通方法转换的时间的比值。比值越小，说明转换速度越快。响应速度时针对转换后的数据，使用POSTMAN测试接口响应速度，若速度越快，代表接入的系统或APP响应速度越快。优选的，该方法的实现方式如下：、获取数据，首先根据电子证照附件索引数据表，能够完成电子证照OFD版式文件从MONGDB库中读取并存储到服务器上，并同时读取电子证照OFD版式文件所对应的电子证照类型代码，为MapReduce构建键值对提供基础数据支撑；、构建数据转换程序，并根据不同的证照类型完成不同DPI的设置，既保证转换结果的清晰度，也保证减小数据占用磁盘空间大小；、将转换程序融合到MapReduce多任务处理程序，完成数据的处理；、数据转换结果的入库以及临时文件的删除，将转换后的OFD版式文件存入mongdb，并将mongdb返回的索引数据入库，对转换前后的临时文件进行删除操作。本发明还要求保护一种证照OFD版式文件快速转图片的系统，基于MapReduce模块并行处理大规模数据集，采用MapReduce框架实现对证照OFD版式文件的多任务转换，根据不同证照类型自定义清晰度，实现输入端为不同证照类型OFD版式文件，输出端对应输出相应证照类型的证照图片文件；包括：数据录入模块，用于完成证照OFD版式文件数据的输入；数据处理模块，包括用于并行处理数据的MapReduce并行处理子模块和用于OFD版式文件转轻量级图片的数据转换子模块；数据存储模块，用于转换完后的数据存储，包括数据保存和方法评价；该系统通过上述的方法实现证照OFD版式文件快速转图片。本发明还要求保护一种证照OFD版式文件快速转图片的装置，包括：至少一个存储器和至少一个处理器；所述至少一个存储器，用于存储机器可读程序；所述至少一个处理器，用于调用所述机器可读程序，执行上述的方法。本发明的一种证照OFD版式文件快速转图片的方法、系统及装置与现有技术相比，具有以下有益效果：1、支持自定义电子证照版式文件输出清晰度，该方法中，用户可以根据每种证照类型的输出效果，动态调整dpi值，实现在保证转换图片清晰度的条件下，尽可能的降低内存空间占用，降低成本。2、对接入证照系统的其他应用系统或APP比较友好，成本低，以图片形式的方式展示证照附件内容，能够在短时间内完成数据对接，另外省去了购买OFD阅读器查看OFD版式文件的费用。3.提高其他应用或APP的响应速度，扩大电子证照的应用范围，以图片形式存储的证照附件，在大小上占据优势，由于省去了转换时间，在接口适配后的响应速度也快许多，提高用户的使用体验。4.能够快速完成几千万甚至上亿数据的转换，对于大量电子证照，本方法能够利用MapReduce的并行处理能力，快速完成数据转换任务。附图说明图1是本发明实施例提供的证照OFD版式文件快速转图片的方法中获取数据集的流程图；图2是本发明实施例提供的证照OFD版式文件快速转图片的方法中MapReduce作业的数据流示图；图3是本发明实施例提供的证照OFD版式文件快速转图片的方法中方法评估的流程图。具体实施方式《关于加快推进电子证照扩大应用领域和全国互通互认的意见》提出在今年底前基本建立全国一体化政务服务平台电子证照共享服务体系，实现企业和群众常用证照制发和应用的电子化，在全国范围内达到标准统一、互通互认。要不断加大电子证照的应用，电子证照系统内的电子证照版式文件也相应的会跟越来越多的系统或者APP进行对接， 为更好的实现电子证照的管理和应用，为对接系统提供更加高效、快捷的OFD版式图片文件的服务，很多电子证照系统的版式文件都以OFD方式存在，就需要能够在短时间完成大量OFD文件转轻量级图片的效果，使对接系统也能够更方便快速地解析证照版式图片文件。进一步促进电子证照系统的应用服务水平。基于以上所述，本发明实施例提供一种证照OFD版式文件快速转图片的方法，基于MapReduce模块并行处理大规模数据集，采用MapReduce框架实现对证照OFD版式文件的多任务转换，根据不同证照类型自定义清晰度，实现输入端为不同证照类型OFD版式文件，输出端对应输出相应证照类型的证照图片文件；本方法基于Hadoop的MapReduce模块完成多任务并行处理转换的机制，实现了对证照的版式文件快速转换，支持根据不同证照类型自定义清晰度参数，快速完成OFD版式文件的数据转换，能够大大提高版式文件相关接口的响应速度，提高用户使用体验。该方法的实现包括：数据录入模块，用于完成证照OFD版式文件数据的输入；数据处理模块，包括用于并行处理数据的MapReduce并行处理子模块和用于OFD版式文件转轻量级图片的数据转换子模块；数据存储模块，用于转换完后的数据存储，包括数据保存和方法评价。具体实现方式如下：1、数据录入模块构建电子证照OFD版式文件录入模块，因为证照OFD文件数量多而且每个文件的大小以及总存储大小也不确定，而因MongoDB使用分片技术具有易扩展性、高性能实时的插入性以及存储动态性等，很多电子证照系统选择Mongdb对电子证照OFD版式文件进行存储。本方法中构建的电子证照OFD版式文件录入模块，可直接读取Mongdb中的数据，完成数据的录入。所述数据录入模块完成数据录入的过程如下：、获取证照类型的证照类型代码；、根据证照类型代码获取证照的证照标识；、获取存储MONGDB数据的表名称以及表字段，并根据证照标识获取该类证照的证照版式文件的索引信息；、通过表结构中的索引字段完成数据文件流的读入；、将文件流转换为证照版式OFD文件存储到服务器。2、数据处理模块数据处理模块主要分为两部分：第一部分是数据转换子模块，即在不影响使用者阅读使用的前提下，将OFD版式文件转换为轻量级图片，这不仅节省了空间，也不会影响OFD版式文件的使用。另一部分是Hadoop MapReduce并行处理子模块，目前大多数电子证照系统很少考虑OFD版式文件在第三方对接的展示的问题，所以目前证照版式文件大都以OFD格式存在，每个地市项目证照数据一般在500万以上，省级项目则在几千万以上，有的项目甚至上亿。要完成证照OFD版式文件的快速转换，必须依靠强大的数据处理模型，多任务、多进程快速完成相应的版式文件数据处理。2.1、数据转换子模块将服务器上的OFD版式文件进行转换,并完成数据从OFD版式文件到轻量级图片文件的转换。使得输出文件不仅包含OFD版式文件的所有信息，而且转换出的图片文件在保证清晰度的前提下，文件大小尽量小，能够尽可能地降低存储成本。所述数据转换子模块实现OFD版式文件转轻量级图片的过程如下：、构建OFDReader类，完成OFD版式文件的读取；、构建Ofd2Img类，并完成数据转换类的初始化；、对ofd版式文件的每页文件进行遍历，使用Ofd2Img类完成数据文件的转换，并根据不同证照类型设置不同的dpi，既保证清晰度，也尽量减少转换后图片所占用磁盘空间；、构建图片输出类ImageIO，完成对输出文件的保存，并关闭相关的文件流。2.2、MapReduce并行处理子模块电子证照库版式文件量存储量巨大，为了快速处理完成大量ofd版式文件到轻量级图片的转换，本方法使用Hadoop MapReduce并行处理模块，MapReduce是一个分布式计算的软件框架，它由资源管理器、节点管理器和MapReduce ApplicationMaster组成。ResourceManager 对客户端暴露的地址。客户端通过该地址向RM提交应用程序，杀死应用程序等。NodeManager总的可用物理内存。注意，该参数是不可修改的，一旦设置，整个运行过程中不可动态修改。另外，该参数的默认值是8192MB。MRAM是应用服务器ApplicationMaster 的具体实例。YARN是一个通用的资源管理系统，完成资源管理与调节的统一调度，实现对上层应用的统一支撑。它是由资源管理器、节点管理器和应用服务器三个组件构成。YARN的设计理念是分离集群资源管理和作业调度/监控，RM完成整个集群的资源管理与调度，NM实现单个节点的资源管理，AM实现监控任务和调度作业，这三者相互密切联系，不可分割。综上，MR只是YARN的一种应用形式，因此，MR与YARN工作流程相同。MapReduce 的启动也会伴随MRAM进程的启动，该进程进一步结合资源管理器进行资源分配，并在资源管理器中完成各个子任务的启动、监控以及实时返回任务的执行状态，值得注意的是MR也具有独特性，在容器中执行的子任务是map或reduce中的一种，而且顺序也不能颠倒，map任务比reduce任务优先执行。所述MapReduce并行处理子模块包括map阶段和Reduce阶段。Map阶段是对任务的拆解阶段，包含多个map任务，Map阶段可以输入多个数据块，可同时将多个电子证照版式文件同时作为一个数据块，每个map任务负责处理一个含有多个证照类型的电子证照版式文件的数据块，处理方法都是按照2.1所述的程序即可。map任务收到含有电子版式文件分片数据后，默认把分片的每一个电子证照版式数据文件作为一条记录，完成每条记录的依次处理，最终输出多个含有录入电子证照版式文件以及输出轻量级图片数据的键值对；Reduce阶段是对结果的重新组合，按照设定者的需求完成数据重新输出，所述reduce任务阶段的存在由项目需求而制定，可存在一个，或存在多个，或在某些特殊场景下，将该阶段省去。每个reduce任务处理能够处理绑定电子证照版式文件以及输出轻量级图片数据的键值对，对于同一类键值reduce阶段最终只输出一个结果；在进入Reduce阶段前，map任务产生的数据还要经过shuffle处理，实现分区、排序、合并等操作；Reduce阶段完成后，结果输出到分布式文件存储系统上保存起来。MapReduce作业的数据流如图2所示：图中：Map阶段是以三个分片数据，每个分片数据是由多个OFD电子证照版式文件的录入组成，每个Map子任务在各自的分区进行OFD电子证照版式文件向轻量级图片数据的转换，经过shuffle阶段的分区、排序以及合并后执行reduce任务，这三个reduce任务分别负责每一个分区的数据，part1、part2以及part3即为最终结果的输出。map任务把含有多个证照类型的OFD版式文件分片分成了多个记录，由于map任务把多个不同证照类型的OFD电子证照版式文件数据分片分成了多个记录，因此每个map任务都可能输出多个不同证照类型的OFD电子证照版式文件数据以及与其对应的轻量级电子证照图片的键值对，根据键是否相同，可以把这些键值对划分到不同电子证照类型，键相同，属于同一电子证照版式文件类型，键不同，则属于另一类电子证照版式文件类型。因为map任务结束可能产生多个不同电子证照类型的键值对，不同的键值对通过分区处理并跟reduce任务进行匹配，一类电子证照版式文件则对应一类分区，一类分区则对应一个reduce任务，不同分区之间电子证照类型不同，每个reduce任务则对应了不同证照类型，他们的证照类型代码不同，则不同的证照类型数据则进入了不同的reduce任务，也保证同一类键值对都送给了同一个reduce任务，完成数据的处理。map任务的个数由输入OFD电子证照版式文件数据分片的个数决定，reduce任务的个数则可根据输入的证照类型数进行指定。分片是一个很灵活的量词，可以把它定义为一个文件，也可是一个文件的部分数据，但是在本方法中指的是由若干不同证照类型组成的OFD电子证照版式数据文件。3、数据存储模块3.1、数据保存，其过程如下：、获取步骤2中reduce步骤后的结果数据；、获取保存版式文件图片的mongdb配置信息；、将结果数据依次存入mongdb，并记录数据在mongdb图片库中的索引；、将索引存入数据库，方便数据的查询操作；、将产生的临时文件，包括源证照版式文件以及reduce产生的结果文件进行删除，释放空间。3.2、方法评价针对reduce阶段产生的结果文件，每个证照类型按抽样检测的方法对数据大小、数据的内容转换是否正常以及转换后的版式文件的图片是否清晰三个方面进行检测，并使用合格率、转换效率以及响应速度进行数据转换成果的评估。参考图3所示。合格率，用P表示。是关于该方法对于OFD版式文件数据转换轻量级图片结果准确率的评价指标，代表的是合格的样本与抽样样本总数的比值。定义公式如所示。P=TP/其中TP为合格样本数据的数量，FP为不合格样本的数量。若P值较低，则需要检测即数据大小合适、数据的内容转换正常以及转换后的版式文件的图片清晰这个三个方面的问题，针对不同的问题需要调整相应的逻辑提高相应的合格率。转换效率，用E表示。是关于该方法对于OFD版式文件数据转换轻量级图片结果的转化速度的评价指标，即针对100万电子证照版式文件数据，使用本方法完成数据转换时间与电子证照系统普通方法转换的时间的比值。定义公式如所示。E=T1/T2其中T1为本方法完成数据转换时间，T2为电子证照系统普通方法转换的时间。比值越小，说明转换速度越快。响应速度，用S表示,针对转换后的数据，使用POSTMAN测试接口响应速度，若速度越快，代表接入的系统或APP响应速度越快。定义公式如所示。E=T3/T4其中T3为本方法完成数据之后接口访问的时间，T4为电子证照系统实时转换接口访问的时间。比值越小，说明转换效果越明显，代表转换更具有意义。该方法的实现方式如下：、获取数据，首先根据电子证照附件索引数据表，能够完成电子证照OFD版式文件从MONGDB库中读取并存储到服务器上，并同时读取电子证照OFD版式文件所对应的电子证照类型代码，为MapReduce构建键值对提供基础数据支撑；、构建数据转换程序，并根据不同的证照类型完成不同DPI的设置，既保证转换结果的清晰度，也保证减小数据占用磁盘空间大小；、将转换程序融合到MapReduce多任务处理程序，完成数据的处理。对临时存储的文件以及所对应的证照类型代码进行map任务，完成对获取的所有证照OFD版式文件数据进行拆解，根据实际证照版式文件的证照类型数量完成map任务个数的制定，本方法中将多个不同证照类型的电子证照OFD版式文件同时作为一个数据块，每个map任务负责处理一个含有多个不同证照类型电子证照版式文件的数据片，处理方法都是按照2.1介绍的程序即可。map任务收到含有电子版式文件分片数据后，它默认会把分片的每一个电子证照版式数据文件作为一条记录，完成每条记录的依次处理，最终输出多个含有录入电子证照版式文件以及输出轻量级图片数据的键值对；Reduce阶段即是对转换后的证照版式文件结果的重新组合，每个reduce任务处理能够处理绑定电子证照版式文件以及输出轻量级图片数据的键值对，对于同一类键值reduce阶段最终只输出一种计算结果。、数据转换结果的入库以及临时文件的删除，将转换后的OFD版式文件存入mongdb，并将mongdb返回的索引数据入库，对转换前后的临时文件进行删除操作。使用本方法进行OFD版式文件快速转图片，最终图片结果能够用于证照OFD版式文件共享与应用，方便了其他系统或者APP的对接。证照附件以轻量级的图片形式存在，能够有效地提高证照版式文件的共享接口的响应速度，能够促进证照版式文件共享与应用。本发明实施例还提供一种证照OFD版式文件快速转图片的系统，基于MapReduce模块并行处理大规模数据集，采用MapReduce框架实现对证照OFD版式文件的多任务转换，根据不同证照类型自定义清晰度，实现输入端为不同证照类型OFD版式文件，输出端对应输出相应证照类型的证照图片文件；包括：数据录入模块，用于完成证照OFD版式文件数据的输入；数据处理模块，包括用于并行处理数据的MapReduce并行处理子模块和用于OFD版式文件转轻量级图片的数据转换子模块；数据存储模块，用于转换完后的数据存储，包括数据保存和方法评价；该系统通过上述实施例所述的证照OFD版式文件快速转图片的方法实现证照OFD版式文件快速转图片。1、数据录入模块，所述数据录入模块完成数据录入的过程如下：、获取证照类型的证照类型代码；、根据证照类型代码获取证照的证照标识；、获取存储MONGDB数据的表名称以及表字段，并根据证照标识获取该类证照的证照版式文件的索引信息；、通过表结构中的索引字段完成数据文件流的读入；、将文件流转换为证照版式OFD文件存储到服务器。2、数据处理模块，包括数据转换子模块和Hadoop MapReduce并行处理子模块：2.1、数据转换子模块将服务器上的OFD版式文件进行转换,并完成数据从OFD版式文件到轻量级图片文件的转换。使得输出文件不仅包含OFD版式文件的所有信息，而且转换出的图片文件在保证清晰度的前提下，文件大小尽量小，能够尽可能地降低存储成本。所述数据转换子模块实现OFD版式文件转轻量级图片的过程如下：、构建OFDReader类，完成OFD版式文件的读取；、构建Ofd2Img类，并完成数据转换类的初始化；、对ofd版式文件的每页文件进行遍历，使用Ofd2Img类完成数据文件的转换，并根据不同证照类型设置不同的dpi，既保证清晰度，也尽量减少转换后图片所占用磁盘空间；、构建图片输出类ImageIO，完成对输出文件的保存，并关闭相关的文件流。2.2、MapReduce并行处理子模块所述MapReduce并行处理子模块包括map阶段和Reduce阶段。Map阶段是对任务的拆解阶段，包含多个map任务，Map阶段可以输入多个数据块，可同时将多个电子证照版式文件同时作为一个数据块，每个map任务负责处理一个含有多个证照类型的电子证照版式文件的数据块，处理方法都是按照2.1所述的程序即可。map任务收到含有电子版式文件分片数据后，默认把分片的每一个电子证照版式数据文件作为一条记录，完成每条记录的依次处理，最终输出多个含有录入电子证照版式文件以及输出轻量级图片数据的键值对；Reduce阶段是对结果的重新组合，按照设定者的需求完成数据重新输出，所述reduce任务阶段的存在由项目需求而制定，可存在一个，或存在多个，或在某些特殊场景下，将该阶段省去。每个reduce任务处理能够处理绑定电子证照版式文件以及输出轻量级图片数据的键值对，对于同一类键值reduce阶段最终只输出一个结果；在进入Reduce阶段前，map任务产生的数据还要经过shuffle处理，实现分区、排序、合并等操作；Reduce阶段完成后，结果输出到分布式文件存储系统上保存起来。MapReduce作业的数据流如图2所示：图中：Map阶段是以三个分片数据，每个分片数据是由多个OFD电子证照版式文件的录入组成，每个Map子任务在各自的分区进行OFD电子证照版式文件向轻量级图片数据的转换，经过shuffle阶段的分区、排序以及合并后执行reduce任务，这三个reduce任务分别负责每一个分区的数据，part1、part2以及part3即为最终结果的输出。map任务把含有多个证照类型的OFD版式文件分片分成了多个记录，由于map任务把多个不同证照类型的OFD电子证照版式文件数据分片分成了多个记录，因此每个map任务都可能输出多个不同证照类型的OFD电子证照版式文件数据以及与其对应的轻量级电子证照图片的键值对，根据键是否相同，可以把这些键值对划分到不同电子证照类型，键相同，属于同一电子证照版式文件类型，键不同，则属于另一类电子证照版式文件类型。因为map任务结束可能产生多个不同电子证照类型的键值对，不同的键值对通过分区处理并跟reduce任务进行匹配，一类电子证照版式文件则对应一类分区，一类分区则对应一个reduce任务，不同分区之间电子证照类型不同，每个reduce任务则对应了不同证照类型，他们的证照类型代码不同，则不同的证照类型数据则进入了不同的reduce任务，也保证同一类键值对都送给了同一个reduce任务，完成数据的处理。map任务的个数由输入OFD电子证照版式文件数据分片的个数决定，reduce任务的个数则可根据输入的证照类型数进行指定。分片是一个很灵活的量词，可以把它定义为一个文件，也可是一个文件的部分数据，但是在本方法中指的是由若干不同证照类型组成的OFD电子证照版式数据文件。3、数据存储模块，包括数据保存和方法评价：3.1、数据保存，其过程如下：、获取步骤2中reduce步骤后的结果数据；、获取保存版式文件图片的mongdb配置信息；、将结果数据依次存入mongdb，并记录数据在mongdb图片库中的索引；、将索引存入数据库，方便数据的查询操作；、将产生的临时文件，包括源证照版式文件以及reduce产生的结果文件进行删除，释放空间。3.2、方法评价针对reduce阶段产生的结果文件，每个证照类型按抽样检测的方法对数据大小、数据的内容转换是否正常以及转换后的版式文件的图片是否清晰三个方面进行检测，并使用合格率、转换效率以及响应速度进行数据转换成果的评估。参考图3所示。合格率，用P表示。是关于该方法对于OFD版式文件数据转换轻量级图片结果准确率的评价指标，代表的是合格的样本与抽样样本总数的比值。定义公式如所示。P=TP/其中TP为合格样本数据的数量，FP为不合格样本的数量。若P值较低，则需要检测即数据大小合适、数据的内容转换正常以及转换后的版式文件的图片清晰这个三个方面的问题，针对不同的问题需要调整相应的逻辑提高相应的合格率。转换效率，用E表示。是关于该方法对于OFD版式文件数据转换轻量级图片结果的转化速度的评价指标，即针对100万电子证照版式文件数据，使用本方法完成数据转换时间与电子证照系统普通方法转换的时间的比值。定义公式如所示。E=T1/T2其中T1为本方法完成数据转换时间，T2为电子证照系统普通方法转换的时间。比值越小，说明转换速度越快。响应速度，用S表示,针对转换后的数据，使用POSTMAN测试接口响应速度，若速度越快，代表接入的系统或APP响应速度越快。定义公式如所示。E=T3/T4其中T3为本方法完成数据之后接口访问的时间，T4为电子证照系统实时转换接口访问的时间。比值越小，说明转换效果越明显，代表转换更具有意义。具体实现方式如下：、获取数据，首先根据电子证照附件索引数据表，能够完成电子证照OFD版式文件从MONGDB库中读取并存储到服务器上，并同时读取电子证照OFD版式文件所对应的电子证照类型代码，为MapReduce构建键值对提供基础数据支撑；、构建数据转换程序，并根据不同的证照类型完成不同DPI的设置，既保证转换结果的清晰度，也保证减小数据占用磁盘空间大小；、将转换程序融合到MapReduce多任务处理程序，完成数据的处理。对临时存储的文件以及所对应的证照类型代码进行map任务，完成对获取的所有证照OFD版式文件数据进行拆解，根据实际证照版式文件的证照类型数量完成map任务个数的制定，本方法中将多个不同证照类型的电子证照OFD版式文件同时作为一个数据块，每个map任务负责处理一个含有多个不同证照类型电子证照版式文件的数据片，处理方法都是按照2.1介绍的程序即可。map任务收到含有电子版式文件分片数据后，它默认会把分片的每一个电子证照版式数据文件作为一条记录，完成每条记录的依次处理，最终输出多个含有录入电子证照版式文件以及输出轻量级图片数据的键值对；Reduce阶段即是对转换后的证照版式文件结果的重新组合，每个reduce任务处理能够处理绑定电子证照版式文件以及输出轻量级图片数据的键值对，对于同一类键值reduce阶段最终只输出一种计算结果。、数据转换结果的入库以及临时文件的删除，将转换后的OFD版式文件存入mongdb，并将mongdb返回的索引数据入库，对转换前后的临时文件进行删除操作。本系统基于Hadoop的MapReduce模块完成多任务并行处理转换的机制，实现了对证照的版式文件快速转换，支持根据不同证照类型自定义清晰度参数，快速完成OFD版式文件的数据转换，能够大大提高版式文件相关接口的响应速度，提高用户使用体验。Hadoop是Apache开发的分布式系统基础架构。用户可在该架构下开发分布式程序。并且能够利用集群进行高速运算和存储。Hadoop实现了一个分布式文件系统，以HDFS为代表。HDFS有高容错性的特点，并且可部署在低廉的硬件上；而且可提供高吞吐量访问应用程序的数据，Hadoop的框架最核心的设计就是：HDFS和MapReduce。HDFS为海量的数据提供了存储，而MapReduce则为海量的数据提供了计算。本发明实施例还提供一种证照OFD版式文件快速转图片的装置，包括：至少一个存储器和至少一个处理器；所述至少一个存储器，用于存储机器可读程序；所述至少一个处理器，用于调用所述机器可读程序，执行上述实施例所述的证照OFD版式文件快速转图片的方法。通过上面具体实施方式，所述技术领域的技术人员可容易的实现本发明。但是应当理解，本发明并不限于上述的具体实施方式。在公开的实施方式的基础上，所述技术领域的技术人员可任意组合不同的技术特征，从而实现不同的技术方案。除说明书所述的技术特征外，均为本专业技术人员的已知技术。
