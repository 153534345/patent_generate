标题title
一种视频流图像自适应增强方法和系统
摘要abst
本发明公开了一种视频流图像自适应增强方法和系统，所述方法包括：获取输入的原始视频数据，对原始视频数据的每一帧图像转换成YUV格式，得到原始图像；将转换格式后的图像进行滤波处理，得到滤波图像，根据所述滤波图像和转换成YUV格式原始图像的yin分量计算得到选择判断参数；设置控制参数，根据所述控制参数和滤波图像计算得到细纹理增强参数，并通过所述细纹理增强参数控制处理得到小局部处理的第一增强结果图像；计算得到大局部处理的第二增强结果图像；将所述第一增强结果图像和第二增强结果图像作用到原始图像中进行筛选，根据运动差量和筛选结果得到最终输出数据。
权利要求书clms
1.一种视频流图像自适应增强方法，其特征在于，所述方法包括：获取输入的原始视频数据，对原始视频数据的每一帧图像转换成YUV格式，得到原始图像；将转换格式后的原始图像进行滤波处理，得到滤波图像，根据所述滤波图像和转换成YUV格式原始图像的yin分量计算得到选择判断参数；设置控制参数，根据所述控制参数和滤波图像计算得到细纹理增强参数，并通过所述细纹理增强参数控制处理得到小局部处理的第一增强结果图像；将所述原始图像进行下采样，下采样后扩展至原图得到第一扩展图，根据所述第一扩展图和原始图像的yin分量计算得到大局部处理的第二增强结果图像；将所述第一增强结果图像和第二增强结果图像作用到原始图像中进行筛选，并计算当前帧上下帧的运动差量，根据所述运动差量和筛选结果得到最终输出数据。2.根据权利要求1所述的一种视频流图像自适应增强方法，其特征在于，所述滤波处理的方法包括：构建第一滤波器，将原始图像yin分量数据和第一滤波器进行矩阵滤波，得到第一滤波图像，将原始图像和所述第一滤波矩阵相减得到第一滤波结果图像。3.根据权利要求2所述的一种视频流图像自适应增强方法，其特征在于，构建第二滤波器，将所述第二滤波器对所述第一滤波图像进行矩阵滤波，得到第二滤波图像，将所述第一滤波图像减去所述第二滤波图像，得到最终的滤波图像，滤波图像均以矩阵形式存在。4.根据权利要求3所述的一种视频流图像自适应增强方法，其特征在于，所述选择判断参数的计算方法包括：根据所述第一滤波图像和原始图像，采用如下公式计算得到：；其中yf1表示第一滤波图像，yin表示原始图像的yin分量，第一滤波图像和原始图像的yin分量均以矩阵形式存在，abs取绝对值计算，yk表示选择判断参数。5.根据权利要求4所述的一种视频流图像自适应增强方法，其特征在于，所述第一增强结果图像的计算过程还包括：计算第一增强过程中的处理过程量：；其中Ydf表示过程处理量，fix表示四舍五入取整计算，yd2表示第二滤波结果图像，yd1表示第一滤波结果图像。6.根据权利要求5所述的一种视频流图像自适应增强方法，其特征在于，设置控制参量，并通过所述控制参量控制所述处理过程量的处理效果，通过所述控制参量计算纹理增强参数wt，所述纹理增强参数的计算公式为：；其中str为设置的控制参量，进一步采用如下公式进行控制：；Ydf1为中间过程量，ydf1out为最终输出的所述第一增强结果图像。7.根据权利要求6所述的一种视频流图像自适应增强方法，其特征在于，所述第二增强结果图像的计算方法包括：计算原始图像的下采样图像，并将下采样图像扩展至原图大小得到第一扩展图像yup3，通过如下公式计算第二增强结果图像：；其中yout3为第二增强结果图像。8.根据权利要求7所述的一种视频流图像自适应增强方法，其特征在于，所述将第一增强结果图像和第二增强结果图像作用到原始图像中进行筛选计算方法包括：;;其中youtf为筛选中间过程量，movdiffk为运动误差，yout为两次增强后最终的输出数据，其中所述运动误差的计算方法包括：；上一帧下采样单帧数据为ydowninpre，sum为加权图像矩阵所有矩阵内像素值，ydownin为对原始图像进行下采样的图像。9.一种视频流图像自适应增强系统，其特征在于，所述系统执行权利要求1-8中任意一项所述的一种视频流图像自适应增强方法。10.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质存储有计算机程序，所述计算机程序可被处理器执行权利要求1-8中任意一项所述的一种视频流图像自适应增强方法。
说明书desc
技术领域本发明涉及一种视频处理技术领域，特别涉及一种视频流图像自适应增强方法和系统。背景技术视频流的各处理流程中，原始数据是一个清晰度差、对比度差的视频流，这时候往往要通过现有的数据，计算出处理方式，然后处理视频流，在经过一定的调试，恢复视频流数据呈现为人眼差不多的状态,该过程为图像增强或叫做图像重建。然而现有的视频流图像增强方法逻辑上存在一定漏洞，即没有掌握视频流本身的规律来进行处理，其二，缺少真正稳定可靠的图像增强手段与参数，一旦场景，图像处理增益变换其一，很容易参数不适应，导致图像恢复重建不完全，闪烁巨大。发明内容本发明其中一个发明目的在于提供一种视频流图像自适应增强方法和系统，所述方法和系统通过小局部增强和大局部增强的两种方式作用在视频流原图上，因此使得图像增强可以从不同的局部和整体对视频图像进行自适应控制，从而提高视频图像的处理效果。本发明另一个发明目的在于提供一种视频流图像自适应增强方法和系统，所述方法和系统在图像处理过程中无需配置复杂的参数，且无需设置截断阈值，从而可以有效地避免图像增强过程中的增益变化导致的参数不适应问题，有效地提高图像增强的稳定性。本发明另一个发明目的在于提供一种视频流图像自适应增强方法和系统，所述方法和系统的整个图像增强过程中可以有效地根据视频图像信息和图像之间的规律作出适应性地参数调整和计算，因此可以有效地提高图像增强的适应性。为了实现至少一个上述发明目的，本发明进一步提供一种视频流图像自适应增强方法，所述方法包括：获取输入的原始视频数据，对原始视频数据的每一帧图像转换成YUV格式，得到原始图像；将转换格式后的原始图像进行滤波处理，得到滤波图像，根据所述滤波图像和转换成YUV格式原始图像的yin分量计算得到选择判断参数；设置控制参数，根据所述控制参数和滤波图像计算得到细纹理增强参数，并通过所述细纹理增强参数控制处理得到小局部处理的第一增强结果图像；将所述原始图像进行下采样，下采样后扩展至原图得到第一扩展图，根据所述第一扩展图和原始图像的yin分量计算得到大局部处理的第二增强结果图像；将所述第一增强结果图像和第二增强结果图像作用到原始图像中进行筛选，并计算当前帧上下帧的运动差量，根据所述运动差量和筛选结果得到最终输出数据。根据本发明其中一个较佳实施例，所述滤波处理的方法包括：构建第一滤波器，将原始图像yin分量数据和第一滤波器进行矩阵滤波，得到第一滤波图像，将原始图像和所述第一滤波矩阵相减得到第一滤波结果图像。根据本发明另一个较佳实施例，构建第二滤波器，将所述第二滤波器对所述第一滤波图像进行矩阵滤波，得到第二滤波图像，将所述第一滤波图像减去所述第二滤波图像，得到最终的滤波图像。根据本发明另一个较佳实施例，所述选择判断参数的计算方法包括：根据所述第一滤波图像和原始图像，采用如下公式计算得到：；其中yf1表示第一滤波图像，yin表示原始图像的yin分量，第一滤波图像和原始图像的yin分量均以矩阵形式存在，abs取绝对值计算，yk表示选择判断参数。根据本发明另一个较佳实施例，所述第一增强结果图像的计算过程还包括：计算第一增强过程中的处理过程量：；其中Ydf表示处理过程量，fix表示四舍五入取整计算，yd2表示第二滤波结果图像，yd1表示第一滤波结果图像，255表示最大的像素值，256表示总像素值个数。根据本发明另一个较佳实施例，设置控制参量，并通过所述控制参量控制所述处理过程量的处理效果，通过所述控制参量计算纹理增强参数wt，所述纹理增强参数的计算公式为：；其中str为设置的控制参量，进一步采用如下公式进行控制：；Ydf1为中间过程量，ydf1out为最终输出的所述第一增强结果图像。根据本发明另一个较佳实施例，所述第二增强结果图像的计算方法包括：计算原始图像的下采样图像，并将下采样图像扩展至原图大小得到第一扩展图像yup3，通过如下公式计算第二增强结果图像：；其中yout3为第二增强结果图像。根据本发明另一个较佳实施例，所述将第一增强结果图像和第二增强结果图像作用到原始图像中进行筛选计算方法包括：;;其中youtf为筛选中间过程量，movdiffk为运动误差，yout为两次增强后最终的输出数据，其中所述运动误差的计算方法包括：；上一帧下采样单帧数据为ydowninpre，sum为加权图像矩阵所有矩阵内像素值，ydownin为对原始图像进行下采样的图像。为了实现至少一个上述发明目的，本发明进一步提供一种视频流图像自适应增强系统，所述系统执行上述一种视频流图像自适应增强方法。本发明进一步提供一种计算机可读存储介质，所述计算机可读存储介质存储有计算机程序，所述计算机程序可被处理器执行上述一种视频流图像自适应增强方法。附图说明图1显示的是本发明一种视频流图像自适应增强方法的流程示意图。图2显示的是未经过本发明图像增强的视频帧原图。图3显示的是经过本发明图像增强处理的视频帧图。具体实施方式以下描述用于揭露本发明以使本领域技术人员能够实现本发明。以下描述中的优选实施例只作为举例，本领域技术人员可以想到其他显而易见的变型。在以下描述中界定的本发明的基本原理可以应用于其他实施方案、变形方案、改进方案、等同方案以及没有背离本发明的精神和范围的其他技术方案。可以理解的是，术语“一”应理解为“至少一”或“一个或多个”，即在一个实施例中，一个元件的数量可以为一个，而在另外的实施例中，该元件的数量可以为多个，术语“一”不能理解为对数量的限制。请参考图1，本发明公开了一种视频流图像自适应增强方法和系统。其中所述方法主要包括如下步骤：首先需要对获取的视频流进行格式转换，传统输入的视频流通常为RGB格式，将所述RGB格式的视频流分解成单帧的RGB图像，进一步将所述单帧的RGB图像转换为YUV格式的图像，先提取所述yin分量的数据进行处理，值得一提的是，本发明中yin分量是一种在RGB图像上的灰度分量，本发明以默认的8bit位宽进行如下的将RGB格式转换成YUV格式的处理过程：；其中上述公式中RGB字母含义为原始图像对应三原色中的像素值。本发明中所称的图像计算方式为图像的像素在系统中对应格式的数据的计算，图像矩阵中数据计算是针对像素值进行的相关计算。按照上述公式当将视频每一帧RGB格式转换成YUV格式，将所述YUV格式的视频帧作为原始图像进行第一阶段的图像增强处理，所述第一阶段的图像增强处理方法包括：首先构建第一滤波器vf1，采用所述原始图像的yin分量数据和所述第一滤波器进行矩阵滤波得到第一滤波图像yf1，进一步将原始图像的yin分量数据减去所述第一滤波图像yf1得到第一滤波结果图像yd1，其中所述第一滤波器vf1矩阵可以举例设置为：；其中第一滤波结果图像的计算方法为：。进一步构建第二滤波器vf2，利用所述第二滤波器vf2对所述第一滤波图像yf1进行矩阵滤波，得到第二滤波图像yf2，进一步根据所述第一滤波图像yf1和第二滤波图像yf2得到第二滤波结果图像yd2:。进一步设置选择判断参数yk，采用如下公式计算所述选择判断参数yk:;其中abs表示取绝对值计算。进一步采用如下公式计算第一图像增强阶段的中间过程处理量Ydf：；其中fix表示四舍五入取整计算，*为乘法。在完成所述中间过程量Ydf计算后，进一步设置控制参数str，其中所述控制参数用于调控所述中间过程处理量Ydf效果，所述控制参数str默认值为512。进一步采用如下公式计算细纹理增强参数wt，其中所述细纹理增强参数wt为第一增强图像阶段的中间过程量。进一步采用如下公式进行控制处理：；其中Ydf1为中间过程变量，Ydf1out为第一阶段输出的第一增强结果图像。在完成上述第一阶段的图像增强后，进一步执行第二阶段图像增强操作，其中首先需要对所述原始图像的yin分量进行下采样，本发明中所述下采样可以优选采用64*64的图像块，进一步将下采样得到的图像标记为ydownin，将所述下采样图像ydownin扩展至原图大小，得到第一扩展图像yup3。需要说明的是，所述下采样算法为现有算法，本发明不再对下采样算法进行详细描述，并且所述上述下采样图像块大小可以根据不同视频大小进行适配性更改。由于整个处理过程处理的是视频流，视频流为多帧，记前一帧处理到这里的下采样单帧数据为ydowninpre，ydowninpre为上一帧的计算结果，并在不断的迭代更新，并计算运动误差。其中所述运动误差的计算公式如下：；其中movdiffk为所述运动误差，sum为加权图像矩阵所有矩阵内像素值，abs为取绝对值，上述任意公式中max表示取最大值，min表示取最小值。进一步将第一图像增强阶段的第一滤波结果图像yd1进行下采样，并采用上述相同大小64*64的图像块进行下采样，并采用相同的下采样算法得到另一个下采样图像ydown3，进一步将所述下采样图像ydown3扩展到原图大小，得到第二扩展图像yup3。进一步采用上述第一扩展图像yup3和原始图像yin分量计算第二增强结果图像：；其中所述第二增强结果图像为大局部增强处理，可以提升图像的通透性和对比度，其中yout3为第二增强结果图像。进一步利用所述第二增强结果图像yout3和第一增强结果图像Ydf1out进行yd1的处理结果进行结果筛选：；上述结果结果筛选使得大局部控制和小局部控制一起作用在原图上，并进行选择筛选。上述筛选方法使得大致物体边界处更偏向小局部控制，在物体中间更偏向用大局部控制。进一步根据之前计算得到的运动误差movdiffk计算得到第二增强阶段的最终输出数据yout：。需要说明的是，上述最终输出数据yout为原始图像yin分量上的数据，因此输出完整的增强图像还需要根据所述最终输出数据yout对原始图像的u分量和v分量进行处理，其中处理方法包括：；经过上述计算得到了完整的图像自适应增强后的数据yout、u1和v1后，进一步将上述图像自适应增强后的数据进行格式转换，对每一帧图像增强后的YUV格式图像按照如下公式转换为RGB格式：；其中Rout、Gout和Bout分别为图像增强后各个分量的输出数据，从而可以在显示器输出完整的增强图像数据。请结合图2和图3，其中图2是未进行上述完整步骤图像增强的RGB图像，图3是经过上述完整步骤图像增强的RGB图像，很明显图3的通透度和清晰度比图2更好，因此上述完整步骤的图像增强技术效果是明显的。特别地，根据本发明公开的实施例，上文参考流程图描述的过程可以被实现为计算机软件程序。例如，本公开的实施例包括一种计算机程序产品，其包括承载在计算机可读介质上的计算机程序，该计算机程序包含用于执行流程图所示的方法的程序代码。在这样的实施例中，该计算机程序可以通过通信部分从网络上被下载和安装，和/或从可拆卸介质被安装。在该计算机程序被中央处理单元执行时，执行本申请的方法中限定的上述功能。需要说明的是，本申请上述的计算机可读介质可以是计算机可读信号介质或者计算机可读存储介质或者是上述两者的任意组合。计算机可读存储介质例如可以是但不限于电、磁、光、电磁、红外线段、或半导体的系统、装置或器件，或者任意以上的组合。计算机可读存储介质的更具体的例子可以包括但不限于：具有一个或多个导线段的电连接、便携式计算机磁盘、硬盘、随机访问存储器、只读存储器、可擦式可编程只读存储器、光纤、便携式紧凑磁盘只读存储器、光存储器件、磁存储器件、或者上述的任意合适的组合。在本申请中，计算机可读存储介质可以是任何包含或存储程序的有形介质，该程序可以被指令执行系统、装置或者器件使用或者与其结合使用。而在本申请中，计算机可读的信号介质可以包括在基带中或者作为载波一部分传播的数据信号，其中承载了计算机可读的程序代码。这种传播的数据信号可以采用多种形式，包括但不限于电磁信号、光信号或上述的任意合适的组合。计算机可读的信号介质还可以是计算机可读存储介质以外的任何计算机可读介质，该计算机可读介质可以发送、传播或者传输用于由指令执行系统、装置或者器件使用或者与其结合使用的程序。计算机可读介质上包含的程序代码可以用任何适当的介质传输，包括但不限于：无线段、电线段、光缆、RF等等，或者上述的任意合适的组合。附图中的流程图和框图，图示了按照本发明各种实施例的系统、方法和计算机程序产品的可能实现的体系架构、功能和操作。在这点上，流程图或框图中的每个方框可以代表一个模块、程序段、或代码的一部分，该模块、程序段、或代码的一部分包含一个或多个用于实现规定的逻辑功能的可执行指令。也应当注意，在有些作为替换的实现中，方框中所标注的功能也可以以不同于附图中所标注的顺序发生。例如，两个接连地表示的方框实际上可以基本并行地执行，它们有时也可以按相反的顺序执行，这依所涉及的功能而定。也要注意的是，框图和/或流程图中的每个方框、以及框图和/或流程图中的方框的组合，可以用执行规定的功能或操作的专用的基于硬件的系统来实现，或者可以用专用硬件与计算机指令的组合来实现。本领域的技术人员应理解，上述描述及附图中所示的本发明的实施例只作为举例而并不限制本发明，本发明的目的已经完整并有效地实现，本发明的功能及结构原理已在实施例中展示和说明，在没有背离所述原理下，本发明的实施方式可以有任何变形或修改。
