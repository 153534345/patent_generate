标题title
基于改进的椭圆拟合优化算法测量锻件倾斜度的方法
摘要abst
本发明涉及基于改进的椭圆拟合优化算法测量锻件倾斜度的方法，属于锻件关键几何量检测技术领域，包括距离数据的采集并进行坐标变换、筛选样本点、通过正交几何距离模型利用PSO算法拟合椭圆、利用拟合椭圆中心拟合锻件在三维空间上的中轴线并计算倾斜度。本发明通过随机划分区域选取样本点及加权分位数筛选消除异常值簇对拟合结果的干扰并节省算力；通过构建正交几何距离残差模型可以消除高曲率偏差问题，且可获得更好的逼近效果；通过改进的PSO算法拟合椭圆获得精确度、稳定度更高的拟合椭圆；在‑3°~3°范围内的测量误差均小于0.05°，满足锻件倾斜度的测量要求。
权利要求书clms
1.基于改进的椭圆拟合优化算法测量锻件倾斜度的方法，其特征在于：包括如下步骤：步骤1：控制步进电机运动带动螺旋丝杆，使被测锻件的旋转轴心对准转轴，激光测距仪达到测量位置；步骤2：计算机驱动激光测距仪和伺服电机同时启动，测得激光测距仪与被测锻件表面间的动态距离di；步骤3：控制计算机的系统装置对距离信息进行坐标变换、样本点筛选，剔除异常值的影响后，对筛选后的点进行椭圆拟合，具体步骤为：步骤31：激光测距仪每次转过的角度记为θ0，则激光测距仪在某一位置转过的角度θ为kθ0，k表示激光测距仪扫过的第k个点，第k点的位置坐标，即被测锻件轮廓样本点坐标为：xk＝·cosθyk＝·sinθ式中：L表示激光测距仪至旋转中心的距离，d表示激光测距仪至被测锻件表面的距离；步骤32：对所述步骤31获得的被测锻件被测截面轮廓样本点进行随机区域划分，每次随机均匀分成6个区域，并从每个区域中随机选取一个样本点，对所选取的样本点进行直接代数拟合，直接代数拟合所表示的椭圆方程为：Ax2+Bxy+Cy2+Dx+Ey+F＝0遍历所有样本点，构建正交几何距离残差模型，并以该模型为依据进行加权分位数筛选，保存符合条件的正交几何残差所对应的样本点；步骤33：根据所述步骤32中正交几何距离残差模型的定义，将目标椭圆参数的问题被转化为求解非线性目标函数的问题，设置拟合椭圆与步骤32所选取的样本点的最小正交几何距离残差为目标函数，椭圆由模型向量u表征，具体为：u＝t式中：为椭圆中心，a为长轴，b为短轴，α为长轴a与X正半轴的夹角；满足约束条件为：C1:a,b∈R+C2:b≤aC3:θc∈t表示椭圆参数。3.根据权利要求1所述的基于改进的椭圆拟合优化算法测量锻件倾斜度的方法，其特征在于，所述步骤32中的椭圆正交几何距离残差模型建立过程为：从一个通用椭圆的几何方程开始，该椭圆的半主轴长度为a，半次轴长度为b，方向角α，中心，椭圆方程的几何表示具体为：为减小求取正交点时所需的计算量，在拟合坐标系内建立新的局部坐标系，两坐标系的变换关系用旋转矩阵和平移向量表示：式中，平移向量中的Xc,Yc表示椭圆在拟合坐标系下的圆心坐标，以上参数均由迭代的初值所提供；在局部坐标系中，椭圆的方程表示为：在正交点的切线方程表示为：由此可得局部坐标系下，正交几何残差模型可以写为：4.根据权利要求1所述的基于改进的椭圆拟合优化算法测量锻件倾斜度的方法，其特征在于，所述步骤32中的样本点筛选方法为：用加权分位数法筛选所述步骤32中的样本点，遍历样本点，在数组num_index中记录每组样本点对应的正交几何残差平方和G，表示为：式中，X代表数据点在拟合坐标系中的坐标，f代表获得数据点到椭圆的正交距离的非线性函数；将这些数值由小到大排列，注意排列后的数值为：G≤G≤...≤G式中，G代表第k组对应的G值；要预先计算p只需找到k，使则x＜ξp＜x，当出现异常数值时，所选点的p分位数不会改变，导致阈值不准确，所选点的质量较差；为了提取所选点的质量，减少异常值对不良拟合效果的影响，在最高百分位数的基础上增加一个权重函数，表示为：ξp＝-w'k·x)+w'k·x式中，加权代数距离的平方之和表示为：式中，α代表重量系数，决定公式具体为：在数组best_ellipse_par中存储所有步骤32中样本点所对应的G满足G＜ξp条件的样本点坐标。5.根据权利要求4所述的基于改进的椭圆拟合优化算法测量锻件倾斜度的方法，其特征在于，所述步骤33中的目标函数建立方法为：根据几何拟合算法对误差距离的定义，对数组best_ellipse_par的样本点求解目标椭圆参数的问题被转化为求解非线性目标函数的问题，具体为：式中，X代表数据点在拟合坐标系中的坐标，f代表获得数据点到椭圆的正交距离的非线性函数，u代表待求椭圆方程的参数，min代表目标函数，即所求G的最小值。6.根据权利要求5所述的基于改进的椭圆拟合优化算法测量锻件倾斜度的方法，其特征在于，所述椭圆目标函数min能够通过所述步骤33中粒子群优化算法求取椭圆由模型向量u；在PSO算法中，每个粒子可以更新其速度和位置：式中，i是粒子指数；j是维度指数；pbest和gbest的适配值是变量的惯性权重和加速系数；k是当前迭代数；c1和c2是加速常数；r1和r2是符合范围内偶数分布的随机数；w是惯性权重系数，它具有权衡全局和局部搜索能力的能力，其数值如下所示：更新粒子的位置x和速度v继续进行，直到达到所要求的最小不匹配。停止更新这两个值的标准是基于最大的迭代次数或要求的计算精度。
说明书desc
技术领域本发明涉及基于改进的椭圆拟合优化算法测量锻件倾斜度的方法，属于锻件关键几何量检测技术领域。背景技术通过锻造技术生产的零部件已广泛应用于冶金、航空航天、兵器装备、交通运输等多个领域，其中，长轴类锻件常用于转动机构的转动轴或连接轴，如船用螺旋桨轴、核电半速转子等，圆环类锻件常用于转动部件或固定部件，如车船轮毂、蒸发罐底座等。墩粗和冲孔是柱状或环状的锻件在锻造过程中的重要工序，镦粗杆或穿孔针和锻件胚料之间的位置姿态将对加工质量产生很大影响。目前，光学技术在锻件几何量测量中应用较为广泛，可以分为机器视觉法和激光扫描法。对于机器视觉方法，一方面可以通过CCD直接获取锻件侧面图像，经图像处理后确定锻件尺寸，然而这种方法易受测量环境噪声的影响；另一方面可利用CCD获取投射到锻件表面的线激光图像，文献《Spectral selective and difference imaging lasertriangulation measurement system for on line measurement of large hotworkpieces in precision open die forging》通过投射到工件表面的绿色条形激光获取工件截面，进而求解出锻件的直径；《基于绿激光图像识别的热态大型锻件长度尺寸测量》则首先获取了绿色条形激光图像，然后由多段点云数据拟合得到热态圆柱体锻件的圆周曲线。对于激光扫描方法，可以通过旋转平台或伺服电机带动激光测距仪完成对点云数据的获取，进而由点云数据重构被测件的三维图像。尽管上述检测技术的应用已经进行了有关锻件尺寸测量的研究，但对于锻件倾斜度的测量研究仍处于起步阶段。发明内容本发明的目的是提供一种基于改进的椭圆拟合优化算法测量锻件倾斜度的方法，坐标变换实现被测截面轮廓的可视化，并结合随机方法对样本点进行筛选，利用PSO算法对拟合椭圆的几何参数模型进行求解，从拟合椭圆的中心点得到锻件中心轴的三维线性方程，并从线性方程计算出锻件的倾斜角。避免了异常值对于测量的影响，提高了计算效率和精度，更方便、快捷、准确的测得锻件倾斜度。为了实现上述目的，本发明采用的技术方案是：一种基于改进的椭圆拟合优化算法测量锻件倾斜度的方法，包括如下步骤：步骤1：控制步进电机运动带动螺旋丝杆，使被测锻件的旋转轴心对准转轴，激光测距仪达到测量位置；步骤2：计算机驱动激光测距仪和伺服电机同时启动，测得激光测距仪与被测锻件表面间的动态距离di；步骤3：控制计算机的系统装置对距离信息进行坐标变换、样本点筛选，剔除异常值的影响后，对筛选后的点进行椭圆拟合，具体步骤为：步骤31：激光测距仪每次转过的角度记为θ0，则激光测距仪在某一位置转过的角度θ为kθ0，k表示激光测距仪扫过的第k个点，第k点的位置坐标，即被测锻件轮廓样本点坐标为：xk＝·cosθyk＝·sinθ式中：L表示激光测距仪至旋转中心的距离，d表示激光测距仪至被测锻件表面的距离；步骤32：对所述步骤31获得的被测锻件被测截面轮廓样本点进行随机区域划分，每次随机均匀分成6个区域，并从每个区域中随机选取一个样本点，对所选取的样本点进行直接代数拟合，直接代数拟合所表示的椭圆方程为：Ax2+Bxy+Cy2+Dx+Ey+F＝0遍历所有样本点，构建正交几何距离残差模型，并以该模型为依据进行加权分位数筛选，保存符合条件的正交几何残差所对应的样本点；步骤33：根据所述步骤32中正交几何距离残差模型的定义，将目标椭圆参数的问题被转化为求解非线性目标函数的问题，设置拟合椭圆与步骤32所选取的样本点的最小正交几何距离残差为目标函数，椭圆由模型向量u表征，具体为：u＝t式中：为椭圆中心，a为长轴，b为短轴，α为长轴a与X正半轴的夹角；满足约束条件为：C1:a,b∈R+C2:b≤aC3:θc∈C4:xc,yc∈R利用粒子群优化算法求解目标函数，目标函数所对应的模型向量u即为拟合椭圆参数；步骤4：由各横截面中心拟合出被测锻件的中轴线，最后由中轴线方程求解锻件倾斜角度，具体为：式中，为直线上已知点坐标，是空间直线的方向向量由三维直线在XOZ面的投影方程的斜率可求得为对应X、Y向倾斜角度。本发明技术方案的进一步改进在于：所述步骤32中的代数拟合方法为：由公式来确定每个系数，然后根据极值原理，为了最小化f，必须有其中，设向量λ＝t表示椭圆参数。本发明技术方案的进一步改进在于：所述步骤32中的椭圆正交几何距离残差模型建立过程为：从一个通用椭圆的几何方程开始，该椭圆的半主轴长度为a，半次轴长度为b，方向角α，中心，椭圆方程的几何表示具体为：为减小求取正交点时所需的计算量，在拟合坐标系内建立新的局部坐标系，两坐标系的变换关系用旋转矩阵和平移向量表示：式中，平移向量中的Xc,Yc表示椭圆在拟合坐标系下的圆心坐标，以上参数均由迭代的初值所提供；在局部坐标系中，椭圆的方程表示为：在正交点的切线方程表示为：由此可得局部坐标系下，正交几何残差模型可以写为：本发明技术方案的进一步改进在于：所述步骤32中的样本点筛选方法为：用加权分位数法筛选所述步骤32中的样本点，遍历样本点，在数组num_index中记录每组样本点对应的正交几何残差平方和G，表示为：式中，X代表数据点在拟合坐标系中的坐标，f代表获得数据点到椭圆的正交距离的非线性函数。将这些数值由小到大排列，注意排列后的数值为：G≤G≤...≤G式中，G代表第k组对应的G值；要预先计算p只需找到k，使则x＜ξp＜x，当出现异常数值时，所选点的p分位数不会改变，导致阈值不准确，所选点的质量较差。为了提取所选点的质量，减少异常值对不良拟合效果的影响，在最高百分位数的基础上增加一个权重函数，表示为：ξp＝-w'k·x)+w'k·x式中，加权代数距离的平方之和表示为：式中，α代表重量系数，决定公式具体为：在数组best_ellipse_par中存储所有步骤32中样本点所对应的G满足G＜ξp条件的样本点坐标。本发明技术方案的进一步改进在于：所述步骤33中的目标函数建立方法为：根据几何拟合算法对误差距离的定义，对数组best_ellipse_par的样本点求解目标椭圆参数的问题被转化为求解非线性目标函数的问题，具体为：式中，X代表数据点在拟合坐标系中的坐标，f代表获得数据点到椭圆的正交距离的非线性函数，u代表待求椭圆方程的参数，min代表目标函数，即所求G的最小值。本发明技术方案的进一步改进在于：所述椭圆目标函数min能够通过所述步骤33中粒子群优化算法求取椭圆由模型向量u；在PSO算法中，每个粒子可以更新其速度和位置：式中，i是粒子指数；j是维度指数；pbest和gbest的适配值是变量的惯性权重和加速系数；k是当前迭代数；c1和c2是加速常数；r1和r2是符合范围内偶数分布的随机数；w是惯性权重系数，它具有权衡全局和局部搜索能力的能力，其数值如下所示：更新粒子的位置x和速度v继续进行，直到达到所要求的最小不匹配。停止更新这两个值的标准是基于最大的迭代次数或要求的计算精度。由于采用了上述技术方案，本发明取得的技术效果有：本发明提供了一种基于改进型优化算法拟合椭圆的锻件倾斜量测量方法，通过搭建由被测锻件、激光测距仪、倾角传感器等组成的测量装置，对于测量的距离数据进行多重处理，转化为三维空间上的锻件中轴线，获得锻件的倾斜度，能够显著消除异常值簇的误差干扰；建立的X、Y向测量校准曲线可以消除系统误差，对不同倾斜状态下的锻件进行测量，利用校准方程修正测量结果后，在-3°～3°范围内的测量误差均小于0.05°，可以满足锻件倾斜度的测量要求。附图说明图1是本发明的激光测距与检测驱动实验装置图；图2是异常值簇存在和剔除后拟合结果对比图；图3是PSO算法拟合椭圆的G收敛曲线；图4为Y向倾斜3.0°时的数据处理结果；图5为系统误差曲线。其中，1、被测锻件，2、倾斜度可调平台，3、载物台，4、步进电机，5、螺旋丝杆，6、固定支架，7、转轴，8、伺服电机，9、减速箱，10、底座，11、可调支脚，12、激光测距仪，13、计算机。具体实施方式下面结合附图及具体实施例对本发明做进一步详细说明：一种基于改进型优化算法拟合椭圆的锻件倾斜量测量方法，该方法利用激光位移传感器对锻件进行环绕测量以获取锻件横截面距离信息，基于回归分析方法对采集到的距离数据进行异常值判别并剔除；对剔除异常值后的数据进行坐标变换和直接最小二乘拟合，由各横截面中心拟合出锻件中轴线，最后由中轴线方程求解锻件倾斜角度。激光测距与检测驱动实验装置如图1所示，为本发明基于改进的椭圆拟合优化算法测量锻件倾斜度的方法的实验装置。所述激光测距与检测驱动实验装置包括激光检测装置和检测驱动装置，所述激光检测装置包括：倾斜度可调平台2、载物台3、底座10、可调支脚11、激光测距仪12和计算机13。所述检测驱动装置包括：步进电机4、螺旋丝杆5、转轴7、伺服电机8、减速箱9和固定支架6。所述激光测距与检测驱动装置工作过程如下：调节可调支脚11使整个测量系统保持水平，将被测锻件1固定在倾斜度可调平台2上，步进电机4带动螺旋丝杆5移动测量位姿并校准实验系统，使激光测距仪12对准转轴7的转动轴线；伺服电机8、减速箱9驱动转轴7连续360°转动，此时被测锻件1跟随转动，激光测距仪12检测其与被测锻件1旋转一周截面表面的距离；调节倾斜度可调平台2改变被测锻件1所处的倾角状态，并记录该状态下XY向的倾角，重新通过激光测距仪12测量被测锻件1转动一周截面表面的距离。将所测量距离数据传入计算机13，计算机13的系统装置采用VisualStudio、工控软件与Matlab联合编程，其中Matlab主要用于数据的处理。所述被测锻件1为圆柱形，直径为200mm、高度为240mm；倾斜度可调平台2的倾斜角度由位于左侧位置处的微调螺旋杆进行调节，调节范围是±3°；所述倾斜角度由电子倾角仪测得，所述电子倾角仪的双轴测量分辨率是0.01°，双轴测量精度是0.05°；所述伺服电机8连接减速箱9，减速箱9的输出轴带动通过转轴7连接的固定支架6，伺服电机8驱动脉冲信号由S7-200PLC供给，激光测距仪12固定而被测锻件1旋转完成环绕测量；螺旋丝杆5有效行程和定位精度分别为200mm和0.03mm；螺旋丝杆5均由42步进电机4驱动，驱动脉冲信号由STM32单片机供给，使用C#编写的软件完成数据采集和处理。一种基于改进的椭圆拟合优化算法测量锻件倾斜度的方法，具体步骤包括：步骤1：控制步进电机4运动带动螺旋丝杆5，使被测锻件1的旋转轴心对准转轴7，激光测距仪12达到测量位置。步骤2：计算机13驱动激光测距仪12和伺服电机8同时启动，测得激光测距仪12与被测锻件1表面间的动态距离di；步骤3：控制计算机的系统装置对距离信息进行坐标变换、样本点筛选，剔除异常值的影响后，对筛选后的点进行椭圆拟合，具体步骤为：步骤31：由极坐标到直角坐标的转换原理，激光测距仪12每次转过的角度记为θ0，则激光测距仪12在某一位置转过的角度θ为kθ0，k表示激光测距仪12扫过的第k个点，第k点的位置坐标，即被测锻件轮廓样本点坐标为：式中：L表示激光测距仪至旋转中心的距离，与测量系统中旋转臂的长度有关，在实验中为已知量，d表示激光测距仪至锻件表面的距离，在实验中为被测量；步骤32：对上述步骤31获得的被测锻件被测截面轮廓样本点进行随机区域划分，每次随机均匀分成6个区域，并从每个区域中随机选取一个样本点，对所选取的样本点进行直接代数拟合，并构建正交集合距离残差模型，依照该模型对样本点进行加权分位数筛选，直接代数拟合所表示的椭圆方程为：Ax2+Bxy+Cy2+Dx+Ey+F＝0 确定代数拟合评价函数为：来确定每个系数，然后根据极值原理，为了最小化f，必须有其中，设向量λ＝t表示椭圆参数。椭圆正交几何距离残差模型：从一个通用椭圆的几何方程开始，该椭圆的半主轴长度为a，半次轴长度为b，方向角α，中心，椭圆方程的几何表示具体为：为减小求取正交点时所需的计算量，在拟合坐标系内建立新的局部坐标系。两坐标系的变换关系用旋转矩阵和平移向量表示：式中，平移向量中的Xc,Yc表示椭圆在拟合坐标系下的圆心坐标，以上参数均由迭代的初值所提供。在局部坐标系中，椭圆的方程表示为：在正交点的切线方程表示为：由此可得局部坐标系下，正交几何残差模型可以写为：以正交几何距离残差模型为依据进行加权分位数筛选，遍历样本点，在数组num_index中记录每组样本点对应的正交几何残差平方和G，表示为：式中，X代表数据点在拟合坐标系中的坐标，f代表获得数据点到椭圆的正交距离的非线性函数。将这些数值由小到大排列，注意排列后的数值为：G≤G≤...≤G式中，G代表第k组对应的G值。要预先计算p只需找到k，使则x＜ξp＜x，当出现异常数值时，所选点的p分位数不会改变，导致阈值不准确，所选点的质量较差。为了提取所选点的质量，减少异常值对不良拟合效果的影响，在最高百分位数的基础上增加一个权重函数，表示为：ξp＝-w'k·x)+w'k·x式中，加权代数距离的平方之和表示为：式中，α代表重量系数，决定公式具体为：在数组best_ellipse_par中存储所有步骤32中样本点所对应的G满足G＜ξp条件的样本点坐标。步骤33：对上述数组best_ellipse_par的样本点进行基于粒子群优化算法的椭圆拟合。根据步骤32中正交几何距离残差模型的定义，目标椭圆参数的问题被转化为求解非线性目标函数的问题，具体为：式中，X代表数据点在拟合坐标系中的坐标，f代表获得数据点到椭圆的正交距离的非线性函数，u代表待求椭圆方程的参数，min代表目标函数，即所求G的最小值。椭圆由模型向量u表征，具体为：u＝t式中：为椭圆中心，a为长轴，b为短轴，α为长轴a与X正半轴的夹角。满足约束条件为：椭圆目标函数min通过所述PSO算法求取椭圆由模型向量u。在PSO算法中，每个粒子可以更新其速度和位置：式中，i是粒子指数；j是维度指数；pbest和gbest的适配值是变量的惯性权重和加速系数；k是当前迭代数；c1和c2是加速常数；r1和r2是符合范围内偶数分布的随机数。w是惯性权重系数，它具有权衡全局和局部搜索能力的能力。其数值如下所示：更新粒子的位置x和速度v继续进行，直到达到所要求的最小不匹配。停止更新这两个值的标准是基于最大的迭代次数或要求的计算精度。步骤4：由上述各横截面中心拟合出待测锻件1的中轴线，最后由中轴线方程求解锻件倾斜角度，具体为：式中，为直线上已知点坐标，是空间直线的方向向量由三维直线在XOZ面的投影方程的斜率可求得为对应X、Y向倾斜角度。调节平台使工件在XY向同时产生倾角，对测量结果进行系统误差补偿，工件在不同倾斜角度下的测量结果见表1。表1倾斜度测量结果从表1的数据分析中可以得出，对6组不同倾角的测量结果进行分析，最大测量误差为0.04°，平均测量误差小于0.03°，测量结果说明了本文所提出的测量方法对0～3°范围内的倾角可实现精准测量。传统最小二乘椭圆拟合技术视所有样本点等权重，当被测锻件存在异常值簇时会出现较大误差，且不具备迭代寻优性能，导致椭圆拟合结果会出现较大偏差，从而造成倾斜度测量不准确。本发明提出的方法在利用加权分位数法剔除异常值簇，椭圆拟合结果与传统方法对比如图2所示，充分证明了该方法有效消除了异常值簇的影响，提高了拟合精度。基于改进型优化算法拟合椭圆的锻件倾斜量测量方法，G的迭代曲线如图3所示，图中展示了在第35代左右G的值达到收敛。将工件固定于倾斜度可调平台上，工件在X向倾斜0.00°、Y向倾斜3.00°时的测量结果如图4所示，图中展示出了8个不同高度横截面测量情况及其中心位置，相邻横截面间的垂直距离均为16mm，由此得到竖直方向的多个椭圆长轴中心点的空间坐标，最后拟合得到锻件中轴线。由于测量装置存在系统误差，所以首先对不同倾角下的工件进行测量以确定校准方程。依据电子倾角仪的示数调节平台至不同倾斜度，从而使工件产生不同姿态；首先使工件在X向的倾斜度为0.00°，然后分别在Y向设定不同倾角进行测量，测量范围是-3°～3°，间隔是1°，X向和Y向的测量结果如图5所示，利用一次函数拟合测量值，拟合结果表现出良好的线性。以上所述的实施例仅是对本发明的优选实施方式进行描述，并非对本发明的范围进行限定，在不脱离本发明设计精神的前提下，本领域普通技术人员对本发明的技术方案做出的各种变形和改进，均应落入本发明权利要求书确定的保护范围内。
