标题title
基于反锐化掩模算法的光伏板的热斑缺陷检测方法
摘要abst
本发明涉及图像数据处理领域，具体涉及一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，包括：获取校正后的光伏板区域红外灰度图；对灰度图进行滑窗，获取所有光照区域；对光照区域进行滑窗，得到各像素点的相似点连线方向及其累加标记值；利用各像素点的相似点连线方向的累加标记值、光照区域的最小外接矩形中与各像素点的相似点连线方向相同的方向上的像素点数量，得到光照区域各像素点的灰度趋势度；利用光照区域各像素点的灰度值、灰度趋势度，得到各像素点的增益权重值；利用各像素点的增益权重值得到图像增强后的灰度图；对图像增强后的灰度图进行阈值分割，获取热斑区域。上述方法用于检测光伏板的热斑缺陷，可提高检测准确度。
权利要求书clms
1.一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，其特征在于，包括：获取校正后的待检测光伏板区域红外灰度图；设置第一滑窗，对红外灰度图进行滑窗遍历，利用每个第一滑窗内所有像素点的灰度值均值对红外灰度图中的像素点进行合并，获取红外灰度图的所有光照区域；设置第二滑窗，对每个光照区域进行滑窗遍历，利用每个第二滑窗内所有像素点的灰度值方差、每个第二滑窗内中心像素点与邻域像素点的灰度值相似度，得到每个光照区域中各像素点的所有相似点连线方向；利用每个光照区域中各像素点的所有相似点连线方向上像素点的数量，得到每个光照区域中各像素点的所有相似点连线方向的累加标记值；获取每个光照区域的最小外接矩形，利用每个光照区域中各像素点的所有相似点连线方向的累加标记值、每个光照区域的最小外接矩形中与各像素点的相似点连线方向相同的方向上的像素点数量，计算得到每个光照区域中各像素点的灰度趋势度；利用每个光照区域中各像素点的灰度值、各像素点的灰度趋势度、每个光照区域中所有像素点的灰度值均值，计算得到每个光照区域中各像素点的增益权重值；利用每个光照区域中各像素点的增益权重值得到图像增强后的红外灰度图；对图像增强后的红外灰度图进行阈值分割，获取待检测光伏板的热斑缺陷区域。2.根据权利要求1所述的一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，其特征在于，所述红外灰度图的所有光照区域是按照如下方式获取：设置第一滑窗，以红外灰度图中各像素点为第一滑窗的中心像素点，对红外灰度图进行遍历；利用每一个第一滑窗内像素点的灰度值均值与相邻第一滑窗内像素点灰度值均值的差值判断每一个第一滑窗内的像素点与其相邻的第一滑窗内容的像素点是否为同一光照区域，依次完成对红外灰度图像中的所有光照区域的分割。3.根据权利要求2所述的一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，其特征在于，还包括：每一个第一滑窗内像素点的灰度值均值与相邻第一滑窗内像素点灰度值均值的差值小于灰度值差值阈值时，将第一滑窗内像素点和相邻第一滑窗内像素点合并为同一光照区域。4.根据权利要求3所述的一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，其特征在于，还包括：当每一个第一滑窗内像素点的灰度值均值与相邻第一滑窗内像素点灰度值均值的差值大于灰度值差值阈值时；获取相邻第一滑窗的下一个滑窗，并利用第一滑窗内像素点的灰度值均值与下一个滑窗内像素点的均值的差值判断和第一滑窗内像素点和相邻第一滑窗内像素点是否属于同一光照区域。5.根据权利要求1所述的一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，其特征在于，所述每个光照区域中各像素点的所有相似点连线方向的累加标记值是按照如下方式得到：设置第二滑窗，以每个光照区域中各像素点为中心像素点进行滑窗遍历；利用每个第二滑窗中像素点的灰度值的方差及该第二滑窗内像素点的灰度相似性确定出每个第二滑窗中的连接像素点；并将每个第二滑窗中的连接像素点与第二滑窗的中心像素点进行相连，得到每个第二滑窗中的多个相似点连线方向；并对每个第二滑窗中的每个连相似点连线方向进行赋值得到初始累加标记值；当相邻两个第二滑窗中的多个连接方向发生重合，则将该重合的连接方向进行合并，并在该连相似点连线方向上的初始累加标记值中增加累加标记值；依次获得每个光照区域中所有连相似点连线方向的累加标记值；确定光照区域中各像素点的所有相似点连线方向的累加标记值。6.根据权利要求1所述的一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，其特征在于，所述每个光照区域中各像素点的灰度趋势度是按照如下方式得到：对每个光照区域进行如下操作：将光照区域中的任意像素点作为第三像素点；获取光照区域的最小外接矩形；统计最小外接矩形中与第三像素点的各相似点连线方向相同的方向上的像素点数量；利用第三像素点的各相似点连线方向的累加标记值、最小外接矩形中与第三像素点的各相似点连线方向相同的方向上的像素点数量，计算得到第三像素点的灰度趋势度；按照得到第三像素点的灰度趋势度的方法得到光照区域中每个像素点的灰度趋势度。7.根据权利要求1所述的一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，其特征在于，所述每个光照区域中各像素点的增益权重值的表达式如下：式中，表示第u个光照区域中第i个像素点的增益权重值，表示第u个光照区域中第i个像素点的灰度趋势度，e表示自然常数，表示超参数，表示第u个光照区域中第i个像素点的灰度值，表示第u个光照区域中所有像素点的灰度值均值。8.根据权利要求1所述的一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，其特征在于，所述待检测光伏板的热斑缺陷区域是按照如下方式获取：利用每个光照区域中各像素点的增益权重值、红外灰度图中各像素点的灰度值，得到图像增强后的红外灰度图；利用大津算法对图像增强后的红外灰度图进行阈值分割，得到第一分割阈值和第二分割阈值；获取图像增强后的红外灰度图中灰度值第二分割阈值的像素点，将灰度值第二分割阈值的像素点组成的区域作为待检测光伏板的热斑缺陷区域。9.根据权利要求1所述的一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，其特征在于，所述校正后的待检测光伏板区域红外灰度图是按照如下方式获取：采集待检测光伏板的红外图像；对待检测光伏板的红外图像进行畸变校正，得到校正后的待检测光伏板的红外图像；对校正后的待检测光伏板的红外图像进行语义分割，得到校正后的待检测光伏板区域红外图像；对校正后的待检测光伏板区域红外图像进行灰度化处理，获取校正后的待检测光伏板区域红外灰度图。
说明书desc
技术领域本发明涉及图像数据处理领域，具体涉及一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法。背景技术随着科技的发展，光伏板的使用越来越广泛。在光伏板使用过程中，由于长期暴露在外界环境中，因此光伏板极易发生故障。光伏板热斑缺陷是危害最大且发生最频繁的缺陷之一。热斑缺陷会影响光伏板的发电效果以及使用寿命，也很容易引发火灾。因此，及时的识别定位光伏板热斑缺陷对于光伏板的使用极为重要。现有的光伏板的热斑缺陷检测方法需要利用无人机采集红外图像，但是由于大气传输以及红外成像系统的影响，会使得采集的光伏板红外图像的清晰度下降，图像质量下降，因此现有的光伏板的热斑缺陷检测方法需要对光伏板红外图像进行图像增强，然后对增强后的红外图像进行阈值分割得到热斑缺陷区域。现有的光伏板的热斑缺陷检测方法一般采用反锐化掩模算法对光伏板红外图像进行图像增强：通过对采集的光伏板的红外图像进行低通滤波处理，得到低频的模糊图像，并用原始图像减去该模糊图像得到图像中的高频信息；将加权处理的高频信息图像，与原始图像进行叠加，得到增强后的图像。但是，传统的反锐化掩模算法中，通过实施者自行设定增益权重值，并且每个像素点设置的增益权重值相同，在放大细节边缘信息的同时，还放大了无用信息的细节，比如光伏板的栅线和焊点的特征细节，进而容易降低阈值分割的准确度，从而降低光伏板的热斑缺陷检测的准确度。发明内容本发明提供一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，以解决现有的光伏板的热斑缺陷检测方法准确度低的问题。为达到上述目的，本发明采用如下技术方案，一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法，包括：获取校正后的待检测光伏板区域红外灰度图；设置第一滑窗，对红外灰度图进行滑窗遍历，利用每个第一滑窗内所有像素点的灰度值均值对红外灰度图中的像素点进行合并，获取红外灰度图的所有光照区域；设置第二滑窗，对每个光照区域进行滑窗遍历，利用每个第二滑窗内所有像素点的灰度值方差、每个第二滑窗内中心像素点与邻域像素点的灰度值相似度，得到每个光照区域中各像素点的所有相似点连线方向；利用每个光照区域中各像素点的所有相似点连线方向上像素点的数量，得到每个光照区域中各像素点的所有相似点连线方向的累加标记值；获取每个光照区域的最小外接矩形，利用每个光照区域中各像素点的所有相似点连线方向的累加标记值、每个光照区域的最小外接矩形中与各像素点的相似点连线方向相同的方向上的像素点数量，计算得到每个光照区域中各像素点的灰度趋势度；利用每个光照区域中各像素点的灰度值、各像素点的灰度趋势度、每个光照区域中所有像素点的灰度值均值，计算得到每个光照区域中各像素点的增益权重值；利用每个光照区域中各像素点的增益权重值得到图像增强后的红外灰度图；对图像增强后的红外灰度图进行阈值分割，获取待检测光伏板的热斑缺陷区域。进一步的，所述红外灰度图的所有光照区域是按照如下方式获取：设置第一滑窗，以红外灰度图中各像素点为第一滑窗的中心像素点，对红外灰度图进行遍历；利用每一个第一滑窗内像素点的灰度值均值与相邻第一滑窗内像素点灰度值均值的差值判断每一个第一滑窗内的像素点与其相邻的第一滑窗内容的像素点是否为同一光照区域，依次完成对红外灰度图像中的所有光照区域的分割。进一步的，还包括：每一个第一滑窗内像素点的灰度值均值与相邻第一滑窗内像素点灰度值均值的差值小于灰度值差值阈值时，将第一滑窗内像素点和相邻第一滑窗内像素点合并为同一光照区域。进一步的，还包括：当每一个第一滑窗内像素点的灰度值均值与相邻第一滑窗内像素点灰度值均值的差值大于灰度值差值阈值时；获取相邻第一滑窗的下一个滑窗，并利用第一滑窗内像素点的灰度值均值与下一个滑窗内像素点的均值的差值判断和第一滑窗内像素点和相邻第一滑窗内像素点是否属于同一光照区域。进一步的，所述每个光照区域中各像素点的所有相似点连线方向的累加标记值是按照如下方式得到：设置第二滑窗，以每个光照区域中各像素点为中心像素点进行滑窗遍历；利用每个第二滑窗中像素点的灰度值的方差及该第二滑窗内像素点的灰度相似性确定出每个第二滑窗中的连接像素点；并将每个第二滑窗中的连接像素点与第二滑窗的中心像素点进行相连，得到每个第二滑窗中的多个相似点连线方向；并对每个第二滑窗中的每个连相似点连线方向进行赋值得到初始累加标记值；当相邻两个第二滑窗中的多个连接方向发生重合，则将该重合的连接方向进行合并，并在该连相似点连线方向上的初始累加标记值中增加累加标记值；依次获得每个光照区域中所有连相似点连线方向的累加标记值；确定光照区域中各像素点的所有相似点连线方向的累加标记值。进一步的，所述每个光照区域中各像素点的灰度趋势度是按照如下方式得到：对每个光照区域进行如下操作：将光照区域中的任意像素点作为第三像素点；获取光照区域的最小外接矩形；统计最小外接矩形中与第三像素点的各相似点连线方向相同的方向上的像素点数量；利用第三像素点的各相似点连线方向的累加标记值、最小外接矩形中与第三像素点的各相似点连线方向相同的方向上的像素点数量，计算得到第三像素点的灰度趋势度；按照得到第三像素点的灰度趋势度的方法得到光照区域中每个像素点的灰度趋势度。进一步的，所述每个光照区域中各像素点的增益权重值的表达式如下：式中，表示第u个光照区域中第i个像素点的增益权重值，表示第u个光照区域中第i个像素点的灰度趋势度，e表示自然常数，表示超参数，表示第u个光照区域中第i个像素点的灰度值，表示第u个光照区域中所有像素点的灰度值均值。进一步的，所述待检测光伏板的热斑缺陷区域是按照如下方式获取：利用每个光照区域中各像素点的增益权重值、红外灰度图中各像素点的灰度值，得到图像增强后的红外灰度图；利用大津算法对图像增强后的红外灰度图进行阈值分割，得到第一分割阈值和第二分割阈值；获取图像增强后的红外灰度图中灰度值第二分割阈值的像素点，将灰度值第二分割阈值的像素点组成的区域作为待检测光伏板的热斑缺陷区域。进一步的，所述校正后的待检测光伏板区域红外灰度图是按照如下方式获取：采集待检测光伏板的红外图像；对待检测光伏板的红外图像进行畸变校正，得到校正后的待检测光伏板的红外图像；对校正后的待检测光伏板的红外图像进行语义分割，得到校正后的待检测光伏板区域红外图像；对校正后的待检测光伏板区域红外图像进行灰度化处理，获取校正后的待检测光伏板区域红外灰度图。本发明的有益效果是：本发明根据每个光照区域的灰度值特性进行区域的划分，在进行区域划分的过程中，排除了栅线和焊点高灰度值的影响，使得区域划分更加准确。根据每个像素点所在区域特性，以及像素点自身的灰度趋势度特性，自适应计算每个像素点的增益权重值。不仅考虑了像素点的邻域灰度分布特性，并且同时考虑了邻域的灰度分布特性，相较于传统的反锐化掩模算法，本发明的计算方法更加准确，且反锐化掩模算法结果精度更高，增强效果更好。本发明通过提高图像增强效果，使得阈值分割准确度提高，进而提高热斑缺陷检测的准确度。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例提供的一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法流程示意图；图2为本发明实施例提供的一种第一滑窗操作过程示意图；图3为本发明实施例提供的一种第一滑窗操作过程中的窗口1的示意图；图4为本发明实施例提供的一种第一滑窗操作过程中的窗口2的示意图；图5为本发明实施例提供的一种第一滑窗操作过程中的窗口3的示意图；图6为本发明实施例提供的一种第一滑窗操作过程中的窗口4的示意图；图7为本发明实施例提供的一种第一滑窗操作过程中的窗口5的示意图；图8为本发明实施例提供的一种第一滑窗操作过程中的窗口6的示意图；图9为本发明实施例提供的一种第二滑窗示意图；图10为本发明实施例提供的另一种第二滑窗示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。本发明的主要目的是：对经过预处理后的光伏板红外图像，根据光伏板表面不同光照区域的灰度分布特性，以及不同区域的像素点的邻域灰度分布以及对应的邻域的灰度分布，计算像素点的灰度趋势度。根据像素点所属区域的区域特性以及像素点的灰度趋势度进行增益权重值计算，进而通过自适应反锐化掩模算法进行图像增强，进而精准识别光伏板的热斑区域。在采集的无人机红外图像中，由于大气传输以及红外成像系统的影响，会使得采集的光伏板红外图像的清晰度下降，图像质量下降，因此在进行光伏板的缺陷检测过程中，会造成光伏板热斑缺陷检测结果不准确。本发明的一种基于反锐化掩模算法的光伏板的热斑缺陷检测方法的实施例，如图1所示，包括：S101、获取校正后的待检测光伏板区域红外灰度图。本实施例利用无人机采集光伏板的红外图像。其中无人机的飞行参数根据具体实施情况而定，本实施例不进行具体说明。由于无人机的飞行高度以及红外相机的角度参数的影响，在采集的红外图像中会发生图像畸变，因此在进行光伏板热斑识别的过程中，需要先对图像进行畸变校正。本实施例畸变校正采用现有的无控制点的无人机图像畸变校正方法：通过使用无人机航拍信息进行图像畸变校正，即通过获取无人机飞行过程中的俯仰角、翻滚角、航偏角以及航高信息进行图像的畸变校正，无人机航拍信息可以通过无人机飞行参数获取。对校正之后的图像进行语义分割处理，具体的内容为：语义分割所用的数据集为经过校正之后的光伏板红外图像；对图像中像素点进行人工标注，其中将图像像素点分为两类，一类为背景区域，人工标注为0；一类为光伏板区域，人工标注为1；本实施例所述的语义分割网络为网络，对应的损失函数为交叉熵函数。对语义分割后的图像进行灰度化处理，获取校正后的待检测光伏板区域红外灰度图。S102、设置第一滑窗，对红外灰度图进行滑窗遍历，利用每个第一滑窗内所有像素点的灰度值均值对红外灰度图中的像素点进行合并，获取红外灰度图的所有光照区域。需要说明的是：通过反锐化掩模算法进行光伏板红外图像的增强处理，使得在检测光伏板热斑缺陷时更加准确。而反锐化掩模算法中若对图像边缘细节进行统一增强，会影响热斑缺陷检测精度，因此本实施例根据每个像素点的特性计算各自对应的反锐化掩模的增益权重值。由于大气传输以及红外成像系统的影响，会使得采集的光伏板红外图像的清晰度下降，图像质量下降，因此在进行光伏板的缺陷检测过程中，会造成光伏板热斑缺陷检测结果不准确。反锐化掩模是一种常用的增强图像中的边缘细节信息的算法，通过对采集的光伏板的红外图像进行低通滤波处理，得到低频的模糊图像，并用原始图像减去该模糊图像得到图像中的高频信息；将加权处理的高频信息图像，与原始图像进行叠加，得到增强后的图像，其中反锐化掩模算法的计算公式的表达式为：式中，表示采集的光伏板红外原始图像；表示经过增强后的光伏板红外原始图像；表示高频信息增益权重值；表示图像中的高频信息。然而该方法会对所有的图像边缘细节进行统一增强，同样会影响热斑缺陷检测精度。因此本实施例中根据图像中每个像素点的特性计算各自对应的反锐化掩模的增益权重值。由于光伏板在不同的光照区域下，会在光伏板上产生不同的温度区域，对应的区域灰度分布特性也不同，因此需要进行像素点的区域划分。通过计算灰度趋势度表征每个像素点的邻域灰度分布以及对应的邻域的灰度分布，灰度趋势度越大，表明当前像素点的趋势分布连续。根据每个光照区域的灰度值特性进行区域的划分，在进行区域划分的过程中，排除了栅线和焊点高灰度值的影响，使得区域划分更加准确。通过灰度趋势度表征每个像素点的邻域灰度分布以及对应的邻域的灰度分布，即用于表征像素点的周期分布性，进而计算增益权重值的权重系数值。本实施例中图像的高频信息包括光伏板的细节边缘信息以及热斑细节信息。而光伏板的细节边缘信息包括本身栅线信息以及焊点信息；热斑细节信息包括光伏板上热斑的边缘信息。基于此，本实施例通过计算每个像素点的灰度趋势度来计算不同像素点的反锐化掩膜算法中的增益权重值。其中灰度趋势度表征每个像素点的邻域灰度分布以及对应的邻域的灰度分布，灰度趋势度越大，表明当前像素点的趋势分布连续。另外，由于光伏板在不同的光照区域下，会在光伏板上产生不同的温度区域，即在采集的光伏板的红外图像中产生不同的灰度区域，对应的焊点信息和栅线信息也不相同。因此对于得到的图像进行区域划分，并根据区域特征以及同区域的像素点的灰度趋势度计算像素点的增益权重值。首先需要对采集的光伏板的红外图像进行区域划分，对处理得到的光伏板图像进行区域划分，设置第一滑窗，所述第一滑窗的大小为，且以红外灰度图中各像素点为中心像素点。将红外灰度图左上角的像素点作为起始点，按照从左至右，从上至下的方式对红外灰度图进行滑窗遍历。统计每个像素点的滑窗内的灰度值均值，若当前滑窗的灰度值均值与下一个滑窗的灰度值均值存在较大的差异，则对应的当前滑窗的像素点与下一个滑窗的像素点不属于同一个区域。而在进行滑窗过程中，由于栅线和焊点的影响，会对统计过程造成错误计算，因此，本实施例根据栅线和焊点的周期性特征以及栅线和焊点的高灰度值的特征，在统计滑窗均值时增加判定条件：设置灰度值差值阈值A’， A’可根据实施者具体实施情况而定，本实施例给出经验参考值A’=25。对于行方向，若当前像素点对应的滑窗的灰度值均值与前一个像素点对应的滑窗的灰度值均值较大，记录上一个像素点的坐标，记为；继续滑窗操作计算均值，若再一次发生当前像素点的滑窗的灰度值均值与前一个像素点对应的滑窗的灰度值均值差异较大，比较当前像素点的滑窗灰度值均值与记录的像素点对应的滑窗灰度值均值，若两者差异较小，则继续滑窗计算，当前像素点与像素点均为同一个区域，即为中间夹杂的像素点也同为一个区域；若两者差异较大，则像素点为区域边缘像素点。类似此操作，列方向同样进行此操作。如图2所示，为第1个光照区域中第一滑窗操作过程示意图。如图3-图8所示，分别为第1个光照区域中第一滑窗操作过程中的窗口1-6的示意图。在滑窗过程中，首先分别计算窗口1和窗口2之间的灰度值均值，并计算得到两个滑窗之间的灰度值均值差异，两个滑窗之间的灰度值均值差异大于所设置的灰度值差值阈值，因此将窗口1的中心像素点标记为B像素点；继续进行类似滑窗操作，窗口2和窗口3之间的灰度值均值差异小于所设置的灰度值差值阈值，继续滑窗；直到窗口5和窗口6之间的灰度值均值差异大于所设置的灰度值差值阈值，则将窗口6与窗口1进行灰度值均值比较，两者差异值小于所设置的灰度值差值阈值，则表明窗口6的中心像素点与窗口1的中心像素点B属于同一个区域。至此，将同属于一个区域的像素点进行合并，获取红外灰度图的所有光照区域。S103、设置第二滑窗，对每个光照区域进行滑窗遍历，利用每个第二滑窗内所有像素点的灰度值方差、每个第二滑窗内中心像素点与邻域像素点的灰度值相似度，得到每个光照区域中各像素点的所有相似点连线方向及其累加标记值。通过每个像素点的邻域信息计算每个像素点的灰度趋势度，灰度趋势度越大，表明该像素点越呈现周期性。具体的是设置第二滑窗，所述第二滑窗的大小为3×3，以每个光照区域中各像素点为中心像素点进行滑窗遍历；在遍历的过程中提高一种遍历的实施例，将光照区域左上角的像素点作为起始点，按照从左至右，从上至下的方式对光照区域进行滑窗遍历。利用每个第二滑窗中像素点的灰度值的方差及该第二滑窗内像素点的灰度相似性确定出每个第二滑窗中的连接像素点；具体的是，计算每个遍历像素点对应的第二滑窗内所有像素点的灰度值方差，并设置方差阈值，可根据实施者具体实施情况而定，本实施例给出经验参考值，其中表示光照区域内所有像素点的灰度值均值。获取满足方差阈值的遍历像素点集。对大于方差阈值的遍历像素点进行灰度值相似度计算。计算当前滑窗内邻域像素点与中心像素点之间的灰度值相似度，其中满足方差阈值的遍历像素点对应的第二滑窗内中心像素点与第个邻域像素点的灰度值相似度的计算表达式为：式中，表示满足方差阈值的遍历像素点对应的第二滑窗内中心像素点的灰度值，表示满足方差阈值的遍历像素点对应的第二滑窗内第个邻域像素点的灰度值。e表示自然常数。此处的含义为：中心像素点的灰度值与滑窗内邻域像素点的灰度值差异越小，表明两个像素点之间灰度值越相似，表明灰度值相似度越大。通过指数函数，将灰度值差异值映射至0-1范围内，随着灰度值差异越小，灰度值相似度越大。设置灰度值相似度阈值，D可根据实施者具体实施情况而定，本实施例给出经验参考值。在满足方差阈值的遍历像素点对应的第二滑窗的邻域像素点中标记大于灰度值相似度阈值的像素点。在当前第二滑窗内这些标记过的像素点中，若其中一些像素点周围存在没有标记过的点作为连接像素点；记作第二滑窗内的连接点集；并将每个第二滑窗中的连接像素点与第二滑窗的中心像素点进行相连，得到每个第二滑窗中的多个相似点连线方向；并对每个第二滑窗中的每个连相似点连线方向进行赋值得到初始累加标记值；当相邻两个第二滑窗中的多个连接方向发生重合，则将该重合的连接方向进行合并，并在该连相似点连线方向上的初始累加标记值中增加累加标记值；依次获得每个光照区域中所有连相似点连线方向的累加标记值；确定光照区域中各像素点的所有相似点连线方向的累加标记值具体的是，将每个第二滑窗内的连接像素点分别与第二滑窗内的中心像素点进行连接，得到相似点连线，再分别以连接点集中的像素点进行下一滑窗的计算，类似连接点集计算得到连接点集。以连接线为例，设置当前连接线方向的累加标记值，若连接点集中存在于上一滑窗的相同连接线方向，则累加标记值。继续下一滑窗计算，直到当前滑窗内不存在满足上述条件的像素点，获取当前的最终累加标记值。类似此操作，以连接线的方向进行计算，得到其他连接线的最终累加标记值、、…。如图9所示为第二滑窗的示意图，图10所示为第2个光照区域中第10个像素点对应的第二滑窗示意图。如图9和图10所示，对于第2个光照区域中第10个像素点，该像素点g0的灰度值为130，以该点为中心像素点，分别计算灰度值相似度，满足阈值条件的像素点的分别为g2、g3、g5、g7和g8，则对应的连接点集为g2和g7，则其中对应的连接线为g2-g0，连接线为g7-g0。接下来以g2为中心像素点分析连接特性，同样得到连接点集，若连接点集中存在与连接线方向相同的像素点，记为g2’，则设置的连接线的累加标记值，则，继续以g2’为滑窗下一次计算。类似此操作，得到最终的的值，记方向的最终累加标记值。S104、获取每个光照区域的最小外接矩形，利用每个光照区域中各像素点的所有相似点连线方向的累加标记值、每个光照区域的最小外接矩形中与各像素点的相似点连线方向相同的方向上的像素点数量，计算得到每个光照区域中各像素点的灰度趋势度。获取光照区域的最小外接矩形。则对应的第个光照区域中的第个像素点的灰度趋势度的计算表达式为：式中，表示第个光照区域中的第个像素点的灰度趋势度，表示第个光照区域中的第个像素点的第个连接线方向为的累加标记值；表示第个光照区域中的最小外接矩形的方向为的区域大小；表示方向的数量，即8个角度方向。其中，若当前像素点满足设置的条件的累加标记值越多，表明当前像素点越呈现趋势性变化，则对应的像素点更呈现方向性特征，对应的本实施例中的光伏板图像表现为周期性特征。对应在各个光照区域中，由于光照区域为不规则的形状，因此通过获取光照区域的最小外接矩形，代表该光照区域。计算最小外接矩形的每个方向上累加标记值占该方向上所有像素点数量的比例，来表征当前像素点的趋势性，比例越大，当前像素点的趋势性越大。至此，可以得到不同光照区域中每个像素点的灰度趋势度，其中像素点的灰度趋势度越大，则表明该像素点与其周围邻域像素点以及对应的邻域的灰度分布越呈现规律性变化。S105、利用每个光照区域中各像素点的灰度值、各像素点的灰度趋势度、每个光照区域中所有像素点的灰度值均值，计算得到每个光照区域中各像素点的增益权重值。根据像素点所属区域的区域特性以及像素点的灰度趋势度进行增益权重值计算。若当前像素点与其所在区域的像素点的灰度值差异越大，则对应的增益权重值较大。通过获取的灰度趋势度，进行增益权重值的调整，灰度趋势度越大，则对应的调整后的增益权重值越小。根据每个像素点所在区域特性，以及像素点自身的灰度趋势度特性，自适应计算每个像素点的增益权重值。相较于仅考虑当前像素点的邻域分布特性的计算方法更加准确，且反锐化掩模算法结果精度更高，增强效果更好。根据每个像素点的灰度趋势度计算每个像素点的自适应反锐化掩膜。本实施例根据像素点所属区域的区域特性以及像素点的灰度趋势度进行增益权重值计算，其中第个光照区域的第个像素点的增益权重值的计算表达式为：式中，表示第个光照区域的第个像素点的灰度趋势度；表示第个光照区域的第个像素点的灰度值；表示第个光照区域中所有像素点的灰度值均值；表示超参数，用于调整当前像素点的整体的增益权重值，防止增益权重值过大，可根据实施者具体实施情况而定，本实施例给出经验参考值。表示第个光照区域的第个像素点的增益权重值，e表示自然常数。其中，通过计算不同区域像素点的灰度值与其所处区域的灰度值均值之间的差异进行增益权重值计算，若当前像素点的灰度值与区域灰度值均值差异越大，表明当前像素点属于有用信息点，即对应本实施例中的栅线点、焊点以及光斑点区域，且对应的权重值越高。其次，为了保证光斑区域点的增益权重值较栅线点和焊点的增益权重值较高，即为了增大它们之间的灰度值差异值，此处通过计算灰度趋势度进行调整，灰度趋势度越大的像素点，越呈现周期性的变化，则对应的该像素点的调整后的增益权重值越小。S106、利用每个光照区域中各像素点的增益权重值得到图像增强后的红外灰度图。得到每个像素点的增益权重值后，根据反锐化掩模算法原理进行图像增强。至此，得到了增强后的光伏板的红外图像。S107、对图像增强后的红外灰度图进行阈值分割，获取待检测光伏板的热斑缺陷区域。得到了增强后的光伏板的热斑红外图像。通过多阈值分割方法，进行热斑的识别。具体内容为：通过大津阈值算法，确定多个分割阈值记为和，。将灰度值大于等于的像素点的像素值设置为1；将灰度值小于，并且大于等于的像素点的像素值设置为0.5，将灰度值小于的像素点的像素值设置为0。其中像素值为1的像素点为光伏板热斑区域的像素点。以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
