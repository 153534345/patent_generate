标题title
一种安全平台的联锁控显方法及系统
摘要abst
本发明提供了一种安全平台的联锁控显方法及系统，技术要点包括，数据初始化，将原始配置数据中读取的图元进行各图元类的初始化，并存入场景类中，把场景类添加到视图类，然后场景类对初始化后的图元类进行图元更新，更新后的图元通过视图类进行展示，最后往视图类输入用户操作鼠标事件，并传递给场景类，场景类将鼠标事件传递给相应的图元类。本发明实现一种可应用于自主化安全平台的联锁控显方法及系统，高效地实现了联锁控显机的自主化开发；本发明提出了一种图形刷新和绘制方法，使控显系统可以直接处理原始数据进行站场图显示和操作。
权利要求书clms
1.一种安全平台的联锁控显方法，其特征在于，包括以下步骤：数据初始化，将原始配置数据中读取的图元进行各图元类的初始化，并存入场景类中，把场景类添加到视图类；场景类对初始化后的图元类进行图元更新；更新后的图元通过视图类进行展示；往视图类输入用户操作鼠标事件，并传递给场景类，场景类将鼠标事件传递给相应的图元类。2.根据权利要求1所述的一种安全平台的联锁控显方法，其特征在于，所述数据初始化，包括以下步骤：读取原始配置数据，获取图元的宽和高，以图元左上角为原点进行绘制，将图元的坐标映射到场景坐标系中，图元放入容器进行管理；根据读取的原始配置数据获取每个图元在场景类中的刷新区域。3.根据权利要求1所述的一种安全平台的联锁控显方法，其特征在于，所述场景类对初始化后的图元类进行图元更新，包括以下步骤：检测设备状态，如果有变化触发图元更新，所述图元更新采用双缓存机制；判断Manage传递的状态变化标志是否触发，有变化则设置刷新标志；进行设备局部刷新，刷新视图对应的图元。4.根据权利要求1所述的一种安全平台的联锁控显方法，其特征在于，所述更新后的图元通过视图类进行展示，包括以下步骤：指定一块区域装载所有的图元元素和图元之间的逻辑；图元嵌入场景中，默认场景原点与图元原点对齐；场景坐标映射到视图上，显示场景对应的图元。5.根据权利要求1所述的一种安全平台的联锁控显方法，其特征在于，传递所述用户操作鼠标事件，包括以下步骤：输入用户操作鼠标事件；视图接收用户操作鼠标事件；视图将用户操作鼠标事件传递给场景；场景将事件传递给获得焦点的图元，如果焦点消失则事件丢弃。6.一种安全平台的联锁控显系统，其特征在于，包括MMI主框架模块、显示模块和操作模块；所述MMI主框架程序包括数据初始化模块和图元模块；所述数据初始化模块，用于数据初始化，将原始配置数据中读取的图元进行各图元类的初始化，并存入场景类中，把场景类添加到视图类；所述图元模块，用于场景类对初始化后的图元类进行图元更新；所述显示模块，用于对更新后的图元通过视图类进行展示；所述操作模块，用于往视图类输入用户操作鼠标事件，并传递给场景类，场景类将鼠标事件传递给相应的图元类。7.根据权利要求6所述的一种安全平台的联锁控显系统，其特征在于，所述数据初始化模块进行数据初始化，包括以下步骤：读取原始配置数据，获取图元的宽和高，以图元左上角为原点进行绘制，将图元的坐标映射到场景坐标系中，图元放入容器进行管理；根据读取的原始配置数据获取每个图元在场景类中的刷新区域。8.根据权利要求6所述的一种安全平台的联锁控显系统，其特征在于，所述图元模块，通过场景类对初始化后的图元类进行图元更新，包括以下步骤：检测设备状态，如果有变化触发图元更新；判断Manage传递的状态变化标志是否触发，有变化则设置刷新标志；进行设备局部刷新，刷新视图对应的图元。9.根据权利要求6所述的一种安全平台的联锁控显系统，其特征在于，所述显示模块对更新后的图元通过视图类进行展示，包括以下步骤：指定一块区域装载所有的图元元素和图元之间的逻辑；图元嵌入场景中，默认场景原点与图元原点对齐；场景坐标映射到视图上，显示场景对应的图元。10.根据权利要求6所述的一种安全平台的联锁控显系统，其特征在于，所述操作模块，传递用户操作鼠标事件，包括以下步骤：通过操作模块输入用户操作信号；视图接收用户操作鼠标事件；视图将用户操作鼠标事件传递给场景；场景将用户操作鼠标事件传递给获得焦点的图元，如果焦点消失则用户操作鼠标事件丢弃。11.根据权利要求6-10任一项所述的一种安全平台的联锁控显系统，其特征在于，所述MMI主框架模块，还分别连接有DOG软件狗模块、CBI网络通信库模块、MMI_COMMDLL库模块、STP_Comm库模块；所述DOG软件狗模块，用于监控MMI主框架模块运行；所述CBI网络通信库模块，用于实现控显软件与联锁逻辑部和维护机的网络通信；所述MMI_COMMDLL库模块，用于为CTC接口通信模块，实现与CTC网络通信；所述STP_Comm库模块，用于为STP接口通信模块，实现与STP网络通信；所述MMI主框架模块，还用于控显MMI主框架程序动态加载或静态编译其它所有功能库，实现控显软件所有需求定义的功能项。
说明书desc
技术领域本发明属于联锁控显技术领域，特别涉及一种安全平台的联锁控显方法及系统。背景技术计算机联锁系统的控显子系统基于windows平台实现了联锁系统的人机接口功能。控显软件为车务人员控制列车运行提供了直接的人机操作界面，车务人员需要监视观察图形界面，根据界面上显示的各种状态，进行各种调车进路和列车进路的排列和取消工作。控显进程可以自动统计破铅封操作，车务人员可以通过相应界面读取统计结果。目前国际冲突日益激烈，铁路信号设备深度自主化势在必行。现有计算机联锁的控显机均是基于国外平台，为实现铁路信号系统的自主化需要自主化安全平台上实现控显功能，原有控显软件无法在自主化安全平台上直接处理原始数据进行站场图显示和操作。发明内容针对背景技术中的问题，本发明提出一种安全平台的联锁控显方法及系统。为了实现上述目的，本发明采用以下技术方案：一种安全平台的联锁控显方法，包括以下步骤：数据初始化，将原始配置数据中读取的图元进行各图元类的初始化，并存入场景类中，把场景类添加到视图类；场景类对初始化后的图元类进行图元更新；更新后的图元通过视图类进行展示；往视图类输入用户操作鼠标事件，并传递给场景类，场景类将鼠标事件传递给相应的图元类。优选的，数据初始化，包括以下步骤：读取原始配置数据，获取图元的宽和高，以图元左上角为原点进行绘制，将图元的坐标映射到场景坐标系中，图元放入容器进行管理；根据读取的原始配置数据获取每个图元在场景类中的刷新区域。优选的，场景类对初始化后的图元类进行图元更新，包括以下步骤：检测设备状态，如果有变化触发图元更新，图元更新采用双缓存机制；判断Manage传递的状态变化标志是否触发，有变化则设置刷新标志；进行设备局部刷新，刷新视图对应的图元。优选的，更新后的图元通过视图类进行展示，包括以下步骤：指定一块区域装载所有的图元元素和图元之间的逻辑；图元嵌入场景中，默认场景原点与图元原点对齐；场景坐标映射到视图上，显示场景对应的图元。优选的，传递用户操作鼠标事件，包括以下步骤：输入用户操作鼠标事件；视图接收用户操作鼠标事件；视图将用户操作鼠标事件传递给场景；场景将事件传递给获得焦点的图元，如果焦点消失则事件丢弃。一种安全平台的联锁控显系统，包括MMI主框架模块、显示模块和操作模块；MMI主框架程序包括数据初始化模块和图元模块；数据初始化模块，用于数据初始化，将原始配置数据中读取的图元进行各图元类的初始化，并存入场景类中，把场景类添加到视图类；图元模块，用于场景类对初始化后的图元类进行图元更新；显示模块，用于对更新后的图元通过视图类进行展示；操作模块，用于往视图类输入用户操作鼠标事件，并传递给场景类，场景类将鼠标事件传递给相应的图元类。优选的，数据初始化模块进行数据初始化，包括以下步骤：读取原始配置数据，获取图元的宽和高，以图元左上角为原点进行绘制，将图元的坐标映射到场景坐标系中，图元放入容器进行管理；根据读取的原始配置数据获取每个图元在场景类中的刷新区域。优选的，图元模块，通过场景类对初始化后的图元类进行图元更新，包括以下步骤：检测设备状态，如果有变化触发图元更新；判断Manage传递的状态变化标志是否触发，有变化则设置刷新标志；进行设备局部刷新，刷新视图对应的图元。优选的，显示模块对更新后的图元通过视图类进行展示，包括以下步骤：指定一块区域装载所有的图元元素和图元之间的逻辑；图元嵌入场景中，默认场景原点与图元原点对齐；场景坐标映射到视图上，显示场景对应的图元。优选的，操作模块，传递用户操作鼠标事件，包括以下步骤：通过操作模块输入用户操作信号；视图接收用户操作鼠标事件；视图将用户操作鼠标事件传递给场景；场景将用户操作鼠标事件传递给获得焦点的图元，如果焦点消失则用户操作鼠标事件丢弃。优选的，MMI主框架模块，还分别连接有DOG软件狗模块、CBI网络通信库模块、MMI_COMMDLL库模块、STP_Comm库模块；DOG软件狗模块，用于监控MMI主框架模块运行；CBI网络通信库模块，用于实现控显软件与联锁逻辑部和维护机的网络通信；MMI_COMMDLL库模块，用于为CTC接口通信模块，实现与CTC网络通信；STP_Comm库模块，用于为STP接口通信模块，实现与STP网络通信；MMI主框架模块，还用于控显MMI主框架程序动态加载或静态编译其它所有功能库，实现控显软件所有需求定义的功能项。本发明的有益效果：1、本发明实现一种可应用于自主化安全平台的联锁控显方法及系统，高效地实现了联锁控显机的自主化开发；2、本发明提出了一种图形刷新和绘制方法，使控显系统可以直接处理原始数据进行站场图显示和操作。本发明的其它特征和优点将在随后的说明书中阐述，并且，部分地从说明书中变得显而易见，或者通过实施本发明而了解。本发明的目的和其他优点可通过在说明书、权利要求书以及附图中所指出的结构来实现和获得。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作一简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1示出了本发明的一种安全平台的联锁控显方法流程图；图2示出了本发明的一种安全平台的联锁控显系统的顶层模块框架图；图3示出了控显总体框架流程图；图4示出了图形刷新及绘制流程图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地说明，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。一种安全平台的联锁控显方法，如图1所示，包括以下步骤：数据初始化，将原始配置数据中读取的图元进行各图元类的初始化，并存入场景类中，把场景类添加到视图类；场景类对初始化后的图元类进行图元更新；更新后的图元通过视图类进行展示；视图类接收用户操作鼠标事件，并传给场景类，场景类将鼠标事件传递给相应的图元类。需要说明的是，图元类是对象的模板，每个图元是图元类的实例，同理场景是场景类的实例，视图是视图类的实例。需要说明的是，图元指图形元素，视图是将场景的内容可视化。需要说明的是，上述控显方法主要功能是绘制各种类型，不同状态的设备；发送屏幕更新消息给窗口视图以及响应系统更新消息，更新变化区域。进一步地，数据初始化，包括以下步骤：读取原始配置数据，获取图元的宽和高，以图元左上角为原点进行绘制，将图元的坐标映射到场景坐标系中，图元放入容器进行管理；根据读取的原始配置数据获取每个图元在场景类中的刷新区域。需要说明的是，图元类对象判断刷新标志，需要刷新时进行该图元的局部刷新。进一步地，场景类对初始化后的图元类进行图元更新，包括以下步骤：检测设备状态，如果有变化触发图元更新，图元更新采用双缓存机制；判断Manage传递的状态变化标志是否触发，有变化则设置刷新标志；进行设备局部刷新，刷新视图对应的图元。需要说明的是，图元更新采用双缓存机制是指每个设备图元类对象具有一个绘图画布，图元类对象先将需要显示的图元绘制在绘图画布上，然后在需要更新图元显示时，触发场景重绘。需要说明的是，场景类对象会触发图元类的绘图事件，将画布绘制到在该图元的指定刷新区域上。进一步地，更新后的图元通过视图类进行展示，包括以下步骤：指定一块区域装载所有的图元元素和图元之间的逻辑；图元嵌入场景中，默认场景原点与图元原点对齐；场景坐标映射到视图上，显示场景对应的图元。需要说明的是，图元与图元之间是相互联系的，不同的图元之间有逻辑关系。进一步地，传递用户操作鼠标事件，包括以下步骤：输入用户操作鼠标事件；视图接收用户操作鼠标事件；视图将用户操作鼠标事件传递给场景；场景将用户操作鼠标事件传递给获得焦点的图元，如果焦点消失则用户操作鼠标事件丢弃。需要说明的是，输入用户操作信号一般是人为输入，该处理用户操作信号的步骤与图元通过视图类进行展示的步骤没有先后关系，可以并行。一种安全平台的联锁控显系统，包括MMI主框架模块、显示模块和操作模块；MMI主框架程序包括数据初始化模块和图元模块；数据初始化模块，用于数据初始化，将原始配置数据中读取的图元进行各图元类的初始化，并存入场景类中，把场景类添加到视图类；图元模块，用于场景类对初始化后的图元类进行图元更新；显示模块，用于对更新后的图元通过视图类进行展示；操作模块，用于视图类接收用户操作鼠标事件，并传给场景类，场景类将鼠标事件传递给相应的图元类。进一步地，如图2所示，MMI主框架模块，还分别连接有DOG软件狗模块、CBI网络通信库模块、MMI_COMMDLL库模块、STP_Comm库模块；DOG软件狗模块，用于监控MMI主框架模块运行；CBI网络通信库模块，用于实现控显软件与联锁逻辑部和维护机的网络通信；MMI_COMMDLL库模块，用于为CTC接口通信模块，实现与CTC网络通信；STP_Comm库模块，用于为STP接口通信模块，实现与STP网络通信；MMI主框架模块，还用于控显MMI主框架程序动态加载或静态编译其它所有功能库，实现控显软件所有需求定义的功能项。需要说明的是，上述模块基于国产自主化安全平台的控显机软件顶层结构由若干个功能模块库或执行程序组成，每个模块库负责实现相对独立的逻辑功能，若干个功能模块交互配合实现一系列业务逻辑。控显软件外部接口分别有操作员、联锁逻辑部、联锁维护机、CTC系统、STP系统。需要说明的是，该控显系统总的原理是通过定时器，定期收联锁反馈收据，发送控制数据，解析数据，刷新变化，从而实现操作显示控制。需要说明的是，如图3所示，控显总体的框架流程可以分为多条路径：软件初始化生成基本站场图—界面消息响应—图形更新—图形刷新；软件初始化生成基本站场图—界面消息响应—按钮点击—图形刷新；软件初始化生成基本站场图—界面消息响应—按钮点击—命令发生—网络数据发送；软件初始化生成基本站场图—定时器处理—网络数据发送；软件初始化生成基本站场图—定时器处理—网络数据接收—数据读取、解析—数据刷新。需要说明的是，如图4所示，显示模块包括显示器，操作模块包括鼠标。尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的精神和范围。
