标题title
一种分割引导的磁共振图像脊柱关键参数自动测量方法
摘要abst
本发明公开了一种分割引导的磁共振图像脊柱关键参数自动测量方法，方法包括：通过分割编码器和分割解码器组成分割支路；所述分割支路用于将输入的图像数据进行分割，得到分割结果和多尺度分割特征；通过回归编码器和全连接层组成回归支路；其中，所述回归编码器根据所述多尺度分割特征，通过分割引导的注意力模块提取到注意力感知的回归特征；所述全连接层用于输出估计得到的关键参数。本发明提高了效率和精度，可广泛应用于图像处理技术领域。
权利要求书clms
1.一种分割引导的磁共振图像脊柱关键参数自动测量方法，其特征在于，包括：通过分割编码器和分割解码器组成分割支路；所述分割支路用于将输入的图像数据进行分割，得到分割结果和多尺度分割特征；通过回归编码器和全连接层组成回归支路；其中，所述回归编码器根据所述多尺度分割特征，通过分割引导的注意力模块提取到注意力感知的回归特征；所述全连接层用于输出估计得到的关键参数。2.根据权利要求1所述的一种分割引导的磁共振图像脊柱关键参数自动测量方法，其特征在于，所述分割引导的注意力模块包括由分割引导的通道注意力模块和分割引导的空间注意力模块；所述方法还包括：所述多尺度分割特征输入分割引导的通道注意力模块后，得到变换后的分割特征；根据所述分割特征，输出通道注意力图。3.根据权利要求2所述的一种分割引导的磁共振图像脊柱关键参数自动测量方法，其特征在于，所述方法还包括：所述多尺度分割特征输入经过分割引导的空间注意力模块后，得到空间注意力图；将所述回归特征经过卷积层和批归一化层的处理，得到变换后的回归特征；根据所述变换后的回归特征、所述通道注意力图以及所述空间注意力图，得到注意力感知的回归特征。4.根据权利要求2所述的一种分割引导的磁共振图像脊柱关键参数自动测量方法，其特征在于，将多尺度分割特征输入分割引导的通道注意力模块后，得到变换后的分割特征这一过程的表达式为：其中，代表变换后的分割特征；i代表第i个尺度；comv代表卷积层；BN代表批归一化；Relu代表线性整流函数。5.根据权利要求4所述的一种分割引导的磁共振图像脊柱关键参数自动测量方法，其特征在于，所述根据所述分割特征，输出通道注意力图这一过程的表达式为：其中，代表通道注意力图；代表第i个尺度；代表变换后的分割特征；MaxPool代表最大池化；MLP代表多层感知器；AvgPool代表平均池化；sigmoid代表sigmoid激活函数。6.根据权利要求3所述的一种分割引导的磁共振图像脊柱关键参数自动测量方法，其特征在于，所述多尺度分割特征输入经过分割引导的空间注意力模块后，得到空间注意力图这一过程的表达式为：其中，代表空间注意力图；i代表第i个尺度；代表变换后的分割特征；MaxPool代表最大池化；conv代表卷积层；BN代表批归一化；sigmoid代表sigmoid激活函数。7.根据权利要求3所述的一种分割引导的磁共振图像脊柱关键参数自动测量方法，其特征在于，所述得到变换后的回归特征的表达式为：所述得到注意力感知的回归特征的表达式为：其中，代表所述卷积层和批归一化层的处理后的回归特征；i代表第i个尺度；代表所述卷积层和批归一化层的处理前的回归特征；conv代表卷积层；BN代表批归一化；Relu代表线性整流函数；代表空间注意力图；代表通道注意力图。8.一种分割引导的磁共振图像脊柱关键参数自动测量装置，其特征在于，包括：第一模块，用于通过分割编码器和分割解码器组成分割支路；所述分割支路用于将输入的图像数据进行分割，得到分割结果和多尺度分割特征；第二模块，用于通过回归编码器和全连接层组成回归支路；其中，所述回归编码器根据所述多尺度分割特征，通过分割引导的注意力模块提取到注意力感知的回归特征；所述全连接层用于输出估计得到的关键参数。9.一种电子设备，其特征在于，包括处理器以及存储器；所述存储器用于存储程序；所述处理器执行所述程序实现如权利要求1至7中任一项所述的方法。10.一种计算机可读存储介质，其特征在于，所述存储介质存储有程序，所述程序被处理器执行实现如权利要求1至7中任一项所述的方法。
说明书desc
技术领域本发明涉及图像处理技术领域，尤其是一种分割引导的磁共振图像脊柱关键参数自动测量方法。背景技术椎管狭窄按部位可分为中央椎管狭窄、侧隐窝狭窄，以及椎间孔狭窄。一般而言，椎间盘突出、骨赘形成，以及黄韧带肥厚等椎关节的改变，是椎管狭窄的主要原因。这些病理性的改变常引起腰腿疼痛、刺痛、间歇性跛行等神经症状，严重影响人们健康和生活水平。椎管狭窄的位置以及狭窄程度会影响治疗方案的选择。在横断位磁共振图像中测量椎管两个前后径、左椎间孔宽度、右椎间孔宽度等脊柱关键参数，可为椎管狭窄诊断、椎间盘突出分级提供量化分析依据。现有磁共振图像脊柱关键参数测量方法可分为三种：基于分割的方法、基于关键点检测的方法、基于直接测量的方法。基于分割的方法通常包含脊柱结构分割和关键点检测两个步骤，这两个步骤可以通过手动或者自动来实现，由于手动分割和手动标注关键点很耗时、主观性强，手动测量方法在临床上适用性不大。有学者通过采用深度学习的方法对脊柱结构进行自动分割，然后通过曲线演化方法优化脊柱结构的重要边界，最后通过设计好的规则，让计算机检测出关键点，根据关键点坐标计算出脊柱关键参数，由于重要边界的优化过程是在超分辨率图像上进行，所以测量精度能达到亚像素级别。基于关键点检测的方法通过预测关键点的热图，然后根据热图的峰值得到关键点坐标，最后计算出脊柱关键参数，这类方法常用于Cobb角的计算，在横断位磁共振图像脊柱关键参数测量中较为罕见。基于直接测量的方法把脊柱关键参数测量看作一个回归问题，预测模型直接输出所测量的脊柱关键参数值，这类方法在矢状位和横断位磁共振图像脊柱关键参数测量中都较为常见。对于上述现有的参数测量方法，其中，基于分割的方法需要通过曲线演化的方法对脊柱结构重要边界进行优化，这一过程需要迭代运算、计算时间长，计算效率有待提高。基于关键点检测的方法无法做到亚像素级别的测量精度，测量精度直接受图像空间分辨力以及关键点检测误差的影响，测量精度无法满足临床需求。基于直接测量的方法容易过拟合，测量精度无法满足临床需求。发明内容有鉴于此，本发明实施例提供一种效率高且精度高的，分割引导的磁共振图像脊柱关键参数自动测量方法。本发明实施例的一方面提供了一种分割引导的磁共振图像脊柱关键参数自动测量方法，包括：通过分割编码器和分割解码器组成分割支路；所述分割支路用于将输入的图像数据进行分割，得到分割结果和多尺度分割特征；通过回归编码器和全连接层组成回归支路；其中，所述回归编码器根据所述多尺度分割特征，通过分割引导的注意力模块提取到注意力感知的回归特征；所述全连接层用于输出估计得到的关键参数。可选地，所述分割引导的注意力模块包括由分割引导的通道注意力模块和分割引导的空间注意力模块；所述方法还包括：所述多尺度分割特征输入分割引导的通道注意力模块后，得到变换后的分割特征；根据所述分割特征，输出通道注意力图。可选地，所述方法还包括：所述多尺度分割特征输入经过分割引导的空间注意力模块后，得到空间注意力图；将所述回归特征经过卷积层和批归一化层的处理，得到变换后的回归特征；根据所述变换后的回归特征、所述通道注意力图以及所述空间注意力图，得到注意力感知的回归特征。可选地，将多尺度分割特征输入分割引导的通道注意力模块后，得到变换后的分割特征这一过程的表达式为：其中，代表变换后的分割特征；i代表第i个尺度；conv代表卷积层；BN代表批归一化；Relu代表线性整流函数。可选地，所述根据所述分割特征，输出通道注意力图这一过程的表达式为：其中，代表通道注意力图；代表第i个尺度；代表变换后的分割特征；MaxPook代表最大池化；MLP代表多层感知器；AvgPool代表平均池化；sigmoid代表sigmoid激活函数。可选地，所述多尺度分割特征输入经过分割引导的空间注意力模块后，得到空间注意力图这一过程的表达式为：其中，代表空间注意力图；i代表第i个尺度；代表变换后的分割特征；MaxPool代表最大池化；conv代表卷积层；BN代表批归一化；sigmoid代表sigmoid激活函数。可选地，所述得到变换后的回归特征的表达式为：所述得到注意力感知的回归特征的表达式为：其中，代表所述卷积层和批归一化层的处理后的回归特征；i代表第i个尺度；代表所述卷积层和批归一化层的处理前的回归特征；conv代表卷积层；BN代表批归一化；Relu代表线性整流函数；代表空间注意力图；代表通道注意力图。本发明实施例的另一方面还提供了一种分割引导的磁共振图像脊柱关键参数自动测量装置，包括：第一模块，用于通过分割编码器和分割解码器组成分割支路；所述分割支路用于将输入的图像数据进行分割，得到分割结果和多尺度分割特征；第二模块，用于通过回归编码器和全连接层组成回归支路；其中，所述回归编码器根据所述多尺度分割特征，通过分割引导的注意力模块提取到注意力感知的回归特征；所述全连接层用于输出估计得到的关键参数。本发明实施例的另一方面还提供了一种电子设备，包括处理器以及存储器；所述存储器用于存储程序；所述处理器执行所述程序实现如前面所述的方法。本发明实施例的另一方面还提供了一种计算机可读存储介质，所述存储介质存储有程序，所述程序被处理器执行实现如前面所述的方法。本发明实施例还公开了一种计算机程序产品或计算机程序，该计算机程序产品或计算机程序包括计算机指令，该计算机指令存储在计算机可读存储介质中。计算机设备的处理器可以从计算机可读存储介质读取该计算机指令，处理器执行该计算机指令，使得该计算机设备执行前面的方法。本发明的实施例通过分割编码器和分割解码器组成分割支路；所述分割支路用于将输入的图像数据进行分割，得到分割结果和多尺度分割特征；通过回归编码器和全连接层组成回归支路；其中，所述回归编码器根据所述多尺度分割特征，通过分割引导的注意力模块提取到注意力感知的回归特征；所述全连接层用于输出估计得到的关键参数。本发明提高了效率和精度。附图说明为了更清楚地说明本申请实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本申请的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例的整体方法的框架示意图；图2为本发明实施例的分割引导的注意力模块的结构图。具体实施方式为了使本申请的目的、技术方案及优点更加清楚明白，以下结合附图及实施例，对本申请进行进一步详细说明。应当理解，此处所描述的具体实施例仅仅用以解释本申请，并不用于限定本申请。针对现有技术存在的问题，本发明实施例的一方面提供了一种分割引导的磁共振图像脊柱关键参数自动测量方法，包括：通过分割编码器和分割解码器组成分割支路；所述分割支路用于将输入的图像数据进行分割，得到分割结果和多尺度分割特征；通过回归编码器和全连接层组成回归支路；其中，所述回归编码器根据所述多尺度分割特征，通过分割引导的注意力模块提取到注意力感知的回归特征；所述全连接层用于输出估计得到的关键参数。可选地，所述分割引导的注意力模块包括由分割引导的通道注意力模块和分割引导的空间注意力模块；所述方法还包括：所述多尺度分割特征输入分割引导的通道注意力模块后，得到变换后的分割特征；根据所述分割特征，输出通道注意力图。可选地，所述方法还包括：所述多尺度分割特征输入经过分割引导的空间注意力模块后，得到空间注意力图；将所述回归特征经过卷积层和批归一化层的处理，得到变换后的回归特征；根据所述变换后的回归特征、所述通道注意力图以及所述空间注意力图，得到注意力感知的回归特征。可选地，将多尺度分割特征输入分割引导的通道注意力模块后，得到变换后的分割特征这一过程的表达式为：其中，代表变换后的分割特征；i代表第i个尺度；conv代表卷积层；BN代表批归一化；Relu代表线性整流函数。可选地，所述根据所述分割特征，输出通道注意力图这一过程的表达式为：其中，代表通道注意力图；i代表第i个尺度；代表变换后的分割特征；MaxPool代表最大池化；MLP代表多层感知器；AvgPool代表平均池化；sigmoid代表sigmoid激活函数。可选地，所述多尺度分割特征输入经过分割引导的空间注意力模块后，得到空间注意力图这一过程的表达式为：其中，代表空间注意力图；i代表第i个尺度；代表变换后的分割特征；MaxPool代表最大池化；conv代表卷积层；BN代表批归一化；sigmoid代表sigmoid激活函数。可选地，所述得到变换后的回归特征的表达式为：所述得到注意力感知的回归特征的表达式为：其中，代表所述卷积层和批归一化层的处理后的回归特征；i代表第i个尺度；代表所述卷积层和批归一化层的处理前的回归特征；conv代表卷积层；BN代表批归一化；Relu代表线性整流函数；代表空间注意力图；代表通道注意力图。本发明实施例的另一方面还提供了一种分割引导的磁共振图像脊柱关键参数自动测量装置，包括：第一模块，用于通过分割编码器和分割解码器组成分割支路；所述分割支路用于将输入的图像数据进行分割，得到分割结果和多尺度分割特征；第二模块，用于通过回归编码器和全连接层组成回归支路；其中，所述回归编码器根据所述多尺度分割特征，通过分割引导的注意力模块提取到注意力感知的回归特征；所述全连接层用于输出估计得到的关键参数。本发明实施例的另一方面还提供了一种电子设备，包括处理器以及存储器；所述存储器用于存储程序；所述处理器执行所述程序实现如前面所述的方法。本发明实施例的另一方面还提供了一种计算机可读存储介质，所述存储介质存储有程序，所述程序被处理器执行实现如前面所述的方法。本发明实施例还公开了一种计算机程序产品或计算机程序，该计算机程序产品或计算机程序包括计算机指令，该计算机指令存储在计算机可读存储介质中。计算机设备的处理器可以从计算机可读存储介质读取该计算机指令，处理器执行该计算机指令，使得该计算机设备执行前面的方法。下面结合说明书附图，对本发明的关键参数自动测量方法的具体实现过程进行详细描述：针对现有技术存在的问题，本发明提出的分割引导的磁共振图像脊柱关键参数自动测量方法同时实现脊柱结构分割和脊柱关键参数自动测量，推理阶段不需要迭代，运行时间短，测量精度能达到亚像素级别，能够满足椎管狭窄诊断系统、椎间盘突出分级系统的应用要求。具体地，本发明方法框架如图1所示，其由图中上端的分割支路和下端的回归支路组成，分割支路由分割编码器和解码器组成，输入图像经过分割支路后，输出分割结果和多尺度的分割特征回归支路由回归编码器和全连接层组成，在多尺度分割特征引导下，回归编码器通过分割引导的注意力模块提取到注意力感知的回归特征最后通过全连接层输出所估计的关键参数分割引导的注意力模块：SGAM结构如图2所示，其由分割引导的通道注意力模块和分割引导的空间注意力模块组成。分割特征输入分割引导的通道注意力模块后，得到变换后的分割特征最后输出通道注意力图可用以下公式表示：经过分割引导的空间注意力模块后，得到空间注意力图回归特征经过卷积层Conv和批归一化层，得到变换后的回归特征最后注意力感知的回归特征数学表达式为：综上所述，相较于现有技术，本发明具有以下两大特点：1.分割引导的脊柱关键参数测量框架：本发明首次提出了分割引导的脊柱关键参数测量框架，可以对横断位磁共振图像的脊柱关键参数进行准确的自动测量，为椎管狭窄诊断系统、椎间盘突出诊断系统提供核心算法和有效工具。2.分割引导的注意力模块：本发明首次提出了分割引导的注意力模块，该模块可以提取注意力感知的回归特征，使回归网络重点关注与任务相关的区域，缓解回归网络过拟合，同时提高脊柱关键参数测量的精度和方法的可解释性。本发明在推理阶段不需要迭代，算法运行时间短，对脊柱关键参数测量精度高。在一些可选择的实施例中，在方框图中提到的功能/操作可以不按照操作示图提到的顺序发生。例如，取决于所涉及的功能/操作，连续示出的两个方框实际上可以被大体上同时地执行或所述方框有时能以相反顺序被执行。此外，在本发明的流程图中所呈现和描述的实施例以示例的方式被提供，目的在于提供对技术更全面的理解。所公开的方法不限于本文所呈现的操作和逻辑流程。可选择的实施例是可预期的，其中各种操作的顺序被改变以及其中被描述为较大操作的一部分的子操作被独立地执行。此外，虽然在功能性模块的背景下描述了本发明，但应当理解的是，除非另有相反说明，所述的功能和/或特征中的一个或多个可以被集成在单个物理装置和/或软件模块中，或者一个或多个功能和/或特征可以在单独的物理装置或软件模块中被实现。还可以理解的是，有关每个模块的实际实现的详细讨论对于理解本发明是不必要的。更确切地说，考虑到在本文中公开的装置中各种功能模块的属性、功能和内部关系的情况下，在工程师的常规技术内将会了解该模块的实际实现。因此，本领域技术人员运用普通技术就能够在无需过度试验的情况下实现在权利要求书中所阐明的本发明。还可以理解的是，所公开的特定概念仅仅是说明性的，并不意在限制本发明的范围，本发明的范围由所附权利要求书及其等同方案的全部范围来决定。所述功能如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本发明的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台计算机设备执行本发明各个实施例所述方法的全部或部分步骤。而前述的存储介质包括：U盘、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质。在流程图中表示或在此以其他方式描述的逻辑和/或步骤，例如，可以被认为是用于实现逻辑功能的可执行指令的定序列表，可以具体实现在任何计算机可读介质中，以供指令执行系统、装置或设备使用，或结合这些指令执行系统、装置或设备而使用。就本说明书而言，“计算机可读介质”可以是任何可以包含、存储、通信、传播或传输程序以供指令执行系统、装置或设备或结合这些指令执行系统、装置或设备而使用的装置。计算机可读介质的更具体的示例包括以下：具有一个或多个布线的电连接部、便携式计算机盘盒、随机存取存储器、只读存储器、可擦除可编辑只读存储器、光纤装置以及便携式光盘只读存储器。另外，计算机可读介质甚至可以是可在其上打印所述程序的纸或其他合适的介质，因为可以例如通过对纸或其他介质进行光学扫描，接着进行编辑、解译或必要时以其他合适方式进行处理来以电子方式获得所述程序，然后将其存储在计算机存储器中。应当理解，本发明的各部分可以用硬件、软件、固件或它们的组合来实现。在上述实施方式中，多个步骤或方法可以用存储在存储器中且由合适的指令执行系统执行的软件或固件来实现。例如，如果用硬件来实现，和在另一实施方式中一样，可用本领域公知的下列技术中的任一项或他们的组合来实现：具有用于对数据信号实现逻辑功能的逻辑门电路的离散逻辑电路，具有合适的组合逻辑门电路的专用集成电路，可编程门阵列，现场可编程门阵列等。在本说明书的描述中，参考术语“一个实施例”、“一些实施例”、“示例”、“具体示例”、或“一些示例”等的描述意指结合该实施例或示例描述的具体特征、结构、材料或者特点包含于本发明的至少一个实施例或示例中。在本说明书中，对上述术语的示意性表述不一定指的是相同的实施例或示例。而且，描述的具体特征、结构、材料或者特点可以在任何的一个或多个实施例或示例中以合适的方式结合。尽管已经示出和描述了本发明的实施例，本领域的普通技术人员可以理解：在不脱离本发明的原理和宗旨的情况下可以对这些实施例进行多种变化、修改、替换和变型，本发明的范围由权利要求及其等同物限定。以上是对本发明的较佳实施进行了具体说明，但本发明并不限于所述实施例，熟悉本领域的技术人员在不违背本发明精神的前提下还可做出种种的等同变形或替换，这些等同的变形或替换均包含在本申请权利要求所限定的范围内。
