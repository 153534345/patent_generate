标题title
一种基于多天线的PDOA估计与片内数据融合方法
摘要abst
本发明公开了一种基于多天线的PDOA估计与片内数据融合方法，包括对于每一根天线对应的ADC数据分别与本地序列进行互相关计算；首径检测，并根据第一路径检测输出的结果，以符号长度为周期提取每一路的互相关结果；提取的每一分路的互相关结果分别与主路的互相关结果共轭相乘，并求解对应的相位差；同时利用更新后的相位差对每一分路相位差补偿；对每一分路数据进行时延补偿；对补偿后的数据进行叠加并归一化处理，得到合并后的数据；PDOA估计使能信号拉低后，PDOA结果锁定，利用锁定后的相位差以及天线的延时值计算出PDOA。对多天线的数据进行片内处理，消除了载波频偏以及采样频偏对PDOA估计结果的影响，极大的提高了PDOA的估计精度，利用相位差的估计结果以及其对应的延时对从路数据进行修正，然后对修正后的从路数据与主路数据进行合并一路数据，降低了基带处理的复杂度。
权利要求书clms
1.一种基于多天线的PDOA估计与片内数据融合方法，其特征在于，所述方法包括以下步骤：步骤1，对于每一根天线对应的ADC数据分别与本地序列进行互相关计算；步骤2，首径检测，并根据第一路径检测输出的结果，以符号长度为周期提取每一路的互相关结果；步骤3，提取的每一分路的互相关结果分别与主路的互相关结果共轭相乘，并根据共轭相乘的结果求出相位，得到每一分路相对于主路的相位差；步骤4，每一个符号计算的相位差，以符号长度为周期，通过卡尔曼滤波的方法进行修正并更新；步骤5，同时利用更新后的相位差对每一分路相对主路之间的相位差补偿；步骤6，利用更新后的相位差计算出每一分路相对于主路的采样时延，并对每一分路数据进行时延补偿；步骤7，对补偿后的数据进行叠加并归一化处理，得到合并后的数据；步骤8，PDOA估计使能信号拉低后，PDOA结果锁定，利用锁定后的相位差以及天线的延时值计算出PDOA。2.根据权利要求1所述的基于多天线的PDOA估计与片内数据融合方法，其特征在于，所述步骤4中，每一个符号计算的相位差，以符号长度为周期，通过卡尔曼滤波的方法进行修正并更新，修正并更新的方法如下：其中，为第m个符号的更新后结果，第m+1个符号的估计结果，为第m+1个符号的更新后结果，kG为第m+1个符号的增益系数。3.根据权利要求1所述的基于多天线的PDOA估计与片内数据融合方法，其特征在于，所述步骤6中，利用更新后的相位差计算出每一分路相对于主路的采样时延：其中，为Sn分路天线的第m个符号相对于主路天线的相位差，fc为载波频率，根据主从天线相对延时不同，ΔtSn的估计结果应该在一个范围内+＜ΔtSn＜1/+)，如果不在预设的范围内，需要加或减1/fc，将ΔtSn调整到预设范围内，其中tSn为Sn分路天线对应的天线延时，tM为主路天线对应的天线延时。4.根据权利要求1所述的基于多天线的PDOA估计与片内数据融合方法，其特征在于，所述步骤6中，对每一分路数据进行时延补偿，其方法：首先通过时间差ΔtSn与对比，判断该分路相对于主路是超前还是滞后，对于分路数据超前于主路数据，补偿方法如下：其中，Δts为采样间隔时间，n为一个符号中的第n个采样点，N表示一个符号的采样点数，s'n为Sn分路天线在t时刻的经过相位补偿后的数据，ΔtSn为Sn分路天线数据相对于主路数据的延时，s″Sn为延时补偿后t时刻的数据；对于分路数据滞后于主路数据，补偿方法如下：5.根据权利要求1所述的基于多天线的PDOA估计与片内数据融合方法，其特征在于，所述步骤7中，对补偿后的数据进行叠加并归一化处理，得到合并后的数据，其方法：其中sM为主路天线对应的数据，w0为主路天线的权重系数，s″Si～s″Sn为各分路天线对应的数据，w1～wn为各分路天线对应的权重系数。6.根据权利要求1所述的基于多天线的PDOA估计与片内数据融合方法，其特征在于，所述步骤8中，利用锁定后的相位差以及天线的延时值计算出PDOA，其方法如下：其中的范围为-π～π，如果如果
说明书desc
技术领域本发明涉及超宽带通信定位技术 领域，具体涉及一种基于多天线的PDOA估计与片内数据融合方法。背景技术目前基于GNSS的室外定位技术相对成熟，但在室内，由于卫星 信号容易受到遮挡并无法完成正常定位服务并且定位精度不能满足 服务需求。近年来人们对于高精度的定位服务的需求愈加强烈，据统 计，人们70％-80％的活动发生在室内，因此开展室内定位技术有着十 分重要的意义。基于各种不同的需求，许多相应的定位技术已经展现 出来，并取得了不错的效果，例如红外线、射频识别、超声波、WIFI、 蓝牙、Zigbee、视觉定位等技术。然而都有各自的曲线，要么定位精 度低，要么对坏境的要求苛刻，无法满足人们对室内定位感知系统精 度高、环境自适应好的要求。UWB定位技术的诸多有点是的该技术能 够实现高精度的室内定位，相比于其他无线定位技术，UWB具有抗干 扰能力强、带宽极宽、传输速率快、功率消耗小等诸多优势。基于信 号到达角度的定位，由于具有所需基站少、 不要求高精度系统时钟以及计算量小且实时性强，一直作为研究的重 点。AOA需要通过到达相位差 计算得到，然而PDOA的计算需要两根或两根以上的天线计算得到， 对于单天线芯片组成的多天线组，其PDOA的计算需要片外处理，易 受到载波频偏以及采样频偏的影响，而对于多天线芯片，其PDOA的 计算可以在片内处理，其性能要高于单天线芯片组成的多天线组。而 对于多天线芯片，又面临着多天线数据处理的问题，如果并行处理多 天线的数据，会极大的增加基带的复杂度，因此怎样利用多天线带来 的PDOA计算增益的同时，又需要考虑多天线的数据融合是研究的一 个重点。发明内容针对现有技术的不足，本发明旨在提供一种基于多天线的PDOA 估计与片内数据融合方法，本发明利用多天线芯片计算PDOA，消除 了载波频偏以及采样频偏对PDOA估计精度的影响，通过利用相位差 的估计结果以及其对应的延时对从路数据进行修正，然后对修正后的 从路数据与主路数据进行合并一路数据，最终基带只需要处理一路数 据，极大降低了基带的复杂度。为了实现上述目的，本发明采用如下技术方案：一种基于多天线的PDOA估计与片内数据融合方法，所述方法包 括以下步骤：步骤1，对于每一根天线对应的ADC数据分别与本地序列进行互 相关计算；步骤2，首径检测，并根据第一路径检测输出的结果，以符号长 度为周期提取每一路的互相关结果；步骤3，提取的每一分路的互相关结果分别与主路的互相关结果 共轭相乘，并根据共轭相乘的结果求出相位，得到每一分路相对于主 路的相位差；步骤4，每一个符号计算的相位差，以符号长度为周期，通过卡 尔曼滤波的方法进行修正并更新；步骤5，同时利用更新后的相位差对每一分路相对主路之间的相 位差补偿；步骤6，利用更新后的相位差计算出每一分路相对于主路的采样 时延，并对每一分路数据进行时延补偿；步骤7，对补偿后的数据进行叠加并归一化处理，得到合并后的 数据；步骤8，PDOA估计使能信号拉低后，PDOA结果锁定，利用锁定 后的相位差以及天线的延时值计算出PDOA。需要说明的是，所述步骤4中，每一个符号计算的相位差，以符 号长度为周期，通过卡尔曼滤波的方法进行修正并更新，修正并更新 的方法如下：其中，为第m个符号的更新后结果，第m+ 1个符号的估计结果，为第m+1个符号的更新后结果， kG为第m+1个符号的增益系数。需要说明的是，所述步骤6中，利用更新后的相位差计算出每一 分路相对于主路的采样时延：其中，为Sn分路天线的第m个符号相对于主路天线的相 位差，fc为载波频率，根据主从天线相对延时不同，ΔtSn的估计 结果应该在一个范围内+＜ΔtSn＜1/ +)，如果不在预设的范围内，需要加或减1/fc，将 ΔtSn调整到预设范围内，其中tSn为Sn分路天线对应的天线延时， tM为主路天线对应的天线延时。需要说明的是，所述步骤6中，对每一分路数据进行时延补偿， 其方法：首先通过时间差ΔtSn与对比，判断该分路相对于主 路是超前还是滞后，对于分路数据超前于主路数据，补偿方法如下：其中，Δts为采样间隔时间，n为一个符号中的第n个采样点，N 表示一个符号的采样点数，s′n为Sn分路天线在t时刻的经过相位补 偿后的数据，ΔtSn为Sn分路天线数据相对于主路数据的延时，s″Sn 为延时补偿后t时刻的数据；对于分路数据滞后于主路数据，补偿方法如下：需要说明的是，所述步骤7中，对补偿后的数据进行叠加并归一 化处理，得到合并后的数据，其方法：其中sM为主路天线对应的数据，w0为主路天线的权重系数， s″Si～s″Sn为各分路天线对应的数据，w1～wn为各分路天线对应的 权重系数；需要说明的是，所述步骤8中，利用锁定后的相位差以及天线的 延时值计算出PDOA，其方法如下：其中的范围为-π～π，如果如果本发明有益效果在于：1、对多天线的数据进行片内处理，消除了载波频偏以及采样频 偏对PDOA估计结果的影响，极大的提高了PDOA的估计精度；2、利用相位差的估计结果以及其对应的延时对从路数据进行修 正，然后对修正后的从路数据与主路数据进行合并一路数据，降低了 基带处理的复杂度；3、通过数据合并的方法可以有效提高首径信号的信噪比，从而 能够更加精确的恢复首径信号的脉冲波形，提高其时间分辨率。附图说明图1为本发明基于多天线的PDOA估计与片内数据融合方法的系 统简略图；图2为本发明基于多天线的PDOA估计与片内数据融合方法的系 统架构示意图；图3为本发明基于多天线的PDOA估计与片内数据融合方法的系 统处理流程图；图4为本发明基于多天线的PDOA估计与片内数据融合方法的首 径检测数据流示意图；图5为本发明基于多天线的PDOA估计与片内数据融合方法的首 径检测处理流程图；图6为本发明基于多天线的PDOA估计与片内数据融合方法的首 径搜索方法处理流程图。具体实施方式以下将对本发明作进一步的描述，需要说明的是，以下实施例以 本技术方案为前提，给出了详细的实施方式和具体的操作过程，但本 发明的保护范围并不限于本实施例。需要指出的是，如图1所示，对于多天线，首先定义其中一根天 线为主天线，如天线101，其他天线为从天线，例如天线102和天线 103。主天线对应的数据路径为主路径，从天线对应的数据路径为从 路径。在进行PDOA估计以及数据合并时，都是以主路径作为参考。本发明为一种基于多天线的PDOA估计与片内数据融合方法，所 述方法包括以下步骤：步骤1，对于每一根天线对应的ADC数据分别与本地序列进行互 相关计算；步骤2，首径检测，并根据第一路径检测输出的结果，以符号长 度为周期提取每一路的互相关结果；步骤3，提取的每一分路的互相关结果分别与主路的互相关结果 共轭相乘，并根据共轭相乘的结果求出相位，得到每一分路相对于主 路的相位差；步骤4，每一个符号计算的相位差，以符号长度为周期，通过卡 尔曼滤波的方法进行修正并更新；步骤5，同时利用更新后的相位差对每一分路相对主路之间的相 位差补偿；步骤6，利用更新后的相位差计算出每一分路相对于主路的采样 时延，并对每一分路数据进行时延补偿；步骤7，对补偿后的数据进行叠加并归一化处理，得到合并后的 数据；步骤8，PDOA估计使能信号拉低后，PDOA结果锁定，利用锁定 后的相位差以及天线的延时值计算出PDOA。实施例1需要说明的是，如图2所示，本实施例的处理流程为：三根天线 接收的数据分别经过各自的ADC进行数据采集，采集后的数据分别与 本地序列进行互相关计算，并根据首径索引提取互相关的计算结果计 算相位差，通过卡尔曼滤波的方式对计算的相位差进行跟踪并修正， 根据修正的相差分别对两个从路的数据进行相位补偿，同时根据相位 差计算出从路数据延时的时间差，根据时间差的取值范围对时间进行 修正，根据修正后的时间差分别对两个从路数据进行延时补偿，对补 偿后的两个从路数据与主路数据进行数据合并，最后对合并后的数据进行归一化处理，输出给基带模块。当PDOA计算模块使能后，利用跟踪修正后的相位差 并考虑天线延时差与取值范围分别计算出两个从路相对于主路的相 位差PDOA1和PDOA2。如图3所示，为本实施例的每一步的处理流程，该处理流程共包 含8个步骤，下面结合图2和图3具体介绍每一步的处理过程：S301：对于每一根天线对应的ADC数据分别与本地序列进行互相 关计算；以主路天线为例，互相关计算方法如下：其中，N为一个符号的采样点数，sM为ADC采样的信号，l 为本地信号，rM为互相关后的结果。S302：首径检测，并根据第一路径检测输出的结果，以符 号长度为周期提取每一路的互相关结果；其中，首径检测过程如图4所示，其具体处理流程如图5所示， 结合图3和图4，其具体步骤如下：S501：对主从路的互相关结果进行共轭相乘；主路互相关计算模块201输出结果rM与从路互相关计算模块 202输出结果rS1共轭相乘方法如下：rMS1＝rS1*conj)；其中，conj为取共轭运算；主路互相关计算模块201输出结果rM与从路互相关计算模块 203输出结果rS2共轭相乘方法如下：rMS2＝rS2*conj)；S502：对共轭相乘后的结果，以符号长度为周期进行累加；累加模块403，累加过程的方法如下所示：rcum1＝*rcum1+ωG*rMS1；其中，ωG为权重系数，N为一个符号周期内的采样点数， rcum1上一个符号相同位置处加权累加后的结果；在本实施例中，权重系数取值为：1，1/2，1/2，1/4，1/4，1/4， 1/4，1/8，…；累加模块404，累加过程的方法如下所示：rcum2＝*rcum2+ωG*rMS2；S503：对累加后的结果取绝对值，并对多路数据进行求和合并；该过程方法如下：rcum＝|rcum1|+|rcum2|；S504：利用合并后的数据进行首径检测，并输出首径索引；首径检测的处理流程图，如图6所示，其具体的处理步骤如下：S601：根据求和合并后的数据求动态阈值基数利用累加合并后的数据rcum，开始滑窗计算动态阈值基数， 计算方法如下：其中，N为一个符号周期内的采样点数；S602：根据阈值基数计算动态阈值，计算方法如下：Dth＝dth*rcoef；其中，Dth为数据rcum对应的动态阈值，rcoef为动态阈值 基数转化为动态阈值的比例系数；S603：通过合并数据rcum动态阈值Dth进行比较，前向搜 索首径的上升沿，并根据上升沿检测首径位置；当rcum＞Dth时，为检测到首径的上升沿，并开始首径位 置检测；如果rcum＞rcum＞Dth并且rcum＞ rcum＞Dth，则rcum为检测到首径索引对应的 值，FpIdx＝％N为一个符号周期内首径位置，其中％为取余 操作；S604：当连续三个符号检测到的首径位置相同，则输出首径索引 FpIdx。S303：提取的每一分路的互相关结果分别与主路的互相关结果共 轭相乘，并根据共轭相乘的结果求出相位，得到每一分路相对于主路 的相位差；根据首径索引FpIdx，提取主路互相关模块201输出结果 rM和从路互相关模块202输出结果rS1，共轭相乘计算方法如下：r′MS1＝rS1*conj)；其中，m为首径输出后的第m个符号；同样，根据首径索引FpIdx，提取主路互相关模块201输出结果 rM和从路互相关模块203输出结果rS2，得到共轭相乘后的结果r′MS2根据共轭相乘结果，相位差计算模块204求出每一个分路相对于 主路的相位差的方法如下：同样，相位差计算模块205求出每一个分路相对于主路的相位差 为S304：每一个符号计算的相位差，以符号长度为周期，通过卡尔 曼滤波的方法进行修正并更新；相位差跟踪并修正模块206中的方法如下所示：其中，为第m个符号的更新后结果，第m+ 1个符号的估计结果，为第m+1个符号的更新后结果， kG为第m+1个符号的增益系数；同样，相位差跟踪并修正模块207，其输出的结果可以表示为 S305：同时利用更新后的相位差对每一分路相对主路之间的相位 差补偿；从路1的数据经过相位补偿模块210补偿后的结果为：同样，从路2的数据经过相位补偿模块211补偿后的结果为s′S2S306：利用更新后的相位差计算出每一分路相对于主路的采样时 延，并对每一分路数据进行时延补偿；其中，从路1的数据经过相位差转时间差模块212，其输出结果 计算方法如下：其中，为S1分路天线的第m个符号相对于主路天线的相 位差，fc为载波频率；同样可得，从路2的数据经过相位差转时间差模块213的输出结 果为ΔtS2；根据主从天线相对延时不同，需要对相位差转时间差模块的输出 结果进行修正；假设主路天线的天线延时为tM，从路1天线的天线延时为tS1， 从路2天线的天线延时为tS2；则ΔtS1和ΔtS2的范围分别为+＜ΔtS2＜1/+)和+＜ΔtS2＜1/+)；对于ΔtS1和ΔtS2不在范围内的，需要加或减1/fc，将 ΔtS1和ΔtS2调整到设定的范围内；利用计算的ΔtS1和ΔtS2分别对其对应的从路数据进行补 偿，以ΔtS1为例进行补偿说明；首先通过时间差ΔtS1与对比，判断该分路相对于主 路是超前还是滞后：ΔtS1＜表示该分路数据超前于主路数据，补偿方法 如下：其中，Δts为采样间隔时间；ΔtS1＞表示该分路数据滞后于主路数据，补偿方法 如下：同样的方法，可以得到从路2经过延时补偿后的值为s″S2S307：对补偿后的数据进行叠加并归一化处理，得到合并后的数 据；其方法如下：其中，w0为主路天线数据的权重系数，w1和w2分别为从路天线 数据s″S1和s″S2对应的权重系数；S308：PDOA估计使能信号拉低后，PDOA结果锁定，利用锁定后 的相位差以及天线的延时值计算出PDOA；以从路1为例，利用通过PDOA计算模块208计算主天线101 与从天线102的PDOA的方法如下：其中的范围为-N～π，如果如果同样的方法，利用通过PDOA计算模块209计算主天线101 与从天线103的PDOA为对于本领域的技术人员来说，可以根据以上的技术方案和构思， 给出各种相应的改变和变形，而所有的这些改变和变形，都应该包括 在本发明权利要求的保护范围之内。
