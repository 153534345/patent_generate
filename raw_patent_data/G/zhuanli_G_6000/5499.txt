标题title
一种信号调节电路以及信号偏移自检校正方法
摘要abst
本发明公开了一种信号调节电路以及信号偏移自检校正方法，属于流量计技术领域，包括：自检电路，用于测量驱动线圈电流，计算信号频率及波形对称率；若波形对称率大于设定值，则调整驱动信号放大倍数并以检测线圈为基准评估分析其水平零点位置；若零点垂直偏移达到设定的数值则计算偏移并降低偏移系数；校正电路，与自检电路相连接，用于对自检电路波形对称率小于设定值时计算正波值积分面积以及负波值积分面积，若积分面积为预设的数值，则向下调整垂直参考电压值或向上调整垂直参考电压值；拾取电路,该信号调节电路以及信号偏移自检校正方法，大幅度减少元件负荷并降低运算规格及处理器工作频率，获得高分辨率的相位差。
权利要求书clms
1.一种信号调节电路，其特征在于：包括：自检电路，用于测量驱动线圈电流，计算信号频率及波形对称率；若波形对称率大于设定值，则调整驱动信号放大倍数并以检测线圈为基准评估分析其水平零点位置；若零点垂直偏移达到设定的数值则计算偏移并降低偏移系数；校正电路，与自检电路相连接，用于对自检电路波形对称率小于设定值时计算正波值积分面积以及负波值积分面积，若积分面积为预设的数值，则向下调整垂直参考电压值或向上调整垂直参考电压值；拾取电路，与自检电路相连接，用于拾取检测线圈差分信号并依据自检数据校正其参考电压。2.根据权利要求1所述的一种信号调节电路，其特征在于：所述自检电路包括：串联的电阻R40和电阻R43、连接在电阻R40和电阻R43节点的电阻R112、与电阻R112相连接的运算放大器U8B、与运算放大器U8B并联的电阻R111、与电阻R111并联的电容C74、与运算放大器U8B相连接的电阻R41、连接在电阻R41和运算放大器U8B节点的电容C62和电阻C63、与电阻R41相连接的电容C64、与电容C64相连接的差分电容C69、与差分电容C69相连接的电容C73、连接在差分电容C69和电容C73节点的电阻R49、与电阻R49相连接的放大器U12、与放大器U12相连接的电阻R46和电阻R51、一端连接在电阻R46与放大器U12节点的电阻R44、一端连接在电阻R51与放大器U12节点的电阻R52；其中，所述电阻R44的另一端与电容C63和电阻R41的节点相连接；所述电阻R52的另一端与电阻R49和放大器U12的节点相连接。3.根据权利要求1所述的一种信号调节电路，其特征在于：所述校正电路包括：数字电位器U3、连接在数字电位器U3的第八引脚的电感FB1和电感FB2、连接在电感FB1和电感FB2节点的电容C3、与电容C3并联的电容C1和电容C2、连接在数字电位器U3的的第五引脚的运算放大器U1A、一端在运算放大器U1A的电阻R4、与运算放大器U1A相连接的电阻R8、与电阻R8相连接的运算放大器U1B、并联连接在运算放大器U1B上的电阻R3和电容C4、连接在运算放大器U1B和电阻R3节点的电阻R6、连接在运算放大器U1B上的电阻R10、与电阻R10相连接的电阻R11、连接在电阻R11和电阻R10的电容C7、一端连接与电容C7相连接的电阻R12；其中，所述电阻R12的另一端与运算放大器U1B和电阻R10的节点相连接。4.根据权利要求1所述的一种信号调节电路，其特征在于：所述拾取电路包括：运算放大器U4A、并联在运算放大器U4A的电阻R25和电容C39、与运算放大器U4A相连接的电阻R27、与运算放大器U4A相连接的电阻R28、连接在电阻R28和运算放大器U4A节点的电阻R30、与电阻R30并联的电容C43；运算放大器U4B、并联在运算放大器U4B的电阻R36和电容C48、与运算放大器U4B相连接的电阻R37、与运算放大器U4B相连接的电阻R38、连接在电阻R38和运算放大器U4B节点的电阻R39、与电阻R39并联的电容C53。5.根据权利要求1所述的一种信号调节电路，其特征在于：所述设定值为99%。6.一种基于权利要求1-5中任一所述的信号调节电路的信号偏移自检校正方法，其特征在于：包括：自检步骤：通过电阻R40和电阻R43分压，提供稳定的参考偏移电压，驱动线圈电流由Current_Sens+流出，经放大器U12后由 Current_Sens-流回线圈，参考偏移电压及驱动线圈电流在放大器U12的第三端子、第四端子上将产生一差分信号对，经放大器U12放大后输出为，与参考偏移电压形成差分电压后，经过由电阻R41、电阻R49、差分电容C69共同构成一阶RC滤波器，输出至AIN2、AIN3；驱动线圈电流输入由运算放大器U8B引脚7的电压水平偏移，为非反相输入端的偏移后电压，可由以下公式得到，其中为运算放大器U8B输出的参考偏移电压，为线圈输出电压；放大器U12第一端子的输出通过下列公式得到：一阶RC滤波器前的最终差分电压通过下列公式得到模数转换器输入端使用一阶低通RC滤波器，由电阻R41、电阻R49和差分差分电容C69组成的差分低通RC滤波器设定-3dB截止频率，给定为：最终电流差分信号对AIN2以及 AIN3为处理后的线圈电流，将其输入至一个16bit的电流检测单元即模数转换器，处理器将获取其波形并检查自身波形的对称率。7.根据权利要求6中所述的信号偏移自检校正方法，其特征在于： 所述方法还包括：校正步骤：当需要调整波形的对称率时，调节电压引入运算放大器U1B反相输入端，由波形发生器给出的驱动线圈电压经过由电阻R11与电容C7组成的低通滤波器接入到运算放大器U1B同相输入端，两者组成差分电压后经运算放大器U1B放大输出至TP1，TP1点的电压由下式得出：调节电压是基于实时条件由处理器给出的动态参考电压；电压自运算放大器U1A输出至驱动线圈，通过数字电位器U3可调节运算放大器U1A的放大倍数放大驱动信号；由于为正弦波信号，幅值电压600mV，通过调节电压始终调整其值以构造对称波形，整个正弦波可以满足下列公式，式中为正弦波信号的电压幅值，为正弦波信号的最大电压幅值：通过调节电压的调整从而确保=0。8.根据权利要求7中所述的信号偏移自检校正方法，其特征在于： 所述方法还包括：拾取步骤：左检测线圈信号对LeftCoil+/ LeftCoil-分别接入比例放大电路中运算放大器U4B的反相端即第六端子和同相端即端子5，同时调节电压自电阻R39、电容C53并联电路引入运算放大器U4B同相端，运算放大器输入差分信号对经运算放大器放大后输入处理器，处理器控制调节电压值以对左检测线圈信号对波形微调，确保其对称性，右检测线圈信号对RightCoil+/ RightCoil-拾取电路与左检测线圈信号对相同。9.根据权利要求8中所述的信号偏移自检校正方法，其特征在于： 所述方法还包括：自检步骤中，所述对称率的方法包括，处理器对取样值进行处理，通过对信号的正波值及负波值进行积分，两者相除即为波形对称率；。10.根据权利要求9中所述的信号偏移自检校正方法，其特征在于： 所述波形对称率小于99%，则比较正波值积分面积与负波值积分面积大小，若正波值积分面积大于负波值积分面积，则向下调整垂直参考电压即调节电压，反之则向上调整垂直参考电压即调节电压，调整后再次执行波形对称率判断，若未达到则继续进行调整；若波形对称率大于99%，处理器调节数字电位器U3，调整放大电路的放大倍数，对调整后驱动线圈电压适当放大，并输出至驱动线圈。
说明书desc
技术领域本发明属于流量计技术领域，具体涉及信号调节电路以及信号偏移自检校正方法。背景技术在振动流量计测量相位差时，通常需要大量复杂的计算且高规格的计数原件以达到高分辨率的相位差，振动流量计的左右线圈的物理位置即运作时的物理摆动位置无法确保绝对对称于其运动之中心点，现有技术无法降低运算所需要的硬件条件，简化获得相位差的运算方程，无法减少多级放大造成的延时问题，在不牺牲分辨率的情况下减少多级放大的级数，另外无法减少左右线圈在安装或运动时因不对称所需要的数学模型进行推导所占据的运算资源，需要大量的变换运算来反复推导出其频域相位并运行其他公式来导出其相位差，因些，需要研发一种信号调节电路以及信号偏移自检校正方法来解决现有的问题。发明内容本发明的目的在于提供一种信号调节电路以及信号偏移自检校正方法，以解决无法通过降低元件的运算规格及处理器工作频率得到高分辨率的相位差的问题。为实现上述目的，本发明提供如下技术方案：一种信号调节电路，包括：自检电路，用于测量驱动线圈电流，计算信号频率及波形对称率；若波形对称率大于设定值，则调整驱动信号放大倍数并以检测线圈为基准评估分析其水平零点位置；若零点垂直偏移达到设定的数值则计算偏移并降低偏移系数；校正电路，与自检电路相连接，用于对自检电路波形对称率小于设定值时计算正波值积分面积以及负波值积分面积，若积分面积为预设的数值，则向下调整垂直参考电压值或向上调整垂直参考电压值；拾取电路，与自检电路相连接，用于拾取检测线圈差分信号并依据自检数据校正其参考电压。优选的，所述自检电路包括：串联的电阻R40和电阻R43、连接在电阻R40和电阻R43节点的电阻R112、与电阻R112相连接的运算放大器U8B、与运算放大器U8B并联的电阻R111、与电阻R111并联的电容C74、与运算放大器U8B相连接的电阻R41、连接在电阻R41和运算放大器U8B节点的电容C62和电阻C63、与电阻R41相连接的电容C64、与电容C64相连接的差分电容C69、与差分电容C69相连接的电容C73、连接在差分电容C69和电容C73节点的电阻R49、与电阻R49相连接的放大器U12、与放大器U12相连接的电阻R46和电阻R51、一端连接在电阻R46与放大器U12节点的电阻R44、一端连接在电阻R51与放大器U12节点的电阻R52；其中，所述电阻R44的另一端与电容C63和电阻R41的节点相连接；所述电阻R52的另一端与电阻R49和放大器U12的节点相连接。优选的，所述校正电路包括：数字电位器U3、连接在数字电位器U3的第八引脚的电感FB1和电感FB2、连接在电感FB1和电感FB2节点的电容C3、与电容C3并联的电容C1和电容C2、连接在数字电位器U3的的第五引脚的运算放大器U1A、一端在运算放大器U1A的电阻R4、与运算放大器U1A相连接的电阻R8、与电阻R8相连接的运算放大器U1B、并联连接在运算放大器U1B上的电阻R3和电容C4、连接在运算放大器U1B和电阻R3节点的电阻R6、连接在运算放大器U1B上的电阻R10、与电阻R10相连接的电阻R11、连接在电阻R11和电阻R10的电容C7、一端连接与电容C7相连接的电阻R12；其中，所述电阻R12的另一端与运算放大器U1B和电阻R10的节点相连接。优选的，所述拾取电路包括：运算放大器U4A、并联在运算放大器U4A的电阻R25和电容C39、与运算放大器U4A相连接的电阻R27、与运算放大器U4A相连接的电阻R28、连接在电阻R28和运算放大器U4A节点的电阻R30、与电阻R30并联的电容C43；运算放大器U4B、并联在运算放大器U4B的电阻R36和电容C48、与运算放大器U4B相连接的电阻R37、与运算放大器U4B相连接的电阻R38、连接在电阻R38和运算放大器U4B节点的电阻R39、与电阻R39并联的电容C53。优选的，所述设定值为99%。本发明另提供一种信号调节电路的信号偏移自检校正方法，包括：自检步骤：通过电阻R40和电阻R43分压，提供稳定的参考偏移电压，驱动线圈电流由Current_Sens+流出，经放大器U12后由 Current_Sens-流回线圈，参考偏移电压及驱动线圈电流在放大器U12的第三端子、第四端子上将产生一差分信号对，经放大器U12放大后输出为，与参考偏移电压形成差分电压后，经过由电阻R41、电阻R49、差分电容C69共同构成一阶RC滤波器，输出至AIN2、AIN3；驱动线圈电流输入由运算放大器U8B引脚7的电压水平偏移，为非反相输入端的偏移后电压，可由以下公式得到，其中为运算放大器U8B输出的参考偏移电压，为线圈输出电压；放大器U12第一端子的输出通过下列公式得到：一阶RC滤波器前的最终差分电压通过下列公式得到模数转换器输入端使用一阶低通RC滤波器，由电阻R41、电阻R49和差分差分电容C69组成的差分低通RC滤波器设定-3dB截止频率，给定为：最终电流差分信号对AIN2以及AIN3为处理后的线圈电流，将其输入至一个16bit的电流检测单元即模数转换器，处理器将获取其波形并检查自身波形的对称率。优选的，校正步骤：当需要调整波形的对称率时，调节电压引入运算放大器U1B反相输入端，由波形发生器给出的驱动线圈电压经过由电阻R11与电容C7组成的低通滤波器接入到运算放大器U1B同相输入端，两者组成差分电压后经运算放大器U1B放大输出至TP1，TP1点的电压由下式得出：调节电压是基于实时条件由处理器给出的动态参考电压；电压自运算放大器U1A输出至驱动线圈，通过数字电位器U3可调节运算放大器U1A的放大倍数放大驱动信号；由于驱动线圈电压为正弦波信号，幅值电压600mV，通过始终调整其值以构造对称波形，整个正弦波可以满足下列公式：通过调节电压的调整从而确保=0。优选的，拾取步骤：左检测线圈信号对LeftCoil+/ LeftCoil-分别接入比例放大电路中运算放大器U4B的反相端即第六端子和同相端即端子5，同时调节电压自电阻R39、电容C53并联电路引入运算放大器U4B同相端，运算放大器输入差分信号对经运算放大器放大后输入处理器，处理器控制调节电压值以对左检测线圈信号对波形微调，确保其对称性，右检测线圈信号对RightCoil+/ RightCoil-拾取电路与左检测线圈信号对相同；优选的，自检步骤中，所述对称率的方法包括，处理器对取样值进行处理，通过对信号的正波值及负波值进行积分，两者相除即为波形对称率；。优选的，所述波形对称率小于99%，则比较正波值积分面积与负波值积分面积大小，若正波值积分面积大于负波值积分面积，则向下调整垂直参考电压即调节电压，反之则向上调整垂直参考电压即调节电压，调整后再次执行波形对称率判断，若未达到则继续进行调整；若波形对称率大于99%，处理器调节数字电位器U3，调整放大电路的放大倍数，对调整后驱动线圈电压适当放大，并输出至驱动线圈。本发明的技术效果和优点：该信号调节电路以及信号偏移自检校正方法，大幅度减少元件负荷并降低运算规格及处理器工作频率，获得高分辨率的相位差，通过极少的运算资源来完成相对应的相位差计算，大大节省了处理器所需的内存以及生产成本，此运算得利于前置的自检调节电路，并以几何原理来计算出标准相位之间的差值，此自检调节电路即一种能垂直调整信号波形的电路，通过驱动线圈电流自检，侦测零点漂移系数，从而调整实际驱动波形水平电压值，有效地降低左右检测线圈拾取信号的步骤以及提升初期零点监测的效率，降低运算所需要的硬件条件，简化获得相位差的运算方程，减少多级放大造成的延时问题，在不牺牲分辨率的情况下减少多级放大的级数，减少左右线圈在安装或运动时因不对称所需要的数学模型进行推导所占据的运算资源。附图说明图1为本发明的驱动线圈电流自检电路图；图2为本发明驱动线圈电压校正电路图；图3为本发明检测线圈差分信号对拾取电路图；图4为本发明线圈信号偏移自检、校正的流程图；图5为本发明数学模型基础示意图；图6为本发明偏移自检后的数学模型基础示意图；图7为本发明校正后的数学模型基础示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。本发明提供了如图1、图2、图3中所示的一种信号调节电路，包括：自检电路，用于测量驱动线圈电流，计算信号频率及波形对称率；若波形对称率大于设定值，则调整驱动信号放大倍数并以检测线圈为基准评估分析其水平零点位置；若零点垂直偏移达到设定的数值则计算偏移并降低偏移系数；本实施例中，所述设定值为99%；所述自检电路包括：串联的电阻R40和电阻R43、连接在电阻R40和电阻R43节点的电阻R112、与电阻R112相连接的运算放大器U8B、与运算放大器U8B并联的电阻R111、与电阻R111并联的电容C74、与运算放大器U8B相连接的电阻R41、连接在电阻R41和运算放大器U8B节点的电容C62和电阻C63、与电阻R41相连接的电容C64、与电容C64相连接的差分电容C69、与差分电容C69相连接的电容C73、连接在差分电容C69和电容C73节点的电阻R49、与电阻R49相连接的放大器U12、与放大器U12相连接的电阻R46和电阻R51、一端连接在电阻R46与放大器U12节点的电阻R44、一端连接在电阻R51与放大器U12节点的电阻R52；其中，所述电阻R44的另一端与电容C63和电阻R41的节点相连接；所述电阻R52的另一端与电阻R49和放大器U12的节点相连接。校正电路，与自检电路相连接，用于对自检电路波形对称率小于设定值时计算正波值积分面积以及负波值积分面积，若积分面积为预设的数值，则向下调整垂直参考电压值或向上调整垂直参考电压值；所述校正电路包括：数字电位器U3、连接在数字电位器U3的第八引脚的电感FB1和电感FB2、连接在电感FB1和电感FB2节点的电容C3、与电容C3并联的电容C1和电容C2、连接在数字电位器U3的的第五引脚的运算放大器U1A、一端在运算放大器U1A的电阻R4、与运算放大器U1A相连接的电阻R8、与电阻R8相连接的运算放大器U1B、并联连接在运算放大器U1B上的电阻R3和电容C4、连接在运算放大器U1B和电阻R3节点的电阻R6、连接在运算放大器U1B上的电阻R10、与电阻R10相连接的电阻R11、连接在电阻R11和电阻R10的电容C7、一端连接与电容C7相连接的电阻R12；其中，所述电阻R12的另一端与运算放大器U1B和电阻R10的节点相连接。拾取电路，与自检电路相连接，用于拾取检测线圈差分信号并依据自检数据校正其参考电压。该信号拾取电路用于拾取检测线圈差分信号对并且依据自检数据校正其参考电压。此自检功能只在自然频率出现后才开始启动。在寻找自然频率的过程中，自检功能只对应于其峰对峰值进行计算及反馈。所述拾取电路包括：运算放大器U4A、并联在运算放大器U4A的电阻R25和电容C39、与运算放大器U4A相连接的电阻R27、与运算放大器U4A相连接的电阻R28、连接在电阻R28和运算放大器U4A节点的电阻R30、与电阻R30并联的电容C43；运算放大器U4B、并联在运算放大器U4B的电阻R36和电容C48、与运算放大器U4B相连接的电阻R37、与运算放大器U4B相连接的电阻R38、连接在电阻R38和运算放大器U4B节点的电阻R39、与电阻R39并联的电容C53。本发明另提供一种信号调节电路的信号偏移自检校正方法，如图1所示，A1处+5V电压通过电阻R40和电阻R43分压，经电压跟随电路后，提供稳定的参考偏移电压，驱动线圈电流由Current_Sens+流出，经放大器U12后又由 Current_Sens-流回线圈，参考偏移电压及驱动线圈电流在放大器U12的第三端子、第四端子上将产生一差分信号对，经放大器U12放大后输出为，与参考偏移电压形成差分电压后，经过由电阻R41、电阻R49、电容C69共同构成的一阶RC滤波器，输出至AIN2、AIN3，经过计算，按照图1设计得到其增益为：5.1倍，且其一阶RC滤波切断频率为3.6kHz；图1中是水平移动地参考点，以便在单极电源系统中处理双向电流测量，带有分流电阻的测量目标上的电压即驱动线圈电流输入被一个由运放输出控制的电压水平偏移即运算放大器U8B的第七引脚；非反相输入端的偏移后电压由以下方程给出，其中为运算放大器U8B输出的参考偏移电压，为线圈输出电压；放大器U12的第一引脚的输出可由下式得出：一阶RC滤波器前的最终差分电压为图1中，在模数转换器输入端使用一阶低通RC滤波器，进一步抑制带宽外噪声，避免混叠，由电阻R41、电阻R49和差分电容C69组成的差分低通RC滤波器设定-3dB截止频率，给定为：图1中最终电流差分信号对AIN2以及AIN3为处理后的线圈电流，将其输入至一个16bit的电流检测单元即模数转换器，处理器将获取其波形并检查自身波形的对称率；如图2所示，当需要调整波形的对称率时，需要依靠此电路进行校正，调节电压引入运算放大器U1B反相输入端，由波形发生器给出的驱动线圈电压经过由电阻R11与电容C7组成的低通滤波器接入到运算放大器U1B同相输入端，两者组成差分电压后经运算放大器U1B放大输出至TP1，TP1点的电压由下式得出：其中调节电压是基于实时条件由处理器给出的动态参考电压；图2中电压自运算放大器U1A输出至驱动线圈，通过数字电位器U3可调节运算放大器U1A的放大倍数，从而进一步放大驱动信号；由于为正弦波信号，优选幅值电压600mV，通过调节电压始终调整其值以构造对称波形，因此，整个正弦波可以满足其标准数学方程:此处的公式是对正弦波的典型数学表示，与电路图没有关系。代表了正弦波信号的电压幅值，是正弦波的最大幅值。通过调节电压的调整从而确保=0；所图3所示，本发明公开的检测线圈差分信号对拾取电路.对差分信号对进行简单滤波和放大而不再对差分信号对进行繁琐的信号处理，差分信号分别输入运算放大器的同相端和反相端，每多一级信号处理固然会时使其波形更加贴近理想形态且增加其重复性，但都会变相地增加信号的延时，当多级处理的各个运算放大器之间存在延时误差时，会间接造成相位之间的误差，降低数据的精准度，因此，只做一级差分信号处理不仅能减少以上情况的发生，还能降低元件的使用量，此外还可确保采集到尽量多的信号以便于数字处理时进行相应趋势的识别；图3中左检测线圈信号对LeftCoil+/ LeftCoil-分别接入比例放大电路中运算放大器U4B的反相端即第六端子和同相端即第五端子，同时调节电压自电阻R39、电容C53并联电路引入运算放大器U4B同相端，运算放大器输入差分信号对经运算放大器放大后输入处理器，处理器控制调节电压、值以对左检测线圈信号对波形微调，确保其对称性，右检测线圈信号对RightCoil+/ RightCoil-拾取电路与左检测线圈信号对相同；如图4流程图所示，处理器找到自然频率后开始自检功能，以图1所示电路进行驱动线圈电流检测，经模数转换器取样后输入至处理器，处理器对取样值进行处理，计算信号频率及波形对称率；通过对信号的正波值部分及负波值部分进行积分，两者相处即为波形对称率；若波形对称率小于99%，则波形对称性不符合要求，需要调整，比较正波值积分面积与负波值积分面积大小，若正波值积分面积大于负波值积分面积，则向下调整垂直参考电压即图2中调节电压，反之则向上调整垂直参考电压即图2中调节电压；调整后再次进行波形对称性判定，如波形对称性仍不符合要求则继续进行调整；如波形对称率大于99%，处理器调节图2所示数字电位器U3，从而调整放大电路的放大倍数，对调整后驱动线圈电压适当放大，确保驱动信号符合设计要求，并输出至驱动线圈；众所周知，振动流量计的检测线圈信号为驱动线圈动作后的反馈，对驱动线圈的驱动信号对称性调节将在检测线圈信号上有相同的调节作用，即对检测线圈信号对称性的粗调；根据流量计内流体流动方向，选择入口侧的检测线圈的信号作为参考差分信号对，选择出口侧的检测线圈的信号作为测量差分信号对，实施例中以左检测线圈信号作为参考差分信号对，以右检测线圈信号作为测量差分信号对；如图4流程图所示，以参考信号对左检测线圈信号为基准，在图3所示的检测电路检测到检测线圈的电流后经模数转换器取样后输入处理器中，取左检测线圈信号的取样值进行评估，正弦波信号于波形最大斜率处为幅值中心点，取作左检测线圈的水平零点，按照最优斜率算法计算出水平零点处的幅值，如其值不为零，则发生零点垂直偏移，计算零点偏移差值，降低偏移系数以调整图3所示的调节电压、，而后再次启动自检功能，对波形对称性进行调整；左检测线圈信号的水平零点未发生垂直偏移，则将左检测线圈信号即参考差分信号对的初相设为零，对同一时间的右检测线圈信号取样值按照三角函数计算即可取得该时刻右检测线圈信号的相位，即左右线圈信号间的相位差；如图4所示，当经过一级差分信号处理后的线圈理想信号波形，此波形还原在没有干扰源的情况下的原始数据，当两个波形不在一个参考坐标系时，其几何图形部分重叠时，无法以单一运算将两者间的相位差导出，必须将其变换至频域或者其他换算来得出最终相位差；如图5所示，当自检完成后，双方都基于同一个参考坐标系下时，其对应的几何图形能完全包容、对称于起始波形，此时，只需简单的三角函数解就能得出相位差，此方案还能继续优化；真实的正弦波信号经电路元件采集后以复信号形式表示，众所周知，复信号可记作 ，其图形表示为一个单位圆，横轴为实轴，纵轴为虚轴。由欧拉公式可知，一个单位圆可以分解为一个水平方向的正弦波和一个垂直方向的正弦波，正弦波的相位可转化为单位圆上对应点的角度。两个不同参考坐标系下的单位圆，可分别为分解为一个水平方向的正弦波和一个垂直方向的正弦波，单位圆的圆心不在同一点，其参考坐标系也不相同，单位圆分解出的正弦波也不在同一参考坐标系中。如图6所示，当自检完成后，将起始波形的起始计算值设在参考系的起始值，此时，只要计算相对波形对应参考系得角度差就能得到两者的相位差；两个单位圆的圆心重合，由单位圆分解出的正弦波在同一个参考坐标系中，两条正弦波上各取一点，其对应的相位差即可转化为单位圆上相应点间的夹角θ。对驱动线圈的电流放大并取样其差分信号，通过校验该差分信号的对称性从而对驱动信号进行主动性调整，以确保驱动信号的对称；将两个线圈的差分信号对校正至同一个参考系，并且依照最优斜率算法，将参考差分信号对可以是右线圈，或者左线圈，因流体移动方向而定的初相设为零，并以三角函数取得参考差分信号对与测量差分信号对所对应的相位差。本申请通过拾取线圈的一级差分信号并通过校正其垂直信号偏移并以最少的硬件需求达到运算要求，第一输入端对，被配置为接受所述值第一差分讯号对；线圈电流拾取电路，以及其运算放大器，水平参考校正电路，相位差对应之运算法则，不止获取线圈电流值，也对比其正，负波形之对称行，要求将其正负波形之对称率不小于99%，其中的调节电路用于调节正负波形之对称率，并以12bit的分辨率来调节其中之偏差，当两线圈波形对应之图形重叠时，其相位差能以三角函数解之，能以零点为基础，并以最优斜率来计算其中相位差；该信号调节电路以及信号偏移自检校正方法，大幅度减少元件负荷并降低运算规格及处理器工作频率，但获得高分辨率的相位差，将其对称于同一水平，且按照最优斜率运算将有助于缩短其运算过程，通过极少的运算资源来完成相对应的相位差计算，大大节省了处理器所需的内存以及生产成本，此运算得利于前置的自检调节电路，并以几何原理来计算出标准相位之间的差值，此自检调节电路即一种能垂直调整信号波形的电路，通过驱动线圈电流自检，侦测零点漂移系数，从而调整实际驱动波形水平电压值，有效地降低左右检测线圈拾取信号的步骤以及提升初期零点监测的效率，降低运算所需要的硬件条件，简化获得相位差的运算方程，减少多级放大造成的延时问题，在不牺牲分辨率的情况下减少多级放大的级数，减少左右线圈在安装或运动时因不对称所需要的数学模型进行推导所占据的运算资源。最后应说明的是：以上所述仅为本发明的优选实施例而已，并不用于限制本发明，尽管参照前述实施例对本发明进行了详细的说明，对于本领域的技术人员来说，其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换,凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
