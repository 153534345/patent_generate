标题title
一种对PDF文档进行RSA和SM2双标准签名和验证的方法
摘要abst
本发明提供了一种对PDF文档进行RSA和SM2双标准签名和验证的方法，包括同时使用RSA和SM2两种算法对PDF文档进行数字签名，以及对数字签名进行验证，判定PDF文档签名域是否被破坏，或者PDF文档文本域是否被篡改或破坏，或者PDF文档是否被篡改或破坏。本发明提供的PDF文档数字签名和验证方法同时采用RSA和SM2双标准，一方面既满足我国对商用密码应用的管理要求，另一方面也有利于促进检验检测证书与报告等数字签名PDF文档的跨国流通与应用，提升国际贸易便利化水平。
权利要求书clms
1.一种对PDF文档进行RSA和SM2双标准签名和验证的方法，其特征在于：同时使用RSA和SM2双标准对PDF进行数字签名，具体步骤如下：步骤101，计算PDF文档文本域的哈希值，获取RSA证书的哈希值，分别对PDF文档文本域的哈希值和RSA证书的哈希值进行SM2加密，得到PDF文档文本域的哈希值的SM2加密值和RSA证书的哈希值的SM2加密值；步骤102，在PDF文档内插入SM2标识位；步骤103，将步骤101中的PDF文档文本域的哈希值的SM2加密值和RSA证书的哈希值的SM2加密值插入SM2标识位中，形成包含SM2加密值的PDF文档；步骤104，计算包含SM2加密值的PDF文档文本域的哈希值，对该哈希值进行RSA加密，得到经SM2签名的PDF文档的RSA加密值；步骤105，将步骤104得到的的RSA加密值插入步骤103得到的PDF文档的签名域中，实现PDF文档的RSA签名。2.根据权利要求1所述的一种对PDF文档进行RSA和SM2双标准签名和验证的方法，其特征在于：对同时使用RSA和SM2双标准数字签名后的PDF文档进行解密验签，具体步骤如下：步骤201，读取待解密验签的PDF文档签名域的RSA加密值，如无法读出，判定PDF文档签名域被破坏；步骤202，读取待解密验签的PDF文档的SM2标识符，如无SM2标识符，判定PDF文档未使用SM2进行数字签名；步骤203，读取待解密验签的PDF文档的SM2标识符，并对PDF文档文本域的哈希值的SM2加密值和RSA证书的哈希值的SM2加密值使用公钥进行解密得到PDF文档文本域的哈希值和RSA证书的哈希值；步骤204，使用步骤101同样的方法计算获得待解密验签的PDF文档签名域RSA证书的哈希值，与步骤203解密得到的RSA证书的哈希值对比，如两者不同，判定PDF文档签名使用的RSA证书被伪造；步骤205，读取待解密验签的PDF文档文本域并去除SM2标识符相关的内容，使用步骤101同样的方法计算获得待解密验签的PDF文档文本域的哈希值，与步骤203解密得到的PDF文档文本域的哈希值对比，如两者不同，判定PDF文档文本域被篡改或破坏；步骤206，如经过步骤201至步骤205，如果该PDF文档均未被判定PDF文档签名域被破坏，且未被判定PDF文档未使用SM2进行数字签名，且未被判定PDF文档签名使用的RSA证书被伪造，且未被判定PDF文档文本域被篡改或破坏，则该经RSA和SM2双标准数字签名的PDF文档解密验签通过。
说明书desc
技术领域本发明属于计算机技术领域，特别涉及一种针对PDF文档同时进行RSA和SM2双标准数字签名和验证的方法。背景技术RSA算法是国际上第一个能同时用于加密和数字签名的算法，RSA也是被研究得最广泛的公钥算法，从提出到现今的四十多年里，经历了各种攻击的考验，逐渐为人们接受，普遍认为是目前最优秀的公钥方案之一。SM2算法是我国自主设计的公钥密码算法，由国家密码管理局于2010年12月首次公开发布，2012年3月成为中国商用密码标准，2016年8月成为中国国家密码标准。SM2基于更加安全先进的椭圆曲线密码机制，在国际标准的ECC椭圆曲线密码理论基础上改进而来，其加密强度更高。RSA算法和SM2算法是2个独立的非对称算法，可用于身份验证、加解密。非对称算法加密和解密使用不同的密钥，即使用加密密钥进行加密、解密密钥进行解密。RSA和SM2的加解密应用已经非常成熟，在电子文档数字签名领域应用很广泛。RSA是国际标准非对称算法，SM2是中国自己的非对称算法，通常情况下各自独立使用。但在一些特定领域如针对检验检测报告、认证证书进行数字签名，一方面为了遵循国家商用密码产品应用管理要求，在国内流通时需要使用SM2算法进行数字签名和验证，另一方面为促进国际贸易便利化还需要跨国流通与应用，要求应用符合估计标准的RSA算法进行数字签名与验证。因此，在不破坏数据的情况下，如何对PDF文件同时采用RSA和SM2双标准进行签名和验证成为亟待解决的技术问题。发明内容技术问题：为了解决以上技术问题，本发明提供了一种针对PDF文档同时进行RSA和SM2双标准数字签名和验证的方法。技术方案：本发明提供了一种针对PDF文档同时进行RSA和SM2双标准数字签名和验证的方法，其中，数字签名过程如下：步骤101，计算PDF文档文本域的哈希值，获取RSA证书的哈希值，分别对PDF文档文本域的哈希值和RSA证书的哈希值进行SM2加密，得到PDF文档文本域的哈希值的SM2加密值和RSA证书的哈希值的SM2加密值；步骤102，在PDF文档内插入SM2标识位；步骤103，将步骤101中的PDF文档文本域的哈希值的SM2加密值和RSA证书的哈希值的SM2加密值插入SM2标识位中，形成包含SM2加密值的PDF文档；步骤104，计算包含SM2加密值的PDF文档文本域的哈希值，对该哈希值进行RSA加密，得到经SM2签名的PDF文档的RSA加密值；步骤105，将步骤104得到的的RSA加密值插入步骤103得到的PDF文档的签名域中，实现PDF文档的RSA签名。其中，解密验签过程如下：步骤201，读取待解密验签的PDF文档签名域的RSA加密值，如无法读出，判定PDF文档签名域被破坏；步骤202，读取待解密验签的PDF文档的SM2标识符，如无SM2标识符，判定PDF文档未使用SM2进行数字签名；步骤203，读取待解密验签的PDF文档的SM2标识符，并对PDF文档文本域的哈希值的SM2加密值和RSA证书的哈希值的SM2加密值使用公钥进行解密得到PDF文档文本域的哈希值和RSA证书的哈希值；步骤204，使用步骤101同样的方法计算获得待解密验签的PDF文档签名域RSA证书的哈希值，与步骤203解密得到的RSA证书的哈希值对比，如两者不同，判定PDF文档签名使用的RSA证书被伪造；步骤205，读取待解密验签的PDF文档文本域并去除SM2标识符相关的内容，使用步骤101同样的方法计算获得待解密验签的PDF文档文本域的哈希值，与步骤203解密得到的PDF文档文本域的哈希值对比，如两者不同，判定PDF文档文本域被篡改或破坏；步骤206，如经过步骤201至步骤205，如果该PDF文档均未被判定PDF文档签名域被破坏，且未被判定PDF文档未使用SM2进行数字签名，且未被判定PDF文档签名使用的RSA证书被伪造，且未被判定PDF文档文本域被篡改或破坏，则该经RSA和SM2双标准数字签名的PDF文档解密验签通过。有益效果：本发明提供的PDF文档数字签名和验证方法同时采用RSA和SM2两种算法，一方面既满足我国对商用密码应用的管理要求，另一方面也有利于促进检验检测证书与报告等同时采用RSA和SM2两种算法进行数字签名PDF文档的跨国流通与应用，提升国际贸易便利化水平。本发明提供的方法避免了数字签名时对PDF文档同时进行RSA和SM2两次签名导致破坏彼此的算法，甚至破坏PDF文档数据的问题；还保证了在解密验签时既可以单独验证SM2签名，也可以在国际上广泛应用的adobe reader等常见办公软件中自动验证RSA签名。附图说明图1为adobe reader打开经RSA和SM2双标准数字签名的双签pdf文档图。图2为上传双签文档验证SM2签名图。图3为验证双签文档的SM2签名信息图。图4为adobe reader打开经修改过签名信息的双签文档图。图5为验证经修改签名信息的双签文档签名信息图。图6为验证双签文档的RSA签名信息图。图7为验证双签文档的SM2签名信息图。实施方式下面对本发明具体实施方式作出进一步说明。同时对PDF文档进行RSA和SM2双标准数字签名和验证的方法，其中，数字签名过程如下：步骤101，计算PDF文档文本域的哈希值，获取RSA证书的哈希值，分别对PDF文档文本域的哈希值和RSA证书的哈希值进行SM2加密，得到PDF文档文本域的哈希值的SM2加密值和RSA证书的哈希值的SM2加密值；步骤102，在PDF文档内插入SM2标识位；步骤103，将步骤101中的PDF文档文本域的哈希值的SM2加密值和RSA证书的哈希值的SM2加密值插入SM2标识位中，形成包含SM2加密值的PDF文档；步骤104，计算包含SM2加密值的PDF文档文本域的哈希值，对该哈希值进行RSA加密，得到经SM2签名的PDF文档的RSA加密值；步骤105，将步骤104得到的的RSA加密值插入步骤103得到的PDF文档的签名域中，实现PDF文档的RSA签名。其中，解密验签过程如下：步骤201，读取待解密验签的PDF文档签名域的RSA加密值，如无法读出，判定PDF文档签名域被破坏；步骤202，读取待解密验签的PDF文档的SM2标识符，如无SM2标识符，判定PDF文档未使用SM2进行数字签名；步骤203，读取待解密验签的PDF文档的SM2标识符，并对PDF文档文本域的哈希值的SM2加密值和RSA证书的哈希值的SM2加密值使用公钥进行解密得到PDF文档文本域的哈希值和RSA证书的哈希值；步骤204，使用步骤101同样的方法计算获得待解密验签的PDF文档签名域RSA证书的哈希值，与步骤203解密得到的RSA证书的哈希值对比，如两者不同，判定PDF文档签名使用的RSA证书被伪造；步骤205，读取待解密验签的PDF文档文本域并去除SM2标识符相关的内容，使用步骤101同样的方法计算获得待解密验签的PDF文档文本域的哈希值，与步骤203解密得到的PDF文档文本域的哈希值对比，如两者不同，判定PDF文档文本域被篡改或破坏；步骤206，如经过步骤201至步骤205，如果该PDF文档均未被判定PDF文档签名域被破坏，且未被判定PDF文档未使用SM2进行数字签名，且未被判定PDF文档签名使用的RSA证书被伪造，且未被判定PDF文档文本域被篡改或破坏，则该经RSA和SM2双标准数字签名的PDF文档解密验签通过。以下结合一个更具体的实例对本发明的具体实施方式做出说明。1. 根据步骤101至步骤105的方法形成一个经过RSA和SM2双标准数字签名的“双签文档.pdf”，并用pdf文档阅读工具打开，见图1。pdf阅读工具显示：该文档已加密，签名由“上海XX技术有限公司”验证，证书由“XX”颁发，该信息为国际通用的RSA签名信息。2.将该文档上传至中国国家认证认可监督委员会网站，验证该文件SM2签名信息，完整显示SM2签名信息，见图2和图3。3.将该文档破解后修改签名信息，重命名为“被修改双签.pdf”。用pdf文档阅读工具打开，见图4。pdf阅读工具显示：该文档数字签名已被修改或无效；显示了该文档被修改，图5。4.将“双签文档.pdf”上传至经改进的双签名验证平台进行签名验证。“双签文档.pdf”的RSA签名验证结果见图6；SM2签名验证结果见图7，说明本发明提供的的数字签名和验证过程未破坏文档结构，可实现双签和双验。以上所述实施实例仅表达了本发明的几种实施方式，其描述较为具体和详细，但并不能因此而理解为对发明专利范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本发明构思的前提下，还可以做出若干变形和改进，这些都属于本发明的保护范围。因此，本发明专利的保护范围应以所附权利要求为准。
