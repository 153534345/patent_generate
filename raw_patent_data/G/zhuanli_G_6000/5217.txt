标题title
一种自主学习的电池电量估算方法及装置
摘要abst
本发明属于电池电量计算技术领域，具体公开了一种自主学习的电池电量估算方法及装置，包括：对电池进行放电至空电压，采用Wh统计电池电量并实时存储为当前电量值；将当前电量值置零，对电池进行充电，当前电量值逐渐增大，实时测量充电电流和充电电压，电池充满后，存储当前电量值为电池总电量；再次对电池进行放电至空电压，得到实际放电电量，获取电池总电量和实际放电电量的差值，生成误差系数；在充电过程中，使用误差系数校准电池总电量，直至充满，修正电池总电量。本发明采用WH计算电池容量，由于用电设备的功耗是基本一致的，因此整个放电过程是线性平滑的，指示的电量与还可使用的时间同步性好，用户体验大大改善。
权利要求书clms
1.一种自主学习的电池电量估算方法，其特征在于，包括：步骤1:读取电池的电量信息，对所述电池进行放电至空电压，计算电池电量，存储计算得到电池电量为当前电量值；步骤2:对所述电池进行充电，实时测量充电电流和充电电压，电池充满后，得到电池总电量，更新存储当前电量值为所述电池总电量；步骤3:再次将所述电池放电至空电压，计算电池的放电量，得到实际放电电量，获取电池总电量和实际放电电量的差值，生成误差系数R；步骤4：对电池电量进行修正估算：在充电过程中，利用所述误差系数R校准电池总电量，直至充满，得到校准电池总电量；在放电过程中，采用校准电池总电量进行放电，放电时的功耗使用误差系数R进行校准，得到校准放电电量直到电池放空，利用所述校准电池总电量确定放电剩余电量，并根据所述放电剩余电量进行所述误差系数的修正，得到修正误差系数R1；步骤5：更新所述误差系数R为修正误差系数R1，重复步骤4对电池电量进行实时估算。2.根据权利要求1所述的一种自主学习的电池电量估算方法，其特征在于，所述计算电池电量的方式为利用瓦时计算。3.根据权利要求1所述的一种自主学习的电池电量估算方法，其特征在于，所述步骤3中，误差系数的计算公式为：式中，R为误差系数，A为电池总电量，B为实际放电电量。4.根据权利要求1所述的一种自主学习的电池电量估算方法，其特征在于，步骤4中，所述放电剩余电量为所述校准电池总电量与所述校准放电电量的差值；所述误差系数R的修正包括以下步骤：当放空时，剩余电量大于0，则说明误差系数偏小，修正误差系数R1= R+1%；当电池还未放空时，剩余电量已经为0，则说明误差系数偏大，修正误差系数R1= R-1%。5.根据权利要求1所述的一种自主学习的电池电量估算方法，其特征在于，所述步骤5中，对电池电量进行实时估算具体为；估算充电量为：估算放电量为：式中，T为标准计量时间，I为平均电流，U为平均电压，R1为修正后的误差系数。6.根据权利要求1所述的一种自主学习的电池电量估算方法，其特征在于，对电池进行放电至空电压之前，需要判断电池是否为第一次放电，若是，则使用理论电池容量进行放电；若不是，则判断是否为第二次放电，若是第二次放电，则以第一次充电的电池总电量进行放电，若不是第二次放电，则使用校准后的充电量进行放电；所述理论电池容量为根据电池标称参数计算出的容量，作为初次放电时的默认容量，当算法学习到真实容量后，使用真实容量代替理论电池容量。7.根据权利要求1所述的一种自主学习的电池电量估算方法，其特征在于，所述电池放电至空电压的判断方法为：持续时间达到设定值，则认为电池已经放空，电量应为0%;电池充满的判断方法：持续时间达到设定值，则认为电池已经充满，电量应为100%;式中：为电池当前电压；为电芯空电压：即单节电芯放空时的电压值；n为电池串联节数；为电芯满电压：即单节电芯充满时的电压值；为电池当前电流；为停止电流。8.一种自主学习的电池电量估算装置，其特征在于，包括：读取模块，所述读取模块被配置为：读取电池的电量信息，对电池进行放电至空电压，计算电池电量，并实时存储为当前电量值；充电模块，所述充电模块被配置为：对空电压的电池进行充电，当前电量值逐渐增大，实时测量充电电流和充电电压，电池充满后，存储当前电量值为电池总电量；放电模块，所述放电模块被配置为：对电池进行放电至空电压，计算电池的放电量，得到实际放电电量，获取电池总电量和实际放电电量的差值，生成误差系数；修正模块：所述修正模块被配置为：在充电过程中，使用误差系数校准电池总电量，直至充满，修正电池总电量；在放电过程中，采用电池总电量进行放电，放电时的功耗使用误差系数进行校准，直到电池放空，放空时根据剩余电量，修正误差系数。9.根据权利要求8所述的一种自主学习的电池电量估算装置，其特征在于，所述读取模块至少包括外部检流电阻、充放电电路和存储模块，所述外部检流电阻用于检测充放电电流及电池电压；所述充放电电路用于对电池进行充电或放电；所述存储模块至少用于存储当前电量值；所述放电模块至少包括输出单元、运算单元、电源模块；所述运算单元内置自主学习模型，通过学习充电电量和放电电量计算并生成误差系数；所述输出单元用于电池电量数据的输出；所述电源模块，用于将电池电压转换为装置的工作电压。10.根据权利要求9所述的一种自主学习的电池电量估算装置，其特征在于，所述外部检流电阻为毫欧电阻，用于检测充放电电流及电池电压。
说明书desc
技术领域本发明属于电池电量计算技术领域，特别涉及一种自主学习的电池电量估算方法及装置。背景技术随着电子技术的发展，锂离子电池和锂聚合物电池在便携设备中的应用越来越多，而用户对电池电量十分关注，需要在使用过程中及时充电，以避免在需要使用的时候电池没电影响设备的正常使用。目前常用的电池电量采集管理有两种方式：第一种，使用带库仑计的电量管理芯片，使用Ah计算电池容量，可以准确地采集和管理电池电量；第二种，通过电池电压来估算电池电量。使用库仑计的方式有以下优点：芯片集成度高，电池电量信息比较准确，体积小，功耗低。但库仑计也存在以下缺点：一般只适用于3.7V单节锂电池的电量管理，缺少两节及以上电芯串联的电量管理方案；设置参数较为复杂，如果参数设置不当将影响电量的准确性；另外，若不同批次的电池电芯内阻、容量差异较大时，电量计估算的电量具有很大的偏差，会出现电量不准确、电量跳变等问题。而使用电压估算的方式则存在更大的弊端：首先是电量不准确，电压受负载电流的大小变化而变化，电量会出现较大的波动情况；其次，充电和放电时的电压表现完全不一样，需要分别对充电和放电设计两套参数来估算电量，难以达到较高的准确度。因此，当电器使用两节及以上电芯串联、并且负载电流较大、负载电流变化也较大时，传统的电量管理方法并不适用。因此，提供一种自主学习的电池电量估算方法及装置是本领域技术人员亟需解决的技术问题。发明内容本发明的目的在于克服现有技术中电池电量计算不精确，波动较大的缺陷，提供一种自主学习的电池电量估算方法。本发明的第一方面，提供了一种自主学习的电池电量估算方法，包括：步骤1:读取电池的电量信息，对所述电池进行放电至空电压，计算电池电量，存储计算得到电池电量为当前电量值；步骤2:对所述电池进行充电，实时测量充电电流和充电电压，电池充满后，得到电池总电量，更新存储当前电量值为所述电池总电量；步骤3:再次将所述电池放电至空电压，计算电池的放电量，得到实际放电电量，获取电池总电量和实际放电电量的差值，生成误差系数R；步骤4：对电池电量进行修正估算：在充电过程中，利用所述误差系数R校准电池总电量，直至充满，得到校准电池总电量；在放电过程中，采用校准电池总电量进行放电，放电时的功耗使用误差系数R进行校准，得到校准放电电量直到电池放空，利用所述校准电池总电量确定放电剩余电量，并根据所述放电剩余电量进行所述误差系数的修正，得到修正误差系数R1；步骤5：更新所述误差系数R为修正误差系数R1，重复步骤4对电池电量进行实时估算。进一步的方案为，所述计算电池电量的方式为利用瓦时计算。进一步的方案为，所述步骤3中，误差系数的计算公式为：式中，R为误差系数，A为电池总电量，B为实际放电电量。进一步的方案为，步骤4中，所述放电剩余电量为所述校准电池总电量与所述校准放电电量的差值；所述误差系数R的修正包括以下步骤：当放空时，剩余电量大于0，则说明误差系数偏小，修正误差系数R1= R+1%；当电池还未放空时，剩余电量已经为0，则说明误差系数偏大，修正误差系数R1=R-1%。进一步的方案为，所述步骤5中，对电池电量进行实时估算具体为；估算充电量为：估算放电量为：式中，T为标准计量时间，I为平均电流，U为平均电压，R1为修正后的误差系数。进一步的方案为，对电池进行放电至空电压之前，需要判断电池是否为第一次放电，若是，则使用理论电池容量进行放电；若不是，则判断是否为第二次放电，若是第二次放电，则以第一次充电的电池总电量进行放电，若不是第二次放电，则使用校准后的充电量进行放电；所述理论电池容量为根据电池标称参数计算出的容量，作为初次放电时的默认容量，当算法学习到真实容量后，使用真实容量代替理论电池容量。进一步的方案为，所述电池放电至空电压的判断方法为：持续时间达到设定值，则认为电池已经放空，电量应为0%;电池充满的判断方法：持续时间达到设定值，则认为电池已经充满，电量应为100%;式中：为电池当前电压；为电芯空电压：即单节电芯放空时的电压值；n为电池串联节数；为电芯满电压：即单节电芯充满时的电压值；为电池当前电流；为停止电流。本发明的第二方面，提供了一种自主学习的电池电量估算装置，包括：读取模块，所述读取模块被配置为：读取电池的电量信息，对电池进行放电至空电压，计算电池电量，并实时存储为当前电量值；充电模块，所述充电模块被配置为：对空电压的电池进行充电，当前电量值逐渐增大，实时测量充电电流和充电电压，电池充满后，存储当前电量值为电池总电量；放电模块，所述放电模块被配置为：对电池进行放电至空电压，计算电池的放电量，得到实际放电电量，获取电池总电量和实际放电电量的差值，生成误差系数；修正模块：所述修正模块被配置为：在充电过程中，使用误差系数校准电池总电量，直至充满，修正电池总电量；在放电过程中，采用电池总电量进行放电，放电时的功耗使用误差系数进行校准，直到电池放空，放空时根据剩余电量，修正误差系数。进一步的方案为，所述读取模块至少包括外部检流电阻、充放电电路和存储模块，所述外部检流电阻用于检测充放电电流及电池电压；所述充放电电路用于对电池进行充电或放电；所述存储模块至少用于存储当前电量值；所述放电模块至少包括输出单元、运算单元、电源模块；所述运算单元内置自主学习模型，通过学习充电电量和放电电量计算并生成误差系数；所述输出单元用于电池电量数据的输出；所述电源模块，用于将电池电压转换为装置的工作电压。进一步的方案为，所述外部检流电阻为毫欧电阻，用于检测充放电电流及电池电压与现有技术相比，本发明的有益效果在于：本发明的自主学习电池电量的估算方法，可有效的提升便携式设备的电池电量指示准确度和平滑度；本发明的装置，可应用于各类便携式设备，避免了单节电池或者多节电池供电以及电池老化对电量估算的影响，提升了便携式设备的用户体验。本发明采用WH计算电池容量，由于用电设备的功耗是基本一致的，因此整个放电过程是线性平滑的，指示的电量与还可使用的时间同步性好，用户体验大大改善。附图说明以下附图仅对本发明作示意性的说明和解释，并不用于限定本发明的范围，其中：图1：电池初次放电流程图；图2：电池初次充电流程图；图3：电池第二次放电流程图；图4：正常充电流程图；图5：正常放电流程图；图6：本发明装置连接示意图；图7：电量模块原理框图；图中：1、电池组；2、外部检流电阻；3、充放电电路；4、电量模块；5、运算单元；6、电源模块；7、运算放大器；8、输出单元；9、存储单元。具体实施方式为了使本发明的目的、技术方案、设计方法及优点更加清楚明了，以下结合附图通过具体实施例对本发明进一步详细说明。应当理解，此处所描述的具体实施例仅用于解释本发明，并不用于限定本发明。本发明的第一方面，提供了一种自主学习的电池电量估算装置，如图6和图7所示，所述装置包括电池组1、外部检流电阻2、充放电电路3和电量模块4，其中，外部检流电阻2用于检测充放电电流及电池电压，采用大功率、低阻值的毫欧电阻以减小功耗。所述电池组1、外部检流电阻2、充放电电路3依次串联，所述电量模块4与所述外部检流电阻2并联；其中，电量模块4包括：运算放大器7，用于检测充电电流和放电电流，确定充放电状态；输出单元8，用于电池电量数据的输出；输出单元8具备两种输出模式，其一为TTL串口数据输出，采用主动上报的方式输出电池各信息，上报的周期可设置，在此不作具体限定；另一种为电平输出，四个IO端口可输出四段电平指示，高电平可驱动LED点亮以指示电量；运算单元5，内置自主学习模型，实时测量充放电的电流和电压并计算充电、放电的电量，计算当前误差并校正电量，按照预设规则存储电量，将电量数据通过输出单元8输出到外部；存储单元9，用于存储电池电量数据；存储单元9使用EEPROM存储。本申请所需的存储数据量较小，一个扇区的存储空间即可满足需求，存储算法是专门根据EEPROM的读写规律设计的，只有当整个扇区的空间全部写满后，再进行擦除操作，最大程度的提升EEPROM的使用寿命；电源模块6，用于将电池组1电压转换为电量模块4的工作电压；运算放大器7设置有两组，分别与所述外部检流电阻2并联，所述运算放大器7、输出单元8、存储单元9分别与所述运算单元5连接，所述运算单元5与所述电源模块6连接。常规的电量计使用的是AH计算容量，但由于用电设备的功耗是基本一致的，功耗等于电压与电流的乘积，而电池一般具有电压逐渐降低的特性曲线，因此导致电流会逐渐增大。如果仅使用电流来估算电量，会出现电压高时，电量消耗很慢，电压降低后，电流增大，电量消耗变快，用户体验不佳，针对此类问题，本发明基于上述装置，还提供了一种自主学习的电池电量估算方法，如图1所示，当设备接通电池，初次运行时，电量模块4按以下流程处理：首先，电量模块4读取存储的电量信息，判断是否第一次放空，若是，则采用理论电池容量放电，直到电池放空。在放电过程中，定时存储电量值为当前电量值以防掉电丢失电量信息。如图2所示，当电池放空后，当前电量值置零，等待充电过程。充电时，电量从零开始增加，增加的电量是依据电流及电压的实测数据进行计算的，即以功率为单位计算增加的电量。当电池充满时，可获得电池的满电量值，存储为当前电量值，作为首次未校准的电池总电量。如图3所示，再次将电池放电，此时的电池总电量为上次的实测值，通过实时功耗消耗记录剩余电量值，直到电池放空。此时，根据电池总电量和实际放电电量的差值，生成误差系数。有了误差系数后，电量的初步学习就完成了，后期的电量估算会利用此误差系数，校准实际电量值和误差系数，使电量估算更加贴近实际电量。如图4所示，为正常充电过程，自主学习模型学习到误差系数后，在正常充电过程中，充进电池的电量需使用误差系数进行校准，直到充满，充满后，学习到新的电池总电量值。如图5所示，为正常放电过程，使用新学习到的电池总电量进行放电，放电时的功耗使用误差系数进行校准，直到电池放空，放空时根据剩余电量情况，再次修正误差系数。其中，电池放空的判断方法为：持续时间达到设定值，则认为电池已经放空，电量应为0%;电池充满的判断方法：持续时间达到设定值，则认为电池已经充满，电量应为100%;式中：为电池当前电压；为电芯空电压，即单节电芯放空时的电压值，一般锂聚合物电池为3.0V，此参数用于判断电池是否放空；n为电池串联节数；为电芯满电压：电芯满电压，即单节电芯充满时的电压值，一般锂聚合物电池为4.2V，此参数用于判断电池是否充满；为电池当前电流；为停止电流，即表明充电已经结束的电流阀值，应小于充电器的截止电流；另外，每次接近充满时或接近放空时，采用平滑算法，将电量置满或置空，使用户体验更舒服顺畅，避免电量跳变引起的用户不满。至此，电量学习完成，以后每次充放电过程都会自主动态调整误差系数，以适应实际电量。本申请能通过学习适应不同的电池串联数，不同的电池容量，并且可自动学习电池内阻损耗和老化情况，使指示电量始终与实际电量相近，使用户掌握设备的真实电量，避免因电量误差太大导致来不及充电而造成设备不能使用的损失。在上述中，误差系数的计算公式为：式中，R为误差系数，A为电池总电量，B为实际放电电量。修正误差系数包括以下步骤：当放空时，剩余电量大于0，则说明误差系数偏小，调整误差系数为 R+1%；当电池还未放空时，剩余电量已经为0，则说明误差系数偏大，调整误差系数为R-1%。校准后的充电量表示方法为：校准后的放电量表示方法为：式中，T为标准计量时间，I为平均电流，U为平均电压，R为误差系数。本发明通过自主学习模型通过对电池或电池组的误差系数以及电池总电量的学习，在电池充电或放电时，利用误差系数实时调整电池总电量，使得电池的充放电平缓，避免由于电压降低而使得电流增大。比如，在现有的电池电量估算方法中，当电池充满电后，显示电量为100%，刚开始放电时，由于电池一般具有电压逐渐降低的特性曲线，并且放电对象的功率是恒定的，因此当高电压时，电量消耗很慢，电压降低后，电流增大，电量消耗变快。也就是说，电量从100%降到80%的过程会持续较长的时间，也就是人们常说的电池比较耐用，但是当电池放电至电量显示20%时，从20%降到0的过程很快，这就导致同样都是20%的电量，使用的时间却完全不同，不能提醒用户及时充电。在本申请的估算方法下，由于通过电池第一次充放电和第二次充放电，自主学习模型学习到误差系数和电池的总电量，而当满电状态的电池在放电过程中，误差系数实时校准电池剩余电量，即使电量显示20%，仍然可以保证剩余电量的使用时长为满电状态使用时长的1/5，避免因充电不及时导致的设备关机，使得电量估算更可信。以上已经描述了本发明的各实施例，上述说明是示例性的，并非穷尽性的，并且也不限于所披露的各实施例。在不偏离所说明的各实施例的范围和精神的情况下，对于本技术领域的普通技术人员来说许多修改和变更都是显而易见的。本文中所用术语的选择，旨在最好地解释各实施例的原理、实际应用或对市场中的技术改进，或者使本技术领域的其它普通技术人员能理解本文披露的各实施例。
