标题title
基于并行随机迭代求解线性方程组的断层成像方法及系统
摘要abst
本发明提出了基于并行随机迭代求解线性方程组的断层成像方法及系统，涉及计算机断层成像技术领域,建立以像素点吸收系数为未知数的线性方程组；将线性方程组的求解任务按行划分到各处理器上；迭代并行计算各处理器对当前近似解的最优投影和新的近似解，直到新的近似解满足设置的求解精度要求，新的近似解为线性方程组的最终解，即为断层每个像素点的吸收系数；将吸收系数的大小作为灰度图像的像素点亮度大小，绘制断层图像；本发明使用多个处理器并行计算，有效地解决现有方法存储和计算的瓶颈，高效求解计算机断层成像中高精度扫描所产生的高维方程组，减少求解所消耗的内存空间和求解时间，使得计算机断层成像可以产生更高精度的图像。
权利要求书clms
1.基于并行随机迭代求解线性方程组的断层成像方法，其特征在于，包括：使用扫描仪对断层进行射线扫描，依据获取的扫描信号，建立以像素点吸收系数为未知数的线性方程组；将线性方程组的求解任务按行划分到各处理器上；以设置的初始解为当前近似解，迭代并行计算各处理器对当前近似解的最优投影和新的近似解，直到新的近似解满足设置的求解精度要求，新的近似解为线性方程组的最终解，即为断层每个像素点的吸收系数；将吸收系数的大小作为灰度图像的像素点亮度大小，绘制断层图像；其中，各处理器通过贪心采样方法计算各自对当前近似解的最优投影；对各处理器的最优投影进行平均，得到新的近似解。2.如权利要求1所述的基于并行随机迭代求解线性方程组的断层成像方法，其特征在于，所述线性方程组为，A是射线穿过断层各个像素点的路径长度，为系数矩阵， 是断层各个像素点的吸收系数，为待求解的向量， b 是射线的出射强度，为常数项向量。3.如权利要求1所述的基于并行随机迭代求解线性方程组的断层成像方法，其特征在于，所述按行划分，是对系数矩阵和常数项向量进行按行划分，将划分得到的系数矩阵分量及对应的常数项分量，组成子方程组，分配到不同的处理器上。4.如权利要求3所述的基于并行随机迭代求解线性方程组的断层成像方法，其特征在于，所述贪心采样方法，具体为：设置初始投影为当前近似解，投影次数为0；基于子方程组和当前投影，计算投影距离范数最大的超平面；将当前投影投影到计算出来的超平面上，得到新的投影；投影次数加1，返回步骤，计算新的超平面和投影，直到投影次数满足要求。5.如权利要求4所述的基于并行随机迭代求解线性方程组的断层成像方法，其特征在于，所述投影次数满足要求，是投影次数等于子方程组的行数。6.如权利要求4所述的基于并行随机迭代求解线性方程组的断层成像方法，其特征在于，所述计算投影距离范数最大的超平面，具体为：从子方程组中随机选择多个超平面，计算每个超平面的投影距离范数，比较投影距离范数的大小，从中计算投影距离范数最大的超平面。7.如权利要求1所述的基于并行随机迭代求解线性方程组的断层成像方法，其特征在于，所述对各处理器的最优投影进行平均，是对各处理器产生的最优投影的各个元素分别取算数平均，产生新的近似解。8.基于并行随机迭代求解线性方程组的断层成像系统，其特征在于，包括方程建立模块、任务划分模块、并行求解模块和图像绘制模块：方程建立模块，被配置为：使用扫描仪对断层进行射线扫描，依据获取的扫描信号，建立以像素点吸收系数为未知数的线性方程组；任务划分模块，被配置为：将线性方程组的求解任务按行划分到各处理器上；并行求解模块，被配置为：以设置的初始解为当前近似解，迭代并行计算各处理器对当前近似解的最优投影和新的近似解，直到新的近似解满足设置的求解精度要求，新的近似解为线性方程组的最终解，即为断层每个像素点的吸收系数；图像绘制模块，被配置为：将吸收系数的大小作为灰度图像的像素点亮度大小，绘制断层图像；其中，各处理器通过贪心采样方法计算各自对当前近似解的最优投影；对各处理器的最优投影进行平均，得到新的近似解。9.计算机可读存储介质，其上存储有程序，其特征在于，该程序被处理器执行时实现如权利要求1-7任一项所述的基于并行随机迭代求解线性方程组的断层成像方法中的步骤。10.电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的程序，其特征在于，所述处理器执行所述程序时实现如权利要求1-7任一项所述的基于并行随机迭代求解线性方程组的断层成像方法中的步骤。
说明书desc
技术领域本发明属于计算机断层成像技术领域，尤其涉及基于并行随机迭代求解线性方程组的断层成像方法及系统。背景技术本部分的陈述仅仅是提供了与本发明相关的背景技术信息，不必然构成在先技术。计算机断层成像是一种使用X射线获取物体内部截面图像的成像技术，被广泛应用于物理学、生物学、考古学、地球物理学和其他科学领域；首先使用扫描仪从不同角度对物体内部的截面进行多次X射线扫描，使用探测器拾取扫描信号并传输到计算机，经处理产生线性方程组，然后通过迭代方法求解该线性方程组，从而产生截面图像。计算机断层成像扫描产生的线性方程组具有方程数量远远大于未知数数量的特点，因此，通常使用随机Kaczmarz方法求解该线性方程组；但是，随着扫描精度的提高，产生的线性方程组维数越来越大，高达千万维甚至以上；高维度线性方程组占用的存储空间巨大，使用单个处理器求解消耗的时间长，甚至需要花费数天时间，难以求解高精度和超高精度扫描产生的巨大方程组，限制了计算机断层成像的发展。现有的随机Kaczmarz方法使用单个处理器进行存储和计算，单个处理器的内存难以完整存储整个线性方程组，且单个处理器的计算速度十分有限，使得求解所需要的时间成本非常高，限制了计算机断层成像技术的精度，迫切需要借助并行计算技术来缩短计算时间。对于并行计算的可行性，随机Kaczmarz方法具有收敛速度慢、单次迭代计算量小、两次迭代间依赖性强的特点，这使得该方法迭代次数非常多、单次迭代计算成本非常小、每次迭代必须依赖前一次迭代的计算结果，该方法大量的迭代次数和非常小的单次迭代成本使得对每一次迭代步骤进行并行计算因计算量太小而无法有效提高计算效率，反而因并行计算所带来的通信开销使得计算效率大大降低；而每次迭代必须依赖前一次迭代的计算结果又使得同时计算不同的迭代步骤不可行，导致该方法难以利用多个处理器共同存储、同时并行计算，几乎没有并行化的机会，无法有效利用计算机强大的计算能力。也就是说，随机Kaczmarz方法具有收敛速度慢、单次迭代计算量小、两次迭代间依赖性强的特点，使用并行计算，导致非常高的通信量和非常低的浮点运算密度，产生非常低的计算效率和高额时间成本，从而使得在多个处理器上并行求解方程组具有非常大的困难。因此，如何借助多个处理器实现高效高精度快速断层成像，是一项亟待解决的问题。发明内容为克服上述现有技术的不足，本发明提供了基于并行随机迭代求解线性方程组的断层成像方法及系统，使用多个处理器并行计算，有效地解决现有方法存储和计算的瓶颈，高效求解计算机断层成像中高精度扫描所产生的高维方程组，减少求解所消耗的内存空间和求解时间，使得计算机断层成像可以产生更高精度的图像。为实现上述目的，本发明的一个或多个实施例提供了如下技术方案：本发明第一方面提供了基于并行随机迭代求解线性方程组的断层成像方法；基于并行随机迭代求解线性方程组的断层成像方法，包括：使用扫描仪对断层进行射线扫描，依据获取的扫描信号，建立以像素点吸收系数为未知数的线性方程组；将线性方程组的求解任务按行划分到各处理器上；以设置的初始解为当前近似解，迭代并行计算各处理器对当前近似解的最优投影和新的近似解，直到新的近似解满足设置的求解精度要求，新的近似解为线性方程组的最终解，即为断层每个像素点的吸收系数；将吸收系数的大小作为灰度图像的像素点亮度大小，绘制断层图像；其中，各处理器通过贪心采样方法计算各自对当前近似解的最优投影；对各处理器的最优投影进行平均，得到新的近似解。进一步的，所述线性方程组为， A是射线穿过断层各个像素点的路径长度，为系数矩阵， 是断层各个像素点的吸收系数，为待求解的向量， b 是射线的出射强度，为常数项向量。进一步的，所述按行划分是对系数矩阵和常数项向量进行按行划分，将划分得到的系数矩阵分量及对应的常数项分量，组成子方程组，分配到不同的处理器上。进一步的，所述贪心采样方法，具体为：设置初始投影为当前近似解，投影次数为0；基于子方程组和当前投影，计算投影距离范数最大的超平面；将当前投影投影到计算出来的超平面上，得到新的投影；投影次数加1，返回步骤，计算新的超平面和投影，直到投影次数满足要求。进一步的，所述投影次数满足要求，是投影次数等于子方程组的行数。进一步的，所述计算投影距离范数最大的超平面，具体为：从子方程组中随机选择多个超平面，计算每个超平面的投影距离范数，比较投影距离范数的大小，从中计算投影距离范数最大的超平面。进一步的，所述对各处理器的最优投影进行平均，是对各处理器产生的最优投影的各个元素分别取算数平均，产生新的近似解。本发明第二方面提供了基于并行随机迭代求解线性方程组的断层成像系统。断层成像中线性方程组的并行随机迭代求解系统，包括方程建立模块、任务划分模块、并行求解模块和图像绘制模块：方程建立模块，被配置为：使用扫描仪对断层进行射线扫描，依据获取的扫描信号，建立以像素点吸收系数为未知数的线性方程组；任务划分模块，被配置为：将线性方程组的求解任务按行划分到各处理器上；并行求解模块，被配置为：以设置的初始解为当前近似解，迭代并行计算各处理器对当前近似解的最优投影和新的近似解，直到新的近似解满足设置的求解精度要求，新的近似解为线性方程组的最终解，即为断层每个像素点的吸收系数；图像绘制模块，被配置为：将吸收系数的大小作为灰度图像的像素点亮度大小，绘制断层图像；其中，各处理器通过贪心采样方法计算各自对当前近似解的最优投影；对各处理器的最优投影进行平均，得到新的近似解。本发明第三方面提供了计算机可读存储介质，其上存储有程序，该程序被处理器执行时实现如本发明第一方面所述的基于并行随机迭代求解线性方程组的断层成像方法中的步骤。本发明第四方面提供了电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的程序，所述处理器执行所述程序时实现如本发明第一方面所述的基于并行随机迭代求解线性方程组的断层成像方法中的步骤。以上一个或多个技术方案存在以下有益效果：本发明提供的断层成像方法使得计算机断层扫描可以利用多个处理器共同存储、并行计算求解线性方程组，突破了高精度扫描产生的高维方程组无法存储、无法求解的难题，提高了扫描精度和速度。本发明采用并行存储策略减少了单个处理器内存空间使用量，从而可以求解更高维度的方程组；若使用P个处理器并行存储，则求解精度与单处理器相比可以提高P倍。本发明采用并行求解策略减少了线性方程组的求解时间，从而提高了图像生成的速度；若使用P个处理器并行求解，则求解速度与单处理器相比有明显提高，理想条件下可以提高P倍，在实际应用中，随着处理器个数的增加，该倍数逐渐减少。各处理器并行计算近似解的多次投影，每个处理器在一次迭代中进行多次投影，与现有方法一次迭代只进行一次投影不同，解决了现有方法因大量的迭代次数和非常小的单次迭代成本使得对每一次迭代步骤进行并行计算因计算量太小而无法有效提高计算效率，反而因并行计算所带来的通信开销使得计算效率大大降低的问题，从而使求解过程可以利用计算机多处理器强大的计算能力。本发明的贪心采样过程结合了随机选择策略和贪心选择策略；随机选择策略可能会产生糟糕的投影，从而使收敛速度过慢；而贪心选择策略虽然会产生最优的投影，但代价高昂；本发明的贪心采样策略构造了一个低维随机子空间，并在随机子空间中产生最优投影，贪心选择策略的成本在低维空间中非常小；因此，可以以很少的计算成本产生相对最优的投影，解决了现有方法收敛速度慢的问题。本发明通过取各处理器计算的投影的平均值的方式来给出新的近似解，与现有方法在投影之后立即进行迭代，把投影作为新的近似解不同，通过把现有方法中投影和迭代的过程分离，消除了每次迭代必须依赖前一次迭代的计算结果的问题。本发明附加方面的优点将在下面的描述中部分给出，部分将从下面的描述中变得明显，或通过本发明的实践了解到。附图说明构成本发明的一部分的说明书附图用来提供对本发明的进一步理解，本发明的示意性实施例及其说明用于解释本发明，并不构成对本发明的不当限定。图1为第一个实施例的方法流程图。图2为第一个实施例迭代求解线性方程组的流程图。图3为第一个实施例中使用100000×100维度的线性方程组进行测试得到的加速比示意图。图4为第一个实施例中使用500000×500维度的线性方程组进行测试得到的加速比示意图。图5为第一个实施例中使用250000×100维度的线性方程组进行测试得到的加速比示意图。图6为第一个实施例中使用1250000×500维度的线性方程组进行测试得到的加速比示意图。图7为第二个实施例的系统结构图。具体实施方式下面结合附图与实施例对本发明作进一步说明。应该指出，以下详细说明都是示例性的，旨在对本发明提供进一步的说明；除非另有指明，本文使用的所有技术和科学术语具有与本发明所属技术领域的普通技术人员通常理解的相同含义。需要注意的是，这里所使用的术语仅是为了描述具体实施方式，而非意图限制根据本发明的示例性实施方式；如在这里所使用的，除非上下文另外明确指出，否则单数形式也意图包括复数形式，此外，还应当理解的是，当在本说明书中使用术语“包含”和/或“包括”时，其指明存在特征、步骤、操作、器件、组件和/或它们的组合。实施例一本实施例公开了基于并行随机迭代求解线性方程组的断层成像方法，如图1所示，包括：步骤S1、使用扫描仪对断层进行射线扫描，依据获取的扫描信号，建立以像素点吸收系数为未知数的线性方程组；具体的，使用扫描仪对物体内部断层进行X射线扫描，断层是一个截面，X射线通过物体内部断层时会发生吸收，不同角度入射的X射线在物体内部断层中穿过的路径不同，吸收的强弱程度也不同；通过入射角度，确定X射线在物体内部断层中穿过的路径，进而得到路径长度；使用探测器拾取X射线的出射强度，根据朗伯-比尔定律，通过物体内部断层的X射线的吸收过程，用线性方程组表示。其中，A是射线穿过断层各个像素点的路径长度，为系数矩阵， 是断层各个像素点的吸收系数，为待求解的向量， b 是射线的出射强度，为常数项向量。系数矩阵A的列，代表X射线穿过物体内部断层中一个像素点的路径长度。步骤S2、将线性方程组的求解任务按行划分到各处理器上；具体的，求解计算机断层成像扫描产生的线性方程组，其中，系数矩阵是 的矩阵，常数项向量是 的向量，系数矩阵和常数项向量的行数相同，用表示，是系数矩阵的列数，即物体内部断层中像素点的个数，使用 个处理器的线性方程组并行随机迭代求解方法，是处理器个数，为正数；如图2所示，对系数矩阵和常数项向量进行按行分块，分为块，划分成 ，共 个子方程组, 是分配到第个处理上的 的系数矩阵分量， 是分配到第个处理上的 的常数项分量，系数矩阵分量和常数项分量的行数相同，用表示，是系数矩阵分量的列数，是处理器的序号，；各个处理器存储经过划分的线性方程组，每个处理器的内存仅存储其中的一块，即存储子方程组 。步骤S3、以设置的初始解为当前近似解，迭代并行计算各处理器对当前近似解的最优投影和新的近似解，直到新的近似解满足设置的求解精度要求，新的近似解为线性方程组的最终解，即为断层每个像素点的吸收系数；具体的，如图2所示，各处理器将初始解 设置为经验解，若没有经验解则设置为 0 向量，迭代次数 设置为 0，为非负整数，准备开始迭代求解。迭代求解的具体步骤为：步骤S301：设置当前近似解为初始解，迭代次数k为0；步骤S302：并行计算当前近似解的最优投影；各处理器通过贪心采样方法，并行计算各自对当前近似解的最优投影；贪心采样过程结合随机选择策略和贪心选择策略，随机选择策略可能会产生糟糕的投影，从而使收敛速度过慢；而贪心选择策略虽然会产生最优的投影，但代价高昂；本实施例的贪心采样策略构造了一个低维随机子空间，并在随机子空间中产生最优投影，贪心选择策略的成本在低维空间中非常小，因此，它可以以很少的计算成本产生相对最优的投影，解决了现有方法收敛速度慢的问题，具体为：设置初始投影为当前近似解，投影次数为0；各处理器将初始投影 设置为当前近似解，投影次数 设置为 0，为非负整数，准备开始投影，其中，为当前近似解的第0次投影。基于子方程组和当前投影，计算投影距离范数最大的超平面；从子方程组 中随机选择多个超平面，每个超平面被选中的概率与超平面的范数成正比，j为超平面的序号，第j个超平面被选中的概率使用以下公式计算：其中，是第j个超平面的向量，是第j个超平面的右端项常数， 表示 “” 的欧几里得范数，对于每一个选中的超平面，计算投影距离范数： 其中，代表近似解 的第 次投影，比较所有选中超平面的投影距离范数的大小，并且挑选出具有最大的投影距离范数值的超平面 ，分别是具有最大的投影距离范数的超平面的向量和右端项常数，J是具有最大的投影距离范数的超平面的序号。将当前投影投影到计算出来的超平面上，得到新的投影；把当前投影 投影到选中的超平面 上，得到新的投影： 其中，代表近似解 的第i次投影。投影次数i加1，返回步骤，计算新的超平面和投影，直到投影次数i等于子方程组 的系数矩阵分量的行数d，得到最优投影。各处理器并行计算了近似解的多次投影，每个处理器在一次迭代中进行d次投影，与现有方法一次迭代只进行一次投影不同，解决了现有方法因大量的迭代次数和非常小的单次迭代成本使得对每一次迭代步骤进行并行计算因计算量太小而无法有效提高计算效率，反而因并行计算所带来的通信开销使得计算效率大大降低的问题，从而使求解过程可以利用计算机多处理器强大的计算能力。步骤S303：基于最优投影，计算新的近似解；经过 次投影，各处理器都产生了各自对近似解 的最优投影 ；把各处理器产生的投影中的各个元素分别取算数平均，产生新的近似解，记第 个处理器产生的投影为 ，算数平均为： 其中， 代表求解使用的处理器的个数。通过取各处理器计算的投影的平均值的方式来给出新的近似解，与现有方法在投影之后立即进行迭代，把投影作为新的近似解不同，通过把现有方法中投影和迭代的过程分离，消除了每次迭代必须依赖前一次迭代的计算结果的问题。步骤S304：迭代次数 k加1，若本次迭代产生的近似解不满足产生图像所需要的精度，则转到步骤S302，进行新一轮的迭代，否则，近似解即为线性方程组的解。步骤S4、将吸收系数的大小作为灰度图像的像素点亮度大小，绘制断层图像；具体的，从不同角度对断层进行多次扫描，通过截面的X射线束的吸收过程可以用线性方程组表示；通过迭代方法求解该线性方程组，可以得到截面每个像素点的吸收系数，把吸收系数的大小作为灰度图像的像素点亮度大小，从而绘制断层图像。选取四组测试数据对本实施例方法的效果进行验证：使用100000×100维度的线性方程组进行测试，测试规模从1个处理器到8个处理器，分别记录求解时间，计算加速比，加速比如图3所示。使用500000×500维度的线性方程组进行测试，测试规模从1个处理器到8个处理器，分别记录求解时间，计算加速比，加速比如图4所示。使用250000×100维度的线性方程组进行测试，测试规模从1个处理器到8个处理器，分别记录求解时间，计算加速比,加速比如图5所示。使用1250000×500维度的线性方程组进行测试，测试规模从1个处理器到8个处理器，分别记录求解时间，计算加速比,加速比如图6所示。基于以上四组测试数据的结果，可以看到本实施例方法具有近线性加速比，将处理器的数量加倍，计算速度也会加倍，这表明本实施例方法充分利用了每个参与计算的处理器的性能，各处理器的计算效率接近单处理器求解的理想计算效率，解决了并行求解高精度扫描产生的高维方程组计算效率低、无法有效利用处理器性能的难题，提高了扫描精度和速度。实施例二本实施例公开了基于并行随机迭代求解线性方程组的断层成像系统；如图7所示，基于并行随机迭代求解线性方程组的断层成像系统，包括方程建立模块、任务划分模块、并行求解模块和图像绘制模块：方程建立模块，被配置为：使用扫描仪对断层进行射线扫描，依据获取的扫描信号，建立以像素点吸收系数为未知数的线性方程组；任务划分模块，被配置为：将线性方程组的求解任务按行划分到各处理器上；并行求解模块，被配置为：以设置的初始解为当前近似解，迭代并行计算各处理器对当前近似解的最优投影和新的近似解，直到新的近似解满足设置的求解精度要求，新的近似解为线性方程组的最终解，即为断层每个像素点的吸收系数；图像绘制模块，被配置为：将吸收系数的大小作为灰度图像的像素点亮度大小，绘制断层图像；其中，各处理器通过贪心采样方法计算各自对当前近似解的最优投影；对各处理器的最优投影进行平均，得到新的近似解。实施例三本实施例的目的是提供计算机可读存储介质。计算机可读存储介质，其上存储有计算机程序，该程序被处理器执行时实现如本公开实施例一所述的基于并行随机迭代求解线性方程组的断层成像方法中的步骤。实施例四本实施例的目的是提供电子设备。电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的程序，所述处理器执行所述程序时实现如本公开实施例一所述的基于并行随机迭代求解线性方程组的断层成像方法中的步骤。以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
