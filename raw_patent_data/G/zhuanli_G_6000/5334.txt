标题title
一种自动售货机VMC与外设装置间的桥接方法及装置
摘要abst
本发明公开了一种自动售货机VMC与外设装置间桥接方法，所方法包括由外设装置发送需要模拟MDB从属设备的复位指令给桥接设备，桥接设备记录外设装置的设备地址，由自动售货机VMC发送轮询帧，桥接设备将存储的由外设装置发送的复位指令转为9bit帧发送给自动售货机VMC，自动售货机VMC收到桥接设备回复的该地址的复位指令后，发送出设置帧，桥接设备回复自动售货机VMC设备确认字符ACK，桥接设备将自动售货机VMC发送的设置帧转换成为8bit帧发送给外设装置，外设装置将配置数据帧发送给桥接设备，自动售货机VMC发送轮询帧给桥接设备，桥接设备在收到自动售货机VMC发送的轮询帧后将配置数据帧封装为MDB格式帧发送给自动售货机VMC。
权利要求书clms
1.一种自动售货机VMC与外设装置间的桥接方法，其特征在于，所述桥接方法包括如下步骤：A.由外设装置发送需要模拟MDB从属设备的复位指令给桥接设备；所述复位指令的格式为:外设装置的设备地址+命令字节；B.桥接设备接收并存储该复位指令，并记录外设装置的设备地址；C由自动售货机VMC发送轮询帧；D.桥接设备收到自动售货机VMC发送的轮询帧后，将存储的由外设装置发送的复位指令去掉地址字节并重新计算校验，并在最后字节后加上模式位后，转为9bit帧发送给自动售货机VMC；E.自动售货机VMC收到桥接设备回复的该地址的复位指令后，发送出设置帧；F.桥接设备回复自动售货机VMC设备确认字符ACK；G.桥接设备将自动售货机VMC发送的设置帧去掉命令字节的mode位，并转换成为8bit帧发送给外设装置；H.外设装置将配置数据帧发送给桥接设备，所述配置数据帧的格式为:外设装置的设备地址+命令字节；I.自动售货机VMC发送轮询帧给桥接设备；J.桥接设备在收到自动售货机VMC发送的轮询帧后将配置数据帧封装为MDB格式帧发送给自动售货机VMC；K.自动售货机VMC发送业务数据1；L.桥接设备在收到自动售货机VMC发出的业务数据1后回复确认字符ACK，并将业务数据1去掉命令字节的mode位，并转换成为8bit帧发送给外设装置；M.外设装置发送业务数据2给桥接设备，所述业务数据2的格式为:外设装置的设备地址+命令字节；N.桥接设备收到业务数据2后，去掉地址字节并转为9bit的MDB格式帧，通过自动售货机VMC发出对应地址的轮询帧后，回复给自动售货机VMC。2.根据权利要求1所述的桥接方法，在当MDB总线空闲时，自动售货机VMC将定期发送轮询帧。3.根据权利要求2所述的桥接方法，当桥接设备中没有存储外设装置发出的指令时，桥接设备则直接回复自动售货机VMC确认字符ACK。4.一种自动售货机VMC与外设装置间的桥接装置，所述桥接装置中存储有用于实现上述权利要求1至3之一所述的桥接方法的指令。5.一种存储装置，所述存储装置中存储有用于实现上述权利要求1至3之一所述的桥接方法的指令。
说明书desc
技术领域本发明涉及自动售货机技术领域，尤其涉及一种自动售货机VMC与外设装置间的桥接方法及装置。背景技术在商业自动售货机结构中，自动售货机的公共现金接收部件包括自动售货控制和纸币/硬币接收器。它们通过标准MDB/内部通信协议进行通信。尽管MDB/ICP标准可以支持主从设备到多从设备的通信，但是较老的自动售货机没有考虑更多的部件用于附加的支付选项。因此，现有的自动售货机很难重新配置或升级。另外，为了支持中央云管理平台，需要具备所有支付的聚合功能。基于MDB/ICP中的主/从体系结构，云管理不可能直接与从设备通信。商用MDB/ICP-232替换基于模拟MDB/VMC定时控制来与票据/硬币接收器通信，但是它不提供通过MDB/ICP标准与主设备的通信。因此，这种替换不能直接用于升级现有的较老的自动售货机。现有技术中存在的桥接方法都是将MDB协议转换为私有协议，并提供给开发者。此时开发者仅需要关心私有协议。但这种桥接方法同时能够接入的MDB外设装置的数量有限，通用性比较差。由此可见，本领域中急需一种新的能够实现自动售货机VMC与外设装置间桥接得方法，且使外设装置更为方便的接入自动售货机VMC。发明内容本发明所要解决的技术问题之一是现实自动售货机VMC与外设装置间桥接。为了解决上述技术问题，本发明提供了一种自动售货机VMC与外设装置间桥接方法，所述桥接方法包括如下步骤：A.由外设装置发送需要模拟MDB从属设备的复位指令给桥接设备；所述复位指令的格式为:外设装置的设备地址+命令字节；B.桥接设备接收并存储该复位指令，并记录外设装置的设备地址。C由自动售货机VMC发送轮询帧。D.桥接设备收到自动售货机VMC发送的轮询帧后，将存储的由外设装置发送的复位指令去掉地址字节并重新计算校验，并在最后字节后加上模式位后，转为9bit帧发送给自动售货机VMC。E.自动售货机VMC收到桥接设备回复的该地址的复位指令后，发送出设置帧。F.桥接设备回复自动售货机VMC设备确认字符ACK。G.桥接设备将自动售货机VMC发送的设置帧去掉命令字节的mode位，并转换成为8bit帧发送给外设装置。H.外设装置将配置数据帧发送给桥接设备，所述配置数据帧的格式为:外设装置的设备地址+命令字节。I.自动售货机VMC发送轮询帧给桥接设备。J.桥接设备在收到自动售货机VMC发送的轮询帧后将配置数据帧封装为MDB格式帧发送给自动售货机VMC；K.自动售货机VMC发出业务数据1；L.桥接设备在收到自动售货机VMC发出的业务数据1后回复确认字符ACK，并将业务数据1去掉命令字节的mode位，并转换成为8bit帧发送给外设装置；M.外设装置发送业务数据2给桥接设备，所述业务数据2的格式为:外设装置的设备地址+命令字节；N.桥接设备收到业务数据2后，去掉地址字节并转为9bit的MDB格式帧，通过自动售货机VMC发出对应地址的轮询帧后，回复给自动售货机VMC。在一个实施例中，在当MDB总线空闲时，自动售货机VMC将定期发送轮询帧。在一个实施例中，当桥接设备中没有存储外设装置发出的指令时，桥接设备则直接回复自动售货机VMC确认字符ACK。根据本发明的另一方面，还提供了一种自动售货机VMC与外设装置间的桥接装置，所述桥接装置中存储有用于实现上述桥接方法的指令。根据本发明的另一方面，还提供了一种存储装置，所述存储装置中存储有用于实现上述桥接方法的指令。本发明中外设装置发送帧格式为：地址+MDB业务数据，桥接设备转发外部装置给自动售货机VMC的帧的处理方式为：去掉地址字节，将业务数据帧转换为9bit，并在最后一个字节添加上模式位，桥接设备转发自动售货机VMC的数据给外部装置的处理方式为：去掉首字节即命令字节的模式，将9bit帧转换位8bit。与现有技术相比，本发明的技术方案可以具有如下优点：1、本发明的技术方案实现了复用MDB协议，针对不同种类的外设装置无需对外设装置作出改变即可直接接入，实现外设设备与自动售货机VMC之间的通讯。2、本发明的技术方案提高了自动售货机VMC扩展性，当MDB协议更新时，仅需要对桥接设备进行相应的更新即可实现保证原来接入的外设被依然正常工作。本发明的其它特征和优点将在随后的说明书中阐述，并且，部分地从说明书中变得显而易见，或者通过实施本发明而了解。本发明的目的和其他优点可通过在说明书、权利要求书以及附图中所特别指出的结构来实现和获得。附图说明附图用来提供对本发明的进一步理解，并且构成说明书的一部分，与本发明的实施例共同用于解释本发明，并不构成对本发明的限制。在附图中：图1是根据本发明一实施例的方法的流程示意图。具体实施方式为使本发明的目的、技术方案和优点更加清楚，以下结合附图对本发明作进一步地详细说明。图1是根据本发明一实施例的流程示意图。本实施例中，自动售货机VMC与桥接设备之间采用MDB总线连接，根据MDB协议进行通讯。桥接设备与外设装置之间使用RS232接口进行连接。下面结合图1对本方法进行说明。本实施例的自动售货机VMC与外设装置间桥接方法包括如下步骤：A.由外设装置发送需要模拟MDB从属设备的复位指令给桥接设备；所述复位指令的格式为:外设装置的设备地址+命令字节；B.桥接设备接收并存储该复位指令，并记录外设装置的设备地址。C由自动售货机VMC发送轮询帧。D.桥接设备收到自动售货机VMC发送的轮询帧后，将存储的由外设装置发送的复位指令去掉地址字节并重新计算校验，并在最后字节后加上模式位后，转为9bit帧发送给自动售货机VMC。E.自动售货机VMC收到桥接设备回复的该地址的复位指令后，发送出设置帧。F.桥接设备回复自动售货机VMC设备确认字符ACK。G.桥接设备将自动售货机VMC发送的设置帧去掉命令字节的mode位，并转换成为8bit帧发送给外设装置。H.外设装置将配置数据帧发送给桥接设备，所述配置数据帧的格式为:外设装置的设备地址+命令字节。I.自动售货机VMC发送轮询帧给桥接设备。J.桥接设备在收到自动售货机VMC发送的轮询帧后将配置数据帧封装为MDB格式帧发送给自动售货机VMC；K.自动售货机VMC发出业务数据1；L.桥接设备在收到自动售货机VMC发出的业务数据1后回复确认字符ACK，并将业务数据1去掉命令字节的mode位，并转换成为8bit帧发送给外设装置；M.外设装置发送业务数据2给桥接设备，所述业务数据2的格式为:外设装置的设备地址+命令字节；N.桥接设备收到业务数据2后，去掉地址字节并转为9bit的MDB格式帧，通过自动售货机VMC发出对应地址的轮询帧后，回复给自动售货机VMC。在本实施例的桥接方法中，在当MDB总线空闲时，自动售货机VMC将定期发送轮询帧。同时，当桥接设备中没有存储外设装置发出的指令时，桥接设备则直接回复自动售货机VMC确认字符ACK。以上所述，仅为本发明的具体实施案例，本发明的保护范围并不局限于此，任何熟悉本技术的技术人员在本发明所述的技术规范内，对本发明的修改或替换，都应在本发明的保护范围之内。
