标题title
一种实现SWP全双工通讯的系统及方法
摘要abst
本发明提供了一种实现SWP全双工通讯的系统及方法，该系统在UICC内部SWP PAD后端分别连接SWP接收模块和SWP发送模块，SWP接收模块与SWP发送模块同时连接到双端口RAM的两组端口。通过RAM中不同的地址来区分数据的接收区和数据的发送区，实现只需使用8.7MHz到17.4MHz的低速率时钟和一个双端口RAM即可完成支持全速率的SWP同时接收和发送数据的方案，即使用双端口RAM可以利用两个端口同时写入不同地址的数据和同时读出相同地址以及不同地址数据的特性，可以解决不易实现，不易管理，面积大，成本高等问题。
权利要求书clms
1.一种实现SWP全双工通讯的系统，其特征在于，包括SWP模块和CPU，所述SWP模块包括双端口RAM、SWP接收模块、SWP发送模块、SWP控制器以及SWP PAD，所述SWP控制器一端与所述双端口RAM相连，另一端与所述CPU相连；所述SWP接收模块和所述SWP发送模块分别连接在所述双端口RAM的两个不同端口上，所述CPU通过所述SWP控制器控制双端口RAM中所述SWP接收模块和所述SWP发送模块的作业过程；所述SWP PAD作为SWP数据端口，包括电压域数字调制信号通路S1和电流域数字调制信号通路S2，所述SWP接收模块与所述电压域数字调制信号通路S1相连，SWP发送模块与电流域数字调制信号通路S2相连，所述电压域数字调制信号通路S1用于接收SWP模块接收到的数字信号，并传给所述SWP接收模块，所述SWP接收模块接收数据后发送给所述双端口RAM；所述电流域数字调制信号通路S2用于接收SWP发送模块待发送的数据，并将其发送给CLF。2.根据权利要求1所述的实现SWP全双工通讯的系统，其特征在于，所述SWP控制器与所述CPU之间依次通过APB总线、AHB TO APB桥和AHB总线相连。3.根据权利要求1所述的实现SWP全双工通讯的系统，其特征在于，所述SWP接收模块接收数据后发送给所述双端口RAM，具体为：所述SWP接收模块接收电压域数字调制信号通路S1传输的数据时，当接收到的数据每满一个字节就直接写入双端口RAM，然后CPU通过SWP控制器读取写入双端口RAM中的数据并按照协议进行解析。4.根据权利要求3所述的实现SWP全双工通讯的系统，其特征在于，所述CPU处理完待解析的数据后，根据协议将待发送的解析完的数据通过SWP控制器写入双端口RAM，待数据写入完毕后，所述SWP控制器控制连接在所述双端口RAM上的SWP发送模块发送到SWP PAD上的电流域数字调制信号通路S2，并最终通过电流信号发送到CLF。5.根据权利要求3所述的实现SWP全双工通讯的系统，其特征在于，所述双端口RAM包括多个接收数据存储区和多个发送数据存储区，所述接收数据存储区和发送数据存储区数量相同，每个接收数据存储区和发送数据存储区能够分别存储一个字节。6.根据权利要求5所述的实现SWP全双工通讯的系统，其特征在于，所述双端口RAM包括4个接收数据存储区和4个发送数据存储区，其中，接受数据存储区地址为：0x00~0x1f，0x20~0x3f，0x40~0x5f，0x60~0x7f；发送数据存储区地址为：0x80~0x9f，0xa0~0xbf，0xc0~0xdf，0xe0~0xff。7.根据权利要求1所述的实现SWP全双工通讯的系统，其特征在于，所述SWP接收模块和所述SWP发送模块内还包括低频时钟模块，所述低频时钟模块频率范围为8.7MHz到17.4MHz。8.一种实现SWP全双工通讯的方法，基于权利要求1-7任一所述的实现SWP全双工通讯的系统，其特征在于，包括以下步骤：S101，CLF发送通讯数据到UICC，UICC中的SWP PAD获取信号后，通过电压域数字调制信号通路S1发送到SWP接收模块；S102，所述SWP接收模块每接收到一个字节的数据就传输给所述双端口RAM中的一个接收数据存储区，然后CPU通过SWP控制器读取写入双端口RAM中接收数据存储区中的数据并按照协议进行解析；S103，待数据解析完成后，根据协议将解析完成的数据通过SWP控制器写入双端口RAM上的某个发送数据存储区，待该发送数据存储区中的数据满一个字节后采用所述SWP发送模块通过SWP控制器将接收到的数据通过电流域数字调制信号通路S2发送到SWP PAD，最后发送到CLF。9.根据权利要求8所述的实现SWP全双工通讯的方法，其特征在于，所述双端口RAM中分别包括四个接收数据存储区和四个发送数据存储区，步骤S101和步骤S102中的步骤循环进行，步骤S103中的过程也同时循环进行。
说明书desc
技术领域本发明涉及芯片涉及技术领域，尤其涉及一种实现SWP全双工通讯的系统及方法。背景技术SWP是SOC与NFC模块通讯的一种标准协议。SOC支持SWP的一般做法是在芯片内集成一个硬件模块PHY。现有技术的SWP数据传递图如图1所示，其中CLF是主设备,UICC是从设备，信号S1是电压域的数字调制信号，信号S2是电流域的数字调制信号；SWP接口是UICC和CLF 之间的面向比特流，点到点通信的协议。当主设备以高状态发送S1信号，从设备借助上拉电流或不借助上拉电流来传输S2信号。因信号S1以脉冲宽度编码，所以可以在它上面传送一个传输时钟，即数据以全双工模式传输。在实现硬件模块时为了支持SWP接口的全速率的全双工通讯特性，最少需要34MHz以上的模块时钟和两块RAM或者两块FIFO或者多组寄存器，实现时功耗大，面积大，成本高，管理不方便，不易实现。为了解决上述存在的技术问题，因此需要找到一种能够实现SWP全双工通讯的系统及方法。发明内容本发明的目的在于提供一种实现SWP全双工通讯的系统及方法，从而解决现有技术中存在的前述问题。为了实现上述目的，本发明采用的技术方案如下：一种实现SWP全双工通讯的系统，包括SWP模块和CPU，所述SWP模块包括双端口RAM、SWP接收模块、SWP发送模块、SWP控制器以及SWP PAD，所述SWP控制器一端与所述双端口RAM相连，另一端与所述CPU相连；所述SWP接收模块和所述SWP发送模块分别连接在所述双端口RAM的两个不同端口上，所述CPU通过所述SWP控制器控制双端口RAM中所述SWP接收模块和所述SWP发送模块的作业过程；所述SWP PAD作为SWP数据端口，包括电压域数字调制信号通路S1和电流域数字调制信号通路S2，所述SWP接收模块与所述电压域数字调制信号通路S1相连，SWP发送模块与电流域数字调制信号通路S2相连，所述电压域数字调制信号通路S1用于接收SWP模块接收到的数字信号，并传给所述SWP接收模块，所述SWP接收模块接收数据后发送给所述双端口RAM；所述电流域数字调制信号通路S2用于接收SWP发送模块待发送的数据，并将其发送给CLF。优选的，所述SWP控制器与所述CPU之间依次通过APB总线、AHB TO APB桥和AHB总线相连。优选的，所述SWP接收模块接收数据后发送给所述双端口RAM，具体为：所述SWP接收模块接收电压域数字调制信号通路S1传输的数据时，当接收到的数据每满一个字节就直接写入双端口RAM，然后CPU通过SWP控制器读取写入双端口RAM中的数据并按照协议进行解析。优选的，所述CPU处理完待解析的数据后，根据协议将待发送的解析完的数据通过SWP控制器写入双端口RAM，待数据写入完毕后，所述SWP控制器控制连接在所述双端口RAM上的SWP发送模块发送到SWP PAD上的电流域数字调制信号通路S2，并最终通过电流信号发送到CLF。更优选的，所述双端口RAM包括多个接收数据存储区和多个发送数据存储区，所述接收数据存储区和发送数据存储区数量相同，每个接收数据存储区和发送数据存储区能够分别存储一个字节。更优选的，所述双端口RAM包括4个接收数据存储区和4个发送数据存储区，其中，接受数据存储区地址为：0x00~0x1f，0x20~0x3f，0x40~0x5f，0x60~0x7f；发送数据存储区地址为：0x80~0x9f，0xa0~0xbf，0xc0~0xdf，0xe0~0xff。优选的，所述SWP接收模块和所述SWP发送模块内还包括低频时钟模块，所述低频时钟模块频率范围为8.7MHz到17.4MHz。本发明的另一个目的在于提供一种实现SWP全双工通讯的方法，基于所述的实现SWP全双工通讯的系统实现，包括以下步骤：S101，CLF发送通讯数据到UICC，UICC中的SWP PAD获取信号后，通过电压域数字调制信号通路S1发送到SWP接收模块；S102，所述SWP接收模块每接收到一个字节的数据就传输给所述双端口RAM中的一个接收数据存储区，然后CPU通过SWP控制器读取写入双端口RAM中接收数据存储区中的数据并按照协议进行解析；S103，待数据解析完成后，根据协议将解析完成的数据通过SWP控制器写入双端口RAM上的某个发送数据存储区，待该发送数据存储区中的数据满一个字节后采用所述SWP发送模块通过SWP控制器将接收到的数据通过电流域数字调制信号通路S2发送到SWP PAD，最后发送到CLF。优选的，由于所述双端口RAM中分别包括四个接收数据存储区和四个发送数据存储区，因此在实际的运行过程中，步骤S101和步骤S102中的步骤循环进行，步骤S103中的过程也同时循环进行，二者相互之间不受影响，从而使得SWP接口实现了全双工通讯过程。步骤S101中，采用SWP接收模块接收信号时，其中的低频时钟模块包括两个采样时钟，当一个采样时钟采样到低电平信号S1，则另一个采样时钟就采样到高电平信号S1，具体原理包括以下内容：1）采样时钟1检测到信号S1上升沿，此时计数器dec_cntr设为1；2）当低频时钟模块的采样时钟1检测到信号S1位于高电平时，计数器dec_cntr做加1操作；3）当采样时钟2检测到信号S1位于低电平，计数器dec_cntr做减1操作；4）采样时钟检测到S1上升沿，产生bit_start信号；接收数据位rx_data根据计数器dec_cntr结果赋值；若计数器dec_cntr结果不为0，接收数据位rx_data数据为逻辑1；若计数器dec_cntr结果为0，则接收数据位rx_data数据为逻辑0。本发明的有益效果是：本发明提供了一种实现SWP全双工通讯的系统及方法，该在UICC内部SWP PAD后端分别连接SWP接收模块和SWP发送模块，SWP接收模块与SWP发送模块同时连接到双端口RAM的两组端口。通过RAM中不同的地址来区分数据的接收区和数据的发送区，实现只需使用8.7MHz到17.4MHz的低速率时钟和一个双端口RAM即可完成支持全速率的SWP同时接收和发送数据的方案，即使用双端口RAM可以利用两个端口同时写入不同地址的数据和同时读出相同地址以及不同地址数据的特性，可以解决不易实现，不易管理，面积大，成本高等问题。附图说明图1是现有技术中SWP数据传输原理图；图2是实施例1中提供的实现SWP全双工通讯的系统组成图；图3是实施例2中提供的实现SWP全双工通讯的方法流程图；图4是实施例2中SWP接收模块接收数据时时钟模块的采样过程。具体实施方式为了使本发明的目的、技术方案及优点更加清楚明白，以下结合附图，对本发明进行进一步详细说明。应当理解，此处所描述的具体实施方式仅仅用以解释本发明，并不用于限定本发明。实施例1本实施例提供了一种实现SWP全双工通讯的系统，如图2所示，包括SWP模块和CPU，所述SWP模块包括双端口RAM、SWP接收模块、SWP发送模块、SWP控制器以及SWP PAD，所述SWP控制器一端与所述双端口RAM相连，另一端与所述CPU相连；所述SWP接收模块和所述SWP发送模块分别连接在所述双端口RAM的两个不同端口上，所述CPU通过所述SWP控制器控制双端口RAM中所述SWP接收模块和所述SWP发送模块的作业过程；所述SWP PAD作为SWP数据端口，包括电压域数字调制信号通路S1和电流域数字调制信号通路S2，所述SWP接收模块与所述电压域数字调制信号通路S1相连，SWP发送模块与电流域数字调制信号通路S2相连，所述电压域数字调制信号通路S1用于接收SWP模块接收到的数字信号，并传给所述SWP接收模块，所述SWP接收模块接收数据后发送给所述双端口RAM；所述电流域数字调制信号通路S2用于接收SWP发送模块待发送的数据，并将其发送给CLF。本实施例中的所述SWP控制器与所述CPU之间依次通过APB总线、AHB TO APB桥和AHB总线相连。本实施例中的所述SWP接收模块接收数据后发送给所述双端口RAM，具体为：所述SWP接收模块接收电压域数字调制信号通路S1传输的数据时，当接收到的数据每满一个字节就直接写入双端口RAM，然后CPU通过SWP控制器读取写入双端口RAM中的数据并按照协议进行解析。当所述CPU处理完待解析的数据后，根据协议将待发送的解析完的数据通过SWP控制器写入双端口RAM，待数据写入完毕后，所述SWP控制器控制连接在所述双端口RAM上的SWP发送模块发送到SWP PAD上的电流域数字调制信号通路S2，并最终通过电流信号发送到CLF。本实施例中的所述双端口RAM包括多个接收数据存储区和多个发送数据存储区，所述接收数据存储区和发送数据存储区数量相同，每个接收数据存储区和发送数据存储区能够分别存储一个字节。更优选的，所述双端口RAM包括4个接收数据存储区和4个发送数据存储区，其中，接受数据存储区地址为：0x00~0x1f，0x20~0x3f，0x40~0x5f，0x60~0x7f；发送数据存储区地址为：0x80~0x9f，0xa0~0xbf，0xc0~0xdf，0xe0~0xff。本实施例中所述SWP接收模块和所述SWP发送模块内还包括低频时钟模块，所述低频时钟模块频率范围为8.7MHz到17.4MHz，其中的低频时钟模块包括两个采样时钟，当一个采样时钟采样到低电平信号S1，则另一个采样时钟就采样到高电平信号S1，具体原理包括以下内容：1）采样时钟1检测到信号S1上升沿，此时计数器dec_cntr设为1；2）当低频时钟模块的采样时钟1检测到信号S1位于高电平时，计数器dec_cntr做加1操作；3）当采样时钟2检测到信号S1位于低电平，计数器dec_cntr做减1操作；4）采样时钟检测到S1上升沿，产生bit_start信号；接收数据位rx_data根据计数器dec_cntr结果赋值；若计数器dec_cntr结果不为0，接收数据位rx_data数据为逻辑1；若计数器dec_cntr结果为0，则接收数据位rx_data数据为逻辑0。实施例2本实施例提供一种实现SWP全双工通讯的方法，原理示意图如图3所示，基于实施例1中所述的实现SWP全双工通讯的系统实现，包括以下步骤：S101，CLF发送通讯数据到UICC，UICC中的SWP PAD获取信号后，通过电压域数字调制信号通路S1发送到SWP接收模块；S102，所述SWP接收模块每接收到一个字节的数据就传输给所述双端口RAM中的一个接收数据存储区，然后CPU通过SWP控制器读取写入双端口RAM中接收数据存储区中的数据并按照协议进行解析；S103，待数据解析完成后，根据协议将解析完成的数据通过SWP控制器写入双端口RAM上的某个发送数据存储区，待该发送数据存储区中的数据满一个字节后采用所述SWP发送模块通过SWP控制器将接收到的数据通过电流域数字调制信号通路S2发送到SWP PAD，最后发送到CLF。由于所述双端口RAM中分别包括四个接收数据存储区和四个发送数据存储区，因此在实际的运行过程中，步骤S101和步骤S102中的步骤循环进行，步骤S103中的过程也同时循环进行，二者相互之间不受影响，从而使得SWP接口实现了全双工通讯过程。步骤S101中，采用SWP接收模块接收信号时，其中的低频时钟模块包括两个采样时钟，当一个采样时钟采样到低电平信号S1，则另一个采样时钟就采样到高电平信号S1，具体原理如图4所示，包括以下内容：1）采样时钟1检测到信号S1上升沿，此时计数器dec_cntr设为1；2）当低频时钟模块的采样时钟1检测到信号S1位于高电平时，计数器dec_cntr做加1操作；3）当采样时钟2检测到信号S1位于低电平，计数器dec_cntr做减1操作；4）采样时钟检测到S1上升沿，产生bit_start信号；接收数据位rx_data根据计数器dec_cntr结果赋值；若计数器dec_cntr结果不为0，接收数据位rx_data数据为逻辑1；若计数器dec_cntr结果为0，则接收数据位rx_data数据为逻辑0。通过采用本发明公开的上述技术方案，得到了如下有益的效果： 本发明提供了一种实现SWP全双工通讯的系统及方法，该在UICC内部SWP PAD后端分别连接SWP接收模块和SWP发送模块，SWP接收模块与SWP发送模块同时连接到双端口RAM的两组端口。通过RAM中不同的地址来区分数据的接收区和数据的发送区，实现只需使用8.7MHz到17.4MHz的低速率时钟和一个双端口RAM即可完成支持全速率的SWP同时接收和发送数据的方案，即使用双端口RAM可以利用两个端口同时写入不同地址的数据和同时读出相同地址以及不同地址数据的特性，可以解决不易实现，不易管理，面积大，成本高等问题。以上所述仅是本发明的优选实施方式，应当指出，对于本技术领域的普通技术人员来说，在不脱离本发明原理的前提下，还可以做出若干改进和润饰，这些改进和润饰也应视本发明的保护范围。
