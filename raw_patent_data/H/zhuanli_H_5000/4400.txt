标题title
一种有线无线融合的航天器内时间敏感网络队列管理调度方法
摘要abst
本发明涉及有线无线融合的航天器内部时间敏感网络通信技术领域，具体涉及一种有线无线融合的航天器内时间敏感网络队列管理调度方法，包括将航天器内部数据包中的有线TSN帧映射到无线TDMA帧中，根据数据帧的目的MAC地址和QoS字段将其存储到对应输出端口的缓存队列中；缓存队列中存入的数据包需小于此队列所能存储的最大数据量阈值，将非TSN流的数据包进行入队管理，为TSN流的数据包打上入队时间戳后进行入队管理；出队调度时判断当前时隙是否属于本无线节点，若是，则采用权值队列平均时延最小调度算法调度各类数据包；本发明能够确定性保障TSN流在网络中传输，而且公平地调度非TSN数据包，从而提升网络的整体吞吐量。
权利要求书clms
1.一种有线无线融合的航天器内时间敏感网络队列管理调度方法，其特征在于，将航天器内部数据包中的有线TSN帧映射到无线TDMA帧中，根据数据帧的目的MAC地址和QoS字段将其存储到对应输出端口的缓存队列中；缓存队列中存入的数据包需小于此队列所能存储的最大数据量阈值，将非TSN流的数据包进行入队管理，为TSN流的数据包打上入队时间戳后进行入队管理；出队调度时判断当前时隙是否属于本无线节点，若是，则采用权值队列平均时延最小调度算法调度各类数据包。2.根据权利要求1所述的一种有线无线融合的航天器内时间敏感网络队列管理调度方法，其特征在于，将航天器内部数据包中的有线TSN帧映射到无线TDMA帧中包括：有线TSN帧为一个带有VLAN标签的以太网帧，TDMA帧为自定义的802.11帧，自定义的802.11帧包括采用802.11头部、序号、数据长度QoS字段、最大存活时间、负载以及32位的CRC校验；航天器内部有线侧数据经过TSN交换机到达TSN网关接收端口时，将有线TSN帧转换为802.11无线帧，将VLAN标签中的pcp优先级字段映射到无线TDMA帧的QoS字段，并且将自定义的数据包最大存活依次映射到无线TDMA帧中。3.根据权利要求1所述的一种有线无线融合的航天器内时间敏感网络队列管理调度方法，其特征在于，根据数据帧的目的MAC地址和QoS字段将其存储到对应输出端口的缓存队列中，即根据无线TDMA帧的目的MAC地址和QoS字段将无线TDMA帧存储到对应缓存队列中，即若TDMA帧的QoS字段为特定数值，即该数据包为时敏数据，则存储到TSN列表；否则，即该数据包为非时敏数据，则将该数据包存储到非TSN列表。4.根据权利要求3所述的一种有线无线融合的航天器内时间敏感网络队列管理调度方法，其特征在于，非TSN流的数据包和TSN流的数据包在进行入队管理之前，按照网络中优先级值范围设置出门控循环列表数量，判断TSN列表和非TSN列表中的缓存队列占用的总存储空间，若该总存储空间没有超过全局限制阈值，则对TSN列表和非TSN列表中的缓存队列进行入队操作；否则对非TSN列表中最长的缓存队列进行数据包的丢弃，直到总存储空间没有超过全局限制阈值，再对TSN列表和非TSN列表中的缓存队列进行入队操作。5.根据权利要求1所述的一种有线无线融合的航天器内时间敏感网络队列管理调度方法，其特征在于，将非TSN流的数据包进行入队管理，即提取非TSN流的数据包最大存活字段，获取本数据包过期的时间阈值，计算数据包的剩余存活时间能否完成数据报文的传输，若数据包的传输时延小于或等于数据包的剩余存活时间，则将此数据包压入队列，若大于数据包的剩余存活时间，则丢弃该数据包。6.根据权利要求5所述的一种有线无线融合的航天器内时间敏感网络队列管理调度方法，其特征在于，数据包的传输时延表示为：其中，为数据包的传输时延；hi为数据传输链路中需要经过的节点总数；为数据通过在第n个节点内的传输时延；为有线链路的数据传播时延；节点n的数据处理时间。7.根据权利要求5所述的一种有线无线融合的航天器内时间敏感网络队列管理调度方法，其特征在于，若TSN流到达概率服从泊松分布，服务时间服从指数分布，则TSN流的排队时延表示为：其中，Dnomal为TSN流到达概率服从泊松分布、服务时间服从指数分布的排队时延；M为TSN列表中队列数目；表示TSN流s在每个发送周期Ti的数据量；为TSN流终端di在周期Ti内数据量发送时延；V为无线传输速率；为TSN流终端di在每个周期Ti产生的业务量。8.根据权利要求7所述的一种有线无线融合的航天器内时间敏感网络队列管理调度方法，其特征在于，TSN流终端di在周期Ti内数据量发送时延表示为：其中，hi为数据传输链路中需要经过的节点总数；为交换机内部处理时延；为有线的传输时延；为有线的传播时延。9.根据权利要求1所述的一种有线无线融合的航天器内时间敏感网络队列管理调度方法，其特征在于，采用动态权值调度算法调度各类数据包的过程包括以下步骤：101、TSN网关在收到网关下发的时隙表后，根据时隙表设定的本节点发送时隙，设定相应的计时器，根据计时器触发本节点发送状态；102、本地计时器触发本节点的发送状态，节点对自身TSN列表进行轮询，循环检测各队列的发送权值；103、若轮询队列的权值pi大于正在发送的数据权值pj，则判断当前正在传输的是否为有线非TSN帧，若是，则令TSN帧抢占非TSN帧资源调度当前数据包，若否，则等待所述有线TSN帧调度结束，再调度当前数据包；104、若pi≤pj，则从TSN列表头部轮询队列出栈操作，每次取数据包的数据量不超过队列字节阈值F；105、当出队完成后，从更新后的循环列表中删除该出队的队列；106、当轮询至非TSN队列的权值pi大于正在发送的pj，那么等待当前队列数据发送完毕，取pi权值队列的数据包进行发送，并重新赋予该非TSN队列一个权值，然后跳过该队列，对下一个队列进行出队操作；107、如果对所有队列轮询完一轮，则根据队列的已等待时间与优先级信息，更新所有队列的权值，返回步骤101。10.根据权利要求7所述的一种有线无线融合的航天器内时间敏感网络队列管理调度方法，其特征在于，队列的发送权值表示为：a+b＝1其中，Ti表示队列i的数据进入队列后的等待发送时间，Qi表示队列i的固有优先级，其中a,b为计算权值；N为队列的数量。
说明书desc
技术领域本发明涉及有线无线融合的航天器内部时间敏感网络通信技术领域，具体涉及一种有线无线融合的航天器内时间敏感网络队列管理调度方法。背景技术随着国际深空探索以及载人航天技术的发展，航天器数据通信从单一的传感网络发展为多类型、多设备结合的复杂数据交互系统，业务的多样性以及不同的端到端时延要求向现有的数据交换系统提出了新的挑战。而航天器内部数据传输总线普遍使用1553B、CAN总线进行数据通信，其质量占比大，影响航天器搭载更多有效载荷；同时，航天员在舱内和舱外工作时的移动性通信需求不断增加，需要保障通信的可靠性和实时性。可见，将无线通信方式引入到航天器通信系统中，可以有效满足其通信需求，并减少通信线束质量占比。但是在当前学术研究与工业实践中，主要关注如何为无线节点分配所需的无线传输时隙，而节点获得无线传输时隙后，如何调度缓存队列中的各类数据包，解决有线数据报文在无线时隙资源中的合理调度，是实现时敏业务端到端确定性传输的关键。现实需求推动着有关标准协议产生，时间敏感网络是由IEEE 802.1工作组提出的一种能够为时敏业务提供低时延、低抖动和极低数据丢失能力的高质量网络。它基于传统以太网，凭借时间同步、流量调度、路径冗余等多种优化机制，来保证对时敏业务实时高效的传输。近年来，时间敏感网络技术主要应用于工业以太网和车载以太网等有线网络，并逐渐扩展至5G前传网络和WiFi等无线网络。TSN具有以下目标：1)确保交换网络的报文时延得到保障；2)时间敏感数据流和非时间敏感数据流可以共网传输，并且非时间敏感数据流的传输不会对时间敏感数据流的传输时延造成影响。由此可见，TSN既能够为时间敏感业务提供可靠的服务质量保证，同时也能够支持非时敏业务在网络中的传输。因此，现有TSN标准可以很好地利用在星内网络中。无线TSN技术研究处于初始化阶段，尚未形成标准。目前有研究对现有IEEE802.11协议进行改进，使无线网络具有可靠性和实时性能。因此可以将无线TSN技术引入航天器内部网络中。综上所述，引入TSN技术来降低航天器线束重量占比的同时保障星内通信的时延确定性十分必要。然而当星内的终端设备通过有线传输将数据汇聚到无线输出端口时，会在输出端口出现排队现象，这样当有线的业务通过无线信道传输到网关设备时，会因传输数据量较大的业务而导致网络拥塞，从而无法满足空间时敏业务的时延要求，或者低优先级业务的数据完全堵塞无法传输，那么如何在无线输出端口进行队列调度保障各类业务时延成为研究重点。发明内容为了保证TSN流在网络中传输，并且公平地调度其他类型的数据包，本发明提出一种有线无线融合的航天器内时间敏感网络队列管理调度方法，包括将航天器内部数据包中的有线TSN帧映射到无线TDMA帧中，根据数据帧的目的MAC地址和QoS字段将其存储到对应输出端口的缓存队列中；缓存队列中存入的数据包需小于此队列所能存储的最大数据量阈值，将非TSN流的数据包进行入队管理，为TSN流的数据包打上入队时间戳后进行入队管理；出队调度时判断当前时隙是否属于本无线节点，若是，则采用权值队列平均时延最小调度算法调度各类数据包。进一步的，将航天器内部数据包中的有线TSN帧映射到无线TDMA帧中包括：有线TSN帧为一个带有VLAN标签的以太网帧，TDMA帧为自定义的802.11帧，自定义的802.11帧包括采用802.11头部、序号、数据长度QoS字段、最大存活时间、负载以及32位的CRC校验；航天器内部有线侧数据经过TSN交换机到达TSN网关接收端口时，将有线TSN帧转换为802.11无线帧，将VLAN标签中的pcp优先级字段映射到无线TDMA帧的QoS字段，并且将自定义的数据包最大存活依次映射到无线TDMA帧中。进一步的，根据数据帧的目的MAC地址和QoS字段将其存储到对应输出端口的缓存队列中，即根据无线TDMA帧的目的MAC地址和QoS字段将无线TDMA帧存储到对应缓存队列中，即若TDMA帧的QoS字段为特定数值，即该数据包为时敏数据，则存储到TSN列表；否则，即该数据包为非时敏数据，则将该数据包存储到非TSN列表。进一步的，非TSN流的数据包和TSN流的数据包在进行入队管理之前，按照网络中优先级值范围设置出门控循环列表数量，判断TSN列表和非TSN列表中的缓存队列占用的总存储空间，若该总存储空间没有超过全局限制阈值，则对TSN列表和非TSN列表中的缓存队列进行入队操作；否则对非TSN列表中最长的缓存队列进行数据包的丢弃，直到总存储空间没有超过全局限制阈值，再对TSN列表和非TSN列表中的缓存队列进行入队操作。进一步的，将非TSN流的数据包进行入队管理，即提取非TSN流的数据包最大存活字段，获取本数据包过期的时间阈值，计算数据包的剩余存活时间能否完成数据报文的传输，若数据包的传输时延小于或等于数据包的剩余存活时间，则将此数据包压入队列，若大于数据包的剩余存活时间，则丢弃该数据包。进一步的，数据包的传输时延表示为：其中，为数据包的传输时延；hi为数据传输链路中需要经过的节点总数；为数据通过在第n个节点内的传输时延；为有线链路的数据传播时延；节点n的数据处理时间。进一步的，若TSN流到达概率服从泊松分布，服务时间服从指数分布，则TSN流的排队时延表示为：其中，Dnomal为TSN流到达概率服从泊松分布、服务时间服从指数分布的排队时延；M为TSN列表中队列数目；Bis表示TSN流s在每个发送周期Ti的数据量；为TSN流终端di在周期Ti内数据量发送时延；V为无线传输速率；Bis为TSN流终端di在每个周期Ti产生的业务量。进一步的，TSN流终端di在周期Ti内数据量发送时延表示为：其中，hi为数据传输链路中需要经过的节点总数；为交换机内部处理时延；为有线的传输时延；为有线的传播时延。进一步的，采用动态权值调度算法调度各类数据包的过程包括以下步骤：101、TSN网关在收到网关下发的时隙表后，根据时隙表设定的本节点发送时隙，设定相应的计时器，根据计时器触发本节点发送状态；102、本地计时器触发本节点的发送状态，节点对自身TSN列表进行轮询，循环检测各队列的发送权值；103、若轮询队列的权值pi大于正在发送的数据权值pj，则判断当前正在传输的是否为有线非TSN帧，若是，则令TSN帧抢占非TSN帧资源调度当前数据包，若否，则等待所述有线TSN帧调度结束，再调度当前数据包；104、若pi≤pj，则从TSN列表头部轮询队列出栈操作，每次取数据包的数据量不超过队列字节阈值F；105、当出队完成后，从更新后的循环列表中删除该出队的队列；106、当轮询至非TSN队列的权值pi大于正在发送的pj，那么等待当前队列数据发送完毕，取pi权值队列的数据包进行发送，并重新赋予该非TSN队列一个权值，然后跳过该队列，对下一个队列进行出队操作；107、如果对所有队列轮询完一轮，则根据队列的已等待时间与优先级信息，更新所有队列的权值，返回步骤101。进一步的，队列的发送权值表示为：a+b＝1其中，Ti表示队列i的数据进入队列后的等待发送时间，Qi表示队列i的固有优先级，其中a,b为计算权值；N为队列的数量。本发明通过队列传输时间管理非TSN流能够保障已过期的数据不占用无线资源进行数据转发，通过动态权值控制调度算法调度数据包能够避免非TSN数据包在大流量的TSN流的队列后面长时间排队，而得不到转发资源的情况，只需要在一段时间的等待后，转发权值变高，那么在TSN数据转发完成后能够获得一段时间的转发窗口时间，从而能够确定性保障TSN流在网络中传输，而且公平地调度非TSN数据包，从而提升网络的整体吞吐量。附图说明图1是本发明队列管理调度方法实施例示意图；图2是本发明实施例中队列管理调度方法流程图；图3是本发明实施例采用的航天器内部网络场景示意图；图4是本发明采用的超帧结构示意图；图5是本发明TSN帧到无线TDMA帧映射示意图；图6是本发明采用入队管理流程示意图；图7是本发明非TSN流设计时间戳管理机制示意图；图8是本发明动态权值控制调度算法流程示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。本发明提出一种有线无线融合的航天器内时间敏感网络队列管理调度方法，包括将航天器内部数据包中的有线TSN帧映射到无线TDMA帧中，根据数据帧的目的MAC地址和QoS字段将其存储到对应输出端口的缓存队列中；缓存队列中存入的数据包需小于此队列所能存储的最大数据量阈值，将非TSN流的数据包进行入队管理，为TSN流的数据包打上入队时间戳后进行入队管理；出队调度时判断当前时隙是否属于本无线节点，若是，则采用权值队列平均时延最小调度算法调度各类数据包。图1是本发明队列管理调度方法实施例示意图队列管理调度示意图中，当数据包从有线侧到达TSN网关无线输出端口后，首先进行入队管理，入队管理完成后形成多个队列Q1,Q2,…,QN，为每个队列分配优先级并形成缓存队列；入队完成后采用动态权值控制调度算法调度的方式调度各类TDMA无线帧。图2是本发明实施例中队列管理调度方法流程图，所述队列管理调度方法具体包括：101、将航天器内部数据包中的有线TSN帧映射到无线TDMA帧中。在说明如何将航天器内部数据包中的有线TSN帧映射到无线TDMA帧中之前，先说明本发明实施例中的网络场景。航天器内部网络场景示意图如图3，航天器内部存在传感器终端对各舱室的温度、外壳压力等数据进行采集，用户终端进行音频、控制数据的传输。为了保障时敏业务传输时延，数据处理中心充当TSN控制器，用于获取网络中各节点的全局状态信息并进行决策的下发，该传感采集网络中包括多个TSN交换机，每个交换机中可以连接温度传感器、遥测传感器、视频监控器、遥感照相机、数据存储系统、星载计算机、TSN网关等。无线节点之间以TDMA的方式组网，各终端与无线网关均一跳可达，构成无线TSN网络，TSN控制器作为主控节点主要负责网络拓扑发现、需求收集以及时隙表计算下发。网关至控制节点的内部各子系统之间以有线以太网方式连接，并且通过TSN交换机与相应控制系统进行通信。有线TSN架构主要包括数据发送节点、数据接收节点和TSN交换机，TSN网关应有无线发射和接收功能，负责将各舱室数据转发到控制节点以及接收控制节点传输到终端的数据。本发明实施例中所采用的超帧结构示意图如图4所示，，本发明中将信道资源以超帧为周期进行划分，每个超帧都是由时隙下发和数据传输两个部分组成，在时隙下发阶段，控制节点计算各节点的时隙分配结果，通过广播beacon帧的方式进行时隙表下发，时隙表发送结束后，控制中心等待一段时间，新入网节点竞争上报时隙请求信息，然后在数据传输阶段，无线节点在各自时隙传输数据，并将本身节点的时隙请求信息与休眠信息进行上报。由于不同终端的数据量不同，而仅仅依据各终端自身业务量的大小进行时隙长度划分，可能会导致某个节点时隙过长影响其余节点的数据传输，以及网络中的时隙的严重碎片化，因此，网络中TDMA时隙内时隙单位长度Tp需要满足以下条件：上式中Rspace为无线链路传输速率，为节点i的TSN数据流带宽，此式表示时隙单位Tp的选择需要考虑所有节点在k倍Tp的传输时间下的最小空余时间，以保证在时隙划分时的信道利用率，约束一表示最小时隙单位所需满足的长度范围，表示信道中最小包长所需带宽，表示所有节点中最大的数据量所需带宽，约束二表示时隙在k倍最小单位时隙Tp的长度中能传输完成大小的数据量；N*表示正整数，N表示节点的数量。节点所需时隙长度和节点内的数据流大小有关，那么节点i内数据流s所需单位时隙个数Ci,s表示为：其中，Tg表示不同节点时隙间的保护带长度，表示向上取整。在上述时隙分配的设计下，在本发明实施例中，数据包从有线侧数据经过TSN交换机到达TSN网关无线输出端口时，首先将有线TSN帧优先级映射到无线TDMA帧。具体的，航天器内部有线侧数据经过TSN交换机到达TSN网关接收端口时，将有线TSN帧转换为802.11无线帧，将VLAN标签中的pcp优先级字段映射到无线TDMA帧的QoS字段，并且将自定义的数据包最大存活依次映射到无线TDMA帧中。图5是本发明实施例中所提供的TSN帧到无线TDMA帧映射示意图，其中有线TSN帧为一个带有VLAN标签的以太网帧，TDMA帧为自定义的802.11帧，将TSN帧中的VLAN标签pcp字段映射到无线帧的Qos字段，并且将自定义的数据包最大存活依次映射到无线TDMA帧中。以太网帧的格式可以参考现有的802.2或者802.3协议，所述自定义的802.11帧包括采用802.11头部、序号、数据长度QoS字段、最大存活时间，负载以及32位的CRC校验。102、根据无线TDMA帧的目的MAC地址和QoS字段将所述无线TDMA帧存储到对应缓存队列中。在本发明实施例中，根据数据包无线TDMA帧中的目的地址判断出所述数据包的所属无线节点，并根据无线TDMA帧中QoS字段将所述无线TDMA帧存放在相应的缓存队列中。具体的，首先根据无线TDMA帧中的目的地址判断所述数据包所属的目的无线节点，QoS字段占3位，故每个所属无线节点有8个队列，然后根据QoS值存放到相应的缓存队列中，假设QoS值为010时，则可以对应第3个队列。103、在缓存队列占用的总存储空间满足全局限制阈值下，按照传输时间管理机制将非TSN流的数据包进行入队管理，为TSN流的数据包打上入队时间戳后进行入队管理。图6为本发明实施例中的入队管理流程图，入队管理的总体流程包括首先判断有线侧是否有数据到来，如果有数据到来，则利用帧转换模块将有线TSN帧转换为无线TDMA帧；判断缓存队列占用的总存储空间与全局限制阈值的大小，若大于所述全局限制阈值，检测非TSN列表中最长缓存队列，从所述最长缓存队列中丢弃头部数据包后结束流程，否则根据TDMA帧中的目的MAC地址字段判断出该TDMA帧所属的无线节点，根据QoS字段判断当前的数据流是否为TSN流，若为TSN流，则获取本地时钟，并获取时敏数据上一次到达的时间，计算时敏业务的到达的周期信息然后将此时的本地时间与周期信息进行匹配储存，表示为：将此TSN流打上入队时间戳后放入TSN队列中，否则打上时间戳之后放入非TSN流匹配队列，这里的匹配队列是这些缓存数据所形成的队列。在一些实施例中，为了便于区别TSN流，本发明设置出8个循环列表，根据优先级信息不同将其划分为TSN列表和非TSN列表，把无线TDMA帧中QoS值为7和6的缓存队列放在TSN列表，把其余的缓存队列也就是QoS值为0～5的缓存队列放在非TSN列表。其中，所述缓存队列占用的总存储空间CM的具体计算公式为：其中，Qm代表需要传输的数据流，Qi表示不同优先级数据缓存队列长度，N为TSN网关输出端口所有队列的数目。在本发明实施例中，数据包入队时，首先需要检查各缓存队列占用的总存储空间CM是否已经超过全局限制阈值Congest，如果没有超过设定的全局限制阈值，则正式开始入队列操作；如果超过设定的全局限制阈值，则需要对非TSN列表中最长的缓存队列进行数据包的丢弃，为后续到达的数据包提供存储空间，具体丢包的方式是从头部丢弃一个数据包，然后正式开始入队操作。本发明实施例中不对TSN列表中的缓存队列进行检测，可保障TSN流的可靠性。对于时间戳管理机制，图7是本发明实施例中非TSN流设计时间戳管理机制流程图，具体包括以下步骤：队列管理模块设计出周期性定时器，在周期T内统计当前队列数据发送量dq_pks；计算公式为：dq_pks＝dq_pks+dq_size；dq_pks表示当前缓存队列数据发送量；dq_size表示当前缓存队列发送的每个数据包大小。随后判断当前队列是否为时敏队列，若是，则获取上文中得到的时敏数据的到达周期时间然后通过计数器计算TSN流的到达速率Rts：上式中T为轮询周期，Bts为轮询周期内存入时敏队列中的时敏业务数据量大小。获取了TSN流的到达速率后，更新本节点的时敏数据到达的周期与单位时间到达数据量信息，将更新时间update_time进行合并记录，记录信息结构如下：通过更新时间与数据到达周期信息，即可对TSN数据在未来到达的时间进行估计，控制节点获取到时敏数据到达时间信息可以为其划分相应的时隙起始位置，通过TSN流的到达速率Rts可以为节点划分时隙长度。若当前轮询的队列为非TSN队列，则进行时间戳管理控制，统计当前队列的数据发送量dq_pks，然后等待所述周期性定时器溢出后，计算当前出队列速率now_dq_rate，具体计算方式为：now_dq_rate＝dq_pks/T并且，为了有效地消除网络突发流量所引起的出队列速率的急速变化，本发明在此引入低通滤波器加权的方法，计算出队列速率dq_rate，即：dq_rate＝×dq_rate+α×now_dq_rate其中，α表示低通滤波器权重。计算出当前队列时延dq_del，具体计算公式为：dq_del＝qlength/dq_rate入队管理模块提取出缓存队列中所有数据包的最大存活字段，求取出缓存队列中数据包的平均存活时间；计算方法包括：其中，L为队列长度，ti为数据包存活时间。判断数据包平均存活时间与无线链路传播时延之差与当前队列时延队列的大小，若小于或等于当前队列时延，则从队列头部丢弃数据包，具体表示为：其中，为无线链路传播时延；若满足，则从队列头部丢弃数据包。104、出队调度时判断当前时隙是否属于本无线节点，若是，则采用动态权值控制调度算法调度各类数据包。本发明采用了动态权值控制调度算法调度各类数据包，首先设置各队列的初始权值Qi，以及每次调度的字节数F，每次出队将从队列中至多取F个字节。假设某个舱室内部产生TSN流的终端为d1,d2,...dN,每个发送周期可以对应一个TSN流的终端；其路由跳数为1,2,…,h，带宽为R，交换机内部处理时延恒定为Dproc，TSN流终端di在每个周期Ti产生的业务量为则周期内业务量的传输时延有线的传播时延为那么di在周期Ti内数据量发送时延为：为了确定性调度TSN流，每条TSN流s的发送周期Ti应满足：其中F为初始化队列字节阈值，即每次轮询从缓存队列中取的字节数，为TSN流s在每个发送周期Ti的数据量，N为当前TSN网关输出端口队列数目，M为TSN列表中队列数目，V为无线传输速率。为了保障非TSN流不会在因为某一队列的大流量数据被堵塞，节点在调度各队列数据时需要考虑各队列的调度权值pi。与传统的基于信用值的调度方式不同的是，需要考虑各队列的等待数据各队列的调度等待时间以及时隙剩余时间以提升时隙的利用率并降低非TSN队列的业务过期率。因此，非TSN队列的权值pi以及调度字节数F确定方式如下：上式中，a,b为权值系数，N为非TSN队列数量，R为节点输出数据的速率。由于TSN流是按循环顺序调度的，因此TSN列表中的队列可以等效为FIFO队列，假设TSN流到达概率服从泊松分布，服务时间服从指数分布，那么此系统可以表示为M/D/1队列模型，其中业务到达率λ、服务率μ、利用率ρ的值分别为：由此，可计算出其在一般情况下排队时延Dnomal为：在上述分析下，本发明的动态时延控制调度算法采用优先轮询TSN列表的方式，通过约束TSN流的发送周期和动态循环检测TSN数据包的逗留时延，以动态控制的方式让TSN流稳定地在网络中传输，轮询完成TSN列表后，基于全局限制阈值的控制下，轮询非TSN列表，公平地调度非TSN流，从而提升整个网络吞吐量。本发明中采用动态时延控制调度算法调度各类数据包的基本过程可以包括如下：步骤1：TSN无线节点在每个时隙读取自身的身份标识，判断当前时隙是否属于本无线节点；其中，TSN无线节点在每个时隙的起始时刻读取自身的时隙表中本时隙号对应的身份标识，判断当前时隙是否属于本无线节点。步骤2：若通过身份标识确定当前时隙属于本无线节点，对TSN列表进行轮询，循环检测TSN帧逗留时延D；步骤3：若D＞Dnomal，则判断当前正在传输的是否为有线非TSN帧，若是，则令TSN帧抢占非TSN帧资源调度当前数据包，若否，则等待所述有线TSN帧调度结束，再调度当前数据包；在一些实施例中，为了保障TSN帧传输时延，抢占非TSN帧资源，将正在传输的非TSN列表中的数据包拆分为64字节，然后TSN流抢占剩余字节资源，从而保障TSN流能够优先调度出去。步骤4：若D≤Dnomal，则从TSN列表头部轮询队列出栈操作，每次取数据包的数据量不超过队列字节阈值F；Dnomal表示正常情况的排队时延。步骤5：当出队完成后，从更新后的循环列表中删除该出队的队列；上述分析中的约束条件可知TSN流数据包不存在队列内部排队，故该队列此时一定为空，所以可以直接从新的循环列表删除此队列。步骤6：当TSN列表为空时，则开始从非TSN列表进行轮询调度，从非TSN列表头部开始轮询队列，首先对所有非TSN队列的发送权值进行计算，选取最高的权值队列进行发送，发送数据包字节数F根据剩余时隙大小进行取值；步骤7：每次发送完成一次数据，更新所有队列的发送权值，从而完成一次轮询调度返回步骤1。本发明实施例中采用动态时延控制调度算法调度数据包，如图8，调度流程包括：首先判断当前时隙是否属于当前无线节点，若属于当前无线节点，则开始轮询列表，判断TSN列表是否为空，若不为空，则开始轮询TSN列表队列，并选定队列出队；判断TSN帧逗留时延是否大于正常情况的排队时延，若大于正常的排队时延，则继续判断当前正在传输的是否为非TSN帧，若为非TSN帧，则抢占非TSN帧的资源后采用TDMA调度数据包，否则等待TSN帧调度结束后再调度数据包，调度完成后从TSN列表中删除该队列，完成本次轮询。另一方面，当TSN列表为空时，则可以开始轮询非TSN列表队列；判断当前所有非TSN队列的发送权值，选取最高发送权值的队列进行数据发送，发送字节数的选择需要依据剩余的时隙长度进行选取，若队列中的数据无法在剩余的时隙中完成发送，则需要将本此轮询的数据进行分片发送，以确保在隙的利用率，在完成此次轮询后，重新计算所有非TSN队列的权值，以及下一次发送所能传输的字节数。判断当前队列是否为空，若为空，则从TSN列表中删除该队列，否则等待下次轮询完成本次轮询。本发明主要分为队列入队管理和队列出队调度；本发明通过时间戳管理机制的入队管理操作能够保障网络不拥塞，通过动态权值控制调度算法的出队调度操作调度数据包能够确定性保障TSN流在网络中传输的前提下，公平地调度其它类型数据包，提升网络的整体吞吐量。尽管已经示出和描述了本发明的实施例，对于本领域的普通技术人员而言，可以理解在不脱离本发明的原理和精神的情况下可以对这些实施例进行多种变化、修改、替换和变型，本发明的范围由所附权利要求及其等同物限定。
