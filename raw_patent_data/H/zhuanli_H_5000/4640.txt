标题title
一种基于消息队列的多网络链路接口实现方法及其系统
摘要abst
本发明涉及一种基于消息队列的多网络链路接口实现方法、系统、存储介质，方法包含以下步骤：启用若干物理接口，并分别将所述物理接口连接至消息队列组件；启动每个所述物理接口对应的链接管理对象；注册所述链接管理对象至所述消息队列组件；发送相应的事件至相应的所述链接管理对象，通过相应的所述链接管理对象根据所述事件对相应的所述物理接口进行配置，所述事件包含使能事件；根据物理接口的工作状态构建链接决策矩阵，当上行应用数据时，通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据。通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据，从而将网络链接分层次管理，使得系统的开发速度大大提高。
权利要求书clms
1.一种基于消息队列的多网络链路接口实现方法，其特征在于：包含以下步骤：启用若干物理接口，并分别将所述物理接口连接至消息队列组件；启动每个所述物理接口对应的链接管理对象；注册所述链接管理对象至所述消息队列组件；发送相应的事件至相应的所述链接管理对象，通过相应的所述链接管理对象根据所述事件对相应的所述物理接口进行配置，所述事件包含使能事件；根据物理接口的工作状态构建链接决策矩阵，当上行应用数据时，通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据。2.根据权利要求1所述的一种基于消息队列的多网络链路接口实现方法，其特征在于：根据物理接口的工作状态构建链接决策矩阵，通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据之前，包括以下步骤：获取每一所述物理接口的连接状态、启用状态，判断并输出当前可以工作的所述物理接口；获取并输出每一所述物理接口的连接优先级；所述工作状态至少包含所述连接状态、所述启用状态、所述连接优先级，根据所述连接状态、所述启用状态、所述连接优先级构建链接决策矩阵。3.根据权利要求2所述的一种基于消息队列的多网络链路接口实现方法，其特征在于：所述通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据，包括以下步骤：若当前可以工作的所述物理接口的数量为一个，将所述应用数据传输至当前可以工作的所述物理接口，判断所述当前可以工作的所述物理接口对应的所述链接管理对象是否有效，若是则将所述应用数据通过相应的所述链接管理对象上行。4.根据权利要求2所述的一种基于消息队列的多网络链路接口实现方法，其特征在于：所述通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据，包括以下步骤：若当前可以工作的所述物理接口的数量为多个，将所述应用数据传输至任意一个当前可以工作的所述物理接口，判断所述当前可以工作的所述物理接口对应的所述链接管理对象是否有效，将所述应用数据通过所述链接管理对象是有效的接口上行。5.根据权利要求2所述的一种基于消息队列的多网络链路接口实现方法，其特征在于：若所述链接管理对象是有效的接口的数量为多个，并且所述应用数据所需的流量大于第一阈值时，将所述应用数据通过所述链接管理对象是有效的接口同时上行；若所述链接管理对象是有效的接口的数量为多个，并且所述应用数据所需的流量小于第一阈值时，将所述应用数据通过所述链接管理对象是有效的接口分时上行。6.根据权利要求1所述的一种基于消息队列的多网络链路接口实现方法，其特征在于：包含虚拟物理接口，所述虚拟物理接口被配置为可延迟和/或按需启动。7.根据权利要求6所述的一种基于消息队列的多网络链路接口实现方法，其特征在于：响应于所述事件和/或用户操作加入所述虚拟物理接口，将所述虚拟物理接口对应的链接管理对象注册至所述消息队列组件，并将所述虚拟物理接口注册至系统，通过所述虚拟物理接口对应的链接管理对象和所述物理接口对应的链接管理对象一同上行所述应用数据。8.根据权利要求1所述的一种基于消息队列的多网络链路接口实现方法，其特征在于：包括以下步骤：响应于物理接口出现异常，则通过所述链接管理对象通知所述消息队列组件，并重启对应的所述物理接口和/或通过所述事件启动其他物理接口。9.一种基于消息队列的多网络链路接口实现系统，其特征在于：包含以下模块：物理接口启动模块，用于启用若干物理接口，并分别将所述物理接口连接至消息队列组件；链接管理对象启动模块，用于启动每个所述物理接口对应的链接管理对象；注册模块，用于注册所述链接管理对象至所述消息队列组件；配置模块，用于发送相应的事件至相应的所述链接管理对象，通过相应的所述链接管理对象根据所述事件对相应的所述物理接口进行配置；决策模块，用于根据物理接口的工作状态构建链接决策矩阵，当上行应用数据时，通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据。10.一种计算机可读存储介质，存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现权利要求1至8中任一项所述的一种基于消息队列的多网络链路接口实现方法。
说明书desc
技术领域本发明涉及网络链路领域，具体指有一种基于消息队列的多网络链路接口实现方法及其系统。背景技术在现代计算机网络中，连接是双向的。对于到上行链路端口的连接，同一条电缆或无线链路可以在任一端与另一端的设备之间传输数据，上行链路用于上载数据。传统的上行联网链接管理的拓扑图如图1所示，在传统的网络切换方式中，经常使用一些全局变量，信号等进行实现网络的切换，并且不可随着系统负载变化同时对多个接口进行优化，由于系统的复杂性，经常会在全局变量的使用当中带来很多不可避免的竞争状态，每个物理接口都有相应的全局变量，越来越多的变量会导致接口组合切换的复杂度呈指数级上升，导致资源的使用异常，进而导致多链路上行时系统不稳定。如何在多个上行数据接口中，根据每个网络接口及应用负载，稳定快速地网络接口是每个多链路上行的设备首要解决的一个问题。传统的上行链接虽然支持多个物理接口，但是不能同时利用好多个物理接口，即使在多个物理接口可用的情况下也仅能使用一个，或者只能固定同时使用某几个接口，没有办法根据系统负载需要进行数据聚合等。同时传统的上行链路网络切换在面对多个输入源时经常会导致切换逻辑的错误，比如用户在使用上行链路A联网过程中时，突然需要切换至上行链路B；比如上行链路A联网过程中，由某个IO信号输入，要求重新使能上行链路A；由于全局变量或信号量的操作不当，极有可能导致，整个链路状态的不一致，进而导致上行链路状态切换失败。针对上述的现有技术存在的问题设计一种基于消息队列的多网络链路接口实现方法及其系统是本发明研究的目的。发明内容针对上述现有技术存在的问题，本发明在于提供一种基于消息队列的多网络链路接口实现方法及其系统，能够有效解决上述现有技术存在的问题。本发明的技术方案是：一种基于消息队列的多网络链路接口实现方法，包含以下步骤：启用若干物理接口，并分别将所述物理接口连接至消息队列组件；启动每个所述物理接口对应的链接管理对象；注册所述链接管理对象至所述消息队列组件；发送相应的事件至相应的所述链接管理对象，通过相应的所述链接管理对象根据所述事件对相应的所述物理接口进行配置，所述事件包含使能事件；根据物理接口的工作状态构建链接决策矩阵，当上行应用数据时，通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据。进一步地，根据物理接口的工作状态构建链接决策矩阵，通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据之前，包括以下步骤：获取每一所述物理接口的连接状态、启用状态，判断并输出当前可以工作的所述物理接口；获取并输出每一所述物理接口的连接优先级；所述工作状态至少包含所述连接状态、所述启用状态、所述连接优先级，根据所述连接状态、所述启用状态、所述连接优先级构建链接决策矩阵。进一步地，所述通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据，包括以下步骤：若当前可以工作的所述物理接口的数量为一个，将所述应用数据传输至当前可以工作的所述物理接口，判断所述当前可以工作的所述物理接口对应的所述链接管理对象是否有效，若是则将所述应用数据通过相应的所述链接管理对象上行。进一步地，所述通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据，包括以下步骤：若当前可以工作的所述物理接口的数量为多个，将所述应用数据传输至任意一个当前可以工作的所述物理接口，判断所述当前可以工作的所述物理接口对应的所述链接管理对象是否有效，将所述应用数据通过所述链接管理对象是有效的接口上行。进一步地，若所述链接管理对象是有效的接口的数量为多个，并且所述应用数据所需的流量大于第一阈值时，将所述应用数据通过所述链接管理对象是有效的接口同时上行；若所述链接管理对象是有效的接口的数量为多个，并且所述应用数据所需的流量小于第一阈值时，将所述应用数据通过所述链接管理对象是有效的接口分时上行。进一步地，包含虚拟物理接口，所述虚拟物理接口被配置为可延迟和/或按需启动。进一步地，响应于所述事件和/或用户操作加入所述虚拟物理接口，将所述虚拟物理接口对应的链接管理对象注册至所述消息队列组件，并将所述虚拟物理接口注册至系统，通过所述虚拟物理接口对应的链接管理对象和所述物理接口对应的链接管理对象一同上行所述应用数据。进一步地，包括以下步骤：响应于物理接口出现异常，则通过所述链接管理对象通知所述消息队列组件，并重启对应的所述物理接口和/或通过所述事件启动其他物理接口。一种基于消息队列的多网络链路接口实现系统，包含以下模块：物理接口启动模块，用于启用若干物理接口，并分别将所述物理接口连接至消息队列组件；链接管理对象启动模块，用于启动每个所述物理接口对应的链接管理对象；注册模块，用于注册所述链接管理对象至所述消息队列组件；配置模块，用于发送相应的事件至相应的所述链接管理对象，通过相应的所述链接管理对象根据所述事件对相应的所述物理接口进行配置；决策模块，用于根据物理接口的工作状态构建链接决策矩阵，当上行应用数据时，通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据。一种计算机可读存储介质，存储有计算机程序，所述计算机程序被处理器执行时实现所述的一种基于消息队列的多网络链路接口实现方法。因此，本发明提供以下的效果和/或优点：本发明对多个物理接口的工作状态构建链接决策矩阵，通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据，从而将网络链接分层次管理，使得系统的开发速度大大提高。本发明通过引入决策矩阵，使得系统的复杂度大大降低，可扩展性增加，减少错误的引入。本发明可以实现多个物理端口的并行上线，简化软件操作。同时本发明通过对虚拟物理接口的处理，使其能够在需要/接入时注册至系统，同时系统将虚拟物理接口当作物理接口进行处理，将虚拟物理接口加入到物理接口的群集中，进行并行上行。应当明白，本发明的上文的概述和下面的详细说明是示例性和解释性的，并且意在提供对如要求保护的本发明的进一步的解释。附图说明图1为现有技术的框架示意图。图2为本发明的流程示意图。图3为本发明的框架示意图。具体实施方式为了便于本领域技术人员理解，现将实施例结合附图对本发明作进一步详细描述：应了解到，在本实施例中所提及的步骤，除特别说明其顺序的，均可依实际需要调整其前后顺序，甚至可同时或部分同时执行，参考图2－3，一种基于消息队列的多网络链路接口实现方法，包含以下步骤：S1，启用若干物理接口，并分别将所述物理接口连接至消息队列组件。本步骤中，物理接口是指例如有线接口、无线接口等设备，是系统中不同设备与部件之间的硬件接口。同时，本步骤之前，先启动链接管理器，再通过链接管理器根据系统配置启动物理接口。其中，链接管理器是本申请自定义的模块，用于对各个物理接口进行启动。消息队列组件常用的比如redis/mosquitto，本质上可以认为是一个先进先出的队列，用于对消息进行先进先出的顺序进行输出。本步骤的链接管理器可以订阅在某个主题，当如果有消息到达时链接管理器就可以收到这个消息，消息也可以等同为事件。本实施例中启动物理接口A和物理接口B。S2，启动每个所述物理接口对应的链接管理对象。本步骤根据所启动的物理接口，启动该物理接口所对应的链接管理对象。本实施例根据S1的结果，启动物理接口A和物理接口B对应的链接管理对象AgentA和链接管理对象AgentB。链接管理对象用于接收物理接口所需要上传的数据。S3，注册所述链接管理对象至所述消息队列组件。本步骤中，注册后，链接对象才能够从消息队列组件中获取和/或发送数据。本实施例将链接管理对象AgentA和链接管理对象AgentB注册至消息队列组件。S4，发送相应的事件至相应的所述链接管理对象，通过相应的所述链接管理对象根据所述事件对相应的所述物理接口进行配置，所述事件包含使能事件。本步骤中，事件包含使能事件，常用的事件格式可以有jsonrpc等协议。接口的事件根据不同的接口有不同的事件，比如本实施例是以太网，当配置为静态IP，同时网线刚接入时，可以产生一个接口使能事件，由于静态是提前配置好的，又会继续产生一个协议使能事件，当这个接口可以通外网时产生一个上线使能事件。S4.1，获取每一所述物理接口的连接状态、启用状态，判断并输出当前可以工作的所述物理接口。本步骤获取物理接口是否连接有硬件以及该物理接口是否启用，例如接入了以太网或者无线连接有网络，同时该网络接口是被启用的。然后输出当前可以工作的物理接口。例如当前接入网络并且可以工作的物理接口是物理接口A和物理接口B。那么，后续的数据将从当前接入网络并且可以工作的物理接口进行上行。S4.2，获取并输出每一所述物理接口的连接优先级。本步骤输出物理接口的优先级，例如物理接口A的优先级大于物理接口B的优先级。那么，后续的数据将从优先级高的物理接口进行上行。S4.3，所述工作状态至少包含所述连接状态、所述启用状态、所述连接优先级，根据所述连接状态、所述启用状态、所述连接优先级构建链接决策矩阵。链接决策矩阵可以例如下矩阵表示：S5，根据物理接口的工作状态构建链接决策矩阵，当上行应用数据时，通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据。本步骤是本发明的核心步骤，在上述步骤S4.3中，建立了链接决策矩阵，当需要上传数据时，数据会先通过链接决策矩阵的中所包含的第一列元素进行判断，选择最佳的一个或多个物理接口，接下来，数据会先通过链接决策矩阵的中所包含的第二列元素进行判断，选择继续满足条件的一个或多个物理接口…最后，数据会先通过链接决策矩阵的中所包含的第N列元素进行判断，选出全部满足的一个或多个物理接口进行上行数据。接下来具体介绍通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据的若干具体处理步骤。如图3所示。进一步地，所述通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据，包括以下步骤：S5.1，若当前可以工作的所述物理接口的数量为一个，将所述应用数据传输至当前可以工作的所述物理接口，判断所述当前可以工作的所述物理接口对应的所述链接管理对象是否有效，若是则将所述应用数据通过相应的所述链接管理对象上行。本步骤用于处理物理接口仅有一个物理接口可以工作时的情况。本实施例以仅有物理接口A可以工作进行举例，如图3中的仅A可工作代表的曲线所示，图3中的SA、SB、SC等分别代表链接决策矩阵中各个判定条件，应用数据会先经过SA，SA接口会去根据AgentA所提供的数据，判断物理接口A是否有效，A有效时，链接决策矩阵继续确认AgentB是否有效，如果无效，则继续。最终仅有A可以使用，数据链接上行仅从A上行。S5.2，若当前可以工作的所述物理接口的数量为多个，将所述应用数据传输至任意一个当前可以工作的所述物理接口，判断所述当前可以工作的所述物理接口对应的所述链接管理对象是否有效，将所述应用数据通过所述链接管理对象是有效的接口上行。本步骤用于处理物理接口有多个物理接口可以工作时的情况接口。例如物理接口A和B可以工作时，如图3中A/B汇聚上行代表的曲线所示。链接决策矩阵中应用数据会先经过SA，SA接口会去根据AgentA所提供的数据，判断A是否有效，A有效时，链接决策矩阵继续确认AgentB是否有效，B有效，链接决策矩阵向右前进。最终有A/B可以使用，数据链接上行可以同时从A/B上行。进一步地，S5.2.1，若所述链接管理对象是有效的接口的数量为多个，并且所述应用数据所需的流量大于第一阈值时，将所述应用数据通过所述链接管理对象是有效的接口同时上行；若所述链接管理对象是有效的接口的数量为多个，并且所述应用数据所需的流量小于第一阈值时，将所述应用数据通过所述链接管理对象是有效的接口分时上行。进一步地，包含虚拟物理接口，所述虚拟物理接口被配置为可延迟和/或按需启动。响应于所述事件和/或用户操作加入所述虚拟物理接口，将所述虚拟物理接口对应的链接管理对象注册至所述消息队列组件，并将所述虚拟物理接口注册至系统，通过所述虚拟物理接口对应的链接管理对象和所述物理接口对应的链接管理对象一同上行所述应用数据。本步骤中，虚拟物理接口可以认为是VPN或PPPOE等，当用户通过主动或被动加入虚拟网络，或者是接入的那个虚拟物理接口主动发使能事件，比如多个电信帐号拨号。因此，所述虚拟物理接口被配置为当需要使用或者延迟一定时间后再启用。本步骤将所述虚拟物理接口对应的链接管理对象注册至所述消息队列组件，并将所述虚拟物理接口注册至系统后，本方法将虚拟物理接口判定为和上述物理接口一致，通过上述方法将虚拟物理接口以物理接口的方式加入，并且并入链接决策矩阵的建立和后续的判定中。本实施例中，接口C为虚拟物理接口。进一步地，包括以下步骤：S6，响应于物理接口出现异常，则通过所述链接管理对象通知所述消息队列组件，并重启对应的所述物理接口和/或通过所述事件启动其他物理接口。实施例二一种基于消息队列的多网络链路接口实现系统，包含以下模块：物理接口启动模块，用于启用若干物理接口，并分别将所述物理接口连接至消息队列组件；链接管理对象启动模块，用于启动每个所述物理接口对应的链接管理对象；注册模块，用于注册所述链接管理对象至所述消息队列组件；配置模块，用于发送相应的事件至相应的所述链接管理对象，通过相应的所述链接管理对象根据所述事件对相应的所述物理接口进行配置；决策模块，用于根据物理接口的工作状态构建链接决策矩阵，当上行应用数据时，通过所述链接决策矩阵从若干个相应的所述链接管理对象上行应用数据。本实施例的工作原理、使用方法与实施例一基本一致，再次不再赘述。实施例三一种计算机可读存储介质，存储有计算机程序，所述计算机程序被处理器执行时实现实施例一所述的一种基于消息队列的多网络链路接口实现方法。本实施例的工作原理、使用方法与实施例一基本一致，再次不再赘述。本领域内的技术人员应明白，本发明的实施例可提供为方法、系统、或计算机程序产品。因此，本发明可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本发明可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本发明是参照根据本发明实施例的方法、设备、和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。应当注意的是，在权利要求中，不应将位于括号之间的任何参考符号构造成对权利要求的限制。单词“包含”不排除存在未列在权利要求中的部件或步骤。位于部件之前的单词“一”或“一个”不排除存在多个这样的部件。本发明可以借助于包括有若干不同部件的硬件以及借助于适当编程的计算机来实现。在列举了若干装置的单元权利要求中，这些装置中的若干个可以是通过同一个硬件项来具体体现。单词第一、第二、以及第三等的使用不表示任何顺序。可将这些单词解释为名称。尽管已描述了本发明的优选实施例，但本领域内的技术人员一旦得知了基本创造性概念，则可对这些实施例作出另外的变更和修改。所以，所附权利要求意欲解释为包括优选实施例以及落入本发明范围的所有变更和修改。显然，本领域的技术人员可以对本发明进行各种改动和变型而不脱离本发明的精神和范围。这样，倘若本发明的这些修改和变型属于本发明权利要求及其等同技术的范围之内，则本发明也意图包含这些改动和变型在内。在本发明的描述中，需要理解的是，术语“第一”、“第二”仅用于描述目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量。由此，限定有“第一”、“第二”的特征可以明示或者隐含地包括一个或者更多个该特征。在本发明的描述中，“多个”的含义是两个或两个以上，除非另有明确具体的限定。在本发明中，除非另有明确的规定和限定，术语“安装”、“相连”、“连接”、“固定”等术语应做广义理解，例如，可以是固定连接，也可以是可拆卸连接，或成一体；可以是机械连接，也可以是电连接；可以是直接相连，也可以通过中间媒介间接相连，可以是两个元件内部的连通或两个元件的相互作用关系。对于本领域的普通技术人员而言，可以根据具体情况理解上述术语在本发明中的具体含义。在本发明中，除非另有明确的规定和限定，第一特征在第二特征“上”或“下”可以是第一和第二特征直接接触，或第一和第二特征通过中间媒介间接接触。而且，第一特征在第二特征“之上”、“上方”和“上面”可是第一特征在第二特征正上方或斜上方，或仅仅表示第一特征水平高度高于第二特征。第一特征在第二特征“之下”、“下方”和“下面”可以是第一特征在第二特征正下方或斜下方，或仅仅表示第一特征水平高度小于第二特征。在本说明书的描述中，参考术语“一个实施例”、“一些实施例”、“示例”、“具体示例”、或“一些示例”等的描述意指结合该实施例或示例描述的具体特征、结构、材料或者特点包含于本发明的至少一个实施例或示例中。在本说明书中，对上述术语的示意性表述不应理解为必须针对的是相同的实施例或示例。而且，描述的具体特征、结构、材料或者特点可以在任一个或多个实施例或示例中以合适的方式结合。此外，在不相互矛盾的情况下，本领域的技术人员可以将本说明书中描述的不同实施例或示例以及不同实施例或示例的特征进行结合和组合。
