标题title
VPN客户端代理DNS解析方法及装置
摘要abst
本公开涉及一种VPN客户端代理DNS解析方法及装置，该方法包括：接收并解析DNS查询请求报文，获取其所包含的目的地域名；基于该目的地域名查询VPN资源域名Map表，确认该目的地域名是否被包含VPN资源域名Map表中，VPN资源域名Map表包含可被VPN侧DNS服务器执行DNS解析的VPN资源域名及与VPN资源域名相对应的IP地址；当在VPN资源域名Map表中查询到该目的地域名时，基于查询所得到的目的地域名及目的地域名相对应的IP地址构造第一DNS查询响应报文，或者当在VPN资源域名Map表中未查询到该目的地域名时，将DNS查询请求报文转发至用户侧DNS服务器；以及采用从第一DNS查询响应报文或从用户侧DNS服务器接收的针对DNS查询请求报文的第二DNS查询响应报文进行应答。
权利要求书clms
1.一种VPN客户端代理DNS解析方法，包括：接收并解析DNS查询请求报文，获取DNS查询请求报文的目的地域名；基于所述DNS查询请求报文的目的地域名查询VPN资源域名Map表，确认DNS查询请求报文的目的地域名是否被包含所述VPN资源域名Map表中，所述VPN资源域名Map表包含可被VPN侧DNS服务器执行DNS解析的VPN资源域名及与所述VPN资源域名相对应的IP地址；当在所述VPN资源域名Map表中查询到所述DNS查询请求报文的目的地域名时，基于查询所得到的目的地域名及与所述目的地域名相对应的IP地址构造第一DNS查询响应报文，或者当在所述VPN资源域名Map表中未查询到所述DNS查询请求报文的目的地域名时，将所述DNS查询请求报文转发至用户侧DNS服务器；以及采用从所述第一DNS查询响应报文或从用户侧DNS服务器接收的针对DNS查询请求报文的第二DNS查询响应报文进行应答。2.如权利要求1所述的VPN客户端代理DNS解析方法，还包括：VPN客户端接收从与其经过连接认证的VPN侧DNS服务器发送来的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，所述VPN资源域名由VPN侧DNS服务器基于VPN用户发布的VPN资源计算获得，与所述VPN资源域名相对应的IP地址基于VPN用户发布的VPN资源或接收到的针对VPN资源域名的DNS查询响应报文获得；以及VPN客户端对接收到的所述配置进行解析，基于解析得到的VPN资源域名及与所述VPN资源域名相对应的IP地址生成VPN资源域名Map表。3.如权利要求2所述的VPN客户端代理DNS解析方法，还包括：VPN客户端周期性地接收从VPN侧DNS服务器发送来的新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，并基于解析所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置后所获取的VPN资源域名及与所述VPN资源域名相对应的IP地址更新所述VPN资源域名Map表。4.如权利要求2或3所述的VPN客户端代理DNS解析方法，其中所述包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置采用JSON格式被同步推送到VPN客户端。5.如权利要求3所述的VPN客户端代理DNS解析方法，其中所述新的包含VPN资源域名的配置为VPN侧DNS服务器增加、删除或修改部分VPN资源域名和/或与所述VPN资源域名相对应的IP地址后的配置。6.一种VPN客户端代理DNS解析装置，包括：DNS查询请求报文接收及解析组件：用于接收并解析DNS查询请求报文，获取DNS查询请求报文的目的地域名；查询组件，用于基于所述DNS查询请求报文的目的地域名查询VPN资源域名Map表，确认DNS查询请求报文的目的地域名是否被包含所述VPN资源域名Map表中，所述VPN资源域名Map表包含可被VPN侧DNS服务器执行DNS解析的VPN资源域名及与所述VPN资源域名相对应的IP地址；DNS查询响应报文构造组件，用于当在所述VPN资源域名Map表中查询到所述DNS查询请求报文的目的地域名时，基于查询所得到的目的地域名及所述目的地域名相对应的IP地址构造第一DNS查询响应报文；转发组件，用于当在所述VPN资源域名Map表中未查询到所述DNS查询请求报文的目的地域名时，将所述DNS查询请求报文转发至用户侧DNS服务器；以及应答组件，用于采用所述第一DNS查询响应报文或从用户侧DNS服务器接收的针对DNS查询请求报文的第二DNS查询响应报文进行应答。7.如权利要求6所述的VPN客户端代理DNS解析装置，还包括：配置接收组件，用于接收从与其经过连接认证的VPN侧DNS服务器发送来的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，所述VPN资源域名由VPN侧DNS服务器基于VPN用户发布的VPN资源计算获得，与所述VPN资源域名相对应的IP地址基于VPN用户发布的VPN资源或接收到的针对VPN资源域名的DNS查询响应报文获得；以及配置解析组件，用于对接收到的所述配置进行解析；VPN资源域名Map表生成组件，用于基于解析得到的VPN资源域名及与所述VPN资源域名相对应的IP地址生成VPN资源域名Map表。8.如权利要求7所述的VPN客户端代理DNS解析装置，其中，所述配置接收组件还周期性地接收从VPN侧DNS服务器发送来的新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置以及所述配置解析组件还解析所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，以便所述VPN资源域名Map表生成组件基于解析所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置后所获取的VPN资源域名及与所述VPN资源域名相对应的IP地址更新所述VPN资源域名Map表。9.如权利要求7或8所述的VPN客户端代理DNS解析装置，其中所述包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置采用JSON格式被同步推送到VPN客户端。10.如权利要求8所述的VPN客户端代理DNS解析装置，其中所述新的包含VPN资源域名的配置为VPN侧DNS服务器增加、删除或修改部分VPN资源域名和/或与所述VPN资源域名相对应的IP地址后的配置。
说明书desc
技术领域本公开涉及数据通讯技术领域，具体而言，涉及一种VPN客户端代理DNS解析方法及装置。背景技术一般用户办公网络中会搭建一个DNS服务器，主机通过配置内网DNS地址和一个公网DNS进行DNS域名解析，这样当内网DNS服务器出现问题时，会采用公网DNS服务器进行解析，内网DNS服务器可以解析客户网络私有域名以及公网域名。用户在使用VPN时，由于部分VPN资源以域名形式发布，用户原有网络用户侧DNS服务器无法解析VPN域名资源，VPN资源域名要求使用VPN服务器侧DNS服务器进行解析。公网域名可以通过VPN服务器侧DNS服务器进行解析，也可以通过客户原有网络用户侧DNS服务器进行解析，但是客户内部私有域名需要通过原有网络用户侧DNS服务器进行解析。通过将用户VPN虚拟网卡DNS服务器配置为VPN服务器侧DNS服务器，修改注册表、网卡跃点数等常规方法修改网卡的优先级，从而实现优先使用内网DNS服务器对DNS请求进行解析。但部分操作系统使用常规方法无法修改网卡优先级，使得VPN在正常连接后原有网络侧DNS服务器的优先级高于VPN服务器侧DNS服务器优先级，导致VPN资源域名被解析成公网地址或者不能被解析，用户无法正确访问VPN资源。如果VPN侧DNS服务器不支持解析公网域名时，VPN侧DNS服务器解析失败后再用原有网络侧DNS服务器进行解析，则域名经过两次解析，导致解析速度慢，严重影响用户体验。如果VPN侧DNS服务器支持解析公网域名，但由于用户和VPN侧DNS服务器地理位置、运营商等不一样，会导致解析出的IP存在跨运营商以及CDN等问题。如果终端应用程序发送的所有DNS请求都发送到VPN服务器侧DNS服务器，则需要经过虚拟网卡加密通过隧道发送到VPN服务器侧DNS服务器，从而增加了跨网VPN流量，导致DNS服务器资源的大量消耗。因此，需要一种无需修改网卡优先级的VPN客户端代理DNS解析方法及装置。发明内容有鉴于此，本公开提供一种VPN客户端代理DNS解析方法及装置。根据本公开的第一方面，提出一种VPN客户端代理DNS解析方法，该方法包括：接收并解析DNS查询请求报文，获取DNS查询请求报文的目的地域名；基于所述DNS查询请求报文的目的地域名查询VPN资源域名Map表，确认DNS查询请求报文的目的地域名是否被包含所述VPN资源域名Map表中，所述VPN资源域名Map表包含可被VPN侧DNS服务器执行DNS解析的VPN资源域名及与所述VPN资源域名相对应的IP地址；当在所述VPN资源域名Map表中查询到所述DNS查询请求报文的目的地域名时，基于查询所得到的目的地域名及与所述目的地域名相对应的IP地址构造第一DNS查询响应报文，或者当在所述VPN资源域名Map表中未查询到所述DNS查询请求报文的目的地域名时，将所述DNS查询请求报文转发至用户侧DNS服务器；以及采用从所述第一DNS查询响应报文或从用户侧DNS服务器接收的针对DNS查询请求报文的第二DNS查询响应报文进行应答。根据本公开的VPN客户端代理DNS解析方法，其还包括：VPN客户端接收从与其经过连接认证的VPN侧DNS服务器发送来的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，所述VPN资源域名由VPN侧DNS服务器基于VPN用户发布的VPN资源计算获得，与所述VPN资源域名相对应的IP地址基于VPN用户发布的VPN资源或接收到的针对VPN资源域名的DNS查询响应报文获得；以及VPN客户端对接收到的所述配置进行解析，基于解析得到的VPN资源域名及与所述VPN资源域名相对应的IP地址生成VPN资源域名Map表。根据本公开的VPN客户端代理DNS解析方法，其还包括：VPN客户端周期性地接收从VPN侧DNS服务器发送来的新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，并基于解析所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置后所获取的VPN资源域名及与所述VPN资源域名相对应的IP地址更新所述VPN资源域名Map表。根据本公开的VPN客户端代理DNS解析方法，其中所述包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置采用JSON格式被同步推送到VPN客户端。根据本公开的VPN客户端代理DNS解析方法，其中所述新的包含VPN资源域名与所述VPN资源域名相对应的IP地址的配置为VPN侧DNS服务器增加、删除或修改部分VPN资源域名和/或与所述VPN资源域名相对应的IP地址后的配置。根据本公开的第二方面，提出一种VPN客户端代理DNS解析装置，该装置包括：DNS查询请求报文接收及解析组件：用于接收并解析DNS查询请求报文，获取DNS查询请求报文的目的地域名；查询组件，用于基于所述DNS查询请求报文的目的地域名查询VPN资源域名Map表，确认DNS查询请求报文的目的地域名是否被包含所述VPN资源域名Map表中，所述VPN资源域名Map表包含可被VPN侧DNS服务器执行DNS解析的VPN资源域名及与所述VPN资源域名相对应的IP地址；DNS查询响应报文构造组件，用于当在所述VPN资源域名Map表中查询到所述DNS查询请求报文的目的地域名时，基于查询所得到的目的地域名及与所述目的地域名相对应的IP地址构造第一DNS查询响应报文；转发组件，用于当在所述VPN资源域名Map表中未查询到所述DNS查询请求报文的目的地域名时，将所述DNS查询请求报文转发至用户侧DNS服务器；以及应答组件，用于采用所述第一DNS查询响应报文或从用户侧DNS服务器接收的针对DNS查询请求报文的第二DNS查询响应报文进行应答。根据本公开的VPN客户端代理DNS解析装置，其还包括：配置接收组件，用于接收从与其经过连接认证的VPN侧DNS服务器发送来的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，所述VPN资源域名由VPN侧DNS服务器基于VPN用户发布的VPN资源计算获得，与所述VPN资源域名相对应的IP地址基于VPN用户发布的VPN资源或接收到的针对VPN资源域名的DNS查询响应报文获得；以及配置解析组件，用于对接收到的所述配置进行解析；VPN资源域名Map表生成组件，用于基于解析得到的VPN资源域名及与所述VPN资源域名相对应的IP地址生成VPN资源域名Map表。根据本公开的VPN客户端代理DNS解析装置，其中，所述配置接收组件还周期性地接收从VPN侧DNS服务器发送来的新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置以及所述配置解析组件还解析所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，以便所述VPN资源域名Map表生成组件基于解析所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置后所获取的VPN资源域名及与所述VPN资源域名相对应的IP地址更新所述VPN资源域名Map表。根据本公开的VPN客户端代理DNS解析装置，其中所述包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置采用JSON格式被同步推送到VPN客户端。根据本公开的VPN客户端代理DNS解析装置，其中所述新的包含VPN资源域名的配置为VPN侧DNS服务器增加、删除或修改部分VPN资源域名和/或与所述VPN资源域名相对应的IP地址后的配置。综上所述，采用本公开的VPN客户端代理DNS解析方法和装置，无需要设置网卡优先级，通过VPN客户端监听本地端口，代理本机所有的DNS查询请求，完成DNS请求解析。具体而言，就是当用户端发起DNS查询请求时，VPN客户端收到DNS请求报文，解析请求报文，当检测到DNS请求解析的目的地域名是VPN资源域名时，VPN客户端基于VPN资源域名表中的VPN资源域名及与所述VPN资源域名相对应的IP地址按照DNS协议构造针对所述DNS查询请求报文的DNS查询响应报文，非VPN资源域名则直接通过用户侧DNS服务器器进行解析，从而减小了VPN隧道的DNS流量，减轻了VPN侧DNS服务器的负担。此外，非VPN资源域名不需VPN侧DNS服务器进行解析，也不需要等待VPN侧DNS服务器解析失败，而是直接通过用户侧DNS服务器进行解析，解析公网域名速度快，用户可以快速访问网络，提升了用户体验。应当理解的是，以上的一般描述和后文的细节描述仅是示例性的，并不能限制本公开。附图说明通过参照附图详细描述其示例实施例，本公开的上述和其它目标、特征及优点将变得更加显而易见。下面描述的附图仅仅是本公开的一些实施例，对于本领域的普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1所示的是根据本公开实施例的VPN客户端代理DNS解析方法和装置的应用实例示意图。图2所示的是根据本公开实施例的VPN客户端代理DNS解析方法的流程示意图。图3所示的本公开实施例中的VPN侧DNS服务器发布VPN资源域名及与所述VPN资源域名相对应的IP地址的流程示意图。图4所示的本公开实施例中的VPN资源域名Map表同步更新的流程示意图。图5所示的是根据本公开实施例的VPN客户端代理DNS解析装置的原理图。具体实施方式现在将参考附图更全面地描述示例实施例。然而，示例实施例能够以多种形式实施，且不应被理解为限于在此阐述的实施例；相反，提供这些实施例使得本公开将全面和完整，并将示例实施例的构思全面地传达给本领域的技术人员。在图中相同的附图标记表示相同或类似的部分，因而将省略对它们的重复描述。此外，所描述的特征、结构或特性可以以任何合适的方式结合在一个或更多实施例中。在下面的描述中，提供许多具体细节从而给出对本公开的实施例的充分理解。然而，本领域技术人员将意识到，可以实践本公开的技术方案而没有特定细节中的一个或更多，或者可以采用其它的方法、组元、装置、步骤等。在其它情况下，不详细示出或描述公知方法、系统、实现或者操作以避免模糊本公开的各方面。附图中所示的方框图仅仅是功能实体，不一定必须与物理上独立的实体相对应。即，可以采用软件形式来实现这些功能实体，或在一个或多个硬件模块或集成电路中实现这些功能实体，或在不同网络和/或处理器装置和/或微控制器装置中实现这些功能实体。附图中所示的流程图仅是示例性说明，不是必须包括所有的内容和操作/步骤，也不是必须按所描述的顺序执行。例如，有的操作/步骤还可以分解，而有的操作/步骤可以合并或部分合并，因此实际执行的顺序有可能根据实际情况改变。应理解，虽然本文中可能使用术语第一、第二等来描述各种组件，但这些组件不应受这些术语限制。这些术语乃用以区分一组件与另一组件。因此，下文论述的第一组件可称为第二组件而不偏离本申请概念的教示。如本文中所使用，术语“及/或”包括相关联的列出项目中的任一个及一或多者的所有组合。本领域技术人员可以理解，附图只是示例实施例的示意图，附图中的模块或流程并不一定是实施本公开所必须的，因此不能用于限制本公开的保护范围。图1所示的是根据本公开实施例的VPN客户端代理DNS解析方法及装置的应用实例示意图。如图1所示，在VPN的应用环境中，由于部分VPN资源以域名形式发布，用户访问这些资源需要访问VPN侧DNS服务器，以解析VPN资源域名。访问公用网络和用户内部私有网络上的资源则需要访问原有网络的用户侧的DNS服务器，以解析公网域名和私有网络域名。主机在配置DNS服务器时，会配置一个VPN侧DNS服务器的地址和一个公网DNS服务器的地址。VPN资源域名要求使用VPN侧DNS服务器进行解析，用户侧DNS服务器无法解析。公网域名可以通过VPN侧DNS服务器进行解析，也可以通过用户侧DNS服务器进行解析，但是用户私有网络域名需要通过用户侧DNS服务器进行解析。使用VPN时，内网域名要求使用VPN DNS解析，公网域名要求使用公网DNS解析。为此，有些VPN环境中，人们通常通过修改注册表、网卡跃点数等常规方法修改网卡的优先级，从而实现优先使用内网DNS服务器对DNS请求进行解析。使用常规方法修改网卡优先级比较困难，VPN在正常连接后公网DNS优先级高于VPN DNS优先级，内网域名会被解析成公网地址或者不能被解析，从而导致用户无法正确访问内网域名。这为人们带来不好的体验，修改网卡优先级对普通用户而言是一项难以克服的技术障碍。因此，本公开提出了一种VPN客户端代理DNS解析方法。域名解析总体可分为两步：首先，本机向域名服务器发出一个DNS请求报文，报文里携带需要查询的域名；之后，域名服务器向本机回应一个DNS响应报文，里面包含域名对应的IP地址。在VPN环境下，VPN客户端会代理本机向域名服务器转发DNS查询请求报文以及接受来自域名服务器的DNS响应报文。在VPN环境下，VPN客户端启动后，由于DNS协议的默认端口号为53号，VPN客户端即开始监听本机53端口，以代理本机所有的DNS解析。VPN客户端将用户侧DNS服务器地址进行保存，在连接上VPN侧DNS服务器进行认证通过后，设置物理网卡和虚拟网卡的DNS服务器地址为127.0.0.1。图2所示的是根据本公开实施例的VPN客户端代理DNS解析方法的流程示意图。如图2所示，在步骤S202中，接收并解析DNS查询请求报文。更具体的，VPN客户端监听到用户端应用程序向本机53号端口发送了DNS查询请求报文后，通过新建UDP Socket1接收所述DNS查询请求报文。之后，VPN客户端对所述DNS查询请求报文进行解析，获取所述DNS查询请求报文所包含的待解析的目的地域名。若将用户端应用程序发出的所有DNS查询请求都发送到VPN侧DNS服务器，需要经过虚拟网卡加密后通过隧道发送到VPN侧DNS服务器，会增加跨网VPN流量，消耗大量的DNS服务器资源。本公开实施例的VPN客户端代理DNS解析方法，将VPN侧DNS服务器可以执行解析的VPN资源域名及与所述VPN资源域名相对应的IP地址存储在VPN客户端，从而无需将目的地域名为VPN资源域名的DNS查询请求向VPN侧DNS服务器进行转发，便可获得针对所述DNS查询请求的DNS查询响应。由于Map表存储数据结构中的键唯一，不允许存在重复，因此根据Map表中的Key进行查询或修改时速度非常快。本公开实施例的VPN客户端代理DNS解析方法将VPN侧DNS服务器可以执行解析的VPN资源域名存储在Map表中。更具体的，所述Map表的采用VPN资源域名作为Key，对应的Value可设置为与所述VPN资源域名相对应的IP地址，其中，同一个Key可以对应多个Value值，即同一个VPN资源域名对应的IP地址可以是多个。如图2所示，在步骤S204中，基于所述DNS查询请求报文的目的地域名查询VPN资源域名Map表，确认DNS查询请求报文的目的地域名是否被包含所述VPN资源域名表中。在步骤S206中，判断所述DNS查询请求报文的目的地域名是否在VPN资源域名Map表查询到的结果为“是”时进入步骤S208。在步骤S208中，基于查询所得到的目的地域名及所述目的地域名相对应的IP地址构造第一DNS查询响应报文。更具体的，若查询成功，说明所述DNS查询请求的目的地域名是VPN服务器发布的资源域名，则基于查询VPN资源域名Map表所得到的IP地址，按照DNS协议格式构造第一DNS查询响应报文。在步骤S210中，采用所述第一DNS查询响应报文进行应答。更具体的，将步骤S208中所构造出的第一DNS查询响应报文通过UDP Socket1转发给用户端应用程序。在步骤S206中，判断所述DNS查询请求报文的目的地域名是否在VPN资源域名Map表查询到的结果为“否”进入步骤S212，在步骤S212中，将所述DNS查询请求报文转发至用户侧DNS服务器。更具体的，若查询不成功，说明所述DNS查询请求目的地域名的不是VPN侧DNS服务器发布的VPN资源域名，需要用户侧DNS服务器进行解析，则新建UDP Socket2，通过UDPSocket2将所述DNS请求报文向用户侧DNS服务器进行转发。在步骤S214中，采用从用户侧DNS服务器接收的第二DNS查询响应报文进行应答。更具体的，在步骤S212中，通过UDPSocket2将所述DNS请求报文向用户侧DNS服务器进行转发后，当UDP Socket2收到用户侧的DNS服务器返回的第二DNS查询响应报文时，通过UDP Socket1将所述第二DNS查询响应报文发给用户端应用程序。在VPN环境中，VPN侧DNS服务器发布VPN资源有两种方式，一种是IP方式，一种是域名，由于域名方式需要DNS解析，需要将VPN侧DNS服务器发布的VPN资源域名及与所述VPN资源域名相对应的IP地址实时同步到VPN客户端。根据本公开实施例的VPN客户端代理DNS解析方法，VPN客户端接收从与其经过连接认证的VPN侧DNS服务器发送来的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，所述VPN资源域名由VPN侧DNS服务器基于VPN用户发布的VPN资源计算获得，与所述VPN资源域名相对应的IP地址基于VPN用户发布的VPN资源或接收到的针对VPN资源域名的DNS查询响应报文获得。图3所示的本公开实施例中的VPN侧DNS服务器发布VPN资源域名及与所述VPN资源域名相对应的IP地址的流程示意图。如图3所示，在步骤S302中，t＝0，计时器开始计时。在步骤S304中，用户发布VPN资源；在步骤S306中，VPN侧DNS服务器基于用户发布的VPN资源计算出VPN资源域名，与VPN资源域名相对应的IP地址则基于VPN用户发布的VPN资源或接收到的针对VPN资源域名的DNS查询响应报文获得。更具体的，与所述VPN资源域名相对应的IP地址通过用户发布的VPN资源所包含的VPN资源域名和IP映射关系，或者将针对所述VPN资源域名的DNS查询请求报文发送至DNS服务器，待接收到来自DNS服务器的DNS查询响应报文后，提取出所处DNS查询响应报文中的IP地址。在步骤S308中，VPN侧DNS服务器生成包含所述VPN资源域名及与所述VPN资源域名相对应的IP地址的配置；在步骤S310中，向VPN客户端发送包含所述VPN资源域名及与所述VPN资源域名相对应的IP地址的配置；在步骤S312中，判断t是否等于nT，其中T为预设的不为0的周期常数，n为正整数；在判断t是否等于nT的结果为“是”时，进入步骤S314；在步骤S314中，检测用户所发布的VPN资源域名及与所述VPN资源域名相对应的IP地址是否更新；在步骤S312中检测用户所发布的VPN资源域名是否更新的结果为“是”时，依次经过步骤S308和步骤S310，VPN侧DNS服务器向VPN客户端发送新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置。VPN客户端接收到VPN侧DNS服务器发送来的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置后，对接收到的所述配置进行解析，基于解析得到的VPN资源域名及与所述VPN资源域名相对应的IP地址生成VPN资源域名Map表。图4所示的本公开实施例中的VPN资源域名Map表同步更新的流程示意图。如图4所示，在步骤S402中，VPN客户端接收从VPN侧DNS服务器发送的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置。更具体的，VPN客户端在与VPN侧DNS服务器连接认证后，VPN侧DNS服务器将配置向VPN客户端进行发送，VPN客户端对所述配置进行接收。在步骤S404中，VPN客户端对接收到的所述配置进行解析，提取出所述配置所包含的VPN资源域名及与所述VPN资源域名相对应的IP地址。在步骤S406中，VPN客户端基于解析配置所得到的VPN资源域名及与所述VPN资源域名相对应的IP地址生成VPN资源域名Map表。具体而言，可以将VPN资源域名作为Map表的Key，其对应的Value值设置为IP地址。在步骤S408中VPN客户端判断是否收到新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，当判断是否收到新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置的结果为“是”时，进入步骤S410。在步骤S410中，对VPN资源域名Map表进行更新。更具体的，VPN在收到新配置后，清除VPN资源域名Map表中的数据，将所述新配置所包含的VPN资源域名及与所述VPN资源域名相对应的IP地址重新添加到VPN资源域名Map表中。在对VPN资源域名Map表进行更新后，再进入步骤S408判断VPN客户端是否收到新的配置。在步骤S408中VPN客户端判断是否收到新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，当判断是否收到新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置的结果为“否”时，再次判断VPN客户端是否接收到新的配置。可选择地，VPN客户端周期性地接收从VPN侧DNS服务器发送来的新的包含VPN资源域名的配置，并基于解析所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置后所获取的VPN资源域名及与所述VPN资源域名相对应的IP地址更新所述VPN资源域名Map表。根据本公开实施例的VPN客户端代理DNS解析方法，所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置为VPN侧DNS服务器增加、删除或修改部分VPN资源域名和/或与所述VPN资源域名相对应的IP地址后的配置后的配置。更具体的，当用户发布的VPN资源域名发生变化时，例如新增、修改或删除部分VPN资源域名或者VPN资源域名和其所对应的IP映射关系发生变化等，VPN侧DNS服务器基于用户更新发布的VPN资源域名及与所述VPN资源域名相对应的IP地址，生成新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，并将所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置向VPN客户端进行发送。可选择地，VPN资源域名的配置采用JSON格式被同步推送到VPN客户端。更具体的，VPN侧DNS服务器在向VPN客户端发送包含VPN资源域名的配置时，所述配置可以包含多个VPN资源域名及与所述VPN资源域名相对应的IP地址。例如若VPN侧DNS服务器发布3个VPN资源域名：oa.myvpn.com对应IP地址为192.168.1.2和192.168.1.3,mail.myvpn.com对应IP地址为192.168.1.4,hr.myvpn.com对应IP地址为192.168.1.5，所述3个VPN资源域名及与所述3个VPN资源域名相对应的IP地址的配置可采用以下的JSON格式同步到VPN客户端：图5所示的是根据本公开实施例的VPN客户端代理DNS解析装置的原理图。如图5所示，VPN客户端代理DNS解析装置包括：DNS查询请求报文接收及解析组件502、查询组件504、DNS查询响应报文构造组件506、转发组件508、应答组件510。其中，DNS查询请求报文接收及解析组件502，用于接收并解析DNS查询请求报文，获取DNS查询请求报文的目的地域名；查询组件504，用于基于所述DNS查询请求报文的目的地域名查询VPN资源域名Map表，确认DNS查询请求报文的目的地域名是否被包含所述VPN资源域名Map表中，所述VPN资源域名Map表包含可被VPN侧DNS服务器执行DNS解析的VPN资源域名；DNS查询响应报文构造组件506，用于当在所述VPN资源域名Map表中查询到所述DNS查询请求报文的目的地域名时，基于查询所得到的目的地域名及与所述目的地域名相对应的IP地址构造第一DNS查询响应报文；转发组件508，用于当在所述VPN资源域名Map表中未查询到所述DNS查询请求报文的目的地域名时，将所述DNS查询请求报文转发至用户侧DNS服务器；以及应答组件508，用于采用所述第一DNS查询响应报文或从用户侧DNS服务器接收的针对DNS查询请求报文的第二DNS查询响应报文进行应答。可选择地，本公开实施例的VPN客户端代理DNS解析装置，还包括：配置接收组件512、配置解析组件514和VPN资源域名Map表生成组件516。其中，配置接收组件512，用于接收从与其经过连接认证的VPN侧DNS服务器发送来的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，所述VPN资源域名由VPN侧DNS服务器基于VPN用户发布的VPN资源计算获得，与所述VPN资源域名相对应的IP地址基于VPN用户发布的VPN资源或接收到的针对VPN资源域名的DNS查询响应报文获得；以及配置解析组件514，用于对接收到的所述配置进行解析；VPN资源域名Map表生成组件516，用于基于解析得到的VPN资源域名及与所述VPN资源域名相对应的IP地址生成VPN资源域名Map表。可选择地，本公开实施例中的VPN客户端代理DNS解析装置中的所述配置接收组件512还周期性地接收从VPN侧DNS服务器发送来的新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置以及所述配置解析组件514还解析所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置，以便所述VPN资源域名Map表生成组件516基于解析所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置后所获取的VPN资源域名及与所述VPN资源域名相对应的IP地址更新所述VPN资源域名Map表。可选择地，本公开实施例中的VPN客户端代理DNS解析装置中的所述包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置采用JSON格式被同步推送到VPN客户端。可选择地，本公开实施例中的VPN客户端代理DNS解析装置中的所述新的包含VPN资源域名及与所述VPN资源域名相对应的IP地址的配置为VPN侧DNS服务器增加、删除或修改部分VPN资源域名和/或与所述VPN资源域名相对应的IP地址后的配置。综上所述，采用本公开的VPN客户端代理DNS解析方法和装置，无需要设置网卡优先级，通过VPN客户端监听本地端口，代理本机所有的DNS查询请求，完成DNS请求解析。具体而言，就是当用户端发起DNS查询请求时，VPN客户端收到DNS请求报文，解析请求报文，当检测到DNS请求解析的目的地域名是VPN资源域名时，VPN客户端基于VPN资源域名表中的VPN资源域名及与所述VPN资源域名相对应的IP地址按照DNS协议构造针对所述DNS查询请求报文的DNS查询响应报文，非VPN资源域名则直接通过用户侧DNS服务器器进行解析，从而减小了VPN隧道的DNS流量，减轻了VPN侧DNS服务器的负担。此外，非VPN资源域名不需VPN侧DNS服务器进行解析，也不需要等待VPN侧DNS服务器解析失败，而是直接通过用户侧DNS服务器进行解析，解析公网域名速度快，用户可以快速访问网络，提升了用户体验。总体而言,本公开解决的问题是，部分操作系统使用常规方法无法修改网卡优先级，VPN在正常连接后原有网络DNS服务器优先级高于VPN服务器侧DNS服务器优先级，导致VPN资源域名被解析成公网地址或者不能被解析，从而导致用户无法正确访问VPN资源。如果VPN侧DNS服务器不支持解析公网域名，当VPN侧DNS服务器解析失败后，用原有网络DNS服务器进行解析，域名经过两次解析，解析速度慢，严重影响用户体验。如果VPN侧DNS服务器支持解析公网域名，由于用户和VPN测DNS服务器地理位置、运营商等不一样，会导致解析出的IP存在跨运营商以及CDN等问题。终端应用程序发送的所有DNS请求都发送到VPN服务器侧DNS服务器，需要经过虚拟网卡加密通过隧道发送到VPN服务器侧DNS服务器，增加了跨网VPN流量,消耗大量DNS服务器资源。为此，本公开VPN客户端启动后监听本机53端口代理DNS请求报文，然后将用户侧网络DNS服务器DNS地址进行保存，连接上VPN服务器认证通过后，设置物理网卡及虚拟网卡DNS为127.0.0.1。VPN服务器将发布的资源域名及IP映射关系推送到VPN客户端，VPN客户端将VPN发布的域名及IP映射关系保存到VPN客户端域名IP map表中。当用户端应用程序发起DNS请求时，VPN客户端进程收到DNS请求报文，解析请求报文，将解析到的域名在域名IP map表中进行查找，如果找到，按照DNS协议格式构造DNS回复报文进行回复。如果没有找到，说明不是VPN发布的资源域名，需要根据用户侧DNS服务器进行解析，VPN客户端充当DNS客户端，向用户侧网络DNS服务器转发DNS请求，如果DNS服务器返回DNS响应报文，将DNS响应报文转发给客户端，从而实现DNS请求解析。具体实现主要包含以下两个流程，分别为VPN服务器发布的资源域名同步流程和DNS请求解析流程。VPN服务器发布的资源域名同步流程：一般来说，VPN发布资源有两种方式，一种是IP方式，一种是域名，由于域名方式需要DNS解析，本发明需要将VPN服务器发布的资源域名和IP映射关系实时同步到VPN客户端。VPN服务器根据用户发布的资源，计算发布的资源域名，资源域名对应的IP地址通过用户配置的域名和IP映射关系以及发送DNS请求去获取，将发布的资源域名和IP映射关系保存下来。VPN客户端连接上VPN服务器认证通过后，VPN服务器将VPN发布的资源域名及IP映射关系配置推送到VPN客户端。VPN客户端收到推送配置后，解析配置，将VPN发布的域名及IP映射关系保存到VPN客户端域名IP map表中。其中以域名为键，IP地址为值，IP地址可以多个。这样当VPN客户端接收到DNS请求报文时，首先根据域名在域名IP map表中进行查找，如果找到，将找到的IP地址按照DNS报文格式进行回复。如VPN服务器发布3个资源域名oa.myvpn.com、mail.myvpn.com、hr.myvpn.com，其中oa.myvpn.com对应IP地址为192.168.1.2和192.168.1.3,mail.myvpn.com对应IP地址为192.168.1.4,hr.myvpn.com对应IP地址为192.168.1.5。资源以JSON格式同步到客户端。VPN服务器侧程序周期性检测发布的资源域名及IP的映射关系，如果发生变化，如新增、修改、删除部分资源域名以及资源域名和IP映射关系发生变化，那么其将发布的资源域名IP映射关系实时同步到VPN客户端，VPN客户端收到配置后，清除域名IP map表中数据,将发布的资源域名及IP映射数据重新添加到VPN客户端域名IP map表。具体而言，解析过程为：VPN客户端启动后监听本机53端口代理DNS请求报文，然后将用户侧网络DNS服务器DNS地址进行保存，设置物理网卡和虚拟网卡DNS为127.0.0.1。当用户端应用程序发起DNS请求时，会发送DNS请求报文至本机53端口，此时VPN客户端通过UDP Socket1接收到本机53端口的DNS请求报文。然后解析DNS请求报文，提取域名，根据域名在域名IP map表进行查找，如果找到，提取IP地址，按照DNS响应报文格式，构造DNS响应报文，将解析结果通过UDP Socket1发送给用户端应用程序；如果没有找到，说明不是VPN资源域名，需要用户侧DNS服务器进行解析，则新建UDP Socket2，然后通过UDP Socket2将DNS请求报文发送至用户侧DNS服务器。用户侧DNS服务器回复响应报文，VPN客户端通过UDPSocket2收取DNS回复报文并通过UDP Socket1发给用户端应用程序。以上结合具体实施例描述了本公开的基本原理，但是，需要指出的是，对本领域的普通技术人员而言，能够理解本公开的方法和装置的全部或者任何步骤或者部件，可以在任何计算装置或者计算装置的网络中，以硬件、固件、软件或者它们的组合加以实现，这是本领域普通技术人员在阅读了本公开的说明的情况下运用他们的基本编程技能就能实现的。因此，本公开的目的还可以通过在任何计算装置上运行一个程序或者一组程序来实现。所述计算装置可以是公知的通用装置。因此，本公开的目的也可以仅仅通过提供包含实现所述方法或者装置的程序代码的程序产品来实现。也就是说，这样的程序产品也构成本公开，并且存储有这样的程序产品的存储介质也构成本公开。显然，所述存储介质可以是任何公知的存储介质或者将来所开发出来的任何存储介质。还需要指出的是，在本公开的装置和方法中，显然，各部件或各步骤是可以分解和/或重新组合的。这些分解和/或重新组合应视为本公开的等效方案。并且，执行上述系列处理的步骤可以自然地按照说明的顺序按时间顺序执行，但是并不需要一定按照时间顺序执行。某些步骤可以并行或彼此独立地执行。上述具体实施方式，并不构成对本公开保护范围的限制。本领域技术人员应该明白的是，取决于设计要求和其他因素，可以发生各种各样的修改、组合、子组合和替代。任何在本公开的精神和原则之内所作的修改、等同替换和改进等，均应包含在本公开保护范围之内。
