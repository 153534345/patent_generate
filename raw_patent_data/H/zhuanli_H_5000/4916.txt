标题title
基于差分结构的SAR ADC失调误差校正方法及电路
摘要abst
本发明提供了一种基于差分结构的SAR ADC失调误差校正方法及电路，该校正方法包括：在校正逻辑模块的驱动下，通过对P辅助校正电容阵列和N辅助校正电容阵列中的辅助校正电容进行n次逻辑切换和判断，得到n位的校正结果信息；利用校正逻辑模块对所述校正结果信息进行编码，得到补偿方向信息和校正补偿值；所述补偿方向信息表征了补偿的类型；所述校正补偿值表征了补偿的电压值大小；在正常工作阶段，根据所述校正逻辑模块输出的所述校正补偿值和所述校正补偿方向信息，对ADC失调误差进行校正。
权利要求书clms
1.一种基于差分结构的SAR ADC失调误差校正方法，其特征在于，包括：在校正逻辑模块的驱动下，通过对P辅助校正电容阵列和N辅助校正电容阵列中的辅助校正电容进行n次逻辑切换和判断，得到n位的校正结果信息；其中所述P辅助校正电容阵列和所述N辅助校正电容阵列均包括n个辅助校正电容，n为正整数；利用校正逻辑模块对所述校正结果信息进行编码，得到补偿方向信息和校正补偿值；所述补偿方向信息表征了补偿的类型；所述校正补偿值表征了补偿的电压值大小；在正常工作阶段，根据所述校正逻辑模块输出的所述校正补偿值和所述校正补偿方向信息，对ADC失调误差进行校正。2.根据权利要求1所述的基于差分结构的SAR ADC失调误差校正方法，其特征在于，所述P辅助校正电容阵列中的所有的辅助校正电容的上极板直接相连；所述N辅助校正电容阵列中的所有的辅助校正电容的上极板直接相连。3.根据权利要求2所述的基于差分结构的SAR ADC失调误差校正方法，其特征在于，所述P辅助校正电容阵列和所述N辅助校正电容阵列中的n个辅助校正电容的电容值均满足：从低位到高位，以2的次方依次递增；阵列中第i个电容的电容值Ca的取值为：Ca＝2i-1Cu，其中，Cu表示单位电容，i为正整数，且1≤i≤n。4.根据权利要求3所述的基于差分结构的SAR ADC失调误差校正方法，其特征在于，所述P辅助校正电容阵列及所述N辅助校正电容阵列均包括一低位辅助电容，所述低位辅助电容的电容值Ca的取值为：Ca＝Cu，其中，Cu表示单位电容。5.根据权利要求1所述的基于差分结构的SAR ADC失调误差校正方法，其特征在于，所述n次逻辑切换和判断是从最高位辅助电容开始依次往最低位辅助电容进行，且每一次逻辑切换和判断后更新所述校正结果信息中相应位的数值。6.根据权利要求5所述的基于差分结构的SAR ADC失调误差校正方法，其特征在于，每一次逻辑切换和判断具体包括：在校正逻辑模块驱动下，将所述P辅助校正电容阵列中的所有的辅助电容的上极板连接至比较器的第一端，作为所述比较器第一输入信号；将所述N辅助校正电容阵列中的所有的辅助电容的上极板连接至所述比较器的第二端，作为所述比较器的第二输入信号；控制所述P辅助校正电容阵列和所述N辅助校正电容阵列中的相应位的辅助电容的下极板连接到指定的电压信号；根据比较器的输出结果得到所述校正结果信息的相应位的值。7.根据权利要求6所述的基于差分结构的SAR ADC失调误差校正方法，其特征在于，所述指定的电压信号为：第一参考电压或第二参考电压或共模电平。8.根据权利要求1所述的基于差分结构的SAR ADC失调误差校正方法，其特征在于，所述利用校正逻辑模块对所述校正结果信息进行编码，得到补偿方向信息和校正补偿值；具体包括：根据所述n位的校正结果信息的最高位确定所述补偿方向信息；根据所述n位的校正结果信息和所述补偿方向信息确定所述校正补偿值。9.根据权利要求8所述的基于差分结构的SAR ADC失调误差校正方法，其特征在于，根据所述n位的校正结果信息的最高位确定所述补偿方向信息，具体包括：当所述校正结果信息的最高位cal为1，所述补偿方向信息为第一补偿方向；所述第一补偿方向表征正补偿方向；当所述校正结果信息的最高位cal为0，所述补偿方向信息为第二补偿方向；所述第二补偿方向表征负补偿方向；其中n位的二进制数值cal表示所述校正结果信息，cal表示所述校正结果信息的最高位。10.根据权利要求9所述的基于差分结构的SAR ADC失调误差校正方法，其特征在于，根据所述n位的校正结果信息和所述补偿方向信息确定所述校正补偿值，具体包括：当所述补偿方向信息为第一补偿方向时，所述校正补偿值cal_com根据以下公式得到：cal_com＝cal-2n-1；当所述补偿方向信息为第二补偿方向时，所述校正补偿值cal_com根据以下公式得到：cal_com＝2n-1-cal；其中n位的二进制数值cal_com表示所述校正补偿值。11.根据权利要求1～10任一项所述的基于差分结构的SAR ADC失调误差校正方法，其特征在于，根据所述校正逻辑模块输出的所述校正补偿值和所述校正补偿方向信息，对ADC失调误差进行校正，具体包括：根据所述校正补偿值中对应位的值确定所述P辅助校正阵列和N辅助校正阵列中的每一个辅助校正电容的下极板接入的电压信号。12.根据权利要求11所述的基于差分结构的SAR ADC失调误差校正方法，其特征在于，所述确定P辅助校正阵列和N辅助校正阵列中的每一个辅助校正电容的下极板接入的电压信号，具体包括：所述校正补偿值的某位为0，表征P辅助校正电容阵列和N辅助校正电容阵列中对应的辅助校正电容的下极板接共模电平；所述校正补偿值的某位为1，则：当所述补偿方向信息为所述第一补偿方向时，表征P辅助校正电容阵列的辅助校正电容的下极板接第一参考电压，N辅助校正电容阵列的辅助校正电容的下极板接第二参考电压；当所述补偿方向信息为所述第二补偿方向时，表征P辅助校正电容阵列的辅助校正电容的下极板接第二参考电压，N辅助校正电容阵列的辅助校正电容的下极板接第一参考电压。13.一种基于差分结构的SAR ADC失调误差校正电路，应用于如权利要求1～12任一项所述的校正方法，其特征在于，包括：辅助校正电容阵列，包括P辅助校正电容阵列和N辅助校正电容阵列；所述P辅助校正电容阵列及所述N辅助校正电容阵列均包括n个辅助校正电容以及第一电压选择单元；其中，n为正整数；所述第一电压选择单元通过多个开关将所述P辅助校正电容阵列及所述N辅助校正电容阵列中的每个辅助校正电容的下极板连接到第一参考电压或第二参考电压或共模电压；主DAC电容阵列，包括P端主DAC电容阵列和N端主DAC电容阵列；所述P端主DAC电容阵列和所述N端主DAC电容阵列均包括m个主DAC电容以及第二电压选择单元；其中m为正整数，且m≥n；所述第二电压选择单元通过多个开关控制所述P端主DAC电容阵列中的每个主DAC电容的下极板连接到所述第一参考电压或第一输入电压或所述共模电压，和/或控制所述N端主DAC电容阵列中的每个主DAC电容的下极板连接到所述第二参考电压或第二输入电压或所述共模电压；比较器，所述P辅助校正电容阵列的所有的辅助校正电容的上极板与所述P端主DAC电容阵列的所有的主DAC电容的上极板都连接至所述比较器的第一输入端；所述N辅助校正电容阵列的所有的辅助校正电容的上极板与所述N端主DAC电容阵列的所有的主DAC电容的上极板都连接至所述比较器的第二输入端；第三电压选择单元，用于通过开关将所述P辅助校正电容阵列中的所有的辅助校正电容和所述P端主DAC电容阵列中的所有的主DAC电容的上极板连接至所述共模电压；第四电压选择单元，用于通过开关将所述N辅助校正电容阵列中的所有的辅助校正电容和所述N端主DAC电容阵列中的所有的主DAC电容的上极板连接至所述共模电压；校正逻辑模块，所述校正逻辑模块的输入端连接所述比较器的输出端；所述校正逻辑模块的输出端连接所述P辅助校正电容阵列和所述N辅助校正电容阵列的第一电压选择单元；SAR逻辑模块，所述SAR逻辑模块的输入端连接所述比较器的输出端；所述SAR逻辑模块的输出端连接所述P端主DAC电容阵列和所述N端主DAC电容阵列的第二电压选择单元。
说明书desc
技术领域本发明涉及集成电路领域，尤其涉及一种基于差分结构的SAR ADC失调误差校正方法及电路。背景技术由于芯片版图难以做到电路的布局和走线完全对称，比较器等电路存在工艺失配，芯片生产制造过程中器件存在加工偏差，以及应用场景中电路板上的干扰引入，都会导致ADC产生失调误差。随着对ADC精度的要求越来越高，电路失调等偏差对ADC性能的影响越来越明显，在高精度应用场景下必须对ADC的失调进行校正额补偿。目前常用的SAR ADC失调校正方法主要有：通过可调电阻阵列来调节比较器共模电平、采用数字校正的方法和采用额外的辅助校正电容DAC阵列对失调电压进行补偿消除。通过可调电阻阵列调节ADC失调电压的方案实现逻辑简单，但是电阻阵列会引入额外的静态功耗；采用数字校正的方法不需要额外的辅助校正电阻和电容，能减小电路面积，但需要复杂的数字逻辑设计，且存在收敛性问题；采用辅助电校正容阵列的校正方法没有静态功耗，且无收敛性问题。目前采用辅助校正电容阵列的校正电路是单端结构，容易受到随应用环境变化的共模干扰和噪声的影响。发明内容本发明提供一种基于差分结构的SAR ADC失调误差校正方法及电路，以解决由芯片制造工艺偏差和应用环境变化中动态共模干扰和噪声带来的ADC失调误差的问题。根据本发明的第一方面，提供了一种基于差分结构的SAR ADC失调误差校正方法，包括：在校正逻辑模块的驱动下，通过对P辅助校正电容阵列和N辅助校正电容阵列中的辅助校正电容进行n次逻辑切换和判断，得到n位的校正结果信息；其中所述P辅助校正电容阵列和所述N辅助校正电容阵列均包括 n个辅助校正电容，n为正整数；利用校正逻辑模块对所述校正结果信息进行编码，得到补偿方向信息和校正补偿值；所述补偿方向信息表征了补偿的类型；所述校正补偿值表征了补偿的电压值大小；在正常工作阶段，根据所述校正逻辑模块输出的所述校正补偿值和所述校正补偿方向信息，对ADC失调误差进行校正。可选的，所述P辅助校正电容阵列中的所有的辅助校正电容的上极板直接相连；所述N辅助校正电容阵列中的所有的辅助校正电容的上极板直接相连。可选的，所述P辅助校正电容阵列和所述N辅助校正电容阵列中的n 个辅助校正电容的电容值均满足：从低位到高位，以2的次方依次递增；阵列中第i个电容的电容值Ca的取值为：Ca＝2i-1Cu，其中，Cu表示单位电容，i为正整数，且1≤i≤n。可选的，所述P辅助校正电容阵列及所述N辅助校正电容阵列均包括一低位辅助电容，所述低位辅助电容的电容值Ca的取值为：Ca＝Cu，其中，Cu表示单位电容。可选的，所述n次逻辑切换和判断是从最高位辅助电容开始依次往最低位辅助电容进行，且每一次逻辑切换和判断后更新所述校正结果信息中相应位的数值。可选的，每一次逻辑切换和判断具体包括：在校正逻辑模块驱动下，将所述P辅助校正电容阵列中的所有的辅助电容的上极板连接至比较器的第一端，作为所述比较器第一输入信号；将所述N辅助校正电容阵列中的所有的辅助电容的上极板连接至所述比较器的第二端，作为所述比较器的第二输入信号；控制所述P辅助校正电容阵列和所述N辅助校正电容阵列中的相应位的辅助电容的下极板连接到指定的电压信号；根据比较器的输出结果得到所述校正结果信息的相应位的值。可选的，所述指定的电压信号为：第一参考电压或第二参考电压或共模电平。可选的，所述利用校正逻辑模块对所述校正结果信息进行编码，得到补偿方向信息和校正补偿值；具体包括：根据所述n位的校正结果信息的最高位确定所述补偿方向信息；根据所述n位的校正结果信息和所述补偿方向信息确定所述校正补偿值。可选的，根据所述n位的校正结果信息的最高位确定所述补偿方向信息，具体包括：当所述校正结果信息的最高位cal为1，所述补偿方向信息为第一补偿方向；所述第一补偿方向表征正补偿方向；当所述校正结果信息的最高位cal为0，所述补偿方向信息为第二补偿方向；所述第二补偿方向表征负补偿方向；其中n位的二进制数值cal表示所述校正结果信息，cal 表示所述校正结果信息的最高位。可选的，根据所述n位的校正结果信息和所述补偿方向信息确定所述校正补偿值，具体包括：当所述补偿方向信息为第一补偿方向时，所述校正补偿值 cal_com根据以下公式得到：cal_com＝cal-2n-1；当所述补偿方向信息为第二补偿方向时，所述校正补偿值cal_com根据以下公式得到：cal_com＝2n-1-cal；其中n位的二进制数值cal_com表示所述校正补偿值。可选的，根据所述校正逻辑模块输出的所述校正补偿值和所述校正补偿方向信息，对ADC失调误差进行校正，具体包括：根据所述校正补偿值中对应位的值确定所述P辅助校正阵列和N辅助校正阵列中的每一个辅助校正电容的下极板接入的电压信号。可选的，所述确定P辅助校正阵列和N辅助校正阵列中的每一个辅助校正电容的下极板接入的电压信号，具体包括：所述校正补偿值的某位为0，表征P辅助校正电容阵列和N辅助校正电容阵列中对应的辅助校正电容的下极板接共模电平；所述校正补偿值的某位为1，则：当所述补偿方向信息为所述第一补偿方向时，表征P辅助校正电容阵列的辅助校正电容的下极板接第一参考电压，N辅助校正电容阵列的辅助校正电容的下极板接第二参考电压；当所述补偿方向信息为所述第二补偿方向时，表征P辅助校正电容阵列的辅助校正电容的下极板接第二参考电压，N辅助校正电容阵列的辅助校正电容的下极板接第一参考电压。根据本发明第二方面，提供了一种基于差分结构的SAR ADC失调误差校正电路，应用于本发明第一方面提供的校正方法，包括：辅助校正电容阵列，包括P辅助校正电容阵列和N辅助校正电容阵列；所述P辅助校正电容阵列及所述N辅助校正电容阵列均包括n个辅助校正电容以及第一电压选择单元；其中，n为正整数；所述第一电压选择单元通过多个开关将所述P辅助校正电容阵列及所述N辅助校正电容阵列中的每个辅助校正电容的下极板连接到第一参考电压或第二参考电压或共模电压；主DAC电容阵列，包括P端主DAC电容阵列和N端主DAC电容阵列；所述P端主DAC电容阵列和所述N端主DAC电容阵列均包括m个主DAC电容以及第二电压选择单元；其中m为正整数，且m≥n；所述第二电压选择单元通过多个开关控制所述P端主DAC电容阵列中的每个主DAC电容的下极板连接到所述第一参考电压或第一输入电压或所述共模电压，和/或控制所述N端主DAC电容阵列中的每个主DAC 电容的下极板连接到所述第二参考电压或第二输入电压或所述共模电压；比较器，所述P辅助校正电容阵列的所有的辅助校正电容的上极板与所述P端主DAC电容阵列的所有的主DAC电容的上极板都连接至所述比较器的第一输入端；所述N辅助校正电容阵列的所有的辅助校正电容的上极板与所述N端主DAC电容阵列的所有的主DAC电容的上极板都连接至所述比较器的第二输入端；第三电压选择单元，用于通过开关将所述P辅助校正电容阵列中的所有的辅助校正电容和所述P端主DAC电容阵列中的所有的主DAC电容的上极板连接至所述共模电压；第四电压选择单元，用于通过开关将所述N辅助校正电容阵列中的所有的辅助校正电容和所述N端主DAC电容阵列中的所有的主DAC电容的上极板连接至所述共模电压；校正逻辑模块，所述校正逻辑模块的输入端连接所述比较器的输出端；所述校正逻辑模块的输出端连接所述P辅助校正电容阵列和所述N辅助校正电容阵列的第一电压选择单元；SAR逻辑模块，所述SAR逻辑模块的输入端连接所述比较器的输出端；所述SAR逻辑模块的输出端连接所述P端主DAC电容阵列和所述N 端主DAC电容阵列的第二电压选择单元。本发明提供的基于差分结构的SAR ADC失调误差校正方法和电路，具有差分的主电容阵列和n 位的差分辅助校正电容阵列，在校正阶段，在校正逻辑模块的驱动下，通过对P辅助校正电容阵列和N 辅助校正电容阵列中的辅助校正电容进行n次逻辑切换和判断，得到校正结果信息；校正逻辑模块对所述校正结果信息进行编码，得到补偿方向信息和校正补偿值，并保存在寄存器中；在正常工作阶段，将所述校正补偿值补偿到ADC中，从而抵消ADC失调误差。采用n位辅助的辅助校正电容阵列能完全消除一定范围内的ADC失调误差，差分电路结构能够对电路和环境中的共模干扰和噪声有很好的抑制作用。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其他的附图。图1是本发明一示例性实施例中提供的基于差分结构的SAR ADC失调误差校正方法的流程示意图；图2是本发明一示例性实施例中提供的基于差分结构的SAR ADC失调误差校正电路的电路结构示意图；图3是本发明一示例性实施例中提供的逻辑切换和判断的流程示意图；图4是本发明一示例性实施例中提供的利用校正逻辑模块得到补偿方向信息和校正补偿值的流程示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。本发明的说明书和权利要求书及上述附图中的术语“第一”、“第二”、“第三”、“第四”等是用于区别类似的对象，而不必用于描述特定的顺序或先后次序。应该理解这样使用的数据在适当情况下可以互换，以便这里描述的本发明的实施例能够以除了在这里图示或描述的那些以外的顺序实施。此外，术语“包括”和“具有”以及他们的任何变形，意图在于覆盖不排他的包含，例如，包含了一系列步骤或单元的过程、方法、系统、产品或设备不必限于清楚地列出的那些步骤或单元，而是可包括没有清楚地列出的或对于这些过程、方法、产品或设备固有的其它步骤或单元。下面以具体地实施例对本发明的技术方案进行详细说明。下面这几个具体的实施例可以相互结合，对于相同或相似的概念或过程可能在某些实施例不再赘述。请参考图1，本发明提供的一种基于差分结构的SAR ADC失调误差校正方法，包括：S1：在校正逻辑模块的驱动下，通过对P辅助校正电容阵列和N辅助校正电容阵列中的辅助校正电容进行n次逻辑切换和判断，得到n位的校正结果信息；其中所述P辅助校正电容阵列和所述N辅助校正电容阵列均包括n 个辅助校正电容，n为正整数；S2：利用校正逻辑模块对所述校正结果信息进行编码，得到补偿方向信息和校正补偿值；所述补偿方向信息表征了补偿的类型；所述校正补偿值表征了补偿的电压值大小；S3：在正常工作阶段，根据所述校正逻辑模块输出的所述校正补偿值和所述校正补偿方向信息，对ADC失调误差进行校正。SAR ADC即逐次逼近式模拟数字转换器，在每一次转换过程中，通过遍历所有的量化值并将其转化为模拟值，将输入信号与其逐一比较，最终得到要输出的数字信号。电容式DAC类型的SAR ADC根据电荷再分配的原理产生模拟输出电压，其主DAC通常包括一个由多个按照二进制加权排列的电容和一个“空LSB”电容组成的阵列。本实施方案中所述SAR ADC为电容式 DAC类型的SAR ADC，主DAC电容阵列包括P端主DAC电容阵列和N端主DAC电容阵列；所述P端主DAC电容阵列和所述N端主DAC电容阵列均包括m个主DAC电容，m为正整数，且m≥n。本实施方案中基于的差分结构的SAR ADC通过主把一组差分的模拟输入信号VIP，VIN量化成m位的数字信号输出。请参考图2，本发明提供了一种基于差分结构的SAR ADC失调误差校正电路，包括：辅助校正电容阵列10，包括P辅助校正电容阵列11和N辅助校正电容阵列12；所述P辅助校正电容阵列11及所述N辅助校正电容阵列12均包括n个辅助校正电容以及第一电压选择单元；其中，n为正整数；所述第一电压选择单元通过多个开关将所述P辅助校正电容阵列11及所述N辅助校正电容阵列12中的每个辅助校正电容的下极板连接到所述第一参考电压VREFP或第二参考电压VREFN或共模电压VCM；主DAC电容阵列20，包括P端主DAC电容阵列21和N端主DAC电容阵列22；所述P端主DAC电容阵列21和所述N端主DAC电容阵列22均包括m 个主DAC电容以及第二电压选择单元；其中m为正整数，且m≥n；所述第二电压选择单元通过多个开关控制所述P端主DAC电容阵列21 中的每个主DAC电容的下极板连接到所述第一参考电压VREFP或第一输入电压VIP或所述共模电压VCM，和/或控制所述N端主DAC电容阵列中的每个主DAC电容的下极板连接到所述第二参考电压VREFN或第二输入电压VIN或所述共模电压VCM；比较器30，所述P辅助校正电容阵列11的所有的辅助校正电容的上极板与所述P端主DAC电容阵列21的所有的主DAC电容的上极板都连接至所述比较器30的第一输入端；所述N辅助校正电容阵列12的所有的辅助校正电容的上极板与所述N端主DAC电容阵列22的所有的主DAC电容的上极板都连接至所述比较器30的第二输入端；第三电压选择单元，用于通过开关将所述P辅助校正电容阵列11中的所有的辅助校正电容和所述P端主DAC电容阵列21中的所有的主DAC电容的上极板连接至所述共模电压VCM；第四电压选择单元，用于通过开关将所述N辅助校正电容阵列12中的所有的辅助校正电容和所述N端主DAC电容阵列22中的所有的主DAC电容的上极板连接至所述共模电压VCM；校正逻辑模块40，所述校正逻辑模块40的输入端连接所述比较器30的输出端；所述校正逻辑模块40的输出端连接所述P辅助校正电容阵列11和所述N辅助校正电容阵列21的第一电压选择单元；SAR逻辑模块50，所述SAR逻辑模块50的输入端连接所述比较器30 的输出端；所述SAR逻辑模块50的输出端连接所述P端主DAC电容阵列 21和所述N端主DAC电容阵列22的第二电压选择单元。由于芯片生产制造过程中器件存在加工偏差，以及应用场景中电路板上的干扰引入，都会导致ADC产生失调误差。本实施方案提供一种基于差分结构的SAR ADC失调误差校正方法及校正电路，所述校正电路包括一组差分的辅助校正电容阵列即P辅助校正电容阵列11和N辅助校正电容阵列12。一般在每次开机，或者芯片工作环境发生较大变化时触发进行校正。在校正阶段，校正逻辑模块40的驱动P辅助校正电容阵列11和N辅助校正电容阵列12中的辅助校正电容进行n次逻辑切换和判断，并对所属校正结果信息进行编码，得到校正补偿值并将所述校正补偿值保存在寄存器中；在正常工作阶段，将所述校正补偿值从寄存器中读出并通过校正逻辑电路补偿到ADC中，从而消除一定范围的ADC内部电路本身的失调误差，采用差分电路结构能够对电路和环境中的共模干扰和噪声有很好的抑制作用。在一种实施方式中，所述P辅助校正电容阵列11和所述N辅助校正电容阵列12中的n个辅助校正电容的电容值均满足：从低位到高位，以2的次方依次递增；阵列中第i个电容的电容值Ca的取值为：Ca＝2i-1Cu，其中， Cu表示单位电容，i为正整数，且1≤i≤n。在一种实施方式中，为了保证电容阵列的线性度，在所述P辅助校正电容阵列11及所述N辅助校正电容阵列12中均还有一个最低位电容，所述低位辅助电容的电容值Ca的取值为：Ca＝Cu，其中，Cu表示单位电容。如果ADC选用的单位电容为Cu,则n位辅助校正电容阵列的电容值设置为Ca＝2n-1Cu,Ca＝2n-2Cu,...Ca＝22Cu,Ca＝2Cu,Ca＝Cu, Ca＝Cu；n的位数由校正精度和成本折中选取，校正位数n越大，校正精度越高，但需要的电容支路越多，电路面积越大。校正位数n一般设置小于 ADC的位数。步骤S1中，请参考图3，所述n次逻辑切换和判断是从最高位辅助电容开始依次往最低位辅助电容进行，且每一次逻辑切换和判断后更新所述校正结果信息中相应位的数值。其中每一次逻辑切换和判断具体包括：S11：在校正逻辑模块40驱动下，将所述P辅助校正电容阵列11中的所有的辅助电容的上极板连接至比较器的第一端，作为所述比较器30第一输入信号；将所述N辅助校正电容阵列12中的所有的辅助电容的上极板连接至所述比较器的第二端，作为所述比较器30的第二输入信号；在一种实施方式中，所述P辅助校正电容阵列11中的所有的辅助校正电容的上极板直接相连；所述N辅助校正电容阵列12中的所有的辅助校正电容的上极板直接相连。并且所述P辅助校正电容阵列11的所有的辅助校正电容的上极板与所述P端主DAC电容阵列21的所有的主DAC电容的上极板都连接至所述比较器30的第一输入端；所述N辅助校正电容阵列12的所有的辅助校正电容的上极板与所述N端主DAC电容阵列22的所有的主DAC电容的上极板都连接至所述比较器30的第二输入端。即所述P端主DAC电容阵列21与所述P辅助校正电容阵列11中所有电容的上极板的输出电压VP为比较器30的第一输入端电压；所述N端主DAC电容阵列22与所述N辅助校正电容阵列12中的所有电容的上极板输出电压VN为比较器30的第二输入端电压。S12：控制所述P辅助校正电容阵列11和所述N辅助校正电容阵列12 中的相应位的辅助电容的下极板连接到指定的电压信号；所述指定的电压信号为：第一参考电压VREFP或第二参考电压VREFN或共模电平VCM。S13：根据比较器30的输出结果得到所述校正结果信息的相应位的值。在逻辑判断阶段，P端主DAC电容阵列21和N端主DAC电容阵列22 的电容上极板断开连接，P辅助校正电容阵列11和N辅助校正电容阵列12 中最低位电容Ca的下极板都接共模电平VCM，校正逻辑电路控制P辅助校正电容阵列11中电容Ca的下极板依次接VREFP,N辅助校正电容阵列12 中电容Ca的下极板依次接VREFN,在校正逻辑电路的控制下进行逐次逼近逻辑切换和判断。具体过程如下：首先假设辅助校正电容阵列高位电容控制信号S＝1,其他电容控制位 S设置为0，即将P辅助校正电容阵列11中的最高位电容Ca下极板接VREFP，N辅助校正电容阵列12中的最高位电容Ca下极板接VREFN，P 端辅助校正电容阵列和N端辅助校正电容阵列中的低位电容Ca的下极板全部接VCM，如果此时通过比较器30输出结果得到P端输出电压VP大于N 端输出电压VN，则当前控制位S保持为1，如果此时P端输出电压VP小于N端输出电压VN，则当前控制位S＝0。在最高位S完成判断和选值之后，将此高位S置1，即P端辅助校正电容阵列中的次高位电容Ca下极板接VREFP，N端辅助校正电容阵列中的次高位电容Ca下极板接VREFN。最高位电容下极板根据上次判断结果S的值进行电压切换，如果S＝1，P端最高位电容接VREFP，N端最高位电容接VREFN，如果S＝0，切换到共模电平VCM，剩下的其他位电容下极板全部接VCM。其他位的切换和判断过程和最高位和次高位的判断方法相同，直到完成Ca电容下极板的切换和判断，S每一位的值都确定下来，此时一个校正判断周期完成，在校正判断完成后，本次校正结果S的值存储在一个n 位的校正结果寄存器cal中。为了保证在步骤S1逻辑判断时通过逻辑切换将失调电压量化出来，在逻辑判断前需要进行复位和采样，以得到上极板的一个恒定电荷。复位时所有电容上级板和下极板都接共模电平VCM，将电容中电荷复位至0。此时P端电容阵列和N端电容阵列中的电容上极板电荷分别为：QP＝0QN＝0采样时所有电容上极板浮空，P端主DAC电容阵列21和N端主DAC 电容阵列22的电容下极板都接共模电平VCM，P端电容阵列和N端电容阵列的所有电容上极板短接，P端辅助校正电容阵列中的最高位电容Ca和最低位电容Ca接ADC正参考源VREFP，其他位电容接共模电平VCM，N端辅助校正电容阵列中的最高位电容Ca和最低位电容Ca接ADC负参考源 VREFN，其他位电容接共模电平VCM。此时P端电容阵列和N端电容阵列中的电容上极板电荷分别为：QP＝-VCM*CTOT-*QN＝-VCM*CTOT-*其中CTOT为电容阵列输出节点上的等效电容之和，P端和N端的等效电容之和相等，都为CTOT。电容的上极板电荷守恒，即整个过程不管电容下极板切换到哪个电平，上极板电荷都保持不变。而为满足上极板电荷不变，上极板的电压就会跟着变化，这样在逻辑判断阶段，每一次阵列中电容下极板电平切换了，都可以通过电荷QP和QN算出当前对应的上极板电压值VP和VN。在辅助校正电容阵列高位电容进行逻辑判断时，P端电容阵列和N端阵列输出节点的电压VP和VN分别为：P端电容阵列和N端阵列输出节点的电压差为：其中VOS为失调电压值，1LSB为ADC的能识别的最小电压精度，等于一个单位电容接参考源时得到的电压权重值。如果失调电压值VOS≤1LSB，且小于-1LSB，比较器30对应的输出结果 VP＜VN；当前控制位S保持为1；如果失调电压值VOS＞1LSB,比较器30对应的输出结果VP＞VN，当前控制位S清0。在一种实施方式中，请参考图4，步骤S2所述利用校正逻辑模块40对所述校正结果信息进行编码，得到补偿方向信息和校正补偿值；具体包括：S21：根据所述n位的校正结果信息的最高位确定所述补偿方向信息；得到的校正结果信息最高位cal是符号位，用来表示电压补偿的方向， cal＝1，表示需要正向补偿，cal＝0，表示需要反向补偿。cal 用来指示VOS偏差的具体大小，n个校正位，则能校正的范围覆盖 -LSB～2n-1LSB以内的偏差。为了提高校正精度，可以将本实施方式中步骤S1计算所述校正结果信息的过程重复多次，比如t次，将t组校正结果信息取平均值作为最终的校正结果信息cal。S22:根据所述n位的校正结果信息和所述补偿方向信息确定所述校正补偿值cal_com，从cal到cal_com的具体编码方式为：当所述补偿方向信息为第一补偿方向时，即cal＝1，所述校正补偿值 cal_com＝cal-2n-1；当所述补偿方向信息为第二补偿方向时，即cal＝0，所述校正补偿值 cal_com＝2n-1-cal。以n＝6为例，校正结果cal、补偿方向标志位cal_dir、校正补偿值 cal_com和VOS的值对应关系如表1所示。表1：校正结果cal、补偿方向标志位cal_dir、校正补偿值cal_com和VOS的值对应关系步骤S2将步骤S1得到的n位校正结果信息cal在校正逻辑电路中经过编码变成校正补偿方向标志信号cal_dir和校正补偿值cal_com，并存储在寄存器中，步骤S3在ADC正常工作时该补偿值将加载到ADC中，控制辅助校正阵列电容下极板电平去补偿失调误差。具体包括：根据所述校正补偿值中对应位的值确定所述P辅助校正阵列和N辅助校正阵列中的每一个辅助校正电容的下极板接入的电压信号。在一种实施方式中，当所述校正补偿值cal_com的某位为0，表征 P辅助校正电容阵列11和N辅助校正电容阵列12中对应的辅助校正电容的下极板接共模电平VCM；当所述校正补偿值cal_com的某位为1，则：当所述补偿方向信息为所述第一补偿方向时，说明需要正向补偿，此时 P辅助校正电容阵列11的辅助校正电容的下极板接第一参考电压VREFP，N辅助校正电容阵列12的辅助校正电容的下极板接第二参考电压VREFN；当所述补偿方向信息为所述第二补偿方向时，说明需要反向补偿，此时 P辅助校正电容阵列11的辅助校正电容的下极板接第二参考电压VREFN，N 辅助校正电容阵列12的辅助校正电容的下极板接第一参考电压VREFP。一般在每次开机，或者芯片工作环境发生较大变化时触发进行校正，并将所述补偿方向信息和所述校正补偿值保存。在正常工作阶段，所述P辅助校正电容阵列11及所述N辅助校正电容阵列1212中的最低位电容Ca始终接VCM，其他电容Ca～Ca 的下极板电压分别由所述校正逻辑模块40根据n位的所述校正补偿值 cal_com按顺序由大到小一一对应去控制接至相应的电压，从而将所述校正补偿值补偿到ADC中，抵消失调误差。最后应说明的是：以上各实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述各实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分或者全部技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的范围。
