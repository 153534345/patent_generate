标题title
一种基于位平面分割的可分离密文域可逆数据隐藏方法
摘要abst
本发明公开一种基于位平面分割的可分离密文域可逆数据隐藏方法，首先提出了一种分块分类置乱算法及遍历矩阵加密算法，完成原始图像加密；然后利用Hilbert曲线加密实现水印图像加密；在密文域中，采用全位平面置乱技术，首先实施位平面旋转，再将其分块分类成连续块和非连续快，最后依据像素预测方法实现可逆数据隐藏。同时，本发明实现了秘钥可分离，拥有隐藏秘钥可以提取隐藏的水印，拥有加密秘钥可以恢复原始图像，拥有双秘钥则既能提取水印图像又可以恢复原始图像。本发明基于像素预测实现了100％可逆，不仅能无差错提取水印图像，而且能够100％恢复原始图像，具有高安全性、大容量、高质量及良好的鲁棒性。
权利要求书clms
1.一种基于位平面分割的可分离密文域可逆数据隐藏方法，其特征在于依次按照如下步骤进行：步骤1：对原始图像进行分块分类置乱加密和遍历矩阵加密步骤1.1将尺寸为M×N的原始图像分成p×q个尺寸为m×n不重叠的子块，所述p＝M/m，q＝N/n；步骤1.2根据公式将子块分为亮度块和暗度块，并用1标注亮度块、0标注暗度块，生成分类图B；式中num表示子块内灰度值大于等于127的像素个数，i∈,，j∈；步骤1.3对分类图B进行Huffman压缩编码，将编码后的数据作为秘钥K1保存；步骤1.4遍历分类图B重新排列，将所有亮度块置于暗度块前面，再将亮度块按原顺序重排列，将暗度块逆序重排列，得到分块分类置乱后图像；步骤1.5利用公式生成长度为m×n的随机数列L1，式中3.5699456＜μ≤4，0＜x＜1，所述随机数列L1无序且不重复，将公式中的初值μ和x0作为秘钥K2保存；xk+1＝μxk步骤1.6将随机数列L1排序，排序后数列记为L2，根据L1与L2的一一对应关系，生成数对，依据数对的对应关系构造出遍历矩阵；步骤1.7以分块分类置乱后图像子块为单位进行多次矩阵遍历加密，得到密文图像，所述矩阵遍历加密即依据构造的遍历矩阵重新排列子块内的像素，将矩阵遍历加密次数作为秘钥K3保存；步骤2：水印图像加密将水印图像分成不重叠的8×8子块，以水平方向优先，蛇形遍历所有子块，每个子块内按Hilbert曲线无交叉遍历所有像素点生成一维数据；步骤3：密文域可逆数据隐藏，具体步骤如下：步骤3.1：将密文图像进行全位平面置乱，即将8个不同像素的最高位组合成一个新的1×8矩阵，再将8个不同像素的第七位组合成一个新的1×8矩阵，以此类推，最后将8个不同像素的最低位组合成一个新的1×8矩阵，再将8个新的1×8矩阵重新组合成一个8×8矩阵，得到全位平面置乱后的密文图像；步骤3.2将全位平面置乱后的密文图像的新位平面中相同位的每行前4个元素和后4个元素分别组成2×2子块；步骤3.3扫描生成的全部2×2子块，将所有2×2子块分类为连续块和非连续块，所述连续块是块内所有像素均为1或0的2×2子块，所述非连续块是块内像素有0有1的2×2子块；以1表示连续块，0表示非连续块，生成块标签矩阵，并作为秘钥K4保存；步骤3.4按照连续块在前非连续块在后的顺序，重新排列所有2×2子块，得到基于2×2子块重排列后的8个新位平面矩阵；步骤3.5对于新位平面矩阵中的连续块，块中的第pos个位置为保留位置，其余三个位置各嵌入1比特数据，得到嵌入数据后的连续块，所述pos根据公式计算，式中MOD是取模函数，INT是向下取整函数，K5是一个随机数，作为秘钥K5保存；pos＝MOD,4) 步骤3.6对于新位平面矩阵中的非连续块，块中的第pos个位置为预测位置，预测位置的值为被预测值，所述pos根据公式计算；步骤3.7按照公式确定预测位置的值，即预测值p，当预测值与被预测值相同时，该非连续块为可嵌入块，在预测位置嵌入1比特数据，否则该非连续块为不可嵌入块，得到嵌入数据后的非连续块；将可嵌入块用1标注，不可嵌入块用0标注，生成长度与块数量相同的序列L，并将L作为秘钥K6保存；步骤3.8将所有一维数据均嵌入到子块中，记录块嵌入标签结束位置，作为秘钥K7保存，将经过一维数据嵌入的8个位平面重新组合成图像，得到含水印的密文图像；步骤4图像恢复与数据提取利用加密秘钥K1-K4，从含水印的密文图像中提取解密图像，具体步骤如下：步骤4.1利用秘钥K4得到块标签矩阵，将块重新排列，得到新位平面；步骤4.2将新位平面实施逆90度旋转，得到原始位平面；步骤4.3将原始位平面每行8比特二进制转换成一个十进制灰度值，所有灰度值组合成密文图像；步骤4.4利用秘钥K2构造遍历矩阵；步骤4.5利用秘钥K3，对密文图像实施逆矩阵解密，得到解密后的图像矩阵；步骤4.6利用秘钥K1得到的分类图，重新排列亮度块与暗度块，得到解密图像；利用加密秘钥K5-K7，从含水印的密文图像中提取水印图像，具体步骤如下：步骤4.7利用秘钥K5，确定数据嵌入位置；步骤4.8利用秘钥K7，读取块嵌入标签结束位置；步骤4.9对于连续块，依次读取除确定位置外的所有值，得到嵌入到连续块中的数据；步骤4.10利用秘钥K6，将非连续块分为可嵌入块和不可嵌入块；步骤4.11提取可嵌入块中确定数据位置的值，得到非连续块中的数据；步骤4.12基于Hilbert曲线解密数据，得到水印图像；步骤4.13利用秘钥K5，确定数据嵌入位置及保留位置，利用秘钥K7，读取块嵌入标签结束位置；步骤4.14对于连续块，读取保留位置的值，并将当前块中所有值均替换为保留位置值；步骤4.15对于非连续块，将其分为可嵌入块和不可嵌入块；步骤4.16对于可嵌入块，读取除嵌入位置外的其他三个位置的值，若该三个值中1的个数更多，则将嵌入位置值置为1，否则置为0，得到恢复后的密文图像；采用双重秘钥，从含水印的密文图像中提取水印图像及得到原始图像，具体步骤如下：步骤4.17利用秘钥K5，确定数据嵌入位置；步骤4.18利用秘钥K7，读取块嵌入标签结束位置；步骤4.19对于连续块，依次读取除确定位置外的所有值，得到嵌入到连续块中的数据；步骤4.20利用秘钥K6，将非连续块分为可嵌入块和不可嵌入块；步骤4.21提取可嵌入块中确定数据位置的值，得到非连续块中的数据；步骤4.22基于Hilbert曲线解密数据，得到水印图像；步骤4.23利用钥K5，确定数据嵌入位置、保留位置，利用秘钥K7，读取块嵌入标签结束位置；步骤4.24对于连续块，读取保留位置的值，并将当前块中所有值均替换为保留位置值；步骤4.25对于非连续块，将其分为可嵌入块和不可嵌入块；步骤4.26对于可嵌入块，读取除嵌入位置外的其他三个位置的值，若该三个值中1的个数更多，则将嵌入位置值置为1，否则置为0，得到恢复后的密文图像；步骤4.27利用秘钥K4得到块标签矩阵，将恢复后密文图像的块重新排列，得到新位平面；步骤4.28将新位平面实施逆90度旋转，得到原始位平面；步骤4.29将原始位平面每行8比特二进制转换成一个十进制灰度值，所有灰度值组合成密文图像；步骤4.30利用秘钥K2构造遍历矩阵；步骤4.31利用秘钥K3，对密文图像实施逆矩阵解密，得到解密后的图像矩阵；步骤4.32利用秘钥K1得到的分类图，重新排列亮度块与暗度块，得到原始图像。
说明书desc
技术领域本发明涉及一种密文域可逆数据隐藏方法，尤其是一种基于位平面分割的可分离密文域可逆数据隐藏方法。背景技术信息隐藏技术凭借其完整性认证、版权保护等功能在众多加密技术中脱颖而出，可逆数据隐藏是一种可以无损恢复原始图像和无差错提取信息的信息隐藏技术。然而，传统的可逆数据隐藏存在着原始图像暴露的安全隐患，故将加密技术与可逆数据隐藏相结合的密文域可逆数据隐藏成了学术界关注的热点。密文域可逆信息隐藏在保护图像内容不被泄露的同时隐藏信息，用户可以根据拥有的秘钥种类和自身需求解密图像内容、提取隐藏的信息及无损恢复原始图像，有助于保障图像的机密性和可用性。最初的RDHEI算法是在图像加密后腾出空间，即基于VRAE框架和对称加密的密文可逆信息隐藏。早在2008年，Puech等人通过分割加密后图像，在每个分块中隐藏附加信息，最后利用图像像素的局部标准差来完成信息提取和图像恢复，但是该方法一直未得到研究者关注；Zhang利用流密码加密原始图像，然后将加密图像分成大小相同的块，通过翻转分块中部分像素的LSB来隐藏附加信息，该算法能够利用自然图像像素相关性实现较好性能；Zhou等提出在解码阶段利用两类支持向量机分类器来区分图像区域，从而提取信息并恢复图像。然而，上述经典RDHEI方法存在共同的应用局限，即算法的信息提取和图像恢复过程不可分离。为解决这一问题，Ge等使用流密码置乱加密图像块，然后采用直方图平移的方法实现信息隐藏，最后在接收方提取信息并根据置乱秘钥和加密秘钥无损恢复图像；Zhang等提出一种高保真的缩略图保护加密方案，该方案不仅准确实现加解密，而且缩略图更接近于原始明文图像，且具有较低的噪声；Wang等对所有像素块进行重排列并加密，通过自适应预测MSB来隐藏信息，该算法充分利用块内像素相关性，提升了嵌入容量。随着国内外数据安全需求的不断提升，基于对称加密和RRBE框架、以及基于公钥/同态加密的密文域可逆信息隐藏算法得到学者普遍关注。Puteaus等提出密文域信息隐藏不需要考虑加密和隐藏后的图像视觉质量问题，故采用图像最高位平面替换来嵌入附加信息，因此得到了较高的有效载荷。Chen等使用流密码和位置置乱相结合的方法生成密文图像，通过多MSB压缩的方法预留空间嵌入附加信息，该方法可以抵御各种攻击且有效提高了容量。Ke等设计了一种基于秘钥交换的LSB信息隐藏方法，该方法实现了无须私钥直接从加密域提取信息。然而，基于VRAE框架有其自身的局限性，比如有的在数据提取或图像恢复中可能出现误码率，无法实现完全可逆；有的在信息提取和图像恢复过程中不可分离。发明内容本发明是为了解决现有技术所存在的上述技术问题，提供一种基于位平面分割的可分离密文域可逆数据隐藏方法。本发明的技术解决方案是：一种基于位平面分割的可分离密文域可逆数据隐藏方法，其特征在于依次按照如下步骤进行：步骤1：对原始图像进行分块分类置乱加密和遍历矩阵加密步骤1.1将尺寸为M×N的原始图像分成p×q个尺寸为m×n不重叠的子块，所述p＝M/m，q＝N/n；步骤1.2根据公式将子块分为亮度块和暗度块，并用1标注亮度块、0标注暗度块，生成分类图B；式中num表示子块内灰度值大于等于127的像素个数，i∈,，j∈；步骤1.3对分类图B进行Huffman压缩编码，将编码后的数据作为秘钥K1保存；步骤1.4遍历分类图B重新排列，将所有亮度块置于暗度块前面，再将亮度块按原顺序重排列，将暗度块逆序重排列，得到分块分类置乱后图像；步骤1.5利用公式生成长度为m×n的随机数列L1，式中3.5699456＜μ≤4，0＜x＜1，所述随机数列L1无序且不重复，将公式中的初值μ和x0作为秘钥K2保存；xk+1＝μxk步骤1.6将随机数列L1排序，排序后数列记为L2，根据L1与L2的一一对应关系，生成数对，依据数对的对应关系构造出遍历矩阵；步骤1.7以分块分类置乱后图像子块为单位进行多次矩阵遍历加密，得到密文图像，所述矩阵遍历加密即依据构造的遍历矩阵重新排列子块内的像素，将矩阵遍历加密次数作为秘钥K3保存；步骤2：水印图像加密将水印图像分成不重叠的8×8子块，以水平方向优先，蛇形遍历所有子块，每个子块内按Hilbert曲线无交叉遍历所有像素点生成一维数据；步骤3：密文域可逆数据隐藏，具体步骤如下：步骤3.1：将密文图像进行全位平面置乱，即将8个不同像素的最高位组合成一个新的1×8矩阵，再将8个不同像素的第七位组合成一个新的1×8矩阵，以此类推，最后将8个不同像素的最低位组合成一个新的1×8矩阵，再将8个新的1×8矩阵重新组合成一个8×8矩阵，得到全位平面置乱后的密文图像；步骤3.2将全位平面置乱后的密文图像的新位平面中相同位的每行前4个元素和后4个元素分别组成2×2子块；步骤3.3扫描生成的全部2×2子块，将所有2×2子块分类为连续块和非连续块，所述连续块是块内所有像素均为1或0的2×2子块，所述非连续块是块内像素有0有1的2×2子块；以1表示连续块，0表示非连续块，生成块标签矩阵，并作为秘钥K4保存；步骤3.4按照连续块在前非连续块在后的顺序，重新排列所有2×2子块，得到基于2×2子块重排列后的8个新位平面矩阵；步骤3.5对于新位平面矩阵中的连续块，块中的第pos个位置为保留位置，其余三个位置各嵌入1比特数据，得到嵌入数据后的连续块，所述pos根据公式计算，式中MOD是取模函数，INT是向下取整函数，K5是一个随机数，作为秘钥K5保存；pos＝MOD,4)步骤3.6对于新位平面矩阵中的非连续块，块中的第pos个位置为预测位置，预测位置的值为被预测值，所述pos根据公式计算；步骤3.7按照公式确定预测位置的值，即预测值p，当预测值与被预测值相同时，该非连续块为可嵌入块，在预测位置嵌入1比特数据，否则该非连续块为不可嵌入块，得到嵌入数据后的非连续块；将可嵌入块用1标注，不可嵌入块用0标注，生成长度与块数量相同的序列L，并将L作为秘钥K6保存；步骤3.8将所有一维数据均嵌入到子块中，记录块嵌入标签结束位置，作为秘钥K7保存，将经过一维数据嵌入的8个位平面重新组合成图像，得到含水印的密文图像；步骤4图像恢复与数据提取利用加密秘钥K1-K4，从含水印的密文图像中提取解密图像，具体步骤如下：步骤4.1利用秘钥K4得到块标签矩阵，将块重新排列，得到新位平面；步骤4.2将新位平面实施逆90度旋转，得到原始位平面；步骤4.3将原始位平面每行8比特二进制转换成一个十进制灰度值，所有灰度值组合成密文图像；步骤4.4利用秘钥K2构造遍历矩阵；步骤4.5利用秘钥K3，对密文图像实施逆矩阵解密，得到解密后的图像矩阵；步骤4.6利用秘钥K1得到的分类图，重新排列亮度块与暗度块，得到解密图像；利用加密秘钥K5-K7，从含水印的密文图像中提取水印图像，具体步骤如下：步骤4.7利用秘钥K5，确定数据嵌入位置；步骤4.8利用秘钥K7，读取块嵌入标签结束位置；步骤4.9对于连续块，依次读取除确定位置外的所有值，得到嵌入到连续块中的数据；步骤4.10利用秘钥K6，将非连续块分为可嵌入块和不可嵌入块；步骤4.11提取可嵌入块中确定数据位置的值，得到非连续块中的数据；步骤4.12基于Hilbert曲线解密数据，得到水印图像；步骤4.13利用秘钥K5，确定数据嵌入位置及保留位置，利用秘钥K7，读取块嵌入标签结束位置；步骤4.14对于连续块，读取保留位置的值，并将当前块中所有值均替换为保留位置值；步骤4.15对于非连续块，将其分为可嵌入块和不可嵌入块；步骤4.16对于可嵌入块，读取除嵌入位置外的其他三个位置的值，若该三个值中1的个数更多，则将嵌入位置值置为1，否则置为0，得到恢复后的密文图像；采用双重秘钥，从含水印的密文图像中提取水印图像及得到原始图像，具体步骤如下：步骤4.17利用秘钥K5，确定数据嵌入位置；步骤4.18利用秘钥K7，读取块嵌入标签结束位置；步骤4.19对于连续块，依次读取除确定位置外的所有值，得到嵌入到连续块中的数据；步骤4.20利用秘钥K6，将非连续块分为可嵌入块和不可嵌入块；步骤4.21提取可嵌入块中确定数据位置的值，得到非连续块中的数据；步骤4.22基于Hilbert曲线解密数据，得到水印图像；步骤4.23利用钥K5，确定数据嵌入位置、保留位置，利用秘钥K7，读取块嵌入标签结束位置；步骤4.24对于连续块，读取保留位置的值，并将当前块中所有值均替换为保留位置值；步骤4.25对于非连续块，将其分为可嵌入块和不可嵌入块；步骤4.26对于可嵌入块，读取除嵌入位置外的其他三个位置的值，若该三个值中1的个数更多，则将嵌入位置值置为1，否则置为0，得到恢复后的密文图像；步骤4.27利用秘钥K4得到块标签矩阵，将恢复后密文图像的块重新排列，得到新位平面；步骤4.28将新位平面实施逆90度旋转，得到原始位平面；步骤4.29将原始位平面每行8比特二进制转换成一个十进制灰度值，所有灰度值组合成密文图像；步骤4.30利用秘钥K2构造遍历矩阵；步骤4.31利用秘钥K3，对密文图像实施逆矩阵解密，得到解密后的图像矩阵；步骤4.32利用秘钥K1得到的分类图，重新排列亮度块与暗度块，得到原始图像。本发明首先提出了一种分块分类置乱算法及遍历矩阵加密算法，完成原始图像加密；然后利用Hilbert曲线加密实现水印图像加密；在密文域中，采用全位平面置乱技术，首先实施位平面旋转，再将其分块分类成连续块和非连续块，最后依据像素预测方法实现可逆数据隐藏。同时，本发明实现了秘钥可分离，拥有隐藏秘钥可以提取隐藏的水印，拥有加密秘钥可以恢复原始图像，拥有双秘钥则既能提取水印图像又可以恢复原始图像。本发明基于像素预测实现了100％可逆，不仅能无差错提取水印图像，而且能够100％恢复原始图像，具有高安全性、大容量、高质量及良好的鲁棒性。附图说明图1是本发明实施例的流程图。图2是本发明实施例的原始图像。图3是本发明实施例分块分类置乱示意图。图4是本发明实施例遍历矩阵加密原理示意图。图5是本发明实施例的密文图像。图6是本发明实施例原始图像的直方图。图7是本发明实施例密文图像的直方图。图8是本发明实施例的水印图像。图9是本发明实施例Hilbert曲线的加密示意图。图10是本发明实施例全位平面置乱示意图。图11是本发明实施例位平面分块图。图12是本发明实施例块分类示意图。图13是本发明实施例连续块保留位置示意图图14是本发明实施例非连续块及嵌入位置示意图。图15是本发明实施例的解密图像。图16是本发明实施例在椒盐噪声攻击后恢复的原始图像及提取的水印图像。图17是本发明实施例在剪切攻击后密文图像、恢复的原始图像及提取的水印图像。具体实施方式本发明的一种基于位平面分割的可分离密文域可逆数据隐藏方法如图1所示，依次按照如下步骤进行：步骤1：对原始图像进行分块分类置乱加密和遍历矩阵加密步骤1.1将图2的6幅尺寸为128×128的标准灰度原始图像：Lena、Baboon、Boat、Pepper、Barbara、Airplane，分别分成p×q个尺寸为m×n不重叠的子块，所述p＝M/m，q＝N/n；步骤1.2根据公式将子块分为亮度块和暗度块，并用1标注亮度块、0标注暗度块，生成分类图B；式中num表示子块内灰度值大于等于127的像素个数，i∈,，j∈；步骤1.3对分类图B进行Huffman压缩编码，将编码后的数据作为秘钥K1保存；步骤1.4遍历分类图B重新排列，将所有亮度块置于暗度块前面，再将亮度块按原顺序重排列，将暗度块逆序重排列，得到分块分类置乱后图像；例如将图3a所示16×16的原始图像分成不重叠的4×4子块，其分类矩阵及置乱后矩阵分别如公式B、B’所示，则置乱后图像如图3b所示，其中白色代表像素灰度值大于等于127，黑色则表示小于127；步骤1.5如图4a、图4b所示，以置乱后图像子块为单位进行矩阵遍历加密，利用公式生成长度为m×n的随机数列L1，式中3.5699456＜μ≤4，0＜x＜1，所述随机数列L1应无序且不重复，因此在生成随机数的过程中，如遇相同数据，则删除后重新生成，将公式中的初值μ和x0作为秘钥K2保存；xk+1＝μxk 例如，对于4×4子块，以K2为秘钥，生成长度为16的随机序列L1，其中每个数后的表示其所在位置：L1＝{0.4523,0.9537,0.1698,0.5429,0.9554,0.1639,0.5277,0.9595,0.1495,0.4894,0.9621,0.1405,0.4649,0.9578,0.1557,0.5062}；步骤1.6将随机数列L1排序，排序后数列记为L2，每个数后的中i表示其值在原序列中的位置，j表示在排序后序列中的位置：L2＝{0.1405,0.1495,0.1557,0.1639,0.1698,0.4523,0.4649,0.4894,0.5062,0.5277,0.5429,0.9537,0.9554,0.9578,0.9595,0.9621}；根据L1与L2的一一对应关系，生成数对，依据数据对的对应关系，构造出的遍历矩阵如下：步骤1.7以分块分类置乱后图像子块为单位进行多次矩阵遍历加密，得到密文图像，所述矩阵遍历加密即依据构造的遍历矩阵重新排列子块内的像素，一次矩阵遍历加密矩阵及二次矩阵遍历加密矩阵分别如图4c、4d所示，将矩阵遍历加密次数作为秘钥K3保存；得到的密文图像如图5所示，从加密效果而言，密文图像类似于噪声，相关性很低，无法从中获取原始图像细节信息；图6是原始图像直方图，图7是密文图像直方图，从像素空间分布而言，密文图像呈均匀分布，无法与原始图像像素分布拟合；表1是原始图像与密文图像的信息熵、NPCR、UACI，信息熵值越接近8，说明图像随机性越好，像素相关性越弱。表1由表1可以看出，原始图像的信息熵在6.7左右，而密文图像则为7.9左右；利用NPCR和UACI来衡量原始图像与密文图像之间的区别，NPCR值均在99％以上，而UACI值在17％以下；综上所述，本发明密文图像与原始图像差别很大，且密文图像的像素分布随机性更强，表明对原始图像使用的加密具有很强的安全性。步骤2：水印图像加密将图8所示的尺寸为64×64的灰度水印图像，分成不重叠的8×8子块，如图9a-d所示，以水平方向优先，蛇形遍历所有子块，每个子块内按Hilbert曲线无交叉遍历所有像素点生成一维数据；步骤3：密文域可逆数据隐藏，具体步骤如下：步骤3.1如图10a-c所示，将密文图像进行全位平面置乱，即将8个不同像素的最高位组合成一个新的1×8矩阵，再将8个不同像素的第七位组合成一个新的1×8矩阵，以此类推，最后将8个不同像素的最低位组合成一个新的1×8矩阵，再将8个新的1×8矩阵重新组合成一个8×8矩阵，得到全位平面置乱后的密文图像；步骤3.2如图11所示，将全位平面置乱后的密文图像的新位平面中相同位的每行前4个元素和后4个元素分别组成2×2子块；步骤3.3如图12所示，扫描生成的全部2×2子块，将所有2×2子块分类为连续块和非连续块，所述连续块是块内所有像素均为1或0的2×2子块，所述非连续块是块内像素有0有1的2×2子块；以1表示连续块，0表示非连续块，生成块标签矩阵，并作为秘钥K4保存；步骤3.4按照连续块在前非连续块在后的顺序，重新排列所有2×2子块，得到基于2×2子块重排列后的8个新位平面矩阵；步骤3.5对于新位平面矩阵中的连续块，块中的第pos个位置为保留位置，其余三个位置各嵌入1比特数据，得到嵌入数据后的连续块，所述pos根据公式计算，式中MOD是取模函数，INT是向下取整函数，K5是一个随机数，作为秘钥K5保存；pos＝MOD,4)当pos＝0,1,2,3时保留位置如图13所示；步骤3.6对于新位平面矩阵中的非连续块，块中的第pos个位置为预测位置，预测位置的值为被预测值，所述pos根据公式计算，假设K5＝17，则pos＝1；步骤3.7按照公式确定预测位置的值，即预测值p，当预测值与被预测值相同时，该非连续块为可嵌入块，在预测位置嵌入1比特数据，否则该非连续块为不可嵌入块，得到嵌入数据后的非连续块；将可嵌入块用1标注，不可嵌入块用0标注，生成长度与块数量相同的序列L，并将L作为秘钥K6保存；图14a中黑色框为被预测位置，该元素周围三像素和为1，则其预测值为p＝0，该预测值与该位置值相同，因此该块为可嵌入块，也就是说该位置可用于嵌入信息，恢复时利用其周围三像素即可完全恢复；图14b中黑色框为被预测位置，被预测值为0，但是因为其周围三像素之和为1，预测值为1，与被预测值为0不等，因此为不可嵌入块；图14c黑色边框均为可嵌入位置；步骤3.8将所有一维数据均嵌入到子块中，记录块嵌入标签结束位置，作为秘钥K7保存，将经过一维数据嵌入的8个位平面重新组合成图像，得到含水印的密文图像；表2是6幅图像的容量分析结果，表内数据的单位为bpp。算法的容量是衡量算法性能的重要指标之一，容量越高，越能满足更多用户的需求，全位平面嵌入策略,在嵌入容量方面优势明显，理论上，对于任一像素将其转换成8bit二进制，每4bit构成1个2×2子块，共2个子块，若2个子块均为连续块，则可嵌入2×3＝6bit信息，因此理论上最高容量可达6bpp。表2由表2可以看出：本发明理论容量和实际容量都较高。表3为6幅图像在不同算法中的嵌入容量。表3由表3可以看出，本发明的嵌入容量远远高于文献，嵌入容量的平均值分别约为这些算法的70倍、41倍、2.83倍和1.27倍。步骤4图像恢复与数据提取利用加密秘钥K1-K4，从含水印的密文图像中提取解密图像，具体步骤如下：步骤4.1利用秘钥K4得到块标签矩阵，将块重新排列，得到新位平面；步骤4.2将新位平面实施逆90度旋转，得到原始位平面；步骤4.3将原始位平面每行8比特二进制转换成一个十进制灰度值，所有灰度值组合成密文图像；步骤4.4利用秘钥K2构造遍历矩阵；步骤4.5利用秘钥K3，对密文图像实施逆矩阵解密，得到解密后的图像矩阵；步骤4.6利用秘钥K1得到的分类图，重新排列亮度块与暗度块，得到如图15所示的解密图像；从图15的视觉效果看，很难看出解密图像与原始图像的区别。表4是本发明实施例解密图像与原始图像的PNSR值。表4由表4可以看出，解密图像与原始图像的峰值信噪比值很高，其中Airplane图像PNSR高达69.9710，而最低值的Baboon图像也达到了55.5628。表5为本发明与不同算法的图像质量结果。表5由表5可以看出，本发明的平均PSNR高达64.64dB，远远高于文献的算法，具有很好的解密图像质量。利用加密秘钥K5-K7，从含水印的密文图像中提取水印图像，具体步骤如下：步骤4.7利用秘钥K5，确定数据嵌入位置；步骤4.8利用秘钥K7，读取块嵌入标签结束位置；步骤4.9对于连续块，依次读取除确定位置外的所有值，得到嵌入到连续块中的数据；步骤4.10利用秘钥K6，将非连续块分为可嵌入块和不可嵌入块；步骤4.11提取可嵌入块中确定数据位置的值，得到非连续块中的数据；步骤4.12基于Hilbert曲线解密数据，得到水印图像；步骤4.13利用秘钥K5，确定数据嵌入位置及保留位置，利用秘钥K7，读取块嵌入标签结束位置；步骤4.14对于连续块，读取保留位置的值，并将当前块中所有值均替换为保留位置值；步骤4.15对于非连续块，将其分为可嵌入块和不可嵌入块；步骤4.16对于可嵌入块，读取除嵌入位置外的其他三个位置的值，若该三个值中1的个数更多，则将嵌入位置值置为1，否则置为0，得到恢复后的密文图像；采用双重秘钥，从含水印的密文图像中提取水印图像及得到原始图像，具体步骤如下：步骤4.17利用秘钥K5，确定数据嵌入位置；步骤4.18利用秘钥K7，读取块嵌入标签结束位置；步骤4.19对于连续块，依次读取除确定位置外的所有值，得到嵌入到连续块中的数据；步骤4.20利用秘钥K6，将非连续块分为可嵌入块和不可嵌入块；步骤4.21提取可嵌入块中确定数据位置的值，得到非连续块中的数据；步骤4.22基于Hilbert曲线解密数据，得到水印图像；步骤4.23利用钥K5，确定数据嵌入位置、保留位置，利用秘钥K7，读取块嵌入标签结束位置；步骤4.24对于连续块，读取保留位置的值，并将当前块中所有值均替换为保留位置值；步骤4.25对于非连续块，将其分为可嵌入块和不可嵌入块；步骤4.26对于可嵌入块，读取除嵌入位置外的其他三个位置的值，若该三个值中1的个数更多，则将嵌入位置值置为1，否则置为0，得到恢复后的密文图像；步骤4.27利用秘钥K4得到块标签矩阵，将恢复后密文图像的块重新排列，得到新位平面；步骤4.28将新位平面实施逆90度旋转，得到原始位平面；步骤4.29将原始位平面每行8比特二进制转换成一个十进制灰度值，所有灰度值组合成密文图像；步骤4.30利用秘钥K2构造遍历矩阵；步骤4.31利用秘钥K3，对密文图像实施逆矩阵解密，得到解密后的图像矩阵；步骤4.32利用秘钥K1得到的分类图，重新排列亮度块与暗度块，得到原始图像；表6是提取水印与原始水印相似度值NCC和恢复图像与原始图像的峰值信噪比PSNR。表6由表6可以看出，从6幅含水印的密文图像中提取水印与原始水印的相似度均为1，且恢复后的图像与原始图像的PSNR为+∞，实现了100％可逆性。图16是本发明实施例添加系数为0.05的椒盐噪声攻击后恢复的原始图像及提取的水印图像，图16a1-f1为攻击后恢复的原始图像，图16a2-f2为攻击后提取的水印图像。可见在噪声攻击下，本发明实施例提取的水印图像和恢复的原始图像清晰可见，具有一定的鲁棒性。表7是在椒盐噪声的攻击下原始水印图像与提取水印图像的NCC值。表7由表7可以看出，本发明实施例的原始水印图像与提取水印图像NCC值均在0.99以上，相似度极高，说明本发明可以有效抵抗椒盐噪声攻击。图17a1-f1为本发明实施例剪切攻击不同位置后的密文图像，图17a2-f2为恢复的原始图像，图17a3-f3为提取的水印图像，可见在剪切攻击性下，恢复的原始图像和提取的水印图像均清晰可见。表8是在不同位置、不同比例的剪切攻击下原始水印图像与提取水印图像的NCC值。表8由表8可以看出，原始水印图像与提取水印图像NCC值均在0.98以上，说明本发明可以有效抵抗剪切攻击。参考文献：Qin Chuan,Zhang Wei,Cao Fang,et al.Separable reversible datahiding in encrypted images via adaptive embedding strategy with blockselection.Signal Processing,2018,153:109-122黄梦雪,和红杰,陈帆.抵抗唯密文攻击的可分离加密域可逆信息隐藏.计算机辅助设计与图形学学报,2020,32:874-882杨阳,李欣然,胡锦川.基于块重构的加密域可逆信息隐藏.应用科学学报,2021,39:906-922.杨尧林,和红杰,陈帆,原长琦.基于预测误差自适应编码的图像加密可逆数据隐藏.计算机研究与发展,2021,58:1340-1350.Ren Honglin Lu Wei,Chen Bing.Reversible data hiding in encryptedbinary images by pixel prediction.Signal Processing,2019:268-277李锦伟,张晓雅,姚远志,俞能海.基于细粒度嵌入空间预留的密文域图像可逆信息隐藏方法.网络与信息安全学报,2022,8:106-117.
