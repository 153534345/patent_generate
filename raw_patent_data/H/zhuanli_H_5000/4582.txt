标题title
一种无人机或无人车的视频和位置同步方法
摘要abst
本发明涉及同步技术领域，特别涉及一种无人机或无人车的视频和位置同步方法；所述方法包括以下步骤：安装在无人机/无人车上的同步软件通过抓取视频数据包，计算并获得视频开始时间，随后将视频开始时间推送给服务器上的同步软件，服务器上的同步软件接收心跳数据和视频开始时间，处理并获得和视频同步的心跳数据，随后推送给原处理系统进行处理。本发明通过在不增加硬件的情况下，只需在无人机/无人车和服务器上各安装一个同步软件，同时并未对无人机/无人车和服务器已有的原处理系统进行修改，即可实现无人机/无人车的位置和视频的同步，拓宽了无人机/无人车的应用场景。
权利要求书clms
1.一种无人机或无人车的视频和位置同步方法，用于实现无人机/无人车和服务器之间的视频和位置的同步，在无人机/无人车和服务器上各安装一个同步软件，并且无人机/无人车和服务器之间通过网络通信；其特征在于，所述方法包括以下步骤：安装在无人机/无人车上的同步软件通过抓取视频数据包，计算并获得视频开始时间，随后将视频开始时间推送给服务器上的同步软件，服务器上的同步软件接收心跳数据和视频开始时间，处理并获得和视频同步的心跳数据，随后推送给原处理系统进行处理。2.根据权利要求1所述的一种无人机或无人车的视频和位置同步方法，其特征在于，所述视频开始时间的处理步骤为：安装在无人机/无人车上的同步软件通过抓取视频数据包，根据视频数据包中的视频流虽未含有视频的真实采集时间，但是视频流的每一帧均有对应的视频帧时间戳，该视频帧时间戳＝当前时间-视频开始时间，其中，摄像机视频采集时间和推送间隔时间忽略不计，则抓取到视频流的时间＝采集时间＝当前时间，则视频开始时间＝抓取时间-视频帧时间戳。3.根据权利要求2所述的一种无人机或无人车的视频和位置同步方法，其特征在于，所述抓取视频数据包中的视频流由于视频开始时间不变，采用大周期间隔抓取计算抓取时间。4.根据权利要求2所述的一种无人机或无人车的视频和位置同步方法，其特征在于，所述服务器上的同步软件接收心跳数据和视频开始时间，处理并获得和视频同步的心跳数据的步骤为：服务器上的同步软件接收到心跳数据后，将心跳数据缓存，然后以心跳包中的时间作为心跳实际发出时间，同时，服务器上的同步软件通过抓包获取视频流中的视频帧的时间戳，通过从同步信息中获取的视频实际开始时间，计算视频帧实际发出时间，该视频帧实际发出时间＝视频开始时间+视频帧的时间戳，然后在心跳缓存中查找心跳实际发出时间和视频帧实际发出时间最近的心跳数据，并获取和视频同步的心跳数据，推送至服务器上的原处理系统，其中，最大同步时间误差＝心跳间隔和视频帧间隔的最大值。5.根据权利要求4所述的一种无人机或无人车的视频和位置同步方法，其特征在于，所述服务器上的同步软件还包括查询接口，用于查询视频延迟时间、心跳延迟时间和视频当前帧心跳数据。
说明书desc
技术领域本发明涉及同步技术领域，特别涉及一种无人机或无人车的视频和位置同步方法。背景技术无人机/无人车的位置和视频是最重要的数据之一，受限于无人机/无人车的体积、重量、功耗等，许多应用场景都需要将位置和视频推送到服务端进行处理。无人机/无人车的位置可以通过心跳机制实时推送，在保证无人机/无人车和服务器时间同步的情况下，可以精确获取到延迟时间。但视频一般是通过rtsp/rtmp等流媒体协议推送，协议复杂修改困难，而且摄像机集成度高，大多数设备不支持定制修改，难以精确获取视频延迟时间。因此服务器收到的无人机/无人车的位置和视频是不同步的，且视频延迟时间未知，需要位置信息的视频处理程序难以保证准确性，制约了无人机/无人车的应用场景。另外无人机/无人车一般是通过无线通信技术和后端服务器组成网络通信，而无线通信具有易受干扰、通信延迟波动大等问题，加剧了通信延迟的波动性，无人机/无人车的位置和视频就更加难以同步。为此，提出一种无人机或无人车的视频和位置同步方法。发明内容本发明的目的在于提供一种无人机或无人车的视频和位置同步方法，以解决上述技术中提出的问题。为了实现上述目的，本发明的技术方案如下：一种无人机或无人车的视频和位置同步方法，用于实现无人机/无人车和服务器之间的视频和位置的同步，在无人机/无人车和服务器上各安装一个同步软件，并且无人机/无人车和服务器之间通过网络通信；所述方法包括以下步骤：安装在无人机/无人车上的同步软件通过抓取视频数据包，计算并获得视频开始时间，随后将视频开始时间推送给服务器上的同步软件，服务器上的同步软件接收心跳数据和视频开始时间，处理并获得和视频同步的心跳数据，随后推送给原处理系统进行处理。可选的，所述视频开始时间的处理步骤为：安装在无人机/无人车上的同步软件通过抓取视频数据包，根据视频数据包中的视频流虽未含有视频的真实采集时间，但是视频流的每一帧均有对应的视频帧时间戳，该视频帧时间戳＝当前时间-视频开始时间，其中，摄像机视频采集时间和推送间隔时间忽略不计，则抓取到视频流的时间＝采集时间＝当前时间，则视频开始时间＝抓取时间-视频帧时间戳。可选的，所述抓取视频数据包中的视频流由于视频开始时间不变，采用大周期间隔抓取计算抓取时间。可选的，所述服务器上的同步软件接收心跳数据和视频开始时间，处理并获得和视频同步的心跳数据的步骤为：服务器上的同步软件接收到心跳数据后，将心跳数据缓存，然后以心跳包中的时间作为心跳实际发出时间，同时，服务器上的同步软件通过抓包获取视频流中的视频帧的时间戳，通过从同步信息中获取的视频实际开始时间，计算视频帧实际发出时间，该视频帧实际发出时间＝视频开始时间+视频帧的时间戳，然后在心跳缓存中查找心跳实际发出时间和视频帧实际发出时间最近的心跳数据，并获取和视频同步的心跳数据，推送至服务器上的原处理系统，其中，最大同步时间误差＝心跳间隔和视频帧间隔的最大值。可选的，所述服务器上的同步软件还包括查询接口，用于查询视频延迟时间、心跳延迟时间和视频当前帧心跳数据。本发明的有益效果为：本发明通过在不增加硬件的情况下，只需在无人机/无人车和服务器上各安装一个同步软件，同时并未对无人机/无人车和服务器已有的原处理系统进行修改，即可实现无人机/无人车的位置和视频的同步，拓宽了无人机/无人车的应用场景。本发明在无人机/无人车上安装的同步软件通过抓取视频流数据包的方式，计算并获得视频开始时间，推送至服务器上安装的同步软件，整个过程无需修改人机/无人车的控制系统和摄像机软件系统，避免了现有的摄像机集成度高，大多数摄像机设备不支持定制修改，难以精确获取视频延迟时间的问题；本发明在服务器上安装同步软件，替代了原处理系统接收心跳数据和同步数据，并且处理后获得和视频同步的心跳数据，推送给原处理系统进行进一步处理，整个过程无需原处理系统配合修改；本发明中服务器上安装的同步软件可提供视频延迟时间和心跳延迟时间等信息的查询，提供查询接口和推送通道，便于原处理系统对视频和心跳延迟进行分析处理。附图说明图1为本发明实施例无人机视频和位置同步方法的同步过程流程图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅是本发明的一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。参考附图1，一种无人机或无人车的视频和位置同步方法，用于实现无人机/无人车和服务器之间的视频和位置的同步，在无人机/无人车和服务器上各安装一个同步软件，并且无人机/无人车和服务器之间通过网络通信；所述方法包括以下步骤：安装在无人机/无人车上的同步软件通过抓取视频数据包，计算并获得视频开始时间，随后将视频开始时间推送给服务器上的同步软件，服务器上的同步软件接收心跳数据和视频开始时间，处理并获得和视频同步的心跳数据，随后推送给原处理系统进行处理。进一步的，本发明涉及的无人机/无人车上的摄像机和无人机/无人车上的控制系统是相互独立的存在，虽然无法直接读取摄像机推送给服务器的视频流，但是控制系统和摄像机处于同一网络，无人机/无人车和服务器上的同步软件均可以通过抓包的方式获取视频流数据信息。可选的，所述视频开始时间的处理步骤为：安装在无人机/无人车上的同步软件通过抓取视频数据包，根据视频数据包中的视频流虽未含有视频的真实采集时间，但是视频流的每一帧均有对应的视频帧时间戳，该视频帧时间戳＝当前时间-视频开始时间，其中，摄像机视频采集时间和推送间隔时间忽略不计，则抓取到视频流的时间＝采集时间＝当前时间，则视频开始时间＝抓取时间-视频帧时间戳。进一步的，本发明涉及的视频流数据信息的格式包括但不限于rtsp/rtmp等，并且前述格式的视频流中并不包括视频的真实采集时间，但是视频流的每一帧都有对应的一个视频帧时间戳，考虑到摄像机视频采集时间和推送间隔时间几乎可以忽略，主要是由于视频采集后及时推送给服务器，因此没有中间环节，可以认为抓取到视频流的时间就是采集时间，则视频开始时间＝抓取时间-视频帧时间戳，把这个计算获得的视频开始时间推送给服务器，服务器端即可计算得到视频流中每一帧的真实时间，由于该无人机/无人车上安装的同步软件只进行抓包计算，并未与已知的无人机/无人车上的摄像机和无人机/无人车上的控制系统做交互，无需修改已有的控制系统和摄像机软件系统，对已有的控制系统和摄像机软件系统无侵入处理。可选的，所述抓取视频数据包中的视频流由于视频开始时间不变，采用大周期间隔抓取计算抓取时间。进一步的，本发明涉及的抓取视频数据包中的视频流由于视频开始时间不变，因此不需要每一帧都进行抓包计算，可以采用较大周期间隔抓取计算，对于性能要求较低。进一步的，本发明涉及的在无人机/无人车上的控制系统中可以安装同步软件，可以将同步软件安装在控制系统中，如果不能安装，可以采用外挂一个低性能嵌入式处理器即可。进一步的，本发明涉及的无人机/无人车作为客户端，因此同步软件推送视频开始时间可以和心跳数据使用相同的端口，服务器处理时做区分处理即可。进一步的，本发明涉及的服务器接收到视频流数据无需做修改，接收到的心跳数据和同步信息先由同步软件处理，通过缓存心跳数据，延迟推送心跳数据方式，使得心跳数据和视频流同步，并且将同步后的心跳数据推送给服务器上的原处理系统。进一步的，本发明涉及的服务器若只需要位置数据不需要视频数据的原处理系统，同步软件可另外推送一路心跳数据过去，保证无缝衔接，整个过程服务器上的同步软件都是独立工作，未与已知的原处理系统进行交互，并且未对已知的原处理系统进行修改，因此对已有的原处理系统无侵入处理。可选的，所述服务器上的同步软件接收心跳数据和视频开始时间，处理并获得和视频同步的心跳数据的步骤为：服务器上的同步软件接收到心跳数据后，将心跳数据缓存，然后以心跳包中的时间作为心跳实际发出时间，同时，服务器上的同步软件通过抓包获取视频流中的视频帧的时间戳，通过从同步信息中获取的视频实际开始时间，计算视频帧实际发出时间，该视频帧实际发出时间＝视频开始时间+视频帧的时间戳，然后在心跳缓存中查找心跳实际发出时间和视频帧实际发出时间最近的心跳数据，并获取和视频同步的心跳数据，推送至服务器上的原处理系统，其中，最大同步时间误差＝心跳间隔时间和视频帧间隔时间的最大值，心跳间隔时间＝1/心跳周期，视频帧间隔时间＝1/视频帧率。进一步的，本发明涉及的删除该心跳数据之前一段时间的缓存的心跳数据，其中，保留一段时间是为防止查询不到心跳数据，通过前述的处理过程，能够保证推送到原处理系统的心跳数据和视频流同步。可选的，所述服务器上的同步软件还包括查询接口，用于查询视频延迟时间、心跳延迟时间和视频当前帧心跳数据。进一步的，本发明涉及的服务器上的同步软件将视频流和心跳数据的延迟信息推送给原处理系统中进行进一步分析处理，同时，同步软件还包括查询接口，用于查询视频流实时延迟时间、心跳实时延迟时间和视频当前帧心跳等数据，增加了数据获取手段，同时丰富了无人机/无人车的应用场景。最后说明的是，以上实施例仅用以说明本发明的技术方案而非限制，尽管参照较佳实施例对本发明进行了详细说明，本领域的普通技术人员应当理解，可以对本发明的技术方案进行修改或者等同替换，而不脱离本发明技术方案的宗旨和范围，其均应涵盖在本发明的权利要求范围当中。
