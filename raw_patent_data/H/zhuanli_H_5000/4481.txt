标题title
一种基于联邦学习的网络入侵协同检测方法
摘要abst
一种基于联邦学习的网络入侵协同检测方法。其包括发起者发起联邦学习请求；协调方下发参数信息；各参与方在本地训练联邦入侵检测卷积模型；获得本地加密态联邦入侵检测卷积模型并上传；得到全局联邦入侵检测卷积模型并下发；反馈联邦学习情况等步骤。本发明所训练的联邦入侵检测卷积模型更切合自身的业务需求。联邦学习任务采用联邦模型增量平均聚合函数，可使联邦学习效率提升。各参与方上传模型采用加密态联邦入侵检测卷积模型，可防止半诚实的参与方对其他参与方的模型反演攻击。由联邦学习的发起者进行仲裁，保护了入侵检测库不被协调方获取，可保证模型参数端到端的安全性，旨在增强模型健壮性。
权利要求书clms
1.一种基于联邦学习的网络入侵协同检测方法，其特征在于：所述基于联邦学习的网络入侵协同检测方法包括按顺序进行的下列步骤：1)发起者InitiOrgan作为联邦学习的N个参与方之一，参与联邦入侵检测卷积模型的训练和仲裁；其它参与方PartiOrgan包括第一参与方PartiOrgan1至第N-1参与方PartiOrgann-1，只参与联邦入侵检测卷积模型的训练；首先发起者InitiOrgan向协调方发起联邦学习的请求，并由发起者InitiOrgan根据自身需求与协调方共同决定与联邦入侵检测卷积模型相关的参数信息；2)协调方将相关的参数信息下发给本地联邦入侵检测卷积模型的各参与方；3)各参与方获得参数信息后，根据参数信息初始化本地联邦入侵检测卷积模型而获得本地初始联邦入侵检测卷积模型，然后将本地所拥有的入侵检测库传入各自的本地初始联邦入侵检测卷积模型进行训练，得到一个更新的本地联邦入侵检测卷积模型；4)各参与方完成一轮本地联邦入侵检测卷积模型更新后，采用加密态子模型拆分与融合算法，将更新的本地联邦入侵检测卷积模型拆分成N个加密态子模型，并与其它参与方交换各个加密态子模型，最后各参与方累加交换所得的加密态子模型，作为本地加密态联邦入侵检测卷积模型；5)各参与方将各自的本地加密态联邦入侵检测卷积模型上传到协调方；6)协调方将各参与方上传的本地加密态联邦入侵检测卷积模型进行加密态联邦模型增量加权平均，得到一个全局联邦入侵检测卷积模型；7)协调方将全局联邦入侵检测卷积模型下发给各个参与方；8)其它参与方PartiOrgan利用本地入侵检测库继续训练全局联邦入侵检测卷积模型；发起者InitiOrgan将本地入侵检测库按9∶1的比例对上述全局联邦入侵检测卷积模型进行训练和仲裁，仲裁函数采用联邦多标签熵损失函数，并根据仲裁函数的收敛状态向协调方反馈联邦学习情况。2.根据权利要求1所述的基于联邦学习的网络入侵协同检测方法，其特征在于：在步骤1)中，所述参数信息包括：101)算法选择：联邦学习选用的算法；102)数据处理方法：各本地入侵检测库数据预处理方法；103)隐私保护方法：上传更新的联邦入侵检测卷积模型所用的加密方式；104)参与方个数：联邦入侵检测卷积模型训练的参与方总数；105)全局轮次：全局联邦入侵检测卷积模型训练最大轮次；106)本地轮次：单轮次各参与方所训练的次数；107)共享批次大小：协调方指定各参与方同用的批次大小；108)参与方比率：单轮次随机选择的参与方比例；109)节点更新法：更新联邦入侵检测卷积模型节点参数选用的方法；110)共享学习率：协调方指定的各参与方同用的学习率大小；111)共享动量：协调方指定的各参与方同用的动量大小。3.根据权利要求1所述的基于联邦学习的网络入侵协同检测方法，其特征在于：在步骤3)中，所述训练方法如下：301)各参与方对本地所拥有的入侵检测库进行数据预处理，包括标准化处理和将特征矩阵转化成CNN像素矩阵；302)利用本地批次大小对预处理后的入侵检测库进行分批处理并打乱顺序；然后参与方利用协调方下发的全局初始联邦入侵检测卷积模型构建本地初始联邦入侵检测卷积模型；之后各参与方在本地对本地初始联邦入侵检测卷积模型训练E个轮次以更新模型参数；303)本地初始联邦入侵检测卷积模型向前蔓延计算各节点参数，然后采用联邦多标签熵损失函数计算模型参数的损失值MultiLabelLoss，公式如下：其中，i表示样本；N表示样本总数；MCOORDI表示由协调方选择的训练任务的标签类别数量；表示样本和标签类别的符号函数，若样本i的标签类别与标签类别c相同，则样本i的符号函数值为1，否则为0；predSoftmaxci表示样本i对于标签类别c的预测概率值；304)模型反向蔓延，计算模型参数的损失值MultiLabelLoss对各个神经元节点参数的偏导值，求解偏导值的方法是采用联邦共享动量SGD算法，并利用偏导值大小更新节点参数，其中联邦共享动量SGD的计算公式为：其中，mavgt为节点参数在共享动量shareMomen的条件下，第t次本地轮次的动量平均值；共享动量shareMomen为协调方所指定的联邦共享动量SGD；为第t次本地轮次的模型参数的损失值MultiLabelLoss对节点参数的偏导值；shareLR为联邦入侵检测卷积模型的共享学习率；为第t次本地轮次的节点参数更新值；305)反复计算模型参数的损失值MultiLabelLoss和偏导值直至训练的本地批次数达到最大。4.根据权利要求1所述的基于联邦学习的网络入侵协同检测方法，其特征在于：在步骤4)中，所述各参与方完成一轮本地联邦入侵检测卷积模型更新后，采用加密态子模型拆分与融合算法，将更新的本地联邦入侵检测卷积模型拆分成N个加密态子模型，并与其它参与方交换各个加密态子模型，最后各参与方累加交换所得的加密态子模型，作为本地加密态联邦入侵检测卷积模型的具体步骤如下：401)发起者InitiOrgan拥有更新的本地联邦入侵检测卷积模型M1、第一参与方PartiOrgan1拥有更新的本地联邦入侵检测卷积模型M2、…、第N-1参与方PartiOrgann-1拥有更新的本地联邦入侵检测卷积模型Mn；402)发起者InitiOrgan取N-1个随机算子，分别为Rm2、Rm3、…、Rmn，然后计算出下列N个加密态子模型：＜M1＞2＝Rm2＜M1＞3＝Rm3……＜M1＞n＝Rmn＜M1＞1＝M1-＜M1＞2-＜M1＞3-…-＜M1＞n其中＜·＞表示加密态子模型拆分与融合算法中的加密态密文；403)发起者InitiOrgan将加密态子模型＜M1＞2转发给第一参与方PartiOrgan1，将加密态子模型＜M1＞3转发给第二参与方PartiOrgan2，以此类推；同上，第一参与方PartiOrgan1和第二参与方PartiOrgan2均执行与发起者InitiOrgan相同的操作，并向其它参与方转发加密态子模型；一次转发后，发起者InitiOrgan拥有加密态子模型为：＜M1＞1、＜M2＞1、…、＜Mn＞1；第一参与方PartiOrgan1拥有加密态子模型为：＜M1＞2、＜M2＞2、…、＜Mn＞2；第二参与方PartiOrgan2拥有加密态子模型为：＜M1＞3、＜M2＞3、…、＜Mn＞3，以此类推；404)各参与方在本地累加交换所得的加密态子模型，作为本地加密态联邦入侵检测卷积模型：InitiOrgan：＜M＞1＝＜M1＞1+＜M2＞1+…+＜Mn＞1PartiOrgan1：＜M＞2＝＜M1＞2+＜M2＞2+…+＜Mn＞2…PartiOrgann-1：＜M＞n＝＜M1＞n+＜M2＞n+…+＜Mn＞n其中，＜M＞1为发起者InitiOrgan经累加交换所得的加密态子模型，作为本地加密态联邦入侵检测卷积模型、＜M＞2为第一参与方PartiOrgan1经累加交换所得的本地加密态联邦入侵检测卷积模型、＜M＞3为第二参与方PartiOrgan2经累加交换所得的本地加密态联邦入侵检测卷积模型，以此类推。5.根据权利要求1所述的基于联邦学习的网络入侵协同检测方法，其特征在于：在步骤6)中，所述加密态联邦模型增量加权平均的计算公式如下：其中，GloModelt表示第t轮协调方下发的全局联邦入侵检测卷积模型；表示第i个参与方第t轮训练后得到的本地加密态模型；表示本轮本地加密态模型参数与本轮全局初始联邦入侵检测卷积模型参数的差值，其值作为本轮参与方上传的模型参数增量；N表示参与本轮全局迭代的参与方个数。6.根据权利要求1所述的基于联邦学习的网络入侵协同检测方法，其特征在于：在步骤8)中，所述发起者InitiOrgan对全局联邦入侵检测卷积模型进行仲裁的方法是：801)发起者InitiOrgan收到协调方下发的全局联邦入侵检测卷积模型后，首先冻结非卷积感知层的节点，再向前蔓延求出仲裁函数的仲裁损失值；802)发起者InitiOrgan记录仲裁损失值，并根据仲裁损失值来判断仲裁函数的收敛状态：具体步骤如下：80201)经多次全局批次训练后，若仲裁损失值未下降反而增大，发起者InitiOrgan请求协调方终止联邦学习，并重新协商新的参数信息；80202)经多次全局批次训练后，若仲裁损失值仍处于下降状态，发起者InitiOrgan不作处理；80203)经多次全局批次训练后，若仲裁损失值已达到收敛状态，发起者InitiOrgan请求协调方终止联邦学习，并把最后一次下发的全局联邦入侵检测卷积模型作为联邦学习的结果。
说明书desc
技术领域本发明属于网络入侵检测技术领域，特别是涉及一种基于联邦学习的网络入侵协同检测方法。背景技术近年来，随着大数据应用的普及，网络已经成为了人人皆知、人人皆用的工具之一，网络用户数量的爆发性增长，也带来了网络流量呈指数级别的增加，但随之而来的是网络安全问题变得日益严峻。网络入侵检测系统作为网络安全重要组成部分，一直以来都是网络安全技术领域研究的热点。传统的网络入侵检测技术主要以单点式样本训练方法为主，但面对如今复杂多变的网络环境，单点式训练存在以下问题：可用样本数量受限：对于收集恶意攻击样本的单个机构来说，所能标记的带标签的样本数量是有限的，这就导致了样本数量不够，尤其是恶意样本数，因此在实际应用中，入侵检测模型易产生大量误报告警，从而淹没了真实的攻击告警。恶意样本形式多变：恶意攻击的手段和方式多种多样，而每个机构所收集的恶意样本也不尽相同，仅凭一个机构训练的模型对于某类恶意攻击具有局限性，不能很好地适应复杂的现实环境。机构间存在数据孤岛：随着网络安全法的完善，本机构的数据不能随意出库，不能随意明文使用，这导致了机构间产生数据孤岛，如何在不泄露数据的情况下使用数据成为了一个很棘手的问题。发明内容为了解决上述问题，本发明的目的在于提供一种基于联邦学习的网络入侵协同检测方法。为了达到上述目的，本发明提供的基于联邦学习的网络入侵协同检测方法包括按顺序进行的下列步骤：1)发起者InitiOrgan作为联邦学习的N个参与方之一，参与联邦入侵检测卷积模型的训练和仲裁；其它参与方PartiOrgan包括第一参与方PartiOrgan1至第N-1参与方PartiOrgann-1，只参与联邦入侵检测卷积模型的训练；首先发起者InitiOrgan向协调方发起联邦学习的请求，并由发起者InitiOrgan根据自身需求与协调方共同决定与联邦入侵检测卷积模型相关的参数信息；2)协调方将相关的参数信息下发给本地联邦入侵检测卷积模型的各参与方；3)各参与方获得参数信息后，根据参数信息初始化本地联邦入侵检测卷积模型而获得本地初始联邦入侵检测卷积模型，然后将本地所拥有的入侵检测库传入各自的本地初始联邦入侵检测卷积模型进行训练，得到一个更新的本地联邦入侵检测卷积模型；4)各参与方完成一轮本地联邦入侵检测卷积模型更新后，采用加密态子模型拆分与融合算法，将更新的本地联邦入侵检测卷积模型拆分成N个加密态子模型，并与其它参与方交换各个加密态子模型，最后各参与方累加交换所得的加密态子模型，作为本地加密态联邦入侵检测卷积模型；5)各参与方将各自的本地加密态联邦入侵检测卷积模型上传到协调方；6)协调方将各参与方上传的本地加密态联邦入侵检测卷积模型进行加密态联邦模型增量加权平均，得到一个全局联邦入侵检测卷积模型；7)协调方将全局联邦入侵检测卷积模型下发给各个参与方；8)其它参与方PartiOrgan利用本地入侵检测库继续训练全局联邦入侵检测卷积模型；发起者InitiOrgan将本地入侵检测库按9：1的比例对上述全局联邦入侵检测卷积模型进行训练和仲裁，仲裁函数采用联邦多标签熵损失函数，并根据仲裁函数的收敛状态向协调方反馈联邦学习情况。在步骤1)中，所述参数信息包括：101)算法选择：联邦学习选用的算法；102)数据处理方法：各本地入侵检测库数据预处理方法；103)隐私保护方法：上传更新的联邦入侵检测卷积模型所用的加密方式；104)参与方个数：联邦入侵检测卷积模型训练的参与方总数；105)全局轮次：全局联邦入侵检测卷积模型训练最大轮次；106)本地轮次：单轮次各参与方所训练的次数；107)共享批次大小：协调方指定各参与方同用的批次大小；108)参与方比率：单轮次随机选择的参与方比例；109)节点更新法：更新联邦入侵检测卷积模型节点参数选用的方法；110)共享学习率：协调方指定的各参与方同用的学习率大小；111)共享动量：协调方指定的各参与方同用的动量大小。在步骤3)中，所述训练方法如下：301)各参与方对本地所拥有的入侵检测库进行数据预处理，包括标准化处理和将特征矩阵转化成CNN像素矩阵；302)利用本地批次大小对预处理后的入侵检测库进行分批处理并打乱顺序；然后参与方利用协调方下发的全局初始联邦入侵检测卷积模型构建本地初始联邦入侵检测卷积模型；之后各参与方在本地对本地初始联邦入侵检测卷积模型训练E个轮次以更新模型参数；303)本地初始联邦入侵检测卷积模型向前蔓延计算各节点参数，然后采用联邦多标签熵损失函数计算模型参数的损失值MultiLabelLoss，公式如下：其中，i表示样本；N表示样本总数；MCOORDI表示由协调方选择的训练任务的标签类别数量；表示样本和标签类别的符号函数，若样本i的标签类别与标签类别c相同，则样本i的符号函数值为1，否则为0；predSoftmaxci表示样本i对于标签类别c的预测概率值；304)模型反向蔓延，计算模型参数的损失值MultiLabelLoss对各个神经元节点参数的偏导值，求解偏导值的方法是采用联邦共享动量SGD算法，并利用偏导值大小更新节点参数，其中联邦共享动量SGD的计算公式为：其中，mavgt为节点参数在共享动量shareMomen的条件下，第t次本地轮次的动量平均值；共享动量shareMomen为协调方所指定的联邦共享动量SGD；为第t次本地轮次的模型参数的损失值MultiLabelLoss对节点参数的偏导值；shareLR为联邦入侵检测卷积模型的共享学习率；为第t次本地轮次的节点参数更新值；305)反复计算模型参数的损失值MultiLabelLoss和偏导值直至训练的本地批次数达到最大。在步骤4)中，所述各参与方完成一轮本地联邦入侵检测卷积模型更新后，采用加密态子模型拆分与融合算法，将更新的本地联邦入侵检测卷积模型拆分成N个加密态子模型，并与其它参与方交换各个加密态子模型，最后各参与方累加交换所得的加密态子模型，作为本地加密态联邦入侵检测卷积模型的具体步骤如下：401)发起者InitiOrgan拥有更新的本地联邦入侵检测卷积模型M1、第一参与方PartiOrgan1拥有更新的本地联邦入侵检测卷积模型M2、…、第N-1参与方PartiOrgann-1拥有更新的本地联邦入侵检测卷积模型Mn；402)发起者InitiOrgan取N-1个随机算子，分别为Rm2、Rm3、…、Rmn，然后计算出下列N个加密态子模型：＜M1＞2＝Rm2＜M1＞3＝Rm3……＜M1＞n＝Rmn＜M1＞1＝M1-＜M1＞2-＜M1＞3-…-＜M1＞n其中＜·＞表示加密态子模型拆分与融合算法中的加密态密文；403)发起者InitiOrgan将加密态子模型＜M1＞2转发给第一参与方PartiOrgan1，将加密态子模型＜M1＞3转发给第二参与方PartiOrgan2，以此类推；同上，第一参与方PartiOrgan1和第二参与方PartiOrgan2均执行与发起者InitiOrgan相同的操作，并向其它参与方转发加密态子模型；一次转发后，发起者InitiOrgan拥有加密态子模型为：＜M1＞1、＜M2＞1、…、＜Mn＞1；第一参与方PartiOrgan1拥有加密态子模型为：＜M1＞2、＜M2＞2、…、＜Mn＞2；第二参与方PartiOrgan2拥有加密态子模型为：＜M1＞3、＜M2＞3、…、＜Mn＞3，以此类推；404)各参与方在本地累加交换所得的加密态子模型，作为本地加密态联邦入侵检测卷积模型：InitiOrgan：＜M＞1＝＜M1＞1+＜M2＞1+…+＜Mn＞1PartiOrgan1：＜M＞2＝＜M1＞2+＜M2＞2+…+＜Mn＞2…PartiOrgann-1：＜M＞n＝＜M1＞n+＜M2＞n+…+＜Mn＞n其中，＜M＞1为发起者InitiOrgan经累加交换所得的加密态子模型，作为本地加密态联邦入侵检测卷积模型、＜M＞2为第一参与方PartiOrgan1经累加交换所得的本地加密态联邦入侵检测卷积模型、＜M＞3为第二参与方PartiOrgan2经累加交换所得的本地加密态联邦入侵检测卷积模型，以此类推。在步骤6)中，所述加密态联邦模型增量加权平均的计算公式如下：其中，GloModelt表示第t轮协调方下发的全局联邦入侵检测卷积模型；表示第i个参与方第t轮训练后得到的本地加密态模型；表示本轮本地加密态模型参数与本轮全局初始联邦入侵检测卷积模型参数的差值，其值作为本轮参与方上传的模型参数增量；N表示参与本轮全局迭代的参与方个数。在步骤8)中，所述发起者InitiOrgan对全局联邦入侵检测卷积模型进行仲裁的方法是：801)发起者InitiOrgan收到协调方下发的全局联邦入侵检测卷积模型后，首先冻结非卷积感知层的节点，再向前蔓延求出仲裁函数的仲裁损失值；802)发起者InitiOrgan记录仲裁损失值，并根据仲裁损失值来判断仲裁函数的收敛状态：具体步骤如下：80201)经多次全局批次训练后，若仲裁损失值未下降反而增大，发起者InitiOrgan请求协调方终止联邦学习，并重新协商新的参数信息；80202)经多次全局批次训练后，若仲裁损失值仍处于下降状态，发起者InitiOrgan不作处理；80203)经多次全局批次训练后，若仲裁损失值已达到收敛状态，发起者InitiOrgan请求协调方终止联邦学习，并把最后一次下发的全局联邦入侵检测卷积模型作为联邦学习的结果。本发明提供的基于联邦学习的网络入侵协同检测方法具有如下有益效果：与传统方法由协调方完全控制联邦学习流程不同，本方法中联邦学习的发起者与协调方共建横向联邦学习任务，所训练的联邦入侵检测卷积模型更切合自身的业务需求。联邦学习任务采用联邦模型增量平均聚合函数，可使联邦学习的效率提升。各参与方上传模型采用加密态联邦入侵检测卷积模型，可防止半诚实的参与方对其他参与方的模型反演攻击。由联邦学习的发起者进行仲裁，保护了入侵检测库不被协调方获取，可保证模型参数端到端的安全性，旨在增强模型健壮性。附图说明图1为本发明提供的基于联邦学习的网络入侵协同检测方法流程图。图2为本发明中各参与方进行本地初始联邦入侵检测卷积模型训练流程图。图3为本发明中N个参与方加密态子模型拆分与融合算法流程图。图4为本发明中全局联邦入侵检测卷积模型仲裁流程图。具体实施方式下面结合附图和具体实施例对本发明进行详细说明。如图1所示，本发明提供的基于联邦学习的网络入侵协同检测方法包括按顺序进行的下列步骤：1)发起者InitiOrgan作为联邦学习的N个参与方之一，参与联邦入侵检测卷积模型的训练和仲裁；其它参与方PartiOrgan包括第一参与方PartiOrgan1至第N-1参与方PartiOrgann-1，只参与联邦入侵检测卷积模型的训练；首先发起者InitiOrgan向协调方发起联邦学习的请求，并由发起者InitiOrgan根据自身需求与协调方共同决定与联邦入侵检测卷积模型相关的参数信息；本发明方法适用于多机构之间的横向联邦学习，协调方并没有完整的权力决定与联邦学习相关的参数信息，协调方由聚合服务器承担，主要任务是下发初始的联邦入侵检测卷积模型和接收更新的联邦入侵检测卷积模型，并进行联邦入侵检测卷积模型的增量加权平均，并由协调方决定哪些参与方有权参与单次训练轮次。所述参数信息包括：101)算法选择：联邦学习选用的算法。102)数据处理方法：各本地入侵检测库数据预处理方法，本方法中采用了标准化处理方法和CNN像素矩阵转化方法。103)隐私保护方法：上传更新的联邦入侵检测卷积模型所用的加密方式。104)参与方个数：联邦入侵检测卷积模型训练的参与方总数。105)全局轮次：全局联邦入侵检测卷积模型训练最大轮次。106)本地轮次：单轮次各参与方所训练的次数。107)共享批次大小：协调方指定各参与方同用的批次大小。108)参与方比率：单轮次随机选择的参与方比例。109)节点更新法：更新联邦入侵检测卷积模型节点参数选用的方法。110)共享学习率：协调方指定的各参与方同用的学习率大小。111)共享动量：协调方指定的各参与方同用的动量大小。2)协调方将相关的参数信息下发给本地联邦入侵检测卷积模型的各参与方；3)各参与方获得参数信息后，根据参数信息初始化本地联邦入侵检测卷积模型而获得本地初始联邦入侵检测卷积模型，然后将本地所拥有的入侵检测库传入各自的本地初始联邦入侵检测卷积模型进行训练，得到一个更新的本地联邦入侵检测卷积模型；如图2所示，所述训练方法如下：301)各参与方对本地所拥有的入侵检测库进行数据预处理，包括标准化处理和将特征矩阵转化成CNN像素矩阵，其中CNN像素矩阵的维数根据入侵检测库中特征的数量确定，本发明中入侵检测库包含41个特征，故将特征矩阵转化成CNN像素矩阵时，CNN像素矩阵的维数为7*7；302)利用本地批次大小对预处理后的入侵检测库进行分批处理并打乱顺序；然后参与方利用协调方下发的全局初始联邦入侵检测卷积模型构建本地初始联邦入侵检测卷积模型；之后各参与方在本地对本地初始联邦入侵检测卷积模型训练E个轮次以更新模型参数；303)本地初始联邦入侵检测卷积模型向前蔓延计算各节点参数，然后采用联邦多标签熵损失函数计算模型参数的损失值MultiLabelLoss，公式如下：其中，i表示样本；N表示样本总数；MCOORDI表示由协调方选择的训练任务的标签类别数量；表示样本和标签类别的符号函数，若样本i的标签类别与标签类别c相同，则样本i的符号函数值为1，否则为0；predSoftmaxci表示样本i对于标签类别c的预测概率值；304)模型反向蔓延，计算模型参数的损失值MultiLabelLoss对各个神经元节点参数的偏导值，本发明求解偏导值的方法是采用联邦共享动量SGD算法，并利用偏导值大小更新节点参数，其中联邦共享动量SGD的计算公式为：其中，mavgt为节点参数在共享动量shareMomen的条件下，第t次本地轮次的动量平均值；共享动量shareMomen为协调方所指定的联邦共享动量SGD；为第t次本地轮次的模型参数的损失值MultiLabelLoss对节点参数的偏导值；shareLR为联邦入侵检测卷积模型的共享学习率；为第t次本地轮次的节点参数更新值；305)反复计算模型参数的损失值MultiLabelLoss和偏导值直至训练的本地批次数达到最大。4)各参与方完成一轮本地联邦入侵检测卷积模型更新后，采用加密态子模型拆分与融合算法，将更新的本地联邦入侵检测卷积模型拆分成N个加密态子模型，并与其它参与方交换各个加密态子模型，最后各参与方累加交换所得的加密态子模型，作为本地加密态联邦入侵检测卷积模型；如图3所示，具体步骤如下：401)发起者InitiOrgan拥有更新的本地联邦入侵检测卷积模型M1、第一参与方PartiOrgan1拥有更新的本地联邦入侵检测卷积模型M2、…、第N-1参与方PartiOrgann-1拥有更新的本地联邦入侵检测卷积模型Mn；402)发起者InitiOrgan取N-1个随机算子，分别为Rm2、Rm3、…、Rmn，然后计算出下列N个加密态子模型：＜M1＞2＝Rm2＜M1＞3＝Rm3……＜M1＞n＝Rmn＜M1＞1＝M1-＜M1＞2-＜M1＞3-…-＜M1＞n其中＜·＞表示加密态子模型拆分与融合算法中的加密态密文；403)发起者InitiOrgan将加密态子模型＜M1＞2转发给第一参与方PartiOrgan1，将加密态子模型＜M1＞3转发给第二参与方PartiOrgan2，以此类推；同上，第一参与方PartiOrgan1和第二参与方PartiOrgan2均执行与发起者InitiOrgan相同的操作，并向其它参与方转发加密态子模型；一次转发后，发起者InitiOrgan拥有加密态子模型为：＜M1＞1、＜M2＞1、…、＜Mn＞1；第一参与方PartiOrgan1拥有加密态子模型为：＜M1＞2、＜M2＞2、…、＜Mn＞2；第二参与方PartiOrgan2拥有加密态子模型为：＜M1＞3、＜M2＞3、…、＜Mn＞3，以此类推；404)各参与方在本地累加交换所得的加密态子模型，作为本地加密态联邦入侵检测卷积模型：InitiOrgan：＜M＞1＝＜M1＞1+＜M2＞1+…+＜Mn＞1PartiOrgan1：＜M＞2＝＜M1＞2+＜M2＞2+…+＜Mn＞2…PartiOrgann-1：＜M＞n＝＜M1＞n+＜M2＞n+…+＜Mn＞n其中，＜M＞1为发起者InitiOrgan经累加交换所得的加密态子模型，作为本地加密态联邦入侵检测卷积模型、＜M＞2为第一参与方PartiOrgan1经累加交换所得的本地加密态联邦入侵检测卷积模型、＜M＞3为第二参与方PartiOrgan2经累加交换所得的本地加密态联邦入侵检测卷积模型，以此类推。5)各参与方将各自的本地加密态联邦入侵检测卷积模型上传到协调方；6)协调方将各参与方上传的本地加密态联邦入侵检测卷积模型进行加密态联邦模型增量加权平均，得到一个全局联邦入侵检测卷积模型；所述加密态联邦模型增量加权平均的计算公式如下：其中，GloModelt表示第t轮协调方下发的全局联邦入侵检测卷积模型；表示第i个参与方第t轮训练后得到的本地加密态模型；表示本轮本地加密态模型参数与本轮全局初始联邦入侵检测卷积模型参数的差值，其值作为本轮参与方上传的模型参数增量；N表示参与本轮全局迭代的参与方个数；7)协调方将全局联邦入侵检测卷积模型下发给各个参与方；8)其它参与方PartiOrgan利用本地入侵检测库继续训练全局联邦入侵检测卷积模型；发起者InitiOrgan将本地入侵检测库按9：1的比例对上述全局联邦入侵检测卷积模型进行训练和仲裁，仲裁函数采用联邦多标签熵损失函数，并根据仲裁函数的收敛状态向协调方反馈联邦学习情况。如图4所示，所述发起者InitiOrgan对全局联邦入侵检测卷积模型进行仲裁的方法是：801)发起者InitiOrgan收到协调方下发的全局联邦入侵检测卷积模型后，首先冻结非卷积感知层的节点，再向前蔓延求出仲裁函数的仲裁损失值；802)发起者InitiOrgan记录仲裁损失值，并根据仲裁损失值来判断仲裁函数的收敛状态：具体步骤如下：80201)经多次全局批次训练后，若仲裁损失值未下降反而增大，发起者InitiOrgan请求协调方终止联邦学习，并重新协商新的参数信息；80202)经多次全局批次训练后，若仲裁损失值仍处于下降状态，发起者InitiOrgan不作处理；80203)经多次全局批次训练后，若仲裁损失值已达到收敛状态，发起者InitiOrgan请求协调方终止联邦学习，并把最后一次下发的全局联邦入侵检测卷积模型作为联邦学习的结果。
