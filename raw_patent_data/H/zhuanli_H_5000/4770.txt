标题title
一种Tbox裁决方法及装置
摘要abst
本发明公开了一种Tbox裁决方法及装置，其中Tbox裁决方法包括：接收多个执行体下发的携带更新消息的CAN报文；将对应执行体的CAN报文与协议信息一起封装成Tbox更新事件消息，并送入裁决队列；确定多个执行体的通信流水号是否一致，如果不一致，将流水号最小的元素移出队列，如果一致，则对所述CAN报文进行裁决；根据裁决结果确定所述CAN报文是否为异常表项；该Tbox裁决方法仅可以通过异常CAN报文发现攻击者的篡改Tbox数据行为，抵御基于CAN协议软件漏洞或后门实施的攻击，还满足了Tbox对实时性和可靠性的要求，并支持多种Tbox裁决模式，可以根据需求进行相应配置。
权利要求书clms
1.一种Tbox裁决方法，其特征在于，包括：接收多个执行体下发的携带业务信息的CAN报文；将对应执行体的CAN报文与协议信息一起封装成Tbox更新事件消息，并送入裁决队列；其中，所述协议信息包括通信流水号；确定多个执行体的通信流水号是否一致，如果不一致，将流水号最小的元素移出队列，如果一致，则对所述CAN报文进行裁决；根据裁决结果确定所述CAN报文是否为异常表项，若是则修改对应执行体的可信程度并修正该执行体配置的权重，重新裁决，否则输出裁决结果。2.根据权利要求1所述的Tbox裁决方法，其特征在于：所述协议信息还包括执行体标识id、业务消息id、时间戳和裁决数据长度中的一项或多项。3.根据权利要求1所述的Tbox裁决方法，其特征在于：在将对应执行体的CAN报文与协议信息一起封装成Tbox更新事件消息的同时判断是否开启了Tbox特权模式，如果开启，则根据所述CAN报文生成更新指令，并下发到Tbox的输出接口，Tbox的输出接口下发至各个ECU执行。4.根据权利要求1所述的Tbox裁决方法，其特征在于，在根据裁决结果确定所述CAN报文是为异常表项时，判断所述CAN报文是否属于Tbox特权模式，若是则根据异常CAN报文的内容来实施相应的恢复方案。5.根据权利要求4所述的Tbox裁决方法，其特征在于：根据异常CAN报文的内容来实施相应的恢复方案，进一步包括：若异常CAN报文的内容是添加新配置，则恢复方案为从输出接口删除该配置；若异常CAN报文的内容是更新配置，则恢复方案是先从输出接口删除该配置，然后从Tbox回收缓存中搜索原先的配置并将其下发到输出接口；若异常CAN报文的内容是删除配置，则从Tbox回收缓存中搜索原先的配置并重新将其下发到输出接口。6.根据权利要求1所述的Tbox裁决方法，其特征在于：对所述CAN报文进行裁决进一步包括：根据自适应一致性表决算法对所述CAN报文进行裁决，票数多的Tbox表项将为裁决结果。7.根据权利要求6所述的Tbox裁决方法，其特征在于：若票数相同，根据执行体的历史裁决结果或可信度因素进行加权处理后再进行二次裁决。8.一种Tbox裁决装置，其特征在于，包括：接收单元，用于接收多个执行体下发的携带更新消息的CAN报文；封装单元，将对应执行体的CAN报文与协议信息一起封装成Tbox更新事件消息，并送入裁决队列；其中，所述协议信息包括通信流水号；裁决单元，用于确定多个执行体的通信流水号是否一致，如果不一致，将流水号最小的元素移出队列，如果一致，则对所述CAN报文进行裁决；修正单元，用于根据裁决结果确定所述CAN报文是否为异常表项，若是则修改对应执行体的可信程度并修正该执行体配置的权重，重新裁决，否则输出裁决结果。9.根据权利要求8所述的Tbox裁决装置，其特征在于，还包括：判断单元，用于判断是否开启了Tbox特权模式，如果开启，则根据所述CAN报文生成更新指令，并下发到Tbox的输出接口，Tbox的输出接口下发至各个ECU执行。10.根据权利要求8所述的Tbox裁决装置，其特征在于，在根据裁决结果确定所述CAN报文是为异常表项时，判断所述CAN报文是否属于Tbox特权模式，若是则根据异常CAN报文的内容来实施相应的恢复方案。11.根据权利要求10所述的Tbox裁决装置，其特征在于：根据异常CAN报文的内容来实施相应的恢复方案，进一步包括：若异常CAN报文的内容是添加新配置，则恢复方案为从输出接口删除该配置；若异常CAN报文的内容是更新配置，则恢复方案是先从输出接口删除该配置，然后从Tbox回收缓存中搜索原先的配置并将其下发到输出接口；若异常CAN报文的内容是删除配置，则从Tbox回收缓存中搜索原先的配置并重新将其下发到输出接口。12.根据权利要求8所述的Tbox裁决装置，其特征在于：对所述CAN报文进行裁决进一步包括：根据自适应一致性表决算法对所述CAN报文进行裁决，票数多的Tbox表项将为裁决结果。13.根据权利要求12所述的Tbox裁决装置，其特征在于：若票数相同，根据执行体的历史裁决结果或可信度因素进行加权处理后再进行二次裁决。14.一种计算机可读存储介质，所述计算机可读存储介质存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现如权利要求1至7任一项所述的一种Tbox裁决方法的步骤。
说明书desc
技术领域本发明涉及网络通信系统技术领域，更具体地说，涉及一种Tbox裁决方法及装置。背景技术Telematics BOX，简称为Tbox，作为车联网的重要组成部分，Tbox被装载到车机上，可以通过CANBUS与车辆进行双向通信，不仅仅可以获取车辆的如车速、油耗、胎压、电池电压等状态信息，而且可以对车辆实现远程控制，例如远程开关车门、启停发动机、寻车以及开关空调功能。Tbox是车辆用于同外界通信的最为关键的部分，传统的车辆只是作为代步的工具。随着科技的不断进步以及人们生活意识的提高，车辆越来越多的被要求具有智能化、互联化。Tbox可深度读取汽车CAN总线数据和私有协议，通过无线网络将数据传到云服务器，其中的微控制单元主要负责整车CAN网络数据与处理和信息上传以及远程升级等功能。与一般的通信总线相比，CAN总线的数据通信具有突出的可靠性、实时性和灵活性，因此广泛应用于汽车领域。CAN报文采用短帧结构，每一帧的有效字节数为8个，且每帧信息都有CRC校验以及其他校验措施，这使得其数据出错率极低。然而，Tbox的关键作用意味着一旦发生网络空间安全威胁，其影响和造成的后果也是难以想象的。网络空间安全威胁的根源是不可避免的系统漏洞。人为设计的信息处理系统很难避免设计与实现方面的缺陷和错误导致的“暗功能”，但是迄今一直未能找到穷尽漏洞的形式化检查方法。现有的技术要么无法检测到Tbox的漏洞问题，要么检测的过程会影响Tbox的正常使用，大大的降低了Tbox的可靠性以及实时性。发明内容为了解决上述问题，本发明提供一种实时性和可靠性高而且并支持多种Tbox裁决模式的Tbox裁决方法及装置。为了实现上述目的，本发明一方面提供一种Tbox裁决方法，包括：接收多个执行体下发的携带更新消息的CAN报文；将对应执行体的CAN报文与协议信息一起封装成Tbox更新事件消息，并送入裁决队列；其中，所述协议信息包括通信流水号；确定多个执行体的通信流水号是否一致，如果不一致，将流水号最小的元素移出队列，如果一致，则对所述CAN报文进行裁决；根据裁决结果确定所述CAN报文是否为异常表项，若是则修改对应执行体的可信程度并修正该执行体配置的权重，重新裁决，否则输出裁决结果。作为优选的一种技术方案，所述协议信息还包括执行体标识id、业务消息id、时间戳和裁决数据长度中的一项或多项。作为优选的一种技术方案，在将对应执行体的CAN报文与协议信息一起封装成Tbox更新事件消息的同时判断是否开启了Tbox特权模式，如果开启，则根据所述CAN报文生成更新指令，并下发到Tbox的输出接口，Tbox的输出接口下发至各个ECU执行。作为优选的一种技术方案，在根据裁决结果确定所述CAN报文是为异常表项时，判断所述CAN报文是否属于Tbox特权模式，若是则根据异常CAN报文的内容来实施相应的恢复方案。作为优选的一种技术方案，根据异常CAN报文的内容来实施相应的恢复方案，进一步包括：若异常CAN报文的内容是添加新配置，则恢复方案为从输出接口删除该配置；若异常CAN报文的内容是更新配置，则恢复方案是先从输出接口删除该配置，然后从Tbox回收缓存中搜索原先的配置并将其下发到输出接口；若异常CAN报文的内容是删除配置，则从Tbox回收缓存中搜索原先的配置并重新将其下发到输出接口。作为优选的一种技术方案，对所述CAN报文进行裁决进一步包括：根据自适应一致性表决算法对所述CAN报文进行裁决，票数多的Tbox表项将为裁决结果；若票数相同，根据执行体的历史裁决结果或可信度因素进行加权处理后再进行二次裁决。作为优选的一种技术方案，在确定所述CAN报文是否有误之前还包括：从所述Tbox更新事件消息中提取通信流水号，比较所述裁决队列中多个执行体的通信流水号是否一致，如果不一致，将流水号最小的元素移出队列，如果一致则执行下一步。另一方面，本发明还提供一种Tbox裁决装置，包括：接收单元，用于接收多个执行体下发的携带更新消息的CAN报文；封装单元，用于将对应执行体的CAN报文与协议信息一起封装成Tbox更新事件消息，并送入裁决队列；其中，所述协议信息包括通信流水号；裁决单元，用于确定多个执行体的通信流水号是否一致，如果不一致，将流水号最小的元素移出队列，如果一致，则对所述CAN报文进行裁决；修正单元，用于根据裁决结果确定所述CAN报文是否为异常表项，若是则修改对应执行体的可信程度并修正该执行体配置的权重，重新裁决，否则输出裁决结果。本发明相对于现有技术的有益效果是：该Tbox裁决方法通过比对各个执行体下发的CAN报文中的携带的通信流水号，从而判断CAN报文为异常表项，当发现对应的CAN报文为异常表现，则修改对应执行体的可信程度，同时修正该执行体配置的权重，这样可以通过异常CAN报文发现攻击者的篡改Tbox数据行为，抵御基于CAN协议软件漏洞或后门实施的攻击，还满足了Tbox对实时性和可靠性的要求，并支持多种Tbox裁决模式，可以根据需求进行相应配置。附图说明图1是本发明提供的一种Tbox裁决方法的流程图；图2是本发明提供的一种Tbox裁决装置的结构图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅是本发明的一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。参照图1，本实施例提供一种Tbox裁决方法，包括以下步骤：S10：接收多个执行体下发的携带更新消息的CAN报文；在此需要说明的是，Tbox执行体是一套能够独立实现CAN报文解析和与调度模块交互的集合，Tbox执行体解析之后的数据包需要经过裁决后才能下发到Tbox输出接口。Tbox执行体接口是Tbox执行体将更新的CAN报文按照特定格式通告给裁决装置的消息接口。应当理解的是，CAN报文帧类型包括数据帧，远程帧，错误帧和过载帧。标准帧包含11位标识符，扩展帧包含29位标识符。裁决的CAN报文主要是数据帧，数据帧携带着从发送器至接收器的数据。数据帧由7个不同的位场组成，即帧起始、仲裁场、控制场、数据场、CRC场、应答场和帧结束。其中帧起始和帧结束用于标识帧的起止点；仲裁场、控制场、CRC场、应答场用于控制和校验；数据场包含接收器需要的数据。S20：将对应执行体的CAN报文与协议信息一起封装成Tbox更新事件消息，并送入裁决队列；其中，所述协议信息包括通信流水号；具体的，Tbox执行体接口接收到Tbox更新消息后，将其连同执行体标识id、通信流水号、业务消息id、时间戳和裁决数据长度等信息封装成一次Tbox更新事件消息，并送入裁决队列。在此需要说明的是，由于各个Tbox执行体通告CAN报文时会存在一定的时间差，也可能出现丢包等异常情况，因此裁决装置在收到Tbox更新事件消息后，要将该消息先送入待裁决队列进行缓存，在满足特定条件后再送入表决器进行Tbox裁决。在待裁决队列中，每一个元素的索引是Tbox更新事件消息的通信流水号，每个元素值包含了来源于多个执行体Tbox更新事件消息。在一些实施例中，在将对应执行体的CAN报文与业务信息一起封装成一次Tbox更新事件消息的同时判断是否开启了Tbox特权模式，如果开启，则根据所述CAN报文生成更新指令，并下发到Tbox的输出接口，Tbox的输出接口下发至各个ECU执行，若没有开启则执行步骤S30。在此需要说明的是，由于汽车对某些操作的时效性要求很高，Tbox特权模式指的是Tbox执行体接口一旦收到一个特定的新的Tbox更新事件后，将立即将其下发到Tbox输出接口，同时将其送入待裁决队列。如果判定这次Tbox更新事件中的裁决数据项为异常，则要对该裁决结果进行修正。对于一些QoS敏感度高，时延敏感度高且不涉及安全的业务，可以选择特权模式先下发至输出接口再进行裁决，例如音乐，视频等。而安全性高的业务，则必须经过裁决，保障生命安全。符合Tbox特权模式的资格需要人为提前确定，根据CAN报文的业务消息id来确定。S30：确定多个执行体的通信流水号是否一致，如果不一致，将流水号最小的元素移出队列，如果一致，则对所述CAN报文进行裁决；具体的，首先从更新事件消息中提取通信流水号，从多个执行体队列中比较通信流水号是否一致。如果不一致，将流水号最小的元素移出队列，并记录其流水号，执行体id和业务消息id等信息。如果一致，则检测队列的消息是否有误。如果有误，则将结果上报给执行体调度模块并下发到Tbox输出接口，如果无误，则将N个相应的元素出队列到裁决装置进行表决。应当说明的是，表决按照自适应一致性表决算法进行，票数多的Tbox表项将被作为裁决结果。若票数相同，可根据执行体的历史裁决结果或可信度等因素进行加权处理后再进行二次裁决。S40：根据裁决结果确定所述CAN报文是否为异常表项，若是则修改对应执行体的可信程度并修正该执行体配置的权重，重新裁决，否则输出裁决结果。具体的，通过比对了通信流水号和业务消息id相同的各个CAN报文的信息。一旦通过比对发现了某个CAN报文的裁决数据与其他不一致，则认定该条CAN报文为异常表项，并将该条Tbox连同其来源信息上报给执行体调度模块，并将错误信息下发给Tbox输出接口。如果某条CAN报文中来自执行体的异常检测结果异常，则修改对应执行体的可信程度，修正该执行体配置的权重。在一些实施例中，如果裁决流程通过表决发现一条异常裁决数据，则检查该数据的业务数据id是否属于Tbox特权模式，如果是该模式，且异常裁决数据已经被下发给输出接口，则发起纠正流程。该流程首先根据异常CAN报文的内容来实施相应的恢复方案。如果内容是添加新配置，则恢复方案为从输出接口删除该配置；如果动作是更新配置，则恢复方案是先从输出接口删除该配置，然后从Tbox回收缓存中搜索原先的配置并将其下发到输出接口；如果动作是删除配置，则从Tbox回收缓存中搜索原先的配置并重新将其下发到输出接口。最后，裁决流程完成后，被裁决的元素将从待裁决队列中进行清除，然后重置裁决定时器，启动下一个裁决周期。该Tbox裁决方法通过比对通信流水号和业务消息id相同的各个CAN报文的信息，从而判断CAN报文为异常表项，并修改对应执行体的可信程度，同时修正该执行体配置的权重，不仅可以通过异常CAN报文发现攻击者的篡改Tbox数据行为，抵御基于CAN协议软件漏洞或后门实施的攻击，还满足了Tbox对实时性和可靠性的要求，并支持多种Tbox裁决模式，可以根据需求进行相应配置。参照图2，本实施例还提供一种Tbox裁决装置，包括：接收单元100，用于接收多个执行体下发的携带更新消息的CAN报文；在此需要说的是，由于具体的接收方式以及过程在上述实施例中所记载的Tbox裁决方法的步骤S10中已经详细阐述，故在此不再赘述。封装单元200，用于将对应执行体的CAN报文与协议信息一起封装成Tbox更新事件消息，并送入裁决队列；其中，所述协议信息包括通信流水号；在此需要说的是，由于具体的封装方式以及过程在上述实施例中所记载的Tbox裁决方法的步骤S20中已经详细阐述，故在此不再赘述。裁决单元300，用于确定多个执行体的通信流水号是否一致，如果不一致，将流水号最小的元素移出队列，如果一致，则对所述CAN报文进行裁决；在此需要说的是，由于具体的裁决方式以及过程在上述实施例中所记载的Tbox裁决方法的步骤S30中已经详细阐述，故在此不再赘述。修正单元400，用于根据裁决结果确定所述CAN报文是否为异常表项，若是则修改对应执行体的可信程度并修正该执行体配置的权重，重新裁决，否则输出裁决结果；在此需要说的是，由于具体的修正方式以及过程在上述实施例中所记载的Tbox裁决方法的步骤S40中已经详细阐述，故在此不再赘述。在另外一实施例中，本发明还提供一种计算机可读存储介质，其中，该计算机可读存储介质可存储有程序，该程序执行时包括上述方法实施例中记载的任何一种Tbox裁决方法的部分或全部步骤。另外，在本发明各个实施例中的各功能单元可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中。上述集成的单元既可以采用硬件的形式实现，也可以采用软件功能单元的形式实现。所述集成的单元如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储器中。基于这样的理解，本发明的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的全部或部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储器中，包括若干指令用以使得一台计算机设备执行本发明各个实施例所述方法的全部或部分步骤。而前述的存储器包括：U盘、只读存储器、随机存取存储器、移动硬盘、磁碟或者光盘等各种可以存储程序代码的介质。本领域普通技术人员可以理解上述实施例的各种方法中的全部或部分步骤是可以通过程序来指令相关的硬件来完成，该程序可以存储于一计算机可读存储器中，存储器可以包括：闪存盘、只读存储器、随机存取器、磁盘或光盘等。以上参照附图描述了根据本发明的实施例的用于对Tbox进行裁决的示例性流程图。应指出的是，以上描述中包括的大量细节仅是对本发明的示例性说明，而不是对本发明的限制。在本发明的其他实施例中，该方法可具有更多、更少或不同的步骤，且各步骤之间的顺序、包含、功能等关系可以与所描述和图示的不同。
