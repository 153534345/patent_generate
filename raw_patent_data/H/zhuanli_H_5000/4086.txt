标题title
一种5G通信系统的TCS开关切换的通用方法
摘要abst
本发明公开了一种5G通信系统的TCS开关切换的通用方法，属于5G通信技术领域，在fdd模式下，由寄存器直接控制开关的管脚；在tdd模式下，先捕捉空口数据帧头的上升沿脉冲，然后根据帧头起始位置，设置计数器计数NR无线帧，根据总体偏移量去设置一个新的脉冲和新的计数器，脉冲确定计数器的起始位置，根据开关的开和关的局部偏移量，分别设置开关的开和关的脉冲，开关的开和关的计数器，脉冲确定计数器的起始位置，然后将开关的开和关的计数器按照符号的长度设置计数器，计数0至279，最后根据函数去判断指示信号的开关状态，并且由开关信号直接控制管脚；本发明解决5G通信系统中tdd子帧配置的多样性以及复杂性。
权利要求书clms
1.一种5G通信系统的TCS开关切换的通用方法，其特征在于：针对频分双工FDD和时分双工TDD两种不同的模式，在频分双工FDD模式下由寄存器去控制信号，信号直接控制管脚，在时分双工TDD模式下由TCS算法去控制信号，实现信号控制管脚，具体包括以下步骤：步骤一、根据10msNR无线帧恢复出来的帧头的起始位置的脉冲timebase_trig_10ms，将其上升沿作为TCS开关切换的起始位置；步骤二、根据步骤一中的timebase_trig_10ms去计数一个完整的10msNR无线帧，即设置一个以timebase_trig_10ms的上升沿为起始位置，由0计数到时钟频率数值减1的计数器timebase_cnt_10ms；步骤三、在步骤二描述的计数器timebase_cnt_10ms里去设置脉冲all_pulse；步骤四、根据步骤三中脉冲all_pulse的上升沿做起始位置，设置一个计数0到时钟频率数值减1的计数器cnt_all_pulse，计数一个完整的10msNR无线帧；步骤五、在步骤四描述的计数器cnt_all_pulse里，根据开关局部偏移量switch_on_offset和switch_off_offset，去设置脉冲on_pulse和off_pulse；步骤六、根据步骤五中的脉冲on_pulse和off_pulse的起始位置去计数10msNR无线帧，即分别设置数0到时钟频率数值减1的计数器cnt_switch_on和cnt_switch_off；步骤七、根据符号symbol的长度，分别划分步骤六中的计数器cnt_switch_on和cnt_switch_off，得到计数器cnt_switch_on_symbol和cnt_switch_off_symbol，即分别去计数0到279，并且将每个符号symbol的起始位置设置脉冲switch_on_symbol_pulse和switch_off_symbol_pulse；步骤八、定义560bit的子帧配比指示信号tdd_symbol_cfg，能够拆解为280个2bit，步骤七中的计数器cnt_switch_on_symbol和cnt_switch_off_symbol的0到279分别对应指示信号tdd_symbol_cfg从低位到高位的280组2bit；步骤九、设置一个2bit的函数，用函数去判断步骤八中计数器cnt_switch_on_symbol和cnt_switch_off_symbol关于指示信号tdd_symbol_cfg的对应关系，然后由逻辑命令，根据开关的所在的上行或者下行链路位置，完成最终开关的切换。2.根据权利要求1所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：所述步骤二具体为：由于数据进入空口后，存在一定的设备时延，所以空口数据的起始位置脉冲timebase_trig_10ms和空口数据的真实起始位置不一定对齐，此时如果需要准确的将TCS开关的起始位置和空口数据的起始位置对齐，开关整体的打开和关闭状态就需要有准确的偏移量all_offset去偏移，如果开关需要提前打开或者关闭，则用十六进制负值表示all_offset，如果开关需要延后打开或者关闭，则用十六进制正值表示all_offset。3.根据权利要求1所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：所述步骤三具体为：根据步骤二中开关整体偏移量all_offset的数值，在步骤二描述的计数器timebase_cnt_10ms里去设置脉冲all_pulse，如果需要将TCS开关整体前提，则将all_offset设置为负值，即在timebase_cnt_10ms计数到单位为赫兹的时钟频率数值-1-十进制的all_offset的位置，设置脉冲all_pulse，如果需要将TCS开关整体延后，则将all_offset设置为正值，即在timebase_cnt_10ms计数到十进制的all_offset的位置设置脉冲all_pulse。4.根据权利要求2所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：虽然偏移量all_offset调节TCS开关整体的位置，但是为了让开关的切换不影响到空口数据，打开和关闭开关还需要调节时延，即调节开关的打开和关闭的上升沿和下降沿的位置；所述开关包括上行链路和下行链路的开关，具体为：射频链路下行数据使能开关，功放开关，射频链路上行数据使能开关和低噪声放大器开关。5.根据权利要求4所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：定义开关的开状态的局部偏移量为switch_on_offset，如果开关需要提前打开，则用十六进制负值表示，如果开关需要延后打开，则用十六进制正值表示；定义开关的关状态的局部偏移量为switch_off_offset，如果开关需要提前关闭，则用十六进制负值表示，如果开关需要延后关闭，则用十六进制正值表示。6.根据权利要求4所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：所述步骤五具体为：根据局部偏移量switch_on_offset和switch_off_offset的数值，在步骤四描述的计数器cnt_all_pulse的相应位置去设置脉冲switch_on_pulse和switch_off_pulse，如果switch_on_offset为负值，在cnt_all_pulse计数到单位为赫兹的时钟频率数值-1-十进制的switch_on_offset的绝对值的位置，设置脉冲switch_on_pulse，如果switch_on_offset为正值，在cnt_all_pulse计数到十进制的switch_on_offset的位置设置脉冲switch_on_pulse；如果switch_off_offset为负值，在cnt_all_pulse计数到单位为赫兹的时钟频率数值-1-十进制的switch_off_offset的绝对值的位置设置脉冲switch_off_pulse，如果switch_off_offset为正值，在cnt_all_pulse计数到十进制的switch_off_offset的位置，设置脉冲switch_off_pulse。7.根据权利要求2所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：所述all_offset调节的偏移量是TCS开关整体的偏移量，即开关的开和关的整体偏移量。8.根据权利要求3所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：由于起始位置的计数器timebase_cnt_10ms是从0开始计数到时钟频率数值减1，所以当偏移量all_offset为负值时，需要全局考虑，即舍弃第一个计数周期产生的不稳定状态，从计数器的第二个计数周期开始计数。9.根据权利要求7所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：由于偏移量all_offset是设置开关整体的偏移量，是设置和空口数据的起始位置对齐的偏移量，而实际的数据会由于设备和FPGA系统延时后，起始位置发生变化，此时需要有局部偏移量switch_on_offset和switch_off_offset去细微调整，用以精确调节打开和关闭开关的上升沿与下降沿和空口数据的位置关系，此时调节范围是整体偏移量all_offset和局部偏移量switch_on_offset与switch_off_offset的叠加；整体和局部偏移量的调节精度：，整体偏移量的调节范围：，X满足：；而局部调节的范围：，x满足：。10.根据权利要求1所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于，步骤七中，每个10msNR无线帧共包含20个时隙，每个时隙包含14个符号，而每个符号0包含cp，长度为4448，符号1至符号13的长度为4384，即需要准确地在符号的起始位置去设置脉冲switch_on_pulse和switch_off_pulse，当第一个脉冲switch_on_pulse和switch_off_pulse的位置在计数器cnt_switch_on和cnt_switch_off数到0的时刻，第二个脉冲switch_on_pulse和switch_off_pulse的位置在计数器cnt_switch_on和cnt_switch_off数到4447的时刻，第三个脉冲switch_on_pulse和switch_off_pulse的位置在计数器cnt_switch_on和cnt_switch_off数到4447+4384的时刻，以此类推一直到第279个脉冲switch_on_pulse和switch_off_pulse都设置完成，即计数器cnt_switch_on和cnt_switch_off将280个符号symbol全部划分完。11.根据权利要求1所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：所述步骤九中，函数的位宽为2bit，判断的是输入的560bit子帧配比指示信号，280个symbol对应的2bit依次对应2bit位宽的函数，即函数需要处理280次。12.根据权利要求1所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：所述步骤九中的函数定义如下，2’b00：上下行链路关闭，2’b01：下行链路打开，2’b10：上行链路打开，2’b11：上下行链路常开。13.根据权利要求12所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：所述步骤九中的判断方法为：定义TCS开关信号的下行开关为dl_switch，当上下行链路关闭时，dl_switch置0；当下行链路打开时，dl_switch置1；当上行链路打开时，dl_switch置0；上下行链路常开时，dl_switch置1；定义TCS开关信号的上行开关为ul_switch，当上下行链路关闭时，ul_switch置0；当下行链路打开时，ul_switch置0；当上行链路打开时，ul_switch置1；上下行链路常开时，ul_switch置1；此时，2bit函数就实现了280个2bit的子帧配比指示信号到开关的切换。14.根据权利要求13所述的一种5G通信系统的TCS开关切换的通用方法，其特征在于：所述步骤九中的逻辑命令为：当偏移量switch_on_offset和偏移量switch_off_offset相等时，即脉冲switch_on_symbol_pulse和switch_off_symbol_pulse都在同一位置被拉高，即计数器cnt_switch_on_symbol和cnt_switch_off_symbol完全对齐，此时根据脉冲switch_on_symbol_pulse将开关dl_switch和ul_switch按照步骤九中的函数定义置0或1；当脉冲switch_on_symbol_pulse为1时，函数在数值为2’b1和2’b3时，将开关dl_switch置1，开关ul_switch置0，其余时刻保持；当脉冲switch_off_symbol_pulse为1时，函数在数值为2’b0和2’b2时，将开关dl_switch置0，开关ul_switch置1其余时刻保持；由开关dl_switch和ul_switch去控制管脚，此时完成关于tdd模式下TCS下行开关的切换。
说明书desc
技术领域本发明涉及5G通信技术领域，建立在时钟频率和采样率相等的基础上，用于解析5G中子载波的子帧配比，精准地切换TCS开关，从而控制开关信号。背景技术在5G通信系统中，以30Khz子载波为例，1个NR无线帧的长度为10ms，分为20个时隙，每个时隙分为14个符号，分别是符号0至符号13，每个时隙的符号0包含cp，即每个时隙的符号0的长度是4448，其余符号1至符号13的长度是4384。这样的帧结构决定了5G系统中TDD子帧配比要比4G系统要复杂的多。在4G的通信系统中，tdd模式下，需要支持的子载波的子帧配比只有九种，而在5G通信系统中，子载波的子帧配比则需要支持几十种，一方面是5G通信系统比4G通信系统，需要支持的子帧配比急剧增多，另一方面是子载波的内部结构不同，这使得原来的4G通信系统中关于时间控制序列的算法失效，而更多的5G通信系统中，关于时间控制序列的算法不能全面地配置子载波的子帧配比，使得每换一种配比可能需要重新生成比特流文件，这样大大的减少了代码的灵活性，增加了调试的复杂性，从而增大人力投入，延长开发周期，影响项目进度。发明内容针对现有技术中存在的问题，本发明目的在于，提供一种在5G通信技术领域的，并且时钟频率和采样率相等的基础上的时间控制序列开关切换算法。解决5G通信系统中tdd子帧配置的多样性以及复杂性，从而减少人力投入，缩短开发周期。为了实现上述目的，本发明所采用技术方案为：一种5G通信系统的TCS开关切换的通用方法，其特征在于：针对频分双工fdd和时分双工tdd两种不同的模式，在频分双工fdd模式下由寄存器去控制信号，从而信号直接控制管脚，在时分双工tdd模式下由TCS算法去控制信号，从而实现信号控制管脚，具体包括以下步骤：步骤一、根据10msNR无线帧恢复出来的帧头的起始位置的脉冲timebase_trig_10ms，将其上升沿作为TCS开关切换的起始位置；步骤二、根据步骤一中的timebase_trig_10ms去计数一个完整的10msNR无线帧，即设置一个以timebase_trig_10ms的上升沿为起始位置，由0计数到时钟频率数值减1的计数器timebase_cnt_10ms；步骤三、在步骤二描述的计数器timebase_cnt_10ms里去设置脉冲all_pulse；步骤四、根据步骤三中脉冲all_pulse的上升沿做起始位置，设置一个计数0到时钟频率数值减1的计数器cnt_all_pulse，计数一个完整的10msNR无线帧；步骤五、在步骤四描述的计数器cnt_all_pulse里，根据开关局部偏移量switch_on_offset和switch_off_offset，去设置脉冲switch_on_pulse和switch_off_pulse；步骤六、根据步骤五中的脉冲switch_on_pulse和switch_off_pulse的起始位置去计数10msNR无线帧，即分别设置数0到时钟频率数值减1的计数器cnt_switch_on和cnt_switch_off；步骤七、根据符号的长度，分别划分步骤六中的计数器cnt_switch_on和cnt_switch_off，得到计数器cnt_switch_on_symbol和cnt_switch_off_symbol，即分别去计数0~279，并且将每个symbol的起始位置设置脉冲switch_on_symbol_pulse和switch_off_symbol_pulse；步骤八、定义560bit的子帧配比指示信号tdd_symbol_cfg，能够拆解为280个2bit，步骤七中的计数器cnt_switch_on_symbol和cnt_switch_off_symbol的0到279分别对应指示信号tdd_symbol_cfg从低位到高位的280组2bit；步骤九、设置一个2bit的函数，用函数去判断步骤八中计数器cnt_switch_on_symbol和cnt_switch_off_symbol关于指示信号tdd_symbol_cfg的对应关系，然后由逻辑命令，根据开关的所在的上行或者下行链路位置，完成最终开关的切换。所述步骤二具体为：由于数据进入空口后，存在一定的设备时延，所以空口数据的起始位置脉冲timebase_trig_10ms和空口数据的真实起始位置不一定对齐，此时如果需要准确的将TCS开关的起始位置和空口数据的起始位置对齐，开关整体的打开和关闭状态就需要有准确的偏移量all_offset去偏移，如果开关需要提前打开或者关闭，则用十六进制负值表示all_offset，如果开关需要延后打开或者关闭，则用十六进制正值表示all_offset。所述步骤三具体为：根据步骤二中开关偏移量all_offset的数值，在步骤二描述的计数器timebase_cnt_10ms里去设置脉冲all_pulse，如果需要将TCS开关整体前提，则将all_offset设置为负值，即在timebase_cnt_10ms计数到时钟频率数值-1-DEC)的位置设置脉冲all_pulse，如果需要将TCS开关整体延后，则将all_offset设置为正值，即在timebase_cnt_10ms计数到DEC的位置设置脉冲all_pulse。所述步骤二中，虽然偏移量all_offset调节TCS开关整体的位置，但是为了让开关的切换不影响到空口数据，开关的开和关还需要偏移量去调节，即调节开关的开和关的上升沿和下降沿的位置；所述开关包括上行链路和下行链路的开关，具体为：射频链路下行数据使能开关，功放开关，射频链路上行数据使能开关和低噪声放大器开关。定义开关的开状态的局部偏移量为switch_on_offset，如果开关需要提前打开，则用十六进制负值表示，如果开关需要延后打开，则用十六进制正值表示；定义开关的关状态的局部偏移量为switch_off_offset，如果开关需要提前关闭，则用十六进制负值表示，如果开关需要延后关闭，则用十六进制正值表示。所述步骤五具体为：根据局部偏移量switch_on_offset和switch_off_offset的数值，在步骤四描述的计数器cnt_all_pulse的相应位置去设置脉冲switch_on_pulse和switch_off_pulse，如果switch_on_offset为负值，在cnt_all_pulse计数到时钟频率数值-1-Dec的位置设置脉冲switch_on_pulse，如果switch_on_offset为正值，在cnt_all_pulse计数到Dec的位置设置脉冲switch_on_pulse；如果switch_off_offset为负值，在cnt_all_pulse计数到)的位置设置脉冲switch_off_pulse，如果switch_off_offset为正值，在cnt_all_pulse计数到DEC，x满足：。步骤五中，和步骤二同理，由于计数器cnt_all_pulse是从0开始计数到时钟频率数值减1，所以当偏移量switch_on_offset和switch_off_offset为负值时，是需要全局考虑的，即舍弃第一个计数周期产生的不稳定状态，从计数器的第二个周期开始计数。同时，需要考虑偏移量switch_on_offset和switch_off_offset为0时，即计数器cnt_switch_on和cnt_switch_off为0的时候设置脉冲switch_on_pulse和switch_off_pulse。步骤七中，每个10msNR无线帧共包含20个时隙，每个时隙包含14个符号，而每个符号0包含cp，长度为4448，符号1至符号13的长度为4384，即需要准确地在符号的起始位置去设置脉冲switch_on_pulse和switch_off_pulse，当第一个脉冲switch_on_pulse和switch_off_pulse的位置在计数器cnt_switch_on和cnt_switch_off数到0的时刻，第二个脉冲switch_on_pulse和switch_off_pulse的位置在计数器cnt_switch_on和cnt_switch_off数到4447的时刻，第三个脉冲switch_on_pulse和switch_off_pulse的位置在计数器cnt_switch_on和cnt_switch_off数到的时刻，以此类推一直到第279个脉冲switch_on_pulse和switch_off_pulse都设置完成，即计数器cnt_switch_on和cnt_switch_off将280个symbol全部划分完。步骤九中，函数的位宽为2bit，判断的是输入的560bit子帧配比指示信号，280个symbol对应的2bit依次对应2bit位宽的函数，即函数需要处理280次。函数定义如下，2’b00：上下行链路关闭，2’b01：下行链路打开，2’b10：上行链路打开，2’b11：上下行链路常开。判断方法为：定义TCS开关信号的下行开关为dl_switch，当上下行链路关闭时，dl_switch置0；当下行链路打开时，dl_switch置1；当上行链路打开时，dl_switch置0；上下行链路常开时，dl_switch置1；定义TCS开关信号的上行开关为ul_switch，当上下行链路关闭时，ul_switch置0；当下行链路打开时，ul_switch置0；当上行链路打开时，ul_switch置1；上下行链路常开时，ul_switch置1；此时，2bit函数就实现了280个2bit的子帧配比指示信号到开关的切换。具体实现的逻辑命令：当偏移量switch_on_offset和偏移量switch_off_offset相等时，即脉冲switch_on_symbol_pulse和switch_off_symbol_pulse都在同一位置被拉高，即计数器cnt_switch_on_symbol和cnt_switch_off_symbol完全对齐，此时根据脉冲switch_on_symbol_pulse将开关dl_switch和ul_switch按照步骤九中的函数定义置0或1；当脉冲switch_on_symbol_pulse为1时，函数在数值为2’b1和2’b3时，将开关dl_switch置1，开关ul_switch置0，其余时刻保持；当脉冲switch_off_symbol_pulse为1时，函数在数值为2’b0和2’b2时，将开关dl_switch置0，开关ul_switch置1其余时刻保持；由开关dl_switch和ul_switch去控制管脚，此时完成关于tdd模式下TCS下行开关的切换。与现有技术相比，本发明的有益效果在于：1、本发明在时钟频率和采样率相同的情况下，运用FPGA实现在fdd和tdd模式下，实现5G通信系统中对开关的控制逻辑，首先精度控制在纳秒级，可以有效避免在下行切换到上行，在没有保护间隔的情况下，开关影响到数据的风险。2、本发明能够灵活地支持各种子帧配比，巧妙地解决了5G通信系统里，子载波子帧配比的复杂性，真正将通用性发挥到最大功效。本发明由整体和局部偏移量，去调节开关的开和关的时延量，整体偏移量避免了因为环境而引起的外部较大时延，局部偏移量解决了下行切换到上行和上行切换到下行时，数据容易被开关切到的风险，从而保证开关和空口数据地精准对应，增大了传输速率，减少了开发周期，提高了开发效率。附图说明图1为本发明5G通信系统的TCS开关切换的通用方法接口图。图2为本发明5G通信系统的TCS开关切换的通用方法流程图。图3为本发明5G通信系统的TCS开关切换的通用方法时序图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述。显然，所描述的实施例仅仅是本发明的一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有作出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。下面结合附图对本发明进一步说明。参见图1，本发明接口如下：输入：以122.88Mhz的时钟和复位信号，FPGA的数据采样率为122.88Mhz为例进行说明，tdd_symbol_cfg是560bit的子帧配比指示信号，从低位到高位的每2bit指示一个符号的开关的开和关状态，当2bit的数值为0，表示上下行关闭，1表示下行打开，2表示上行打开，3表示上下行常开，具体数值根据需求，通过寄存器去配置。timebase_trig_10ms是空口数据的帧头的起始脉冲。all_offset是整体开关的偏移量，控制整体开关的提前量和延后量，具体时间计算公式：。pa_switch_on_offset和pa_switch_off_offset表示功放开关的局部偏移量，lna_switch_on_offset和lna_switch_off_offset表示低噪声放大器开关的局部偏移量，dl_data_switch_on_offset和dl_data_switch_off_offset表示射频下行数据使能开关的局部偏移量以及ul_data_switch_on_offset和ul_data_switch_off_offset示射频上行数据使能开关的局部偏移量，开和关的上升沿和下降沿的提前量和延后量，计算公式。输出：pa_switch_tdd，lna_switch_tdd，dl_data_switch和ul_data_switch_tdd分别是tdd模式下的功放开关，低噪声放大器开关，射频下行链路数据使能开关和射频上行链路数据使能开关，pa_switch_fdd，lna_switch_fdd，dl_data_switch_fdd和ul_data_switch_tdd分别是fdd模式下的功放开关，低噪声放大器开关，射频下行链路数据使能开关和上行链路数据使能开关，以4发4收举例。参见图2和图3，本发明包括以下步骤：一种5G通信系统的TCS开关切换的通用方法，针对fdd和tdd两种不同的模式，在fdd模式下由寄存器去控制信号，实现信号控制管脚，在tdd模式下由TCS算法去控制信号，实现信号控制管脚，包括以下步骤：步骤一.根据10msNR无线帧恢复出来的帧头的起始位置的脉冲timebase_trig_10ms，将其上升沿作为TCS开关切换的起始位置，此timebase_trig_10ms和空口数据的帧头的上升沿在理论上是对齐的。步骤二.根据步骤一中的timebase_trig_10ms去计数一个完整的10msNR无线帧，即设置一个以timebase_trig_10ms的上升沿为起始位置，由0计数到时钟频率数值减1的计数器timebase_cnt_10ms，例如时钟频率为122.88M，则设置timebase_cnt_10ms去计数0到1228799，后面的步骤都根据时钟频率和数据采样率为122.88M去说明。步骤三.由于数据进入空口后，存在一定的设备时延，所以空口数据的起始位置脉冲timebase_trig_10ms和空口数据的真实起始位置不一定对齐，此时如果需要准确的将TCS开关的起始位置和空口数据的起始位置对齐，开关整体的打开和关闭状态就需要有准确的偏移量all_offset去偏移，如果开关需要提前打开或者关闭，则用十六进制负值表示all_offset，如果开关需要延后打开或者关闭，则用十六进制正值表示all_offset。步骤四.根据步骤三中开关偏移量all_offset的数值，在步骤二描述的计数器timebase_cnt_10ms里去设置脉冲all_pulse，如果需要将TCS开关整体前提，则将all_offset设置为负值，即在timebase_cnt_10ms计数到时钟频率数值-1-DEC)的位置设置脉冲all_pulse，如果需要将TCS开关整体延后，则将all_offset设置为正值，即在timebase_cnt_10ms计数到DEC的位置设置脉冲all_pulse。步骤五.根据步骤四中脉冲all_pulse的上升沿做起始位置，设置一个计数0到1228799的计数器cnt_all_pulse，计数一个完整的10msNR无线帧。步骤六.虽然偏移量all_offset调节TCS开关整体的位置，但是为了让开关的切换不影响到空口数据，打开和关闭开关还需要调节时延，即调节开关的打开和关闭的上升沿和下降沿的位置；所述开关包括上行链路和下行链路的开关，具体为：射频链路下行数据使能开关，功放开关，射频链路上行数据使能开关和低噪声放大器开关，特此只以功放开关举例说明。定义功放开关的开状态的偏移量为pa_switch_on_offset，如果开关需要提前打开，则用十六进制负值表示，如果开关需要延后打开，则用十六进制正值表示；定义功放开关的关状态的偏移量为pa_switch_off_offset，如果开关需要提前关闭，则用十六进制负值表示，如果开关需要延后关闭，则用十六进制正值表示。步骤七.根据步骤六中偏移量pa_switch_on_offset和pa_switch_off_offset的数值，在步骤五描述的计数器cnt_all_pulse的相应位置去设置脉冲pa_switch_on_pulse和pa_switch_off_pulse，如果pa_switch_on_offset为负值，在cnt_all_pulse计数到的位置设置脉冲pa_switch_on_pulse，如果pa_switch_on_offset为正值，在cnt_all_pulse计数到Dec的位置设置脉冲pa_switch_on_pulse；如果pa_switch_off_offset为负值，在cnt_all_pulse计数到)的位置设置脉冲pa_switch_off_pulse，如果pa_switch_off_offset为正值，在cnt_all_pulse计数到DEC(pa_switch_off_offset0的位置设置脉冲pa_switch_off_pulse。步骤八.根据步骤七中的脉冲pa_switch_on_pulse和pa_switch_off_pulse的起始位置去计数10ms帧，即分别设置数0~1228799的计数器cnt_pa_switch_on和cnt_pa_switch_off。步骤九.根据symbol的长度，分别划分步骤八中的计数器cnt_pa_switch_on和cnt_pa_switch_off，得到计数器cnt_pa_switch_on_symbol和cnt_pa_switch_off_symbol，即分别去计数0~279，并且将每个symbol的起始位置设置脉冲pa_switch_on_symbol_pulse和pa_switch_off_symbol_pulse。步骤十.定义560bit的子帧配比指示信号tdd_symbol_cfg，可以拆解为280个2bit，步骤十中的计数器cnt_pa_switch_on_symbol和cnt_pa_switch_off_symbol的0~279分别对应指示信号tdd_symbol_cfg从低位到高位的280组2bit。步骤十一.设置一个2bit的函数，函数定义如下，2’b00：上下行链路关闭，2’b01：下行链路打开，2’b10：上行链路打开，2’b11：上下行链路常开。用函数去判断步骤十中计数器cnt_pa_switch_on_symbol和cnt_pa_switch_off_symbol关于指示信号tdd_symbol_cfg的对应关系。以功放开关举例，实际最终的TCS开关信号的下行开关，定义为pa_switch，当上下行链路关闭时，pa_switch置0；当下行链路打开时，pa_switch置1；当上行链路打开时，pa_switch置0；上下行链路常开时，pa_switch置1。上行开关，以低噪声放大开关举例，定义为lna_switch，当上下行链路关闭时，lna_switch置0；当下行链路打开时，lna_switch置0；当上行链路打开时，lna_switch置1；上下行链路常开时，lna_switch置1。此时，2bit函数就实现了280个2bit的子帧配比指示信号到开关的切换。步骤十二.根据步骤十一中的函数，有以下逻辑命令完成最终开关的切换，当偏移量pa_switch_on_offset和pa_switch_off_offset相等时，即脉冲pa_switch_on_symbol_pulse和pa_switch_off_symbol_pulse都在同一位置被拉高，即计数器cnt_pa_switch_on_symbol和cnt_pa_switch_off_symbol完全对齐，此时根据脉冲pa_switch_on_symbol_pulse将开关pa_switch按照步骤十一中的函数定义置0或1；当脉冲pa_switch_on_symbol_pulse为1时，函数在数值为2’b1和2’b3时，将开关pa_switch置1，其余时刻保持；当脉冲pa_switch_off_symbol_pulse为1时，函数在数值为2’b0和2’b2时，将开关pa_switch置0，其余时刻保持。由开关pa_switch去控制管脚，此时完成关于tdd模式下TCS下行开关的切换，上行开关的控制同下行开关的原理。以上所述的实施方式，并不构成对该技术方案保护范围的限定。任何在上述实施方式的精神和原则之内所作的修改、等同替换和改进等，均应包含在该技术方案的保护范围之内。
