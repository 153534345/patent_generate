标题title
一种基于无线测距技术的海量LoRa节点快速自组网通信方法
摘要abst
一种基于无线测距技术的海量LoRa节点快速自组网通信方法，应用于地震勘探节点的无线通信技术领域，涉及设备包括：网关以及终端节点，其中，网关用于集中收集地震勘探节点的数据，地震勘探节点用于采集、传输所需数据。包括步骤如下：LoRa网关和地震勘探节点间进行组网、通信，采用无线测距技术、改进的K‑Means无监督聚类分组技术、冲突退避和跳频机制完成快速入网；LoRa终端节点进入监听模式等待网关呼叫。每个LoRa终端节点都由mac地址进行标识，以便于点对点通信。本发明有地震勘探节点的组网分组自动化、入网快速化以及低功耗的特点，非常适合海量地震勘探节点的质控检测。
权利要求书clms
1.一种基于无线测距技术的海量LoRa节点快速自组网通信方法，其特征在于：所述方法包括如下步骤：步骤1：网关与终端节点基于混合滤波方法和拟合方法利用无线信号进行测距；步骤2：终端节点基于K-Means无监督聚类改进方法进行自适应分组，同组终端节点用相同组号标记；步骤3：网关与终端节点基于步骤2的自适应分组技术、冲突退避和跳频机制分组组网；步骤4：网关与终端节间功能包括：无操作时，终端节点进入监听模式；点对点通信时，终端节点利用短前导序列传输采集的数据；广播或点对点通信方式，网关改变终端节点LoRa模块的工作状态；网关自动老化终端节点。2.根据权利要求1所述的一种基于无线测距技术的海量LoRa节点快速自组网通信方法，其特征在于：所述步骤1中混合滤波方法为对无线信号先进行卡尔曼滤波后进行均值滤波。3.根据权利要求1所述的一种基于无线测距技术的海量LoRa节点快速自组网通信方法，其特征在于：所述步骤1中拟合方法为采用高阶多项式对测试点数据进行拟合解得优化参数。4.根据权利要求1所述的一种基于无线测距技术的海量LoRa节点快速自组网通信方法，其特征在于：所述步骤2中K-Means无监督聚类改进方法为K值由终端节点数量动态控制、采用一维K-Means聚类算法将终端节点分为环状组。5.根据权利要求1所述的一种基于无线测距技术的海量LoRa节点快速自组网通信方法，其特征在于：所述步骤3中冲突退避方法为进行瞬时无线信号强度采集，大于指定阈值，则判为有干扰，进行随机延时退避，其中随机数通过无线信号强度的采集值构造。6.根据权利要求1所述的一种基于无线测距技术的海量LoRa节点快速自组网通信方法，其特征在于：所述步骤3中跳频机制方法为进行瞬时无线信号强度采集，大于指定阈值，则判为有干扰，进行随机变频入网，其中随机数通过无线信号强度的采集值构造。7.根据权利要求1所述的一种基于无线测距技术的海量LoRa节点快速自组网通信方法，其特征在于：所述步骤4中，无操作时，终端节点进入监听模式，具体为，进入RxDutyCycle模式，监听网关呼叫。8.根据权利要求1所述的一种基于无线测距技术的海量LoRa节点快速自组网通信方法，其特征在于：所述步骤4中，点对点通信时，终端节间传输采集的数据，具体为，终端节点mac地址唯一并利用短前导序列向网关传输数据。9.根据权利要求1所述的一种基于无线测距技术的海量LoRa节点快速自组网通信方法，其特征在于：所述步骤4中，广播或点对点通信方式，网关改变终端节点LoRa模块的工作状态，具体为，网关通过特殊帧格式，通过广播或点对点的无线通信方式，修改终端节点LoRa模块参数。10.根据权利要求1所述的一种基于无线测距技术的海量LoRa节点快速自组网通信方法，其特征在于：所述步骤4中，网关自动老化终端节点，具体为，终端节点定时向网关上传心跳数据包，超时则网关对未上传心跳数据包的终端节点进行老化处理。
说明书desc
技术领域本发明属于LoRa无线通信技术领域，具体涉及一种基于无线测距技术的海量LoRa节点快速自组网通信方法。背景技术在无线通信技术领域，LoRa无线通信是其中重要的一种技术。LoRa指远距离无线电，是一种线性调频扩频调制技术，因其具有传输距离远、功耗低、组网灵活等诸多优势特性，故而在一些行业应用广泛。在地震勘探领域中，传统的有线勘探正逐步被无线勘探取缔，而LoRa因其优势也在该领域初步崭露头角。一个LoRa网络系统一般由服务器、网关和终端节点组成，网关和服务器间一般通过5G/4G/3G/GPRS连接，网关和终端节点间一般通过星型网络结构连接，LoRa网关将海量终端节点采集的地震勘探数据汇总后上报服务器，因此如何高效地对网关和终端节点组网和通信，显得尤为重要。对于海量LoRa终端节点的组网和通信，常常存在终端节点功耗高、组网耗时过长等问题。中国专利CN111107674A公开了一种基于野外动物监测设备的LoRa时分组网通信方法，该方法采用分时广播机制进行组网通信，实现了LoRa的组网通信。然而在上述方法中，每个终端节点入网，LoRa网关都需要广播一次，每次广播都将唤醒所有终端节点导致功耗增加，而且当某一终端节点向网关传输数据时同时也会唤醒其他不相关终端节点，导致功耗进一步增加；而且终端节点在监听模式下被唤醒进行组网是需要一定时长的，当终端节点数量较多时，每个终端节点的唤醒时间累加，组网的耗时也将会大大增长。因此现有技术需要一种减少大面积唤醒终端节点的处理方法，来降低LoRa终端节点的功耗，并且需要一种提高海量LoRa终端节点组网通信速度的方法，来提高组网的效率。发明内容为了解决上述问题，本发明提出了一种基于无线测距技术的海量LoRa节点快速自组网通信方法，适用于海量地震勘探节点的质控检测，实现组网过程的快速自动化以及网络管理的易操作，同时降低节点功耗。一种基于无线测距技术的海量LoRa节点快速自组网通信方法，包括如下步骤：步骤1：网关与终端节点基于混合滤波方法和拟合方法利用无线信号进行测距；步骤2：终端节点基于K-Means无监督聚类改进方法进行自适应分组，同组终端节点用相同组号标记；步骤3：网关与终端节点基于步骤2的自适应分组技术、冲突退避和跳频机制分组组网；步骤4：网关与终端节间功能包括：无操作时，终端节点进入监听模式；点对点通信时，终端节点利用短前导序列传输采集的数据；广播或点对点通信方式，网关改变终端节点LoRa模块的工作状态；网关自动老化终端节点。进一步地，所述步骤1中混合滤波方法为对无线信号先进行卡尔曼滤波后进行均值滤波。进一步地，所述步骤1中拟合方法为采用高阶多项式对测试点数据进行拟合解得优化参数。进一步地，所述步骤2中K-Means无监督聚类改进方法为K值由终端节点数量动态控制、采用一维K-Means聚类算法将终端节点分为环状组。进一步地，所述步骤3中冲突退避方法为进行瞬时无线信号强度采集，大于指定阈值，则判为有干扰，进行随机延时退避，其中随机数通过无线信号强度的采集值构造。进一步地，所述步骤3中跳频机制方法为进行瞬时无线信号强度采集，大于指定阈值，则判为有干扰，进行随机变频入网，其中随机数通过无线信号强度的采集值构造。进一步地，所述步骤4中，无操作时，终端节点进入监听模式，具体为，进入RxDutyCycle模式，监听网关呼叫。进一步地，所述步骤4中，点对点通信时，终端节间传输采集的数据，具体为，终端节点mac地址唯一并利用短前导序列向网关传输数据。进一步地，所述步骤4中，广播或点对点通信方式，网关改变终端节点LoRa模块的工作状态，具体为，网关通过特殊帧格式，通过广播或点对点的无线通信方式，修改终端节点LoRa模块参数。进一步地，所述步骤4中，网关自动老化终端节点，具体为，终端节点定时向网关上传心跳数据包，超时则网关对未上传心跳数据包的终端节点进行老化处理。相对于现有技术，本发明的有益效果至少包括：1)采用多路不同频率网关，分组进行组网，加快组网速度，减少组网时间，实现组网过程快速自动化。2)组网过程生成终端节点的mac地址-距离的对应关系的查找表，可对终端节点老化处理，方便lora网络的管理。3)组网过程中网关仅进行几次广播，减少唤醒终端节点的次数，从而降低功耗；终端节点与网关通信时，采用短前导序列，可大幅减少唤醒不相关节点的概率，从而进一步降低功耗。4)支持空中唤醒和无线通信改参，网关可通过lora无线通信修改终端节点的相关参数，方便使用者改变终端节点的工作状态。附图说明图1是本发明实施例中的网关和终端节点结构组成框图。图2是本发明实施例中的多项式算法拟合曲线图。图3是本发明实施例中的LoRa组网现场情况模拟图。图4是本发明实施例中的终端节点组网通信流程图。图5是本发明实施例中的网关组网通信流程图。具体实施方式下面结合说明书附图对本发明的技术方案做进一步的详细说明。如图1所示是本发明的网关和终端节点结构组成框图，其中网关由五路不同频率的子网关组成，默认子网关通信频率为freq1，其他频率的子网关均应用于跳频通信。终端节点设备中都烧录的默认的相关参数，包括：通信频率、扩频因子、带宽以及mac地址等，其中通信频率为默认为freq1。LoRa组网暂时的现场情况是：一台网关和海量的终端节点，根据实际测量，将终端节点布置到可监听网关的范围之内。本发明是一种基于无线测距技术的海量LoRa节点快速自组网通信方法，该方法包括测距、组网及通信等步骤，具体方法包括如下步骤：步骤1：测距。测距过程具体包括如下步骤：S1：建立测距模型：测距模型采用无线信号传播的对数衰减模型：其中，Pr为发射端距离为d处的接收端得到的接收信号功率，一般用当前位置Rssi值——Rc代替；Pr常取为发射端距离为1m处的接收端得到的接收信号功率，一般用距离发射端1m处的Rssi值——R1m代替；n为传播因子、环境因子；Xσ是均值为0的高斯随机变量。由上述测距模型及参数简化公式：Rc＝R1m-10·n·log10d 进一步化简可得终端节点与网关距离d：S2：混合滤波：均值滤波是指终端节点接收多个Rssi值，并对其求算术平均值作为滤波结果的过程，以降低不稳定因素引起的误差，对于N个采样值，有下式：卡尔曼滤波是一种基于估计算法的递归状态空间模型，是一种最优的递归数据处理算法，该算法可降低观测数据中包括系统中的噪声和干扰的影响。卡尔曼滤波算法抽象公式如下：Pk＝APk-1AT+QKk＝PkHT-1P'k＝Pk其中，为k时刻的状态值，uk-1为k-1时刻对系统的控制变量，Pk为k时刻的误差协方差，Q为过程噪声协方差，Kk为k时刻的卡尔曼增益，R为测量噪声协方差，为校正更新后的状态值，yk为k时刻的测量值，P'k为校正更新后的误差协方差，I为单位矩阵，A、B和H为系统参数。结合S1建立的测距模型，将抽象参数具体化：测距模型中无系统控制变量，Buk-1＝0；在无系统控制变量的情况下，由于测量变量为瞬时Rssi值，故设上一时刻与下一时刻Rssi值不变，A＝1；H＝1。化简后，卡尔曼滤波算法公式如下：Kk＝-1P'k＝其中，具体为更新后的Rssi值，yk具体为当前Rssi值，即Rc。卡尔曼算法具体实现步骤：首先初始化P0和再由k-1时刻的最优Rssi值预测k时刻的Rssi值，然后由k-1时刻的误差协方差和过程噪声预测k时刻的误差协方差，计算卡尔曼增益，最后对预测的Rssi值进行校正更新。混合滤波的步骤：先对采集的瞬时Rssi值进行卡尔曼滤波，再对卡尔曼滤波的结果进行均值滤波，将均值滤波的结果其作为混合滤波的结果输出。S3：参数优化：测距公式式中，R1m可通过实测获得；n可通过两组已知的Rc和d获得，但R1m和n会随周围环境改变，为使测距更加精准，需进行现场测量并结合拟合算法进行拟合，以获得更合适的参数，拟合算法采用多项式回归算法。对式化简后，进行N阶泰勒展开：则有拟合参数：参数优化的具体步骤：1)100m以内每隔2m采集样本；100m～3000m每隔100m采集样本。2)对不同距离下的瞬时Rssi样本值，进行混合滤波，求出滤波后的稳定值。3)采用多项式回归算法计算R1m和n的值：R1m＝-32.121，n＝3.029。拟合曲线如2所示。S4：将参数优化后的值代入式，最终测距公式化简为：S5：测距的具体实施步骤：1)频率为freq1的子网关1持续广播，以供终端节点测距。2)终端节点对瞬时Rssi值采样，经过混合滤波后的输出结果代入测距公式，计算终端节点到网关的距离。步骤2：分组。分组过程具体包括如下步骤：K-Means方法是聚类中的经典算法，数据挖掘十大经典算法之一。算法接受参数k，然后将事先输入的n个数据对象划分为k个聚类以便使得所获得的聚类满足聚类中的对象相似度较高，而不同聚类中的对象相似度较小。本发明的自适应分组采用K-Means的改进算法，利用一维K-Me ans算法将LoRa节点划分为环状组，具体步骤如下：S1：确定K值；S2：从原始数据集中选择K个点作为初始均值点；S3：依次从原始数据集中取出数据，每取出一个数据就和K个均值点分别计算距离，和某个均值点更近就归为这个均值点所在的簇；S4：当步骤S3结束后，分别计算各簇当前的均值点；S5：比较当前的均值点和上一步得到的均值点是否相同，如果相同，则K-Means算法结束，否则，将当前的均值点替换掉之前的均值点，然后重复S3。利用步骤1测得的距离结合步骤2的自适应分组算法，对终端节点聚类分组，根据如图3所示的LoRa组网现场情况模拟图，将终端节点聚类为四组：第一组：0～L1、第二组：L 1～L 2、第三组：L 2～L 3、第四组：L 3～L4，其中0＜L 1＜L 2＜L 3＜L4。聚类分组完成后，对本组节点进行标记，如第一组所有终端节点组号记为1。节点与分组的对应关系如下表所示：步骤3：组网。组网过程具体包括如下步骤：S1：频率为freq1的子网关1广播组网请求包。S2：终端节点按照自适应的分组，开始由近及远分组入网，某一组终端节点正在入网，则其他组终端节点进入低功耗监听模式，等待上一组完成再入网。入网过程具体包括如下步骤：1)第一组终端节点优先入网，其他组终端节点进入低功耗监听模式。第一组内的终端节点入网时，先进行信道冲突检测，如果有其他终端节点正在入网，即瞬时Rssi值大于指定阈值，则进行随机退避防止碰撞，其中随机退避次数固定，随机数则通过瞬时Rssi值构造。2)如果到达退避的极限次数，则进行跳频，跳频后，重复上述1)的防碰撞步骤，直到第一组所有终端节点入网成功。3)网关再次广播，第二组终端节点入网，重复上述1)和2)的步骤，直到所有的终端节点入网成功。步骤4：从开始组网到完成组网的过程中，终端节点会携带本机mac地址和步骤1测量的距离入网，网关最终生成终端节点的mac地址-距离的对应关系的查找表。步骤5：组网完成之后，无操作时，终端节点进入RxDutyCycle模式监听网关呼叫，等待点对点通信请求；终端节点定时向网关传输心跳数据包，否则超时网关会对本终端节点进行老化处理，即删除本终端节点相关的查找表信息；终端节点向网关点对点通信时，采用短前导序列进行通信，此举可大幅减少唤醒其他不相关节点的概率。根据步骤4网关中已经存储了与终端节点相关的mac地址-距离的对应关系，终端节点中也存储了此对应关系。网关有操作时，即进行点对点通信，由网关广播通信数据包，其中包含mac地址-距离的对应关系，终端节点将本机的mac地址与通信数据包中的对比，不相同，则忽略此次通信数据包后立刻进入RxDutyCycle模式继续监听网关呼叫；相同，则本终端节点接收通信数据包并解析其内容，进行相关采集操作。终端节点向网关通信时，终端节点设置短前导序列，然后传输通信数据包，其中包含更新后的mac地址-距离的对应关系，网关收到通信数据包后，解析数据包内容并更新对应查找表内容。进行网关自动老化终端节点，终端节点定时向网关上传心跳数据包，超时则网关对未上传心跳数据包的终端节点进行老化处理。根据上述的实施例可以快速建立一个LoRa网络，网络组网过程自动化，支持旧设备老化处理，提高了LoRa网络的组网速度，降低了操作难度；终端节点通过短前导序列传输数据，大幅度减小了唤醒其他不相关节点的概率，降低了终端节点的功耗；支持终端节点的空中唤醒和无线修改LoRa参数，方便用户通过网关远程改变终端节点的工作状态。以上所述仅为本发明的较佳实施方式，本发明的保护范围并不以上述实施方式为限，但凡本领域普通技术人员根据本发明所揭示内容所作的等效修饰或变化，皆应纳入权利要求书中记载的保护范围内。
