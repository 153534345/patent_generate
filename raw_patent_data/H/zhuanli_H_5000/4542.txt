标题title
一种白平衡方法和终端设备
摘要abst
本申请涉及图像处理技术领域，提供了一种白平衡方法和终端设备，用于解决现有技术中当图像中存在误导性颜色区时，相关技术中白平衡操作容易导致图像偏色的问题。本申请通过引导用户选择目标图像块，以便于有效去除误导性颜色区中的色块。通过用户选择的色块的在二维坐标系中的分布情况可以筛选出色温值接近实际色温的映射点，在计算色温时提高了色温的准确性。故此，本申请缓解了误导性颜色区中的像素点使图像的色温计算产生偏差的问题，继而通过较为准确的计算色温，有效改善图像质量，缓解图像偏色的问题。
权利要求书clms
1.一种白平衡方法，其特征在于，所述方法包括：展示采集的图像；引导用户在所述图像中选择用于确定目标色温的目标图像块；将所述目标图像块中各像素点转换到二维坐标系中，得到所述目标图像块在所述二维坐标系中的各映射点；所述二维坐标系中第一坐标轴用于表述红色分量和绿色分量的比值，第二坐标轴用于表述蓝色分量和绿色分量的比值；基于所述目标图像块在所述二维坐标系中的各映射点的分布情况，筛选出用于计算色温的映射点，得到有效点集合；基于所述有效点集合中各映射点的色温，得到目标色温；基于所述目标色温对图像进行校正。2.根据权利要求1所述的方法，其特征在于，所述引导用户在所述图像中选择用于确定目标色温的目标图像块，具体包括：输出供选择的色块类型，所述色块类型包括有效点色块和失效点色块，所述有效点色块用于指示参与计算色温的图像块，所述失效点色块用于指示不参与计算色温的图像块；响应于用户对所述色块类型的选择操作，确定选择的色块类型；响应于对图像块的选择操作，确定所述色块类型对应的所述目标图像块。3.根据权利要求2所述的方法，其特征在于，所述色块类型为所述有效点色块，所述基于所述目标图像块在所述二维坐标系中的各映射点的分布情况，筛选出用于计算色温的映射点，得到有效点集合，具体包括：确定所述目标图像块内各映射点的坐标值的均值和方差，其中，所述坐标值的均值为所述目标图像块中各映射点的中心点；基于所述均值和方差构建正态分布函数；以所述中心点为基准，根据所述正态分布函数的概率分布表从所述目标图像块的映射点中筛选出在指定概率区间内的映射点，得到有效点集合。4.根据权利要求2所述的方法，其特征在于，所述色块类型为所述失效点色块，所述基于所述目标图像块在所述二维坐标系中的各映射点的分布情况，筛选出用于计算色温的映射点，得到有效点集合，具体包括：确定所述目标图像块内各映射点的坐标值的均值和方差，其中，所述坐标值的均值为所述目标图像块中各映射点的中心点；基于所述均值和方差构建正态分布函数；以所述中心点为基准，根据所述正态分布函数的概率分布表从所述目标图像块的映射点中筛选出在指定概率区间内的映射点，得到失效点集合；从所述图像的映射点中筛选掉所述失效点集合内的点，得到有效点集合。5.根据权利要求3所述的方法，其特征在于，所述以所述中心点为基准，根据所述正态分布函数的概率分布表从所述目标图像块的映射点中筛选出在指定概率区间内的映射点，得到有效点集合，具体包括：根据所述均值和所述方差在所述概率分布表中确定所述指定概率区间；根据所述指定概率区间确定所述有效点集合中映射点的数量；按照与所述中心点的欧氏距离由近及远的顺序，筛选出属于所述指定概率区域的映射点，得到所述有效点集合。6.根据权利要求4所述的方法，其特征在于，所述以所述中心点为基准，根据所述正态分布函数的概率分布表从所述目标图像块的映射点中筛选出在指定概率区间内的映射点，得到失效点集合，具体包括：根据所述均值和所述方差在所述概率分布表中确定所述指定概率区间；根据所述指定概率区间确定所述有效点集合中映射点的数量；按照与所述中心点的欧氏距离由近及远的顺序，筛选出属于所述指定概率区域的映射点，得到所述失效点集合。7.根据权利要求1-6中任一所述的方法，其特征在于，所述目标图像块包括一个图像子块或多个图像子块。8.一种终端设备，其特征在于，包括：存储器，用于存储处理器可执行指令；处理器，被配置为执行所述指令，以实现如权利要求1-7中任一项所述的方法。9.一种计算机可读存储介质，其特征在于，当所述计算机可读存储介质中的指令由终端设备的处理器执行时，使得终端设备能够执行以实现如权利要求1-7中任一项所述的方法。10.一种计算机程序产品，其特征在于，包括计算机程序，所述计算机程序被处理器执行时实现如权利要求1-7中任一项所述的方法。
说明书desc
技术领域本申请涉及图像处理领域，尤其涉及一种白平衡方法和终端设备。背景技术在图像处理领域，现有的自动白平衡技术是通过求取图像的像素点的红色分量、绿色分量和蓝色分量的数值确定图像中各个像素点在二维坐标系中的位置。由于二维坐标系中不同的位置对应不同的色温值，因此相关技术中先根据像素点在二维坐标系中位置能确定出各个像素点的色温值，然后根据各个像素点的色温值计算平均色温，之后根据该平均色温进行白平衡。然而，实际应用中发现，当图像中存在误导性颜色区时，相关技术中白平衡操作容易导致图像偏色。发明内容本申请公开了一种白平衡方法和终端设备，用于解决现有技术中当图像中存在误导性颜色区时，相关技术中白平衡操作容易导致图像偏色的问题。第一方面，本申请提出一种白平衡方法，所述方法包括：展示采集的图像；引导用户在所述图像中选择用于确定目标色温的目标图像块；将所述目标图像块中各像素点转换到二维坐标系中，得到所述目标图像块在所述二维坐标系中的各映射点；所述二维坐标系中第一坐标轴用于表述红色分量和绿色分量的比值，第二坐标轴用于表述蓝色分量和绿色分量的比值；基于所述目标图像块在所述二维坐标系中的各映射点的分布情况，筛选出用于计算色温的映射点，得到有效点集合；基于所述有效点集合中各映射点的色温，得到目标色温；基于所述目标色温对图像进行校正。可选的，所述引导用户在所述图像中选择用于确定目标色温的目标图像块，具体包括：输出供选择的色块类型，所述色块类型包括有效点色块和失效点色块，所述有效点色块用于指示参与计算色温的图像块，所述失效点色块用于指示不参与计算色温的图像块；响应于用户对所述色块类型的选择操作，确定选择的色块类型；响应于对图像块的选择操作，确定所述色块类型对应的所述目标图像块。可选的，所述色块类型为所述有效点色块，所述基于所述目标图像块在所述二维坐标系中的各映射点的分布情况，筛选出用于计算色温的映射点，得到有效点集合，具体包括：确定所述目标图像块内各映射点的坐标值的均值和方差，其中，所述坐标值的均值为所述目标图像块中各映射点的中心点；基于所述均值和方差构建正态分布函数；以所述中心点为基准，根据所述正态分布函数的概率分布表从所述目标图像块的映射点中筛选出在指定概率区间内的映射点，得到有效点集合。可选的，所述色块类型为所述失效点色块，所述基于所述目标图像块在所述二维坐标系中的各映射点的分布情况，筛选出用于计算色温的映射点，得到有效点集合，具体包括：确定所述目标图像块内各映射点的坐标值的均值和方差，其中，所述坐标值的均值为所述目标图像块中各映射点的中心点；基于所述均值和方差构建正态分布函数；以所述中心点为基准，根据所述正态分布函数的概率分布表从所述目标图像块的映射点中筛选出在指定概率区间内的映射点，得到失效点集合；从所述图像的映射点中筛选掉所述失效点集合内的点，得到有效点集合。可选的，所述为所述有效点集合中各映射点分配权重，具体包括：针对每个映射点，获取所述映射点的色温；根据所述色温确定所述映射点在所述色温曲线上对应的色温校准点；计算所述映射点与所述色温校准点的距离；基于所述权重与所述距离的反相关关系为所述映射点分配权重。可选的，所述以所述中心点为基准，根据所述正态分布函数的概率分布表从所述目标图像块的映射点中筛选出在指定概率区间内的映射点，得到有效点集合，具体包括：根据所述均值和所述方差在所述概率分布表中确定所述指定概率区间；根据所述指定概率区间确定所述有效点集合中映射点的数量；按照与所述中心点的欧氏距离由近及远的顺序，筛选出属于所述指定概率区域的映射点，得到所述有效点集合。可选的，所述以所述中心点为基准，根据所述正态分布函数的概率分布表从所述目标图像块的映射点中筛选出在指定概率区间内的映射点，得到失效点集合，具体包括：根据所述均值和所述方差在所述概率分布表中确定所述指定概率区间；根据所述指定概率区间确定所述有效点集合中映射点的数量；按照与所述中心点的欧氏距离由近及远的顺序，筛选出属于所述指定概率区域的映射点，得到所述失效点集合。可选的，所述目标图像块包括一个图像子块或多个图像子块。第二方面，本申请提出一种终端设备，包括：存储器，用于存储处理器可执行指令；处理器，被配置为执行所述指令，以实现如本申请第一方面中提供的任一方法。第三方面，本申请一实施例还提供了一种计算机可读存储介质，当所述计算机可读存储介质中的指令由终端设备的处理器执行时，使得终端设备能够执行如本申请第一方面中提供的任一方法。第四方面，本申请实施例中提供了一种计算机程序产品，包括计算机程序，所述计算机程序被处理器执行时实现如本申请第一方面中提供的任一方法。本申请的实施例提供的技术方案至少带来以下有益效果：本申请在采集到图像之后，获取用户根据需要在图像中选择的目标图像块，根据该目标像素块在二维坐标系中的映射点筛选出有效点集合，并基于有效点集合中的映射点色温计算目标色温，最后根据目标色温对图像进行白平衡操作。本申请通过引导用户选择目标图像块，以便于有效去除误导性颜色区中的色块。通过用户选择的色块的在二维坐标系中的分布情况可以筛选出色温值接近实际色温的映射点，在计算色温时提高了色温的准确性。故此，本申请缓解了误导性颜色区中的像素点使图像的色温计算产生偏差的问题，继而通过较为准确的计算色温，有效改善图像质量，缓解图像偏色的问题。应当理解的是，以上的一般描述和后文的细节描述仅是示例性和解释性的，并不能限制本公开。附图说明为了更清楚地说明本申请实施例的技术方案，下面将对本申请实施例中所需要使用的附图作简单地介绍，显而易见地，下面所介绍的附图仅仅是本申请的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1a为本申请实施例提供的应用场景示意图；图1b为本申请实施例提供的硬件结构示意图；图1c为本申请实施例提供的软件结构示意图；图2a为本申请实施例提供的一种白平衡的流程示意图之一；图2b为本申请实施例提供的一种通过语音提示引导用户在图像中选择目标图像块的示意图；图2c为本申请实施例提供的一种通过动画的形式引导用户在图像中选择目标图像块的示意图；图2d为本申请实施例提供的一种通过静态界面引导用户在图像中选择目标图像块的示意图；图3a为本申请实施例提供的一种白平衡的流程示意图之二；图3b为本申请实施例提供的白平衡方法选择示意图；图4a为本申请实施例提供的一种白平衡的流程示意图之三；图4b为本申请实施例提供的一种多个目标图像块的最小外接矩形示意图；图5为本申请实施例提供的一种白平衡的流程示意图之四；图6a为本申请实施例提供的一种色温曲线示意图；图6b为本申请实施例提供的一种灰色区域示意图；图6c为本申请实施例提供的图像与二维坐标系的关系示意图。具体实施方式为使本申请实施例的目的、技术方案和优点更加清楚，下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述。其中，在本申请实施例的描述中，除非另有说明，″/″表示或的意思，例如，A/B可以表示A或B；文本中的″和/或″仅仅是一种描述关联对象的关联关系，表示可以存在三种关系，例如，A和/或B，可以表示：单独存在A，同时存在A和B，单独存在B这三种情况，另外，在本申请实施例的描述中，″多个″是指两个或多于两个。术语″第一″、″第二″仅用于描述目的，而不能理解为暗示或暗示相对重要性或者隐含指明所指示的技术特征的数量。由此，限定有″第一″、″第二″的特征可以明示或者隐含地包括一个或者更多个该特征，在本申请实施例的描述中，除非另有说明，″多个″的含义是两个或两个以上。以下，对本申请实施例中的部分用语进行解释说明，以便于本领域技术人员理解。自动白平衡：终端设备根据摄像头采集图像数据中的R/G、B/G和色温，自动计算出图像的色温值，并对图像进行校正。二维坐标系：本申请实施例中二维坐标系中将R与G值的比值作为横坐标，B与G的比值作为纵坐标轴建立的二维坐标系。误导性颜色区：将图像转换到二维坐标系中后，该图像中影响AWB色温计算的区域。目标色温：本申请实施例中指白平衡操作采用的色温。在图像处理领域，当终端设备使用AWB功能对图像的色温进行调整时，是通过求取图像的像素点的R、G、B数值和色温，确定图像中各像素点在二维坐标系中的位置。由于在二维坐标系中不同的位置对应不同的色温值，因此根据像素点在二维坐标系中位置能确定各个像素点的色温值，并根据各个像素点的色温值进行白平衡操作。在复杂的环境下，图像中存在误导性颜色区，这些区域的色温与图像中其他像素点的色温相差较大，因此被称为误导性颜色区。在计算色温时，误导性颜色区中的像素点对色温的影响较大，导致图像的色温与真实色温偏差较大，从而导致白平衡操作之后图像存在偏色。有鉴于此，为了解决上述问题，本申请实施例提供了一种白平衡方法及终端设备。本申请在采集到图像之后，获取用户根据需要在图像中选择的目标图像块，根据该目标像素块在二维坐标系中的映射点筛选出有效点集合，并基于有效点集合中的映射点色温计算目标色温，最后根据目标色温对图像进行白平衡操作。本申请通过引导用户选择目标图像块，以便于有效去除误导性颜色区中的色块。通过用户选择的色块的在二维坐标系中的分布情况可以筛选出色温值接近实际色温的映射点，在计算色温时提高了色温的准确性。故此，本申请缓解了误导性颜色区中的像素点使图像的色温计算产生偏差的问题，继而通过较为准确的计算色温，有效改善图像质量，缓解图像偏色的问题。在介绍完本申请实施例的设计思想之后，下面对本申请实施例的技术方案能够适用的应用场景做一些简单介绍，需要说明的是，以下介绍的应用场景仅用于说明本申请实施例而非限定。在具体实施时，可以根据实际需要灵活地应用本申请实施例提供的技术方案。在图1a所示的页面中，用户可以通过终端设备101设备提供的摄像功能，例如点击图1a上的摄像头图标启动摄像头，并基于摄像头采集图像。用户操作终端设备101，在采集到的图像上选择目标图像块，根据目标图像块内的像素点确定色温，最后根据色温对图像进行白平衡操作。当然，需要说明的是，本申请实施例中任何关于用户的信息均可通过用户授权之后获取的。如图1b所示是一种终端设备101的结构示意图。下面以终端设备101为例对实施例进行具体说明。应该理解的是，图1b所示终端设备101仅是一个范例，并且终端设备101可以具有比图1c中所示的更多的或者更少的部件，可以组合两个或多个的部件，或者可以具有不同的部件配置。图中所示出的各种部件可以在包括一个或多个信号处理和/或专用集成电路在内的硬件、软件、或硬件和软件的组合中实现。图1b中示例性示出了根据示例性实施例中终端设备101的硬件配置框图。如图1c所示，终端设备101包括：射频电路110、存储器120、显示单元130、摄像头140、传感器150、音频电路160、无线保真模块170、处理器180、蓝牙模块181、以及电源190等部件。RF电路110可用于在收发信息或通话过程中信号的接收和发送，可以接收基站的下行数据后交给处理器180处理可以将上行数据发送给基站。通常，RF电路包括但不限于天线、至少一个放大器、收发信机、耦合器、低噪声放大器、双工器等器件。存储器120可用于存储软件程序及数据。处理器180通过运行存储在存储器120的软件程序或数据，从而执行终端设备101的各种功能以及数据处理。存储器120可以包括高速随机存取存储器，还可以包括非易失性存储器，例如至少一个磁盘存储器件、闪存器件、或其他易失性固态存储器件。存储器120存储有使得终端设备101能运行的操作系统。本申请中存储器120可以存储操作系统及各种应用程序，还可以存储执行本申请实施例所述访白平衡方法的代码。显示单元130可用于接收输入的数字或字符信息，产生与终端设备101的用户设置以及功能控制有关的信号输入，具体地，显示单元130可以包括设置在终端设备101正面的触摸屏131，可收集用户在其上或附近的触摸操作，例如点击按钮，拖动滚动框等。显示单元130还可用于显示由用户输入的信息或提供给用户的信息以及终端101的各种菜单的图形用户界面。具体地，显示单元130可以包括设置在终端设备101正面的显示屏132。其中，显示屏132可以采用液晶显示器、发光二极管等形式来配置。显示单元130可以用于显示本申请中所述的各种图形用户界面。其中，触摸屏131可以覆盖在显示屏132之上，也可以将触摸屏131与显示屏132集成而实现终端设备101的输入和输出功能，集成后可以简称触摸显示屏。本申请中显示单元130可以显示应用程序以及对应的操作步骤。摄像头140可用于捕获静态图像或视频。物体通过镜头生成光学图像投射到感光元件。感光元件可以是电荷耦合器件或互补金属氧化物半导体光电晶体管。感光元件把光信号转换成电信号，之后将电信号传递给处理器180转换成数字图像信号。终端设备101还可以包括至少一种传感器150，比如加速度传感器151、距离传感器152、指纹传感器153、温度传感器154。终端设备101还可配置有陀螺仪、气压计、湿度计、温度计、红外线传感器、光传感器、运动传感器等其他传感器。音频电路160、扬声器161、麦克风162可提供用户与终端设备101之间的音频接口。音频电路160可将接收到的音频数据转换后的电信号，传输到扬声器161，由扬声器161转换为声音信号输出。终端设备101还可配置音量按钮，用于调节声音信号的音量。另一方面，麦克风162将收集的声音信号转换为电信号，由音频电路160接收后转换为音频数据，再将音频数据输出至RF电路110以发送给比如另一终端，或者将音频数据输出至存储器120以便进一步处理。本申请中麦克风162可以获取用户的语音。Wi-Fi属于短距离无线传输技术，终端设备101可以通过Wi-Fi模块170帮助用户收发电子邮件、浏览网页和访问流媒体等，它为用户提供了无线的宽带互联网访问。处理器180是终端设备101的控制中心，利用各种接口和线路连接整个终端的各个部分，通过运行或执行存储在存储器120内的软件程序，以及调用存储在存储器120内的数据，执行终端设备101的各种功能和处理数据。在一些实施例中，处理器180可包括一个或多个处理单元；处理器180还可以集成应用处理器和基带处理器，其中，应用处理器主要处理操作系统、用户界面和应用程序等，基带处理器主要处理无线通信。可以理解的是，上述基带处理器也可以不集成到处理器180中。本申请中处理器180可以运行操作系统、应用程序、用户界面显示及触控响应，以及本申请实施例所述的白平衡方法。另外，处理器180与显示单元130耦接。蓝牙模块181，用于通过蓝牙协议来与其他具有蓝牙模块的蓝牙设备进行信息交互。例如，终端设备101可以通过蓝牙模块181与同样具备蓝牙模块的可穿戴电子设备建立蓝牙连接，从而进行数据交互。终端设备101还包括给各个部件供电的电源190。电源可以通过电源管理系统与处理器180逻辑相连，从而通过电源管理系统实现管理充电、放电以及功耗等功能。终端设备101还可配置有电源按钮，用于终端的开机和关机，以及锁屏等功能。图1c是本发明实施例的终端设备101的软件结构框图。分层架构将软件分成若干个层，每一层都有清晰的角色和分工。层与层之间通过软件接口通信。在一些实施例中，将Android系统分为四层，从上至下分别为应用程序层，应用程序框架层，安卓运行时和系统库，以及内核层。应用程序层可以包括一系列应用程序包。如图1c所示，应用程序包可以包括相机，图库，日历，通话，地图，导航，WLAN，蓝牙，音乐，视频，短信息等应用程序。应用程序框架层为应用程序层的应用程序提供应用编程接口和编程框架。应用程序框架层包括一些预先定义的函数。如图1c所示，应用程序框架层可以包括窗口管理器，内容提供器，视图系统，电话管理器，资源管理器，通知管理器等。窗口管理器用于管理窗口程序。窗口管理器可以获取显示屏大小，判断是否有状态栏，锁定屏幕，截取屏幕等。内容提供器用来存放和获取数据，并使这些数据可以被应用程序访问。所述数据可以包括视频，图像，音频，拨打和接听的电话，浏览历史和书签，电话簿等。视图系统包括可视控件，例如显示文字的控件，显示图片的控件等。视图系统可用于构建应用程序。显示界面可以由一个或多个视图组成的。例如，包括短信通知图标的显示界面，可以包括显示文字的视图以及显示图片的视图。电话管理器用于提供终端设备101的通信功能。例如通话状态的管理。资源管理器为应用程序提供各种资源，比如本地化字符串，图标，图片，布局文件，视频文件等。通知管理器使应用程序可以在状态栏中显示通知信息，可以用于传达告知类型的消息，可以短暂停留后自动消失，无需用户交互。比如通知管理器被用于告知下载完成，消息提醒等。通知管理器还可以是以图表或者滚动条文本形式出现在系统顶部状态栏的通知，例如后台运行的应用程序的通知，还可以是以对话窗口形式出现在屏幕上的通知。例如在状态栏提示文本信息，发出提示音，终端设备振动，指示灯闪烁等。Android Runtime包括核心库和虚拟机。Android runtime负责安卓系统的调度和管理。核心库包含两部分：一部分是java语言需要调用的功能函数，另一部分是安卓的核心库。应用程序层和应用程序框架层运行在虚拟机中。虚拟机将应用程序层和应用程序框架层的java文件执行为二进制文件。虚拟机用于执行对象生命周期的管理，堆栈管理，线程管理，安全和异常的管理，以及垃圾回收等功能。系统库可以包括多个功能模块和init进程孵化来的用户空间的守护进程、HAL层以及开机动画等，本申请中提及的进程在该层面运行。例如：表面管理器，媒体库，三维图形处理库，2D图形引擎等。表面管理器用于对显示子系统进行管理，并且为多个应用程序提供了2D和3D图层的融合。媒体库支持多种常用的音频，视频格式回放和录制，以及静态图像文件等。媒体库可以支持多种音视频编码格式，例如：MPEG4，H.264，MP3，AAC，AMR，JPG，PNG等。三维图形处理库用于实现三维图形绘图，图像渲染，合成，和图层处理等。2D图形引擎是2D绘图的绘图引擎。内核层是硬件和软件之间的层。内核层至少包含显示驱动，摄像头驱动，音频驱动，传感器驱动。本申请实施例中的终端设备101可以为包括但不限于移动终端、桌面计算机、移动电脑、平板电脑等电子设备。为进一步说明本申请实施例提供的技术方案，下面结合附图以及具体实施方式对此进行详细的说明。虽然本申请实施例提供了如下述实施例或附图所示方法的操作步骤，但基于常规或者无需创造性的劳动在所述方法中可以包括更多或者更少的操作步骤。在逻辑上不存在必要因果关系的步骤中，这些步骤的执行顺序不限于本申请实施例提供的执行顺序。如图2a所示为本申请实施例提供的一种白平衡方法的流程示意图之一，包括以下步骤。步骤201，展示采集的图像。步骤202，引导用户在图像中选择用于确定目标色温的目标图像块。在一些实施例中，可以选择一个图像块或多个图像块作为目标图像块。引导的方式可以是语音提示用户选择目标图像块，也可以是静态界面或动画的形式引导用户选择目标图像块。如图2b所示，若使用语音提示引导用户选择目标图像块时，通过语音提示的方式引导用户选择一个图像块或多个图像块作为目标图像块。如图2c所示，若使用动画的形式引导用户选择目标图像块时，通过在界面上播放动画引导用户选择一个图像块或多个图像块作为目标图像块。如图2d所示，若使用静态界面引导用户选择目标图像块时，在目标图像块选择界面提示用户选择一个图像块或多个图像块作为目标图像块。在另一种实施例中，为了便于用户操作，还可以提供不同的色块类型来帮助用户选择目标图像块。本申请实施例中色块类型包括有效点色块和失效点色块。其中，有效点色块用于选择出参与计算色温的图像块，失效点色块用于筛选掉不参与计算目标色温的图像块。基于色块类型选择目标图像块的方案如图3a所示，可实施为：步骤301，输出供选择的色块类型。步骤302，响应于用户对所述色块类型的选择操作，确定选择的色块类型。如图3b所示，用户在终端设备执行AWB操作之前，可以根据自身需求选择有效点色块或失效点色块对图像做AWB处理。当用户希望选择与标准灰卡颜色接近的区域对图像进行校正时，可以通过选择有效点色块的方法将图像中与标准灰卡颜色接近的区域作为目标图像块。当用户希望去除与标准灰卡颜色差异较大的区域时，可以通过选择失效点色块的方法将图像中与标准灰卡颜色差异较大的区域作为目标图像块，根据目标图像块以外的色温区域的目标色温对图像进行白平衡操作。步骤303，响应于对图像块的选择操作，确定色块类型对应的目标图像块。其中，在选择的色块类型下，选择图像块的操作与前文图2b-图2d所示的方式相同，这里不再赘述。在确定了目标图像块之后，在步骤203中，将目标图像块中各像素点转换到二维坐标系中，得到目标图像块在二维坐标系中的各映射点。步骤204，基于目标图像块在二维坐标系中的各映射点的分布情况，筛选出用于计算色温的映射点，得到有效点集合。在本申请实施例中，由于目标图像块的色块类型包括有效点色块和失效点色块，针对用户选择的目标图像块的色块类型不同，执行不同的操作方法确定有效点集合。下面针对有效点色块和失效点色块的情况分别进行说明：1)选择有效点色块：当用户选择的目标图像块为有效点色块时，基于目标图像块内的映射点确定有效点集合的方法如图4a所示：步骤401，确定目标图像块内各映射点的坐标值的均值和方差。其中坐标值的均值为目标图像块内各映射点的中心点。在本申请实施例中，有效点集合的范围与坐标值有关。像素点的坐标值由像素点的R、G、B数值构成。其中映射点的横坐标为R/G、纵坐标为B/G。R/G和B/G用于确定映射点在二维坐标系中的位置。在确定映射点在二维坐标系中的位置之后，根据目标图像块内各像素点的R/G和B/G的坐标值求出R/G和B/G的均值并求出R/G和B/G的方差σx、σy，其中，中心点的坐标为步骤402，基于均值和方差构建正态分布函数。在本申请实施例中，在根据均值确定了中心点之后，根据均值和方差σx、σy构建正态分布函数。在正态分布函数中，根据能够确定有效点集合中的映射点数量在目标图像块中的映射点数量中所占的比值。步骤403，以中心点为基准，根据正态分布函数的概率分布表从目标图像块的映射点中筛选出在指定概率区间内的映射点，得到有效点集合。在本申请实施例中，目标图像块在二维坐标系中的映射点是离散分布的，且在目标图像块的中心位置分布的最多，因此需要根据目标图像块的中心点确定有效点集合。在本申请实施例中，n的值不同，确定的指定概率区间也不同，有效点集合中的映射点数量在目标图像块中的映射点数量中所占的比值也不同。根据指定概率区间确定n的值之后，进而获得有效点集合中映射点的数量。此时按照与中心点的欧氏距离由近及远的顺序，筛选出属于指定概率区域的映射点，得到有效点集合。例如，目标图像块中所有映射点的中心点的坐标为根据确定有效点集合中映射点的数量，以该数量作为参考值，计算各映射点与中心点的欧氏距离，直至从各映射点中筛选出等于参考值的映射点数量，筛选出来的映射点构成的集合即为有效点集合。假设n＝1，有效点集合中映射点的数量是目标图像块中映射点数量的68.26％；若n＝2，有效点集合中映射点的数量是目标图像块中映射点数量的95.44％；类似的，若n＝3，有效点集合的中映射点的数量是目标图像块中映射点数量的99.74％。在本申请中，n的取值越大，有效点集合中映射点的数量越多。若需要选择映射点分布较集中的区域作为有效点集合，则将n的值取1计算有效点集合；若需要有效点集合中尽可能多的包括目标图像块中的映射点，则将n的值取3计算有效点集合。若用户选择的目标图像块的色块类型为有效点色块，则n的值取1能使计算的结果更加精确；若用户选择的目标图像块的色块类型为失效点色块，则若n的值取3能更好地剔除失效点对目标色温的影响。在本申请的另一实施例中，也可以根据聚类算法确定各映射点的中心点，进而确定有效点集合。如确定滑动窗口的半径R，选择目标图像块中任一的映射点作为圆心建立滑动窗口，根据滑动窗口的面积和滑动窗口内的映射点数量计算滑动窗口内的映射点密度。每计算完映射点密度之后，滑动窗口在目标图像块中滑动，再次计算映射点密度，直至滑动窗口中的映射点密度不再增加。将最大映射点密度对应的滑动窗口中的映射点坐标的均值作为目标图像块的内的映射点的中心点。在确定聚类点中心之后，也可以根据滑动窗口的半径确定有效点集合。聚类算法有多种，本申请示例性的给出了其中一种，对采用何种聚类算法计算本申请中目标图像块的中心点和有效点集合，本申请不进行限制。在本申请的一种实施例中，如图4b所示，若用户选择的目标图像块有多个时，则选择的所有图像块的并集作为目标图像块。2)选择失效点色块：当用户选择目标图像块为失效点色块时，基于目标图像块内的像素点确定有效点集合的方法如图5所示。步骤501，确定目标图像块内各映射点的坐标值的均值和方差。步骤502，基于均值和方差构建正态分布函数。步骤503，以中心点为基准，根据正态分布函数的概率分布表从目标图像块的映射点中筛选出在指定概率区间内的映射点，得到失效点集合。步骤504，从图像的映射点中筛选掉失效点集合内的点，得到有效点集合。在本申请实施例中，当图像中有色温较低的像素点时，为了使像素点的色温不影响对图像的白平衡操作，通过选择失效点色块的方法将该像素点所在的区域作为目标图像块，即将误导性颜色区的色块作为目标图像块，并计算目标图像块中的失效点集合。将去除失效点集合去后的图像中的点作为有效点集合计算目标色温，从而降低计算色温时的偏差。在本申请实施例中，确定失效点集合的方法与确定有效点集合的方法相同。在确定失效点集合后，将失效点集合之外的点作为有效点集合，根据有效点集合中像素点色温对图像进行校正。综上所述，当用户希望选择与标准灰卡颜色接近的区域对图像进行校正时，可以通过选择有效点色块的方法对图像进行校正；当用户希望去除与标准灰卡颜色差异较大的区域时，可以通过选择失效点色块的方法对图像进行校正。在一些实施例中若目标图像块中包括了误导性颜色区的像素点，此时两种区域的像素点色温与实际色温相差较大，因此会影响目标色温的计算，需要将误导性颜色区的像素点作为失效点排除。在确定有效点集合之后，在步骤205中基于有效点集合中各映射点的色温，得到目标色温。在本申请实施例中，二维坐标系中的色温曲线可通过18％反射率的标准灰卡建立的。由于不同光源的色温值不同，且在不同光源下，同一标准灰卡的R、G、B的值不同。因此以R/G为横轴，B/G为纵轴，通过获取不同光源下标准灰卡的R、G、B的值，就能在二维坐标系中确定不同光源下标准灰卡对应的坐标。将所有坐标用平滑的曲线连接后得到色温曲线。也即，针对同一标准灰卡，不同色温情况下，该标准灰卡的R、G、B值不同。不同色温情况下标准灰卡由于R、G、B值不同，导致不同色温情况下，标准灰卡的R/G和G/B的值不同。R/G和G/B的值为标准灰卡在二维坐标系中的坐标，由此同一标准色卡，在不同色温情况下在二维坐标系中的坐标不同。由此在不同色温情况下，得到同一标准灰卡的不同坐标点，然后对这些坐标点进行拟合，得到色温曲线。例如，在色温值为2500k的光源下，由标准灰卡的R、G、B值计算出E点。类似的，在色温值为6500k的光源下，标准灰卡的R、G、B计算出A点。以此类推，在多个色温下得到同一标准灰卡在二维坐标系中的不同点，且如图6a所示色温越高标准灰卡在二维坐标系中的点越靠近纵坐标轴且远离横坐标轴，色温越低标准灰卡在二维坐标系中的点越靠近横坐标轴且远离纵坐标轴。由此，能够确定在色温值为2500k的低色温下，E点的位置在色温曲线上靠近横坐标轴且远离纵坐标轴的位置，在色温值为6500k的高色温下，A点的位置在色温曲线靠近纵坐标轴且远离横坐标轴的位置。因此在多个色温下得到同一标准灰卡在二维坐标系中的不同点后，能得到色温曲线上每个点分别对应一个色温。构建色温曲线的同时建立色温曲线上每个点和相应的色温的对应关系，由此通过色温曲线能够找到该曲线上每个点对应的色温。如图6b所示，由于相近颜色的色温接近，为了便于兼容更多的颜色，将色温曲线所在的有限区域称为灰色区域，通过调整光源、灰色区域的轮廓参数等可确定色温曲线的灰色区域范围。灰色区域几乎包括了图像中所有的像素点的色温，若像素点对应的映射点不在灰色区域中，则代表像素点的色温异常，在计算时会将色温异常的像素点排除。例如图6b中的点C在灰色区域之外，若点C在有效点集合之内，则将点C排除，也即，点C不参与确定最终的目标色温。若映射点在灰色区域中，则表示该映射点的色温与对应的色温校准点的色温之间的偏差较小，且映射点在灰色区域中越接近同色温情况下色温曲线上的点，该映射点的色温值越准确。在本申请实施例中，同一图像中不同图像块的映射点所在的集合可能重叠。如图6c所示的失效点集合1和失效点集合2，由于失效点集合1和失效点集合2中的像素点的色温值相近，因此失效点集合1和失效点集合2在二维坐标系中的映射点所在的集合相同，用户通过选择失效点集合1和/或失效点集合2得到的有效点集合也相同。故此，本申请实施例中选择一些图像块基本能够涵盖整个图像中相似或相同图像块的情况，而不必将每个相邻或相似图像块都选择一遍。在本申请实施例中，获取了有效点集合之后，为了便于确定目标色温，可采用有效点集合中的每个点分配权重。实施时，先确定色温校准点，然后基于色温校准点对有效点集合中的各映射点分配权重，然后针对有效点集合中的每个映射点对应的色温值，采用分配的权重和加权求和求均值的方式确定目标色温。实施时，在AWB中计算色温校准点的方式有很多，对此本申请并不进行限制。本申请实施例提供一种确定色温校准点的方式为：根据图像中颜色与标准灰卡相同和相近的像素点的色温值计算色温校准点，根据色温校准点对有效点集合中的映射点分配权重。例如，若图像中与标准灰卡颜色相同和相近的像素点有100个，其中80个像素点分布在色温曲线上色温值为4500k的点附近，则该图像的色温校准点为色温曲线上对应色温值4500k的点。得到色温校准点之后，分配权重时，可通过映射点的坐标值和色温校准点的坐标值计算映射点与色温校准点之间的欧氏距离为有效点集合中的映射点色温分配权重。其中，欧氏距离与权重具有反相关关系，即欧氏距离越大，映射点的权重越小；欧氏距离越小，映射点的权重越大。如图6b所示，点F为色温校准点，点C的与点F的欧式距离比点D与点F的欧氏距离更远，则点C的权重小于点D的权重。在确定有效点集合中的各映射点的权重后，AWB根据权重对有效点集合中的映射点色温加权求均值，得到目标色温。然后，在步骤206中基于目标色温对图像进行校正。由于映射点色温的权重不同，因此目标色温中，与色温校准点的差越大的映射点色温在目标色温中所占的比重越少，与色温校准点越接近的映射点色温在目标色温中所占的比重越大，故而通过加权求均值得到的目标色温与图像中的光源下的标准色温更接近。在本申请中，通过用户自行选择的目标图像块确定色温的方法，可以让用户自行决定图像的色温，避免在AWB操作中，因为误导性颜色区的影响使图像的色温产生偏差。在示例性实施例中，本申请还提供了一种包括指令的计算机可读存储介质，例如包括指令的存储器120，上述指令可由终端设备101的处理器180执行以完成上述白平衡方法。可选地，存储介质可以是非临时性计算机可读存储介质，例如，所述非临时性计算机可读存储介质可以是ROM、随机存取存储器、CD-ROM、磁带、软盘和光数据存储设备等。在示例性实施例中，还提供一种计算机程序产品，包括计算机程序，所述计算机程序被处理器180执行时实现如本申请提供的白平衡方法。本领域内的技术人员应明白，本申请的实施例可提供为方法、系统、或计算机程序产品。因此，本申请可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本申请可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本申请是参照根据本申请的方法、设备、和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。显然，本领域的技术人员可以对本申请进行各种改动和变型而不脱离本申请的精神和范围。这样，倘若本申请的这些修改和变型属于本申请权利要求及其等同技术的范围之内，则本申请也意图包含这些改动和变型在内。
