标题title
一种车云服务实现方法与系统
摘要abst
本发明涉及一种车云服务实现方法与系统，包括：当任一个ECU发布一个本地服务时，中央计算单元通过本地服务的虚拟局域网接收本地服务的SOME/IP报文，并根据预设的整车服务列表判断本地服务是否可以转换为远程服务，若否，则确定本地服务无法提供给云端调用，若是，则将本地服务的SOME/IP报文转换为对应的远程服务的SOME/IP报文，并将其通过远程服务的虚拟局域网发送给Tbox；当Tbox通过远程服务的虚拟局域网接收任一个远程服务的SOME/IP报文时，将远程服务的SOME/IP报文转换为MQTT报文，并将MQTT报文发送至云端，以供云端调用远程服务。通过本发明，能够保证车云服务映射的安全协同，以更好地保障车云协同的服务安全通信。
权利要求书clms
1.一种车云服务实现方法，其特征在于，其基于一种车云服务管理系统实现，所述系统包括设置于车端的中央计算单元、Tbox和多个ECU，所述Tbox与云端之间采用MQTT协议进行通信；所述方法包括如下步骤：当任一个ECU发布一个本地服务时，所述中央计算单元通过本地服务的虚拟局域网接收该本地服务的SOME/IP报文，并根据预设的整车服务列表判断该本地服务是否可以转换为远程服务，若否，则确定该本地服务无法提供给云端调用，若是，则将该本地服务的SOME/IP报文转换为对应的远程服务的SOME/IP报文，并将其通过远程服务的虚拟局域网发送给所述Tbox；当任一个ECU发布一个远程服务时，该ECU将该远程服务的SOME/IP报文通过远程服务的虚拟局域网发送给所述Tbox；当所述Tbox通过远程服务的虚拟局域网接收任一个远程服务的SOME/IP报文时，将该远程服务的SOME/IP报文转换为MQTT报文，并将该MQTT报文发送至云端，以供云端调用该远程服务。2.根据权利要求1所述的方法，其特征在于，所述整车服务列表至少记录多种服务类型、服务标识、多种服务类型所分别包含的各个服务名目、本地服务的各个服务名目与远程服务之间的服务转换信息；其中，每一种服务类型具有对应的服务标识，所述多种服务类型至少包括本地服务和远程服务。3.根据权利要求2所述的方法，其特征在于，所述根据预设的整车服务列表判断该本地服务是否可以转换为远程服务，包括：根据该本地服务的SOME/IP报文确定该本地服务的服务名目，并根据该本地服务的服务名目以及所述服务转换信息确定该本地服务是否可以转换为远程服务。4.根据权利要求2所述的方法，其特征在于，所述将该本地服务的SOME/IP报文转换为对应的远程服务的SOME/IP报文，包括：将该本地服务的SOME/IP报文所包含的服务标识替换为对应的远程服务的服务标识，得到转换后的远程服务的SOME/IP报文。5.根据权利要求1-4中任一项所述的方法，其特征在于，所述远程服务包括远程OEM服务和远程第三方服务；所述方法包括：当任一个ECU发布一个远程OEM服务时，该ECU将该远程OEM服务的SOME/IP报文通过远程OEM服务的虚拟局域网发送给所述Tbox；当任一个ECU发布一个远程第三方服务时，该ECU将该远程第三方服务的SOME/IP报文通过远程第三方服务的虚拟局域网发送给所述Tbox。6.根据权利要求2所述的方法，其特征在于，所述远程OEM服务和所述远程第三方服务均包括认证类服务、非娱乐类服务和娱乐类服务，所述认证类服务、非娱乐类服务和娱乐类服务分别具有不同的服务标识。7.根据权利要求6所述的方法，其特征在于，所述方法还包括：当所述Tbox接收到云端发布的远程服务的MQTT报文，将该远程服务的MQTT报文转换为对应远程服务的SOME/IP报文，并将其发送给中央计算单元；所述中央计算单元对该远程服务的SOME/IP报文进行解析获取其服务标识和服务名目，并根据该服务标识、服务名目和所述整车服务列表执行对应的服务管理策略。8.根据权利要求7所述的方法，其特征在于，所述根据该服务标识、服务名目和所述整车服务列表执行对应的服务管理策略，包括：根据该服务名目以及所述整车服务列表判断是否需要将该远程服务的SOME/IP报文转换为对应的本地服务的SOME/IP报文，若否，则将该远程服务的SOME/IP报文发送给对应的ECU，若是，则将该远程服务的SOME/IP报文的服务标识替换为本地服务的服务标识，得到对应的本地服务的SOME/IP报文，并将其发送给对应的ECU。9.根据权利要求7所述的方法，其特征在于，所述根据该服务标识、服务名目和所述整车服务列表执行对应的服务管理策略，包括：在将云端发布的远程服务的SOME/IP报文发送给对应的ECU时，采用Qos0机制将娱乐类型的远程服务的SOME/IP报文发送给对应的ECU，采用Qos1机制将非娱乐类型的远程服务的SOME/IP报文发送给对应的ECU，以及，采用Qos2机制将认证类型的远程服务的SOME/IP报文发送给对应的ECU。10.一种车云服务实现系统，用于实现权利要求1-9中任一项所述的车云服务实现方法，所述系统包括设置于车端的中央计算单元、Tbox和多个ECU，所述Tbox与云端之间采用MQTT协议进行通信。
说明书desc
技术领域本发明涉及车辆网络技术领域，具体涉及一种车云服务实现方法与系统。背景技术随着车载网络通信技术的快速发展，汽车上车载以太网的应用越来越广泛，信息娱乐系统、智能驾驶系统、整车控制系统等的数据量信号开始采用车载以太网进行传输，对于传统的面向信号的通信已经无法满足软件定义汽车的需求，在汽车车载以太网网络中，面向服务的通信，对于网络中各ECU通信能力、服务处理能力、安全机制处理的要求越来越高。为了满足软件定义汽车以及SOA的开发，车端必须与云端进行服务交互，目前车端主要是采用简单的服务转发，并未提出关于服务映射及处理的安全策略，服务安全仍存在隐患，因此，相关技术还有待改进，以更好地保障车云协同的服务安全通信。发明内容本发明的目的在于提出一种车云服务实现方法与系统，以保证车云服务映射的安全协同，以更好地保障车云协同的服务安全通信。为实现上述目的，本发明的实施例提出一种车云服务实现方法，其基于一种车云服务管理系统实现，所述系统包括设置于车端的中央计算单元、Tbox和多个ECU，所述Tbox与云端之间采用MQTT协议进行通信；所述方法包括如下步骤：当任一个ECU发布一个本地服务时，所述中央计算单元通过本地服务的虚拟局域网接收该本地服务的SOME/IP报文，并根据预设的整车服务列表判断该本地服务是否可以转换为远程服务，若否，则确定该本地服务无法提供给云端调用，若是，则将该本地服务的SOME/IP报文转换为对应的远程服务的SOME/IP报文，并将其通过远程服务的虚拟局域网发送给所述Tbox；当任一个ECU发布一个远程服务时，该ECU将该远程服务的SOME/IP报文通过远程服务的虚拟局域网发送给所述Tbox；当所述Tbox通过远程服务的虚拟局域网接收任一个远程服务的SOME/IP报文时，将该远程服务的SOME/IP报文转换为MQTT报文，并将该MQTT报文发送至云端，以供云端调用该远程服务。优选地，所述整车服务列表至少记录多种服务类型、服务标识、多种服务类型所分别包含的各个服务名目、本地服务的各个服务名目与远程服务之间的服务转换信息；其中，每一种服务类型具有对应的服务标识，所述多种服务类型至少包括本地服务和远程服务。优选地，所述根据预设的整车服务列表判断该本地服务是否可以转换为远程服务，包括：根据该本地服务的SOME/IP报文确定该本地服务的服务名目，并根据该本地服务的服务名目以及所述服务转换信息确定该本地服务是否可以转换为远程服务；优选地，所述将该本地服务的SOME/IP报文转换为对应的远程服务的SOME/IP报文，包括：将该本地服务的SOME/IP报文所包含的服务标识替换为对应的远程服务的服务标识，得到转换后的远程服务的SOME/IP报文。优选地，所述远程服务包括远程OEM服务和远程第三方服务；所述方法包括：当任一个ECU发布一个远程OEM服务时，该ECU将该远程OEM服务的SOME/IP报文通过远程OEM服务的虚拟局域网发送给所述Tbox；当任一个ECU发布一个远程第三方服务时，该ECU将该远程第三方服务的SOME/IP报文通过远程第三方服务的虚拟局域网发送给所述Tbox。优选地，所述远程OEM服务和所述远程第三方服务均包括认证类服务、非娱乐类服务和娱乐类服务，所述认证类服务、非娱乐类服务和娱乐类服务分别具有不同的服务标识。优选地，所述方法还包括：当所述Tbox接收到云端发布的远程服务的MQTT报文，将该远程服务的MQTT报文转换为对应远程服务的SOME/IP报文，并将其发送给中央计算单元；所述中央计算单元对该远程服务的SOME/IP报文进行解析获取其服务标识和服务名目，并根据该服务标识、服务名目和所述整车服务列表执行对应的服务管理策略。优选地，所述根据该服务标识、服务名目和所述整车服务列表执行对应的服务管理策略，包括：根据该服务名目以及所述整车服务列表判断是否需要将该远程服务的SOME/IP报文转换为对应的本地服务的SOME/IP报文，若否，则将该远程服务的SOME/IP报文发送给对应的ECU，若是，则将该远程服务的SOME/IP报文的服务标识替换为本地服务的服务标识，得到对应的本地服务的SOME/IP报文，并将其发送给对应的ECU。优选地，所述根据该服务标识、服务名目和所述整车服务列表执行对应的服务管理策略，包括：在将云端发布的远程服务的SOME/IP报文发送给对应的ECU时，采用Qos0机制将娱乐类型的远程服务的SOME/IP报文发送给对应的ECU，采用Qos1机制将非娱乐类型的远程服务的SOME/IP报文发送给对应的ECU，以及，采用Qos2机制将认证类型的远程服务的SOME/IP报文发送给对应的ECU。本发明的实施例还提出一种车云服务管理系统，用于实现上述的实施例所述的车云服务实现方法，所述系统包括设置于车端的中央计算单元、Tbox和多个ECU，所述Tbox与云端之间采用MQTT协议进行通信。本发明的实施例至少具有以下有益效果：本发明的实施例提出一种车云服务实现方法与系统，通过实现车云服务在不同协议、不同服务类型切换、不同虚拟局域网切换的机制下，可以实现安全、可靠的服务调用，保证了安全相关的服务也可以实现远程调用，以保证车云服务映射的安全协同，使得整车提供的服务可以安全、可靠、高效地提供给用户、第三方开发者、主机厂实现远程调用。本发明的实施例的其它特征和优点将在随后的说明书中阐述。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例中一种车云服务实现方法的流程示意图。图2为本发明实施例中一种车云服务实现方法的应用场景图。图3为本发明实施例中一种远程OEM服务发布和订阅的流程示意图。图4为本发明实施例中一种服务认证流程示意图。具体实施方式以下将参考附图详细说明本公开的各种示例性实施例、特征和方面。另外，为了更好的说明本发明，在下文的具体实施例中给出了众多的具体细节。本领域技术人员应当理解，没有某些具体细节，本发明同样可以实施。在一些实例中，对于本领域技术人员熟知的手段未作详细描述，以便于凸显本发明的主旨。参阅图1，本发明的实施例提出一种车云服务实现方法，其基于一种车云服务管理系统实现，所述系统包括设置于车端的中央计算单元、Tbox和多个ECU，所述Tbox与云端之间采用MQTT协议进行通信；所述方法包括如下步骤：步骤S100、当任一个ECU发布一个本地服务时，所述中央计算单元通过本地服务的虚拟局域网接收该本地服务的SOME/IP报文，并根据预设的整车服务列表判断该本地服务是否可以转换为远程服务，若否，则确定该本地服务无法提供给云端调用，若是，则将该本地服务的SOME/IP报文转换为对应的远程服务的SOME/IP报文，并将其通过远程服务的虚拟局域网发送给所述Tbox；具体而言，所述预设的整车服务列表中会记录哪些本地服务可以转换为远程服务，因此，根据预设的整车服务列表即可以判断该本地服务是否可以转换为远程服务；本实施例中对本地服务和远程服务分别设置了不同虚拟局域网，来提高车端服务的安全管理，所述Tbox无法直接获取本地服务，只有当本地服务被所述中央计算单元转换为对应的远程服务时，所述Tbox才能通过远程服务的虚拟局域网获取该远程服务；步骤S200、当任一个ECU发布一个远程服务时，该ECU将该远程服务的SOME/IP报文通过远程服务的虚拟局域网发送给所述Tbox；具体而言，对于ECU发布的远程服务，所述Tbox能够通过远程服务的虚拟局域网直接获取该远程服务；步骤S300、当所述Tbox通过远程服务的虚拟局域网接收任一个远程服务的SOME/IP报文时，将该远程服务的SOME/IP报文转换为MQTT报文，并将该MQTT报文发送至云端，以供云端调用该远程服务。更具体地，在一些实施例中，参阅图2，所述云端包括主机厂云、第三方云和MQTT代理器，所述Tbox与云端的所述MQTT代理器之间采用MQTT协议进行通信，所述主机厂云、第三方云在发布服务或调用车端服务时，均通过所述MQTT代理器来实现，举例而言，在步骤S300中，所述Tbox将该MQTT报文发送至云端，所述MQTT代理器接收该MQTT报文，并对其进行解析，解析后的结果发送给所述主机厂云或第三方云。更具体地，在一些实施例中，所述整车服务列表至少记录多种服务类型、服务标识、多种服务类型所分别包含的各个服务名目、本地服务的各个服务名目与远程服务之间的服务转换信息；其中，每一种服务类型具有对应的服务标识，所述多种服务类型至少包括本地服务和远程服务，所述远程服务包括远程OEM服务和远程第三方服务，所述远程OEM服务用于主机厂服务调用，所述远程第三方服务用于第三方开发者调用，并且，所述远程OEM服务和所述远程第三方服务分别设置有不同虚拟局域网VLAN。需说明的是，由中央计算单元发布到云端的服务只能是整车服务列表中的远程OEM服务或远程第三方服务类型，不能为本地服务类型。举例而言，所述所述整车服务列表如下表1所示：表1具体地，表1中服务标识1/2/3分别对应不同细分类型的远程OEM服务，表1中服务标识4/5/6分别对应不同细分类型的远程第三方服务，服务明目例如是外灯控制，又例如是温度控制，等等，此处不进行穷举；更具体地，在一些实施例中，所述根据预设的整车服务列表判断该本地服务是否可以转换为远程服务，包括：根据该本地服务的SOME/IP报文确定该本地服务的服务名目，并根据该本地服务的服务名目以及所述服务转换信息确定该本地服务是否可以转换为远程服务。具体而言，通过根据该本地服务的服务名目查询整车服务列表中的服务转换信息，确定该本地服务的服务名目是否可以转换为哪一种的远程服务。更具体地，在一些实施例中，所述将该本地服务的SOME/IP报文转换为对应的远程服务的SOME/IP报文，包括：将该本地服务的SOME/IP报文所包含的服务标识替换为对应的远程服务的服务标识，得到转换后的远程服务的SOME/IP报文。更具体地，在一些实施例中，所述方法包括：当任一个ECU发布一个远程OEM服务时，该ECU将该远程OEM服务的SOME/IP报文通过远程OEM服务的虚拟局域网发送给所述Tbox；当任一个ECU发布一个远程第三方服务时，该ECU将该远程第三方服务的SOME/IP报文通过远程第三方服务的虚拟局域网发送给所述Tbox。具体而言，本实施例中采用服务标识来区分不同的服务类型，因此，在将本地服务转换为远程服务时，只需要将其服务标识替换为对应的远程OEM服务或远程第三方服务的服务标识即可，然后通过远程OEM服务或远程第三方服务的虚拟局域网发送给Tbox。更具体地，在一些实施例中，所述远程OEM服务和所述远程第三方服务均包括认证类服务、非娱乐类服务和娱乐类服务，所述认证类服务、非娱乐类服务和娱乐类服务分别具有不同的服务标识；具体而言，所述远程OEM服务的认证类服务、非娱乐类服务和娱乐类服务分别对应表1中的服务标识1、2、3；所述远程第三方服务的认证类服务、非娱乐类服务和娱乐类服务分别对应表1中的服务标识4、5、6；需说明的是，对应认证类服务，在云端进行调用时，所述中央计算单元需要对其进行认证，只有认证通过，才允许调用。更具体地，在一些实施例中，所述方法还包括：当所述Tbox接收到云端发布的远程服务的MQTT报文，将该远程服务的MQTT报文转换为对应远程服务的SOME/IP报文，并将其发送给中央计算单元；所述中央计算单元对该远程服务的SOME/IP报文进行解析获取其服务标识和服务名目，并根据该服务标识、服务名目和所述整车服务列表执行对应的服务管理策略；在本实施例中，所述根据该服务标识、服务名目和所述整车服务列表执行对应的服务管理策略，包括：根据该服务名目以及所述整车服务列表判断是否需要将该远程服务的SOME/IP报文转换为对应的本地服务的SOME/IP报文，若否，则将该远程服务的SOME/IP报文发送给对应的ECU，若是，则将该远程服务的SOME/IP报文的服务标识替换为本地服务的服务标识，得到对应的本地服务的SOME/IP报文，并将其发送给对应的ECU。更具体地，在一些实施例中，所述根据该服务标识、服务名目和所述整车服务列表执行对应的服务管理策略，包括：在将云端发布的远程服务的SOME/IP报文发送给对应的ECU时，采用Qos0机制将娱乐类型的远程服务的SOME/IP报文发送给对应的ECU，采用Qos1机制将非娱乐类型的远程服务的SOME/IP报文发送给对应的ECU，以及，采用Qos2机制将认证类型的远程服务的SOME/IP报文发送给对应的ECU。具体而言，Qos0机制的具体内容如下表2所示：表2云端-MQTT-Qos车端-SOME/IP-子服务类型QoS0，At most once，至多一次娱乐类服务QoS1，At least once，至少一次非娱乐类服务QoS2，Exactly once，确保只有一次认证类服务其中，QoS0代表，Sender发送的一条消息，Receiver最多能收到一次，也就是说Sender尽力向Receiver发送消息，如果发送失败，也就算了；其中，QoS1代表，Sender发送的一条消息，Receiver至少能收到一次，也就是说Sender向Receiver发送消息，如果发送失败，会继续重试，直到Receiver收到消息为止，但是因为重传的原因，Receiver有可能会收到重复的消息；其中，QoS2代表，Sender发送的一条消息，Receiver确保能收到而且只收到一次，也就是说Sender尽力向Receiver发送消息，如果发送失败，会继续重试，直到Receiver收到消息为止，同时保证Receiver不会因为消息重传而收到重复的消息。在本实施例中，Sender指的是发送报文的中央计算单元，Receiver指的是接收报文的ECU。下面列举一个云端主机厂云订阅车端服务的例子进行解释说明，以下仅以订阅过程为示意包含，本发明包含但不限于订阅等过程，例如还有服务发送、服务应答等；参阅图3，订阅的过程如下步骤所示：步骤S01：ECU1发布远程OEM服务A/本地服务A；步骤S02：对于本地服务，由于与远程服务不在同一虚拟局域网VLAN中，所述Tbox无法获取该本地服务，所述中央计算单元会根据整车服务列表清单判断，该本地服务是否可转换为远程OEM服务，若否，则此服务无法提供给云端调用，若是，则会继续判断属于远程OEM服务中的哪种类型，对服务标识进行替换，并转发到远程OEM服务的VLAN中去，以下为服务标识替换示意：标识00替换为标识01；步骤S03：Tbox接收到远程OEM服务A，将该远程OEM服务A的SOME/IP报文转换为MQTT报文，在整个SOME/IP报文中增加一个MQTT报文头，并根据远程OEM服务的服务标识，将MQTT的主题名设置为服务标识，将Qos的等级根据服务标识中的标识设置，发布订阅主题A到云端的MQTT代理器；步骤04：APP或后台需要订阅远程OEM服务A时，发送MQTT订阅主题A报文到云端的MQTT代理器；步骤05：云端的MQTT代理器转发MQTT订阅主题A报文到Tbox；步骤06：所述Tbox接收到订阅主题A报文，剥去MQTT报文头得到SOME/IP订阅服务A，并发送SOME/IP订阅服务A报文到中央计算单元；步骤07：所述中央计算单元根据SOME/IP订阅服务A的服务标识进行判断，若为认证类服务，需进行APP或后台认证，同时由于认证类服务对应的MQTT的Qos2，此时，所述中央计算单元需进行数据监控，并进行认证，认证方法示意如图4，其中，认证的错误次数在一定阈值下，如果超过一定阈值，此服务将会暂停提供一段时间；若认证过程及认证完成后的服务通信过程中存在报文重复接收，中央计算单元需立刻终止此服务提供；若为非娱乐类服务，由于非娱乐类服务对应的MQTT的Qos1，中央计算单元需进行数据监控，若服务通信过程中存在报文重复接收，需主动丢弃重复报文，并不影响服务运行；若为娱乐类服务，由于娱乐类服务对应的MQTT的Qos0，中央计算单元无需进行数据监控；步骤08：所述中央计算单元根据订阅服务A的服务标识进行判断，若服务标识存在整车服务列表清单的远程OEM服务，此时提供服务A的ECU1和所述Tbox在同一虚拟局域网VLAN中，所述中央计算单元之间二层交换到ECU1中去，若服务标识不存在整车服务列表清单的远程OEM服务，所述中央计算单元需对服务标识进行替换，过程参照上述步骤02，与其标识替换为反向替换，同时，对虚拟局域网VLAN标签进行替换，并将替换后的报文转发到本地服务的虚拟局域网VLAN中去；步骤09：ECU1收到订阅服务A的SOME/IP报文，ECU1回复订阅确认报文给所述中央计算单元；步骤10：所述中央计算单元进行转发到所述Tbox，过程参考上述步骤02；步骤11：所述Tbox接收到服务订阅确认报文A，将订阅确认报文A的SOME/IP报文转换为MQTT，过程参考上述步骤03；步骤12：云端转发MQTT订阅主题A确认报文到APP或后台；步骤13：APP或后台接收到订阅确认报文，此时服务A订阅完成；步骤14：ECU1发送服务A事件报文到APP或后台，发送路径中涉及的转换过程及处理逻辑参考以上步骤。以上步骤S01～S14仅为ECU发布服务以及后台或APP如何订阅ECU发布的服务的举例，通过该例子可以更好地理解本发明实施例的主旨/构思。本发明的另一实施例还提出一种车云服务管理系统，用于实现上述的实施例所述的车云服务实现方法，所述系统包括设置于车端的中央计算单元、Tbox和多个ECU，所述Tbox与云端之间采用MQTT协议进行通信。以上所描述的实施例的系统仅仅是示意性的，其中所述作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部模块来实现实施例的系统的方案的目的。需说明的是，上述实施例的系统与上述实施例的方法对应，因此，上述实施例的系统未详述部分可以参阅上述实施例的方法的内容得到，即上述实施例的方法记载的具体步骤内容可以理解为上述实施例的系统所能够实现的功能，此处不再赘述。并且，上述实施例车云服务管理系统若以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。通过以上描述可知，本发明的各实施例通过实现车云服务在不同协议、不同服务类型切换、不同虚拟局域网切换的机制下，可以实现安全、可靠的服务调用，保证了安全相关的服务也可以实现远程调用，以保证车云服务映射的安全协同，使得整车提供的服务可以安全、可靠、高效地提供给用户、第三方开发者、主机厂实现远程调用。以上已经描述了本发明的各实施例，上述说明是示例性的，并非穷尽性的，并且也不限于所披露的各实施例。在不偏离所说明的各实施例的范围和精神的情况下，对于本技术领域的普通技术人员来说许多修改和变更都是显而易见的。本文中所用术语的选择，旨在最好地解释各实施例的原理、实际应用或对市场中的技术改进，或者使本技术领域的其它普通技术人员能理解本文披露的各实施例。
