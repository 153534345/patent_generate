标题title
一种摄像头芯片表面黑点补偿方法
摘要abst
本发明提供一种摄像头芯片表面黑点补偿方法，包括获取摄像头模组在纯白色画面下的RAW图像，将RAW图像分拆成多个通道；针对每一通道，计算每一像素点的单点亮度值；计算以每一像素点为中心的一个模块的模块平均亮度值，根据像素点的单点亮度值以及模块平均亮度值确定该像素点的亮度值是否需要补偿，如需要补偿，则计算该像素点的补偿系数；对补偿系数进行验证；将需要补偿的像素点的位置以及该像素点的补偿系数写入芯片烧录数据中；电子设备应用摄像头模组拍摄照片时，记录需要补偿的像素点的位置并获取该像素点对应的补偿系数，应用补偿系数对该像素点的亮度值进行补偿。本发明能够有效的对摄像头芯片的黑点进行补偿，提升摄像头芯片的良品率。
权利要求书clms
1.一种摄像头芯片表面黑点补偿方法，包括：获取摄像头模组在纯白色画面下的RAW图像，将所述RAW图像分拆成多个通道；针对每一所述通道，计算每一像素点的单点亮度值；其特征在于：计算以每一所述像素点为中心的一个预设大小的模块的模块平均亮度值，根据所述像素点的单点亮度值以及所述模块平均亮度值确定该像素点的亮度值是否需要补偿，如需要补偿，则计算该像素点的补偿系数；对所述补偿系数进行验证；将需要补偿的像素点的位置以及该像素点的补偿系数写入芯片烧录数据中；电子设备应用所述摄像头模组拍摄照片时，记录需要补偿的像素点的位置并获取该像素点对应的补偿系数，应用所述补偿系数对该像素点的亮度值进行补偿。2.根据权利要求1所述的一种摄像头芯片表面黑点补偿方法，其特征在于：根据所述像素点的单点亮度值以及所述模块平均亮度值确定该像素点的亮度值是否需要补偿包括：计算所述单点亮度值与所述模块平均亮度值的差值，如果差值在下限阈值与上限阈值之间，则确定该像素点的亮度值需要补偿。3.根据权利要求2所述的一种摄像头芯片表面黑点补偿方法，其特征在于：所述像素点的所述补偿系数为所述模块平均亮度值与所述单点亮度值的比值乘以烧录系数。4.根据权利要求3所述的一种摄像头芯片表面黑点补偿方法，其特征在于：所述烧录系数为预设值，且所述预设值为0.9至1.1之间。5.根据权利要求2至4任一项所述的一种摄像头芯片表面黑点补偿方法，其特征在于：如所述单点亮度值与所述模块平均亮度值的差值小于所述下限阈值，则确认该像素点不需要补偿。6.根据权利要求2至4任一项所述的一种摄像头芯片表面黑点补偿方法，其特征在于：如所述单点亮度值与所述模块平均亮度值的差值大于所述上限阈值，则确认所述摄像头模组无法使用。7.根据权利要求2至4任一项所述的一种摄像头芯片表面黑点补偿方法，其特征在于：对所述补偿系数进行验证包括：断电并重新上电后，读取需要补偿的所述像素点的单点亮度值，并使用所述补偿系数对所述单点亮度值进行补偿得到补偿亮度值，得到新的RAW图像；计算新的RAW图像中，是否所有像素点的所述补偿亮度值与经过补偿后的模块平均亮度值的差值均小于所述下限阈值，如是，确认所述补偿系数通过验证。8.根据权利要求7所述的一种摄像头芯片表面黑点补偿方法，其特征在于：如确认某一像素点的补偿系数不通过验证，则对该像素点的补偿系数进行调整。9.根据权利要求1至4任一项所述的一种摄像头芯片表面黑点补偿方法，其特征在于：将需要补偿的像素点的位置以及该像素点的补偿系数写入芯片烧录数据时，还将该像素点的所述单点亮度值以及所述模块平均亮度值写入所述烧录数据。10.根据权利要求1至4任一项所述的一种摄像头芯片表面黑点补偿方法，其特征在于：以所述像素点为中心的模块的大小为9×9。
说明书desc
技术领域本发明涉及摄像头芯片的补偿处理技术领域，具体的，涉及一种摄像头芯片表面黑点补偿方法。背景技术现有很多智能电子设备具有图像拍摄的功能，例如智能手机、平板电脑、行车记录仪等均设置有摄像装置，摄像装置通常设置摄像头芯片，通过摄像头芯片来拍摄图像。然而，受到摄像头芯片生产工艺的影响，在摄像头芯片的表面上难免形成黑点。随着智能手机技术的发展，对摄像头芯片的质量要求越来越高，对摄像头芯片表面黑点的要求越来越严格，例如要求摄像头芯片表面的黑点数量提出非常严格的要求。随着摄像头芯片的质量要求越来越高，摄像头芯片的不良率随之上升，不良的摄像头芯片往往只能报废，对摄像头芯片的制造厂家造成较大的损失。为此，人们在考虑通过对摄像头芯片进行补偿，例如通过软件算法的方式进行补偿，以解决摄像头芯片黑点的问题。目前，对摄像模组校准的方法很多，例如公开号为CN112601079A的中国发明专利申请公开了一种摄像模组的校准方法，该方法获取目标模组拍摄的测试图，并对测试图进行通道值区域划分；根据通道值区域计算出各个通道值区域的通道值；根据通道值和设定模组的设定值，确定出各个通道值区域的补偿系数；采用补偿系数对目标模组进行补偿以校准目标模组。然而，该方法仅仅是针对每一个通道进行补偿，并没有针对单个像素点是否为黑点进行判断，即没有判断每一个像素点自身是否为异常的像素点，对像素点的补偿并不准确。发明内容针对现有技术的不足，本发明提供一种摄像头芯片表面黑点补偿方法，以提高异常像素点的补偿准确性。为实现上述目的，本发明通过以下技术方案予以实现：一种摄像头芯片表面黑点补偿方法，包括：获取摄像头模组在纯白色画面下的RAW图像，将RAW图像分拆成多个通道；针对每一通道，计算每一像素点的单点亮度值；并且，计算以每一像素点为中心的一个预设大小的模块的模块平均亮度值，根据像素点的单点亮度值以及模块平均亮度值确定该像素点的亮度值是否需要补偿，如需要补偿，则计算该像素点的补偿系数；对补偿系数进行验证；将需要补偿的像素点的位置以及该像素点的补偿系数写入芯片烧录数据中；电子设备应用摄像头模组拍摄照片时，记录需要补偿的像素点的位置并获取该像素点对应的补偿系数，应用补偿系数对该像素点的亮度值进行补偿。优选的，根据像素点的单点亮度值以及模块平均亮度值确定该像素点的亮度值是否需要补偿包括：计算单点亮度值与模块平均亮度值的差值，如果差值在下限阈值与上限阈值之间，则确定该像素点的亮度值需要补偿。优选的，像素点的补偿系数为模块平均亮度值与单点亮度值的比值乘以烧录系数。优选的，烧录系数为预设值，且预设值为0.9至1.1之间。优选的，如单点亮度值与模块平均亮度值的差值小于下限阈值，则确认该像素点不需要补偿。优选的，如单点亮度值与模块平均亮度值的差值大于上限阈值，则确认摄像头模组无法使用。优选的，对补偿系数进行验证包括：断电并重新上电后，读取需要补偿的像素点的单点亮度值，并使用补偿系数对单点亮度值进行补偿得到补偿亮度值，得到新的RAW图像；计算新的RAW图像中，是否所有像素点的补偿亮度值与经过补偿后的模块平均亮度值的差值均小于下限阈值，如是，确认补偿系数通过验证。优选的，如确认某一像素点的补偿系数不通过验证，则对该像素点的补偿系数进行调整。优选的，将需要补偿的像素点的位置以及该像素点的补偿系数写入芯片烧录数据时，还将该像素点的单点亮度值以及模块平均亮度值写入烧录数据。优选的，以像素点为中心的模块的大小为9×9。与现有技术相比，本发明的有益效果是：本发明针对每一个通道的每一像素点，单独计算各个像素点的单点亮度值以及模块平均亮度值，由于模块平均亮度值是以一个像素点为中心的模块，计算的模块平均亮度值更加能够贴近于该像素点周边的其他像素点的亮度值，因此，通过对比根据像素点的单点亮度值以及模块平均亮度值能够准确的确定该像素点的亮度值是否异常，针对异常的像素点，则根据情况确定是否需要补偿，使得补偿计算更加准确。另外，本发明并不是针对所有异常的像素点均进行补偿，只有单点亮度值以及模块平均亮度值的差值在特定范围内的像素点才会补偿，如果单点亮度值以及模块平均亮度值的差值过大，则不需要进行补偿。此外，本发明还针对补偿系数进行验证，从而确保补偿后的像素点能够满足要求，提高补偿质量。附图说明图1是本发明方法实施例的流程图。图2是摄像头芯片没有异常情况下在纯白色画面下形成的图像。图3是应用本发明方法实施例进行亮度补偿前的图像。图4是应用本发明方法实施例获取的RAW图像。图5是应用本发明方法实施例分拆成四个通道的图像示意图。图6是应用本发明方法实施例异常像素点的示意图。图7是应用本发明方法实施例以异常像素点为中心的3×3模块的示意图。图8是应用本发明方法实施例进行亮度补偿后的图像。图9是实现本发明实施例的装置结构框图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。本发明应用在具有摄像头的电子设备上，例如智能手机、平板电脑等，电子设备设置有摄像头芯片。参见图1，本发明的方法首先执行步骤S1，获取摄像头芯片在纯白色画面下的RAW图像。例如，摄像头模组在在G4C光源板下点亮，保存纯白画面下的RAW图像。如果摄像头芯片没有异常，即没有存在黑点，在纯白色画面下获得的图像如图2所示。如果摄像头芯片存在异常的像素点，即该像素点为黑点，则在图像中形成一个黑色的斑点，如图3所示。形成黑色斑点的区域就是异常像素点所在的区域，本发明主要针对异常像素点进行补偿，以消除黑色像素点。获取在纯白色画面下的RAW图像后，执行步骤S2，将RAW图像划分为多个通道。参见图4，RAW图像包括大量的像素点，每一个像素点为一种颜色，例如红色R、绿色Gr、绿色Gb、蓝色B，相邻的四个像素点分别为四个颜色中的一个，依据每一个像素点的颜色，将RAW图像划分为四个通道，每一个通道具有一种颜色，如图5所示，将图4中所有红色R的像素点提取出来，形成红色R通道的像素点；如图5所示，将图4中所有绿色Gr的像素点提取出来，形成绿色Gr通道的像素点；如图5所示，将图4中所有绿色Gb的像素点提取出来，形成绿色Gb通道的像素点；如图5所示，将图4中所有蓝色B的像素点提取出来，形成蓝色B通道的像素点。接着，执行步骤S3，针对每一个通道，按照从左往右、从上往下遍历每一个像素点，并计算每个像素点的单点亮度值Bpixel，每个像素点的单点亮度值Bpixel就是自身的亮度值。如图6所示，虚线框内的像素点为异常像素点，该像素点的亮度值明显大于同一通道的相邻的其他像素点的亮度值。并且，计算每一个像素点的模块平均亮度值Bblock。具体的，以每一个像素点为中心，建立一个预设大小的模块，例如以一个像素点为中心，构建一个大小为9×9的模块，然后计算该模块中每一个像素点的亮度值的平均值，以该平均值作为该模块中心的像素点的模块平均亮度值Bblock。图7示意性的显示了以一个异常的像素点为中心的3×3的模块，即虚线框内的模块。接着，根据每一个像素点的单点亮度值Bpixel以及模块平均亮度值Bblock确定该像素点是否异常的像素点，并确定是否需要对该像素点进行补偿。具体的，如果某一个像素点是异常像素点，则该像素点的亮度值将大于周边像素点的亮度值，因此，该像素点的单点亮度值Bpixel会大于对应的模块平均亮度值Bblock，因此，只需要计算一个像素点的单点亮度值Bpixel以及模块平均亮度值Bblock之间的差值，即可以快速的计算出该像素点是否为异常的像素点。具体的，预先设置一个下限阈值A以及一个上限阈值B，如果一个像素点的单点亮度值Bpixel以及模块平均亮度值Bblock之间的差值小于下限阈值A，则可以确定该像素点没有异常，不需要做任何处理；如果一个像素点的单点亮度值Bpixel以及模块平均亮度值Bblock之间的差值大于下限阈值A，并且小于上限阈值B，则确认该像素点为异常像素点，但还可以通过补偿的方式进行处理；如果一个像素点的单点亮度值Bpixel以及模块平均亮度值Bblock之间的差值大于上限阈值B，则确认该像素点为异常像素点，且已经无法通过补偿的方式进行处理，摄像头模块只能够报废处理。因此，本实施例主要是针对第二种情况，即像素点的单点亮度值Bpixel以及模块平均亮度值Bblock之间的差值大于下限阈值A，并且小于上限阈值B的情况，对该像素点进行补偿计算。针对这种情况，本实施例需要计算该像素点的补偿系数，即执行步骤S5。具体的，应用该像素点的单点亮度值Bpixel以及模块平均亮度值Bblock计算该像素点的补偿系数Bratio。具体的，像素点的补偿系数Bratio是该像素点的模块平均亮度值Bblock与该像素点的单点亮度值Bpixel的比值乘以烧录系数K，其中，烧录系数优选为0.9至1.1之间，更优选的，烧录系数K为1，当然，可以根据不同烧录平台进行微调。针对每一个像素点均执行是否为异常像素点的判断计算，一旦确认该像素点是异常像素点且可以补偿，则按照上述步骤计算该像素点的补偿系数Bratio。由于上述步骤计算的补偿系数Bratio是初步计算获得的补偿系数，该补偿系数不一定准确，为此，本实施例还需要执行验证操作。具体的，记录每一个异常且可以补偿的像素点的坐标，并将该像素点的单点亮度值Bpixel、模块平均亮度值Bblock以及补偿系数Bratio烧录到摄像头芯片的一次性烧录数据中。其中，像素点的坐标包括像素点横坐标和纵坐标，具体的，以第一个像素点为在坐标轴的原点，以芯片的长边作为X轴，即横轴，以芯片的短边作为Y轴，即纵轴，计算出像素点的坐标，该坐标包括X轴坐标和Y轴坐标。然后，对摄像头模组断电，在重新上电以后，读取需要补偿的像素点的单点亮度值，并使用该像素点的补偿系数Bratio对该单点亮度值进行补偿得到补偿亮度值，使用该像素点的补偿亮度值替代该像素点的单点亮度值Bpixel由此得到新的RAW图像。接着，计算新的RAW图像中，是否所有像素点的补偿亮度值与经过补偿后的模块平均亮度值的差值均小于下限阈值A，如是，确认所有像素点的补偿系数均通过验证。当然，如确认某一像素点的补偿系数不通过验证，则对该像素点的补偿系数进行调整，并重新进行验证。如果所有需要补偿的像素点的补偿系数均通过验证，则执行步骤S6，将所有需要补偿的像素点的坐标、单点亮度值Bpixel、模块平均亮度值Bblock以及补偿系数Bratio烧录到摄像头芯片的一次性烧录数据中。最后，当电子设备使用摄像头芯片进行拍照的时候，读取摄像头芯片内存储的一次性烧录信息，包括异常像素点的坐标、单点亮度值Bpixel、模块平均亮度值Bblock以及补偿系数Bratio等数据。并且执行步骤S7，记录需要补偿的像素点的位置，并且使用该像素点对应的Bratio计算该像素点的补偿亮度值，具体的，获取该像素点的实际亮度值，然后使用实际亮度值乘以补偿系数Bratio得到该像素点的补偿亮度值，使用补偿亮度值替代实际亮度值，由此获得补偿后的RAW图像，将补偿后的RAW图像呈现给用户，从而实现摄像头芯片表面黑点的补偿。经过补偿计算后的图像如图8所示，图像中明显的黑点消失，满足拍摄的要求。参见图9，摄像头芯片内设置一个图像获取模块11、测试计算模块12，其中，图像获取模块11用于获取摄像头芯片所拍摄的RAW图像，测试计算模块12用于检测每一个像素点是否为异常像素点，如果是异常像素点并且可以通过补偿的方式处理，则按照上述的方式进行补偿计算，即确定该像素点的补偿系数。本实施例应用补偿信息烧录模块13将需要补偿的像素点的信息，包括像素点的坐标、补偿系数等写入到烧录信息中。在手机等电子设备上设置有实际应用模块14，当电子设备拍摄图像时，实际应用模块14获取每一个需要补偿的像素点的坐标，并且获取该像素点对应的补偿系数，应用该补偿系数计算相应像素点的补偿亮度值，使用补偿亮度值替代该像素点的实际亮度值，生成最终的RAW图像。可见，应用本发明的方法可以对摄像头芯片表面黑点进行补偿，通过补偿的方式可以避免摄像头芯片黑点的情况，可以提升摄像头芯片的良品率，减少摄像头芯片报废的情况。需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。尽管已经示出和描述了本发明的实施例，对于本领域的普通技术人员而言，可以理解在不脱离本发明的原理和精神的情况下可以对这些实施例进行多种变化、修改、替换和变型，本发明的范围由所附权利要求及其等同物限定。
