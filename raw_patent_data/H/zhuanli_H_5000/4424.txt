标题title
基于质量感知的自适应全向视频流方法
摘要abst
本发明公开一种基于质量感知的自适应全向视频流方法，考虑了全向视频特有的两种质量决定因素——视点移动和亮度变化，并采用用户调查研究来量化该特征对主观感知质量的影响。通过引入上述两种特征对SSIM度量进行改进，建立了用户感知质量模型。在MPC算法对每个视频块决策的基础上，对视频块内所有的区域进行质量分配，以最大化总体视频块的SSIM质量。本发明能够对视频区域实现更合理的质量分配，进一步提高流媒体资源利用率和用户体验质量。
权利要求书clms
1.基于质量感知的自适应全向视频流方法，其特征是，包括步骤如下：步骤1、先使用常用的对称投影法将全向视频文件投影到二维平面；再将投影后的视频文件切割成多个等长的视频块，并将每个视频块转码为不同的比特率级别；步骤2、将各个比特率级别的视频块每个视频帧从空间上切割成多个视频区域，并将每个视频区域进一步从空间上切割成多个视频窗口；步骤3、基于全向视频文件预先给定的视点轨迹，计算各个比特率级别视频块的每个视频帧的每个像素点的相对视点移动速度和视点亮度变化，其中：vb＝|vu-v0b|lb＝|lub-lmb|步骤4、计算各个比特率级别下各个视频区域的相对视点移动速度和视点亮度变化，其中：步骤5、计算各个比特率级别下视频帧的每个像素点的基于视点的刚刚可见差异阈值，其中：步骤6、计算各个比特率级别下各个视频窗口的权重，其中：步骤7、计算各个比特率级别下各个视频窗口的用户感知质量，其中：步骤8、计算各个比特率级别下各个视频区域的用户感知质量，其中：步骤9、基于步骤4所得到的相对视点移动速度和视点亮度变化与步骤8所得到的用户感知质量，建立各个比特率级别下各个视频区域的相对视点移动速度和视点亮度变化的用户感知质量查询表；步骤10、使用ABR算法将视频块的自适应比特率决策建模为一个基于模型预测控制的最优化问题，通过求解该最优化问题确定每个视频块的比特率，即相应地确定了视频块的每个视频帧的比特率；步骤11、基于当前用户的历史视点位置使用现有的线性回归方法预测未来时间点的视点位置，并使用当前时间点的过去m秒的最低视点移动速度作为未来时间点视点移动速度的预测值，最后采用步骤3和4相同的公式计算各个比特率级别下所有视频区域的相对视点移动速度和视点亮度变化；步骤12、计算步骤11所得的各个比特率级别下所有视频区域的相对视点移动速度和视点亮度变化与步骤4所得的相应比特率级别下对应视频区域的相对视点移动速度和视点亮度变化的欧式距离，并利用步骤9所构建的用户感知质量查询表确定欧式距离最小的视频区域对应的用户感知质量，最终可以得到各个比特率级别下所有视频区域的用户感知质量；步骤13、基于步骤10所确定的视频块的比特率和步骤12所确定的各个比特率级别下所有视频区域的用户感知质量，在视频块的所有视频帧的所有视频区域的总质量低于或等于该视频块比特率的情况下，以最大化视频块的总体用户感知质量为目标，进一步确定视频块的所有视频帧中各个视频区域的质量；上述式中，vb表示比特率级别b下像素点的相对视点移动速度，lb表示比特率级别b下像素点的视点亮度变化，vu表示用户视点移动速度，v0b表示比特率级别b下像素点处对象的运动速度，lub表示比特率级别b下像素点处的亮度，lmb表示比特率级别b下m秒前视点所在视频区域所有像素点的平均亮度，m为设定值，||表示绝对值符号；表示比特率级别b下视频区域i的相对视点移动速度，表示比特率级别b下视频区域i的视点亮度变化，N为视频区域i的所有像素点数量；JNDb表示比特率级别b下像素点的基于视点的刚刚可见差异阈值，CJNDb表示比特率级别b下像素点的基于视频内容特性的刚刚可见差异阈值，a表示给定的非零常数；表示比特率级别b下视频区域i的第j个视频窗口的权重，i表示视频区域的编号，j表示视频窗口的编号，Nij表示视频区域i的第j个视频窗口的所有像素点数量；表示比特率级别b下视频区域i的第j个视频窗口的用户感知质量；表示比特率级别b下视频区域i的第j个视频窗口所有像素点灰度的均值，表示源视频比特率o下视频区域i的第j个视频窗口所有像素点灰度的均值；表示比特率级别b下视频区域i的第j个视频窗口所有像素点灰度的方差，表示源视频比特率o下视频区域i的第j个视频窗口所有像素点灰度的方差；表示比特率级别b下与源视频比特率o下与视频区域i的第j个视频窗口所有像素点灰度的协方差；a1、a2均为给定的非零常数；表示比特率级别b下视频区域i的用户感知质量；Ni表示视频区域i的所有视频窗口数量。2.根据权利要求1所述的基于质量感知的自适应全向视频流方法，其特征是，步骤10所构建的优化问题为：max-β*Rebuf-γ*Smooth))式中，bt为当前待决策的第t个视频块的比特率，Q表示比特率bt下第t个视频块的视频质量，Rebuf表示比特率bt下第t个视频块的卡顿时间，Smooth)表示比特率bt下第t个视频块的质量平滑度，α表示视频质量权重，β表示卡顿时间权重，γ表示质量平滑度权重。3.根据权利要求1所述的基于质量感知的自适应全向视频流方法，其特征是，步骤12的欧氏距离Di为：式中，表示步骤9用户感知质量查询表中比特率级别b下视频区域i的相对视点移动速度，表示步骤9用户感知质量查询表中比特率级别b下视频区域i的视点亮度变化，N为视频区域i的像素点数量；表示步骤11预测的视频区域i的相对视点移动速度，表示步骤11预测的视频区域i的视点亮度变化；Di表示欧式距离。4.根据权利要求1所述的基于质量感知的自适应全向视频流方法，其特征是，步骤13的目标函数为：式中，i为当前待决策的视频区域编号，M为视频块中视频区域的数量，Si表示当前待决策视频区域i的尺寸大小，bti为当前待决策视频区域i的比特率，表示比特率级别bti下当前待决策视频区域i的用户感知质量，bt为视频块的比特率。
说明书desc
技术领域本发明涉及流媒体传输技术领域，具体涉及一种基于质量感知的自适应全向视频流方法。背景技术近年来，全向视频已逐渐成为新兴的互联网流量之一。同时，全向视频流的传输比传统视频流更具挑战性。为了创造全景体验，全向视频必须以高分辨率、无卡顿的方式流式传输全景内容，这将产生大量的带宽和资源消耗。在自适应传输过程中，首先将全向视频投影为普通的二维平面视频，然后在时间上将其切割成视频块。对于每个视频块，编码器将其转码为多个比特率级别。最后，在空间上将各个比特率级别的视频块进一步切割成视频区域。与传统的自适应方法类似，视频播放器可以在两个连续视频区域的边界处动态地切换质量级别，以应对网络带宽的波动。目前的大多数自适应算法均采用视点驱动的方法，其中只有视点区域中的视频内容以高质量进行流式传输。但这类方法具有以下局限性：首先，视点区域通常比电脑屏幕大得多，在相同质量下，流式传输视点区域的内容仍需要至少两倍于普通视频的带宽；其次，由于需要预取视点区域的内容，播放器必须预测用户行为，而任何预测误差都可能导致用户体验质量的下降；最后，为了适应视点的移动，全向视频必须在空间上进行切割，并被转码为多个质量级别，这将大大增加视频的大小。由于用户对全向视频质量的感知方式与普通视频不同，受视点移动的独特影响，该特性有助于进一步降低带宽需求并提高用户体验质量。因此，现有的自适应全向视频流传输算法在资源分配和最大化QoE方面仍存在一定的缺陷，无法满足当前高质量全向流媒体服务的部署和发展要求。故急需一种更科学、高效的自适应全向视频流方法。发明内容本发明所要解决的是目前自适应全向视频流方法存在的资源利用率低、视频服务质量低等问题，提供一种基于质量感知的自适应全向视频流方法。为解决上述问题，本发明是通过以下技术方案实现的：基于质量感知的自适应全向视频流方法，包括步骤如下：步骤1、先使用常用的对称投影法将全向视频文件投影到二维平面；再将投影后的视频文件切割成多个等长的视频块，并将每个视频块转码为不同的比特率级别；步骤2、将各个比特率级别的视频块每个视频帧从空间上切割成多个视频区域，并将每个视频区域进一步从空间上切割成多个视频窗口；步骤3、基于全向视频文件预先给定的视点轨迹，计算各个比特率级别视频块的每个视频帧的每个像素点的相对视点移动速度和视点亮度变化，其中：vb＝|vu-v0b|lb＝|lub-lmb|步骤4、计算各个比特率级别下各个视频区域的相对视点移动速度和视点亮度变化，其中：步骤5、计算各个比特率级别下视频帧的每个像素点的基于视点的刚刚可见差异阈值，其中：步骤6、计算各个比特率级别下各个视频窗口的权重，其中：步骤7、计算各个比特率级别下各个视频窗口的用户感知质量，其中：步骤8、计算各个比特率级别下各个视频区域的用户感知质量，其中：步骤9、基于步骤4所得到的相对视点移动速度和视点亮度变化与步骤8所得到的用户感知质量，建立各个比特率级别下各个视频区域的相对视点移动速度和视点亮度变化的用户感知质量查询表；步骤10、使用ABR算法将视频块的自适应比特率决策建模为一个基于模型预测控制的最优化问题，通过求解该最优化问题确定每个视频块的比特率，即相应地确定了视频块的每个视频帧的比特率；步骤11、基于当前用户的历史视点位置使用现有的线性回归方法预测未来时间点的视点位置，并使用当前时间点的过去m秒的最低视点移动速度作为未来时间点视点移动速度的预测值，最后采用步骤3和4相同的公式计算各个比特率级别下所有视频区域的相对视点移动速度和视点亮度变化；步骤12、计算步骤11所得的各个比特率级别下所有视频区域的相对视点移动速度和视点亮度变化与步骤4所得的相应比特率级别下对应视频区域的相对视点移动速度和视点亮度变化的欧式距离，并利用步骤9所构建的用户感知质量查询表确定欧式距离最小的视频区域对应的用户感知质量，最终可以得到各个比特率级别下所有视频区域的用户感知质量；步骤13、基于步骤10所确定的视频块的比特率和步骤12所确定的各个比特率级别下所有视频区域的用户感知质量，在视频块的所有视频帧的所有视频区域的总质量低于或等于该视频块比特率的情况下，以最大化视频块的总体用户感知质量为目标，进一步确定视频块的所有视频帧中各个视频区域的质量；上述式中，vb表示比特率级别b下像素点的相对视点移动速度，lb表示比特率级别b下像素点的视点亮度变化，vu表示用户视点移动速度，v0b表示比特率级别b下像素点处对象的运动速度，lub表示比特率级别b下像素点处的亮度，lmb表示比特率级别b下m秒前视点所在视频区域所有像素点的平均亮度，m为设定值，| |表示绝对值符号；表示比特率级别b下视频区域i的相对视点移动速度，表示比特率级别b下视频区域i的视点亮度变化，N为视频区域i的所有像素点数量；JNDb表示比特率级别b下像素点的基于视点的刚刚可见差异阈值，CJNDb表示比特率级别b下像素点的基于视频内容特性的刚刚可见差异阈值，a表示给定的非零常数；表示比特率级别b下视频区域i的第j个视频窗口的权重，i表示视频区域的编号，j表示视频窗口的编号，Nij表示视频区域i的第j个视频窗口的所有像素点数量；表示比特率级别b下视频区域i的第j个视频窗口的用户感知质量；表示比特率级别b下视频区域i的第j个视频窗口所有像素点灰度的均值，表示源视频比特率o下视频区域i的第j个视频窗口所有像素点灰度的均值；表示比特率级别b下视频区域i的第j个视频窗口所有像素点灰度的方差，表示源视频比特率o下视频区域i的第j个视频窗口所有像素点灰度的方差；表示比特率级别b下与源视频比特率o下与视频区域i的第j个视频窗口所有像素点灰度的协方差；a1、a2均为给定的非零常数；表示比特率级别b下视频区域i的用户感知质量；Ni表示视频区域i的所有视频窗口数量。上述步骤10所构建的优化问题为：max-β*Rebuf-γ*Smooth))式中，bt为当前待决策的第t个视频块的比特率，Q表示比特率bt下第t个视频块的视频质量，Rebuf表示比特率bt下第t个视频块的卡顿时间，Smooth)表示比特率bt下第t个视频块的质量平滑度，α表示视频质量权重，β表示卡顿时间权重，γ表示质量平滑度权重。上述步骤12的欧氏距离Di为：式中，表示步骤9用户感知质量查询表中比特率级别b下视频区域i的相对视点移动速度，表示步骤9用户感知质量查询表中比特率级别b下视频区域i的视点亮度变化，N为视频区域i的像素点数量；表示步骤11预测的视频区域i的相对视点移动速度，表示步骤11预测的视频区域i的视点亮度变化；Di表示欧式距离。上述步骤13的目标函数为：式中，i为当前待决策的视频区域编号，M为视频块中视频区域的数量，Si表示当前待决策视频区域i的尺寸大小，bti为当前待决策视频区域i的比特率，表示比特率级别bti下当前待决策视频区域i的用户感知质量，bt为视频块的比特率。与现有技术相比，本发明在传统的视点驱动方法的基础上，利用全向视频特有的两个质量决定因素建立用户感知质量模型，以更准确地计算用户主观感知的视频质量。通过调整视频块和视频块内所有视频区域的质量，建立自适应质量决策模型。基于上述两个模型，本发明能够实现更合理的视频质量分配，进一步提高流媒体资源利用率和用户体验质量。附图说明图1为本发明的应用场景图。图2为基于质量感知的自适应全向视频流方法的总流程图；图3为用户感知质量模型的流程图；图4为自适应质量决策模型的流程图。具体实施方式为使本发明的目的、技术方案和优点更加清楚明白，以下结合具体实例，对本发明进一步详细说明。图1为本发明的应用场景图，其主要由视频服务器、内容分发网络和视频播放器组成。在视频服务器端，首先将投影后的平面视频文件切割成多个等长的视频块，然后使用编码器将其转码为不同的比特率级别。内容分发网络从视频服务器处获取平面视频文件的各个比特率级别的视频块，将各个比特率级别的视频块从空间上切割成多个视频区域进行存储，并基于历史视点数据和用户感知质量模型计算各个比特率级别的视频块的所有区域的用户感知质量。视频播放器基于质量决策器输出每个视频块的比特率级别和该块中各个视频区域的质量，并通过互联网向内容分发网络请求下载相应的视频区域。一种基于质量感知的自适应全向视频流方法，如图2所示，包括步骤如下：步骤1、先使用常用的对称投影法将全向视频文件投影到二维平面；再将投影后的视频文件切割成多个等长的视频块，并将每个视频块转码为不同的比特率级别。对全向视频文件进行预处理，使用对称投影法-ERP投影技术将其投影到二维平面。使用FFmpeg工具将投影后的视频文件切割成多个等长的视频块，并将每个视频块转码为不同的比特率级别，不同比特率级别对应不同的清晰度和视频质量。在本实施例中，750kbps、1200kbps和1850kbps分别对应低清晰度、标准清晰度和高清晰度。步骤2、将各个比特率级别的视频块的每个视频帧从空间上切割成多个视频区域，并将每个视频区域进一步从空间上切割成多个视频窗口。步骤3、基于全向视频文件预先给定的视点轨迹，计算各个比特率级别视频块的每个视频帧的每个像素点的相对视点移动速度和视点亮度变化。根据全向视频的特点，用户对全向视频质量的感知受用户视点移动的影响。因此，通过用户研究量化全向视频特有的两个质量决定因素即相对视点移动速度和视点亮度变化对用户感知质量的影响，以更准确地建模用户主观感知的全向视频质量。相对视点移动速度是指用户视点移动速度vu和比特率级别b下视频帧像素点处对象的运动速度v0b之差，则比特率级别b下视频帧的每个像素点的相对视点移动速度vb为：vb＝|vu-v0b|式中，| |表示绝对值符号。视点亮度变化是指比特率级别b下视频帧像素点处的亮度lub和当前时间点的m秒前时间点视点区域所有像素点的平均亮度lmb之差，则比特率级别b下视频帧的每个像素点的视点亮度变化lb为：lb＝|lub-lmb|式中，||表示绝对值符号，m为设定值。步骤4、计算各个比特率级别下各个视频区域的相对视点移动速度和视点亮度变化。比特率级别b下视频区域i的相对视点移动速度为：比特率级别b下视频区域i的视点亮度变化为：式中，N为视频区域i的像素点数量。步骤5、计算各个比特率级别下视频帧的每个像素点的基于视点的刚刚可见差异阈值。传统的JND阈值仅与视频内容特性有关，称为基于视频内容特性的JND阈值。而根据本发明的研究结果，JND阈值不仅与视频内容特性有关，还与相对视点移动速度和视点亮度变化有关，称为基于视点的JND阈值。其中，在同一比特率级别b下，JND阈值随vb的增加而递增，而随lb的增加而先递减后递增，且这两个因素对JND阈值的影响是相互独立的。通过拟合用户研究数据的规律，可以得到基于视点的JND阈值的计算如下：式中，JNDb表示比特率级别b下像素点处基于视点的JND阈值，CJNDb表示比特率级别b下像素点处基于视频内容特性的JND阈值，a为给定的非零常数。步骤6、计算各个比特率级别下各个视频窗口的权重。比特率级别b下像素点处基于视点的JND阈值JNDb越小，用户越容易感知到质量差异，因此像素点对应的权重值越高，反之，像素点处基于视点的JND阈值JNDb越大，用户越不容易感知到质量差异，因此像素点对应的权重值越低。由于不同视频窗口中的像素点具有不同的重要性，本发明基于新的质量决定因素对该权重进行定义，其中比特率级别b下视频区域i的第j个视频窗口的权重为：式中，i表示视频区域的编号，j表示视频窗口的编号，Nij表示视频区域i的第j个视频窗口的像素点数量。步骤7、计算各个比特率级别下各个视频窗口的用户感知质量。参见图3，基于结构相似性指数指标进行计算，则比特率级别b下视频区域i的第j个视频窗口的用户感知质量为：式中，表示比特率级别b下视频区域i的第j个视频窗口所有像素点灰度的均值，表示源视频比特率o下视频区域i的第j个视频窗口所有像素点灰度的均值；表示比特率级别b下视频区域i的第j个视频窗口所有像素点灰度的方差，表示源视频比特率o下视频区域i的第j个视频窗口所有像素点灰度的方差；表示比特率级别b下与源视频比特率o下与视频区域i的第j个视频窗口所有像素点灰度的协方差；a1、a2均为给定的非零常数。步骤8、计算各个比特率级别下各个视频区域的用户感知质量。基于视频区域中所有视频窗口的用户感知质量和权重进行计算，则比特率级别b下视频区域i的用户感知质量为：式中，Ni表示视频区域i的视频窗口数量。步骤9、基于步骤4所得到的相对视点移动速度和视点亮度变化与步骤8所得到的用户感知质量，建立各个比特率级别下各个视频区域的相对视点移动速度和视点亮度变化的用户感知质量查询表。用户感知质量查询表的格式如下：后续基于所构建的用户感知质量查询表进行自适应质量决策模型，参见图4。步骤10、使用ABR算法将视频块的自适应比特率决策建模为一个基于模型预测控制的最优化问题，通过求解该最优化问题确定每个视频块的比特率，即相应地确定了视频块的每个视频帧的比特率。这里的视频块的比特率指每秒传送的数据量，是一个平均的概念，比如，一个3-5s的视频块的比特率＝总数据量/，这个总数据量就包含了视频块内所有视频帧的数据量，而每个视频帧的数据量也不尽相同，因此这里没办法绝对的说视频帧的比特率是多少因为一般不这样度量但可以确定的是一旦视频块的比特率确定其包含每个视频帧的数据量也相应确定。本发明利用现有ABR算法求解每个视频块的比特率。ABR算法的优化目标为最大化用户QoE，其中视频质量、质量平滑度和卡顿时间对用户QoE具有重要影响，为此本发明使用基于上述因素的线性QoE模型作为算法的优化目标。具体地，待求解的最优化问题P定义如下：P：max-β*Rebuf-γ*Smooth))式中，问题P表示最大化用户体验质量，即自适应比特率算法的优化目标。bt为当前待决策的第t个视频块的比特率，Q表示比特率bt下第t个视频块的视频质量，Rebuf表示比特率bt下第t个视频块的卡顿时间，Smooth)表示比特率bt下第t个视频块的质量平滑度，α表示视频质量权重，β表示卡顿时间权重，γ表示质量平滑度权重。求解最优化问题P的具体过程为：在请求下载视频块t时，通过枚举未来T个视频块所有的比特率组合，基于最大化下T个视频块总体QoE的目标来选择当前视频块t的比特率。该视频块下载完成后，将向前移动T个未来时间视界。该过程重复直到所有视频块传输结束。步骤11、基于当前用户的历史视点位置使用现有的线性回归方法预测未来时间点的视点位置，并使用当前时间点的过去m秒的最低视点移动速度作为未来时间点视点移动速度的预测值最后采用步骤3和4相同的公式计算各个比特率级别下所有视频区域的相对视点移动速度和视点亮度变化步骤12、计算步骤11所得的各个比特率级别下所有视频区域的相对视点移动速度和视点亮度变化与步骤4所得的相应比特率级别下对应视频区域的相对视点移动速度和视点亮度变化的欧式距离，并利用步骤9所构建的用户感知质量查询表确定欧式距离最小的视频区域对应的用户感知质量最终可以得到各个比特率级别下所有视频区域的用户感知质量。根据步骤9的用户感知质量查询表中存储的和相对视点移动速度和视点亮度变化这两个特征匹配的条目或最接近的条目的SSIM来确定各个比特率级别下各个视频区域的SSIM值，以便客户端可以在不获取视频内容的情况下大致估计视频块的总体用户感知质量，即将计算的各个比特率级别下所有视频区域的相对视点移动速度和视点亮度变化信息与查询表中相应比特率级别下的对应视频区域信息进行比较，确定各个比特率级别下所有视频区域的用户感知质量。步骤13、基于步骤10所确定的视频块的比特率bt和基于步骤12所确定的各个比特率级别下所有视频区域的用户感知质量，在视频块的所有视频帧的所有视频区域的总质量低于或等于该视频块比特率的情况下，以最大化视频块的总体用户感知质量为目标，进一步确定视频块的所有视频帧中各个视频区域的质量。确定视频块的比特率后，即能确定该块中所有视频帧的比特率，该比特率决定了该视频帧中所有视频区域的总质量。在所有视频帧的所有视频区域的总质量低于或等于该视频块比特率的情况下，通过定义总体用户感知质量的目标函数并进行求解来输出视频块中每个视频区域的质量。基于得到的不同比特率级别视频块中各个视频区域的SSIM值，通过最大化视频块的总体SSIM值来确定该块中每个视频区域的质量级别，目标函数定义为：式中，i为当前待决策的视频区域编号，bti为当前待决策视频区域i的比特率，M为视频块中视频区域的数量。Si为视频区域i的尺寸大小，为步骤12所确定的比特率级别bti下视频区域i的用户感知质量，bt是步骤10所确定的视频块t的比特率。具体的质量决策过程为：结合枚举法和贪心法，对于任何一对视频区域，如果发现一个质量分配比另一个质量分配更合理，即产生更高的总和更小的视频区域总大小，则在剩下视频区域的质量分配迭代中排除后一个分配，该过程重复直到所有视频区域的质量分配结束。本发明考虑了全向视频特有的两种质量决定因素一一视点移动速度和亮度变化，并采用用户调查研究来量化其对用户主观感知质量的影响。通过引入上述两种特征对SSIM度量进行改进，建立了用户感知质量模型。在MPC算法对每个视频块比特率决策的基础上，对视频块内所有的区域进行质量分配，以最大化视频块的总体SSIM质量。本发明能够对视频区域实现更合理的质量分配，进一步提高流媒体资源利用率和用户体验质量。需要说明的是，尽管以上本发明所述的实施例是说明性的，但这并非是对本发明的限制，因此本发明并不局限于上述具体实施方式中。在不脱离本发明原理的情况下，凡是本领域技术人员在本发明的启示下获得的其它实施方式，均视为在本发明的保护之内。
