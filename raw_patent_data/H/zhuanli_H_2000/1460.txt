标题title
一种提升旋转图案盘定位精度的步进电机控制方法
摘要abst
本发明提供了一种提升旋转图案盘定位精度的步进电机控制方法，包括转动虚位误差控制方法，转动虚位误差控制方法能够在步进电机带动旋转盘转动时自动补偿虚位误差，使图案盘转动时降低或者消除传动结构间隙造成的误差问题，大大提升了图案盘的旋转定位精度，使得图案盘能够准确地旋转至目标位置，进而提高了图案投影灯的实际投影效果。
权利要求书clms
1.一种提升旋转图案盘定位精度的步进电机控制方法，其特征在于，包括转动虚位误差控制方法，转动虚位误差控制方法包括如下具体步骤：步骤一、步进电机以第一旋转方向驱动图案盘从起始位置旋转第一角度，转动完成后，第一旋转方向上的转动虚位误差为0；步骤二、步进电机的旋转方向改为第二旋转方向，当图案投影灯打出的图案光斑开始发生角度改变时步进电机停止转动，同时记录步进电机的步进值Smotor；步骤三、计算转动虚位误差补偿值Ei，Ei= K*Smotor其中，K为误差比例系数，为误差比例系数K设定一个初始值；步骤四、步进电机以第一旋转方向转动使图案盘回到起始位置，并以第一旋转方向作为基准方向Dirpre；步骤五、步进电机接收到图案盘转动命令后启动，判断当前步进电机旋转方向Dirnow与基准方向Dirpre是否相同；若当前步进电机旋转方向Dirnow与基准方向Dirpre相同，则无需进行转动虚位误差补偿；若当前步进电机旋转方向Dirnow与基准方向Dirpre相反，则进行转动虚位误差补偿，补偿计算方法如下：；其中，为补偿后的目标位置，/＞为初始设定的目标位置；步骤六、根据图案盘旋转的实际角度位置与理论角度位置的偏差，对误差比例系数K进行调整，减小或者消除实际角度位置与理论角度位置之间偏差。2.根据权利要求1所述的一种提升旋转图案盘定位精度的步进电机控制方法，其特征在于，步骤五中，在判断当前步进电机旋转方向Dirnow与基准方向Dirpre是否相同时，方法如下：定义基准方向Dirpre =1，；其中，Scurrent为当前位置；当 Dirnow ＝ Dirnow时，则当前步进电机旋转方向Dirnow与基准方向Dirpre相同；当 Dirnow ≠ Dirnow时，则当前步进电机旋转方向Dirnow与基准方向Dirpre相反。3.根据权利要求1所述的一种提升旋转图案盘定位精度的步进电机控制方法，其特征在于，误差比例系数K的初始值为1。4.根据权利要求1所述的一种提升旋转图案盘定位精度的步进电机控制方法，其特征在于，在图案盘上设置磁铁，在底板上设置与磁铁相对应的磁敏传感器，当图案盘处于初始位置时，图案盘上的磁铁与磁敏传感器完全对中；还包括图案盘初始位置误差控制方法，包括如下具体步骤：步骤S1、步进电机以第一旋转方向驱动图案盘转动，当磁敏传感器第一次感应到磁铁时，将此时图案盘的位置记为第一极限感应位置S1 ；图案盘继续转动，当图案盘转动至磁敏传感器刚好无法感应到磁铁时，将此时图案盘的位置记录为第二极限感应位置S2；图案盘继续转动行程R后停下；步骤S2、步进电机以第二旋转方向驱动图案盘回转，图案盘在回转过程中，当磁敏传感器第一次感应到磁铁时，将此时磁铁位置记录为第二极限感应位置S2 ，图案盘继续转动，当图案盘转动至磁敏传感器无法感应到磁铁时，将此时图案盘的位置记录为第一极限感应位置S1 ；图案盘继续转动行程R后停下；步骤S3、重复步骤S1和步骤S2，获取N组第一极限感应位置和第二极限感应位置数据；步骤S4、计算第一极限感应位置的算术平均值S1和第二极限感应位置的算数平均值S2/＞；步骤S5、对第一极限感应位置的算术平均值S1和第二极限感应位置的算数平均值S2/＞取平均值，得到图案盘初始目标位置S；通过步进电机驱动图案盘转动至图案盘初始目标位置S。5.根据权利要求4所述的一种提升旋转图案盘定位精度的步进电机控制方法，其特征在于，步骤S5中，第一极限感应位置的算术平均值S1和第二极限感应位置的算数平均值S2的计算方法如下：S1=/3；S2=/3；其中，S1 为第N个第一极限感应位置，S2 为第N个第二极限感应位置。6.根据权利要求4所述的一种提升旋转图案盘定位精度的步进电机控制方法，其特征在于，行程R大于转动虚位误差补偿值Ei。7.根据权利要求1所述的一种提升旋转图案盘定位精度的步进电机控制方法，其特征在于，通过编码器对步进电机的运行进行闭环控制，步进电机闭环控制方法如下：步骤n1、初始化步进电机和编码器；初始化误差变量，误差变量包括上一次误差Errorpre和累积误差Errorsum ；步骤n2、设置比例系数 Kp、积分时间Ti 和微分时间 Td；步骤n3、控制器设置目标位置Starget ；步骤n4、进行循环控制，通过步进电机的编码器反馈得到当前位置Scurrent ；步骤n5、计算当前误差Error；Error=Starget-Scurrent；步骤n6、计算比例项输出P；P=Kp * Error；步骤n7、计算积分项输出I；Errorsum+1=Errorsum+Error；I = Kp *  * Errorsum+1；步骤n8、计算微分项输出D：D = Kp * Td * ；步骤n9、计算最终的控制输出Output：Output = P + I + D ；更新误差，Errorpre=Error；将控制输出Output输送至电机驱动；步骤n10、重复步骤n4至n9，直至达到目标位置。
说明书desc
技术领域本发明涉及景观照明技术领域，特别涉及一种提升旋转图案盘定位精度的步进电机控制方法。背景技术图案投影灯是常用的一种景观照明设备，照射灯的光从图案盘上透过，在投影面上投射出带有图案的光斑；通过电机驱动图案盘旋转，从而对光斑的角度进行调整。现有的一种图案盘旋转驱动方式如图1所示，其中包括步进电机2、底板1、中心齿轮5、图案盘齿轮4以及图案盘3，图案盘3、中心齿轮5均转动设置在底板1上，图案盘齿轮4与图案盘3相连，图案盘齿轮4分布在中心齿轮5的周围且与中心齿轮5啮合，中心齿轮5通过皮带机构6与步进电机2的输出轴相连；在工作时，通过步进电机通过皮带机构带动中心齿轮旋转，中心齿轮带动周围的图案盘齿轮以及图案盘旋转。现有的这种驱动方式存在以下缺点：由于中心齿轮与图案盘齿轮在传动过程中，两者之间存在传动间隙，且电机与中心齿轮之间的皮带机构存在固有的转动误差，两者因素结合，最终导致图案盘旋转时存在转动虚位误差，影响了图案盘的旋转定位精度以及最终的实际投影效果。发明内容本发明的目的是解决现有技术中的不足之处，提供一种提升旋转图案盘定位精度的步进电机控制方法。本发明的目的是通过如下技术方案实现的：一种提升旋转图案盘定位精度的步进电机控制方法，包括转动虚位误差控制方法，转动虚位误差控制方法包括如下具体步骤：步骤一、步进电机以第一旋转方向驱动图案盘从起始位置旋转第一角度，转动完成后，第一旋转方向上的转动虚位误差为0；步骤二、步进电机的旋转方向改为第二旋转方向，当图案投影灯打出的图案光斑开始发生角度改变时步进电机停止转动，同时记录步进电机的步进值Smotor；步骤三、计算转动虚位误差补偿值Ei，Ei=K*Smotor其中，K为误差比例系数，为误差比例系数K设定一个初始值；步骤四、步进电机以第一旋转方向转动使图案盘回到起始位置，并以第一旋转方向作为基准方向Dirpre；步骤五、步进电机接收到图案盘转动命令后启动，判断当前步进电机旋转方向Dirnow与基准方向Dirpre是否相同；若当前步进电机旋转方向Dirnow与基准方向Dirpre相同，则无需进行转动虚位误差补偿；若当前步进电机旋转方向Dirnow与基准方向Dirpre相反，则进行转动虚位误差补偿，补偿计算方法如下：；其中，为补偿后的目标位置，/＞为初始设定的目标位置；步骤六、根据图案盘旋转的实际角度位置与理论角度位置的偏差，对误差比例系数K进行调整，减小或者消除实际角度位置与理论角度位置之间偏差。作为优选，步骤五中，在判断当前步进电机旋转方向Dirnow与基准方向Dirpre是否相同时，方法如下：定义基准方向Dirpre=1，；其中，Scurrent为当前位置；当 Dirnow＝ Dirnow时，则当前步进电机旋转方向Dirnow与基准方向Dirpre相同；当 Dirnow≠ Dirnow时，则当前步进电机旋转方向Dirnow与基准方向Dirpre相反。作为优选，误差比例系数K的初始值为1。作为优选，在图案盘上设置磁铁，在底板上设置与磁铁相对应的磁敏传感器，当图案盘处于初始位置时，图案盘上的磁铁与磁敏传感器完全对中；还包括图案盘初始位置误差控制方法，包括如下具体步骤：步骤S1、步进电机以第一旋转方向驱动图案盘转动，当磁敏传感器第一次感应到磁铁时，将此时图案盘的位置记为第一极限感应位置S1；图案盘继续转动，当图案盘转动至磁敏传感器刚好无法感应到磁铁时，将此时图案盘的位置记录为第二极限感应位置S2；图案盘继续转动行程R后停下；步骤S2、步进电机以第二旋转方向驱动图案盘回转，图案盘在回转过程中，当磁敏传感器第一次感应到磁铁时，将此时磁铁位置记录为第二极限感应位置S2，图案盘继续转动，当图案盘转动至磁敏传感器无法感应到磁铁时，将此时图案盘的位置记录为第一极限感应位置S1；图案盘继续转动行程R后停下；步骤S3、重复步骤S1和步骤S2，获取N组第一极限感应位置和第二极限感应位置数据；步骤S4、计算第一极限感应位置的算术平均值S1和第二极限感应位置的算数平均值S2/＞；步骤S5、对第一极限感应位置的算术平均值S1和第二极限感应位置的算数平均值S2/＞取平均值，得到图案盘初始目标位置S；通过步进电机驱动图案盘转动至图案盘初始目标位置S。作为优选，步骤S5中，第一极限感应位置的算术平均值S1和第二极限感应位置的算数平均值S2/＞的计算方法如下：S1=/3；S2=/3；其中，S1为第N个第一极限感应位置，S2为第N个第二极限感应位置。作为优选，行程R大于转动虚位误差补偿值Ei。作为优选，通过编码器对步进电机的运行进行闭环控制，步进电机闭环控制方法如下：步骤n1、初始化步进电机和编码器；初始化误差变量，误差变量包括上一次误差Errorpre和累积误差Errorsum；步骤n2、设置比例系数 Kp、积分时间Ti 和微分时间 Td；步骤n3、控制器设置目标位置Starget；步骤n4、进行循环控制，通过步进电机的编码器反馈得到当前位置Scurrent；步骤n5、计算当前误差Error；Error=Starget-Scurrent；步骤n6、计算比例项输出P；P=Kp * Error；步骤n7、计算积分项输出I；Errorsum+1=Errorsum+Error；I = Kp *  * Errorsum+1；步骤n8、计算微分项输出D：D = Kp * Td * ；步骤n9、计算最终的控制输出Output：Output = P + I + D ；更新误差，Errorpre=Error；将控制输出Output输送至电机驱动；步骤n10、重复步骤n4至n9，直至达到目标位置。本发明的有益效果是：本发明中，通过转动虚位误差控制方法，能够在步进电机带动旋转盘转动时自动补偿虚位误差，使图案盘转动时降低或者消除传动结构间隙造成的误差问题，使图案盘能够准确地旋转至目标位置；通过图案盘初始位置误差控制方法，能够使图案盘准确地定位至初始位置，提高了图案盘的初始位置的定位精度；通过闭环控制方法以较低的成本使步进电机的运行精度大大提高；通过上述三种手段相结合，大大提高了图案盘的旋转定位精度，使图案盘能够准确地旋转至目标位置，提高了图案投影灯的实际投影效果。附图说明图1为现有的一种图案盘旋转驱动方式的结构示意图。图2为起始位置误差的原理示意图。图3为通过双边缘检测算法校正起始位置误差的示意图。图4为步进电机闭环控制系统的示意图。图中：1、底板，2、步进电机，3、图案盘，4、图案盘齿轮，5、中心齿轮，6、皮带机构。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员所获得的所有其他实施例，都属于本发明保护的范围。本领域技术人员应理解的是，在本发明的揭露中，术语“纵向”、“横向”、“上”、“下”、“前”、“后”、“左”、“右”、“竖直”、“水平”、“顶”、“底” “内”、“外”等指示的方位或位置关系是基于附图所示的方位或位置关系，其仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此上述术语不能理解为对本发明的限制。可以理解的是，术语“一”应理解为“至少一”或“一个或多个”，即在一个实施例中，一个元件的数量可以为一个，而在另外的实施例中，该元件的数量可以为多个，术语“一”不能理解为对数量的限制。一种提升旋转图案盘定位精度的步进电机控制方法，包括转动虚位误差控制方法，转动虚位误差控制方法包括如下具体步骤：步骤一、步进电机以第一旋转方向驱动图案盘从起始位置旋转第一角度，转动完成后，第一旋转方向上的转动虚位误差为0。本步骤中，第一旋转方向为图1中所在视角下的顺时针方向。步骤二、步进电机的旋转方向改为第二旋转方向，当图案投影灯打出的图案光斑开始发生角度改变时步进电机停止转动，同时记录步进电机的步进值Smotor。本步骤中，第二旋转方向为图1中所在视角下的逆时针方向；可通过人工观察的方式来确定光斑是否开始发生角度变化，当光斑刚开始发生角度变化时，立即控制步进电机停止运转；在这过程中，步进电机的转动状态为慢速状态，步进电机以允许的最慢速度进行转动，步进电机的步进值Smotor由编码器进行检测并记录。步骤三、计算转动虚位误差补偿值Ei，Ei=K*Smotor其中，K为误差比例系数，为误差比例系数K设定一个初始值；本发明中，误差比例系数K的初始值设定为1。步骤四、步进电机以第一旋转方向转动使图案盘回到起始位置，并以第一旋转方向作为基准方向Dirpre。步骤五、步进电机接收到图案盘转动命令后启动，判断当前步进电机旋转方向Dirnow与基准方向Dirpre是否相同；若当前步进电机旋转方向Dirnow与基准方向Dirpre相同，则无需进行转动虚位误差补偿；若当前步进电机旋转方向Dirnow与基准方向Dirpre相反，则进行转动虚位误差补偿，补偿计算方法如下：；其中，为补偿后的目标位置，/＞为初始设定的目标位置。其中，在判断当前步进电机旋转方向Dirnow与基准方向Dirpre是否相同时，方法如下：定义基准方向Dirpre=1，；其中，Scurrent为当前位置；当 Dirnow＝ Dirnow时，则当前步进电机旋转方向Dirnow与基准方向Dirpre相同；当 Dirnow≠ Dirnow时，则当前步进电机旋转方向Dirnow与基准方向Dirpre相反。步骤六、根据图案盘旋转的实际角度位置与理论角度位置的偏差，对误差比例系数K进行调整，减小或者消除实际角度位置与理论角度位置之间偏差。本发明通过上述转动虚位误差控制方法，能够在步进电机带动旋转盘转动时自动补偿虚位误差，使图案盘转动时降低或者消除传动结构间隙造成的误差问题，使得图案盘能够准确地旋转至目标位置。传统的图案投影灯中，图案盘在转动前，会处于一个初始位置，该初始位置是事先设定好的，现有技术中，图案盘初始位置的定位是通过磁铁和磁敏传感器来实现的。如图2所示，磁铁和磁敏传感器分别设置在图案盘和底板上，磁铁随图案盘的转动而转动，通常以磁铁转动至磁敏传感器完全正对时图案盘的位置作为初始位置。现有技术中，初始位置的定位方式是：当图案盘上的磁铁转动至靠近磁敏传感器的位置时，磁敏传感器会感应到磁铁的存在，将磁敏传感器感应到磁铁时图案盘坐所在的位置定位为图案盘的初始位置。但是由于磁铁存在一定的磁场范围，且不同磁敏传感器的感应范围也是不同的，因此，磁敏传感器在感应磁铁时，磁铁并非完全正对磁敏传感器，磁敏传感器的中心位置S与磁铁中心位置存在一个起始位置误差E，这就影响了影响了图案盘的初始位置精度。本发明中，还包括图案盘初始位置误差控制方法，通过图案盘初始位置误差控制方法来提高图案盘的初始位置定位精度。其中，在图案盘上设置磁铁，在底板上设置与磁铁相对应的磁敏传感器，当图案盘处于初始位置时，图案盘上的磁铁与磁敏传感器完全对中。本发明的图案盘初始位置误差控制方法包括如下具体步骤：步骤S1、步进电机以第一旋转方向驱动图案盘转动，当磁敏传感器第一次感应到磁铁时，将此时图案盘的位置记为第一极限感应位置S1；图案盘继续转动，当图案盘转动至磁敏传感器刚好无法感应到磁铁时，将此时图案盘的位置记录为第二极限感应位置S2；图案盘继续转动行程R后停下。步骤S2、步进电机以第二旋转方向驱动图案盘回转，图案盘在回转过程中，当磁敏传感器第一次感应到磁铁时，将此时磁铁位置记录为第二极限感应位置S2，图案盘继续转动，当图案盘转动至磁敏传感器无法感应到磁铁时，将此时图案盘的位置记录为第一极限感应位置S1；图案盘继续转动行程R后停下。其中，行程R大于转动虚位误差补偿值Ei。步骤S3、重复步骤S1和步骤S2，获取N组第一极限感应位置和第二极限感应位置数据。在这N组数据中，包括N个第一极限感应位置和N个第二极限感应位置。第一极限感应位置包括S1、S1、S1......S1，第二极限感应位置包括S2、S2、S2 ......S2。步骤S4、计算第一极限感应位置的算术平均值S1和第二极限感应位置的算数平均值S2/＞。其中，第一极限感应位置的算术平均值S1和第二极限感应位置的算数平均值S2的计算方法如下：S1=/3；S2=/3；其中，S1为第N个第一极限感应位置，S2为第N个第二极限感应位置。步骤S5、对第一极限感应位置的算术平均值S1和第二极限感应位置的算数平均值S2/＞取平均值，得到图案盘初始目标位置S；通过步进电机驱动图案盘转动至图案盘初始目标位置S；其中，S=/2。本发明中，通过图案盘初始位置误差控制方法，能够使图案盘准确地定位至初始位置，当图案盘转动至初始位置时，图案盘上的磁铁与磁敏传感器完全对中，提高了图案盘的初始位置的定位精度。由于现有的图案盘的旋转是由步进电机来实现驱动的，采用开环控制方式，因此无法避免步进电机本身的误差对图案盘旋转定位精度的影响。伺服电机虽然具有更精确的位置控制以及更高的负载驱动能力，但同时伺服电机的成本更高且体积更大，故在对图案盘的控制系统中直接将步进电机更换成伺服电机，成本高昂。本发明中，通过编码器对步进电机进行闭环控制，在不更换伺服电机的前提下，通过闭环控制方法以较低的成本使步进电机的运行精度大大提高，进而提升了图案盘的旋转定位精度。如图4所示，步进电机闭环控制系统包括控制器、编码器、电机驱动、以及步进电机，其中，编码器采用AS5047D磁编码器。步进电机闭环控制方法如下：步骤n1、初始化步进电机和编码器；初始化误差变量，误差变量包括上一次误差Errorpre和累积误差Errorsum；步骤n2、设置比例系数Kp、积分时间Ti 和微分时间 Td。其中，比例系数 Kp 决定了步进电机的响应速度，积分参数Ti 用于消除静态误差，微分参数Td 用于抑制振荡和提高稳定性。步骤n3、控制器设置目标位置Starget；步骤n4、进行循环控制，通过步进电机的编码器反馈得到当前位置Scurrent；步骤n5、计算当前误差Error；Error=Starget-Scurrent；步骤n6、计算比例项输出P；P=Kp * Error；步骤n7、计算积分项输出I；Errorsum+1=Errorsum+Error；I = Kp *  * Errorsum+1；其中，Errorsum+1为更新后的累计误差；步骤n8、计算微分项输出D：D = Kp * Td * ；步骤n9、计算最终的控制输出Output，Output = P + I + D ；更新误差，Errorpre=Error；将控制输出Output输送至电机驱动；步骤n10、重复步骤n4至n9，直至达到目标位置。通过编码器对步进电机进行闭环控制，具备以下有点：1、高精度定位：传统的步进电机采用开环控制方式，可能存在步进丢失或者累积误差的问题，而闭环步进电机通过在驱动系统中添加编码器实时反馈电机角度信息，可以实现更高的旋转定位精度和运动控制精度；同时闭环控制可以纠正步进电机运动过程中的误差，使得电机的位置控制更加准确。2、提高负载能力：传统步进电机在承载大负载或工作瞬间负载突变时，容易出现逐渐失速的现象；而本发明中，通过闭环控制实时调整电机驱动信号，可以更好地抵抗负载变化和外界干扰，保持较稳定的转动性能，具备更高的负载能力。3、快速响应和高速运动：传统的开环步进电机受到驱动信号频率和扭矩的限制，无法实现高速运动和快速响应；而本发明中利用闭环控制方法，步进电机在保持高精度运行的同时，可以实现实现更快的响应速度和更高速度的旋转。4、 简化系统调试：步进电机闭环控制系统中集成了编码器这一反馈装置，能够提供准确的位置反馈信号，这样可以降低系统调试和调整的难度，简化系统的结构和控制算法设计，减少用户在使用过程中的工作量和复杂性。本发明中，通过转动虚位误差控制方法，能够在步进电机带动旋转盘转动时自动补偿虚位误差，使图案盘转动时降低或者消除传动结构间隙造成的误差问题；通过图案盘初始位置误差控制方法，能够使图案盘准确地定位至初始位置，提高了图案盘的初始位置的定位精度；通过闭环控制方法以较低的成本使步进电机的运行精度大大提高；通过上述三种手段相结合，大大提高了图案盘的旋转定位精度，使图案盘能够准确地旋转至目标位置，提高了图案投影灯的实际投影效果。本发明不局限于上述最佳实施方式，任何人在本发明的启示下都可得出其他各种形式的产品，但不论在其形状或结构上作任何变化，凡是具有与本申请相同或相近似的技术方案，均落在本发明的保护范围之内。
