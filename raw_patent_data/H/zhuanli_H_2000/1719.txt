标题title
一种车路云一体化的时序数据管理系统及方法
摘要abst
本发明公开了一种车路云一体化的时序数据管理系统及方法，其包括设备感知层、云端数据管理层和数据传输层，设备感知层用于采集车辆和路侧的原始感知数据，形成上报数据，实时发布到数据传输层，通过订阅主题的方式从数据传输层获取云端数据管理层下发的指令类数据；云端数据管理层用于接收上报数据，获得车路融合数据，再进行存储；云端数据管理层还用于接收数据应用侧下发的指令类数据，进行存储，最后发布到数据传输层，用于控制车辆和路侧设备；数据传输层用于接收设备感知层和云端数据管理层发布的数据，进行主题管理，并向订阅主题的设备感知层和云端数据管理层分发相应数据。本发明能够实现车路云一体化的数据管理。
权利要求书clms
1.一种车路云一体化的时序数据管理系统，其特征在于，包括设备感知层、云端数据管理层和数据传输层，其中：设备感知层用于采集车辆和路侧的原始感知数据，并将原始感知数据进行融合汇总，形成上报数据，实时发布到数据传输层，还通过订阅主题的方式从数据传输层获取云端数据管理层下发的指令类数据；云端数据管理层用于接收上报数据，还通过订阅主题的方式获取原始感知数据，并将原始感知数据进行数据融合，获得车路融合数据，再对原始感知数据和车路融合数据分别进行存储，以提供实时和离线服务，为数据应用提供数据支撑服务；云端数据管理层还用于接收数据应用侧下发的指令类数据，并将指令类数据进行存储，最后发布到数据传输层，用于控制车辆和路侧设备；数据传输层搭建Mqtt Broker集群，用于接收设备感知层和云端数据管理层发布的数据，通过Mqtt Broker集群的Broker进行主题管理，并向订阅主题的设备感知层和云端数据管理层分发相应数据。2.如权利要求1所述的车路云一体化的时序数据管理系统，其特征在于，设备感知层包括路侧设备；云端数据管理层具体包括：车路融合服务器，其用于从数据传输层订阅并获取原始感知数据，并将原始感知数据进行数据融合，获得车路融合数据，再对原始感知数据和车路融合数据分别进行存储；时间序列数据库服务器，其具有时间序列数据库和超级表；其中：时间序列数据库用于处理带时间标签的数据，对上报数据进行采集和存储，具体的存储方法包括：步骤221a，读写缓存实时数据；步骤222a，判断是否有对应当前缓存数据的子表，如无，则按照路侧设备和车辆作为维度，以超级表为模板创建子表；步骤223a，将步骤221a缓存的数据写入子表；超级表，其用于按照上报数据中基础数据及其标签属性创建子表；接口服务器，其用于为车辆和路侧设备同数据应用侧之间的数据传输提供至少两种封装好的接口服务：一是用于为数据应用侧提供查询时间序列数据库中的原始感知数据和融合后数据的服务；二是用于接收数据应用侧通过接口调用下发的指令类数据。3.如权利要求2所述的车路云一体化的时序数据管理系统，其特征在于，超级表具体包括如下类型：Type1，车辆感知超级表，其包括基础数据和标签数据，其中：基础数据包括车辆上报时间戳、车辆类型、车辆位置、车辆朝向、车辆速度和电量；标签数据包括车辆编号；Type 2，路侧感知超级表，其包括基础数据和标签数据，其中：基础数据包括路侧上报时间戳、目标类型、目标位置、目标长宽高、目标朝向和目标速度；标签数据包括路侧设备编号；Type 3，路侧交通事件超级表，其包括基础数据和标签数据，其中：基础数据包括事件上报时间戳、设备位置、交通事件位置、事件类型、事件来源和事件半径；标签数据包括设备编号；Type 4，红绿灯上报超级表，其包括基础数据和标签数据，其中：基础数据包括路口所在区域、相位号和灯组灯色；标签数据包括设备编号；Type 5，融合后超级表，其包括基础数据和标签数据，其中：基础数据包括时间戳、目标类型、目标位置、目标长宽高、目标朝向、目标速度、目标朝向和目标电量；标签数据包括数据类型和目标编号。4.如权利要求3所述的车路云一体化的时序数据管理系统，其特征在于，接口服务器具体包括Tomcat集群部署模块、接口鉴权模块和接口封装模块，其中：Tomcat集群部署模块作为应用服务器，用于在数据应用侧发起调用接口的请求后，提供基于Http协议的接口服务；接口鉴权模块用于在数据应用侧发起调用接口的请求后，将API Key在内的所有请求参数进行排序，然后与接口调用者的密码共同生成相应的请求签名，再判断请求签名与预设签名是否一致，如果一致，则验证通过；接口封装模块用于定义接口格式，按照proto buff格式定义，约定接口入参、出参标准，对实时和离线数据查询进行封装，并在接口鉴权模块验证通过后、接口服务时对时间序列数据库进行读写操作，反馈结果给数据应用侧，为其他系统提供调用的标准API。5.如权利要求1-4中任一项所述的车路云一体化的时序数据管理系统，其特征在于，数据传输层具体包括：车辆感知类主题上报模块，其用于接收上报数据中的车辆信息，并使用分主题名称割线方式对车辆信息对应的主题进行管理；车辆指令类主题下发模块，其用于接收指令类数据中的车辆控制指令，并使用主题名称割线方式对车辆指令和控制指令对应的主题进行管理；路侧感知类数据主题上报模块，其用于接收上报数据中的路侧感知信息，并使用主题名称割线方式对路侧感知信息对应的主题进行管理；路侧交通事件类数据主题上报模块，其用于接收上报数据中的交通事件信息，并使用主题名称割线方式对交通事件信息对应的主题进行管理；路侧红路灯类数据主题上报模块，其用于接收上报数据中的红绿灯信息，并使用主题名称割线方式对红绿灯信息对应的主题进行管理；路侧设备控制指令类主题下发模块，其用于接收指令类数据中的路侧设备控制指令，并使用主题名称割线方式对路侧设备控制指令对应的主题进行管理。6.一种车路云一体化的时序数据管理方法，其特征在于，包括：设备感知：通过设备感知层采集车辆和路侧的原始感知数据，并将原始感知数据进行融合汇总，形成上报数据，实时发布到数据传输层，还通过订阅主题的方式从数据传输层获取云端数据管理层下发的指令类数据；云端数据管理：通过云端数据管理层接收上报数据，还通过订阅主题的方式获取原始感知数据，并将原始感知数据进行数据融合，获得车路融合数据，再对原始感知数据和车路融合数据分别进行存储，以提供实时和离线服务，为数据应用提供数据支撑服务；云端数据管理层还用于接收数据应用侧下发的指令类数据，并将指令类数据进行存储，最后发布到数据传输层，用于控制车辆和路侧设备；数据传输：通过数据传输层搭建Mqtt Broker集群，用于接收设备感知层和云端数据管理层发布的数据，通过Mqtt Broker集群的Broker进行主题管理，并向订阅主题的设备感知层和云端数据管理层分发相应数据。7.如权利要求1所述的车路云一体化的时序数据管理方法，其特征在于，云端数据管理的步骤中，通过时间序列数据库服务器中的时间序列数据库对原始感知数据和车路融合数据分别进行存储，该存储方法具体包括：步骤221a，读写缓存实时数据；步骤222a，判断是否有对应当前缓存数据的子表，如无，则按照路侧设备和车辆作为维度，以超级表为模板创建子表；步骤223a，将步骤221a缓存的数据写入子表；其中，步骤222a中的超级表用于按照上报数据中基础数据及其标签属性创建子表。8.如权利要求7所述的车路云一体化的时序数据管理方法，其特征在于，超级表具体包括如下类型：Type1，车辆感知超级表，其包括基础数据和标签数据，其中：基础数据包括车辆上报时间戳、车辆类型、车辆位置、车辆朝向、车辆速度和电量；标签数据包括车辆编号；Type 2，路侧感知超级表，其包括基础数据和标签数据，其中：基础数据包括路侧上报时间戳、目标类型、目标位置、目标长宽高、目标朝向和目标速度；标签数据包括路侧设备编号；Type 3，路侧交通事件超级表，其包括基础数据和标签数据，其中：基础数据包括事件上报时间戳、设备位置、交通事件位置、事件类型、事件来源和事件半径；标签数据包括设备编号；Type 4，红绿灯上报超级表，其包括基础数据和标签数据，其中：基础数据包括路口所在区域、相位号和灯组灯色；标签数据包括设备编号；Type 5，融合后超级表，其包括基础数据和标签数据，其中：基础数据包括时间戳、目标类型、目标位置、目标长宽高、目标朝向、目标速度、目标朝向和目标电量；标签数据包括数据类型和目标编号。9.如权利要求8所述的车路云一体化的时序数据管理方法，其特征在于，云端数据管理的步骤中通过云端数据管理层为数据应用侧提供数据支撑服务的方法，具体包括：步骤221b，在接收到数据应用侧发起调用接口的请求后，将API Key在内的所有请求参数进行排序，然后与接口调用者的密码共同生成相应的请求签名，再判断请求签名与预设签名是否一致，如果是，则验证通过；步骤222b，按照proto buff格式定义，约定接口入参、出参标准，对实时和离线数据查询进行封装，并在接口鉴权模块验证通过后、接口服务时对时间序列数据库进行读写操作，反馈结果给数据应用侧，为其他系统提供调用的标准API。10.如权利要求6-9中任一项所述的车路云一体化的时序数据管理方法，其特征在于，数据传输层通过Mqtt Broker集群的Broker进行主题管理的类型具体包括：Type1，车辆感知类主题管理：接收上报数据中的车辆信息，并主题名称使用分割线方式对车辆信息对应的主题进行管理；Type2，车辆指令类主题管理：接收指令类数据中的车辆控制指令，并主题名称使用分割线方式对车辆指令和控制指令对应的主题进行管理；Type3，路侧感知类数据主题管理：接收上报数据中的路侧感知信息，并主题名称使用分割线方式对路侧感知信息对应的主题进行管理；Type4，路侧交通事件类数据主题管理：接收上报数据中的交通事件信息，并主题名称使用分割线方式对交通事件信息对应的主题进行管理；Type5，路侧红路灯类数据主题管理：接收上报数据中的红绿灯信息，并主题名称使用分割线方式对红绿灯信息对应的主题进行管理；Type6，路侧设备控制指令类主题管理：接收指令类数据中的路侧设备控制指令，并主题名称使用分割线方式对路侧设备控制指令对应的主题进行管理。
说明书desc
技术领域本发明涉及自动驾驶应用技术领域，特别是关于一种车路云一体化的时序数据管理系统及方法。背景技术车路云一体化系统需要以车载、路侧、云端等多源数据融合为基础，随着车辆网和无线通信等技术的发展，接入路侧感知、路侧单元以及车载通信单元在内的大量设备，每种设备都以1-20HZ频率上传，云端需要不断流入动态实时数据，会产生海量历史数据，同时云端需要实时分发、持久化用于实时和离线应用。传统关系型数据库，无法做到分布式存储，查询逻辑复杂，而大数据组件虽然可实现分布式存储，但需要集成多个组件，增加了运维和硬件成本。结合车端和路侧自身数据具备时效性、独立性、结构化等特性，提出基于时间序列数据库进行数据管理。发明内容本发明的目的在于提供一种车路云一体化的时序数据管理方法及系统来克服或至少减轻现有技术的上述缺陷中的至少一个。为实现上述目的，本发明提供一种车路云一体化的时序数据管理系统，其包括设备感知层、云端数据管理层和数据传输层，其中：设备感知层用于采集车辆和路侧的原始感知数据，并将原始感知数据进行融合汇总，形成上报数据，实时发布到数据传输层，还通过订阅主题的方式从数据传输层获取云端数据管理层下发的指令类数据；云端数据管理层用于接收上报数据，还通过订阅主题的方式获取原始感知数据，并将原始感知数据进行数据融合，获得车路融合数据，再对原始感知数据和车路融合数据分别进行存储，以提供实时和离线服务，为数据应用提供数据支撑服务；云端数据管理层还用于接收数据应用侧下发的指令类数据，并将指令类数据进行存储，最后发布到数据传输层，用于控制车辆和路侧设备；数据传输层搭建Mqtt Broker集群，用于接收设备感知层和云端数据管理层发布的数据，通过Mqtt Broker集群的Broker进行主题管理，并向订阅主题的设备感知层和云端数据管理层分发相应数据。进一步地，设备感知层包括路侧设备；云端数据管理层具体包括：车路融合服务器，其用于从数据传输层订阅并获取原始感知数据，并将原始感知数据进行数据融合，获得车路融合数据，再对原始感知数据和车路融合数据分别进行存储；时间序列数据库服务器，其具有时间序列数据库和超级表；其中：时间序列数据库用于处理带时间标签的数据，对上报数据进行采集和存储，具体的存储方法包括：步骤221a，读写缓存实时数据；步骤222a，判断是否有对应当前缓存数据的子表，如无，则按照路侧设备和车辆作为维度，以超级表为模板创建子表；步骤223a，将步骤221a缓存的数据写入子表；超级表，其用于按照上报数据中基础数据及其标签属性创建子表；接口服务器，其用于为车辆和路侧设备同数据应用侧之间的数据传输提供至少两种封装好的接口服务：一是用于为数据应用侧提供查询时间序列数据库中的原始感知数据和融合后数据的服务；二是用于接收数据应用侧通过接口调用下发的指令类数据。进一步地，超级表具体包括如下类型：Type1，车辆感知超级表，其包括基础数据和标签数据，其中：基础数据包括车辆上报时间戳、车辆类型、车辆位置、车辆朝向、车辆速度和电量；标签数据包括车辆编号；Type 2，路侧感知超级表，其包括基础数据和标签数据，其中：基础数据包括路侧上报时间戳、目标类型、目标位置、目标长宽高、目标朝向和目标速度；标签数据包括路侧设备编号；Type 3，路侧交通事件超级表，其包括基础数据和标签数据，其中：基础数据包括事件上报时间戳、设备位置、交通事件位置、事件类型、事件来源和事件半径；标签数据包括设备编号；Type 4，红绿灯上报超级表，其包括基础数据和标签数据，其中：基础数据包括路口所在区域、相位号和灯组灯色；标签数据包括设备编号；Type 5，融合后超级表，其包括基础数据和标签数据，其中：基础数据包括时间戳、目标类型、目标位置、目标长宽高、目标朝向、目标速度、目标朝向和目标电量；标签数据包括数据类型和目标编号。进一步地，接口服务器具体包括Tomcat集群部署模块、接口鉴权模块和接口封装模块，其中：Tomcat集群部署模块作为应用服务器，用于在数据应用侧发起调用接口的请求后，提供基于Http协议的接口服务；接口鉴权模块用于在数据应用侧发起调用接口的请求后，将API Key在内的所有请求参数进行排序，然后与接口调用者的密码共同生成相应的请求签名，再判断请求签名与预设签名是否一致，如果一致，则验证通过；接口封装模块用于定义接口格式，按照proto buff格式定义，约定接口入参、出参标准，对实时和离线数据查询进行封装，并在接口鉴权模块验证通过后、接口服务时对时间序列数据库进行读写操作，反馈结果给数据应用侧，为其他系统提供调用的标准API。进一步地，数据传输层具体包括：车辆感知类主题上报模块，其用于接收上报数据中的车辆信息，并使用分主题名称割线方式对车辆信息对应的主题进行管理；车辆指令类主题下发模块，其用于接收指令类数据中的车辆控制指令，并使用主题名称割线方式对车辆指令和控制指令对应的主题进行管理；路侧感知类数据主题上报模块，其用于接收上报数据中的路侧感知信息，并使用主题名称割线方式对路侧感知信息对应的主题进行管理；路侧交通事件类数据主题上报模块，其用于接收上报数据中的交通事件信息，并使用主题名称割线方式对交通事件信息对应的主题进行管理；路侧红路灯类数据主题上报模块，其用于接收上报数据中的红绿灯信息，并使用主题名称割线方式对红绿灯信息对应的主题进行管理；路侧设备控制指令类主题下发模块，其用于接收指令类数据中的路侧设备控制指令，并使用主题名称割线方式对路侧设备控制指令对应的主题进行管理。本发明还提供一种车路云一体化的时序数据管理方法，其包括：设备感知：通过设备感知层采集车辆和路侧的原始感知数据，并将原始感知数据进行融合汇总，形成上报数据，实时发布到数据传输层，还通过订阅主题的方式从数据传输层获取云端数据管理层下发的指令类数据；云端数据管理：通过云端数据管理层接收上报数据，还通过订阅主题的方式获取原始感知数据，并将原始感知数据进行数据融合，获得车路融合数据，再对原始感知数据和车路融合数据分别进行存储，以提供实时和离线服务，为数据应用提供数据支撑服务；云端数据管理层还用于接收数据应用侧下发的指令类数据，并将指令类数据进行存储，最后发布到数据传输层，用于控制车辆和路侧设备；数据传输：通过数据传输层搭建Mqtt Broker集群，用于接收设备感知层和云端数据管理层发布的数据，通过Mqtt Broker集群的Broker进行主题管理，并向订阅主题的设备感知层和云端数据管理层分发相应数据。进一步地，云端数据管理的步骤中，通过时间序列数据库服务器中的时间序列数据库对原始感知数据和车路融合数据分别进行存储，该存储方法具体包括：步骤221a，读写缓存实时数据；步骤222a，判断是否有对应当前缓存数据的子表，如无，则按照路侧设备和车辆作为维度，以超级表为模板创建子表；步骤223a，将步骤221a缓存的数据写入子表；其中，步骤222a中的超级表用于按照上报数据中基础数据及其标签属性创建子表。进一步地，超级表具体包括如下类型：Type1，车辆感知超级表，其包括基础数据和标签数据，其中：基础数据包括车辆上报时间戳、车辆类型、车辆位置、车辆朝向、车辆速度和电量；标签数据包括车辆编号；Type 2，路侧感知超级表，其包括基础数据和标签数据，其中：基础数据包括路侧上报时间戳、目标类型、目标位置、目标长宽高、目标朝向和目标速度；标签数据包括路侧设备编号；Type 3，路侧交通事件超级表，其包括基础数据和标签数据，其中：基础数据包括事件上报时间戳、设备位置、交通事件位置、事件类型、事件来源和事件半径；标签数据包括设备编号；Type 4，红绿灯上报超级表，其包括基础数据和标签数据，其中：基础数据包括路口所在区域、相位号和灯组灯色；标签数据包括设备编号；Type 5，融合后超级表，其包括基础数据和标签数据，其中：基础数据包括时间戳、目标类型、目标位置、目标长宽高、目标朝向、目标速度、目标朝向和目标电量；标签数据包括数据类型和目标编号。进一步地，云端数据管理的步骤中通过云端数据管理层为数据应用侧提供数据支撑服务的方法，具体包括：步骤221b，在接收到数据应用侧发起调用接口的请求后，将API Key在内的所有请求参数进行排序，然后与接口调用者的密码共同生成相应的请求签名，再判断请求签名与预设签名是否一致，如果是，则验证通过；步骤222b，按照proto buff格式定义，约定接口入参、出参标准，对实时和离线数据查询进行封装，并在接口鉴权模块验证通过后、接口服务时对时间序列数据库进行读写操作，反馈结果给数据应用侧，为其他系统提供调用的标准API。进一步地，数据传输层通过Mqtt Broker集群的Broker进行主题管理的类型具体包括：Type1，车辆感知类主题管理：接收上报数据中的车辆信息，并主题名称使用分割线方式对车辆信息对应的主题进行管理；Type2，车辆指令类主题管理：接收指令类数据中的车辆控制指令，并主题名称使用分割线方式对车辆指令和控制指令对应的主题进行管理；Type3，路侧感知类数据主题管理：接收上报数据中的路侧感知信息，并主题名称使用分割线方式对路侧感知信息对应的主题进行管理；Type4，路侧交通事件类数据主题管理：接收上报数据中的交通事件信息，并主题名称使用分割线方式对交通事件信息对应的主题进行管理；Type5，路侧红路灯类数据主题管理：接收上报数据中的红绿灯信息，并主题名称使用分割线方式对红绿灯信息对应的主题进行管理；Type6，路侧设备控制指令类主题管理：接收指令类数据中的路侧设备控制指令，并主题名称使用分割线方式对路侧设备控制指令对应的主题进行管理。本发明通过时间序列数据库，能够实现车路云一体化的数据管理。附图说明图1是本发明实施例所提供的车路云一体化的时序数据管理系统的框架示意图；图2是本发明实施例所提供的设备感知层和云端管理层之间数据交互的流程图；图3是本发明实施例提供的云端数据管理中数据存储的流程示意图；图4为本发明实施例所提供的云端数据管理中数据服务和数据应用的示意图。具体实施方式下面结合附图和实施例对本发明进行详细的描述。如图1所示，本发明实施例提供的车路云一体化的时序数据管理系统采用分层解耦结构设计，各层之间相互独立，互不影响，同时使用中间媒介进行数据交互，具体包括设备感知层1、云端数据管理层2和数据传输层3，其中：设备感知层1用于采集车辆和路侧的原始感知数据，并将原始感知数据进行融合汇总，形成上报数据，实时发布到数据传输层3的MQTT Broker服务器，还通过订阅主题的方式获取数据应用侧下发的指令类数据。在一个实施例中，设备感知层1包括路侧部分和车端部分。路侧部分包括路侧设备11和路侧边缘服务器12。其中：路侧设备11用于获取其所覆盖区域的路侧的原始感知数据。路侧设备11例如可以是感知摄像机、毫米波雷达和激光雷达等各类交通检测仪器，这些设备可以对道路运行状况、交通参与者、交通事件和红路灯等进行识别。路侧边缘服务器12用于接收来自路侧设备11感知到的原始感知数据，对交通态势、交通事件、交通参与者进行检测、识别和跟踪，并一体化融合，形成上报数据中的路况信息和预警信息，发布到数据传输层3。路侧边缘服务器12同时也用于订阅云端数据管理层2下发到数据传输层3的指令类数据，并将传输到路侧设备11。车端部分包括车载感知设备13和车端边缘服务器14。其中：车载感知设备13用于获取车辆的原始感知数据，其包括车速、航向、加速度、位置和里程等车辆信息。车端边缘服务器14用于接收车载感知设备13感知到的车辆的原始感知数据，作为上报数据中的一部分，发布到数据传输层3的MQTT Broker对应的主题下。云端数据管理层2用于通过设备感知层1接收上报数据，通过订阅数据传输层3相关主题的方式获取车路感知数据，并将原始感知数据进行数据融合，获得车路融合后数据，再对原始感知数据和车路融合后数据分别进行存储，以提供实时和离线服务，为数据应用侧提供数据支撑服务。云端数据管理层2还用于接收数据应用侧下发的指令类数据，并将指令类数据进行存储，再进行数据融合，最后发布到数据传输层3的MQTT Broker对应的主题下，用于控制车辆和路侧设备。上述实施例中，指令类数据包括车辆指令、控制指令和路侧设备控制指令。其中：车辆指令包括决策类数据，如：车辆编号、目的地、路径信息、停车点信息、载客状态、车辆所处阶段。控制指令包括刹车、转向、启动车辆等。路侧设备控制指令包括路侧设备编号、所属区域和传感器的角度调整。图3为本发明实施例提供的数据存储流程，对应图1中云端数据管理层中的数据存储，时间序列数据库可以高效存储和快速处理海量时序大数据，与传统数据库相比，存储空间减半，查询速度大大提高，非常适用于车路云一体化场景中，本实施例中云端数据管理层2具体包括车路融合服务器21、时间序列数据库服务器22和接口服务器23。其中：车路融合服务器21用于处理两部分数据，一部分是从数据传输层3订阅并获取原始感知数据，并将原始感知数据进行数据融合，获得车路融合数据，再对原始感知数据和车路融合数据分别进行存储。另一部分是外部系统和应用下发的指令类数据，作为MQTT客户端，发布数据到数据传输层3的MQTT Broker服务端。时间序列数据库服务器22具有时间序列数据库和超级表。其中：时间序列数据库用于包含两部分存储：一部分对车路原始数据、融合后数据进行存储，一部分用于对数据应用侧下发的指令类数据进行存储。并设定数据保留时间，比如可以设定数据保留时间为365天，每10天一个数据文件。时间序列数据库的具体的存储方法包括：步骤221a，车路融合服务器21从数据传输层3的MQTT Broker服务节点，实时订阅获取车路原始数据、融合后数据，数据包含时间属性、标签属性，然后读写缓存实时数据。数据缓存包括写缓存和读缓存。其中，写缓存的方法具体包括：通过车路融合服务器21获取数据，并预先设定缓存阈值，同时记录最后一次数据写入缓存的时间，每次读取数据时，针对系统当前时间和记录的最后一次写入缓存时间进行比较，未超过阈值时，直接写入缓存，用于实时应用查询；超过缓存时，将缓存数据写入磁盘，进行持久化操作。读缓存的方法具体包括：先从缓存中查询数据，不存在时，从磁盘中查询。步骤222a，判断是否有对应当前缓存数据的子表，子表定义从超级表继承，为真实存储数据的表，其按照每辆车、每个路侧设备一张子表原则创建，并遵循同一辆车、同一个路侧设备超级表中标签属性相同，并用时间戳和设备编号区分不同时序数据。如无子表，则按照路侧设备和车辆作为维度，以超级表为模板动态创建子表，比如车辆含有多辆车，每辆车有唯一的编号，创建子表时，以vehicle_车辆编号方式定义，比如车辆编号为1001的，则子表名称为vehicle_1001；路侧以每个设备点为维度创建子表，含有唯一设备编号，子表定义以roadside+路侧设备编号创建，比如路侧设备1的编号是2001，则子表名称为roadside_2001。当然，如有子表，直接使用子表即可。其中，子表创建依赖超级表，用于实际存储数据。步骤223a，将步骤221a缓存的数据写入子表。在一个实施例中，数据写入的方法包括：由车路融合服务器21和接口服务器23使用标准SQL写入数据。数据存储包含实时和离线数据存储，实时数据主要存储按照约定时间内的最近时间段内的数据，比如设置约定时间为2个小时，系统会自动检测最早数据是否超过约定时间，当超过约定时间时，按照时间顺序，将最早数据写入历史数据库中。离线数据，主要存储车路产生的历史数据，用于数据分析等应用。超级表用于按照上报数据中基础数据及其标签属性创建子表，超级表是一个表模板，并不真实存储数据，实际数据存储在子表中，可以包含多个子表。超级表包括基础数据和标签数据，其中，基础数据表示车辆和路侧上报的动态变化数据，标签数据表示车辆和路侧设备静态数据。其中，创建超级表遵循：车辆自身数据共用一张超级表，路侧感知类数据、交通事件、红绿灯上报数据分别对应一张超级表，融合后数据共用一张超级表，以下是车端和路侧设备数据对应的超级表创建，包含车辆和路侧原始数据、车路感知后数据。在一个实施例中，超级表具体包括如下类型：Type1，车辆感知超级表，其包括基础数据和标签数据，其中：基础数据包括车辆上报时间戳、车辆类型、车辆位置、车辆朝向、车辆速度和电量；标签数据包括车辆编号。Type 2，路侧感知超级表，其包括基础数据和标签数据，其中：基础数据包括路侧上报时间戳、目标类型、目标位置、目标长宽高、目标朝向和目标速度；标签数据包括路侧设备编号。Type 3，路侧交通事件超级表，其包括基础数据和标签数据，其中：基础数据包括事件上报时间戳、设备位置、交通事件位置、事件类型、事件来源和事件半径；标签数据包括设备编号。Type 4，红绿灯上报超级表，其包括基础数据和标签数据，其中：基础数据包括路口所在区域、相位号和灯组灯色；标签数据包括设备编号。Type 5，融合后超级表，其包括基础数据和标签数据，其中：基础数据包括时间戳、目标类型、目标位置、目标长宽高、目标朝向、目标速度、目标朝向和目标电量；标签数据包括数据类型和目标编号。接口服务器23用于为车辆和路侧设备11同数据应用侧之间的数据传输提供至少两种封装好的接口服务：一是用于为数据应用侧提供查询时间序列数据库中的原始感知数据、融合后数据的服务；二是用于接收数据应用侧通过接口调用下发的指令类数据。在一个实施例中，接口服务器23具体包括Tomcat集群部署模块、接口鉴权模块和接口封装模块，其中：Tomcat集群部署模块作为应用服务器，用于在数据应用侧发起调用接口的请求后，提供基于Http协议的接口服务。接口鉴权模块用于在数据应用侧发起调用接口的请求后，将APIKey在内的所有请求参数进行排序，然后与接口调用者的密码共同生成相应的请求签名，再判断请求签名与预设签名是否一致，如果是，则验证通过。其中，验证是对接口调用方进行身份识别，识别通过可以调用接口，并返回查询结果给数据应用侧，识别不通过，提示身份验证失效。预设签名是指服务器为接口调用者预先分配的ID和密码。请求签名指接口调用者发起的携带身份信息。接口封装模块用于定义接口格式，按照proto buff格式定义，约定接口入参、出参标准，对实时和离线数据查询进行封装，并在接口鉴权模块验证通过后、接口服务时对时间序列数据库进行读写操作，反馈结果给数据应用侧，为其他系统提供调用的标准API。如图2所示，数据传输层3作为Server端，负责数据分发，采用发布、订阅通信协议，设备感知层1和云端数据管理层2作为Mqtt Client端，与Server相连，二者之间不直接通信，作为设备感知层1和云端数据管理层2之间数据交互的纽带。数据传输层3具有MqttBroker集群，用于接收设备感知层1和云端数据管理层2发布的数据，通过Mqtt Broker集群的Broker进行主题管理，并向订阅主题的设备感知层1和云端数据管理层2分发相应数据，数据以订阅、发布模式进行，以此来实现分层解耦的目标，不同的数据使用不同主题加以区分。在一个实施例中，数据传输层3具体包括车辆感知类主题上报模块、车辆指令类主题下发模块、路侧感知类数据主题上报模块、路侧交通事件类数据主题上报模块、路侧红路灯类数据主题上报模块和路侧设备控制指令类主题下发模块，其中：车辆感知类主题上报模块用于接收上报数据中的车辆信息，并使用主题名称分割线方式对车辆信息对应的主题进行管理。车辆指令类主题下发模块用于接收指令类数据中的车辆控制指令，并使用主题名称分割线方式对车辆指令和控制指令对应的主题进行管理。使用时，设备感知层1的车辆边缘服务器14通过订阅此主题，传输给车辆，实现对车辆的控制。路侧感知类数据主题上报模块用于接收上报数据中的路侧感知信息，并使用主题名称分割线方式对路侧感知信息对应的主题进行管理。路侧交通事件类数据主题上报模块用于接收上报数据中的交通事件信息，并主题名称分割线方式对交通事件信息对应的主题进行管理。路侧红路灯类数据主题上报模块用于接收上报数据中的红绿灯信息，并使用主题名称分割线方式对红绿灯信息对应的主题进行管理。路侧设备控制指令类主题下发模块用于接收指令类数据中的路侧设备控制指令，并使用主题名称分割线方式对路侧设备控制指令对应的主题进行管理。使用时，设备感知层1的路侧边缘服务器12通过订阅此主题，传输给路侧设备11，实现对车辆和路侧设备的控制。如图4所示，图4显示的是数据服务和数据应用示意图，具体包括：数据服务，提供接口服务，对时间序列数据库进行读写操作，即可用于查询车辆和路侧设备发送的实时原始数据、融合后数据，也可以用于其他应用系统发送给车辆和路侧设备的指令类数据进行接口封装模块。按数据时效性，划分如下：实时数据：数据低延迟，查询响应在毫秒级别，数据动态无边界，使用last_row从时间序列数据库缓存中查询数据，采用流式方式封装API。准实时数据：数据延迟中等，响应时间在分钟和小时级，数据直接从实时数据中获取，采用批处理模式封装API。离线数据：高延迟，响应时间一般在T+1，数据从时间序列数据库历史库中批量获取，采用批处理模式封装API。为数据应用，按照数据时效性，分别对应不同应用。如下：准实时应用：本专利结合MAAS系统及数字孪生应用，要求数据响应在毫秒级，应用层通过API接口获取数据，并展示和交互；实时应用：本专利结合车辆轨迹分析应用，车辆分析查询10分钟内最新车辆数据，通过API接口获取数据，并展示。离线应用：主要用于数据仿真系统模型搭建、模型训练，同时也应用与车辆历史数据分析。本发明实施例还提供一种车路云一体化的时序数据管理方法，其包括：设备感知：通过设备感知层1采集车辆和路侧的原始感知数据，并将原始感知数据进行融合汇总，形成上报数据，实时发布到数据传输层3，还通过订阅主题的方式从数据传输层2获取云端数据管理层3下发的指令类数据。云端数据管理：通过云端数据管理层2接收上报数据，还通过订阅主题的方式获取原始感知数据，并将原始感知数据进行数据融合，获得车路融合数据，再对原始感知数据和车路融合数据分别进行存储，以提供实时和离线服务，为数据应用提供数据支撑服务；云端数据管理层2还用于接收数据应用侧下发的指令类数据，并将指令类数据进行存储，最后发布到数据传输层3，用于控制车辆和路侧设备。数据传输：通过数据传输层3搭建Mqtt Broker集群，用于接收设备感知层1和云端数据管理层2发布的数据，通过Mqtt Broker集群的Broker进行主题管理，并向订阅主题的设备感知层1和云端数据管理层2分发相应数据。在一个实施例中，云端数据管理的步骤中，通过时间序列数据库服务器22中的时间序列数据库对原始感知数据和车路融合数据分别进行存储，该存储方法具体包括：步骤221a，读写缓存实时数据；步骤222a，判断是否有对应当前缓存数据的子表，如无，则按照路侧设备和车辆作为维度，以超级表为模板创建子表；步骤223a，将步骤221a缓存的数据写入子表；其中，步骤222a中的超级表用于按照上报数据中基础数据及其标签属性创建子表。在一个实施例中，超级表具体包括如下类型：Type1，车辆感知超级表，其包括基础数据和标签数据，其中：基础数据包括车辆上报时间戳、车辆类型、车辆位置、车辆朝向、车辆速度和电量；标签数据包括车辆编号；Type 2，路侧感知超级表，其包括基础数据和标签数据，其中：基础数据包括路侧上报时间戳、目标类型、目标位置、目标长宽高、目标朝向和目标速度；标签数据包括路侧设备编号；Type 3，路侧交通事件超级表，其包括基础数据和标签数据，其中：基础数据包括事件上报时间戳、设备位置、交通事件位置、事件类型、事件来源和事件半径；标签数据包括设备编号；Type 4，红绿灯上报超级表，其包括基础数据和标签数据，其中：基础数据包括路口所在区域、相位号和灯组灯色；标签数据包括设备编号；Type 5，融合后超级表，其包括基础数据和标签数据，其中：基础数据包括时间戳、目标类型、目标位置、目标长宽高、目标朝向、目标速度、目标朝向和目标电量；标签数据包括数据类型和目标编号。在一个实施例中，云端数据管理的步骤中通过云端数据管理层2为数据应用侧提供数据支撑服务的方法具体包括：步骤221b，在接收到数据应用侧发起调用接口的请求后，将API Key在内的所有请求参数进行排序，然后与接口调用者的密码共同生成相应的请求签名，再判断请求签名与预设签名是否一致，如果是，则验证通过；步骤222b，按照proto buff格式定义，约定接口入参、出参标准，对实时和离线数据查询进行封装，并在接口鉴权模块验证通过后、接口服务时对时间序列数据库进行读写操作，反馈结果给数据应用侧，为其他系统提供调用的标准API。在一个实施例中，数据传输层3通过Mqtt Broker集群的Broker进行主题管理的类型具体包括：Type1，车辆感知类主题管理：接收上报数据中的车辆信息，并使用主题名称分割线方式对车辆信息对应的主题进行管理；Type2，车辆指令类主题管理：接收指令类数据中的车辆控制指令，并使用主题名称分割线方式对车辆指令和控制指令对应的主题进行管理；Type3，路侧感知类数据主题管理：接收上报数据中的路侧感知信息，并使用主题名称分割线方式对路侧感知信息对应的主题进行管理；Type4，路侧交通事件类数据主题管理：接收上报数据中的交通事件信息，并使用主题名称分割线方式对交通事件信息对应的主题进行管理；Type5，路侧红路灯类数据主题管理：接收上报数据中的红绿灯信息，并使用主题名称分割线方式对红绿灯信息对应的主题进行管理；Type6，路侧设备控制指令类主题管理：接收指令类数据中的路侧设备控制指令，并使用主题名称分割线方式对路侧设备控制指令对应的主题进行管理。最后需要指出的是：以上实施例仅用以说明本发明的技术方案，而非对其限制。本领域的普通技术人员应当理解：可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的精神和范围。
