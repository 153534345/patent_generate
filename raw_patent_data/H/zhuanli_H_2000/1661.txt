标题title
基于行情推送及查询的带宽均衡方法、设备及介质
摘要abst
本发明涉及互联网技术领域，提供一种基于行情推送及查询的带宽均衡方法、设备及介质，能够当服务端的推送带宽占用率在预设占用率范围内时，启动带宽均衡策略，避免影响带宽使用的稳定性，再结合每个客户端账号发起的所有请求占用带宽的权重、每个客户端账号的优先级确定目标优先级，以保证优先级高的账号的使用，从目标优先级下的每个目标客户端账号中选择带宽利用率最小的待处理客户端账号，并对待处理客户端账号进行降速处理，优先对带宽利用率小的客户端账号进行降速，以充分利用服务端带宽资源，保证整个行情推送及查询服务端运行的稳定，同时保证了实时行情推送在互联网中的性能。
权利要求书clms
1.一种基于行情推送及查询的带宽均衡方法，其特征在于，所述基于行情推送及查询的带宽均衡方法包括：获取服务端的推送带宽占用率，当所述推送带宽占用率在预设占用率范围内时，计算所述服务端的查询可用带宽及查询使用带宽；当所述查询使用带宽大于所述查询可用带宽时，获取向所述服务端发起行情推送及查询请求的客户端账号，并计算每个客户端账号发起的所有请求占用带宽的权重；获取每个客户端账号的优先级；根据每个客户端账号发起的所有请求占用带宽的权重、每个客户端账号的优先级确定目标优先级，并获取所述目标优先级下的每个目标客户端账号；计算每个目标客户端账号的带宽利用率；从每个目标客户端账号的带宽利用率中选择最小的带宽利用率所对应的目标客户端账号作为待处理客户端账号；对所述待处理客户端账号进行降速处理。2.如权利要求1所述的基于行情推送及查询的带宽均衡方法，其特征在于，所述获取服务端的推送带宽占用率后，所述方法还包括：获取预先配置的第一占用率阈值及第二占用率阈值；当所述推送带宽占用率达到所述第一占用率阈值时，生成告警日志；当所述推送带宽占用率大于或者等于所述第一占用率阈值，且小于所述第二占用率阈值时，确定所述推送带宽占用率在所述预设占用率范围内，不拒绝客户端账户登录；当所述推送带宽占用率达到所述第二占用率阈值时，对已进行所述降速处理的客户端账号执行二次降速处理；其中，所述第一占用率小于所述第二占用率阈值；其中，所述告警日志用于定位任意客户端账号被拒绝的原因，及用于提示扩充服务端节点。3.如权利要求1所述的基于行情推送及查询的带宽均衡方法，其特征在于，所述计算所述服务端的查询可用带宽及查询使用带宽包括：获取所有推送请求的连接的临时流控值的总和作为推送使用总带宽，及获取所述服务端的总带宽；计算所述总带宽与所述推送使用总带宽的差，得到所述查询可用带宽；获取所有查询请求的连接的临时流控值的总和作为所述查询使用带宽。4.如权利要求1所述的基于行情推送及查询的带宽均衡方法，其特征在于，所述计算所述服务端的查询可用带宽及查询使用带宽后，所述方法还包括：当所述查询使用带宽小于所述查询可用带宽时，从所述服务端的栈中弹出查询请求进行处理，直至所述查询使用带宽大于或者等于所述查询可用带宽。5.如权利要求1所述的基于行情推送及查询的带宽均衡方法，其特征在于，所述计算每个客户端账号发起的所有请求占用带宽的权重包括：对于任意客户端账号，当检测到有查询请求进入所述服务端时，将检测到的查询请求确定为第一请求；获取所述第一请求占用的带宽权重作为第一权重；获取该任意客户端账号在所述第一请求进入所述服务端前的所有请求占用带宽的权重作为第二权重；计算所述第一权重与所述第二权重的和作为该任意客户端账号发起的所有请求占用带宽的权重；或者对于所述任意客户端账号，当检测到有查询请求对应的查询结果被返回至所述任意客户端账号对应的客户端时，将检测到的查询请求确定为第二请求；获取所述第二请求占用的带宽权重作为第三权重；获取在所述第二请求对应的查询结果被返回至所述任意客户端账号对应的客户端前该任意客户端账号的所有请求占用带宽的权重作为第四权重；计算所述第四权重与所述第三权重的差作为该任意客户端账号发起的所有请求占用带宽的权重。6.如权利要求1所述的基于行情推送及查询的带宽均衡方法，其特征在于，所述方法还包括：在每轮确定所述目标优先级时，按照每个客户端账号的优先级创建数组；其中，所述数组中的不同元素对应于不同的优先级，不同元素具有不同的下标及不同的权重；从所述数组的各个元素中获取所述权重最小的元素作为目标元素；将所述目标元素对应的优先级确定为所述目标优先级；获取所述目标元素对应的权重作为目标权重，将所述目标权重的二倍确定为所述目标元素对应的新的权重，并利用所述新的权重在下一轮确定所述目标优先级的过程中参与各元素间对应权重的大小的比较；在多轮确定所述目标优先级后，当所述数组中每个元素对应的权重都相同时，将所述数组中的每个元素对应的权重还原为初始状态，并在下一轮确定所述目标优先级时利用所述初始状态执行各元素间对应权重的大小的比较。7.如权利要求1所述的基于行情推送及查询的带宽均衡方法，其特征在于，所述计算每个目标客户端账号的带宽利用率包括：获取每个目标客户端账号发起的所有请求占用带宽的总权重；获取带宽单位数目；计算每个目标客户端账号发起的所有请求占用带宽的总权重与所述带宽单位数目的商，作为每个目标客户端账号的带宽利用率。8.如权利要求1所述的基于行情推送及查询的带宽均衡方法，其特征在于，所述对所述待处理客户端账号进行降速处理包括：获取预先维护的各个优先级对应的降速策略集合；利用所述目标优先级在所述降速策略集合中进行遍历，得到目标降速策略；基于所述目标降速策略对所述待处理客户端账号进行降速处理。9.一种计算机设备，其特征在于，所述计算机设备包括：存储器，存储至少一个指令；及处理器，执行所述存储器中存储的指令以实现如权利要求1至8中任意一项所述的基于行情推送及查询的带宽均衡方法。10.一种计算机可读存储介质，其特征在于：所述计算机可读存储介质中存储有至少一个指令，所述至少一个指令被计算机设备中的处理器执行以实现如权利要求1至8中任意一项所述的基于行情推送及查询的带宽均衡方法。
说明书desc
技术领域在本发明涉及互联网技术领域，尤其涉及一种基于行情推送及查询的带宽均衡方法、设备及介质。背景技术在互联网场景下，大量客户端账号需要向服务端发起订阅推送实时行情请求和查询请求，但服务端的带宽资源是有限的，容易影响服务端系统服务能力的稳定性、带宽使用的稳定性，不同账号发起大量查询请求时会挤占实时推送行情的带宽使用，甚至造成网络拥塞，影响推送的实时性要求。现有技术中，在总的带宽使用不控制的情况下，在各种网络拥塞或抖动等异常发生后，再利用大量异常处理逻辑来解决异常，影响了正常处理逻辑的性能和可靠性。发明内容鉴于以上内容，有必要提供一种基于行情推送及查询的带宽均衡方法、设备及介质，旨在解决行情推送及查询场景下带宽不均衡的问题。一种基于行情推送及查询的带宽均衡方法，所述基于行情推送及查询的带宽均衡方法包括：获取服务端的推送带宽占用率，当所述推送带宽占用率在预设占用率范围内时，计算所述服务端的查询可用带宽及查询使用带宽；当所述查询使用带宽大于所述查询可用带宽时，获取向所述服务端发起行情推送及查询请求的客户端账号，并计算每个客户端账号发起的所有请求占用带宽的权重；获取每个客户端账号的优先级；根据每个客户端账号发起的所有请求占用带宽的权重、每个客户端账号的优先级确定目标优先级，并获取所述目标优先级下的每个目标客户端账号；计算每个目标客户端账号的带宽利用率；从每个目标客户端账号的带宽利用率中选择最小的带宽利用率所对应的目标客户端账号作为待处理客户端账号；对所述待处理客户端账号进行降速处理。根据本发明优选实施例，所述获取服务端的推送带宽占用率后，所述方法还包括：获取预先配置的第一占用率阈值及第二占用率阈值；当所述推送带宽占用率达到所述第一占用率阈值时，生成告警日志；当所述推送带宽占用率大于或者等于所述第一占用率阈值，且小于所述第二占用率阈值时，确定所述推送带宽占用率在所述预设占用率范围内，不拒绝客户端账户登录；当所述推送带宽占用率达到所述第二占用率阈值时，对已进行所述降速处理的客户端账号执行二次降速处理；其中，所述第一占用率小于所述第二占用率阈值；其中，所述告警日志用于定位任意客户端账号被拒绝的原因，及用于提示扩充服务端节点。根据本发明优选实施例，所述计算所述服务端的查询可用带宽及查询使用带宽包括：获取所有推送请求的连接的临时流控值的总和作为推送使用总带宽，及获取所述服务端的总带宽；计算所述总带宽与所述推送使用总带宽的差，得到所述查询可用带宽；获取所有查询请求的连接的临时流控值的总和作为所述查询使用带宽。根据本发明优选实施例，所述计算所述服务端的查询可用带宽及查询使用带宽后，所述方法还包括：当所述查询使用带宽小于所述查询可用带宽时，从所述服务端的栈中弹出查询请求进行处理，直至所述查询使用带宽大于或者等于所述查询可用带宽。根据本发明优选实施例，所述计算每个客户端账号发起的所有请求占用带宽的权重包括：对于任意客户端账号，当检测到有查询请求进入所述服务端时，将检测到的查询请求确定为第一请求；获取所述第一请求占用的带宽权重作为第一权重；获取该任意客户端账号在所述第一请求进入所述服务端前的所有请求占用带宽的权重作为第二权重；计算所述第一权重与所述第二权重的和作为该任意客户端账号发起的所有请求占用带宽的权重；或者对于所述任意客户端账号，当检测到有查询请求对应的查询结果被返回至所述任意客户端账号对应的客户端时，将检测到的查询请求确定为第二请求；获取所述第二请求占用的带宽权重作为第三权重；获取在所述第二请求对应的查询结果被返回至所述任意客户端账号对应的客户端前该任意客户端账号的所有请求占用带宽的权重作为第四权重；计算所述第四权重与所述第三权重的差作为该任意客户端账号发起的所有请求占用带宽的权重。根据本发明优选实施例，所述方法还包括：在每轮确定所述目标优先级时，按照每个客户端账号的优先级创建数组；其中，所述数组中的不同元素对应于不同的优先级，不同元素具有不同的下标及不同的权重；从所述数组的各个元素中获取所述权重最小的元素作为目标元素；将所述目标元素对应的优先级确定为所述目标优先级；获取所述目标元素对应的权重作为目标权重，将所述目标权重的二倍确定为所述目标元素对应的新的权重，并利用所述新的权重在下一轮确定所述目标优先级的过程中参与各元素间对应权重的大小的比较；在多轮确定所述目标优先级后，当所述数组中每个元素对应的权重都相同时，将所述数组中的每个元素对应的权重还原为初始状态，并在下一轮确定所述目标优先级时利用所述初始状态执行各元素间对应权重的大小的比较。根据本发明优选实施例，所述计算每个目标客户端账号的带宽利用率包括：获取每个目标客户端账号发起的所有请求占用带宽的总权重；获取带宽单位数目；计算每个目标客户端账号发起的所有请求占用带宽的总权重与所述带宽单位数目的商，作为每个目标客户端账号的带宽利用率。根据本发明优选实施例，所述对所述待处理客户端账号进行降速处理包括：获取预先维护的各个优先级对应的降速策略集合；利用所述目标优先级在所述降速策略集合中进行遍历，得到目标降速策略；基于所述目标降速策略对所述待处理客户端账号进行降速处理。一种计算机设备，所述计算机设备包括：存储器，存储至少一个指令；及处理器，执行所述存储器中存储的指令以实现所述基于行情推送及查询的带宽均衡方法。一种计算机可读存储介质，所述计算机可读存储介质中存储有至少一个指令，所述至少一个指令被计算机设备中的处理器执行以实现所述基于行情推送及查询的带宽均衡方法。由以上技术方案可以看出，本发明能够当服务端的推送带宽占用率在预设占用率范围内时，启动带宽均衡策略，避免影响带宽使用的稳定性，再结合每个客户端账号发起的所有请求占用带宽的权重、每个客户端账号的优先级确定目标优先级，以保证优先级高的账号的使用，从目标优先级下的每个目标客户端账号中选择带宽利用率最小的待处理客户端账号，并对待处理客户端账号进行降速处理，优先对带宽利用率小的客户端账号进行降速，以充分利用服务端带宽资源，保证整个行情推送及查询服务端运行的稳定，同时保证了实时行情推送在互联网中的性能。附图说明图1是本发明基于行情推送及查询的带宽均衡方法的较佳实施例的流程图。图2是本发明确定目标优先级的流程示意图。图3是本发明基于行情推送及查询的带宽均衡装置的较佳实施例的功能模块图。图4是本发明实现基于行情推送及查询的带宽均衡方法的较佳实施例的计算机设备的结构示意图。具体实施方式为了使本发明的目的、技术方案和优点更加清楚，下面结合附图和具体实施例对本发明进行详细描述。如图1所示，是本发明基于行情推送及查询的带宽均衡方法的较佳实施例的流程图。根据不同的需求，该流程图中步骤的顺序可以改变，某些步骤可以省略。所述基于行情推送及查询的带宽均衡方法应用于一个或者多个计算机设备中，所述计算机设备是一种能够按照事先设定或存储的指令，自动进行数值计算和/或信息处理的设备，其硬件包括但不限于微处理器、专用集成电路、可编程门阵列、数字处理器、嵌入式设备等。所述计算机设备可以是任何一种可与用户进行人机交互的电子产品，例如，个人计算机、平板电脑、智能手机、个人数字助理、游戏机、交互式网络电视、智能式穿戴式设备等。所述计算机设备还可以包括网络设备和/或用户设备。其中，所述网络设备包括，但不限于单个网络服务器、多个网络服务器组成的服务器组或基于云计算的由大量主机或网络服务器构成的云。所述服务器可以是独立的服务器，也可以是提供云服务、云数据库、云计算、云函数、云存储、网络服务、云通信、中间件服务、域名服务、安全服务、内容分发网络、以及大数据和人工智能平台等基础云计算服务的云服务器。其中，人工智能等。S10，获取服务端的推送带宽占用率，当所述推送带宽占用率在预设占用率范围内时，计算所述服务端的查询可用带宽及查询使用带宽。其中，所述预设占用率范围可以进行自定义配置，如在本实施例中，所述获取服务端的推送带宽占用率后，所述方法还包括：获取预先配置的第一占用率阈值及第二占用率阈值；当所述推送带宽占用率达到所述第一占用率阈值时，生成告警日志；当所述推送带宽占用率大于或者等于所述第一占用率阈值，且小于所述第二占用率阈值时，确定所述推送带宽占用率在所述预设占用率范围内，不拒绝客户端账户登录；当所述推送带宽占用率达到所述第二占用率阈值时，对已进行所述降速处理的客户端账号执行二次降速处理；其中，所述第一占用率小于所述第二占用率阈值；其中，所述告警日志用于定位任意客户端账号被拒绝的原因，及用于提示扩充服务端节点。其中，所述第一占用率阈值及所述第二占用率阈值可以根据实际使用需求进行配置，例如：所述第一占用率阈值可以配置为80%，所述第二占用率阈值可以配置为90%。在上述实施例中，当所述推送带宽占用率达到一定阈值时，生成告警日志，方便定位到客户端账号被拒原因，同时提示及时扩充服务端节点，以提升系统的稳定性。在每个连接到服务端的客户端账号都有推送和查询带宽限制的条件下，为保证网络使用稳定，且优先保障各个客户端账号的实时推送所需带宽，当所有账号推送总带宽占用达到总带宽一个阈值时，启动带宽均衡，按照账号优先级的不同来动态调节账号查询带宽的使用限制。当所述推送带宽占用率进一步上升至所述预设占用率范围时，启动后续的带宽均衡策略，但不拒绝客户端账户登录；当所述推送带宽占用率进一步上升达到更高的阈值时，对已进行降速处理的客户端账号执行二次降速处理，例如：原来有客户端账号被降速10%，此时对该客户端账号再降速10%。在本实施例中，当所述推送带宽占用率在预设占用率范围内时，启动带宽均衡策略，首先计算所述服务端的查询可用带宽及查询使用带宽，具体地，所述计算所述服务端的查询可用带宽及查询使用带宽包括：获取所有推送请求的连接的临时流控值的总和作为推送使用总带宽，及获取所述服务端的总带宽；计算所述总带宽与所述推送使用总带宽的差，得到所述查询可用带宽；获取所有查询请求的连接的临时流控值的总和作为所述查询使用带宽。其中，所述临时流控值是指实时产生的流控。所述临时流控值的初始值可以为自定义的阈值。S11，当所述查询使用带宽大于所述查询可用带宽时，获取向所述服务端发起行情推送及查询请求的客户端账号，并计算每个客户端账号发起的所有请求占用带宽的权重。在本实施例中，所述计算所述服务端的查询可用带宽及查询使用带宽后，所述方法还包括：当所述查询使用带宽小于所述查询可用带宽时，从所述服务端的栈中弹出查询请求进行处理，直至所述查询使用带宽大于或者等于所述查询可用带宽。在上述实施例中，当所述查询使用带宽小于所述查询可用带宽时，执行恢复带宽算法，以充分利用带宽。在本实施例中，所述计算每个客户端账号发起的所有请求占用带宽的权重包括：对于任意客户端账号，当检测到有查询请求进入所述服务端时，将检测到的查询请求确定为第一请求；获取所述第一请求占用的带宽权重作为第一权重；获取该任意客户端账号在所述第一请求进入所述服务端前的所有请求占用带宽的权重作为第二权重；计算所述第一权重与所述第二权重的和作为该任意客户端账号发起的所有请求占用带宽的权重；例如：假设不同行情类型的单个请求占用带宽权重为：所有K线权重：1，除K线以外的快照等权重：100。账号A目前的带宽权重为10，一个快照请求入队时，该账号A所有请求占用带宽的权重 = 10+100 = 110。或者对于所述任意客户端账号，当检测到有查询请求对应的查询结果被返回至所述任意客户端账号对应的客户端时，将检测到的查询请求确定为第二请求；获取所述第二请求占用的带宽权重作为第三权重；获取在所述第二请求对应的查询结果被返回至所述任意客户端账号对应的客户端前该任意客户端账号的所有请求占用带宽的权重作为第四权重；计算所述第四权重与所述第三权重的差作为该任意客户端账号发起的所有请求占用带宽的权重；例如：假设账号A目前的带宽权重为10，一个快照请求结果被返回时，该账号A所有请求占用带宽的权重 = 100-10 = 90。其中，当所述第四权重与所述第三权重的差为0时，说明此时没有请求，则可以触发总的查询使用带宽的计算：有在途查询的账号总的临时流控-该账号临时流控。其中，在途是指对应请求进入了服务端，但未返回结果。在本实施例中，在有客户端账号发送查询结果之前及之后，总的推动带宽等也都随之更新，以便进行实时准确的带宽均衡。S12，获取每个客户端账号的优先级。在本实施例中，为每个客户端账号配置不同的优先级，以便对优先级高的客户进行更加优质的服务。例如：可以根据用户的账户级别配置所述优先级，本发明不限制。按客户端账号优先级分档降低查询请求带宽限制，达到保证带宽稳定使用、风险可控，且保证优先级高的账号具有良好的使用体验。S13，根据每个客户端账号发起的所有请求占用带宽的权重、每个客户端账号的优先级确定目标优先级，并获取所述目标优先级下的每个目标客户端账号。在本实例中，所述方法还包括：在每轮确定所述目标优先级时，按照每个客户端账号的优先级创建数组；其中，所述数组中的不同元素对应于不同的优先级，不同元素具有不同的下标及不同的权重；从所述数组的各个元素中获取所述权重最小的元素作为目标元素；将所述目标元素对应的优先级确定为所述目标优先级；获取所述目标元素对应的权重作为目标权重，将所述目标权重的二倍确定为所述目标元素对应的新的权重，并利用所述新的权重在下一轮确定所述目标优先级的过程中参与各元素间对应权重的大小的比较；在多轮确定所述目标优先级后，当所述数组中每个元素对应的权重都相同时，将所述数组中的每个元素对应的权重还原为初始状态，并在下一轮确定所述目标优先级时利用所述初始状态执行各元素间对应权重的大小的比较。例如：请参考图2，是本发明确定目标优先级的流程示意图。在第一轮时，数组中包含3个元素，权重分别为：1、3、5，对应的优先级分别为3、2、1，下标分别为0、1、2，将各元素对应的权重进行两两比较，最终选择权重最小的元素作为目标元素，即选择第一列中的权重为1，优先级为3，下标为0的元素所对应的优先级作为所述目标优先级。进一步地，在进行下一轮时，将上一轮被选择的元素的权重乘以2，即将上一轮被选择的元素的权重1再加上上一轮被选择的元素的权重1，得到下一轮时该元素用于比较的权重2，以此类推。经过多轮后，当所述数组中每个元素对应的权重都相同时，将所述数组中的每个元素对应的权重还原为初始状态1、3、5，并在下一轮确定所述目标优先级时利用所述初始状态执行各元素间对应权重的大小的比较。通过上述实施例，能够利用优先级和权重选择需要被降速的客户端账号，以便针对性地对客户端账号进行带宽限制，使优先级高的客户端账号能够具有更高的使用体验。S14，计算每个目标客户端账号的带宽利用率。在本实施例中，所述计算每个目标客户端账号的带宽利用率包括：获取每个目标客户端账号发起的所有请求占用带宽的总权重；获取带宽单位数目；计算每个目标客户端账号发起的所有请求占用带宽的总权重与所述带宽单位数目的商，作为每个目标客户端账号的带宽利用率。其中，所述带宽单位数目可以为账号临时流控与100kbps的商，是一个固定值。S15，从每个目标客户端账号的带宽利用率中选择最小的带宽利用率所对应的目标客户端账号作为待处理客户端账号。在上述实施例中，从每个目标客户端账号的带宽利用率中选择最小的带宽利用率所对应的目标客户端账号作为待处理客户端账号，由于所述待处理客户端账号本身的带宽利用率不高，因此，可以对所述待处理客户端账号优先进行带宽限制，以降低对其他客户端账号带宽使用情况的影响。S16，对所述待处理客户端账号进行降速处理。在本实施例中，所述对所述待处理客户端账号进行降速处理包括：获取预先维护的各个优先级对应的降速策略集合；利用所述目标优先级在所述降速策略集合中进行遍历，得到目标降速策略；基于所述目标降速策略对所述待处理客户端账号进行降速处理。例如：在所述降速策略集合中记录了各个优先级与对应降速策略的映射关系，对于高优先级的客户端账号，对应的降速策略为降速10%，对于中优先级的客户端账号，对应的降速策略为降速20%，对于低优先级的客户端账号，对应的降速策略为降速30%，则当所述目标优先级为低优先级时，通过在所述降速策略集合中进行遍历，可以确定对应的降速策略为降速30%，提前预防和处理来保证系统运行和带宽使用的稳定。由以上技术方案可以看出，本发明能够当服务端的推送带宽占用率在预设占用率范围内时，启动带宽均衡策略，避免影响带宽使用的稳定性，再结合每个客户端账号发起的所有请求占用带宽的权重、每个客户端账号的优先级确定目标优先级，以保证优先级高的账号的使用，从目标优先级下的每个目标客户端账号中选择带宽利用率最小的待处理客户端账号，并对待处理客户端账号进行降速处理，优先对带宽利用率小的客户端账号进行降速，以充分利用服务端带宽资源，保证整个行情推送及查询服务端运行的稳定，同时保证了实时行情推送在互联网中的性能。如图3所示，是本发明基于行情推送及查询的带宽均衡装置的较佳实施例的功能模块图。所述基于行情推送及查询的带宽均衡装置11包括计算单元110、获取单元111、确定单元112、选择单元113、降速单元114。本发明所称的模块/单元是指一种能够被处理器所执行，并且能够完成固定功能的一系列计算机程序段，其存储在存储器中。在本实施例中，关于各模块/单元的功能将在后续的实施例中详述。所述计算单元110，用于获取服务端的推送带宽占用率，当所述推送带宽占用率在预设占用率范围内时，计算所述服务端的查询可用带宽及查询使用带宽。其中，所述预设占用率范围可以进行自定义配置，如在本实施例中，所述获取服务端的推送带宽占用率后，获取预先配置的第一占用率阈值及第二占用率阈值；当所述推送带宽占用率达到所述第一占用率阈值时，生成告警日志；当所述推送带宽占用率大于或者等于所述第一占用率阈值，且小于所述第二占用率阈值时，确定所述推送带宽占用率在所述预设占用率范围内，不拒绝客户端账户登录；当所述推送带宽占用率达到所述第二占用率阈值时，对已进行所述降速处理的客户端账号执行二次降速处理；其中，所述第一占用率小于所述第二占用率阈值；其中，所述告警日志用于定位任意客户端账号被拒绝的原因，及用于提示扩充服务端节点。其中，所述第一占用率阈值及所述第二占用率阈值可以根据实际使用需求进行配置，例如：所述第一占用率阈值可以配置为80%，所述第二占用率阈值可以配置为90%。在上述实施例中，当所述推送带宽占用率达到一定阈值时，生成告警日志，方便定位到客户端账号被拒原因，同时提示及时扩充服务端节点，以提升系统的稳定性。在每个连接到服务端的客户端账号都有推送和查询带宽限制的条件下，为保证网络使用稳定，且优先保障各个客户端账号的实时推送所需带宽，当所有账号推送总带宽占用达到总带宽一个阈值时，启动带宽均衡，按照账号优先级的不同来动态调节账号查询带宽的使用限制。当所述推送带宽占用率进一步上升至所述预设占用率范围时，启动后续的带宽均衡策略，但不拒绝客户端账户登录；当所述推送带宽占用率进一步上升达到更高的阈值时，对已进行降速处理的客户端账号执行二次降速处理，例如：原来有客户端账号被降速10%，此时对该客户端账号再降速10%。在本实施例中，当所述推送带宽占用率在预设占用率范围内时，启动带宽均衡策略，首先计算所述服务端的查询可用带宽及查询使用带宽，具体地，所述计算单元110计算所述服务端的查询可用带宽及查询使用带宽包括：获取所有推送请求的连接的临时流控值的总和作为推送使用总带宽，及获取所述服务端的总带宽；计算所述总带宽与所述推送使用总带宽的差，得到所述查询可用带宽；获取所有查询请求的连接的临时流控值的总和作为所述查询使用带宽。其中，所述临时流控值是指实时产生的流控。所述临时流控值的初始值可以为自定义的阈值。所述计算单元110，还用于当所述查询使用带宽大于所述查询可用带宽时，获取向所述服务端发起行情推送及查询请求的客户端账号，并计算每个客户端账号发起的所有请求占用带宽的权重。在本实施例中，所述计算所述服务端的查询可用带宽及查询使用带宽后，当所述查询使用带宽小于所述查询可用带宽时，从所述服务端的栈中弹出查询请求进行处理，直至所述查询使用带宽大于或者等于所述查询可用带宽。在上述实施例中，当所述查询使用带宽小于所述查询可用带宽时，执行恢复带宽算法，以充分利用带宽。在本实施例中，所述计算单元110计算每个客户端账号发起的所有请求占用带宽的权重包括：对于任意客户端账号，当检测到有查询请求进入所述服务端时，将检测到的查询请求确定为第一请求；获取所述第一请求占用的带宽权重作为第一权重；获取该任意客户端账号在所述第一请求进入所述服务端前的所有请求占用带宽的权重作为第二权重；计算所述第一权重与所述第二权重的和作为该任意客户端账号发起的所有请求占用带宽的权重；例如：假设不同行情类型的单个请求占用带宽权重为：所有K线权重：1，除K线以外的快照等权重：100。账号A目前的带宽权重为10，一个快照请求入队时，该账号A所有请求占用带宽的权重 = 10+100 = 110。或者对于所述任意客户端账号，当检测到有查询请求对应的查询结果被返回至所述任意客户端账号对应的客户端时，将检测到的查询请求确定为第二请求；获取所述第二请求占用的带宽权重作为第三权重；获取在所述第二请求对应的查询结果被返回至所述任意客户端账号对应的客户端前该任意客户端账号的所有请求占用带宽的权重作为第四权重；计算所述第四权重与所述第三权重的差作为该任意客户端账号发起的所有请求占用带宽的权重；例如：假设账号A目前的带宽权重为10，一个快照请求结果被返回时，该账号A所有请求占用带宽的权重 = 100-10 = 90。其中，当所述第四权重与所述第三权重的差为0时，说明此时没有请求，则可以触发总的查询使用带宽的计算：有在途查询的账号总的临时流控-该账号临时流控。其中，在途是指对应请求进入了服务端，但未返回结果。在本实施例中，在有客户端账号发送查询结果之前及之后，总的推动带宽等也都随之更新，以便进行实时准确的带宽均衡。所述获取单元111，用于获取每个客户端账号的优先级。在本实施例中，为每个客户端账号配置不同的优先级，以便对优先级高的客户进行更加优质的服务。例如：可以根据用户的账户级别配置所述优先级，本发明不限制。按客户端账号优先级分档降低查询请求带宽限制，达到保证带宽稳定使用、风险可控，且保证优先级高的账号具有良好的使用体验。所述确定单元112，用于根据每个客户端账号发起的所有请求占用带宽的权重、每个客户端账号的优先级确定目标优先级，并获取所述目标优先级下的每个目标客户端账号。在本实例中，在每轮确定所述目标优先级时，按照每个客户端账号的优先级创建数组；其中，所述数组中的不同元素对应于不同的优先级，不同元素具有不同的下标及不同的权重；从所述数组的各个元素中获取所述权重最小的元素作为目标元素；将所述目标元素对应的优先级确定为所述目标优先级；获取所述目标元素对应的权重作为目标权重，将所述目标权重的二倍确定为所述目标元素对应的新的权重，并利用所述新的权重在下一轮确定所述目标优先级的过程中参与各元素间对应权重的大小的比较；在多轮确定所述目标优先级后，当所述数组中每个元素对应的权重都相同时，将所述数组中的每个元素对应的权重还原为初始状态，并在下一轮确定所述目标优先级时利用所述初始状态执行各元素间对应权重的大小的比较。例如：请参考图2，是本发明确定目标优先级的流程示意图。在第一轮时，数组中包含3个元素，权重分别为：1、3、5，对应的优先级分别为3、2、1，下标分别为0、1、2，将各元素对应的权重进行两两比较，最终选择权重最小的元素作为目标元素，即选择第一列中的权重为1，优先级为3，下标为0的元素所对应的优先级作为所述目标优先级。进一步地，在进行下一轮时，将上一轮被选择的元素的权重乘以2，即将上一轮被选择的元素的权重1再加上上一轮被选择的元素的权重1，得到下一轮时该元素用于比较的权重2，以此类推。经过多轮后，当所述数组中每个元素对应的权重都相同时，将所述数组中的每个元素对应的权重还原为初始状态1、3、5，并在下一轮确定所述目标优先级时利用所述初始状态执行各元素间对应权重的大小的比较。通过上述实施例，能够利用优先级和权重选择需要被降速的客户端账号，以便针对性地对客户端账号进行带宽限制，使优先级高的客户端账号能够具有更高的使用体验。所述计算单元110，还用于计算每个目标客户端账号的带宽利用率。在本实施例中，所述计算单元110计算每个目标客户端账号的带宽利用率包括：获取每个目标客户端账号发起的所有请求占用带宽的总权重；获取带宽单位数目；计算每个目标客户端账号发起的所有请求占用带宽的总权重与所述带宽单位数目的商，作为每个目标客户端账号的带宽利用率。其中，所述带宽单位数目可以为账号临时流控与100kbps的商，是一个固定值。所述选择单元113，用于从每个目标客户端账号的带宽利用率中选择最小的带宽利用率所对应的目标客户端账号作为待处理客户端账号。在上述实施例中，从每个目标客户端账号的带宽利用率中选择最小的带宽利用率所对应的目标客户端账号作为待处理客户端账号，由于所述待处理客户端账号本身的带宽利用率不高，因此，可以对所述待处理客户端账号优先进行带宽限制，以降低对其他客户端账号带宽使用情况的影响。所述降速单元114，用于对所述待处理客户端账号进行降速处理。在本实施例中，所述降速单元114对所述待处理客户端账号进行降速处理包括：获取预先维护的各个优先级对应的降速策略集合；利用所述目标优先级在所述降速策略集合中进行遍历，得到目标降速策略；基于所述目标降速策略对所述待处理客户端账号进行降速处理。例如：在所述降速策略集合中记录了各个优先级与对应降速策略的映射关系，对于高优先级的客户端账号，对应的降速策略为降速10%，对于中优先级的客户端账号，对应的降速策略为降速20%，对于低优先级的客户端账号，对应的降速策略为降速30%，则当所述目标优先级为低优先级时，通过在所述降速策略集合中进行遍历，可以确定对应的降速策略为降速30%，提前预防和处理来保证系统运行和带宽使用的稳定。由以上技术方案可以看出，本发明能够当服务端的推送带宽占用率在预设占用率范围内时，启动带宽均衡策略，避免影响带宽使用的稳定性，再结合每个客户端账号发起的所有请求占用带宽的权重、每个客户端账号的优先级确定目标优先级，以保证优先级高的账号的使用，从目标优先级下的每个目标客户端账号中选择带宽利用率最小的待处理客户端账号，并对待处理客户端账号进行降速处理，优先对带宽利用率小的客户端账号进行降速，以充分利用服务端带宽资源，保证整个行情推送及查询服务端运行的稳定，同时保证了实时行情推送在互联网中的性能。如图4所示，是本发明实现基于行情推送及查询的带宽均衡方法的较佳实施例的计算机设备的结构示意图。所述计算机设备1可以包括存储器12、处理器13和总线，还可以包括存储在所述存储器12中并可在所述处理器13上运行的计算机程序，例如基于行情推送及查询的带宽均衡程序。本领域技术人员可以理解，所述示意图仅仅是计算机设备1的示例，并不构成对计算机设备1的限定，所述计算机设备1既可以是总线型结构，也可以是星形结构，所述计算机设备1还可以包括比图示更多或更少的其他硬件或者软件，或者不同的部件布置，例如所述计算机设备1还可以包括输入输出设备、网络接入设备等。需要说明的是，所述计算机设备1仅为举例，其他现有的或今后可能出现的电子产品如可适应于本发明，也应包含在本发明的保护范围以内，并以引用方式包含于此。其中，存储器12至少包括一种类型的可读存储介质，所述可读存储介质包括闪存、移动硬盘、多媒体卡、卡型存储器、磁性存储器、磁盘、光盘等。存储器12在一些实施例中可以是计算机设备1的内部存储单元，例如该计算机设备1的移动硬盘。存储器12在另一些实施例中也可以是计算机设备1的外部存储设备，例如计算机设备1上配备的插接式移动硬盘、智能存储卡、安全数字卡、闪存卡等。进一步地，存储器12还可以既包括计算机设备1的内部存储单元也包括外部存储设备。存储器12不仅可以用于存储安装于计算机设备1的应用软件及各类数据，例如基于行情推送及查询的带宽均衡程序的代码等，还可以用于暂时地存储已经输出或者将要输出的数据。处理器13在一些实施例中可以由集成电路组成，例如可以由单个封装的集成电路所组成，也可以是由多个相同功能或不同功能封装的集成电路所组成，包括一个或者多个中央处理器、微处理器、数字处理芯片、图形处理器及各种控制芯片的组合等。处理器13是所述计算机设备1的控制核心，利用各种接口和线路连接整个计算机设备1的各个部件，通过运行或执行存储在所述存储器12内的程序或者模块，以及调用存储在所述存储器12内的数据，以执行计算机设备1的各种功能和处理数据。所述处理器13执行所述计算机设备1的操作系统以及安装的各类应用程序。所述处理器13执行所述应用程序以实现上述各个基于行情推送及查询的带宽均衡方法实施例中的步骤，例如图1所示的步骤。示例性的，所述计算机程序可以被分割成一个或多个模块/单元，所述一个或者多个模块/单元被存储在所述存储器12中，并由所述处理器13执行，以完成本发明。所述一个或多个模块/单元可以是能够完成特定功能的一系列计算机可读指令段，该指令段用于描述所述计算机程序在所述计算机设备1中的执行过程。例如，所述计算机程序可以被分割成计算单元110、获取单元111、确定单元112、选择单元113、降速单元114。上述以软件功能模块的形式实现的集成的单元，可以存储在一个计算机可读取存储介质中。上述软件功能模块存储在一个存储介质中，包括若干指令用以使得一台计算机设备或处理器执行本发明各个实施例所述基于行情推送及查询的带宽均衡方法的部分。所述计算机设备1集成的模块/单元如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本发明实现上述实施例方法中的全部或部分流程，也可以通过计算机程序来指示相关的硬件设备来完成，所述的计算机程序可存储于一计算机可读存储介质中，该计算机程序在被处理器执行时，可实现上述各个方法实施例的步骤。其中，所述计算机程序包括计算机程序代码，所述计算机程序代码可以为源代码形式、对象代码形式、可执行文件或某些中间形式等。所述计算机可读介质可以包括：能够携带所述计算机程序代码的任何实体或装置、记录介质、U盘、移动硬盘、磁碟、光盘、计算机存储器、只读存储器、随机存取存储器等。进一步地，计算机可读存储介质可主要包括存储程序区和存储数据区，其中，存储程序区可存储操作系统、至少一个功能所需的应用程序等；存储数据区可存储根据区块链节点的使用所创建的数据等。本发明所指区块链是分布式数据存储、点对点传输、共识机制、加密算法等计算机技术的新型应用模式。区块链，本质上是一个去中心化的数据库，是一串使用密码学方法相关联产生的数据块，每一个数据块中包含了一批次网络交易的信息，用于验证其信息的有效性和生成下一个区块。区块链可以包括区块链底层平台、平台产品服务层以及应用服务层等。总线可以是外设部件互连标准总线或扩展工业标准结构总线等。该总线可以分为地址总线、数据总线、控制总线等。为便于表示，在图4中仅用一根直线表示，但并不表示仅有一根总线或一种类型的总线。所述总线被设置为实现所述存储器12以及至少一个处理器13等之间的连接通信。尽管未示出，所述计算机设备1还可以包括给各个部件供电的电源，优选地，电源可以通过电源管理装置与所述至少一个处理器13逻辑相连，从而通过电源管理装置实现充电管理、放电管理、以及功耗管理等功能。电源还可以包括一个或一个以上的直流或交流电源、再充电装置、电源故障检测电路、电源转换器或者逆变器、电源状态指示器等任意组件。所述计算机设备1还可以包括多种传感器、蓝牙模块、Wi-Fi模块等，在此不再赘述。进一步地，所述计算机设备1还可以包括网络接口，可选地，所述网络接口可以包括有线接口和/或无线接口，通常用于在该计算机设备1与其他计算机设备之间建立通信连接。可选地，该计算机设备1还可以包括用户接口，用户接口可以是显示器、输入单元），可选地，用户接口还可以是标准的有线接口、无线接口。可选地，在一些实施例中，显示器可以是LED显示器、液晶显示器、触控式液晶显示器以及OLED触摸器等。其中，显示器也可以适当的称为显示屏或显示单元，用于显示在计算机设备1中处理的信息以及用于显示可视化的用户界面。应该了解，所述实施例仅为说明之用，在专利申请范围上并不受此结构的限制。图4仅示出了具有组件12-13的计算机设备1，本领域技术人员可以理解的是，图4示出的结构并不构成对所述计算机设备1的限定，可以包括比图示更少或者更多的部件，或者组合某些部件，或者不同的部件布置。结合图1，所述计算机设备1中的所述存储器12存储多个指令以实现一种基于行情推送及查询的带宽均衡方法，所述处理器13可执行所述多个指令从而实现：获取服务端的推送带宽占用率，当所述推送带宽占用率在预设占用率范围内时，计算所述服务端的查询可用带宽及查询使用带宽；当所述查询使用带宽大于所述查询可用带宽时，获取向所述服务端发起行情推送及查询请求的客户端账号，并计算每个客户端账号发起的所有请求占用带宽的权重；获取每个客户端账号的优先级；根据每个客户端账号发起的所有请求占用带宽的权重、每个客户端账号的优先级确定目标优先级，并获取所述目标优先级下的每个目标客户端账号；计算每个目标客户端账号的带宽利用率；从每个目标客户端账号的带宽利用率中选择最小的带宽利用率所对应的目标客户端账号作为待处理客户端账号；对所述待处理客户端账号进行降速处理。具体地，所述处理器13对上述指令的具体实现方法可参考图1对应实施例中相关步骤的描述，在此不赘述。需要说明的是，本案中所涉及到的数据均为合法取得。在本发明所提供的几个实施例中，应该理解到，所揭露的系统，装置和方法，可以通过其它的方式实现。例如，以上所描述的装置实施例仅仅是示意性的，例如，所述模块的划分，仅仅为一种逻辑功能划分，实际实现时可以有另外的划分方式。本发明可用于众多通用或专用的计算机系统环境或配置中。例如：个人计算机、服务器计算机、手持设备或便携式设备、平板型设备、多处理器系统、基于微处理器的系统、置顶盒、可编程的消费电子设备、网络PC、小型计算机、大型计算机、包括以上任何系统或设备的分布式计算环境等等。本发明可以在由计算机执行的计算机可执行指令的一般上下文中描述，例如程序模块。一般地，程序模块包括执行特定任务或实现特定抽象数据类型的例程、程序、对象、组件、数据结构等等。也可以在分布式计算环境中实践本发明，在这些分布式计算环境中，由通过通信网络而被连接的远程处理设备来执行任务。在分布式计算环境中，程序模块可以位于包括存储设备在内的本地和远程计算机存储介质中。所述作为分离部件说明的模块可以是或者也可以不是物理上分开的，作为模块显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部模块来实现本实施例方案的目的。另外，在本发明各个实施例中的各功能模块可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中。上述集成的单元既可以采用硬件的形式实现，也可以采用硬件加软件功能模块的形式实现。对于本领域技术人员而言，显然本发明不限于上述示范性实施例的细节，而且在不背离本发明的精神或基本特征的情况下，能够以其他的具体形式实现本发明。因此，无论从哪一点来看，均应将实施例看作是示范性的，而且是非限制性的，本发明的范围由所附权利要求而不是上述说明限定，因此旨在将落在权利要求的等同要件的含义和范围内的所有变化涵括在本发明内。不应将权利要求中的任何附关联图标记视为限制所涉及的权利要求。此外，显然“包括”一词不排除其他单元或步骤，单数不排除复数。本发明中陈述的多个单元或装置也可以由一个单元或装置通过软件或者硬件来实现。第一、第二等词语用来表示名称，而并不表示任何特定的顺序。最后应说明的是，以上实施例仅用以说明本发明的技术方案而非限制，尽管参照较佳实施例对本发明进行了详细说明，本领域的普通技术人员应当理解，可以对本发明的技术方案进行修改或等同替换，而不脱离本发明技术方案的精神和范围。
