标题title
基于UART通信的波特率自适应方法、装置、UART系统、介质
摘要abst
本发明提出了一种基于UART通信的波特率自适应方法、装置、UART系统、介质，该方法包括：上位机发送识别帧和参考时钟，高低电平计数器进行电平计数并向计数值比较器输出电平计数值；计数值比较器被填满后向采样时钟生成器输出目标计数值以确定采样时钟和目标波特率；数据控制模块根据采样时钟得到采样数据并发送至上位机；当采样数据和校验数据一致，将目标波特率和采样时钟发送至从机，上位机通过数据控制模块与从机交互通信数据。根据本发明实施例的技术方案，能够根据识别帧确定采样时钟，进而自动确定上位机的目标波特率，无需上位机与从机进行复杂的命令交互，简化了波特率的自适应过程，提高了波特率的识别效率。
权利要求书clms
1.一种基于UART通信的波特率自适应方法，其特征在于，应用于UART系统，所述UART系统包括波特率自适应装置、上位机和从机，所述波特率自适应装置包括高低电平计数器、计数值比较器、采样时钟生成器和数据控制模块，所述高低电平计数器和所述数据控制模块与所述上位机相连接，所述采样时钟生成器和所述数据控制模块与所述从机相连接，所述基于UART通信的波特率自适应方法包括：当所述UART系统上电，所述上位机向所述波特率自适应装置发送识别帧和参考时钟，其中，所述识别帧包括识别数据和校验数据，所述识别数据位于所述校验数据之前，所述识别数据的数据量与所述计数值比较器的存储空间相同；所述计数值比较器在未被填满的状态下使能所述高低电平计数器，所述高低电平计数器根据所述参考时钟对所述识别数据进行电平计数，向所述计数值比较器输出多个电平计数值，其中，所述电平计数值用于指示高电平或者低电平的时长；当所述计数值比较器被填满，停止使能所述高低电平计数器，向所述采样时钟生成器发送目标计数值，其中，所述目标计数值用于指示数值相同的所述电平计数值的最大数量；所述采样时钟生成器根据所述参考时钟和所述目标计数值确定采样时钟，根据所述采样时钟确定目标波特率，使能所述数据控制模块并将所述采样时钟发送至所述数据控制模块；所述数据控制模块根据所述采样时钟对所述上位机发送的数据进行数据采样得到采样数据，将所述采样数据发送至所述上位机；当所述采样数据和所述校验数据一致，所述数据控制模块使能所述采样时钟生成器将所述目标波特率和所述采样时钟发送至所述从机，所述上位机通过所述数据控制模块与所述从机交互通信数据。2.根据权利要求1所述的基于UART通信的波特率自适应方法，其特征在于，所述上位机向所述波特率自适应装置发送识别帧和参考时钟，包括：所述上位机生成所述识别帧，根据所述波特率自适应装置的数据接收位数将所述识别帧拆分成多组帧数据；所述上位机根据所述帧数据生成所述识别数据和所述校验数据，其中，所述识别数据和所述校验数据均包括依次排列的起始位、所述帧数据和停止位，所述识别数据的所述帧数据在所述识别帧中位于所述校验数据的所述帧数据之前；所述上位机向所述波特率自适应装置持续发送所述参考时钟，并依次发送所述识别数据和所述校验数据。3.根据权利要求2所述的基于UART通信的波特率自适应方法，其特征在于，所述高低电平计数器根据所述参考时钟对所述识别数据进行电平计数，向所述计数值比较器输出多个电平计数值，包括：所述高低电平计数器在检测到所述起始位的下降沿后启动电平计数；每当所述高低电平计数器检测到一次新的上升沿，进行一次高电平计数，并向所述计数值比较器输出一个所述电平计数值；每当所述高低电平计数器检测到一次新的下降沿，进行一次低电平计数，并向所述计数值比较器输出一个所述电平计数值；当所述高低电平计数器检测所述停止位的上升沿，停止电平计数。4.根据权利要求3所述的基于UART通信的波特率自适应方法，其特征在于，所述计数值比较器包括多个寄存器，当所述计数值比较器被填满，停止使能所述高低电平计数器，向所述采样时钟生成器发送目标计数值，包括：所述计数值比较器将所述电平计数值存入所述寄存器，其中，每个所述寄存器存储有一个所述电平计数值；当所述计数值比较器的全部所述寄存器被填满，停止使能所述高低电平计数器；所述计数值比较器对所述寄存器中所存储的电平计数值进行数值比对，根据相同次数最多的所述电平计数值确定所述目标计数值，将所述目标计数值发送至所述采样时钟生成器。5.根据权利要求1所述的基于UART通信的波特率自适应方法，其特征在于，所述采样时钟生成器根据所述参考时钟和所述目标计数值确定采样时钟，包括：所述采样时钟生成器以所述参考时钟为基准，根据所述目标计数值的一半所指示的时长翻转一次得到翻转电平；根据全部的所述翻转电平组成所述采样时钟。6.根据权利要求1所述的基于UART通信的波特率自适应方法，其特征在于，所述数据控制模块根据所述采样时钟对所述上位机发送的数据进行数据采样得到采样数据，包括：所述数据控制模块根据所述采样时钟的上升沿，对所述上位机发送数据进行电平采样得到采样电平；所述数据控制模块根据所述校验数据的数据长度，将全部的所述采样电平组成所述采样数据。7.根据权利要求1所述的基于UART通信的波特率自适应方法，其特征在于，所述波特率自适应装置还包括复位系统，所述方法还包括：当所述复位系统获取到内部复位信号或者外部复位信号，清空所述计数值比较器，以使所述计数器比较器重新使能所述高低电平计数器，其中，所述内部复位信号又所述数据控制模块在确定所述采样数据和所述校验数据不一致后生成，所述外部复位信号由所述上位机生成；所述上位机向所述波特率自适应装置重新发送所述识别帧和所述参考时钟。8.一种基于UART通信的波特率自适应装置，其特征在于，包括至少一个控制处理器和用于与所述至少一个控制处理器通信连接的存储器；所述存储器存储有可被所述至少一个控制处理器执行的指令，所述指令被所述至少一个控制处理器执行，以使所述至少一个控制处理器能够执行如权利要求1至7任一项所述的基于UART通信的波特率自适应方法。9.一种UART系统，其特征在于，包括权利要求8所述的基于UART通信的波特率自适应装置。10.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质存储有计算机可执行指令，所述计算机可执行指令用于使计算机执行如权利要求1至7任一项所述的基于UART通信的波特率自适应方法。
说明书desc
技术领域本发明涉及UART通信技术领域，特别涉及一种基于UART通信的波特率自适应方法、装置、UART系统、介质。背景技术目前，UART通信技术应用于各种领域和设备中，为了确保数据传输正确，必须要确保两个设备的波特率一致。在传统的波特率配置方法中，需要在从机提供一组与上位机独立通信的接口，使上位机能直接访问从机内的配置寄存器，再通过上位机直接向从机配置一致的波特率。虽然实现了波特率的一致，但是会增加接口设计的复杂度和设备的通信管脚，影响开发效率。一些相关技术提出了波特率的自适应方法，通过从机自行识别上位机通信所使用的波特率，并将自身的波特率调整为一致。但是在自适应完成之前，上位机和从机的波特率并不一致，此时进行的命令交互或者寄存器操作非常复杂，开发难度较大，自动化程度较低。发明内容本发明旨在至少解决现有技术中存在的技术问题之一。为此，本发明提出一种基于UART通信的波特率自适应方法、装置、UART系统、介质，能够简化波特率的自适应过程，提高自适应波特率的效率。第一方面，本发明实施例提供了一种基于UART通信的波特率自适应方法，应用于UART系统，所述UART系统包括波特率自适应装置、上位机和从机，所述波特率自适应装置包括高低电平计数器、计数值比较器、采样时钟生成器和数据控制模块，所述高低电平计数器和所述数据控制模块与所述上位机相连接，所述采样时钟生成器和所述数据控制模块与所述从机相连接，所述基于UART通信的波特率自适应方法包括：当所述UART系统上电，所述上位机向所述波特率自适应装置发送识别帧和参考时钟，其中，所述识别帧包括识别数据和校验数据，所述识别数据位于所述校验数据之前，所述识别数据的数据量与所述计数值比较器的存储空间相同；所述计数值比较器在未被填满的状态下使能所述高低电平计数器，所述高低电平计数器根据所述参考时钟对所述识别数据进行电平计数，向所述计数值比较器输出多个电平计数值，其中，所述电平计数值用于指示高电平或者低电平的时长；当所述计数值比较器被填满，停止使能所述高低电平计数器，向所述采样时钟生成器发送目标计数值，其中，所述目标计数值用于指示数值相同的所述电平计数值的最大数量；所述采样时钟生成器根据所述参考时钟和所述目标计数值确定采样时钟，根据所述采样时钟确定目标波特率，使能所述数据控制模块并将所述采样时钟发送至所述数据控制模块；所述数据控制模块根据所述采样时钟对所述上位机发送的数据进行数据采样得到采样数据，将所述采样数据发送至所述上位机；当所述采样数据和所述校验数据一致，所述数据控制模块使能所述采样时钟生成器将所述目标波特率和所述采样时钟发送至所述从机，所述上位机通过所述数据控制模块与所述从机交互通信数据。根据本发明的一些实施例，所述上位机向所述波特率自适应装置发送识别帧和参考时钟，包括：所述上位机生成所述识别帧，根据所述波特率自适应装置的数据接收位数将所述识别帧拆分成多组帧数据；所述上位机根据所述帧数据生成所述识别数据和所述校验数据，其中，所述识别数据和所述校验数据均包括依次排列的起始位、所述帧数据和停止位，所述识别数据的所述帧数据在所述识别帧中位于所述校验数据的所述帧数据之前；所述上位机向所述波特率自适应装置持续发送所述参考时钟，并依次发送所述识别数据和所述校验数据。根据本发明的一些实施例，所述高低电平计数器根据所述参考时钟对所述识别数据进行电平计数，向所述计数值比较器输出多个电平计数值，包括：所述高低电平计数器在检测到所述起始位的下降沿后启动电平计数；每当所述高低电平计数器检测到一次新的上升沿，进行一次高电平计数，并向所述计数值比较器输出一个所述电平计数值；每当所述高低电平计数器检测到一次新的下降沿，进行一次低电平计数，并向所述计数值比较器输出一个所述电平计数值；当所述高低电平计数器检测所述停止位的上升沿，停止电平计数。根据本发明的一些实施例，所述计数值比较器包括多个寄存器，当所述计数值比较器被填满，停止使能所述高低电平计数器，向所述采样时钟生成器发送目标计数值，包括：所述计数值比较器将所述电平计数值存入所述寄存器，其中，每个所述寄存器存储有一个所述电平计数值；当所述计数值比较器的全部所述寄存器被填满，停止使能所述高低电平计数器；所述计数值比较器对所述寄存器中所存储的电平计数值进行数值比对，根据相同次数最多的所述电平计数值确定所述目标计数值，将所述目标计数值发送至所述采样时钟生成器。根据本发明的一些实施例，所述采样时钟生成器根据所述参考时钟和所述目标计数值确定采样时钟，包括：所述采样时钟生成器以所述参考时钟为基准，根据所述目标计数值的一半所指示的时长翻转一次得到翻转电平；根据全部的所述翻转电平组成所述采样时钟。根据本发明的一些实施例，所述数据控制模块根据所述采样时钟对所述上位机发送的数据进行数据采样得到采样数据，包括：所述数据控制模块根据所述采样时钟的上升沿，对所述上位机发送数据进行电平采样得到采样电平；所述数据控制模块根据所述校验数据的数据长度，将全部的所述采样电平组成所述采样数据。根据本发明的一些实施例，所述波特率自适应装置还包括复位系统，所述方法还包括：当所述复位系统获取到内部复位信号或者外部复位信号，清空所述计数值比较器，以使所述计数器比较器重新使能所述高低电平计数器，其中，所述内部复位信号又所述数据控制模块在确定所述采样数据和所述校验数据不一致后生成，所述外部复位信号由所述上位机生成；所述上位机向所述波特率自适应装置重新发送所述识别帧和所述参考时钟。第二方面，本发明实施例提供了一种基于UART通信的波特率自适应装置，包括少一个控制处理器和用于与所述至少一个控制处理器通信连接的存储器；所述存储器存储有可被所述至少一个控制处理器执行的指令，所述指令被所述至少一个控制处理器执行，以使所述至少一个控制处理器能够执行如上述第一方面所述的基于UART通信的波特率自适应方法。第三方面，本发明实施例提供了一种UART系统，包括有如上述第二方面所述的基于UART通信的波特率自适应装置。第四方面，本发明实施例提供了一种计算机可读存储介质，存储有计算机可执行指令，所述计算机可执行指令用于执行如上述第一方面所述的基于UART通信的波特率自适应方法。根据本发明实施例的基于UART通信的波特率自适应方法，至少具有如下有益效果：当所述UART系统上电，所述上位机向所述波特率自适应装置发送识别帧和参考时钟，其中，所述识别帧包括识别数据和校验数据，所述识别数据位于所述校验数据之前，所述识别数据的数据量与所述计数值比较器的存储空间相同；所述计数值比较器在未被填满的状态下使能所述高低电平计数器，所述高低电平计数器根据所述参考时钟对所述识别数据进行电平计数，向所述计数值比较器输出多个电平计数值，其中，所述电平计数值用于指示高电平或者低电平的时长；当所述计数值比较器被填满，停止使能所述高低电平计数器，向所述采样时钟生成器发送目标计数值，其中，所述目标计数值用于指示数值相同的所述电平计数值的最大数量；所述采样时钟生成器根据所述参考时钟和所述目标计数值确定采样时钟，根据所述采样时钟确定目标波特率，使能所述数据控制模块并将所述采样时钟发送至所述数据控制模块；所述数据控制模块根据所述采样时钟对所述上位机发送的数据进行数据采样得到采样数据，将所述采样数据发送至所述上位机；当所述采样数据和所述校验数据一致，所述数据控制模块使能所述采样时钟生成器将所述目标波特率和所述采样时钟发送至所述从机，所述上位机通过所述数据控制模块与所述从机交互通信数据。根据本发明实施例的技术方案，波特率自适应装置能够根据识别帧确定并校验采样时钟，进而自动确定上位机的目标波特率，并根据目标波特率同步上位机与从机之间的通信数据，无需上位机与从机进行复杂的命令交互，只需进行简单的帧识别和采样，简化了波特率的自适应过程，提高了波特率的识别效率。附图说明图1是本发明一个实施例提供的波特率自适应装置的示意图；图2是本发明一个实施例提供的基于UART通信的波特率自适应方法的流程图；图3是本发明另一个实施例提供的生成识别帧的流程图；图4是本发明另一个实施例提供的数据传输波形的示意图；图5是本发明另一个实施例提供的电平计数的流程图；图6是本发明另一个实施例提供的获取电平计数值的流程图；图7是本发明另一个实施例提供的生成采样时钟的流程图；图8是本发明另一个实施例提供的采样时钟的波形示意图；图9是本发明另一个实施例提供的数据采样的流程图；图10是本发明另一个实施例提供的系统复位的流程图；图11是本发明提供的具体示例的流程图；图12是本发明另一个实施例提供的基于UART通信的波特率自适应装置的结构图。具体实施方式下面详细描述本发明的实施例，所述实施例的示例在附图中示出，其中自始至终相同或类似的标号表示相同或类似的元件或具有相同或类似功能的元件。下面通过参考附图描述的实施例是示例性的，仅用于解释本发明，而不能理解为对本发明的限制。在本发明的描述中，需要理解的是，涉及到方位描述，例如上、下、前、后、左、右等指示的方位或位置关系为基于附图所示的方位或位置关系，仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本发明的限制。在本发明的描述中，若干的含义是一个或者多个，多个的含义是两个以上，大于、小于、超过等理解为不包括本数，以上、以下、以内等理解为包括本数。如果有描述到第一、第二只是用于区分技术特征为目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量或者隐含指明所指示的技术特征的先后关系。本发明的描述中，除非另有明确的限定，设置、安装、连接等词语应做广义理解，所属技术领域技术人员可以结合技术方案的具体内容合理确定上述词语在本发明中的具体含义。本发明实施例提供了一种基于UART通信的波特率自适应方法、装置、UART系统、介质，其中，基于UART通信的波特率自适应方法包括：当所述UART系统上电，所述上位机向所述波特率自适应装置发送识别帧和参考时钟，其中，所述识别帧包括识别数据和校验数据，所述识别数据位于所述校验数据之前，所述识别数据的数据量与所述计数值比较器的存储空间相同；所述计数值比较器在未被填满的状态下使能所述高低电平计数器，所述高低电平计数器根据所述参考时钟对所述识别数据进行电平计数，向所述计数值比较器输出多个电平计数值，其中，所述电平计数值用于指示高电平或者低电平的时长；当所述计数值比较器被填满，停止使能所述高低电平计数器，向所述采样时钟生成器发送目标计数值，其中，所述目标计数值用于指示数值相同的所述电平计数值的最大数量；所述采样时钟生成器根据所述参考时钟和所述目标计数值确定采样时钟，根据所述采样时钟确定目标波特率，使能所述数据控制模块并将所述采样时钟发送至所述数据控制模块；所述数据控制模块根据所述采样时钟对所述上位机发送的数据进行数据采样得到采样数据，将所述采样数据发送至所述上位机；当所述采样数据和所述校验数据一致，所述数据控制模块使能所述采样时钟生成器将所述目标波特率和所述采样时钟发送至所述从机，所述上位机通过所述数据控制模块与所述从机交互通信数据。根据本发明实施例的技术方案，波特率自适应装置能够根据识别帧确定并校验采样时钟，进而自动确定上位机的目标波特率，并根据目标波特率同步上位机与从机之间的通信数据，无需上位机与从机进行复杂的命令交互，只需进行简单的帧识别和采样，简化了波特率的自适应过程，提高了波特率的识别效率。首先，对本发明的UART系统的结构进行示例性说明，本示例并非对UART系统的结构做出的限定，而是可以执行本发明技术方案的一个具体实施环境，参照图1，图1为本发明提供的波特率自适应装置的结构示意图，该波特率自适应装置包括高低电平计数器、计数值比较器、采样时钟生成器、数据控制模块和复位系统。波特率自适应装置分别与上位机和从机相连接。需要说明的是，高低电平计数器连接于上位机TX接口和计数值比较器，高低电平计数器用于在参考时钟的驱动下，对高电平或低电平进行计数生成电平计数值。需要说明的是，计数值比较器还连接于采样时钟生成器，计数值比较器由多个寄存器组成，当计数值比较器的寄存器未被填满之前，使能高低电平计数器，使其从上位机获取数据并进行电平计数，当计数值比较器的寄存器被填满后，停止使能高低电平计数器，并想采样时钟生成器输出寄存器中存储的最多相同的电平计数值，即目标计数值。需要说明的是，采样时钟生成器还连接于从机和数据控制模块，采样时钟生成器用于根据目标计数值生成采样时钟，并根据采样时钟计算出目标波特率。需要说明的是，数据控制模块分别连接于上位机TX接口，上位机RX接口、从机TX接口、从机RX接口和复位系统，当识别上位机的目标波特率成功后，接通上位机TX接口，上位机RX接口、从机TX接口和从机RX接口，从而对上位机和从机发送的通信数据进行同步。值得注意的是，在知晓波特率自适应装置各个部分的功能后，本领域技术人员熟知如何设置具体电路结构，本实施例并不涉及具体的电路结构改进，能够实现上述功能和接口即可。下面基于附图1所示的UART系统，对本发明实施例的控制方法作进一步阐述。参照图2，图2为本发明实施例提供的一种基于UART通信的波特率自适应方法的流程图，该基于UART通信的波特率自适应方法包括但不限于有以下步骤：S21，当UART系统上电，上位机向波特率自适应装置发送识别帧和参考时钟，其中，识别帧包括识别数据和校验数据，识别数据位于校验数据之前，识别数据的数据量与计数值比较器的存储空间相同；S22，计数值比较器在未被填满的状态下使能高低电平计数器，高低电平计数器根据参考时钟对识别数据进行电平计数，向计数值比较器输出多个电平计数值，其中，电平计数值用于指示高电平或者低电平的时长；S23，当计数值比较器被填满，停止使能高低电平计数器，向采样时钟生成器发送目标计数值，其中，目标计数值用于指示数值相同的电平计数值的最大数量；S24，采样时钟生成器根据参考时钟和目标计数值确定采样时钟，根据采样时钟确定目标波特率，使能数据控制模块并将采样时钟发送至数据控制模块；S25，数据控制模块根据采样时钟对上位机发送的数据进行数据采样得到采样数据，将采样数据发送至上位机；S26，当采样数据和校验数据一致，数据控制模块使能采样时钟生成器将目标波特率和采样时钟发送至从机，上位机通过数据控制模块与从机交互通信数据。需要说明的是，由于UART通信需要上位机和从机的波特率统一，因此在确定上位机的目标波特率之前，本实施例的上位机向波特率自适应装置发送识别帧，由于识别帧是上位机根据目标波特率进行发送的，波特率自适应装置确定了识别帧对指示的波特率，也就确定了上位机的目标波特率。本实施例将识别帧分为识别数据和校验数据，通过识别数据进行采样时钟的识别，通过校验数据对采样时钟是否准确进行校验，若校验成功则通过采样时钟对应的目标波特率进行UART通信，否则继续进行识别，从而实现波特率的自适应。需要说明的是，识别帧的帧结构可以根据波特率自适应装置进行调整，识别数据和校验数据的具体组数也可以根据实际需求调整，识别数据的数量越多，识别的准确度越高。需要说明的是，为了提高波特率识别的自动化程度，本实施例将识别数据的数据量设置成与计数值比较器的存储量设置为相同，通过计数值比较器是否填满作为使能信号的变更依据，从而切换识别帧的接收对象。根据图1所示实施例的描述，计数值比较器由寄存器组成，因此在UART系统上电时，计数值比较器未被填满，从而对高低电平比较器发送使能信号，数据控制模块没有获取到使能信号，因此上位机TX接口发送的识别帧由高低电平计数器接收，并且接收的是位于前面的识别数据，高低电平计数器对识别数据进行电平计数，每检测到一次电平就向计数值比较器输出一个电平计数值，当计数值比较器被电平计数值填满，停止使能高低电平计数器并向采样时钟生成器输出目标计数值，采样时钟生成器根据目标计数值确定采样时钟后使能数据控制模块，使得位于识别数据后的校验数据有数据控制模块接收，从而进行采样数据和校验数据的比对，当采样数据和校验数据一致，数据控制模块接通上位机RX接口、上位机TX接口、从机TX接口和从机RX接口，实现上位机和从机的通信数据的同步。基于本实施例的技术方案，上位机只需要发送识别帧，由波特率自适应装置自动响应对波特率进行识别，并在识别正确后接通上位机和从机，不仅简化了波特率识别的过程，还提高了波特率识别的自动化程度。需要说明的是，高低电平计数器可以通过上升沿和下降沿对高电平和低电平进行检测，并且结合参考时钟确定每个电平的时长，例如，在检测到下降沿后，当检测到下一个上升沿，根据此期间参考时钟的电平数得到电平计数值。每个电平计数值会进入到计数值比较器中，虽然识别帧的高电平和低电平是等宽的，但是为了避免信号抖动，信号延迟等其他因素造成的计数差异，本实施例的计数值比较器取相同次数最多的计数值作为目标计数值，输出给采样时钟生成器，提高采样时钟的准确性。需要说明的是，目标计数值能够表征一个电平的时长，因此能够根据目标计数值和参考时钟确定采样时钟，例如，根据目标计数值的一半生成一个翻转电平，结合参考时钟确定翻转电平的时长，将得到的多个翻转电平确定为采样时钟。需要说明的是，目标波特率即为波特率数值，本领域技术人员可知的是，目标波特率表示每秒可传输的二进制位数，在具备采样时钟的基础上，可以根据采样时钟的频率计算得到目标波特率，采样时钟一个周期代表一位传输数据的时长，具体计算过程为本领域技术人员熟知的技术，在此不多做赘述。需要说明的是，当采样时钟生成器确定采样时钟和目标波特率后，先对上述数据进行保存，并向数据控制模块发送采样时钟和使能信号，使得数据控制模块运行，从上位机TX接口接收数据，由于识别数据已经被高低电平计数器接收，因此数据控制模块从校验数据的第一位进行接收。为了对采样时钟进行验证，本实施例在接受校验数据的同时，通过采样时钟对数据进行采样，若采样时钟所对应的波特率与上位机的波特率一直，采样得到的采样数据与校验数据应当是一致的，本实施例以此为依据对采样时钟的准确性进行校验，当校验通过后，数据控制模块向采样时钟生成器发送使能信号，使其将采样时钟和目标波特率发送至从机，使得从机具备与上位机一致的目标波特率，为UART通信提供波特率基础。需要说明的是，在得到采样数据后，数据控制模块对采样数据和校验数据进行比对，比对通过后向从机发送目标波特率并接通上位机和从机的通信接口，除此以外，还需要将采样数据发送至上位机，由于上位机是知晓校验数据的，因此上位机同样可以对采样数据和校验数据进行比对，比对通过后停止发送识别帧，变更为向波特率自适应装置发送通信数据，通过波特率自适应装置进行数据同步，与从机实现UART通信。综上所述，本实施例的波特率自适应装置可以分为波特率识别模式和空闲模式，波特率识别模式在UART系统上电或者复位后自动进入，在未完成波特率识别前维持在波特率识别模式，上位机发送过来的所有数据只进入波特率自适应装置，而不会进入到从设备，当采样数据和校验数据验证通过后，确定目标波特率可用，波特率自适应装置进入空闲模式，上位机才与从机在数据控制模块内连通。对于上位机，需要启动或者复位后发送识别帧，然后根据数据控制模块发送的采样数据判断波特率是否识别完成，如果识别未完成，上位机需要继续发送识别帧；如果识别完成，上位机和从机的数据经过数据控制模块的采样时钟进行同步后，进行正常的串口通信。本实施例的波特率自适应装置进入空闲模式后，关闭波特率识别功能降低该系统功耗，直到上位机发送复位信号。另外，在一实施例中，参照图3，图2所示的步骤S21还包括但不限于有以下步骤：S31，上位机生成识别帧，根据波特率自适应装置的数据接收位数将识别帧拆分成多组帧数据；S32，上位机根据帧数据生成识别数据和校验数据，其中，识别数据和校验数据均包括依次排列的起始位、帧数据和停止位，识别数据的帧数据在识别帧中位于校验数据的帧数据之前；S33，上位机向波特率自适应装置持续发送参考时钟，并依次发送识别数据和校验数据。需要说明的是，为了区分识别数据和校验数据，本实施例根据波特率自适应装置的数据接受位数拆分识别帧进行发送，例如，波特率自适应装置每次可以接受8位数据，且计数值比较器设置有16个寄存器，识别数据采用两组数据，则可以将识别帧设置为Ox55551234，分4组数据进行发送，分别为Ox55、Ox55、Ox12和Ox34，其中，Ox表征16进制，两组Ox55为Ox55为识别数据，Ox12和Ox34为校验数据。需要说明的是，在将识别帧拆分为多组帧数据后，为了区分每组数据，需要在数据前增加起始位，在数据后增加停止位，通过起始位的检测确定数据开始，通过停止位的检测确定数据结束，例如，参考图4，以识别数据Ox55为例，帧数据Ox55包括8位数据，即8个交错的高低电平，在首个高电平之前设置一个低电平作为起始位，在最后一个低电平后设置一个高电平作为停止位，起始位和停止位的具体时长可以根据实际需求调整，能够被高低电平计数器识别为起始位和停止位即可。另外，在一实施例中，参照图5，图2所示的步骤S22还包括但不限于有以下步骤：S51，高低电平计数器在检测到起始位的下降沿后启动电平计数；S52，每当高低电平计数器检测到一次新的上升沿，进行一次高电平计数，并向计数值比较器输出一个电平计数值；S53，每当高低电平计数器检测到一次新的下降沿，进行一次低电平计数，并向计数值比较器输出一个电平计数值；S54，当高低电平计数器检测停止位的上升沿，停止电平计数。需要说明的是，高低电平计数器在参考时钟的驱动下分别对高电平和低电平进行计数。如图4所示的波形图，第一组识别数据之前会有一段低电平的起始位，计数器识别到下降沿后就开始启动计数准备，直到遇到上升沿就开始对识别数据的高电平的计数，到下个下降沿开始对是哦别数据的低电平计数，完成8位数据的计数后，在停止位的上升沿触发计数停止，等遇到下一个起始位再开始计数。需要说明的是，本实施例的高低电平计数器由参考时钟驱动，并且根据数据结构可知前两组用于识别波特率的0x55数据一共可组成16个相同时长的交错高低电平。高低电平计数器每获取一个电平的计数值就传送给计数值比较器中。例如，参考图4，在检测到一次起始位的下降沿后启动计时，在检测到第一个上升沿后根据参考时钟进行计数，在检测到下一个下降沿后确定参考时钟的翻转次数为10次，因此输出电平计数值为10。检测到新的下降沿后进行低电平计数同理，在此不重复赘述。另外，在一实施例中，计数值比较器包括多个寄存器，参照图6，图2所示的步骤S22还包括但不限于有以下步骤：S61，计数值比较器将电平计数值存入寄存器，其中，每个寄存器存储有一个电平计数值；S62，当计数值比较器的全部寄存器被填满，停止使能高低电平计数器；S63，计数值比较器对寄存器中所存储的电平计数值进行数值比对，根据相同次数最多的电平计数值确定目标计数值，将目标计数值发送至采样时钟生成器。需要说明的是，计数值比较器可以设置多个寄存器，例如根据上述示例中，采用十六进制的识别帧Ox55551234，计数值比较器需要存储16位数据，因此可以设置16个寄存器，具体数量根据实际需求调整即可。需要说明的是，计数值比较器在寄存器未全部填满之前使能高低电平计数器，例如在系统上电后，由于寄存器的特性会清空，因此能欧使能高低电平计数器，当高低电平计数器获取到图4所示的Ox55识别数据后，输出8个电平计数值，在对第二组Ox55进行电平计数后，再输出8个电平计数值，此时计数值比较器的16个寄存器被填满，输出目标计数值并停止使能高低电平计数器，上位机TX接口到高低电平计数器的数据通路关闭。需要说明的是，为了避免信号抖动，信号延迟等其他因素造成的计数差异，计数值比较器开始比较16个计数值大小，取相同次数最多的计数值输出给采样时钟生成器。另外，在一实施例中，参照图7，图2所示的步骤S24还包括但不限于有以下步骤：S71，采样时钟生成器以参考时钟为基准，根据目标计数值的一半所指示的时长翻转一次得到翻转电平；S72，根据全部的翻转电平组成采样时钟。需要说明的是，根据上述实施例的描述，目标计数值为两次翻转之间的时长，一个时钟需要同时具备高电平和低电平，因此，采样时钟可以是以参考时钟为基准，用电平计数值的半数产生一个翻转电平，从而分频出一个采样时钟，采样时钟和识别数据之间的波形比对可以参考如图8所示，当采样时钟识别正确，采样时钟的上升沿和下降沿与识别帧的数据相匹配，即可以确保波特率保持一致，若采样时钟不正确，如图8下面两个波形所示，采样时钟的上升沿或下降沿无法对准校验数据，使得采样出来的采样数据与校验数据不一致，需要重新进行采样时钟的识别。另外，在一实施例中，参照图9，图2所示的步骤S25还包括但不限于有以下步骤：S91，数据控制模块根据采样时钟的上升沿，对上位机发送数据进行电平采样得到采样电平；S92，数据控制模块根据校验数据的数据长度，将全部的采样电平组成采样数据。需要说明的是，数据控制器通过采样时钟对上位机TX接口发送的数据进行采样，如图8所示，若采样时钟正确，上升沿或下降沿与校验数据的波形一致，得到的采样数据与校验数据相同。示例性地，以校验数据为0x12和0x34两组数据为例，每当采样时钟的上升沿到来就采样一次上位机TX接口的电平，将电平值存下来的作为采样数据，同时往上位机RX接口反馈回去。存下来的采样数据依次组成两组8位数据，如果两组数据不是0x12和0x34说明采样时钟不正确，波特率未能正确识别，数据控制器会发出复位信号对系统进行复位，等待下一批发送过来的识别帧，上位机也会因为收到错误的反馈数据而继续发送识别帧。如果匹配正确则整个系统进入空闲模式，数据控制器使能采样时钟生成器发出采样时钟和波特率值。同时从机RX、TX接口开启，数据控制器用采样时钟对上位机和从机的数据进行同步，完成两设备相同波特率下的数据交互。另外，在一实施例中，波特率自适应装置还包括复位系统，参照图10，本实施例的方法还包括但不限于有以下步骤：S101，当复位系统获取到内部复位信号或者外部复位信号，清空计数值比较器，以使计数器比较器重新使能高低电平计数器，其中，内部复位信号又数据控制模块在确定采样数据和校验数据不一致后生成，外部复位信号由上位机生成；S102，上位机向波特率自适应装置重新发送识别帧和参考时钟。需要说明的是，根据图2所示实施例的描述，若在系统上电阶段，计数值比较器初始状态为空，能够使能高低电平计数器进行电平计数。而在开始自适应识别后，由于采样时钟并不一定识别准确，并且进行UART通信的过程中可能需要调整设备参数，本实施例波特率自适应装置中设置复位系统，通过外部复位信号和内部复位信号重复触发目标波特率的自适应识别。需要说明的是，外部复位信号可以由上位机在任何时机发送，根据设备使用需求触发即可，本领域技术人员熟知如何通过上位机向装置发送复位信号，在此不重复赘述。值得注意的是，当目标波特率识别成功，上位机和从机进行UART通信的过程中，即上述实施例中所述的空闲状态，此时波特率自适应装置内部确定目标波特率正确，因此不会生成内部复位信号，需要通过外部复位信号对波特率自适应装置进行复位。上位机发送外部复位信号后，向波特率自适应装置发送识别帧，重复上述实施例的步骤完成波特率的自适应。需要说明的是，内部复位信号由数据控制模块确定采样数据和校验数据不一致时生成，此时上位机也会同步判断校验失败，因此会重新发送识别帧，此时复位清空计数值比较器后使能高低电平计数器，重新获取识别数据进行计数，具体流程参考上述实施例的描述即可，在此不重复赘述。另外，为了更好地说明本实施例的技术方案，以下提出一个具体示例，在本示例中，识别帧以Ox55551234为例，计数值比较器以16个寄存器为例，参照图11，本示例包括但不限于有以下步骤：S111，系统上电，上位机向波特率自适应装置发出识别帧0x55551234；S112，高低电平计数器识别到起始位下降沿，开始对识别数据内的电平进行计数，每当电平翻转一次就完成一个电平的计数，然后将电平计数值传给计数值比较器；S113，计数值比较器接收完16个电平计数值后取消对高低电平计数器的使能，高低电平计数器停止工作，上位机TX接口到高低电平计数器的数据通路关闭，计数值比较器比较16个电平计数值，以相同数最多的计数值作为目标计数值输出给采样时钟生成器；S114，采样时钟生成器接收到目标计数值，在参考时钟的驱动下用目标计数值的半数产生一个翻转电平，生成采样时钟，根据采样时钟的频率计算出目标波特率，在生成采样时钟的同时使能数据控制模块，上位机TX接口到数据控制模块的数据通路开启；S115，数据控制模块以采样时钟为基准，对上位机发过来的后两组数据0x12和0x34进行采样，完成采样后对采样数据发给上位机，当采样数据和校验数据一致，执行步骤S116，否则，当采样数据和校验数据不一致，数据控制模块发出一次内部复位信号，执行步骤S112；S116，数据控制模块发出完成信号给采样时钟生成器，使采样时钟生成器向从机输出采样时钟和目标波特率，数据控制模块连通上位机与从机的接口。如图12所示，图12是本发明一个实施例提供的基于UART通信的波特率自适应装置的结构图。本发明还提供了一种基于UART通信的波特率自适应装置，包括：处理器1201，可以采用通用的中央处理器、微处理器、应用专用集成电路、或者一个或多个集成电路等方式实现，用于执行相关程序，以实现本申请实施例所提供的技术方案；存储器1202，可以采用只读存储器、静态存储设备、动态存储设备或者随机存取存储器等形式实现。存储器1202可以存储操作系统和其他应用程序，在通过软件或者固件来实现本说明书实施例所提供的技术方案时，相关的程序代码保存在存储器1202中，并由处理器1201来调用执行本申请实施例的基于UART通信的波特率自适应方法；输入/输出接口1203，用于实现信息输入及输出；通信接口1204，用于实现本设备与其他设备的通信交互，可以通过有线方式实现通信，也可以通过无线方式实现通信；总线1205，在设备的各个组件之间传输信息；其中处理器1201、存储器1202、输入/输出接口1203和通信接口1204通过总线1205实现彼此之间在设备内部的通信连接。本申请实施例还提供了一种UART系统，包括如上所述的基于UART通信的波特率自适应装置。本申请实施例还提供了一种存储介质，存储介质为计算机可读存储介质，该存储介质存储有计算机程序，该计算机程序被处理器执行时实现上述基于UART通信的波特率自适应方法。存储器作为一种非暂态计算机可读存储介质，可用于存储非暂态软件程序以及非暂态性计算机可执行程序。此外，存储器可以包括高速随机存取存储器，还可以包括非暂态存储器，例如至少一个磁盘存储器件、闪存器件、或其他非暂态固态存储器件。在一些实施方式中，存储器可选包括相对于处理器远程设置的存储器，这些远程存储器可以通过网络连接至该处理器。上述网络的实例包括但不限于互联网、企业内部网、局域网、移动通信网及其组合。以上所描述的装置实施例仅仅是示意性的，其中作为分离部件说明的单元可以是或者也可以不是物理上分开的，实现了以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部模块来实现本实施例方案的目的。本领域普通技术人员可以理解，上文中所公开方法中的全部或某些步骤、系统可以被实施为软件、固件、硬件及其适当的组合。某些物理组件或所有物理组件可以被实施为由处理器，如中央处理器、数字信号处理器或微处理器执行的软件，或者被实施为硬件，或者被实施为集成电路，如专用集成电路。这样的软件可以分布在计算机可读介质上，计算机可读介质可以包括计算机存储介质和通信介质。如本领域普通技术人员公知的，术语计算机存储介质包括在用于存储信息的任何方法或技术中实施的易失性和非易失性、可移除和不可移除介质。计算机存储介质包括但不限于RAM、ROM、EEPROM、闪存或其他存储器技术、CD-ROM、数字多功能盘或其他光盘存储、磁盒、磁带、磁盘存储或其他磁存储装置、或者可以用于存储期望的信息并且可以被计算机访问的任何其他的介质。此外，本领域普通技术人员公知的是，通信介质通常包括计算机可读指令、数据结构、程序模块或者诸如载波或其他传输机制之类的调制数据信号中的其他数据，并且可包括任何信息递送介质。以上是对本发明的较佳实施进行了具体说明，但本发明并不局限于上述实施方式，熟悉本领域的技术人员在不违背本发明精神的共享条件下还可作出种种等同的变形或替换，这些等同的变形或替换均包括在本发明权利要求所限定的范围内。
