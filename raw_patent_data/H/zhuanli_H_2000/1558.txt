标题title
一种考虑时空相关性的风电功率区间预测及其可解释方法
摘要abst
本发明公开了一种考虑时空相关性的风电功率区间预测及其可解释方法，涉及新能源功率预测的人工智能应用领域。首先将风电功率历史数据和历史气象数据通过RSDD和链式方程插补；然后将训练集输入本发明所提出的STF‑DNN模型中，捕捉时间序列中的长期依赖关系。之后从模型预测过程和预测结果两个层面构建面向风电时空特征和深度学习融合模型的可解释性体系，并以可解释性为导向优化所提出的STF‑DNN模型。最后，为验证解释结果的可靠性，结合SHAP原理量化考虑时间差异性的特征全局贡献，从而解释了模型预测风电功率。本发明在风电功率区间预测精度、模型预测机制的可解释性及数据预处理方面，均取得了大幅度的进步。
权利要求书clms
1.一种考虑时空相关性的风电功率区间预测及其可解释方法，其特征在于：包括如下步骤：阶段一：数据获取与预处理，具体如下：S1：数据获取：选取与风功率最密切的五个基本因素作为参数：风速、风向、温度、湿度、气压，并结合不同高度、地理位置细化各气象特征的量测值，得到24维变量作为模型的原始输入序列；S2：数据预处理：风电历史数据是模型预测的基础；分别对缺失值和异常值采用链式方程插补CE和滚动标准差检测法RSDD进行补充；①CE是将时间序列中的每个缺失值替换为一组基于模型的合理预测值：首先，根据除缺失值以外的完整变量为数据集中的每个变量创建一个预测模型；然后，使用相应的预测模型拟合每个变量的缺失值；每轮插补都使用前一轮的插补值，直到达到收敛为止；最后，将多个估算数据集组合构成最终数据集，其中包含所有缺失数据的估算值；②RSDD是利用时间序列在临近区域变化幅度较小的特点，以固定长度的时间窗口进行向前滚动，对每段统计其均值并计算其标准差，如公式所示； 其中i为窗口序数，t为滑动时间窗口长度，为特征值，/＞为这一段平均特征值，/＞表征了特征离散程度；若数据超出一段序列标准差的一定倍数范围，则对应样本受噪声干扰而产生了极端异常值，剔除对应数据避免影响模型评估；阶段二：基于时空相关性的风电功率区间预测：首先，基于融合时间、空间、特征注意力机制的深度神经网络STF-DNN模型求解功率的确定性预测值；然后，通过分位数回归模型QR得到预测值的条件概率分布，并计算多分位数下的不确定性功率预测值；接着，求出各分位点下条件分位数预测值的均值和方差，通过置信区间的上下边界及确定性的预测值，进而确定不同置信水平下的预测区间，具体如下：S1：多维注意力机制：对于时间序列数据，DNN网络学习T时间段中动态信息的映射关系，三阶段注意机制分别在时间、空间、特征维度评估不同时间步长t、不同风机组和气象特征i对风电出力的贡献程度，以及分位数回归模型QR生成预测值的条件概率分布；具体为：①时间注意力模块：在模型中引入多头注意力模型以挖掘时间序列信息，不同时间步长下的抽象信息对预测结果的影响通过时间注意因子来反映；关键时间步长中的抽象信息得到增强，同时削弱了不相关时间步长所占权重，形成时间注意力机制的基本结构；时间注意力模块的输入为不同时间步长的时序信息，经过对输入序列的动态赋权，输出各步长下每个时刻的平均注意因子，进而挖掘不同时间步长对模型预测的影响，将多头注意力的并行头数设置为模型超参数，并在模型训练过程中进行调优，而且选择并行头数为8；同时，采用激活函数Sigmoid和正则化技术Dropout减少过拟合，来提高模型的性能和稳定性，剩余参数设置为：隐藏单元数为256，Dropout率为0.2，初始学习率为0.05；②空间注意力模块：引入空间注意力机制SA，构造多头注意力模型，其输入为不同机组的时序特征，输出为各风电机组的空间注意力权重，以反映不同季节影响下各机组对风电总功率的贡献度；将输入的特征平均分配给多头注意力的每个头，经过网格法搜索，对不同头数下模型预测准确率和速度进行综合评估，确定并行头数为6；并将剩余参数设置为：隐藏单元数为128，Dropout率为0.1，初始学习率为0.01；③特征注意力模块：引入自注意力机制，动态计算时间序列内部特征的权重，能够捕捉变长时间序列的长期相关性关系，包括编码器和解码器；编码器和解码器分别由个结构相同的子模块构成；采用缩放点积作为注意力评分函数，计算查询向量序列Q与键向量序列 K中所有键的相关性，得到每个键对应的价值权重系数；使用softmax函数将权重系数归一化后，对价值向量序列进行加权求和，最终得到注意力分数序列为： 式中：K、Q、V分别为键向量、查询向量和价值向量，为输入矩阵Q、K、V时注意力分数计算机制；/＞为K序列的维度；此时模型的输入为风电机组的气象特征维度；经过网格法搜索，隐藏层神经元数量设置为512，初始学习率为0.01，批量大小设置为32，并通过正则化提高模型的泛化能力；S2：深度神经网络：采用批量标准化方法BN，将对上一层神经元的输出线性组合得到的值作标准化处理，即通过平移和缩放为0均值和单位标准差，然后再对标准化后的结果进行线性变换；将深度神经网络DNN模型与特征、时间、空间注意力模块进行融合，耦合关系建立过程具体为：首先，将经过预处理后的高维数据输入特征注意力模块中，得到不同输入变量的权重，其次将特征加权输入到DNN模型进行映射后，通过时间注意层对输入序列中不同历史时刻携带的时序信息分配注意力权重，增强对当前时刻预测具有关键影响的时间信息表达，并选择最佳步长作为空间注意力机制的训练依据；在此基础上，考虑光伏机组的空间分布差异，在不同地理位置因素下经过空间注意层得出各机组对总出力的贡献度；S3：分位数回归模型：引入研究自变量和因变量条件分位数之间关系的QR模型，表示为：式中：r为样本序数；为第r个自变量；n为样本总数；/＞为第r个因变量；/＞为内的分位数；/＞为/＞的第/＞个条件分位数；/＞为回归系数的向量；对于已知时序数据，将求解不同分位数点的问题转化为最小化损失函数L，如式所示：式中：为不对称函数；最终，通过QR模型估算第个条件分位数为：式中：、/＞分别为模型对/＞、/＞的估计值；QR模型在不同置信水平下，输出多个分位点的功率预测值；在不同分位点下求出预测值的均值和方差，且各分位点的预测值服从高斯分布，则置信水平为的预测区间边界为： 式中：、/＞分别为预测区间的上下限；/＞为均值；/＞为方差；/＞为显著性水平；为显著水平对应的临界值；阶段三：面向模型预测机制的可解释性体系：首先结合模型结构，提出基于神经元电导梯度法NCG的模型预测过程解释方法，分别从神经元分布和神经元权重的角度解释模型预测依据；然后，基于注意力机制从数据映射的角度解释模型预测结果的时空特征关系；最后为验证解释结果的合理性，结合SHAP原理分别从全局特征和局部样本的角度量化面向不同工况下的特征全局贡献，并解释模型对所研究样本的预测依据，具体如下：S1：基于NCG的模型预测过程解释：采用电导分析方法，充分考虑各隐藏层上神经元的影响，特征i在神经元上的电导计算公式如所示； 式中：F为深度学习模型；x为给定输入样本；为基准样本，取样本期望值；/＞为神经元；为内的积分变量；/＞为F沿特征i在样本x处的梯度；根据公式，可解释各特征在神经元的映射贡献权重；通过对所有输入特征进行积分，可得到神经元的总电导，如式所示； 式中：M为特征总数；公式为神经元积分梯度，用于比较不同神经元的重要性差异；将其引入时序数据中，使用黎曼近似替代神经元积分梯度，为给定样本x下神经元/＞的激活函数，设/＞是从基准样本到所研究样本x的k点线性插值中的第/＞个点，则有：当时，有：因此，黎曼等效后的神经元梯度表示为式： S2：基于注意力的预测结果解释：①通过可视化动态变化的特征注意力权重，深入挖掘不同输入特征对风电功率的贡献程度；以热力图的形式量化各特征对模型预测结果的影响，进而解释模型预测依据；②对比不同时间步长下模型对各时间点的时间注意因子，解释与模型预测结果关联性最强的时间步，增强模型对决策时刻的权重；③在空间层面以各风机在不同季节对模型预测结果的权重平均值为依据，可视化不同风力发电机对总功率的贡献度，从而解释影响系统出力的关键机组；S3：基于SHAP的解释结果验证：使用SHAP理论训练广义加权线性模型拟合待解释分类器；模型对任一样本的预测结果表示为所有样本的平均预测期望与对应样本所有特征的SHAP值之和，如式所示： 式中：是模型对所有样本的预测基准值，代表模型对任一样本预测结果的期望；/＞是样本第i维特征的SHAP值，表示样本x的任意特征/＞在不同特征子集中边际贡献的均值，计算方法如所示：式中：为所有特征集合；S表示不包含特征i的特征子集。
说明书desc
技术领域本发明涉及人工智能在新能源功率预测领域的应用，具体为一种考虑时空相关性的风电功率区间预测及其可解释方法。背景技术作为新能源发电的重要组成部分，风电渗透率的不断提高使其并网后对电网影响越来越显著。因此，准确预测其出力、量化其不确定性对于优化电力系统调度以及保障电网安全稳定运行具有重要意义。从时间尺度看，风电功率预测可分为超短期预测、短期预测、中期预测和长期预测，其中短期预测能够提供风电出力的实时变化信息进而提升电力系统对光电的消纳能力，是近期的研究对象。从建模方法看，目前研究主要有基于物理原理和气象因素的机理分析法和基于特征挖掘的数据驱动法，由于避免了对复杂物理过程的分析和数学运算，后者成为近年研究热点。从预测结果类型上看，分为确定性点预测和不确定性概率区间预测。在点预测领域，文献提出了卷积神经网络、长短期记忆网络以及基于卷积神经网络和长短期记忆网络的混合模型三种功率预测方法，结果表明集成模型的效果最好，并且模型精度随输入序列的增加而提高。文献采用皮尔逊系数分析气象特征与功率的相关性，并行训练多个基础模型，通过训练误差确定组合权重，一定程度上提高了预测精度。文献提出了基于注意力机制的小波分解法和双向长短期记忆网络的风电功率预测方法，与单一模型对比，各项误差均达到最小。文献结合三次插值和双向长短期记忆用于天气预报和历史风电数据协同预测，并使用超分辨率算法将天气预报数据的时间分辨率从3小时提高到1小时。在概率区间预测方面，文献考虑了功率变化剧烈时段和平缓时段之间波动趋势的差别，结合时段特点制定了分时聚类预测方法，进一步精确了误差区间。文献将原始风电功率序列分解为多模态分量，使用样本熵计算各分量复杂度并将其重构为趋势分量、振荡分量和随机分量，分别训练神经网络并通过混合核密度估计法实现了给定置信水平下风电短期功率的概率预测。上述研究在一定程度上增强了预测准确性，但由于风电机组时空相关性复杂、波动性大、随机性强，并且受气象条件、季节性变化等因素影响较大，因此需要深入挖掘动态变化的时空关系并量化预测结果的不确定性。同时，数据驱动方法的黑箱性质使其缺少“决策空间”向“解释空间”的映射，难以对模型预测过程给出合理解释成为限制其在电力系统运行分析中应用的主要障碍之一。目前对数据驱动可解释性的研究主要有三种方法：事前解释、建立自身具备解释性的模型和事后解释。由于前两种方法可迁移能力差，且牺牲了预测结果的准确率，不适用于电网稳定运行的高精度要求，因此，现阶段研究主要集中于事后解释方法。文献从局部等效角度，使用线性模型作为神经网络在单数据邻域内的代理模型，将输入变量灵敏度和贡献度作为解释结果，取得了较高的准确率。文献从特征热度图的角度，建立输入特征与模型输出的联系，得出特征相关性及对模型预测起重要作用的因素，仿真结果表明该方法可提供较为准确的评估结果和可解释的决策规则。文献从全局代理模型的角度，结合了门控循环单元较强的非线性建模能力和决策树自身的可解释性，通过树正则化作为门控循环单元的目标函数，并通过控制正则化系数以平衡分类模型的准确率与透明度。然而，鲜有文献对数据驱动风电功率预测的可解释性进行研究，并且现有可解释方法主要从特征映射关系的角度进行数据挖掘，未能从根本上结合模型自身的特点解释其内部工作机制和各中间层传递的信息。综上，现有风电功率预测技术虽已取得不错效果，但现阶段仍存在以下问题：①风电功率预测技术多集中在点预测，区间概率预测研究较少，难以准确表征新能源功率的波动性，并且区间预测模型的精确度和敏感性亟需进一步提升；②风电功率与时间、空间、气象特征具有明显的动态相关性，但在目前的研究中，风电机组功率预测缺乏时空规律性方面的考虑，对风电功率预测具有关键作用的变量也无法得到增强；③现有数据驱动方法多为黑箱模型，模型的预测过程难以被调度人员理解，对于预测结果难以给出有合理依据的解释，并且现有的可解释方法缺少对解释结果正确性的验证，限制了人工智能方法在实际电网中的应用。因此提升现有风电功率预测的区间预测精度、挖掘风电出力的时空规律性并合理解释模型预测机制是十分必要的。发明内容本发明为了解决现有风电功率预测的区间预测精度需要进行提升，同时缺乏对风电机组时空规律性方面的考量，以及对于预测结果难以给出有合理依据的解释，并且现有的可解释方法缺少对解释结果正确性验证的问题，提供了一种考虑时空相关性的风电功率区间预测及其可解释方法。本发明是通过如下技术方案来实现的：一种考虑时空相关性的风电功率区间预测及其可解释方法，包括如下步骤：阶段一：数据获取与预处理，具体如下：S1：数据获取：数值天气预报是根据大气实际情况，在一定初值和边界条件下，通过数值计算预报未来气候条件的方法。选取与风功率最密切的五个基本因素作为参数：风速、风向、温度、湿度、气压，并结合不同高度、地理位置细化各气象特征的量测值，得到24维变量作为模型的原始输入序列。S2：数据预处理：风电历史数据是模型预测的基础，数据的精确度对功率预测结果具有重要影响。然而，在风电场实际运行中，往往由于特殊气候条件、设备测量误差、传输故障等因素，容易产生造成数据缺失和极端异常值。因此，保证数据的完整性和合理性，对于提升新能源功率预测精度，优化电网调度具有重要意义。本发明分别对缺失值和异常值采用链式方程插补CE和滚动标准差检测法RSDD进行补充。①CE是将时间序列中的每个缺失值替换为一组基于模型的合理预测值，该模型充分考虑了各变量之间的关系。首先，根据除缺失值以外的完整变量为数据集中的每个变量创建一个预测模型；然后，使用相应的预测模型拟合每个变量的缺失值；每轮插补都使用前一轮的插补值，直到达到收敛为止；最后，将多个估算数据集组合构成最终数据集，其中包含所有缺失数据的估算值。②RSDD是利用时间序列在临近区域变化幅度较小的特点，以固定长度的时间窗口进行向前滚动，对每段统计其均值并计算其标准差，如公式所示； 其中i为窗口序数，t为滑动时间窗口长度，为特征值，为这一段平均特征值，表征了特征离散程度；若数据超出一段序列标准差的一定倍数范围，则对应样本受噪声干扰而产生了极端异常值，剔除对应数据避免影响模型评估。与目前常用的全局离群值检测方法相比，其保留了新能源功率随时间序列变化的趋势，考虑了不同气象条件导致的特征值差异性，最大限度的保证了正常数据的完整性，并且窗口长度t越小，结果越精确。阶段二：基于时空相关性的风电功率区间预测：首先，基于融合时间、空间、特征注意力机制的深度神经网络STF-DNN模型求解功率的确定性预测值；STF-DNN模型由注意力模块、深度神经网络和分位数回归模型组成，其中DNN用于充分提取和挖掘数据特征与风电功率的映射关系，注意力模块通过强化时空相关性及重要气象特征的权重以提高模型预测性能，分位数回归模型用于量化风电预测的不确定性。然后，通过分位数回归模型QR得到预测值的条件概率分布，并计算多分位数下的不确定性功率预测值；接着，求出各分位点下条件分位数预测值的均值和方差，通过置信区间的上下边界及确定性的预测值，进而确定不同置信水平下的预测区间，具体如下：S1：多维注意力机制：对于时间序列数据，DNN网络学习T时间段中动态信息的映射关系，三阶段注意机制分别在时间、空间、特征维度评估不同时间步长t、不同风机组和气象特征i对风电出力的贡献程度，以及分位数回归模型QR生成预测值的条件概率分布。①时间注意力模块：风电功率预测作为时间序列预测问题，具有明显的季节性变化，且对历史信息具有高度的依赖性。随着预测步长的增加，模型预测时间越短，但时序信息丢失越严重。针对上该问题，本发明在模型中引入多头注意力模型以挖掘时间序列信息，不同时间步长下的抽象信息对预测结果的影响通过时间注意因子来反映。关键时间步长中的抽象信息得到增强，同时削弱了不相关时间步长所占权重。时间注意力机制的基本结构如附图1所示。其中注意力模块的输入为不同时间步长的时序信息，经过对输入序列的动态赋权，输出各步长下每个时刻的平均注意因子，进而挖掘不同时间步长对模型预测的影响。本发明将多头注意力的并行头数设置为模型超参数，并在模型训练过程中进行调优，一般而言，较少的并行头数可以提供更快的计算速度，而头数较多则可以增强模型的表达能力，因此，采用2、4、8、16作为备选策略，经过综合评估，最终选择并行头数为8。同时，采用激活函数Sigmoid和正则化技术Dropout减少过拟合，进一步提高模型的性能和稳定性。其余参数设置为：隐藏单元数为256，Dropout率为0.2，初始学习率为0.05。②空间注意力模块：在地理位置、容量等因素影响下，不同风电机组对系统总出力的贡献程度不同，并且各机组之间在空间上存在复杂的相关性关系，因此引入空间注意力机制，结构如附图1所示。不同的是，此时多头注意力模型的输入为不同机组的时序特征，经过注意因子计算、激活和归一化，得到各风电机组的空间注意力权重，以反映不同季节影响下各机组对风电总功率的贡献度，为调度人员提供了重点监测依据。由于要将输入的特征平均分配给多头注意力的每个头，因此多头注意力的头数必须能够被输入风电机组数量整除。因此头数只能在1、2、3、5、6、10、15、30中选择，经过网格法搜索，对不同头数下模型预测准确率和速度进行综合评估，最终确定并行头数为6。其余参数设置为：隐藏单元数为128，Dropout率为0.1，初始学习率为0.01。③特征注意力模块：由于各风电电站采集相关天气预报信息不尽相同而使序列特征值存在缺失，为此，引入自注意力机制SA，动态计算时间序列内部特征的权重，能够捕捉变长时间序列的长期相关性关系，包括编码器和解码器；如图1所示；编码器和解码器分别由个结构相同的子模块构成；采用缩放点积作为注意力评分函数，计算查询向量序列Q与键向量序列 K中所有键的相关性，得到每个键对应的价值权重系数；使用softmax函数将权重系数归一化后，对价值向量序列进行加权求和，最终得到注意力分数序列为： 式中：K、Q、V分别为键向量、查询向量和价值向量，为输入矩阵Q、K、V时注意力分数计算机制；为K序列的维度；此时模型的输入为风电机组的气象特征维度；通过自适应动态变化的特征注意力权重，量化不同特征对风电功率的贡献程度，削弱无关特征对模型预测的影响；同时，通过特征注意力权重热力图直观反映了不同特征被赋予的注意力权重，表征了各气象特征对风电功率的影响程度；经过网格法搜索，隐藏层神经元数量设置为512，初始学习率为0.01，批量大小设置为32，并通过正则化提高模型的泛化能力。S2：深度神经网络：深度神经网络具有很强的特征提取和数据拟合能力，广泛应用于自然语言处理、图像识别等领域。但随着网络隐藏层数的加深，不同的层学习的速度差异很大，即网络中靠近输出层的学习速度远高于输入层，误差的梯度呈指数增长，造成网络权值更新不稳定，进而降低了预测精度。因此，采用批量标准化方法，将对上一层神经元的输出线性组合得到的值作标准化处理，即通过平移和缩放为0均值和单位标准差，然后再对标准化后的结果进一步进行线性变换。由于实现了网络中层与层之间的解耦，允许各层进行独立学习，因而提高了整个网络的学习速度，并且降低了模型对参数变化的敏感性，增强了模型的适应能力。将深度神经网络DNN模型与特征、时间、空间注意力模块进行融合，耦合关系如图1所示，建立过程具体为：首先，将经过预处理后的高维数据输入特征注意力模块中，得到不同输入变量的权重，一方面强化了核心特征的影响权重，提升模型预测效率，另一方面削弱模型对不相关特征的关注度，避免对后续模型预测过程的干扰。将特征加权输入到DNN模型进行映射后，通过时间注意层对输入序列中不同历史时刻携带的时序信息分配注意力权重，增强对当前时刻预测具有关键影响的时间信息表达，并选择最佳步长作为空间注意力机制的训练依据。在此基础上，考虑光伏机组的空间分布差异，在不同地理位置因素下经过空间注意层得出各机组对总出力的贡献度，为调度人员重点检测提供参考依据。S3：分位数回归模型：引入研究自变量和因变量条件分位数之间关系的QR模型，表示为：式中：r为样本序数；为第r个自变量；n为样本总数；为第r个因变量；为内的分位数；为的第个条件分位数；为回归系数的向量；对于已知时序数据，将求解不同分位数点的问题转化为最小化损失函数L，如式所示：式中：为不对称函数；最终，通过QR模型估算第个条件分位数为：式中：、分别为模型对、的估计值；QR模型可以在不同置信水平下，输出多个分位点的功率预测值；在不同分位点下求出预测值的均值和方差，且各分位点的预测值服从高斯分布，则置信水平为的预测区间边界为： 式中：、分别为预测区间的上下限；为均值；为方差；为显著性水平；为显著水平对应的临界值。阶段三：面向模型预测机制的可解释性体系：由于DNN深层结构的黑箱性质使其预测结果难以解释，限制了其在电网稳定运行领域的应用。为提升模型的可解释能力，该阶段首先结合模型结构，提出基于神经元电导梯度法的模型预测过程解释方法，分别从神经元分布和神经元权重的角度解释模型预测依据；然后，基于注意力机制从数据映射的角度解释模型预测结果的时空特征关系。进一步为验证解释结果的合理性，结合SHAP原理分别从全局特征和局部样本的角度量化面向不同工况下的特征全局贡献，并解释模型对所研究样本的预测依据。S1：基于NCG的模型预测过程解释：为充分考虑各隐藏层上神经元的影响，采用电导分析方法，特征i在神经元上的电导计算公式如所示； 式中：F为深度学习模型；x为给定输入样本；为基准样本，通常取样本期望值；为神经元；为内的积分变量；为F沿特征i在样本x处的梯度；根据公式，可解释各特征在神经元的映射贡献权重；通过对所有输入特征进行积分，可得到神经元的总电导，如式所示； 式中：M为特征总数；公式为神经元积分梯度，可比较不同神经元的重要性差异；将其引入时序数据中，使用黎曼近似替代神经元积分梯度，为给定样本x下神经元的激活函数，设是从基准样本到所研究样本x的k点线性插值中的第个点，则有：当时，有：因此，黎曼等效后的神经元梯度可表示为式： S2：基于注意力的预测结果解释：①通过可视化动态变化的特征注意力权重，深入挖掘不同输入特征对风电功率的贡献程度；以热力图的形式量化各特征对模型预测结果的影响，进而解释模型预测依据，提高模型的透明度；②对比不同时间步长下模型对各时间点的时间注意因子，解释与模型预测结果关联性最强的时间步，增强模型对决策时刻的权重，进一步作为指导模型训练的依据；③在空间层面以各风机在不同季节对模型预测结果的权重平均值为依据，可视化不同风力发电机对总功率的贡献度，从而解释影响系统出力的关键机组；S3：基于SHAP的解释结果验证：为从全局角度解释输入变量对模型预测的边际贡献，以及模型对实例样本作出预测的原因，使用SHAP理论训练广义加权线性模型拟合待解释分类器；模型对任一样本的预测结果表示为所有样本的平均预测期望与对应样本所有特征的SHAP值之和，如式所示： 式中：是模型对所有样本的预测基准值，代表模型对任一样本预测结果的期望；是样本第i维特征的SHAP值，表示样本x的任意特征在不同特征子集中边际贡献的均值，计算方法如所示：式中：为所有特征集合；S表示不包含特征i的特征子集；特征的SHAP绝对值越大，表明该特征对模型预测结果的贡献程度越大，同时，SHAP值的正负性反映了特征将增加或减少模型输出。因此，SHAP值可以精确地表征当特征值改变时预测输出的对应关系，进而解释关键特征在风电功率中的影响。以上构成了面向模型预测机制的解释体系：将NCG、注意力机制和SHAP理论引入风电功率预测中，构建以模型预测机制为导向的可解释体系，如附图2所示。首先，为深入解释模型预测过程，基于NCG从层间归因、层内分布和层上输入三个维度构建以神经元为核心的模型结构解释方法，以理解各神经元及其所依据的输入变量在模型预测中的贡献；然后，依据考虑时空和特征关系的注意力机制对影响模型功率预测的关键因素进行挖掘，并以此为导向指导模型优化；最后，从全局特征和局部样本两个层面验证解释结果的合理性；一方面，SHAP值表征了特征对模型输出的边际贡献，以特征SHAP值的平均绝对值大小衡量其全局重要性，并根据特征SHAP值与其自身特征值的分布关系，挖掘特征与风电功率的正负相关性；另一方面，通过式计算各实例样本全部特征的SHAP值，进一步得出影响对应样本实际功率的主导特征。本发明所提出的一种考虑时空相关性的风电功率区间预测及其可解释方法，首先，将风电功率历史数据和历史气象数据通过RSDD和链式方程插补，去除实测数据中的离群值并拟合缺失值，经过归一化处理生成风电时间序列数据。然后，将训练集输入STF-DNN模型中，捕捉时间序列中的长期依赖关系，从而实现风电功率高精度预测，并通过QR以置信度区间表征功率预测的动态变化性，在测试集上对模型性能进行评估并采用交叉验证和网格搜索方法优化模型参数。进一步，从模型预测过程和预测结果两个层面构建面向风电时空特征和深度学习融合模型的可解释性体系，并以可解释性为导向优化所提出的STF-DNN模型。一方面，基于注意力机制挖掘风电机组的时空相关性及影响风电功率的核心因素，输出的注意因子向量以反馈形式指导模型增强对关键变量的表达并削弱无关因素的影响权重，从而提升模型预测精度和效率。另一方面，通过NCG解释模型结构的预测机理，为模型网络结构的改进提供参数指导。最后，为验证解释结果的可靠性，结合SHAP原理量化考虑时间差异性的特征全局贡献，从局部角度对实例样本进行溯因分析，解释模型预测风电功率的主要依据。与现有技术相比本发明具有以下有益效果：本发明所提供的一种考虑时空相关性的风电功率区间预测及其可解释方法，①在风电功率预测方面，充分挖掘了风电机组的时空规律特性，增强了模型对不同维度下核心信息的关注，在预测精度等指标显著上优于现有预测方法，为解决动态变化的风电功率预测建模问题提供了指导方向；②在模型预测机制方面，通过神经元电导法面向模型结构以神经元为核心，建立了神经元分布和权重解释，通过注意力机制从数据特征角度解释了风电功率的时空相关性规矩，并从全局特征和局部样本的角度对解释结论进行验证，提高了模型决策机制的透明性，与现有方法相比，增强了预测结果的可信度；③在数据预处理方面，充分考虑了量测数据缺失值和异常值的问题，避免了因噪声干扰产生的极端数据对模型预测过程的干扰，进一步提升了模型预测的准确率。附图说明图1是本发明所提出的STF-DNN模型整体结构，其中包括时间及空间维度的多头注意力模型与特征维度的自注意力模型。图2是本发明所提出的面向模型预测机制的可解释性体系。图3是本发明所提出的基于RSDD的风电序列异常值检测结果。图4是本发明所提出的基于STF-DNN的可解释风电功率预测流程。图5是不同注意力融合方式下模型的性能比较。图6至图10分别是DNN、GRU、SVM、LSTM和所提STF-DNN模型在相同数据集上的功率预测结果。图11是第四层上神经元4的属性分布。图12是第四层上神经元5的属性分布。图13是第四层上神经元9的属性分布。图14是第四层上部分神经元的输入特征权重。图15是特征注意力权重随训练过程变化情况。图16是不同天气情况下时间注意力权重。图17是3时间步长下的时间注意力权重。图18是4时间步长下的时间注意力权重。图19是5时间步长下的时间注意力权重。图20是各机组对整体出力贡献的平均权重。图21是考虑时间差异性的特征贡献度。图22是针对实例样本的预测结果溯因。具体实施方式以下结合具体实施例对本发明作进一步说明。本实施例中采用了本发明所提出的一种考虑时空相关性的风电功率区间预测及其可解释方法，如图1所示，包括如下步骤：阶段一：数据获取与预处理，具体如下：S1：数据获取：选取与风功率最密切的五个基本因素作为参数：风速、风向、温度、湿度、气压，并结合不同高度、地理位置细化各气象特征的量测值，得到24维变量作为模型的原始输入序列；如表1所示；表1S2：数据预处理：风电历史数据是模型预测的基础；分别对缺失值和异常值采用链式方程插补CE和滚动标准差检测法RSDD进行补充；异常值检测：由于实际环境中存在噪声干扰，原始数据中常包含离群值和缺失值，降低模型预测精度。因此对其进行数据清洗，选择滑动时间窗口大小为5个时间单位，采用RSDD检测异常值，结果如附图3所示，在长度为2000的部分样本序列中共检测出7处异常值。然后，通过链式方程插补空缺值并标准化，按7∶3划分训练集和测试集；①CE是将时间序列中的每个缺失值替换为一组基于模型的合理预测值：首先，根据除缺失值以外的完整变量为数据集中的每个变量创建一个预测模型；然后，使用相应的预测模型拟合每个变量的缺失值；每轮插补都使用前一轮的插补值，直到达到收敛为止；最后，将多个估算数据集组合构成最终数据集，其中包含所有缺失数据的估算值；②RSDD是利用时间序列在临近区域变化幅度较小的特点，以固定长度的时间窗口进行向前滚动，对每段统计其均值并计算其标准差，如公式所示； 其中i为窗口序数，t为滑动时间窗口长度，为特征值，为这一段平均特征值，表征了特征离散程度；若数据超出一段序列标准差的一定倍数范围，则对应样本受噪声干扰而产生了极端异常值，剔除对应数据避免影响模型评估；S3：评估指标：选取预测区间覆盖率、区间平均宽度和平均中心偏差作为模型预测精度的评价标准，如公式—所示。 式中：为统计值，当样本r的实际功率值落在预测区间时，为1，否则为0。表征了在一定的置信水平下观测值处于预测区间范围内的概率，其值越大，表明预测结果可靠性越强。 式中：为实际功率值的极差；、分别为样本r预测区间的上下界。表征了模型拟合的精确度，在相同置信水平的情况下，其值越小，表明预测精准性越高。式中：为样本r的实际功率值。衡量了实际观测值与预测区间中心的偏差，越小，表明模型的拟合能力越好。阶段二：基于时空相关性的风电功率区间预测：首先，基于融合时间、空间、特征注意力机制的深度神经网络STF-DNN模型求解功率的确定性预测值；STF-DNN模型由注意力模块、深度神经网络和分位数回归模型组成，其中DNN用于充分提取和挖掘数据特征与风电功率的映射关系，注意力模块通过强化时空相关性及重要气象特征的权重以提高模型预测性能，分位数回归模型用于量化风电预测的不确定性。然后，通过分位数回归模型QR得到预测值的条件概率分布，并计算多分位数下的不确定性功率预测值；接着，求出各分位点下条件分位数预测值的均值和方差，通过置信区间的上下边界及确定性的预测值，进而确定不同置信水平下的预测区间，具体如下：S1：多维注意力机制：对于时间序列数据，DNN网络学习T时间段中动态信息的映射关系，三阶段注意机制分别在时间、空间、特征维度评估不同时间步长t、不同风机组和气象特征i对风电出力的贡献程度，以及分位数回归模型QR生成预测值的条件概率分布；①时间注意力模块：在模型中引入多头注意力模型以挖掘时间序列信息，不同时间步长下的抽象信息对预测结果的影响通过时间注意因子来反映；关键时间步长中的抽象信息得到增强，同时削弱了不相关时间步长所占权重，形成时间注意力机制的基本结构；时间注意力模块的输入为不同时间步长的时序信息，经过对输入序列的动态赋权，输出各步长下每个时刻的平均注意因子，进而挖掘不同时间步长对模型预测的影响，将多头注意力的并行头数设置为模型超参数，并在模型训练过程中进行调优，最终选择并行头数为8；同时，采用激活函数Sigmoid和正则化技术Dropout减少过拟合，来提高模型的性能和稳定性，剩余参数设置为：隐藏单元数为256，Dropout率为0.2，初始学习率为0.05；②空间注意力模块：引入空间注意力机制SA，构造多头注意力模型，其输入为不同机组的时序特征，输出为各风电机组的空间注意力权重，以反映不同季节影响下各机组对风电总功率的贡献度；将输入的特征平均分配给多头注意力的每个头，经过网格法搜索，对不同头数下模型预测准确率和速度进行综合评估，确定并行头数为6；并将剩余参数设置为：隐藏单元数为128，Dropout率为0.1，初始学习率为0.01；③特征注意力模块：引入自注意力机制，动态计算时间序列内部特征的权重，能够捕捉变长时间序列的长期相关性关系，包括编码器和解码器；编码器和解码器分别由个结构相同的子模块构成；采用缩放点积作为注意力评分函数，计算查询向量序列Q与键向量序列 K中所有键的相关性，得到每个键对应的价值权重系数；使用softmax函数将权重系数归一化后，对价值向量序列进行加权求和，最终得到注意力分数序列为： 式中：K、Q、V分别为键向量、查询向量和价值向量，为输入矩阵Q、K、V时注意力分数计算机制；为K序列的维度；此时模型的输入为风电机组的气象特征维度；经过网格法搜索，隐藏层神经元数量设置为512，初始学习率为0.01，批量大小设置为32，并通过正则化提高模型的泛化能力；S2：深度神经网络：采用批量标准化方法BN，将对上一层神经元的输出线性组合得到的值作标准化处理，即通过平移和缩放为0均值和单位标准差，然后再对标准化后的结果进一步进行线性变换；将深度神经网络DNN模型与特征、时间、空间注意力模块进行融合，耦合关系建立过程具体为：首先，将经过预处理后的高维数据输入特征注意力模块中，得到不同输入变量的权重，其次将特征加权输入到DNN模型进行映射后，通过时间注意层对输入序列中不同历史时刻携带的时序信息分配注意力权重，增强对当前时刻预测具有关键影响的时间信息表达，并选择最佳步长作为空间注意力机制的训练依据；在此基础上，考虑光伏机组的空间分布差异，在不同地理位置因素下经过空间注意层得出各机组对总出力的贡献度；S3：分位数回归模型：引入研究自变量和因变量条件分位数之间关系的QR模型，表示为：式中：r为样本序数；为第r个自变量；n为样本总数；为第r个因变量；为内的分位数；为的第个条件分位数；为回归系数的向量；对于已知时序数据，将求解不同分位数点的问题转化为最小化损失函数L，如式所示：式中：为不对称函数；最终，通过QR模型估算第个条件分位数为：式中：、分别为模型对、的估计值；QR模型在不同置信水平下，输出多个分位点的功率预测值；在不同分位点下求出预测值的均值和方差，且各分位点的预测值服从高斯分布，则置信水平为的预测区间边界为： 式中：、分别为预测区间的上下限；为均值；为方差；为显著性水平；为显著水平对应的临界值。本实施例的阶段二中，首先，将训练集输入STF-DNN模型中，捕捉时间序列中的长期依赖关系，从而实现风电功率高精度预测，并通过QR以置信度区间表征功率预测的动态变化性，在测试集上对模型性能进行评估并采用交叉验证和网格搜索方法优化模型参数。进一步，从模型预测过程和预测结果两个层面构建面向风电时空特征和深度学习融合模型的可解释性体系，并以可解释性为导向优化所提出的STF-DNN模型。一方面，基于注意力机制挖掘风电机组的时空相关性及影响风电功率的核心因素，输出的注意因子向量以反馈形式指导模型增强对关键变量的表达并削弱无关因素的影响权重，从而提升模型预测精度和效率。另一方面，通过NCG解释模型结构的预测机理，为模型网络结构的改进提供参数指导。最后，为验证解释结果的可靠性，结合SHAP原理量化考虑时间差异性的特征全局贡献，从局部角度对实例样本进行溯因分析，解释模型预测风电功率的主要依据。在所提出的STF-DNN模型中，将经过预处理后的高维数据输入特征注意力模块中，一方面强化了核心特征的影响权重，提升模型预测效率，另一方面削弱模型对不相关特征的关注度，避免对后续模型预测过程的干扰。在DNN特征映射后，通过时间注意层对输入序列中不同历史时刻携带的时序信息分配注意力权重，增强对当前时刻预测具有关键影响的时间信息表达，并选择最佳步长作为空间注意力机制的训练依据。在此基础上，考虑风电机组的空间分布差异，在不同地理位置因素下经过空间注意层得出各机组对总出力的贡献度，为调度人员重点检测提供参考依据。为验证构建模型顺序的合理性，将注意力机制的不同融合形式从模型预测准确率和训练时间的角度进行综合考量，结果如附图5所示，可见本发明所提顺序框架在保持高准确率的前提下，大幅提升了模型的训练效率。为进一步验证本发明所提方法的优越性，基于相同预处理后的数据集将本发明所提方法与深度置信网络、多层感知机、生成对抗网络、深度神经网络方法进行对比。所有算法的batch_size为256，模型最大迭代次数epoch为500，初始学习率0.05，各参数均采用网格法寻优。DBN、MLP、DNN的隐藏层数量为4，dropout为0.5；多头注意力模块的并行头数为4。选择分辨率为10min，全天共144个采样点，时间跨度为2022年5月1日—8月31日，共17712条运行数据，并按照7:3划分训练集和测试集。在测试集上对各模型预测的风电功率和实测数据进行绘制，预测效果如附图6至图10所示。由图6至图10可知，DBN模型的预测置信区间较宽，增大了功率波动场景下的不确定性；MLP作为浅层神经网络，在各时段的拟合效果均未达到理想状态，预测误差较大，不能很好的适应电网调度的高精度要求；GAN模型在波峰时段的预测值显著低于实际值，而DNN的预测值则偏高，二者难以准确表征极端场景下的功率变化。而所提STF-DNN模型在全时段均实现对风电功率的最优拟合，相比于DNN，由于引入多维注意力机制，增强了模型对核心输入变量的关注度，削弱了其在功率急剧变化时受不相关变量干扰的影响。同时，其在功率平稳时段预测区间较宽，在功率显著波动时预测区间较窄，有利于调度人员进行风险决策，大幅减少了风电功率区间预测的不确定性，具有较好的抗干扰能力。为进一步精细化表征模型性能，将DNN、GAN、双注意力长短期记忆网络、时空图卷积神经网络和本发明所提模型在相同测试集上依据评估指标在90%置信度下进行对比，各模型参数选择方法同上，预测效果如附表2所示。通过对比分析可以得出：相较于GAN，DNN的区间覆盖率、区间平均宽度和平均中心偏差均具有改善，表明深度神经网络具有更好的拟合效果；DALSTM通过引入注意力机制，能够有效捕捉时空信息；而本实施例所提STF-DNN模型实现了多维指标下的最优预测，表明时间-空间-特征的三维注意力能更进一步挖掘复杂的输入变量关系，对预测结果的精度具有明显提升，特别是平均中心偏差指标的显著减小，表明数据拟合的可靠性更高。表2阶段三：面向模型预测机制的可解释性体系：首先结合模型结构，提出基于神经元电导梯度法NCG的模型预测过程解释方法，分别从神经元分布和神经元权重的角度解释模型预测依据；然后，基于注意力机制从数据映射的角度解释模型预测结果的时空特征关系。进一步为验证解释结果的合理性，结合SHAP原理分别从全局特征和局部样本的角度量化面向不同工况下的特征全局贡献，并解释模型对所研究样本的预测依据。具体如下：S1：基于NCG的模型预测过程解释：为充分考虑各隐藏层上神经元的影响，采用电导分析方法，特征i在神经元上的电导计算公式如所示； 式中：F为深度学习模型；x为给定输入样本；为基准样本，取样本期望值；为神经元；为内的积分变量；为F沿特征i在样本x处的梯度；根据公式，可解释各特征在神经元的映射贡献权重；通过对所有输入特征进行积分，可得到神经元的总电导，如式所示； 式中：M为特征总数；公式为神经元积分梯度，可比较不同神经元的重要性差异；将其引入时序数据中，使用黎曼近似替代神经元积分梯度，为给定样本x下神经元的激活函数，设是从基准样本到所研究样本x的k点线性插值中的第个点，则有：当时，有：因此，黎曼等效后的神经元梯度可表示为式： 。①神经元分布解释：为进一步理解各层内不同神经元如何协同运行以实现最终预测，使用层电导可视化第四隐藏层内部分神经元的贡献值分布，如附图11-13所示。由图可知，神经元4具有均匀分布的高贡献值，表明其挖掘到与出力预测具有强正相关的特征；神经元5的贡献值分布在0值附近，且支撑的实例样本较少，没有学习到实质性特征；神经元9以-0.028为中心近似对称分布，主要负责捕捉降低风电功率的信息。因此，不同神经元在模型预测过程中发挥的作用有较大差异，这是由其对输入特征的敏感性和映射关系决定的，且并非所有神经元都用于预测。②神经元权重解释：为解释重要神经元从输入时间序列中挖掘的具体特征信息，将神经元总电导值除以各边际输入特征，得到特征相对于该神经元的贡献权重，有助于理解输入的哪些部分用于激活特定神经元。由附图14可知，不同神经元对特征的敏感程度存在较大差异。从特征角度看，GHI在多个神经元上均出现权重峰值，而地面气压则不作为激活各神经元的主要因素；从神经元差异性看，神经元4对DHI分配的权重远高于其余神经元，神经元2的主要输入特征是GHI、DHI和云层不透明度。S2：基于注意力的预测结果解释：①特征权重解释：风电场站量测的气象特征众多，部分特征对系统总出力预测的影响较小，引入特征注意力模块可以强化模型对影响较大的重要特征的关注，起到对海量特征的筛选过滤作用，进而提高模型预测精度，避免无关特征对模型预测的干扰。以 20号风电机组为例，附图15为模型迭代训练第1至40次时20号机组各项特征对整体出力预测的注意力权重图。其中颜色的深浅反映了特征所占权重，颜色越深，表示该特征对模型预测结果的贡献度越大。由图可知，初始迭代时，模型对各特征的关注度较为混乱，无法捕捉到重要特征，此时预测误差也较大；当迭代次数达到40次时，模型对以50米高度风速、地面气压和总降水为核心的特征关注度不断加深，其中50米高度风速的注意权重达到0.98，是影响系统整体出力最直接的因素，而地表风向、50米高度风向、气温等因素的权重被削弱。随着模型训练迭代次数的增加，特征注意力权重变化可以很好的揭示与风电出力预测最相关的因素，与先验知识相符，进一步验证了模型的可靠性。②时间权重解释：在晴天、多云、大风和雨雪四种天气类型下对各时间维度的注意力权重可视化如附图16所示。通过分析可知，在各气象工况下模型对全年各月份的关注度基本满足从两边向中间递减的规律，并且各类型天气对月份的侧重点有较大差异，晴天和多云在各时段具有较均衡的预测贡献，大风在春秋两季具有较高权重，而雨雪天气仅在12月至次年4月对预测结果有影响。其中1、2月在多种工况下均具有较高权重，是模型在预测过程中的主要依据。不同时间步长的季节特征对预测结果有不同影响，为了分析每个时间步长的特征如何影响模型预测过程，将模型对各时间步长预测的时间注意力权重可视化以表征模型对时间的关注度，结果如附图17-19所示。由图可知，在各时步预测过程中，最终决策时刻及其附近时间点对模型预测具有最为突出的贡献，这是由于模型在下一时刻的出力预测主要取决于上一时刻出力。但当时间步长增大时，时间序列所蕴含的信息被淡化，降低对最后时刻的关注度。因此，为兼顾预测效率和精度，本实施例选择4个单位时长作为滑动时间窗口大小。③空间权重解释：按地理分布位置的相近性对多台风电发电机进行聚类排序，对模型在不同季节场景下进行仿真，通过空间注意力机制量化各机组对整体出力结果预测的贡献程度，结果如附图20所示。由图20可见，各风电机组对全局功率预测的贡献受空间相互作用关系较大，大致形成以3、12、20、26号风电为核心的机群，处于中心位置的风电机组重要性普遍高于边缘机组，表明模型在整体上更关注中心区域风电机组，所提出的空间注意力机制能够在不同季节下实现对机组空间关系的动态挖掘。S3：基于SHAP的解释结果验证：使用SHAP理论训练广义加权线性模型拟合待解释分类器；模型对任一样本的预测结果表示为所有样本的平均预测期望与对应样本所有特征的SHAP值之和，如式所示： 式中：是模型对所有样本的预测基准值，代表模型对任一样本预测结果的期望；是样本第i维特征的SHAP值，表示样本x的任意特征在不同特征子集中边际贡献的均值，计算方法如所示：式中：为所有特征集合；S表示不包含特征i的特征子集。①特征全局贡献度验证：根据特征SHAP绝对值归一化后降序排列得到考虑时间差异性的特征全局贡献度如附图21所示。图中，SHAP值所代表的矩形越长，表示该特征对模型预测结果的影响力越大。从特征物理意义角度看，风速、气压和降水量对风电功率预测的贡献度远超过其他特征，是模型预测的首要参考依据。此外，空气湿度、云量也对模型具有一定影响，而风向、长波辐射等因素的SHAP值接近于0，表明当其特征值在正常范围内发生改变时，几乎不会引起模型最终预测结果的变化，与可解释结论一致。从时间角度看，各特征贡献度具有明显的季节差异性，春季在各特征中具有较为均匀的SHAP权重，而太阳直射辐射指数的SHAP值主要由夏季决定，气温、降雪深度、云层不透明度等特征则在秋冬两季有较突出贡献。因此，在实际风电预测中，可依据相应时间选择对应的特征作为预测依据。②样本预测依据验证：为解释模型对实例样本的功率预测结果，基于SHAP对给定样本进行溯因分析，结果如附图22所示。图中正数表示对风电功率预测提升具有正向增益作用的特征，负数表示削弱功率的特征，长度表征了该特征对样本预测结果的影响力。由图可知，个体样本的预测依据与模型全局特征贡献度在顺序上存在一定差异，这是由样本各特征值的波动情况决定的，但50米高度风速、地表气压和总降水等具有全局高权重的特征对不同样本个体的预测结果均有重要影响。以该样本为例，风速是影响其功率输出最相关的因素，虽然在短波辐射和云量等指标值上具有削弱风电功率的趋势，即可能伴有多云天气，但风速、降水、气压等因素均位于正常范围内且对模型预测的贡献程度更高，因此从整体看其风电出力结果相较于样本平均水平仍有较大提升，证明了解释结果的合理性。本发明要求保护的范围不限于以上具体实施方式，而且对于本领域技术人员而言，本发明可以有多种变形和更改，凡在本发明的构思与原则之内所作的任何修改、改进和等同替换都应包含在本发明的保护范围之内。
