标题title
一种储能电站数据同步方法、系统及设备
摘要abst
本公开涉及一种储能电站数据同步方法、系统及设备，方法包括以下步骤：计算簇相对于堆的时钟偏差记为簇‑堆时钟偏差并校准簇的时钟；计算模组相对于簇的时钟偏差记为模组‑簇时钟偏差并校准模组的时钟；令簇在整数秒时向簇内的模组广播模组数据采集命令，响应于模组数据采集命令，模组在一个上报周期内向上级的簇上报模组数据；簇接收下级所有模组上报的模组数据并存储；堆向堆内的簇发起簇数据采集命令，采集簇内存储的数据。系统和设备用于执行上述方法。本公开可令堆内各级设备采集到的所有数据均处于同一时刻，实现对各级设备数据的同步采集，可提高后续的数据分析结果的准确性，更便于储能系统的状态检测、故障寻因等过程。
权利要求书clms
1.一种储能电站数据同步方法，应用于储能电站中，所述储能电站包括沿数据收集方向按序级联的模组、簇和堆，其特征在于，所述储能电站数据同步方法包括以下步骤：S01、计算簇相对于堆的时钟偏差记为簇-堆时钟偏差，基于所述簇-堆时钟偏差校准簇的时钟；S02、计算模组相对于簇的时钟偏差记为模组-簇时钟偏差，基于所述模组-簇时钟偏差校准模组的时钟；S03、令簇在整数秒时向簇内的模组广播模组数据采集命令，响应于所述模组数据采集命令，模组在一个上报周期内向上级的簇上报模组数据；S04、簇接收下级所有模组上报的模组数据并存储；S05、堆向堆内的簇发起簇数据采集命令，采集簇内存储的数据。2.根据权利要求1所述储能电站数据同步方法，其特征在于，步骤S01具体为：令簇向上级的堆发送时间同步请求报文，所述时间同步请求报文中携带有其离开簇时的时间戳，记为第一时间戳T1；堆在接收簇发送的时间同步请求报文时，在所述时间同步请求报文中加入堆接收到所述时间同步请求报文时的时间戳，记为第二时间戳T2；堆将所述时间同步请求报文回发至簇中，并在所述时间同步请求报文中加入回发时的时间戳，记为第三时间戳T3；簇在接收堆回发的时间同步请求报文时，在所述时间同步请求报文中加入簇接收到所述时间同步请求报文时的时间戳，记为第四时间戳T4；定义所述簇-堆时钟偏差为Toffset1，则有：Toffset1＝+)/2。3.根据权利要求1所述储能电站数据同步方法，其特征在于，步骤S02具体为：令簇向簇内的模组广播同步帧，所述同步帧中携带有其离开簇时的时间戳，记为第五时间戳T5；令簇在同步帧广播完成后，立即向簇内的模组广播跟随帧，所述跟随帧中携带有其离开簇时的时间戳，记为第六时间戳T6；模组在接收到所述同步帧时，记录当前时间戳记为第七时间戳T7；模组在接收到所述跟随帧时，获取所述跟随帧携带的第六时间戳T6；定义所述模组-簇时钟偏差为Toffset2，则有：Toffset2＝T6-T7。4.根据权利要求1所述储能电站数据同步方法，其特征在于，步骤S03中，响应于所述模组数据采集命令，模组在一个上报周期内，自第一帧开始逐帧向上级的簇上报模组数据，直至最后一帧结束上报，等待下一次模组数据采集命令。5.根据权利要求1所述储能电站数据同步方法，其特征在于，步骤S04中，簇实时接收下级模组上报的模组数据并解析至簇的缓存中，直至簇内所有模组的数据接收完毕，将簇内所有模组的数据同步到待上报的缓存中，等待堆的簇数据采集命令。6.根据权利要求1所述储能电站数据同步方法，其特征在于，步骤S05中，堆采用多线程并发同时采集下级各簇的数据。7.根据权利要求6所述储能电站数据同步方法，其特征在于，步骤S05中，堆向堆内的簇发起簇数据采集命令时，检测各个簇是否收集簇内所有模组的模组数据，若是则采集簇内存储的数据，否则跳过该簇。8.一种储能电站数据同步系统，应用于储能电站中，所述储能电站包括沿数据收集方向按序级联的模组、簇和堆，其特征在于，所述储能电站数据同步系统包括：处理控制模块，其用于计算簇相对于堆的时钟偏差记为簇-堆时钟偏差，基于所述簇-堆时钟偏差校准簇的时钟；计算模组相对于簇的时钟偏差记为模组-簇时钟偏差，基于所述模组-簇时钟偏差校准模组的时钟；令簇在整数秒时向簇内的模组广播模组数据采集命令，响应于所述模组数据采集命令，模组在一个上报周期内向上级的簇上报模组数据；簇接收下级所有模组上报的模组数据并存储；堆向堆内的簇发起簇数据采集命令，采集簇内存储的数据。9.一种计算机设备，包括信号连接的处理器和存储器，其特征在于，所述存储器中存储有至少一条指令或至少一段程序，所述至少一条指令或所述至少一段程序由所述处理器加载时执行如权利要求1-7任一项所述储能电站数据同步方法。10.一种计算机可读存储介质，其上存储有至少一条指令或至少一段程序，其特征在于，所述至少一条指令或所述至少一段程序被处理器加载时执行如权利要求1-7任一项所述储能电站数据同步方法。
说明书desc
技术领域本公开涉及储能电站数据处理的技术领域，具体涉及一种储能电站数据同步方法、系统及设备。背景技术现有的储能电站、储能系统的拓扑结构一般遵循三层通信架构，沿数据收集方向依次定义为按序级联的模组、簇和堆，单个模组又包含有多节串并联的电池。模组负责采集下级每节电池的电压、温度等数据，然后通过CAN总线上报到簇中。簇负责收集簇内所有模组的数据，同时整理由自身计算或采集的数据，如母线电压、电流、容量等，整理后将数据统一上报至上级的堆。堆负责收集下级所有簇的数据然后进行集中处理，同时结合自身采集或计算获得的数据，完成堆的业务逻辑处理和功能实现。由于储能系统中堆、簇、模组以及下级的电池的数量庞大，在对储能电站进行监测时，同一时刻下各节电池的电压、电流、温度等数据的同步就显得相当重要，理想状态下系统采集到各个设备下的电压、电流和温度等数值应为所有设备在同一时刻的数值，如果采集的数据不同步，数据分析结果就很难准确，故障发生时无法准确定位原因，如第一簇的峰值电流出现在第一秒，第二簇的峰值电流出现在第二秒，如果各簇的数据收集时没有进行严格的时间同步，分析数据时就无法判断两簇的峰值电流是同时出现还是先后出现的，在进行原因分析时也就无法判断是负载过大造成同时过流，还是第一簇触发保护状态将功率分配到第二簇再出现过流的。现有技术中，通常通过实时时钟对各级设备的时钟进行校对，使各设备保持时钟同步，但由于各级设备采集数据时没有按照统一步调进行采集，实时时钟的校时无法精确到毫秒级，数据采集也存在先后，最终导致无法保证数据完成的同步，影响后续数据分析结果的准确性，给储能系统的状态监测、故障寻因等造成困扰。发明内容为了解决上述现有技术存在的问题，本公开目的在于提供一种储能电站数据同步方法、系统及设备。本公开可令堆内各级设备采集到的所有数据均处于同一时刻，实现对各级设备数据的同步采集，可提高后续的数据分析结果的准确性，更便于储能系统的状态检测、故障寻因等过程。本公开所述的一种储能电站数据同步方法，应用于储能电站中，所述储能电站包括沿数据收集方向按序级联的模组、簇和堆，所述储能电站数据同步方法包括以下步骤：S01、计算簇相对于堆的时钟偏差记为簇-堆时钟偏差，基于所述簇-堆时钟偏差校准簇的时钟；S02、计算模组相对于簇的时钟偏差记为模组-簇时钟偏差，基于所述模组-簇时钟偏差校准模组的时钟；S03、令簇在整数秒时向簇内的模组广播模组数据采集命令，响应于所述模组数据采集命令，模组在一个上报周期内向上级的簇上报模组数据；S04、簇接收下级所有模组上报的模组数据并存储；S05、堆向堆内的簇发起簇数据采集命令，采集簇内存储的数据。优选地，步骤S01具体为：令簇向上级的堆发送时间同步请求报文，所述时间同步请求报文中携带有其离开簇时的时间戳，记为第一时间戳T1；堆在接收簇发送的时间同步请求报文时，在所述时间同步请求报文中加入堆接收到所述时间同步请求报文时的时间戳，记为第二时间戳T2；堆将所述时间同步请求报文回发至簇中，并在所述时间同步请求报文中加入回发时的时间戳，记为第三时间戳T3；簇在接收堆回发的时间同步请求报文时，在所述时间同步请求报文中加入簇接收到所述时间同步请求报文时的时间戳，记为第四时间戳T4；定义所述簇-堆时钟偏差为Toffset1，则有：Toffset1＝+)/2。优选地，步骤S02具体为：令簇向簇内的模组广播同步帧，所述同步帧中携带有其离开簇时的时间戳，记为第五时间戳T5；令簇在同步帧广播完成后，立即向簇内的模组广播跟随帧，所述跟随帧中携带有其离开簇时的时间戳，记为第六时间戳T6；模组在接收到所述同步帧时，记录当前时间戳记为第七时间戳T7；模组在接收到所述跟随帧时，获取所述跟随帧携带的第六时间戳T6；定义所述模组-簇时钟偏差为Toffset2，则有：Toffset2＝T6-T7。优选地，步骤S03中，响应于所述模组数据采集命令，模组在一个上报周期内，自第一帧开始逐帧向上级的簇上报模组数据，直至最后一帧结束上报，等待下一次模组数据采集命令。优选地，步骤S04中，簇实时接收下级模组上报的模组数据并解析至簇的缓存中，直至簇内所有模组的数据接收完毕，将簇内所有模组的数据同步到待上报的缓存中，等待堆的簇数据采集命令。优选地，步骤S05中，堆采用多线程并发同时采集下级各簇的数据。优选地，步骤S05中，堆向堆内的簇发起簇数据采集命令时，检测各个簇是否收集簇内所有模组的模组数据，若是则采集簇内存储的数据，否则跳过该簇。本公开的一种储能电站数据同步系统，应用于储能电站中，所述储能电站包括沿数据收集方向按序级联的模组、簇和堆，所述储能电站数据同步系统包括：处理控制模块，其用于计算簇相对于堆的时钟偏差记为簇-堆时钟偏差，基于所述簇-堆时钟偏差校准簇的时钟；计算模组相对于簇的时钟偏差记为模组-簇时钟偏差，基于所述模组-簇时钟偏差校准模组的时钟；令簇在整数秒时向簇内的模组广播模组数据采集命令，响应于所述模组数据采集命令，模组在一个上报周期内向上级的簇上报模组数据；簇接收下级所有模组上报的模组数据并存储；堆向堆内的簇发起簇数据采集命令，采集簇内存储的数据。本公开的一种计算机设备，包括信号连接的处理器和存储器，所述存储器中存储有至少一条指令或至少一段程序，所述至少一条指令或所述至少一段程序由所述处理器加载时执行如上所述储能电站数据同步方法。本公开的一种计算机可读存储介质，其上存储有至少一条指令或至少一段程序，所述至少一条指令或所述至少一段程序被处理器加载时执行如上所述储能电站数据同步方法。本公开所述的一种储能电站数据同步方法、系统及设备，其优点在于，本公开通过报文、同步帧和跟随帧，计算获得簇-堆时钟偏差和模组-簇时钟偏差，基于簇-堆时钟偏差和模组-簇时钟偏差对簇和模组的时钟进行校准，使模组、簇、堆三者的时钟保持同步，并通过整数秒启动采集数据的方法，便于各级设备之间采集数据的对齐，使各级设备采集的数据均处于同一时刻，实现对各级设备数据的同步采集，可提高后续的数据分析结果的准确性，更便于储能系统的状态检测、故障寻因等过程。附图说明图1是本实施例所述一种储能电站数据同步方法的步骤流程图；图2是本实施例数据采集时序的示意图；图3是本实施例同一时刻采集的簇数据示例图之一；图4是本实施例同一时刻采集的簇数据示例图之二；图5是本实施例所述计算机设备的结构示意图。附图标记说明：101-处理器，102-存储器。具体实施方式如图1-图4所示，本公开所述的一种储能电站数据同步方法，应用于储能电站中，储能电站包括有沿数据收集方向按序级联的模组、簇和堆，一个储能电站系统中通常包含有多个堆，每个堆包含有多个模组，每个模组内又包含有多节串并联的电池，堆和簇之间通过TCP/IP网络连接，簇与模组之间通过CAN总线连接，以形成三层网络拓扑结构。本实施例的储能电站数据同步方法包括以下步骤：S01、计算簇相对于堆的时钟偏差记为簇-堆时钟偏差，基于所述簇-堆时钟偏差校准簇的时钟；具体如下：令簇向上级的堆发送时间同步请求报文，该时间同步请求报文中携带有其离开簇时的时间戳，记为第一时间戳T1；堆在接收簇发送的时间同步请求报文时，在所述时间同步请求报文中加入堆接收到所述时间同步请求报文时的时间戳，记为第二时间戳T2；堆将所述时间同步请求报文回发至簇中，并在所述时间同步请求报文中加入回发时的时间戳，记为第三时间戳T3；簇在接收堆回发的时间同步请求报文时，在所述时间同步请求报文中加入簇接收到所述时间同步请求报文时的时间戳，记为第四时间戳T4；定义簇-堆时钟偏差为Toffset1，报文传输延时为Tdelay1,可得如下关系式：T2＝+Tdelay1；T4＝+Tdelay1；由以上关系式可得簇-堆时钟偏差Toffset1表示为：Toffset1＝+)/2基于簇-堆时钟偏差校准簇的时钟具体为：将簇的原始时钟加上所得簇-堆时钟偏差Toffset1，获得校准后的簇的时钟。S02、计算模组相对于簇的时钟偏差记为模组-簇时钟偏差，基于所述模组-簇时钟偏差校准模组的时钟；具体为：令簇向簇内的模组广播同步帧，所述同步帧中携带有其离开簇时的时间戳，记为第五时间戳T5；令簇在同步帧广播完成后，立即向簇内的模组广播跟随帧，所述跟随帧中携带有其离开簇时的时间戳，记为第六时间戳T6；模组在接收到所述同步帧时，记录当前时间戳记为第七时间戳T7；模组在接收到所述跟随帧时，获取所述跟随帧携带的第六时间戳T6；定义所述模组-簇时钟偏差为Toffset2，帧传输延时为Tdelay2,可得如下关系式：T6＝T5+Tdelay2；T7＝+Tdelay2；由以上关系式可得模组-簇时钟偏差Toffset2表示为：Toffset2＝T6-T7。基于模组-簇时钟偏差校准模组的时钟具体为：将模组的原始时钟加上所得模组-簇时钟偏差Toffset2，获得校准后的模组的时钟。由于簇在广播同步帧后立即广播跟随帧，根据同步帧和跟随帧的时间戳信息计算模组-簇时钟偏差，使得对模组的时钟校准可达毫秒级，确保各级设备之间的时钟同步精度。S03、令簇在整数秒时向簇内的模组广播模组数据采集命令，响应于模组数据采集命令，模组在一个上报周期内向上级的簇上报模组数据，具体如图2所示，簇在整数秒，如第0秒0毫秒时，令簇广播模组数据采集命令，簇内的各模组在接收到模组数据采集命令后，开始从第一帧上报模组数据，每个模组有十三帧，每间隔40毫秒发送一帧，则每个模组可在13*40＝520毫秒内完成上报，模组发送完本轮数据后停止，继续等待下一次启动数据上报的命令。S04、簇接收下级所有模组上报的模组数据并存储，具体的，簇实时接收各模组的模组数据后解析进自身的缓存中，直至簇内所有模组数据均接收完毕，将整簇的模组数据同步到待上报的缓存中，等待堆的主动采集数据。S05、堆向堆内的簇发起簇数据采集命令，采集簇内存储的数据，具体的，由于堆与簇之间采用TCP/IP网络连接，通信速度较快，堆可采用多线程并发的方式同时采集各簇的数据，提高采集效率。堆向堆内的簇发起簇数据采集命令时，检测各个簇数据的完整性，即检测各个簇是否收集簇内所有模组的模组数据，若是则采集簇内存储的数据，否则跳过该簇。在实际应用中，采用上述的数据同步方法采集各簇的数据如图3、图4所示，由此可见，本实施例的数据同步方法可同步采集各簇同一时刻的数据，以便于后续进行数据分析。本公开通过报文、同步帧和跟随帧，计算获得簇-堆时钟偏差和模组-簇时钟偏差，基于簇-堆时钟偏差和模组-簇时钟偏差对簇和模组的时钟进行校准，使模组、簇、堆三者的时钟保持同步，并通过整数秒启动采集数据的方法，便于各级设备之间采集数据的对齐，使各级设备采集的数据均处于同一时刻，实现对各级设备数据的同步采集，可提高后续的数据分析结果的准确性，更便于储能系统的状态检测、故障寻因等过程。本实施例还提供了一种储能电站数据同步系统，应用于储能电站中，所述储能电站包括沿数据收集方向按序级联的模组、簇和堆，所述储能电站数据同步系统包括：处理控制模块，其用于计算簇相对于堆的时钟偏差记为簇-堆时钟偏差，基于所述簇-堆时钟偏差校准簇的时钟；计算模组相对于簇的时钟偏差记为模组-簇时钟偏差，基于所述模组-簇时钟偏差校准模组的时钟；令簇在整数秒时向簇内的模组广播模组数据采集命令，响应于所述模组数据采集命令，模组在一个上报周期内向上级的簇上报模组数据；簇接收下级所有模组上报的模组数据并存储；堆向堆内的簇发起簇数据采集命令，采集簇内存储的数据。本实施例的储能电站数据同步系统与上述的储能电站数据同步方法属于相同的发明构思，可参照上文描述进行理解，在此不再赘述。如图5所示，本实施例还提供了一种计算机设备，包括通过总线信号连接的处理器101和存储器102，所述存储器102中存储有至少一条指令或至少一段程序，所述至少一条指令或所述至少一段程序由所述处理器101加载时执行如上所述储能电站数据同步方法。存储器102可用于存储软件程序以及模块，处理器101通过运行存储在存储器102的软件程序以及模块，从而执行各种功能应用。存储器102可主要包括存储程序区和存储数据区，其中，存储程序区可存储操作系统、功能所需的应用程序等；存储数据区可存储根据所述设备的使用所创建的数据等。此外，存储器102可以包括高速随机存取存储器，还可以包括非易失性存储器，例如至少一个磁盘存储器件、闪存器件、或其他易失性固态存储器件。相应地，存储器102还可以包括存储器控制器，以提供处理器101对存储器102的访问。本公开实施例所提供的方法实施例可以在计算机终端、服务器或者类似的运算装置中执行，即上述计算机设备可以包括计算机终端、服务器或者类似的运算装置。该计算机设备的内部结构可包括但不限于：处理器、网络接口及存储器。其中，计算机设备内的处理器、网络接口及存储器可通过总线或其他方式连接。其中，处理器101)是计算机设备的计算核心以及控制核心。网络接口可选的可以包括标准的有线接口、无线接口。存储器102是计算机设备中的记忆设备，用于存放程序和数据。可以理解的是，此处的存储器102可以是高速RAM存储设备，也可以是非不稳定的存储设备，例如至少一个磁盘存储设备；可选的还可以是至少一个位于远离前述处理器101的存储装置。存储器102提供存储空间，该存储空间存储了电子设备的操作系统，可包括但不限于：Windows系统，Linux，Android系统、IOS系统等等，本公开对此并不作限定；并且，在该存储空间中还存放了适于被处理器101加载并执行的一条或一条以上的指令，这些指令可以是一个或一个以上的计算机程序。在本说明书实施例中，处理器101加载并执行存储器102中存放的一条或一条以上指令，以实现上述方法实施例所述储能电站数据同步方法。本公开实施例还提供一种计算机可读存储介质，其上存储有至少一条指令或至少一段程序，所述至少一条指令或所述至少一段程序被处理器101加载时执行如上所述储能电站数据同步方法。上述计算机可读存储介质承载有一个或者多个程序，当上述一个或者多个程序被执行时，实现根据本公开实施例的方法。根据本公开的实施例，计算机可读存储介质可以是非易失性的计算机可读存储介质。例如可以包括但不限于：便携式计算机磁盘、硬盘、随机访问存储器、只读存储器、可擦式可编程只读存储器、便携式紧凑磁盘只读存储器、光存储器件、磁存储器件、或者上述的任意合适的组合。在本公开中，计算机可读存储介质可以是任何包含或存储程序的有形介质，该程序可以被指令执行系统、装置或者器件使用或者与其结合使用。在本公开的描述中，需要理解的是，方位词如“前、后、上、下、左、右”、“横向、竖向、水平”和“顶、底”等所指示的方位或位置关系通常是基于附图所示的方位或位置关系，仅是为了便于描述本公开和简化描述，在未作相反说明的情况下，这些方位词并不指示和暗示所指的装置或元件必须具有特定的方位或者以特定的方位构造和操作，因此不能理解为对本公开保护范围的限制。对于本领域的技术人员来说，可根据以上描述的技术方案以及构思，做出其它各种相应的改变以及形变，而所有的这些改变以及形变都应该属于本公开权利要求的保护范围之内。
