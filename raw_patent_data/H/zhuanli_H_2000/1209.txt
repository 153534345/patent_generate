标题title
一种实现动态IP池的方法、系统、设备及可读存储介质
摘要abst
本发明提供了一种实现动态IP池的方法、系统、设备及可读存储介质，涉及通信处理技术领域，包括：各节点同时竞争ETCD分布式锁选举出主节点；主节点与副节点通过gRPC进行周期性交互，检测主节点和副节点是否异常，若主节点异常，则重新选举主节点；若副节点异常，则主节点接管副节点IP或将该副节点IP分配给其他正常副节点接管；主节点与副节点分别执行预设检测循环脚本，若自身业务执行异常，则根据预设IP变化处理该节点。本发明基于gRPC+ETCD构架，由ETCD进行主节点竞选，状态监控；通过gRPC通信，将业务检测内容进行规划，明确各类型异常IP接管，使节点出现故障或IP丢失时，本发明仍能实现NAS高可用业务。
权利要求书clms
1.一种实现动态IP池的方法，其特征在于，用于节点端，包括：集群节点连接分布式键值存储系统，各节点同时竞争分布式键值存储系统的分布式锁选举主节点，获得分布式锁的节点为主节点，其他节点为副节点；通过谷歌远程过程调用协议，主节点与副节点进行周期性交互，检测主节点和副节点是否异常，若主节点异常，则重新选举主节点，得到新的主节点；若副节点异常，则主节点接管副节点IP或将该副节点IP分配给其他正常副节点接管；主节点与副节点分别执行预设检测循环脚本，判断自身业务是否执行异常，若自身业务执行异常，则根据预设IP变化处理该节点。2.根据权利要求1所述实现动态IP池的方法，其特征在于，各节点同时竞争分布式键值存储系统的分布式锁，获得分布式锁的节点为主节点，其他节点为副节点，包括：将各节点的机器ID作为相对应的唯一标识符，各节点分别为自己的唯一标识符创建租约；各节点将自己的标识符和租约写入分布式键值存储系统，根据分布式键值存储系统的修订机制，得到返回的修订值，各节点记录自己的修订值；比较各节点修订值的大小，选取修订值最小的节点获得分布式锁，该节点为主节点，其他节点为副节点；主节点通过心跳机制对租约进行续约。3.根据权利要求1所述实现动态IP池的方法，其特征在于，通过谷歌远程过程调用协议，主节点与副节点进行周期性交互，检测主节点和副节点是否异常，所述周期性交互包括副节点定期向主节点上报自身信息和主节点定期收集副节点信息，包括：当副节点周期性通过谷歌远程过程调用协议向主节点上报自己角色为副节点并且在线时，若上报超时，则判断主节点异常，副节点发起选举；副节点将自身角色提升为竞选者，任期号加1，得到更新任期号；获取其他节点的任期号，比较更新任期号与其他节点的任期号是否一致，若不一致，则竞选者作为新主节点；若一致，则竞选者与其他节点比较IP大小，选取IP大的节点作为新主节点，IP小的节点自动将角色降为副节点；选举出新主节点后，新主节点告知其他节点新主节点的任期号，同步其他节点任期；主节点通过谷歌远程过程调用协议定期收集副节点信息；若主节点收集某副节点信息超时，则判断该副节点异常，主节点接管副节点IP或将该副节点IP分配给其他正常副节点接管；主节点通过谷歌远程过程调用协议再次收集该副节点信息，若收集该副节点信息正常，则该副节点IP被接管节点自动归还。4.根据权利要求1所述实现动态IP池的方法，其特征在于，主节点与副节点分别执行预设检测循环脚本，判断自身业务是否执行异常，包括：检测节点角色，根据不同的角色调用对应的谷歌远程过程调用协议对节点业务进行循环检测；所述检测包括高可用服务节点状态、高可用配置网卡状态、物理设备状态、网络文件系统进程和信息服务块进程；若主节点上的检测出现异常，则判断主节点业务执行异常，重新选举主节点；若副节点上的检测出现异常，则判断副节点业务执行异常，主节点根据预设IP变化处理该副节点。5.一种实现动态IP池的系统，其特征在于，包括：节点选举单元，用于各节点同时竞争分布式键值存储系统的分布式锁选举主节点；节点交互单元，用于通过谷歌远程过程调用协议，主节点与副节点进行周期性交互；接口单元，用于输入预设检测循环脚本；业务检测单元，用于主节点与副节点分别执行预设检测循环脚本，判断自身业务是否执行异常。6.根据权利要求5所述的实现动态IP池的系统，其特征在于，所述节点选举单元包括：创租单元，用于将各节点的机器ID作为相对应的唯一标识符，各节点分别为自己的唯一标识符创建租约；修订单元，用于各节点将自己的标识符和租约写入分布式键值存储系统，根据分布式键值存储系统的修订机制，得到返回的修订值，各节点记录自己的修订值；第一比较单元，用于比较各节点修订值的大小，选取修订值最小的节点获得分布式锁，该节点为主节点，其他节点为副节点；续租单元，用于主节点通过心跳机制对租约进行续约。7.根据权利要求5所述的实现动态IP池的系统，其特征在于，所述节点交互单元包括：上报单元，用于副节点周期性通过谷歌远程过程调用协议向主节点上报自己角色为副节点并且在线；角色提升单元，用于副节点将自身角色提升为竞选者，任期号加1，得到更新任期号；第二比较单元，用于获取其他节点的任期号，比较更新任期号与其他节点的任期号是否一致，若不一致，则竞选者作为新主节点；第三比较单元，用于当所述第二比较单元结果若一致时，竞选者与其他节点比较IP大小，选取IP大的节点作为新主节点，IP小的节点自动将角色降为副节点；告知单元，用于选举出新主节点后，新主节点告知其他节点新主节点的任期号，同步其他节点任期；收集单元，用于主节点通过谷歌远程过程调用协议定期收集副节点信息；分配单元，用于当主节点收集某副节点信息超时，主节点接管副节点IP或将该副节点IP分配给其他正常副节点接管；归还单元，用于主节点通过谷歌远程过程调用协议再次收集该副节点信息，当收集该副节点信息正常，则该副节点IP被接管节点自动归还。8.根据权利要求5所述的实现动态IP池的系统，其特征在于，所述业务检测单元包括：检测单元，用于检测节点角色，根据不同的角色调用对应的谷歌远程过程调用协议对节点业务进行循环检测；第一判断单元，用于当主节点上的检测出现异常时，判断主节点业务执行异常，重新选举主节点；第二判断单元，用于当副节点上的检测出现异常时，判断副节点业务执行异常，主节点根据预设IP变化处理该副节点。9.一种实现动态IP池的设备，其特征在于，包括：存储器，用于存储计算机程序；处理器，用于执行所述计算机程序时实现如权利要求1至4任一项所述实现动态IP池的方法的步骤。10.一种可读存储介质，其特征在于，包括，所述可读存储介质上存储有计算机程序，所述计算机程序被处理器执行时实现如权利要求1至4任一项所述实现动态IP池的方法的步骤。
说明书desc
技术领域本发明涉及通信处理技术领域，具体而言，涉及一种实现动态IP池的方法、系统、设备及可读存储介质。背景技术现有基于统一分布式存储的网络附属存储高可用设计架构高度依赖于分布式键值存储系统，并且在集群部署的过程中ETCD数据库和NAS存储会混合部署到相同的节点上，ETCD出现故障时伴随着集群节点出现异常，无法完全实现NAS高可用业务和高可用NAS IP的漂移和接管。并且此架构高度绑定ETCD，发现ETCD故障或者集群节点异常后，难以对相关业务进行增加和修改。发明内容本发明的目的在于提供一种实现动态IP池的方法、系统、设备及可读存储介质，以解决上述问题。为了实现上述目的，本发明采取的技术方案如下：第一方面，本申请提供了一种实现动态IP池的方法，用于节点端，包括：集群节点连接分布式键值存储系统，各节点同时竞争分布式键值存储系统的分布式锁选举主节点，获得分布式锁的节点为主节点，其他节点为副节点；通过谷歌远程过程调用协议，主节点与副节点进行周期性交互，检测主节点和副节点是否异常，若主节点异常，则重新选举主节点，得到新的主节点；若副节点异常，则主节点接管副节点IP或将该副节点IP分配给其他正常副节点接管；主节点与副节点分别执行预设检测循环脚本，判断自身业务是否执行异常，若自身业务执行异常，则根据预设IP变化处理该节点。第二方面，本申请还提供了一种实现动态IP池的系统，包括：节点选举单元、节点交互单元、接口单元和业务检测单元。所述节点选举单元用于各节点同时竞争分布式键值存储系统的分布式锁选举主节点。所述节点交互单元用于通过谷歌远程过程调用协议，主节点与副节点进行周期性交互。所述接口单元用于输入预设检测循环脚本。所述业务检测单元用于主节点与副节点分别执行预设检测循环脚本，判断自身业务是否执行异常。第三方面，本申请还提供了一种实现动态IP池的设备，包括：存储器，用于存储计算机程序；处理器，用于执行所述计算机程序时实现所述实现动态IP池的方法的步骤。第四方面，本申请还提供了一种可读存储介质，包括，所述可读存储介质上存储有计算机程序，所述计算机程序被处理器执行时实现所述实现动态IP池的方法的步骤。本发明的有益效果为：本发明通过基于谷歌远程过程调用协议的分布式键值存储系统架构，由ETCD进行主节点竞选，状态监控，服务发现，负载均衡；通过gRPC框架，将业务检测内容进行规划，明确解决各类型异常接管问题，当节点出现故障或IP丢失时，本发明仍能实现NAS高可用业务。本发明的其他特征和优点将在随后的说明书阐述，并且，部分地从说明书中变得显而易见，或者通过实施本发明实施例了解。本发明的目的和其他优点可通过在所写的说明书、权利要求书，以及附图中所特别指出的结构来实现和获得。附图说明为了更清楚地说明本发明实施例的技术方案，下面将对实施例中所需要使用的附图作简单的介绍，应当理解，以下附图仅示出了本发明的某些实施例，因此不应被看作是对范围的限定，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他相关的附图。图1为本发明实施中实现动态IP池的方法步骤S100的流程图；图2为本发明实施中实现动态IP池的方法步骤S200的流程图；图3为本发明实施中实现动态IP池的方法步骤S300的流程图；图4为本发明实施中实现动态IP池的系统结构示意图；图5为本发明实施中实现动态IP池的设备结构示意图。图中标记：400、节点选举单元；500、节点交互单元；600、接口单元；700、业务检测单元；410、创租单元；420、修订单元；430、第一比较单元；440、续租单元；510、上报单元；520、角色提升单元；530、第二比较单元；540、第三比较单元；550、告知单元；560、收集单元；570、分配单元；580、归还单元；710、检测单元；711、业务规划单元；720、第一判断单元；730、第二判断单元；731、IP变化单元；800、实现动态IP池的设备；801、处理器；802、存储器；803、指令输入端口；804、I/O接口；805、通信组件。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整的描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。通常在此处附图中描述和示出的本发明实施例的组件可以以各种不同的配置来布置和设计。因此，以下对在附图中提供的本发明的实施例的详细描述并非旨在限制要求保护的本发明的范围，而是仅仅表示本发明的选定实施例。基于本发明中的实施例，本领域普通技术人员在没有作出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。应注意到：相似的标号和字母在下面的附图中表示类似项，因此，一旦某一项在一个附图中被定义，则在随后的附图中不需要对其进行进一步定义和解释。同时，在本发明的描述中，术语“第一”“第二”等仅用于区分描述，而不能理解为指示或暗示相对重要性。实施例1：本实施例提供了一种实现动态IP池的方法，用于节点端，包括：S100、集群节点连接分布式键值存储系统，各节点同时竞争分布式键值存储系统的分布式锁选举主节点，获得分布式锁的节点为主节点，其他节点为副节点。所述主节点在集群节点中是唯一的，拥有同步、调度分配特权，选举出主节点后，各节点开始执行自身业务。S200、通过谷歌远程过程调用协议，主节点与副节点进行周期性交互，检测主节点和副节点是否异常，若主节点异常，则重新选举主节点，得到新的主节点；若副节点异常，则主节点接管副节点IP或将该副节点IP分配给其他正常副节点接管；S300、主节点与副节点分别执行预设检测循环脚本，判断自身业务是否执行异常，若自身业务执行异常，则根据预设IP变化处理该节点。如图1所示，在一些具体实施例中，步骤S100包括步骤S110、步骤S120、步骤S130和步骤S140。S110、将各节点的机器ID作为相对应的唯一标识符，各节点分别为自己的唯一标识符创建租约；S120、各节点将自己的标识符和租约写入分布式键值存储系统，根据分布式键值存储系统的修订机制，得到返回的修订值，各节点记录自己的修订值；S130、比较各节点修订值的大小，选取修订值最小的节点获得分布式锁，该节点为主节点，其他节点为副节点；S140、主节点通过心跳机制对租约进行续约。步骤S200中所述周期性交互包括副节点定期向主节点上报自身信息和主节点定期收集副节点信息。如图2所示，在一些具体实施例中，步骤S200包括步骤S210、步骤S220、步骤S230、步骤S240、步骤S250、步骤S260、步骤S270和步骤S280。S210、当副节点周期性通过谷歌远程过程调用协议向主节点上报自己角色为副节点并且在线时，若上报超时，则判断主节点异常，副节点发起选举；S220、副节点将自身角色提升为竞选者，任期号加1，得到更新任期号；S230、获取其他节点的任期号，比较更新任期号与其他节点的任期号是否一致，若不一致，则竞选者作为新主节点；S240、若一致，则竞选者与其他节点比较IP大小，选取IP大的节点作为新主节点，IP小的节点自动将角色降为副节点；需要说明的是，本申请架构为异步模型，存在多个节点同时成为竞选者，且获取到对方尚未更新任期号的情况，因此出现这种情况时，需要集群节点再度竞争分布式锁来避免产生多个主节点。S250、选举出新主节点后，新主节点告知其他节点新主节点的任期号，同步其他节点任期；S260、主节点通过谷歌远程过程调用协议定期收集副节点信息；S270、若步骤S260中主节点收集某副节点信息超时，则判断该副节点异常，主节点接管副节点IP或将该副节点IP分配给其他正常副节点接管；S280、主节点通过步骤S260再次收集该副节点信息，若收集该副节点信息正常，则该副节点IP被接管节点自动归还。如图3所示，在一些具体实施例中，步骤S300包括步骤S310、步骤S320和步骤S330。S310、检测节点角色，根据不同的角色调用对应的谷歌远程过程调用协议对节点业务进行循环检测；所述检测包括高可用服务节点状态、高可用配置网卡状态、物理设备状态、网络文件系统进程和信息服务块进程。S320、若步骤S310主节点上的检测出现异常，则判断主节点业务执行异常，重新选举主节点；S330、若步骤S310副节点上的检测出现异常，则判断副节点业务执行异常，主节点根据预设IP变化处理该副节点。需要说明的是，所述预设IP变化具体包括：当高可用服务节点暂停时，该节点IP被其他正常节点接管；高可用服务节点恢复时，该节点IP被接管节点自动归还；高可用配置网卡断开时，该节点IP被其他正常节点接管；高可用配置网卡重连时，该节点IP被接管节点自动归还；节点对应的物理设备关机或者重启或者断电时，该节点IP被其他正常节点接管；节点对应的物理设备开机正常运行时，该节点IP被接管节点自动归还；网络文件系统进程停止或者异常时，该节点IP被其他正常节点接管；信息服务块进程停止或者异常时该节点IP被其他正常节点接管。在一些具体的实施例中，步骤S140包括步骤S141和步骤S142。S141、当主节点持有分布式锁的期间节点崩溃，心跳机制停止，唯一标识符将因租约到期而被删除，主节点释放分布式锁，避免死锁；S142、其余节点竞争分布式锁，选出新的主节点。实施例2：如图4所示，本实施例提供了一种实现动态IP池的系统，包括：节点选举单元400，用于各节点同时竞争分布式键值存储系统的分布式锁选举主节点；节点交互单元500，用于通过谷歌远程过程调用协议，主节点与副节点进行周期性交互；接口单元600，用于输入预设检测循环脚本；业务检测单元700，用于主节点与副节点分别执行预设检测循环脚本，判断自身业务是否执行异常。在一些具体的实施例中，节点选举单元400包括：创租单元410，用于将各节点的机器ID作为相对应的唯一标识符，各节点分别为自己的唯一标识符创建租约；修订单元420，用于各节点将自己的标识符和租约写入分布式键值存储系统，根据分布式键值存储系统的修订机制，得到返回的修订值，各节点记录自己的修订值；第一比较单元430，用于比较各节点修订值的大小，选取修订值最小的节点获得分布式锁，该节点为主节点，其他节点为副节点；续租单元440，用于主节点通过心跳机制对租约进行续约。在一些具体的实施例中，节点交互单元500包括：上报单元510，用于副节点周期性通过谷歌远程过程调用协议向主节点上报自己角色为副节点并且在线；角色提升单元520，用于副节点将自身角色提升为竞选者，任期号加1，得到更新任期号；第二比较单元530，用于获取其他节点的任期号，比较更新任期号与其他节点的任期号是否一致，若不一致，则竞选者作为新主节点；第三比较单元540，用于当所述第二比较单元结果若一致时，竞选者与其他节点比较IP大小，选取IP大的节点作为新主节点，IP小的节点自动将角色降为副节点；告知单元550，用于选举出新主节点后，新主节点告知其他节点新主节点的任期号，同步其他节点任期；收集单元560，用于主节点通过谷歌远程过程调用协议定期收集副节点信息；分配单元570，用于当主节点收集某副节点信息超时，主节点接管副节点IP或将该副节点IP分配给其他正常副节点接管；归还单元580，用于主节点通过谷歌远程过程调用协议再次收集该副节点信息，当收集该副节点信息正常，则该副节点IP被接管节点自动归还。在一些具体的实施例中，业务检测单元700包括：检测单元710，用于检测节点角色，根据不同的角色调用对应的谷歌远程过程调用协议对节点业务进行循环检测；第一判断单元720，用于当主节点上的检测出现异常时，判断主节点业务执行异常，重新选举主节点；第二判断单元730，用于当副节点上的检测出现异常时，判断副节点业务执行异常，主节点根据预设IP变化处理该副节点。在一些具体的实时例中，检测单元710包括：业务规划单元711，用于规划检测内容，所述检测包括高可用服务节点状态、高可用配置网卡状态、物理设备状态、网络文件系统进程和信息服务块进程；在一些具体的实时例中，第二判断单元730包括：IP变化单元731，用于当高可用服务节点暂停时，该节点IP被其他正常节点接管；高可用服务节点恢复时，该节点IP被接管节点自动归还；高可用配置网卡断开时，该节点IP被其他正常节点接管；高可用配置网卡重连时，该节点IP被接管节点自动归还；节点对应的物理设备关机或者重启或者断电时，该节点IP被其他正常节点接管；节点对应的物理设备开机正常运行时，该节点IP被接管节点自动归还；网络文件系统进程停止或者异常时，该节点IP被其他正常节点接管；信息服务块进程停止或者异常时该节点IP被其他正常节点接管。实施例3：相应于上面的方法实施例，本实施例中还提供了一种实现动态IP池的设备，下文描述的实现动态IP池的设备与上文描述的实现动态IP池的方法可相互对应参照。图5是根据示例性实施例示出的一种实现动态IP池的设备的框图。如图5所示，该实现动态IP池的设备800包括：处理器801，存储器802。该实现动态IP池的设备还可以包括指令输入端口803，I/O接口804以及通信组件805中的一者或多者。其中，处理器801用于控制实现动态IP池的设备的整体操作，以完成上述的实现动态IP池的方法中的全部或部分步骤。存储器802用于存储各种类型的数据以支持在该实现动态IP池的设备的操作，这些数据例如可以包括用于在该实现动态IP池的设备上操作的任何应用程序或方法的指令，以及应用程序相关的数据。该存储器802可以由任何类型的易失性或非易失性存储设备或者它们的组合实现，例如静态随机存取存储器，电可擦除可编程只读存储器，可擦除可编程只读存储器，可编程只读存储器，只读存储器，磁存储器，快闪存储器，磁盘或光盘。指令输入端口803可以包括屏幕和键盘。其中屏幕例如可以是触摸屏，键盘用于输出和/或输入程序指令。所接收的程序指令可以被进一步存储在存储器802或通过通信组件805发送。I/O接口804为处理器801和其他接口模块之间提供接口，上述其他接口模块可以是鼠标，按钮等。这些按钮可以是虚拟按钮或者实体按钮。通信组件805用于该实现动态IP池的设备与其他设备之间进行有线或无线通信。无线通信，例如Wi-Fi，蓝牙，近场通信，2G、3G或4G，或它们中的一种或几种的组合，因此相应的该通信组件805可以包括：Wi-Fi模块，蓝牙模块，NFC模块。在一示例性实施例中，实现动态IP池的设备800可以被一个或多个应用专用集成电路、数字信号处理器、数字信号处理设备、可编程逻辑器件、现场可编程门阵列、控制器、微控制器、微处理器或其他电子元件实现，用于执行上述的实现动态IP池的方法。实施例4：相应于上面的方法实施例，本实施例中还提供了一种存储介质，所述存储介质为可读存储介质，下文描述的一种可读存储介质与上文描述的实现动态IP池的方法可相互对应参照。一种可读存储介质，可读存储介质上存储有计算机程序，计算机程序被处理器801执行时实现上述方法实施例的实现动态IP池的方法的步骤。该可读存储介质具体可以为U盘、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可存储程序代码的可读存储介质。以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。以上所述，仅为本发明的具体实施方式，但本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，可轻易想到变化或替换，都应涵盖在本发明的保护范围之内。因此，本发明的保护范围应以权利要求的保护范围为准。
