标题title
一种固定模式噪音的计算与补偿方法
摘要abst
本发明涉及视频图像处理技术领域，尤其涉及一种固定模式噪音的计算与补偿方法，包括：步骤S1、自学习模块获取在不同光源环境下的学习样本的图像数据，生成映射关系；步骤S2、使用相机处理预设数量的测试样本，噪声消除模块对各测试样本的图像信息进行噪声补偿，检测模块检测各补偿后的所述图像信息中的竖纹密度，判定各图像信息的噪声补偿是否符合标准；步骤S3、所述中控模块统计针对各图像数据的噪声补偿是否符合标准的判定结果以控制所述噪声消除模块重新进行自学习，并在自学习时将对应的学习参数调节至对应值；本发明在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，提高了相机图像处理的效率。
权利要求书clms
1.一种固定模式噪音的计算与补偿方法，其特征在于，包括：步骤S1、自学习模块获取在全黑环境及均匀光源环境下的学习样本的图像数据，并根据所述图像数据生成映射关系；步骤S2、使用相机处理预设数量的测试样本，噪声消除模块根据所述测试样本的亮度对各测试样本的图像信息进行噪声补偿，中控模块在所述噪声补偿完成时控制检测模块检测各补偿后的所述图像信息中的竖纹密度以根据所述竖纹密度判定各图像信息的噪声补偿是否符合标准；步骤S3、所述中控模块在完成判定各图像信息的噪声补偿是否符合标准时，统计针对各图像数据的噪声补偿是否符合标准的判定结果以根据所述判定结果控制所述噪声消除模块重新进行自学习，并在自学习时将对应的学习参数调节至对应值。2.根据权利要求1所述的固定模式噪音的计算与补偿方法，其特征在于，对于所述步骤S1，包括：步骤S11、将相机置于全黑环境下并使其保持静止；步骤S12、在预设的暗场增益幅度中使用预设的增益步进值获取m个增益值，并在预设的曝光时长幅度下使用预设的曝光时长步进值获取n个曝光时长；针对第i个增益值gi，i＝1,2,3，...m，自学习模块分别与各所述曝光时长进行匹配以形成单个训练基准，在该训练基准下采集s张图像并取各图像的均值作为该训练基准下的暗场噪声图像数据，对于使用第i个增益值gi和第j个曝光时长ej形成的训练基准，j＝1,2,3，...，n，中控模块将在该基准下的暗场噪声图像数据记为Idarkij，所述自学习模块重复上述步骤以获取m×n个暗场图像数据；步骤S13、所述自学习模块通过使用所述暗场图像数据、所述增益以及所述曝光时间三个变量在三维空间的分布情况，使用t次曲面方程进行拟合以生成暗场噪声相对于增益g与曝光时间e的连续映射关系Idark＝f并将其记为暗部映射；步骤S14、所述自学习模块将相机置于均匀光源环境下并使其保持静止，重复所述步骤S2以获取m×n个原始图像数据，对于使用第i个增益值gi和第j个曝光时长ej形成的训练基准，中控模块将在该基准下的原始图像数据记为Iorgij，在该基准下的明场噪声图像数据记为Ilumij，设定Ilumij＝-Igoalij，其中，Igoalij为在该训练标准下的目标图像数据；步骤S15、所述自学习模块利用所述明场噪声图像、所述增益g以及所述曝光时间e三个变量在三维空间的分布情况进行t次曲面拟合以生成Ilum相对于增益g与曝光时间e的连续映射关系Ilum＝h并将其记为亮部映射。3.根据权利要求2所述的固定模式噪音的计算与补偿方法，其特征在于，在所述步骤S2中，所述中控模块完成对的单个所述测试样本的噪声补偿完成时控制检测模块依次检测各补偿后测试样本中图像信息中的竖纹密度P，并根据竖纹密度P判定针对该图像信息的噪声补偿是否合格的初步判定方式，其中：第一初步判定方式为所述中控模块判定所述图像信息的噪声补偿合格，并控制标记模块标记该图像的环境类型及合格判定结果；所述第一初步判定方式满足所述竖纹密度P小于等于第一预设竖纹密度P1；第二初步判定方式为所述中控模块判定所述图像信息的噪声补偿不合格，并根据该图像信息的亮度判定是否更换映射以重新对该图像信息进行噪声补偿处理；所述第二初步判定方式满足所述竖纹密度P大于第一预设竖纹密度P1且小于等于第二预设竖纹密度P2；第三初步判定方式为所述中控模块判定所述图像信息的噪声补偿不合格，并控制标记模块标记该图像的环境类型及合格判定结果；所述第三初步判定方式满足所述竖纹密度P大于第二预设竖纹密度P2；所述环境类型包括眀场和暗场，所述合格判定结果包括合格和不合格。4.根据权利要求3所述的固定模式噪音的计算与补偿方法，其特征在于，所述中控模块在所述第二初步判定方式下控制所述检测模块检测所述图像信息的亮度，并根据测得的亮度判定是否更换映射以重新对图像信息进行噪声补偿，其中：若所述图像信息中的亮度小于预设亮度且所述中控模块使用所暗部映射对该图像信息进行噪声补偿，或，所述图像信息中的亮度大于等于预设亮度且所述中控模块使用所述亮部映射对该图像信息进行噪声补偿，则所述中控模块不更换映射对该图像重新进行噪声补偿并判定所述图像信息的映射合格；若所述图像信息中的亮度小于预设亮度且所述中控模块使用所述亮部映射对该图像信息进行噪声补偿，或，所述图像信息中的亮度大于等于预设亮度且所述中控模块使用所述暗部映射对该图像信息进行噪声补偿，则所述中控模块更换映射对该图像重新进行噪声补偿。5.根据权利要求4所述的固定模式噪音的计算与补偿方法，其特征在于，所述中控模块在所述标记模块完成对全部图像信息的标记时，统计标记为不合格的图像信息的数量与测试样本总数比值，中控模块将该比值记为不合格比值，并根据不合格比值确定针对各映射方式的调节方式，其中:第一调节方式为所述中控模块判定所述映射合格，不对该映射进行调节；所述第一调节方式满足所述不合格比值小于等于第一预设不合格比值；第二调节方式为所述中控模块判定所述映射不合格，并分别计算亮场环境中亮部图像不合格数量与亮部图像总数的亮部比值Bl，以及，暗场环境中暗部图像不合格数量与暗部图像总数的暗部比值Bd，并根据Bl和Bd对对应的映射中的参数进行调节；所述第二调节方式满足所述不合格比值大于第一预设不合格比值且小于等于第二预设不合格比值；第三调节方式为所述中控模块判定所述映射不合格，并根据不合格比值B与所述第二预设不合格比值的差值将各映射中曝光时长的步进值和增益的步进值调节至对应值；所述第三调节方式满足所述不合格比值大于第二预设不合格比值。6.根据权利要求5所述的固定模式噪音的计算与补偿方法，其特征在于，所述中控模块在所述第二调节方式下分别计算亮场环境中亮部图像不合格数量与亮部图像总数的亮部比值Bl，以及，暗场环境中暗部图像不合格数量与暗部图像总数的暗部比值Bd，并根据Bl和Bd判定调节的映射类型的调节类型判定方式，其中：第一类型判定方式为所述中控模块判定对所述亮部映射中的参数进行调节；所述第一类型调节方式满足所述亮部比值Bl大于所述暗部比值Bd；第二类型判定方式为所述中控模块判定对所述暗部映射中的参数进行调节；所述第二类型调节方式满足所述亮部比值Bl小于等于所述暗部比值Bd。7.根据权利要求6所述的固定模式噪音的计算与补偿方法，其特征在于，所述中控模块在所述第三调节方式下根据不合格比值B与所述第二预设不合格比值的差值判定调节曝光时长的步进值和增益的步进值的步进值调节方式，其中：第一步进值调节方式为所述中控模块选用第一调节系数α1对步进值进行调节，设定调节后的步进值s’＝s0×α1，其中s0为调节前的初始步进值；所述第一步进值调节方式满足所述差值大于等于预设差值；第二步进值调节方式为所述中控模块选用第二调节系数α2对步进值进行调节，设定调节后的步进值s’＝s0×α2；所述第二步进值调节方式满足所述差值小于预设差值。8.根据权利要求7所述的固定模式噪音的计算与补偿方法，其特征在于，所述中控模块在完成对所述曝光时长的步进值调节时，根据调节后的步进值判定对曝光时长的幅度的幅度单向调节方式，其中：第一幅度单向调节方式为所述中控模块选用第一单向调节系数β1对所述曝光时长的幅度进行调节，设定调节后曝光时长的幅度为G’＝G0×β1，其中G0为调节前曝光时长的幅度；所述第一幅度单向调节方式满足调节后的步进值大于第一预设步进值；第二幅度单向调节方式为所述中控模块选用第二单向调节系数β2对所述曝光时长的幅度进行调节，设定调节后曝光时长的幅度为G’＝G0×β2；所述第二幅度单向调节方式满足调节后的步进值小于等于第一预设步进值。9.根据权利要求8所述的固定模式噪音的计算与补偿方法，其特征在于，所述中控模块在完成对所述增益的步进值调节时，根据调节后的步进值判定对增益的幅度的幅度双向调节方式，其中：第一幅度双向调节方式为所述中控模块选用第一双向调节系数γ1对所述增益的幅度进行调节，设定调节后增益的幅度为E’＝E0×γ1，其中E0为调节前增益的幅度；所述第一幅度单向调节方式满足调节后的步进值大于第二预设步进值；第二幅度双向调节方式为所述中控模块选用第二双向调节系数γ2对所述增益的幅度进行调节，设定调节后增益的幅度为E’＝E0×γ1，其中E0为调节前增益的幅度；所述第一幅度双向调节方式满足调节后的步进值大于第二预设步进值。10.根据权利要求9所述的固定模式噪音的计算与补偿方法，其特征在于，所述中控模块在判定需对曝光时长和增益的幅度调节时，将所述亮部图像不合格数量与测试样本的总数的比值或所述暗部图像不合格数量与测试样本的总数的比值记为单部不合格比值并根据单部不合格比值判定对调节后的幅度进行修正的修正方式，其中：第一修正方式为所述中控模块选用第一修正系数a1对调节系数进行修正，设定修正后的第i单向调节系数βi’＝βi×a1，其中βi为修正前第i单向调节系数，修正后的第i双向调节系数γi’＝γi×a1，其中γi为修正前第i双向调节系数；所述第一修正方式满足所述单部不合格比值大于等于预设单部不合格比值；第二修正方式为所述中控模块选用第二修正系数a2对调节系数进行修正，设定修正后的第i单向调节系数βi’＝βi×a2，修正后的第i双向调节系数γi’＝γi×a2；所述第二修正方式满足所述单部不合格比值小于预设单部不合格比值。
说明书desc
技术领域本发明涉及视频图像处理技术领域，尤其涉及一种固定模式噪音的计算与补偿方法。背景技术针对线扫相机的固定模式噪声导致图像出现竖条纹问题，现有技术普遍能够准确计算明亮场景下的固定模式噪声，从而消除明亮场景下的竖条纹，然而，同样的参数或计算方法应用于亮度较低的环境时，计算出的固定模式噪声往往是不正确的，从而导致在进行SUM-X操作后，竖条纹无法消除甚至更加明显。现有技术无法使用同一套参数或计算方法兼容不同亮度环境下的固定模式噪声计算的原因是这些参数或计算方法表达的是传感器采集到的像素亮度值与目标像素亮度值之间的数学关系，而这样的数学关系无法准确计算不同场景下的固定噪声。中国专利申请号：CN202110622979.6公开了一种固定模式噪声动态补偿装置、方法和终端设备，该发明实施例公开了一种固定模式噪声动态补偿装置、方法和终端设备，固定模式噪声动态补偿装置包括补偿矩阵确定模块和动态补偿模块，补偿矩阵确定模块用于确定多个固定模式噪声补偿矩阵，动态补偿模块用于根据感光图像帧的像素均值从多个固定模式噪声补偿矩阵中确定感光图像帧的像素均值对应的固定模式噪声补偿矩阵以补偿感光图像帧。这种动态补偿方式，考虑到感光器件的各个像素点在不同感光状态下可能存在不同的固定模式噪声，因此，避免了不同感光状态下不同的固定模式噪声对光流法计算的影响。进而将经过补偿的感光图像帧用于光流法计算，可以避免固定模式噪声影响光流计算的准确性；由此可见，所述固定模式噪声动态补偿装置、方法和终端设备存在以下问题：对于亮度较低的环境计算出的固定模式噪声不正确导致竖条纹完全无法消除。发明内容为此，本发明提供一种固定模式噪音的计算与补偿方法，用以克服现有技术中对于亮度较低的环境计算出的固定模式噪声不正确导致竖条纹完全无法消除的问题。为实现上述目的，本发明提供一种固定模式噪音的计算与补偿方法，包括：步骤S1、自学习模块获取在全黑环境及均匀光源环境下的学习样本的图像数据，并根据所述图像数据生成映射关系；步骤S2、使用相机处理预设数量的测试样本，噪声消除模块根据所述测试样本的亮度对各测试样本的图像信息进行噪声补偿，中控模块在所述噪声补偿完成时控制检测模块检测各补偿后的所述图像信息中的竖纹密度以根据所述竖纹密度判定各图像信息的噪声补偿是否符合标准；步骤S3、所述中控模块在完成判定各图像信息的噪声补偿是否符合标准时，统计针对各图像数据的噪声补偿是否符合标准的判定结果以根据所述判定结果控制所述噪声消除模块重新进行自学习，并在自学习时将对应的学习参数调节至对应值。进一步地，对于所述步骤S1，包括：步骤S11、将相机置于全黑环境下并使其保持静止；步骤S12、在预设的暗场增益幅度中使用预设的增益步进值获取m个增益值，并在预设的曝光时长幅度下使用预设的曝光时长步进值获取n个曝光时长；针对第i个增益值gi，i＝1,2,3，...m，自学习模块分别与各所述曝光时长进行匹配以形成单个训练基准，在该训练基准下采集s张图像并取各图像的均值作为该训练基准下的暗场噪声图像数据，对于使用第i个增益值gi和第j个曝光时长ej形成的训练基准，j＝1,2,3，...，n，中控模块将在该基准下的暗场噪声图像数据记为Idarkij，所述自学习模块重复上述步骤以获取m×n个暗场图像数据；步骤S13、所述自学习模块通过使用所述暗场图像数据、所述增益以及所述曝光时间三个变量在三维空间的分布情况，使用t次曲面方程进行拟合以生成暗场噪声相对于增益g与曝光时间e的连续映射关系Idark＝f并将其记为暗部映射；步骤S14、所述自学习模块将相机置于均匀光源环境下并使其保持静止，重复所述步骤S2以获取m×n个原始图像数据，对于使用第i个增益值gi和第j个曝光时长ej形成的训练基准，中控模块将在该基准下的原始图像数据记为Iorgij，在该基准下的明场噪声图像数据记为Ilumij，设定Ilumij＝-Igoalij，其中，Igoalij为在该训练标准下的目标图像数据；步骤S15、所述自学习模块利用所述明场噪声图像、所述增益g以及所述曝光时间e三个变量在三维空间的分布情况进行t次曲面拟合以生成Ilum相对于增益g与曝光时间e的连续映射关系Ilum＝h并将其记为亮部映射。进一步地，在所述步骤S2中，所述中控模块完成对的单个所述测试样本的噪声补偿完成时控制检测模块依次检测各补偿后测试样本中图像信息中的竖纹密度P，并根据竖纹密度P判定针对该图像信息的噪声补偿是否合格的初步判定方式，其中：第一初步判定方式为所述中控模块判定所述图像信息的噪声补偿合格，并控制标记模块标记该图像的环境类型及合格判定结果；所述第一初步判定方式满足所述竖纹密度P小于等于第一预设竖纹密度P1；第二初步判定方式为所述中控模块判定所述图像信息的噪声补偿不合格，并根据该图像信息的亮度判定是否更换映射以重新对该图像信息进行噪声补偿处理；所述第二初步判定方式满足所述竖纹密度P大于第一预设竖纹密度P1且小于等于第二预设竖纹密度P2；第三初步判定方式为所述中控模块判定所述图像信息的噪声补偿不合格，并控制标记模块标记该图像的环境类型及合格判定结果；所述第三初步判定方式满足所述竖纹密度P大于第二预设竖纹密度P2；所述环境类型包括眀场和暗场，所述合格判定结果包括合格和不合格。进一步地，所述中控模块在所述第二初步判定方式下控制所述检测模块检测所述图像信息的亮度，并根据测得的亮度判定是否更换映射以重新对图像信息进行噪声补偿，其中：若所述图像信息中的亮度小于预设亮度且所述中控模块使用所暗部映射对该图像信息进行噪声补偿，或，所述图像信息中的亮度大于等于预设亮度且所述中控模块使用所述亮部映射对该图像信息进行噪声补偿，则所述中控模块不更换映射对该图像重新进行噪声补偿并判定所述图像信息的映射合格；若所述图像信息中的亮度小于预设亮度且所述中控模块使用所述亮部映射对该图像信息进行噪声补偿，或，所述图像信息中的亮度大于等于预设亮度且所述中控模块使用所述暗部映射对该图像信息进行噪声补偿，则所述中控模块更换映射对该图像重新进行噪声补偿。进一步地，所述中控模块在所述标记模块完成对全部图像信息的标记时，统计标记为不合格的图像信息的数量与测试样本总数比值，中控模块将该比值记为不合格比值，并根据不合格比值确定针对各映射方式的调节方式，其中:第一调节方式为所述中控模块判定所述映射合格，不对该映射进行调节；所述第一调节方式满足所述不合格比值小于等于第一预设不合格比值；第二调节方式为所述中控模块判定所述映射不合格，并分别计算亮场环境中亮部图像不合格数量与亮部图像总数的亮部比值Bl，以及，暗场环境中暗部图像不合格数量与暗部图像总数的暗部比值Bd，并根据Bl和Bd对对应的映射中的参数进行调节；所述第二调节方式满足所述不合格比值大于第一预设不合格比值且小于等于第二预设不合格比值；第三调节方式为所述中控模块判定所述映射不合格，并根据不合格比值B与所述第二预设不合格比值的差值将各映射中曝光时长的步进值和增益的步进值调节至对应值；所述第三调节方式满足所述不合格比值大于第二预设不合格比值。进一步地，所述中控模块在所述第二调节方式下分别计算亮场环境中亮部图像不合格数量与亮部图像总数的亮部比值Bl，以及，暗场环境中暗部图像不合格数量与暗部图像总数的暗部比值Bd，并根据Bl和Bd判定调节的映射类型的调节类型判定方式，其中：第一类型判定方式为所述中控模块判定对所述亮部映射中的参数进行调节；所述第一类型调节方式满足所述亮部比值Bl大于所述暗部比值Bd；第二类型判定方式为所述中控模块判定对所述暗部映射中的参数进行调节；所述第二类型调节方式满足所述亮部比值Bl小于等于所述暗部比值Bd。进一步地，所述中控模块在所述第三调节方式下根据不合格比值B与所述第二预设不合格比值的差值判定调节曝光时长的步进值和增益的步进值的步进值调节方式，其中：第一步进值调节方式为所述中控模块选用第一调节系数α1对步进值进行调节，设定调节后的步进值s’＝s0×α1，其中s0为调节前的初始步进值；所述第一步进值调节方式满足所述差值大于等于预设差值；第二步进值调节方式为所述中控模块选用第二调节系数α2对步进值进行调节，设定调节后的步进值s’＝s0×α2；所述第二步进值调节方式满足所述差值小于预设差值。进一步地，所述中控模块在完成对所述曝光时长的步进值调节时，根据调节后的步进值判定对曝光时长的幅度的幅度单向调节方式，其中：第一幅度单向调节方式为所述中控模块选用第一单向调节系数β1对所述曝光时长的幅度进行调节，设定调节后曝光时长的幅度为G’＝G0×β1，其中G0为调节前曝光时长的幅度；所述第一幅度单向调节方式满足调节后的步进值大于第一预设步进值；第二幅度单向调节方式为所述中控模块选用第二单向调节系数β2对所述曝光时长的幅度进行调节，设定调节后曝光时长的幅度为G’＝G0×β2；所述第二幅度单向调节方式满足调节后的步进值小于等于第一预设步进值。进一步地，所述中控模块在完成对所述增益的步进值调节时，根据调节后的步进值判定对增益的幅度的幅度双向调节方式，其中：第一幅度双向调节方式为所述中控模块选用第一双向调节系数γ1对所述增益的幅度进行调节，设定调节后增益的幅度为E’＝E0×γ1，其中E0为调节前增益的幅度；所述第一幅度单向调节方式满足调节后的步进值大于第二预设步进值；第二幅度双向调节方式为所述中控模块选用第二双向调节系数γ2对所述增益的幅度进行调节，设定调节后增益的幅度为E’＝E0×γ1，其中E0为调节前增益的幅度；所述第一幅度双向调节方式满足调节后的步进值大于第二预设步进值。进一步地，所述中控模块在判定需对曝光时长和增益的幅度调节时，将所述亮部图像不合格数量与测试样本的总数的比值或所述暗部图像不合格数量与测试样本的总数的比值记为单部不合格比值并根据单部不合格比值判定对调节后的幅度进行修正的修正方式，其中：第一修正方式为所述中控模块选用第一修正系数a1对调节系数进行修正，设定修正后的第i单向调节系数βi’＝βi×a1，其中βi为修正前第i单向调节系数，修正后的第i双向调节系数γi’＝γi×a1，其中γi为修正前第i双向调节系数；所述第一修正方式满足所述单部不合格比值大于等于预设单部不合格比值；第二修正方式为所述中控模块选用第二修正系数a2对调节系数进行修正，设定修正后的第i单向调节系数βi’＝βi×a2，修正后的第i双向调节系数γi’＝γi×a2；所述第二修正方式满足所述单部不合格比值小于预设单部不合格比值。与现有技术相比，本发明的有益效果在于，本发明中中控模块根据测得的竖纹密度初步判定图像信息的噪声补偿是否符合标准，提高了对噪声补偿效果的控制精度，并在初步判定图像信息的噪声补偿不合格时根据该图像信息的亮度判定是否更换映射以重新对该图像信息进行噪声补偿处理，或，控制标记模块标记该图像的环境类型及合格判定结果，通过图像信息的亮度判定映射是否合格，提高了对映射的控制精度，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，提高了相机图像处理的效率；本发明中所述中控模块统计标记为不合格的图像信息的数量以根据该数量对曝光时长和增益的步进值调节以对映射进行调节，进一步提高了对映射的控制精度，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，进一步提高了相机图像处理的效率。进一步地，本发明通过自学习模块将相机置于全黑环境或均匀光源环境下获取原始图像数据，并根据所述图像数据、增益以及曝光时间获取映射关系，本发明通过图像数据、增益、曝光时间进一步提高了对映射的控制精度，实现了对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹。进一步地，本发明根据所述图像信息中的竖纹密度判定针对该图像信息的噪声补偿是否合格，提高了对噪声补偿效果的控制精度，并在判定所述图像信息的噪声补偿合格时控制标记模块标记该图像的环境类型及合格判定结果，提高了处理下一图像过程的效率。进一步地，本发明根据图像信息的亮度判定是否更换映射以重新对图像信息进行噪声补偿，提高了对图像信息的控制精度，并在判定映射不符合标准时，更换对应环境下的映射对该图像重新进行噪声补偿，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，进一步提高了相机图像处理的效率。进一步地，本发明通过标记为不合格的图像信息的数量与测试样本总数比值判定对各映射的调节方式，提高了对各亮度环境下噪声补偿效果的控制精度，并在判定所述映射不合格时根据亮部比值和暗部比值对对应的映射中的参数进行调节，或，根据不合格比值与所述第二预设不合格比值的差值将各映射中曝光时长的步进值和增益的步进值调节至对应值，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，进一步提高了相机图像处理的效率。进一步地，本发明根据亮部图像不合格数量与亮部图像总数的所述亮部比值、暗场环境中暗部图像不合格数量与暗部图像总数的所述暗部比值判定调节的映射的类型，进一步提高了对映射的控制精度，并根据亮部比值与暗部比值的比对结果对所述亮部映射中的参数进行调节，实现了对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹。进一步地，本发明根据不合格比值与所述第二预设不合格比值的差值判定调节曝光时长的步进值和增益的步进值的步进值调节方式，提高了对曝光时长和增益的步进值的控制精度，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，进一步提高了相机图像处理的效率。进一步地，本发明根据调节后的步进值选用对应的单向调节系数对曝光时长的幅度的幅度进行单向调节，提高了对曝光时长的幅度的控制精度，实现了对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹。进一步地，本发明根据调节后的步进值选用对应的双向调节系数对增益的幅度进行双向调节，提高了对增益的幅度的控制精度，实现了对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹。进一步地，本发明通过单部不合格比值对调节后的幅度进行修正，提高了对幅度的控制精度，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，进一步提高了相机图像处理的效率。附图说明图1为本发明所述固定模式噪音的计算与补偿方法的流程图；图2为本发明针对所述步骤S1的流程图；图3为本发明针对所述竖纹密度判定图像信息的噪声补偿是否合格的初步判定方式的流程图；图4为本发明针对各映射方式的调节方式的流程图。具体实施方式为了使本发明的目的和优点更加清楚明白，下面结合实施例对本发明作进一步描述；应当理解，此处所描述的具体实施例仅仅用于解释本发明，并不用于限定本发明。下面参照附图来描述本发明的优选实施方式。本领域技术人员应当理解的是，这些实施方式仅仅用于解释本发明的技术原理，并非在限制本发明的保护范围。需要说明的是，在本发明的描述中，术语“上”、“下”、“左”、“右”、“内”、“外”等指示的方向或位置关系的术语是基于附图所示的方向或位置关系，这仅仅是为了便于描述，而不是指示或暗示所述装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本发明的限制。此外，还需要说明的是，在本发明的描述中，除非另有明确的规定和限定，术语“安装”、“相连”、“连接”应做广义理解，例如，可以是固定连接，也可以是可拆卸连接，或一体地连接；可以是机械连接，也可以是电连接；可以是直接相连，也可以通过中间媒介间接相连，可以是两个元件内部的连通。对于本领域技术人员而言，可根据具体情况理解上述术语在本发明中的具体含义。请参阅图1所示，其为本发明实施例固定模式噪音的计算与补偿方法的流程图。本发明实施例固定模式噪音的计算与补偿方法，包括：步骤S1、自学习模块获取在全黑环境及均匀光源环境下的学习样本的图像数据，并根据所述图像数据生成映射关系；步骤S2、使用相机处理预设数量的测试样本，噪声消除模块根据所述测试样本的亮度对各测试样本的图像信息进行噪声补偿，中控模块在所述噪声补偿完成时控制检测模块检测各补偿后的所述图像信息中的竖纹密度以根据所述竖纹密度判定各图像信息的噪声补偿是否符合标准；步骤S3、所述中控模块在完成判定各图像信息的噪声补偿是否符合标准时，统计针对各图像数据的噪声补偿是否符合标准的判定结果以根据所述判定结果控制所述噪声消除模块重新进行自学习，并在自学习时将对应的学习参数调节至对应值。本发明中中控模块根据测得的竖纹密度初步判定图像信息的噪声补偿是否符合标准，提高了对噪声补偿效果的控制精度，并在初步判定图像信息的噪声补偿不合格时根据该图像信息的亮度判定是否更换映射以重新对该图像信息进行噪声补偿处理，或，控制标记模块标记该图像的环境类型及合格判定结果，通过图像信息的亮度判定映射是否合格，提高了对映射的控制精度，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，提高了相机图像处理的效率；本发明中所述中控模块统计标记为不合格的图像信息的数量以根据该数量对曝光时长和增益的步进值调节以对映射进行调节，进一步提高了对映射的控制精度，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，进一步提高了相机图像处理的效率。请参阅图2所示，其为本发明针对所述步骤S1的流程图。具体而言，对于所述步骤S1，包括：步骤S11、将相机置于全黑环境下并使其保持静止；步骤S12、在预设的暗场增益幅度中使用预设的增益步进值获取m个增益值，并在预设的曝光时长幅度下使用预设的曝光时长步进值获取n个曝光时长；针对第i个增益值gi，i＝1,2,3，...m，自学习模块分别与各所述曝光时长进行匹配以形成单个训练基准，在该训练基准下采集s张图像并取各图像的均值作为该训练基准下的暗场噪声图像数据，对于使用第i个增益值gi和第j个曝光时长ej形成的训练基准，j＝1,2,3，...，n，中控模块将在该基准下的暗场噪声图像数据记为Idarkij，所述自学习模块重复上述步骤以获取m×n个暗场图像数据；步骤S13、所述自学习模块通过使用所述暗场图像数据、所述增益以及所述曝光时间三个变量在三维空间的分布情况，使用t次曲面方程进行拟合以生成暗场噪声相对于增益g与曝光时间e的连续映射关系Idark＝f并将其记为暗部映射；步骤S14、所述自学习模块将相机置于均匀光源环境下并使其保持静止，重复所述步骤S2以获取m×n个原始图像数据，对于使用第i个增益值gi和第j个曝光时长ej形成的训练基准，中控模块将在该基准下的原始图像数据记为Iorgij，在该基准下的明场噪声图像数据记为Ilumij，设定Ilumij＝-Igoalij，其中，Igoalij为在该训练标准下的目标图像数据；步骤S15、所述自学习模块利用所述明场噪声图像、所述增益g以及所述曝光时间e三个变量在三维空间的分布情况进行t次曲面拟合以生成Ilum相对于增益g与曝光时间e的连续映射关系Ilum＝h并将其记为亮部映射。本发明通过自学习模块将相机置于全黑环境或均匀光源环境下获取原始图像数据，并根据所述图像数据、增益以及曝光时间获取映射关系，本发明通过图像数据、增益、曝光时间进一步提高了对映射的控制精度，实现了对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹。请参阅图3所示，其为本发明针对所述竖纹密度判定图像信息的噪声补偿是否合格的初步判定方式的流程图。具体而言，在所述步骤S2中，所述中控模块完成对的单个所述测试样本的噪声补偿完成时控制检测模块依次检测各补偿后测试样本中图像信息中的竖纹密度P，并根据竖纹密度P判定针对该图像信息的噪声补偿是否合格的初步判定方式，其中：第一初步判定方式为所述中控模块判定所述图像信息的噪声补偿合格，并控制标记模块标记该图像的环境类型及合格判定结果；所述第一初步判定方式满足所述竖纹密度P小于等于第一预设竖纹密度P1；第二初步判定方式为所述中控模块判定所述图像信息的噪声补偿不合格，并根据该图像信息的亮度判定是否更换映射以重新对该图像信息进行噪声补偿处理；所述第二初步判定方式满足所述竖纹密度P大于第一预设竖纹密度P1且小于等于第二预设竖纹密度P2；第三初步判定方式为所述中控模块判定所述图像信息的噪声补偿不合格，并控制标记模块标记该图像的环境类型及合格判定结果；所述第三初步判定方式满足所述竖纹密度P大于第二预设竖纹密度P2；所述环境类型包括眀场和暗场，所述合格判定结果包括合格和不合格。本发明实施例中第一预设竖纹密度为3条/张，第二预设竖纹密度为5条/张。本发明根据所述图像信息中的竖纹密度判定针对该图像信息的噪声补偿是否合格，提高了对噪声补偿效果的控制精度，并在判定所述图像信息的噪声补偿合格时控制标记模块标记该图像的环境类型及合格判定结果，提高了处理下一图像过程的效率。具体而言，所述中控模块在所述第二初步判定方式下控制所述检测模块检测所述图像信息的亮度，并根据测得的亮度判定是否更换映射以重新对图像信息进行噪声补偿，其中：若所述图像信息中的亮度小于预设亮度且所述中控模块使用所暗部映射对该图像信息进行噪声补偿，或，所述图像信息中的亮度大于等于预设亮度且所述中控模块使用所述亮部映射对该图像信息进行噪声补偿，则所述中控模块不更换映射对该图像重新进行噪声补偿并判定所述图像信息的映射合格；若所述图像信息中的亮度小于预设亮度且所述中控模块使用所述亮部映射对该图像信息进行噪声补偿，或，所述图像信息中的亮度大于等于预设亮度且所述中控模块使用所述暗部映射对该图像信息进行噪声补偿，则所述中控模块更换映射对该图像重新进行噪声补偿并检测其补偿效果。本发明实施例中预设亮度为像素点为1个分量。本发明根据图像信息的亮度判定是否更换映射以重新对图像信息进行噪声补偿，提高了对图像信息的控制精度，并在判定映射不符合标准时，更换对应环境下的映射对该图像重新进行噪声补偿，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，进一步提高了相机图像处理的效率。请参阅图4所示，其为本发明针对各映射方式的调节方式的流程图。具体而言，所述中控模块在所述标记模块完成对全部图像信息的标记时，统计标记为不合格的图像信息的数量与测试样本总数比值，中控模块将该比值记为不合格比值，并根据不合格比值确定针对各映射方式的调节方式，其中:第一调节方式为所述中控模块判定所述映射合格，不对该映射进行调节；所述第一调节方式满足所述不合格比值小于等于第一预设不合格比值；第二调节方式为所述中控模块判定所述映射不合格，并分别计算亮场环境中亮部图像不合格数量与亮部图像总数的亮部比值Bl，以及，暗场环境中暗部图像不合格数量与暗部图像总数的暗部比值Bd，并根据Bl和Bd对对应的映射中的参数进行调节；所述第二调节方式满足所述不合格比值大于第一预设不合格比值且小于等于第二预设不合格比值；第三调节方式为所述中控模块判定所述映射不合格，并根据不合格比值B与所述第二预设不合格比值的差值将各映射中曝光时长的步进值和增益的步进值调节至对应值；所述第三调节方式满足所述不合格比值大于第二预设不合格比值。本发明实施例中第一预设不合格比值为0.9，第二预设不合格比值为0.7。本发明通过标记为不合格的图像信息的数量与测试样本总数比值判定对各映射的调节方式，提高了对各亮度环境下噪声补偿效果的控制精度，并在判定所述映射不合格时根据亮部比值和暗部比值对对应的映射中的参数进行调节，或，根据不合格比值与所述第二预设不合格比值的差值将各映射中曝光时长的步进值和增益的步进值调节至对应值，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，进一步提高了相机图像处理的效率。具体而言，所述中控模块在所述第二调节方式下分别计算亮场环境中亮部图像不合格数量与亮部图像总数的亮部比值Bl，以及，暗场环境中暗部图像不合格数量与暗部图像总数的暗部比值Bd，并根据Bl和Bd判定调节的映射类型的调节类型判定方式，其中：第一类型判定方式为所述中控模块判定对所述亮部映射中的参数进行调节；所述第一类型调节方式满足所述亮部比值Bl大于所述暗部比值Bd；第二类型判定方式为所述中控模块判定对所述暗部映射中的参数进行调节；所述第二类型调节方式满足所述亮部比值Bl小于等于所述暗部比值Bd。本发明根据亮部图像不合格数量与亮部图像总数的所述亮部比值、暗场环境中暗部图像不合格数量与暗部图像总数的所述暗部比值判定调节的映射的类型，进一步提高了对映射的控制精度，并根据亮部比值与暗部比值的比对结果对所述亮部映射中的参数进行调节，实现了对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹。具体而言，所述中控模块在所述第三调节方式下根据不合格比值B与所述第二预设不合格比值的差值判定调节曝光时长的步进值和增益的步进值的步进值调节方式，其中：第一步进值调节方式为所述中控模块选用第一调节系数α1对步进值进行调节，设定调节后的步进值s’＝s0×α1，其中s0为调节前的初始步进值；所述第一步进值调节方式满足所述差值大于等于预设差值；第二步进值调节方式为所述中控模块选用第二调节系数α2对步进值进行调节，设定调节后的步进值s’＝s0×α2；所述第二步进值调节方式满足所述差值小于预设差值。本发明实施例中α1为0.7，α2为0.75，预设差值为0.2。本发明根据不合格比值与所述第二预设不合格比值的差值判定调节曝光时长的步进值和增益的步进值的步进值调节方式，提高了对曝光时长和增益的步进值的控制精度，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，进一步提高了相机图像处理的效率。具体而言，所述中控模块在完成对所述曝光时长的步进值调节时，根据调节后的步进值判定对曝光时长的幅度的幅度单向调节方式，其中：第一幅度单向调节方式为所述中控模块选用第一单向调节系数β1对所述曝光时长的幅度进行调节，设定调节后曝光时长的幅度为G’＝G0×β1，其中G0为调节前曝光时长的幅度；所述第一幅度单向调节方式满足调节后的步进值大于第一预设步进值；第二幅度单向调节方式为所述中控模块选用第二单向调节系数β2对所述曝光时长的幅度进行调节，设定调节后曝光时长的幅度为G’＝G0×β2；所述第二幅度单向调节方式满足调节后的步进值小于等于第一预设步进值。本发明实施例中G’为调节后曝光时长幅度，G0为调节前曝光时长幅度，对于调节前曝光时长幅度G0，设定G0＝Gb-Ga，其中Gb为调节前的曝光时长最大值，Ga为调节前的曝光时长最小值，G’＝Gb’-Ga’，调节前的曝光时长最小值Ga与调节后曝光时长最小值Ga’的差值满足：△Ga＝/2，△Gb＝/2，其中曝光时长最小值不变。本发明实施例中β1为1.2，β2为1.3，第一预设步进值为0.4。本发明根据调节后的步进值选用对应的单向调节系数对曝光时长的幅度的幅度进行单向调节，提高了对曝光时长的幅度的控制精度，实现了对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹。具体而言，所述中控模块在完成对所述增益的步进值调节时，根据调节后的步进值判定对增益的幅度的幅度双向调节方式，其中：第一幅度双向调节方式为所述中控模块选用第一双向调节系数γ1对所述增益的幅度进行调节，设定调节后增益的幅度为E’＝E0×γ1，其中E0为调节前增益的幅度；所述第一幅度单向调节方式满足调节后的步进值大于第二预设步进值；第二幅度双向调节方式为所述中控模块选用第二双向调节系数γ2对所述增益的幅度进行调节，设定调节后增益的幅度为E’＝E0×γ1，其中E0为调节前增益的幅度；所述第一幅度双向调节方式满足调节后的步进值大于第二预设步进值。本发明实施例中E’为调节后增益幅度，E0为调节前增益幅度，对于调节前增益幅度E0，设定E0＝Eb-Ea，其中Eb为调节前的增益最大值，Ea为调节前的增益最小值，E’＝Eb’-Ea’，调节前的增益最小值Ea与调节后增益最小值Ea’的差值满足：△Ea＝/2，△Eb＝/2。本发明实施例中γ1为1.25，γ2为1.35，第二预设步进值为0.3。本发明根据调节后的步进值选用对应的双向调节系数对增益的幅度进行双向调节，提高了对增益的幅度的控制精度，实现了对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹。具体而言，所述中控模块在判定需对曝光时长和增益的幅度调节时，将所述亮部图像不合格数量与测试样本的总数的比值或所述暗部图像不合格数量与测试样本的总数的比值记为单部不合格比值并根据单部不合格比值判定对调节后的幅度进行修正的修正方式，其中：第一修正方式为所述中控模块选用第一修正系数a1对调节系数进行修正，设定修正后的第i单向调节系数βi’＝βi×a1，其中βi为修正前第i单向调节系数，修正后的第i双向调节系数γi’＝γi×a1，其中γi为修正前第i双向调节系数；所述第一修正方式满足所述单部不合格比值大于等于预设单部不合格比值；第二修正方式为所述中控模块选用第二修正系数a2对调节系数进行修正，设定修正后的第i单向调节系数βi’＝βi×a2，修正后的第i双向调节系数γi’＝γi×a2；所述第二修正方式满足所述单部不合格比值小于预设单部不合格比值。本发明实施例中a1为1.05，a2为1.07，预设单部不合格比值为0.8。本发明通过单部不合格比值对调节后的幅度进行修正，提高了对幅度的控制精度，在保证对于亮度较低的环境计算出的固定模式噪声可以完全消除竖条纹的同时，进一步提高了相机图像处理的效率。至此，已经结合附图所示的优选实施方式描述了本发明的技术方案，但是，本领域技术人员容易理解的是，本发明的保护范围显然不局限于这些具体实施方式。在不偏离本发明的原理的前提下，本领域技术人员可以对相关技术特征做出等同的更改或替换，这些更改或替换之后的技术方案都将落入本发明的保护范围之内。以上所述仅为本发明的优选实施例，并不用于限制本发明；对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
