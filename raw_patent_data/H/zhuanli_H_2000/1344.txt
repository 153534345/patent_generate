标题title
一种三相双向谐振变换器的驱动控制方法
摘要abst
本发明公开了一种三相双向谐振变换器的驱动控制方法，利用STM32单片机的一个高级定时器生成六路PWM驱动信号；通过配置死区时间，实现线性升占空比软启动控制；利用高级定时器的中央对齐模式3功能，在高级定时器计数器的0点和自动重载值ARR点更新比较寄存器值，实现了三相PWM驱动50％占空比输出，并精准保证三相PWM驱动相位角依次相差120度；通过控制死区时间线性下降，改变高级定时器死区时间参数，实现线性升占空比软启动控制。
权利要求书clms
1.一种三相双向谐振变换器的驱动控制方法，所述的三相双向谐振变换器包括STM32单片机，所述的三相双向谐振变换器的电路结构包括：A相桥臂为PA1和PA2，B相桥臂为PB1和PB2，C相桥臂为PC1和PC2；A相桥臂PA1的驱动信号为PWMA1，A相桥臂PA2驱动信号为PWMA2，B相桥臂PB1的驱动信号为PWMB1，B相桥臂PB2的驱动信号为PWMB2，C相桥臂PC1的驱动信号为PWMC1，C相桥臂PC2的驱动信号为PWMC2驱动信号；其特征在于：利用高级定时器的中央对齐模式3功能，在高级定时器计数器的0点和自动重载值ARR点更新比较寄存器值，实现三相PWM驱动50％占空比输出，并保证驱动信号PWMA1与PWMB1、PWMB1与PWMC1、PWMC1与PWMA1之间相位角均相差120度；利用高级定时器的通道1、通道2和通道3的互补功能，实现PWMA1互补生成PWMA2，PWMB1互补生成PWMB2，PWMC1互补生成PWMC2。2.根据权利要求1所述的一种三相双向谐振变换器的驱动控制方法，其特征在于，利用STM32单片机的高级定时器生成互补的PWM驱动信号，自带死区配置功能，通过配置死区时间，实现线性升占空比软启动控制；软启动阶段，初始化高级定时器的死区时间设置为最大死区时间，使起始周期PWM驱动信号保持为低电平，然后死区时间呈线性减小，PWM驱动信号占空比呈线性上升，直到软启动阶段结束，死区时间到达最小值，此时PWM驱动信号到达占空比最大值，到达正常工作状态，完成线性升占空比软启动控制；最大死区时间是指：当六路PWM驱动信号在每个周期内输出均为低，即占空比为0时，到达最大死区时间。3.根据权利要求2所述的一种三相双向谐振变换器的驱动控制方法，其特征在于，驱动控制方法具体包括如下步骤：步骤1、通过STM32单片机的中央对齐模式3，设定自动重载值ARR，构造三相双向谐振变换器所需频率的三角载波，三角载波的初始角度为0度；步骤2、初始化设定STM32单片机的高级定时器的通道1的比较寄存器值为ARR/2，通道2的比较寄存器值为ARR/6，通道3的比较寄存器值为/6；步骤3、设定死区时间DT，设定高级定时器生成PWM极性：通道1极性OC1＝0，即通道1的比较寄存器值小于载波值，PWM为高；通道2极性OC2＝1，通道3极性OC3＝1，即通道2的比较寄存器值和通道3的比较寄存器值大于载波值，PWM为高；步骤4、使能高级定时器的通道1、通道2和通道3的互补输入功能，通道1实现A相桥臂的PA1与PA2的PWM驱动信号互补，通道2实现B相桥臂的PB1与PB2的PWM驱动信号互补，通道3实现C相桥臂的PC1与PC2的PWM驱动信号互补；步骤5、配置完成，开始生成六路PWM驱动信号；步骤6、高级定时器的计数器等于自动重载值ARR时，触发更新事件，通道1的比较寄存器值不变，为ARR/2，通道2和通道3的比较寄存器值进行重新赋值，通道2的比较寄存器值为/6，通道3的比较寄存器值为ARR/6，实现50％占空比的PWM驱动输出；步骤7、高级定时器的计数器等于0时，触发更新事件，通道1的比较寄存器值不变，为ARR/2，通道2和通道3的比较寄存器值进行重新赋值，通道2的比较寄存器值为ARR/6，通道3的比较寄存器值为/6；步骤8、上述步骤6和7循环进行，实现50％占空比的PWM驱动输出，同时实现控制三相PWM驱动相位差保持120度。
说明书desc
技术领域本发明属于嵌入式控制技术领域，具体涉及一种三相双向谐振变换器的驱动控制方法。背景技术STM32单片机是三相双向谐振变换器的核心控制部件，具体是指以STM32系列处理器为控制核心的单片机，本发明研究的是基于STM32单片机控制的驱动控制方法的实现，不具体到单个型号的处理器，例如可以是STM32f103或STM32f407处理器。基于STM32单片机控制的三相双向谐振变换器中的大功率模组，作为中间级的隔离DC/DC变换器应用于AC/AC电源中。采用谐振技术实现软开关，可以减小开关损耗，提高工作频率以及功率密度。大功率模组采用固定开关频率控制方式，同一桥臂两个IGBT互补，各自导通约50％。三相桥臂对应IGBT驱动信号相移120度，原边和副边对应的IGBT为同一驱动信号控制。三相双向谐振变换器在启动时需进行软启动操作，若启动时刻的PWM驱动波形占空比50％，则母线电流过大，开关管出现电流尖峰，导致器件损坏，采用线性升占空比软启动控制方法则能使启动电流缓慢上升，并最终降低到工作电流状态，保护器件。由于STM32单片机中没有专用的三相双向谐振变换器的PWM驱动模块，无法实现三相PWM驱动的标准化输出。如果使用三个定时器分别输出三相PWM驱动信号，则这种方法在运行过程中无法精准保持三相PWM驱动信号的相位差为120度，随着相位差的偏移，此控制方法具有极大的不稳定性，甚至会造成开关管的短路，最终烧坏机器。据了解，目前还没有基于STM32单片机的三相双向谐振变换器的驱动控制方法。发明内容三相双向谐振变换器的驱动控制方法要求为：六路PWM周期相同，且A相桥臂的PA1与PA2的PWM驱动信号互补，B相桥臂的PB1与PB2的PWM驱动信号互补，C相桥臂的PC1与PC2的PWM驱动信号互补；每相间PWM驱动信号相位差为120度，即A相桥臂PA1的PWM信号与B相桥臂PB1的PWM信号相位差为120度，B相桥臂PB1的PWM信号与C相桥臂PC1的PWM信号相位差为120度。为了解决以上技术问题，本发明提出了一种三相双向谐振变换器的驱动控制方法，实现了精准的三相六路双极性PWM波形输出，在运行过程中保持三相间PWM驱动稳定相差120度，同相输出两路PWM互补，并可作为以STM32单片机输出控制三相双向谐振变换器的标准化程序。本发明所采用的技术方案如下：一种三相双向谐振变换器的驱动控制方法，所述的三相双向谐振变换器包括STM32单片机，所述的三相双向谐振变换器的电路结构包括：A相桥臂为PA1和PA2，B相桥臂为PB1和PB2，C相桥臂为PC1和PC2；A相桥臂PA1的驱动信号为PWMA1，A相桥臂PA2驱动信号为PWMA2，B相桥臂PB1的驱动信号为PWMB1，B相桥臂PB2的驱动信号为PWMB2，C相桥臂PC1的驱动信号为PWMC1，C相桥臂PC2的驱动信号为PWMC2驱动信号；利用高级定时器的中央对齐模式3功能，在高级定时器计数器的0点和自动重载值ARR点更新比较寄存器值，实现三相PWM驱动50％占空比输出，并保证驱动信号PWMA1与PWMB1、PWMB1与PWMC1、PWMC1与PWMA1之间相位角均相差120度；利用高级定时器的通道1、通道2和通道3的互补功能，实现PWMA1互补生成PWMA2，PWMB1互补生成PWMB2，PWMC1互补生成PWMC2。优选的，利用STM32单片机的高级定时器生成互补的PWM驱动信号，自带死区配置功能，通过配置死区时间，实现线性升占空比软启动控制；软启动阶段，初始化高级定时器的死区时间设置为最大死区时间，使起始周期PWM驱动信号保持为低电平，然后死区时间呈线性减小，PWM驱动信号占空比呈线性上升，直到软启动阶段结束，死区时间到达最小值，此时PWM驱动信号到达占空比最大值，到达正常工作状态，完成线性升占空比软启动控制；最大死区时间是指：当六路PWM驱动信号在每个周期内输出均为低，即占空比为0时，到达最大死区时间。优选的，驱动控制方法具体包括如下步骤：步骤1、通过STM32单片机的中央对齐模式3，设定自动重载值ARR，构造三相双向谐振变换器所需频率的三角载波，三角载波的初始角度为0度；步骤2、初始化设定STM32单片机的高级定时器的通道1的比较寄存器值为ARR/2，通道2的比较寄存器值为ARR/6，通道3的比较寄存器值为/6；步骤3、设定死区时间DT，设定高级定时器生成PWM极性：通道1极性OC1＝0，即通道1的比较寄存器值小于载波值，PWM为高；通道2极性OC2＝1，通道3极性OC3＝1，即通道2的比较寄存器值和通道3的比较寄存器值大于载波值，PWM为高；步骤4、使能高级定时器的通道1、通道2和通道3的互补输入功能，通道1实现A相桥臂的PA1与PA2的PWM驱动信号互补，通道2实现B相桥臂的PB1与PB2的PWM驱动信号互补，通道3实现C相桥臂的PC1与PC2的PWM驱动信号互补；步骤5、配置完成，开始生成六路PWM驱动信号；步骤6、高级定时器的计数器等于自动重载值ARR时，触发更新事件，通道1的比较寄存器值不变，为ARR/2，通道2和通道3的比较寄存器值进行重新赋值，通道2的比较寄存器值为/6，通道3的比较寄存器值为ARR/6，实现50％占空比的PWM驱动输出；步骤7、高级定时器的计数器等于0时，触发更新事件，通道1的比较寄存器值不变，为ARR/2，通道2和通道3的比较寄存器值进行重新赋值，通道2的比较寄存器值为ARR/6，通道3的比较寄存器值为/6；步骤8、上述步骤6和7循环进行，实现50％占空比的PWM驱动输出，同时实现控制三相PWM驱动相位差保持120度。本发明的优点在于：本发明精确保证三相PWM驱动的相位差为120度，使用一个高级定时器生成三相PWM驱动，避免了使用多个定时器的相位同步问题，通过线性升占空比软启动控制提高了控制系统的稳定性。本发明实现了三相双向谐振变换器的软启动控制，利用高级定时器的死区功能，通过线性更新死区时间配置，实现了线性升占空比软启动控制。本发明附加的方面和优点将在下面的描述中部分给出，部分将从下面的描述中变得明显，或通过本发明的实践了解到。附图说明图1是本发明实施例的三相双向谐振变换器的拓扑电路结构示意图；图2是本发明实施例的线性升占空比软启动A相PWM驱动生成时序图；图3是本发明实施例的正常工作状态的PWM时序图。具体实施方式下面将结合附图对本发明的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明的一部分实施例，而不是全部的实施例。如图1所示，是本发明实施例的三相双向谐振变换器的拓扑电路结构示意图。图1中的拓扑电路结构是现有已知技术，本发明实施例是针对这一拓扑电路结构提出的基于STM32单片机的驱动控制方法。图1中，D1-D6为原边的开关管，D1’-D6’为副边的开关管，原边Cdc1为原边的母线电容，副边Cdc2为副边的母线电容，Lr为谐振电感，Lm为变压器原边感值，Cr为谐振电容，n:1代表变压器的变比。A相驱动信号为PWMA1和PWMA2，两信号互补且占空比均约为50％；B相驱动信号为PWMB1和PWMB2，两信号互补且占空比均约为50％；C相驱动信号为PWMC1和PWMC2，两信号互补且占空比均约为50％；如图3所示，其中A相驱动信号PWMA1与B相驱动信号PWMB1相位差为120度，B相驱动信号PWMB1与C相驱动信号PWMC1相位差为120度，原边和副边对应的IGBT为同一驱动信号控制。利用高级定时器生成取反的两路PWM自带死区配置功能，通过配置死区时间，实现线性升占空比软启动控制，满足了双向谐振变换器对于软启动的要求，在软启动阶段，初始化高级定时器TIM1的死区时间设置为最大死区时间，使起始周期PWM驱动信号保持为低电平，即PWMA1、PWMA2、PWMB1、PWMB2、PWMC1和PWMC2都保持为低，然后死区时间呈线性减小，PWM驱动信号占空比呈线性上升，直到软启动阶段结束，死区到达最小值，此时PWM驱动信号到达占空比最大值，到达了正常工作状态；正常工作状态时，死区保持不变，由于死区的存在，每个PWM驱动信号均约为50％，占空比保持不变，完成线性升占空比软启动控制。本发明选用一个高级定时器TIM1或TIM8就可完成六路PWM驱动信号的输出，下面以高级定时器TIM1为例，进行驱动控制步骤详细说明：S1：高级定时器TIM1，时钟频率为168Mhz，也可以根据三相双向谐振变换器的谐振频率选用合适的时钟频率。通过STM32单片机的中央对齐模式3，设定变量自动重载值ARR，通过STM32单片机的中央对齐模式3构造三相双向谐振变换器所需频率的三角载波，三角载波初始角度为0度。自动重载值ARR的值可根据计数时钟频率的不同计算给定，初始化时设定，工作过程中不需改变。S2：初始化设定高级定时器TIM1的通道1的比较寄存器值为ARR/2，如图3中A点，通道2的比较寄存器值为ARR/6，如图3中E点，通道3的比较定时器为/6，如图3中G点。S3：设定高级定时器TIM1生成PWM极性：通道1极性OC1＝0，如图3所示通道1的比较寄存器值介于AB两点之间，即比较寄存器值小于载波值，PWM为高；通道2极性OC2＝1，通道3极性OC3＝1，如图3所示通道2的比较寄存器值在DE两点之间，通道3的比较寄存器值在GH两点之间，即比较寄存器值大于载波值，PWM为高。OC1、OC2和OC3的含义分别是：通道1的比较寄存器值、通道2的比较寄存器值和通道3的比较寄存器值。S4：如图3所示，使能高级定时器TIM1的通道1、通道2和通道3的互补输入功能，通道1实现A相桥臂的PA1与PA2的PWM驱动信号互补，通道2实现B相桥臂的PB1与PB2的PWM驱动信号互补，通道3实现C相桥臂的PC1与PC2的PWM驱动信号互补。S5：配置死区时间为最大死区时间，进入软启动阶段。S6：配置完成，开始生成六路PWM驱动信号。S7：如图3所示，高级定时器TIM1的计数器等于自动重载值ARR时，触发更新事件，通道1的比较寄存器值不变，为ARR/2，通道2、通道3的比较寄存器值进行重新赋值，通道2的比较寄存器值为/6，在图3的F点位置，通道3的比较寄存器值为ARR/6，如图3的H点位置，实现了50％占空比的PWM驱动输出。S8：如图3所示，高级定时器TIM1的计数器等于0时，触发更新事件，通道1的比较寄存器值不变，为ARR/2，通道2、通道3的比较寄存器值进行重新赋值，通道2的比较寄存器值为ARR/6，通道3的比较寄存器值为/6。S9：如图3所示，上述步骤7和8循环进行，实现了50％占空比的PWM驱动输出，同时实现了精准控制三相PWM驱动相位差保持120度。S10：如图2所示，在软启动阶段，配置死区时间呈线性减小，如图2所示，PWM驱动信号呈线性增大。S11：直到软启动阶段结束，进入正常工作阶段，配置死区时间为最小死区时间并保持不变，此时PWM驱动信号到达占空比最大值，到达了正常工作状态，完成线性升占空比软启动控制。STM32处理器中均设置有通用定时器、高级定时器和基本定时器共三种定时器，其中，高级定时器有两个，名称分别是TIM1和TIM8，TIM1和TIM8均可以实现本发明，通道和中央对齐模块均为描述高级定时器固有特性的专用技术名词，本发明中的上述技术名词，均为其在STM32处理器领域的标准技术含义，其技术含义均是清楚的。高级定时器的中央对齐模式有三种，分别为中央对齐模式1、中央对齐模式2和中央对齐模式3，本发明实施例必须使用中央对齐模式3才能实现。本发明实施例中，未详细描述的技术特征均为现有技术或者常规技术手段，在此不再赘述。最后需要说明的是：以上实施例，仅为本发明的具体实施方式，用以说明本发明的技术方案，而非对其限制，本发明的保护范围并不局限于此。本领域技术人员应该理解：任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，其可以对前述实施例所记载的技术方案进行修改或可轻易想到变化，或者对其中部分技术特征进行等同替换；而这些修改、变化或者替换，并不使相应技术方案的本质脱离本发明实施例技术方案的精神和范围，都应涵盖在本发明的保护范围之内。
