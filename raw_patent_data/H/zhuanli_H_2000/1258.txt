标题title
电子设备及其通话处理方法
摘要abst
本申请涉及一种电子设备以及通话处理方法，方法包括：接收到来电消息，进行通话初始化，其中通话初始化包括显示来电显示界面和建立挂断监听；接收到挂断消息，判断挂断监听是否完成；对应于挂断监听未完成，并且挂断消息未被处理，则缓存挂断消息，不对挂断消息进行处理。可以看出，在电子设备先后接收的来电消息和挂断消息时，判断针对挂断消息的挂断监听是否建立完成的判断过程，在挂断监听建立完成后，才开始处理挂断消息，避免了在挂断消息的挂断监听尚未建立完成时，已经根据挂断消息挂断了与通信网络之间的通话，导致了电子设备卡在通话应用的来电显示界面的问题。
权利要求书clms
1.一种通话处理方法，应用于电子设备，其特征在于，所述方法包括：接收到来电消息，进行通话初始化，其中所述通话初始化包括显示来电显示界面和建立挂断监听；接收到挂断消息，判断所述挂断监听是否完成；对应于所述挂断监听未完成，并且所述挂断消息未被处理，则缓存所述挂断消息，不对所述挂断消息进行处理。2.根据权利要求1所述的通话处理方法，其特征在于，还包括：对应于所述挂断监听建立完成，处理所述挂断消息，关闭所述来电显示界面。3.根据权利要求1所述的通话处理方法，其特征在于，所述接收到挂断消息，判断所述挂断监听是否完成，包括：对应于连续第一检测次数检测到挂断监听未建立，判断出所述挂断监听未完成。4.根据权利要求3所述的通话处理方法，其特征在于，所述连续执行所述检测的时间间隔相同。5.根据权利要求1所述的通话处理方法，其特征在于，所述接收到挂断消息，判断所述挂断监听是否完成，包括：对应于在第一时间段内检测到挂断监听未建立，判断出所述挂断监听未完成。6.根据权利要求3至5中任一项所述的通话处理方法，其特征在于，通过以下方式确定所述挂断监听是否建立：对应于所述挂断监听对应的程序对象创建完毕，确定所述挂断监听建立；对应于所述挂断监听对应的程序对象不存在，确定所述挂断监听未建立。7.根据权利要求3至5中任一项所述的通话处理方法，其特征在于，通过以下方式确定所述挂断监听是否建立：对应于检测到完成状态标识，确定所述挂断监听建立；对应于未检测到所述完成状态标识，确定所述挂断监听未建立。8.根据权利要求3所述的通话处理方法，其特征在于，还包括：检测到所述挂断监听未完成，并且所述挂断消息已被处理；确定是否检测到用户的第一操作；对应于检测的用户的第一操作，关闭所述来电显示界面，其中，所述第一操作包括接听操作或者拒听操作。9.一种电子设备，其特征在于，包括：存储器，用于存储由电子设备的一个或多个处理器执行的指令，以及处理器，是电子设备的处理器之一，用于执行权利要求1-8中任一项所述的通话处理方法。10.一种计算机程序产品，其特征在于，包括：非易失性计算机可读存储介质,所述非易失性计算机可读存储介质包含用于执行权利要求1-8中任一项所述的通话处理方法的计算机程序代码。
说明书desc
技术领域本申请涉及智能终端的技术领域。尤其涉及一种电子设备及其通话处理方法。背景技术随着通信技术的发展，越来越多的用户会使用电子设备进行通话。发出通话的电子设备可以是主叫方，接收通话的电子设备可以是被叫方。主叫方和被叫方之间实现通话的过程可以包括：主叫方通过通信网络向被叫方发送来电消息，被叫方接收到来电消息后可以选择接听，主叫方或者被叫方都可以通过发送挂断消息挂断通话。在主叫方发出来电消息后，被叫方开始初始化通话应用。而如果在被叫方初始化通话应用未完成前，主叫方挂断电话，或者在通信网络发生异常的情况下使得被叫方收到了主叫方的挂断消息，此时由于通话应用的初始化未完成，通话应用的来电显示界面会正常显示，即使是用户点击拒接电话，来电显示界面也不会关闭，使得电子设备卡在来电显示界面。发明内容本申请提供了一种电子设备及其通话处理方法。第一方面，本申请实施例提供了一种通话处理方法，应用于电子设备，方法包括：接收到来电消息，进行通话初始化，其中通话初始化包括显示来电显示界面和建立挂断监听；接收到挂断消息，判断挂断监听是否完成；对应于挂断监听未完成，并且挂断消息未被处理，则缓存挂断消息，不对挂断消息进行处理。在本申请中，这里的电子设备可以包括能够支持通话业务的各种电子设备，例如，手机、平板电脑等等。接收到来电消息，对通话应用的来电显示界面进行初始化以及建立挂断监听；在接收到挂断消息时，先判断挂断监听是否建立完成，如果挂断监听尚未建立完成，先缓存挂断消息且不对挂断消息进行处理，直至挂断监听建立完成后，处理已缓存的挂断消息。可以看出，在电子设备先后接收的来电消息和挂断消息时，新增了判断针对挂断消息的挂断监听是否建立完成的判断过程，在挂断监听建立完成后，才开始处理挂断消息，使得通话应用能够正常地关闭来电显示界面，避免了来电消息和挂断消息之际的间隔较短，在挂断消息的挂断监听尚未建立完成时，已经根据挂断消息挂断了与通信网络之间的通话，导致了电子设备卡在通话应用的来电显示界面的问题。在上述第一方面的一种可能的实现中，还包括：对应于挂断监听建立完成，处理挂断消息，关闭来电显示界面。在本申请中，在确定挂断监听建立完成后，开始处理挂断消息。在上述第一方面的一种可能的实现中，接收到挂断消息，判断挂断监听是否完成，包括：对应于连续第一检测次数检测到挂断监听未建立，判断出挂断监听未完成。在本申请中，接收到挂断消息后，可以基于预设时间间隔以及预设检测次数循环检测挂断监听对应的程序对象是否存在，若程序对象存在，则直接处理挂断消息；如果不是，则先缓存挂断消息直至挂断监听建立完成。也就是，在经过预设检测次数后，挂断监听尚未建立，确定挂断监听未建立完成。在上述第一方面的一种可能的实现中，连续执行检测的时间间隔相同。在本申请中，可以基于固定的预设时间间隔循环检测挂断监听是否建立完成。在上述第一方面的一种可能的实现中，接收到挂断消息，判断挂断监听是否完成，包括：对应于在第一时间段内检测到挂断监听未建立，判断出挂断监听未完成。在本申请中，基于预设时间间隔以及预设检测次数，也就是可以实现最多延时10次达到200ms检测挂断监听是否建立。在上述第一方面的一种可能的实现中，其特征在于，通过以下方式确定挂断监听是否建立：对应于挂断监听对应的程序对象创建完毕，确定挂断监听建立；对应于挂断监听对应的程序对象不存在，确定挂断监听未建立。在上述第一方面的一种可能的实现中，通过以下方式确定挂断监听是否建立：对应于检测到完成状态标识，确定挂断监听建立；对应于未检测到完成状态标识，确定挂断监听未建立。在本申请中，通过循环检测挂断监听对应的程序对象是否存在，确定挂断监听是否建立完成，以及在建立挂断监听的过程中配置挂断监听建立完成状态，挂断监听建立完成状态的初始值是未完成，在建立完成后，将挂断监听建立完成状态的值更新为完成。在上述第一方面的一种可能的实现中，还包括：检测到挂断监听未完成，并且挂断消息已被处理；确定是否检测到用户的第一操作；对应于检测的用户的第一操作，关闭来电显示界面，其中，第一操作包括接听操作或者拒听操作。在本申请中，在经过第一时间段内检测到挂断监听未建立，判断出挂断监听未完成时，若用户在通话应用的来电显示界面点击接听或者挂断，且下发接听/挂断指令后5s内没有收到应答结果，说明已经处于通话挂断的状态。此时，可以构造一个挂断监听以及一个挂断消息，实现关闭来电显示界面。第二方面，本申请实施例提供一种电子设备，包括：存储器，用于存储由电子设备的一个或多个处理器执行的指令，以及处理器，是电子设备的处理器之一，用于执行第一方面的通话处理方法。第三方面，本申请实施例提供一种计算机程序产品，包括：非易失性计算机可读存储介质,非易失性计算机可读存储介质包含用于执行第一方面的通话处理方法的计算机程序代码。附图说明图1为本申请实施例提供的电子设备接收到来电的场景示意图；图2为本申请实施例提供的电子设备进行通话处理的示意图；图2为本申请实施例提供的电子设备进行通话处理的示意图；图3为本申请实施例提供的电子设备的各个功能模块进行通话处理的示意图；图3为本申请实施例提供的电子设备的各个功能模块进行通话处理的示意图；图4为本申请实施例提供的电子设备的结构示意图；图5为本申请实施例提供的电子设备的软件结构框图；图6为本申请实施例提供的电子设备接收来点消息和处理挂断消息的方法交互示意图；图7为本申请实施例提供的电子设备接收来点消息以及处理挂断消息的方法交互示意图；图8为本申请实施例提供的电子设备接收来点消息以及处理挂断消息的流程示意图；图9为本申请实施例提供的电子设备接收来点消息以及处理挂断消息的流程示意图。具体实施方式下面将结合附图对本申请实施例中的技术方案进行清楚、详尽地描述。可以理解，本申请技术方式适用于能够支持通话业务的各种电子设备，例如，手机、平板电脑、笔记本电脑、可穿戴设备、车载设备等终端设备。本申请实施例涉及的通话业务可以包括IP多媒体系统的通话业务，如：基于长期演进网络的语音通话，基于长期演进网络的视频通话， 基于无线保真技术的语音通话的语音通话，基于无线保真技术的的视频通话以及基于电路交换的通话业务。参考图1，图1示例性地示出了本申请实施例提供的电子设备接收到来电的场景示意图。如图1所示，这里的电子设备可以是手机100，手机100在收到来自对方设备的来电消息的短时间内就收到了挂断消息，这时，手机100的屏幕可以显示通话应用的来电显示界面，来电显示界面包括拒绝控件101、接听控件102以及来电信息。尽管用户在来电显示界面点击拒绝控件101，但来电显示界面不会关闭，手机100卡在来电显示界面。为了便于理解，下面通过图2进一步描述设置于手机100用于处理来电消息以及挂断消息的系统200的架构图。如图2所示，系统200包括通话应用程序201、通话处理架构202、通话模块203以及基带处理器204。其中，通话应用程序201、通话处理架构202、通话模块203可以称为软件侧，基带处理器204可以称为硬件侧。其中，通话应用程序201用于根据来电消息进行初始化，初始化的过程包括：初始化来电显示界面以及显示来电显示界面；或者根据通话处理架构202建立的挂断监听，在接收到挂断消息对应的挂断状态后，关闭来电显示界面；通话应用程序201还可以响应于用户对来电显示界面执行的拒绝操作或者接听操作等等，下发接听或者拒听对应的通话指令。通话处理架构202用于向通话应用程序201传递来电消息以及建立挂断消息对应的挂断状态对应的挂断监听。通话模块203用于向通话处理架构202传递接收的来电消息，即将接收到的来电消息传递给通话处理架构202，以及处理、传递接收到的挂断消息，即，控制基带处理器204与通信网络之间挂断通话以及将通话挂断的挂断状态传递给通话处理架构202。通话模块203还用于处理通话处理架构202传递的通话指令，根据通话指令通过基带处理器204控制接听对方设备的来电、拒听对方设备的来电等等。基带处理器204与通信网络通信，接收对方设备的来电消息或者挂断消息。可以看出，若手机100的系统200中的基带处理器204通过通信网络收到对方设备的来电消息，通话模块203和通话处理架构202依次将来电消息传递给通话应用程序201，通话应用程序201可以响应来电消息显示来电显示界面。通话处理架构202可以在接收来电消息后，建立挂断消息对应的挂断状态对应的挂断监听。若手机100的系统200中的基带处理器204通过通信网络收到对方设备的挂断消息，通话模块203可以处理挂断消息，控制基带处理器204与通信网络之间挂断通话以及向通话应用程序201传递挂断状态；通话应用程序201可以通过建立完成的挂断监听响应于挂断消息对应的挂断状态控制关闭来电显示界面。如果手机100先后接收到来电消息和挂断消息，且来电消息和挂断消息之间的时间间隔很短，会导致挂断监听还没建立完成时，通话模块203已经处理了挂断消息，使得手机100与对方设备之间实现通话挂断。由于挂断消息对应的挂断监听尚未建立完成，通话应用程序201显示来电显示界面时，无法通过挂断监听响应通话模块203传递挂断消息对应的挂断状态，控制关闭来电显示界面。导致手机100会一直显示通话应用程序201的来电显示界面。此时，基带处理器204与通信网络之间已经处于通话挂断，即使用户针对来电显示界面的接听/拒绝控件执行了用户操作，通话模块203也无法响应用户操作，只会一直卡在来电显示界面，需要用户强制关闭通话应用的进程或者重启手机100才能重置通话应用程序201。为了解决上述问题，本申请实施例提出了一种通话处理方法，方法包括：接收到来电消息，响应于来电消息，对通话应用的来电显示界面进行初始化；在接收到挂断消息时，判断通话应用的来电显示界面的初始化过程中的针对挂断消息对应的挂断状态的挂断监听是否建立完成，如果挂断监听尚未建立完成，先缓存挂断消息且不对挂断消息进行处理，直至挂断监听建立完成后，处理已缓存的挂断消息并上报挂断状态。参考图2，在手机100的系统200中的基带处理器204通过通信网络收到对方设备的来电消息，通话模块203和通话处理架构202依次将来电消息传递给通话应用程序201，通话应用程序201可以响应来电消息初始化以及显示来电显示界面。通话处理架构202可以在接收来电消息后，建立挂断消息对应的挂断状态的挂断监听。若手机100的系统200中的基带处理器204通过通信网络收到对方设备的挂断消息，通话模块203可以判断挂断监听是否建立完成，若挂断监听尚未建立完成，通话模块203可以先缓存挂断消息且不处理挂断消息，直至挂断监听建立完成后，通话模块203才开始处理挂断消息，控制基带处理器204与通信网络之间挂断通话，以及将挂断消息对应的挂断状态传递给通话处理架构202。通话应用程序201可以通过建立完成的挂断监听响应于挂断状态控制关闭来电显示界面。在一些实施例中，这里的挂断监听可以是通话处理架构202建立的监听程序，判断挂断监听是否建立完成的方式可以是，通话模块203接收到挂断消息后，可以基于预设时间间隔检测通话处理架构202建立的挂断监听对应的程序对象是否存在，若程序对象存在，则直接处理挂断消息；如果不是，则先缓存挂断消息直至挂断监听建立完成。在另一些实施例中，还可以在通话处理架构202建立挂断监听的过程中配置挂断监听建立完成状态，挂断监听建立完成状态的初始值是未完成，在建立完成后，将挂断监听建立完成状态的值更新为完成。在先后接收到来电消息和挂断消息时，先判断挂断监听建立完成状态是否为完成，如果是，则直接处理挂断消息；如果不是，则先缓存挂断消息直至挂断监听建立完成状态变成完成。可以看出，通过本申请实施例的通话处理方法，在手机100先后接收的来电消息和挂断消息时，增加了判断针对挂断消息的挂断监听是否建立完成的判断步骤，只有在挂断监听建立完成后，才开始处理挂断消息，使得通话应用能够基于挂断监听响应于挂断消息对应的挂断状态正常地关闭来电显示界面，避免了出现来电消息和挂断消息之际的间隔较短，在挂断消息的挂断监听尚未建立完成时，手机100已经根据挂断消息挂断了与通信网络之间的通话，而通话应用无法通过挂断监听关闭来电显示界面，导致了手机100卡在通话应用的来电显示界面的问题。在通过图2和图2描述了手机100会出现卡在来电显示界面的原因以及解决方法后，下面通过图3和图3进一步描述图2和图2所示的系统200的通话处理架构202和通话模块203中的各个子模块处理来电消息和挂断消息的过程。如图3所示，通话处理架构202包括：通话来电呼叫跟踪子模块2021、通话管理子模块2022以及通话呼叫子模块2023。通话模块203包括：通话服务处理子模块2031、通话服务跟踪子模块2032、通话呼叫会话子模块2033、通话呼叫会话回调处理子模块2034以及通话服务发送子模块2035。对于来电消息来说，在手机100接收到来电消息后，通话服务处理子模块2031用于与手机100的基带处理器通信获取从通信网络接收到的对方设备的来电消息。通话服务跟踪子模块2032用于接收通话服务处理子模块2031获取的来电消息，将来电消息传递给通话来电呼叫跟踪子模块2021。通话来电呼叫跟踪子模块2021用于处理来电消息，通知通话管理子模块2022初始化通话应用。通话管理子模块2022用于控制来电消息或者挂断消息在各个子模块之间传递、通知通话呼叫子模块2023启动通话应用的初始化以及通过通话呼叫会话子模块2033建立挂断监听，例如：挂断监听可以用于监听是否接收到对方设备的挂断消息。在一些实施例中，通话呼叫会话子模块2033建立还可以建立操作监听，包括：是否接收到用户对手机100的通话应用执行的拒绝操作或者监听是否接收到用户对手机100的通话应用执行的接听操作等等。通话呼叫会话子模块2033用于通过通话呼叫会话回调处理子模块2034建立挂断监听。也就是，建立挂断监听对应的监听程序以便于处理挂断消息等等。通话呼叫子模块2023用于管理通话应用的来电显示界面。对于挂断消息来说，通话服务发送子模块2035用于与手机100的基带处理器通信获取从通信网络接收到的对方设备的挂断消息。通话服务处理子模块2031用于确定是否接收到挂断消息，通话服务跟踪子模块2032根据挂断消息挂断通话，通知通话呼叫会话子模块2033挂断状态，即，确定挂断状态为通话挂断。通话呼叫会话子模块2033用于向通话呼叫会话回调处理子模块2034传递挂断状态。通话呼叫子模块2023用于根据通话呼叫会话回调处理子模块2034建立的挂断监听，响应于挂断状态，挂断通话，关闭通话应用的来电显示界面。继续参考图3，手机100的基带处理器通过通信网络收到对方设备的来电消息，通话服务处理子模块2031、通话服务跟踪子模块2032、通话来电呼叫跟踪子模块2021、通话管理子模块2022和通话呼叫子模块2023依次响应来电消息并初始化通话应用。在初始化过程中还需要通过通话呼叫会话回调处理子模块2034建立挂断监听，使得通话呼叫子模块2023可以实现通话挂断、通话接听。如果手机100又立刻接收到挂断消息，手机100也会并行处理挂断消息，若来电消息与挂断消息的时间间隔过近，会导致在通话应用的初始化过程还没完成时，通话服务跟踪子模块2032已经处理了挂断消息，使得手机100与对方设备之间实现通话挂断。此时，若挂断消息对应的挂断监听尚未建立完成，使得挂断消息对应的挂断状态通过通话呼叫会话回调处理子模块2034上报给通话呼叫子模块2023后，通话呼叫子模块2023无法处理挂断状态，导致手机100会始终显示通话应用的来电显示界面，即，卡在来电显示界面。为了解决图3中来电消息与挂断消息的时间间隔过近，导致手机100会始终显示通话应用的来电显示界面的问题，下面参考图3，在通话服务跟踪子模块2032接收到通话服务处理子模块2031传递的挂断消息后，先判断通话呼叫会话回调处理子模块2034是否建立了挂断消息对应的挂断监听，如果挂断监听尚未建立，则缓存挂断消息暂不处理，直到挂断监听建立完成后，才开始处理挂断消息，通知通话呼叫会话子模块2033挂断消息对应的挂断状态。图4是本申请实施例提供的一例电子设备100的结构示意图。如图4所示，电子设备可以包括：处理器410，外部存储器接口420，内部存储器421，通用串行总线接口430，充电管理模块440，电源管理模块441，电池442，天线1，天线2，移动通信模块450，无线通信模块460，音频模块470，扬声器470A，受话器470B，麦克风470C，耳机接口470D，传感器模块480，按键490，马达491，指示器492，摄像头493，显示屏494，以及用户标识模块卡接口495等。其中，上述传感器模块480可以包括压力传感器，陀螺仪传感器，气压传感器，磁传感器，加速度传感器，距离传感器，接近光传感器，指纹传感器，温度传感器，触摸传感器和环境光传感器等传感器。可以理解的是，本实施例示意的结构并不构成对电子设备的具体限定。在另一些实施例中，电子设备可以包括比图示更多或更少的部件，或者组合某些部件，或者拆分某些部件，或者不同的部件布置。图示的部件可以以硬件，软件或软件和硬件的组合实现。处理器410可以包括一个或多个处理单元，例如：处理器410可以包括应用处理器，调制解调处理器，图形处理器，图像信号处理器，控制器，存储器，视频编解码器，数字信号处理器，基带处理器，和/或神经网络处理器等。其中，不同的处理单元可以是独立的器件，也可以集成在一个或多个处理器中。处理器410中还可以设置存储器，用于存储指令和数据。在一些实施例中，处理器410中的存储器为高速缓冲存储器。该存储器可以保存处理器410刚用过或循环使用的指令或数据。如果处理器410需要再次使用该指令或数据，可从所述存储器中直接调用。避免了重复存取，减少了处理器410的等待时间，因而提高了系统的效率。在一些实施例中，处理器410可以包括一个或多个接口。接口可以包括集成电路接口，集成电路内置音频接口，脉冲编码调制接口，通用异步收发传输器接口，移动产业处理器接口，通用输入输出接口，用户标识模块接口，和/或通用串行总线接口等。可以理解的是，本实施例示意的各模块间的接口连接关系，只是示意性说明，并不构成对电子设备的结构限定。在另一些实施例中，电子设备也可以采用上述实施例中不同的接口连接方式，或多种接口连接方式的组合。电子设备通过GPU，显示屏494，以及应用处理器等实现显示功能。GPU为图像处理的微处理器，连接显示屏494和应用处理器。GPU用于执行数学和几何计算，用于图形渲染。处理器410可包括一个或多个GPU，其执行程序指令以生成或改变显示信息。显示屏494用于显示图像，视频等。该显示屏494包括显示面板。电子设备可以通过ISP，摄像头493，视频编解码器，GPU，显示屏494以及应用处理器等实现拍摄功能。ISP用于处理摄像头493反馈的数据。摄像头493用于捕获静态图像或视频。在一些实施例中，电子设备可以包括1个或N个摄像头493，N为大于1的正整数。外部存储器接口420可以用于连接外部存储卡，例如Micro SD卡，实现扩展电子设备的存储能力。外部存储卡通过外部存储器接口420与处理器410通信，实现数据存储功能。例如将音乐，视频等文件保存在外部存储卡中。内部存储器421可以用于存储计算机可执行程序代码，所述可执行程序代码包括指令。处理器410通过运行存储在内部存储器421的指令，从而执行电子设备的各种功能应用以及数据处理。例如，在本申请实施例中，处理器410可以通过执行存储在内部存储器421中的指令，内部存储器421可以包括存储程序区和存储数据区。其中，存储程序区可存储操作系统，至少一个功能所需的应用程序等。存储数据区可存储电子设备使用过程中所创建的数据等。此外，内部存储器421可以包括高速随机存取存储器，还可以包括非易失性存储器，例如至少一个磁盘存储器件，闪存器件，通用闪存存储器等。可以理解的是，本申请实施例示意的结构并不构成对电子设备的具体限定。在本申请另一些实施例中，电子设备可以包括比图示更多或更少的部件，或者组合某些部件，或者拆分某些部件，或者不同的部件布置。图示的部件可以以硬件，软件或软件和硬件的组合实现。图5是本发明实施例的电子设备100的软件结构框图。分层架构将软件分成若干个层，每一层都有清晰的角色和分工。层与层之间通过软件接口通信。在一些实施例中，将Android系统分为四层，从上至下分别为应用层，应用框架层，安卓运行时和系统库，以及内核层。如图5所示，应用层可以包括生活，视频，阅读，购物，图库，日历，通话，导航和音乐等应用程序。可以理解，这里的应用程序可以是电子设备100已安装的应用或者服务，或者是通过快服务中心检索到的电子设备100未安装的应用或者服务。应用框架层可以包括布局子系统，窗口管理模块、事件输入模块、通话处理模块等等。其中，布局子系统用于确定电子设备的屏幕中的各个显示元素的位置。事件输入模块用于响应用户对电子设备执行的操作，改变电子设备的屏幕中的显示内容。窗口管理模块用于获取应用对应的窗口的属性。通话处理模块用于向通话应用程序传递来电消息以及建立挂断消息对应的挂断状态对应的挂断监听。硬件抽象层可以包括绘制服务模块、通话模块等等。其中，绘制服务模块用于将一个或者多个应用的窗口中的一个或者多个图层进行绘制合成之后得到帧数据。通话模块可以用于向通话处理模块传递接收的来电消息以及处理、传递接收到的挂断消息，控制基带处理器与通信网络之间挂断通话以及将通话挂断的挂断状态传递给通话处理模块。内核层包括显示驱动，事件驱动和传感器驱动等等。下面基于图6所示的方法交互示意图结合图3所示的手机100的通话功能对应的各个功能模块结构图来详细描述本申请实施例提供的通话处理方法。图6所示的方法可以由手机100的处理器执行相关的指令实现。参考图6，该通话处理方法可以包括以下步骤：S601：通话服务处理子模块2031接收来电消息。示例性地，通话服务处理子模块2031用于与手机100的基带处理器通信获取从通信网络接收到的对方设备的来电消息。S602：通话服务跟踪子模块2032向通话来电呼叫跟踪子模块2021传递接收的来电消息。示例性地，通话服务跟踪子模块2032用于接收通话服务处理子模块2031获取的来电消息，将来电消息传递给通话来电呼叫跟踪子模块2021。S603：通话来电呼叫跟踪子模块2021处理来电消息。示例性地，通话来电呼叫跟踪子模块2021用于处理来电消息，通知通话管理子模块2022。S604：通话管理子模块2022初始化通话应用。示例性地，通话管理子模块2022用于控制来电消息或者挂断消息在各个子模块之间传递、通知通话呼叫子模块2023启动通话应用的初始化以及通过通话呼叫会话子模块2033建立挂断监听。S605：通话呼叫子模块2023显示通话应用的来电显示界面。示例性地，通话呼叫子模块2023用于控制显示通话应用的来电显示界面。例如：配置来电显示界面包括的各个控件，如：接听控件、拒听控件等等，以及显示来电信息，如：对方设备的号码等等。S606：通话呼叫会话子模块2034建立挂断监听。示例性地，通话呼叫会话子模块2033用于通过通话呼叫会话回调处理子模块2034建立挂断监听。也就是，建立挂断监听对应的监听程序以便于处理挂断消息等等。S607：通话服务发送子模块2035接收挂断消息。示例性地，通话服务发送子模块2035用于与手机100的基带处理器通信获取从通信网络接收到的对方设备的挂断消息。S608：通话服务处理子模块2031向通话服务跟踪子模块2032传递接收的挂断消息。示例性地，通话服务处理子模块2031用于确定是否接收到挂断消息，将挂断消息传递给通话服务跟踪子模块2032。S609：通话服务跟踪子模块2032判断挂断监听是否建立。示例性地，通话服务跟踪子模块2032接收到通话服务处理子模块2031传递的挂断消息后，先判断通话呼叫会话回调处理子模块2034是否建立了挂断消息对应的挂断监听，如果挂断监听尚未建立，则执行步骤S610，缓存挂断消息暂不处理。如果挂断监听建立完成，则执行步骤S611，开始处理挂断消息，通知通话呼叫会话子模块2033挂断消息对应的挂断状态。在一些实施例中，判断挂断监听是否建立完成的方式可以是，通话服务跟踪子模块2032接收到挂断消息后，可以基于预设时间间隔以及预设检测次数循环检测通话处理架构202建立的挂断监听对应的程序对象是否存在，若程序对象存在，则直接处理挂断消息；如果不是，则先缓存挂断消息直至挂断监听建立完成。也就是，每次延时20ms再去检测挂断监听是否建立完成，完成则处理挂断消息，否则等待下一次检测，可以实现最多延时10次达到200ms。S610：通话服务跟踪子模块2032缓存挂断消息。示例性地，通话服务跟踪子模块2032可以在手机100的存储区域内，缓存挂断消息。S611：通话服务跟踪子模块2032处理挂断消息。S612：通话呼叫会话子模块2033确定挂断状态。示例性地，示例性地，通话服务跟踪子模块2032根据挂断消息挂断通话，通知通话呼叫会话子模块2033挂断状态，即，确定挂断状态为通话挂断。S613：通话呼叫会话子模块2033向通话呼叫会话回调处理子模块2034上报挂断状态。示例性地，通话呼叫会话子模块2033用于向通话呼叫会话回调处理子模块2034传递挂断状态。S614：通话呼叫会话回调处理子模块2034监听到挂断状态。S615：通话呼叫子模块2023关闭来电显示界面。示例性地，通话呼叫子模块2023用于根据通话呼叫会话回调处理子模块2034建立的挂断监听，响应于挂断状态，挂断通话，关闭通话应用的来电显示界面。可以看出，通过图6所示的通话处理方法可以实现只有在挂断监听建立完成后，手机100才开始处理挂断消息，使得通话应用能够基于挂断监听响应于挂断消息对应的挂断状态正常地关闭来电显示界面。在另一些实施例中，在图6所示的步骤S609中，若超过执行检测挂断监听是否建立完成的次数超过预设检测次数，且延时超过了预设时间间隔与预设检测次数的乘积，手机100还可以通过如图7所示的通话处理方法关闭来电显示界面。下面基于图7所示的方法交互示意图结合图3所示的手机100的通话功能对应的各个功能模块结构图来详细描述本申请实施例提供的通话处理方法。图7所示的方法可以由手机100的处理器执行相关的指令实现。参考图7，该通话处理方法可以包括以下步骤：S701：通话呼叫子模块2023接收到对来电显示界面执行的用户操作。示例性地，这里的用户操作可以包括用户对来电显示界面执行的拒绝操作或者接听操作等用户操作了。S702：通话呼叫子模块2023向通话服务跟踪子模块2032传递通话指令。示例性地，响应于用户操作，通话呼叫子模块2023可以向通话服务跟踪子模块2032下发接听或者拒听对应的通话指令。S702：通话呼叫子模块2023向通话服务跟踪子模块2032传递通话指令。S703：通话呼叫子模块2023判断是否接收到通话指令对应的应答结果。示例性地，这里的应答结果可以是与接听指令或者拒听指令对应的应答结果，接听指令可以对应于接听应答，拒听指令可以对应于挂断应答。在一些实施例中，通话呼叫子模块2023可以基于预设时间段判断是否接收到通话指令对应的应答结果，也就是，在传递通话指令后，在预设时间段内判断是否接收到通话指令对应的应答结果。如果接收到通话指令对应的应答结果，则进入步骤S704，执行应答结果对应的通话操作，否则，进入步骤S705，直接构造挂断监听并生成挂断消息对应的挂断状态，通过挂断监听响应挂断状态控制关闭来电显示界面。S704：通话呼叫子模块2023执行应答结果对应的通话操作。示例性地，通话呼叫子模块2023可以根据应答结果，接听通话或者挂断通话。S705：通话呼叫子模块2023构造挂断监听并生成挂断消息对应的挂断状态，通过挂断监听响应挂断状态控制关闭来电显示界面。示例性地，通话呼叫子模块2023可以采用通话呼叫会话回调处理子模块2034建立挂断监听的方式，建立挂断监听对应的监听程序。在挂断监听建立完成后，生成挂断消息对应的挂断状态，通过建立的挂断监听控制关闭来电显示界面。可以看出，在通过图7所示的通话处理方法，即，延时200ms挂断监听也没有建立完成，若用户在来电显示界面点击接听或者挂断，且下发接听/挂断指令后5s内没有收到应答结果，说明基带处理器与通信网络之间已经处于通话挂断的状态。此时，通话呼叫子模块2023可以构造一个挂断监听以及一个挂断消息，实现关闭来电显示界面。在一些实施例中，判断挂断监听是否建立的过程还可以通过图8所示的方法流程图以及结合3所示的手机100的通话功能对应的各个功能模块结构图来描述，图8的方法流程图包括如下步骤。S801：通话服务跟踪子模块2032接收到挂断消息。示例性地，这里的挂断消息可以是通过如图6所示的通话服务处理子模块2031接收后传递给通话服务跟踪子模块2032的挂断消息。S802：通话服务跟踪子模块2032判断挂断监听是否建立。示例性地，通话服务跟踪子模块2032接收到通话服务处理子模块2031传递的挂断消息后，先判断通话呼叫会话回调处理子模块2034是否建立了挂断消息对应的挂断监听，如果挂断监听尚未建立，则执行步骤S803，等待经过预设时间间隔后，再执行步骤S804，判断执行挂断监听检测的次数是否到达预设检测次数阈值，如果未到达，则回到步骤S802，继续判断挂断监听是否建立，否则进入步骤S805，判断挂断监听是否建立的过程结束，即，执行结束。如果挂断监听尚建立，则执行步骤S806，处理挂断消息。S803：通话服务跟踪子模块2032等待经过预设时间间隔。S804：通话服务跟踪子模块2032判断执行挂断监听检测的次数是否到达预设检测次数阈值。示例性地，通话服务跟踪子模块2032接收到挂断消息后，可以基于预设时间间隔以及预设检测次数阈值循环检测挂断监听是否建立完成。如果未到达预设检测次数阈值，则回到步骤S802，继续判断挂断监听是否建立，如果到达，进入步骤S805，判断挂断监听是否建立的过程结束，即，执行结束。也就是，每次延时20ms再去检测挂断监听是否建立完成，完成则处理挂断消息，否则等待下一次检测，可以实现最多延时10次达到200ms。S805：通话服务跟踪子模块2032确定执行结束。示例性地，若执行判断挂断监听是否建立的执行次数满足了预设检测次数阈值，则判断挂断监听是否建立的过程结束。S805：通话服务跟踪子模块2032处理挂断消息。示例性地，通话服务跟踪子模块2032根据挂断消息挂断通话，通知通话呼叫会话子模块2033挂断状态，即，确定挂断状态为通话挂断。可以理解，在另一些实施例中，图7所示的方法交互示意图还可以通过图9所示的方法流程图结合图3所示的手机100的通话功能对应的各个功能模块结构图来描述，图9的方法流程图包括如下步骤。S901：通话呼叫子模块2023接收到对来电显示界面执行的用户操作。示例性地，这里的用户操作可以包括用户对来电显示界面执行的拒绝操作或者接听操作等用户操作了。S902：通话呼叫子模块2023判断是否在预设时间段内接收到用户操作对应的应答结果。示例性地，这里的应答结果可以是与用户执行的用户操作生成的接听指令或者拒听指令对应的应答结果，接听指令可以对应于接听应答，拒听指令可以对应于挂断应答。在一些实施例中，通话呼叫子模块2023可以基于预设时间段判断是否接收到通话指令对应的应答结果，也就是，在传递通话指令后，在预设时间段内判断是否接收到通话指令对应的应答结果。如果接收到通话指令对应的应答结果，则进入步骤S903，执行应答结果对应的通话操作，否则，进入步骤S904，直接构造挂断监听并生成挂断消息对应的挂断状态，通过挂断监听响应挂断状态控制关闭来电显示界面。S903：通话呼叫子模块2023执行应答结果对应的通话操作。示例性地，通话呼叫子模块2023可以根据应答结果，接听通话或者挂断通话。之后，进入步骤S905，执行结束。S904：通话呼叫子模块2023构造挂断监听并生成挂断消息对应的挂断状态，通过挂断监听响应挂断状态控制关闭来电显示界面。示例性地，通话呼叫子模块2023可以采用通话呼叫会话回调处理子模块2034建立挂断监听的方式，建立挂断监听对应的监听程序。在挂断监听建立完成后，生成挂断消息对应的挂断状态，通过建立的挂断监听控制关闭来电显示界面。之后，进入步骤S905，执行结束。S905：通话呼叫子模块2023确定执行结束。示例性地，来电显示界面关闭后，执行结束。应当理解的是，虽然在本文中可能使用了术语“第一”、“第二”等等来描述各个特征，但是这些特征不应当受这些术语限制。使用这些术语仅仅是为了进行区分，而不能理解为指示或暗示相对重要性。举例来说，在不背离示例性实施例的范围的情况下，第一特征可以被称为第二特征，并且类似地第二特征可以被称为第一特征。此外，各种操作将以最有助于理解说明性实施例的方式被描述为多个彼此分离的操作；然而，描述的顺序不应被解释为暗示这些操作必须依赖描述的顺序，其中的许多操作可以被并行地、并发地或者同时实施。此外，各项操作的顺序也可以被重新安排。当所描述的操作完成时，所述处理可以被终止，但是还可以具有未包括在附图中的附加操作。所述处理可以对应于方法、函数、规程、子例程、子程序等等。说明书中对“一个实施例”，“实施例”，“说明性实施例”等的引用表示所描述的实施例可以包括特定特征、结构或性质，但是每个实施例也可能或不是必需包括特定的特征、结构或性质。而且，这些短语不一定是针对同一实施例。此外，当结合具体实施例描述特定特征，本领域技术人员的知识能够影响到这些特征与其他实施例的结合，无论这些实施例是否被明确描述。除非上下文另有规定，否则术语“包含”、“具有”和“包括”是同义词。短语“A/B”表示“A或B”。短语“A和/或B”表示“、或”。如本文所使用的，术语“模块”可以指代，作为其中的一部分，或者包括：用于运行一个或多个软件或固件程序的存储器，专用集成电路，电子电路和/或处理器，组合逻辑电路，和/或提供所述功能的其他合适组件。在附图中，可能以特定布置和/或顺序示出了一些结构或方法特征。然而，应当理解的是，这样的特定布置和/或排序不是必需的。而是，在一些实施例中，这些特征可以以不同于说明性附图中所示的方式和/或顺序来进行说明。另外，特定附图中所包含得结构或方法特征并不意味着所有实施例都需要包含这样的特征，在一些实施例中，可以不包含这些特征，或者可以将这些特征与其他特征进行组合。上面结合附图对本申请的实施例做了详细说明，但本申请技术方案的使用不仅仅局限于本专利实施例中提及的各种应用，各种结构和变型都可以参考本申请技术方案轻易地实施，以达到本文中提及的各种有益效果。在本领域普通技术人员所具备的知识范围内，在不脱离本申请宗旨的前提下做出的各种变化，均应归属于本申请专利涵盖范围。
