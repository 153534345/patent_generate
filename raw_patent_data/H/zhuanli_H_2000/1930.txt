标题title
一种适用于近红外水果无损检测的光谱预处理方法及装置
摘要abst
本申请公开一种适用于近红外水果无损检测的光谱预处理方法及装置，其方法包括：使用二阶差分计算其光谱数据的总体噪音分布；根据噪音分布对光谱数据进行自适应阈值分割，形成多个分割区间，在每个分割区间内计算各自区间的噪音，以残差小于噪音阈值为优化目标对原始光谱各区间进行循环自适应参数SG滤波，找到最优滤波参数；使用最优滤波参数在各自区间内对光谱数据进行滑动多项式拟合，对每个点的拟合多项式在当前点处求导。本发明根据水果近红外无损检测的光谱数据特点，提出分段自适应参数滤波方法，在不同信噪比区间找到不同的最优滤波参数，减少现有滤波方法的欠拟合和过拟合问题，有效降低了微分求导增加的噪音，提高了数据质量。
权利要求书clms
1.一种适用于近红外水果无损检测的光谱预处理方法，其特征在于：包括：步骤1：测定吸光度，使用二阶差分计算其光谱数据的总体噪音分布；步骤2：根据噪音分布对光谱数据进行自适应阈值分割，形成多个分割区间，在每个分割区间内计算各自区间的噪音，以残差小于噪音阈值为优化目标对原始光谱各区间进行循环自适应参数SG滤波，找到最优滤波参数；步骤3：使用最优滤波参数在各自区间内对光谱数据进行滑动多项式拟合，对每个点的拟合多项式在当前点处求导；步骤4：逐点计算吸光度数据所有点的导数。2.根据权利要求1所述的光谱预处理方法，其特征在于：所述步骤1中测定吸光度包括如下过程：关闭光源，分别放入标定白球和水果样本，打开光谱仪采集白球和水果样本背面光谱数据iw和i0作为光谱仪的本底信号，再开灯预热预设时间后分别采集白球和水果样本透射近红外光谱Iw和I0，计算吸光度序列A，其计算公式为：。3.根据权利要求2所述的光谱预处理方法，其特征在于：所述步骤1中使用二阶差分计算其光谱数据的总体噪音分布，包括如下过程：对吸光度序列A做区间截取，取预设区间波段生成新的吸光度序列A0；对A0执行二阶差分操作，二阶差分操作是使用算子对A0进行滑动卷积，生成吸光度二阶差分序列A″，A″用以反映吸光度序列A0的噪音分布。4.根据权利要求3所述的光谱预处理方法，其特征在于：所述步骤2具体包括如下过程：根据吸光度二阶差分序列A″找到噪音最佳区间分割，根据水果近红外透射光谱数据特点，预设两个分割点t1：650nm和t2：870nm，形成三个分割区间；三个分割区间内的光谱点数分别记为n1、n2、n3，三个分割区间内的光谱平均值分别记为m1、m2、m3,总体光谱平均值为m0，计算此时的区间类间方差f=，类间方差/＞的算术平方根为类间标准差/＞,类间方差/＞的计算过程为：光谱落入三个区间的概率分别记为q1、q2和q3，则：；满足以下关系：；类间方差的表达式为：；设立循环次数上限，反复随机调整分割点t1、t2，循环计算新的f，循环结束找到的最大的类间方差对应的：；；此时的分割点t1、t2即为最优分割点，将吸光度二阶差分序列A″分割为A1″、A2″、A3″三部分；分别计算A1″、A2″、A3″的平均噪音s1、s2、s3；用分割点t1、t2将吸光度序列A0分割成区间A1、A2、A3，三个区间内光谱点数分别为n1、n2、n3，分别在各个区间内使用SG滤波，初始参数为窗口w=5，阶数g=3，滤波后数据分别为、、/＞,残差ε1、ε2、ε3；其中，残差计算公式如下：；；；遍历参数，先固定阶数，遍历窗口，窗口w1每次加2，阶数g1每次加1，反复迭代计算新的残差，直至ε1大于s1，停止迭代，此时得到参数w1、g1即为SG滤波最优参数，同样的方法得到w2、g2、w3、g3。5.根据权利要求4所述的光谱预处理方法，其特征在于：所述分别计算A1″、A2″、A3″的平均噪音s1、s2、s3，具体计算方法为：以A1″为例，将A1″等分为L个区间Segi，每个区间内数据点数为n，计算每个区间内数据的平均值v和标准差σ，找到其中标准差最小的那个区间Segi，平均值为vi，标准差为σi，以一个宽度为n的窗口覆盖Segi区间，向右滑动检测，每次移动一个数据点，计算这个数据点是否属于区间，如果是，则保持该点不变，如果不是，则将该点用当前窗口内数据的平均值代替，重复上述步骤，直至右边所有数据全部检测完毕，用同样的方法检测左侧数据，最后计算处理后的A1″的标准差σA1,同样的方法计算A2″、A3″的标准差σA2、σA3；,/＞,/＞。6.根据权利要求5所述的光谱预处理方法，其特征在于：所述步骤3具体包括如下过程：使用步骤2得到的最优参数在对应的A1、A2、A3区间内执行滑动窗口多项式拟合，每个点的拟合系数为p，即：；其中；根据拟合系数计算此多项式在窗口中心点处的一阶、二阶导数，计算公式为：；；在窗口中心处i=0；，/＞；按照上述公式，滑动窗口逐点计算窗口中心点导数值，直接得到滤波后的一阶导数和二阶导数/＞。7.一种适用于近红外水果无损检测的光谱预处理装置，其特征在于：包括：吸光度计算模块，用于测定吸光度；噪音分布计算模块，用于使用二阶差分计算其光谱数据的总体噪音分布；最优滤波参数计算模块：用于根据噪音分布对光谱数据进行自适应阈值分割，形成多个分割区间，在每个分割区间内计算各自区间的噪音，以残差小于噪音阈值为优化目标对原始光谱各区间进行循环自适应参数SG滤波，以获得最优滤波参数；多项式拟合模块：用于使用最优滤波参数在各自区间内对光谱数据进行滑动多项式拟合，对每个点的拟合多项式在当前点处求导；所有点导数计算模块：用于逐点计算吸光度数据所有点的导数。8.一种计算机可读介质，其特征在于：该计算机可读介质存储有处理器可执行的程序代码，所述程序代码使所述处理器执行如权利要求1-6任一所述的光谱预处理方法。
说明书desc
技术领域本发明涉及近红外光谱信号的预处理技术领域，具体是一种适用于近红外水果无损检测的光谱预处理方法及装置。背景技术近红外光谱是指波长在780纳米至2526纳米区间的电磁波。其中780纳米至1100纳米区间为短波近红外，1100纳米至2526纳米区间为长波近红外。当一束近红外光通过具有近红外吸收的物质时，物质分子吸收不相同的能量，形成近红外区域的吸收光谱，这是近红外光谱分析方法的基础。由于近红外光穿透能力强，对检测物没有损伤性，使用近红外漫透射的方法可以获取水果内部深层的品质信息，所以近红外光谱分析方法在水果无损分选、品质检测上已有大量运用。光谱仪在采集水果样本近红外光谱得到的信号包含了噪声和各种外界不利因素干扰，噪音主要包括光谱仪本底噪音和暗电流，不利干扰包括由于样本不均匀、光散射和光程不同导致的基线平移和基线漂移。因此使用近红外光谱分析技术来分析样品的物质成分，就必需要先对光谱进行预处理，以降噪和减少各种干扰的影响，提高后续建模准确度。现有技术中，对近红外光谱信号进行预处理的方案多为：使用移动平均平滑法和SG卷积平滑去掉高频噪音，使用一阶、二阶微分处理扣除基线平移和漂移。其中，SG卷积平滑法详细见褚小立主编的《化学计量学方法与分子光谱分析技术》一书。而现有的移动平均平滑法和SG卷积平滑法需要确定平滑窗口大小，窗口过大会造成过平滑，窗口过小会造成欠平滑，并且普通光栅光谱仪在近红外区间灵敏度低于可见光区间，导致光谱在不同区间信噪比不同，如果使用同样的滤波参数，可能导致有的波段欠拟合，有些波段过拟合的情况；一阶二阶微分法在处理基线平移和漂移的过程中会加入噪音，使用多点差分和使用滤波后数据差分可以减少噪音，但是仍然无法得到十分满意的效果。发明内容在下文中给出了关于本发明实施例的简要概述，以便提供关于本发明的某些方面的基本理解。应当理解，以下概述并不是关于本发明的穷举性概述。它并不是意图确定本发明的关键或重要部分，也不是意图限定本发明的范围。其目的仅仅是以简化的形式给出某些概念，以此作为稍后论述的更详细描述的前序。为解决上述技术问题，本申请提供一种适用于近红外水果无损检测的光谱预处理方法，根据水果近红外无损检测的光谱数据特点，提出分段自适应参数滤波方法，在不同信噪比区间找到不同的最优滤波参数，减少现有滤波方法的欠拟合和过拟合问题；针对微分法处理基线平移和漂移增加的噪音问题，直接求取多项式拟合后的函数在数据点处的导数，将滤波和求导过程统一到一步完成，有效降低了微分求导增加的噪音，提高了数据质量，为后续建模提供了良好的基础。根据本申请的一方面，提供一种适用于近红外水果无损检测的光谱预处理方法，包括：步骤1：测定吸光度，使用二阶差分计算其光谱数据的总体噪音分布；步骤2：根据噪音分布对光谱数据进行自适应阈值分割，形成多个分割区间，在每个分割区间内计算各自区间的噪音，以残差小于噪音阈值为优化目标对原始光谱各区间进行循环自适应参数SG滤波，找到最优滤波参数；步骤3：使用最优滤波参数在各自区间内对光谱数据进行滑动多项式拟合，对每个点的拟合多项式在当前点处求导；步骤4：逐点计算吸光度数据所有点的导数。本发明通过对SG滤波进行改进，对光谱数据进行自适应阈值分割以划分分割区间，并寻找各分割区间的最优滤波参数，再和导数融合在一起一步完成，从而有效提高求导后的数据质量。进一步的，所述步骤1中测定吸光度包括如下过程：关闭光源，分别放入标定白球和水果样本，打开光谱仪采集白球和水果样本背面光谱数据iw和i0作为光谱仪的本底信号，再开灯预热预设时间后分别采集白球和水果样本透射近红外光谱Iw和I0，计算吸光度序列A，其计算公式为：。w为自然数。进一步的，所述步骤1中使用二阶差分计算其光谱数据的总体噪音分布，包括如下过程：对吸光度序列A做区间截取，取预设区间波段生成新的吸光度序列A0；对A0执行二阶差分操作，二阶差分操作是使用算子对A0进行滑动卷积，生成吸光度二阶差分序列A″，A″用以反映吸光度序列A0的噪音分布；进一步的，所述步骤2具体包括如下过程：根据吸光度二阶差分序列A″找到噪音最佳区间分割，根据水果近红外透射光谱数据特点，预设两个分割点t1：650nm和t2：870nm，形成三个分割区间；三个分割区间内的光谱点数分别记为n1、n2、n3，三个分割区间内的光谱平均值分别记为m1、m2、m3,总体光谱平均值为m0，计算此时的区间类间方差f=，类间方差/＞的算术平方根为标准差/＞,类间方差/＞的计算过程为：光谱落入三个区间的概率分别记为q1、q2和q3，则：；满足以下关系：；类间方差的表达式为：；设立循环次数上限，反复随机调整分割点t1、t2，循环计算新的f，循环结束找到的最大的类间方差对应的：；；此时的分割点t1、t2即为最优分割点，将吸光度二阶差分序列A″分割为A1″、A2″、A3″三部分；分别计算A1″、A2″、A3″的平均噪音s1、s2、s3，计算方法为：以A1″为例，将A1″等分为L个区间Segi，每个区间内数据点数为n，计算每个区间内数据的平均值v和标准差σ，找到其中标准差最小的那个区间Segi，平均值为vi，标准差为σi，以一个宽度为n的窗口覆盖Segi区间，向右滑动检测，每次移动一个数据点，计算这个数据点是否属于区间，如果是，则保持该点不变，如果不是，则将该点用当前窗口内数据的平均值代替，重复上述步骤，直至右边所有数据全部检测完毕，用同样的方法检测左侧数据，最后计算处理后的A1″的标准差σA1,同样的方法计算A2″、A3″的标准差σA2、σA3；,/＞,/＞；用分割点t1、t2将吸光度序列A0分割成区间A1、A2、A3，三个区间内光谱点数分别为n1、n2、n3，分别在各个区间内使用SG滤波，初始参数为窗口w=5，阶数g=3，滤波后数据分别为、/＞、/＞,残差ε1、ε2、ε3；其中，残差计算公式如下：；；；遍历参数，先固定阶数，遍历窗口，窗口w1每次加2，阶数g1每次加1，反复迭代计算新的残差，直至ε1大于s1，停止迭代，此时得到参数w1、g1即为SG滤波最优参数，同样的方法得到w2、g2、w3、g3；进一步的，所述步骤3具体包括如下过程：使用步骤2得到的最优参数在对应的A1、A2、A3区间内执行滑动窗口多项式拟合，每个点的拟合系数为p，即：；其中，；根据拟合系数计算此多项式在窗口中心点处的一阶、二阶导数，计算公式为：；；在窗口中心处i=0；，/＞；按照上述公式，滑动窗口逐点计算窗口中心点导数值，直接得到滤波后的一阶导数和二阶导数/＞。根据本申请的另一方面，还提供一种适用于近红外水果无损检测的光谱预处理装置，其包括：吸光度计算模块，用于测定吸光度；噪音分布计算模块，用于使用二阶差分计算其光谱数据的总体噪音分布；最优滤波参数计算模块：用于根据噪音分布对光谱数据进行自适应阈值分割，形成多个分割区间，在每个分割区间内计算各自区间的噪音，以残差小于噪音阈值为优化目标对原始光谱各区间进行循环自适应参数SG滤波，以获得最优滤波参数；多项式拟合模块：用于使用最优滤波参数在各自区间内对光谱数据进行滑动多项式拟合，对每个点的拟合多项式在当前点处求导；所有点导数计算模块：用于逐点计算吸光度数据所有点的导数。根据本申请的再一方面，还提供一种计算机可读介质，该计算机可读介质存储有处理器可执行的程序代码，所述程序代码使所述处理器执行如权利要求1-6任一所述的光谱预处理方法。本发明根据水果近红外无损检测的光谱数据特点，提出分段自适应参数滤波方法，在不同信噪比区间找到不同的最优滤波参数，减少现有滤波方法的欠拟合和过拟合问题；针对微分法处理基线平移和漂移增加的噪音问题，直接求取多项式拟合后的函数在数据点处的导数，将滤波和求导过程统一到一步完成，有效降低了微分求导增加的噪音，提高了数据质量，为后续建模提供了良好的基础。附图说明本发明可以通过参考下文中结合附图所给出的描述而得到更好的理解，其中在所有附图中使用了相同或相似的附图标记来表示相同或者相似的部件。所述附图连同下面的详细说明一起包含在本说明书中并且形成本说明书的一部分，而且用来进一步举例说明本发明的优选实施例和解释本发明的原理和优点。在附图中：图1为本发明实施例的光谱预处理方法的流程图；图2为反映吸光度序列A0的噪音分布的A″示意图。具体实施方式下面将参照附图来说明本发明的实施例。在本发明的一个附图或一种实施方式中描述的元素和特征可以与一个或更多个其它附图或实施方式中示出的元素和特征相结合。应当注意，为了清楚的目的，附图和说明中省略了与本发明无关的、本领域普通技术人员已知的部件和处理的表示和描述。本发明实施例提供一种适用于近红外水果无损检测的光谱预处理方法，其流程图如图1所示，包括：过程1：测定待测样本的吸光度；过程1：计算吸光度的二阶差分；过程2：根据二阶差分结果选取最优区间分割；过程3：计算各区间总体噪音；过程4：以噪音为阈值搜寻最优滤波参数；过程5：对吸光度数据使用最优参数在滑动窗口内拟合多项式函数；过程6：根据多项式系数求取函数在窗口中心点处的导数；过程7：逐点计算吸光度数据所有点导数；过程8：结束。其中，过程2-过程4的根据二阶差分结果选取最优区间分割，计算各区间总体噪音，以噪音为阈值搜寻最优滤波参数，具体是：根据噪音分布对光谱数据进行自适应阈值分割，形成多个分割区间，在每个分割区间内计算各自区间的噪音，以残差小于噪音阈值为优化目标对原始光谱各区间进行循环自适应参数SG滤波，找到最优滤波参数；其中，过程5具体是使用最优滤波参数在各自区间内对光谱数据进行滑动多项式拟合，对每个点的拟合多项式在当前点处求导。通过划分区间和寻找最优参数的方法是对现有SG滤波改进，并将SG滤波和导数融合在一起一步完成，有效提高求导后的数据质量。具体的，作为一个具体的实施例，其光谱预处理具体包括如下步骤：步骤1：关闭光源，分别放入标定白球和水果样本，打开光谱仪采集白球和水果样本背面光谱数据iw和i0作为光谱仪的本底信号，再开灯预热30分钟后分别采集白球和水果样本透射近红外光谱Iw和I0，执行计算吸光度A操作，计算公式为：；步骤2：对吸光度序列A做区间截取，取580nm-1000nm区间波段生成新的吸光度序列A0，对A0执行二阶差分操作，方法为使用算子对A0滑动卷积，生成吸光度二阶差分序列A″，A″可以反映吸光度序列A0的噪音分布；步骤3：根据吸光度二阶差分序列A″找到噪音最佳区间分割，根据水果近红外透射光谱数据特点，预设两个分割点t1：650nm和t2：870nm，分成三个分割区间。由于光栅型近红外光谱仪特点是在近红外区间灵敏度低于可见光区间，因此本申请创新性的分区间进行计算噪音。此外，由于水果主要成分吸收波段在800-950区间，所以尤其需要在这个区间提高信号质量。设置区间时，可以设置多个，鉴于区间越多计算量越大，根据水果近红外光谱特点，本申请人根据大量实验，设置3个区间最为适合，并分别设置两个分割点为t1：650nm和t2：870nm。当然，t1和t2的数值不一定是650nm和870nm，t1可以选取范围650nm±50nm，t2可以选取范围为870nm±50nm。分成的三个区间内光谱点数分别为n1、n2、n3，三个区间内的光谱平均值分别为m1、m2、m3,总体光谱平均值为m0，计算此时的区间类间方差f=，类间方差/＞的算术平方根为类间标准差/＞,类间方差/＞的计算过程为：光谱落入三个区间的概率分别记为q1、q2和q3，则：；满足以下关系：；类间方差的表达式为：；使用优化算法，设立循环次数上限1000次，反复随机调整分割点t1、t2，计算新的f，循环结束找到的最大的类间方差对应的：；；此时的分割点t1、t2即为最优分割点，将吸光度二阶差分序列A″分割为A1″、A2″、A3″三部分；步骤4：分别计算A1″、A2″、A3″的平均噪音s1、s2、s3，计算方法为：以A1″为例，将A1″等分为L个区间Segi，每个区间内数据点数为n，计算每个区间内数据的平均值v和标准差σ，找到其中标准差最小的那个区间Segi，平均值为vi，标准差为σi，以一个宽度为n的窗口覆盖Segi区间，向右滑动检测，每次移动一个数据点，计算这个数据点是否属于区间，如果是，则保持该点不变，如果不是，则将该点用当前窗口内数据的平均值代替，重复上述步骤，直至右边所有数据全部检测完毕，用同样的方法检测左侧数据，最后计算处理后的A1″的标准差σA1,同样的方法计算A2″、A3″的标准差σA2、σA3；,/＞,/＞；步骤5：用分割点t1、t2将吸光度序列A0分割成区间A1、A2、A3，三个区间内光谱点数分别为n1、n2、n3，分别在各个区间内使用SG滤波，初始参数为窗口w=5，阶数g=3，滤波后数据分别为、/＞、/＞,残差ε1、ε2、ε3，残差按下式计算：；；；遍历参数，先固定阶数，遍历窗口，窗口w1每次加2，阶数g1每次加1，反复迭代计算新的残差，直至ε1大于s1，停止迭代，此时得到参数w1、g1为SG滤波最优参数，同样的方法得到w2、g2、w3、g3；步骤6：使用步骤5得到的最优参数在对应的A1、A2、A3区间内执行滑动窗口多项式拟合，每个点的拟合系数为p，即：；其中，；根据拟合系数计算此多项式在窗口中心点处的一阶、二阶导数，计算公式为：；；在窗口中心处i=0；，/＞；按照上述公式，滑动窗口逐点计算窗口中心点导数值，直接得到滤波后的一阶导数和二阶导数/＞。本发明通过上述方案，具有如下优点：1、结合水果透射光谱特性按信噪比划分最优区间，在各区间内以区间平均噪音为阈值限制寻找最优滤波参数，从而取得信噪比的一、二阶导数，从而可有效减少微分求导增加的噪音，进而提高数据质量。现有技术中，SG滤波是一种很常用的滤波方法，本发明通过对SG滤波进行优化，增加最优区间分割步骤，计算每段区间噪音，以噪音为优化阈值调整滤波参数，这样能保证各区间使用的都是最优参数；2、现有技术中的方案一般是直接差分求导，而直接差分求导会增加噪音，每增加一阶导数都会增加一次噪音，导致二阶导信噪比很低，本发明采用拟合函数求导代替差分运算，从而进一步减少微分求导增加的噪音；3、本发明将优化后的SG滤波和求导融合，有效减少常用的差分求导格外附加的噪音，提高了数据质量，为后续建模提供了良好的基础。本发明实施例还提供一种计算机可读介质，该计算机可读介质存储有处理器可执行的程序代码，所述程序代码使所述处理器执行上述光谱预处理方法。本发明实施例还提供一种适用于近红外水果无损检测的光谱预处理装置，其包括：吸光度计算模块，用于测定吸光度；噪音分布计算模块，用于使用二阶差分计算其光谱数据的总体噪音分布；最优滤波参数计算模块：用于根据噪音分布对光谱数据进行自适应阈值分割，形成多个分割区间，在每个分割区间内计算各自区间的噪音，以残差小于噪音阈值为优化目标对原始光谱各区间进行循环自适应参数SG滤波，以获得最优滤波参数；多项式拟合模块：用于使用最优滤波参数在各自区间内对光谱数据进行滑动多项式拟合，对每个点的拟合多项式在当前点处求导；所有点导数计算模块：用于逐点计算吸光度数据所有点的导数。此外，本发明的方法不限于按照说明书中描述的时间顺序来执行，也可以按照其他的时间顺序地、并行地或独立地执行。因此，本说明书中描述的方法的执行顺序不对本发明的技术范围构成限制。尽管上面已经通过对本发明的具体实施例的描述对本发明进行了披露，但是，应该理解，上述的所有实施例和示例均是示例性的，而非限制性的。本领域的技术人员可在所附权利要求的精神和范围内设计对本发明的各种修改、改进或者等同物。这些修改、改进或者等同物也应当被认为包括在本发明的保护范围内。
