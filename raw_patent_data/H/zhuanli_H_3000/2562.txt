标题title
实现超快速静噪功能的光模块、系统及方法
摘要abst
本发明涉及光通信领域，尤其涉及一种实现超快速静噪功能的光模块、系统及方法，通过在现有方案的基础上增设比较器、与非门等硬件电路，比较器通过比对实时电平信号和参考电平信号，向与非门输出比较电平信号，与非门对接收的比较电平信号和管脚电平信号做与非逻辑运算，并根据运算结果向4通道CDR集成芯片提供控制电平信号，实现4通道集成CDR芯片的快速TX Squelch功能；该方案完全可以满足纳秒级别的要求，从而实现极速响应系统异常的目的，为系统维护提供有力保障。
权利要求书clms
1.一种实现超快速静噪功能的光模块，其特征在于，包括多通道CDR集成芯片、激光器芯片、调压电路、比较器、与非门及光模块用微控制器，多通道CDR集成芯片与光模块用微控制器通讯连接；所述多通道CDR集成芯片包括LOS单元、逻辑门电路、CDR&amp;Driver单元，并定义有LOL管脚和TXDIS管脚；所述LOS单元用于接收和处理客户侧系统主板发射的电信号，并分发给CDR&amp;Driver单元和逻辑门电路，所述逻辑门电路用于接收和处理LOS单元发出的电信号，并通过LOL管脚输出实时电平信号；所述TXDIS管脚用于接收与非门发出的控制电平信号，并根据控制电平信号控制CDR&amp;Driver单元的启闭；所述CDR&amp;Driver用于向激光器芯片输出电信号；所述激光器芯片将接收的电信号转换为光信号输出；所述光模块用微控制器包括VDAC单元，并定义有输出管脚，所述VDAC单元通过调压电路向比较器提供参考电平信号，所述光模块用微控制器通过输出管脚向与非门提供管脚电平信号；所述比较器用于接收和比较参考电平信号和实时电平信号，并向与非门输出比较电平信号；所述与非门用于接收比较电平信号和管脚电平信号，并通过与非逻辑运算向TXDIS管脚输出控制电平信号。2.如权利要求1所述的一种实现超快速静噪功能的光模块，其特征在于，所述参考电平信号的电压值设定在0.3V-1.5V之间。3.如权利要求1所述的一种实现超快速静噪功能的光模块，其特征在于，所述参考电平信号的电压值设定在1.2V。4.如权利要求1所述的一种实现超快速静噪功能的光模块，其特征在于，所述光模块用微控制器定义有输入管脚，光模块用微控制器通过输入管脚来接收通过LOL管脚输出的实时电平信号。5.如权利要求1所述的一种实现超快速静噪功能的光模块，其特征在于，所述光模块用微控制器包括寄存器，寄存器用于接收客户侧系统主板发出的指令，来控制管脚电平信号。6.一种实现超快速静噪功能的系统，包括客户侧系统主板，客户侧系统主板包括客户侧用微控制器，其特征在于，还包括权利要求1至5任一所述的实现超快速静噪功能的光模块，所述客户侧用微控制器与光模块用微控制器之间通讯连接。7.一种基于权利要求1至5任一所述的光模块的实现超快速静噪功能的方法，其特征在于，包括以下步骤，多通道CDR集成芯片向比较器提供实时电平信号，光模块用微控制器向比较器提供参考电平信号，光模块用微控制器向与非门提供管脚电平信号；比较器通过比对实时电平信号和参考电平信号，向与非门输出比较电平信号；若实时电平信号小于参考电平信号，则比较电平信号为低电平信号，反之，则比较电平信号为高电平信号；与非门对接收的比较电平信号和管脚电平信号做与非逻辑运算，并根据运算结果向多通道CDR集成芯片提供控制电平信号；多通道CDR集成芯片根据控制电平信号启闭CDR&amp;Driver单元。8.如权利要求7所述的一种实现超快速静噪功能的方法，其特征在于，所述与非门的与非逻辑运算为：当比较电平信号为低电平信号，管脚电平信号为低电平信号，则控制电平信号为高电平信号；当比较电平信号为低电平信号，管脚电平信号为高电平信号，则控制电平信号为高电平信号；当比较电平信号为高电平信号，管脚电平信号为低电平信号，则控制电平信号为高电平信号；当比较电平信号为高电平信号，管脚电平信号为高电平信号，则控制电平信号为低电平信号。9.如权利要求7所述的一种实现超快速静噪功能的方法，其特征在于，包括以下步骤，光模块用微控制器根据客户侧系统主板发出的指令，通过寄存器赋值，来控制管脚电平信号变为高电平信号或低电平信号。
说明书desc
技术领域本发明涉及光通信领域，尤其涉及一种实现超快速静噪功能的光模块、系统及方法。背景技术数据中心作为云计算最重要的基础设施之一，云计算的高景气度以及云服务厂商扩大的资本开支直接带动了数据中心的繁荣度。长期来看，数据流量保持高速增长的趋势几乎是不可逆的，随着5G的大规模建设，万物互联将使得流量呈爆发式增长，同时VR/AR、超高清视频和车联网等下游爆款应用也将带来海量的流量需求，因此长期来看，全球数据流量必将呈现高速增长的态势。在此大趋势下，数据中心的叶脊架构升级，以及速率升级在日益强劲的需求面前刻不容缓，将带来数通光模块数量以及速率提升的强劲需求。而低速率的光通信产品已经不能满足日常的数据传输需求，光模块的数据传输也已从10G、25G、40G等提速到100G、200G甚至400G。目前市场上的100G光模块封装有CFP、CFP2、CFP4和QSFP28，其中QSFP28光模块因为体积更小，可以插入更高密度接口的交换机，成为100G光模块的主流方案。由于100GQSFP28 LR4光模块在市场上的热度，出现了以下需求：部分终端客户要求100G QSFP28 LR4光模块支持纳秒级别的快速TX Squelch，而非传统的慢速TX Squelch。针对上述需求，众多国内外芯片设计厂家跟进，试图开发出支持100G QSFP28 LR4运用的4通道CDR集成芯片，由于各种原因，有些厂家的发射4通道CDR集成芯片不支持硬件TX Squelch，也就无法满足终端客户提出来的纳秒级别的快速TX Squelch。即使作为光模块厂家在使用了此类4通道CDR集成芯片方案后，可以通过借助于MCU芯片，再加上软件寄存器赋值的方式来实现，但也只是做到了被业界称为的软件TX Squelch功能，耗时在400百毫秒左右，在响应时间上远远无法满足终端客户提出的纳秒级别的快速TX Squelch，差距高达几千倍。如图1所示，为现有的100G QSFP28 LR4光模块与客户侧主板的结合系统，当HOST无正常调制数据信号输出给到光模块时，若不关闭激光器laser1~4，光模块依然可以发出直流光而非正常的带有调制数据信息的光信号，对于高速通信系统而言，这种直流光，毫无意义而言，将导致系统误判，所以在此异常情况下，应该快速关闭laser1~4光芯片，即实现TX Squelch功能。对于上述异常情况下，通常采用下述两种方式来实现TXSquelch：1. 当光模块内部的MCU2的管脚Port1在侦测到集成CDR芯片输出管脚LOL为低电平时，MCU2内部固件将其管脚Port2设置为高电平，使得4通道集成CDR芯片的TXDIS管脚为高电平，从而关闭激光器芯片laser1~4，实现光模块不发光，此过程持续时间为400毫秒左右，无法满足纳秒级别的TX Squelch；2. HOST内的微控制器MCU1通过I2C总线I2C_M给光模块内部下达指令，将寄存器字节Byte231设置为十六进制0XF，或者将寄存器字节Byte86设置为十六进制0XF，此时光模块内部的微控制器MCU2会将其管脚Port2设置为高电平，从而达到关闭激光器芯片laser1~4，使得光模块不发光，但此过程耗费的时间要超过第1点方案，更加满足不了纳秒级别的快速TX Squelch。基于此，本案由此提出。发明内容本发明的目的之一在于提供一种实现超快速静噪功能的光模块，通过硬件电路方案，实现纳秒级别的TX Squelch功能。为了实现上述目的，本发明的技术方案如下：一种实现超快速静噪功能的光模块，包括多通道CDR集成芯片、激光器芯片、调压电路、比较器、与非门及光模块用微控制器，多通道CDR集成芯片与光模块用微控制器通讯连接；所述多通道CDR集成芯片包括LOS单元、逻辑门电路、CDR&amp;Driver单元，并定义有LOL管脚和TXDIS管脚；所述LOS单元用于接收和处理客户侧系统主板发射的电信号，并分发给CDR&amp;Driver单元和逻辑门电路，所述逻辑门电路用于接收和处理LOS单元发出的电信号，并通过LOL管脚输出实时电平信号；所述TXDIS管脚用于接收与非门发出的控制电平信号，并根据控制电平信号控制CDR&amp;Driver单元的启闭；所述CDR&amp;Driver用于向激光器芯片输出电信号；所述激光器芯片将接收的电信号转换为光信号输出；所述光模块用微控制器包括VDAC单元，并定义有输出管脚，所述VDAC单元通过调压电路向比较器提供参考电平信号，所述光模块用微控制器通过输出管脚向与非门提供管脚电平信号；所述比较器用于接收和比较参考电平信号和实时电平信号，并向与非门输出比较电平信号；所述与非门用于接收比较电平信号和管脚电平信号，并通过与非逻辑运算向TXDIS管脚输出控制电平信号。进一步的，所述参考电平信号的电压值设定在0.3V-1.5V之间。进一步的，所述参考电平信号的电压值设定在1.2V。进一步的，所述光模块用微控制器定义有输入管脚，光模块用微控制器通过输入管脚来接收通过LOL管脚输出的实时电平信号。进一步的，所述光模块用微控制器包括寄存器，寄存器用于接收客户侧系统主板发出的指令，来控制管脚电平信号。本发明的目的之二在于提供一种实现超快速静噪功能的系统，包括客户侧系统主板，客户侧系统主板包括客户侧用微控制器，还包括上述实现超快速静噪功能的光模块，所述客户侧用微控制器与光模块用微控制器之间通讯连接。本发明的目的之三在于提供一种基于上述光模块的实现超快速静噪功能的方法，包括以下步骤，多通道CDR集成芯片向比较器提供实时电平信号，光模块用微控制器向比较器提供参考电平信号，光模块用微控制器向与非门提供管脚电平信号；比较器通过比对实时电平信号和参考电平信号，向与非门输出比较电平信号；若实时电平信号小于参考电平信号，则比较电平信号为低电平信号，反之，则比较电平信号为高电平信号；与非门对接收的比较电平信号和管脚电平信号做与非逻辑运算，并根据运算结果向多通道CDR集成芯片提供控制电平信号；多通道CDR集成芯片根据控制电平信号启闭CDR&amp;Driver单元。进一步的，所述与非门的与非逻辑运算为：当比较电平信号为低电平信号，管脚电平信号为低电平信号，则控制电平信号为高电平信号；当比较电平信号为低电平信号，管脚电平信号为高电平信号，则控制电平信号为高电平信号；当比较电平信号为高电平信号，管脚电平信号为低电平信号，则控制电平信号为高电平信号；当比较电平信号为高电平信号，管脚电平信号为高电平信号，则控制电平信号为低电平信号。进一步的，还可兼容传统的慢速TX Squelch功能，包括以下步骤，光模块用微控制器根据客户侧系统主板发出的指令，通过寄存器赋值，来控制管脚电平信号变为高电平信号或低电平信号。本发明的优点在于：1. 采用增设比较器和与非门的方式，通过硬件电路实现TX Squelch功能，完全可以满足纳秒级别的要求，从而实现极速响应系统异常的目的，为系统维护提供有力保障；2. 使用光模块用微控制器内部的一个数模转换端口，配合由精密电阻组成的调压电路，可以方便调节参考电平信号，使得比较器输出的比较电平信号可以准确无误地跟踪实时电平信号，便于与非逻辑运算；3. 由于多通道CDR集成芯片和微控制器MCU输出的电平信号定义规则不同，通过增加比较器，将多通道CDR集成电芯片的LOL管脚电平从CMOS电平转换为0~3.3V，从而保证与之电气连接的下级与非门电路的2个输入端口的电平信号，是同一种电平信号；4. 本发明系统可同时兼容传统的慢速TX Squelch功能，提升了方案的适用性。附图说明图1为现有技术中100G QSFP28 LR4光模块与客户侧主板的结合系统示意图；图2为实施例中100G QSFP28 LR4光模块与客户侧主板的结合系统示意图；图3为实施例中参考电平信号的电压值设定示意图；图4为实施例中设定参考电平信号的电压值为1.2V时，光模块用微控制器和比较器上的电压值和电阻值示意图。具体实施方式以下结合实施例对本发明作进一步详细描述。英文注释：HOST：客户侧系统主板，给实施例中100G QSFP28 LR4光模块提供电源和调制数据信号；TX：发射端电通道；LOS：Loss of signal，输入信号缺失，实施例中，LOS1~LOS4是光模块内部4通道CDR集成电芯片电路功能块之一，针对HOST侧输出的TX1~4高速调制数据信号的幅度与预先设置的参考阈值进行判决后输送至后级逻辑门电路；TXDIS：实施例中4通道CDR集成电芯片使能管脚，当接收到高电平时关闭所有CDR&amp;Driver1~4输出电流，进而关闭激光器光芯片laser1~4，完成TX Squelch功能；CDR&amp;Driver：时钟数据恢复+驱动，是实施例中4通道CDR集成电芯片电路功能块之一，实施例中，CDR&amp;Driver1~4给光模块的激光器光芯片laser1~4，提供调制数据信号电流和直流偏置电流；Laser，激光器光芯片，实施例中，Laser1~4作为光信号的载体，将系统主板侧的数据电信号，转成光信号发射出去；VDAC：电压形数模转成功能电路。如图2所示，本实施例提出一种实现超快速静噪功能的系统，包括客户侧系统主板HOST和由4通道CDR集成芯片、激光器芯片Laser1~4、调压电路、比较器、与非门、光模块用微控制器MCU2组成的100G QSFP28 LR4光模块。客户侧系统主板，通过电通道TX1~4给100G QSFP28 LR4光模块提供电源和调制数据电信号，其内部设有客户侧微控制器MCU1，该客户侧微控制器MCU1与光模块用微控制器MCU2通过I2C总线通讯连接，实现数据存储和通讯。4通道CDR集成芯片内部设有LOS单元、逻辑门电路、CDR&amp;Driver单元、LOL管脚和TXDIS管脚。LOS单元用于接收和处理客户侧系统主板HOST发射的电信号，并分发给CDR&amp;Driver单元和逻辑门电路，逻辑门电路用于接收和处理LOS单元发出的电信号，并通过LOL管脚输出实时电平信号；所述TXDIS管脚用于接收与非门发出的控制电平信号VTDIS，并根据控制电平信号VTDIS控制CDR&amp;Driver单元的启闭；所述CDR&amp;Driver用于向激光器芯片输出电信号。激光器芯片Laser1~4将接收的电信号转换为光信号输出。光模块用微控制器包括VDAC单元，并定义有输出管脚Port2，所述VDAC单元通过调压电路向比较器提供参考电平信号VC，本实施例中，调压电路由精密电阻R1和R2组成。使用光模块用微控制器MCU2内部的一个数模转换端口，配合由精密电阻R1和R2组成的调压电路，可以方便调节参考电平信号VC，使得比较器输出的比较电平信号可以准确无误地跟踪实时电平信号。光模块用微控制器通过输出管脚向与非门提供管脚电平信号VMCU2。比较器用于接收和比较参考电平信号VC和实时电平信号，并向与非门输出比较电平信号VCO。由于4通道CDR集成芯片和光模块用微控制器MCU2输出的电平信号定义规则不同，通过增加比较器，将多通道CDR集成电芯片的LOL管脚电平从CMOS电平转换为0~3.3V，从而保证与之电气连接的下级与非门电路的2个输入端口的电平信号，是同一种电平信号，便于与非逻辑运算。与非门用于接收比较电平信号VCO和管脚电平信号VMCU2，并通过与非逻辑运算向TXDIS管脚输出控制电平信号VTDIS。参考电平信号VC的电压值设定如下：如图3和图4所示，根据4通道CDR集成电芯片规格书，当LOL管脚输出的实时电平信号为高电平时，电平值为1.5~1.92v，当LOL管脚输出的实时电平信号为低电平时，电平值为＜0.3v，此实时电平信号是连接到比较器的负端输入端口，因此理论推算，参考电平信号VC电平值设定在0.3~1.5V之间都可以，本实施例建议将此参考电平信号VC取值为1.2V左右，这样电阻R1和R2，可以共用一颗物料，以有利于产品BOM的管理。作为优选，本实施例光模块用微控制器MCU2还定义有输入管脚Port1，光模块用微控制器MCU2通过输入管脚Port1来接收通过LOL管脚输出的实时电平信号。这样设置的目的在于，可以方便用于在有需要时，可以查看LOL管脚输出的实时电平值的大小。上述的系统的使用过程如下所述：S01.系统上电运行，插在系统板卡上的100G QSFP28 LR4光模块得电，并开始运作，其内部的4通道CDR集成电芯片的LOS1~4单元会实时判断并识别由电通道TX1~4输送过来的高速调制数据电信号的幅度，然后各自输出进入到后级的逻辑门电路和CDR&amp;Driver单元，逻辑门电路做逻辑运算后输出实时电平信号至比较器的正端输入口；光模块用微控制器MCU2向比较器提供参考电平信号VC，光模块用微控制器MCU2向与非门提供管脚电平信号VMCU2；S02. 比较器通过比对实时电平信号和参考电平信号VC，向与非门输出比较电平信号VCO；若电通道TX1~4当中任何一个有异常，那么逻辑门电路输出的实时电平信号为低电平信号，电平值＜0.3v，此低电平输送至比较器的正端输入端口，并和负端输入端口VC=1.2V做对比，那么比较器输出端口输出的比较电平信号VCO为低电平信号；若TX1~4都是正常的，那么逻辑门电路输出的实时电平信号为高电平，电平值在1.5~1.92v，此高电平信号输送至比较器的正端输入端口，并和负端输入端口VC=1.2V做对比，那么比较器输出端口输出的比较电平信号VCO为高电平；S03. 与非门对接收的比较电平信号VCO和管脚电平信号VMCU2做与非逻辑运算，并根据运算结果向4通道CDR集成芯片提供控制电平信号VTDIS；本实施例中，与非门的与非逻辑运算如下表所示：VCOVMCU2VTDISLLHLHHHLHHHL依据上表，可以得出：a. 当比较电平信号VCO为低电平信号，管脚电平信号VMCU2为低电平信号，则控制电平信号VTDIS为高电平信号；b. 当比较电平信号VCO为低电平信号，管脚电平信号VMCU2为高电平信号，则控制电平信号VTDIS为高电平信号；c. 当比较电平信号VCO为高电平信号，管脚电平信号VMCU2为低电平信号，则控制电平信号VTDIS为高电平信号；d. 当比较电平信号VCO为高电平信号，管脚电平信号VMCU2为高电平信号，则控制电平信号VTDIS为低电平信号；故在比较电平信号VCO和/或管脚电平信号VMCU2为低电平信号时，控制电平信号VTDIS都是高电平信号，进而可以关闭激光器芯片laser1~4，当比较电平信号VCO为高电平信号时，控制电平信号VTDIS的高低取决于管脚电平信号VMCU2，而一般情况下，管脚电平信号VMCU2保持为高电平信号；S04. 多通道CDR集成芯片根据控制电平信号启闭CDR&amp;Driver单元，即当控制电平信号为高电平信号时，TXDIS管脚处高电平，进而通过关闭CDR&amp;Driver单元，来关闭激光器芯片laser1~4，达到快速TX Squelch功能；控制电平信号为低电平信号时，TXDIS管脚处低电平，光模块正常工作。通过上述步骤可以看出，本实施例方案里面增加的硬件电路，在系统异常时，能快速响应，并关闭激光器芯片，达到快速TX Squelch功能，在系统正常运行时，该硬件电路对光模块无任何干扰。在实现快速TX Squelch的同时，本实施例方案还可向下兼容慢速TX Squelch。光模块用微控制器包括寄存器，寄存器用于接收客户微控制器MCU1发出的指令，来控制管脚电平信号。如图2所示，当系统运行异常时，客户侧微控制器MCU1通过I2C总线I2C_M给光模块用微控制器MCU2下达指令，将寄存器字节Byte231设置为十六进制0XF，或者将寄存器字节Byte86设置为十六进制0XF，此时光模块用微控制器MCU2会将其输出管脚Port2设置为低电平，即管脚电平信号VMCU2为低电平，根据与非门的真值表可知，控制电平信号VTDIS为高电平，从而关闭激光器芯片laser1~4，使得光模块不发光，实现了传统的软TX Squelch功能，即慢速TX Squelch功能。在系统正常运作状态下，即当客户侧系统主板HOST没有下指令更改光模块寄存器Byte231或者字节Byte86的默认设置值，也即没有要求光模块进入慢速TX Squelch状态，那么光模块用微控制器MCU2会将其输出管脚Port2设置为高电平，即VMCU2为高电平，根据与非门的真值表可知，与非门的输出管脚VTDIS为低电平，则光模块正常发光，系统正常运作。上述实施例仅用于解释说明本发明的构思，而非对本发明权利保护的限定，凡利用此构思对本发明进行非实质性的改动，均应落入本发明的保护范围。
