标题title
一种基于RDM协议的设备自编址方法
摘要abst
本发明提供一种基于RDM协议的设备自编址方法，该方法包括：目标RDM设备将自身MAC地址及自身的通道数上传至RDM总线；目标RDM设备从RDM总线上采集其余RDM设备的数据；根据各RDM设备的通道数以及各通道数对应的RDM设备的数量对RDM总线上的各RDM设备进行地址码分区，根据各RDM设备的通道数大小对地址码分配区进行排列；目标RDM设备产生第一随机数，应用第一随机数计算目标RDM设备在地址码分配区的预测地址码；目标RDM设备将预测地址码发送至RDM总线，若在预设时间内目标RDM设备未收到回复，则目标RDM设备将预测地址码确定为自身的目标地址码。本发明能够解决具有RDM通讯功能的设备能够利用自身RDM协议完成自动分配地址码，减少人工成本和设备成本的问题。
权利要求书clms
1.一种基于RDM协议的设备自编址方法，其特征在于：目标RDM设备将自身MAC地址及自身的通道数上传至RDM总线；所述目标RDM设备从所述RDM总线上采集其余RDM设备的数据，其余RDM设备的数据包括各RDM设备的通道数以及各通道数对应的RDM设备的数量；根据各RDM设备的通道数以及各通道数对应的RDM设备的数量对所述RDM总线上的各RDM设备进行地址码分区，所述通道数相同的RDM设备分在同一个地址码分配区，根据各RDM设备的所述通道数大小对所述地址码分配区进行排列；所述目标RDM设备产生第一随机数，应用所述第一随机数计算所述目标RDM设备在地址码分配区的预测地址码；所述目标RDM设备将所述预测地址码发送至所述RDM总线，若在预设时间内所述目标RDM设备未收到回复，则所述目标RDM设备将所述预测地址码确定为自身的目标地址码，在预设时间内所述目标RDM设备收到回复，所述目标RDM设备产生第二随机数，并应用所述第二随机数计算所述目标RDM设备在地址码分配区的新的预测地址码，向所述RDM总线发送所述新的预测地址码。2.根据权利要求1所述的基于RDM协议的设备自编址方法，其特征在于：根据各RDM设备的所述通道数大小对所述地址码分配区进行排列包括：根据各RDM设备的所述通道数大小，以所述通道数从大到小的方式或者以所述通道数从小到大的方式对所述地址码分配区进行排列。3.根据权利要求1或2所述的基于RDM协议的设备自编址方法，其特征在于：一个所述地址码分配区的起始地址码为上一个地址码分配区的终止地址码的下一位，一个所述地址码分配区的长度为该地址码分配区对应的通道数乘以该地址码分配区对应的所述RDM设备的数量。4.根据权利要求1或2所述的基于RDM协议的设备自编址方法，其特征在于：所述第一随机数为正整数且小于或等于该所述通道数对应的RDM设备数量；所述第二随机数为正整数且小于或等于该所述通道数对应的RDM设备数量。5.根据权利要求3所述的基于RDM协议的设备自编址方法，其特征在于：所述预测地址码为当前地址码分配区对应的通道数与所述第一随机数相乘再加上所述上一个地址码分配区的终止地址码。6.根据权利要求5所述的基于RDM协议的设备自编址方法，其特征在于：若当前地址码分配区对应的通道数为所述RDM总线上为最大通道数，则所述上一个地址码分配区的终止地址码为0。7.根据权利要求1或2所述的基于RDM协议的设备自编址方法，其特征在于：所述目标RDM设备将所述预测地址码发送至所述RDM总线包括：所述目标RDM设备连续发送三次将所述预测地址码至所述RDM总线。8.根据权利要求1或2所述的基于RDM协议的设备自编址方法，其特征在于：所述目标RDM设备确定自身的目标地址码后，所述目标RDM设备的各通道从所述目标地址码开始往后占用多个地址码，所述目标RDM设备的各通道的地址码相邻。9.根据权利要求1或2所述的基于RDM协议的设备自编址方法，其特征在于：所述目标RDM设备将自身MAC地址及自身的通道数上传至RDM总线前，生成第三随机数，应用所述第三随机数作为计时值进行计时，在计时时间结束后将自身MAC地址及自身的通道数上传至RDM总线。
说明书desc
技术领域本发明涉及信息控制技术领域，具体是涉及一种基于RDM协议的设备自编址方法。背景技术RDM是远程设备管理协议，其以高效的信息交互方式，在景观照明、舞台灯光控制等领域等到广泛应用。如果希望具有RDM通讯功能的设备能够被独立控制，则需要为每一个RDM设备的每一通道设置一个独立的地址码。具有RDM通讯功能的设备能够利用自身RDM协议完成自动分配地址码，减少人工成本和设备成本是本申请要解决的问题。如果智能灯具应用RDM协议，传统分配地址码的方法是由技术人员攀爬至灯具的位置，通过控制台或者主控电脑对每台设备进行设置，使得每台设备都拥有唯一的地址码，为各个RDM设备设置地址的工作十分繁琐，耗费大量人力和时间。现有自动分配地址码的方法包括在各设备之间通过485信号线通信来完成地址分配，这需要设备兼容485信号线，设备之间的485信号线串联，设备通过485信号线将自身地址码与自身的通道数发送至下一台设备，得到下一台设备的地址码。由于这种方案需要在设备上增加485信号线，会增加设备的成本。发明内容本发明的目的是提供一种减少人工和设备成本的基于RDM协议的设备自编址方法。为了实现上述的第一目的，本发明提供的一种基于RDM协议的设备自编址方法包括：目标RDM设备将自身MAC地址及自身的通道数上传至RDM总线；目标RDM设备从RDM总线上采集其余RDM设备的数据，其余RDM设备的数据包括各RDM设备的通道数以及各通道数对应的RDM设备的数量；根据各RDM设备的通道数以及各通道数对应的RDM设备的数量对RDM总线上的各RDM设备进行地址码分区，通道数相同的RDM设备分在同一个地址码分配区，根据各RDM设备的通道数大小对地址码分配区进行排列；目标RDM设备产生第一随机数，应用第一随机数计算目标RDM设备在地址码分配区的预测地址码；目标RDM设备将预测地址码发送至RDM总线，若在预设时间内目标RDM设备未收到回复，则目标RDM设备将预测地址码确定为自身的目标地址码，在预设时间内目标RDM设备收到回复，目标RDM设备产生第二随机数，并应用第二随机数计算目标RDM设备在地址码分配区的新的预测地址码，向RDM总线发送新的预测地址码。由上述方案可见，在确认RDM设备的地址码时，首先通过通道数确定地址码分区，确认分区后通过第一随机数确认该RDM设备在该地址码分区的具体位置。该RDM设备将通过第一随机数产生的预测地址码发送到总线上试探，如果没有收到RDM总线的回复，证明该地址码没有其余的RDM设备占用，该RDM设备可占用该地址码。如果收到回复，则说明该地址码已被其余RDM设备占用，RDM设备产生第二随机数确认新预测地址码向RDM总线发送。根据各RDM设备的通道数大小，以通道数从大到小的方式或者以通道数从小到大的方式对地址码分配区进行排列。由此可见，对地址码分配区按顺序进行排列便于后续计算地址码和以及对RDM设备进行分配。进一步的方案中，一个地址码分配区的起始地址码为上一个地址码分配区的终止地址码的下一位，一个地址码分配区的长度为该地址码分配区对应的通道数乘以该地址码分配区对应的RDM设备的数量。由此可见，当总线上有3个5通道RDM设备，2个4通道RDM设备，4个3通道RDM设备，则5通道RDM设备的地址码分配区的起始地址码为1，长度为15，终止地址码为15。4通道设备的地址码分配区的起始地址码为16，长度为8，终止地址码为23。3通道设备的地址码分配区起始地址码为24，长度为12，终止地址码为35。其余通道数的地址码分配区以此类推。进一步的方案中，第一随机数为正整数且小于或等于该通道数对应的RDM设备数量；第二随机数为正整数且小于或等于该通道数对应的RDM设备数量。由此可见，第一随机数和第二随机数为正整数并且小于或等于拥有通道数相同的RDM设备数量才能使RDM设备分配到的预测地址码落在该RDM设备的地址码分配区中。进一步的方案中，预测地址码为当前地址码分配区对应的通道数与第一随机数相乘再加上上一个地址码分配区的终止地址码。由此可见，当有3个5通道RDM设备，2个4通道设备，则一个4通道的RDM设备在分配预测地址码时，产生随机数为1，生成预测地址码为15+4×1＝19。进一步的方案中，若当前地址码分配区对应的通道数为RDM总线上为最大通道数，则上一个地址码分配区的终止地址码为0。由此可见，由于RDM总线上最大通道数的RDM设备的地址码分配区排列位置在RDM总线最前面，所以将上一地址码分配区的终止地址码视为0。进一步的方案中，目标RDM设备将预测地址码发送至RDM总线包括：目标RDM设备连续发送三次将预测地址码至RDM总线。由此可见，RDM设备连续发送三次预测地址码至RDM总线的目的是确保RDM总线能够收到RDM设备的信息，而不是数据传输时出现错误而导致RDM总线没有收到信息而没有回复。进一步方案中，目标RDM设备确定自身的目标地址码后，目标RDM设备的各通道从目标地址码开始往后占用多个地址码，目标RDM设备的各通道的地址码相邻。由此可见，RDM设备确定地址码后，这个地址码为RDM设备的起始地址码，RDM的设备的从这个地址码开始占用地址码，且该RDM设备的各通道的地址码相邻。例如，5通道RDM设备，起始地址码为1时，其通道占用地址码为1、2、3、4、5。进一步方案中，目标RDM设备将自身MAC地址及自身的通道数上传至RDM总线前，生成第三随机数，应用第三随机数作为计时值进行计时，在计时时间结束后将自身MAC地址及自身的通道数上传至RDM总线。由此可见，用随机数作为计时值计时，可以使各个RDM设备错开时间将数据发送RDM总线上。附图说明图1是基于RDM协议的设备自编址方法实施例的流程图。图2是基于RDM协议的设备自编址方法实施例地址码统计简示图。以下结合附图及实施例对本发明作进一步说明。具体实施方式参见图1，本实施例中，提供一种基于RDM协议的设备自编址方法实施例的流程图。其中，多个RDM设备均连接至RDM总线，每一个RDM设备均可以向RDM总线发送数据，并可以从RDM总线上获取数据。本实施例首先执行步骤S1，目标RDM设备将自身MAC地址及自身通道数上传至RDM总线。上报自身MAC地址和通道数可以让RDM总线收集的RDM设备信息，返回至RDM设备上。目标RDM设备向RDM总线上报完信息后，执行步骤S2，目标RDM设备从RDM总线上采集其余RDM设备的数据。RDM设备收集到其余RDM设备的数据解析并统计，统计RDM总线上有几通道的设备各几台，以便进行下一步地址码分区。目标RDM设备从RDM总线上采集其余RDM设备的数据后，执行步骤S3，根据各RDM设备的通道数以及通道数对应的RDM的数量对RDM总线上的各RDM设备进行地址码分区。通道数相同的RDM设备分在同一地址码分配区上。地址码分配区根据RDM通道数的大小从大到小或者从小到大进行排列。本实施例的地址码分配区是根据RDM设备通道数的大小从大到小进行排列。各个地址码分配区的计算方式为：一个地址码分配区的起始地址码为上一个地址码分配区的终止地址码的下一位，一个地址码分配区的长度为该地址码分配区对应的通道数乘以该地址码分配区对应的RDM设备的数量。例如，总线上有3个5通道RDM设备，2个4通道RDM设备，4个3通道RDM设备，则5通道RDM设备的地址码分配区的起始地址码为1，长度为15，即终止地址码为15；4通道设备的地址码分配区的起始地址码为16，长度为8，终止地址码为23，3通道设备的地址码分配区的起始地址码为24，长度为12，终止地址码为35，其余通道数的地址码分配区以此类推。执行步骤S3后，执行步骤S4，目标RDM设备产生第一随机数，应用第一随机数计算目标RDM设备在地址码分配区的预测地址码。RDM设备产生的第一随机数要为正整数以及小于或等于与该RDM设备通道数相同的RDM设备的数量。预测地址码的计算方式为：当前地址码分配区对应的通道数与第一随机数相乘再加上上一个地址码分配区的终止地址码。例如，有3个5通道RDM设备，2个4通道设备，则4通道设备在分配预测地址码时，产生随机数为1，生成预测地址码为15+4×1＝19。当RDM设备的通道数在RDM总线上是最大的通道数，则该RDM设备的地址码分配区前没有地址码分配区，则该RDM设备的前地址码分配区的最后一个地址码可视为0。当总线上有3个5通道RDM设备，2个4通道RDM设备，4个3通道RDM设备时，5通道RDM设备其中一个RDM设备产生随机数为2，则其预测地址码为：0+5×2＝10。执行步骤S4后，执行步骤S5，目标RDM设备发送地址码至RDM总线上。为了防止数据传输或者其余使得RDM设备没有将预测地址码发送至RDM总线上，目标RDM设备需要连续发送3次预测地址码至RDM总线上。然后，执行步骤S6，目标RDM设备判断是否接收到RDM总线的回复。若RDM总线没有回复，则证明该预测地址码没有其他设备使用，则执行步骤S7，目标RDM设备可以占用预测地址码，让其成为自己的地址码。若RDM总线有回复，则证明该预测地址码已被其它RDM设备占用，此时执行步骤S8，目标RDM设备产生新的随机数，通过新的随机数确定目标RDM设备在地址码分配区新的预测地址码。这个新的随机数不能与第一随机数的数值相同。然后，返回执行步骤S5，再次将新的预测地址码发送至RDM总线，直到RDM总线对新的预测地址码没有回复。参照图2，图2是基于RDM协议的设备自编址方法实施例地址码统计简示图。其中，字母a、b、c、d、e是RDM设备的数量，字母前面的数字表示的是RDM设备的通道数。当a、b、c、d、e分别为3、2、4、7、4时，5通道设备的地址码分配区在1-15，4通道设备的地址码分配区在16-23，3通道设备的地址码分配区在36-49，2通道设备的地址码分配区在50-53。上述仅为本发明的较佳实施例，但发明的设计构思并不局限于此，在不脱离本发明构思的情况下，还可以包括更多其他等效实施例，对本领域技术人员来说能够进行各种明显的变化、重新调整和替代而不会脱离本发明的保护范围。
