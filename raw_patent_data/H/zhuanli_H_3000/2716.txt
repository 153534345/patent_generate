标题title
基于反向代理和动态脚本的请求处理方法及装置
摘要abst
本发明公开了一种基于反向代理和动态脚本的请求处理方法及装置，属于计算机网络技术领域。所述方法包括：将预设的规则策略文本加载到反向代理的全局共享字典中；接收来自客户端的HTTP请求；根据全局共享字典中的规则策略文本对HTTP请求进行校验；若HTTP请求通过校验，则将HTTP请求的参数名和参数值进行排序拼接得到第一拼接结果；将第一拼接结果进行哈希运算得到第一哈希值；根据第一哈希值从高速缓存中获取HTTP请求对应的请求结果；若高速缓存中没有所述请求结果，则请求至后端的应用服务器进行处理。本发明将不符合标准的请求拦截在外，达到了安全、高可靠、高性能、高并发的对HTTP请求响应的目的。
权利要求书clms
1.基于反向代理和动态脚本的请求处理方法，其特征在于，包括：将预设的规则策略文本加载到反向代理的全局共享字典中；接收来自客户端的HTTP请求，所述HTTP请求包括请求头信息和请求体业务参数信息；根据所述全局共享字典中的规则策略文本对所述HTTP请求进行校验；若所述HTTP请求通过校验，则将所述HTTP请求的参数名和参数值进行排序拼接得到第一拼接结果；将所述第一拼接结果进行哈希运算得到第一哈希值；根据所述第一哈希值从高速缓存中获取所述HTTP请求对应的请求结果；若所述高速缓存中没有所述请求结果，则将所述HTTP请求发送给后端应用服务器进行业务处理。2.根据权利要求1所述的基于反向代理和动态脚本的请求处理方法，其特征在于，当将所述HTTP请求发送给后端应用服务器进行业务处理时，基于消息队列通过Worker异步将接口的请求参数作为key,返回结果作为Value依次加入至高速缓存中。3.根据权利要求1所述的基于反向代理和动态脚本的请求处理方法，其特征在于，所述规则策略文本的生成方法为：根据前置处理内容分别定义白名单IP清单、公密钥清单、公钥授权访问策略三个JSON格式的规则策略文本。4.根据权利要求1所述的基于反向代理和动态脚本的请求处理方法，其特征在于，所述请求处理方法还包括:运行预设的脚本文件更新所述全局共享字典中的规则策略文本。5.根据权利要求1所述的基于反向代理和动态脚本的请求处理方法，其特征在于，根据所述全局共享字典中的规则策略文本对所述HTTP请求进行校验，包括：判断所述HTTP请求对应的IP是否在所述全局共享字典中的白名单IP清单中：首先通过动态脚本获取HTTP请求对应的IP，然后读取全局共享字典中的白名单IP清单，若所述HTTP请求对应的IP不在所述白名单IP清单中，则拒绝该HTTP请求；若所述HTTP请求对应的IP在所述白名单IP清单中，则放行该HTTP请求；判断所述HTTP请求的公钥是否在所述全局共享字典的公密钥清单中：首先通过动态脚本获取HTTP请求的公钥，然后读取全局共享字典中的公密钥清单，若HTTP请求的公钥不在公密钥清单中，则拒绝该HTTP请求；若HTTP请求的公钥在公密钥清单中，则放行该HTTP请求；根据所述请求头信息和请求体业务参数信息生成第一签名信息，所述请求头信息包括公钥、接口方法名、接口签名、请求时间戳和令牌；通过动态脚本获取所述请求头信息中的第二签名信息，将第二签名信息与第一签名信息进行校验，若第二签名信息与第一签名信息不等，则拒绝该HTTP请求，否则放行该HTTP请求。6.根据权利要求5所述的基于反向代理和动态脚本的请求处理方法，其特征在于，根据所述请求头信息和请求体业务参数信息生成第一签名信息，包括：将所述请求头信息与请求体业务参数信息合并按参数名排序，排序后按参数名+参数值拼接，得到第二拼接结果；通过动态脚本在全局共享字典的公密钥清单中根据公钥获取相应的密钥，将密钥拼接在第二拼接结果后，得到第三拼接结果；将第三拼接结果二进制转化为大写的十六进制后做MD5加密，生成第一签名信息。7.根据权利要求5所述的基于反向代理和动态脚本的请求处理方法，其特征在于，所述HTTP请求对应的公钥为预先分配给发送该HTTP请求的客户端的公钥。8.基于反向代理和动态脚本的请求处理装置，其特征在于，包括:规则设置模块，用于将预设的规则策略文本加载到反向代理的全局共享字典中；请求接收模块，用于接收来自客户端的HTTP请求；校验模块，用于根据所述全局共享字典中的规则策略文本对所述HTTP请求进行校验；哈希处理模块，用于在所述HTTP请求通过校验时将所述HTTP请求的参数名和参数值进行排序拼接得到第一拼接结果，并将所述第一拼接结果进行哈希运算得到第一哈希值；请求处理模块，用于根据所述第一哈希值从高速缓存中获取所述HTTP请求对应的请求结果，以及在所述高速缓存中没有所述请求结果时请求至后端的应用服务器进行处理。9.根据权利要求8所述的基于反向代理和动态脚本的请求处理装置，其特征在于，所述请求处理装置还包括：策略更新模块，用于运行预设的脚本文件更新所述全局共享字典中的规则策略文本。10.根据权利要求8所述的基于反向代理和动态脚本的请求处理装置，其特征在于，所述校验模块包括：IP校验子模块，用于判断所述HTTP请求对应的IP是否在所述全局共享字典中的白名单IP清单中：若所述HTTP请求对应的IP在所述白名单IP清单中，则放行该HTTP请求；公钥校验子模块，用于判断所述HTTP请求对应的令牌是否在所述全局共享字典的令牌清单中：若HTTP请求的公钥不在公密钥清单中，则拒绝该HTTP请求；若HTTP请求的公钥在公密钥清单中，则放行该HTTP请求；签名校验子模块，用于根据所述请求头信息和请求体业务参数信息生成第一签名信息，将第二签名信息与第一签名信息进行校验，若第二签名信息与第一签名信息不等，则拒绝该HTTP请求，否则放行该HTTP请求。
说明书desc
技术领域本发明属于计算机网络技术领域，特别是涉及一种基于反向代理和动态脚本的请求处理方法及装置。背景技术伴随着互联网的不断发展，各平台对HTTP协议请求使用场景越来越多，每次请求几乎都有非法请求、访问权限校验等诉求，同时对平台的性能、并发、稳定性要求也越来越高。现有技术中一般是将非法请求、访问权限校验等与核心业务服务集成开发在一起，容易造成业务应用与通用能力的紧耦合。应用一般最终发布在应用服务器中，应用服务器在处理动态请求有很大优势，但最大并发连接数有限制相对较小，容易造成并发和性能相对较低。同时策略调整修改相对比较频繁，修改后需重启应用服务生效，但重启可能需要花费数十秒时间，重启后可能还会存在性能抖动问题，容易造成不稳定性。发明内容本发明的目的在于克服现有技术的不足，提供一种基于反向代理和动态脚本的请求处理方法及装置。本发明的目的是通过以下技术方案来实现的：根据本发明的第一方面，基于反向代理和动态脚本的请求处理方法，包括：将预设的规则策略文本加载到反向代理的全局共享字典中；接收来自客户端的HTTP请求，所述HTTP请求包括请求头信息和请求体业务参数信息；根据所述全局共享字典中的规则策略文本对所述HTTP请求进行校验；若所述HTTP请求通过校验，则将所述HTTP请求的参数名和参数值进行排序拼接得到第一拼接结果；将所述第一拼接结果进行哈希运算得到第一哈希值；根据所述第一哈希值从高速缓存中获取所述HTTP请求对应的请求结果；若所述高速缓存中没有所述请求结果，则将所述HTTP请求发送给后端应用服务器进行业务处理。进一步地，当将所述HTTP请求发送给后端应用服务器进行业务处理时，基于消息队列通过Worker异步将接口的请求参数作为key,返回结果作为Value依次加入至高速缓存中。进一步地，所述规则策略文本的生成方法为：根据前置处理内容分别定义白名单IP清单、公密钥清单、公钥授权访问策略三个JSON格式的规则策略文本。进一步地，所述请求处理方法还包括:运行预设的脚本文件更新所述全局共享字典中的规则策略文本。进一步地，根据所述全局共享字典中的规则策略文本对所述HTTP请求进行校验，包括：判断所述HTTP请求对应的IP是否在所述全局共享字典中的白名单IP清单中：首先通过动态脚本获取HTTP请求对应的IP，然后读取全局共享字典中的白名单IP清单，若所述HTTP请求对应的IP不在所述白名单IP清单中，则拒绝该HTTP请求；若所述HTTP请求对应的IP在所述白名单IP清单中，则放行该HTTP请求；判断所述HTTP请求的公钥是否在所述全局共享字典的公密钥清单中：首先通过动态脚本获取HTTP请求的公钥，然后读取全局共享字典中的公密钥清单，若HTTP请求的公钥不在公密钥清单中，则拒绝该HTTP请求；若HTTP请求的公钥在公密钥清单中，则放行该HTTP请求；根据所述请求头信息和请求体业务参数信息生成第一签名信息，所述请求头信息包括公钥、接口方法名、接口签名、请求时间戳和令牌；通过动态脚本获取所述请求头信息中的第二签名信息，将第二签名信息与第一签名信息进行校验，若第二签名信息与第一签名信息不等，则拒绝该HTTP请求，否则放行该HTTP请求。进一步地，根据所述请求头信息和请求体业务参数信息生成第一签名信息，包括：将所述请求头信息与请求体业务参数信息合并按参数名排序，排序后按参数名+参数值拼接，得到第二拼接结果；通过动态脚本在全局共享字典的公密钥清单中根据公钥获取相应的密钥，将密钥拼接在第二拼接结果后，得到第三拼接结果；将第三拼接结果二进制转化为大写的十六进制后做MD5加密，生成第一签名信息。进一步地，所述HTTP请求对应的公钥为预先分配给发送该HTTP请求的客户端的公钥。根据本发明的第二方面，基于反向代理和动态脚本的请求处理装置，包括:规则设置模块，用于将预设的规则策略文本加载到反向代理的全局共享字典中；请求接收模块，用于接收来自客户端的HTTP请求；校验模块，用于根据所述全局共享字典中的规则策略文本对所述HTTP请求进行校验；哈希处理模块，用于在所述HTTP请求通过校验时将所述HTTP请求的参数名和参数值进行排序拼接得到第一拼接结果，并将所述第一拼接结果进行哈希运算得到第一哈希值；请求处理模块，用于根据所述第一哈希值从高速缓存中获取所述HTTP请求对应的请求结果，以及在所述高速缓存中没有所述请求结果时请求至后端的应用服务器进行处理。进一步地，所述请求处理装置还包括：策略更新模块，用于运行预设的脚本文件更新所述全局共享字典中的规则策略文本。进一步地，所述校验模块包括：IP校验子模块，用于判断所述HTTP请求对应的IP是否在所述全局共享字典中的白名单IP清单中：若所述HTTP请求对应的IP在所述白名单IP清单中，则放行该HTTP请求；公钥校验子模块，用于判断所述HTTP请求对应的令牌是否在所述全局共享字典的令牌清单中：若HTTP请求的公钥不在公密钥清单中，则拒绝该HTTP请求；若HTTP请求的公钥在公密钥清单中，则放行该HTTP请求；签名校验子模块，用于根据所述请求头信息和请求体业务参数信息生成第一签名信息，将第二签名信息与第一签名信息进行校验，若第二签名信息与第一签名信息不等，则拒绝该HTTP请求，否则放行该HTTP请求。本发明的有益效果是：本发明通过对HTTP请求做通用前置处理，实现了业务应用与通用能力的松耦合，同时对请求过滤策略、访问权限策略、缓存前置策略等实时调整修改，在不影响请求访问、不用重启程序的情况下动态生效；本发明实现了通过一个主进程多个工作进程的非阻塞模式对通用前置请求处理，通过多种安全策略，将不符合标准的请求拦截在外，保障了接口安全性，降低了下游系统压力；部分HTTP请求可直接通过高速缓存获取请求对应的请求结果，提高了接口响应的及时性，从而达到了安全、高可靠、高性能、高并发的对HTTP请求响应的目的。附图说明图1为本发明中请求处理方法的一种实施例的流程图；图2为本发明中请求处理装置的一种实施例的组成框图。具体实施方式下面将结合实施例，对本发明的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域技术人员在没有付出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。参阅图1-图2，本实施例提供了一种基于反向代理和动态脚本的请求处理方法及装置：如图1所示，本发明的第一方面提供了一种基于反向代理和动态脚本的请求处理方法，所述轨道区段状态监控方法包括步骤S100～步骤S600，以下详细说明。S100.将预设的规则策略文本加载到反向代理的全局共享字典中。在一些实施例中，所述规则策略文本的生成方法为：根据前置处理内容分别定义白名单IP清单、公密钥清单、公钥授权访问策略三个JSON格式的规则策略文本。在一些实施例中，所述请求处理方法还包括:运行预设的脚本文件更新所述全局共享字典中的规则策略文本。所述脚本文件用于通过定时任务将规则策略文本读取、保存、替换至全局共享字典中，调整规则策略文本后，运行所述脚本文件即可实现全局共享字典中规则策略文本的更新。在一些实施例中，在反向代理进程加载配置文件时定义全局共享字典，所述全局共享字典的空间大小根据存储内容测算而定。S200.接收来自客户端的HTTP请求，所述HTTP请求包括请求头信息和请求体业务参数信息。一般的，所述请求头信息包括公钥、接口方法名、接口签名、请求时间戳、令牌。S300.根据所述全局共享字典中的规则策略文本对所述HTTP请求进行校验。在一些实施例中，根据所述全局共享字典中的规则策略文本对所述HTTP请求进行校验，包括：S310.判断所述HTTP请求对应的IP是否在所述全局共享字典中的白名单IP清单中：首先通过动态脚本获取HTTP请求对应的IP，然后读取全局共享字典中的白名单IP清单，若所述HTTP请求对应的IP不在所述白名单IP清单中，则拒绝该HTTP请求；若所述HTTP请求对应的IP在所述白名单IP清单中，则放行该HTTP请求。在一些实施例中，可通过消息队列或实时调整模式将需要放行的IP添加至白名单IP清单，或者移除白名单IP清单中的IP，从而实现白名单IP清单的修改。S320.判断所述HTTP请求的公钥是否在所述全局共享字典的公密钥清单中：首先通过动态脚本获取HTTP请求的公钥，然后读取全局共享字典中的公密钥清单，若HTTP请求的公钥不在公密钥清单中，则拒绝该HTTP请求；若HTTP请求的公钥在公密钥清单中，则放行该HTTP请求。在一些实施例中，预先为每个HTTP请求分配公密钥，再基于消息队列通过Worker把其分别加入至高速缓存和令牌规则策略文本中。在一些实施例中，将每个令牌可以访问的URL地址存储到数据库中，再基于消息队列通过Worker把其分别加入至高速缓存和访问授权规则策略文本中，从而实现令牌规则策略文本的修改。S330.根据所述请求头信息和请求体业务参数信息生成第一签名信息，所述请求头信息包括公钥、接口方法名、接口签名、请求时间戳和令牌。在一些实施例中，根据所述请求头信息和请求体业务参数信息生成第一签名信息，包括：S331.将所述请求头信息与请求体业务参数信息合并按参数名排序，排序后按参数名+参数值拼接，得到第二拼接结果。S332.通过动态脚本在全局共享字典的公密钥清单中根据公钥获取相应的密钥，将密钥拼接在第二拼接结果后，得到第三拼接结果。S333.将第三拼接结果二进制转化为大写的十六进制后做MD5加密，生成第一签名信息。S340.通过动态脚本获取所述请求头信息中的第二签名信息，将第二签名信息与第一签名信息进行校验，若第二签名信息与第一签名信息不等，则拒绝该HTTP请求，否则放行该HTTP请求。S400.若所述HTTP请求通过校验，则将所述HTTP请求的参数名和参数值进行排序拼接得到第一拼接结果。S500.将所述第一拼接结果进行哈希运算得到第一哈希值。S600.根据所述第一哈希值从高速缓存中获取所述HTTP请求对应的请求结果，若所述高速缓存中没有所述请求结果，则将所述HTTP请求发送给后端应用服务器进行业务处理。在一些实施例中，当将所述HTTP请求发送给后端应用服务器进行业务处理时，基于消息队列通过Worker异步将接口的请求参数作为key,返回结果作为Value依次加入至高速缓存中。如图2所示，本发明的第二方面提供了一种基于反向代理和动态脚本的请求处理装置，所述请求处理装置包括规则设置模块、请求接收模块、校验模块、哈希处理模块和请求处理模块。规则设置模块，用于将预设的规则策略文本加载到反向代理的全局共享字典中。本实施例中，所述规则设置模块可用于执行图1所示的步骤S100，关于所述规则设置模块的具体描述可参对所述步骤S100的描述。请求接收模块，用于接收来自客户端的HTTP请求。本实施例中，所述请求接收模块可用于执行图1所示的步骤S200，关于所述请求接收模块的具体描述可参对所述步骤S200的描述。校验模块，用于根据所述全局共享字典中的规则策略文本对所述HTTP请求进行校验。本实施例中，所述校验模块可用于执行图1所示的步骤S300，关于所述校验模块的具体描述可参对所述步骤S300的描述。哈希处理模块，用于在所述HTTP请求通过校验时将所述HTTP请求的参数名和参数值进行排序拼接得到第一拼接结果，并将所述第一拼接结果进行哈希运算得到第一哈希值。本实施例中，所述哈希处理模块可用于执行图1所示的步骤S400和步骤S500，关于所述哈希处理模块的具体描述可参对所述步骤S400和步骤S500的描述。请求处理模块，用于根据所述第一哈希值从高速缓存中获取所述HTTP请求对应的请求结果，以及在所述高速缓存中没有所述请求结果时请求至后端的应用服务器进行处理。本实施例中，所述请求处理模块可用于执行图1所示的步骤S600，关于所述请求处理模块的具体描述可参对所述步骤S600的描述。在一些实施例中，所述请求处理装置还包括：策略更新模块，用于运行预设的脚本文件更新所述全局共享字典中的规则策略文本。以上所述仅是本发明的优选实施方式，应当理解本发明并非局限于本文所披露的形式，不应看作是对其他实施例的排除，而可用于各种其他组合、修改和环境，并能够在本文所述构想范围内，通过上述教导或相关领域的技术或知识进行改动。而本领域人员所进行的改动和变化不脱离本发明的精神和范围，则都应在本发明所附权利要求的保护范围内。
