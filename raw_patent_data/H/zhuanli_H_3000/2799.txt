标题title
一种自组网主节点选举及数据同步方法
摘要abst
本发明涉及一种自组网主节点选举及数据同步方法，包括：S1、进行第i次选举：若干节点向其他节点广播投票信息；若干节点接收其他节点发出的投票信息；若干节点根据接收到的投票信息，各自确定本次选举的得票节点；若干节点根据自身确定的得票节点更新投票信息；S2、重复执行步骤S1若干次，所述若干节点各自确定有若干得票节点；S3、节点从确定的若干得票节点中选出主节点。本发明进行多次选举：第一次选举时，节点能获得其监听范围内节点的节点特征数据；随着选举次数的增加，节点能获取其监听范围外乃至所有节点的节点特征数据，从而得到唯一的主节点，有效避免由于选出多个主节点而产生多个局域网的情形。
权利要求书clms
1.一种自组网主节点选举及数据同步方法，其特征在于，包括以下步骤：S1、进行第i次选举：节点向其他节点广播投票信息；节点接收其他节点发出的投票信息；节点根据接收到的投票信息，确定本次选举的得票节点；节点根据所述得票节点更新投票信息；S2、重复执行步骤S1若干次，节点确定若干得票节点；S3、节点从确定的若干得票节点中选出主节点。2.根据权利要求1所述的一种自组网主节点选举及数据同步方法，其特征在于，在步骤S1之前，还包括：节点检测是否已存在网络，若存在网络，则节点加入所述网络；否则进行主节点选举。3.根据权利要求1所述的一种自组网主节点选举及数据同步方法，其特征在于，当i＝1时，节点将自身的节点特征数据作为投票信息。4.根据权利要求1所述的一种自组网主节点选举及数据同步方法，其特征在于，所述节点特征数据为节点设备ID或节点通讯地址。5.根据权利要求1所述的一种自组网主节点选举及数据同步方法，其特征在于，所述根据得票节点更新投票信息，具体为：节点比较接收到的投票信息中的节点特征数据与本地存储的投票信息中的节点特征数据，根据其中的最小值或最大值更新投票信息。6.根据权利要求1所述的一种自组网主节点选举及数据同步方法，其特征在于，所述从确定的若干得票节点中选出主节点，具体为：节点统计自身为得票节点的次数，若次数超过次数阈值，则节点将自身确定为主节点。7.根据权利要求1所述的一种自组网主节点选举及数据同步方法，其特征在于，还包括：主节点构建网络，其他节点作为从节点加入所述网络形成自组网。8.根据权利要求7所述的一种自组网主节点选举及数据同步方法，其特征在于，还包括：若存在待同步数据，主节点采用多播方式向从节点发送待同步数据。9.根据权利要求7所述的一种自组网主节点选举及数据同步方法，其特征在于，还包括：主节点定时向从节点发送心跳包数据，若从节点在预设时间内未收到所述心跳包数据，则重新选举主节点。10.一种非暂态计算机可读存储介质，其特征在于，所述非暂态计算机可读存储介质存储计算机指令，所述计算机指令用于使所述计算机执行如下步骤：S1、向其他节点广播投票信息；接收其他节点发出的投票信息；根据接收到的投票信息，确定得票节点；根据所述得票节点，更新投票信息；S2、重复执行步骤S1若干次，得到若干得票节点；S3、从若干得票节点中选出主节点。
说明书desc
技术领域本发明涉及一种自组网主节点选举及数据同步方法，属于无线自组织网络领域。背景技术无线自组织网络是由一组带有无线收发装置的移动终端节点组成的无中心网络，是一种不需要依靠现有固定通信网络基础设施的、能够迅速展开使用的网络体系。自组网中各节点相互协作、通过无线链路进行通信、交换信息，实现信息和服务的共享。自组网中一般会选举一个节点为主节点，主节点可以作为该自组网的管理单元或代理单元，来进行数据同步或者控制其它节点。主节点一般是手工配置的，每个节点需要手动配置IP、主从模式，如果是从节点，需要配置主节点IP等信息。因此，需要一种能自动确定自组网主节点的方法。专利KR101075462B1《如何从子网中选择主节点》将节点分为候选节点和投票节点，候选节点接收投票节点的投票消息；当候选节点从投票节点接收到的投票消息的数量超过正常节点数量的一定比例时，选择候选节点作为第一主节点。候选节点成为主节点后，如果接收到WIN消息且该候选节点的IP地址大于发送者的IP地址，则该候选节点放弃其作为主节点的状态并接收WIN消息，但是候选节点如果的IP地址不大于发送方的IP地址，则对应的候选节点是主节点；从而确定得票数超过比例且IP地址的候选节点最小的节点为主节点。但该方法需要在选举前知道其他节点的IP地址，才能确定自身为投票节点还是候选节点，适用于主节点故障后重新选举的场景。且该方法需要较长的准备时间、步骤繁琐。此外，同一时间上电的节点形成一个自组网，若节点异步上电，则在同一空间内产生多个主节点形成多个自组网，而不同局域网内节点无法通信。发明内容为了克服现有技术中存在的问题，本发明设计了一种自组网主节点选举及数据同步方法，进行多次选举：第一次选举时，节点能获得其监听范围内节点的节点特征数据；随着选举次数的增加，节点能获取其监听范围外乃至所有节点的节点特征数据，从而得到唯一的主节点，有效避免由于选出多个主节点而产生多个局域网的情形。为了实现上述目的，本发明采用如下技术方案：技术方案一：一种自组网主节点选举及数据同步方法，包括以下步骤：S1、进行第i次选举：若干节点向其他节点广播投票信息；若干节点接收其他节点发出的投票信息；若干节点根据接收到的投票信息，各自确定本次选举的得票节点；若干节点根据自身确定的得票节点更新投票信息；S2、重复执行步骤S1若干次，所述若干节点各自确定有若干得票节点；S3、节点从确定的若干得票节点中选出主节点。进一步地，在步骤S1之前，还包括：节点检测是否已存在网络，若存在网络，则节点加入所述网络；否则进行主节点选举。进一步地，当i＝1时，节点将自身的节点特征数据作为投票信息。进一步地，所述节点特征数据为节点设备ID或节点通讯地址。进一步地，所述根据自身确定的得票节点更新投票信息，具体为：节点比较接收到的投票信息中的节点特征数据与本地存储的投票信息中的节点特征数据，根据其中的最小值或最大值更新投票信息。进一步地，所述从确定的若干得票节点中选出主节点，具体为：节点统计自身为得票节点的次数，若次数超过次数阈值，则节点将自身确定为主节点。进一步地，还包括：主节点构建网络，其他节点作为从节点加入所述网络形成自组网。进一步地，还包括：若存在待同步数据，主节点采用多播方式向从节点发送待同步数据。进一步地，还包括：主节点定时向从节点发送心跳包数据，若从节点在预设时间内未收到所述心跳包数据，则重新选举主节点。技术方案二：一种非暂态计算机可读存储介质，其特征在于，所述非暂态计算机可读存储介质存储计算机指令，所述计算机指令用于使所述计算机执行如下步骤：S1、向其他节点广播投票信息；接收其他节点发出的投票信息；根据接收到的投票信息，确定得票节点；根据所述得票节点，更新投票信息；S2、重复执行步骤S1若干次，得到若干得票节点；S3、从若干得票节点中选出主节点。与现有技术相比本发明有以下特点和有益效果：本发明进行多次选举：第一次选举时，节点能获得其监听范围内节点的节点特征数据；随着选举次数的增加，节点能获取其监听范围外乃至所有节点的节点特征数据，从而得到唯一的主节点，有效避免由于选出多个主节点而产生多个局域网的情形。同时，在未完成组网前，节点间的通信并不可靠，有可能存在投票信息丢失的情况，导致某一轮的投票不准确。本发明通过多次选举提高投票准确度。附图说明图1、2是本发明流程图；图3是实施例二示意图。具体实施方式下面结合实施例对本发明进行更详细的描述。为保证各节点的数据同步，选举一个节点为主节点且在同一时刻仅有一个主节点。如图1、2所示，节点上电启动后，检测周边是否存在可用网络，若存在可用网络，则直接加入该可用网络；否则，节点进入STA+AP模式以进行主节点选举，包括以下步骤：S1、进行第一次选举：各节点向自身之外的节点广播投票信息，投票信息为本地存储的节点特征数据的最大值或最小值。具体地，节点特征数据为节点设备ID、节点通讯地址。本实施中，节点特征数据为节点设备ID的最小值。节点至少知道自身的节点特征数据。在第一次选举中，各节点本地仅存有自身的节点设备ID，故各节点将自身的节点设备ID作为投票信息进广播。各节点监听得到其他节点发送的投票信息；各节点根据接收到的投票信息，各自确定本次选举的得票节点；各节点根据自身确定的得票节点，更新下一次要发送的投票信息。具体地，各节点比较接收到的投票信息中的节点设备ID与本地存储的节点设备ID，将其中的节点设备ID最小值对应节点作为得票节点；并将投票信息更新为该得票节点的节点设备ID。如，某一节点在第一次选举中发送的投票信息为41654，监听到的投票信息依次为54645、35468、54311、24652；则将24652更新为第二次要发送的投票信息。S2、进行第二次选举：各节点向自身之外的节点广播投票信息，投票信息为本地存储的节点设备ID的最小值。各节点监听得到其他节点发送的投票信息；各节点根据接收到的投票信息，各自确定本次选举的得票节点；各节点根据自身确定的得票节点，更新下一次要发送的投票信息。如，某一节点在第二次选举中发送的投票信息为24652，接收到的投票信息投票信息依次为15689、16468、26584、19824；则将15689更新为第三次的投票信息。S3、重复执行步骤S2若干次；优选地，重复步骤S2直至完成10次选举。相应的，各节点各自确定有10个得票节点。各节点统计自身为得票节点的次数或得票百分比，若次数超过次数阈值或得票百分比超过阈值，则节点将自身确定为主节点；否则，节点清空本地存储的投票信息，检测周边是否存在可用网络。如，节点在10次选举中依次确立了10个得票节点，统计自身为得票节点的次数为10高于次数阈值8，故该节点确定自身为主节点。主节点构建网络，其他节点作为从节点加入所述网络形成自组网。主节点每10s发送一个心跳包数据用来同步和检测网络完整性，若从节点超过30s没收到来自主节点的心跳包数据，则认为主节点故障，从节点断开所连网络重新选举主节点。实施例二举一个例子说明选举过程：假设，第一、第二、第三、第四、第五节点的节点设备ID值依次为1、2、3、4、5。如图3所示，第一节点、第三节点、第四节点在第二节点的信号范围内；第五节点在第三节点的信号范围内。经第一次选举，第一节点的得票节点为第一节点，第二节点的得票节点为第一节点，第三节点的得票节点为第二节点，第四节点的得票节点为第二节点，第五节点的得票节点为第三节点。经第二次选举，第一节点的得票节点为第一节点，第二节点的得票节点为第一节点，第三节点的得票节点为第一节点，第四节点的得票节点为第一节点，第五节点的得票节点为第二节点。经第三次选举，第一节点的得票节点为第一节点，第二节点的得票节点为第一节点，第三节点的得票节点为第一节点，第四节点的得票节点为第一节点，第五节点的得票节点为第一节点。此后数次的选举结果与第三次的选举结果一致，不再赘述。最终，在10次选举结果中第一节点自身为得票节点的次数为10次；第二节点自身为得票节点的次数为0次；第三节点自身为得票节点的次数为0次；第四节点自身为得票节点的次数为0次；第五节点自身为得票节点的次数为0次；第一节点将自身确定为主节点。实施例三一种数据同步方法，包括如下步骤：主节点收集自组网内所有从节点的MAC地址。本实施例中，节点为带有无线收发装置的共享按摩设备。若存在待同步数据，主节点采用多播方式向从节点发送待同步数据。本实施例中待同步数据为共享按摩设备灯光闪烁频次和时间。实施例四一种非暂态计算机可读存储介质，其特征在于，所述非暂态计算机可读存储介质存储计算机指令，所述计算机指令用于使所述计算机执行实施例一至实施例三所述步骤。最后应当说明的是，以上实施例仅用以说明本发明的技术方案，而非对本发明保护范围的限制，尽管参照较佳实施例对本发明作了详细地说明，本领域的普通技术人员应当分析，可以对本发明的技术方案进行修改或者等同替换，而不脱离本发明技术方案的实质和范围。
