标题title
一种基于安全帽定位的考勤方法、装置及终端
摘要abst
本发明公开一种基于安全帽定位的考勤方法、装置及终端，定时接收安全帽发送的基于GPS确定的第一定位信息以及基于罗盘和计步器确定的第二定位信息；根据第一定位信息确定基于GPS确定的第一定位结果，根据第二定位信息确定基于罗盘和计步器确定的第二定位结果；判断所述第一定位结果和第二定位结果之间的差值是否小于第一预设值，若是，则记录所述第一定位信息以作为考勤定位信息；在对工地的工作人员进行考勤时，借助于安全帽实现考勤定位，并且采用两种方式实现对安全帽的定位，基于GPS的定位方式方便快捷，而基于罗盘和计步器的定位方式准确通用，非常适用于工地等环境复杂的场所，因此，通过两种定位方式的结合保证了工地中考勤的准确性。
权利要求书clms
1.一种基于安全帽定位的考勤方法，其特征在于，包括步骤：S1、定时接收安全帽发送的基于GPS确定的第一定位信息以及基于罗盘和计步器确定的第二定位信息；S2、根据所述第一定位信息确定基于GPS确定的第一定位结果，根据所述第二定位信息确定基于罗盘和计步器确定的第二定位结果；S3、判断所述第一定位结果和第二定位结果之间的差值是否小于第一预设值，若是，则记录所述第一定位信息以作为考勤定位信息。2.根据权利要求1所述的一种基于安全帽定位的考勤方法，其特征在于，所述S1包括：定时接收安全帽发送的基于GPS确定的第一定位信息；获取电子围栏范围，根据所述电子围栏范围和当前接收的第一定位信息确定所述安全帽的当前定位与所述电子围栏的边界的距离；判断所述距离是否小于预设距离阈值，若否，则直接记录所述当前接收的第一定位信息以作为考勤定位信息，否则，定时接收安全帽发送的基于罗盘和计步器确定的第二定位信息。3.根据权利要求1所述的一种基于安全帽定位的考勤方法，其特征在于，所述S1和S2之间还包括步骤：基于时间对齐所述第一定位信息和第二定位信息；所述S2包括：根据当前接收的第一定位信息和上一时间点接收的第一定位信息确定基于GPS确定的相邻时间点的第一相对位移，根据所述第一相对位移确定第一定位结果；根据与所述当前接收的第一定位信息对齐的当前第二定位信息和与所述上一时间点接收的第一定位信息对齐的第二定位信息确定基于罗盘和计步器确定的相邻时间点的第二相对位移，根据所述第二相对位移确定第二定位结果。4.根据权利要求3所述的一种基于安全帽定位的考勤方法，其特征在于，所述第一相对位移包括第一相对距离和第一相对方向角，所述第一相对位移根据基于GPS确定的相邻时间点的经纬度信息确定，所述第一相对方向角根据基于GPS确定的相邻时间点的方向确定；所述第二相对位移包括第二相对距离和第二相对方向角，所述第二相对位移根据基于计步器和罗盘确定的相邻时间点的距离确定，所述第二相对方向角根据基于计步器和罗盘确定的相邻时间点的的方向确定；所述S3包括：判断所述第一相对距离和第二相对距离的差值是否小于第一预设距离值，并且所述第一相对方向角和第二相对方向角的差值是否小于第一预设角度值，若是，则记录所述第一定位信息以作为考勤定位信息。5.根据权利要求1至4中任一项所述的一种基于安全帽定位的考勤方法，其特征在于，所述S3还包括：若否，则触发所述安全帽分别重复执行预设次数的基于GPS的定位和基于罗盘和计步器的定位，获取每一次定位对应的第一定位信息以及第二定位信息；对于每一次定位获取的第一定位信息和第二定位信息，分别执行所述S2，并确定每一次定位对应的第一定位结果和第二定位结果之间的差值；若任一次定位对应的差值小于第一预设值，则记录该次定位对应的第一定位信息以作为考勤定位信息，否则，记录所述第二定位信息以作为考勤定位信息。6.根据权利要求1至4中任一项所述的一种基于安全帽定位的考勤方法，其特征在于，所述S1之前还包括步骤：接收安全帽发送的注册请求，所述注册请求包括安全帽标识、安全帽佩戴对象标识以及安全帽佩戴对象的人脸照片；根据所述注册请求绑定所述安全帽标识、安全帽佩戴对象标识和安全帽佩戴对象的人脸照片，并存储对应的绑定关系；根据所述绑定关系将所述安全帽佩戴对象的人脸照片发送给所述安全帽标识对应的安全帽；所接收的所述第一定位信息和第二定位信息为所述安全帽将自拍获取的安全帽佩戴对象的照片和接收的所述安全帽佩戴对象的人脸照片比对一致后发送的。7.根据权利要求6所述的一种基于安全帽定位的考勤方法，其特征在于，所述S1还包括步骤：接收所述安全帽发送的安全帽标识；根据所述安全帽标识确定是否存在所述安全帽标识对应的绑定关系，若存在，将所述考勤定位信息发送给应用服务器。8.根据权利要求7所述的一种基于安全帽定位的考勤方法，其特征在于，所述考勤定位信息还包括定位时间；还包括步骤：接收考勤规则设置请求，根据所述考勤规则设置请求设置考勤规则，所述考勤规则包括考勤区域和考勤时间段；将所述考勤规则发送给所述应用服务器，使得所述应用服务器根据所述考勤规则和考勤定位信息确定考勤信息。9.一种基于安全帽定位的考勤装置，其特征在于，包括：接收模块，用于定时接收安全帽发送的基于GPS确定的第一定位信息以及基于罗盘和计步器确定的第二定位信息；确定模块，用于根据所述第一定位信息确定基于GPS确定的第一定位结果，根据所述第二定位信息确定基于罗盘和计步器确定的第二定位结果；判断模块，用于判断所述第一定位结果和第二定位结果之间的差值是否小于第一预设值，若是，则记录所述第一定位信息以作为考勤定位信息。10.一种基于安全帽定位的考勤终端，包括存储器、处理器及存储在所述存储器上并可在所述处理器上运行的计算机程序，其特征在于，所述处理器执行所述计算机程序时实现权利要求1至8中任一项所述的一种基于安全帽定位的考勤方法中的各个步骤。
说明书desc
技术领域本发明涉及工地考勤领域，尤其涉及一种基于安全帽定位的考勤方法、装 置及终端。背景技术工地考勤目前常用的考勤方式是工作人员入场、离场时通过指纹或人脸识 别的方式通过闸机进行工作人员的进出场记录。但是，由于工地环境复杂，对 于通过开放式的工地闸机来记录考勤存在局限性，即无法保证工作人员都是通 过闸机通过。并且由于工地通常都是要搬砖、砌砖等，工作人员两手通常都有 泥土，这样就降低了指纹识别的成功率。为了解决上述问题，鉴于在工地工作的工作人员都要戴着安全帽，现有的 工地考勤出现了借助安全帽的定位来实现对工作人员考勤的方式，即通过电子 围栏设置一个区域作为工地工作人员的考勤区域，然后通过安全帽的定位信息 确定工作人员是否在设置的考勤区域内，从而实现对工作人员的考勤。但是， 对于该方式而言，当安全帽处于电子围栏边缘时，由于工地环境复杂会导致安全帽定位信息存在偏差，容易出现对于工作人员 进出电子围栏的判断失误，从而导致考勤不准确的问题。发明内容本发明所要解决的技术问题是：提供一种基于安全帽定位的考勤方法、装 置及终端，能够提高考勤的准确性。为了解决上述技术问题，本发明采用的一种技术方案为：一种基于安全帽定位的考勤方法，包括步骤：S1、定时接收安全帽发送的基于GPS确定的第一定位信息以及基于罗盘和 计步器确定的第二定位信息；S2、根据所述第一定位信息确定基于GPS确定的第一定位结果，根据所述 第二定位信息确定基于罗盘和计步器确定的第二定位结果；S3、判断所述第一定位结果和第二定位结果之间的差值是否小于第一预设 值，若是，则记录所述第一定位信息以作为考勤定位信息。为了解决上述技术问题，本发明采用的另一种技术方案为：一种基于安全帽定位的考勤装置，包括：接收模块，用于定时接收安全帽发送的基于GPS确定的第一定位信息以及 基于罗盘和计步器确定的第二定位信息；确定模块，用于根据所述第一定位信息确定基于GPS确定的第一定位结果， 根据所述第二定位信息确定基于罗盘和计步器确定的第二定位结果；判断模块，用于判断所述第一定位结果和第二定位结果之间的差值是否小 于第一预设值，若是，则记录所述第一定位信息以作为考勤定位信息。为了解决上述技术问题，本发明采用的另一种技术方案为：一种基于安全帽定位的考勤终端，包括存储器、处理器及存储在所述存储 器上并可在所述处理器上运行的计算机程序，所述处理器执行所述计算机程序 时实现上述基于安全帽定位的考勤方法中的各个步骤。本发明的有益效果在于：在对工地的工作人员进行考勤时，借助于安全帽 实现考勤定位，并且采用两种方式实现对安全帽的定位，一种是基于GPS，另 一种是基于罗盘和计步器，基于GPS的定位方式方便快捷，而基于罗盘和计步 器的定位方式准确通用，不受限于所处环境，非常适用于工地等环境复杂的场 所，因此，通过两种定位方式的结合能够实现对考勤人员的准确定位，从而保 证了工地中考勤的准确性。附图说明图1为本发明实施例的一种基于安全帽定位的考勤方法的步骤流程图；图2为本发明实施例的一种基于安全帽定位的考勤装置的结构示意图；图3为本发明实施例的一种基于安全帽定位的考勤终端的结构示意图；图4为本发明实施例的一种基于安全帽定位的考勤方法的详细流程图；图5为本发明实施例的一种基于安全帽定位的考勤方法中基于计步器和罗 盘定位时的运动示意图；图6为本发明实施例的一种基于安全帽定位的考勤方法中基于安全帽建立 的坐标系示意图；图7为本发明实施例的一种基于安全帽定位的考勤方法中两种定位方式的 坐标系转换到同一坐标系的示意图；图8为本发明实施例的一种基于安全帽定位的考勤方法中两种定位方式的 工人运动轨迹示意图；图9为本发明实施例的一种基于安全帽定位的考勤方法中基于罗盘+计步器 实现定位的示意图；图10为本发明实施例的一种基于安全帽定位的考勤方法中基于GPS定位的 原点查找逻辑示意图；图11为本发明实施例的一种基于安全帽定位的考勤方法中基于罗盘+计步 器实现定位转换后的的位移记录所在的坐标系示意图；图12为本发明实施例的一种基于安全帽定位的考勤方法中基于GPS实现定 位转换后的位移记录所在的坐标系示意图；图13为本发明实施例的一种基于安全帽定位的考勤系统的结构示意图；图14为本发明实施例的一种基于安全帽定位的考勤系统中各个装置的结构 示意图。具体实施方式为详细说明本发明的技术内容、所实现目的及效果，以下结合实施方式并 配合附图予以说明。本发明上述基于安全帽定位的考勤方法、装置及终端能够适用于环境比较 复杂的场景，比如工地，以下通过具体的实施方式进行说明：在一个可选的实施方式中，如图1所示，一种基于安全帽定位的考勤方法， 本实施方式中以注册服务器的角度进行描述，具体地，包括步骤：S1、定时接收安全帽发送的基于GPS确定的第一定位信息以及基于罗盘和 计步器确定的第二定位信息，其中，可以通过远程配置的方式为安全帽配置定 时上报的周期间隔，比如30分钟触发一次定时数据上报任务，该周期间隔可以 根据具体的应用场景进行灵活设置；S2、根据所述第一定位信息确定基于GPS确定的第一定位结果，根据所述 第二定位信息确定基于罗盘和计步器确定的第二定位结果；S3、判断所述第一定位结果和第二定位结果之间的差值是否小于第一预设 值，若是，则记录所述第一定位信息以作为考勤定位信息；其中，所述S1之前还包括步骤：接收安全帽发送的注册请求，所述注册请求包括安全帽标识、安全帽佩戴 对象标识以及安全帽佩戴对象的人脸照片，安全帽标识比如设备序列号，安全 帽佩戴对象标识比如身份证等；根据所述注册请求绑定所述安全帽标识、安全帽佩戴对象标识和安全帽佩 戴对象的人脸照片，并存储对应的绑定关系；根据所述绑定关系将所述安全帽佩戴对象的人脸照片发送给所述安全帽标 识对应的安全帽；所接收的所述第一定位信息和第二定位信息为所述安全帽将自拍获取的安 全帽佩戴对象的照片和接收的所述安全帽佩戴对象的人脸照片比对一致后发送 的；安全帽在接收到注册服务器发送的安全帽佩戴对象的人脸照片后，当要上 报定位数据给注册服务器之前，先通过自拍装置拍摄佩戴者的人脸照片，然后 将拍摄得到的人脸照片与从注册服务器接收的人脸照片进行比对，如果一致， 则将定位数据进行上报，否则，提示出错，比如可以发出蜂鸣声，并终止定位 数据的上报，同时等待下一次上报周期的到来重新进行比对认证；上述实施方式中，借助人脸识别实现定时身份识别后上报定位数据，通过 人脸识别与定时的定位触发实现了更为准确的考勤，由于不依赖指纹识别，能 够避免因为泥土等污渍造成的考勤难识别的问题，并且由于存在人脸鉴权，在 避免造假的同时也能够规范工人的安全帽佩戴；其中，所述S1还包括步骤：接收所述安全帽发送的安全帽标识；根据所述安全帽标识确定是否存在所述安全帽标识对应的绑定关系，若存 在，将所述考勤定位信息发送给应用服务器；若不存在，则丢弃该定位数据， 并终止后续流程，返回S1；在接收安全帽上报的定位数据时，还进一步接收安全帽发送的安全帽标识， 在转发安全帽上报的定位数据之前，先确定是否存储有与安全帽标识对应的绑 定关系，如存在，则说明该安全帽已经注册过并且也经验证鉴权过，因此，将 对应的考勤定位信息发送给应用服务器，通过安全帽、注册服务器的相互配合， 最终将最重要的并且可靠的考勤定位信息发送给应用服务器以进行后续的考勤 工作，大大方便工地自动及时采集考勤信息的同时保证考勤信息的可靠性；所述考勤定位信息还包括定位时间，即安全帽执行相应的定位对应的时间， 每一个定位信息都有对应的定位时间；还包括步骤：接收考勤规则设置请求，根据所述考勤规则设置请求设置考勤规则，所述 考勤规则包括考勤区域和考勤时间段，可以通过配置至少三个点的经纬度坐标 围城的区域作为考勤区域，当定位数据不在该区域范围，则认为出场，反之， 当定位数据在该区域范围，则认为进场；将所述考勤规则发送给所述应用服务器，使得所述应用服务器根据所述考 勤规则和考勤定位信息确定考勤信息；其中，考勤规则可以通过注册服务器接收并转发给应用服务器，也可以直 接在应用服务器上设置；通过对考勤规则的灵活设置能够提高考勤的灵活性， 可以根据实际应用场景需求配置对应的考勤规则，实现方便灵活的考勤统计；如图4所示，为基于安全帽定位的考勤方法的一个实施方式对应的详细步 骤流程图：预先在应用服务器配置所需的考勤规则；注册服务器预先录入安全帽唯一标识、人员唯一标识以及人脸照片；注册服务器将安全帽唯一标识与人员唯一标识、人脸照片进行绑定；注册服务器将绑定好的人员的人脸信息配置到对应的安全帽；安全帽定时向注册服务器传输定位数据；其中，安全帽进行定位数据上报前先进行人脸认证，比对当前佩戴人员人 脸信息预预配置人脸是否一致，如果安全帽人脸认证认为不一致时发出蜂鸣， 随后终止后续上报动作并等待下一次上报周期到来时重新认证；通信服务器接收到上报的定位数据后进行协议解析并将解析后的数据重新 封装转发至注册服务器；注册服务器过滤定位数据，并将过滤后的定位数据转发至应用服务器，即 判断上报的安全帽唯一标识是否存储在注册服务器存储的绑定关系中，若存在， 则将其对应的定位数据转发至应用服务器，若不存在，则将其对应的定位数据 删除，并返回定时向注册服务器传输定位数据步骤；应用服务器接收并存储定位数据，根据考勤规则统计出考勤信息。在另一个可选的实施方式中，所述S1包括：定时接收安全帽发送的基于GPS确定的第一定位信息；获取电子围栏范围，根据所述电子围栏范围和当前接收的第一定位信息确 定所述安全帽的当前定位与所述电子围栏的边界的距离；判断所述距离是否小于预设距离阈值，若否，则直接记录所述当前接收的 第一定位信息以作为考勤定位信息，否则，定时接收安全帽发送的基于罗盘和 计步器确定的第二定位信息；通过将定时获取的GPS定位信息与用于考勤的考勤区域，即电子围栏的边 界的距离的确定来判断安全帽是否处于考勤区域边界，从而确定是否触发两种 定位方式的结合来确定考勤定位信息，避免了在GPS不容易出偏差的位置也采 取两种定位方式相结合从而导致功耗大的问题；为了进一步保证上述判断结果的准确性，可以设置当连续预设个GPS定位 点距离边界距离超出指定阈值后才由后台发送指令触发安全帽使用基于GPS定 位的方式实现考勤定位，因为工地中工人是处于运动中的，随着工人的运动， 可能上一时刻的定位不在考勤区域边缘，但是下一时刻就在考勤区域边缘，因 此，通过一段时间内的考勤数据的考察，能够更为准确地对工人是否处于考勤 区域边缘进行判断。在另一个可选的实施方式中，所述S1和S2之间还包括步骤：基于时间对齐所述第一定位信息和第二定位信息，即可以以其中一个定位 信息为基础，寻找与其对应的定位时间最接近的另一个定位信息，作为与其匹 配的另一个定位信息；由于基于罗盘和计步器的定位的获取时间与基于GPS的定位的上报时间存 在时间差，获取比对点时可以通过当前GPS定位坐标获取时间与罗盘+计步器定 位的获取时间的数据做比对取时间差最近的一条定位数据，从而提高两种定位 的定位信息比对的精准性；所述S2包括：根据当前接收的第一定位信息和上一时间点接收的第一定位信息确定基于 GPS确定的相邻时间点的第一相对位移，根据所述第一相对位移确定第一定位 结果；根据与所述当前接收的第一定位信息对齐的当前第二定位信息和与所述上 一时间点接收的第一定位信息对齐的第二定位信息确定基于罗盘和计步器确定 的相邻时间点的第二相对位移，根据所述第二相对位移确定第二定位结果；其中，所述第一相对位移包括第一相对距离和第一相对方向角，所述第一 相对位移根据基于GPS确定的相邻时间点的经纬度信息确定，所述第一相对方 向角根据基于GPS确定的相邻时间点的方向确定；所述第二相对位移包括第二相对距离和第二相对方向角，所述第二相对位 移根据基于计步器和罗盘确定的相邻时间点的距离确定，所述第二相对方向角 根据基于计步器和罗盘确定的相邻时间点的方向确定；所述S3包括：判断所述第一相对距离和第二相对距离的差值是否小于第一预设距离值， 并且所述第一相对方向角和第二相对方向角的差值是否小于第一预设角度值， 若是，则记录所述第一定位信息以作为考勤定位信息；通过在安全帽中增加计步器能够获取工人步行过程中的加速度，通过罗盘 能够获取步行方向；计步器本质是使用陀螺仪测量三维坐标系xyz轴上的加速度大小，通过计 算每次规律迈步产生的加速度进行计步，其中筛除因晃动等引起的无规律加速 度不记录计步数；为测量人员位移距离通过监听有效迈步时的加速度及时间点， 以及停止迈步的时间点，通过位移公式v0t+1/2*at2获取人员位移距离，其中v0为初速度，a为加速度，t为监听到陀螺仪有效迈步加速度的时间 与上一次获取到有效迈步加速度的时间的间隔，两次连续的停止 迈步时间段不做距离计算；如图5所示，0为坐标系原点即该功能启动时第一次获取陀螺仪有效迈步加速度的时间点，即当安全帽接收到启动罗盘+计步器与GPS定位相结 合的定位方式指令时，建立直角坐标系，创建点坐标，将当前安全帽 所在位置对应于该点坐标，后续通过罗盘+计步器定位获得的位置与该 点坐标作比较，确定相对距离；图5中，A为第二次获取陀螺仪有效迈步加速度的时间点， 假定每次迈步为匀加速直线运动，通过上述位移公式获取A点时位移为 v0tA+1/2*a0tA2，其中v0使用定位系统返回的速度平均值，a0表示OA段的平均 加速度，tA表示OA段的时间，同理位移到B点时相对A点的位移为tB+1/2*aAtB2，aA表示AB段的平均加速度，tB表示AB段的时间，以此类 推，可以算出相邻两点之间的距离；由于要比较的是两种不同定位方式下的定位结果，因此，在进行比较时， 需要将两种定位方式下的定位结果转换到同一个坐标系下，方可进行比较，比 如，对于GPS定位，获取的是经纬度坐标，因此，在进行相对距离的比较时， 可以根据相邻两点的经纬度坐标转换成对应的相邻两点的距离，从而与罗盘+计 步器定位方式下确定出的相邻两点之间的距离进行比较；而对于相对方向角的比较，在一个可实现的方式中，指定罗盘与陀螺仪使 用同一套坐标轴，如图6所示，y轴指向安全帽正前方，z轴垂直于安全帽，x 轴贯穿安全帽左右两侧。罗盘定义：方位角：磁北方向和y轴之间的角度，围 绕z轴；0＝北，90＝东，180＝南，270＝西，俯仰：绕x轴旋转，当z轴向y轴移动时为正值；滚动：围绕y轴的旋 转随着设备顺时针移动而增加；如图7，OB为罗盘指向即磁北方向，OA为陀螺仪加速度指向，面EFGH 为水平面，即安全帽转动时会造成xyz轴跟着偏转，由于罗盘始终指向磁北则 认为罗盘指向等同水平面，通过罗盘指向与坐标轴的夹角可知偏移量，将OA 按罗盘偏转指向使用三角函数翻转得到OC即相对水平面的加速度，通过三角函 数换算可得OC在水平面EFGH的投影OD，则OD即为安全帽在水平面位移方 向，通过三角函数转换可得∠BOD即为运动方向相对磁北偏移量从而可在如图 5指向磁北的平面坐标系绘制出运动轨迹；将GPS定位中的经纬度坐标转换到如图5所示的指向磁北的直角坐标系， 通过三角函数可计算每两点之间的距离以及相对xy轴的偏移量；将上述GPS经纬度和基于罗盘+计步器定位的坐标转换到指向磁北的直角 坐标系，如图8，OABCD为GPS经纬度转换后的坐标，OEFGH为罗盘+计步 器定位的坐标，通过比对相邻时刻坐标相对位移，当位移超过预设阈值则忽略 该定位坐标，如B,F偏差较大，则忽略B点；由于罗盘+计步器定位的获取时间 与定时GPS上报时间存在时间差，获取比对点时通过当前GPS定位坐标获取时 间与罗盘+计步器定位的获取时间的数据做比对，取时间差最近的一条定位数据；通过相对位移的比较能够准确可靠地判断 出基于GPS定位方式是否存在偏差，从而及时地切换定位方式，保证考勤定位 的准确性和可靠性。在另一个可选的实施方式中，所述S3还包括：若否，则触发所述安全帽分别重复执行预设次数的基于GPS的定位和基于 罗盘和计步器的定位，获取每一次定位对应的第一定位信息以及第二定位信息；对于每一次定位获取的第一定位信息和第二定位信息，分别执行所述S2， 并确定每一次定位对应的第一定位结果和第二定位结果之间的差值；若任一次定位对应的差值小于第一预设值，则记录该次定位对应的第一定 位信息以作为考勤定位信息，否则，记录所述第二定位信息以作为考勤定位信 息；本实施方式中，如果GPS的定位和基于罗盘和计步器的定位之间的偏差较 大，则说明此时GPS定位存在误差较大，不可采用当前的GPS定位结果，为了 保证定位结果的准确性，本实施方式中当判断出GPS定位存在偏差时，触发安 全帽再次重复执行基于GPS的定位和基于罗盘和计步器的定位预设次数，比如， 可以重复执行三次，然后分别计算每一次定位对应的GPS的定位相对于上一个 时间点的第一相对位移，和基于罗盘和计步器的定位相对于上一个时间点的第 二相对位移，然后确定每一次定位对应的第一相对位移和第二相对位移之间的 差值，如果任意一次的定位对应的差值小于第一预设值，则表示该次的GPS定 位有效，将该次GPS定位结果进行记录作为考勤定位信息，否则，即如果三次 定位中GPS定位结果均无效，则此时要采用基于罗盘和计步器的定位结果作为 考勤定位信息；比如如图8所示，OABCD为GPS经纬度转换后的坐标，OEFGH为罗盘+ 计步器定位的坐标，当工人在E附近活动时，通过获取的GPS数据和电子围栏 边缘的比较判断此时工人正处在电子围栏边缘，此时开启两种定位方式结合的 方式实现考勤定位，而当下次触发时获取到两种定位方式的定位结果，通过比 较两种定位方式的相对位移可知，点B和F之间相差较大，由此可以确定此时 GPS定位有偏差，因此，在当下可以触发安全帽连续执行三次的GPS定位和罗 盘+计步器定位，分别确定这三次定位结果与前一时间的定位结果的相对位移， 即GPS定位计算与点A之间的相对位移，罗盘+计步器定位计算与点E之间的 相对位移，如果三次中有任意一次GPS定位与罗盘+计步器定位满足预设阈值， 则采用对应次的GPS定位结果，否则，则记录最后一次获取的罗盘+计步器定位 对应的第二相对位移，然后根据点A处的GPS坐标和该第二相对位移计算出对 应的实际定位结果，将该结果作为考勤定位结果，也就是说，如果采用第二定 位结果作为考勤定位信息，需要根据该第二定位结果和距离该第二定位结果最 近的不能存在偏差的第一定位结果来确定出实际的定位结果；如图9所示，当B点为偏移点时，此时计算近似定位位置应为将EF平移使 E与A重合后获取的F1点认为是此时定位点，也就是说：当GPS定位结果与罗盘+计步器定位结果存在偏差时，获取当前对应的第二 定位结果以及距离当前对应的第二定位结果最近的不存在偏差的第一定位结果；确定上述不存在偏差的第一定位结果对应的第二定位结果，根据当前对应 的第二定位结果与上述不存在偏差的第一定位结果对应的第二定位结果之间的 相对位移和上述不存在偏差的第一定位结果确定当前实际的定位结果，具体实 现时，以上述不存在偏差的第一定位结果为基准，将相对位移平移至上述不存 在偏差的第一定位结果处，并使得与上述不存在偏差的第一定位结果对应的第 二定位结果与上述不存在偏差的第一定位结果重合，则此时平移后的相对位移 的另一端点则为实际的定位结果。如果当采用两种定位方式结合实现考勤定位时，即当采用罗盘+计步器的定 位功能启动时当前GPS坐标作为转换成直角坐标系后的原 点位置，如果该GPS位置就已经存在偏差，后续两种定位方式所有节点的 比对都会存在偏差，因此，为了解决该偏差问题，在一个可选的实施方式中：当罗盘+计步器的定位功能启动时触发GPS转换定位坐标系时的原点查找逻辑，即每预设时间，比如10秒获取一次 GPS定位，并且该GPS定位连续重复获取预设次数，比如5次，将第一次获取 的GPS坐标映射到定位坐标系上的原点坐标，当这五次定位点均无异常偏移点 时，则将上述第一次获取的GPS坐标作为原点坐标，否则重复上述逻辑重新获 取当前GPS坐标作为原点坐标继续检测直至获取到可用原点，如图10所示， O2坐标系左侧点为异常偏移点不作为定位坐标系原点；通过上述查找逻辑保证了在采用两种定位方式结合实现考勤定位时，能够 使得与罗盘+计步器的定位方式对应的基于GPS的定位方式中至少有一个GPS 定位是准确的，从而当要基于罗盘+计步器的定位结果确定实际定位结果时，保 证能够寻找到一个准确的GPS定位结果作为参照点，从而保证了确定的实际定 位结果的准确性；上述查找逻辑中，直角坐标系有两套，一套为罗盘+计步器的定位功能启动 时基于启动点作为原点，后续所有基于罗盘+计步器的位移记录所在的坐标系如 图11所示的坐标系O1，另一套为基于GPS经纬度系统以某 个经纬度坐标作为原点，其他定位位置基于该点的分布构成的直角坐标系如图 12所示的坐标系O2；二者通过时间做关联，如图11中A 相对位移点获取的时间t1与图12中原点O2获取的时间t2 相等或接近时，则认为图12中原点O2定位位置对应图11中位移位置A；如图 10所示，叠加坐标系后可方便的看出位移位置在定位坐标系中的相对位置，通 过该定位坐标系与GPS对应转换可计算出定位坐标系上其他点的GPS定位；在另一个可选的实施方式中，如图2所示，一种基于安全帽定位的考勤装 置，包括：接收模块，用于定时接收安全帽发送的基于GPS确定的第一定位信息以及 基于罗盘和计步器确定的第二定位信息；确定模块，用于根据所述第一定位信息确定基于GPS确定的第一定位结果， 根据所述第二定位信息确定基于罗盘和计步器确定的第二定位结果；判断模块，用于判断所述第一定位结果和第二定位结果之间的差值是否小 于第一预设值，若是，则记录所述第一定位信息以作为考勤定位信息；其中，各个模块所执行的具体步骤包括前述各个实施方式中的基于安全帽 定位的考勤方法中对应的各个步骤；本实施方式中，基于安全帽定位的考勤装置可以是注册服务器，其与应用 服务器、通信服务器和安全帽构成了基于安全帽定位的考勤系统，如图13所示， 通过通信服务器作为入口，可接收来自不同安全帽定位上报装置的定位数据， 并将上报的定位数据经注册服务器过滤转发至应用服务器，还可根据需要在基 于安全帽定位的工人考勤系统中部署多个通信服务器；图14所示为基于安全帽定位的考勤系统中各个装置的模块示意图：应用服务器201，用于管理考勤规则，存储定位数据，分析考勤信息；注册服务器202，用于应用服务器201与通信服务器203之间的通信，将通 信服务器203转发来的定位数据进行过滤后转发至应用服务器201；通信服务器203，用于注册服务器202与安全帽定位上报装置204之间的通 信，将安全帽定位上报装置204上报的定位数据进行解析，随后重新封装成注 册服务器202和应用服务器201可识别的数据结构后将封装后的数据转发至注 册服务器202；安全帽定位上报装置204，用于定时将人员身份验证通过后的定位数据上报 至通信服务器203；安全帽定位上报装置204包含定位数据定时上报装置204-1、定位装置204-2、 自拍装置204-3；定位装置204-2包括两种定位模块，一个是实现GPS定位的定位模块，另 一个是包含计步器+罗盘的定位模块；其中，定位装置204-2可以在注册服务器的触发下确定是否启动基于计步器 +罗盘的定位，具体的触发机制与前述基于安全帽定位的考勤方法中的实施方式 相同，即将获取的GPS定位数据与电子围栏的边缘进行比对，若根据GPS定位 数据确定安全帽正处于电子围栏边缘，则启动基于计步器+罗盘的定位，采用两 种定位方式相结合的方式确定考勤定位信息；自拍装置204-3是一个安装在安全帽帽檐上的摄像头，该摄像头对准人脸方 向可实现人脸抓拍功能。定位数据定时上报装置204-1存在定时任务，可通过远程配置方式为其配置 任务周期间隔，默认周期为30分钟触发一次上报任务。当任务周期到来时，将 触发自拍装置204-3进行人脸抓拍，将抓拍到的照片与定位数据定时上报装置 204-1预先配置的人员人脸照片进行比对，人脸比对不一致则发出蜂鸣告警，并 终止后续流程，直至下次任务周期到来时重新进行比对；人脸比对一致时则触 发定位装置204-2中的GPS定位模块获取当前经纬度坐标，并将获取到经纬度 坐标与当前获取时间以及安全帽定位上报装置唯一标示封装成定位数据传输至 通信服务器203；通信服务器203包含协议解析单元203-1；协议解析单元203-1用于对定位数据定时上报装置204-1上报的定位数据做 协议解析，解析出其中的安全帽定位上报装置唯一标识，经纬度坐标，经纬度 坐标获取时间，并将其重新封装成注册服务器202，应用服务器201可识别的数 据结构；注册服务器202包含注册单元202-1，过滤单元202-2；注册单元202-1用于存储安全帽定位上报装置的唯一标识以及基本信息，如 序列号，mac，ip，端口，远程操作登入用户名，密码等；同时存储工人人员唯 一标识以及人员人脸照片信息如身份证号、姓名、性别、职务、学历、照片等； 通过将注册单元202-1中存储的安全帽定位上报装置唯一标示与人员唯一表示 进行绑定，随后将绑定人员人脸照片通过远程方式配置到安全帽定位上报设备 装置204中用于其身份验证。过滤单元202-2用于通信服务器203转发来的定位数据中包含的安全帽定位 上报装置唯一标识进行解析并与注册单元202-1中存储的安全帽定位上报装置 唯一标识进行比对，当找到一致的安全帽定位上报装置唯一标示后则将该定位 数据转发至应用服务器201，否则不一致则丢弃该数据并终止后续流程；应用服务器201包含定位数据存储单元201-1，考勤统计单元201-2，考勤 规则单元201-3；定位数据存储单元201-1用于将注册服务器202转发来的定位数据进行持久 化；考勤统计单元201-2用于从考勤规则单元201-3获取规则信息，并将规则信 息应用于从定位数据存储单元201-1中存储的定位数据中，从定位数据统计出考 勤信息。考勤规则单元201-3用于配置考勤统计单元201-2统计时所使用的统计规则， 规则包括通过配置至少三点的经纬度度坐标围成的区域作为考勤区域，当定位 数据不在该区域范围则认为出场，反之当定位数据在该范围内时认为进场；同 时考勤规则配置考勤有效时间段，即至少一组有起止时间构成的时间段，仅当 定位数据获取时间在有效考勤时间段内的数据才参与考勤统计；其中，考勤规则的设置可以在应用服务器设置，在另一个可选的实施方式 中，也可以在注册服务器中进行设置，再发送给应用服务器。在另一个可选的实施方式中，如图3所示，一种基于安全帽定位的考勤终 端，包括存储器、处理器及存储在所述存储器上并可在所述处理器上运行的计 算机程序，所述处理器执行所述计算机程序时实现上述各个实施例方式中的一 种基于安全帽定位的考勤方法中的各个步骤。综上所述，本发明提供的一种基于安全帽定位的考勤方法、装置及终端， 在对工地的工作人员进行考勤时，借助于安全帽实现考勤定位，并且采用两种 方式实现对安全帽的定位，一种是基于GPS，另一种是基于罗盘和计步器，基 于GPS的定位方式方便快捷，而基于罗盘和计步器的定位方式准确通用，不受 限于所处环境，非常适用于工地等环境复杂的场所，因此，通过两种定位方式 的结合能够实现对考勤人员的准确定位，从而保证了工地中考勤的准确性，同 时在执行考勤的过程中，结合人脸识别认证一方面避免造假，另一方面通过认 证避免了无关的定位数据的上传，同时在获取了定位数据后，进一步基于安全帽标识对定位数据进行验证和过滤，提高了定位数据的可靠性，并减小了定位 数据的冗余性，同时考勤规则可自适应设置，提高了考勤的灵活性，从定位数 据的生成、传输、验证、过滤到应用，整个流程保证了考勤的高效性、可靠性 与准确性。以上所述仅为本发明的实施例，并非因此限制本发明的专利范围，凡是利 用本发明说明书及附图内容所作的等同变换，或直接或间接运用在相关的技术 领域，均同理包括在本发明的专利保护范围内。
