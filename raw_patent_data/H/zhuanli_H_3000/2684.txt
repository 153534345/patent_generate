标题title
金融设备认证方法、取款机、外接设备及存储介质
摘要abst
本发明公开了一种金融设备认证方法、取款机、外接设备及存储介质，属于终端安全技术领域。其中，该方法包括：发送取款机的第一设备信息至外接设备，以使外接设备返回第一私钥签名的第一签名数据；接收第一签名数据，并根据外接设备的第一公钥对第一签名数据的第一验签结果、第一设备信息和外接设备的第二设备信息确定外接设备是否正确；当外接设备正确时，根据取款机的第二私钥对第二设备信息进行签名处理，获得第二签名数据并发送至外接设备，以使外接设备根据取款机的第二公钥对第二签名数据的第二验签结果、第一设备信息和第二设备信息确定取款机是否正确，本发明实现了提高外接设备信息的安全性。
权利要求书clms
1.一种金融设备认证方法，其特征在于，应用于取款机，所述金融设备认证方法包括以下步骤：发送所述取款机的第一设备信息至外接设备，以使所述外接设备根据所述外接设备的第一私钥对所述第一设备信息进行签名处理，获得第一签名数据并返回所述第一签名数据；接收所述外接设备发送的所述第一签名数据，并根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确；当所述外接设备正确时，根据所述取款机的第二私钥对所述第二设备信息进行签名处理，获得第二签名数据并发送第二签名数据至所述外接设备，以使所述外接设备根据所述取款机的第二公钥对所述第二签名数据的第二验签结果、所述第一设备信息和所述第二设备信息确定所述取款机是否正确。2.如权利要求1所述的金融设备认证方法，其特征在于，所述第一设备信息包括第一随机数和所述取款机的第一标识信息，所述第二设备信息包括第二随机数和所述外接设备的第二标识信息，所述根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确的步骤包括：根据所述第一公钥对所述第一签名数据进行验签处理，获得所述取款机验证随机数作为所述第一验签结果；当所述第一验证随机数等于所述第一随机数，且的第一验证标识信息、所述取款机的第一验证随机数和所述外接设备的第二，所述第二验证随机数等于所述第二随机数，且，所述第一验证标识信息为所述第一标识信息时，确定所述外接设备正确；当所述第一验证随机数不等于所述第一随机数时，或，当所述第二验证随机数不等于所述第二随机数时，或，当所述第一验证标识信息为所述第一标识信息以外的信息时，确定所述外接设备不正确。3.如权利要求1所述的金融设备认证方法，其特征在于，所述获得第二签名数据并发送第二签名数据至所述外接设备的步骤包括：获取当前时刻的通讯状态；根据所述取款机的通讯协议和所述通讯状态确定文本信息；拼接所述第二签名数据、所述第一设备信息、所述第二设备信息和所述文本信息作为第二数据，发送所述第二数据至所述外接设备。4.如权利要求1所述的金融设备认证方法，其特征在于，所述接收所述外接设备发送的所述第一签名数据的步骤之后，还包括：获取所述第一设备信息发送至所述外接设备的第一时间和接收到所述第一签名数据的第二时间；当所述第一时间和所述第二时间的时间差大于预设时长时，返回执行发送所述取款机的第一设备信息至外接设备的步骤；当所述第一时间和所述第二时间的时间差小于或等于所述预设时长时，执行所述根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确的步骤。5.如权利要求1至4任一项所述的金融设备认证方法，其特征在于，所述发送所述取款机的第一设备信息至外接设备的步骤之前，还包括：接收身份信息；当所述身份信息具有管理权限时，发送所述第二公钥至所述外接设备并接收所述外接设备的所述第一公钥。6.一种金融设备认证方法，其特征在于，应用于外接设备，所述金融设备认证方法包括以下步骤：接收取款机的第一设备信息并根据所述外接设备的第一私钥对所述第一设备信息进行签名处理，获得第一签名数据并返回所述第一签名数据至所述取款机，以使所述取款机根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确；接收所述取款机发送的第二签名数据，并根据所述取款机的第二公钥对所述第二签名数据的第二验签结果、所述第一设备信息和所述第二设备信息确定所述取款机是否正确；其中，所述第二签名数据为所述取款机当所述外接设备正确时根据所述取款机的第二私钥对所述第二设备信息进行签名处理获得。7.如权利要求6所述的金融设备认证方法，其特征在于，所述第一设备信息包括第一随机数和所述取款机的第一标识信息，所述第二设备信息包括第二随机数和所述外接设备的第二标识信息，所述根据所述取款机的第二公钥对所述第二签名数据的第二验签结果、所述第一设备信息和所述第二设备信息确定所述取款机是否正确的步骤包括：根据所述第二公钥对所述第二数据进行验签处理，获得所述外接设备的第二验证标识信息、所述取款机的第三验证随机数和所述外接设备的第四验证随机数作为所述第二验签结果；当所述第三验证随机数等于所述第一随机数，且，所述第四验证随机数等于所述第二随机数，且，所述第二验证标识信息为所述第二标识信息时，确定所述取款机正确；当所述第三验证随机数不等于所述第一随机数时，或，当所述第四验证随机数不等于所述第二随机数时，或，当所述第二验证标识信息为所述第二标识信息以外的信息时，确定所述取款机不正确。8.一种取款机，其特征在于，所述取款机包括存储器、处理器及存储在所述存储器上并可在所述处理器上运行的金融设备认证程序，所述金融设备认证程序被所述处理器执行时实现如权利要求1至5中任一项所述的金融设备认证方法的步骤。9.一种外接设备，其特征在于，所述外接设备包括存储器、处理器及存储在所述存储器上并可在所述处理器上运行的金融设备认证程序，所述金融设备认证程序被所述处理器执行时实现如权利要求6至7中任一项所述的金融设备认证方法的步骤。10.一种存储介质，其特征在于，所述存储介质上存储有金融设备认证程序，所述金融设备认证程序被处理器执行时实现如权利要求1至7任一项所述的金融设备认证方法的步骤。
说明书desc
技术领域本发明涉及终端安全领域，尤其涉及金融设备认证方法、取款机、外接设备及存储介质。背景技术随着经济的发展，自动取款机由于便捷、高效等原因成为银行的常用设备。为了避免犯罪分子通过更换取款机的部件盗取用户信息，目前，非对称验证方法在取款机端使用外接设备的公钥验证由外接设备私钥签名的数据，从而确定固件未被篡改，但是外接设备也存在用户信息，在该方法下容易导致外接设备接入犯罪分子的取款机中导致用户信息被盗取，降低了外接设备的安全性。上述内容仅用于辅助理解本发明的技术方案，并不代表承认上述内容是现有技术。发明内容本发明的主要目的在于提供一种金融设备认证方法、取款机、外接设备及存储介质，旨在提高外接设备信息的安全性。为实现上述目的，本发明提供一种金融设备认证方法，应用于取款机，所述金融设备认证方法包括以下步骤：发送所述取款机的第一设备信息至外接设备，以使所述外接设备根据所述外接设备的第一私钥对所述第一设备信息进行签名处理，获得第一签名数据并返回所述第一签名数据；接收所述外接设备发送的所述第一签名数据，并根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确；当所述外接设备正确时，根据所述取款机的第二私钥对所述第二设备信息进行签名处理，获得第二签名数据并发送第二签名数据至所述外接设备，以使所述外接设备根据所述取款机的第二公钥对所述第二签名数据的第二验签结果、所述第一设备信息和所述第二设备信息确定所述取款机是否正确。可选地，所述第一设备信息包括第一随机数和所述取款机的第一标识信息，所述第二设备信息包括第二随机数和所述外接设备的第二标识信息，所述根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确的步骤包括：根据所述第一公钥对所述第一签名数据进行验签处理，获得所述取款机的第一验证标识信息、所述取款机的第一验证随机数和所述外接设备的第二验证随机数作为所述第一验签结果；当所述第一验证随机数等于所述第一随机数，且，所述第二验证随机数等于所述第二随机数，且，所述第一验证标识信息为所述第一标识信息时，确定所述外接设备正确；当所述第一验证随机数不等于所述第一随机数时，或，当所述第二验证随机数不等于所述第二随机数时，或，当所述第一验证标识信息为所述第一标识信息以外的信息时，确定所述外接设备不正确。可选地，所述获得第二签名数据并发送第二签名数据至所述外接设备的步骤包括：获取当前时刻的通讯状态；根据所述取款机的通讯协议和所述通讯状态确定文本信息；拼接所述第二签名数据、所述第一设备信息、所述第二设备信息和所述文本信息作为第二数据，发送所述第二数据至所述外接设备。可选地，所述接收所述外接设备发送的所述第一签名数据的步骤之后，还包括：获取所述第一设备信息发送至所述外接设备的第一时间和接收到所述第一签名数据的第二时间；当所述第一时间和所述第二时间的时间差大于预设时长时，返回执行发送所述取款机的第一设备信息至外接设备的步骤；当所述第一时间和所述第二时间的时间差小于或等于所述预设时长时，执行所述根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确的步骤。可选地，所述发送所述取款机的第一设备信息至外接设备的步骤之前，还包括：接收身份信息；当所述身份信息具有管理权限时，发送所述第二公钥至所述外接设备并接收所述外接设备的所述第一公钥。此外，为实现上述目的，本发明还提供一种金融设备认证方法，应用于外接设备，所述金融设备认证方法包括以下步骤：接收取款机的第一设备信息并根据所述外接设备的第一私钥对所述第一设备信息进行签名处理，获得第一签名数据并返回所述第一签名数据至所述取款机，以使所述取款机根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确；接收所述取款机发送的第二签名数据，并根据所述取款机的第二公钥对所述第二签名数据的第二验签结果、所述第一设备信息和所述第二设备信息确定所述取款机是否正确；其中，所述第二签名数据为所述取款机当所述外接设备正确时根据所述取款机的第二私钥对所述第二设备信息进行签名处理获得。可选地，所述第一设备信息包括第一随机数和所述取款机的第一标识信息，所述第二设备信息包括第二随机数和所述外接设备的第二标识信息，所述根据所述取款机的第二公钥对所述第二数据的第二验签结果确定所述取款机是否正确的步骤包括：根据所述第二公钥对所述第二数据进行验签处理，获得所述外接设备的第二验证标识信息、所述取款机的第三验证随机数和所述外接设备的第四验证随机数作为所述第二验签结果；当所述第三验证随机数等于所述第一随机数，且，所述第四验证随机数等于所述第二随机数，且，所述第二验证标识信息为所述第二标识信息时，确定所述取款机正确；当所述第三验证随机数不等于所述第一随机数时，或，当所述第四验证随机数不等于所述第二随机数时，或，当所述第二验证标识信息为所述第二标识信息以外的信息时，确定所述取款机不正确。此外，为实现上述目的，本发明还提供一种取款机，所述取款机包括存储器、处理器及存储在所述存储器上并可在所述处理器上运行的金融设备认证程序，所述金融设备认证程序被所述处理器执行时实现上述任一项所述的金融设备认证方法的步骤。此外，为实现上述目的，本发明还提供一种外接设备，所述外接设备包括存储器、处理器及存储在所述存储器上并可在所述处理器上运行的金融设备认证程序，所述金融设备认证程序被所述处理器执行时实现上述任一项所述的金融设备认证方法的步骤。此外，为实现上述目的，本发明还提供一种存储介质，所述存储介质上存储有金融设备认证程序，所述金融设备认证程序被处理器执行时实现上述任一项所述的金融设备认证方法的步骤。本发明提出一种金融设备认证方法，该方法所述金融设备认证方法包括以下步骤：发送所述取款机的第一设备信息至外接设备，以使所述外接设备根据所述外接设备的第一私钥对所述第一设备信息进行签名处理，获得第一签名数据并返回所述第一签名数据；接收所述外接设备发送的所述第一签名数据，并根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确；当所述外接设备正确时，根据所述取款机的第二私钥对所述第二设备信息进行签名处理，获得第二签名数据并发送第二数据至所述外接设备，以使所述外接设备根据所述取款机的第二公钥对所述第二数据的第二验签结果确定所述取款机是否正确，其中，所述第二数据包括所述第一设备信息、所述外接设备的第二设备信息以及所述第二签名数据。相比于目前的非对称方法，本申请通过第一私钥和第二私钥对第一设备信息和第二设备信息的签名得到第一签名数据和第二签名数据，使得所述第一签名数据和所述第二签名数据分别代表外接设备和取款机的身份，再使用第一公钥验和第二公钥分别对第一签名数据和第二签名数据验签，即取款机和外接设备分别对另一方进行了一次认证，使得所述外接设备无法随意接入其他取款机，避免外接设备的信息泄露，从而提高外接设备信息的安全性。附图说明图1是本发明实施例方案涉及的硬件结构示意图；图2为本发明金融设备认证方法第一实施例的流程示意图；图3为本发明金融设备认证方法第二实施例的流程示意图；图4为本发明金融设备认证方法第三实施例的流程示意图；图5为本发明金融设备认证方法第四实施例的流程示意图；图6为本发明金融设备认证方法第六实施例的流程示意图。本发明目的的实现、功能特点及优点将结合实施例，参照附图做进一步说明。具体实施方式应当理解，此处所描述的具体实施例仅仅用以解释本发明，并不用于限定本发明。本发明实施例提出一种取款机1，在本实施例中，取款机1用于执行实施例一至五中任意实施例的步骤，取款机具体安装有预设应用，取款机1可基于预设应用实现与外接设备2建立通信连接。在本发明实施例中，参照图1。取款机1包括：处理器101，通信总线102，存储器103，网络接口104。通信总线103用于实现这些组件之间的连接通信。存储器103可以是高速RAM存储器，也可以是稳定的存储器，例如磁盘存储器。存储器103可选的还可以是独立于前述处理器101的存储装置。作为一种可读存储介质的存储器103中可以包括金融设备认证程序。在图1所示的装置中，处理器101可以用于调用存储器103中存储的金融设备认证程序，并执行以下实施例中金融设备认证方法的相关步骤操作。本发明实施例提出一种外接设备2，在本实施例中，外接设备2用于执行实施例六至七中任意实施例的步骤，外接设备2具体安装有预设应用，外接设备2可基于预设应用实现与取款机1建立通信连接。在本发明实施例中，参照图1。外接设备2包括：处理器201，通信总线202，存储器203，网络接口204。通信总线203用于实现这些组件之间的连接通信。存储器203可以是高速RAM存储器，也可以是稳定的存储器，例如磁盘存储器。存储器203可选的还可以是独立于前述处理器201的存储装置。作为一种可读存储介质的存储器203中可以包括金融设备认证程序。在图1所示的装置中，处理器201可以用于调用存储器203中存储的金融设备认证程序，并执行以下实施例中金融设备认证方法的相关步骤操作。其中，图1中虚线箭头标识的是外接设备2发送数据至取款机1，实线箭头标识的是取款机1发送数据至外接设备2。本领域技术人员可以理解，图1中示出的结构并不构成对装置的限定，可以包括比图示更多或更少的部件，或者组合某些部件，或者不同的部件布置。本发明实施例提供了一种金融设备认证方法，参照图2，图2为本发明一种金融设备认证方法第一实施例的流程示意图。本实施例中，应用于取款机，所述金融设备认证方法包括：步骤S10，发送所述取款机的第一设备信息至外接设备，以使所述外接设备根据所述外接设备的第一私钥对所述第一设备信息进行签名处理，获得第一签名数据并返回所述第一签名数据；这里的取款机是指自动取款机，所述第一设备信息是指取款机的信息，这里的第一设备信息用于给所述外接设备签名，这里的外接设备是与ATM连接的设备，具体的可以为键盘、读卡器、循环机芯以及触控屏等设备。这里的第一私钥与所述第一公钥对应，由所述外接设备产生，第一私钥只保存于所述外接设备中。外接设备通过第一私钥以及签名算法对所述第一设备信息加密，这里的签名算法可以为公钥密码算法，也可以是椭圆曲线公钥密码算法。外接设备将签名后的第一签名数据发送回所述取款机。步骤S20，接收所述外接设备发送的所述第一签名数据，并根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确；接收所述外接设备发送的所述第一签名数据，所述第一公钥用于验证所述第一签名数据，当验签通过后，根据第一验签结果、所述第一设备信息和所述第二设备信息所述外接设备是否正确，即判断发送的第一签名数据的外接设备是否为发送第一公钥的外接设备。步骤S30，当所述外接设备正确时，根据所述取款机的第二私钥对所述第二设备信息进行签名处理，获得第二签名数据并发送第二签名数据至所述外接设备，以使所述外接设备根据所述取款机的第二公钥对所述第二签名数据的第二验签结果、所述第一设备信息和所述第二设备信息确定所述取款机是否正确。当所述外接设备正确时，根据所述取款机的第二私钥对所述第二设备信息进行签名处理，获得第二签名数据并发送第二签名数据至所述外接设备，以使所述外接设备根据所述取款机的第二公钥对所述第二签名数据的第二验签结果、所述第一设备信息和所述第二设备信息确定所述取款机是否正确。这里的第二私钥是指所述取款机的私钥，与第二公钥配对。通过签名算法与所述第二设备信息进行签名处理，获得第二签名数据。具体的，在本实施例中，这里的签名算法与外接设备对第一设备信息签名的算法相同。将第二数据发送至所述外接设备，以使所述外接设备使用第二公钥对第二数据的第二验签结果，并根据第二验签结果确定所述取款机是否正确，即所述取款机是否为第二公钥对应的取款机。在本实施例中，相比于目前的非对称方法，本申请通过第一私钥和第二私钥对第一设备信息和第二设备信息的签名得到第一签名数据和第二签名数据，使得所述第一签名数据和所述第二签名数据分别代表外接设备和取款机的身份，再使用第一公钥验和第二公钥分别对第一签名数据和第二签名数据验签，即取款机和外接设备分别对另一方进行了一次认证，使得所述外接设备无法随意接入其他取款机，避免外接设备的信息泄露，从而提高外接设备信息的安全性。基于上述实施例，本发明提出一种金融设备认证方法的第二实施例，参照图3，所述第一设备信息包括第一随机数和所述取款机的第一标识信息，所述第二设备信息包括第二随机数和所述外接设备的第二标识信息，所述根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确的步骤包括：步骤S21，根据所述第一公钥对所述第一签名数据进行验签处理，获得所述取款机的第一验证标识信息、所述取款机的第一验证随机数和所述外接设备的第二验证随机数作为所述第一验签结果；所述第一随机数由所述取款机产生，第一标识信息可以由所述取款机发送，也可以由所述外接设备直接获取。所述外接设备对第一设备信息签名时，将对所述第一随机数，所述第二随机数和所述第一标识信息进行拼接并签名，得到第一签名数据。当执行金融设备认证方法时，会重新产生所述第一随机数和所述第二随机数。根据第一公钥对所述第一签名数据进行验签处理时，获取所述第一验证标识信息、所述取款机的第一验证随机数和所述外接设备的第二验证随机数。步骤S22，当所述第一验证随机数等于所述第一随机数，且，所述第二验证随机数等于所述第二随机数，且，所述第一验证标识信息为所述第一标识信息时，确定所述外接设备正确；由于所述第一公钥和所述第一私钥为外接设备的一对密钥，通过所述第一公钥得到的所述第一验证随机数应与所述第一随机数相等，所述第二验证随机数应与所述二随机数相等，所述第一验证标识信息为所述第一标识信息。满足上述条件时，确定所述第一公钥与所述第一私钥为相同的外接设备，由此确定所述外接设备正确。步骤S23，当所述第一验证随机数不等于所述第一随机数时，或，当所述第二验证随机数不等于所述第二随机数时，或，当所述第一验证标识信息为所述第一标识信息以外的信息时，确定所述外接设备不正确。当所述第一验证随机数不等于所述第一随机数时，或，当所述第二验证随机数不等于所述第二随机数时，或，当所述第一验证标识信息为所述第一标识信息以外的信息时，确定所述第一公钥与第一私钥不属于同一个所述外接设备，从而确定所述外接设备不正确。具体的，在其他实施例中，所述第一设备信息包括第一时间戳，所述外接设备通过所述第一私钥对所述第一时间戳签名得到第一签名数据，取款机根据所述第一公钥对所述第一签名数据进行校验得到第一验证时间戳。当所述第一验证时间戳为所述第一时间戳时，确定所述外接设备正确。当所述第一验证时间戳为所述第一时间戳以外的时间戳时，确定所述外接设备不正确。在本实施例中，所述取款机通过发送第一随机数，使得每一次验证的验证数据不相同，可以避免使用历史的通信数据冒充所述外接设备，提高所述取款机的安全性。基于上任一实施例，本发明提出一种金融设备认证方法的第三实施例，参照图4，所述获得第二签名数据并发送第二签名数据至所述外接设备包括：步骤S301，获取当前时刻的通讯状态；这里的通讯协议是指所述取款机与所述外接设备的通讯协议，这里的通讯状态可以为当前所述取款机与所述外接设备通讯的次数，当前所述取款机额与所述外接设备的通讯方向。步骤S302，根据所述取款机的通讯协议和所述通讯状态确定文本信息；根据所述通讯协议确定所述文本信息的结构和各字节的含义，根据所述通讯状态可以确定具体的文本信息。步骤S303，拼接所述第二签名数据、所述第一设备信息、所述第二设备信息和所述文本信息作为第二数据，发送所述第二数据至所述外接设备。具体的，在本实施例中，根据预设拼接顺序将所述第二签名数据、所述第一设备信息、所述外接设备的第二设备信息和所述文本信息拼接为第二数据。在其他实施例中，根据预设拼接顺序将所述第二签名数据、所述第一设备信息、所述外接设备的第二设备信息拼接为所述第二数据。在本实施例中，通过通讯协议和通讯的状态确定文本信息，并拼接为所述第二数据，可以明确发送的目标。避免多个外接设备连接时，第二数据导致其他外接设备认证失败，从而提高认证的准确度。基于上任一实施例，本发明提出一种金融设备认证方法的第四实施例，参照图5，所述接收所述外接设备发送的所述第一签名数据之后，还包括：步骤S201，获取所述第一设备信息发送至所述外接设备的第一时间和接收到所述第一签名数据的第二时间；所述第一时间是指发送第一设备信息的时间，所述第二时间是指接收到所述第一数据的时间。步骤S202，当所述第一时间和所述第二时间的时间差大于预设时长时，返回执行发送所述取款机的第一设备信息至外接设备的步骤；具体的，所述第二时间减去所述第一时间得到所述时间差，当所述时间差大于所述预设时长时，确定所述第一数据不可用，返回执行所述发送所述取款机的第一设备信息至外接设备的步骤。步骤S203，当所述第一时间和所述第二时间的时间差小于或等于所述预设时长时，执行所述根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确的步骤。当所述时间差小于或等于所述预设时长时，判断所述第一数据可用，执行所述根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确的步骤。在本实施例中，通过所述第一时间和所述第二时间的时间差以及预设时长确定所述第一数据是否可用，保证了验签数据的时效性，从而提高了验签准确性。基于上述任一实施例，本发明提出一种金融设备认证方法的第五实施例，所述发送所述取款机的第一设备信息至外接设备的步骤之前，还包括：接收身份信息；当所述身份信息具有管理权限时，发送所述第二公钥至所述外接设备并接收所述外接设备的所述第一公钥。这里的身份信息是指所述取款机用户的身份信息，可用通过账号密码的方式确定身份信息。所述管理权限是指具有使所述取款机和所述外接设备交换公钥的权限。当所述身份信息具有所述管理权限时，发送所述第二公钥至所述外接设备并接收所述外接设备的所述第一公钥。在本实施例中，通过判断身份信息是否具有管理权限，在具有管理权限时，再发送所述第二公钥至所述外接设备并接收所述外接设备的所述第一公钥，避免公钥被非法替换，保证用于验签的公钥与用于签名的私钥匹配，从而提高所述取款机和外接设备的安全性。本发明实施例提供了一种金融设备认证方法，参照图6，图6为本发明一种金融设备认证方法第六实施例的流程示意图。本实施例中，应用于外接设备，所述金融设备认证方法包括：步骤S40，接收取款机的第一设备信息并根据所述外接设备的第一私钥对所述第一设备信息进行签名处理，获得第一签名数据并返回所述第一签名数据至所述取款机，以使所述取款机根据所述外接设备的第一公钥对所述第一签名数据的第一验签结果、所述第一设备信息和所述外接设备的第二设备信息确定所述外接设备是否正确；具体的，在本实施例中，这里的第一设备信息可以为所述第一设备的标识，根据第一私钥和预设算法，对所述第一设备的标识进行签名处理，得到第一签名数据，发送所述第一签名数据至所述取款机。步骤S50，接收所述取款机发送的第二签名数据，并根据所述取款机的第二公钥对所述第二签名数据的第二验签结果、所述第一设备信息和所述第二设备信息确定所述取款机是否正确；其中，所述第二签名数据为所述取款机当所述外接设备正确时根据所述取款机的第二私钥对所述第二设备信息进行签名处理获得。所述第二验签结果是指根据所述第二公钥对所述第二数据的第二签名数据进行验签得到的结果。在本实施例中，通过接收所述第二签名数据，并根据所述第二公钥对所述第二签名数据的第二验签结果、所述第一设备信息和所述第二设备信息确定所述取款机是否正确，使得所述外接设备确定所述取款机是否为交换公钥时的取款机，从而提高了外接设备的安全性。此外，在本实施例中，所述第一设备信息包括第一随机数和所述取款机的第一标识，所述第二设备信息包括第二随机数和所述外接设备的第二标识信息，所述根据所述取款机的第二公钥对所述第二签名数据的第二验签结果、所述第一设备信息和所述第二设备信息确定所述取款机是否正确的步骤包括：根据所述第二公钥对所述第二数据进行验签处理，获得所述外接设备的第二验证标识信息、所述取款机的第三验证随机数和所述外接设备的第四验证随机数作为所述第二验签结果；当所述第三验证随机数等于所述第一随机数，且，所述第四验证随机数等于所述第二随机数，且，所述第二验证标识信息为所述第二标识信息时，确定所述取款机正确；当所述第三验证随机数不等于所述第一随机数时，或，当所述第四验证随机数不等于所述第二随机数时，或，当所述第二验证标识信息为所述第二标识信息以外的信息时，确定所述取款机不正确。这里的第三验证随机数与所述第一随机数对应，第四验证随机数与所述第二随机数对应。当执行金融设备认证方法时，会重新产生所述第一随机数和所述第二随机数。在其他实施例中，所述第一设备信息包括第一时间戳，所述第二设备信息包括第二时间戳，根据所述第二公钥对所述第二数据进行验签处理，获得第三验证时间戳和第四验证时间戳，当所述第三验证时间戳等于第一时间戳，且，所述第四验证时间戳等于所述第二时间戳时，确定所述取款机正确。在本实施例中，通过对第二验签结果和第一随机数和第二随机数的比对，并且所述第一随机数和所述第二随机数在执行金融设备认证方法时重新产生。避免重放攻击，从而提高所述取款机和外接设备的安全性。此外，本申请的实施例还提出一种存储介质，所述存储介质上存储有金融设备认证程序，所述金融设备认证程序被处理器执行时实现如上述任一项所述的金融设备认证方法实施例的步骤。需要说明的是，在本文中，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者系统不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者系统所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括该要素的过程、方法、物品或者系统中还存在另外的相同要素。上述本发明实施例序号仅仅为了描述，不代表实施例的优劣。通过以上的实施方式的描述，本领域的技术人员可以清楚地了解到上述实施例方法可借助软件加必需的通用硬件平台的方式来实现，当然也可以通过硬件，但很多情况下前者是更佳的实施方式。基于这样的理解，本发明的技术方案本质上或者说对现有技术做出贡献的部分可以以软件产品的形式体现出来，该计算机软件产品存储在如上所述的一个存储介质中，包括若干指令用以使得一台终端设备执行本发明各个实施例所述的方法。以上仅为本发明的优选实施例，并非因此限制本发明的专利范围，凡是利用本发明说明书及附图内容所作的等效结构或等效流程变换，或直接或间接运用在其他相关的技术领域，均同理包括在本发明的专利保护范围内。
