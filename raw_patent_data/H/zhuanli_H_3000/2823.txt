标题title
基于xml配置文件递归实现的二进制数据报文解析方法
摘要abst
本申请实施例提出了基于xml配置文件递归实现的二进制数据报文解析方法，包括读取xml配置文件，基于读取到特征字段构造报文结构对象字典；获取数据报文，从已构建的报文结构对象字典中获取与数据报文对应的报文结构对象；对报文结构对象中的字段结构进行遍历，基于其中字段结构的属性进行解析。扩展了xml文件中字段的属性，使得任意结构的动态报文都能完全通过xml配置来完成解析。比硬编码解析方式大大减少了因为接口文档变动、重新修改报文配置所需要的时间。
权利要求书clms
1.基于xml配置文件递归实现的二进制数据报文解析方法，其特征在于，所述方法包括：S1，读取xml配置文件，基于读取到特征字段构造报文结构对象字典；S2，获取数据报文，从已构建的报文结构对象字典中获取与数据报文对应的报文结构对象；S3，对报文结构对象中的字段结构进行遍历，基于其中字段结构的属性进行解析。2.根据权利要求1所述的基于xml配置文件递归实现的二进制数据报文解析方法，其特征在于，所述S1包括：S11，读取二进制数据报文的xml配置文件，获取xml配置文件中的特征字段；S12，根据获取到的特征字段作为索引key，以报文结构对象为值构造报文结构对象字典。3.根据权利要求1所述的基于xml配置文件递归实现的二进制数据报文解析方法，其特征在于，所述S2包括：S21，获取一条二进制数据报文并提取特征；S22，根据特征索引从报文结构对象字典中获取对应的报文结构对象。4.根据权利要求1所述的基于xml配置文件递归实现的二进制数据报文解析方法，其特征在于，所述S3包括：S31，遍历报文结构对象中的字段结构对象列表，如果列表中还有未遍历的字段结构对象，则取出字段结构对象并执行S32，否则退出该层报文解析；S32，对取出的字段结构对象进行基于count属性的判断；S33，对取出的字段结构对象进行基于referTo属性的判断，如果取出的字段结构对象包含referTo属性，则重新执行步骤S2至S3；如果取出的字段结构对象不包含referTo属性，则重新执行步骤S31。5.根据权利要求4所述的基于xml配置文件递归实现的二进制数据报文解析方法，其特征在于，所述S32包括：S321，如果字段结构对象包含count属性，判断count属性是否是变量；S322，如果count属性是变量，则根据已知的字段解析结果动态确定已取出的字段结构对象是否包含count属性，并对包含count属性的字段以数组的方式解析；S323，如果count属性是常量，则以定长数组的方式解析；S324，如果字段结构对象不包含count属性，则以单个元素的方式解析。6.根据权利要求4所述的基于xml配置文件递归实现的二进制数据报文解析方法，其特征在于，所述S33包括：S331，如果字段结构对象包含referTo属性，则判断referTo属性是否是表达式；S332，如果referTo属性是表达式形式，则根据之前的解析结果动态确定referTo的子报文结构对象，并以子报文的方式解析；S333，如果referTo属性不是表达式形式，则根据referTo属性的值直接确定referTo的子报文结构对象，并以子报文的方式解析；S334，如果字段结构对象不包含referTo属性，则执行解析基础类型字段的步骤。7.根据权利要求1所述的基于xml配置文件递归实现的二进制数据报文解析方法，其特征在于，所述S334还包括：S3341，根据length确定字段的长度，根据format确定字段的类型，解析字段的值；S3342，如果字段结构对象format属性是crc函数表达式，不会在二进制数据报文解析成数据字典的过程中使用到，在数据字典序列化成二进制数据报文时，实时计算表达式的值。
说明书desc
技术领域本申请涉及报文解析领域，尤其涉及基于xml配置文件递归实现的二进制数据报文解析方法。背景技术目前轨交行业二进制报文解析主要有两种方法。一种是基于硬编码的方法，代码中硬编码了每个报文的解析逻辑，优点是解析逻辑可以根据具体报文定制，解析非常高效和灵活，缺点是一旦报文接口有变动，要重新修改代码，变更代价较大。另一种是基于xml配置文件的解析方法，Xml具有可读性好，可扩展性强等非常多的优点。在xml文件中配置报文结构，一般会配置字段名称、字段长度、字段类型。其中字段类型通常是基础数据类型，如无符号整数、有符号整数、ASCII字符串、Address类型、枚举类型等。但如果报文字段内容是变长数组、深层次结构体等复杂类型，现有技术无法满足。此外，在修改报文的场景下，报文crc校验字段的值需要根据报文其他字段的值动态计算，如若不然，修改后的报文将无法被业务系统使用。发明内容本申请实施例提出了基于xml配置文件递归实现的二进制数据报文解析方法，解决了现有基于xml配置文件的解析方法无法处理动态数组、复杂的结构体，无法动态更新字段的值等问题。该方法扩展了xml文件中字段的属性，使得任意结构的动态报文都能完全通过xml配置来完成解析。此外该方法的发明，比硬编码解析方式大大减少了因为接口文档变动，重新修改报文配置所需要的时间。具体的，本申请实施例提出的基于xml配置文件递归实现的二进制数据报文解析方法，包括：S1，读取xml配置文件，基于读取到特征字段构造报文结构对象字典；S2，获取数据报文，从已构建的报文结构对象字典中获取与数据报文对应的报文结构对象；S3，对报文结构对象中的字段结构进行遍历，基于其中字段结构的属性进行解析。可选的，所述S1包括：S11，读取二进制数据报文的xml配置文件，获取xml配置文件中的特征字段；S12，根据获取到的特征字段作为索引key，以报文结构对象为值构造报文结构对象字典。可选的，所述S2包括：S21，获取一条二进制数据报文并提取特征；S22，根据特征索引从报文结构对象字典中获取对应的报文结构对象。可选的，所述S3包括：S31，遍历报文结构对象中的字段结构对象列表，如果列表中还有未遍历的字段结构对象，则取出字段结构对象并执行S32，否则退出该层报文解析；S32，对取出的字段结构对象进行基于count属性的判断；S33，对取出的字段结构对象进行基于referTo属性的判断，如果取出的字段结构对象包含referTo属性，则重新执行步骤S2至S3；如果取出的字段结构对象不包含referTo属性，则重新执行步骤S31。可选的，所述S32包括：S321，如果字段结构对象包含count属性，判断count属性是否是变量；S322，如果count属性是变量，则根据已知的字段解析结果动态确定已取出的字段结构对象是否包含count属性，并对包含count属性的字段以数组的方式解析；S323，如果count属性是常量，则以定长数组的方式解析；S324，如果字段结构对象不包含count属性，则以单个元素的方式解析。可选的，所述S33包括：S331，如果字段结构对象包含referTo属性，则判断referTo属性是否是表达式；S332，如果referTo属性是表达式形式，则根据之前的解析结果动态确定referTo的子报文结构对象，并以子报文的方式解析；S333，如果referTo属性不是表达式形式，则根据referTo属性的值直接确定referTo的子报文结构对象，并以子报文的方式解析；S334，如果字段结构对象不包含referTo属性，则执行解析基础类型字段的步骤。可选的，所述S334还包括：S3341，根据length确定字段的长度，根据format确定字段的类型，解析字段的值；S3342，如果字段结构对象format属性是crc函数表达式，不会在二进制数据报文解析成数据字典的过程中使用到，在数据字典序列化成二进制数据报文时，实时计算表达式的值。有益效果：解决了现有基于xml配置文件的解析方法无法处理动态数组、复杂的结构体，无法动态更新字段的值等问题。该方法扩展了xml文件中字段的属性，使得任意结构的动态报文都能完全通过xml配置来完成解析。此外该方法的发明，比硬编码解析方式大大减少了因为接口文档变动，重新修改报文配置所需要的时间。附图说明为了更清楚地说明本申请的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本申请的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本申请实施例提出的基于xml配置文件递归实现的二进制数据报文解析方法的流程图；图2为本申请实施例提出的具体的执行流程图；图3为本申请实施例提出的二进制数据报文xml配置图。具体实施方式为使本申请的结构和优点更加清楚，下面将结合附图对本申请的结构作进一步地描述。具体的，如图1所示，本申请实施例提出的基于xml配置文件递归实现的二进制数据报文解析方法，包括：S1，读取xml配置文件，基于读取到特征字段构造报文结构对象字典；S2，获取数据报文，从已构建的报文结构对象字典中获取与数据报文对应的报文结构对象；S3，对报文结构对象中的字段结构进行遍历，基于其中字段结构的属性进行解析。在实施中，为了解决当前两种解析报文的方法各自存在的问题，现提出一种基于xml配置文件递归实现的二进制数据报文解析方法。通过字段的referTo扩展属性，引用另一个子报文的配置。程序通过报文字段的referTo属性可以知道该字段的值是不是一个结构体对象，如果referTo是子报文的名称，即指向一个子报文配置，则使用该子报文配置解析该字段的值。如果referTo是一个包含其他子报文的表达式，则解析过程中解析该表达式，动态判断使用哪个子报文完成解析，则可以实现动态子报文的解析。值得注意的，本申请提出的报文解析方法，还通过字段的count扩展属性、表示该字段的值是不是一个数组。如果count是常数，则表示该字段的值是一个定长数组，如果count是另一个字段的名称，则表示该字段的值是一个变长数组，数组的长度在报文解析过程中，对应名称字段的值动态确定。具体的，前述方法中用于构建报文结构对象字典操作的S1，包括：S11，读取二进制数据报文的xml配置文件，获取xml配置文件中的特征字段；S12，根据获取到的特征字段作为索引key，以报文结构对象为值构造报文结构对象字典。可选的，前述方法中用于获取与数据报文对应的报文结构对象的S2，包括：S21，获取一条二进制数据报文并提取特征；S22，根据特征索引从报文结构对象字典中获取对应的报文结构对象。可选的，前述方法中用于基于其中字段结构的属性进行解析的S3包括：S31，遍历报文结构对象中的字段结构对象列表，如果列表中还有未遍历的字段结构对象，则取出字段结构对象并执行S32，否则退出该层报文解析；S32，对取出的字段结构对象进行基于count属性的判断；S33，对取出的字段结构对象进行基于referTo属性的判断，如果取出的字段结构对象包含referTo属性，则重新执行步骤S2至S3；如果取出的字段结构对象不包含referTo属性，则重新执行步骤S31。在实施中，S32包括：S321，如果字段结构对象包含count属性，判断count属性是否是变量；S322，如果count属性是变量，则根据已知的字段解析结果动态确定已取出的字段结构对象是否包含count属性，并对包含count属性的字段以数组的方式解析；S323，如果count属性是常量，则以定长数组的方式解析；S324，如果字段结构对象不包含count属性，则以单个元素的方式解析。S33包括：S331，如果字段结构对象包含referTo属性，则判断referTo属性是否是表达式；S332，如果referTo属性是表达式形式，则根据之前的解析结果动态确定referTo的子报文结构对象，并以子报文的方式解析；S333，如果referTo属性不是表达式形式，则根据referTo属性的值直接确定referTo的子报文结构对象，并以子报文的方式解析；S334，如果字段结构对象不包含referTo属性，则执行解析基础类型字段的步骤。S334包括：S3341，根据length确定字段的长度，根据format确定字段的类型，解析字段的值；S3342，如果字段结构对象format属性是crc函数表达式，不会在二进制数据报文解析成数据字典的过程中使用到，在数据字典序列化成二进制数据报文时，实时计算表达式的值。在上述判断步骤中，通过字段的format扩展属性、表示该字段的类型，可以是hex、decimal、binary、ascii等，也可以是表达式，例如：crc32或者crc32,表示修改报文后该字段的值需要根据报文其他字段动态计算。通过referTo扩展属性和embeded扩展属性，使多个报文相同字段只需要配置一次，然后在多个地方引用，解析的时候被引用的子报文配置内嵌到引用的主报文中。基于前述内容提出的技术方案，具体的执行流程如图2所示：步骤1，读取二进制数据报文的xml配置文件，以报文的SID、DID、type等特征字段共同作为索引key，报文结构对象为值，构造报文结构对象字典。其中报文结构对象包含了报文的基本属性和一个字段结构对象列表，字段结构对象包含了字段的各个属性，包括字段占几个字节、字段类型、字段是否是数组、数组长度、引用子报文的报文结构对象等。步骤2，获取一条二进制数据报文，并根据索引从报文结构对象字典中获取对应的报文结构对象。步骤3，遍历报文结构对象中的字段结构对象列表，如果列表中还有未遍历的字段结构对象，则取出一个，进入下一步，否则退出该层报文解析。步骤4，如果字段结构对象包含count属性，则判断count属性是否是变量。如果是，则根据前面字段的解析结果动态确定count属性的值。对于包含count属性的字段以数组的方式解析。否则，以单个元素的方式解析。步骤6，如果字段结构对象包含referTo属性，则判断referTo属性是否是表达式。如果是，则根据之前的解析结果动态确定referTo的子报文结构对象。对于包含referTo属性的字段以子报文的方式解析，回到步骤3，否则进入步骤7。步骤7，根据length确定字段的长度，根据format确定字段的类型，解析字段的值。如果字段结构对象format属性是crc函数表达式，不会在二进制数据报文解析成数据字典的过程中使用到。但是会在数据字典序列化成二进制数据报文时，实时计算表达式的值。图3为二进制数据报文xml配置图，用了一个生活中的例子的配置代替了实际轨道交通的业务报文的配置。主报文，包含Name、Age、HeightAndweight、LuckyNumber、PhoneNumbers、FriendsCount、Friends、CRCValue等字段。第5行，HeightAndweight以嵌入的方式将Height、weight字段嵌入到主报文；第7行，PhoneNumbers是一个内部元素为4个字节十进制数，个数为5的定长数组；第9行，Friends是一个内部元素type为Friend的结构，个数为FriendsCount值的动态变长数组；第10行，当LuckyNumber及以后的任意字段发生改动时，CRCValue字段的值会根据LuckyNumber及以后的字段重新计算；第25行，Food的值是一个根据Type的值动态确定的结构，当Type分别等于1或2时，Food分别用Meet或Vegetable子报文的配置去解析。以上所述仅为本申请的实施例，并不用以限制本申请，凡在本申请的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本申请的保护范围之内。
