标题title
一种手机短信授权托管服务系统
摘要abst
本发明提供了一种手机短信授权托管服务系统，使用MQTT将手机应用、云平台和第三方服务之间的通信链路建立起来，实现了对符合条件的短信的逐级推送。系统中APP负责监听手机的短信，并判断这些短信是否需要被推送至云平台；云平台除了实现对权限等信息的校验外，主要实现了对短信的分流，将短信根据规则分别推送到不同的第三方服务；第三方服务根据各自的业务需要对短信进行响应的处理。本发明依靠云平台，将个人手机短信与第三方服务联系在一起，在保证用户短信安全的情况下，完成对第三方的授权。
权利要求书clms
1.一种手机短信授权托管服务系统，其特征在于，包括手机应用端、云平台和第三方服务端；所述手机应用端包括登录授权模块、短信推送规则模块和短信监听及推送模块；所述登录授权模块用于实现当前用户在云平台的认证，使用Shiro框架实现；工作流程如下：初始化环境，加载配置文件的信息，获取SecurityManager安全管理器；获取当前主体和会话，并、向会话中存储信息；从会话中获取存储的内容，并比较与存储值是否一致；判断当前用户是否认证，如果已认证则将账号和密码封装到UsernamePasswordToken中，并检查是否有指定角色权限；所述短信推送规则模块，该模块可以设置短信推送规则，推送规则和短信的匹配方式使用正则表达式来实现，将符合推送规则的信息推送到云平台；所述短信监听及推送模块在用户给予授权的情况下，该模块负责监听手机收到的短信内容，经过推送规则匹配后，将需要推送的短信内容通过MQTT的方式推送到云平台侧；短信监听通过观察者模式，监听短信数据库实现，具体如下：手机收到信息时，创建一个类继承自ContentObserver类，并重写类里的onChange方法，短信数据库发生变化时，就会回调到onChange方法，在onChange方法中判断是否需要被推送到云平台；所述云平台中主要包括登录注册模块、申请短信服务模块和短信分流模块；所述登录注册模块配合手机用户和第三方完成注册、登录功能；所述申请短信服务模块用于服务提供者云平台中选择开通短信服务功能，开通此功能后，相应的短信会通过云平台转发给第三方服务；所述短信分流模块确定需要该短信的第三方服务提供者，将这条短信使用MQTT推送给需要这条短信的第三方服务提供者。2.根据权利要求1所述的手机短信授权托管服务系统，其特征在于，所述登录授权模块还可以使用OAuth框架具体实现方式如下:OAuth在手机应用端与第三方服务端之间设置了授权层，手机应用端只能登录授权层，手机应用端在登录的时候，指定授权层令牌的权限范围和有效期，手机应用端登录授权层后，第三方服务端根据令牌的权限范围和有效期，向手机应用端开放用户储存的资料。
说明书desc
技术领域本发明涉及一种手机短信授权托管服务系统，属于物联网技术领域。背景技术随着爬虫/反爬虫技术的发展，在爬取网站数据时，由于各种流量限制，往往需要多个账号的访问权限，才能实现最大效率的数据抓取。目前手机短信的主要功能已改变，不再是人与人沟通的一种方式。大部分用途是收取各个平台的登录授权码；小部分的通知信息；还有部分广告信息。爬虫编写者对短信验证码有着特殊的需要，尤其在抓取某些网站的数据时，往往需要通过短信验证码来实现对某网站的登录。用户在将某些物联网设备的操作权限托管给第三方服务时，往往需要通过短信验证的方式将授权提供给第三方服务，需要认为参与，处理不方便。发明内容本发明目的是提供了一种手机短信授权托管服务系统，方便用户将短信授权托管给第三方服务。本发明为实现上述目的，通过以下技术方案实现：一种手机短信授权托管服务系统，包括手机应用端、云平台和第三方服务端；所述手机应用端包括登录授权模块、短信推送规则模块和短信监听及推送模块；所述登录授权模块用于实现当前用户在云平台的认证，使用Shiro框架实现；工作流程如下：初始化环境，加载配置文件的信息，获取SecurityManager安全管理器；获取当前主体和会话，并、向会话中存储信息；从会话中获取存储的内容，并比较与存储值是否一致；判断当前用户是否认证，如果已认证则将账号和密码封装到UsernamePasswordToken中，并检查是否有指定角色权限；所述短信推送规则模块，该模块可以设置短信推送规则，推送规则和短信的匹配方式使用正则表达式来实现，将符合推送规则的信息推送到云平台；所述短信监听及推送模块在用户给予授权的情况下，该模块负责监听手机收到的短信内容，经过推送规则匹配后，将需要推送的短信内容通过MQTT的方式推送到云平台侧；短信监听通过观察者模式，监听短信数据库实现，具体如下：手机收到信息时，创建一个类继承自ContentObserver类，并重写类里的onChange方法，短信数据库发生变化时，就会回调到onChange方法，在onChange方法中判断是否需要被推送到云平台；所述云平台中主要包括登录注册模块、申请短信服务模块和短信分流模块；所述登录注册模块配合手机用户和第三方完成注册、登录功能；所述申请短信服务模块用于服务提供者云平台中选择开通短信服务功能，开通此功能后，相应的短信会通过云平台转发给第三方服务；所述短信分流模块确定需要该短信的第三方服务提供者，将这条短信使用MQTT推送给需要这条短信的第三方服务提供者。优选的，所述登录授权模块还可以使用OAuth框架具体实现方式如下:OAuth在手机应用端与第三方服务端之间设置了授权层，手机应用端只能登录授权层，手机应用端在登录的时候，指定授权层令牌的权限范围和有效期，手机应用端登录授权层后，第三方服务端根据令牌的权限范围和有效期，向手机应用端开放用户储存的资料。本发明的优点在于：本发明依靠云平台，将个人手机短信与第三方服务联系在一起，在保证用户短信安全的情况下，完成对第三方的授权。附图说明附图用来提供对本发明的进一步理解，并且构成说明书的一部分，与本发明的实施例一起用于解释本发明，并不构成对本发明的限制。图1为本发明流程结构示意图。图2为手机应用端与云平台交互流程示意图。图3为第三方服务端与云平台交互流程示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。如图1所示，该系统使用MQTT将手机应用端、云平台和第三方服务端之间的通信链路建立起来，实现了对符合条件的短信的逐级推送。系统中APP负责监听手机的短信，并判断这些短信是否需要被推送至云平台；云平台除了实现对权限等信息的校验外，主要实现了对短信的分流，将短信根据规则分别推送到不同的第三方服务；第三方服务根据各自的业务需要对短信进行响应的处理。手机应用端主要包含以下几个模块：1.登录授权模块用于实现当前用户在云平台的认证，使用Shiro或OAuth的方式实现。其中，shiro是一个开源安全框架，提供身份验证、授权、密码学和会话管理。在不同的项目中用户、权限、角色等信息可以以各种形式存储。其主要工作流程如下：1、初始化环境，例如加载shiro.ini配置文件的信息；2、获取SecurityManager安全管理器；3、获取当前主体；4、获取当前主体的会话；5、向会话中存储一些内容；6、再次从会话中获取存储的内容，并比较与存储值是否一致；7、判断当前用户是否认证；8、将账号和密码封装到UsernamePasswordToken中；9、检查是否有指定角色权限。OAuth的授权逻辑如下:OAuth在"客户端"与"服务提供商"之间，设置了一个授权层。"客户端"不能直接登录"服务提供商"，只能登录授权层，以此将用户与客户端区分开来。"客户端"登录授权层所用的令牌，与用户的密码不同。用户可以在登录的时候，指定授权层令牌的权限范围和有效期。"客户端"登录授权层以后，"服务提供商"根据令牌的权限范围和有效期，向"客户端"开放用户储存的资料。2.设置短信推送规则模块短信推送规则是由手机的拥有者设置的，该规则决定了哪些短信信息将被推送到云平台，推送规则和短信的匹配方式一般使用正则表达式来实现。例如有如下匹配规则：/^+/匹配文本开头为  的短信，其他格式的短信无法匹配成功。无法匹配成功的文本举例：a.是一个快递收发服务点b.一个快递收发服务点c.菜鸟驿站]是一个快递收发服务点3.短信监听及推送模块在用户给予授权的情况下，该模块负责监听手机收到的短信内容，经过推送规则匹配后，将需要推送的短信内容通过MQTT的方式推送到云平台侧。短信的监听一般通过观察者模式，监听短信数据库来实现。当手机收到一条短信时，短信数据库会发生变化。Android提供了ContentObserver类，只要创建一个类继承自ContentObserver类，并重写类里的onChange方法，当短信数据库发生变化时，就会回调到onChange方法。在onChange方法中判断是否需要被推送到云平台，若需要推送，可使用MQTT服务将短信内容推送至云平台。云平台中主要包含以下几个模块：1.登录注册模块配合手机用户和第三方完成注册、登录等授权功能。2.申请短信服务模块第三方在云平台中完成注册后即可在云平台中选择需要开通短信服务的手机号申请开通短信服务功能，开通此功能后，相应的短信会通过云平台转发给第三方服务。3.短信分流模块手机应用端推送到云平台的短信，由短信分流模块确定该短信是被哪个第三方服务提供者需要的，将这条短信使用MQTT推送给需要这条短信的那个第三方服务提供者。如图2，3所示，该系统的主要操作流程包括：手机用户：1.手机用户安装与云平台配套的APP2.手机用户登录并设置短信推送规则3.手机APP开始向云平台推送符合正则的短信第三方服务提供者：4. 第三方服务提供者在云平台完成注册登录5. 第三方服务提供者申请短信服务。6.云平台为第三方服务提供者分配手机号，并将手机号和第三方服务提供者进行临时绑定7.云平台开始向第三方服务提供者推送手机端推送上来的与此第三方服务提供者绑定的信息。最后应说明的是：以上所述仅为本发明的优选实施例而已，并不用于限制本发明，尽管参照前述实施例对本发明进行了详细的说明，对于本领域的技术人员来说，其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
