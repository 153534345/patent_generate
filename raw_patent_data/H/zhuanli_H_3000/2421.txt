标题title
一种分布式逐次逼近型模数转换器及其运算方法
摘要abst
本发明提出了一种分布式逐次逼近型模数转换器及其运算方法，属于半导体CMOS超大规模集成电路中的存内计算技术领域。本发明把传统SAR‑ADC中用于产生参考电压的电容型DAC与SAR逻辑电路独立出来，让存内计算系统内的多个ADC单元共用。并且在每个DSADC单元中仅需一个SA与两个寄存器，一个存储比较器输出结果，一个存储比较器下一次开启的序号。本发明DSADC单元中的SA开启次数随读出位数线性增加，所需功耗与面积都远小于SAR‑ADC与Flash‑ADC。假如输出数据存在稀疏性时，本发明能利用输出数据的稀疏性特点进一步降低功耗与提高转换速度。本发明降低了当存内计算系统内需要使用多个模数转换器时，所使用的多个模数转换器消耗的总面积与功耗。
权利要求书clms
1.一种分布式逐次逼近型模数转换器，其特征在于，包含一个控制模块、若干个模数转换单元和一个稀疏性检测器，每个模数转换单元包括一个灵敏放大器和一个有限状态机，灵敏放大器用于比较两个电压大小并输出比较结果，若待测电压比当前VCMP大则输出高电平“1”，若待测电压比当前VCMP小则输出低电平“0”，有限状态机中包含两个寄存器，分别是结果寄存器ResReg与计数寄存器NumReg，以及一个指向ResReg的位的指针，结果寄存器ResReg存储比较结果，计数寄存器NumReg存储下一次需要开启的比较序号，有限状态机的输出为结果寄存器的值与稀疏信号，稀疏性探测器收集所有模数转换单元的稀疏信号汇总产生总的稀疏判断，将结果送入到控制模块中，控制模块包括一个比较电压产生器和数字控制单元，比较电压产生器用于产生每步用于比较的模拟电压VCMP，数字控制单元用于发出信号。2.一种如权利要求1所述的分布式逐次逼近型模数转换器的运算方法，其步骤包括：1)控制模块中比较电压产生器发出用于比较的模拟电压VCMP，同时数字控制单元发出信号包括复位信号Reset、时钟信号Clk和三个多比特数字信号Num，Num+与Num-；其中，Num代表现在正进行的比较的序号，Num+为假如单个模数转换单元中的灵敏放大器输出为正时，此模数转换单元在下一次应开启比较的序号，Num-为假如单个模数转换单元中的灵敏放大器输出为负时，此模数转换单元下一次应开启比较的序号；2)每个模数转换单元比较内部寄存器NumReg与输入信号Num是否相等；若一个模数转换单元内部寄存器NumReg与输入信号Num相等，灵敏放大器开启并比较待测电压与VCMP电压的大小，把结果存在指针指向的ResReg的最高位，每个模数转换单元根据自己内部的比较结果，选择把两个数字信号Num+或Num-存储在内部NumReg中，当灵敏放大器输出结果为正时，存储Num+，当灵敏放大器输出结果为负时，存储Num-，同时把Ptr指针指向ResReg的下一位；根据灵敏放大器的比较结果把反馈信号Fb置1或0，然后每个模数转换单元输出结果寄存器的值与反馈信号Fb；若一个模数转换单元内部寄存器NumReg与输入信号Num不相等，灵敏放大器不开启，同时把反馈信号Fb置高阻状态，模数转换单元输出结果寄存器的值与反馈信号Fb；每个模数转换单元中有限状态机等待下一次Clk上升沿。3.如权利要求2所述的运算方法，其特征在于，每个模数转换单元先初始化，把内部计数寄存器NumReg与结果寄存器ResReg都置0，同时指针Ptr指向结果寄存器最高位。4.如权利要求2所述的运算方法，其特征在于，在每次Clk上升沿到来时，每个模数转换单元先检查Reset信号是否为1，是则初始化，否则继续进行后续转换。
说明书desc
技术领域本发明属于半导体和CMOS超大规模集成电路中的存内计算技术领域，具体涉及一种基于存储器阵列进行向量矩阵乘法计算中使用的模数转换电路。背景技术随着人工智能与深度学习技术的发展，人工神经网络在自然语言处理、图像识别、自动驾驶、图神经网络等领域得到了广泛的应用。然而逐渐增大的网络规模导致数据在内存与传统计算设备如CPU与GPU间的搬运消耗了大量的能量，这被称为冯诺依曼瓶颈。在人工神经网络算法中占据最主要部分的计算为向量矩阵乘法计算。存内计算，把权重存储在存储器单元中，并在阵列中进行向量矩阵乘法计算，避免了数据在内存与计算单元间的频繁搬运，被认为是一种有希望解决冯诺依曼瓶颈的途径。如图1，存内计算通常使用数模混合计算方式。存储器单元可以是SRAM、DRAM等易失存储器，也可以是Flash、RRAM、PCRAM、MRAM等非易失存储器。向量矩阵乘法计算计算的权重被存储在存储器中，输入通过数模转换器或缓冲器实现，计算结果表示为位线上的电流或电压。计算结果需要由模数转换器读出，在存内计算中常使用的ADC结构为逐次逼近型ADC或快闪型模数转换器。高精度向量矩阵乘法计算需要高精度的ADC进行模数转换读出。传统SAR-ADC与Flash-ADC的结构如图2，SAR-ADC的电容面积与功耗都会随读出位数指数增加，Flash-ADC所需的灵敏放大器数量与总功耗也随读出位数指数增加。由于数模混合存内计算需要同时使用大量ADC读出，单个ADC的面积与功耗增加极大的增加了系统的总面积与功耗，这成为了数模混合存内计算的面积与能效提升的瓶颈。发明内容针对以上问题，本发明提供一种分布式逐次逼近型模数转换器，可以提高工作速度的同时，降低了电路功耗。本发明的技术方案如下：一种分布式逐次逼近型模数转换器，其特征在于，包含一个控制模块、若干个模数转换单元和一个稀疏性检测器，每个模数转换单元包括一个灵敏放大器和一个有限状态机，灵敏放大器用于比较两个电压大小并输出比较结果，若待测电压比当前VCMP大则输出高电平“1”，若待测电压比当前VCMP小则输出低电平“0”，有限状态机中包含两个寄存器，分别是结果寄存器ResReg与计数寄存器NumReg，以及一个指向ResReg的位的指针，结果寄存器ResReg存储比较结果，计数寄存器NumReg存储下一次需要开启的比较序号，有限状态机的输出为结果寄存器的值与稀疏信号，稀疏性探测器收集所有模数转换单元的稀疏信号汇总产生总的稀疏判断，将结果送入到控制模块中，控制模块包括一个比较电压产生器和数字控制单元，比较电压产生器用于产生每步用于比较的模拟电压VCMP，数字控制单元用于发出信号。本发明提供了一种分布式逐次逼近型模数转换器的运算方法，其步骤包括：1)控制模块中比较电压产生器发出用于比较的模拟电压VCMP，同时数字控制单元发出信号包括复位信号Reset、时钟信号Clk和三个多比特数字信号Num，Num+与Num-；其中，Num代表现在正进行的比较的序号，Num+为假如单个模数转换单元中的灵敏放大器输出为正时，此模数转换单元在下一次应开启比较的序号，Num-为假如单个模数转换单元中的灵敏放大器输出为负时，此模数转换单元下一次应开启比较的序号；2)每个模数转换单元比较内部寄存器NumReg与输入信号Num是否相等；若一个模数转换单元内部寄存器NumReg与输入信号Num相等，灵敏放大器开启并比较待测电压与VCMP电压的大小，把结果存在指针指向的ResReg的最高位，每个模数转换单元根据自己内部的比较结果，选择把两个数字信号Num+或Num-存储在内部NumReg中，当灵敏放大器输出结果为正时，存储Num+，当灵敏放大器输出结果为负时，存储Num-。同时把Ptr指针指向ResReg的下一位；根据灵敏放大器的比较结果把反馈信号Fb置1或0，然后每个模数转换单元输出结果寄存器的值与反馈信号Fb；若一个模数转换单元内部寄存器NumReg与输入信号Num不相等，灵敏放大器不开启，同时把反馈信号Fb置高阻状态，模数转换单元输出结果寄存器的值与反馈信号Fb；每个模数转换单元中有限状态机等待下一次Clk上升沿。本发明提出的分布式逐次逼近型ADC把传统SAR-ADC中用于产生参考电压的电容型DAC与SAR逻辑电路独立出来，让存内计算系统内的多个ADC单元共用。并且在每个DSADC单元中仅需一个灵敏放大器与两个寄存器，一个存储比较器输出结果，一个存储比较器下一次开启的序号。且DSADC单元中的灵敏放大器开启次数随读出位数线性增加，所需功耗与面积都远小于存内计算通常使用的SAR-ADC与Flash-ADC。且本发明利用输出稀疏性检测模块与相应的搜索过程，可以减少比较次数，因此提高了DSADC的工作速度与进一步降低了功耗。附图说明图1为基于数模混合存内计算的向量矩阵乘法示意图；图2为SAR-ADC与Flash-ADC结构图；图3为本发明DSADC结构图；图4为本发明DSADC单元的工作流程图；图5为本发明具体实施例中控制模块的搜索树与对应发放的信号；图6为本发明具体实施例中存在输出稀疏性的搜索过程。具体工作方式图3为本发明所提出的分布式逐次逼近型模数转换器结构图。一个DSADC包含一个总的控制模块与若干个分立的模数转换单元与一个稀疏性检测器。控制模块中包括一个比较电压产生器与数字控制单元。比较电压产生器可以用常规数模转换器实现，用于产生模拟电压VCMP。控制部分发出的信号包括复位信号Reset，时钟信号Clk，三个多比特数字信号Num，Num+与Num-。每个分立的DSADC单元内包括一个灵敏放大器与一个有限状态机。有限状态机中包含两个寄存器，分别是结果寄存器与计数寄存器，以及一个指向ResReg的位的指针。ResReg与NumReg的字长与ADC设计精度的位数相同，ResReg存储比较结果，NumReg存储下一次需要开启比较器的步骤序号。FSM的输出为结果寄存器的值ResReg与稀疏信号Fb。稀疏探测器收集所有DSADC单元的稀疏信号，汇总产生总的稀疏判断，结果送入总的控制模块以利用输出稀疏性减少比较次数，提高DSADC的工作速度与进一步降低功耗。图4为每个DSADC单元的工作流程图。假设需要进行N比特的模数转换。首先把寄存器NumReg与ResReg都置0，指针Ptr指向ResReg最高位。在每个Clk上升沿到来时，先检测Reset信号是否为1，是则表示重置并回到初始步，否则开始转换过程。转换过程的开始每个DSADC单元内会先比较内部寄存器NumReg与输入信号Num是否相等，其中Num由总控制模块产生，代表现在正在进行的比较的序号。控制模块发出的信号，包括用于比较的参考电压VCMP，以及三个N比特数字量Num，Num+与Num-。Num代表现在正进行的比较的序号，Num+为假如单个DSADC单元中的灵敏放大器输出为正时此DSADC单元在下一次应开启的序号，Num-为假如单个DSADC单元中的灵敏放大器输出为负时此DSADC单元下一次应开启的序号。在第一次比较时，Num为0，由于每个DSADC单元中的初始NumReg也为0，与Num相等，灵敏放大器开启并比较待测电压与VCMP电压的大小，把结果存在Ptr指向的ResReg的最高位MSB。每个DSADC单元根据自己内部的SA的比较结果，选择把SAR控制逻辑产生的两个数字信号Num+或Num-存储在内部NumReg中，代表下一次需要开启SA比较的序号。同时把Ptr指针指向ResReg的下一位。最后根据SA的比较结果把反馈信号Fb置1或0。然后每个DSADC单元中的FSM等待下一次Clk高电平。若CLK高电平到来时Reset信号为0且NumReg与Num相等，表示需要开启此次比较，此时开启灵敏放大器，把比较结果存储在指针Ptr指针指向的ResReg寄存器的位，其余工作过程与第一次相同。若Clk高电平到来时Reset信号为0且NumReg与Num不相等，表示此次比较跳过，SA不开启，各寄存器值保持不变，只把反馈信号Fb变为高阻。Num由总控制模块产生，产生顺序为预先设定的搜索树。图5是控制模块的搜索树，显示了每次比较时，反复此过程一直到搜索树搜索完成。图5中每个方框代表一次比较过程，其中“比较步骤”为本方框代表的比较过程在所有比较过程中的次序编号，编号由小到大按时间顺序发生。VCMP代表本次比较过程中比较电压产生器输出的模拟电压。Num、Num+与Num-为控制模块输出的三个多比特数字信号。以比较次序编号0为例，此时比较电压产生器输出电压VCMP为1/2VREF，VREF为整个比较过程固定的参考电压。控制模块输出的三个多比特数字信号分别为Num为0，Num+为2，Num-为1。因为此次比较为编号为0的比较，此时所有DSADC单元内的NumReg寄存器都已提前初始化为0。由于NumReg与Num相等，所有DSADC单元都需要执行此次比较。若一个DSADC单元比较结果灵敏放大器输出为正，则把Num+的值2存入NumReg；若一个DSADC单元比较结果灵敏放大器输出为负，则把Num-的值1存入NumReg。当进行到次序为1的比较时，则只有NumReg中存储值为1的DSADC单元才开启，而NumReg中存储值为2的DSADC单元不开启，以节省这部分功耗。图6是存在输出稀疏性时，搜索树的搜索过程。输出稀疏性指根据之前比较结果，判断待测电压不可能存在的范围，并跳过不需要的比较过程。即在序号为1的比较过程，Num等于1，Num-等于3，Num+等于4。假设此时检测器检测到所有ADC单元反馈信号Fb都是1或高阻，表示不会有ADC单元的NumReg存储值会是Num-，那在未来则跳过序号为3的比较周期与所有的后续周期。输出稀疏性常出现在较低或较高电压范围。以上实施例仅用以说明本发明的技术方案而非对其进行限制，本领域的普通技术人员可以对本发明的技术方案进行修改或者等同替换，而不脱离本发明的精神和范围，本发明的保护范围应以权利要求所述为准。
