标题title
一种通用的设备联动方法和系统
摘要abst
本发明涉及物联网应用领域，尤其是涉及一种通用的设备联动方法和系统，该方法在物联网系统中运用联动策略来执行动作，具体包括以下步骤：步骤一：接收物联网系统内发生的事件；步骤二：将发生的事件与各联动策略内配置的事件条件进行匹配，确定触发事件的联动策略；步骤三：判断联动策略内配置的状态条件满足情况，确定满足状态条件的联动策略；步骤四：执行联动策略中配置的场景动作或者根据自学习获得的场景动作。本发明使得在物联网系统内实现多设备联动的复杂场景策略更加灵活和智能，并提供更好的策略泛化能力。
权利要求书clms
1.一种通用的设备联动方法，在物联网系统中运用联动策略来执行动作，其特征在于，具体包括以下步骤：步骤一：接收物联网系统内发生的事件；步骤二：将发生的事件与各联动策略内配置的事件条件进行匹配，确定触发事件的联动策略；步骤三：判断联动策略内配置的状态条件满足情况，确定满足状态条件的联动策略；步骤四：执行联动策略中配置的场景动作或者根据自学习获得的场景动作。2.如权利要求1所述的一种通用的设备联动方法，其特征在于，所述步骤一中接收的事件，具体包括：时间触发事件、设备联动事件以及设备自身产生的事件信息、告警信息；其中，所述的事件包含属性有：事件类型、事件来源、事件值、触发时间；所述事件类型描述事件的触发的原因，具体通过字典表来进行表述；事件值描述当前具体事件的值；触发时间则表示事件发生的时间；事件来源为触发该事件的唯一设备ID编号或者来源ID编号。3.如权利要求1所述的一种通用的设备联动方法，其特征在于，所述步骤二具体为：首先根据发生的事件，组合成多个事件类型Key，包括：事件类型、包含事件来源ID的事件类型、包含事件来源ID和触发者ID的事件类型；然后根据事件类型key，分别从字典数据结构中查找是包含该Key值的联动策略集合，如果没找到，则直接结束；如果找到配置的联动策略集合，则进行遍历：遍历联动策略集合中的每个联动策略，并且判断当前触发的事件是否满足联动策略内配置的事件条件：如果满足，再判断配置的事件条件是否配置了延时执行时间，若配置，则还需要触发延时计时器，再将该联动策略取出放入满足触发事件条件的待触发联动策略列表，待下一步处理；如果不满足事件条件，则继续遍历联动策略集合，直到遍历完成。4.如权利要求3所述的一种通用的设备联动方法，其特征在于，所述每个联动策略中事先配置的事件条件对应为多个事件的，每个事件条件包含事件类型、事件值或者范围、事件触发时间、延时执行时间，可进行动态配置。5.如权利要求3所述的一种通用的设备联动方法，其特征在于，所述字典数据结构为：{事件类型-＜联动策略1,联动策略2，…＞}，是联动策略在存储时，将事件类型和各联动策略进行倒排序存储。6.如权利要求3所述的一种通用的设备联动方法，其特征在于，所述步骤三具体为：从当前遍历的待触发联动策略列表中获取联动策略所配置的状态条件，判断当前配置的状态条件数量：如果当前状态条件为空或者没有配置，则默认满足所述联动策略的状态条件，直接执行联动策略的场景或者动作；如果当前状态条件配置只有一条，则所述联动策略的状态条件根据该唯一状态条件进行判断，判断当前状态条件是否满足，如果满足，则执行联动策略的场景或者动作，否则舍弃当前联动策略；如果当前状态条件配置大于一条，则配置多个状态条件之间的逻辑运算规则，计算每个状态条件的结果，每个状态条件的结果经过所配置的与、或、非逻辑运算后，作为判断所述联动策略的状态条件满足情况的结果，并将计算结果带入逻辑表达式，计算最终的逻辑运算结果，当逻辑运算结果为真时，则执行该联动策略的场景或动作，否则舍弃当前联动策略。7.如权利要求6所述的一种通用的设备联动方法，其特征在于，所述状态条件可进行动态配置，状态条件包含属性：状态对象、状态属性、属性值范围和时间条件，其中时间条件是指对维持当前状态持续时间或者当前状态发生时间点的要求，包括：状态发生时间点小于等于某个时刻、状态发生时间点在某个两个时刻之间、状态发生时间点大于等于某个时刻；状态持续时间小于等于某个时长、状态持续时间在某两个时长之间、状态持续时间大于等于某个时长。8.如权利要求6所述的一种通用的设备联动方法，其特征在于，所述步骤四中的配置的场景动作为配置单个动作或者由多个动作组成的场景 ，所述执行联动策略即执行所述联动策略中配置的多个场景动作以及多个独立动作。9.如权利要求6所述的一种通用的设备联动方法，其特征在于，所述步骤四种的根据自学习获得的场景动作，具体为：当联动策略中场景动作执行后，用户进行了人工反馈，自动收集用户的相关动作，并进行学习，使得当该联动策略下次被执行时，系统会执行学习后的动作，代替原配置的固定动作。10.一种采用权利要求1至9任一一项所述的通用的设备联动方法的联动系统，其特征在于，包括：事件收集模块，用于接收物联网系统内发生的事件；事件条件判断模块，用于匹配各联动策略内配置的事件条件，确定待触发的联动策略；状态条件判断模块，用于判断联动策略内状态条件满足情况，确定满足状态条件的联动策略；设备动作学习和执行模块，用于执行联动策略中配置的场景动作，或者根据自学习获得的场景动作。
说明书desc
技术领域本发明涉及物联网应用领域，尤其是涉及一种通用的设备联动方法和系统。背景技术随着物联网技术的发展，其在智能家居、智慧城市、智能电网、城市管理、智能交通、智能物流、产品溯源尤其是智慧园区等领域，有着广泛和深入的应用。物联网技术的核心思想是将设备智能化，并通过网络等通信技术，实现万物互联，提供智能的云端服务。如何利用设备之间的互联互通，为用户提供更便捷和个性的场景服务，是各个物联网细分领域内所追求的共同诉求。通过公开资料查询，目前绝大部分设备联动方法是基于：当发生什么事件的时候，执行什么样的动作，也就是固有的“当…然后…”的范式。虽然该方法一定程度上解决了联动场景的灵活配置，但是无法满足更复杂的设备联动场景，以及无法更好地实现场景泛化，为用户提供个性的场景服务。发明内容为了解决现有技术中存在的上述技术问题，本发明提出了一种通用的设备联动方法和系统，其具体技术方案如下：一种通用的设备联动方法，在物联网系统中运用联动策略来执行动作，具体包括以下步骤：步骤一：接收物联网系统内发生的事件；步骤二：将发生的事件与各联动策略内配置的事件条件进行匹配，确定触发事件的联动策略；步骤三：判断联动策略内配置的状态条件满足情况，确定满足状态条件的联动策略；步骤四：执行联动策略中配置的场景动作或者根据自学习获得的场景动作。进一步的，所述步骤一中接收的事件，具体包括：时间触发事件、设备联动事件以及设备自身产生的事件信息、告警信息；其中，所述的事件包含属性有：事件类型、事件来源、事件值、触发时间；所述事件类型描述事件的触发的原因，具体通过字典表来进行表述；事件值描述当前具体事件的值；触发时间则表示事件发生的时间；事件来源为触发该事件的唯一设备ID编号或者来源ID编号。进一步的，所述步骤二具体为：首先根据发生的事件，组合成多个事件类型Key，包括：事件类型、包含事件来源ID的事件类型、包含事件来源ID和触发者ID的事件类型；然后根据事件类型key，分别从字典数据结构中查找是包含该Key值的联动策略集合，如果没找到，则直接结束；如果找到配置的联动策略集合，则进行遍历：遍历联动策略集合中的每个联动策略，并且判断当前触发的事件是否满足联动策略内配置的事件条件：如果满足，再判断配置的事件条件是否配置了延时执行时间，若配置，则还需要触发延时计时器，再将该联动策略取出放入满足触发事件条件的待触发联动策略列表，待下一步处理；如果不满足事件条件，则继续遍历联动策略集合，直到遍历完成。进一步的，所述每个联动策略中事先配置的事件条件对应为多个事件的，每个事件条件包含事件类型、事件值或者范围、事件触发时间、延时执行时间，可进行动态配置。进一步的，所述字典数据结构为：{事件类型-＜联动策略1,联动策略2，…＞}，是联动策略在存储时，将事件类型和各联动策略进行倒排序存储。进一步的，所述步骤三具体为：从当前遍历的待触发联动策略列表中获取联动策略所配置的状态条件，判断当前配置的状态条件数量：如果当前状态条件为空或者没有配置，则默认满足所述联动策略的状态条件，直接执行联动策略的场景或者动作；如果当前状态条件配置只有一条，则所述联动策略的状态条件根据该唯一状态条件进行判断，判断当前状态条件是否满足，如果满足，则执行联动策略的场景或者动作，否则舍弃当前联动策略；如果当前状态条件配置大于一条，则配置多个状态条件之间的逻辑运算规则，计算每个状态条件的结果，每个状态条件的结果经过所配置的与、或、非逻辑运算后，作为判断所述联动策略的状态条件满足情况的结果，并将计算结果带入逻辑表达式，计算最终的逻辑运算结果，当逻辑运算结果为真时，则执行该联动策略的场景或动作，否则舍弃当前联动策略。进一步的，所述状态条件可进行动态配置，状态条件包含属性：状态对象、状态属性、属性值范围和时间条件，其中时间条件是指对维持当前状态持续时间或者当前状态发生时间点的要求，包括：状态发生时间点小于等于某个时刻、状态发生时间点在某个两个时刻之间、状态发生时间点大于等于某个时刻；状态持续时间小于等于某个时长、状态持续时间在某两个时长之间、状态持续时间大于等于某个时长。进一步的，所述步骤四中的配置的场景动作为配置单个动作或者由多个动作组成的场景 ，所述执行联动策略即执行所述联动策略中配置的多个场景动作以及多个独立动作。进一步的，所述步骤四种的根据自学习获得的场景动作，具体为：当联动策略中场景动作执行后，用户进行了人工反馈，自动收集用户的相关动作，并进行学习，使得当该联动策略下次被执行时，系统会执行学习后的动作，代替原配置的固定动作。一种通用的设备联动系统，包括：事件收集模块，用于接收物联网系统内发生的事件；事件条件判断模块，用于匹配各联动策略内配置的事件条件，确定待触发的联动策略；状态条件判断模块，用于判断联动策略内状态条件满足情况，确定满足状态条件的联动策略；设备动作学习和执行模块，用于执行联动策略中配置的场景动作，或者根据自学习获得的场景动作。有益效果：本发明使得在物联网系统内实现多设备联动的复杂场景策略更加灵活和智能，并提供更好的策略泛化能力。附图说明图1为本发明的一个实施例的一种通用的设备联动方法的主要步骤流程示意图；图2为本发明方法中的步骤二的具体流程示意图；图3为本发明方法中的步骤三的具体流程示意图；图4为基于本发明方法的联动策略范式示意图；图5为本发明的一个实施例的一种通用的设备联动系统的组成结构图；图6为本发明的一个实施例的一种通用的设备联动装置的结构示意图。具体实施方式为了使本发明的目的、技术方案和技术效果更加清楚明白，以下结合说明书附图和实施例，对本发明作进一步详细说明。如图1所示，本发明的一个实施例的一种通用的设备联动方法，应用于服务器或者网关，所述服务器或者网关与设备通信连接，该方法具体包括以下步骤：步骤一：接收物联网系统内发生的事件。物联网系统内连接着大量的智能设备，各个智能设备运行期间会产生各种类型的事件，智慧园区内常见的事件包括但不限于：门禁开关事件、车辆道闸开关事件、摄像头安全告警事件、违章停车事件、车辆超速事件、员工刷卡消费事件、灯光开关事件、空调开关/调温事件、窗帘开关事件、员工手动考勤事件、电力设备告警事件以及各类设备、环境状态改变事件等，这些可以统称为智能设备自身产生的事件信息、告警信息。除此之外，还包括时间触发事件：如倒计时结束事件、时刻到达事件等。以及本发明所描述的设备联动事件，即执行联动策略的事件，也作为事件来源之一。为了更好的描述事件，将事件抽象成至少包含属性：事件类型、事件来源、事件值、触发时间。所述事件类型主要描述该事件是由什么触发，具体通过字典表来进行表述；而事件值描述当前具体事件的值；触发时间则表示事件发生的时间；事件来源为触发该事件的唯一设备编号或者来源编号。比如描述“在时间2022/06/15 12:12:12 设备ID为dlaksdjf-kj23h4kljklk的设备触发了开门事件”，其中“设备ID为“dlaksdjf-kj23h4kljklk”的设备”为事件来源，“时间2022/06/15 12:12:12”为触发时间，“开门事件”为事件类型。步骤二：将发生的事件与各联动策略内配置的事件条件进行匹配，确定触发事件的联动策略。每个联动策略中事先配置的事件条件至少包含一个事件，每个事件条件包含事件类型、事件值或者范围、事件触发时间、延时执行时间；所述事件条件可进行动态配置。在存储联动策略时，将事件类型和联动策略进行倒排序存储，即字典数据结构为：{事件类型-＜联动策略1,联动策略2，…＞}，其中的事件类型对应的事件值是根据步骤一中事件类型、来源编号灵活组合而成。当事件触发时，根据触发的事件类型，从所述字典数据结构中，找到所有待触发的联动策略；遍历每个待触发的联动策略，找到满足触发事件条件的联动策略，具体步骤如图2所示，包括：首先根据输入的事件即发生的事件，组合成多个事件类型Key，包括：事件类型、包含事件来源ID的事件类型、包含事件来源ID和触发者ID的事件类型。然后根据事件类型key，分别去字典数据结构中查找是包含该Key值的联动策略集合；如果没找到，则直接结束；如果找到配置的联动策略集合，则进行遍历：遍历联动策略集合中的每个联动策略，并且判断当前触发的事件是否满足联动策略内配置的事件条件：如果满足，再判断该配置的事件条件是否配置了延时执行时间，若配置，则还需要触发延时计时器，再将该联动策略取出放入满足触发事件条件的待触发联动策略列表，待步骤三中进一步处理；如果不满足事件条件，则继续遍历联动策略集合，直到遍历完成。步骤三：判断联动策略内配置的状态条件满足情况，确定满足状态条件的联动策略。通过步骤二，已经筛选出了满足当前触发事件的联动策略集合，遍历联动策略集合中的每个联动策略及其条件判断条件，作为最终待执行的联动策略，在联动策略内配置的状态条件可进行动态配置，至少包含属性：状态对象、状态属性、属性值范围，也可能还包含时间条件；其中时间条件是指对维持当前状态持续时间或者当前状态发生时间点的要求，包括：状态发生时间点小于某个时刻、状态发生时间点在某个两个时刻之间、状态发生时间点大于某个时刻；状态持续时间小于某个时长、状态持续时间在某两个时长之间、状态持续时间大于某个时长。具体步骤如图3所示，包括：首先从当前遍历的待触发联动策略中获取该联动策略所配置的状态条件，判断当前配置的状态条件数量：如果当前状态条件为空或者没有配置，则默认满足所述联动策略的状态条件，直接执行步骤四，即执行该联动策略的场景或者动作；如果当前状态条件配置只有一条，则所述联动策略的状态条件根据该唯一状态条件进行判断，判断当前状态条件是否满足，如果满足，则执行步骤四，否则舍弃当前联动策略；如果当前状态条件配置大于一条，则配置多个状态条件之间的逻辑运算规则，计算每个状态条件的结果，每个状态条件的结果经过所配置的与、或、非逻辑运算后，作为判断所述联动策略的状态条件满足情况的结果，形如：)，并将计算结果带入逻辑表达式，计算最终的逻辑运算结果，当逻辑运算结果为真时，则执行该联动策略的场景或动作，否则舍弃当前联动策略。步骤四：执行联动策略中配置的场景动作，或者根据自学习获得的场景动作。当满足步骤三中的状态条件时，联动策略才能最终被执行。联动策略中场景动作可配置单个动作，如关灯，或者由多个动作组成的某个场景，如午休场景下，包括关灯、关门、关窗帘、设置定时闹钟等动作。所以执行联动策略即执行所述联动策略中配置的多个场景动作以及多个独立动作。当联动策略触发后，同时生成联动策略触发事件，也可作为步骤一中的事件来源。当联动策略中场景动作执行后，如果用户进行了人工反馈，则自动收集用户的相关动作，并进行学习，使得当该联动策略下次被执行时，系统会执行学习后的动作，代替原配置的固定动作，实现联动策略的自动泛化能力，达到满足用户个性化的场景服务效果。基于本发明提供的一种系统通用的设备联动方法，可以快速构建出如图4所示的联动策略范式，包括事件条件、状态条件、执行动作。基于联动策略范式，可以快速配置出复杂的设备联动场景，如：例子1：如果室外温度达到35度时，当办公室内有人时，执行关闭窗户，空调设置制冷模式，设置26度；例子2：如果办公室门关闭时，延时1分钟，当办公室没人且处于下班时间时，执行下班场景；例子3：如果会议室门打开或者窗帘打开或者窗帘关闭或者会议室检测有人时，在当前时间会议室处于使用状态或者距离会议开始小于5分钟时，且当前室外温度超过35度，以及当前空调处于关闭状态超过5分钟，执行会议模式并且打开空调设置制冷。如图5所示，本发明实施例中，一种通用的设备联动系统，包括：事件收集模块，其被用于接收物联网系统内发生的事件；事件条件判断模块，其被用于匹配各联动策略内配置的事件条件，确定待触发的联动策略；状态条件判断模块，其被用于判断联动策略内状态条件满足情况，确定满足状态条件的联动策略；设备动作学习和执行模块，其被用于执行联动策略中配置的场景动作，或者根据自学习获得的场景动作。所述事件收集模块：用于接收物联网系统内发生的事件，包括常规的物联网系统内设备自身产生的事件信息、告警信息，还包括时间触发事件：如倒计时结束事件、时刻到达事件，还包括所述的联动策略执行事件。其中，所述事件至少包括：事件类型、事件来源、事件值、触发时间。所述事件条件判断模块：其中配置的事件条件可包括多个事件，每个事件条件包含事件类型、事件来源、事件值范围、触发时间，可能包含延时执行时间；所述事件条件可进行动态配置。存储联动策略时，将事件类型和联动策略进行倒排序存储，即字典数据结构为：{事件类型-＜联动策略1,联动策略2，…＞}。当事件触发时，根据该触发的事件类型，去上述数据字典结构里面，找到所有待触发的联动策略；遍历每个待触发的联动策略，找到满足触发事件条件的联动策略。所述状态条件判断模块：包含状态对象、状态属性、属性值范围，可能包含时间条件，状态条件可动态配置。状态条件的时间条件是指对维持当前状态持续时间或者当前状态发生时间点的要求，包括：状态发生时间点小于某个时刻、状态发生时间点在某个两个时刻之间、状态发生时间点大于某个时刻；状态持续时间小于某个时长、状态持续时间在某两个时长之间、状态持续时间大于某个时长。联动策略内，状态条件可包含0个、1个或者多个：当包含0个时，默认满足所述联动策略状态条件；当包含1个时，则所述联动策略状态条件根据该唯一状态条件进行判断；当包含多个时，每个状态条件的结果经过所配置的与、或、非逻辑运算后，作为判断所述联动策略内状态条件满足情况的结果。所述设备动作学习和执行模块：当联动场景执行动作后，如果用户进行了人工反馈，则会自动收集用户的相关动作，并进行学习。当该联动策略下次被执行时，系统会执行学习后的动作，代替原配置的固定动作，实现联动策略的自动泛化能力，达到满足用户个性化的场景服务效果。与前述一种通用设备联动方法的实施例相对应，本发明还提供了一种通用的设备联动装置的实施例。参见图6，本发明实施例提供的一种通用的设备联动装置，包括一个或多个处理器，用于实现上述实施例中的一种通用的设备联动方法。本发明一种通用的设备联动装置的实施例可以应用在任意具备数据处理能力的设备上，该任意具备数据处理能力的设备可以为诸如计算机等设备或装置。装置实施例可以通过软件实现，也可以通过硬件或者软硬件结合的方式实现。以软件实现为例，作为一个逻辑意义上的装置，是通过其所在任意具备数据处理能力的设备的处理器将非易失性存储器中对应的计算机程序指令读取到内存中运行形成的。从硬件层面而言，如图6所示，为本发明的一种通用的设备联动装置所在任意具备数据处理能力的设备的一种硬件结构图，除了图6所示的处理器、内存、网络接口、以及非易失性存储器之外，实施例中装置所在的任意具备数据处理能力的设备通常根据该任意具备数据处理能力的设备的实际功能，还可以包括其他硬件，对此不再赘述。上述装置中各个单元的功能和作用的实现过程具体详见上述方法中对应步骤的实现过程，在此不再赘述。对于装置实施例而言，由于其基本对应于方法实施例，所以相关之处参见方法实施例的部分说明即可。以上所描述的装置实施例仅仅是示意性的，其中所述作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部模块来实现本发明方案的目的。本领域普通技术人员在不付出创造性劳动的情况下，即可以理解并实施。本发明实施例还提供一种计算机可读存储介质，其上存储有程序，该程序被处理器执行时，实现上述实施例中的一种通用的设备联动方法。所述计算机可读存储介质可以是前述任一实施例所述的任意具备数据处理能力的设备的内部存储单元，例如硬盘或内存。所述计算机可读存储介质也可以是外部存储设备，例如所述设备上配备的插接式硬盘、智能存储卡、SD卡、闪存卡等。进一步的，所述计算机可读存储介质还可以既包括任意具备数据处理能力的设备的内部存储单元也包括外部存储设备。所述计算机可读存储介质用于存储所述计算机程序以及所述任意具备数据处理能力的设备所需的其他程序和数据，还可以用于暂时地存储已经输出或者将要输出的数据。以上所述，仅为本发明的优选实施案例，并非对本发明做任何形式上的限制。虽然前文对本发明的实施过程进行了详细说明，对于熟悉本领域的人员来说，其依然可以对前述各实例记载的技术方案进行修改，或者对其中部分技术特征进行同等替换。凡在本发明精神和原则之内所做修改、同等替换等，均应包含在本发明的保护范围之内。
