标题title
基于SOC芯片的车载网关、控制方法及车载装置
摘要abst
本发明公开了一种基于SOC芯片的车载网关、控制方法及车载装置，车载网关包括SOC核心处理模块、以太网接口模块、CAN接口模块、存储模块和电源管理模块，所述以太网接口模块、CAN接口模块、存储模块、USB模块和电源管理模块均与所述SOC核心处理模块连接；所述SOC核心处理模块的FPGA单元采用二层交换网络设计，包括主交换模块SW1、辅交换模块SW2和交换模块倒换及冗余控制模块，当检测到SW1转发状态正常时，控制SW2丢弃接收数据，不进行数据的转发，当检测到SW1转发状态异常，控制SW1不再进行数据转发，切换到SW2进行数据收发，同时SW1进行复位。本发明对核心的以太网交换部分进行冗余设计，增强了网关的可靠性，并且具有强大的数据采集和处理能力。
权利要求书clms
1.基于SOC芯片的车载网关，其特征在于，包括SOC核心处理模块、以太网接口模块、CAN接口模块、存储模块和电源管理模块，所述以太网接口模块、CAN接口模块、存储模块、USB模块和电源管理模块均与所述SOC核心处理模块连接；所述SOC核心处理模块包括CPU单元和FPGA单元，所述CPU单元，用于电路监控、系统配置、电源管理、路由表维护和路由计算；所述FPGA单元采用二层交换网络设计，用于实现交换方式的控制，包括主交换模块SW1、辅交换模块SW2和交换模块倒换及冗余控制模块，在车载网关正常工作时，主交换模块SW1完成数据接收和转发，辅交换模块SW2进行数据接收及校验，并检测主交换模块SW1的转发状态，当检测到主交换模块SW1转发状态正常时，交换模块倒换及冗余控制模块发出第一控制指令，控制辅交换模块SW2丢弃接收数据，不进行数据的转发，当检测到主交换模块SW1转发状态异常，交换模块倒换及冗余控制模块发出第二控制指令，控制主交换模块SW1不再进行数据转发，切换到辅交换模块SW2进行数据收发，同时主交换模块SW1进行复位；所述以太网接口模块，用于通过主交换模块SW1、辅交换模块SW2连接外部网口；所述CAN接口模块，用于与整车的执行元件进行内部通信；所述存储模块，用于存储配置数据、程序数据和整车运行内存数据；所述电源管理模块，用于为SOC核心处理模块和以太网接口模块提供电能。2.根据权利要求1所述基于SOC芯片的车载网关，其特征在于，所述主交换模块SW1和辅交换模块SW2的结构相同，均包括MAC控制模块、端口调度模块、报文解析分类模块、打包模块、数据缓存模块、Hash表模块、数据优先级分类模块、错误检测控制模块、包分流模块、令牌桶调度模块和SW控制模块；所述MAC控制模块与端口调度模块连接，所述端口调度模块分别与打包模块和报文解析分类模块连接，所述打包模块与包分流模块连接，所述包分流模块与错误检测控制模块连接，所述错误检测控制与SW控制模块连接，所述报文解析模块分类模块与数据缓存模块和Hash表模块连接，所述数据缓存模块和Hash表模块均与、数据优先级分类模块连接，所述数据优先级分类模通过多个令牌桶与令牌桶调度模块连接，所述令牌桶调度模块与错误检测控制模块连接。3.根据权利要求2所述基于SOC芯片的车载网关，其特征在于，所述MAC控制模块，用于数据报文MAC地址学习，然后端口调度模块根据MAC地址表进行数据报文转发；所述端口调度模块，用于数据包的收发控制，确定发送数据包的端口；所述报文解析分类模块，用于提取报文的五元组，并将所述五元组与数据包进行分流；所述五元组包括源IP地址、源端口、目标IP地址、目标端口和传输层协议；所述打包模块，用于数据打包，增加数据报文头和MAC地址；所述数据缓存模块，用于缓存各端口接收的数据报文，形成数据队列发送给优先级分类模块；所述Hash表模块，用于查询报文优先级及安全策略，并输出数据包优先级及安全策略，进入优先级分类模块；所述数据优先级分类模块，用于优先级分类模块根据数据包是否安全，决定是否打开令牌桶，不符合安全规则的数据包，将不被接受，进行丢弃，被接受的数据包，根据优先级，决定数据包去向哪一个令牌桶；所述错误检测控制模块，用于对令牌桶输出的数据进行校验，若有错误丢弃，无误则继续传输；所述包分流模块，用于根据报文类型确定二层转发或三层转发，CPU单元接收三层的数据报文，配置报文转发端口；所述令牌桶调度模块，用于以优先级调动令牌桶，将数据输出；输出的数据经过转发引擎由打包模块，进入端口调度模块；所述SW控制模块，用于检测接收数据缓冲区使用情况，控制端口收发数据。4.根据权利要求2所述基于SOC芯片的车载网关，其特征在于，所述打包模块通过二层引擎和三层引擎与包分流模块连接，包分流模块根据优先级及安全策略，决定令牌桶输出的数据进行二层转发或三层转发；所述二层引擎实现二层交换机功能，所述三层引擎实现三层交换机功能。5.根据权利要求4所述基于SOC芯片的车载网关，其特征在于，所述主交换模块SW1和辅交换模块SW2还包括CPU配置端口，所述CPU配置端口用于Hash表模块设置和参数读取，设置VLAN、IP地址和接口access，实现三层转发功能。6.根据权利要求2所述基于SOC芯片的车载网关，其特征在于，所述MAC控制模块包括多个MAC单元，多个MAC单元并行与所述端口调度模块连接。7.根据权利要求1所述基于SOC芯片的车载网关，其特征在于，所述存储模块包括Flash、EEPROM和DDR；所述CAN接口模块预留2路CAN总线接口，2路CAN总线接口通过CAN总线与CPU单元连接。8.根据权利要求1所述基于SOC芯片的车载网关，其特征在于，还包括接口检测模块JTAG、USB模块、数字量输入输出模块和模拟量采集模；所述接口检测模块JTAG、USB模块、数字量输入输出模块和模拟量采集模均与SOC核心处理模块连接。9.一种车载网关的控制方法，其特征在于，应用于权利要求1-8中任一项所述的基于SOC芯片的车载网关，该控制方法包括下述步骤：SOC核心处理模块通过以太网接口外接网口设备，获取网口设备的数据流；当车载网关正常工作时，主交换模块SW1完成数据接收和转发，辅交换模块SW2进行数据接收及校验，检测主交换模块SW1的转发状态；当检测到主交换模块SW1转发状态正常时，交换模块倒换及冗余控制模块发出第一控制指令，通知辅交换模块SW2丢弃接收数据，错误检测控制模块丢弃数据报文，不进行数据转发；当检测到主交换模块SW1转发状态异常，交换模块倒换及冗余控制模块发出第二控制指令，控制主交换模块SW1不再进行数据转发，切换到辅交换模块SW2进行数据收发，CPU单元对主交换模块SW1进行复位；当数据流出现突发时，交换模块倒换及冗余控制模块控制辅交换模块SW2进行数据接收，主交换模块SW1将不再进行数据接收，只进行数据发送，接收数据将由辅交换模块SW2完成存储，当主交换模块SW1完成缓冲区的数据转发后，辅交换模块SW2再进行数据发送。10.一种车载装置，包括装置壳体，其特征在于，所述装置壳体中设置有权利要求1-8中任一项所述的基于SOC芯片的车载网关。
说明书desc
技术领域本发明属于车载通信的技术领域，具体涉及一种基于SOC芯片的车载网关、控制方法及车载装置。背景技术车载网关是汽车整车的重要部件，是整车网络的数据交换枢纽，CAN、LIN、MOST、FlexRay等网络数据可以通过车载网关在不同的网络中进行路由。现有技术中提供了一种车载网关，包括控制模块，所述控制模块的连接端连接有储存模块、数据采集模块、信息处理模块、信号采集模块、网络模块，所述数据采集模块、信息处理模块、信号采集模块的输出端连接在网络模块的连接端，所述数据采集模块的连接端连接有CAN总线模块，所述网络模块的连接端连接有串口模块、平台模块和定位模块，从而在网关模块的协同作用下，方便用户适时安排自己的乘车计划，从而大大提高出行效率。但是该车载网关通信率低、可靠性差，不能满足域控制器集中化车载装置的要求。发明内容本发明的主要目的在于克服现有技术的缺点与不足，提供一种基于SOC芯片的车载网关、控制方法及车载装置，通过对以太网交换模块的冗余设计，提高整车的安全性和可靠性。为了达到上述目的，本发明采用以下技术方案：第一方面，本发明实施例提供了一种基于SOC芯片的车载网关，包括SOC核心处理模块、以太网接口模块、CAN接口模块、存储模块和电源管理模块，所述以太网接口模块、CAN接口模块、存储模块、USB模块和电源管理模块均与所述SOC核心处理模块连接；所述SOC核心处理模块包括CPU单元和FPGA单元，所述CPU单元，用于电路监控、系统配置、电源管理、路由表维护和路由计算；所述FPGA单元采用二层交换网络设计，用于实现交换方式的控制，包括主交换模块SW1、辅交换模块SW2和交换模块倒换及冗余控制模块，在车载网关正常工作时，主交换模块SW1完成数据接收和转发，辅交换模块SW2进行数据接收及校验，并检测主交换模块SW1的转发状态，当检测到主交换模块SW1转发状态正常时，交换模块倒换及冗余控制模块发出第一控制指令，控制辅交换模块SW2丢弃接收数据，不进行数据的转发，当检测到主交换模块SW1转发状态异常，交换模块倒换及冗余控制模块发出第二控制指令，控制主交换模块SW1不再进行数据转发，切换到辅交换模块SW2进行数据收发，同时主交换模块SW1进行复位；所述以太网接口模块，用于通过主交换模块SW1、辅交换模块SW2连接外部网口；所述CAN接口模块，用于与整车的执行元件进行内部通信；所述存储模块，用于存储配置数据、程序数据和整车运行内存数据；所述电源管理模块，用于为SOC核心处理模块和以太网接口模块提供电能。进一步的，所述主交换模块SW1和辅交换模块SW2的结构相同，均包括MAC控制模块、端口调度模块、报文解析分类模块、打包模块、数据缓存模块、Hash表模块、数据优先级分类模块、错误检测控制模块、包分流模块、令牌桶调度模块和SW控制模块；所述MAC控制模块与端口调度模块连接，所述端口调度模块分别与打包模块和报文解析分类模块连接，所述打包模块与包分流模块连接，所述包分流模块与错误检测控制模块连接，所述错误检测控制与SW控制模块连接，所述报文解析模块分类模块与数据缓存模块和Hash表模块连接，所述数据缓存模块和Hash表模块均与、数据优先级分类模块连接，所述数据优先级分类模通过多个令牌桶与令牌桶调度模块连接，所述令牌桶调度模块与错误检测控制模块连接。进一步的，所述MAC控制模块，用于数据报文MAC地址学习，然后端口调度模块根据MAC地址表进行数据报文转发；所述端口调度模块，用于数据包的收发控制，确定发送数据包的端口；所述报文解析分类模块，用于提取报文的五元组，并将所述五元组与数据包进行分流；所述五元组包括源IP地址、源端口、目标IP地址、目标端口和传输层协议；所述打包模块，用于数据打包，增加数据报文头和MAC地址；所述数据缓存模块，用于缓存各端口接收的数据报文，形成数据队列发送给优先级分类模块；所述Hash表模块，用于查询报文优先级及安全策略，并输出数据包优先级及安全策略，进入优先级分类模块；所述数据优先级分类模块，用于优先级分类模块根据数据包是否安全，决定是否打开令牌桶，不符合安全规则的数据包，将不被接受，进行丢弃，被接受的数据包，根据优先级，决定数据包去向哪一个令牌桶；所述错误检测控制模块，用于对令牌桶输出的数据进行校验，若有错误丢弃，无误则继续传输；所述包分流模块，用于根据报文类型确定二层转发或三层转发，CPU单元接收三层的数据报文，配置报文转发端口；所述令牌桶调度模块，用于以优先级调动令牌桶，将数据输出；输出的数据经过转发引擎由打包模块，进入端口调度模块；所述SW控制模块，用于检测接收数据缓冲区使用情况，控制端口收发数据。进一步的，所述打包模块通过二层引擎和三层引擎与包分流模块连接，包分流模块根据优先级及安全策略，决定令牌桶输出的数据进行二层转发或三层转发；所述二层引擎实现二层交换机功能，所述三层引擎实现三层交换机功能。进一步的，所述主交换模块SW1和辅交换模块SW2还包括CPU配置端口，所述CPU配置端口用于Hash表模块设置和参数读取，设置VLAN、IP地址和接口access，实现三层转发功能。进一步的，所述MAC控制模块包括多个MAC单元，多个MAC单元并行与所述端口调度模块连接。进一步的，所述存储模块包括Flash、EEPROM和DDR；所述CAN接口模块预留2路CAN总线接口，2路CAN总线接口通过CAN总线与CPU单元连接。进一步的，还包括接口检测模块JTAG、USB模块、数字量输入输出模块和模拟量采集模；所述接口检测模块JTAG、USB模块、数字量输入输出模块和模拟量采集模均与SOC核心处理模块连接。第二方面，本发明实施例还提供了一种车载网关的控制方法，应用于所述的基于SOC芯片的车载网关，该控制方法包括下述步骤：SOC核心处理模块通过以太网接口外接网口设备，获取网口设备的数据流；当车载网关正常工作时，主交换模块SW1完成数据接收和转发，辅交换模块SW2进行数据接收及校验，检测主交换模块SW1的转发状态；当检测到主交换模块SW1转发状态正常时，交换模块倒换及冗余控制模块发出第一控制指令，通知辅交换模块SW2丢弃接收数据，错误检测控制模块丢弃数据报文，不进行数据转发；当检测到主交换模块SW1转发状态异常，交换模块倒换及冗余控制模块发出第二控制指令，控制主交换模块SW1不再进行数据转发，切换到辅交换模块SW2进行数据收发，CPU单元对主交换模块SW1进行复位；当数据流出现突发时，交换模块倒换及冗余控制模块控制辅交换模块SW2进行数据接收，主交换模块SW1将不再进行数据接收，只进行数据发送，接收数据将由辅交换模块SW2完成存储，当主交换模块SW1完成缓冲区的数据转发后，辅交换模块SW2再进行数据发送。第三方面，本发明实施例还提供了一种车载装置，包括装置壳体，所述装置壳体中设置有所述的基于SOC芯片的车载网关。本发明与现有技术相比，具有如下优点和有益效果：本发明的SOC核心处理模块采用二层交换网络设计，在车载网关正常工作时，主交换模块SW1完成数据接收和转发，辅交换模块SW2进行数据接收及校验，并检测主交换模块SW1的转发状态，当检测到主交换模块SW1转发状态正常时，交换模块倒换及冗余控制模块发出第一控制指令，控制辅交换模块SW2丢弃接收数据，不进行数据的转发，当检测到主交换模块SW1转发状态异常，交换模块倒换及冗余控制模块发出第二控制指令，控制主交换模块SW1不再进行数据转发，切换到辅交换模块SW2进行数据收发，同时主交换模块SW1进行复位。所述主交换模块SW1和辅交换模块SW2实时监控对方的状态，防止模块死机造成通信中断，影响车载以太网通信；当出现数据量突发时，可通过流水线技术降低数据缓存溢出，解决数据量突发引起缓存溢出问题，增加系统可靠性，降低网络出错的概率。另外，本发明采用集成SOC芯片，降低了网关体积、减少了功耗、增加了系统可靠性。附图说明为了更清楚地说明本申请实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本申请的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例中基于SOC芯片的车载网关的结构示意图；图2为本发明实施例中车载以太网的二层交换网络结构示意图；图3为本发明实施例中车载网关控制方法的流程图；图4为本发明实施例中车载装置的结构示意图；具体实施方式为了使本技术领域的人员更好地理解本申请方案，下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述。显然，所描述的实施例仅仅是本申请一部分实施例，而不是全部的实施例。基于本申请中的实施例，本领域技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本申请保护的范围。在本申请中提及“实施例”意味着，结合实施例描述的特定特征、结构或特性可以包含在本申请的至少一个实施例中。在说明书中的各个位置出现该短语并不一定均是指相同的实施例，也不是与其它实施例互斥的独立的或备选的实施例。本领域技术人员显式地和隐式地理解的是，本申请所描述的实施例可以与其它实施例相结合。请参阅图1，在本申请的一个实施例中提供了一种基于SOC芯片的车载网关，包括SOC核心处理模块、以太网接口模块、CAN接口模块、存储模块和电源管理模块，所述以太网接口模块、CAN接口模块、存储模块、USB模块和电源管理模块均与所述SOC核心处理模块连接。本实施例中，以太网交换模块和硬件接口设计通过硬件编程实现，CPU使用SOC芯片的多核处理器实现；通过硬件编程实现以太网二层交换模块，使用两个以太网二层交换模块实现冗余设计，增加系统可靠性。进一步的，所述SOC核心处理模块包括CPU单元和FPGA单元，所述CPU单元，用于电路监控、系统配置、电源管理、路由表维护和路由计算，所述FPGA单元采用二层交换网络设计，用于实现交换方式的控制，包括主交换模块SW1、辅交换模块SW2和交换模块倒换及冗余控制模块，在车载网关正常工作时，主交换模块SW1完成数据接收和转发，辅交换模块SW2进行数据接收及校验，并检测主交换模块SW1的转发状态，当检测到主交换模块SW1转发状态正常时，交换模块倒换及冗余控制模块发出第一控制指令，控制辅交换模块SW2丢弃接收数据，不进行数据的转发，当检测到主交换模块SW1转发状态异常，交换模块倒换及冗余控制模块发出第二控制指令，控制主交换模块SW1不再进行数据转发，切换到辅交换模块SW2进行数据收发，同时主交换模块SW1进行复位。更进一步的，请参阅图2，所述主交换模块SW1和辅交换模块SW2的结构相同，下面以主交换模块SW1为例进行说明，所述主交换模块SW1包括MAC控制模块、端口调度模块、报文解析分类模块、打包模块、数据缓存模块、Hash表模块、数据优先级分类模块、错误检测控制模块、包分流模块、令牌桶调度模块和SW1控制模块；分别与打包模块和报文解析分类模块连接，所述打包模块与包分流模块连接，所述包分流模块与错误检测控制模块连接，所述错误检测控制与SW1控制模块连接，所述报文解析模块分类模块与数据缓存模块和Hash表模块连接，所述数据缓存模块和Hash表模块均与、数据优先级分类模块连接，所述数据优先级分类模通过多个令牌桶与令牌桶调度模块连接，所述令牌桶调度模块与错误检测控制模块连接。所述MAC控制模块，用于数据报文MAC地址学习，然后端口调度模块根据MAC地址表进行数据报文转发。所述端口调度模块，用于数据包的收发控制，确定发送数据包的端口。所述报文解析分类模块，用于提取报文的五元组，并将所述五元组与数据包进行分流；所述五元组包括源IP地址、源端口、目标IP地址、目标端口和传输层协议。所述打包模块，用于数据打包，增加数据报文头和MAC地址。所述数据缓存模块，用于缓存各端口接收的数据报文，形成数据队列发送给优先级分类模块。所述Hash表模块，用于查询报文优先级及安全策略，并输出数据包优先级及安全策略，进入优先级分类模块。所述数据优先级分类模块，用于优先级分类模块根据数据包是否安全，决定是否打开令牌桶，不符合安全规则的数据包，将不被接受，进行丢弃，被接受的数据包，根据优先级，决定数据包去向哪一个令牌桶。所述错误检测控制模块，用于对令牌桶输出的数据进行校验，若有错误丢弃，无误则继续传输。所述包分流模块，用于根据报文类型确定二层转发或三层转发，CPU单元接收三层的数据报文，配置报文转发端口。所述令牌桶调度模块，用于以优先级调动令牌桶，将数据输出；输出的数据经过转发引擎由打包模块，进入端口调度模块。所述SW控制模块，用于检测接收数据缓冲区使用情况，控制端口收发数据。可以理解的，所述端口调度模块一方面通过接收打包模块发送的数据，另一方面将调度的数据发送至报文解析分类模块；所述包分流模块通过二层引擎或三层引擎将包数据分流给打包模块，而打包模块的数据来源于错误检测控制模块。进一步的，本实施例中转发引擎分层级设置，分为二层引擎和三层引擎，包分流模块根据优先级及安全策略，决定令牌桶输出的数据进行二层转发或三层转发；利用二层引擎实现二层交换机功能，利用三层引擎实现三层交换机功能。可以理解的，所述报文解析分类模块解析后的数据按照分类的不同，一类存储到数据缓存模块中，另外一类通过五元组的形状写入Hash表模块中，缓存模块和Hash表模块中的数据通过优先级与安全策略发送到优先级分类模块中，所述优先级分类模块经过令牌桶调度模块处理后由错误检测控制模块进行检测。值得注意的是，所述SW1控制模块可直接控制数据缓存模块中存储的数据，从而更加高效的实现数据的交换操作。所述主交换模块SW1和辅交换模块SW2还包括CPU配置端口，所述CPU配置端口用于Hash表模块设置和参数读取，设置VLAN、IP地址和接口access，实现三层转发功能。所述MAC控制模块包括多个MAC单元，多个MAC单元并行与所述端口调度模块连接；示例性的，本实施例MAC控制模块包括MAC0-MAC16，这17个MAC单元均与端口调度模块连接。可以理解的是，辅交换模块SW2的结构组成及工作方式与主交换模块SW1相同，所述主交换模块SW1和辅交换模块SW2连接交换模块倒换及冗余控制模块，通过交换模块倒换及冗余控制模块对主交换模块SW1和辅交换模块SW2的工作状态进行切换和控制。另外，请再次参阅图2，所述辅交换模块SW2也包括MAC0-MAC16，其中主交换模块SW1的MAC0与辅交换模块SW2的MAC0连接，主交换模块SW1的MAC1与辅交换模块SW2的MAC1连接，依此类推，主交换模块SW1的MAC16与辅交换模块SW2的MAC16连接。在一个实施例中，所述以太网接口模块，用于通过主交换模块SW1、辅交换模块SW2连接外部网口，外部网口可以是多个，并行与以太网接口模块连接，例如网口1、网口2…网口n并行设置，然后通过以太网接口模块连接主交换模块SW1、辅交换模块SW2。进一步的，所述CAN接口模块，用于与整车的执行元件进行内部通信；示例性的，所述CAN接口模块预留2路CAN总线接口，用于汽车ECU、传感器、执行器等模块通信，所述CAN接口通过CAN总线跟SOC核心处理模块的CPU单元直接相连，可根据需求完成数据的采集和协议转换，也可进行边缘计算、数据处理。进一步的，所述存储模块，用于存储配置数据、程序数据和整车运行内存数据；示例性的，所述存储模块包括Flash、EEPROM、DDR。所述电源管理模块，用于为SOC核心处理模块和以太网接口模块提供电能。示例性的，所述电源管理模块提供12-36V的电压。在一个实施例中，所述基于SOC芯片的车载网关还包括数字量输入输出模块和模拟量采集模块，示例性的，所述数字量输入输出模块和模拟量采集模块含有4路数字亮输入、4路数字量输出、2路模拟量输入通道，可用于传感器边缘数据采集、执行器及电源输出控制。其中，模拟量数据采集采用了12位的高精度ADC，数字量输出采用继电器输出，可进行供电及执行器的输出驱动。在一个实施例中，所述基于SOC芯片的车载网关还包括串口模块，所述串口模块包括RS485/RS232串行接口，串行接口与SOC核心处理模块的CPU都那样连接相连。所述串口模块可用于网关设备调试及程序升级，也可用于汽车传感器、控制器接入，可用于数据采集及控制。在一个实施例中，所述基于SOC芯片的车载网关还包括接口检测模块JTAG，通过接口检测模块JTAG对SOC核心处理模块进行检测。在一个实施例中，所述基于SOC芯片的车载网关还包括USB模块，通过所述USB模块可以连接外部USB设备，如U盘等。USB模块支持OTG应用，可用于文件的拷贝、设备配置。请参阅图3，在本申请的另一个实施例中，提供了一种车载网关的控制方法，该控制方法包括下述步骤：S1、SOC核心处理模块通过以太网接口外接网口设备，获取网口设备的数据流；S2、当车载网关正常工作时，主交换模块SW1完成数据接收和转发，辅交换模块SW2进行数据接收及校验，检测主交换模块SW1的转发状态；S3、当检测到主交换模块SW1转发状态正常时，交换模块倒换及冗余控制模块发出第一控制指令，通知辅交换模块SW2丢弃接收数据，错误检测控制模块丢弃数据报文，不进行数据转发S4、当检测到主交换模块SW1转发状态异常，交换模块倒换及冗余控制模块发出第二控制指令，控制主交换模块SW1不再进行数据转发，切换到辅交换模块SW2进行数据收发，CPU单元对主交换模块SW1进行复位；S5、当数据流出现突发时，交换模块倒换及冗余控制模块控制辅交换模块SW2进行数据接收，主交换模块SW1将不再进行数据接收，只进行数据发送，接收数据将由辅交换模块SW2完成存储，当主交换模块SW1完成缓冲区的数据转发后，辅交换模块SW2再进行数据发送。本实施例的车载网关的控制方法，完成一种流水线的工作方式，防止缓存溢出造成数据丢包。请参阅图4，在本申请的另一个实施例中，提供了一种车载装置，包括装置壳体，所述装置壳体中设置有所述的基于SOC芯片的车载网关，该车载网关包括SOC核心处理模块、以太网接口模块、CAN接口模块、存储模块和电源管理模块，所述以太网接口模块、CAN接口模块、存储模块、USB模块和电源管理模块均与所述SOC核心处理模块连接；所述SOC核心处理模块包括CPU单元和FPGA单元，所述CPU单元，用于电路监控、系统配置、电源管理、路由表维护和路由计算；所述FPGA单元采用二层交换网络设计，用于实现交换方式的控制，包括主交换模块SW1、辅交换模块SW2和交换模块倒换及冗余控制模块，在车载网关正常工作时，主交换模块SW1完成数据接收和转发，辅交换模块SW2进行数据接收及校验，并检测主交换模块SW1的转发状态，当检测到主交换模块SW1转发状态正常时，交换模块倒换及冗余控制模块发出第一控制指令，控制辅交换模块SW2丢弃接收数据，不进行数据的转发，当检测到主交换模块SW1转发状态异常，交换模块倒换及冗余控制模块发出第二控制指令，控制主交换模块SW1不再进行数据转发，切换到辅交换模块SW2进行数据收发，同时主交换模块SW1进行复位；所述以太网接口模块，用于通过主交换模块SW1、辅交换模块SW2连接外部网口；所述CAN接口模块，用于与整车的执行元件进行内部通信；所述存储模块，用于存储配置数据、程序数据和整车运行内存数据；所述电源管理模块，用于为SOC核心处理模块和以太网接口模块提供电能。本领域普通技术人员可以理解实现上述实施例方法中的全部或部分流程，是可以通过计算机程序来指令相关的硬件来完成，所述的程序可存储于一非易失性计算机可读取存储介质中，该程序在执行时，可包括如上述各方法的实施例的流程。其中，本申请所提供的各实施例中所使用的对存储器、存储、数据库或其它介质的任何引用，均可包括非易失性和/或易失性存储器。非易失性存储器可包括只读存储器、可编程ROM、电可编程ROM、电可擦除可编程ROM或闪存。易失性存储器可包括随机存取存储器或者外部高速缓冲存储器。作为说明而非局限，RAM以多种形式可得，诸如静态RAM、动态RAM、同步DRAM、双数据率SDRAM、增强型SDRAM、同步链路DRAM、存储器总线直接RAM、直接存储器总线动态RAM、以及存储器总线动态RAM等。以上实施例的各技术特征可以进行任意的组合，为使描述简洁，未对上述实施例中的各个技术特征所有可能的组合都进行描述，然而，只要这些技术特征的组合不存在矛盾，都应当认为是本说明书记载的范围。上述实施例为本发明较佳的实施方式，但本发明的实施方式并不受上述实施例的限制，其他的任何未背离本发明的精神实质与原理下所作的改变、修饰、替代、组合、简化，均应为等效的置换方式，都包含在本发明的保护范围之内。
