标题title
一种特殊变结构闭环PI处理器方法
摘要abst
本发明公开了一种特殊变结构闭环PI处理器方法，将电机控制器控制电机速度运行的变结构PI处理划分：①给定速度和反馈速度的误差绝对值大于误差目标值1时阶段，此阶段由于速度误差大于误差目标值1，此时PI的积分KI不参与计算，并且此时的PI的KP动态变化；②给定速度和反馈速度的误差绝对值小于误差目标值1并大于误差目标值2，处于动态KP并恒定积分KI动作；③给定速度和反馈速度的误差绝对值小于误差目标值2，此时PI的比例KP和积分KI均参与计算，并且均恒定值；④在速度恒速阶段并且速度误差的符号第一次发生变化，此时恒定KP并动态积分KI动作；通过特殊变结构PI的处理，以提高电机驱动器控制电机速度运行时的动态性和稳态性。
权利要求书clms
1.一种特殊变结构闭环PI处理器方法，其特征在于，所述方法步骤包括：A、实时获取控制电机运行时的设定速度Vref，电机运行时的反馈速度Vf；B、根据设定速度Vref和电机运行时的反馈速度Vf的差，计算出速度误差Verror；C、根据系统速度要求，设置好速度误差目标值ERRref1和速度误差目标值ERRref2；D、判断当前速度误差Verror，满足条件①则处于动态KP并积分KI不动作阶段，满足条件②则处于动态KP并恒定积分KI动作阶段，满足条件③则处于KP恒定并恒定积分KI动作阶段，满足条件④则处于恒定KP并动态积分KI动作阶段，满足条件⑤则处于恒定KP并恒定积分KI动作阶段；条件①，在速度加减速阶段，Verror绝对值＞＝设定误差目标值ERRref1；条件②，在速度加减速阶段，Verror绝对值＜设定误差目标值ERRref1并且Verror＞＝设定误差目标值ERRref2；条件③，在速度加减速阶段，Verror绝对值＜设定误差目标值ERRref2条件④，在速度恒速阶段，Verror符号发生第一次变化；条件⑤，在速度恒速阶段，Verror符号发生第二次变化；E、若处于D中的条件①阶段，则动态KP并积分KI不动作，此时的KP值是以电机驱动器最大力矩为基准，通过最大力矩与速度的误差动态计算出KP，此时的KP命名为KP1；F、若处于D中的条件②阶段，则KP从KP1通过惯性滤波过渡到用户设置的KP值，此时的KP命名为KP2，即一直以KP2参与运算，并积分KI动作，此时的积分KI是用户设置的KI，命名为KI1，并一直以KI1参与运算；G、若处于D中的条件③阶段，则KP恒定，即一直以F中的KP2参与运算，积分KI恒定，并一直以F中的KI1参与运算；H、若处于D中的条件④阶段，则KP恒定，即一直以F中的KP2参与运算，积分KI加大一定的倍数X，这个倍数X可以通过使用者进行设置，例如积分加大到KI2，并一直以KI2参与运算；I、若处于D中的条件⑤阶段，则KP恒定，即一直以F中的KP2参与运算，积分KI恢复到KI1，并一直以KI1参与运算。2.根据权利要求1所述的一种特殊变结构闭环PI处理器方法，其特征在于，步骤E所述的阶段中，动态KP值的计算，是以电机驱动器最大力矩Tmax为基准，通过与速度的误差动态计算出KP，这样会加快加减速的响应，而此时积分不参与运算，所以单纯靠KP所计算的力矩控制电机的加减速，防止了加减速过程中因速度误差大时造成的积分值的饱和作用和积分退出慢的现象。3.根据权利要求1所述的一种特殊变结构闭环PI处理器方法，其特征在于，步骤F所述的阶段中，由于速度误差进入了小误差阶段，此时的KP从KP1通过惯性滤波过渡到用户设置的KP值，并积分KI动作。通过惯性滤波过渡，减少了KP值的突变而造成的力矩的突变，使得电机驱动器输出力矩柔性过渡。4.根据权利要求1所述的一种特殊变结构闭环PI处理器方法，其特征在于，步骤H所述的阶段中，速度误差Verror符号发生第一次变化，说明速度反馈值已经超调，此时应该以更强的KI参与运算，以便快速减少积分器中的累加值，从而大大抑制反馈速度超调量。5.根据权利要求1所述的一种特殊变结构闭环PI处理器方法，其特征在于，步骤I所述的阶段中，速度误差Verror符号发生第二次变化，说明反馈速度已经在进入稳态过渡，此时KP和积分KI均以用户设置的正常值进行稳态调节，这样稳态误差就能正常保证，速度就不会震荡。6.根据权利要求1的一种特殊变结构闭环PI处理器方法，其特征在于，其中E步骤所述的方法中的计算公式为：KP1＝Tmax/Verror其中KP1的上限为程序能够允许的最大字节。7.根据权利要求1的一种特殊变结构闭环PI处理器方法，其特征在于，其中F步骤所述的方法中的计算公式：KP＝a*KP2**KP其中KP的初值为KP1，a为滤波系数，KP2＝KP。8.根据权利要求1的一种特殊变结构闭环PI处理器方法，其特征在于，其中H步骤所述的方法中的计算公式：KI2＝KI1*X；其中X是扩大倍数，可以由用户设定。
说明书desc
技术领域本发明涉及驱动器控制电机的速度环闭环控制技术领域，特别是涉及一种特殊变结构闭环PI处理器方法。背景技术近年来，随着新能源汽车的迅速发展，市面上各种型式的车辆均逐步新能源化，小到自行车、大到公交大巴重卡等，并且混动车辆控制在整个新能源车中市场占有率也可观，在混动技术中，有一项档位切换工艺，在此工艺中，时常要用到速度控制模式，在速度控制模式中，实际电机速度的超调量又是一个比较关键的指标，在现有技术中为了减少超调量，常见的技术有纯积分分离技术和积分抗饱和技术，用积分分离技术和积分抗饱和技术时，虽然可以减少速度超调量，但减少超调量的范围有限，均有可能造成速度的超调量达不到要求，为此我们提出一种特殊变结构闭环PI处理器方法。发明内容为了克服现有技术的不足，本发明提供一种特殊变结构闭环PI处理器方法，利用动态速度环PI技术，直接对速度误差的大小和方向进行直接判断，动态调节PI参数，达到直接控制速度超调量的效果。为解决上述技术问题，本发明提供如下技术方案：一种特殊变结构闭环PI处理器方法，所述方法步骤包括：A、实时获取控制电机运行时的设定速度Vref，电机运行时的反馈速度Vf；B、根据设定速度Vref和电机运行时的反馈速度Vf的差，计算出速度误差Verror；C、根据系统速度要求，设置好速度误差目标值ERRref1和速度误差目标值ERRref2；D、判断当前速度误差Verror，满足条件①则处于动态KP并积分KI不动作阶段，满足条件②则处于动态KP并恒定积分KI动作阶段，满足条件③则处于KP恒定并恒定积分KI动作阶段，满足条件④则处于恒定KP并动态积分KI动作阶段，满足条件⑤则处于恒定KP并恒定积分KI动作阶段；条件①，在速度加减速阶段，Verror绝对值＞＝设定误差目标值ERRref1；条件②，在速度加减速阶段，Verror绝对值＜设定误差目标值ERRref1并且Verror＞＝设定误差目标值ERRref2；条件③，在速度加减速阶段，Verror绝对值＜设定误差目标值ERRref2条件④，在速度恒速阶段，Verror符号发生第一次变化；条件⑤，在速度恒速阶段，Verror符号发生第二次变化；E、若处于D中的条件①阶段，则动态KP并积分KI不动作，此时的KP值是以电机驱动器最大力矩为基准，通过最大力矩与速度的误差动态计算出KP，此时的KP命名为KP1；F、若处于D中的条件②阶段，则KP从KP1通过惯性滤波过渡到用户设置的KP值，此时的KP命名为KP2，即一直以KP2参与运算，并积分KI动作，此时的积分KI是用户设置的KI，命名为KI1，并一直以KI1参与运算；G、若处于D中的条件③阶段，则KP恒定，即一直以F中的KP2参与运算，积分KI恒定，并一直以F中的KI1参与运算；H、若处于D中的条件④阶段，则KP恒定，即一直以F中的KP2参与运算，积分KI加大一定的倍数X，这个倍数X可以通过使用者进行设置，例如积分加大到KI2，并一直以KI2参与运算；I、若处于D中的条件⑤阶段，则KP恒定，即一直以F中的KP2参与运算，积分KI恢复到KI1，并一直以KI1参与运算。作为本发明的一种优选技术方案，步骤E所述的阶段中，动态KP值的计算，是以电机驱动器最大力矩Tmax为基准，通过与速度的误差动态计算出KP，这样会加快加减速的响应，而此时积分不参与运算，所以单纯靠KP所计算的力矩控制电机的加减速，防止了加减速过程中因速度误差大时造成的积分值的饱和作用和积分退出慢的现象。作为本发明的一种优选技术方案，步骤F所述的阶段中，由于速度误差进入了小误差阶段，此时的KP从KP1通过惯性滤波过渡到用户设置的KP值，并积分KI动作。通过惯性滤波过渡，减少了KP值的突变而造成的力矩的突变，使得电机驱动器输出力矩柔性过渡。作为本发明的一种优选技术方案，步骤H所述的阶段中，速度误差Verror符号发生第一次变化，说明速度反馈值已经超调，此时应该以更强的KI参与运算，以便快速减少积分器中的累加值，从而大大抑制反馈速度超调量。作为本发明的一种优选技术方案，步骤I所述的阶段中，速度误差Verror符号发生第二次变化，说明反馈速度已经在进入稳态过渡，此时KP和积分KI均以用户设置的正常值进行稳态调节，这样稳态误差就能正常保证，速度就不会震荡。作为本发明的一种优选技术方案，其中E步骤所述的方法中的计算公式为：KP1＝Tmax/Verror其中KP1的上限为程序能够允许的最大字节。作为本发明的一种优选技术方案，其中F步骤所述的方法中的计算公式：KP＝a*KP2**KP其中KP的初值为KP1，a为滤波系数，KP2＝KP。作为本发明的一种优选技术方案，其中H步骤所述的方法中的计算公式：KI2＝KI1*X；其中X是扩大倍数，可以由用户设定。与现有技术相比，本发明能达到的有益效果是：通过加减速前期速度大误差阶段的纯动态比例KP以电机驱动器最大力矩运行，解决了动态性的问题，使的加减速动态性能响应快。再通过后期小速度误差范围的KI介入，直接利用反馈速度误差的大小和符号来动态调整比例KP和积分KI，解决了反馈速度超调和稳速时的稳态精度要求。附图说明图1为本发明的的控制总体框图。具体实施方式为了使本发明实现的技术手段、创作特征、达成目的与功效易于明白了解，下面结合具体实施例，进一步阐述本发明，但下述实施例仅仅为本发明的优选实施例，并非全部。基于实施方式中的实施例，本领域技术人员在没有做出创造性劳动的前提下所获得其它实施例，都属于本发明的保护范围。下述实施例中的实验方法，如无特殊说明，均为常规方法，下述实施例中所用的材料、试剂等，如无特殊说明，均可从商业途径得到。实施例:如图1所示，一种特殊变结构闭环PI处理器方法，所述方法步骤包括：A、实时获取控制电机运行时的设定速度Vref，电机运行时的反馈速度Vf；B、根据设定速度Vref和电机运行时的反馈速度Vf的差，计算出速度误差Verror；C、根据系统速度要求，设置好速度误差目标值ERRref1和速度误差目标值ERRref2；D、判断当前速度误差Verror，满足条件①则处于动态KP并积分KI不动作阶段，满足条件②则处于动态KP并恒定积分KI动作阶段，满足条件③则处于KP恒定并恒定积分KI动作阶段，满足条件④则处于恒定KP并动态积分KI动作阶段，满足条件⑤则处于恒定KP并恒定积分KI动作阶段；条件①，在速度加减速阶段，Verror绝对值＞＝设定误差目标值ERRref1；条件②，在速度加减速阶段，Verror绝对值＜设定误差目标值ERRref1并且Verror＞＝设定误差目标值ERRref2；条件③，在速度加减速阶段，Verror绝对值＜设定误差目标值ERRref2条件④，在速度恒速阶段，Verror符号发生第一次变化；条件⑤，在速度恒速阶段，Verror符号发生第二次变化；E、若处于D中的条件①阶段，则动态KP并积分KI不动作，此时的KP值是以电机驱动器最大力矩为基准，通过最大力矩与速度的误差动态计算出KP，此时的KP命名为KP1；F、若处于D中的条件②阶段，则KP从KP1通过惯性滤波过渡到用户设置的KP值，此时的KP命名为KP2，即一直以KP2参与运算，并积分KI动作，此时的积分KI是用户设置的KI，命名为KI1，并一直以KI1参与运算；G、若处于D中的条件③阶段，则KP恒定，即一直以F中的KP2参与运算，积分KI恒定，并一直以F中的KI1参与运算；H、若处于D中的条件④阶段，则KP恒定，即一直以F中的KP2参与运算，积分KI加大一定的倍数X，这个倍数X可以通过使用者进行设置，例如积分加大到KI2，并一直以KI2参与运算；I、若处于D中的条件⑤阶段，则KP恒定，即一直以F中的KP2参与运算，积分KI恢复到KI1，并一直以KI1参与运算。步骤E所述的阶段中，动态KP值的计算，是以电机驱动器最大力矩Tmax为基准，通过与速度的误差动态计算出KP，这样会加快加减速的响应，而此时积分不参与运算，所以单纯靠KP所计算的力矩控制电机的加减速，防止了加减速过程中因速度误差大时造成的积分值的饱和作用和积分退出慢的现象。步骤F所述的阶段中，由于速度误差进入了小误差阶段，此时的KP从KP1通过惯性滤波过渡到用户设置的KP值，并积分KI动作。通过惯性滤波过渡，减少了KP值的突变而造成的力矩的突变，使得电机驱动器输出力矩柔性过渡。步骤H所述的阶段中，速度误差Verror符号发生第一次变化，说明速度反馈值已经超调，此时应该以更强的KI参与运算，以便快速减少积分器中的累加值，从而大大抑制反馈速度超调量。步骤I所述的阶段中，速度误差Verror符号发生第二次变化，说明反馈速度已经在进入稳态过渡，此时KP和积分KI均以用户设置的正常值进行稳态调节，这样稳态误差就能正常保证，速度就不会震荡。其中E步骤所述的方法中的计算公式为：KP1＝Tmax/Verror其中KP1的上限为程序能够允许的最大字节。其中F步骤所述的方法中的计算公式：KP＝a*KP2**KP其中KP的初值为KP1，a为滤波系数，KP2＝KP。其中H步骤所述的方法中的计算公式：KI2＝KI1*X；其中X是扩大倍数，可以由用户设定。当前用户设定频率Vref＝60HZ，电机从0开始加速，用户设定ERRref1为最大速度差的4分之1，即*1/4＝15HZ，用户设定ERRref1为最大速度差的6分之1，即*1/6＝10HZ,用户设定的KP＝KP2，用户设定的KI＝KI1，X是用户设定的扩大倍数。Vf是电机时时反馈给电机驱动器的反馈频率。力矩输出T＝KP*Verror+∫。1.当前＝Verror，若Verror绝对值大于15HZ时，当前的KP就以的值作为当前的KP值，KP上限为程序能够允许的最大字。此时的KI＝0。2.当前＝Verror，若Verror绝对值小于15HZ并且大于10HZ时，当前的KP就以的值作为作为初值，惯性滤波到用户设定的KP2，并一直以KP2作为计算值。KI就以用户设定的KI1作为计算值。3.当前＝Verror，若Verror绝对值小于10HZ时，时时判断Verror的符号方向是否发生了变化，若没有发生变化，则KP并一直以KP2作为计算值。KI就以用户设定的KI1作为计算值。若Verror的符号方向第一次发生了变化，则KP并一直以KP2作为计算值。KI就以用户设定的KI1乘以X放大倍数的值作为计算值。若Verror的符号方向第二次发生了变化，则KP并一直以KP2作为计算。KI就以用户设定的KI1值作为计算值。以上显示和描述了本发明的基本原理、主要特征和本发明的优点。本行业的技术人员应该了解，本发明不受上述实施例的限制，上述实施例和说明书中描述的仅为本发明的优选例，并不用来限制本发明，在不脱离本发明精神和范围的前提下，本发明还会有各种变化和改进，这些变化和改进都落入要求保护的本发明范围内，本发明要求保护范围由所附的权利要求书及其等效物界定。
