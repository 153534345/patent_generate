标题title
一种检测并防止MQTT漏洞的方法、系统和装置
摘要abst
本发明公开了一种检测并防止MQTT漏洞的方法、系统和装置，本发明通过漏洞评估、设计解析引擎、协议识别、协议解析和严格协议验证的步骤，在开源IDS中添加MQTT物联网协议支持，使IDS可以用于主动发现和屏蔽物联网设备的漏洞，以及在受到攻击前维护物联网网络或设备漏洞，起到保障物联网设备和网络的安全的效果。本发明还通过定义一套可以被入侵检测系统使用的规则，并由解析引擎使用，实现保护设备免受利用协议实现的漏洞攻击，并防止影响IoT网络的MQTT泛洪攻击。
权利要求书clms
1.一种检测并防止MQTT漏洞的方法，包括以下步骤：S1：漏洞评估；根据在线漏洞报告平台关于MQTT协议的漏洞信息，评估网络中存在的IoT设备的协议漏洞，针对不同的漏洞影响协议的字段进行整理，按照严重程度，难易度进行多优先级算法排序；S2：设计解析引擎；根据对漏洞评估结果设计出解析引擎，所述解析引擎包括协议识别、协议解析和严格协议验证功能；S3：协议识别；解析引擎基于开源IDS支持MQTT协议的基础，识别传入或传出数据包协议，分析数据；S4：协议解析；通过分析协议签名，确定MQTT客户端之间交换包的顺序和特征，以此过滤掉畸形数据包或攻击性的数据包，再根据识别出的协议的格式来解析数据包；S5：严格协议验证；通过分析MQTT数字签名中的TCP长度、总包长度以及来自MQTT代理的响应包中的标志，判断流数据包是否是与MQTT协议相关的数据包，验证数据包字段，是否符合漏洞描述，如果是漏洞就按照引擎提供处理机制处理，如果不是漏洞，就正常流程协议数据。2.如权利要求1所述的一种检测并防止MQTT漏洞的方法，其特征在于：定义一套可以被入侵检测系统使用的规则，并由解析引擎使用。3.如权利要求2所述的一种检测并防止MQTT漏洞的方法，其特征在于：所述规则为，在所述S4协议解析步骤中，解析引擎负责对协议漏洞和MQTT协议包字段的不当使用进行广泛检查。4.如权利要求2所述的一种检测并防止MQTT漏洞的方法，其特征在于，所述规则为，在所述S4协议解析步骤中，从MQTT数据包中提取关键字；将所提取的关键字添加到解析引擎和开源IDS的规则匹配引擎中，解析引擎将从每个MQTT传入或传出的数据包中提取这些关键字的值，并执行严格的协议验证，而开源IDS的规则引擎将关键字的值与MQTT规则匹配，如果存在规则匹配，那么它将阻塞该数据包。5.一种检测并防止MQTT漏洞系统，其特征在于，该系统包括：物联网设备，用于发布和接收数据包；云管理平台，用于执行如权利要求1至4任一方法；MQTT服务器，用于按照如权利要求1至4任一方法与物联网设备、云管理平台进行交互。6.一种电子设备，其特征在于，该电子设备包括：处理器和可读存储介质；所述可读存储介质存储有能够被所述处理器执行的可执行指令；所述处理器用于执行可读存储介质中存储的可执行指令，以实现权利要求1-4任一项的方法步骤。
说明书desc
技术领域本发明涉及物联网安全技术，更具体地，本发明涉及一种检测并防止MQTT漏洞的方法、系统和装置。背景技术随着物联网设备在我们日常生活中的广泛使用，保护物联网设备免受网络攻击的需求日渐增长。通过固件更新对物联网设备中发现的漏洞进行修复是目前最常见的方法。然而，这一功能并不是每个物联网设备都可用。只有少数几家物联网厂商支持物联网设备固件的自动更新。而且，攻击者可能会利用固件更新技术中的漏洞，将一些恶意软件集成到设备固件中。所以物联网设备对补丁或更新固件的支持效果并不好。传统的网络防御系统由于缺乏对受限应用协议、消息排队遥测传输等广泛应用的物联网应用层协议的支持，无法保障物联网设备和网络的安全。发明内容本发明克服了现有技术的不足，提供一种检测并防止MQTT漏洞的方法、系统和装置，以期望可以解决基于网络的IDS不支持MQTT协议的问题。为解决上述的技术问题，本发明采用以下技术方案：一种检测并防止MQTT漏洞的方法，包括以下步骤：S1：漏洞评估；根据NVD和CVE等在线漏洞报告平台关于MQTT协议的漏洞信息，评估网络中存在的IoT设备的协议漏洞，针对不同的漏洞影响协议的字段进行整理，按照严重程度，难易度进行多优先级算法排序；S2：设计解析引擎；根据对漏洞评估结果设计出解析引擎，所述解析引擎包括协议识别、协议解析和严格协议验证功能；所述协议识别、协议解析和严格协议验证功能具体为，解析引擎识别传入或传出数据包的协议，在协议识别之后，根据识别出的协议格式解析数据包，并验证数据包字段；S3：协议识别；解析引擎基于开源IDS支持MQTT协议的基础，识别传入或传出数据包协议，分析数据；S4：协议解析；通过分析协议签名，确定MQTT客户端之间交换包的顺序和特征，以此过滤掉畸形数据包或攻击性的数据包，再根据识别出的协议的格式来解析数据包；所述畸形数据包或攻击性的数据包具体包括：FTP、SMTP、HTTP数据包或攻击性的数据包，S5：严格协议验证；通过分析MQTT数字签名中的TCP长度、总包长度以及来自MQTT代理的响应包中的标志，判断流数据包是否是与MQTT协议相关的数据包。验证数据包字段，是否符合漏洞描述，如果是漏洞就按照引擎提供处理机制处理，如果不是漏洞，就正常流程协议数据。解析引擎将保护大部分MQTT协议发现并解决漏洞。进一步的技术方案是，定义一套可以被入侵检测系统使用的规则，并由解析引擎使用。通过定义规则，并由解析引擎使用该规则，可以提供额外的安全性，防御不属于MQTT协议实现缺陷的网络攻击，例如泛洪攻击，起到进一步保护物联网网络安全的效果。更进一步的技术方案是：所述规则为，在所述S4协议解析步骤中，解析引擎负责对协议漏洞和MQTT协议包字段的不当使用进行广泛检查。由于Suricata的MQTT解析引擎没有对不适当的长度检查、必需字段或逻辑错误执行严格的检查。所以通过定义规则使解析引擎针对不适当的长度检查、必需字段和逻辑错误执行协议验证，解析引擎能在网关级进行严格的协议验证，保护设备免受利用协议实现的漏洞攻击。更进一步的技术方案是：所述规则为，在所述S4协议解析步骤中，从MQTT数据包中提取关键字；将所提取的关键字添加到解析引擎和开源IDS的规则匹配引擎中，解析引擎将从每个MQTT传入或传出的数据包中提取这些关键字的值，并执行严格的协议验证，而开源IDS的规则引擎将关键字的值与MQTT规则匹配，如果存在规则匹配，那么它将阻塞该数据包。当攻击者试图发送多个连接请求时，则会被规则引擎分析检测，如果来自单个源的传入连接请求超过每分钟10个连接请求的限制，则引擎将丢弃这些恶意数据包。同样，当攻击者试图向MQTT代理大量发送发布包时，如果来自单个源的传入流量超过了每分钟100个发布包的限制，引擎将检测并丢弃这种恶意尝试。及时抛弃攻击数据，留下系统资源接收正确的数据，避免系统失效。防止影响IoT网络的MQTT泛洪攻击。本发明还提供了一种检测并防止MQTT漏洞系统，该系统包括：物联网设备，用于发布和接收数据包；云管理平台，用于执行上述方法；MQTT服务器，用于按照上述方法与物联网设备、云管理平台进行交互。本发明还提供了一种电子设备，该电子设备包括：处理器和可读存储介质；所述可读存储介质存储有能够被所述处理器执行的可执行指令；所述处理器用于执行可读存储介质中存储的可执行指令，以实现上述方法步骤。本发明通过在开源IDS中添加MQTT物联网协议支持，使IDS可以用于主动发现和屏蔽物联网设备的漏洞，以及在受到攻击前维护物联网网络或设备漏洞，起到保障物联网设备和网络的安全的效果。附图说明图1为本申请实施例提供的一种检测并防止MQTT漏洞的方法的流程示意图。图2为本申请实施例定义的解析引擎所执行的规则流程示意图。图3为本申请提供的检测并防止MQTT漏洞系统工作原理示意图。具体实施方式为了使本发明的目的、技术方案及优点更加清楚明白，以下结合实施例及附图，对本发明进行进一步详细说明。应当理解，此处所描述的具体实施例仅仅用以解释本发明，并不用于限定本发明。参见图1，公开实施例提供了一种检测并防止MQTT漏洞的方法，包括以下步骤：S1：漏洞评估；根据NVD和CVE等在线漏洞报告平台关于MQTT协议的漏洞信息，评估网络中存在的物联网设备的协议漏洞，针对不同的漏洞影响协议的字段进行整理，按照严重程度，难易度进行多优先级算法排序；在本实施例中按照：包长度检查不当、缺少必要字段检查、缺少逻辑错误检查以及其他漏洞由高到底优先级排序；S2：设计解析引擎；根据对漏洞评估结果，即不同漏洞等级对应的漏洞类别，可配置不同的解析方式，设计出解析引擎，所述解析引擎包括协议识别、协议解析和严格协议验证功能；所述根据不同漏洞等级对应的漏洞类别，可配置不同的解析方式；所述协议识别、协议解析和严格协议验证功能具体为，解析引擎识别传入或传出数据包的协议，在协议识别之后，根据识别出的协议格式解析数据包，并验证数据包字段；S3：协议识别；解析引擎基于开源IDS支持MQTT协议的基础，识别传入或传出数据包协议，分析数据；需要说明的是，开源IDS可以使用：Snort、OSSEC、Suricata等，在本实施例中，使用Suricata。具体为，Suricata中的协议识别是基于底层协议的默认端口号完成的,通过端口过滤的方法来执行MQTT协议识别，即将默认的MQTT端口1883上的每个传入数据包检测为MQTT数据包。S4：协议解析；通过分析协议签名，确定MQTT客户端之间交换包的顺序和特征，以此过滤掉畸形数据包，包括：FTP、SMTP、HTTP数据包和攻击性数据包，再根据识别出的协议的格式来解析数据包；S5：严格协议验证；通过分析MQTT数字签名中的TCP长度、总包长度以及来自MQTT代理的响应包中的标志，判断流数据包是否是与MQTT协议相关的数据包，验证数据包字段，是否符合漏洞描述，如果是漏洞就按照引擎提供的处理机制处理，如果不是漏洞，就作为正常流程协议数据。为了进一步优化方案，本发明实施例在上述实施例的基础上作了进一步的改进，定义一套可以被入侵检测系统使用的规则，并由解析引擎使用。所述规则为，在所述S4协议解析中，解析引擎负责对协议漏洞和MQTT协议包字段的不当使用进行广泛检查。参见图2，在本申请所提供方法的另一实施例中，所述规则为，在所述S4协议解析步骤中，从MQTT数据包中提取关键字；所述提取关键字方法具体为：根据MQTT协议字段，配置正则表达式，提取出关键字，供引擎分析。将所提取的关键字添加到提议的解析引擎和开源IDS的规则匹配引擎中，在本实施例中，所述开源IDS使用Suricata。解析引擎将从每个MQTT传入或传出的数据包中提取这些关键字的值，并执行严格的协议验证，而Suricata的规则引擎将关键字的值与MQTT规则匹配，如果存在规则匹配，那么它将阻塞该数据包。参见图3，本发明还提供了一种检测并防止MQTT漏洞系统，该系统包括：物联网设备，用于发布和接收数据包；云管理平台，用于执行上述方法；MQTT服务器，用于按照上述方法与物联网设备、云管理平台进行交互。本发明还提供了一种电子设备，该电子设备包括：处理器和机器可读存储介质；所述机器可读存储介质存储有能够被所述处理器执行的机器可执行指令；所述处理器用于执行机器可执行指令，以实现上述方法步骤。示例性的，上述机器可读存储介质可以是任何电子、磁性、光学或其它物理存储装置，可以包含或存储信息，如可执行指令、数据，等等。例如，机器可读存储介质可以是：RAM、易失存储器、非易失性存储器、闪存、存储驱动器、固态硬盘、任何类型的存储盘，或者类似的存储介质，或者它们的组合。尽管这里参照本发明的解释性实施例对本发明进行了描述，但是，应该理解，本领域技术人员可以设计出很多其他的修改和实施方式，这些修改和实施方式将落在本申请公开的原则范围和精神之内。更具体地说，在本申请公开的范围内，可以对主题组合布局的组成部件和/或布局进行多种变型和改进。除了对组成部件和/或布局进行的变型和改进外，对于本领域技术人员来说，其他的用途也将是明显的。
