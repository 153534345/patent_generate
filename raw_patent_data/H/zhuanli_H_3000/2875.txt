标题title
可信网络连接身份认证方法、电子设备及存储介质
摘要abst
本发明涉及网络安全技术领域，特别涉及可信网络连接身份认证方法、电子设备及存储介质，其中方法包括：基于EAP，建立终端设备与认证服务器之间的通信；从认证服务器接收含有认证服务器的身份证明的数据包；验证认证服务器的身份，若不合法，则断开通信，若合法，则生成含有终端设备的身份信息的数据包并向认证服务器发送，以利用认证服务器认证；从认证服务器接收含有认证结果的数据包，若认证结果为认证失败，断开通信，若认证结果为继续认证，再次生成含有终端设备的身份信息的数据包并向认证服务器发送，若认证结果为认证成功，确认身份可信。本方案能够保证接入网络的终端设备身份安全可信，且简单、轻量，具备在多种跨域网络中的兼容性。
权利要求书clms
1.一种可信网络连接身份认证方法，其特征在于，包括：基于EAP，建立请求接入的终端设备与认证服务器之间的通信；从所述认证服务器接收含有所述认证服务器的身份证明的数据包；其中所述认证服务器的身份证明基于IBC进行标识；基于所述认证服务器的身份证明，验证所述认证服务器的身份；若身份不合法，则断开通信，若身份合法，则生成含有终端设备的身份信息的数据包并向所述认证服务器发送，以利用所述认证服务器执行：接收含有终端设备的身份信息的数据包；基于终端设备的身份信息，认证所述终端设备的身份，生成含有认证结果的数据包，并向终端设备发送；其中，终端设备的身份信息基于IBC进行标识；认证结果包括认证成功、认证失败和继续认证；从所述认证服务器接收含有认证结果的数据包；若认证结果为认证失败，则断开通信，若认证结果为继续认证，则再次生成含有终端设备的身份信息的数据包并向所述认证服务器发送，以利用所述认证服务器继续执行认证，若认证结果为认证成功，则确认终端设备的身份可信。2.根据权利要求1所述的方法，其特征在于，还包括：在确认终端设备的身份可信之后，判断是否建立与所述认证服务器之间的加密隧道；是则建立加密隧道，并向所述认证服务器发送受信任凭据。3.根据权利要求2所述的方法，其特征在于，所述建立加密隧道，包括：生成含有终端设备拥有的受信任凭据模板类型信息的数据包，并向所述认证服务器发送，以利用所述认证服务器执行：接收含有终端设备拥有的受信任凭据模板类型信息的数据包；基于终端设备拥有的受信任凭据模板类型信息，评估终端设备能够提供受信任凭据的能力，生成含有模版建议信息的数据包，并向终端设备发送；从所述认证服务器接收含有模版建议信息的数据包；基于模版建议信息，判断终端设备是否能够满足要求；若不满足，则生成含有建立隧道失败标识的数据包并向所述认证服务器回复，若满足，则向所述认证服务器返回含有模版建议信息的数据包，以利用所述认证服务器执行：接收含有模版建议信息的数据包；产生协商数据，生成包含所述认证服务器产生的协商数据的数据包，并向终端设备发送；从所述认证服务器接收包含所述认证服务器产生的协商数据的数据包；产生协商数据，生成包含终端设备产生的协商数据的数据包，并向所述认证服务器发送，以利用所述认证服务器执行：接收包含终端设备产生的协商数据的数据包；基于终端设备及所述认证服务器产生的协商数据，生成对称密钥；基于所述认证服务器及终端设备产生的协商数据，生成对称密钥。4.根据权利要求3所述的方法，其特征在于，向所述认证服务器发送受信任凭据，包括：基于模版建议信息确定受信任凭据；基于生成的对称密钥对受信任凭据进行加密，得到包含受信任凭据的加密数据包，并向所述认证服务器发送，以利用所述认证服务器执行：接收包含受信任凭据的加密数据包；基于生成的对称密钥对加密数据包进行解密，得到受信任凭据；基于受信任凭据进行评估，得到评估结果；基于评估结果，判断是否认证成功，并向终端设备反馈。5.根据权利要求4所述的方法，其特征在于，所述认证服务器的身份证明基于SM9进行标识；所述含有所述认证服务器的身份证明的数据包中，装载有所述认证服务器产生的第一随机数、所述认证服务器的SM9公钥，以及所述认证服务器的SM9私钥对第一随机数的签名数据，作为所述认证服务器的身份证明；终端设备的身份信息基于SM9进行标识；所述含有终端设备的身份信息的数据包中，装载有终端设备的SM9公钥，以及终端设备的SM9私钥对第一随机数的签名数据，作为终端设备的身份信息。6.根据权利要求5所述的方法，其特征在于，所述包含所述认证服务器产生的协商数据的数据包中，装载有所述认证服务器产生的第二随机数，以及，基于第二随机数、终端设备的SM9公钥及SM9密钥交换协议产生的协商数据；所述包含终端设备产生的协商数据的数据包中，装载有基于第二随机数、所述认证服务器的SM9公钥及SM9密钥交换协议产生的协商数据。7.根据权利要求6所述的方法，其特征在于，所述基于模版建议信息确定受信任凭据，包括：根据模版建议信息确定受信任凭据的数据，并决定是否对受信任凭据的数据进行分片，若分片，则得到多个包含受信任凭据的数据包，否则得到单个包含受信任凭据的数据包；所述基于生成的对称密钥对受信任凭据进行加密，得到包含受信任凭据的加密数据包，包括：基于生成的对称密钥，采用SM4加密算法对包含受信任凭据的数据包进行加密，得到加密数据；基于所述认证服务器产生的协商数据得到盐值，采用SM4加密算法对包含受信任凭据的数据包或加密数据进行HMAC运算，得到HMAC数据；基于得到的加密数据和HMAC数据，生成包含受信任凭据的加密数据包。8.一种可信网络连接身份认证方法，其特征在于，包括：基于EAP，建立认证服务器与请求接入的终端设备之间的通信；向所述终端设备发送含有认证服务器的身份证明的数据包，以利用所述终端设备执行：接收含有所述认证服务器的身份证明的数据包；基于含有认证服务器的身份证明的数据包，验证认证服务器的身份；若身份不合法，则断开通信，若身份合法，则生成含有所述终端设备的身份信息的数据包并向认证服务器发送；其中，认证服务器的身份证明、所述终端设备的身份信息均基于IBC确定；从所述终端设备接收含有所述终端设备的身份信息的数据包；基于终端设备的身份信息，认证所述终端设备的身份，生成含有认证结果的数据包，并向所述终端设备发送；其中，认证结果包括认证成功、认证失败和继续认证；若认证结果为认证失败，则断开通信，若认证结果为继续认证，则继续从所述终端设备接收含有终端设备的身份信息的数据包，再次认证所述终端设备的身份，若认证结果为认证成功，则确认终端设备的身份可信。9.一种电子设备，包括存储器和处理器，所述存储器中存储有计算机程序，其特征在于，所述处理器执行所述计算机程序时，实现如权利要求1-8中任一项所述的方法。10.一种存储介质，其上存储有计算机程序，其特征在于，当所述计算机程序在计算机中执行时，令计算机执行权利要求1-8中任一项所述的方法。
说明书desc
技术领域本发明实施例涉及网络安全技术领域，特别涉及可信网络连接身份认证方法、电子设备及存储介质。背景技术随着互联网、物联网和工控互联网的迅速发展，IP基础设施的发展带来了新技术，也带了新的安全挑战。机器级平台身份验证对于网络访问请求的安全性和授权至关重要。目前，现有技术中多是针对互联网设备的身份认证方法，这些技术通常涉及到数字证书认证的签名和验签流程，受证书存储容量等因素的限制，难以在资源受限的物联网设备或工控互联网平台上使用。因此，需要一种轻量级身份认证方法。发明内容本发明的目的是针对上述至少一部分不足之处，提供一种轻量级的可信网络连接身份认证方法、电子设备及存储介质，能够适用于互联网、物联网甚至是工控互联网平台，在多网跨域的融合性网络平台上增强整个网络架构的安全性。第一方面，本发明实施例提供了一种可信网络连接身份认证方法，包括：基于EAP，建立请求接入的终端设备与认证服务器之间的通信；从所述认证服务器接收含有所述认证服务器的身份证明的数据包；其中所述认证服务器的身份证明基于IBC进行标识；基于所述认证服务器的身份证明，验证所述认证服务器的身份；若身份不合法，则断开通信，若身份合法，则生成含有终端设备的身份信息的数据包并向所述认证服务器发送，以利用所述认证服务器执行：接收含有终端设备的身份信息的数据包；基于终端设备的身份信息，认证所述终端设备的身份，生成含有认证结果的数据包，并向终端设备发送；其中，终端设备的身份信息基于IBC进行标识；认证结果包括认证成功、认证失败和继续认证；从所述认证服务器接收含有认证结果的数据包；若认证结果为认证失败，则断开通信，若认证结果为继续认证，则再次生成含有终端设备的身份信息的数据包并向所述认证服务器发送，以利用所述认证服务器继续执行认证，若认证结果为认证成功，则确认终端设备的身份可信。可选地，所述的可信网络连接身份认证方法还包括：在确认终端设备的身份可信之后，判断是否建立与所述认证服务器之间的加密隧道；是则建立加密隧道，并向所述认证服务器发送受信任凭据。可选地，所述建立加密隧道，包括：生成含有终端设备拥有的受信任凭据模板类型信息的数据包，并向所述认证服务器发送，以利用所述认证服务器执行：接收含有终端设备拥有的受信任凭据模板类型信息的数据包；基于终端设备拥有的受信任凭据模板类型信息，评估终端设备能够提供受信任凭据的能力，生成含有模版建议信息的数据包，并向终端设备发送；从所述认证服务器接收含有模版建议信息的数据包；基于模版建议信息，判断终端设备是否能够满足要求；若不满足，则生成含有建立隧道失败标识的数据包并向所述认证服务器回复，若满足，则向所述认证服务器返回含有模版建议信息的数据包，以利用所述认证服务器执行：接收含有模版建议信息的数据包；产生协商数据，生成包含所述认证服务器产生的协商数据的数据包，并向终端设备发送；从所述认证服务器接收包含所述认证服务器产生的协商数据的数据包；产生协商数据，生成包含终端设备产生的协商数据的数据包，并向所述认证服务器发送，以利用所述认证服务器执行：接收包含终端设备产生的协商数据的数据包；基于终端设备及所述认证服务器产生的协商数据，生成对称密钥；基于所述认证服务器及终端设备产生的协商数据，生成对称密钥。可选地，向所述认证服务器发送受信任凭据，包括：基于模版建议信息确定受信任凭据；基于生成的对称密钥对受信任凭据进行加密，得到包含受信任凭据的加密数据包，并向所述认证服务器发送，以利用所述认证服务器执行：接收包含受信任凭据的加密数据包；基于生成的对称密钥对加密数据包进行解密，得到受信任凭据；基于受信任凭据进行评估，得到评估结果；基于评估结果，判断是否认证成功，并向终端设备反馈。可选地，所述认证服务器的身份证明基于SM9进行标识；所述含有所述认证服务器的身份证明的数据包中，装载有所述认证服务器产生的第一随机数、所述认证服务器的SM9公钥，以及所述认证服务器的SM9私钥对第一随机数的签名数据，作为所述认证服务器的身份证明；终端设备的身份信息基于SM9进行标识；所述含有终端设备的身份信息的数据包中，装载有终端设备的SM9公钥，以及终端设备的SM9私钥对第一随机数的签名数据，作为终端设备的身份信息。可选地，所述包含所述认证服务器产生的协商数据的数据包中，装载有所述认证服务器产生的第二随机数，以及，基于第二随机数、终端设备的SM9公钥及SM9密钥交换协议产生的协商数据；所述包含终端设备产生的协商数据的数据包中，装载有基于第二随机数、所述认证服务器的SM9公钥及SM9密钥交换协议产生的协商数据。可选地，所述基于模版建议信息确定受信任凭据，包括：根据模版建议信息确定受信任凭据的数据，并决定是否对受信任凭据的数据进行分片，若分片，则得到多个包含受信任凭据的数据包，否则得到单个包含受信任凭据的数据包；所述基于生成的对称密钥对受信任凭据进行加密，得到包含受信任凭据的加密数据包，包括：基于生成的对称密钥，采用SM4加密算法对包含受信任凭据的数据包进行加密，得到加密数据；基于所述认证服务器产生的协商数据得到盐值，采用SM4加密算法对包含受信任凭据的数据包或加密数据进行HMAC运算，得到HMAC数据；基于得到的加密数据和HMAC数据，生成包含受信任凭据的加密数据包。第二方面，本发明实施例还提供了一种可信网络连接身份认证方法，包括：基于EAP，建立认证服务器与请求接入的终端设备之间的通信；向所述终端设备发送含有认证服务器的身份证明的数据包，以利用所述终端设备执行：接收含有所述认证服务器的身份证明的数据包；基于含有认证服务器的身份证明的数据包，验证认证服务器的身份；若身份不合法，则断开通信，若身份合法，则生成含有所述终端设备的身份信息的数据包并向认证服务器发送；其中，认证服务器的身份证明、所述终端设备的身份信息均基于IBC确定；从所述终端设备接收含有所述终端设备的身份信息的数据包；基于终端设备的身份信息，认证所述终端设备的身份，生成含有认证结果的数据包，并向所述终端设备发送；其中，认证结果包括认证成功、认证失败和继续认证；若认证结果为认证失败，则断开通信，若认证结果为继续认证，则继续从所述终端设备接收含有终端设备的身份信息的数据包，再次认证所述终端设备的身份，若认证结果为认证成功，则确认终端设备的身份可信。第三方面，本发明实施例还提供了一种电子设备，包括存储器和处理器，所述存储器中存储有计算机程序，所述处理器执行所述计算机程序时，实现本说明书任一实施例所述的方法。第四方面，本发明实施例还提供了一种计算机可读存储介质，其上存储有计算机程序，当所述计算机程序在计算机中执行时，令计算机执行本说明书任一实施例所述的方法。本发明实施例提供了可信网络连接身份认证方法、电子设备及存储介质，本发明基于EAP建立请求接入的终端设备与认证服务器之间的通信，基于IBC标识终端设备与认证服务器二者的身份，进行终端设备与认证服务器之间的双向认证，从而保证接入网络中的终端设备身份安全可信，相对于基于数字证书的认证方式，本发明更为简单、轻量，具备在多种跨域网络中的兼容性。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明一实施例提供的一种可信网络连接身份认证方法流程图；图2是本发明一实施例提供的另一种可信网络连接身份认证方法流程图；图3是本发明一实施例提供的另一种可信网络连接身份认证方法流程图；图4是第一阶段和第二阶段认证所用数据包的数据格式示意图；图4是第三阶段认证所用数据包的数据格式示意图；图5是第一阶段交互示意图；图5是第二阶段交互示意图；图5是第三阶段交互示意图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例，基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。如前所述，现有技术中多是针对互联网设备的身份认证方法，这些技术通常涉及到数字证书认证的签名和验签流程，受证书存储容量等因素的限制，难以在资源受限的物联网设备或工控互联网平台上使用。EAP位于PPP身份验证协议中，为多种不同的身份认证方法提供通用框架。EAP用于在请求方终端设备和认证服务器之间传递身份认证信息，实际的身份认证会按照EAP类型进行定义与处理。EAP架构的优点之一是它的灵活性，EAP可用于选择特定的身份验证机制，通常在认证服务器请求更多信息以确定要使用的特定身份验证方法之后。EAP不需要更新终端设备和认证服务器中的身份验证器以支持每种新的身份验证方法，而是允许使用后端的服务器，该服务器可以实现某些或所有身份验证方法，身份验证器充当某些或所有方法和对端的传递者。IBC是一种公钥密码体系，它使用广为人知的实体身份表示作为实体公钥。这消除了通过某种机制将单独的公钥绑定到实体身份的需要。在IBC中，公钥通常被视为实体身份和公钥有效期的串联。IBC算法具有轻量级密码计算的优点，可以为物联网和工业互联网提供安全、简洁的密码技术。有鉴于此，本发明提供了一种基于EAP框架、采用IBC进行身份标识的轻量级身份协议认证方法。下面描述以上构思的具体实现方式。请参考图1，本发明实施例提供了一种可信网络连接身份认证方法，该方法应用于请求接入的终端设备，包括：步骤100，基于EAP，建立请求接入的终端设备与认证服务器之间的通信；步骤102，从认证服务器接收含有认证服务器的身份证明的数据包；其中认证服务器的身份证明基于IBC进行标识；步骤104，基于认证服务器的身份证明，验证认证服务器的身份；若该认证服务器的身份不合法，则断开通信；若认证服务器的身份合法，则终端设备生成含有终端设备自身的身份信息的数据包并向认证服务器发送，以利用认证服务器执行：接收含有终端设备的身份信息的数据包；基于终端设备的身份信息，认证终端设备的身份，得到认证结果，生成含有认证结果的数据包，并向终端设备发送；其中，终端设备的身份信息同样基于IBC进行标识；认证结果包括认证成功、认证失败和继续认证；步骤106，从认证服务器接收含有认证结果的数据包；若认证结果为认证失败，则断开通信；若认证结果为继续认证，则再次生成含有终端设备的身份信息的数据包并向认证服务器发送，以利用认证服务器继续执行认证；若认证结果为认证成功，则确认终端设备的身份可信。确认终端设备的身份可信后，即可选择是否连接入可信网络。本发明提供的可信网络连接身份认证方法利用EAP的身份认证框架对可信网络连接的身份认证进行扩展，利用IBC标识终端设备与认证服务器的身份，进行双向的身份验证，保证接入到网络中的终端设备身份安全可信，并且不涉及数字证书的签名验证及存储，更为简单、轻量，能够适用于互联网、物联网甚至是工控互联网平台，具备在多种跨域网络中的兼容性。可选地，该可信网络连接身份认证方法还包括：步骤108，在确认终端设备的身份可信之后，判断是否建立终端设备与认证服务器之间的加密隧道，以进一步认证终端设备的受信任凭据；是则建立加密隧道，并向认证服务器发送受信任凭据，否则结束认证。通过建立加密隧道并发送受信任凭据，能够在终端设备身份可信的基础上，进一步验证该终端设备当前是否处于受信任的状态，例如在受到攻击后，虽然终端设备的身份信息正常，但已处于非正常状态，不再安全可信。上述实施方式引入了受信任凭据的支持，更符合可信网络连接的控制理念。进一步地，步骤108中建立加密隧道包括：步骤108-0，生成含有终端设备拥有的受信任凭据模板类型信息的数据包，并向认证服务器发送，以利用认证服务器执行：接收含有终端设备拥有的受信任凭据模板类型信息的数据包；基于终端设备拥有的受信任凭据模板类型信息，评估终端设备能够提供受信任凭据的能力，给出模版建议信息，生成含有模版建议信息的数据包，并向终端设备发送；步骤108-2，从认证服务器接收含有模版建议信息的数据包；步骤108-4，基于模版建议信息，判断该终端设备是否能够满足要求；若不满足，则生成含有建立隧道失败标识的数据包，并向认证服务器回复；若满足，则向认证服务器返回含有模版建议信息的数据包，以利用认证服务器执行：接收含有模版建议信息的数据包；产生协商数据，生成包含认证服务器产生的协商数据的数据包，并向终端设备发送；步骤108-6，从认证服务器接收包含认证服务器产生的协商数据的数据包；步骤108-8，产生协商数据，生成包含终端设备产生的协商数据的数据包，并向认证服务器发送，以利用认证服务器执行：接收包含终端设备产生的协商数据的数据包；基于终端设备及认证服务器自身产生的协商数据，生成对称密钥；步骤108-10，基于认证服务器及终端设备自身产生的协商数据，生成对称密钥。上述实施方式中，终端设备和认证服务器都得到了对方产生的协商数据，根据协商数据得到只有双方知道的对称密钥，用作建立对称加密隧道。进一步地，步骤108中向认证服务器发送受信任凭据，包括：步骤108-12，基于接收到的模版建议信息，确定该终端设备的受信任凭据；步骤108-14，基于生成的对称密钥对确定的受信任凭据进行加密，得到包含受信任凭据的加密数据包，并向认证服务器发送，以利用认证服务器执行：接收包含受信任凭据的加密数据包；基于生成的对称密钥对接收到的加密数据包进行解密，得到受信任凭据；基于受信任凭据进行评估，得到评估结果；基于评估结果，判断对该终端设备的状态是否认证成功，并向终端设备反馈。上述实施方式中，终端设备和认证服务器基于建立的对称加密隧道进一步传递数据，向认证服务器发送终端设备所拥有的受信任凭据，如终端设备的状态信息等，基于得到的受信任凭据，认证服务器能够进一步评估当前终端设备的状态，确认其可信程度。具体的受信任凭据的模版可根据需要进行设置。进一步地，考虑到本发明可信网络连接身份认证方法的合规性问题，在一些实施方式中，该方法基于SM9国密算法实现。SM9是中国国家密码管理局于2016年3月发布的、基于身份密码的中国国家密码标准，以中国密码国家标准《GM/T 0044-2016SM9》为代表。该标准包含以下组成部分：基于身份的非对称密码算法；基于身份的数字签名算法，它允许一个实体对消息进行数字签名，该消息可以被另一个实体验证；基于身份的密钥建立和密钥封装；基于身份的公钥加密密钥封装算法，允许一个实体安全地向另一个实体发送对称密钥。具体地，认证服务器的身份证明优选基于SM9进行标识；含有认证服务器的身份证明的数据包中，装载有认证服务器产生的第一随机数、认证服务器的SM9公钥，以及认证服务器的SM9私钥对第一随机数的签名数据，作为认证服务器的身份证明；相应地，步骤104中基于认证服务器的身份证明，验证认证服务器的身份，进一步包括：基于认证服务器产生的第一随机数和认证服务器的SM9公钥，验证认证服务器的身份；终端设备的身份信息同样基于SM9进行标识；含有终端设备的身份信息的数据包中，装载有终端设备的SM9公钥，以及终端设备的SM9私钥对第一随机数的签名数据，作为终端设备的身份信息；相应地，步骤104中利用认证服务器执行：基于终端设备的身份信息，认证终端设备的身份，进一步包括：基于终端设备的SM9公钥，认证终端设备的身份。上述实施方式使用SM9国密算法作为双向身份认证阶段的签名验签算法，SM9公钥、SM9私钥均依据SM9国密算法得到。SM9作为一种IBC，能够实现将基于身份的认证流程进行轻量级优化，并且，该方法引入了国密算法的流程，符合密码合规性。进一步地，包含认证服务器产生的协商数据的数据包中，装载有认证服务器产生的第二随机数，以及，基于第二随机数、终端设备的SM9公钥及SM9密钥交换协议产生的协商数据；包含终端设备产生的协商数据的数据包中，装载有基于第二随机数、认证服务器的SM9公钥及SM9密钥交换协议产生的协商数据。相应地，步骤108-8和步骤108-10中，生成对称密钥，均使用SM9密钥交换协议实现。上述实施方式使用SM9国密算法作为加密隧道的密钥协商算法，即，使用SM9密钥交换协议生成一个只有双方知道的对称密钥，加密隧道建立阶段在接入请求的终端设备和认证服务器之间建立一条对称加密隧道，保证受信任凭据度量验证阶段传递的数据具备保密性。SM9密钥交换协议是继SM9数字签名算法、SM9标识加密算法之后，SM9国密算法的第三项ISO/IEC国际标准，用于通信双方基于对方的标识实现会话密钥协商，具有运算效率高、算法安全模式实现灵活等特点。进一步地，步骤108-12包括：根据模版建议信息确定受信任凭据的数据，并决定是否对受信任凭据的数据进行分片，若分片，则得到多个包含受信任凭据的数据包，否则得到单个包含受信任凭据的数据包；步骤108-14中，基于生成的对称密钥对受信任凭据进行加密，得到包含受信任凭据的加密数据包，包括：基于生成的对称密钥，采用SM4加密算法对包含受信任凭据的数据包进行加密，得到加密数据；基于认证服务器产生的协商数据得到盐值，采用SM4加密算法对包含受信任凭据的数据包或加密数据进行HMAC运算，得到HMAC数据；其中，对于单个包含受信任凭据的数据包，把认证服务器传递给终端设备的协商数据作为盐值，对于多个包含受信任凭据的数据包，对应的盐值按数据包的顺序依次加一；基于得到的加密数据和HMAC数据，生成包含受信任凭据的加密数据包。上述实施方式采用SM4加密算法对受信任凭据进行加密，SM4加密算法与SM9一样由国际标准化组织ISO/IEC正式发布，可确保方法的合规性。包含受信任凭据的加密数据包中装载有加密数据和HMAC数据，加密数据用于在认证服务器端评估终端设备的可信程度，HMAC数据可防止第三方用户恶意伪造受信任凭据进行重放攻击。如图2所示，本发明提供的一种可信网络连接身份认证方法包括：步骤200，基于EAP，建立请求接入的终端设备与认证服务器之间的通信；步骤202，从认证服务器接收含有认证服务器的身份证明的数据包；其中认证服务器的身份证明基于IBC进行标识；步骤204，基于认证服务器的身份证明，验证认证服务器的身份；若身份不合法，则断开通信，若身份合法，则生成含有终端设备自身的身份信息的数据包并向认证服务器发送，以利用认证服务器执行：接收含有终端设备的身份信息的数据包；基于终端设备的身份信息，认证终端设备的身份，生成含有认证结果的数据包，并向终端设备发送；其中，终端设备的身份信息同样基于IBC进行标识；认证结果包括认证成功、认证失败和继续认证；步骤206，从认证服务器接收含有认证结果的数据包；若认证结果为认证失败，则断开通信，若认证结果为继续认证，则再次生成含有终端设备的身份信息的数据包并向认证服务器发送，以利用认证服务器继续执行认证，若认证结果为认证成功，则确认终端设备的身份可信；步骤208，判断是否建立与认证服务器之间的加密隧道；是则继续执行，以进一步认证终端设备的受信任凭据，否则结束认证，终端设备接入可信网络；步骤210，生成含有终端设备拥有的受信任凭据模板类型信息的数据包，并向认证服务器发送，以利用认证服务器执行：接收含有终端设备拥有的受信任凭据模板类型信息的数据包；基于终端设备拥有的受信任凭据模板类型信息，评估终端设备能够提供受信任凭据的能力，生成含有模版建议信息的数据包，并向终端设备发送；步骤212，从认证服务器接收含有模版建议信息的数据包；步骤214，基于模版建议信息，判断终端设备是否能够满足要求；若不满足，则生成含有建立隧道失败标识的数据包，并向认证服务器回复；若满足，则向认证服务器返回接收到的、含有模版建议信息的数据包，以利用认证服务器执行：接收含有模版建议信息的数据包；产生协商数据，生成包含认证服务器产生的协商数据的数据包，并向终端设备发送；步骤216，从认证服务器接收包含认证服务器产生的协商数据的数据包；步骤218，产生协商数据，生成包含终端设备产生的协商数据的数据包，并向认证服务器发送，以利用认证服务器执行：接收包含终端设备产生的协商数据的数据包；基于终端设备及认证服务器自身产生的协商数据，生成对称密钥；步骤220，基于认证服务器及终端设备自身产生的协商数据，生成对称密钥；步骤222，根据模版建议信息确定受信任凭据的数据，并决定是否对受信任凭据的数据进行分片；若分片，则得到多个包含受信任凭据的数据包，否则得到单个包含受信任凭据的数据包；步骤224，基于生成的对称密钥，对包含受信任凭据的数据包进行加密，得到加密数据；步骤226，基于认证服务器产生的协商数据得到盐值，对包含受信任凭据的数据包或加密数据进行HMAC运算，得到HMAC数据；其中，对于单个包含受信任凭据的数据包，把认证服务器传递给终端设备的协商数据作为盐值，对于多个包含受信任凭据的数据包，对应的盐值按数据包的顺序依次加一；步骤228，基于得到的加密数据和HMAC数据，生成包含受信任凭据的加密数据包；步骤230，向认证服务器发送包含受信任凭据的加密数据包，以利用认证服务器执行：接收包含受信任凭据的加密数据包；基于生成的对称密钥对加密数据包进行解密，得到受信任凭据；基于受信任凭据进行评估，得到评估结果；基于评估结果，判断是否认证成功，并向终端设备反馈。上述步骤200至步骤206可认为属于认证的第一阶段：双向身份认证阶段，步骤208至步骤220可认为属于第二阶段：加密隧道建立阶段，步骤222至步骤230可认为属于第三阶段：受信任凭据度量验证阶段。请参考图3，本发明实施例还提供了一种可信网络连接身份认证方法，该方法应用于认证服务器，包括：步骤300，基于EAP，建立认证服务器与请求接入的终端设备之间的通信；步骤302，向终端设备发送含有认证服务器自身的身份证明的数据包，以利用终端设备执行：接收含有认证服务器的身份证明的数据包；基于认证服务器的身份证明，验证认证服务器的身份；若身份不合法，则断开通信，若身份合法，则生成含有终端设备的身份信息的数据包并向认证服务器发送；其中，认证服务器的身份证明、终端设备的身份信息均基于IBC确定；步骤304，从终端设备接收含有终端设备的身份信息的数据包；步骤306，基于终端设备的身份信息，认证终端设备的身份，生成含有认证结果的数据包，并向终端设备发送；其中，认证结果包括认证成功、认证失败和继续认证；若认证结果为认证失败，则断开通信，若认证结果为继续认证，则继续从终端设备接收含有终端设备的身份信息的数据包，再次认证终端设备的身份，若认证结果为认证成功，则确认终端设备的身份可信。进一步地，该方法还包括：步骤308，从终端设备接收含有终端设备拥有的受信任凭据模板类型信息的数据包；步骤310，基于终端设备拥有的受信任凭据模板类型信息，评估终端设备能够提供受信任凭据的能力，生成含有模版建议信息的数据包，并向终端设备发送，以利用终端设备执行：接收含有模版建议信息的数据包；基于模版建议信息，判断终端设备是否能够满足要求；若不满足，则生成含有建立隧道失败标识的数据包并向认证服务器回复，若满足，则向认证服务器返回含有模版建议信息的数据包；步骤312，接收数据，若从终端设备接收到含有建立隧道失败标识的数据包，则断开通信；若从终端设备接收到含有模版建议信息的数据包，则产生协商数据，生成包含认证服务器产生的协商数据的数据包并向终端设备发送，以利用终端设备执行：接收包含认证服务器产生的协商数据的数据包；产生协商数据，生成包含终端设备产生的协商数据的数据包并向认证服务器发送；以及，基于认证服务器及终端设备产生的协商数据，生成对称密钥；步骤314，从终端设备接收包含终端设备产生的协商数据的数据包；步骤316，基于终端设备及认证服务器产生的协商数据，生成对称密钥。进一步地，该方法还包括：步骤318，从终端设备接收一个或多个包含受信任凭据的加密数据包；步骤320，基于生成的对称密钥对接收到的加密数据包进行解密，得到受信任凭据；步骤322，基于受信任凭据进行评估，得到评估结果；其中，基于受信任凭据进行评估，可将受信任凭据发送至可信网络的决策端，由决策端进行评估，再从决策端获得评估结果；决策端决策的可信预期值可来自于策略服务器；步骤324，基于评估结果，判断是否对终端设备认证成功，并向终端设备反馈；若认证成功，则向终端设备反馈认证成功的结果，完成对终端设备的认证；若认证不成功，则向终端设备反馈认证失败的结果，断开连接。上述步骤300至步骤306可认为属于认证的第一阶段：双向身份认证阶段，步骤308至步骤316可认为属于第二阶段：加密隧道建立阶段，步骤318至步骤324可认为属于第三阶段：受信任凭据度量验证阶段。进一步地，第一阶段可利用SM9国密算法实现双向身份认证的签名验签，第二阶段可利用SM9国密算法实现加密隧道的密钥协商，第三阶段可利用SM4算法实现对受信任凭据加密。上述应用于认证服务器的可信网络连接身份认证方法与本发明应用于终端设备的方法实施例基于同一构思，具体内容可参见本发明应用于终端设备的方法实施例中的叙述，此处不再赘述。请参阅图4至图5，进一步地，本发明实施方式中认证的第一阶段可采用如图4所示的数据格式得到装载了相应数据的数据包，其中，各类型数据具体说明如下：编码：字段是一个八位字节，用于标识EAP数据包的类型；1值代表EAP请求；0值代表EAP响应。序列号：序列号为了匹配对应的身份认证的请求和响应数据包。总长度：整个数据包的总数据长度。阶段类型：标识认证所属阶段。版本：协议版本信息。标识：指示当前数据包所处的认证阶段，在第一阶段中共有AUTH_REQUEST、AUTH_RESPONSE、AUTH_SUCCESS、AUTH_FAIL和AUTH_CONTINUE五种类型的标识，其中：AUTH_REQUEST：认证服务器请求认证终端设备的身份，此时数据载荷装载有认证服务器产生的随机数，认证服务器的SM9公钥，以及认证服务器的SM9私钥对该随机数的签名数据；AUTH_RESPONSE：当终端设备验证认证服务器的合法身份后，终端设备响应认证服务器的请求，此时数据载荷装载有终端设备的SM9公钥，以及终端设备的SM9私钥对随机数的签名数据；AUTH_SUCCESS：认证服务器认证终端设备为合法身份后，如果无需进行第二阶段和第三阶段的认证，即可立即发送AUTH_SUCCESS作为应答，这时终端设备便会接入到可信网络中；AUTH_FAIL：认证服务器认证对方身份不合法时发送的应答；AUTH_CONTINUE：认证服务器认证对方身份存疑，终端设备需要继续和认证服务器进行协商认证时发送的应答；上述AUTH_SUCCESS、AUTH_FAIL和AUTH_CONTINUE分别对应认证结果中的认证成功、认证失败和继续认证。数据长度：数据载荷的长度。数据载荷：数据包中装载的具体数据。如图5所示，第一阶段终端设备与认证服务器之间的交互大致包括：1)认证服务器向终端设备发送AUTH_REQUEST数据，其中数据载荷包含：认证服务器产生的第一随机数nonce、认证服务器的SM9公钥pubserver以及认证服务器的SM9私钥对nonce的签名数据；2)终端设备收到数据包后通过nonce和pubserver验证对方的合法身份，如果认证服务器身份合法，则发送响应AUTH_REPONSE，同时数据载荷为终端设备自身的SM9公钥pubclient以及其私钥对nonce的签名值；如果身份不合法，则断开通信；3)认证服务器收到对方发来的响应后，也会认证终端设备身份是否合法，如果身份不合法则断开连接；在终端设备身份认证合法后，认证服务器便可根据可信网络中的策略服务器来评估是否需要继续进行受信任凭据的认证，如果需要继续进行可信的认证，则会发送AUTH_CONTINUE的数据包，否则发送AUTH_SUCCESS的数据包。第二阶段依然可采用如图4所示的数据格式得到装载了相应数据的数据包，只是标识与第一阶段的不同，第二阶段的标识主要有以下几种类型：OWN_TEMPLATE：终端设备自身所拥有的受信任凭据模板类型信息，为了区别互联网、物联网和工控互联网等各种不同的使用场景，本发明针对不同的网络使用场景划分了不同模板，可以通过协商后的模板类型来传递自己的受信任凭据，如模板类型默认有TEMP_GEN——通用模板、TEMP_IOT——适用于物联网，以及TEMP_IIOT——适用于工业互联网，此时数据包的数据载荷包含的数据为定长4字节的模板组合；ACK_TEMPLATE：标识认证服务器的模板协商回应结果，即模版建议信息，此时数据载荷包含的数据为定长4字节的建议模板，认证服务器可通过可信网络连接的决策服务器来决策对方应该使用的模板类型，终端设备确认可以使用此模板类型后，也发送ACK_TEMPLATE给认证服务器进行确认，否则发送ACK_FAIL来标识协商失败，同时双方断开连接；CIPHER_NEO：标识对称密钥的协商数据类型，此时数据载荷包含产生的协商数据，其中双方都用新创建的第二随机数及对方的公钥生成协商数据。ACK_FAIL：标识建立隧道失败。如图5所示，第二阶段终端设备与认证服务器之间的交互大致包括：1)终端设备向认证服务器发送OWN_TEMPLATE数据，此时数据载荷为32位的模板类型值，目前只定义TEMP_GEN、TEMP_IOT和TEMP_IIOT，为了保证扩展性，保留其他的值进行后续的扩展；2)认证服务器收到ACK_TEMPLATE数据后，需要对终端设备可以提供受信信任凭据的能力进行评估，然后发送建议的模板值；3)终端设备收到ACK_TEMPLATE数据后，判断是否可以满足要求，不满足则发送ACK_FAIL，满足则回复ACK_TEMPLATE数据；4)认证服务器生成第二随机数，通过第二随机数和终端设备的SM9公钥，使用SM9密钥交换协议产生协商数据，发给终端设备；5)终端设备收到CIPHER_NEO数据后，也把自己产生的协商数据发送给认证服务器；终端设备和认证服务器都得到对方的协商数据后，双双生成对称密钥。第三阶段可采用如图4所示的数据格式得到装载了相应数据的数据包，其中，各类型数据具体说明如下：编码：字段是一个八位字节，用于标识EAP数据包的类型；1值代表EAP请求；0值代表EAP响应。序列号：序列号为了匹配对应的身份认证的请求和响应数据包。总长度：整个数据包的总数据长度。阶段类型：标识认证所属阶段。版本：协议版本信息。标识：指示当前数据包所处的认证阶段，在第三阶段中共有以下几种类型：DATA_START：表明第一个发送的包含受信任凭据的加密数据包，不可以和DATA_MORE标识同时共存，可以与DATA_END共存，表明只有一个数据包，不需要进行数据切片；DATA_MORE：表明后续的加密数据包，因为受信任凭据可能包含大量的数据，所以在数据量很大的时候需要进行切片处理，不能与DATA_START与DATA_END共存；DATA_END：表明最后一个加密数据包；AUTH_SUCCESS：认证成功，由认证服务器发送。AUTH_FAIL：认证失败，由认证服务器发送。加密数据长度：通过SM4加密的受信任凭据的数据长度。加密数据：加密后的受信任凭据。HMAC数据：受信任凭据的HMAC校验数据，通过把第二阶段由认证服务器传递给终端设备的协商数据作为盐值，由SM4加密算法生成。在多个切片数据包中，盐值每次递增1。如图5所示，第三阶段终端设备与认证服务器之间的交互大致包括：1)终端设备根据受信任凭据的长度决定是否对数据进行分片，接着使用协商的对称密钥对受信任凭据进行加密，并使用认证服务器传递过来的协商数据作为盐值对数据使用SM4算法进行HMAC运算。2)认证服务器接受完数据包后，使用协商的对称密钥对受信任凭据进行解密，然后发送到可信网络的决策端进行评估是否可信，如果评估结果为可信状态则发送AUTH_SUCCESS，否则发送AUTH_FAIL，并断开与终端设备的连接。本发明实施例还提供了一种电子设备，包括存储器和处理器，所述存储器中存储有计算机程序，所述处理器执行所述计算机程序时，实现本发明任一实施例中的可信网络连接身份认证方法。本发明实施例还提供了一种计算机可读存储介质，所述计算机可读存储介质上存储有计算机程序，所述计算机程序在被处理器执行时，使所述处理器执行本发明任一实施例中的可信网络连接身份认证方法。具体地，可以提供配有存储介质的系统或者装置，在该存储介质上存储着实现上述实施例中任一实施例的功能的软件程序代码，且使该系统或者装置的计算机读出并执行存储在存储介质中的程序代码。在这种情况下，从存储介质读取的程序代码本身可实现上述实施例中任何一项实施例的功能，因此程序代码和存储程序代码的存储介质构成了本发明的一部分。用于提供程序代码的存储介质实施例包括软盘、硬盘、磁光盘、光盘、磁带、非易失性存储卡和ROM。可选择地，可以由通信网络从服务器计算机上下载程序代码。此外，应该清楚的是，不仅可以通过执行计算机所读出的程序代码，而且可以通过基于程序代码的指令使计算机上操作的操作系统等来完成部分或者全部的实际操作，从而实现上述实施例中任意一项实施例的功能。此外，可以理解的是，将由存储介质读出的程序代码写到插入计算机内的扩展板中所设置的存储器中或者写到与计算机相连接的扩展模块中设置的存储器中，随后基于程序代码的指令使安装在扩展板或者扩展模块上的CPU等来执行部分和全部实际操作，从而实现上述实施例中任一实施例的功能。需要说明的是，在本文中，诸如第一和第二之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个…”限定的要素，并不排除在包括所述要素的过程、方法、物品或者设备中还存在另外的相同因素。本领域普通技术人员可以理解：实现上述方法实施例的全部或部分步骤可以通过程序指令相关的硬件来完成，前述的程序可以存储在计算机可读取的存储介质中，该程序在执行时，执行包括上述方法实施例的步骤；而前述的存储介质包括：ROM、RAM、磁碟或者光盘等各种可以存储程序代码的介质中。最后应说明的是：以上实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的精神和范围。
