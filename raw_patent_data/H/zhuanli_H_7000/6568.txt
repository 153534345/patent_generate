标题title
一种图像处理模块的调试方法和装置
摘要abst
本发明涉及图像处理技术领域，提供了一种图像处理模块的调试方法和装置。其中所述方法包括从外部存储介质中读取像素数据，根据所述像素数据生成数据信号；根据所述数据信号生成同步的控制信号；将所述数据信号与所述控制信号传输至图像处理模块，以便于所述图像处理模块根据所述数据信号与所述控制信号进行调试。本发明由于使用了外部存储，从而能够灵活调整像素数据的来源，能够根据图像处理模块的调试需求，调整像素数据来源，以满足自定义场景或者在使用外部设备的采集数据进行测试的需求。
权利要求书clms
1.一种图像处理模块的调试方法，其特征在于，包括：从外部存储介质中读取像素数据，根据所述像素数据生成数据信号；根据所述数据信号生成同步的控制信号；将所述数据信号与所述控制信号传输至图像处理模块，以便于所述图像处理模块根据所述数据信号与所述控制信号进行调试；所述从外部存储介质中读取像素数据包括：第一状态机将外部存储介质中的像素数据写入到相应像素缓存中，第二状态机从所述像素缓存中读取像素数据；所述第一状态机和所述第二状态机之间进行状态切换的同步，以实现像素数据的同步读写。2.根据权利要求1所述的图像处理模块的调试方法，其特征在于，所述第一状态机和所述第二状态机之间进行状态切换的同步包括：当读指针在所述像素缓存中的位置大于第一预设位置时，则所述第一状态机从等待状态切换至数据写入状态，以将外部存储介质中的像素数据写入到像素缓存的剩余空间内；其中，所述读指针是第二状态机用于读取像素数据的指针。3.根据权利要求2所述的图像处理模块的调试方法，其特征在于，所述第一状态机和所述第二状态机之间进行状态切换的同步还包括：当第二状态机进入预加载状态时，向第一状态机发送预加载命令；所述第一状态机根据所述预加载命令，进入预加载状态，以将外部存储介质中的像素数据写到像素缓存中；当写指针在像素缓存中的位置大于第二预设位置时，向所述第二状态机发送预加载完成命令；其中，所述写指针是所述第一状态机用于将像素数据写入到像素缓存中的指针；所述第二状态机根据所述预加载完成命令，进入数据读取状态，以从像素缓存中读取像素数据。4.根据权利要求1所述的图像处理模块的调试方法，其特征在于，所述像素数据包括长曝光数据和短曝光数据，所述像素缓存划分为用于存储长曝光数据的长缓存和用于存储短曝光数据的短缓存；所述第一状态机和所述第二状态机之间进行状态切换的同步包括：当长数据读指针在所述长缓存中的位置大于第三预设位置时，则所述第一状态机切换至长数据写入状态，使第一状态机将外部存储介质中的长曝光数据写入到长缓存中的剩余空间内；其中，所述长数据读指针是第二状态机用于读取长曝光数据的指针；当短数据读指针在所述短缓存中的位置大于第四预设位置时，则所述第一状态机切换至短数据写入状态，使第一状态机将外部存储介质中的短曝光数据写入到短缓存中的剩余空间内；其中，所述短数据读指针是第二状态机用于读取短曝光数据的指针。5.根据权利要求4所述的图像处理模块的调试方法，其特征在于，所述第一状态机和所述第二状态机之间进行状态切换的同步还包括：当第二状态机进入预加载状态时，向第一状态机发送预加载命令；所述第一状态机根据所述预加载命令，进入长缓存预加载状态，以将外部存储介质中的长曝光数据写到长缓存中；当长数据写指针在长缓存中的位置大于第五预设位置时，向所述第二状态机发送预加载完成命令；其中，所述长数据写指针是所述第一状态机用于将长曝光数据写入到长缓存中的指针；所述第二状态机根据所述预加载完成命令，进入长数据读取状态，以进行像素数据的读取。6.根据权利要求5所述的图像处理模块的调试方法，其特征在于，所述进行像素数据的读取包括：当所述第二状态机为长数据读取状态时，从长缓存中读取长曝光数据，直至读取像素数据的行数大于第一预设行数时，切换至交替数据读取状态；当所述第二状态机为交替数据读取状态时，交替执行从长缓存中读取一行长曝光数据的过程和从短缓存中读取短曝光数据的过程，直至读取像素数据的行数大于第二预设行数时，切换至短数据读取状态；当所述第二状态机为短数据读取状态时，从短缓存中读取短曝光数据。7.根据权利要求4所述的图像处理模块的调试方法，其特征在于，所述第一状态机将外部存储介质中的像素数据写入到相应像素缓存中包括：当所述第一状态机为长缓存预加载状态时，将外部存储介质中的长曝光数据写到长缓存中，在长数据写指针到达长缓存的末尾时，切换至短缓存预加载状态；当所述第一状态机为短缓存预加载状态时，将外部存储介质中的短曝光数据写到短缓存中。8.根据权利要求1至7中任一项所述的图像处理模块的调试方法，其特征在于，所述控制信号包括tuser信号、tlast信号和tdest信号中的至少一种，所述根据所述数据信号生成同步的控制信号包括：在读取到每帧中第一行的第一个像素数据时，将tuser信号拉高，直至预设周期后拉低；在读取到每帧中每行的最后一个像素数据时，tlast信号拉高，直至预设周期后拉低；根据所读取的像素数据的类型，生成预设编码的tdest信号。9.一种图像处理模块的调试装置，其特征在于，包括：至少一个处理器；以及，与所述至少一个处理器通信连接的存储器；其中，所述存储器存储有可被所述至少一个处理器执行的指令，所述指令被所述处理器执行，用于执行权利要求1至8中任一项所述的图像处理模块的调试方法。
说明书desc
技术领域本发明涉及图像处理技术领域，特别是涉及一种图像处理模块的调试方法和装置。背景技术现有技术中进行图像处理模块调试的基本思路是图像传感器输出移动行业处理器接口协议的输出信号，由相应IP核对输出信号进行处理得到高性能扩展总线接口协议数据流，再使用AXI Stream作为输入进行图像处理模块的调试。现有的这种调试方式通常具有几方面问题：基于测试的基本思想，想要确保产品的可靠性，模块测试是必不可少的，模块测试是对系统赋有明显功能的最小粒度的测试，是对一个模块进行测试，根据模块的功能说明检验模块是否有错误，一个可靠的模块测试应当针对单个模块进行多种输入，包括正确输入和错误输入等，从而测试模块是否能够对各种输入进行相应的处理。而现有技术中，由于图像处理模块的测试依赖于图像传感器的输出，则将图像处理模块的输入限定在图像传感器的可输出范围内，使其更偏向于系统测试，而没有实现对图像处理模块的模块测试，使得当在后续实际使用中，若图像传感器发生了更换，该图像处理模块的可靠性仍然是无法估量的。图像传感器仅支持拍摄实景或使用色条生成相应的输出信号，导致其可使用的测试模式单一，在测试某些图像处理模块时需要自定义场景或者在使用外部设备的采集数据时，图像传感器就不能满足该需求。鉴于此，克服该现有技术所存在的缺陷是本技术领域亟待解决的问题。发明内容本发明要解决的技术问题是在现有的测试方式下测试模式单一，无法满足自定义场景或者在使用外部设备的采集数据进行测试的需求，且当前测试图受限于实际搭建的场景，不能根据需要指定具有某种特性的测试图像。本发明采用如下技术方案：第一方面，本发明提供了一种图像处理模块的调试方法，包括：从外部存储介质中读取像素数据，根据所述像素数据生成数据信号；根据所述数据信号生成同步的控制信号；将所述数据信号与所述控制信号传输至图像处理模块，以便于所述图像处理模块根据所述数据信号与所述控制信号进行调试。优选的，所述从外部存储介质中读取像素数据，具体包括：第一状态机将外部存储介质中的像素数据写入到相应像素缓存中，第二状态机从所述像素缓存中读取像素数据；所述第一状态机和所述第二状态机之间进行状态切换的同步，以实现像素数据的同步读写。优选的，所述第一状态机和所述第二状态机之间进行状态切换的同步，具体包括：当读指针在所述像素缓存中的位置大于第一预设位置时，则所述第一状态机从等待状态切换至数据写入状态，以将外部存储介质中的像素数据写入到像素缓存的剩余空间内；其中，所述读指针是第二状态机用于读取像素数据的指针。优选的，所述第一状态机和所述第二状态机之间进行状态切换的同步，还包括：当第二状态机进入预加载状态时，向第一状态机发送预加载命令；所述第一状态机根据所述预加载命令，进入预加载状态，以将外部存储介质中的像素数据写到像素缓存中；当写指针在像素缓存中的位置大于第二预设位置时，向所述第二状态机发送预加载完成命令；其中，所述写指针是所述第一状态机用于将像素数据写入到像素缓存中的指针；所述第二状态机根据所述预加载完成命令，进入数据读取状态，以从像素缓存中读取像素数据。优选的，所述像素数据包括长曝光数据和短曝光数据，所述像素缓存划分为用于存储长曝光数据的长缓存和用于存储短曝光数据的短缓存；所述第一状态机和所述第二状态机之间进行状态切换的同步，具体包括：当长数据读指针在所述长缓存中的位置大于第三预设位置时，则所述第一状态机切换至长数据写入状态，使第一状态机将外部存储介质中的长曝光数据写入到长缓存中的剩余空间内；其中，所述长数据读指针是第二状态机用于读取长曝光数据的指针；当短数据读指针在所述短缓存中的位置大于第四预设位置时，则所述第一状态机切换至短数据写入状态，使第一状态机将外部存储介质中的短曝光数据写入到短缓存中的剩余空间内；其中，所述短数据读指针是第二状态机用于读取短曝光数据的指针。优选的，所述第一状态机和所述第二状态机之间进行状态切换的同步，还包括：当第二状态机进入预加载状态时，向第一状态机发送预加载命令；所述第一状态机根据所述预加载命令，进入长缓存预加载状态，以将外部存储介质中的长曝光数据写到长缓存中；当长数据写指针在长缓存中的位置大于第五预设位置时，向所述第二状态机发送预加载完成命令；其中，所述长数据写指针是所述第一状态机用于将长曝光数据写入到长缓存中的指针；所述第二状态机根据所述预加载完成命令，进入长数据读取状态，以进行像素数据的读取。优选的，所述进行像素数据的读取，具体包括：当所述第二状态机为长数据读取状态时，从长缓存中读取长曝光数据，直至读取像素数据的行数大于第一预设行数时，切换至交替数据读取状态；当所述第二状态机为交替数据读取状态时，交替执行从长缓存中读取一行长曝光数据的过程和从短缓存中读取短曝光数据的过程，直至读取像素数据的行数大于第二预设行数时，切换至短数据读取状态；当所述第二状态机为短数据读取状态时，从短缓存中读取短曝光数据。优选的，所述第一状态机将外部存储介质中的像素数据写入到相应像素缓存中，具体包括：当所述第一状态机为长缓存预加载状态时，将外部存储介质中的长曝光数据写到长缓存中，在长数据写指针到达长缓存的末尾时，切换至短缓存预加载状态；当所述第一状态机为短缓存预加载状态时，将外部存储介质中的短曝光数据写到短缓存中。优选的，所述控制信号包括tuser信号、tlast信号和tdest信号中的至少一种，所述根据所述数据信号生成同步的控制信号，具体包括：在读取到每帧中第一行的第一个像素数据时，将tuser信号拉高，直至预设周期后拉低；在读取到每帧中每行的最后一个像素数据时，tlast信号拉高，直至预设周期后拉低；根据所读取的像素数据的类型，生成预设编码的tdest信号。第二方面，本发明还提供了一种图像处理模块的调试装置，用于实现第一方面所述的图像处理模块的调试方法，所述装置包括：至少一个处理器；以及，与所述至少一个处理器通信连接的存储器；其中，所述存储器存储有可被所述至少一个处理器执行的指令，所述指令被所述处理器执行，用于执行第一方面所述的图像处理模块的调试方法。第三方面，本发明还提供了一种非易失性计算机存储介质，所述计算机存储介质存储有计算机可执行指令，该计算机可执行指令被一个或多个处理器执行，用于完成第一方面所述的图像处理模块的调试方法。本发明通过从外部存储中读取像素数据，从而生成对应的数据信号和控制信号，从而模拟AXI Stream输出，在无需依赖于图像传感器的情况下为图像处理模块提供输入，同时，由于使用了外部存储，从而能够灵活调整像素数据的来源，从而能够根据图像处理模块的调试需求，调整像素数据来源，以满足自定义场景或者在使用外部设备的采集数据进行测试的需求。附图说明为了更清楚地说明本发明实施例的技术方案，下面将对本发明实施例中所需要使用的附图作简单地介绍。显而易见地，下面所描述的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明实施例提供的一种图像处理模块的调试方法的流程示意图；图2是本发明实施例提供的另一种图像处理模块的调试方法的流程示意图；图3是本发明实施例提供的再一种图像处理模块的调试方法的流程示意图；图4是本发明实施例提供的一种图像处理模块的调试方法的示意图；图5是本发明实施例提供的另一种图像处理模块的调试方法的示意图；图6是本发明实施例提供的再一种图像处理模块的调试方法的示意图；图7是本发明实施例提供的再一种图像处理模块的调试方法中大行周期的示意图；图8是本发明实施例提供的一种图像处理模块的调试方法的各信号示意图；图9是本发明实施例提供的一种图像处理模块的调试方法中第二状态机的状态切换示意图；图10是本发明实施例提供的一种图像处理模块的调试方法中第一状态机的状态切换示意图；图11是本发明实施例提供的一种图像处理模块的调试装置的架构示意图；图12是本发明实施例提供的一种图像处理模块的调试装置中部分结构的示意图；图13是本发明实施例提供的另一种图像处理模块装置的架构示意图。具体实施方式为了使本发明的目的、技术方案及优点更加清楚明白，以下结合附图及实施例，对本发明进行进一步详细说明。应当理解，此处所描述的具体实施例仅仅用以解释本发明，并不用于限定本发明。本发明中术语“第一”、“第二”等仅用于描述目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量。由此，限定有“第一”、“第二”等的特征可以明示或者隐含地包括一个或者更多个该特征。在本申请的描述中，除非另有说明，“多个”的含义是两个或两个以上。此外，下面所描述的本发明各个实施方式中所涉及到的技术特征只要彼此之间未构成冲突就可以相互组合。现有的测试方式下测试模式单一，无法满足自定义场景或者在使用外部设备的采集数据进行测试的需求，且当前测试图受限于实际搭建的场景，不能根据需要指定具有某种特性的测试图像。为了解决该问题，本发明实施例提供了一种图像处理模块的调试方法，如图1所示，包括：在步骤201中，从外部存储介质中读取像素数据，根据所述像素数据生成数据信号；其中，所述从外部存储介质中读取像素数据是相对概括性的表述，其代表的是像素数据来源于外部存储介质，并最终被读取，而并非代指直接从外部存储介质中读取，以外部存储介质为SD卡为例，所述从外部存储介质中读取像素数据可以是将外部存储介质中的像素数据加载到内存中，再从内存中读取像素数据到相应缓存中，最后从缓存中读取得到像素数据。在步骤202中，根据所述数据信号生成同步的控制信号；所述控制信号包括tuser信号、tlast信号和tdest信号中的至少一种，在实际使用中，还接收图像处理模块的第一握手信号tready信号的输入，根据该tready信号输出第二握手信号tvalid信号。在后续实施例中也以tdata信号作为所述数据信号的替代表达形式。其中，所述数据信号和控制信号共同组成了图像处理模块所需的AXI Stream输入。在步骤203中，将所述数据信号与所述控制信号传输至图像处理模块，以便于所述图像处理模块根据所述数据信号与所述控制信号进行调试。在此需要说明的是，本发明实施例所述的图像处理模块指代的是所有以AXIStream为输入的模块，本发明实施例对图像处理模块中所执行的具体功能不做限定。本发明实施例通过从外部存储中读取像素数据，从而生成对应的数据信号和控制信号，从而模拟AXI Stream输出，在无需依赖于图像传感器的情况下为图像处理模块提供输入，同时，由于使用了外部存储，从而能够灵活调整像素数据的来源，从而能够根据图像处理模块的调试需求，调整像素数据来源，以满足自定义场景或者在使用外部设备的采集数据进行测试的需求。在实际使用中，外部存储介质的数据读取速率通常较低，无法满足图像处理模块的高速AXI Stream输入需求，为了解决此问题，本发明实施例还提供了一种优选的实施方式，即所述从外部存储介质中读取像素数据，如图2所示，具体包括：在步骤301中，第一状态机将外部存储介质中的像素数据写入到相应像素缓存中，第二状态机从所述像素缓存中读取像素数据；其中，所述像素缓存的大小由本领域技术人员根据像素数据的读取需求分析得到，可以用于存储多个帧、单帧中的多行像素数据、单帧中的单行像素数据或相应数量的像素数据。在步骤302中，所述第一状态机和所述第二状态机之间进行状态切换的同步，以实现像素数据的同步读写。其中，所述第一状态机和第二状态机可以由RTL代码实现，所述第一状态机和所述第二状态机并行进行处理，可并行进行相应的操作。通常情况下，缓存中的数据读取速率大于内存中的数据读取速率，更大于外部存储介质中的数据读取速率，且外部存储介质通常会被多个模块进行访问，可能出现繁忙占用的情况。故本实施方式通过将外部存储介质中的像素数据写入到缓存中，再从缓存中读取像素数据，两者之间的同步则通过第一状态机和第二状态机的同步状态切换实现，从而能够实现像素数据的快速读取，以满足图像处理模块的高速AXI Stream输入需求。当所述图像处理模块的AXI Stream输入需求为非HDR模式时，如SDR模式或LDR模式时，所述第一状态机和所述第二状态机之间进行状态切换的同步，具体包括：当读指针在所述像素缓存中的位置大于第一预设位置时，则所述第一状态机从等待状态切换至数据写入状态，以将外部存储介质中的像素数据写入到像素缓存的剩余空间内；其中，所述读指针是第二状态机用于读取像素数据的指针。所述第一预设位置由本领域技术人员根据所述像素缓存中的数据读取速率、所述像素缓存中的数据写入速率以及不同行的像素数据之间的读取时间间隔共同分析得到，举例而言，若像素缓存的大小为每行像素数据的大小，所述第一预设位置需满足在上一读取周期中读指针到达第一预设位置时刻开始进行像素数据的写入时，能够满足下一读取周期像素数据的读取需求。在优选的实施方式中，所述第一状态机和所述第二状态机之间进行状态切换的同步，如图3所示，还包括：在步骤401中，当第二状态机进入预加载状态时，向第一状态机发送预加载命令。在步骤402中，所述第一状态机根据所述预加载命令，进入预加载状态，以将外部存储介质中的像素数据写到像素缓存中；当写指针在像素缓存中的位置大于第二预设位置时，向所述第二状态机发送预加载完成命令；其中，所述写指针是所述第一状态机用于将像素数据写入到像素缓存中的指针。在步骤403中，所述第二状态机根据所述预加载完成命令，进入数据读取状态，以从像素缓存中读取像素数据。所述第二预设位置由本领域技术人员根据所述像素缓存中的数据读取速率和所述像素缓存中的数据写入速率共同分析得到，举例而言，若像素缓存的大小为每行像素数据的大小，所述第二预设位置需满足在写指针在像素缓存中的位置大于第二预设位置时刻开始进行像素数据的读取时，能够满足对应行的像素数据的读取需求。当所述图像处理模块的AXI Stream输入需求为HDR模式时,所述像素数据包括长曝光数据和短曝光数据，所述像素缓存划分为用于存储长曝光数据的长缓存和用于存储短曝光数据的短缓存；所述第一状态机和所述第二状态机之间进行状态切换的同步，具体包括：当长数据读指针在所述长缓存中的位置大于第三预设位置时，则所述第一状态机切换至长数据写入状态，使第一状态机将外部存储介质中的长曝光数据写入到长缓存中的剩余空间内；其中，所述长数据读指针是第二状态机用于读取长曝光数据的指针；如图4和图6所示，各虚线位置代表长数据读指针到达第三预设位置的时刻，从该时刻开始进行长曝光数据的写入，并在下一周期读取相应位置的长曝光数据时，该位置的长曝光数据已在上一写周期内被写入。当短数据读指针在所述短缓存中的位置大于第四预设位置时，则所述第一状态机切换至短数据写入状态，使第一状态机将外部存储介质中的短曝光数据写入到短缓存中的剩余空间内；其中，所述短数据读指针是第二状态机用于读取短曝光数据的指针。所述第三预设位置由本领域技术人员根据所述长缓存中的数据读取速率、所述长缓存中的数据写入速率以及上一行长曝光数据到下一行长曝光数据之间的读取时间间隔共同分析得到；所述第四预设位置由本领域技术人员根据所述短缓存中的数据读取速率、所述短缓存中的数据写入速率以及上一行短曝光数据到下一行短曝光数据之间的读取时间间隔共同分析得到。其中，所述第一状态机和所述第二状态机之间进行状态切换的同步，还可以包括以下两种实施方式：第一种实施方式：当第二状态机进入预加载状态时，向第一状态机发送预加载命令，所述第一状态机根据所述预加载命令，进入长缓存预加载状态，以将外部存储介质中的长曝光数据写到长缓存中；当长数据写指针到达长缓存的末尾时，进入短缓存预加载状态，以将外部存储介质中的短曝光数据写到短缓存中，并在短缓存写指针到达短缓存的末尾时，第一状态机进入初始状态，向第二状态机发送预加载完成命令，所述第二状态机根据所述预加载完成命令，进入长数据读取状态，以进行像素数据的读取。第二种实施方式：当第二状态机进入预加载状态时，向第一状态机发送预加载命令；所述第一状态机根据所述预加载命令，进入长缓存预加载状态，以将外部存储介质中的长曝光数据写到长缓存中；为了缩短预加载的时间，当长数据写指针在长缓存中的位置大于第五预设位置时，向所述第二状态机发送预加载完成命令；其中，所述长数据写指针是所述第一状态机用于将长曝光数据写入到长缓存中的指针；所述第二状态机根据所述预加载完成命令，进入长数据读取状态，以进行像素数据的读取。如图5所示，虚线位置代表长数据写指针到达第五预设位置，进入长数据读取状态，与此同时，第一状态机依旧在长缓存预加载状态，继续长缓存的写入，使在进行长曝光数据读取时，依旧可进行后续长缓存的写入，使在读取相应长曝光数据之前，将该长曝光数据写入到长缓存，直至写至长缓存末尾时，进入短缓存预加载状态，进行短缓存的写入，以缩短预加载的时间。所述第五预设位置由本领域技术人员根据所述长缓存中的数据读取速率和所述长缓存中的数据写入速率共同分析得到。在可选的实施方式中，所述进行像素数据的读取，如图6所示，具体包括：当所述第二状态机为长数据读取状态时，从长缓存中读取长曝光数据，直至读取像素数据的行数大于第一预设行数时，切换至交替数据读取状态；当所述第二状态机为交替数据读取状态时，交替执行从长缓存中读取一行长曝光数据的过程和从短缓存中读取短曝光数据的过程，直至读取像素数据的行数大于第二预设行数时，切换至短数据读取状态；当所述第二状态机为短数据读取状态时，从短缓存中读取短曝光数据，直至读取像素数据的行数大于第三预设行数时，切换至初始状态，以进行下一帧的读取。所述第一预设行数、第二预设行数和第三预设行数均由本领域技术人员根据图像处理模块的调试的数据源格式分析得到。所述第三预设行数大于等于第二预设行数，所述第二预设行数大于等于第一预设行数。所述读取像素数据的行数包括读取的长曝光数据和短曝光数据的行数，该行数可通过计数器计数得到。其中，在长数据读取状态、交替数据读取状态和短数据读取状态下，像素数据均基于行周期进行读取，如图7所示，图7为在交替数据读取状态下的一个大行周期，在每一个帧周期内有多个大行周期，每个大行周期内有两个小行周期，分别为长曝光行周期和短曝光行周期，在交替数据读取状态下，在长曝光行周期的有效区段读取长曝光数据，在短曝光行周期的有效区段读取短曝光数据；在长数据读取状态下，仅在长曝光行周期的有效区段读取长曝光数据，在短曝光行周期中空闲；在短数据读取状态下，仅在短曝光行周期的有效区段读取短曝光数据，在长曝光行周期中空闲。所述第一状态机将外部存储介质中的像素数据写入到相应像素缓存中，具体包括：当所述第一状态机为长缓存预加载状态时，将外部存储介质中的长曝光数据写到长缓存中，在长数据写指针到达长缓存的末尾时，切换至短缓存预加载状态。当所述第一状态机为短缓存预加载状态时，将外部存储介质中的短曝光数据写到短缓存中。结合上述第二种实施方式，如图5所示，在进入短缓存预加载状态后，并在短数据写指针到达短缓存的末尾前，若长数据读指针到达第三预设位置时，则中断短缓存的写入，转而对长缓存进行写入，直至长数据写指针到达长缓存的末尾时，再度切换至对短缓存继续写入，直至短数据写指针到达短缓存的末尾时，第一状态机进入初始状态。在可选的实施方式中，本发明实施例通过采集实际的图像传感器的输出，并对该输出进行mipi解析后，分析输出信号的规律，得到控制信号与数据信号之间的关联，从而得到下述实施方式，即所述根据所述数据信号生成同步的控制信号，具体包括：在读取到每帧中第一行的第一个像素数据时，将tuser信号拉高，直至预设周期后拉低，用于代表每帧的开始；在读取到每帧中每行的最后一个像素数据时，tlast信号拉高，直至预设周期后拉低，用于代表每行的结束；根据所读取的像素数据的类型，生成预设编码的tdest信号，用于标明当前的像素数据为长曝光数据还是短曝光数据。其中，tuser、tlast和tdest信号如图8所示，在图8中，tdata为数据信号。所述预设周期和预设编码是由本领域技术人员根据图像处理模块所需数据源分析得到的。本发明实施例还将以所述图像处理模块的AXI Stream输入需求为HDR模式为例，对一种可选的实施方式下的第一状态机和第二状态机进行详细阐述，如图9所示，所述第二状态机包括IDLE、LOAD、LONG、ALTERNATE、SHORT和BLANK六个状态，其中，IDLE为初始状态，在进入IDLE状态时，若接收到外部的使能信号，则代表开始读取新一帧，进入LOAD状态，向第一状态机发送预加载命令。LOAD为预加载状态，代表正在向缓存中预加载数据，在该状态下等待，在接收到来自于第一状态机的预加载完成命令时，进入LONG状态。LONG为长数据读取状态，在LONG状态下进行长曝光数据的读取，在行计数row_cnt达到第一预设行数LONG_END时，进入ALTERNATE状态。ALTERNATE为交替数据读取状态，在ALTERNATE状态下交替进行长曝光数据和短曝光数据的读取，在行计数row_cnt达到第二预设行数ALTERNATE_END时，进入SHORT状态。SHORT为短数据读取状态，在SHORT状态下进行短曝光数据的读取，在行计数row_cnt达到第三预设行数SHORT_END时，进入BLANK状态。BLANK为空闲状态，在BLANK状态下等待，在经过预设时间Time后，进入初始状态。所述预设时间由本领域技术人员根据经验分析得到，通常以数据信号中一个读取周期的整数倍作为预设时间，BLANK状态主要用于进行模式切换，模式切换的具体实现将在后续实施例中进行详述，在此不加以赘述。其中，每读取一行像素数据，行计数row_cnt加一，在进入IDLE状态时，行计数row_cnt清零。如图10所示，所述第一状态机包括IDLE、LONG、SHORT、PRE_LONG和PRE_SHORT五个状态，其中，IDLE为初始状态，在该状态下等待，以便于在满足相应条件时，进入LONG、SHORT和PRE_LONG状态中的一个，具体的：第一状态机在IDLE状态下，接收到来自于第二状态机的预加载命令时，进入PRE_LONG状态。PRE_LONG为长缓存预加载状态，在PRE_LONG状态下将长曝光数据写入到长缓存中，在长数据写指针wr_l_addr到达第五预设位置pre_gate时，向第二状态机发送预加载完成命令。在长数据写指针wr_l_addr到达长缓存末尾l_width时，切换至PRE_SHORT状态。PRE_SHORT为短缓存预加载状态，在PRE_SHORT状态下将短曝光数据写入到短缓存中，在短数据写指针wr_s_addr到达短缓存末尾s_width时，切换至IDLE状态。在IDLE状态下，当长数据读指针rd_l_addr到达第三预设位置l_gate时，切换至LONG状态。当短数据读指针rd_s_addr到达第四预设位置s_gate时，切换至SHORT状态。LONG状态为长数据写入状态，在LONG状态将长曝光数据写入到长缓存中，在长数据写指针wr_l_addr到达长缓存末尾l_width时，切换至IDLE状态。SHORT状态为短数据写入状态，在SHORT状态将短曝光数据写入到短缓存中，在短数据写指针wr_s_addr到达长缓存末尾s_width时，切换至IDLE状态。在实际实现中，所述第二状态机所在模块可通过向第一状态机所在模块发送数据读取命令，在数据读取命令中至少包括读取地址，第一状态机所在模块根据所述数据读取命令对缓存进行读取，并将读取得到的像素数据传输给第二状态机所在模块，从而实现像素数据的读取和第一状态机对读指针和写指针的监控。在此需要说明的是，第二状态机按照从前往后的顺序读取像素缓存，第一状态机按照从前往后的顺序写像素缓存。在实际使用中，考虑到还可能存在一种情况，即通过其他外部设备实时采集像素数据或实时生成像素数据，外部设备将像素数据写入到外部存储介质中，再使用本发明所述的图像处理模块的调试方法进行图像处理模块的调试。在该情况下，由于外部存储介质中的像素数据是实时写入的，其写入速度也可能对调试过程造成影响，本发明实施例针对此场景，提供了以下优选的实施方式，具体包括：第一状态机监测像素数据写入外部存储介质的过程，统计像素数据写入外部存储介质的写入速度，判断所述写入速度是否满足相应模式下长曝光数据和短曝光数据的实时读取需求，即判断写入速度是否大于等于长曝光数据和短曝光数据的读取速度。存在以下三种情况：第一种情况：当所述写入速度大于等于长曝光数据和短曝光数据的读取速度时，说明像素数据的采集跟得上数据的读取，使用上述实施例中所述的方法进行长曝光数据和短曝光数据的读取。第二种情况：当所述写入速度小于长曝光数据和短曝光数据的读取速度时，说明像素数据的采集跟不上数据的读取，此时，每当第一状态机监测到外部存储介质中写入新的像素数据时，从外部存储介质中读取新的像素数据，将新的像素数据发送给第二状态机。第三种情况：在实际使用中，由于长曝光数据采集所需的曝光时间长，故采集速度相对较慢，而短曝光数据采集所需的曝光时间短，故采集速度相对较快，故还可能出现像素数据中长曝光数据的写入速度小于长曝光数据的读取速度，而像素数据中短曝光数据的大于短曝光数据的读取速度的情况出现，当第二状态机在长数据读取状态或短数据读取状态下时，可依旧按照上述两种情况进行数据读取。当第二状态机处于交替数据读取状态下时，第一状态机对长曝光数据按照上述第二种情况进行读取，对于短曝光数据按照上述第一种情况进行读取，并在向第二状态机返回短曝光数据和长曝光数据时，对应返回相应的数据序列号，短曝光数据的数据序列号和长曝光数据的数据序列号均依次递增，并在一帧结束后归零，第二状态机按照接收到的长曝光数据的数据序列号，与已接收到的相应数据序列号的短曝光数据相拼接，得到数据信号。举例而言，当采集到的一个长曝光数据时，第一状态机读取外部存储介质中的该长曝光数据并返回给第二状态机，而在此之前，由于短曝光数据采集速度快，其按照第一种情况进行读取时所对应的读取速度也相对较快，若第一状态机接收到的该长曝光数据的数据序列号为8时，由于短曝光数据读取速度快，故在读取长曝光数据的间隙中，已读取到了数据序列号为8的短曝光数据，则按照数据信号的拼接规则，将数据序列号为8的短曝光数据拼接在数据序列号为8的长曝光数据前方或后方，形成一段数据信号。本发明基于上述实施例所描述的方法基础上，结合具体的应用场景，并借由相关场景下的技术表述来阐述本发明特性场景下的实现过程。本发明实施例基于上述实施例中所描述的方法，还提供了一种图像处理模块的调试装置，所述装置如图11所示，包括配置模块、逻辑控制模块和行缓存模块，所述逻辑控制模块和行缓存模块在实际使用中均可以是FPGA模块，其中，逻辑控制模块中设置第二状态机，行缓存模块中设置第一状态机，长缓存和短缓存设置在行缓存模块中。以该装置为应用场景，本发明实施例所述的图像处理模块的调试方法包括：采集实际的图像传感器的输出时序。在后续实施例中，也使用sensor作为图像传感器的替代形式进行表述。在sensor正常工作下，通过逻辑分析仪采集sensor经过mipi解析模块后的信号得到：tuser信号：结合sensor的特性和mipi协议，得到tuser信号表示一帧开始，由于sensor工作在HDR模式，所以一个帧周期内会有两个tuser有效，分别代表着长曝光帧的开始和短曝光帧的开始。tlast信号：表示一行数据的结束。tdest信号：在这里指示当前行是长曝光行还是短曝光行，如当编码为2b1时，代表短曝光行，当编码为2b0时，代表长曝光行。tdata信号：表示像素数据，如果sensor输出的数据格式是row10，则有效位是低10bit。tvalid信号：输出握手信号。tdest信号：输入握手信号。根据上述实时采集的信号时序并结合sensor特性，绘制得到一个帧周期内各个信号的波形图如图8所示。在逻辑控制模块设置第二状态机，模拟实际的sensor的输出。此模块主要实现的功能是在AXI Stream的握手机制下，正确产生tuser、tlast、tdest、tdata信号。根据sensor输出像素的原理：在每一个帧周期内有3500个大行周期，每个大行周期内有两个小行周期，分别为长曝光行周期和短曝光行周期，每个小行周期包括小行有效区和小行blank区。sensor工作在HDR模式下是先输出“最大短曝光行/2”行长曝光数据，然后长曝光数据、短曝光数据按行交替输出，最后输出“最大短曝光行/2”行短曝光数据，接着后面输出blank行一直到帧周期结束。定义两个计数器，一个对单行进行计数称作列计数器，一个对行进行计数称作行计数器，根据行计数器可使状态机跳转，其中，第二状态机一共有6个状态，分别是IDLE、LOAD、LONG、ALTERNATE、SHORT、BLANK，其中IDLE代表初始状态，LOAD状态代表此时需要从DDR中读取像素数据暂存到行缓存中。以便在下一阶段读取像素时避免延时；LONG状态表示此时需要输出长曝光数据，其中长曝光数据从长行缓存中读取；ALTERNATE状态表示此时需要交替输出长曝光数据和短曝光数据，其中短曝光数据从短行缓存中读取；SHORT状态表示此时需要输出短曝光数据，其中短曝光数据从短缓存中读取；最后是BLANK状态，BLANK状态结束回到IDLE状态。上述状态跳转的触发条件分别是行计数器计数到LOAD_END、LONG_END、ALTERNATE_END、SHORT_END、BLANK_END。这些参数是可以配置的，但相互之间也存在约束。这些参数均由本领域技术人员分析得到，并预先存储在配置模块中。在读取像素数据的同时，逻辑控制模块还根据行计数和点计数生成各控制信号，具体包括：tuser信号在刚进入LONG状态、刚进入SHORT状态和输出第一个像素时拉高一个时钟周期。tlast信号在每一行的最后一个像素输出时拉高一个时钟周期。tdest信号根据当前输出行而定，长曝光行输出2’b0，短曝光行输出2’b1。tdata是根据像素数据生成的数据信号，根据状态机分别输出长曝光、短曝光数据或交替输出长曝光数据和短曝光数据。在行缓存模块中设置第一状态机，第一状态机的各状态切换如图10所示，此模块的作用是从外部存储介质DDR中正确的读取像素数据并暂存在行缓存中。其功能上主要关注：什么时候读，读多少次，从哪读，每次读多少个数据。这一块用纯FPGA控制，编写访问DDR的master逻辑，通过发起一条包含“读取起始地址+读取长度+其他”信息的命令即可等待从DDR中接收数据，这就解决了从哪读，每次读多少个数据的问题。而什么时候读，读多少次是模拟sensor逻辑的模块决定的，缓存模块使用FPGA中的BRAM资源。因为sensor工作在HDR模式下，需要输出长短曝光行，所以行缓存分为长曝光缓存和短曝光缓存，此处不用同一个行缓存是因为FPGA从DDR中读取数据有延时，这个延时可能会超过sensor输出两行之间的间隔时长。故通过分别存储在不同的缓存区中，实现数据的高速读取。在DDR中一般图片存储在一片连续的空间内，所以长短曝光数据一般是分开存储的，即长曝光存在addr1+frame_size×frame_cnt内，短曝光数据存储在addr2+frame_size×frame_cnt内。在输出长短曝光交替阶段时，地址要来回切换，一旦出错就会导致图像错误，所以用于从DDR中读取数据的读取地址须严格控制。第二状态机的各状态切换的示意图如图9所示。例化基于AXI Lite的可配置接口，由于帧率，帧数，行间距，切换显示源等参数的配置不是高速频繁的配置，所以可以用AXI Lite接口协议已足够，需要编写一个基于AXILite接口的slave。通过该接口实现帧率、帧数和行间距的设置。本发明实施例还支持在以本发明实施例所述的装置进行图像处理模块的调试，和以sensor进行图像处理模块的调试之间进行切换，而为了防止图像在切换时出现分裂和切割，本发明实施例以信号sel的高低代表选择本发明实施例所述装置或sensor,信号sel为高电平时，选择本发明实施例所述装置，信号sel为低电平时，选择sensor。本发明实施例还根据数据信号，生成对应的test_frame_end波形，当数据读取帧结束时，即第二状态机进入BLANK状态时，test_frame_end波形拉高，第二状态机退出BLANK状态时，test_frame_end波形拉低，从而用于代表帧的结束。同时，对应使用sensor并对其进行mipi协议解析后，同样会输出mipi_frame_end波形，在每帧读取结束时，mipi_frame_end波形拉高，读取下一帧时，mipi_frame_end波形拉低。使用如图12所示的数字逻辑电路进行切换的控制，其中sel1 = sel&amp;mipi_frame_end，sel2=~sel&amp;mipi_frame_end&amp;test_frame_end，从而使当在读取相应帧的过程中出现切换，即波形sel由低到高或由高到低时，不做处理，而是在帧结束后进行更换显示源，其中，test代表本发明实施例所述的装置输出，mipi代表对sensor进行mipi协议解析后的输出。如果切换信号到来先存储，直到帧结束后再使能。在实际使用时，加载SD卡文件系统并读取SD卡中测试数据至DDR中，读取的数据写入DDR中指定的地址区间，并通过AXI Lite接口配置行缓存模块中的长短帧读取的起始地址。当切换为使用本装置进行调试时，行缓存模块从DDR取出读取起始地址，并把这段地址区间的数据读取到相应像素缓存中，以便于进行数据信号和控制信号的生成，所生成的数据信号和控制信号输出至图像处理模块，用于其调试。如图13所示，是本发明实施例的图像处理模块的调试装置的架构示意图。本发明实施例的图像处理模块的调试装置包括一个或多个处理器21以及存储器22。其中，图13中以一个处理器21为例。处理器21和存储器22可以通过总线或者其他方式连接，图13中以通过总线连接为例。存储器22作为一种非易失性计算机可读存储介质，可用于存储非易失性软件程序和非易失性计算机可执行程序，如上述实施例中的图像处理模块的调试方法。处理器21通过运行存储在存储器22中的非易失性软件程序和指令，从而执行图像处理模块的调试方法。存储器22可以包括高速随机存取存储器，还可以包括非易失性存储器，例如至少一个磁盘存储器件、闪存器件、或其他非易失性固态存储器件。在一些实施例中，存储器22可选包括相对于处理器21远程设置的存储器，这些远程存储器可以通过网络连接至处理器21。上述网络的实例包括但不限于互联网、企业内部网、局域网、移动通信网及其组合。所述程序指令/模块存储在所述存储器22中，当被所述一个或者多个处理器21执行时，执行上述实施例中的图像处理模块的调试方法。值得说明的是，上述装置和系统内的模块、单元之间的信息交互、执行过程等内容，由于与本发明的处理方法实施例基于同一构思，具体内容可参见本发明方法实施例中的叙述，此处不再赘述。本领域普通技术人员可以理解实施例的各种方法中的全部或部分步骤是可以通过程序来指令相关的硬件来完成，该程序可以存储于一计算机可读存储介质中，存储介质可以包括：只读存储器、随机存取存储器、磁盘或光盘等。以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的精神和原则之内所作的任何修改、等同替换和改进等，均应包含在本发明的保护范围之内。
