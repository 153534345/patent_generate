标题title
一种支持双算法的版式文件签章方法及系统
摘要abst
本发明属于电子信息技术领域，公开了一种支持双算法的版式文件签章方法及系统：第一用户在第一文件的待签署位置添加第一签名域，生成第二文件，采用SM3算法对第二文件进行摘要运算，生成第二文件的第一摘要值；采用SM2算法对第一摘要值进行加密，生成第一文件的第一数字签名值，将SM2数字证书和第一数字签名值添加到第一签名域，得到第三文件；计算第三文件的第一哈希值，采用RSA算法对第一哈希值进行加密，随后将第三文件和加密后的第一哈希值发送给第二用户。本发明解决了双算法电子文件签名安全性低和计算量大的问题。
权利要求书clms
1.一种支持双算法的版式文件签章方法，其特征在于，包括如下步骤：步骤1、第一用户在第一文件的待签署位置添加第一签名域，生成第二文件，采用SM3算法对所述第二文件进行摘要运算，生成所述第二文件的第一摘要值；步骤2、采用SM2算法对所述第一摘要值进行加密，生成所述第一文件的第一数字签名值，将SM2数字证书和所述第一数字签名值添加到所述第一签名域，得到第三文件；步骤3、计算所述第三文件的第一哈希值，采用RSA算法对所述第一哈希值进行加密，随后将所述第三文件和加密后的第一哈希值发送给第二用户；步骤4、所述第二用户收到所述第三文件和所述加密后的第一哈希值后，使用所述第一用户的公钥对所述加密后的第一哈希值进行解密，若能解密，则验证通过，验证通过后，计算所述第三文件的第二哈希值，若所述第二哈希值与所述第一哈希值一致，则所述第三文件在传输过程中未被修改。2.根据权利要求1所述的一种支持双算法的版式文件签章方法，其特征在于，所述步骤1之前，包括如下步骤：步骤11、所述第一用户向服务器发送验证请求，所述验证请求包括第一用户标识；步骤12、所述服务器根据所述验证请求生成第一私钥和第一公钥，并为所述第一公钥分配第一标识，将所述第一标识和所述第一私钥相对应地存储在第一存储单元，随后将所述第一标识和所述第一公钥发送给所述第一用户；步骤13、所述第一用户生成验证码，使用接收到的所述第一公钥加密所述验证码，并将所述第一标识和加密后的所述验证码发送给所述服务器；步骤14、所述服务器基于所述第一标识查找所述第一存储单元，使用所述第一私钥解密加密后的所述验证码，随后将所述验证码与所述第一标识相对应地存储在所述第一存储单元。3.根据权利要求2所述的一种支持双算法的版式文件签章方法，其特征在于，所述步骤3包括：步骤31、所述第一用户计算所述第三文件的第一哈希值，使用所述第一公钥对所述第一哈希值和所述验证码进行加密，并将所述第一哈希值、所述第三文件、加密后的所述第一哈希值和所述验证码、以及所述第一标识发送给所述服务器；步骤32、所述服务器基于所述第一标识查找所述第一存储单元，使用所述第一私钥对加密后的所述第一哈希值和所述验证码进行解密，获得解密后的所述第一哈希值和所述验证码，当解密后的所述第一哈希值与接收到的所述第一哈希值一致，且解密后的所述验证码与所述第一存储单元中的所述验证码一致时，验证通过；步骤33、所述服务器基于所述第三文件生成第二标识，并生成第二私钥和第二公钥，随后将所述第二标识与所述第二公钥相对应地存储在第二存储单元中；步骤34、所述服务器使用所述第二私钥对所述第一哈希值进行加密，加密完成后将所述第二私钥删除。4.根据权利要求3所述的一种支持双算法的版式文件签章方法，其特征在于，所述步骤33包括：所述服务器获取收到所述第三文件的时间信息，基于所述时间信息生成随机数，并基于所述随机数生成所述第二私钥和所述第二公钥。5.根据权利要求1所述的一种支持双算法的版式文件签章方法，其特征在于，所述步骤4包括：步骤41、所述第二用户收到所述第三文件后，向服务器发送公钥获取请求；步骤42、所述服务器接收到所述公钥获取请求后，提取所述公钥，计算所述公钥的第三哈希值，并基于所述公钥生成第一子公钥和第二子公钥；步骤43、通过第一通信路径将所述第一子公钥和所述第三哈希值发送给所述第二用户，通过第二通信路径将所述第二子公钥发送给所述第二用户；步骤44、所述第二用户基于所述第一子公钥和所述第二子公钥生成第四公钥，随后计算所述第四公钥的第四哈希值，若所述第四哈希值与所述第三哈希值一致，则所述第四公钥为所述第三文件对应的公钥。6.根据权利要求5所述的一种支持双算法的版式文件签章方法，其特征在于，所述步骤42包括：步骤421、所述服务器根据预设规则将所述公钥转化为加密公钥，并将所述加密公钥划分为N个数据块；步骤422、获取所述第一通信路径和所述第二通信路径的传输速度，并计算所述第一通信路径和所述第二通信路径的传输速度之比A：B，其中，所述第一通信路径为传输速度快的路径，所述第二通信路径为传输速度慢的路径；步骤423、按照A：B的比例将所述N个数据块划分为个数据块和/＞个数据块；步骤424、将所述个数据块按照第一组合规则组合生成所述第一子公钥，将所述/＞个数据块按照第二组合规则组合生成所述第二子公钥。7.根据权利要求6所述的一种支持双算法的版式文件签章方法，其特征在于，所述步骤41中，所述第二用户生成第五私钥和第五公钥，并将所述第五公钥发送给所述服务器，所述步骤43中，使用所述第五公钥分别对所述预设规则、所述第一组合规则和所述第二组合规则进行加密，通过所述第一通信路径将加密后的预设规则和加密后的第二组合规则发送给所述第二用户，通过所述第二通信路径将加密后的第一组合规则发送给所述第二用户。8.根据权利要求6所述的一种支持双算法的版式文件签章方法，其特征在于，所述步骤44包括：步骤441、基于所述第一组合规则和所述第二组合规则将所述第一子公钥和所述第二子公钥组合生成所述加密公钥；步骤442、根据所述预设规则将所述加密公钥转化为所述公钥。9.根据权利要求1所述的一种支持双算法的版式文件签章方法，其特征在于，所述步骤4之后还包括：步骤5、所述第二用户确认所述第三文件未被修改后，在所述第三文件的待签署位置添加第二签名域，生成第四文件，采用SM3算法对所述第四文件进行摘要运算，生成所述第四文件的第二摘要值；步骤6、采用SM2算法对所述第二摘要值进行加密，生成所述第三文件的第二数字签名值，将SM2数字证书和所述第二数字签名值添加到所述第二签名域，得到第五文件；步骤7、计算所述第五文件的第五哈希值，采用RSA算法对所述第五哈希值进行加密，随后将所述第五文件和加密后的第五哈希值发送给第三用户；步骤8、所述第三用户收到所述第五文件和所述加密后的第五哈希值后，使用所述第二用户的公钥对所述加密后的第五哈希值进行解密，若能解密，则验证通过，验证通过后，计算所述第五文件的第六哈希值，若所述第六哈希值与所述第五哈希值一致，则所述第五文件在传输过程中未被修改。10.一种支持双算法的版式文件签章系统，用于实现如权利要求1至9任一项所述的支持双算法的版式文件签章方法，其特征在于，包括：第一签章模块、第二签章模块和判断模块；所述第一签章模块，用于第一用户在第一文件的待签署位置添加第一签名域，生成第二文件，采用SM3算法对所述第二文件进行摘要运算，生成所述第二文件的第一摘要值；采用SM2算法对所述第一摘要值进行加密，生成所述第一文件的第一数字签名值，将SM2数字证书和所述第一数字签名值添加到所述第一签名域，得到第三文件；所述第二签章模块，用于计算所述第三文件的第一哈希值，采用RSA算法对所述第一哈希值进行加密，随后将所述第三文件和加密后的第一哈希值发送给第二用户；所述判断模块，用于所述第二用户收到所述第三文件和所述加密后的第一哈希值后，使用所述第一用户的公钥对所述加密后的第一哈希值进行解密，若能解密，则验证通过，验证通过后，计算所述第三文件的第二哈希值，若所述第二哈希值与所述第一哈希值一致，则所述第三文件在传输过程中未被修改。
说明书desc
技术领域本发明属于电子信息技术领域，具体涉及一种支持双算法的版式文件签章方法及系统。背景技术国产密码算法是我国自主研制实现的密码算法，具有较高的安全性，由国家密码管理局认可和推广。RSA算法是国际上第一个能同时用于加密和数字签名的算法，RSA也是被研究得最广泛的公钥算法。RSA和SM2加密算法都属于非对称加密算法，即有公钥和私钥两种密钥。目前，国内、国际市场上主流的电子签章分别使用的是SM2、SM3国密算法和RSA国际算法。通常情况下，国密算法和国际算法各自独立使用，但为了提高跨国流通的通用性和电子文件签章的安全性，在电子文件上同时采用RSA和SM2双标准进行签名是一个重要的发展方向。比如中国专利CN111368335A，公开了PDF文件的电子签章方法及电子签章验证方法和系统，在待签名PDF文件的签名域中创建签名值区域；将签名值区域以外的数据作为签名原文，采用SHA256和SM3算法计算签名原文摘要；基于RSA算法对SHA256签名原文摘要进行签名，基于SM2算法对SM3签名原文摘要进行签名，获得签名值；将签名值依次添加至签名值区域。该方法分别采用RSA和SM2对电子文件进行签名，但是两种签名方法之间相互独立，安全性低。再比如中国专利CN116451261A，公开了一种对PDF文档进行RSA和SM2双标准签名和验证的方法，分别获取PDF文档文本域和RSA证书的哈希值，分别对PDF文档文本域的哈希值和RSA证书的哈希值进行SM2加密，得到PDF文档文本域的哈希值的SM2加密值和RSA证书的哈希值的SM2加密值；在PDF文档内插入SM2标识位；将PDF文档文本域的哈希值的SM2加密值和RSA证书的哈希值的SM2加密值插入SM2标识位中，形成包含SM2加密值的PDF文档；计算包含SM2加密值的PDF文档文本域的哈希值，对该哈希值进行RSA加密，得到经SM2签名的PDF文档的RSA加密值；将RSA加密值插入步骤103得到的PDF文档的签名域中，实现PDF文档的RSA签名。该方法分别采用RSA和SM2对电子文件进行签名，但是计算量大。因此，提供一种支持双算法的版式文件签章方法及系统，以在提高签名安全性的同时减少计算量，是亟待解决的问题。发明内容针对上述提出的技术问题，本发明提供一种支持双算法的版式文件签章方法及系统。第一方面，本发明提供了一种支持双算法的版式文件签章方法，该方法包括：步骤1、第一用户在第一文件的待签署位置添加第一签名域，生成第二文件，采用SM3算法对第二文件进行摘要运算，生成第二文件的第一摘要值；步骤2、采用SM2算法对第一摘要值进行加密，生成第一文件的第一数字签名值，将SM2数字证书和第一数字签名值添加到第一签名域，得到第三文件；步骤3、计算第三文件的第一哈希值，采用RSA算法对第一哈希值进行加密，随后将第三文件和加密后的第一哈希值发送给第二用户；步骤4、第二用户收到第三文件和加密后的第一哈希值后，使用第一用户的公钥对加密后的第一哈希值进行解密，若能解密，则验证通过，验证通过后，计算第三文件的第二哈希值，若第二哈希值与第一哈希值一致，则第三文件在传输过程中未被修改。具体地，步骤1之前，包括如下步骤：步骤11、第一用户向服务器发送验证请求，验证请求包括第一用户标识；步骤12、服务器根据验证请求生成第一私钥和第一公钥，并为第一公钥分配第一标识，将第一标识和第一私钥相对应地存储在第一存储单元，随后将第一标识和第一公钥发送给第一用户；步骤13、第一用户生成验证码，使用接收到的第一公钥加密验证码，并将第一标识和加密后的验证码发送给服务器；步骤14、服务器基于第一标识查找第一存储单元，使用第一私钥解密加密后的验证码，随后将验证码与第一标识相对应地存储在第一存储单元。具体地，步骤3包括：步骤31、第一用户计算第三文件的第一哈希值，使用第一公钥对第一哈希值和验证码进行加密，并将第一哈希值、第三文件、加密后的第一哈希值和验证码、以及第一标识发送给服务器；步骤32、服务器基于第一标识查找第一存储单元，使用第一私钥对加密后的第一哈希值和验证码进行解密，获得解密后的第一哈希值和验证码，当解密后的第一哈希值与接收到的第一哈希值一致，且解密后的验证码与第一存储单元中的验证码一致时，验证通过；步骤33、服务器基于第三文件生成第二标识，并生成第二私钥和第二公钥，随后将第二标识与第二公钥相对应地存储在第二存储单元中；步骤34、服务器使用第二私钥对第一哈希值进行加密，加密完成后将第二私钥删除。具体地，步骤33包括：服务器获取收到第三文件的时间信息，基于时间信息生成随机数，并基于随机数生成第二私钥和第二公钥。具体地，步骤4包括：步骤41、第二用户收到第三文件后，向服务器发送公钥获取请求；步骤42、服务器接收到公钥获取请求后，提取公钥，计算公钥的第三哈希值，并基于公钥生成第一子公钥和第二子公钥；步骤43、通过第一通信路径将第一子公钥和第三哈希值发送给第二用户，通过第二通信路径将第二子公钥发送给第二用户；步骤44、第二用户基于第一子公钥和第二子公钥生成第四公钥，随后计算第四公钥的第四哈希值，若第四哈希值与第三哈希值一致，则第四公钥为第三文件对应的公钥。具体地，步骤42包括：步骤421、服务器根据预设规则将公钥转化为加密公钥，并将加密公钥划分为N个数据块；步骤422、获取第一通信路径和第二通信路径的传输速度，并计算第一通信路径和第二通信路径的传输速度之比A：B，其中，第一通信路径为传输速度快的路径，第二通信路径为传输速度慢的路径；步骤423、按照A：B的比例将N个数据块划分为个数据块和/＞个数据块；步骤424、将个数据块按照第一组合规则组合生成第一子公钥，将个数据块按照第二组合规则组合生成第二子公钥。具体地，步骤41中，第二用户生成第五私钥和第五公钥，并将第五公钥发送给服务器，步骤43中，使用第五公钥分别对预设规则、第一组合规则和第二组合规则进行加密，通过第一通信路径将加密后的预设规则和加密后的第二组合规则发送给第二用户，通过第二通信路径将加密后的第一组合规则发送给第二用户。具体地，步骤44包括：步骤441、基于第一组合规则和第二组合规则将第一子公钥和第二子公钥组合生成加密公钥；步骤442、根据预设规则将加密公钥转化为公钥。具体地，步骤4之后还包括：步骤5、第二用户确认第三文件未被修改后，在第三文件的待签署位置添加第二签名域，生成第四文件，采用SM3算法对第四文件进行摘要运算，生成第四文件的第二摘要值；步骤6、采用SM2算法对第二摘要值进行加密，生成第三文件的第二数字签名值，将SM2数字证书和第二数字签名值添加到第二签名域，得到第五文件；步骤7、计算第五文件的第五哈希值，采用RSA算法对第五哈希值进行加密，随后将第五文件和加密后的第五哈希值发送给第三用户；步骤8、第三用户收到第五文件和加密后的第五哈希值后，使用第二用户的公钥对加密后的第五哈希值进行解密，若能解密，则验证通过，验证通过后，计算第五文件的第六哈希值，若第六哈希值与第五哈希值一致，则第五文件在传输过程中未被修改。第二方面，本发明还提供了一种支持双算法的版式文件签章系统，该系统包括：第一签章模块、第二签章模块和判断模块；第一签章模块，用于第一用户在第一文件的待签署位置添加第一签名域，生成第二文件，采用SM3算法对第二文件进行摘要运算，生成第二文件的第一摘要值；采用SM2算法对第一摘要值进行加密，生成第一文件的第一数字签名值，将SM2数字证书和第一数字签名值添加到第一签名域，得到第三文件；第二签章模块，用于计算第三文件的第一哈希值，采用RSA算法对第一哈希值进行加密，随后将第三文件和加密后的第一哈希值发送给第二用户；判断模块，用于第二用户收到第三文件和加密后的第一哈希值后，使用第一用户的公钥对加密后的第一哈希值进行解密，若能解密，则验证通过，验证通过后，计算第三文件的第二哈希值，若第二哈希值与第一哈希值一致，则第三文件在传输过程中未被修改。与现有技术相比，本发明的有益效果至少如下所述：本发明在对电子文件进行签章时同时采用RSA和SM2两种算法，首先使用国密算法SM2对原文件进行签章，随后将使用SM2算法签章后的文件作为第二原文件，再使用国际算法RSA对第二原文件进行签章，结合SM2算法和RSA算法的优点，提出了一种新的“SM2/RSA”双证书、双算法应用模式，既推广国密算法的应用，同时又兼容国际算法，提高了电子文件签名安全性的同时减少计算量。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据提供的附图获得其他的附图。图1为本发明的一种支持双算法的版式文件签章方法的流程图；图2为本发明的一种支持双算法的版式文件签章系统的结构示意图。具体实施方式为了使本发明的目的、技术方案及优点更加清楚明白，以下结合附图及实施例，对本发明经行进一步的详细说明。显然，此处所描述的具体实施例仅仅用于解释本发明，是本发明的一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域技术普通人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。需要说明，若本发明实施例中有涉及“第一”、“第二”等的描述，则该“第一”、“第二”等的描述仅用于描述目的，而不能理解为指示或暗示其相对重要性或者隐含指明所指示的技术特征的数量。由此，限定有“第一”、“第二”的特征可以明示或者隐含地包括至少一个该特征。另外，各个实施例之间的技术方案可以相互结合，但是必须是以本领域普通技术人员能够实现为基础，当技术方案的结合出现相互矛盾或无法实现时应当认为这种技术方案的结合不存在，也不在本发明要求的保护范围之内。图1所示是本发明提供的一种支持双算法的版式文件签章方法的一个实施例的流程图，该流程图具体包括：步骤1、第一用户在第一文件的待签署位置添加第一签名域，生成第二文件，采用SM3算法对第二文件进行摘要运算，生成第二文件的第一摘要值。步骤2、采用SM2算法对第一摘要值进行加密，生成第一文件的第一数字签名值，将SM2数字证书和第一数字签名值添加到第一签名域，得到第三文件。采用SM2算法第一文件进行签章。其中，采用SM2算法对第一摘要值进行加密生成第一数字签名值后，将该第一数字签名值转换成pkcs#7格式，并将SM2数字证书的格式转换成x.509数字证书的格式，随后将x.509数字证书和pkcs#7格式的第一数字签名值一并添加至上述第一签名域中以完成电子签章，得到第三文件。步骤3、计算第三文件的第一哈希值，采用RSA算法对第一哈希值进行加密，随后将第三文件和加密后的第一哈希值发送给第二用户。进行签名时，首先使用国密算法SM2对原文件进行签章，得到第三文件，然后计算第三文件的第一哈希值，采用RSA算法对第一哈希值进行加密即是对上述第三文件进行签名。基于此，通过SM2算法和RSA算法对同一文件进行签名，实现了双重加密，提高了签名的安全性。具体地，步骤1之前，包括如下步骤：步骤11、第一用户向服务器发送验证请求，验证请求包括第一用户标识。步骤12、服务器根据验证请求生成第一私钥和第一公钥，并为第一公钥分配第一标识，将第一标识和第一私钥相对应地存储在第一存储单元，随后将第一标识和第一公钥发送给第一用户。步骤13、第一用户生成验证码，使用接收到的第一公钥加密验证码，并将第一标识和加密后的验证码发送给服务器。步骤14、服务器基于第一标识查找第一存储单元，使用第一私钥解密加密后的验证码，随后将验证码与第一标识相对应地存储在第一存储单元。第一用户申请对第一文件进行签章之前，先向服务器进行认证，认证通过后，服务器为第一用户分配对传输数据进行加密的第一公钥和第一私钥。接收到服务器发送的第一公钥和第一私钥后，第一用户输入进行签名认证的验证码，使用第一公钥对上述验证码进行加密后发送给服务器，服务器将上述验证码与第一私钥相对应地进行存储。通过加密的方式将验证码发送到服务器并存储，可以避免该验证码被人恶意修改。后续第一用户请求服务器对电子文件进行签名时，通过验证码对用户进行验证，提高了签名的安全性，示例性地，防止用户的签名密钥丢失的情况下，其他人员盗用用户身份对电子文件进行签名。具体地，步骤3包括：步骤31、第一用户计算第三文件的第一哈希值，使用第一公钥对第一哈希值和验证码进行加密，并将第一哈希值、第三文件、加密后的第一哈希值和验证码、以及第一标识发送给服务器。步骤32、服务器基于第一标识查找第一存储单元，使用第一私钥对加密后的第一哈希值和验证码进行解密，获得解密后的第一哈希值和验证码，当解密后的第一哈希值与接收到的第一哈希值一致，且解密后的验证码与第一存储单元中的验证码一致时，验证通过。步骤33、服务器基于第三文件生成第二标识，并生成第二私钥和第二公钥，随后将第二标识与第二公钥相对应地存储在第二存储单元中。步骤34、服务器使用第二私钥对第一哈希值进行加密，加密完成后将第二私钥删除。第一用户对第三文件进行签名时，分别使用第一公钥对第三文件的第一哈希值和上述验证码进行加密，并将加密后的第一哈希值和加密后的验证码发送给服务器，当解密获得的第一哈希值和验证码与直接接收到的第一哈希值和验证码均一致时，才执行签名操作。同时对第一哈希值和验证码进行验证，可以避免他人盗用第一用户的签名信息，也可以避免传输过程中待签名的第一哈希值被篡改后，服务器对错误的哈希值进行签名。对第三文件签名完成后删除用于签名的第二私钥，可以避免私钥被盗用，伪造电子签名。签名完成后，只用使用公钥对签名进行验证，因此，删除私钥不会对签名造成影响，且还可以减少存储空间。具体地，步骤33包括：服务器获取收到第三文件的时间信息，基于时间信息生成随机数，并基于随机数生成第二私钥和第二公钥。随机数的位数，可以根据本领域技术人员的经验或根据实际应用场景进行设置，本申请实施例对此并不限定。随机数具有不规律性，基于随机数生成第二私钥和第二公钥，可以避免私钥被再造或窃取。时间具有不可再现性，基于时间信息生成随机数，进一步保障了签名私钥的安全性，避免他人伪造电子签名。步骤4、第二用户收到第三文件和加密后的第一哈希值后，使用第一用户的公钥对加密后的第一哈希值进行解密，若能解密，则验证通过，验证通过后，计算第三文件的第二哈希值，若第二哈希值与第一哈希值一致，则第三文件在传输过程中未被修改。第二用户使用第一用户的公钥对加密后的第一哈希值进行解密，若能解密，说明接收到的第三文件是上述第一用户发送的；随后，计算接收到的第三文件的第二哈希值，用第二哈希值跟解密得到的第一哈希值进行比较，若一致，则说明第三文件在传输过程中没有被修改。具体地，步骤4包括：步骤41、第二用户收到第三文件后，向服务器发送公钥获取请求。步骤42、服务器接收到公钥获取请求后，提取公钥，计算公钥的第三哈希值，并基于公钥生成第一子公钥和第二子公钥。步骤43、通过第一通信路径将第一子公钥和第三哈希值发送给第二用户，通过第二通信路径将第二子公钥发送给第二用户。步骤44、第二用户基于第一子公钥和第二子公钥生成第四公钥，随后计算第四公钥的第四哈希值，若第四哈希值与第三哈希值一致，则第四公钥为第三文件对应的公钥。通过两条通信路径发送验证签名的公钥，即便一条通信路径上的数据被截取，也不可能恢复出验证签名的公钥，减少公钥被篡改的可能性。同时，基于上述第三哈希值对公钥进行验证，避免收到错误的公钥，对签名验证做出错误的判断。具体地，步骤42包括：步骤421、服务器根据预设规则将公钥转化为加密公钥，并将加密公钥划分为N个数据块；步骤422、获取第一通信路径和第二通信路径的传输速度，并计算第一通信路径和第二通信路径的传输速度之比A：B，其中，第一通信路径为传输速度快的路径，第二通信路径为传输速度慢的路径；步骤423、按照A：B的比例将N个数据块划分为个数据块和/＞个数据块；步骤424、将个数据块按照第一组合规则组合生成第一子公钥，将个数据块按照第二组合规则组合生成第二子公钥。数字N的大小，可以根据本领域技术人员的经验或根据实际应用场景进行设置，本申请实施例对此并不限定。服务器将公钥发送给第二用户之前，为了对公钥进行保护，先根据预设规则对公钥进行变形，将公钥转化为加密公钥，示例性地，公钥为ABCD，按照预设规则将公钥转化为abcd。对公钥进行变形后，将变形后的加密公钥划分为N个不同的数据块。再根据将要传输公钥的两条通信线路的传输速度，将上述N个不同的数据块划分为两部分。根据通信线路的传输速度划分要传输的数据块，可以使传输速度高的通信线路传输多的数据块，使传输速度低的通信线路传输少的数据块，在保障通过两条线路传输数据块保障数据安全的同时，减少传输时间，提高传输效率。随后根据第一组合规则将个数据块组合生成第一子公钥，将/＞个数据块组合生成第二子公钥。具体地，步骤41中，第二用户生成第五私钥和第五公钥，并将第五公钥发送给服务器，步骤43中，使用第五公钥分别对预设规则、第一组合规则和第二组合规则进行加密，通过第一通信路径将加密后的预设规则和加密后的第二组合规则发送给第二用户，通过第二通信路径将加密后的第一组合规则发送给第二用户。分别将第一子公钥与第一组合规则、第二子公钥与第二组合规则通过不同的通信路径传输，只有同时截获两条通信路径上的数据才有还原验证签名的公钥的可能，提高了数据传输的安全性。进一步地，无法还原公钥，就无法破解私钥，也保证了签名的安全性，避免签名被伪造。具体地，步骤44包括：步骤441、基于第一组合规则和第二组合规则将第一子公钥和第二子公钥组合生成加密公钥；步骤442、根据预设规则将加密公钥转化为公钥。具体地，步骤4之后还包括：步骤5、第二用户确认第三文件未被修改后，在第三文件的待签署位置添加第二签名域，生成第四文件，采用SM3算法对第四文件进行摘要运算，生成第四文件的第二摘要值；步骤6、采用SM2算法对第二摘要值进行加密，生成第三文件的第二数字签名值，将SM2数字证书和第二数字签名值添加到第二签名域，得到第五文件；步骤7、计算第五文件的第五哈希值，采用RSA算法对第五哈希值进行加密，随后将第五文件和加密后的第五哈希值发送给第三用户；步骤8、第三用户收到第五文件和加密后的第五哈希值后，使用第二用户的公钥对加密后的第五哈希值进行解密，若能解密，则验证通过，验证通过后，计算第五文件的第六哈希值，若第六哈希值与第五哈希值一致，则第五文件在传输过程中未被修改。同时使用SM2算法和RSA算法进行签名，如果存在多个用户对同一份文件进行签名时，均可按照先使用国密算法SM2对文件进行签章，随后将使用SM2算法签章后的文件作为第二文件，再使用国际算法RSA对第二文件进行签章。优选地，为了避免有用户没有对签名文件进行验证，后续用户对文件签名进行验证时，可以按倒序依次验证同一文件上所有的电子印章。图2所示是本发明提供的一种支持双算法的版式文件签章系统的一个实施例的结构示意图。如图2所示，该系统包括：第一签章模块100、第二签章模块200和判断模块300。第一签章模块100，用于第一用户在第一文件的待签署位置添加第一签名域，生成第二文件，采用SM3算法对第二文件进行摘要运算，生成第二文件的第一摘要值；采用SM2算法对第一摘要值进行加密，生成第一文件的第一数字签名值，将SM2数字证书和第一数字签名值添加到第一签名域，得到第三文件。第二签章模块200，用于计算第三文件的第一哈希值，采用RSA算法对第一哈希值进行加密，随后将第三文件和加密后的第一哈希值发送给第二用户。判断模块300，用于第二用户收到第三文件和加密后的第一哈希值后，使用第一用户的公钥对加密后的第一哈希值进行解密，若能解密，则验证通过，验证通过后，计算第三文件的第二哈希值，若第二哈希值与第一哈希值一致，则第三文件在传输过程中未被修改。应该理解的是，虽然本发明各实施例的流程图中的各个步骤按照箭头的指示依次显示，但是这些步骤并不是必然按照箭头指示的顺序依次执行。除非本文中有明确的说明，这些步骤的执行并没有严格的顺序限制，这些步骤可以以其它的顺序执行。而且，各实施例中的至少一部分步骤可以包括多个子步骤或者多个阶段，这些子步骤或者阶段并不必然是在同一时刻执行完成，而是可以在不同的时刻执行，这些子步骤或者阶段的执行顺序也不必然是依次进行，而是可以与其它步骤或者其它步骤的子步骤或者阶段的至少一部分轮流或者交替地执行。本领域普通技术人员可以理解实现上述实施例方法中的全部或部分流程，是可以通过计算机程序来指令相关的硬件来完成，上述的程序可存储于一个非易失性计算机可读取存储介质中，该程序在执行时，可包括如上述各方法的实施例的流程。其中，本申请所提供的各实施例中所使用的对存储器、存储、数据库或其它介质的任何引用，均可包括非易失性和/或易失性存储器。非易失性存储器可包括只读存储器、可编程ROM、电可编程ROM、电可擦除可编程ROM或闪存。易失性存储器可包括随机存取存储器或者外部高速缓冲存储器。作为说明而非局限，RAM以多种形式可得，诸如静态RAM、动态RAM、同步DRAM、双数据率SDRAM、增强型SDRAM、同步链路DRAM、存储器总线直接RAM、直接存储器总线动态RAM、以及存储器总线动态RAM等。以上上述的实施例仅表达了本发明的实施优选方式，其描述较为具体和详细，但并不能因此而理解为对本发明专利范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本发明构思的前提下，还可以做出若干变形和改进，这些都属于本发明的保护范围。因此，本发明专利的保护范围应以所附权利要求为准。
