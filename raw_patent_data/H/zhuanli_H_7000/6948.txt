标题title
一种面向Tor匿名网络的流关联方法与系统
摘要abst
本发明公开了一种面向Tor匿名网络的流关联方法与系统，方法包括：获取Tor匿名网络中指定中继节点上的流量，初步识别入口流量还是出口流量；对入口和出口流量按照五元组分流；分别提取入口和出口流量的包间延时特征和包大小特征；对两类特征进行短时傅里叶变换和主成分分析法降维，得到包间延时和包大小的主成分时频矩阵，对降维后的特征进行融合重构；将融合的特征向量输入卷积神经网络提取深层次的特征，并由卷积神经网络后的全连接网络完成Tor匿名网络流量关联。本发明通过Tor匿名网络的包间延时和包大小两类特征，可以快速精准地完成Tor匿名流量关联，从而发现利用身份匿名和隐藏服务来躲避网络追踪关联的恶意网络行为。
权利要求书clms
1.一种面向Tor匿名网络的流关联方法，其特征在于，包括以下步骤：获取Tor匿名网络中指定中继节点上的流量，初步识别入口流量还是出口流量，所述入口流量是指进入Tor网络的流量，所述出口流量是指离开Tor网络的流量；对入口流量和出口流量按照五元组形式划分网络流并分别保存为FI和FJ，所述五元组是指：源IP地址、目的IP地址、源端口、目的端口和协议类型，具有相同五元组的流量被认为是同一条流量；分别提取按照五元组划分后的入口流量FI的包间延时特征TI和包大小特征SI，以及按照五元组划分后的出口流量FJ的包间延时特征TJ和包大小特征SJ；对包间延时特征TI、TJ和包大小特征SI、SJ进行短时傅里叶变换，提取时频特征，利用主成分分析法对变换所得的时频矩阵进行降维处理，得到入口流量的包间延时时频特征主要成分矩阵Pti和包大小时频特征主要成分矩阵Psi、以及出口流量的包间延时时频特征主要成分矩阵Ptj和包大小时频特征主要成分矩阵Psj，进行融合重构得到流量特征Fi,j=；将重构的特征向量Fi,j输入卷积神经网络提取深层次的特征，将深层次特征输入全连接网络完成Tor匿名网络的出入口流量的关联。2.根据权利要求1所述的方法，其特征在于，初步识别入口流量还是出口流量包括：根据所获取的经过指定中继节点的流量的大小、IP地址、协议和端口中的一项或多项信息确定是入口流量还是出口流量。3.根据权利要求1所述的方法，其特征在于，提取包间延时特征、包大小特征包括：使用特征提取工具提取数据包到达时间和数据包大小，将这两种信息进行记录，通过计算两个相邻数据包达到时间的间隔得出包间延时特征。4.根据权利要求1所述的方法，其特征在于，对包间延时特征TI、TJ和包大小特征SI、SJ进行短时傅里叶变换，提取时频特征包括：以T表示包间延时特征TI、TJ中的任一个，S表示包大小特征SI、SJ中的任一个，利用指定时间窗口将T和S划分为n个时隙的时域特征：T=，S=，时间窗口随时间滑动，在时间窗口内对每一个时域特征进行傅里叶变换，得到时频矩阵：，，其中，表示包间延时特征的时频矩阵，/＞表示包大小特征的时频矩阵，时频矩阵中的行数表示分帧后信号的时间分辨率，即划分时间窗口的个数n，列数则表示了频域分辨率m。5.根据权利要求4所述的方法，其特征在于，利用主成分分析法对变换后的时频矩阵进行降维处理并重构为流量特征Fi,j包括：计算时频矩阵中每一行元素的均值和方差，基于均值和方差计算标准化值，/＞表示时频矩阵中第i行第k列元素，/＞表示时频矩阵中第i行元素的均值，/＞表示时频矩阵中第i行元素的方差，将时频矩阵转化为数据标准化的矩阵Z；计算数据标准化的矩阵Z的协方差矩阵C，，上标T表示转置，计算协方差矩阵C的特征值/＞和特征向量/＞，选择前k个特征值较大的特征向量作为主成分，前k个特征向量为/＞；基于时频矩阵和特征向量构造主成分矩阵P，/＞；根据上述处理过程分别得到入口流量的包间延时时频特征主要成分矩阵Pti和包大小时频特征主要成分矩阵Psi、以及出口流量的包间延时时频特征主要成分矩阵Ptj和包大小时频特征主要成分矩阵Psj，进行融合重构得到流量特征Fi,j=，Fi,j为卷积神经网络的输入。6.根据权利要求1所述的方法，其特征在于，所述卷积神经网络利用训练集数据经过训练得到，所述训练集数据通过以下方法获取：使用多个Tor客户端对多个网站进行访问，模拟Tor用户使用网络各类行为，产生Tor匿名网络流量，抓取Tor匿名网络入口处和出口处的流量并按照五元组分流，提取Tor网络入口处和出口处流量的包间延时特征和包大小特征；使用重构器将一对关联流对中入口处与随机选取的另一对关联流对中出口处组合形成一对非关联流对，生成一定比例的关联流对与非关联流对，将关联流对和非关联流对混合并附上标签后打乱顺序生成训练用原始数据；对训练用原始数据中的流对的包间延时特征和包大小特征进行短时傅里叶变换，获取时频特征矩阵，利用主成分分析法对变换所得的时频矩阵进行降维处理，得到入口和出口处流量的包间延时时频特征主要成分矩阵和包大小时频特征主要成分矩阵，对降维后的特征即主成分矩阵进行融合重构得到流量特征，作为卷积神经网络模型训练时的输入。7.根据权利要求1所述的方法，其特征在于，卷积神经网络的结构包括：输入层-第一卷积层CONV1-第一池化层POOL1-第二卷积层CONV2-第二池化层POOL2-第三卷积层CONV3；其中第一卷积层用于提取重构的特征向量Fi,j的相邻两行的特征关系，第二卷积层和第三卷积层用于在所有包间延时特征和包大小特征中提取深层次特征，通过第三层卷积后使用Flatten函数将提取的特征转为一维向量输入全连接网络；全连接网络包括三个全连接层，经过三层全连接层后的输出为Pi,j，表示流i和j关联的概率，用于判断两条Tor匿名流量是否为一组关联流对。8.一种面向Tor匿名网络的流关联系统，其特征在于，包括：流量采集模块，用于获取Tor匿名网络中指定中继节点上的流量，初步识别入口流量还是出口流量，所述入口流量是指进入Tor网络的流量，所述出口流量是指离开Tor网络的流量；分流模块，用于对入口流量和出口流量按照五元组形式划分网络流并分别保存为FI和FJ，所述五元组是指：源IP地址、目的IP地址、源端口、目的端口和协议类型，具有相同五元组的流量被认为是同一条流量；特征提取模块，用于分别提取按照五元组划分后的入口流量FI的包间延时特征TI和包大小特征SI，以及按照五元组划分后的出口流量FJ的包间延时特征TJ和包大小特征SJ；特征重构模块，用于对包间延时特征TI、TJ和包大小特征SI、SJ进行短时傅里叶变换，提取时频特征，利用主成分分析法对变换所得的时频矩阵进行降维处理，得到入口流量的包间延时时频特征主要成分矩阵Pti和包大小时频特征主要成分矩阵Psi、以及出口流量的包间延时时频特征主要成分矩阵Ptj和包大小时频特征主要成分矩阵Psj，进行融合重构得到流量特征Fi,j=；关联分析模块，将重构的特征向量Fi,j输入卷积神经网络提取深层次的特征，将深层次特征输入全连接网络完成Tor匿名网络的出入口流量的关联。9.一种计算机设备，其特征在于，包括：一个或多个处理器；存储器；以及一个或多个程序，其中所述一个或多个程序被存储在所述存储器中，并且被配置为由所述一个或多个处理器执行，所述程序被处理器执行时实现如权利要求1-7中任一项所述的面向Tor匿名网络的流关联方法的步骤。10.一种计算机可读存储介质，其上存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现如权利要求1-7中任一项所述的面向Tor匿名网络的流关联方法的步骤。
说明书desc
技术领域本发明涉及计算机网络安全技术领域，具体涉及一种面向Tor匿名网络的流关联方法与系统。背景技术近年来，随着匿名网络技术的逐渐普及，更多的网络用户可以使用匿名网络来保护个人通信隐私。匿名通信技术通过隐藏通信过程中通信双方的身份信息，或者隐藏通信双方的联系，从而有效地实现了对通信实体身份信息的保护。Tor作为全球范围使用最广泛的匿名系统，日均用户超过200万。它通过洋葱路由对流量进行混淆以提供匿名性。传统的网络追踪技术，如链路测试方法等由于算法复杂性、无法获取匿名网络拓扑、需要大量数据包构建路径等难题无法应用于匿名网络的流量关联。目前网络流量关联技术主要可分为两种，主动流水印技术和被动流量分析技术。流水印技术通过在匿名网络入口处改变经过被溯源端网络流的某些特征，使之隐蔽地携带特殊标记信息，即流水印。经过网络传输后，匿名网络出口处捕获的网络流中能够提取出水印信息或符合预期规律的数据包时序特征，从而识别出网络主体间的通信关系。随着对主动网络流水印的研究不断发展，水印方法也呈现多样性，这导致关于流水印的研究也随之增加，主动流水印方法的隐蔽性大幅度降低。被动流量分析技术则是通过部署在网络关键节点上的网络流量采集器捕获流量，直接分析和比较网络流流量中的特征，来对流量进行关联。相比主动流水印技术，被动网络流量分析的流关联方法由于不对网络流施加任何干预，具有极强的隐蔽性。但由于需要采集大量的网络流量加以分析，所以该方法需要巨大的存储空间来保存网络流的特征信息。因此，存在对面向Tor匿名网络的流量关联技术进一步改进的需要。发明内容发明目的：本发明的目的是提供一种面向Tor匿名网络的流关联方法与系统，属于被动流量关联技术，针对目前匿名网络中使用最广泛和用户量最大的Tor网络，较好地解决背景技术中的问题。技术方案：第一方面，本发明提供一种面向Tor匿名网络的流关联方法，包括以下步骤：获取Tor匿名网络中指定中继节点上的流量，初步识别入口流量还是出口流量，所述入口流量是指进入Tor网络的流量，所述出口流量是指离开Tor网络的流量；对入口流量和出口流量按照五元组形式划分网络流并分别保存为FI和FJ，所述五元组是指：源IP地址、目的IP地址、源端口、目的端口和协议类型，具有相同五元组的流量被认为是同一条流量；分别提取按照五元组划分后的入口流量FI的包间延时特征TI和包大小特征SI，以及按照五元组划分后的出口流量FJ的包间延时特征TJ和包大小特征SJ；对包间延时特征TI、TJ和包大小特征SI、SJ进行短时傅里叶变换，提取时频特征，利用主成分分析法对变换所得的时频矩阵进行降维处理，得到入口流量的包间延时时频特征主要成分矩阵Pti和包大小时频特征主要成分矩阵Psi、以及出口流量的包间延时时频特征主要成分矩阵Ptj和包大小时频特征主要成分矩阵Psj，进行融合重构得到流量特征Fi,j=；将重构的特征向量Fi,j输入卷积神经网络提取深层次的特征，将深层次特征输入全连接网络完成Tor匿名网络的出入口流量的关联。于第一方面的某些实施方式中，初步识别入口流量还是出口流量包括：根据所获取的经过指定中继节点的流量的大小、IP地址、协议和端口中的一项或多项信息确定是入口流量还是出口流量。于第一方面的某些实施方式中，提取包间延时特征、包大小特征包括：使用特征提取工具提取数据包到达时间和数据包大小，将这两种信息进行记录，通过计算两个相邻数据包达到时间的间隔得出包间延时特征。于第一方面的某些实施方式中，对包间延时特征TI、TJ和包大小特征SI、SJ进行短时傅里叶变换，提取时频特征包括：以T表示包间延时特征TI、TJ中的任一个，S表示包大小特征SI、SJ中的任一个，利用指定时间窗口将T和S划分为n个时隙的时域特征：T=，S=，时间窗口随时间滑动，在时间窗口内对每一个时域特征进行傅里叶变换，得到时频矩阵：，，其中，表示包间延时特征的时频矩阵，/＞表示包大小特征的时频矩阵，时频矩阵中的行数表示分帧后信号的时间分辨率，即划分时间窗口的个数n，列数则表示了频域分辨率m。于第一方面的某些实施方式中，利用主成分分析法对变换后的时频矩阵进行降维处理并重构为流量特征Fi,j包括：计算时频矩阵中每一行元素的均值和方差，基于均值和方差计算标准化值，/＞表示时频矩阵中第i行第k列元素，/＞表示时频矩阵中第i行元素的均值，/＞表示时频矩阵中第i行元素的方差，将时频矩阵转化为数据标准化的矩阵Z；计算数据标准化的矩阵Z的协方差矩阵C，，上标T表示转置，计算协方差矩阵C的特征值/＞和特征向量/＞，选择前k个特征值较大的特征向量作为主成分，前k个特征向量为/＞；基于时频矩阵和特征向量构造主成分矩阵P，/＞；根据上述处理过程分别得到入口流量的包间延时时频特征主要成分矩阵Pti和包大小时频特征主要成分矩阵Psi、以及出口流量的包间延时时频特征主要成分矩阵Ptj和包大小时频特征主要成分矩阵Psj，进行融合重构得到流量特征Fi,j=，Fi,j为卷积神经网络的输入。于第一方面的某些实施方式中，所述卷积神经网络利用训练集数据经过训练得到，所述训练集数据通过以下方法获取：使用多个Tor客户端对多个网站进行访问，模拟Tor用户使用网络各类行为，产生Tor匿名网络流量，抓取Tor匿名网络入口处和出口处的流量并按照五元组分流，提取Tor网络入口处和出口处流量的包间延时特征和包大小特征；使用重构器将一对关联流对中入口处与随机选取的另一对关联流对中出口处组合形成一对非关联流对，生成一定比例的关联流对与非关联流对，将关联流对和非关联流对混合并附上标签后打乱顺序生成训练用原始数据；对训练用原始数据中的流对的包间延时特征和包大小特征进行短时傅里叶变换，获取时频特征矩阵，利用主成分分析法对变换所得的时频矩阵进行降维处理，得到入口和出口处流量的包间延时时频特征主要成分矩阵和包大小时频特征主要成分矩阵，对降维后的特征即主成分矩阵进行融合重构得到流量特征，作为卷积神经网络模型训练时的输入。于第一方面的某些实施方式中，输入层-第一卷积层CONV1-第一池化层POOL1-第二卷积层CONV2-第二池化层POOL2-第三卷积层CONV3；其中第一卷积层用于提取重构的特征向量Fi,j的相邻两行的特征关系，第二卷积层和第三卷积层用于在所有包间延时特征和包大小特征中提取深层次特征，通过第三层卷积后使用Flatten函数将提取的特征转为一维向量输入全连接网络；全连接网络包括三个全连接层，经过三层全连接层后的输出为Pi,j，表示流i和j关联的概率，用于判断两条Tor匿名流量是否为一组关联流对。本发明的第二方面提供一种面向Tor匿名网络的流关联系统，包括：流量采集模块，用于获取Tor匿名网络中指定中继节点上的流量，初步识别入口流量还是出口流量，所述入口流量是指进入Tor网络的流量，所述出口流量是指离开Tor网络的流量；分流模块，用于对入口流量和出口流量按照五元组形式划分网络流并分别保存为FI和FJ，所述五元组是指：源IP地址、目的IP地址、源端口、目的端口和协议类型，具有相同五元组的流量被认为是同一条流量；特征提取模块，用于分别提取按照五元组划分后的入口流量FI的包间延时特征TI和包大小特征SI，以及按照五元组划分后的出口流量FJ的包间延时特征TJ和包大小特征SJ；特征重构模块，用于对包间延时特征TI、TJ和包大小特征SI、SJ进行短时傅里叶变换，提取时频特征，利用主成分分析法对变换所得的时频矩阵进行降维处理，得到入口流量的包间延时时频特征主要成分矩阵Pti和包大小时频特征主要成分矩阵Psi、以及出口流量的包间延时时频特征主要成分矩阵Ptj和包大小时频特征主要成分矩阵Psj，进行融合重构得到流量特征Fi,j=；关联分析模块，将重构的特征向量Fi,j输入卷积神经网络提取深层次的特征，将深层次特征输入全连接网络完成Tor匿名网络的出入口流量的关联。本发明的第三方面提供一种计算机设备，包括：一个或多个处理器；存储器；以及一个或多个程序，其中所述一个或多个程序被存储在所述存储器中，并且被配置为由所述一个或多个处理器执行，所述程序被处理器执行时实现如本发明第一方面项所述的面向Tor匿名网络的流关联方法的步骤。本发明的第四方面提供一种计算机可读存储介质，其上存储有计算机程序，所述计算机程序被处理器执行时实现如本发明第一方面所述的面向Tor匿名网络的流关联方法的步骤。有益效果：本发明通过采集Tor匿名网络中继节点上入口和出口处流量并分流；提取进入Tor网络流量和离开Tor网络流量的包间延时特征和包大小特征；对提取的包间延时特征和包大小特征进行短时傅里叶变换和主成分分析法降维，得到Tor的包间间隔和包大小的主成分时频矩阵，对降维后的特征进行融合重构；将融合的特征向量输入卷积神经网络提取深层次的特征，并由卷积神经网络后的全连接网络完成Tor匿名网络流量关联。本发明可以快速精准地关联Tor匿名网络中继节点上入口和出口流量，从而发现利用身份匿名和隐藏服务来躲避网络追踪关联的恶意网络行为。附图说明图1为本发明的面向Tor匿名网络的流关联方法的流程图；图2为本发明在应用阶段的采集Tor匿名网络中继节点入口和出口流量示意图；图3为本发明在训练阶段的采集Tor匿名网络入口和出口流量的示意图；图4为本发明采用的卷积神经网络结构示意图；图5为本发明流关联效果示意图。具体实施方式下面将结合附图对本发明实施例中的技术方案进行清楚、完整的描述。参照图1，本发明提供的一种面向Tor匿名网络的流关联方法，包括以下步骤：步骤1：部署流量采集器，采集中继节点处Tor匿名网络流量。捕获Tor匿名网络流量可以通过在Tor网络中设置一个或多个中继节点来实现，例如，可以在Tor网络中设置一个中继节点，捕获通过该节点的所有数据。所述的中继节点是指在Tor网络中充当传输数据的中转站的设备，可以是普通的计算机，也可以是路由器或服务器。流量采集器用于监控和捕获网络流量，以便分析和记录传输的数据。在Tor网络中，如果一个流量采集器能够截获中继节点上的数据流量，就能对其进行解密和分析，同时可以将设置的中继节点贡献出去，使其成为公共节点。为了确保中继节点不会被滥用，还需要加强节点的安全性和防护能力，并定期监视节点的运行状态和流量。若一旦发现节点被滥用，则可以通过流关联进行追踪。根据本发明实施方式，参照图2，在Tor匿名网络的Tor路由中间节点入口处与出口处部署流量采集器，抓取Tor匿名网络中经过该中间节点的流量，并保存为pacp文件。对于捕获的流量，根据流量的大小、IP地址、协议和端口中的一项或多项信息来初步区分该流量是进入Tor匿名网络的入口流还是离开Tor匿名网络的出口流。根据IP地址的方式：对于入口流，源IP地址将是Tor网络的外部IP地址，而目标IP地址将是Tor网络内部的IP地址。对于出口流，源IP地址将是Tor网络内部的IP地址，而目标IP地址将是Tor网络外部的IP地址。在Tor网络中，通常使用的是“虚拟IP地址”，也称为“.onion地址”，这些地址是在Tor网络内部生成的，只能在Tor网络内部进行访问。因此，可以通过判断数据包的目的地址是否为.onion地址来判断是否为Tor网络内部流量。对于外部流量，可以通过判断数据包的目的地址是否为已知的公共IP地址范围来确定。另外，由于Tor网络在连接外部时会使用中继节点，因此外部流量的源地址和目的地址通常会发生变化，可以通过判断数据包中的中继节点信息来确定是否为外部流量。根据流量大小的方式：对于入口流，能够看到大量的流量从Tor网络的外部IP地址发送到Tor网络的内部IP地址。对于出口流，能够看到大量的流量从Tor网络的内部IP地址发送到Tor网络的外部IP地址。根据协议和端口的方式：对于入口流，能够看到大量的TCP或UDP流量进入Tor网络的目标端口。对于出口流，能够看到大量的TCP或UDP流量从Tor网络的源端口离开。不同的方法有不同的适用性。例如，使用IP地址可以很好地区分入口流和出口流，但是如果攻击者使用的是虚假IP地址进行欺骗，则无法准确识别。流量和协议/端口可能会受到不同的攻击和伪装，从而使分析不可靠。因此，为了更准确地确定入口流和出口流，通常需要同时使用多个方法进行分析。如果排除刻意的攻击干扰，只在公共中继节点上对流量进行分析，大部分的流量都能够通过上述的几种方法进行区分。步骤2：使用分流器，对中继节点处采集到的Tor流量数据包按照五元组分流。采集的流量一般为pcap形式，经过步骤1可以初步区分入口流量或出口流量，将入口流量按照五元组形式划分为网络流并保存为FI，将出口流量按照五元组形式划分为网络流并保存为FJ。五元组是指：源IP地址、目的IP地址、源端口、目的端口和协议类型。具有相同五元组的网络流被认定是同一条流量，因此将步骤1中抓取的入口和出口流量分别分流为FI和FJ，将处理后的数据包重新打包并写入pcap文件。因为在Tor中继节点上采集到的其实是大量的流量数据包，这些数据包只有头部信息是未加密的，而有效载荷部分是加密的。此外又因为这些数据包的是多条流混杂在一起的，难以进行流关联分析，所以要针对这些数据包进行分流操作。如果数据包属于同一条流，就会具备相同的源IP地址、目的IP地址、源端口、目的端口和协议类型这五个元素的信息。这些信息包含在数据包的IP和TCP/UDP首部中。pcap格式中的数据包通常包含了数据包的五元组信息，对应的部分如下：源IP地址和目的IP地址：在IP数据包的IP首部中，包括了源IP地址和目的IP地址两个字段，每个字段占用4个字节，共计8个字节。源端口号和目的端口号：在TCP或UDP数据包的TCP或UDP首部中，分别包括了源端口号和目的端口号两个字段。对于TCP首部来说，源端口号和目的端口号各占用2个字节，共计4个字节；对于UDP首部来说，源端口号和目的端口号各占用2个字节，共计4个字节。协议类型：在IP数据包的IP首部中，有一个协议类型字段，该字段指明了该IP数据包中所封装的上层协议类型。如果该IP数据包中封装了TCP协议，协议类型字段就是6；如果该IP数据包中封装了UDP协议，协议类型字段就是17。步骤3：使用特征采集器，分别提取入口流量FI和出口流量FJ的包间延时特征T和包大小特征S。为了给用户提供低延迟匿名通信服务，Tor中继节点会避免混淆数据包定时等传输特性以便增加连接速度。因此通过比较Tor连接的出口和入口段的相关特性能够获得较好的关联效果。分组大小可以表示数据传输量的大小，本发明中分组大小也称为包大小。一般来说，大的数据包通常表示大的数据传输量，因此在一些攻击或者恶意行为中，攻击者或病毒可能会发送大的数据包来加大网络的负荷，使网络资源得不到合理利用。包间间隔则可以表示流量的时间特征。正常的流量通常具有一定的周期性和规律性，通常会有一定的包间隔时间分布。而对于一些攻击和恶意行为，其流量可能会缺乏这种规律性和周期性，包间时间会呈现出不同的分布特征。因此，包大小和包间隔是匿名流量特征分析中重要的两个特征，可以帮助识别流量中的攻击和异常行为。本发明中包间间隔也称为包间延时，包间隔也称为包延时。这里的包指流量数据包，在传输层。在步骤3中使用特征提取工具可以提取数据包到达时间和数据包大小，将这两种信息进行记录。包间隔通过计算两个相邻数据包达到时间的间隔得出。根据本发明的实施方式，对于入口流量FI和出口流量FJ，用特征提取工具CICFlowMeter提取FI和FJ的包间延时T和包大小特征S。CIC FlowMeter是一种用于流量测量和分析工具，它可以对pacp文件进行特征提取和分析。使用该工具对步骤2中分流后的pacp文件进行特征提取，生成相应的csv特征文件。在csv文件中选取数据包到达时间和数据包大小特征数据。包间间隔通过计算两个相邻数据包达到时间的间隔得出。同时，指定每条流中包数量为L，对少于L个包的数据流进行补零操作，对超过L个包的数据流进行截断处理。最终，获取Tor网络入口流量FI的包间延时特征TI和包大小特征SI，以及Tor网络出口流量FJ的包间延时特征TJ和包大小特征SJ。步骤4：使用时频变换器对采集的包间间隔特征和包大小特征经行时频变换，从时间和频率角度同时分析信号的频率和振幅特性，然后采用主成分分析法对时频特征降维，最后使用重构器生成卷积神经网络的输入特征。由于Tor匿名网络在传输的过程中会通过报文重组、随机错位等方法破坏入口流和出口流的报文一对一映射关系，同时使用不同的加密和混淆技术使转发的数据包难以识别和拦截，这都会使捕获的包间间隔和包大小特征时间序列有较低的鲁棒性。对包间间隔和包大小特征时间序列升维到时频域有助于提取更强的综合特性。时频分析是针对非平稳信号的一种信号分析方法。采用时频变换的研究方法可以将被严重扰动的时间序列映射到时频域，能够更好地描述和提取时序信号的特征，适合分析复杂信号在时频域中的特征。本发明采用线性时频变换中常用的短时傅里叶变换对提取的时间序列特征升维。在信号处理中，短时傅里叶变换能够将时域和频域相联系，将输入的非平稳信号分成一系列小时间段也称为分析窗，并假定非平稳信号在分析窗内是平稳的，在分析窗进行傅里叶变换，然后将不同分析窗的傅里叶变换进行加权求和，最终得到整个非平稳信号的傅里叶变换。短时傅里叶变换的公式如下：，式中：为输入原始信号，/＞为分析窗函数，/＞是频率，/＞表示被窗函数截取的原始信号。短时傅里叶变换的实质是套用了窗函数的傅里叶变换，对q累加求和表示对起始时间到终止时间内的所有时间窗口内的傅里叶变换求和，获得非平稳信号的时频特性，它将信号的时域和频域联系起来。本发明中的表示Tor匿名流量的时序特征，对网络流的时序特征做短时傅里叶变换，选取时间窗口的大小，依次对不同时间窗口内的时序信号做傅里叶变换，然后窗口随时间滑动，完成整个时序信号的短时傅里叶变换。为了描述的便利，下面以T表示包间延时特征TI或TJ中的任一项，以S表示包大小特征SI或SJ中的任一项，将包间延时特征序列T和包大小特征序列S划分为n个时隙，作为Tor匿名网络流的时域特征，如下表示：T=，S=，由于在步骤3中指定了一条流中数据包特征值的个数为L，所以每个时隙包含个数据包特征值。对时域特征进行短时傅里叶变换，得到包间隔和包大小特征的时频矩阵，如下表示：，，时频矩阵中的行数表示分帧后信号的时间分辨率即划分时间窗口的个数n，列数则表示了频域分辨率m。为包间隔的特征的时频矩阵，其中矩阵的第一行为划分时隙后时域特征/＞的短时傅里叶变换；最后一行/＞为划分时隙后时域特征/＞的短时傅里叶变换。/＞同理。在进行STFT时，使用窗函数来将时间序列T1划分为N个窗口，窗函数的长度为W。短时傅里叶变换的输出长度m取决于时间窗口长度W和时间序列的长度/＞，即。每个元素则给出了在特定时间和频率上的信号强度或相位信息。通过这两个特征矩阵可以直观地展示采集的Tor匿名网络流量包间间隔和包大小在不同时间和频率上的特征。使用短时傅里叶变换得到了Tor匿名网络流量的时频特性，但也极大地增加了数据量和计算复杂度，给分类器中的卷积神经网络带来了更大的计算开销。因此需要在保留尽可能多的时频特性的前提下对时频矩阵进行降维处理。本发明使用主成分分析法对时频矩阵降维。主要成分分析法可以在保持尽可能多的频谱信息的同时，削减数据的冗余信息。下面以包间间隔时频矩阵为例，给出使用PCA对时频矩阵降维的操作步骤：数据标准化：，使用Z-score标准化将原始数据映射到一个均值为0，标准差为1的正态分布中，从而使所有数据的分布都趋近于正态分布。结果如下公式所示：，其中：，0＜i＜n；0＜k＜m；；0＜i＜n；；0＜i＜n。计算协方差矩阵：PCA需要计算数据的协方差矩阵C，该矩阵描述了数据之间的相关性。，得到的协方差矩阵C为m乘m的方阵。计算特征值和特征向量：计算协方差矩阵C的特征值和特征向量。将原始数据投影到主要特征上可实现数据的降维。其中，计算协方差矩阵C的特征值为，特征向量/＞。选择主成分：根据方差贡献率决定应该选择多少主成分来降低数据维度。对求得的特征值按照大小排序，选择前k个特征值较大的特征向量作为主成分，可以最大程度地保留原始数据中的信息。或者，也可以通过计算每个主成分方差贡献率来衡量其所占比例，以确定保留多少个主成分。前k个特征向量组成的矩阵为。数据降维：将包间间隔原始时频矩阵用特征向量V'构造主成分矩阵P，构造方法如下：，。上述步骤-的降维方法是结合捕获的包间间隔序列描述的，得到包间间隔时频特征主要成分矩阵Pt，该矩阵Pt包括入口处流量得到的包间间隔时频特征主要成分矩阵Pti和出口处流量得到的包间间隔时频特征主要成分矩阵Ptj。采用同样的方法对包大小时间序列分别通过短时傅里叶变换提取时频特征，然后经过主要成分分析法降维压缩数据得到包大小时频特征主要成分矩阵Ps，该矩阵Ps包括入口处流量得到的包大小时频特征主要成分矩阵Psi和出口处流量得到的包大小时频特征主要成分矩阵Psj。将主成分矩阵Pt和Ps行拼接完成对捕获的Tor匿名网络流的描述，如下所示：Fi=，Fj=，其中，i，j表示Tor匿名网络的两条流，Fi和Fj分别作为Tor匿名网络入口流和出口流的综合特征。最后使用重构器生成流量特征作为关联分析器的输入特征Fi,j：Fi,j=。步骤5：利用卷积神经网络提取深层次的特征，将深层次特征输入全连接网络，完成Tor匿名网络中继节点上的流量关联。卷积神经网络是一种多层的监督学习神经网络，卷积层和池化层是特征提取的核心部分。通过采用梯度下降算法最小化损失函数对网络中的权重参数逐层反向调节，通过频繁的迭代训练提高网络的精度。为了让关联分析模型中的卷积神经网络能够获得更全面的特征，需要先构建训练数据集对网络进行训练。如图3所示，训练阶段在Tor匿名网络入口处与出口处部署流量采集器，使用多个Tor客户端对Alexa网站排名在前10000的网站进行访问，模拟Tor用户使用网络各类行为，产生Tor匿名网络流量。使用Wireshark抓取Tor匿名网络入口处和出口处的流量并按照五元组分流，提取Tor网络入口处和出口处流量的包间延时特征和包大小特征。使用重构器将一对关联流对中入口处与随机选取的另一对关联流对中出口处组合形成一对非关联流对。通过这种组合形成非关联流对，关联流对与非关联流对的比例为1：99。即，在训练数据集中i，j是关联流对的概率为1%。将关联的Tor匿名流量对和非关联的Tor匿名流量对混合并附上标签后打乱顺序生成训练用原始数据。对训练用原始数据中的流对的包间延时特征和包大小特征进行短时傅里叶变换，获取时频特征矩阵，利用主成分分析法对变换所得的时频矩阵进行降维处理，得到入口和出口处流量的包间延时时频特征主要成分矩阵和包大小时频特征主要成分矩阵，对降维后的特征即主成分矩阵进行融合重构得到流量特征，作为Tor匿名网络流量关联模型训练时的输入。如图4所示，本发明搭建的卷积神经网络模型结构是：输入层-第一卷积层CONV1-第一池化层POOL1-第二卷积层CONV2-第二池化层POOL2-第三卷积层CONV3 -第一全连接层FC1-第二全连接层FC2-第三全连接层FC3；具体地，第一卷积层CONV1有1000个尺寸为2*40的卷积核，滑动步长为2*2，旨在发现输入流对Fi,j的相邻两行的特征关系，即Tor网络入口处和出口处的特征关系，即Pti与Ptj，Psi与Psj之间的关系；第二卷积层CONV2有800个尺寸为2*10的卷积核，滑动步长为1*2；第三卷积层CONV3有500个尺寸为1*5的卷积核，滑动步长为1*2，第二卷积层和第三卷积层的作用是在所有包间间隔特征和包大小特征中提取深层次特征。在深度学习中，深层次特征是指对原始输入数据进行多层非线性变换得到的高层次的特征表示。在卷积神经网络中，卷积层通过卷积运算提取原始数据的局部特征，而池化层则通过降采样操作保留重要的特征信息，并减少参数数量和计算量。第二卷积层和第三卷积层通常具有更多的卷积核和更深的层次结构，因此可以提取更高层次、更抽象的特征表示。在网络训练过程中，这些深层次特征可以通过反向传播算法进行优化，从而提高网络的分类性能和泛化能力。第三卷积层的输出使用Flatten函数压平并馈送到一个由三层组成的全连接网络。本发明中在每一层卷积后使用最大池化来确保排列不变性，并避免过拟合。第一全连接层FC1神经元个数为1000，第二全连接层FC2的神经元为100，FC3的输出为输入匿名网络流i，j匹配的概率Pi,j，本发明中，当Pi,j的值大于0.9，认定入口流和出口流是一组关联流，实现Tor匿名网络流匹配关联。基于和方法实施例同样的技术构思，本发明还提供一种面向Tor匿名网络的流关联系统，包括：流量采集模块，用于获取Tor匿名网络中指定中继节点上的流量，初步识别入口流量还是出口流量，所述入口流量是指进入Tor网络的流量，所述出口流量是指离开Tor网络的流量；分流模块，用于对入口流量和出口流量按照五元组形式划分网络流并分别保存为FI和FJ，所述五元组是指：源IP地址、目的IP地址、源端口、目的端口和协议类型，具有相同五元组的流量被认为是同一条流量；特征提取模块，用于分别提取按照五元组划分后的入口流量FI的包间延时特征TI和包大小特征SI，以及按照五元组划分后的出口流量FJ的包间延时特征TJ和包大小特征SJ；特征重构模块，用于对包间延时特征TI、TJ和包大小特征SI、SJ进行短时傅里叶变换，提取时频特征，利用主成分分析法对变换所得的时频矩阵进行降维处理，得到入口流量的包间延时时频特征主要成分矩阵Pti和包大小时频特征主要成分矩阵Psi、以及出口流量的包间延时时频特征主要成分矩阵Ptj和包大小时频特征主要成分矩阵Psj，进行融合重构得到流量特征Fi,j=；关联分析模块，将重构的特征向量Fi,j输入卷积神经网络提取深层次的特征，将深层次特征输入全连接网络完成Tor匿名网络的出入口流量的关联。应理解，本发明实施例中的面向Tor匿名网络的流关联系统可以实现上述方法实施例中的全部技术方案，其各个功能模块的功能可以根据上述方法实施例中的方法具体实现，其具体实现过程可参照上述实施例中的相关描述，此处不再赘述。如图5所示，利用本发明的面向Tor匿名网络的流关联方法与系统的最终效果为：输入采集的Tor匿名网络入口和出口流量，经过本发明的方法或系统能够实现Tor流量关联。通过关联Tor匿名网络中继节点入口和出口流量，可以提供有关用户流量的信息，这些信息可以用于追踪和监视。本发明还提供一种计算机设备，包括：一个或多个处理器；存储器；以及一个或多个程序，其中所述一个或多个程序被存储在所述存储器中，并且被配置为由所述一个或多个处理器执行，所述程序被处理器执行时实现如上所述的面向Tor匿名网络的流关联方法的步骤。本发明还提供一种计算机可读存储介质，其上存储有计算机程序，所述计算机程序被处理器执行时实现如上所述的面向Tor匿名网络的流关联方法的步骤。本领域内的技术人员应明白，本发明的实施例可提供为方法、系统、或计算机程序产品。因此，本发明可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本发明可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本发明是参照根据本发明实施例的方法、设备、和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。
