标题title
一种PLC设备组网方法
摘要abst
本发明提出的PLC设备组网方案，步骤1：网关启动组网，允许若干子设备申请组网，同时向若干子设备广播网关网络报文；步骤2：子设备上电，接收多个网关网络报文；步骤3：子设备计算出每个网关信号质量，对比出最优信号质量的网关，即调用申请组网接口向对应的选定网关发起请求入网报文；步骤4：对应网关根据请求入网报文，知晓该子设备的入网请求，并且进行确认回复，进行组网。由子设备对多个PLC网络网关信号质量进行评估，只申请加入最优信号质量的网络网关，使其不能随意加入PLC网络网关，整个过程高效、可靠，不需要复杂的组网过程。
权利要求书clms
1.一种PLC设备组网方法，其特征在于，包括以下步骤：步骤1：网关启动组网，允许若干子设备申请组网，同时向若干子设备广播网关网络报文；步骤2：子设备上电，接收多个网关网络报文；步骤3：子设备计算出每个网关信号质量，对比出最优信号质量的网关，即调用申请组网接口向对应的选定网关发起请求入网报文；步骤4：对应网关根据请求入网报文，知晓该子设备的入网请求，并且进行确认回复，进行组网。2.根据权利要求1所述的一种PLC设备组网方法，其特征在于：在步骤2中，网关网络报文包括对应网关的网络标识、信噪比、物理层时钟偏差、接收成功率。3.根据权利要求2所述的一种PLC设备组网方法，其特征在于：在步骤3中，网关信号质量计算公式：x*0.5+*0.3+z*0.2；其中x为信噪比值；y为物理层时钟偏差；z为接收成功率。4.根据权利要求2所述的一种PLC设备组网方法，其特征在于：还包括步骤5：子设备根据回复的结果判断是否入网成功，如果未收到回复或者回复结果为失败，则子设备再次请求入网，直到请求入网成功。5.根据权利要求4所述的一种PLC设备组网方法，其特征在于：还包括步骤6：子设备继续保持接收到网关网络报文解析处理；若是新网关将该网关加入网络标识列表，并更新该网关的信号质量；若是旧网关，则只更新该网关的信号质量。6.根据权利要求5所述的一种PLC设备组网方法，其特征在于：步骤6中子设备若在有效期内一直接收不到已在网络标识列表内的网关，则将该网关从标识列表删除；如果被删除的网关属于最优信号质量的网关，子设备将重新开始新的申请组网。7.根据权利要求6所述的一种PLC设备组网方法，其特征在于：在步骤6中，有效期初始时间为60秒，每次正常接收网关网络报文，则将有效期递增30秒，有效期最大值为300秒。8.根据权利要求1所述的一种PLC设备组网方法，其特征在于：子设备包括PLC开关、PLC插座。
说明书desc
技术领域本发明涉及PLC领域，尤指一种PLC设备组网方法。背景技术PLC技术典型应用中，多个PLC网络的信号同时在电力线中传输，在没有配备电力线信号隔离器或电力线信号隔离器隔离效果不佳的情况下，目前仍未有高效、可靠的设备组网方案。现有的两种组网方案：1、白名单是允许入网设备的MAC地址的集合。网关可以通过白名单，对请求入网的设备，进行管理认证。不同的通信网络可以有不同的白名单。网关收到设备的请求入网，将请求入网站点的MAC地址与网关本地存储的白名单表进行比对，当请求入网的设备的MAC地址在网关白名单内时，网关允许该设备加入网络；当请求入网的设备的MAC地址不在白名单内时，网关拒绝该设备加入。缺点：操作繁琐：网关需要启动白名单功能，需要配置白名单表项，设备数量多的时候，缺点更明显。2.底层自动组网的方式，指的其实是网关禁用白名单功能，不对请求入网的设备，进行管理认证。网关收到设备的请求入网，网关即允许该设备加入网络。缺点：设备无法准确入网到信号最好的网络里去。一般入网网络比较随机，理论上是入网到先发现的网络里去且该网关禁用了白名单功能。发明内容为解决上述问题，本发明提供一种PLC设备组网方法，高效、可靠，提升PLC设备组网的效率和可靠性。为实现上述目的，本发明采用的技术方案是：一种PLC设备组网方法，包括以下步骤：步骤1：网关启动组网，允许若干子设备申请组网，同时向若干子设备广播网关网络报文；步骤2：子设备上电，接收多个网关网络报文；步骤3：子设备计算出每个网关信号质量，对比出最优信号质量的网关，即调用申请组网接口向对应的选定网关发起请求入网报文；步骤4：对应网关根据请求入网报文，知晓该子设备的入网请求，并且进行确认回复，进行组网。作为进一步说明，在步骤2中，网关网络报文包括对应网关的网络标识、信噪比、物理层时钟偏差、接收成功率。作为进一步说明，在步骤3中，网关信号质量计算公式：x*0.5+*0.3+z*0.2；其中x为信噪比值；y为物理层时钟偏差；z为接收成功率。作为进一步说明，还包括步骤5：子设备根据回复的结果判断是否入网成功，如果未收到回复或者回复结果为失败，则子设备可以，再次请求入网，直到请求入网成功。作为进一步说明，：还包括步骤6：子设备继续保持接收到网关网络报文解析处理；若是新网关将该网关加入网络标识列表，并更新该网关的信号质量；若是旧网关，则只更新该网关的信号质量。作为进一步说明，步骤6中子设备若在有效期内一直接收不到已在网络标识列表内的网关，则将该网关从标识列表删除；如果被删除的网关属于最优信号质量的网关，子设备将重新开始新的申请组网。作为进一步说明，在步骤6中，有效期初始时间为60秒，每次正常接收网关网络报文，则将有效期递增30秒，有效期最大值为300秒。作为进一步说明，在步骤3中，子设备上电后经过50秒信号处理稳定时间，接着调用申请组网接口加入最优信号质量的PLC网络。作为进一步说明，子设备包括PLC开关、PLC插座。本发明的有益效果在于：本发明提出的PLC设备组网方案，由子设备对多个PLC网络网关信号质量进行评估，只申请加入最优信号质量的网络网关，使其不能随意加入PLC网络网关，整个过程高效、可靠，不需要复杂的组网过程。附图说明图1 是PLC设备组网方法中涉及各个模块的原理图。图2 是PLC设备组网方法中的组网逻辑图。具体实施方式请参阅图1-2所示，本发明关于一种PLC设备组网方法，包括以下步骤：步骤1：网关启动组网，允许若干子设备申请组网，同时向若干子设备广播网关网络报文；步骤2：子设备上电，接收多个网关网络报文；步骤3：子设备计算出每个网关信号质量，对比出最优信号质量的网关，即调用申请组网接口向对应的选定网关发起请求入网报文；步骤4：对应网关根据请求入网报文，知晓该子设备的入网请求，并且进行确认回复，进行组网。本发明提出的PLC设备组网方案，由子设备对多个PLC网络网关信号质量进行评估，只申请加入最优信号质量的网络网关，使其不能随意加入PLC网络网关，整个过程高效、可靠，不需要复杂的组网过程。上述提到的网关、子设备都是指具备PLC通信能力的设备；参与组网的设备包括网关和子设备；每个PLC网络都有一个唯一的网络标识，网络标识由网关维护，子设备通过网络标识号可以调用申请组网接口，申请加入指定网关网络；PLC网络的网关会向网络内广播网关网络报文，子设备可以根据接收到的网关网络报文解析并计算获得网络标识、信噪比、时钟偏差和接收成功率等必要信息；在组网前先完成PLC设备安装，并确认各个设备工作正常后，然后启动组网流程；作为进一步说明，在步骤2中，网关网络报文包括对应网关的网络标识、信噪比、物理层时钟偏差、接收成功率。作为进一步说明，在步骤3中，网关信号质量计算公式：x*0.5+*0.3+z*0.2；其中x为信噪比值；y为物理层时钟偏差；z为接收成功率。作为进一步说明，还包括步骤5：子设备根据回复的结果判断是否入网成功，如果未收到回复或者回复结果为失败，则子设备再次请求入网，直到请求入网成功。作为进一步说明，还包括步骤6：子设备继续保持接收到网关网络报文解析处理；若是新网关将该网关加入网络标识列表，并更新该网关的信号质量；若是旧网关，则只更新该网关的信号质量。作为进一步说明，步骤6中子设备若在有效期内一直接收不到已在网络标识列表内的网关，则将该网关从标识列表删除；如果被删除的网关属于最优信号质量的网关，子设备将重新开始新的申请组网。作为进一步说明，在步骤6中，有效期初始时间为60秒，每次正常接收网关网络报文，则将有效期递增30秒，有效期最大值为300秒。作为进一步说明，在步骤3中，子设备上电后经过50秒信号处理稳定时间，接着调用申请组网接口加入最优信号质量的PLC网络。以上实施方式仅仅是对本发明的优选实施方式进行描述，并非对本发明的范围进行限定，在不脱离本发明设计精神的前提下，本领域普通工程技术人员对本发明的技术方案作出的各种变形和改进，均应落入本发明的权利要求书确定的保护范围内。
