标题title
一种基于MQTT协议的车辆OTA任务调度方法
摘要abst
本申请公开了一种基于MQTT协议的车辆OTA任务调度方法，属于车云通信技术领域，应用于车辆OTA任务调度系统，包括任务管理微服务模块、前端web页面、内存型数据库和关系型数据库；车辆OTA任务调度方法包括：通过前端web页面创建OTA任务，包括基本信息和关联信息；将关联信息缓存至内存型数据库，并将基本信息保存至关系型数据库；基于MQTT协议向各车辆发送OTA任务通知信息；判断是否有车辆基于OTA任务通知信息对OTA任务进行查询；若是，将OTA任务与相应车辆的关联关系插入至关系型数据库中，将基本信息和关联关系聚合得到与相应车辆对应的OTA任务信息并返回至相应车辆。适用于车辆调度领域。
权利要求书clms
1.一种基于MQTT协议的车辆OTA任务调度方法，其特征在于，应用于车辆OTA任务调度系统，所述车辆OTA任务调度系统包括任务管理微服务模块、以及分别与所述任务管理微服务模块连接的前端web页面、内存型数据库和关系型数据库；所述车辆OTA任务调度方法包括：通过所述前端web页面创建OTA任务，所述OTA任务包括基本信息和关联信息，其中，所述关联信息包括OTA任务与各车辆的关联关系；通过所述任务管理微服务模块将所述关联信息缓存至所述内存型数据库，并将所述基本信息保存至所述关系型数据库；根据所述关联信息，通过所述任务管理微服务模块基于MQTT协议向各车辆发送OTA任务通知信息；通过所述任务管理微服务模块判断是否有车辆基于OTA任务通知信息对所述OTA任务进行查询；若是，通过所述任务管理微服务模块将所述OTA任务与相应车辆的关联关系插入至所述关系型数据库中，将所述基本信息和所述关联关系聚合得到与相应车辆对应的OTA任务信息并返回至相应车辆。2.如权利要求1所述的车辆OTA任务调度方法，其特征在于，所述车辆OTA任务调度系统还包括：与所述任务管理微服务模块连接的MQTT服务器；所述通过所述任务管理微服务模块基于MQTT协议向各车辆发送OTA任务通知信息包括：根据所述关联信息，将OTA任务通知信息通过MQTT协议发送到MQTT服务器；通过所述MQTT服务器向各车辆发送OTA任务通知信息。3.如权利要求1所述的车辆OTA任务调度方法，其特征在于，所述车辆OTA任务调度系统还包括：与所述任务管理微服务模块连接的云端网关；所述通过所述任务管理微服务模块判断是否有车辆基于OTA任务通知信息对所述OTA任务进行查询包括：判断是否有车辆在收到OTA任务通知信息后访问云端网关，通过云端网关对所述任务管理微服务模块进行访问并对所述OTA任务进行查询。4.如权利要求3所述的车辆OTA任务调度方法，其特征在于，所述车辆OTA任务调度方法还包括：通过所述任务管理微服务模块判断是否有车辆定时轮询云端网关；若是，在所述车辆每次访问云端网关时，通过所述任务管理微服务模块查询所述内存型数据库中是否存在与所述车辆对应的OTA任务，并根据查询得到的结果返回相应信息至所述车辆，其中，返回的相应信息为与所述车辆对应的OTA任务信息或空任务信息。5.如权利要求4所述的车辆OTA任务调度方法，其特征在于，所述根据查询得到的结果返回相应信息至所述车辆包括：当查询得到的结果为所述内存型数据库中存在与所述车辆对应的OTA任务时，将所述OTA任务与所述车辆的关联关系插入至所述关系型数据库中，将所述基本信息和所述关联关系聚合得到与所述车辆对应的OTA任务信息并返回至所述车辆；当查询得到的结果为所述内存型数据库中不存在与所述车辆对应的OTA任务时，返回空任务信息至所述车辆。6.如权利要求1-5任一项所述的车辆OTA任务调度方法，其特征在于，基于Springcloud微服务框架编写任务管理微服务，并将所述任务管理微服务部署到kubernetes集群的容器中，得到所述任务管理微服务模块。7.如权利要求1-5任一项所述的车辆OTA任务调度方法，其特征在于，基于redis得到所述内存型数据库，基于mysql得到所述关系型数据库。8.如权利要求1-5任一项所述的车辆OTA任务调度方法，其特征在于，基于VUE前端框架得到所述前端web页面。9.一种电子设备，包括：存储器、处理器以及存储在所述存储器中并可在所述处理器上运行的计算机程序，其特征在于，所述处理器执行所述计算机程序时实现如权利要求1至8任一项所述方法的步骤。10.一种计算机可读存储介质，所述计算机可读存储介质存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现如权利要求1至8任一项所述方法的步骤。
说明书desc
技术领域本申请涉及一种基于MQTT协议的车辆OTA任务调度方法，属于车云通信技术领域。背景技术在OTA系统中创建车辆的OTA任务时，需要在数据库中插入对应的记录，包括车辆的vin号、车辆的零件信息、任务有效期、软件升级包信息等等。通常每个OTA任务的每辆车都需要插入三条以上的记录，如果这个任务包含了大量车辆，如百万辆级，传统的方法有：1、在创建任务的同时插入数据库数百万条记录，这就会导致数据库的瞬时压力极大，对系统中其他业务造成严重影响，同时超长事务也可能中途失败回滚。2、使用定时任务，在任务的有效期内，平均每天定时生成部分车辆的升级记录，这样的方法虽然减小了数据库的压力，但是造成了有些车辆在接近任务截止日期时才会收到OTA任务的通知，用户体验不好。对于车辆来说，部署一次OTA升级任务只会针对部分车辆进行升级，OTA车辆占车辆整体的一小部分。但是每辆车都会在上电时或定时轮训云端，判断是否存在升级任务，这对于传统升级方法来说，会造成数据库很大的并发压力。发明内容本申请的目的在于提供一种基于MQTT协议的车辆OTA任务调度方法，在减小数据库压力的同时，让车辆能够第一时间内收到OTA任务通知，显著提升OTA任务的效率。为实现上述目的，本申请第一方面提供了一种基于MQTT协议的车辆OTA任务调度方法，应用于车辆OTA任务调度系统，所述车辆OTA任务调度系统包括任务管理微服务模块、以及分别与所述任务管理微服务模块连接的前端web页面、内存型数据库和关系型数据库；所述车辆OTA任务调度方法包括：通过所述前端web页面创建OTA任务，所述OTA任务包括基本信息和关联信息，其中，所述关联信息包括OTA任务与各车辆的关联关系；通过所述任务管理微服务模块将所述关联信息缓存至所述内存型数据库，并将所述基本信息保存至所述关系型数据库；根据所述关联信息，通过所述任务管理微服务模块基于MQTT协议向各车辆发送OTA任务通知信息；通过所述任务管理微服务模块判断是否有车辆基于OTA任务通知信息对所述OTA任务进行查询；若是，通过所述任务管理微服务模块将所述OTA任务与相应车辆的关联关系插入至所述关系型数据库中，将所述基本信息和所述关联关系聚合得到与相应车辆对应的OTA任务信息并返回至相应车辆。在一种实施方式中，所述车辆OTA任务调度系统还包括：与所述任务管理微服务模块连接的MQTT服务器；所述通过所述任务管理微服务模块基于MQTT协议向各车辆发送OTA任务通知信息包括：根据所述关联信息，将OTA任务通知信息通过MQTT协议发送到MQTT服务器；通过所述MQTT服务器向各车辆发送OTA任务通知信息。在一种实施方式中，所述车辆OTA任务调度系统还包括：与所述任务管理微服务模块连接的云端网关；所述通过所述任务管理微服务模块判断是否有车辆基于OTA任务通知信息对所述OTA任务进行查询包括：判断是否有车辆在收到OTA任务通知信息后访问云端网关，通过云端网关对所述任务管理微服务模块进行访问并对所述OTA任务进行查询。在一种实施方式中，所述车辆OTA任务调度方法还包括：通过所述任务管理微服务模块判断是否有车辆定时轮询云端网关；若是，在所述车辆每次访问云端网关时，通过所述任务管理微服务模块查询所述内存型数据库中是否存在与所述车辆对应的OTA任务，并根据查询得到的结果返回相应信息至所述车辆，其中，返回的相应信息为与所述车辆对应的OTA任务信息或空任务信息。在一种实施方式中，所述根据查询得到的结果返回相应信息至所述车辆包括：当查询得到的结果为所述内存型数据库中存在与所述车辆对应的OTA任务时，将所述OTA任务与所述车辆的关联关系插入至所述关系型数据库中，将所述基本信息和所述关联关系聚合得到与所述车辆对应的OTA任务信息并返回至所述车辆；当查询得到的结果为所述内存型数据库中不存在与所述车辆对应的OTA任务时，返回空任务信息至所述车辆。在一种实施方式中，基于Springcloud微服务框架编写任务管理微服务，并将所述任务管理微服务部署到kubernetes集群的容器中，得到所述任务管理微服务模块。在一种实施方式中，基于redis得到所述内存型数据库，基于mysql得到所述关系型数据库。在一种实施方式中，基于VUE前端框架得到所述前端web页面。本申请第二方面提供了一种电子设备，包括：存储器、处理器以及存储在存储器中并可在处理器上运行的计算机程序，该处理器执行计算机程序时实现上述第一方面或者上述第一方面的任一实施方式中的步骤。本申请第三方面提供了一种计算机可读存储介质，上述计算机可读存储介质存储有计算机程序，上述计算机程序被处理器执行时实现上述第一方面或者上述第一方面的任一实施方式中的步骤。由上可见，本申请提供了一种基于MQTT协议的车辆OTA任务调度方法，适用于包含大量车辆的OTA任务的通知和调度，通过使用内存型数据库对车辆信息进行缓存，能够让大多数的车辆请求在缓存中获取到任务信息，避免了访问关系型数据库的步骤，极大的减小了关系型数据库的压力；同时，使用懒加载的方式，即只有当车辆访问任务管理微服务模块时，才会将内存型数据库中的缓存的相应信息初始化到关系型数据库中，避免了一次性创建大量的记录到关系型数据库，将关系型数据库的瞬时压力分摊到各个请求中去，通过该种方式，即使一个任务中的车辆数量达到百万数量级，数据库的最大压力也只是取决于车辆的同时在线数，而同时在线数远远低于OTA任务中的车辆，这样就能实现数据库并发压力很小。同时也能解决定时任务这种方式的问题，即车辆能够即时得到OTA任务的通知并实时获取OTA任务，而不必等待任务有效期的后期才能获取到OTA任务的通知，避免了周期性的调度任务。在车辆调度领域具有现实意义和良好的应用前景。附图说明为了更清楚地说明本申请实施例中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本申请的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本申请实施例提供的一种整体流程图；图2为本申请实施例提供的一种OTA任务调度的整体时序图。具体实施方式以下描述中，为了说明而不是为了限定，提出了诸如特定系统结构、技术之类的具体细节，以便透彻理解本申请实施例。然而，本领域的技术人员应当清楚，在没有这些具体细节的其他实施例中也可以实现本申请。在其它情况下，省略对众所周知的系统、装置、电路以及方法的详细说明，以免不必要的细节妨碍本申请的描述。应当理解，当在本说明书和所附权利要求书中使用时，术语“包括”指示所描述特征、整体、步骤、操作、元素和/或组件的存在，但并不排除一个或多个其它特征、整体、步骤、操作、元素、组件和/或其集合的存在或添加。还应当理解，在本申请说明书中所使用的术语仅仅是出于描述特定实施例的目的而并不意在限制本申请。如在本申请说明书和所附权利要求书中所使用的那样，除非上下文清楚地指明其它情况，否则单数形式的“一”、“一个”及“该”意在包括复数形式。下面结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本申请的一部分实施例，而不是全部的实施例。基于本申请中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其它实施例，都属于本申请保护的范围。在下面的描述中阐述了很多具体细节以便于充分理解本申请，但是本申请还可以采用其它不同于在此描述的其它方式来实施，本领域技术人员可以在不违背本申请内涵的情况下做类似推广，因此本申请不受下面公开的具体实施例的限制。实施例一本申请实施例提供了一种基于MQTT协议的车辆OTA任务调度方法，应用于车辆OTA任务调度系统，所述车辆OTA任务调度系统包括任务管理微服务模块、以及分别与所述任务管理微服务模块连接的前端web页面、内存型数据库和关系型数据库；在一种实施方式中，可采用Springcloud微服务框架编写任务管理微服务，并将该任务管理微服务部署到kubernetes集群的容器中，得到所述任务管理微服务模块。进一步的，可基于redis得到所述内存型数据库，采用mysql得到所述关系型数据库，基于VUE前端框架进行编写并得到所述前端web页面。可选的，所述车辆OTA任务调度系统还包括与所述任务管理微服务模块连接的MQTT服务器，以便任务管理微服务模块向车辆发送信息，该MQTT服务器可采用EMQX服务器。可选的，所述车辆OTA任务调度系统还包括与所述任务管理微服务模块连接的云端网关，以便车辆访问任务管理微服务模块，该云端网关可以为在kubernetes采用ingress应用路由转发网关。如图1和2所示，所述车辆OTA任务调度方法包括：S100通过所述前端web页面创建OTA任务，所述OTA任务包括基本信息和关联信息，其中，所述关联信息包括OTA任务与各车辆的关联关系；在一种应用场景中，OTA管理人员通过前端web页面，创建一个或多个OTA任务并针对每个OTA任务分别输入参数，输入的参数包括相应OTA任务的名称、描述、有效期、车辆vin码、车辆零件信息和软件包升级信息等基本信息、还包括OTA任务与各车辆的关联关系信息，即每个OTA任务所包含的所有车辆的车辆信息。S200通过所述任务管理微服务模块将所述关联信息缓存至所述内存型数据库，并将所述基本信息保存至所述关系型数据库；在一种实施方式中，通过任务管理微服务模块将OTA任务的基本信息保存在mysql中，将关联信息缓存在redis中，其中，关联信息以车辆和任务列表的键值对的格式进行缓存，以任一OTA任务为例，对OTA任务中的每个车辆生成一条键值对并缓存在redis中。S300根据所述关联信息，通过所述任务管理微服务模块基于MQTT协议向各车辆发送OTA任务通知信息；可选的，所述通过所述任务管理微服务模块基于MQTT协议向各车辆发送OTA任务通知信息包括：根据所述关联信息，将OTA任务通知信息通过MQTT协议发送到MQTT服务器；通过所述MQTT服务器向各车辆发送OTA任务通知信息。在一种实施方式中，根据所述关联信息得到任务中包含的所有车辆的车辆信息，根据各车辆信息给对应车辆的MQTT服务器的主题发送OTA任务通知信息，车辆端可先订阅MQTT服务器的topic以便在车辆开机上电时第一时间接收到所述OTA任务通知信息。其中，该OTA任务通知信息包括与相应车辆对应的简略任务信息、如任务的名称和描述等，此时，OTA任务通知信息的格式可以为”vin”:””,”taskid”:””。S400通过所述任务管理微服务模块判断是否有车辆基于OTA任务通知信息对所述OTA任务进行查询；可选的，所述通过所述任务管理微服务模块判断是否有车辆基于OTA任务通知信息对所述OTA任务进行查询包括：判断是否有车辆在收到OTA任务通知信息后访问云端网关，通过云端网关对所述任务管理微服务模块进行访问并对所述OTA任务进行查询。在一种应用场景中，车辆接收到OTA任务通知信息后，通过HTTP方式访问云端网关，通过云端网关访问所述任务管理微服务模块，以便根据OTA任务通知信息中的任务id查询任务详情。S500若是，通过所述任务管理微服务模块将所述OTA任务与相应车辆的关联关系插入至所述关系型数据库中，将所述基本信息和所述关联关系聚合得到与相应车辆对应的OTA任务信息并返回至相应车辆。在一种应用场景中，所述任务管理微服务模块将redis中任务与相应车辆的关联关系保存至mysql中，再通过查询mysql得到相应车辆与本次OTA任务的车辆零件信息、软件包升级信息等基本信息的关联关系并同样保存在mysql中，通过该种方式得到相应车辆的任务相关记录，将这些任务相关记录聚合得到与相应车辆对应的OTA任务信息后统一返回给相应车辆，以便车辆根据接收的OTA任务信息进行OTA升级。可选的，所述车辆OTA任务调度方法还包括：通过所述任务管理微服务模块判断是否有车辆定时轮询云端网关；若是，在所述车辆每次访问云端网关时，通过所述任务管理微服务模块查询所述内存型数据库中是否存在与所述车辆对应的OTA任务，并根据查询得到的结果返回相应信息至所述车辆，其中，返回的相应信息为与所述车辆对应的OTA任务信息或空任务信息。在其他应用场景中，如图2所示，车辆会定时通过云端网关查询是否有OTA任务，任务管理微服务模块根据该车辆的车辆信息查询redis中是否存在该车辆的OTA任务，此处存在两种情况：当查询得到的结果为redis中存在与所述车辆对应的OTA任务时，任务管理微服务模块生成对应的任务相关记录，进一步聚合得到与所述车辆对应的OTA任务信息并通过云端网关返回至所述车辆；当查询得到的结果为redis中不存在与所述车辆对应的OTA任务时，直接返回空任务信息至所述车辆，不会访问mysql数据库，极大的减小了mysql数据库压力。由上可见，本申请实施例提供了一种基于MQTT协议的车辆OTA任务调度方法，通过使用内存型数据库对车辆信息进行缓存，能够让大多数的车辆请求在缓存中获取到任务信息，避免了访问关系型数据库的步骤，极大的减小了关系型数据库的压力；同时，使用懒加载的方式，即只有当车辆连接云端网关，通过云端网关访问任务管理微服务模块时，才会将内存型数据库中的缓存的相应信息初始化到关系型数据库中，避免了一次性创建大量的记录到关系型数据库，将关系型数据库的瞬时压力分摊到各个请求中去，通过该种方式，即使一个任务中的车辆数量达到百万数量级，数据库的最大压力也只是取决于车辆的同时在线数，而同时在线数远远低于OTA任务中的车辆，这样就能实现数据库并发压力很小。同时也能解决定时任务这种方式的问题，即车辆能够即时得到OTA任务的通知并实时获取OTA任务，而不必等待任务有效期的后期才能获取到OTA任务的通知，避免了周期性的调度任务。实施例二本申请实施例提供了一种电子设备，该电子设备包括存储器、处理器以及存储在上述存储器中并可在上述处理器上运行的计算机程序，其中，存储器用于存储软件程序以及模块，处理器通过运行存储在存储器的软件程序以及模块，从而执行各种功能应用以及数据处理。存储器和处理器通过总线连接。具体地，处理器通过运行存储在存储器的上述计算机程序时实现上述实施例一中的任一步骤。应当理解，在本申请实施例中，所称处理器可以是中央处理单元，该处理器还可以是其他通用处理器、数字信号处理器 、专用集成电路、现成可编程门阵列或者其他可编程逻辑器件、分立门或者晶体管逻辑器件、分立硬件组件等。通用处理器可以是微处理器或者该处理器也可以是任何常规的处理器等。存储器可以包括只读存储器、快闪存储器和随机存储器，并向处理器提供指令和数据。存储器的一部分或全部还可以包括非易失性随机存取存储器。由上可见，本申请实施例提供的电子设备通过运行计算机程序实现如实施例一所述的车辆OTA任务调度方法，在减小数据库压力的同时，让车辆能够第一时间内收到OTA任务通知，显著提升OTA任务的效率。应当理解，上述集成的模块/单元如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读存储介质中。基于这样的理解，本申请实现上述实施例方法中的全部或部分流程，也可以通过计算机程序来指令相关的硬件来完成，上述计算机程序可存储于以计算机可读存储介质中，该计算机程序在被处理器执行时，可实现上述各个方法实施例的步骤。其中，上述计算机程序包括计算机程序代码，上述计算机程序代码可以为源代码形式、对象代码形式、可执行文件或某些中间形式等。上述计算机可读介质可以包括：能够携带上述计算机程序代码的任何实体或装置、记录介质、U盘、移动硬盘、磁碟、光盘、计算机存储器、只读存储器、随机存取存储器、电载波信号、电信信号以及软件分发介质等。需要说明的是，上述计算机可读存储介质包含的内容可以根据司法管辖区内立法和专利实践的要求进行适当的增减。对所公开的实施例的上述说明，使本领域专业技术人员能够实现或使用本申请。对这些实施例的多种修改对本领域的专业技术人员来说将是显而易见的，本文中所定义的一般原理可以在不脱离本申请的精神或范围的情况下，在其它实施例中实现。因此，本申请将不会被限制于本文所示的这些实施例，而是要符合与本文所公开的原理和新颖特点相一致的最宽的范围。所属领域的技术人员可以清楚地了解到，为了描述的方便和简洁，仅以上述各功能单元、模块的划分进行举例说明，实际应用中，可以根据需要而将上述功能分配由不同的功能单元、模块完成，即将上述装置的内部结构划分成不同的功能单元或模块，以完成以上描述的全部或者部分功能。实施例中的各功能单元、模块可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中，上述集成的单元既可以采用硬件的形式实现，也可以采用软件功能单元的形式实现。另外，各功能单元、模块的具体名称也只是为了便于相互区分，并不用于限制本申请的保护范围。上述系统中单元、模块的具体工作过程，可以参考前述方法实施例中的对应过程，在此不再赘述。需要说明的是，上述实施例所提供的方法及其细节举例可结合至实施例提供的装置和设备中，相互参照，不再赘述。本领域普通技术人员可以意识到，结合本文中所公开的实施例描述的各实例的单元及算法步骤，能够以电子硬件、或者计算机软件和电子硬件的结合来实现。这些功能究竟是以硬件还是软件方式来执行，取决于技术方案的特定应用和设计约束条件。专业技术人员可以对每个特定的应用来使用不同的方法来实现所描述的功能，但是这种实现不应认为超出本申请的范围。在本申请所提供的实施例中，应该理解到，所揭露的装置/终端设备和方法，可以通过其他的方式实现。例如，以上所描述的装置/设备实施例仅仅是示意性的，例如，上述模块或单元的划分，仅仅为一种逻辑功能划分，实际实现时可以由另外的划分方式，例如多个单元或组件可以结合或者可以集成到另一个系统，或一些特征可以忽略，或不执行。上述实施例仅用以说明本申请的技术方案，而非对其限制；尽管参照前述实施例对本申请进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本申请各实施例技术方案的精神和范围，均应包含在本申请的保护范围之内。
