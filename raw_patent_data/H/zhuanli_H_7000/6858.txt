标题title
一种自适应车载摄像头驱动方法
摘要abst
本发明公开了一种自适应车载摄像头驱动方法，包括以下步骤：S1，遍历所有的I2C总线，探测各总线上是否存在设备；若存在设备，则对总线上的设备遍历，确认设备的类型；根据设备的类型，获取该设备的参数；根据获取到的设备参数，配置摄像头模组的各个参数；获取摄像头模组接入解串器的信息；根据获取到的链路信息，摄像头驱动程序自动配置摄像头模组与智能辅助驾驶系统之间的连接参数；摄像头驱动程序根据摄像头模组的配置和连接参数，驱动摄像头模组向智能辅助驾驶系统输出图像数据；本方法具有实现摄像头模组的自适应驱动，实现摄像头模组适配的自动化，提高适配效率的特点。
权利要求书clms
1.一种自适应车载摄像头驱动方法，其特征在于，包括以下步骤：S1，遍历所有的I2C总线，探测各总线上是否存在设备；S2，若存在设备，则对总线上的设备遍历，确认设备的类型；S3，根据设备的类型，获取该设备的参数；S4，根据获取到的设备参数，配置摄像头模组的各个参数；S5，获取摄像头模组接入解串器的信息；S6，根据获取到的链路信息，摄像头驱动程序自动配置摄像头模组与智能辅助驾驶系统之间的连接参数；S7，摄像头驱动程序根据摄像头模组的配置和连接参数，驱动摄像头模组向智能辅助驾驶系统输出图像数据。2.根据权利要求1所述的自适应车载摄像头驱动方法，其特征在于：步骤S2中，所述设备的类型包括解串器、串行器和图像传感器；所述步骤S3包括，S301，若设备类型是解串器，则获取解串器的型号、时钟配置、供电配置和I2C配置；S302，若设备类型是串行器，则获取串行器的型号、时钟配置、供电配置和I2C配置；S303，若设备类型是图像传感器，则获取图像传感器的型号、时钟配置、供电配置和I2C配置。3.根据权利要求2所述的自适应车载摄像头驱动方法，其特征在于，设备类型的判断包括步骤：遍历每个设备的特定地址寄存器的值，根据寄存器的值来判断设备类型，以及该设备的参数。4.根据权利要求1所述的自适应车载摄像头驱动方法，其特征在于：所述步骤S4中，配置摄像头模组的各个参数包括图像传感器，串行器和解串器的参数。5.根据权利要求1所述的自适应车载摄像头驱动方法，其特征在于，步骤S5中，获取摄像头模组接入解串器的信息包括获取摄像头模组接入解串器的链路信息、解串器接入智能驾驶辅助系统的输出端口信息和解串器与MIPI-CSI的通道信息。6.根据权利要求5所述的自适应车载摄像头驱动方法，其特征在于，步骤S5中获取摄像头模组接入解串器的信息包括步骤：S501，通过串行器和图像传感器的参数，确认摄像头模组的图像传感器输入到串行器的链路信息，以及串行器的输出端口信息；S502，通过解串器和S501的信息，确定解串器的输入链路信息、解串器接入智能驾驶辅助系统的输出端口信息和解串器与MIPI-CSI的通道信息。7.根据权利要求1所述的自适应车载摄像头驱动方法，其特征在于：步骤S6包括步骤：S601，将摄像头模组的参数信息、解串器的参数信息配置到摄像头驱动程序中，启动摄像头驱动程序。
说明书desc
技术领域本发明涉及新一代信息技术的图像通信领域，特别涉及一种自适应车载摄像头驱动方法。背景技术在智能辅助驾驶车辆中，大量使用带串行器的摄像头来采集图像数据。带串行器的摄像头模组的驱动是智能辅助驾驶中的一个重要的基本功能。在现有的驱动实现中，一般是通过手动设置配置文件的方式来设置摄像头模组中的各个参数，驱动程序使用配置文件中的参数来驱动摄像头工作。这种手动的方式需要了解摄像头模组的硬件细节，智能驾驶系统的硬件细节，再加上配置文件参数众多，整个过程繁琐复杂，低效并且容易出错。导致整个摄像头适配对人员素质要求高，适配周期长。因此，急需提供一种自适应车载摄像头驱动方法以解决上述问题。发明内容为此，需要提供一种可以根据当前摄像头与智能辅助驾驶系统的连接情况，自动识别摄像头、智能驾驶系统的相关参数以及两者连接的参数，实现摄像头模组的自适应驱动，实现摄像头模组适配的自动化，提高适配效率。为实现上述目的，发明人提供了一种自适应车载摄像头驱动方法，包括以下步骤：S1，遍历所有的I2C总线，探测各总线上是否存在设备；S2，若存在设备，则对总线上的设备遍历，确认设备的类型；S3，根据设备的类型，获取该设备的参数；S4，根据获取到的设备参数，配置摄像头模组的各个参数；S5，获取摄像头模组接入解串器的信息；S6，根据获取到的链路信息，摄像头驱动程序自动配置摄像头模组与智能辅助驾驶系统之间的连接参数；S7，摄像头驱动程序根据摄像头模组的配置和连接参数，驱动摄像头模组向智能辅助驾驶系统输出图像数据。作为本发明的一种优选方式，步骤S2中，所述设备的类型包括解串器、串行器和图像传感器；所述步骤S3包括，S301，若设备类型是解串器，则获取解串器的型号、时钟配置、供电配置和I2C配置；S302，若设备类型是串行器，则获取串行器的型号、时钟配置、供电配置和I2C配置；S303，若设备类型是图像传感器，则获取图像传感器的型号、时钟配置、供电配置和I2C配置。作为本发明的一种优选方式，设备类型的判断包括步骤：遍历每个设备的特定地址寄存器的值，根据寄存器的值来判断设备类型，以及该设备的参数。作为本发明的一种优选方式，所述步骤S4中，配置摄像头模组的各个参数包括图像传感器，串行器和解串器的参数。作为本发明的一种优选方式，步骤S5中，获取摄像头模组接入解串器的信息包括获取摄像头模组接入解串器的链路信息、解串器接入智能驾驶辅助系统的输出端口信息和解串器与MIPI-CSI的通道信息。作为本发明的一种优选方式，步骤S5中获取摄像头模组接入解串器的信息包括步骤：S501，通过串行器和图像传感器的参数，确认摄像头模组的图像传感器输入到串行器的链路信息，以及串行器的输出端口信息；S502，通过解串器和S501的信息，确定解串器的输入链路信息、解串器接入智能驾驶辅助系统的输出端口信息和解串器与MIPI-CSI的通道信息；作为本发明的一种优选方式，步骤S6包括步骤：S601，将摄像头模组的参数信息、解串器的参数信息配置到摄像头驱动程序中，启动摄像头驱动程序。区别于现有技术，上述技术方案所达到的有益效果有：本方法通过自动识别摄像头模组，自动获取相关参数信息，自动配置摄像头模组与智能辅助驾驶系统之间的数据流，有效的实现了摄像头模组的自适应驱动，提高了适配效率和适配人员的素质要求，减少了出错率，缩短适了适配周期，降低了适配成本。附图说明图1为具体实施方式所述方法流程图。图2为具体实施方式所述摄像头模组与智能辅助驾驶系统的数据流程图。图3为具体实施方式所述总线上设备识别示意图。具体实施方式为详细说明技术方案的技术内容、构造特征、所实现目的及效果，以下结合具体实施例并配合附图详予说明。本实施例提供了一种自适应车载摄像头驱动方法，在本实施例中，要正确驱动摄像头模组，并且智能辅助系统能正确接收摄像头的内容，需要正确配置以下信息：摄像头的图像传感器型号、传感器的时钟配置、传感器的供电配置、传感器的I2C配置、串行器的型号、串行器的时钟配置、串行器的供电配置、串行器的I2C配置、解串器的型号、解串器的时钟配置、解串器的供电配置、解串器的I2C配置、摄像头接入解串器的链路信息、解串器接入到智能辅助驾驶系统的输出端口信息、解串器与MIPI-CSI的通道信息。采用不同方法，可以分别通过程序来自动获取上述信息。如图1和图2所示，本实施例则通过摄像头驱动程序通过上述参数来驱动摄像头模组。具体过程包括如下步骤：S1，遍历所有的I2C总线，探测各总线上是否存在设备；即摄像头驱动程序首先会对所有I2C总线进行初始化，然后枚举每条总线上的所有设备；摄像头驱动程序是让摄像头模组可以在智能辅助驾驶系统上正常工作的一组标准的程序，以动态链接库的形式存在，在运行的时候，加载到内存中，其主要工作内容是根据硬件的实际配置来设置芯片的寄存器。如图3所示，设备包含了解串器、串行器、图像传感器、以及图像传感器只读存储设备、电源设备等5个，但本在本实施例中只分析处理解串器、串行器和图像传感器这三个，0x28：电源设备的地址；0x29：解串器地址；0x10：图像传感器地址；0x40：串行器地址；0x50：图像传感器的只读存储器地址；S2，若存在设备，则对总线上的设备遍历，确认设备的类型；设备的类型包括解串器、串行器和图像传感器；S3，根据设备的类型，获取该设备的参数；若设备类型是解串器，则获取解串器的型号、时钟配置、供电配置和I2C配置；若设备类型是串行器，则获取串行器的型号、时钟配置、供电配置和I2C配置；若设备类型是图像传感器，则获取图像传感器的型号、时钟配置、供电配置和I2C配置。在本实施例的具体实施过程中，识别设备中的解串器，并解析出该解串器的地址，型号,供电配置等参数信息，是通过遍历每个设备的特定地址寄存器的值，根据寄存器的值来判断是否是解串器，以及解串器的具体型号；识别设备中的串行器，并解析出该串行器的地址，型号,供电配置，时钟配置等参数信息是通过遍历每个设备的特定地址寄存器的值，根据寄存器的值来判断是否是串行器，以及串行器的具体型号。识别设备中的图像传感器，并解析出该传感器的地址，型号,供电配置，时钟配置等参数信息是通过遍历每个设备的特定地址寄存器的值，根据寄存器的值来判断是否是图像传感器，以及传感器的具体型号；S4，根据获取到的设备参数，配置摄像头模组的各个参数；包括图像传感器，串行器和解串器的参数；S5，获取摄像头模组接入解串器的信息；获取摄像头模组接入解串器的信息包括获取摄像头模组接入解串器的链路信息、解串器接入智能驾驶辅助系统的输出端口信息和解串器与MIPI-CSI的通道信息。在本实施例的具体实施过程中，是通过串行器和图像传感器的参数，确认摄像头模组的图像传感器输入到串行器的链路信息，以及串行器的输出端口信息，再结合解串器的信息，确定解串器的输入链路信息、解串器接入智能驾驶辅助系统的输出端口信息和解串器与MIPI-CSI的通道信息；S6，根据获取到的链路信息，将摄像头模组的参数信息、解串器的参数信息配置到摄像头驱动程序中，启动摄像头驱动程序，摄像头驱动程序自动配置摄像头模组与智能辅助驾驶系统之间的连接参数；S7，摄像头驱动程序根据摄像头模组的配置和连接参数，驱动摄像头模组向智能辅助驾驶系统输出图像数据。上述实施例通过自动识别摄像头模组，自动获取相关参数信息，自动配置摄像头模组与智能辅助驾驶系统之间的数据流，有效的实现了摄像头模组的自适应驱动，提高了适配效率和适配人员的素质要求，减少了出错率，缩短适了适配周期，降低了适配成本。需要说明的是，尽管在本文中已经对上述各实施例进行了描述，但并非因此限制本发明的专利保护范围。因此，基于本发明的创新理念，对本文所述实施例进行的变更和修改，或利用本发明说明书及附图内容所作的等效结构或等效流程变换，直接或间接地将以上技术方案运用在其他相关的技术领域，均包括在本发明的专利保护范围之内。
