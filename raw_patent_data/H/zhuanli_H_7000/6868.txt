标题title
一种有线通信系统及其设备ID的配置方法
摘要abst
本发明公开了一种有线通信系统及其设备ID的配置方法，所述有线通信系统包括：一个主设备、多个从设备及多根通信线，其中，所述多根通信线和所述多个从设备，通过各个从设备的各个通信端口并联连接，各个从设备的各个通信端口的连接情况各不相同。利用本发明的有线通信系统，所述设备ID配置方法，包括：配置通信线数与各个从设备的通信端口数相等；各个从设备的各个通信端口与各根通信线的连接情况各不相同；通过各个从设备与各根通信线连接的连接情况，确定各个从设备的ID。通过本发明提供的有线通信系统和设备ID配置方法，不需要额外的硬件开销，在一定程度上提升系统的通信效率，降低硬件成本。
权利要求书clms
1.一种有线通信系统，其特征在于，包括：一个主设备、多个从设备及多根通信线，其中，所述多根通信线和所述多个从设备，通过各个从设备的各个通信端口并联连接，各个从设备的各个通信端口的连接情况各不相同。2.根据权利要求1所述的有线通信系统，其特征在于，根据各个通信端口不同的连接情况，确定各个从设备的ID。3.根据权利要求1所述的有线通信系统，其特征在于，各个从设备的各个通信端口与各根通信线连接，通过排列组合的方式排列成不同的连接情况，确定各个从设备的ID。4.根据权利要求1-3任一所述的有线通信系统，其特征在于，有线通信系统还包括：一根时钟信号线，其中，各个从设备的端口相应增加一个时钟端口，主设备通过时钟信号线与各个从设备并联连接，通过时钟信号线向各个从设备提供时钟信号。5.根据权利要求4所述的有线通信系统，其特征在于，从设备包括第一从设备、第二从设备两个从设备，第一从设备、第二从设备均包括：识别模块、第一端口及第二端口，其中一个为通信端口，另一个为时钟端口，两个从设备的各个端口的信号连接情况不同，通过不同的连接情况，确定第一从设备及第二从设备的ID。6.一种有线通信系统设备ID的配置方法，其特征在于，基于权利要求1-5任一所述的有线通信系统，所述配置方法包括：配置通信线数与各个从设备的通信端口数相等；各个从设备的各个通信端口与各根通信线的连接情况各不相同；通过各个从设备与各根通信线连接的连接情况，确定各个从设备的ID。7.根据权利要求6所述的有线通信系统设备ID的配置方法，其特征在于，在有线通信系统中，从设备的数量与通信线数量满足以下条件：其中，m为通信线的数量，m为正整数。8.根据权利要求7所述的有线通信系统设备ID的配置方法，其特征在于，通过以下公式计算通信线的数量：利用上述公式，基于从设备的数量确定通信线的数量。9.根据权利要求6所述的有线通信系统设备ID的配置方法，其特征在于，在连接关系识别阶段，主设备的各个通信线按顺序在各个时钟周期依次发出脉冲信号，一个脉冲周期只有一根通信线发出脉冲信号，每根通信线只有一个脉冲信号。10.根据权利要求9所述的有线通信系统设备ID的配置方法，其特征在于，根据各个通信端口通过与其连接的每根通信线上收到的脉冲信号的次序，识别连接关系，确定各个从设备的ID。11.根据权利要求6所述的有线通信系统设备ID的配置方法，其特征在于，通过第一、第二从设备的识别模块，判断相应从设备第一、第二端口，与通信线、时钟信号线的信号连接情况；通过各个从设备的信号连接情况，确定各个从设备的ID。12.根据权利要求11所述的有线通信系统设备ID的配置方法，其特征在于，第一、第二从设备的识别模块均根据信号翻转是否规律，判断相应从设备第一、第二端口的信号连接情况。13.根据权利要求12所述的有线通信系统设备ID的配置方法，其特征在于，检测到从设备的端口信号翻转规律变化时，该端口与时钟信号线连接；检测到从设备的端口信号翻转非规律变化时，该端口与通信线连接。14.根据权利要求11所述的有线通信系统设备ID的配置方法，其特征在于，当第一从设备的第一端口与时钟信号线连接，第一从设备的第二端口与通信线连接，则第二从设备的第一端口与通信线连接，第二从设备的第二端口与时钟信号线连接。15.根据权利要求6所述的有线通信系统设备ID的配置方法，其特征在于，在确定各个从设备的ID步骤之后，还包括：主设备按照预定的ID次序依次发送数据包，各个从设备根据自身的ID，在通信线上选取相应位置的数据包。
说明书desc
技术领域本发明涉及有线通信技术领域，具体涉及一种有线通信系统及其设备ID的配置方法。背景技术有线通信通常利用金属导线、光纤等有形媒质传送信息，用光或电信号，来代表声音、文字、图像等信息。根据有线通信双方的对等关系，有线通信可以分为无主从式通信、单主从式通信和多主从式通信三种模式。在一个通信网络中，无主从式通信的各节点不分主设备从设备，每个节点可视需求选择是否发送数据，以提升总线的通信效率，当某一节点发生故障时，不会影响其他节点的工作。单主从式通信是指在一个通信网络中，一个主设备只对应一个从设备，主设备直接将数据传送给从设备。多主从式通信是指一个主设备对应多台从设备，主机发送的信息可传送到多台从设备或指定从设备，而从设备发送的信息只能传送到主设备，且各个从设备之间不能直接通信。在主从式有线通信系统中，整个通信网络的通信数据发送权限由主设备控制，从设备只能被动地接收、执行主设备发来的命令，以及根据主设备的要求回传数据。主设备既可以同时对所有从设备发送数据，也可以对指定的一个或多个从设备进行通信。现有技术中，当主设备需要对指定从设备进行通信时，主设备通常需要事先获悉从设备的ID，通过通信地址的匹配实现对指定从设备发送数据或命令的功能。因此，需要事先为每个从设备分配一个唯一的ID，作为每个从设备的唯一标识，如图1所示的主从式有线通信系统，主设备通过总线连接N个从设备，每个从设备拥有一个独立唯一的ID地址。通信时由主设备发起一次通信，从设备根据通信协议将接收到的数据中的地址字段与本机的设备ID地址进行比较：如果地址匹配，则从设备会接收该次通信的数据，对其进行解析，并执行相应的功能；如果地址不匹配，则从设备不接收数据。此方法需在每一次通信中都配有地址字段，一定程度上限制了系统的通信效率。且该方法下，各个从设备ID通常是需要提前确定的，例如用类似烧录的方式固化在从设备的存储中。除ID寻址外，如图2所示的主从式有线通信系统，是通过硬件方式实现寻址的SPI协议。SPI是一种高速的、全双工同步通信总线。SPI以主从方式工作，通常通信需要4根线，分别为：MISO为主设备数据输入，从设备数据输出；MOSI为主设备数据输出从设备数据输入；SCLK为串行时钟信号，由主机产生发送给从机；CS为片选信号，由主设备发送，以控制与哪个从设备通信。其中，只有片选信号CS为预先规定的使能信号时即高电平或低电平，主设备对此从设备的操作才有效，通过片选信号CS来实现从设备的寻址问题。但该方法存在每个从设备需要一根CS信号线，当从设备数量较多时，会大量占用主设备的端口，增加了主设备的硬件端口开销及硬件的成本，当多根信号线进行通信时，易发生连接错误，存在通信效率低的风险。发明内容因此，本发明提供的一种有线通信系统及其设备ID的配置方法，克服了现有技术中主设备硬件成本大，通信效率低的缺陷。为达到上述目的，本发明提供如下技术方案：第一方面，本发明实施例提供一种有线通信系统，包括：一个主设备、多个从设备及多根通信线，其中，所述多根通信线和所述多个从设备，通过各个从设备的各个通信端口并联连接，各个从设备的各个通信端口的连接情况各不相同。可选地，根据各个通信端口不同的连接情况，确定各个从设备的ID。可选地，各个从设备的各个通信端口与各根通信线连接，通过排列组合的方式排列成不同的连接情况，确定各个从设备的ID。可选地，有线通信系统还包括：一根时钟信号线，其中，各个从设备的端口相应增加一个时钟端口，主设备通过时钟信号线与各个从设备并联连接，通过时钟信号线向各个从设备提供时钟信号。可选地，从设备包括第一从设备、第二从设备两个从设备，第一从设备、第二从设备均包括：识别模块、第一端口及第二端口，其中一个为通信端口，另一个为时钟端口，两个从设备的各个端口的信号连接情况不同，通过不同的连接情况，确定第一从设备及第二从设备的ID。第二方面，本发明实施例提供一种有线通信系统设备ID的配置方法，基于第一方面的有线通信系统，所述配置方法包括：配置通信线数与各个从设备的通信端口数相等；各个从设备的各个通信端口与各根通信线的连接情况各不相同；通过各个从设备与各根通信线连接的连接情况，确定各个从设备的ID。可选地，在有线通信系统中，从设备的数量与通信线数量满足以下条件：其中，m为通信线的数量，m为正整数。可选地，通过以下公式计算通信线的数量：利用上述公式，基于从设备的数量确定通信线的数量。可选地，在连接关系识别阶段，主设备的各个通信线按顺序在各个时钟周期依次发出脉冲信号，一个脉冲周期只有一根通信线发出脉冲信号，每根通信线只有一个脉冲信号。可选地，根据各个通信端口通过与其连接的每根通信线上收到的脉冲信号的次序，识别连接关系，确定各个从设备的ID。可选地，通过第一、第二从设备的识别模块，判断相应从设备第一、第二端口，与通信线、时钟信号线的信号连接情况；通过各个从设备的信号连接情况，确定各个从设备的ID。可选地，第一、第二从设备的识别模块均根据信号翻转是否规律，判断相应从设备第一、第二端口的信号连接情况。可选地，检测到从设备的端口信号翻转规律变化时，该端口与时钟信号线连接；检测到从设备的端口信号翻转非规律变化时，该端口与通信线连接。可选地，当第一从设备的第一端口与时钟信号线连接，第一从设备的第二端口与通信线连接，则第二从设备的第一端口与通信线连接，第二从设备的第二端口与时钟信号线连接。可选地，在确定各个从设备的ID步骤之后，还包括：主设备按照预定的ID次序依次发送数据包，各个从设备根据自身的ID，在通信线上选取相应位置的数据包。本发明技术方案，具有如下优点：1.本发明提供的有线通信系统及其设备ID的配置方法，多根通信线和多个从设备，通过各个从设备的各个通信端口并联连接，各个从设备的各个通信端口的连接情况各不相同，根据各个通信端口不同的连接情况来实现对设备ID的唯一标识，以此来减少硬件端口开销，提高通信效率。2.本发明提供的有线通信系统及其设备ID的配置方法，各个从设备ID不需要提前预定，根据从设备的通信端口与通信线的连接情况，实时确定各个从设备的ID，主设备按照预定的ID次序依次发送数据包，各个从设备根据自身的ID，在通信线上选取相应位置的数据包，以此提升通信效率。附图说明为了更清楚地说明本发明具体实施方式或现有技术中的技术方案，下面将对具体实施方式或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施方式，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为现有技术提供的主从式有线通信系统的一个具体示例的系统框图；图2为现有技术提供的主从式有线通信系统的另一个具体示例的系统框图；图3为本发明实施例提供的一种有线通信系统的一个具体示例的系统框图；图4为本发明实施例提供的一种有线通信系统的另一具体示例的系统框图；图5为本发明实施例提供的一种有线通信系统的又一具体示例的系统框图；图6为本发明实施例提供的一种有线通信系统的又一具体示例的系统框图；图7a为本发明实施例提供的通信系统进入连接关系识别阶段一个具体示例的时序图；图7b为本发明实施例提供的从设备检测进入连接关系识别阶段一个具体示例的时序图；图8为本发明实施例提供的一种有线通信系统设备ID的配置的又一具体示例的系统框图；图9为本发明实施例提供的一种有线通信系统设备ID的配置的又一具体示例的系统框图。具体实施方式下面将结合附图对本发明的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。在本发明的描述中，需要说明的是，术语“中心”、“上”、“下”、“左”、“右”、“竖直”、“水平”、“内”、“外”等指示的方位或位置关系为基于附图所示的方位或位置关系，仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本发明的限制。此外，术语“第一”、“第二”、“第三”仅用于描述目的，而不能理解为指示或暗示相对重要性。在本发明的描述中，需要说明的是，除非另有明确的规定和限定，术语“安装”、“相连”、“连接”应做广义理解，例如，可以是固定连接，也可以是可拆卸连接，或一体地连接；可以是机械连接，也可以是电连接；可以是直接相连，也可以通过中间媒介间接相连，还可以是两个元件内部的连通，可以是无线连接，也可以是有线连接。对于本领域的普通技术人员而言，可以具体情况理解上述术语在本发明中的具体含义。此外，下面所描述的本发明不同实施方式中所涉及的技术特征只要彼此之间未构成冲突就可以相互结合。实施例1本发明实施例提供的一种有线通信系统，如图3所示，包括：一个主设备、多个从设备及多根通信线。其中，多根通信线和多个从设备，通过各个从设备的各个通信端口并联连接，各个从设备的各个通信端口的连接情况各不相同，通过排列组合的方式排列成不同的连接情况，根据各个通信端口不同的连接情况，确定各个从设备的ID，以此来减少硬件端口开销，提高通信效率。基于本实施例的配置系统，配置方法包括：配置通信线数与各个从设备的通信端口数相等，各个从设备的各个通信端口与各根通信线的连接情况各不相同，通过各个从设备与各根通信线连接的连接情况，确定各个从设备的ID。在本发明实施例中，从设备的数量与通信线数量满足以下条件：其中，m为通信线的数量，m为正整数。在本发明实施例中，通过以下公式计算通信线的数量：利用上述公式，基于从设备的数量确定通信线的数量。例如：当从设备的数量为5时，相应的通信线数为3；当从设备的数量为6时，相应的通信线数为3；当从设备的数量为23时，相应的通信线数为4。在实际应用中，根据从设备的实际数量确定通信线的数量，从而确定各个从设备的端口数。在一具体实施例中，如图3所示，主设备有n个端口，各个端口分别连接通信线1、通信线2、、通信线n。各个从设备设置的通信端口数相同，且通信线数与各个从设备的通信端口数相等，因此，从设备的通信端口分别为1、2、/＞、n。在一具体实施例中，如图4所示，主设备通过4根通信线与从设备进行通信，分别为：通信线1、通信线2、通信线3、通信线4。每个从设备都有4个通信端口，记为a、b、c、d。此时，最多可容纳24个从设备。每个从设备通过与4根通信线的不同连接方式进行唯一标识，进而实现寻址。图4所示，从设备1的标志方式为：将从设备1的a、b、c、d四个通信端口，按顺序分别与4根通信线连接，即：a-1、b-2、c-3、d-4，此连接方式作为从设备1的ID标识；从设备2的标识方式为：a-2、b-1、c-3、d-4，以此连接方式作为从设备2的ID标识。设置4根通信线根据不同的排列组合，最多可以标识24个从设备。如下表所示，为24种从设备的标识方式，其中1、2、3、4来表示主设备的4根通信线，a、b、c、d来表示从设备的四个通信端口。从下表可知，通过通信线与从设备通信端口的不同连接方式来标识一定数量内的从设备的ID。本发明实施例提供的有线通信系统及其设备ID的配置方法，多根通信线和多个从设备，通过各个从设备的各个通信端口并联连接，各个从设备的各个通信端口的连接情况各不相同，通过排列组合的方式排列成不同的连接情况，根据各个通信端口不同的连接情况，确定各个从设备的ID。当主设备需要对所有从设备发送不同数据的时候，主设备可以按照预定的ID次序依次发送数据包，各个并接的从设备根据自身的ID，在通信线上取相应位置的数据包即可。与现有技术相比，大大提高通信效率。实施例2本发明实施例提供的一种有线通信系统，如图5所示，基于实施例1提供的有线通信系统，本实施例提供的有线通信设备集群还包括：一根时钟信号线Sys-CLK，其中，各个从设备的端口相应增加一个时钟端口clk，主设备通过时钟信号线与各个从设备并联连接，通过时钟信号线Sys-CLK向各个从设备提供时钟信号clk。时钟信号的引入是为了识别连接关系。基于本实施例的有线通信系统，配置方法包括：在连接关系识别阶段，主设备的各个通信线按顺序在各个时钟周期依次发出脉冲信号，一个脉冲周期只有一根通信线发出脉冲信号，每根通信线只有一个脉冲信号。根据各个通信端口通过与其连接的每根通信线上收到的脉冲信号的次序，识别连接关系，确定各个从设备的ID。根据各个从设备的ID，从而完成有线通信设备ID的配置。在本发明实施例中，根据从设备的通信端口与通信线的连接情况，确定各个从设备的ID。由于每根通信线只有一个脉冲信号，利用每根通信线发生的脉冲信号在连接关系识别阶段的先后次序，确定从设备各个端口与通信线的连接方式，从而识别该从设备的ID，通过各个从设备的ID，完成有线通信设备ID的配置。在一具体实施例中，如图6所示，主设备通过时钟信号线Sys-CLK向各个从设备的时钟端口clk提供时钟信号，从设备通信端口a、b、c、d与通信线1、通信线2、通信线3、通信线4通过排列组合以不同的方式连接，从而标识不同的设备ID。当通信系统进入连接关系识别阶段，主设备连接的各个通信线会在既定的时间依次给出脉冲信号，如图7a所示，在主设备在连接关系识别阶段的第1个时钟周期，控制通信线1对应给出一个脉冲信号，图示为高电平脉冲；通信线2在连接关系识别阶段的第2个时钟周期时对应给出一个脉冲信号，依次类推。当从设备检测到进入连接关系识别阶段时，从设备可根据各个端口接收到脉冲的顺序来判断其通信线的连接关系，并根据其连接关系得到从设备ID，进而实现寻址。如图7b所示，从设备3各个端口连接关系识别过程如下：在连接关系识别阶段：从设备3检测到端口a在第4个时钟周期接收到脉冲信号，判断为：a-4；从设备3检测到端口b在第2个时钟周期接收到脉冲信号，判断为：b-2；从设备3检测到端口c在第3个时钟周期接收到脉冲信号，判断为：c-3；从设备3检测到端口d在第1个时钟周期接收到脉冲信号，判断为：d-1，据此确定图6所示的从设备3的ID，例如查表可知从设备3对应ID22，查表仅是一种确定方式，实际实现可有手段多种。当每台从设备识别了自身的ID后，主设备需要对所有从设备发送不同数据的时候，主设备可以按照既定的ID次序依次发送数据包，各个并接的从设备根据自身的ID，在通信线上取相应位置的数据包即可。与现有技术相比，大大提高通信效率。本发明实施例提供的有线通信系统及其设备ID的配置方法，根据实施例1的有线通信系统及其设备ID的配置方法，在各个从设备的端口相应增加一个时钟端口clk，主设备通过时钟信号线与各个从设备并联连接，通过时钟信号线Sys-CLK向各个从设备提供时钟信号clk，以保证各个从设备得以同步运作，以此来标识各通信线的脉冲位置，使得各个从设备可以通过各端口接收到的脉冲信号的次序来确定每个端口连接的通信线，从而获取端口与通信线的连接关系，以此来确定从设备各自的ID。实施例3本发明实施例提供的一种有线通信系统，如图8所示，基于实施例2提供的有线通信系统，从设备包括第一从设备、第二从设备两个从设备，第一从设备、第二从设备均包括：识别模块、第一端口及第二端口，其中一个为通信端口，另一个为时钟端口，两个从设备的各个端口的信号连接情况不同，通过不同的连接情况，确定第一从设备及第二从设备的ID。在本发明实施例中，通过第一、第二从设备的识别模块，判断相应从设备第一、第二端口，与通信线、时钟信号线的信号连接情况；通过各个从设备的信号连接情况，确定各个从设备的ID。在本发明实施例中，第一、第二从设备的识别模块均根据信号翻转是否规律，判断相应从设备第一、第二端口的信号连接情况。在本发明实施例中，检测到从设备的端口信号翻转规律变化时，该端口与时钟信号线连接；检测到从设备的端口信号翻转非规律变化时，该端口与通信线连接。在本发明实施例中，当第一从设备的第一端口与时钟信号线连接，第一从设备的第二端口与通信线连接，则第二从设备的第一端口与通信线连接，第二从设备的第二端口与时钟信号线连接。在本发明实施例中，在确定各个从设备的ID步骤之后，还包括：主设备按照预定的ID次序依次发送数据包，各个从设备根据自身的ID，在通信线上选取相应位置的数据包。在一具体实施例中，如图9所示，从设备包括：从设备1、从设备2。从设备1、从设备2均包括：识别模块、端口a、端口b。a、b端口中有一个为通信端口，另一个则为时钟端口。两个从设备的各个端口的信号连接情况不同，例如：从设备1的端口a连接时钟信号线Sys-CLK，端口b连接通信线data；从设备2的端口a连接通信线data，端口b连接时钟信号线Sys-CLK。当从设备识别了自身的ID后，主设备需要对所有从设备发送不同数据的时候，主设备可以按照既定的ID次序依次发送数据包，各个并接的从设备根据自身的ID，在通信线上取相应位置的数据包即可。与现有技术相比，大大提高通信效率。在一具体实施例中，如图9所示，端口a与时钟信号Sys-CLK连接、端口b与通信线data连接为ID1；端口a与通信线data连接、端口b与时钟信号Sys-CLK连接为ID2。每个从设备内部都含有识别模块，用来识别a、b端口的信号连接情况，通过识别各端口，与时钟信号线Sys-CLK、通信线Data不同的连接方式，确认其设备ID，从而在数据接收时可根据ID信息获取相应的数据内容。如图9所示，从设备1、从设备2的两种不同连接方式，当从设备进入到连接关系识别阶段时，从设备可根据各端口所接收信号的翻转情况来判断端口与通信线的连接关系。例如：从设备1的端口a与时钟信号线Sys-CLK连接，端口b与通信线Data连接，识别模块在较长的一段时间内，检测两个端口的信号是否规律变化，即是否按照固定的周期有高低电平翻转。如果端口信号规律变化即可知该端口连接的是时钟信号。非规律变化则连接通信线。为了进一步提高检测准确度，还可要求主设备在连接关系识别阶段，通过通信线Data发送特定数据，例如若干连续的“1”或连续的“0”。本发明实施例中提供的有线通信系统及其设备ID的配置方法，仅有时钟信号线Sys-CLK、通信线Data时，从设备添加识别模块，当从设备进入到连接关系识别阶段时，从设备可根据各端口所接收信号的翻转情况来判断端口与通信线的连接关系，确认其设备ID，而不需要额外的硬件开销，在一定程度上提升系统的通信效率，降低了硬件成本。显然，上述实施例仅仅是为清楚地说明所作的举例，而并非对实施方式的限定。对于所属领域的普通技术人员来说，在上述说明的基础上还可以做出其它不同形式的变化或变动。这里无需也无法对所有的实施方式予以穷举。而由此所引申出的显而易见的变化或变动仍处于本发明创造的保护范围之中。
