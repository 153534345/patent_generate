标题title
边缘鉴权免流计量方法、装置、电子设备及存储介质
摘要abst
本发明涉及一种边缘鉴权免流计量方法、装置、电子设备及存储介质，该方法包括：接收第一请求，并对第一请求进行合法性校验，第一请求为来自用户端的订单管理请求。在第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，鉴权计费中心包含订单记录以及流量包余量。通过访问鉴权计费中心获取用户的订单记录，并根据内存累计流量，得到流量的消耗数据，流量的消耗数据用以同步更新鉴权计费中心。基于流量的消耗数据，生成业务日志，并通过分布式算力集群处理业务日志，以从业务日志中提取业务状态数据，业务状态数据用于监测业务日志的业务质量变化。该方法提高了代理兼容性，避免了负载过高的情况发生，提高了系统的稳定性。
权利要求书clms
1.一种边缘鉴权免流计量方法，其特征在于，所述方法包括：接收第一请求，并对所述第一请求进行合法性校验，所述第一请求为来自用户端的订单管理请求；在所述第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，所述鉴权计费中心包含所述订单记录以及流量包余量；通过访问所述鉴权计费中心获取所述用户的订单记录，并根据内存累计流量，得到流量的消耗数据，所述流量的消耗数据用以同步更新所述鉴权计费中心；基于所述流量的消耗数据，生成业务日志，并通过分布式算力集群处理所述业务日志，以从所述业务日志中提取业务状态数据，所述业务状态数据用于监测所述业务日志的业务质量变化。2.根据权利要求1所述的边缘鉴权免流计量方法，其特征在于，所述接收第一请求，并对所述第一请求进行合法性校验，包括：通过协商的握手协议接收来自用户端的第一请求，并对所述第一请求进行合法性校验；当所述第一请求的合法性校验成功后，建立与用户端之间的TCP连接隧道；其中，所述TCP连接隧道用于实现与用户端之间的数据交互。3.根据权利要求2所述的边缘鉴权免流计量方法，其特征在于，所述在所述第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，包括：基于所述TCP连接隧道，获取当前免流订单以及用户端的账户信息，并通过鉴权算法对所述当前免流订单以及用户端的账户信息进行加密；将加密后的所述当前免流订单以及用户端的账户信息保存至所述数据库，以更新所述数据库中用户的订单记录；其中，所述鉴权算法为基于SOCKS5协议的扩展算法。4.根据权利要求3所述的边缘鉴权免流计量方法，其特征在于，所述在所述第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，还包括：基于所述更新数据库中用户的订单记录，获取第一更新数据，所述第一更新数据为用户在所述数据库中的订购关系记录的更新数据；将所述第一更新数据发送至所述鉴权计费中心，以同步更新所述鉴权计费中心的订购关系状态和流量包余量。5.根据权利要求4所述的边缘鉴权免流计量方法，其特征在于，所述通过访问所述鉴权计费中心获取所述用户的订单记录，并根据内存累计流量，得到流量的消耗数据，之前包括：接收来自用户端的握手请求，所述握手请求为用户端通过免流专属调度地址发起的；提取握手过程中的关键信息，所述关键信息包括所述当前免流订单以及用户端的账户信息，用于对所述握手请求进行鉴权。6.根据权利要求5所述的边缘鉴权免流计量方法，其特征在于，所述通过访问所述鉴权计费中心获取所述用户的订单记录，并根据内存累计流量，得到流量的消耗数据，包括：访问所述鉴权计费中心，判断所述关键信息在对应订单记录中是否具有订购权益；若是，则通过鉴权，并与所述关键信息对应的用户端完成握手，与用户端之间建立可靠连接；基于所述可靠连接，将源站反馈的与所述关键信息对应的计费数据发送至用户端，以确定所述流量的消耗数据。7.根据权利要求1至6任一项所述的边缘鉴权免流计量方法，其特征在于，所述基于所述流量的消耗数据，生成业务日志，并通过分布式算力集群处理所述业务日志，以从所述业务日志中提取业务状态数据，包括：基于所述流量的消耗数据和内存累计流量，获取具有相同时间间隔的剩余流量变化，以生成所述业务日志，所述业务日志用于表征所述相同时间间隔的剩余流量变化；调用所述分布式算力集群对所述业务日志进行处理，以提取所述业务日志中的业务状态数据，所述业务状态数据至少包括业务种类、业务访问量以及业务宽带。8.一种边缘鉴权免流计量装置，其特征在于，所述装置包括：请求校验模块，用于接收第一请求，并对所述第一请求进行合法性校验，所述第一请求为来自用户端的订单管理请求；数据更新模块，用于在所述第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，所述鉴权计费中心包含所述订单记录以及流量包余量；流量鉴权模块，用于通过访问所述鉴权计费中心获取所述用户的订单记录，并根据内存累计流量，得到流量的消耗数据，所述流量的消耗数据用以同步更新所述鉴权计费中心；业务状态监控模块，用于基于所述流量的消耗数据，生成业务日志，并通过分布式算力集群处理所述业务日志，以从所述业务日志中提取业务状态数据，所述业务状态数据用于监测所述业务日志的业务质量变化。9.一种电子设备，包括存储器和处理器，所述存储器存储有计算机程序，其特征在于，所述处理器执行所述计算机程序时实现权利要求1至7中任一项所述的方法的步骤。10.一种计算机存储介质，存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现权利要求1至7中任一项所述的方法的步骤。
说明书desc
技术领域本发明涉及移动通信技术领域，特别是涉及一种边缘鉴权免流计量方法、装置、电子设备及存储介质。背景技术随着新型互联网产品的的发展，诸如短视频等以多媒体内容为主的APP热度越来越高，用户使用黏度较强，互联网用户利用碎片化时间使用此类应用，导致用户移动数据流量使用量不断提升，通用流量出现难以满足用户需求的趋势。各大ISP厂商为此推出了定向免流产品，为用户提供移动场景下对特定APP的数据使用方案，但APP内置的服务很多，技术实现多样复杂，免流方案各有不同，因此提高免流覆盖范围、加强服务兼容性、确保系统安全可靠是各大厂商的关注点，也是资金和技术投入最多的地方。早期运营商为了快速推出免流产品，降低合作厂商接入门槛，多采用HTTP协议代理的方式来降低系统初期开发难度，以及借助开源社区成熟的代理方案，如Nginx等，来实现简易的反向代理，直接将APP的请求代理到合作方源站。但是随着APP不断迭代升级，功能越发复杂，APP使用过程中不限于基于HTTP协议的多媒体资源请求，因此早期的HTTP协议代理方案兼容性越发不足，免流覆盖范围需要进一步扩大，以便提升用户的免流权益。另外，在免流业务系统中，用户须先订购免流权益产品，系统生成用户的订购关系后方可接入免流服务。在免流服务过程中需要由中心系统实时扣减用户定向流量，早期的免流系统专注运营商权益，订购关系和流量扣减机制高度集中化，大量的同步操作由鉴权中心完成，导致鉴权中心负载过高，成为系统瓶颈，系统存在稳定性隐患。主流的运营商提供的HTTP协议代理免流服务，基于成熟的代理方案，能够方便打印代理请求的日志，并采用定时分析日志并汇总流量，再向流量扣减中心同步数据，这种方式虽然逻辑简单，但是实时性较低，尤其是在晚高峰，若用户的访问日志飙升，分析日志的程序会拉高代理服务器的CPU消耗和磁盘读写压力，让系统资源变得更加紧张。此外，在主流的HTTP协议代理免流场景中，客户的请求很容易被截获，资源地址散播出去后，其他用户可以盗取流量免费使用移动数据，系统存在较大的盗链风险。综上所述，传统的HTTP协议代理免流的方式兼容性较差且由于系统负载过大以及资源紧张的缘故，导致系统稳定性较差。发明内容基于此，有必要针对上述技术问题，提供一种兼容性较好且系统稳定性较高的边缘鉴权免流计量方法、装置、电子设备及存储介质。本发明提供了一种边缘鉴权免流计量方法，所述方法包括：接收第一请求，并对所述第一请求进行合法性校验，所述第一请求为来自用户端的订单管理请求；在所述第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，所述鉴权计费中心包含所述订单记录以及流量包余量；通过访问所述鉴权计费中心获取所述用户的订单记录，并根据内存累计流量，得到流量的消耗数据，所述流量的消耗数据用以同步更新所述鉴权计费中心；基于所述流量的消耗数据，生成业务日志，并通过分布式算力集群处理所述业务日志，以从所述业务日志中提取业务状态数据，所述业务状态数据用于监测所述业务日志的业务质量变化。在其中一个实施例中，所述接收第一请求，并对所述第一请求进行合法性校验，包括：通过协商的握手协议接收来自用户端的第一请求，并对所述第一请求进行合法性校验；当所述第一请求的合法性校验成功后，建立与用户端之间的TCP连接隧道；其中，所述TCP连接隧道用于实现与用户端之间的数据交互。在其中一个实施例中，所述在所述第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，包括：基于所述TCP连接隧道，获取当前免流订单以及用户端的账户信息，并通过鉴权算法对所述当前免流订单以及用户端的账户信息进行加密；将加密后的所述当前免流订单以及用户端的账户信息保存至所述数据库，以更新所述数据库中用户的订单记录；其中，所述鉴权算法为基于SOCKS5协议的扩展算法。在其中一个实施例中，所述在所述第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，还包括：基于所述更新数据库中用户的订单记录，获取第一更新数据，所述第一更新数据为用户在所述数据库中的订购关系记录的更新数据；将所述第一更新数据发送至所述鉴权计费中心，以同步更新所述鉴权计费中心的订购关系状态和流量包余量。在其中一个实施例中，所述通过访问所述鉴权计费中心获取所述用户的订单记录，并根据内存累计流量，得到流量的消耗数据，之前包括：接收来自用户端的握手请求，所述握手请求为用户端通过免流专属调度地址发起的；提取握手过程中的关键信息，所述关键信息包括所述当前免流订单以及用户端的账户信息，用于对所述握手请求进行鉴权。在其中一个实施例中，所述通过访问所述鉴权计费中心获取所述用户的订单记录，并根据内存累计流量，得到流量的消耗数据，包括：访问所述鉴权计费中心，判断所述关键信息在对应订单记录中是否具有订购权益；若是，则通过鉴权，并与所述关键信息对应的用户端完成握手，与用户端之间建立可靠连接；基于所述可靠连接，将源站反馈的与所述关键信息对应的计费数据发送至用户端，以确定所述流量的消耗数据。在其中一个实施例中，所述基于所述流量的消耗数据，生成业务日志，并通过分布式算力集群处理所述业务日志，以从所述业务日志中提取业务状态数据，包括：基于所述流量的消耗数据和内存累计流量，获取具有相同时间间隔的剩余流量变化，以生成所述业务日志，所述业务日志用于表征所述相同时间间隔的剩余流量变化；调用所述分布式算力集群对所述业务日志进行处理，以提取所述业务日志中的业务状态数据，所述业务状态数据至少包括业务种类、业务访问量以及业务宽带。本发明还提供了一种边缘鉴权免流计量装置，所述装置包括：请求校验模块，用于接收第一请求，并对所述第一请求进行合法性校验，所述第一请求为来自用户端的订单管理请求；数据更新模块，用于在所述第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，所述鉴权计费中心包含所述订单记录以及流量包余量；流量鉴权模块，用于通过访问所述鉴权计费中心获取所述用户的订单记录，并根据内存累计流量，得到流量的消耗数据，所述流量的消耗数据用以同步更新所述鉴权计费中心；业务状态监控模块，用于基于所述流量的消耗数据，生成业务日志，并通过分布式算力集群处理所述业务日志，以从所述业务日志中提取业务状态数据，所述业务状态数据用于监测所述业务日志的业务质量变化。本发明还提供了一种电子设备，包括存储器和处理器，所述存储器存储有计算机程序，所述处理器执行所述计算机程序时实现如上述任一种所述的边缘鉴权免流计量方法。本发明还提供了一种计算机存储介质，存储有计算机程序，所述计算机程序被处理器执行时实现如上述任一种所述的边缘鉴权免流计量方法。上述边缘鉴权免流计量方法、装置、电子设备及存储介质，免流代理服务器通过接收来自用户端的订单管理请求，并对该订单管理请求进行合法性校验。随后，在订单管理请求校验成功后建立用户端与免流代理服务器之间的连接通道，进而通过该连接通道更新免流代理服务器中数据库中用户的流量订单记录，并同步更新鉴权计费中心里对应的订单记录以及流量包剩余。然后，免流代理服务器通过访问鉴权计费中心来获取用户的订单记录，并根据内存累计流量得到流量的消耗数据，并进一步同步更新鉴权计费中心中的流量数据，即扣去鉴权计费中心中对应订单的流量的消耗数据。最后，根据流量的消耗数据生成流量消耗的业务日志，并通过分布式算力集群对该业务日志进行处理，来从业务日志中提取用于检测业务日志的业务质量变化的业务状态数据。该方法通过对用户端的订单管理请求进行合法性校验，并在校验成功后按照特定的通信协议进行用户端与免流代理服务器之间的数据交互，而不是局限于HTTP协议的定向流量代理，提高了代理方案的兼容性。另外，鉴权计费中心的设置将订单的订购关系以及流量的扣减分摊至数据库，在一定程度上避免了鉴权中心负载过高的情况发生，提高了系统的稳定性。附图说明为了更清楚地说明本发明或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作一简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明提供的边缘鉴权免流计量方法流程示意图之一；图2为本发明提供的边缘鉴权免流计量方法流程示意图之二；图3为本发明提供的边缘鉴权免流计量方法流程示意图之三；图4为本发明提供的边缘鉴权免流计量方法流程示意图之四；图5为本发明提供的边缘鉴权免流计量方法流程示意图之五；图6为本发明提供的边缘鉴权免流计量方法流程示意图之六；图7为本发明提供的边缘鉴权免流计量方法流程示意图之七；图8为本发明提供的具体实施例中边缘鉴权免流计量方法的系统架构示意图；图9为本发明提供的具体实施例中边缘鉴权免流计量方法的免流接入流程示意图；图10为本发明提供的具体实施例中边缘鉴权免流计量方法的免流数据上下游数据交互过程示意图；图11为本发明提供的具体实施例中边缘鉴权免流计量方法的订购关系和流量同步流程示意图；图12为本发明提供的具体实施例中边缘鉴权免流计量方法的鉴权算法流程示意图；图13为本发明提供的边缘鉴权免流计量装置结构示意图；图14为本发明提供的计算机设备的内部结构图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地说明，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。下面结合图1-图14描述本发明的边缘鉴权免流计量方法、装置、电子设备及存储介质。如图1所示，在一个实施例中，一种边缘鉴权免流计量方法，包括以下步骤：步骤S110，接收第一请求，并对第一请求进行合法性校验，第一请求为来自用户端的订单管理请求。具体的，免流代理服务器接收来自用户端的订单管理请求，并对该订单管理请求进行合法性校验，使得用户端与免流代理服务器之间按照合法性协议建立专属的数据传输通道。步骤S120，在第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，鉴权计费中心包含订单记录以及流量包余量。具体的，免流代理服务器在步骤S110中来自用户端的订单管理请求校验成功后通过与用户端之间进行对应协议的数据交互来更新数据库中对应该用户端的用户的订单记录，进而同步更新鉴权计费中心，该鉴权计费中心中包含对应用户的订单记录以及对应的流量包余量。步骤S130，通过访问鉴权计费中心获取用户的订单记录，并根据内存累计流量，得到流量的消耗数据，流量的消耗数据用以同步更新鉴权计费中心。具体的，免流代理服务器通过访问鉴权计费中心获取用户的初始订单记录，并根据内存累计流量，得到用户端当前流量的消耗数据，该流量的消耗数据也会同步更新至鉴权计费中心，实现鉴权计费中心对用户端流量消耗的实时记录。步骤S140，基于流量的消耗数据，生成业务日志，并通过分布式算力集群处理业务日志，以从业务日志中提取业务状态数据，业务状态数据用于监测业务日志的业务质量变化。具体的，免流代理服务器基于步骤S130中得到的流量的消耗数据，结合不同时间的流量的消耗数据，生成相应的业务日志，并通过分布式算力集群对该业务日志进行处理，来从该业务日志中提取对应流量订单的业务状态数据，以此实现对业务日志的业务质量变化的监控。上述边缘鉴权免流计量方法，免流代理服务器通过接收来自用户端的订单管理请求，并对该订单管理请求进行合法性校验。随后，在订单管理请求校验成功后建立用户端与免流代理服务器之间的连接通道，进而通过该连接通道更新免流代理服务器中数据库中用户的流量订单记录，并同步更新鉴权计费中心里对应的订单记录以及流量包剩余。然后，免流代理服务器通过访问鉴权计费中心来获取用户的订单记录，并根据内存累计流量得到流量的消耗数据，并进一步同步更新鉴权计费中心中的流量数据，即扣去鉴权计费中心中对应订单的流量的消耗数据。最后，根据流量的消耗数据生成流量消耗的业务日志，并通过分布式算力集群对该业务日志进行处理，来从业务日志中提取用于检测业务日志的业务质量变化的业务状态数据。该方法通过对用户端的订单管理请求进行合法性校验，并在校验成功后按照特定的通信协议进行用户端与免流代理服务器之间的数据交互，而不是局限于HTTP协议的定向流量代理，提高了代理方案的兼容性。另外，鉴权计费中心的设置将订单的订购关系以及流量的扣减分摊至数据库，在一定程度上避免了鉴权中心负载过高的情况发生，提高了系统的稳定性。如图2所示，在一个实施例中，本发明提供的边缘鉴权免流计量方法，接收第一请求，并对第一请求进行合法性校验，具体包括以下步骤：步骤S112，通过协商的握手协议接收来自用户端的第一请求，并对第一请求进行合法性校验。具体的，免流代理服务器通过协商的握手协议接收来自用户端的订单管理请求，按照握手协议对来自用户端的订单管理请求进行合法性校验，判断订单管理请求是否符合握手协议。步骤S114，当第一请求的合法性校验成功后，建立与用户端之间的TCP连接隧道。具体的，当来自用户端的订单管理请求合法性校验成功后，免流代理服务器则会建立与用户端之间的TCP连接隧道，以实现免流代理服务器与用户端之间专属的数据交互。其中，TCP连接隧道是一种通过在网络中创建一个虚拟的隧道来传输TCP连接的技术，它可以在不同的网络节点之间建立虚拟的连接，使得数据可以通过这个隧道进行传输。如图3所示，在一个实施例中，本发明提供的边缘鉴权免流计量方法，在第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，具体包括以下步骤：步骤S122，基于TCP连接隧道，获取当前免流订单以及用户端的账户信息，并通过鉴权算法对当前免流订单以及用户端的账户信息进行加密。具体的，免流代理服务器基于先前建立的TCP连接隧道，获取用户端当前的免流订单以及用户端的账户信息，并通过鉴权算法对当前免流订单以及用户端的账户信息进行加密。其中，鉴权算法为基于SOCKS5协议的扩展算法，SOCKS5协议是一种用于客户端与外网服务器之间通讯的中间传递协议，提供了安全和隐私保护的功能，是一种常用的代理协议，被广泛应用于网络通信中。步骤S124，将加密后的当前免流订单以及用户端的账户信息保存至数据库，以更新数据库中用户的订单记录。具体的，免流代理服务器将步骤S122中加密处理后的当前免流订单以及用户端的账户信息保存至数据库，以此来更新数据库中用户的订单信息。如图4所示，在一个实施例中，本发明提供的边缘鉴权免流计量方法，在第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，具体还包括以下步骤：步骤S126，基于更新数据库中用户的订单记录，获取第一更新数据，第一更新数据为用户在数据库中的订购关系记录的更新数据。具体的，免流代理服务器基于更新数据库中用户的订单记录，获取用户在数据库中的订购关系记录的更新数据，即第一更新数据。步骤S128，将第一更新数据发送至鉴权计费中心，以同步更新鉴权计费中心的订购关系状态和流量包余量。具体的，免流代理服务器将步骤S126中得到的第一更新数据发送至鉴权计费中心，以实现鉴权计费中心的订购关系状态和流量包余量的同步更新。如图5所示，在一个实施例中，本发明提供的边缘鉴权免流计量方法，通过访问鉴权计费中心获取用户的订单记录，并根据内存累计流量，得到流量的消耗数据，之前包括：步骤S510，接收来自用户端的握手请求，握手请求为用户端通过免流专属调度地址发起的。具体的，免流代理服务器接收来自用户端的握手请求，该握手请求为用户端通过免流专属调度地址发起的。步骤S520，提取握手过程中的关键信息，关键信息包括当前免流订单以及用户端的账户信息，用于对握手请求进行鉴权。具体的，免流代理服务器提取握手过程中的关键信息，该关键信息包括当前免流订单以及用户端的账户信息，用于对握手请求进行鉴权。如图6所示，在一个实施例中，本发明提供的边缘鉴权免流计量方法，通过访问鉴权计费中心获取用户的订单记录，并根据内存累计流量，得到流量的消耗数据，具体包括以下步骤：步骤S132，访问鉴权计费中心，判断关键信息在对应订单记录中是否具有订购权益。具体的，免流代理服务器访问鉴权计费中心，并判断先前得到的关键信息在对应订单记录中是否具有订购权益。步骤S134，通过鉴权，并与关键信息对应的用户端完成握手，与用户端之间建立可靠连接。具体的，若步骤S132中的判断结果为先前得到的关键信息在对应订单记录中具有订购权益，那么免流代理服务器则会通过对关键信息的鉴权，并与该关键信息对应的用户端完成握手，与该用户端之间建立可靠连接。步骤S136，基于可靠连接，将源站反馈的与关键信息对应的计费数据发送至用户端，以确定流量的消耗数据。具体的，免流代理服务器基于步骤S134中建立的可靠连接，将合作方源站反馈的与关键信息对应的流量计费数据发送至用户单，以此来确定流量的消耗数据。如图7所示，在一个实施例中，本发明提供的边缘鉴权免流计量方法，基于流量的消耗数据，生成业务日志，并通过分布式算力集群处理业务日志，以从业务日志中提取业务状态数据，具体包括以下步骤：步骤S142，基于流量的消耗数据和内存累计流量，获取具有相同时间间隔的剩余流量变化，以生成业务日志，业务日志用于表征相同时间间隔的剩余流量变化。具体的，免流代理服务器基于流量的消耗数据和内存累计流量，获取相同时间间隔的剩余流量变化，来生成对应的业务日志，该业务日志用于表征相同时间间隔的剩余流量变化。步骤S144，调用分布式算力集群对业务日志进行处理，以提取业务日志中的业务状态数据，业务状态数据至少包括业务种类、业务访问量以及业务宽带。具体的，免流代理服务器调用分布式集群对业务日志进行处理，来提取业务日志中的业务状态数据，该业务状态数据中包括但不仅限于业务种类、业务访问量以及业务宽带。参见图8所示，在具体的实施例中，本发明提供的边缘鉴权免流计量方法，实现该方法的系统主要由订购处理模块、鉴权计费中心等六个单元构成，六个单元角色分工明确，在定向免流服务过程中缺一不可，其中计算类能力主要集中在鉴权计费中心和免流接入层，网络IO主要集中免流接入层。只有订购处理模块和免流接入层对互联网客户暴露，其他模块都在内网交互。工作原理是将用户对特定资源的访问产生的数据流量不纳入通用流量包的扣减，特定资源的访问又涉及IP报备，即先对特定IP进行报备，当用户访问此前报备的IP时，只对用户订购的权益流量包进行扣减。其中，订购处理模块主要负责响应网民的订购、续订、退订请求，用户可通过对应的入口点或者订购管理窗口管理对应的订单，该模块会对请求进行合法性校验，并对用户的请求合法性进行判断，当用户请求校验通过后，将用户在数据库中的订购关系记录进行更新，并同步到鉴权计费中心。鉴权计费中心负责订购关系状态和流量包余额，内部维护一个高度动态更新的数据库，采用Redis Cluster存储订购关系和账户流量包余额信息，为免流接入层提供数据支撑。免流接入层提供传输层代理服务，免流数据的入口，边缘鉴权和流量计量都在这里完成。根据全国用户的分布情况，按业务带宽分布部署在全国各省核心城市，免流接入层通过访问鉴权计费中心获取请求用户的订购关系合约信息，根据内存累计流量，将数据消耗同步到鉴权计费中心。在服务客户代理请求的同时，定时生成业务日志并同步到大数据中心，提供质量监控的原始数据。大数据中心接收免流接入层上报的业务日志，利用分布式算力集群处理日志，提取关键参数，为质量监控系统提供准确和及时的业务状态数据。质量监控系统根据大数据中心提供的业务状态数据，根据业务种类、业务访问量、业务带宽等，提供多个计量维度的监控图，运维人员可以登录质量监控系统，观察业务质量变化。配置管理中心集成了业务管理、设备管理、调度管理等诸多资源操作能力，运营管理员通过配置管理中心，操作设备上下线、调整流量调度等。结合图9所示，代理免流服务是基于传输层实现，用户端APP通过协商的握手协议，通过免流代理服务端的校验后，可以建立安全的TCP连接隧道，随后APP端使用建立好的TCP隧道进行数据传输，主流的应用层协议，如HTTP、HTTPS、RTMP等均可稳定支持。客户端与免流代理服务器建立传输层隧道，需要经过较为严格的握手协议，在握手过程中，交互的数据需要进行鉴权算法加密，包括当前免流订购产品和用户的账户信息。其中，使用传输层代理协议是基于SOCKS5协议，在SOCKS5协议握手阶段交互关键信息，建立安全连接。在本实施例中，结合图10所示，在定向免流服务中，多套系统共同参与数据传输流程，涉及ISP提供的DNS系统服务以及合作方提供的源站能力。整个免流过程分为免流请求和数据服务两部分，图中数据传输过程的具体内容如下：客户端通过免流专属调度地址，发起免流代理服务连接请求。通过ISP的域名系统，解析出调度地址，连接免流代理服务器，发起握手请求。免流代理服务器接收到客户端握手请求，提取握手过程中的关键信息，访问鉴权计费中心，获取账户在对应产品下是否有订购权益。若通过鉴权，则顺利完成握手，建立可靠连接。建立可靠连接后，免流代理服务器响应用户请求，转发到合作方源站，源站返回对应的数据内容。免流代理服务器将源站返回的数据内容透传给客户端。免流代理服务器将代理计费数据同步到鉴权计费中心，完成该用户在对应免流产品下的流量扣减。参见图11所示，在免流系统服务客户过程中，涉及订购关系和流量同步。在订购关系层面上，订购处理模块要响应客户的订购、续订、退订需求，并将如上操作归为对应任务，任务执行单元负责将订购状态同步到鉴权计费中心。在流量同步层面上，用户的当前剩余流量是动态变化的，用户订购的产品计费都是周期制，需要定时刷新余额。同时，用户在使用流量过程中则根据用户使用的流量实时扣减。结合图12所示，鉴权算法基于SOCKS5协议的扩展，握手阶段和标准协议一致，且SOCKS5的验证方法只支持账户和密码验证方式，其中password部分通过账户字符串嵌入私钥，再通过SHA256不可逆加密算法生成，保护账户敏感数据不被盗取。上述边缘鉴权免流计量方法，在定向免流场景中，取消传统的中心化鉴权方式，采用分布式鉴权。将鉴权、流量计量等计算和网络IO压力下沉到边缘节点，有效降低了鉴权中心负载，提升了系统的抗并发能力，同时整体扩展性和稳定性均有所提升。边缘对鉴权数据进行了本地缓存，超时访问鉴权接口，这种缓存机制对于订购关系庞大、套餐逻辑复杂的场景比较友好，对升级开发和系统维护都有所帮助。另外，该方法放弃了以往的HTTP代理方式，而是采用传输层代理机制，这种代理方式对上层协议支持良好，系统兼容性较好。采用SOCKS5协议实现代理模式在开源社区被广泛支持，兼容性进一步得到提升。另外，采用user/password的认证方法，并对password采用协商的加密算法，握手过程中规避账户信息泄露的风险，提高了安全性。该方法还着重提高流量扣减的及时性，采用SOCKS5代理侧分钟级同步流量扣减信息，与传统采用日志落盘，然后定时处理日志汇总流量的方式不同，该方法中账户的流量使用信息都存储在内存中，更新速度很快，不产生额外的磁盘读写，性能得到了大幅提升。另外，由于磁盘读写量的降低和数据处理量的减少，系统负载整体降低，在服务器资源不变的情况下，系统承载能力有所提升，优化了业务运行效益。下面对本发明提供的边缘鉴权免流计量装置进行描述，下文描述的边缘鉴权免流计量装置与上文描述的边缘鉴权免流计量方法可相互对应参照。如图13所示，在一个实施例中，一种边缘鉴权免流计量装置，包括请求校验模块1310、数据更新模块1320、流量鉴权模块1330以及业务状态监控模块1340。请求校验模块1310用于接收第一请求，并对第一请求进行合法性校验，第一请求为来自用户端的订单管理请求。数据更新模块1320用于在第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，鉴权计费中心包含订单记录以及流量包余量。流量鉴权模块1330用于通过访问鉴权计费中心获取用户的订单记录，并根据内存累计流量，得到流量的消耗数据，流量的消耗数据用以同步更新鉴权计费中心。业务状态监控模块1340用于基于流量的消耗数据，生成业务日志，并通过分布式算力集群处理业务日志，以从业务日志中提取业务状态数据，业务状态数据用于监测业务日志的业务质量变化。在本实施例中，本发明提供的边缘鉴权免流计量装置，请求校验模块具体用于：通过协商的握手协议接收来自用户端的第一请求，并对第一请求进行合法性校验。当第一请求的合法性校验成功后，建立与用户端之间的TCP连接隧道。其中，TCP连接隧道用于实现与用户端之间的数据交互。在本实施例中，本发明提供的边缘鉴权免流计量装置，数据更新模块具体用于：基于TCP连接隧道，获取当前免流订单以及用户端的账户信息，并通过鉴权算法对当前免流订单以及用户端的账户信息进行加密。将加密后的当前免流订单以及用户端的账户信息保存至数据库，以更新数据库中用户的订单记录。其中，鉴权算法为基于SOCKS5协议的扩展算法。在本实施例中，本发明提供的边缘鉴权免流计量装置，数据更新模块具体还用于：基于更新数据库中用户的订单记录，获取第一更新数据，第一更新数据为用户在数据库中的订购关系记录的更新数据。将第一更新数据发送至鉴权计费中心，以同步更新鉴权计费中心的订购关系状态和流量包余量。在本实施例中，本发明提供的边缘鉴权免流计量装置，还包括握手模块，用于：接收来自用户端的握手请求，握手请求为用户端通过免流专属调度地址发起的。提取握手过程中的关键信息，关键信息包括当前免流订单以及用户端的账户信息，用于对握手请求进行鉴权。在本实施例中，本发明提供的边缘鉴权免流计量装置，流量鉴权模块具体用于：访问鉴权计费中心，判断关键信息在对应订单记录中是否具有订购权益。若是，则通过鉴权，并与关键信息对应的用户端完成握手，与用户端之间建立可靠连接。基于可靠连接，将源站反馈的与关键信息对应的计费数据发送至用户端，以确定流量的消耗数据。在本实施例中，本发明提供的边缘鉴权免流计量装置，业务状态监控模块具体用于：基于流量的消耗数据和内存累计流量，获取具有相同时间间隔的剩余流量变化，以生成业务日志，业务日志用于表征相同时间间隔的剩余流量变化。调用分布式算力集群对业务日志进行处理，以提取业务日志中的业务状态数据，业务状态数据至少包括业务种类、业务访问量以及业务宽带。图14示例了一种电子设备的实体结构示意图，该电子设备可以是智能终端，其内部结构图可以如图14所示。该电子设备包括通过系统总线连接的处理器、存储器和网络接口。其中，该电子设备的处理器用于提供计算和控制能力。该电子设备的存储器包括非易失性存储介质、内存储器。该非易失性存储介质存储有操作系统和计算机程序。该内存储器为非易失性存储介质中的操作系统和计算机程序的运行提供环境。该电子设备的网络接口用于与外部的终端通过网络连接通信。该计算机程序被处理器执行时以实现边缘鉴权免流计量方法，该方法包括：接收第一请求，并对第一请求进行合法性校验，第一请求为来自用户端的订单管理请求；在第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，鉴权计费中心包含订单记录以及流量包余量；通过访问鉴权计费中心获取用户的订单记录，并根据内存累计流量，得到流量的消耗数据，流量的消耗数据用以同步更新鉴权计费中心；基于流量的消耗数据，生成业务日志，并通过分布式算力集群处理业务日志，以从业务日志中提取业务状态数据，业务状态数据用于监测业务日志的业务质量变化。本领域技术人员可以理解，图14中示出的结构，仅仅是与本发明方案相关的部分结构的框图，并不构成对本发明方案所应用于其上的电子设备的限定，具体的电子设备可以包括比图中所示更多或更少的部件，或者组合某些部件，或者具有不同的部件布置。另一方面，本发明还提供了一种计算机存储介质，存储有计算机程序，计算机程序被处理器执行时实现边缘鉴权免流计量方法，该方法包括：接收第一请求，并对第一请求进行合法性校验，第一请求为来自用户端的订单管理请求；在第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，鉴权计费中心包含订单记录以及流量包余量；通过访问鉴权计费中心获取用户的订单记录，并根据内存累计流量，得到流量的消耗数据，流量的消耗数据用以同步更新鉴权计费中心；基于流量的消耗数据，生成业务日志，并通过分布式算力集群处理业务日志，以从业务日志中提取业务状态数据，业务状态数据用于监测业务日志的业务质量变化。又一方面，提供了一种计算机程序产品或计算机程序，该计算机程序产品或计算机程序包括计算机指令，该计算机指令存储在计算机可读存储介质中。电子设备的处理器从计算机可读存储介质读取该计算机指令，处理器执行该计算机指令时实现边缘鉴权免流计量方法，该方法包括：接收第一请求，并对第一请求进行合法性校验，第一请求为来自用户端的订单管理请求；在第一请求校验成功后更新数据库中用户的订单记录，并同步更新鉴权计费中心，鉴权计费中心包含订单记录以及流量包余量；通过访问鉴权计费中心获取用户的订单记录，并根据内存累计流量，得到流量的消耗数据，流量的消耗数据用以同步更新鉴权计费中心；基于流量的消耗数据，生成业务日志，并通过分布式算力集群处理业务日志，以从业务日志中提取业务状态数据，业务状态数据用于监测业务日志的业务质量变化。本领域普通技术人员可以理解实现上述实施例方法中的全部或部分流程，是可以通过计算机程序来指令相关的硬件来完成，该计算机程序可存储于一非易失性计算机可读取存储介质中，该计算机程序在执行时，可包括如上述各方法的实施例的流程。其中，本发明所提供的各实施例中所使用的对存储器、存储、数据库或其它介质的任何引用，均可包括非易失性和/或易失性存储器。非易失性存储器可包括只读存储器、可编程ROM、电可编程ROM、电可擦除可编程ROM或闪存。易失性存储器可包括随机存取存储器或者外部高速缓冲存储器。作为说明而非局限，RAM以多种形式可得，诸如静态RAM、动态RAM、同步DRAM、双倍数据率SDRAM、增强型SDRAM、同步链路DRAM、存储器总线直接RAM、直接存储器总线动态RAM、以及存储器总线动态RAM等。以上实施例的各技术特征可以进行任意的组合，为使描述简洁，未对上述实施例中的各个技术特征所有可能的组合都进行描述，然而，只要这些技术特征的组合不存在矛盾，都应当认为是本说明书记载的范围。以上所述实施例仅表达了本发明的几种实施方式，其描述较为具体和详细，但并不能因此而理解为对本发明专利范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本发明构思的前提下，还可以做出若干变形和改进，这些都属于本发明的保护范围。因此，本发明专利的保护范围应以所附权利要求为准。
