标题title
基于数据脱敏的智能物联网数据聚合方法及装置
摘要abst
本实施例提供基于数据脱敏的智能物联网数据聚合方法及装置。本实施例中聚合网关基于各物联网设备发送的待聚合数据所携带的计数器值，选择出需要聚合的n个物联网设备，在可信执行环境下对该n个物联网设备的第一类数据分别进行数据脱敏要求下的指定加密处理比如数据打乱等，这种对n个物联网设备的第一类数据分别进行数据脱敏所要求的指定加密处理比如打乱处理等，不同于现有差分隐私下添加噪声的处理方式，实现了基于数据脱敏的智能物联网数据聚合，避免由差分隐私引起的问题。
权利要求书clms
1.一种基于数据脱敏的智能物联网数据聚合方法，其特征在于，该方法应用于聚合网关，所述聚合网关被配置运行以提供可信执行环境，所述可信执行环境禁止聚合网关外部访问，该方法包括：与控制中心协商加密密钥K，以使聚合网关和控制中心共享加密密钥K；在监测到任一物联网设备接入物联网时，在可信执行环境下与该物联网设备协商完成初始化，以使本聚合网关的时间和该物联网设备的时间同步以及本聚合网关的本地计数器值和该物联网设备的本地计数器值同步；接收任一物联网设备发送的待聚合数据，在可信执行环境下发现待聚合数据携带的计数器值和时间戳均通过验证，则使用本聚合网关的私钥PK AG对待聚合数据携带的密文进行解密得到物联网数据；其中，任一物联网设备在发送待聚合数据时将本地计数器值增加设定值；任一物联网设备发送的待聚合数据至少携带密文、该物联网设备本地时间戳以及本地最新计数器值；密文是使用聚合网关的公钥PK AG对物联网数据加密得到，物联网数据包括第一类数据和第二类数据；第一类数据为需要保护的敏感数据，第二类数据为非敏感数据；在可信执行环境下对n个物联网设备的第一类数据分别进行数据脱敏要求下的指定加密处理，将n个物联网设备的第二类数据和处理后的第一类数据进行聚合，使用所述加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心以使控制中心使用加密密钥K对目标密文进行解密；n个物联网设备是指发送的待聚合数据所携带的本地最新计数器值为指定值的物联网设备，n大于1。2.根据权利要求1所述的方法，其特征在于，所述与控制中心协商加密密钥K包括：向所述控制中心发送第一值，并接收所述控制中心发送的第二值和T1；所述T1表示所述控制中心的本地时间；所述第一值是基于本聚合网关选择的第一随机数、所述控制中心选择并通知的第一数p和第二数g按照设定算法计算得到，所述第二值是由所述控制中心选择的第二随机数、所述第一数p和所述第二数g按照设定算法计算得到；基于所述第一值和所述第二值计算参考密钥k，并利用所述参考密钥k对所述T1进行加密，得到T2；向所述控制中心发送T2，以使所述控制中心利用所述第一值和所述第二值计算出的参考密钥k对所述T2解密得到T3；接收所述控制中心发送的确认消息ACK，并利用参考密钥k计算所述加密密钥K；所述ACK是所述控制中心在所述T3与所述T1匹配时发送的；所述控制中心在所述T3与所述T1匹配时还用于基于所述参考密钥k计算所述加密密钥K。3.根据权利要求2所述的方法，其特征在于，所述第一值通过下式表示：v1 = g λ mod p；λ为第一随机数；所述第二值通过下式表示：v2 = g v mod p；v为第二随机数；所述基于所述第一值和所述第二值计算参考密钥k包括：计算所述第一值和所述第二值的乘积，依据所述乘积确定所述参考密钥k。4.根据权利要求1所述的方法，其特征在于，在所述可信执行环境下与该物联网设备协商完成初始化包括：接收针对物联网设备的远程认证请求，并向所述物联网设备发送本聚合网关的公钥PKAG；接收所述物联网设备发送的第一初始化消息；所述第一初始化消息携带第三数密文；所述第三数密文是利用所述聚合网关的公钥PKAG对所述物联网设备选择的第三数γi进行加密得到；使用本聚合网关的私钥PK AG对所述第一初始化消息携带的第三数密文进行解密，得到第四数γ i’，将本地时间、第四数以及本地最新计数器值携带在第二初始化消息中发送给所述物联网设备，以使所述物联网设备在验证所述第四数和所述第三数匹配时，将本地计数器值更新为所述第二初始化消息携带的计数器值，以及将本地时间更新为所述第二初始化消息携带的时间。5.根据权利要求1所述的方法，其特征在于，所述在可信执行环境下对n个物联网设备的第一类数据分别进行指定加密处理包括：针对n个物联网设备中每一物联网设备的第一类数据，基于随机打乱函数对该第一类数据进行打乱处理。6.根据权利要求1所述的方法，其特征在于，所述将n个物联网设备的第二类数据和处理后的第一类数据进行聚合包括：针对n个物联网设备中每一物联网设备，将该物联网设备的处理后的第一类数据与该物联网设备的第二类数据对应结合，得到结合数据；按照霍纳规则将各物联网设备的结合数据进行聚合。7.根据权利要求1所述的方法，其特征在于，所述待聚合数据进一步携带：密文签名，所述密文签名是物联网设备通过使用物联网私钥ri对所述密文进行签名得到；使用所述加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心进一步包括：对n个物联网设备发送的待聚合数据中的密文签名进行聚合，得到密文签名聚合，将所述密文签名聚合以及n个物联网设备的物联网公钥集合发送给所述控制中心；物联网公钥集合中任一物联网设备的物联网公钥对应该物联网设备对密文进行签名所使用的物联网私钥，所述物联网公钥集合被所述控制中心用于对密文签名聚合进行验证。8.一种基于数据脱敏的智能物联网数据聚合装置，其特征在于，该装置应用于聚合网关，所述聚合网关被配置运行可信执行环境，所述可信执行环境禁止聚合网关外部访问，该装置包括：协商单元，用于与控制中心协商加密密钥K以使聚合网关和控制中心共享加密密钥K；以及，在监测到任一物联网设备接入物联网时，在可信执行环境下与该物联网设备协商完成初始化，以使本聚合网关的时间和该物联网设备的时间同步以及本聚合网关的本地计数器值和该物联网设备的本地计数器值同步；接收单元，用于接收任一物联网设备发送的待聚合数据，在可信执行环境下发现待聚合数据携带的计数器值和时间戳均通过验证，则使用本聚合网关的私钥PK AG对待聚合数据携带的密文进行解密得到物联网数据；其中，任一物联网设备在发送待聚合数据时将本地计数器值增加设定值；任一物联网设备发送的待聚合数据至少携带密文、该物联网设备本地时间戳以及本地最新计数器值；密文是使用聚合网关的公钥PK AG对物联网数据加密得到，物联网数据包括第一类数据和第二类数据；第一类数据为需要保护的敏感数据，第二类数据为非敏感数据；聚合单元，用于在可信执行环境下对n个物联网设备的第一类数据分别进行数据脱敏要求下的指定加密处理，将n个物联网设备的第二类数据和处理后的第一类数据进行聚合，使用所述加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心以使控制中心使用加密密钥K对目标密文进行解密；n个物联网设备是指发送的待聚合数据所携带的本地最新计数器值为指定值的物联网设备，n大于1。9.一种电子设备，其特征在于，电子设备包括：处理器和存储器；其中，所述存储器，用于存储机器可执行指令；所述处理器，用于读取并执行所述存储器存储的机器可执行指令，以实现如权利要求1至7任一项所述的方法中的步骤。10.一种计算机程序产品，其特征在于，所述计算机程序产品内存储有计算机程序，所述计算机程序被处理器执行时实现权利要求1~ 7任一项所述的方法。
说明书desc
技术领域本申请涉及物联网领域，尤其涉及基于数据脱敏的智能物联网数据聚合方法及装置。背景技术在物联网应用中比如智能电网中，常采用差分隐私的方式来保护数据比如智能物联网数据。所谓差分隐私，其是通过对每一物联网设备比如智能电表等需要保护的物联网数据添加噪音数据来混淆上述物联网数据，以达到保护上述物联网数据的目的。但是，由于差分隐私的本质是在待保护物联网数据中添加噪音数据，这对上述待保护物联网数据的数据质量产生一定的影响，可能会降低待保护物联网数据的精度和可用性。并且，差分隐私需要对每一待保护物联网数据添加噪音数据，这种大规模的数据处理也会存在计算复杂度和存储空间等方面的问题。发明内容本申请实施例提供基于数据脱敏的智能物联网数据聚合方法及装置，以实现基于数据脱敏的智能物联网数据聚合，避免由差分隐私引起的问题。本申请实施例提供一种基于数据脱敏的智能物联网数据聚合方法，该方法应用于聚合网关，所述聚合网关被配置运行以提供可信执行环境，所述可信执行环境禁止聚合网关外部访问，该方法包括：与控制中心协商加密密钥K，以使聚合网关和控制中心共享加密密钥K；在监测到任一物联网设备接入物联网时，在可信执行环境下与该物联网设备协商完成初始化，以使本聚合网关的时间和该物联网设备的时间同步以及本聚合网关的本地计数器值和该物联网设备的本地计数器值同步；接收任一物联网设备发送的待聚合数据，在可信执行环境下发现待聚合数据携带的计数器值和时间戳均通过验证，则使用本聚合网关的私钥PKAG对待聚合数据携带的密文进行解密得到物联网数据；其中，任一物联网设备在发送待聚合数据时将本地计数器值增加设定值；任一物联网设备发送的待聚合数据至少携带密文、该物联网设备本地时间戳以及本地最新计数器值；密文是使用聚合网关的公钥PKAG对物联网数据加密得到，物联网数据包括第一类数据和第二类数据；第一类数据为需要保护的敏感数据，第二类数据为非敏感数据；在可信执行环境下对n个物联网设备的第一类数据分别进行数据脱敏要求下的指定加密处理，将n个物联网设备的第二类数据和处理后的第一类数据进行聚合，使用所述加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心以使控制中心使用加密密钥K对目标密文进行解密；n个物联网设备是指发送的待聚合数据所携带的本地最新计数器值为指定值的物联网设备，n大于1。一种基于数据脱敏的智能物联网数据聚合装置，该装置应用于聚合网关，所述聚合网关被配置运行以提供可信执行环境，所述可信执行环境禁止聚合网关外部访问，该装置包括：协商单元，用于与控制中心协商加密密钥K以使聚合网关和控制中心共享加密密钥K；以及，在监测到任一物联网设备接入物联网时，在可信执行环境下与该物联网设备协商完成初始化，以使本聚合网关的时间和该物联网设备的时间同步以及本聚合网关的本地计数器值和该物联网设备的本地计数器值同步；接收单元，用于接收任一物联网设备发送的待聚合数据，在可信执行环境下发现待聚合数据携带的计数器值和时间戳均通过验证，则使用本聚合网关的私钥PKAG对待聚合数据携带的密文进行解密得到物联网数据；其中，任一物联网设备在发送待聚合数据时将本地计数器值增加设定值；任一物联网设备发送的待聚合数据至少携带密文、该物联网设备本地时间戳以及本地最新计数器值；密文是使用聚合网关的公钥PKAG对物联网数据加密得到，物联网数据包括第一类数据和第二类数据；第一类数据为需要保护的敏感数据，第二类数据为非敏感数据；聚合单元，用于在可信执行环境下对n个物联网设备的第一类数据分别进行数据脱敏要求下的指定加密处理，将n个物联网设备的第二类数据和处理后的第一类数据进行聚合，使用所述加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心以使控制中心使用加密密钥K对目标密文进行解密；n个物联网设备是指发送的待聚合数据所携带的本地最新计数器值为指定值的物联网设备，n大于1。本申请实施例提供一种电子设备，电子设备包括：处理器和存储器；其中，所述存储器，用于存储机器可执行指令；所述处理器，用于读取并执行所述存储器存储的机器可执行指令，以实现如上方法。本申请实施例提供一种计算机程序产品，所述计算机程序产品内存储有计算机程序，所述计算机程序被处理器执行时实现如上方法。综上可以看出，本实施例中，聚合网关基于各物联网设备发送的待聚合数据所携带的计数器值，选择出需要聚合的n个物联网设备，在可信执行环境下对该n个物联网设备的第一类数据分别进行数据脱敏要求下的指定加密处理比如数据打乱等，并将n个物联网设备的第二类数据和处理后的第一类数据进行聚合，使用已与控制中心协商的加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心，这种对n个物联网设备的第一类数据分别进行数据脱敏所要求的指定加密处理比如打乱处理等，不同于现有差分隐私下添加噪声的处理方式，实现了基于数据脱敏的智能物联网数据聚合，避免由差分隐私引起的问题。进一步地，在本实施例中，聚合网关在监测到任一物联网设备接入物联网时，在可信执行环境下与该物联网设备协商完成初始化，以使本聚合网关的本地计数器值和该物联网设备的本地计数器值同步；之后聚合网关依赖于物联网设备的本地计数器值，选择出需要聚合的n个物联网设备，这并非盲目将所有物联网设备的数据进行聚合，而是将满足要求的n个物联网设备的数据进行聚合，节省资源，且能精准将满足要求的各物联网设备的数据进行聚合。进一步地，本实施例中，聚合网关通过运行可信执行环境，能够抵抗外部攻击，进一步保证数据安全。附图说明图1是本申请实施例示出的方法流程图；图2是本申请实施例示出的组网结构示意图；图3是本申请实施例示出的密钥协商流程图；图4是本申请实施例提供的初始化流程图；图5是本申请实施例提供的装置结构图；图6是本申请实施例示出的电子设备结构图。具体实施方式这里将详细地对示例性实施例进行说明，其示例表示在附图中。下面的描述涉及附图时，除非另有表示，不同附图中的相同数字表示相同或相似的要素。以下示例性实施例中所描述的实施方式并不代表与本申请相一致的所有实施方式。相反，它们仅是与如所附权利要求书中所详述的、本申请的一些方面相一致的装置和方法的例子。在本申请使用的术语是仅仅出于描述特定实施例的目的，而非旨在限制本申请。在本申请和所附权利要求书中所使用的单数形式的“一种”、“所述”和“该”也旨在包括多数形式，除非上下文清楚地表示其他含义。还应当理解，本文中使用的术语“和/或”是指并包含一个或多个相关联的列出项目的任何或所有可能组合。应当理解，尽管在本申请可能采用术语第一、第二、第三等来描述各种信息，但这些信息不应限于这些术语。这些术语仅用来将同一类型的信息彼此区分开。例如，在不脱离本申请范围的情况下，第一信息也可以被称为第二信息，类似地，第二信息也可以被称为第一信息。取决于语境，如在此所使用的词语“如果”可以被解释成为“在……时”或“当……时”或“响应于确定”。本实施例提供了基于数据脱敏的智能物联网数据聚合方法。这里，数据脱敏是一种保护数据安全的方法，可以在需要保护的上述物联网数据被使用或传输之前，对敏感数据进行数据脱敏要求下的指定加密处理比如采用高级加密标准下的算法进行诸如字符替换等加密处理，以减少敏感数据泄露和滥用的风险。这里，数据脱敏要求下的指定加密处理不同于差分隐私下添加噪声的方式，不影响敏感数据的数据质量，计算复杂度和存储空间要求都不高，保证了敏感数据无误差，保障了敏感数据的可用性和精度。作为一个实施例，这里的敏感数据比如可为应用于智能电网中智能电表的标识等，本实施例并不具体限定。下面对本申请实施例提供的方法进行描述：参见图1，图1为本申请实施例提供的方法流程图。该流程应用于聚合网关。在本实施例中，聚合网关被安装了一个硬件模块，该硬件模块通过运行飞地可以实现一个可信执行环境，该可信执行环境禁止聚合网关外部比如用户等访问。本实施例提供的应用于聚合网关的方法主要是聚合网关在上述可信执行环境下执行的，以保证整个方法的处理过程安全。可选地，上述硬件模块可为蓬莱硬件，用于实现上述可信执行环境。图2举例示出了上述方法的组网结构。如图2所示，聚合网关分别和控制中心、多个物联网设备相连。应用于智能电网，这里的物联网设备可为智能电表。以智能电表为例，每一固定区域被配备一个智能电表，智能电表可用于采集其所在区域中的电能数据。例如：每半个小时采集所在区域中的电能数据。基于图2所示的组网结构，如图1所示，该流程可包括以下步骤：步骤101，与控制中心协商加密密钥K，以使得本聚合网关和控制中心共享加密密钥K。可选地，作为一个实施例，这里的加密密钥K，被用于对聚合网关在后续发向控制中心的数据进行加密。作为一个实施例，加密密钥K的协商可发生在聚合网关和控制中心的初始化过程，下文会举例进行描述，这里暂不赘述。步骤102，在监测到任一物联网设备接入物联网时，在上述可信执行环境下与该物联网设备协商完成初始化，以使本聚合网关的时间和该物联网设备的时间同步，以及本聚合网关的本地计数器值和该物联网设备的本地计数器值同步。当上述物联网设备第一次接入物联网比如智能电表第一次接入智能电网时，本实施例会先在与该物联网设备相关联的用户设备上安装上述物联网设备的官方应用程序，以运程认证聚合网关的上述可信执行环境，在认证完成后，聚合网关会在上述可信执行环境下与该物联网设备协商完成初始化，以使本聚合网关的时间和该物联网设备的时间同步以及本聚合网关的本地计数器值和该物联网设备的本地计数器值同步，下文会举例描述，这里暂不赘述。需要说明的是，在聚合网关与物联网设备协商完成初始化的过程中，聚合网关会发送本聚合网关的公钥PKAG给物联网设备；这里的PKAG，被用于对物联网设备发向聚合网关的物联网数据进行加密。步骤103，接收任一物联网设备发送的待聚合数据，在上述可信执行环境下发现该待聚合数据携带的计数器值和时间戳均通过验证后，使用本聚合网关的私钥PKAG对该待聚合数据携带的密文进行解密，得到物联网数据。在本实施例中，任一物联网设备在发送待聚合数据时将本地计数器值增加设定值比如1，也即，此时物联网设备本地的最新计数器值相比之前的数值增加了设定值。在本实施例中，任一物联网设备发送的待聚合数据至少携带：密文、该物联网设备本地时间戳以及本地最新计数器值。这里，密文是通过使用聚合网关的公钥PKAG对本物联网设备的物联网数据加密得到。可选地，物联网数据可包括物联网设备的第一类数据和第二类数据。第一类数据为需要保护的敏感数据，第二类数据为非敏感数据。以物联网设备为智能电表为例，这里的第一类数据可为智能电表的标识ID，第二类数据可为智能电表采集的电能数据。作为一个实施例，基于聚合网关的时间和物联网设备的时间同步，以及聚合网关的本地计数器值和物联网设备的本地计数器值同步，则本步骤101中，在上述可信执行环境下发现该待聚合数据携带的计数器值和时间戳均通过验证是指：在上述可信执行环境下，将待聚合数据携带的计数器值减去上述设定值，若得到的结果与本聚合网关的本地计数器值相同，则确定该待聚合数据携带的计数器值通过验证；以及，检查待聚合数据携带的时间戳与本聚合网关的本地计时间戳的时间差在设定时差范围内，则确定该待聚合数据携带的时间戳通过验证。需要说明的是，上述设定时差范围可根据实际应用场景设置，本实施例并不具体限定。一般而言，待聚合数据携带的时间戳与本聚合网关的本地计时间戳的时间差比较小。可以看出，本实施例中，聚合网关在收到待聚合数据后，首先会验证待聚合数据携带的时间戳、计数器值，只有待聚合数据携带的时间戳、计数器值均通过验证后才会进一步对待聚合数据携带的密文进行解密，这保证了数据完整性、机密性。并且，聚合网关是在可信执行环境下执行各步骤，即使聚合网关内部管理员也无法访问该执行过程和结果，可以抵抗重放攻击、伪造攻击、窃听攻击等。可选地，聚合网关在待聚合数据携带的计数器值通过验证后，将本聚合网关的本地计数器值更新为待聚合数据携带的计数器值。步骤104，在可信执行环境下对n个物联网设备的第一类数据分别进行数据脱敏要求下的指定加密处理，并将n个物联网设备的第二类数据和处理后的第一类数据进行聚合，使用所述加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心，以使控制中心使用所述加密密钥K对所述目标密文进行解密；n个物联网设备是指发送的待聚合数据所携带的本地最新计数器值为指定值的物联网设备，n大于1。可选地，在本实施例中，按照如上步骤103的描述，聚合网关会收到很多物联网设备发送的待聚合数据，当接收到任一物联网设备发送的待聚合数据，则执行如步骤103，会得到该物联网设备的第一类数据。假若得到上述n个物联网设备的第一类数据，则如步骤104描述，在可信执行环境下对该n个物联网设备的第一类数据分别进行数据脱敏要求下的指定加密处理，比如以指定加密处理为数据打乱为例，则基于随机打乱函数对n个物联网设备中每一物联网设备的第一类数据进行打乱处理。这种打乱处理方式实质是对物联网设备的第一类数据的修改，以保护物联网设备的第一类数据的安全。在本实施例中，本步骤104中，将n个物联网设备的第二类数据和处理后的第一类数据进行聚合在具体实现时有很多实现方式，比如针对n个物联网设备中每一物联网设备，将该物联网设备的处理后的第一类数据与该物联网设备的第二类数据对应结合，得到结合数据；按照霍纳规则将各物联网设备的结合数据进行聚合。借鉴于霍纳规则本身的细粒度特性，本实施例通过霍纳规则对物联网设备的结合数据进行聚合，相比常规的数据聚合只能得到n个数据的和、以及基于一些方法求得方差而言，本实施例可以保证控制中心直接获得单个物联网设备的物联网数据，这不但可以直接简单计算出数据和、平均值、方差等统计值，同时能够实现智能物联网系统功能的拓展，如异常反馈，弥补单个物联网设备的功能缺陷比如负载预测、精准电费。此外，如负载预测、精准电费等，能更精确的完成数据模型的训练，达到更精准的预测效果，适用于各种场景。需要说明的是，上述将该物联网设备的处理后的第一类数据与该物联网设备的第二类数据对应结合，实质是将该物联网设备的处理后的第一类数据作为该物联网设备的第二类数据的索引，以指示任一个第二类数据对应哪一个第一类数据，但由于任一个第二类数据对应的第一类数据为经由上述指定加密处理比如打乱处理等的第一类数据，即使攻击者在聚合网关传输聚合结果给控制中心的过程中截获该聚合结果，或者控制中心收到聚合结果，其也无法精准知道第一类数据和第二类数据的准确对应关系，保证了物联网设备中敏感数据的安全。至此，完成图1所示流程。通过图1所示流程可以看出，本实施例中，聚合网关基于各物联网设备发送的待聚合数据所携带的计数器值，选择出需要聚合的n个物联网设备，在可信执行环境下对该n个物联网设备的第一类数据分别进行数据脱敏要求下的指定加密处理比如数据打乱等，并将n个物联网设备的第二类数据和处理后的第一类数据进行聚合，使用已与控制中心协商的加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心，这种对n个物联网设备的第一类数据分别进行数据脱敏所要求的指定加密处理，不同于现有差分隐私下添加噪声的处理方式，实现了基于数据脱敏的智能物联网数据聚合，避免由差分隐私引起的问题。进一步地，在本实施例中，聚合网关在监测到任一物联网设备接入物联网时，在可信执行环境下与该物联网设备协商完成初始化，以使本聚合网关的本地计数器值和该物联网设备的本地计数器值同步；之后聚合网关依赖于物联网设备的本地计数器值，选择出需要聚合的n个物联网设备，这并非盲目将所有物联网设备的数据进行聚合，而是将满足要求的n个物联网设备的数据进行聚合，节省资源，且能精准将满足要求的各物联网设备的数据进行聚合。进一步地，本实施例中，聚合网关通过运行可信执行环境，能够抵抗外部攻击。下面对聚合网关如何与控制中心协商加密密钥K进行描述：参见图3，图3为本申请实施例提供的加密密钥K协商流程图。如图3所示，该流程可包括以下步骤：步骤301，控制中心随机选择第一数p和第二数g并公布第一数p和第二数g给聚合网关，并依据第一数p和第二数g、以及随机选择的第二随机数v，按照设定算法计算得到第二值。可选地，在本实施例，这里的第一数p可为一个比较大的素数，以满足密码学协议下第一数p不可在有限时间内通过计算机分解出来的要求。作为一个实施例，第二值可通过下式表示：v2 = gvmod p；v为第二随机数。步骤302，聚合网关基于控制中心通知的第一数p和第二数g，以及随机选择的第一随机数λ，按照设定算法计算得到第一值。参考上述的第二值表达式，第一值可通过下式表示：v1 = gλmod p。步骤303，聚合网关向控制中心发送第一值。步骤304，控制中心向聚合网关发送第二值和T1，T1表示控制中心的本地时间。步骤303和步骤304并没有固定的时间先后顺序。步骤305，聚合网关基于第一值和控制中心发送的第二值，计算参考密钥k，并利用参考密钥k对T1进行加密，得到T2；向控制中心发送T2。步骤306，控制中心基于第二值和聚合网关发送的第一值，计算参考密钥k，并在接收到T2时，使用参考密钥k对所述T2解密得到T3，发现T3与上述T1匹配，则向聚合网关发送确认消息ACK，并基于参考密钥k计算上述加密密钥K。本实施例中，不管是聚合网关还是控制中心，其在计算参考密钥k时，并不解析出上述的第一随机数、第二随机数，而是直接基于第一值和第二值计算，比如借鉴于上述第一值和第二值的表达式，这里可计算第一值和第二值的乘积，依据乘积确定参考密钥k。比如，k = gλνmod p。步骤307，聚合网关接收控制中心发送的确认消息ACK，并利用参考密钥k计算加密密钥K。可选地，在本实施例中，确认消息ACK还可进一步携带控制中心发送该确认消息ACK的时间戳。执行到本步骤307时，聚合网关会先验证该时间戳，比如验证该时间戳和本聚合网关本地的时间戳的时差是否在设定时差范围内，如果是，则确认上述确认消息ACK携带的时间戳通过验证，继续执行上述利用参考密钥k计算加密密钥K的步骤。可选地，在本实施例中，利用参考密钥k计算加密密钥K的方式有很多，比如采用哈希函数对参考密钥k进行处理，得到的结果即为加密密钥K。即：K = H。需要说明的是，聚合网关和控制中心可在步骤306和步骤307之前，预协商使用哪种哈希函数，比如协商使用SHA-256对上述参考密钥k进行哈希，保证哈希函数输入足够长，以避免哈希碰撞攻击。以上对图3所示流程进行了描述。在协商出加密密钥K后，聚合网关会基于初始化本地计数器的计数值Count为预设值比如0。下面对聚合网关在可信执行环境下与物联网设备协商完成初始化的过程进行描述：参见图4，图4为本申请实施例提供的初始化流程图。如图4所示，该流程可包括以下步骤：步骤401，聚合网关接收针对物联网设备的远程认证请求，向物联网设备发送本聚合网关的公钥PKAG。在本实施例中，先借助上述UD向聚合网关发送远程认证请求，以实现聚合网关接收针对物联网设备的远程认证请求。对应地，当聚合网关接收到针对物联网设备的远程认证请求后，其会向UD返回本聚合网关的公钥PKAG。UD收到聚合网关的公钥PKAG后将该公钥PKAG发送给物联网设备，最终实现了聚合网关向物联网设备发送聚合网关的公钥PKAG。步骤402，接收物联网设备发送的第一初始化消息；所述第一初始化消息携带第三数密文；所述第三数密文是利用所述聚合网关的公钥PKAG对所述物联网设备选择的第三数γi进行加密得到。可选地，在本实施例中，物联网设备可使用伪随机数生成器生成一个随机数γi。之后，利用聚合网关的公钥PKAG对第三数γi进行加密得到第三数密文。物联网设备会先将第三数密文携带在第一初始化消息发送给上述UD，由UD将第一初始化消息发送给聚合网关，最终实现了聚合网关接收物联网设备发送的第一初始化消息。步骤403，使用本聚合网关的私钥PKAG对第一初始化消息携带的第三数密文进行解密，得到第四数γi’，将本地时间、第四数γi’以及本地最新计数器值携带在第二初始化消息中发送给所述物联网设备，以使物联网设备在验证所述第四数和所述第三数匹配时，将本地计数器值更新为所述第二初始化消息携带的计数器值，以及将本地时间更新为所述第二初始化消息携带的时间。可选地，在本实施例中，物联网设备在验证第四数和第三数匹配时，则将本地计数器值更新为所述第二初始化消息携带的计数器值，以及将本地时间更新为所述第二初始化消息携带的时间，最终实现了聚合网关在所述可信执行环境下与该物联网设备协商完成初始化。至此，完成图4所示流程。通过图4所示流程实现了聚合网关在可信执行环境下与物联网设备协商完成初始化。需要说明的是，在本实施例中，任一物联网设备发送的待聚合数据进一步携带：密文签名。所述密文签名是物联网设备通过使用物联网私钥ri对上述密文进行签名得到。基于此，本实施例中，上述步骤104中，使用所述加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心进一步包括：对n个物联网设备发送的待聚合数据中的密文签名进行聚合，得到密文签名聚合，将所述密文签名聚合以及n个物联网设备的物联网公钥集合发送给所述控制中心。这里，物联网公钥集合中任一物联网设备的物联网公钥对应该物联网设备对密文进行签名所使用的物联网私钥，所述物联网公钥集合被所述控制中心用于对密文签名聚合进行验证。具体地，当控制中心接收到聚合结果、密文签名聚合、以及n个物联网设备的物联网公钥集合，先使用物联网公钥集合中的各物联网公钥对密文签名聚合中对应的密文签名进行验证，以验证数据完整性。进一步地，本实施例中，使用所述加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心进一步包括：将本地时间戳和本地最新计数器值发送给控制中心。当控制中心在验证出密文签名通过验证后，进一步验证聚合网关发送的时间戳和计数器值，验证方式如步骤103的验证方式类似，不再赘述。之后，控制中心在聚合网关发送的时间戳和计数器值通过验证后，再解密上述聚合结果比如提取相应的霍纳参数，推测出相应的数据明文。在保护隐私的情况，对明文数据进行操作，达到丰富的功能需求比如直接对明文数据进行负载预测、动态定价和数据和、方差计算等功能，计算开销更小。以上对本申请实施例提供的方法进行了描述，下面对本申请实施例提供的装置进行描述：参见图5，图5为本申请实施例提供的装置结构图。该装置应用于聚合网关，所述聚合网关被配置运行以提供可信执行环境，所述可信执行环境禁止聚合网关外部访问，如图5所示，该装置可包括：协商单元，用于与控制中心协商加密密钥K以使聚合网关和控制中心共享加密密钥K；以及，在监测到任一物联网设备接入物联网时，在可信执行环境下与该物联网设备协商完成初始化，以使本聚合网关的时间和该物联网设备的时间同步以及本聚合网关的本地计数器值和该物联网设备的本地计数器值同步；接收单元，用于接收任一物联网设备发送的待聚合数据，在可信执行环境下发现待聚合数据携带的计数器值和时间戳均通过验证，则使用本聚合网关的私钥PKAG对待聚合数据携带的密文进行解密得到物联网数据；其中，任一物联网设备在发送待聚合数据时将本地计数器值增加设定值；任一物联网设备发送的待聚合数据至少携带密文、该物联网设备本地时间戳以及本地最新计数器值；密文是使用聚合网关的公钥PKAG对物联网数据加密得到，物联网数据包括第一类数据和第二类数据；第一类数据为需要保护的敏感数据，第二类数据为非敏感数据；聚合单元，用于在可信执行环境下对n个物联网设备的第一类数据分别进行数据脱敏要求下的指定加密处理，将n个物联网设备的第二类数据和处理后的第一类数据进行聚合，使用所述加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心以使控制中心使用加密密钥K对目标密文进行解密；n个物联网设备是指发送的待聚合数据所携带的本地最新计数器值为指定值的物联网设备，n大于1。作为一个实施例，所述与控制中心协商加密密钥K包括：向所述控制中心发送第一值，并接收所述控制中心发送的第二值和T1；所述T1表示所述控制中心的本地时间；所述第一值是基于本聚合网关选择的第一随机数、所述控制中心选择并通知的第一数p和第二数g按照设定算法计算得到，所述第二值是由所述控制中心选择的第二随机数、所述第一数p和所述第二数g按照设定算法计算得到；基于所述第一值和所述第二值计算参考密钥k，并利用所述参考密钥k对所述T1进行加密，得到T2；向所述控制中心发送T2，以使所述控制中心利用所述第一值和所述第二值计算出的参考密钥k对所述T2解密得到T3；接收所述控制中心发送的确认消息ACK，并利用参考密钥k计算所述加密密钥K；所述ACK是所述控制中心在所述T3与所述T1匹配时发送的；所述控制中心在所述T3与所述T1匹配时还用于基于所述参考密钥k计算所述加密密钥K。作为一个实施例，所述第一值通过下式表示：v1 = gλmod p；λ为第一随机数；所述第二值通过下式表示：v2 = gvmod p；v为第二随机数；所述基于所述第一值和所述第二值计算参考密钥k包括：计算所述第一值和所述第二值的乘积，依据所述乘积确定所述参考密钥k。作为一个实施例，在所述可信执行环境下与该物联网设备协商完成初始化包括：接收针对物联网设备的远程认证请求，并向所述物联网设备发送本聚合网关的公钥PKAG；接收所述物联网设备发送的第一初始化消息；所述第一初始化消息携带第三数密文；所述第三数密文是利用所述聚合网关的公钥PKAG对所述物联网设备选择的第三数γi进行加密得到；使用本聚合网关的私钥PKAG对所述第一初始化消息携带的第三数密文进行解密，得到第四数γi’，将本地时间、第四数以及本地最新计数器值携带在第二初始化消息中发送给所述物联网设备，以使所述物联网设备在验证所述第四数和所述第三数匹配时，将本地计数器值更新为所述第二初始化消息携带的计数器值，以及将本地时间更新为所述第二初始化消息携带的时间。作为一个实施例，所述在可信执行环境下对n个物联网设备的第一类数据分别进行指定加密处理包括：针对n个物联网设备中每一物联网设备的第一类数据，基于随机打乱函数对该第一类数据进行打乱处理。作为一个实施例，所述将n个物联网设备的第二类数据和处理后的第一类数据进行聚合包括：针对n个物联网设备中每一物联网设备，将该物联网设备的处理后的第一类数据与该物联网设备的第二类数据对应结合，得到结合数据；按照霍纳规则将各物联网设备的结合数据进行聚合。作为一个实施例，所述待聚合数据进一步携带：密文签名，所述密文签名是物联网设备通过使用物联网私钥ri对所述密文进行签名得到；使用所述加密密钥K对聚合结果进行加密得到目标密文并发送给控制中心进一步包括：对n个物联网设备发送的待聚合数据中的密文签名进行聚合，得到密文签名聚合，将所述密文签名聚合以及n个物联网设备的物联网公钥集合发送给所述控制中心；物联网公钥集合中任一物联网设备的物联网公钥对应该物联网设备对密文进行签名所使用的物联网私钥，所述物联网公钥集合被所述控制中心用于对密文签名聚合进行验证。至此，完成图5所示装置的结构描述。对应地，本申请实施例还提供了图5所示装置的硬件结构图，具体如图6所示，该电子设备可以为上述实施方法的设备。如图6所示，该硬件结构包括：处理器和存储器。其中，所述存储器，用于存储机器可执行指令；所述处理器，用于读取并执行所述存储器存储的机器可执行指令，以实现如上所示的方法实施例。作为一个实施例，存储器可以是任何电子、磁性、光学或其它物理存储装置，可以包含或存储信息，如可执行指令、数据，等等。例如，存储器可以是：易失存储器、非易失性存储器或者类似的存储介质。具体地，存储器可以是RAM、闪存、存储驱动器、固态硬盘、任何类型的存储盘，或者类似的存储介质，或者它们的组合。基于同样的发明构思，本实施例还提供了计算机可读存储介质。该计算机可读存储介质，用于存储计算机程序；该计算机程序被处理器执行时实现如上所述的方法实施例。基于同样的发明构思，本实施例还提供了计算机程序产品，所述计算机程序产品内存储有计算机程序，所述计算机程序被处理器执行时实现如上所述的方法实施例。上述对本申请特定实施例进行了描述。其它实施例在所附权利要求书的范围内。在一些情况下，在权利要求书中记载的动作或步骤可以按照不同于实施例中的顺序来执行并且仍然可以实现期望的结果。另外，在附图中描绘的过程不一定要求示出的特定顺序或者连续顺序才能实现期望的结果。在某些实施方式中，多任务处理和并行处理也是可以的或者可能是有利的。本领域技术人员在考虑说明书及实践这里申请的发明后，将容易想到本申请的其它实施方案。本申请旨在涵盖本申请的任何变型、用途或者适应性变化，这些变型、用途或者适应性变化遵循本申请的一般性原理并包括本申请未申请的本技术领域中的公知常识或惯用技术手段。说明书和实施例仅被视为示例性的，本申请的真正范围和精神由下面的权利要求指出。应当理解的是，本申请并不局限于上面已经描述并在附图中示出的精确结构，并且可以在不脱离其范围进行各种修改和改变。本申请的范围仅由所附的权利要求来限制。以上所述仅为本申请的较佳实施例而已，并不用以限制本申请，凡在本申请的精神和原则之内，所做的任何修改、等同替换、改进等，均应包含在本申请保护的范围之内。
