标题title
心跳包通信方法、测试系统、终端设备及存储介质
摘要abst
本发明涉及通信领域，公开了一种心跳包通信方法、测试系统、终端设备及存储介质，所述方法包括：定时生成第一心跳包，并向所述第一心跳包内写入上位机的标识码；将所述第一心跳包发送给待测设备；当在预设时间内接收到第二心跳包时，获取所述第二心跳包内的标识码，根据所述第二心跳包内的标识码，确定所述上位机和所述待测设备之间的通信是否正常，若正常则继续维持通信。通过心跳包中包含的标识码，可以快速的定位通信中的问题，并稳定通信连接。
权利要求书clms
1.一种心跳包通信方法，其特征在于，应用于上位机，所述方法包括：定时生成第一心跳包，并向所述第一心跳包内写入所述上位机的标识码；将所述第一心跳包发送给待测设备；当在预设时间内接收到第二心跳包时，获取所述第二心跳包内的标识码，根据所述第二心跳包内的标识码，确定所述上位机和所述待测设备之间的通信是否正常，若正常则继续维持通信。2.根据权利要求1所述的心跳包通信方法，其特征在于，所述上位机和所述待测设备通过多个中间通信节点进行网络通信；所述根据所述第二心跳包内的标识码，确定所述上位机和所述待测设备之间的通信是否正常，包括：确定所述标识码是否包括所有中间通信节点的标识码，若所述标识码有缺失，则确定通信异常，并根据缺失的标识码，对通信异常进行定位。3.根据权利要求1所述的心跳包通信方法，其特征在于，还包括：若所述上位机在所述预设时间内没有接收到所述第二心跳包，则确定和所述待测设备的通信连接异常，并自动断开和所述待测设备的通信连接。4.一种心跳包通信方法，其特征在于，应用于中间通信节点，包括：当接收到来自上位机或待测设备的心跳包时，在所述心跳包中追加所述中间通信节点的标识码，然后将所述心跳包转发给下一跳的通信节点；若超过预设时间没有接收到来自所述待测设备的第二心跳包，则自身产生相应的第二心跳包，并将所述第二心跳包通过其他中间通信节点发送给所述上位机。5.根据权利要求4所述的心跳包通信方法，其特征在于，所述中间通信节点包括服务器、路由器、所述上位机的通信代理服务和所述待测设备的通信代理服务。6.一种心跳包通信方法，其特征在于，应用于待测设备，包括：当在预设时间内接收到第一心跳包后，根据所述第一心跳包中的标识码，确定上位机和所述待测设备之间的网络通信是否正常；若正常，则生成第二心跳包，并在所述第二心跳包中写入所述待测设备的标识码；将所述第二心跳包发送给所述上位机。7.根据权利要求6所述的心跳包通信方法，其特征在于，还包括：若在所述预设时间内没接收到所述第一心跳包，确认所述上位机断开连接，且不生成所述第二心跳包。8.一种测试系统，其特征在于，包括：上位机、待测设备和多个中间通信节点，所述上位机和所述待测设备通过所述多个中间通信节点进行网络通信；所述上位机定时生成第一心跳包，并向所述第一心跳包内写入所述上位机的标识码；将所述第一心跳包通过所述上位机的通信代理服务发送给所述待测设备；所述多个中间通信节点接收到所述第一心跳包时，将所述上位机的标识码追加写入所述第一心跳包中，并转发至下一个通信节点；所述待测设备在预设时间内接收到第一心跳包后，根据所述第一心跳包中的标识码，确定上位机和所述待测设备之间的网络通信是否正常；若正常，则生成第二心跳包，并在所述第二心跳包中写入所述待测设备的标识码；将所述第二心跳包发送给所述上位机；若所述中间通信节点超过预设时间没有接收到来自所述待测设备的第二心跳包，则所述中间通信节点产生相应的第二心跳包，并将所述第二心跳包通过其他中间通信节点发送给所述上位机；当所述上位机在所述预设时间内接收到来自所述上位机的通信代理服务转发的第二心跳包时，获取所述第二心跳包内的标识码，根据所述第二心跳包内的标识码，确定所述上位机和所述待测设备之间的通信是否正常，若正常则继续维持通信。9.一种终端设备，其特征在于，包括处理器和存储器，所述存储器存储有计算机程序，所述计算机程序在所述处理器上运行时执行权利要求1至7中任一项所述的心跳包通信方法。10.一种可读存储介质，其特征在于，其存储有计算机程序，所述计算机程序在处理器上运行时执行权利要求1至7中任一项所述的心跳包通信方法。
说明书desc
技术领域本发明涉及通信领域，尤其涉及一种心跳包通信方法、测试系统、终端设备及存储介质。背景技术如果有些人为控制的指令，例如在PC端有一个控制设备端的按钮，但这个不确定人什么时候按，如果超过了Socket TCP接收超时与发送超时，测试员想按时所有通信已经断开了，已经无法通信，只能重新通信，非常耗时；这种机制只适合频繁接发数据的系统，所以使用场景很受限制，通用性低；只是关闭与释放，如果出现网络问题无法提示是哪里通信出问题，测试员难以定位问题。发明内容第一方面，本申请提供一种心跳包通信方法，应用于上位机，所述方法包括：定时生成第一心跳包，并向所述第一心跳包内写入所述上位机的标识码；将所述第一心跳包发送给待测设备；当在预设时间内接收到第二心跳包时，获取所述第二心跳包内的标识码，根据所述第二心跳包内的标识码，确定所述上位机和所述待测设备之间的通信是否正常，若正常则继续维持通信。进一步的，所述上位机和所述待测设备通过多个中间通信节点进行网络通信；所述根据所述第二心跳包内的标识码，确定所述上位机和所述待测设备之间的通信是否正常，包括：确定所述标识码是否包括所有中间通信节点的标识码，若所述标识码有缺失，则确定通信异常，并根据缺失的标识码，对通信异常进行定位。进一步的，所述方法还包括：若所述上位机在所述预设时间内没有接收到所述第二心跳包，则确定和所述待测设备的通信连接异常，并自动断开和所述待测设备的通信连接。第二方面，本申请还提供一种心跳包通信方法，应用于中间通信节点，包括：当接收到来自上位机或待测设备的心跳包时，在所述心跳包中追加所述中间通信节点的标识码，然后将所述心跳包转发给下一跳的通信节点；若超过预设时间没有接收到来自所述待测设备的第二心跳包，则自身产生相应的第二心跳包，并将所述第二心跳包通过其他中间通信节点发送给所述上位机。进一步的，所述中间通信节点包括服务器、路由器、所述上位机的通信代理服务和所述待测设备的通信代理服务。第三方面，本申请还提供一种心跳包通信方法，应用于待测设备，包括：当在预设时间内接收到第一心跳包后，根据所述第一心跳包中的标识码，确定上位机和所述待测设备之间的网络通信是否正常；若正常，则生成第二心跳包，并在所述第二心跳包中写入所述待测设备的标识码；将所述第二心跳包发送给所述上位机。进一步的，所述方法还包括：若在所述预设时间内没接收到所述第一心跳包，确认所述上位机断开连接，且不生成所述第二心跳包。第四方面，本申请还提供一种测试系统，包括：上位机、待测设备和多个中间通信节点，所述上位机和所述待测设备通过所述多个中间通信节点进行网络通信；所述上位机定时生成第一心跳包，并向所述第一心跳包内写入所述上位机的标识码；将所述第一心跳包通过所述上位机的通信代理服务发送给所述待测设备；所述多个中间通信节点接收到所述第一心跳包时，将所述上位机的标识码追加写入所述第一心跳包中，并转发至下一个通信节点；所述待测设备在预设时间内接收到第一心跳包后，根据所述第一心跳包中的标识码，确定上位机和所述待测设备之间的网络通信是否正常；若正常，则生成第二心跳包，并在所述第二心跳包中写入所述待测设备的标识码；将所述第二心跳包发送给所述上位机；若所述中间通信节点超过预设时间没有接收到来自所述待测设备的第二心跳包，则所述中间通信节点产生相应的第二心跳包，并将所述第二心跳包通过其他中间通信节点发送给所述上位机；当所述上位机在所述预设时间内接收到来自所述上位机的通信代理服务转发的第二心跳包时，获取所述第二心跳包内的标识码，根据所述第二心跳包内的标识码，确定所述上位机和所述待测设备之间的通信是否正常，若正常则继续维持通信。第五方面，本申请还提供一种终端设备，包括处理器和存储器，所述存储器存储有计算机程序，所述计算机程序在所述处理器上运行时执行所述的心跳包通信方法。第六方面，本申请还提供一种可读存储介质，其存储有计算机程序，所述计算机程序在处理器上运行时执行所述的心跳包通信方法。本申请公开了一种心跳包通信方法、测试系统、终端设备及存储介质，所述方法包括：定时生成第一心跳包，并向所述第一心跳包内写入所述上位机的标识码；将所述心跳包通过自身的通信代理服务发送给待测设备；当在预设时间内接收到来自所述通信代理服务转发的第二心跳包时，获取所述第二心跳包内的标识码，根据所述标识码，确定所述上位机和所述待测设备之间的通信是否正常，若正常则继续维持通信。通过心跳包中包含的标识码，可以快速的定位通信中的问题，并通过心跳包稳定通信连接，使得在通信交互频率较低的工作场景中，可以保持上位机和待测设备之间的连接，并且当通信出问题时及时发现出现问题的环节。附图说明为了更清楚地说明本发明的技术方案，下面将对实施例中所需要使用的附图作简单地介绍，应当理解，以下附图仅示出了本发明的某些实施例，因此不应被看作是对本发明保护范围的限定。在各个附图中，类似的构成部分采用类似的编号。图1示出了本申请实施例一种测试系统结构示意图；图2示出了本申请实施例应用于上位机的一种心跳包通信方法流程示意图；图3示出了本申请实施例一种测试系统通信关系示意图；图4示出了本申请实施例应用于待测设备的一种心跳包通信方法流程示意图；图5示出了本申请实施例应用于中间通信节点的一种心跳包通信方法流程示意图。具体实施方式下面将结合本发明实施例中附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。通常在此处附图中描述和示出的本发明实施例的组件可以以各种不同的配置来布置和设计。因此，以下对在附图中提供的本发明的实施例的详细描述并非旨在限制要求保护的本发明的范围，而是仅仅表示本发明的选定实施例。基于本发明的实施例，本领域技术人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。在下文中，可在本发明的各种实施例中使用的术语“包括”、“具有”及其同源词仅意在表示特定特征、数字、步骤、操作、元件、组件或前述项的组合，并且不应被理解为首先排除一个或更多个其它特征、数字、步骤、操作、元件、组件或前述项的组合的存在或增加一个或更多个特征、数字、步骤、操作、元件、组件或前述项的组合的可能性。此外，术语“第一”、“第二”、“第三”等仅用于区分描述，而不能理解为指示或暗示相对重要性。除非另有限定，否则在这里使用的所有术语具有与本发明的各种实施例所属领域普通技术人员通常理解的含义相同的含义。所述术语将被解释为具有与在相关技术领域中的语境含义相同的含义并且将不被解释为具有理想化的含义或过于正式的含义，除非在本发明的各种实施例中被清楚地限定。本申请的技术方案应用于测试系统中的通信过程，通过在发送的心跳包中写入各个设备以及中间通信节点的标识码，以确定当前的通信通路是否正常，并且通过设定预设时间来实现超时机制，使得测试系统中的设备可以自动确定通信是否出现问题以及通信是否断开。使得特使系统中的上位机以及待测设备之间可以通过心跳包维持通信连接，在低频率的通信场景中也可以维持通信，同时通过心跳包中的标识码，可以快速定位出现通信异常的设备或通信节点的位置，从而帮助工作人员快速定位通信问题。接下来以具体实施例说明本申请的技术方案。实施例1如图1所示，为本实施例提供的一种测试系统，该测试系统包括：上位机100、待测设备200和多个中间通信节点300，所述上位机100和所述待测设备200通过所述多个中间通信节点300进行互联网通信。通信协议可以是常见的TCP协议也可以是其他协议。该测试系统可以认为是自动化测试系统，其中，测试时大多数时间都是由测试程序控制待测设备进行测试操作，作为控制测试流程的上位机大多数时间都是监控以及下达测试命令，因此上位机和待测设备之间的交互不会很频繁，所以会存在网络因为长久时间没有通信而断开的情况。其中所述多个中间通信节点300表示构建上位机100与待测设备200通信链路中的一系列通信节点，例如提供互联网服务的服务器，用于上位机和待测设备对外通信的通信代理服务，以及在通信链路中所使用到的路由设备等设备节点等，因此会有多个不同种类的中间通信节点。上位机100为电脑或者用于测试的测试机器，待测设备200则是需要进行测试的设备主体。在进行测试时，上位机100通过多个中间通信节点300和待测设备200进行网络通信。其中，在建立通信后，为了维持通信链路，本实施例的上位机会定时生成第一心跳包，并向所述第一心跳包内写入所述上位机的标识码；第一心跳包会通过上位机的通信代理服务发送给待测设备，该心跳包会在上述的多个中间通信节点300之间进行转发。其中，本申请的第一心跳包中会包含设备的标识码，及对该心跳包进行转发和发送操作的设备或者中间通信节点都会往该心跳包中写入自身的标识码，例如上位机100的标识码为1，中间通信节点中服务器的标识码为2，待测设备200的标识码为3，则上位机向待测设备200发送标识码后，待测设备应当会收到包含标识码为12的心跳包。同样的，待测设备200在预设时间内接收到来自上位机的第一心跳包后，会回复一个第二心跳包，该第二心跳包中也会存有各个转发该第二心跳包的标识码。可以理解，因为心跳包是一种按照一定预设时间，规律性发送的数据包，所以当中间通信设备超过预设时间没有收到来自上位机的第一心跳包，则可以认为通信链路中出现异常，因此当上位机在预设时间内没有收到第二心跳包或者收到的第二心跳包内的标识码有残缺，就可以确认当前的通信链路有异常。同样的，待测设备若是没有在预设时间内收到第一心跳包或者收到的第一心跳包内的标识码残缺，也可以判断出当前的通信链路异常，然后可以实时的进行告警等操作。同时因为心跳包内保存了标识码，而通信链路是固定的，因此可以通过标识码来确定通信出现异常的原因。例如中间通信节点有两个，其标识码为2和3，上位机的标识码为1，待测设备的标识码为4，则从上位机传输到待测设备的第一心跳包中的标识码应当为“123”，从待测设备传输到上位机的标识码就应该是“432”。其中，中间通信节点在上述的预设时间内没有接收到第二心跳包，则会自身产生相应的第二心跳包，并将第二心跳包通过其他中间通信节点发送给所述上位机。例如标识码为3的中间通信节点在预设时间内没有收到第二心跳包，则中间通信节点会判断待测设备的网络通信出了问题，此时该中间通信节点就会自己产生一个第二心跳包，并将该第二心跳包发送给上位机，若是接下来的链路通畅，则上位机会受到标识码为“32”的心跳包，则上位机可以判断到是标识为4的测试设备网络通信异常，通信连接已经断开，此时再发第一心跳包也没有意义，则不用再发第一心跳包。可见，通过上述心跳包携带的信息，可以在通信出现异常时快速定位异常的位置，以便更好的定位异常原因，同时也可以通过心跳包来维持测试系统中上位机和待测设备之间的网络连接，在低频率交互的环境中，依旧保持设备之间的网络通信。实施例2本实施例提供一种心跳包通信方法，其可应用于上述的测试系统中，如图2所示，在上位机中，本实施例的心跳包通信方法包括：步骤S100，定时生成第一心跳包，并向所述第一心跳包内写入所述上位机的标识码；为了更好的说明本实施例的通信方法，本实施例给出如图3所示的一种测试系统结构示意图，其中的第一通信代理服务301为隶属于上位机100内部的用于通信的代理服务，第二通信代理服务303为待测设备200内部的用于通信的代理服务，服务器302用于提供互联网连接。且第一通信代理服务301、服务器302和第二通信代理服务303都属于中间通信节点300中的一员。上位机100在测试系统中为整个测试的主导方，其主要是用于向待测设备200下达测试指令，监控测试流程以及获取测试数据，所以上位机需要主动的维护自身和待测设备之间的网络连接。因此，本实施例中的上位机会定时生成第一心跳包，其中，本实施例的第一心跳包和后续的第二心跳包结构一样，都是包含有标识码的心跳包，上位机在发出第一心跳包时，会将自身的标识码写入心跳包中，标识该心跳包经过该标识码表示的设备发送或转发。本实施例中，为了方便说明，上位机的标识码为1，第一通信代理服务的表示码为2，服务器的标识码为3，第二通信代理服务的标识码为4，待测设备的标识码为5。步骤S200，将所述第一心跳包发送给待测设备。为了发送心跳包，上位机100会将该第一心跳包交给第一通信代理服务301，第一通信代理服务301接收到该心跳包后，会在该心跳包中追加自身的标识码。然后再转发给待测设备。而如图3所示，因为上位机和待测设备之间通过互联网通信，因此为了能转发给待测设备，需要将该心跳包先转发给服务器，再由服务器转发给第二通信代理服务，最后再转发给待测设备。步骤S300，当在预设时间内接收到第二心跳包时，获取所述第二心跳包内的标识码，根据所述第二心跳包内的标识码，确定所述上位机和所述待测设备之间的通信是否正常，若正常则继续维持通信。上位机100所接收到的第二心跳包基本都是由第一通信代理服务转发过来的，同样的，通过识别其中的标识码就可以确定当前和待测设备的网络通信是否正常。如过第二心跳包中的标识码为“5432”，则标识通信链路正常，则可以进行正常的网络通信并周期性发送第一心跳包。若是接收到的第二心跳包如步骤S600中所示的为“432”，则可以直接发现却好了标识码为5的待测设备，由此可以直接确认待测设备的网络通信出了问题。其次，若标识码为“32”，则表示整个通信链路中第二通信代理服务出现了故障，而待测设备可能出现了故障，因为若是第二通信代理服务没有通信问题，则其可以自发的发送第二心跳包至服务器302，则收到的第二心跳包中应当会存在标识码4。根据上述两个例子可知，通过心跳包中标识码的不同，可以简单轻易的判断出整个通信链路中出现问题的环节在哪里，这样也方便测试人员去定位问题。其中，还会存在上位机在预设时间内没有收到第二心跳包，则此时可以确定当前链路存在通信异常，此时无法正常通信，因此可以断开连接通信连接，且可以向工作人员进行告警，后续也不必发送第一心跳包。如图4所示，为本实施例待测设备所示执行的心跳包通信方法，包括：步骤S400，当在预设时间内接收到第一心跳包后，根据所述第一心跳包中的标识码，确定上位机和所述待测设备之间的网络通信是否正常；若正常，则生成第二心跳包，并在所述第二心跳包中写入所述待测设备的标识码。待测设备接收到上位机的第一心跳包后，可以读取其中的标识码，如前述步骤所述，链路完整无异常时，第一心跳包应当携带有“1234”这个顺序的标识符，若第一心跳包中系带的标识符不是这个顺序，或者缺少标识符等情况，则标识网络异常，无法正常通信，则也没有继续发送第二心跳包的必要，因为必然无法发送过去，若是这个标识符，则表示正常通信，则待测设备可以生成第二心跳包作为一个应答包。步骤S500，将所述第二心跳包发送给所述上位机。第二心跳包也会沿着相同的通信链路发送给上位机，区别于第一心跳包抵达待测设备时的标识符，当第二心跳包顺利抵达上位机时，其所经过的中间通信节点的顺序和第一心跳包不同，因此第二心跳包所携带的标识符应当为“5432”的顺序。如图5所示，为本实施例中间通信节点所示执行的心跳包通信方法，包括：步骤S600，当接收到来自上位机或待测设备的心跳包时，在所述心跳包中追加所述中间通信节点的标识码，然后将所述心跳包转发给下一跳的通信节点；本实施例中的中间通信节点有三个，因此当第一心跳包从上位机发出后，会依次经过第一通信代理服务、服务器和第二通信代理服务，在上位机和待测设备之间建立通信连接后，这条通信链路基本是固定的，除了心跳包，一些交互数据也会按照该链路来进行交互传输，因此在通信链路完整无异常时，第一心跳包会在携带有“1234”这个顺序的标识符抵达待测设备。步骤S700，若超过预设时间没有接收到来自所述待测设备的第二心跳包，则自身产生相应的第二心跳包，并将所述第二心跳包通过其他中间通信节点发送给所述上位机。心跳包是周期性定时发送的，因此对于中间通信节点来讲，第一心跳包和第二心跳包应该是周期性的接收到的，因此对于这些中间通信节点来讲，若是在该时间周期内没有接收到心跳包，则表示通信链路断开或者出了问题。其中，当任意中间通信节点在预设时间内没有收到第二心跳包时，可以判断出待测设备至自身的这段通信链路可能出了问题，则此时该中间通信节点就会产生一个第二心跳包，然后将该第二心跳包发送给上位机。其中，可以通过设置计时器来计算是否到达预设时间。同样的，由中间通信节点所产生的第二心跳包也会写入自身的标识符，例如，若是待测设备200故障导致无法发送第二心跳包，则作为中间节点的第二通信代理服务303会首先发现第二心跳包没有发送过来，此时第二通信代理服务会自发的产生一个第二心跳包，并将该第二心跳包向上位机100发送过去。若是接下来的链路通畅，则该第二心跳包会经过服务器302和第一通信代理服务301抵达上位机100，此时该第二心跳包中所记载标识符就应当是“432”。其中如前述步骤所述的，上位机在整个测试系统中是主导方，因此上位机方面发出的第一心跳包若是没有在预设时间内收到，表示上位机方面主动断开了连接，此时中间通信节点便可以直接断开与待测设备之间的通信连接。并且也不需要向待测设备发送第一心跳包，因此上位机断开连接后不必通过心跳包维持通信连接，待测设备可以通过自身的超时判断来确定连接断开。结合上述步骤S100至步骤S700可知，本实施例的心跳包通信方法中，心跳包从上位机或待测设备发送往对端设备时，会携带上通信路径中所经过的所有设备的标识符，上位机以及待测设备可以根据标识符的内容，轻易判断出当前的通信链路是否正常，不必等待超时再执行断开连接的操作，并且根据标识符的内容，也可以快速的定位链路中的问题。使得再交互频次低的测试系统中，通过心跳包维护通信连接的同时，也提供了通信问题的追溯方法，使得测试人员对测试系统的掌控程度更强。本申请还提供一种终端设备，包括处理器和存储器，所述存储器存储有计算机程序，所述计算机程序在所述处理器上运行时执行所述的心跳包通信方法。本申请还提供 一种可读存储介质，其存储有计算机程序，所述计算机程序在处理器上运行时执行所述的心跳包通信方法。在本申请所提供的几个实施例中，应该理解到，所揭露的装置和方法，也可以通过其它的方式实现。以上所描述的装置实施例仅仅是示意性的，例如，附图中的流程图和结构图显示了根据本发明的多个实施例的装置、方法和计算机程序产品的可能实现的体系架构、功能和操作。在这点上，流程图或框图中的每个方框可以代表一个模块、程序段或代码的一部分，所述模块、程序段或代码的一部分包含一个或多个用于实现规定的逻辑功能的可执行指令。也应当注意，在作为替换的实现方式中，方框中所标注的功能也可以以不同于附图中所标注的顺序发生。例如，两个连续的方框实际上可以基本并行地执行，它们有时也可以按相反的顺序执行，这依所涉及的功能而定。也要注意的是，结构图和/或流程图中的每个方框、以及结构图和/或流程图中的方框的组合，可以用执行规定的功能或动作的专用的基于硬件的系统来实现，或者可以用专用硬件与计算机指令的组合来实现。另外，在本发明各个实施例中的各功能模块或单元可以集成在一起形成一个独立的部分，也可以是各个模块单独存在，也可以两个或更多个模块集成形成一个独立的部分。所述功能如果以软件功能模块的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本发明的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台计算机设备执行本发明各个实施例所述方法的全部或部分步骤。而前述的存储介质包括：U盘、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质。以上所述，仅为本发明的具体实施方式，但本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，可轻易想到变化或替换，都应涵盖在本发明的保护范围之内。
