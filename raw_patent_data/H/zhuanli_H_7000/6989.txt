标题title
一种解码功率传输协议信息包的方法、装置及设备
摘要abst
本申请属于解码技术领域，公开了一种解码功率传输协议信息包的方法、装置及设备，该方法包括：根据预设捕获规则对PD信号进行捕获，得到多个信号脉宽；将第一时间长度的信号脉宽解码为第一识别码，将第二时间长度的信号脉宽解码为第二识别码，将第三时间长度的信号脉宽解码为第三识别码，得到识别码串；将识别码串中第一个第一识别码作为标准码，检测标准码的前一个识别码是否为第三识别码；若是，则根据第一处理规则对识别码串进行处理，得到信号特征信息；若不是，则根据第二处理规则对识别码串进行处理，得到信号特征信息。本申请可以达到有效降低解码功率传输协议信息包的成本的效果。
权利要求书clms
1.一种解码功率传输协议信息包的方法，其特征在于，所述方法包括：根据预设捕获规则对PD信号进行捕获，得到多个信号脉宽；将第一时间长度的所述信号脉宽解码为第一识别码，将第二时间长度的所述信号脉宽解码为第二识别码，将第三时间长度的所述信号脉宽解码为第三识别码，得到识别码串；将所述识别码串中第一个所述第一识别码作为标准码，检测所述标准码的前一个识别码是否为所述第三识别码；若是，则根据第一处理规则对所述识别码串进行处理，得到信号特征信息；若不是，则根据第二处理规则对所述识别码串进行处理，得到所述信号特征信息。2.根据权利要求1所述的方法，其特征在于，所述根据预设捕获规则对PD信号进行捕获，得到多个信号脉宽，包括：将所述PD信号的波形中连续两次相同边沿跳变之间的时间间隔作为一个所述信号脉宽。3.根据权利要求1所述的方法，其特征在于，所述信号特征信息包括通信类型信息；所述根据第一处理规则对所述识别码串进行处理，得到信号特征信息，包括：检测所述标准码后的第4个识别码是否为所述第三识别码；若是，则所述通信类型信息为第三通信类型；若不是，则检测所述标准码后的第7个识别码是否为第一识别码，若是，则所述通信类型信息为第一通信类型，若不是，则所述通信类型信息为第二通信类型。4.根据权利要求1所述的方法，其特征在于，所述信号特征信息包括通信类型信息；所述根据第二处理规则对所述识别码串进行处理，得到所述信号特征信息，包括：检测所述标准码后的第3个识别码是否为所述第三识别码；若是，则所述通信类型信息为第三通信类型；若不是，则检测所述标准码后的第7个识别码是否为第一识别码，若是，则所述通信类型信息为第一通信类型，若不是，则所述通信类型信息为第二通信类型。5.根据权利要求1所述的方法，其特征在于，所述第一时间长度为6.6微秒，所述第二时间长度为5微秒，所述第三时间长度为3.3微秒。6.根据权利要求1所述的方法，其特征在于，所述信号特征信息包括通信对话序列编号；所述根据第一处理规则对所述识别码串进行处理，得到信号特征信息，包括：将在所述标准码后，与所述标准码间隔30bit的所述识别码作为起始码，与所述标准码间隔35bit的所述识别码作为结束码；将所述起始码至所述结束码之间的多个所述识别码进行并码处理，得到5bit码串；对所述5bit码串进行处理，得到所述通信对话序列编号。7.根据权利要求1所述的方法，其特征在于，所述信号特征信息包括通信对话序列编号；所述根据第二处理规则对所述识别码串进行处理，得到所述信号特征信息，包括：将在所述标准码后，与所述标准码间隔29bit的所述识别码作为起始码，与所述标准码间隔34bit的所述识别码作为结束码；将所述起始码至所述结束码之间的多个所述识别码进行并码处理，得到5bit码串；对所述5bit码串进行处理，得到所述通信对话序列编号。8.根据权利要求6-7任一项所述的方法，其特征在于，所述对所述5bit码串进行处理，得到所述通信对话序列编号，包括：将所述5bit码串进行逆序操作，得到逆序5bit码串；将所述逆序5bit码串转换为4bit码串，将所述4bit码串中的高位3bit编码作为所述通信对话序列编号。9.一种解码功率传输协议信息包的装置，其特征在于，应用于解码设备，所述装置包括：信号脉宽获取模块，用于根据预设捕获规则对PD信号进行捕获，得到多个信号脉宽；解码模块，用于将第一时间长度的所述信号脉宽解码为第一识别码，将第二时间长度的所述信号脉宽解码为第二识别码，将第三时间长度的所述信号脉宽解码为第三识别码，得到识别码串；信号特征信息获取模块，用于将所述识别码串中第一个所述第一识别码作为标准码，检测所述标准码的前一个识别码是否为所述第三识别码；若是，则根据第一处理规则对所述识别码串进行处理，得到信号特征信息；若不是，则根据第二处理规则对所述识别码串进行处理，得到所述信号特征信息。10.一种计算机设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，其特征在于，所述处理器执行所述计算机程序时实现如权利要求1至8中任一项所述方法的步骤。
说明书desc
技术领域本申请涉及解码技术领域，尤其涉及一种解码功率传输协议信息包的方法、装置及设备。背景技术一般接收到供电端发出的PD信息包中会包括供电端此次通信时跟哪方通信，供电端的供电能力、地址等信息。在接收到供电端发出功率传输协议信息包后约500微秒内需要回复对方，否则本次通信失败；因为编码后的PD信号的码串比较长，解码需要时间多，为避免超时，需要先通过识别PD信号中的信号特征信息来判断对方是否是需要跟本方进行通信，以及若是跟本方进行通信，本方回复对方时的通信对话序列编号等。而现有技术中为了获取这些信号特征信息，通常采用硬解码方式，即将解码功能集成在芯片内部，但这会使得芯片设计的过程长，风险高，芯片价格贵。因此现有技术中存在解码功率传输协议信息包的成本高的问题。发明内容本申请提供了一种解码功率传输协议信息包的方法、装置及设备，能够有效降低解码功率传输协议信息包的成本。第一方面，本申请实施例提供了一种解码功率传输协议信息包的方法，该方法应用于解码设备，该方法包括：根据预设捕获规则对PD信号进行捕获，得到多个信号脉宽；将第一时间长度的信号脉宽解码为第一识别码，将第二时间长度的信号脉宽解码为第二识别码，将第三时间长度的信号脉宽解码为第三识别码，得到识别码串；将识别码串中第一个第一识别码作为标准码，检测标准码的前一个识别码是否为第三识别码；若是，则根据第一处理规则对识别码串进行处理，得到信号特征信息；若不是，则根据第二处理规则对识别码串进行处理，得到信号特征信息。进一步的，上述根据预设捕获规则对PD信号进行捕获，得到多个信号脉宽，包括：将PD信号的波形中连续两次相同边沿跳变之间的时间间隔作为一个信号脉宽。进一步的，信号特征信息包括通信类型信息；上述根据第一处理规则对识别码串进行处理，得到信号特征信息，包括：检测标准码后的第4个识别码是否为第三识别码；若是，则通信类型信息为第三通信类型；若不是，则检测标准码后的第7个识别码是否为第一识别码，若是，则通信类型信息为第一通信类型，若不是，则通信类型信息为第二通信类型。进一步的，信号特征信息包括通信类型信息；上述根据第二处理规则对识别码串进行处理，得到信号特征信息，包括：检测标准码后的第3个识别码是否为第三识别码；若是，则通信类型信息为第三通信类型；若不是，则检测标准码后的第7个识别码是否为第一识别码，若是，则通信类型信息为第一通信类型，若不是，则通信类型信息为第二通信类型。进一步的，第一时间长度为6.6微秒，第二时间长度为5微秒，第三时间长度为3.3微秒。进一步的，信号特征信息包括通信对话序列编号；上述根据第一处理规则对识别码串进行处理，得到信号特征信息，包括：将在标准码后，与标准码间隔30bit的识别码作为起始码，与标准码间隔35bit的识别码作为结束码；将起始码至结束码之间的多个识别码进行并码处理，得到5bit码串；对5bit码串进行处理，得到通信对话序列编号。进一步的，信号特征信息包括通信对话序列编号；上述根据第二处理规则对识别码串进行处理，得到信号特征信息，包括：将在标准码后，与标准码间隔29bit的识别码作为起始码，与标准码间隔34bit的识别码作为结束码；将起始码至结束码之间的多个识别码进行并码处理，得到5bit码串；对5bit码串进行处理，得到通信对话序列编号。进一步的，上述对5bit码串进行处理，得到通信对话序列编号，包括：将5bit码串进行逆序操作，得到逆序5bit码串；将逆序5bit码串转换为4bit码串，将4bit码串中的高位3bit编码作为通信对话序列编号。第二方面，本申请实施例提供了一种解码功率传输协议信息包的装置，该装置应用于解码设备，该装置包括：信号脉宽获取模块，用于根据预设捕获规则对PD信号进行捕获，得到多个信号脉宽；解码模块，用于将第一时间长度的信号脉宽解码为第一识别码，将第二时间长度的信号脉宽解码为第二识别码，将第三时间长度的信号脉宽解码为第三识别码，得到识别码串；信号特征信息获取模块，用于将识别码串中第一个第一识别码作为标准码，检测标准码的前一个识别码是否为第三识别码；若是，则根据第一处理规则对识别码串进行处理，得到信号特征信息；若不是，则根据第二处理规则对识别码串进行处理，得到信号特征信息。第三方面，本申请实施例提供了一种计算机设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，处理器执行计算机程序时执行如上述任一实施例的一种解码功率传输协议信息包的方法的步骤。综上，与现有技术相比，本申请实施例提供的技术方案带来的有益效果至少包括：本申请实施例提供的一种解码功率传输协议信息包的方法，通过程序代码对接收到的PD信号进行解码处理，获得PD信号中的信号特征信息，从而完成了对功率传输协议信息包的解码，无需通过对芯片中的硬件进行设计或改造实现功率传输协议信息包的解码，从硬解码变成了软解码，有效降低了解码功率传输协议信息包的成本。附图说明图1为本申请一个实施例提供的一种解码功率传输协议信息包的方法的流程图。图2为本申请一个实施例提供的第一处理规则的流程图。图3为本申请一个实施例提供的一种解码功率传输协议信息包的装置的结构图。具体实施方式下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本申请一部分实施例，而不是全部的实施例。基于本申请中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本申请保护的范围。请参见图1，本申请实施例提供了一种解码功率传输协议信息包的方法，该方法应用于解码设备，以执行主体为解码设备进行说明，该方法具体可以包括：步骤S1，根据预设捕获规则对PD信号进行捕获，得到多个信号脉宽。步骤S2，将第一时间长度的信号脉宽解码为第一识别码，将第二时间长度的信号脉宽解码为第二识别码，将第三时间长度的信号脉宽解码为第三识别码，得到识别码串。步骤S3，将识别码串中第一个第一识别码作为标准码，检测标准码的前一个识别码是否为第三识别码；若是，则根据第一处理规则对识别码串进行处理，得到信号特征信息；若不是，则根据第二处理规则对识别码串进行处理，得到信号特征信息。具体地，根据标准码的前一个识别码是否为第三识别码，按两种处理规则对识别码串进行检测，这是为了避免在识别引导码时发生错位导致的误判。上述实施例中提供的一种解码功率传输协议信息包的方法，通过程序代码对接收到的PD信号进行解码处理，获得PD信号中的信号特征信息，从而完成了对功率传输协议信息包的解码，无需通过对芯片中的硬件进行设计或改造实现功率传输协议信息包的解码，从硬解码变成了软解码，有效降低了解码功率传输协议信息包的成本。在一些实施例中，上述根据预设捕获规则对PD信号进行捕获，得到多个信号脉宽，包括：将PD信号的波形中连续两次相同边沿跳变之间的时间间隔作为一个信号脉宽。其中，解码设备可以为MCU芯片，可以利用MCU定时器的捕获中断获得信号脉宽；具体地，信号脉宽以定时器的计数寄存器的数据形式表示，每当检测到边沿发生时捕获一次计数器的值，两次相同的边沿捕获到的计数器的值的差值即为一个信号脉宽。具体地，因为PD通信的波特率是330k，即3.3us/bit，且使用曼切斯特编码方式，所以PD信号中最短的脉宽是3.3us/2＝1.6us，脉宽极短，而大多数芯片只能通过提高芯片的主频来捕获和识别这种连续的超短脉宽，而提高芯片主频的成本较高。上述实施例采用单边沿捕获的方式，等价于将PD信号中的2个相邻基本单元组合在一起，从而实现了对1.6us超短脉宽的捕获，无需提升芯片主频也能获得多个信号脉宽，避免了识别成本的提高；且MCU芯片可根据通信情况关闭定时器运行，一定程度上降低了功耗。在一实施例中，信号特征信息包括通信类型信息。请参见图2，上述根据第一处理规则对识别码串进行处理，得到信号特征信息，包括：步骤S31，检测标准码后的第4个识别码是否为第三识别码。步骤S32，若是，则通信类型信息为第三通信类型。步骤S33，若不是，则检测标准码后的第7个识别码是否为第一识别码。步骤S331，若是，则通信类型信息为第一通信类型。步骤S332，若不是，则通信类型信息为第二通信类型。以第4识别码和第7识别码为标准进行检测和判断，是因为在捕获到的PD信号的多个信号脉宽中，因为通信类型不同而出现的不同时间长度的信号脉宽，首先可能是在第一时间长度的信号脉宽之后的第4个信号脉宽，其次是第7个信号脉宽。因此上述实施例首先根据第4个识别码判断，若相同再根据第7个识别码判断，能够准确地判断出信号特征信息中的通信类型，无需逐个检测识别码，不仅减少了软解码的计算量，同时使对信号特征信息的检测更加快速，避免超出500微秒的回复时间限制导致通信失败。在一实施例中，信号特征信息包括通信类型信息。上述根据第二处理规则对识别码串进行处理，得到信号特征信息，包括：检测标准码后的第3个识别码是否为第三识别码。若是，则通信类型信息为第三通信类型。若不是，则检测标准码后的第7个识别码是否为第一识别码，若是，则通信类型信息为第一通信类型，若不是，则通信类型信息为第二通信类型。具体的，通信类型信息是指PD信号中的SOP类型信息，SOP是start of packet，包的开始。第一通信类型，即SOP类型为供电端和常规通信方进行通信；第二通信类型，即SOP’类型为供电端和线缆远端进行通信；第三通信类型，即SOP”类型为供电端和线缆近端进行通信。上述实施例直接对因通信类型不同导致的时间长度不同的信号脉宽对应的识别码进行检测，而不是逐个检测识别码，提升了通信类型识别的速度，在识别到通信类型是和本方进行通信时能够及时回复，避免因识别通信类型的时间超出回复期限导致的通信失败。在一些实施例中，第一时间长度可以为6.6微秒，第二时间长度可以为5微秒，第三时间长度可以为3.3微秒。具体地，第一识别码可以为00，第二识别码可以为1-0或01-，第三识别码可以为1-1-。其中，1-为特征码，表示的是半1，即将完整的1拆分为两个半1。在时间长度按上述实施例来设置时，1-对应0.5bit宽度、时间长度为1.6微秒的信号脉宽；识别码1-1-对应宽度为1bit、时间长度为3.3微秒的信号脉宽，识别码1-0或01-对应5微秒的脉宽，识别码00对应6.6微秒的脉宽。因为引导码后一定会出现连续的3个0，每个识别码都是由两个数字组成的，而这3个0可能是前两个0为一个识别码，也可能是后两个0为一个识别码，这影响了对后续识别码识别的顺序，因此检测标准码的前一个识别码是否为第三识别码，即检测识别码串中的第一个00的前面是否为1-1-，若是，则表明引导码后连续3个0是前两个0组合在一起为一个识别码的，若不是，则说明这连续3个0是后两个0为一个识别码，从而保证了后续识别的准确。上述实施例将PD信号中的1.6微秒的超短脉宽用半1来表示，在单边沿捕获的脉宽为3.3微秒，则表示捕获的信号脉宽中的相邻两个基本单元都为1.6微秒，实现了对PD信号中超短脉宽的捕获。考虑到现有的芯片只能通过提高主频来识别1.6微秒这样的超短脉宽，而提高芯片的主频会导致芯片的设计成本提高，上述实施例通过采用半1来表示1.6微秒脉宽的方法，无需提高芯片的主频也能够实现对超短脉宽的捕获和识别，从而降低了解码PD信号的成本。在一些实施例中，信号特征信息包括通信对话序列编号。上述根据第一处理规则对识别码串进行处理，得到信号特征信息，包括：将在标准码后，与标准码间隔30bit的识别码作为起始码，与标准码间隔35bit的识别码作为结束码；将起始码至结束码之间的多个识别码进行并码处理，得到5bit码串；对5bit码串进行处理，得到通信对话序列编号。具体地，与标准码间隔30bit和间隔35bit的选取和计算包括标准码本身。在一些实施例中，信号特征信息包括通信对话序列编号。上述根据第二处理规则对识别码串进行处理，得到信号特征信息，包括：将在标准码后，与标准码间隔29bit的识别码作为起始码，与标准码间隔34bit的识别码作为结束码；将起始码至结束码之间的多个识别码进行并码处理，得到5bit码串；对5bit码串进行处理，得到通信对话序列编号。其中，通信对话序列编号是指功率传输协议信息包中GOODCRC的ID号，GOODCRC为功率传输协议信息包中的一个数据包，用于表示CRC没问题。GOODCRC的ID号即供电端的通信对话序列编号，在根据通信类型信息判断对方是跟本方进行通信后，根据该ID号回复对方，完成通信。并码处理指的是将起始码到结束码之间的两两相邻的半1合并为一个整1，使得到的5bit码串为常规的01二进制码串。具体地，与标准码间隔29bit和间隔34bit的选取和计算包括标准码本身。因为标准码的前一个识别码是否为第三识别码决定了上述连续的3个0是如何组合的，若是前两个0组合成一个识别码，则需跳过30bit，若是后两个0组成一个识别码，则只需跳过29bit，跳过的30bit的识别码中比跳过的29bit的识别码中多一个0。上述实施例通过直接跳过无用的码串范围，直接对ID号对应的解码范围进行并码处理，实现了快速获得ID号的效果。在一些实施例中，上述对5bit码串进行处理，得到通信对话序列编号，包括：将5bit码串进行逆序操作，得到逆序5bit码串；将逆序5bit码串转换为4bit码串，将4bit码串中的高位3bit编码作为通信对话序列编号。具体地，ID号一般位于16bit的PD信号中的第5-8bit，数值5-8bit只针对GOODCRC数据包的ID号，当要解码其他包的一些编号时，只需更改上述计算中的bit值即可。在具体实施过程中，在接收到供电端发出的功率传输协议信息包后需要在约500微秒内回复对方，如果将接收到的所有PD信号全部解码需要很长时间，非常可能会超出500微秒导致通信失败，因此需要快速识别出需回复的通信对话序列编号，即ID号，先根据ID号回复对方，保证正常通信建立，再将全部的PD信号解码进行回复。上述实施例通过直接从标准码跳至ID号所在的范围进行并码处理，实现了快速获得ID号的技术效果，避免了因全部解码时间太长导致的通信失败。请参见图3，本申请另一实施例提供了一种解码功率传输协议信息包的装置，该装置应用于解码设备，该装置包括：信号脉宽获取模块101，用于根据预设捕获规则对PD信号进行捕获，得到多个信号脉宽。解码模块102，用于将第一时间长度的信号脉宽解码为第一识别码，将第二时间长度的信号脉宽解码为第二识别码，将第三时间长度的信号脉宽解码为第三识别码，得到识别码串。信号特征信息获取模块103，用于将识别码串中第一个第一识别码作为标准码，检测标准码的前一个识别码是否为第三识别码；若是，则根据第一处理规则对识别码串进行处理，得到信号特征信息；若不是，则根据第二处理规则对识别码串进行处理，得到信号特征信息。上述实施例中提供的一种解码功率传输协议信息包的装置，通过模块中存储的程序代码对接收到的PD信号进行解码处理，获得PD信号中的信号特征信息，从而完成了对功率传输协议信息包的解码，无需通过对芯片中的硬件进行设计或改造实现功率传输协议信息包的解码，从硬解码变成了软解码，有效降低了解码功率传输协议信息包的成本。本实施例中提供的关于一种解码功率传输协议信息包的装置的具体限定，可以参见上文中关于一种解码功率传输协议信息包的方法的实施例，于此不再赘述。上述一种解码功率传输协议信息包的装置中的各个模块可全部或部分通过软件、硬件及其组合来实现。上述各模块可以硬件形式内嵌于或独立于计算机设备中的处理器中，也可以以软件形式存储于计算机设备中的存储器中，以便于处理器调用执行以上各个模块对应的操作。本申请实施例提供了一种计算机设备，该计算机设备可以包括通过系统总线连接的处理器、存储器、网络接口和数据库。其中，该计算机设备的处理器用于提供计算和控制能力。该计算机设备的存储器包括非易失性存储介质、内存储器。该非易失性存储介质存储有操作系统、计算机程序和数据库。该内存储器为非易失性存储介质中的操作系统和计算机程序的运行提供环境。该计算机设备的网络接口用于与外部的终端通过网络连接通信。处计算机程序被处理器执行时，使得处理器执行如上述任一实施例的一种解码功率传输协议信息包的方法的步骤。本实施例提供的计算机设备的工作过程、工作细节和技术效果，可以参见上文中关于一种解码功率传输协议信息包的方法的实施例，于此不再赘述。以上实施例的各技术特征可以进行任意的组合，为使描述简洁，未对上述实施例中的各个技术特征所有可能的组合都进行描述，然而，只要这些技术特征的组合不存在矛盾，都应当认为是本说明书记载的范围。以上所述实施例仅表达了本申请的几种实施方式，其描述较为具体和详细，但并不能因此而理解为对发明专利范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本申请构思的前提下，还可以做出若干变形和改进，这些都属于本申请的保护范围。因此，本申请专利的保护范围应以所附权利要求为准。
