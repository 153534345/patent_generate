标题title
一种多环境Hadoop KMS代理服务方法及系统
摘要abst
本发明提供了一种多环境Hadoop KMS代理服务方法及系统，包括服务集群，所述服务集群包括数据访问模块、数据管理模块和Ranger KMS代理模块，所述服务集群用于数据管理、密钥代理管理；第三方Hadoop KMS，所述第三方Hadoop KMS用于密钥管理。还提供了一种多环境Hadoop KMS代理服务方法，可以通过KMS代理的方式对文件数据进行加密或解密，保障数据的安全。本发明提供了一种多环境Hadoop KMS代理服务方法及系统，在对HDFS文件进行透明加密或解密过程中，通过KMS代理服务保护密钥的安全，进而保障数据的安全。
权利要求书clms
1.一种多环境 Hadoop KMS代理服务方法，包括加密方法和解密方法，其特征在于，所述加密方法包括以下步骤：A1、数据管理模块将生成EDEK的请求给Ranger KMS代理模块；A2、Ranger KMS代理模块将访问EZ Key的请求代理到第三方Hadoop KMS获取EZ Key；A3、Ranger KMS代理模块将生成新的EDEK请求代理到第三方Hadoop KMS，第三方Hadoop KMS生成新的EDEK后返回给Ranger KMS代理模块；A4、Ranger KMS代理模块将EDEK储存在数据管理模块中。2.根据权利要求1所述的一种多环境 Hadoop KMS代理服务方法，其特征在于，所述解密方法包括以下步骤：B1、数据访问模块从数据管理模块读取EDEK；B2、数据访问模块发送解密EDEK的请求给Ranger KMS代理模块；B3、Ranger KMS代理模块将访问EZ Key的请求代理到第三方Hadoop KMS获取EZ Key；B4、Ranger KMS代理模块将解密EDEK的请求代理到第三方Hadoop KMS，第三方HadoopKMS解密成DEK后返回给Ranger KMS代理模块；B5、Ranger KMS代理模块将解密后的DEK返回数据访问模块。3.一种多环境 Hadoop KMS代理服务系统，其特征在于，包括：服务集群，所述服务集群用于数据管理、密钥代理管理；所述服务集群包括数据访问模块、数据管理模块和Ranger KMS代理模块，所述数据访问模块用于确保数据在储存和传输过程中得到保护，防止未经授权的访问和数据泄露，所述数据管理模块；所述数据管理模块用于管理和储存文件数据，所述Ranger KMS用于EZKey代理管理；第三方Hadoop KMS，所述第三方Hadoop KMS用于EZ Key管理。4.根据权利要求3所述的一种多环境 Hadoop KMS代理服务系统，其特征在于，所述数据访问模块包括EZ Key管理模块、DEK获取模块、数据文件加密解密模块。5.根据权利要求3所述的一种多环境 Hadoop KMS代理服务系统，其特征在于，所述数据管理模块包括NameNode和DataNode，所述NameNode用于元数据管理，维护文件加密状态和EDEK的获取，DataNode用于存储实际的明文数据块或密文数据块。6.根据权利要求5所述的一种多环境 Hadoop KMS代理服务系统，其特征在于，所述NameNode包括EDEK获取模块，元数据管理模块和透明处理模块。7.根据权利要求3所述的一种多环境 Hadoop KMS代理服务系统，其特征在于，所述Ranger KMS代理模块包括第三方Hadoop KMS访问模块、EDEK代理模块。8.根据权利要求3所述的一种多环境 Hadoop KMS代理服务系统，其特征在于，所述第三方Hadoop KMS为独立的第三方自建KMS模块或内置于第三方集群的第三方内置KMS模块。9.根据权利要求8所述的一种多环境 Hadoop KMS代理服务系统，其特征在于，所述第三方自建KMS模块包括EZ Key访问模块，EDEK生成模块和EDEK解密模块。10.根据权利要求8所述的一种多环境 Hadoop KMS代理服务系统，其特征在于，所述第三方内置KMS模块包括EZ Key访问模块，EDEK生成模块和EDEK解密模块。
说明书desc
技术领域本发明涉及信息安全技术领域，具体涉及一种多环境 Hadoop KMS代理服务方法及系统。背景技术HDFS是Hadoop使用的分布式文件系统，能存储和处理大规模数据。HDFS的设计目标是在标准硬件上运行，从而提供高容错性，并且能够处理已存储的大量数据。HDFS中的数据会保存在本地磁盘中，一般是以明文储存的，难以阻止用户访问涉密的数据。KMS密钥管理服务是一站式密钥管理和数据加密服务平台，可以提供简单安全可靠合规的数据加密保护能力。依托与KMS实现的HDFS透明加密机制，使得我们能够对关键数据或者一些特殊文件进行加密，在HDFS层的DataNode仅存储加密后的密文数据，这样非法用户即使从操作系统层面拷走文件，也只能看到一串加密字节而无法查看文件加密前的真正内容，从而很大程度上提高了数据资源的保密性、安全性。KMS 密钥管理服务通常集成在Hadoop集群中，一旦正确配置和启动，便可使用。KMS 负责整个HDFS透明解密过程的密钥管理工作，因此保存的密钥对于用户数据和文件资源的保密性至关重要。在当前的配置中，KMS服务与HDFS部署在同一集群中，客户端通过连接到HDFS 本地集群内置的 KMS 服务来对其文件进行加解密。但是，一旦非法用户获得了本地集群的权限或最高权限，客户的密钥可能会面临泄露风险。尽管数据已经通过密钥进行了加密，但仍然存在潜在的风险，因为密钥本身可能被不当获取，从而导致数据的安全性受到威胁。现有技术中，如中国公开专利CN108111479A中公布的一种用于Hadoop分布式文件系统透明加解密的密钥管理方法，将KMS的密钥管理协议的承载协议改成负载更轻、效率更高，但是该方法并未加强客户密钥的安全性。如中国公开专利CN109981579B中公布的一种基于SGX的Hadoop秘钥管理服务安全加强方法，通过增加SGX安全区来加强了密钥管理的安全性，但是这种方法只是针对KMS本身在加密区密钥、数据加密密钥、加密数据加密密钥的创建过程和密钥的加解密过程中的安全加固，并不能解决本申请中提到的安全需求场景。发明内容本发明的目的是提出一种多环境 Hadoop KMS代理服务方法及系统，通过KMS代理服务的方式提升客户密钥的安全性。还提供了一种多环境 Hadoop KMS代理服务方法，包括加密方法和解密方法，使用所述的一种多环境 Hadoop KMS代理服务系统，所述加密方法包括以下步骤：A1、数据管理模块将生成EDEK的请求给Ranger KMS代理模块；A2、Ranger KMS代理模块将访问EZ Key的请求代理到第三方Hadoop KMS获取EZKey；A3、Ranger KMS代理模块将生成新的EDEK请求代理到第三方Hadoop KMS，第三方Hadoop KMS生成新的EDEK后返回给Ranger KMS代理模块；A4、Ranger KMS代理模块将EDEK储存在数据管理模块的NameNode中。优选的，所述解密方法包括以下步骤：B1、数据访问模块从数据管理模块的NameNode读取EDEK；B2、数据访问模块发送解密EDEK的请求给Ranger KMS代理模块；B3、Ranger KMS代理模块将访问EZ Key的请求代理到第三方Hadoop KMS获取EZKey；B4、Ranger KMS代理模块将解密EDEK的请求代理到第三方Hadoop KMS，第三方Hadoop KMS解密成DEK后返回给Ranger KMS代理模块；B5、Ranger KMS代理模块将解密后的DEK返回数据访问模块。还提供了一种多环境 Hadoop KMS代理服务系统，包括：服务集群，所述服务集群包括数据访问模块、数据管理模块和Ranger KMS代理模块，所述服务集群用于数据管理、密钥代理管理；第三方Hadoop KMS，所述第三方Hadoop KMS用于密钥管理。优选的，所述数据访问模块包括EZ Key管理模块、DEK获取模块、数据文件加密解密模块，所述数据访问模块用于确保数据在储存和传输过程中得到保护，防止未经授权的访问和数据泄露。进一步优选的，EZ Key管理模块可以增加，删除，更改或查询EZ Key及EZ Key与KMS的映射关系。EZ Key即加密区域密钥，用于加密数据文件。进一步优选的，DEK获取模块可以根据EZ Key与KMS的映射关系，将待解密的EDEK的请求发送给Ranger KMS代理模块，并从Ranger KMS代理模块接受解密后的DEK。DEK即数据加密密钥，EDEK即加密的数据加密密钥，通过DEK与EZ Key结合可以得到EDEK。进一步优选的，数据文件加密解密模块对数据文件进行透明加密或透明解密操作，透明加密操作保证数据在传输和存储过程中保持加密状态，数据解密操作使得用户或应用程序可以正确处理数据。优选的，所述数据管理模块包括NameNode和DataNode，所述NameNode用于元数据管理，维护文件加密状态和EDEK的获取，DataNode用于存储实际的明文或密文数据块。优选的，所述NameNode包括EDEK获取模块，元数据管理模块和透明处理模块。进一步优选的，EDEK获取模块可以与Ranger KMS代理模块通信，根据EZ Key 与KMS 映射关系，向Ranger KMS代理模块发出获取EDEK的请求，并接收Ranger KMS代理模块返回的EDEK。进一步优选的，元数据管理模块可以记录被加密的文件或目录和使用的 EDEK 等元数据信息。进一步优选的，透明处理模块可以处理加密和解密的细节，使加密和解密操作对HDFS 用户和应用程序是无感的，数据加密和解密的过程不会影响用户的操作。优选的，所述Ranger KMS代理模块包括第三方Hadoop KMS访问模块、EDEK代理模块，所述Ranger KMS代理模块用于EZ Key代理管理。进一步优选的，第三方Hadoop KMS访问模块用于访问第三方Hadoop KMS，将访问EZ Key 的 HTTP 请求代理到第三方Hadoop KMS，由第三方Hadoop KMS返回 EZ Key。进一步优选的，EDEK代理模块用于将生成EDEK或解密EDEK的请求代理到第三方Hadoop KMS，第三方Hadoop KMS返回生成的EDEK或解密的DEK。优选的，所述第三方Hadoop KMS为独立的第三方自建KMS模块或内置于第三方集群的第三方内置KMS模块。优选的，所述第三方自建KMS模块包括EZ Key访问模块，EDEK生成模块，所述第三方自建KMS模块用于EZ Key访问模块，EDEK生成模块和EDEK解密模块。进一步优选的，EZ Key访问模块用于对储存EZ Key的访问。进一步优选的，EDEK生成模块用于生成EDEK。进一步优选的，EDEK解密模块用于解密EDEK生成DEK。优选的，所述第三方内置KMS模块包括EZ Key访问模块，EDEK生成模块和EDEK解密模块。进一步优选的，EZ Key访问模块用于对储存EZ Key的访问。进一步优选的，EDEK生成模块用于生成EDEK。进一步优选的，EDEK解密模块用于解密EDEK生成DEK。有益效果：1、本发明提供了一种多环境 Hadoop KMS代理服务方法及系统，在对HDFS文件进行透明加密或解密过程中，通过KMS代理服务保护密钥的安全，进而保障数据的安全。2、现有技术中，KMS服务与HDFS部署在同一集群中，客户端通过连接到HDFS 本地集群内置的 KMS 服务来对其文件进行加解密。但是一旦非法用户获得了本地集群的权限或最高权限，客户的密钥可能会面临泄露风险。本发明中在可以实现HDFS透明加密或解密的同时，可以提升储存数据的安全性。本地的服务集群并不保存密钥，客户的密钥保存在客户手中，而非保存在本地，服务集群中的KMS仅作为代理，及时取得服务集群的最高权限也无法窃取到密钥，保护密钥安全，从而保障数据安全。3、本发明具有多种使用场景，可以应用在独立的第三方自建KMS模块或内置于第三方集群的第三方内置KMS模块，具有较广泛的适用性。4、数据访问模块可以确保数据在存储和传输过程中得到保护，以防止未经授权的访问和数据泄露。5、数据管理模块中NameNode可以处理加解密的细节，使加密和解密操作对 HDFS用户和应用程序是无感的。附图说明图1为本发明提供的一种多环境 Hadoop KMS代理服务系统的实施例1的服务集群的系统结构图。图2为本发明提供的一种多环境 Hadoop KMS代理服务系统的实施例1的第三方自建KMS模块的系统结构图。图3为本发明提供的一种多环境 Hadoop KMS代理服务系统的实施例2的第三方集群的系统结构图。图4为本发明提供的一种多环境 Hadoop KMS代理服务方法的实施例1的方法流程图。图5为本发明提供的一种多环境 Hadoop KMS代理服务方法的实施例2的方法流程图。具体实施方式参选以下本发明的优选实施方法的详述以及包括的实施例可更容易地理解本发明的内容。除非另有限定，本文使用的所有技术以及科学术语具有与本发明所属领域普通技术人员通常理解的相同的含义。当存在矛盾时，以本说明书中的定义为准。实施例1：本发明提供了一种多环境 Hadoop KMS代理服务方法及系统，在对HDFS文件进行透明加密或解密过程中，通过KMS代理服务保护密钥的安全，进而保障数据的安全。如图1-2所示本发明提供了一种多环境 Hadoop KMS代理服务系统，包括：服务集群，服务集群包括数据访问模块、数据管理模块和Ranger KMS代理模块，服务集群用于数据管理、密钥代理管理；第三方Hadoop KMS，第三方Hadoop KMS用于密钥管理。数据访问模块包括EZ Key管理模块、DEK获取模块、数据文件加密解密模块，数据访问模块用于确保数据在储存和传输过程中得到保护，防止未经授权的访问和数据泄露。EZ Key管理模块可以增加，删除，更改或查询EZ Key及EZ Key与KMS的映射关系。EZ Key即加密区域密钥，用于加密数据文件。DEK获取模块可以根据EZ Key与KMS的映射关系，将待解密的EDEK的请求发送给Ranger KMS代理模块，并从Ranger KMS代理模块接受解密后的DEK。DEK即数据加密密钥，EDEK即加密的数据加密密钥，通过DEK与EZ Key结合可以得到EDEK。数据文件加密解密模块对数据文件进行透明加密或透明解密操作，透明加密操作保证数据在传输和存储过程中保持加密状态，数据解密操作使得用户或应用程序可以正确处理数据。数据管理模块包括NameNode和DataNode，NameNode用于元数据管理，维护文件加密状态和EDEK的获取，DataNode用于存储实际的明文或密文数据块。NameNode包括EDEK获取模块，元数据管理模块和透明处理模块。EDEK获取模块可以与Ranger KMS代理模块通信，根据EZ Key 与 KMS 映射关系，向Ranger KMS代理模块发出获取EDEK的请求，并接收Ranger KMS代理模块返回的EDEK。元数据管理模块可以记录被加密的文件或目录和使用的EDEK 等元数据信息。透明处理模块可以处理加解密的细节，使加密和解密操作对 HDFS 用户和应用程序是无感的。Ranger KMS代理模块包括第三方Hadoop KMS访问模块、EDEK代理模块，RangerKMS代理模块用于EZ Key代理管理。第三方Hadoop KMS访问模块用于访问第三方HadoopKMS，将访问 EZ Key 的 HTTP 请求代理到第三方Hadoop KMS，由第三方Hadoop KMS返回EZ Key。EDEK代理模块用于将生成EDEK或解密EDEK的请求代理到第三方Hadoop KMS，第三方Hadoop KMS返回生成的EDEK或解密的DEK。第三方自建KMS模块包括EZ Key访问模块，EDEK生成模块和EDEK解密模块，EZ Key访问模块用于对EZ Key的访问。EDEK生成模块用于生成EDEK。EDEK解密模块用于解密EDEK生成DEK。第三方自建KMS模块作为一个自建的独立的服务模块，将EZ Key保存在客户手中，提升EZ Key的安全性，且体量较小，便于搭建。如图4所示，还提供了一种多环境 Hadoop KMS代理服务方法，包括加密方法和解密方法，使用的一种多环境 Hadoop KMS代理服务系统，加密方法包括以下步骤：A1、数据管理模块将生成EDEK的请求给Ranger KMS代理模块；其中，数据管理模块中NameNode中的EDEK获取模块向Ranger KMS代理模块发出获取EDEK的请求；A2、Ranger KMS代理模块将访问EZ Key的请求代理到第三方Hadoop KMS获取EZKey；其中，Ranger KMS代理模块中的第三方Hadoop KMS访问模块向第三方自建KMS模块发出访问请求，第三方自建KMS模块中的EZ Key访问模块获取EZ Key；A3、Ranger KMS代理模块将生成新的EDEK请求代理到第三方Hadoop KMS，第三方Hadoop KMS生成新的EDEK后返回给Ranger KMS代理模块；其中，Ranger KMS代理模块中的EDEK代理模块提出EDEK生成请求，第三方HadoopKMS访问模块将EDEK生成请求发送到第三方自建KMS模块，第三方自建KMS模块中的EDEK生成模块生成EDEK并反馈给Ranger KMS代理模块；A4、Ranger KMS代理模块将EDEK储存在数据管理模块的NameNode中；其中，NameNode的元数据管理模块对EDEK的元数据进行管理；透明处理模块将加密的细节进行隐藏。解密方法包括以下步骤：B1、数据访问模块从数据管理模块的NameNode读取EDEK；B2、数据访问模块发送解密EDEK的请求给Ranger KMS代理模块；其中，数据访问模块中的DEK获取模块向Ranger KMS代理模块发出获取DEK的请求B3、Ranger KMS代理模块将访问EZ Key的请求代理到第三方Hadoop KMS获取EZKey；其中，Ranger KMS代理模块中的第三方Hadoop KMS访问模块向第三方自建KMS模块发出访问请求，第三方自建KMS模块中的EZ Key访问模块获取EZ Key；B4、Ranger KMS代理模块将解密EDEK的请求代理到第三方Hadoop KMS，第三方Hadoop KMS解密成DEK后返回给Ranger KMS代理模块；其中，Ranger KMS代理模块中的EDEK代理模块提出EDEK解密请求，第三方HadoopKMS访问模块将EDEK解密请求发送到第三方自建KMS模块，第三方自建KMS模块中的EDEK解密模块生成DEK并反馈给Ranger KMS代理模块；B5、Ranger KMS代理模块将解密后的DEK返回数据访问模块其中，数据访问模块中的数据文件解密模块使用DEK将密文数据块转化为明文数据块，用户可以正常使用数据文件。实施例2实施例2中与实施例1不同处在于，第三方Hadoop KMS为内置于第三方集群的第三方内置KMS模块。第三方内置KMS模块包括EZ Key访问模块，EDEK生成模块和EDEK解密模块。EZ Key访问模块用于对储存EZ Key的访问。EDEK生成模块用于生成EDEK。EDEK解密模块用于解密EDEK生成DEK。第三方集群为客户本身的一个独立的集群，将第三方内置KMS模块内置在第三方集群内可以更方便客户内部进行使用。如图3和图5所示，第三方集群内设置有与服务集群相同的数据访问模块和数据管理模块，除了可以使用实施例1中的加密方法，还可以在第三方集群内通过第三方内置KMS模块对数据文件进行加密，加密方法与常规的KMS加密方法相同，加密后的数据文件储存在第三方集群中的数据管理模块中，然后以DISTCP或上传的方式将加密数据文件拷贝到服务集群中的数据管理模块的DataNode中进行加密储存，并将加密数据文件对应的EDEK储存在NameNode中。解密方法与实施例1相同。
