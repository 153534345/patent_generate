标题title
一种OTDR数据分析诊断方法、装置、电子设备及存储介质
摘要abst
本申请涉及光纤网络技术领域，尤其涉及一种OTDR数据分析诊断方法、装置、电子设备及存储介质，对不同光纤资源管理系统中的OTDR异构数据进行采集；根据OTDR数据中的事件数组对衰减数组进行分析，得到正常衰减区的OTDR数据，进而得到其中每相邻两个采样点间的光纤衰减斜率，并且根据光纤衰减斜率得到光纤衰减异常距离段；根据中断事件数组和设置的距离误差阈值确定纤芯中断位置；从而实现对光纤相对脆弱部分以及纤芯中断位置的实时分析和诊断。并且通过大数据对同一光纤多次测试的OTDR数据进行分析，得到采样点位置、光纤衰减值和衰减历经时间的三维表，从而离线反映出在光纤路由中每个采样点衰减趋势变化，更加有效完成OTDR数据的整合分析。
权利要求书clms
1.一种OTDR数据分析诊断方法，其特征在于，所述方法包括以下步骤：对不同光纤资源管理系统中的OTDR异构数据进行采集，并将采集的所述OTDR异构数据归一化为设定格式的OTDR数据；其中，所述OTDR数据包括采样分辨率、采样点个数、衰减数组、测试时间和事件数组；根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据；其中，所述事件数组包括中断事件数组；对所述正常衰减区的OTDR数据进行分析，得到其中每相邻两个采样点间的光纤衰减斜率，并且根据所述光纤衰减斜率得到光纤衰减异常距离段；根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置；获取同一光纤多次测试的OTDR数据，并对光纤衰减斜率异常的采样点进行趋势分析，得到其位置、光纤衰减值和衰减历经时间的三维表。2.根据权利要求1所述一种OTDR数据分析诊断方法，其特征在于，其中，采用数据库驱动适配器或者调用相应API接口的方式，对不同光纤资源管理系统中的OTDR异构数据进行采集，并将采集的所述OTDR异构数据采用数据聚合的方式归一化为设定格式的OTDR数据。3.根据权利要求2所述一种OTDR数据分析诊断方法，其特征在于，所述根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据，包括以下步骤：根据所述OTDR数据中的事件数组，查找产生非中断事件的相关采样点；将查找到的所述相关采样点在所述衰减数组中排除，得到正常衰减区的OTDR数据；其中，所述非中断事件包括光纤始端事件、非反射事件、反射事件和末端事件。4.根据权利要求3所述一种OTDR数据分析诊断方法，其特征在于，所述根据所述光纤衰减斜率得到光纤衰减异常距离段，包括以下步骤：根据设置的光纤衰减斜率变化阈值对所述光纤衰减斜率进行分析，得到光纤衰减异常的可疑起始采样点；利用所述光纤衰减斜率变化阈值获取所述可疑起始采样点对应的第一目标采样点，若所述可疑起始采样点与所述第一目标采样点之间的个数大于设置的连续采样异常点个数，将所述可疑起始采样点确定为光纤衰减异常起始采样点，并得到所述光纤衰减异常起始采样点与所述第一目标采样点构成的光纤衰减异常距离段；利用所述光纤衰减斜率变化阈值获取所述光纤衰减异常起始采样点对应的第二目标采样点，若所述光纤衰减异常起始采样点与所述第二目标采样点之间的个数小于设置的连续采样正常点个数，得到所述光纤衰减异常起始采样点与所述第二目标采样点构成的所述光纤衰减异常距离段的扩充段。5.根据权利要求4所述一种OTDR数据分析诊断方法，其特征在于，所述根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置，包括以下步骤：获取所述中断事件数组中进行正向OTDR测试的第一中断事件点；若相邻两次正向OTDR测试的第一中断事件点之间的距离小于设置的距离误差阈值，将其归并为同一地点发生的第一中断事件点，得到第一中断事件数组；获取所述中断事件数组中进行反向OTDR测试的第二中断事件点；若相邻两次反向OTDR测试的第二中断事件点之间的距离小于设置的距离误差阈值，将其归并为同一地点发生的第二中断事件点，并且根据光纤链路长度将所述第二中断事件点进行反向替换得到第二中断事件数组；将所述第一中断事件数组和所述第二中断事件数组按照中断事件点位置从小到大进行排序，并且若相邻两个中断事件点之间的距离小于设置的距离误差阈值将其归并为同一地点发生的第三中断事件点，得到第三中断事件数组，以确定纤芯中断位置。6.根据权利要求5所述一种OTDR数据分析诊断方法，其特征在于，所述方法还包括以下步骤：基于得到的所述光纤衰减异常距离段生成光纤纤芯质量异常告警信息，以及基于确定的所述纤芯中断位置生成光纤纤芯中断告警信息；对生成的所述光纤纤芯质量异常告警信息和所述光纤纤芯中断告警信息进行推送。7.根据权利要求6所述一种OTDR数据分析诊断方法，其特征在于，所述获取同一光纤多次测试的OTDR数据，并对光纤衰减斜率异常的采样点进行趋势分析，得到其位置、光纤衰减值和衰减历经时间的三维表，包括以下步骤：基于历史存储的OTDR数据，获取同一光纤多次测试的OTDR数据；根据获取的同一光纤多次测试的OTDR数据确定基准采样分辨率，并基于所述基准采样分辨率归一化光纤衰减斜率；对每个采样点上的归一化OTDR衰减斜率按照时序分析，得到光纤衰减斜率异常的采样点的位置、光纤衰减值和衰减历经时间的三维表。8.一种OTDR数据分析诊断装置，其特征在于，所述装置包括：采集模块，用于对不同光纤资源管理系统中的OTDR异构数据进行采集，并将采集的所述OTDR异构数据归一化为设定格式的OTDR数据；其中，所述OTDR数据包括采样分辨率、采样点个数、衰减数组、测试时间和事件数组；第一分析模块，用于根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据；其中，所述事件数组包括中断事件数组；第二分析模块，用于对所述正常衰减区的OTDR数据进行分析，得到其中每相邻两个采样点间的光纤衰减斜率，并且根据所述光纤衰减斜率得到光纤衰减异常距离段；确定模块，用于根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置；第三分析模块，用于获取同一光纤多次测试的OTDR数据，并对光纤衰减斜率异常的采样点进行趋势分析，得到其位置、光纤衰减值和衰减历经时间的三维表。9.一种电子设备，其特征在于，包括：处理器、存储器和总线，所述存储器存储有所述处理器可执行的机器可读指令，当电子设备运行时，所述处理器与所述存储器之间通过总线通信，所述机器可读指令被所述处理器执行时执行如权利要求1至7任一所述的OTDR数据分析诊断方法的步骤。10.一种计算机可读存储介质，其特征在于，该计算机可读存储介质上存储有计算机程序，该计算机程序被处理器运行时执行如权利要求1至7任一所述的OTDR数据分析诊断方法的步骤。
说明书desc
技术领域本申请涉及光纤网络技术领域，尤其涉及一种OTDR数据分析诊断方法、装置、电子设备及存储介质。背景技术随着光纤网络的大规模应用及部署，其对应的光纤资源管理系统各不相同，其中存储的光纤数据分布于异构数据库，存储格式也不尽相同，光纤数据整合利用率较低。同时，光纤网络不仅需要关注光纤纤芯的链路损耗，同样也需要关注传输节点的链路损耗。对于有较高传输标准的光纤传输业务，比如光纤所承载的业务对光纤局部衰减有严格限制的，必须满足其传输要求，虽然并没有出现光纤纤芯中断，但依旧因为局部光纤无法满足传输要求而无法承载相关的传输业务。对于有纤芯中断的情况，更需要第一时间捕获并处理。而在实际处理中，侦测到纤芯中断的时效性不够，对纤芯中断位置的判断不准确，对于未发生纤芯中断但光纤链路损耗过大的网段或相关点位没有及时发现并处理。发明内容为克服现有技术中的不足，本申请提供一种OTDR数据分析诊断方法、装置、电子设备及存储介质，能够实时分析出光纤相对脆弱的部分以及诊断出纤芯中断的位置，并且离线分析出相同纤芯OTDR数据在时间变化上的趋势。第一方面，本申请提供一种OTDR数据分析诊断方法，所述方法包括以下步骤：对不同光纤资源管理系统中的OTDR异构数据进行采集，并将采集的所述OTDR异构数据归一化为设定格式的OTDR数据；其中，所述OTDR数据包括采样分辨率、采样点个数、衰减数组、测试时间和事件数组；根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据；其中，所述事件数组包括中断事件数组；对所述正常衰减区的OTDR数据进行分析，得到其中每相邻两个采样点间的光纤衰减斜率，并且根据所述光纤衰减斜率得到光纤衰减异常距离段；根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置；获取同一光纤多次测试的OTDR数据，并对光纤衰减斜率异常的采样点进行趋势分析，得到其位置、光纤衰减值和衰减历经时间的三维表。在一种可能的实施方式中，其中，采用数据库驱动适配器或者调用相应API接口的方式，对不同光纤资源管理系统中的OTDR异构数据进行采集，并将采集的所述OTDR异构数据采用数据聚合的方式归一化为设定格式的OTDR数据。在一种可能的实施方式中，所述根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据，包括以下步骤：根据所述OTDR数据中的事件数组，查找产生非中断事件的相关采样点；将查找到的所述相关采样点在所述衰减数组中排除，得到正常衰减区的OTDR数据；其中，所述非中断事件包括光纤始端事件、非反射事件、反射事件和末端事件。在一种可能的实施方式中，所述根据所述光纤衰减斜率得到光纤衰减异常距离段，包括以下步骤：根据设置的光纤衰减斜率变化阈值对所述光纤衰减斜率进行分析，得到光纤衰减异常的可疑起始采样点；利用所述光纤衰减斜率变化阈值获取所述可疑起始采样点对应的第一目标采样点，若所述可疑起始采样点与所述第一目标采样点之间的个数大于设置的连续采样异常点个数，将所述可疑起始采样点确定为光纤衰减异常起始采样点，并得到所述光纤衰减异常起始采样点与所述第一目标采样点构成的光纤衰减异常距离段；利用所述光纤衰减斜率变化阈值获取所述光纤衰减异常起始采样点对应的第二目标采样点，若所述光纤衰减异常起始采样点与所述第二目标采样点之间的个数小于设置的连续采样正常点个数，得到所述光纤衰减异常起始采样点与所述第二目标采样点构成的所述光纤衰减异常距离段的扩充段。在一种可能的实施方式中，所述根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置，包括以下步骤：获取所述中断事件数组中进行正向OTDR测试的第一中断事件点；若相邻两次正向OTDR测试的第一中断事件点之间的距离小于设置的距离误差阈值，将其归并为同一地点发生的第一中断事件点，得到第一中断事件数组；获取所述中断事件数组中进行反向OTDR测试的第二中断事件点；若相邻两次反向OTDR测试的第二中断事件点之间的距离小于设置的距离误差阈值，将其归并为同一地点发生的第二中断事件点，并且根据光纤链路长度将所述第二中断事件点进行反向替换得到第二中断事件数组；将所述第一中断事件数组和所述第二中断事件数组按照中断事件点位置从小到大进行排序，并且若相邻两个中断事件点之间的距离小于设置的距离误差阈值将其归并为同一地点发生的第三中断事件点，得到第三中断事件数组，以确定纤芯中断位置。在一种可能的实施方式中，所述方法还包括以下步骤：基于得到的所述光纤衰减异常距离段生成光纤纤芯质量异常告警信息，以及基于确定的所述纤芯中断位置生成光纤纤芯中断告警信息；对生成的所述光纤纤芯质量异常告警信息和所述光纤纤芯中断告警信息进行推送。在一种可能的实施方式中，所述获取同一光纤多次测试的OTDR数据，并对光纤衰减斜率异常的采样点进行趋势分析，得到其位置、光纤衰减值和衰减历经时间的三维表，包括以下步骤：基于历史存储的OTDR数据，获取同一光纤多次测试的OTDR数据；根据获取的同一光纤多次测试的OTDR数据确定基准采样分辨率，并基于所述基准采样分辨率归一化光纤衰减斜率；对每个采样点上的归一化OTDR衰减斜率按照时序分析，得到光纤衰减斜率异常的采样点的位置、光纤衰减值和衰减历经时间的三维表。第二方面，本申请提供一种OTDR数据分析诊断装置，所述装置包括：采集模块，用于对不同光纤资源管理系统中的OTDR异构数据进行采集，并将采集的所述OTDR异构数据归一化为设定格式的OTDR数据；其中，所述OTDR数据包括采样分辨率、采样点个数、衰减数组、测试时间和事件数组；第一分析模块，用于根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据；其中，所述事件数组包括中断事件数组；第二分析模块，用于对所述正常衰减区的OTDR数据进行分析，得到其中每相邻两个采样点间的光纤衰减斜率，并且根据所述光纤衰减斜率得到光纤衰减异常距离段；确定模块，用于根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置；第三分析模块，用于获取同一光纤多次测试的OTDR数据，并对光纤衰减斜率异常的采样点进行趋势分析，得到其位置、光纤衰减值和衰减历经时间的三维表。第三方面，本申请提供一种电子设备，包括：处理器、存储器和总线，所述存储器存储有所述处理器可执行的机器可读指令，当电子设备运行时，所述处理器与所述存储器之间通过总线通信，所述机器可读指令被所述处理器执行时执行如第一方面任一所述的OTDR数据分析诊断方法的步骤。第四方面，本申请提供一种计算机可读存储介质，该计算机可读存储介质上存储有计算机程序，该计算机程序被处理器运行时执行如第一方面任一所述的OTDR数据分析诊断方法的步骤。本实施例提供的一种OTDR数据分析诊断方法、装置、电子设备及存储介质，对不同光纤资源管理系统中的OTDR异构数据进行采集，并将采集的所述OTDR异构数据归一化为设定格式的OTDR数据；其中，所述OTDR数据包括采样分辨率、采样点个数、衰减数组、测试时间和事件数组；根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据；其中，所述事件数组包括中断事件数组；对所述正常衰减区的OTDR数据进行分析，得到其中每相邻两个采样点间的光纤衰减斜率，并且根据所述光纤衰减斜率得到光纤衰减异常距离段；根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置；获取同一光纤多次测试的OTDR数据，并对光纤衰减斜率异常的采样点进行趋势分析，得到其位置、光纤衰减值和衰减历经时间的三维表，从而，实现对光纤相对脆弱部分以及纤芯中断位置的快速分析和诊断，并且利用历史OTDR数据，离线反映出光纤路由中每个采样点衰减趋势变化。附图说明为了更清楚地说明本申请实施例的技术方案，下面将对实施例中所需要使用的附图作简单地介绍，应当理解，以下附图仅示出了本发明的某些实施例，因此不应被看作是对范围的限定，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他相关的附图。图1示出了本申请一实施例所述OTDR数据分析诊断方法的流程图；图2示出了本申请一实施例获取所述得到正常衰减区的OTDR数据的流程图；图3示出了本申请一实施例根据所述光纤衰减斜率得到光纤衰减异常距离段的流程图；图4示出了本申请一实施例根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置的流程图；图5示出了本申请一实施例所述OTDR数据分析诊断装置的结构示意图；图6示出了本申请一实施例所述电子设备的结构框图。具体实施方式为使本申请实施例的目的、技术方案和优点更加清楚，下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述，应当理解，本申请中附图仅起到说明和描述的目的，并不用于限定本申请的保护范围。另外，应当理解，示意性的附图并未按实物比例绘制。本申请中使用的流程图示出了根据本申请的一些实施例实现的操作。 应该理解，流程图的操作可以不按顺序实现，没有逻辑的上下文关系的步骤可以反转顺序或者同时实施。 此外，本领域技术人员在本申请内容的指引下，可以向流程图添加一个或多个其他操作，也可以从流程图中移除一个或多个操作。另外，所描述的实施例仅仅是本申请一部分实施例，而不是全部的实施例。通常在此处附图中描述和示出的本申请实施例的组件可以以各种不同的配置来布置和设计。因此，以下对在附图中提供的本申请的实施例的详细描述并非旨在限制要求保护的本申请的范围，而是仅仅表示本申请的选定实施例。基于本申请的实施例，本领域技术人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都属于本申请保护的范围。需要说明的是，本申请实施例中将会用到术语“包括”，用于指出其后所声明的特征的存在，但并不排除增加其它的特征。鉴于背景技术所提出的技术问题，本申请提供一种OTDR数据分析诊断方法、装置、电子设备及存储介质，能够实时分析出光纤相对脆弱的部分以及诊断出纤芯中断的位置，并且可以离线反映出光纤路由中每个采样点衰减趋势变化。在一实施例中，参见说明书附图1，本申请提供的一种OTDR数据分析诊断方法，所述方法包括以下步骤：S1、对不同光纤资源管理系统中的OTDR异构数据进行采集，并将采集的所述OTDR异构数据归一化为设定格式的OTDR数据；其中，所述OTDR数据包括采样分辨率、采样点个数、衰减数组、测试时间和事件数组；S2、根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据；其中，所述事件数组包括中断事件数组；S3、对所述正常衰减区的OTDR数据进行分析，得到其中每相邻两个采样点间的光纤衰减斜率，并且根据所述光纤衰减斜率得到光纤衰减异常距离段；S4、根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置；S5、获取同一光纤多次测试的OTDR数据，并对光纤衰减斜率异常的采样点进行趋势分析，得到其位置、光纤衰减值和衰减历经时间的三维表。具体的，在步骤S1中，需要说明的是，系统一般存在两种异构，一种是存储OTDR数据结构异构，存储可能是以键值对的形式存储的半结构化数据，也可能是存储在不同数据库表格中的结构化数据；另一种是存储数据库异构，不同的光纤资源管理系统将OTDR数据存储在不同的关系型数据库中，如MYSQL，Oracle等。在一实施例中，通过适配不同的数据库驱动，并通过配置文件连接不同数据源，通过数据库驱动适配层，将各类OTDR数据通过数据库驱动适配层高效读入到系统内存中；或者直接通过第三方系统调用API将OTDR数据实时读入。并且将读入的OTDR异构数据通过数据聚合的方式，采用键值对的方式统一清洗归一化OTDR数据。其中，所述OTDR数据包括采样分辨率、采样点个数、衰减数组、测试时间和事件数组。所述采样分辨率即OTDR采样精度。它定义了OTDR仪器所要求的两个连续采样点之间的最小距离，同时也表明了该OTDR测试故障查找的能力，由本次OTDR测试选择的脉冲宽度和距离量程决定；所述采样点个数即为本次OTDR测试在该采样分辨率的情况下，采集的采样点个数；所述衰减数组是指本次OTDR每个采样点的链路衰减值数据，它是一个一维数组，其数组大小为OTDR采样点个数大小，其值为本次OTDR测试在每个采样点位置的链路衰减值；所述测试时间是指本次OTDR数据测试的开始时间及结束时间；所述事件数组包括事件类型、触发位置、该处的链路衰减值，在本申请中重点分析的事件类型为纤芯中断事件。进一步的，在本申请为了提升对OTDR数据的处理效率，将归一化后的OTDR数据交由安全队列等待处理。在一实施例中，发送给Kafka消息队列，由于生成的OTDR数据量较大，且生成速度较快，将OTDR数据按照业务进行轻量级封装加上ID头部交由Kafka消息队列，以保证数据后续处理的可靠性。另外，OTDR数据通过Kafka交由Flink分析光纤相对脆弱的部分以及诊断纤芯中断的位置，这是由于Flink采用流式数据加载并通过链式方式完成数据高效处理，满足对OTDR数据实时处理的要求。并且流入Flink的OTDR数据，先通过Flink中的Map与FlatMap将OTDR数据形成键值对结构。其中键为业务光纤ID，值也为一个键值对，在该键值对中的键为时间，其时间区域单位可在系统配置文件中配置，值为长度为二的一维数组，存放两个列表数据，分别代表从起点A到终点Z测试的OTDR数据与从起点Z到终点A所经光缆纤芯与相同设备的反向OTDR的测试数据。每个列表中包含封装后的OTDR数据对象。特殊的，如果只有单向OTDR数据，则键值对的值退化为一个OTDR列表信息。参见说明书附图2，在步骤S2中，根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据，包括以下步骤：S201、根据所述OTDR数据中的事件数组，查找产生非中断事件的相关采样点；S202、将查找到的所述相关采样点在所述衰减数组中排除，得到正常衰减区的OTDR数据；其中，所述非中断事件包括光纤始端事件、非反射事件、反射事件和末端事件。在步骤S201-步骤S202中，根据OTDR数据中产生的事件数组，对采样点衰减数组进行分析，屏蔽已产生相关事件的OTDR衰减数组中的点，余下的被认为是正常衰减区的OTDR数据，进行后序较为细致的斜率对比分析。具体的，根据相关事件点屏蔽对应OTDR采样点的步骤为：查找本次OTDR上报的距离最远的光纤始端事件，将该点对应的距离s转换为OTDR采样点的下标索引n，如果本次OTDR采样精度为Dis，则有，将本次OTDR衰减数组下标索引前n个数据设置为系统定义的无效衰减数字，不参与后续分析计算；查找本次OTDR上报的非反射事件，非反射事件对应的发生距离s，则有，将本次OTDR采样点衰减数组下标索引n与 n + 1对应的衰减值设为无效衰减值，不参与后续分析计算，并且以此，分析并标记反射事件；查找本次OTDR上报的末端事件，将该点对应的距离s转换为OTDR采样点下标索引n2，本次OTDR采样精度为Dis，有：，将本次OTDR采样点衰减数组从下标索引n2开始的数据设置为系统定义的无效衰减数字，不参与后续分析计算。则将上述衰减数组根据遍历时首次出现的无效衰减值作为子数组分界线进行切分，并根据子数组的首个有效衰减值在原衰减数组的索引偏移I，保存每个子数组开始的距离，得到正常衰减区的OTDR数据，有start = IDis。参见说明书附图3，在步骤S3中，所述根据所述光纤衰减斜率得到光纤衰减异常距离段，包括以下步骤：S301、根据设置的光纤衰减斜率变化阈值对所述光纤衰减斜率进行分析，得到光纤衰减异常的可疑起始采样点；S302、利用所述光纤衰减斜率变化阈值获取所述可疑起始采样点对应的第一目标采样点，若所述可疑起始采样点与所述第一目标采样点之间的个数大于设置的连续采样异常点个数，将所述可疑起始采样点确定为光纤衰减异常起始采样点，并得到所述光纤衰减异常起始采样点与所述第一目标采样点构成的光纤衰减异常距离段；S303、利用所述光纤衰减斜率变化阈值获取所述光纤衰减异常起始采样点对应的第二目标采样点，若所述光纤衰减异常起始采样点与所述第二目标采样点之间的个数小于设置的连续采样正常点个数，得到所述光纤衰减异常起始采样点与所述第二目标采样点构成的所述光纤衰减异常距离段的扩充段。在步骤S301-步骤S303中，遍历步骤S2得到的所有衰减子数组，分析每两个OTDR采样点间的光纤衰减斜率。两个OTDR采样点间的衰减斜率代表了在该采样分辨率下，即本次OTDR固定的采样间隔下，OTDR相邻采样点光纤衰减变化的情况，光纤衰减越小，其斜率变化呈水平状态，表示越趋近于零；相邻采样点间光纤衰减越大，其斜率变化也较大，越趋近于垂直方向。在一实施例中，通过OTDR采样点的衰减数组及采样分辨率，第m段子数组的第 I个采样点的链路损耗为Lose，其后一点的链路损耗为Lose，该OTDR采样点间的距离，即采样精度为Dis米， 则从I点到I+1点处的斜率k为：k = –Lose)/ Dis，将该段所有OTDR采样点的斜率k 及该段对应的起始距离保存在数据库中，并依此对所有衰减子数组执行该操作。其中，光纤衰减斜率变化阈值δ可由系统根据传输业务需要质量进行设置，需满足Abs–k)＜δ，如果不满足此条件，则认为是光纤衰减异常的可疑起始采样点，并记录k 处的光纤衰减斜率。得到光纤衰减异常的可疑起始采样点后，需要分析光纤衰减异常的距离是否满足一定距离。系统可配置连续异常采样点个数或连续异常采样的光纤距离，本次OTDR测试的采样分辨率对应的采样精度为Dis，一般的，如果设置连续异常采样的光纤距离为s，则要求其距离大于OTDR采样精度Dis，否则向上取整为1，则连续异常采样点个数。从光纤1处开始，一直到1+ m 处，如果满足k–k＞δ ，且，表明从光纤1处开始，一直到 1+ m 处，这段斜率变化较大，即表明本段光纤衰减较大；此时，如果满足m＞λ，表明从光纤1处开始，一直光纤衰减斜率变化阈值δ设置的1 + m 对应的距离，这段距离的光纤衰减较大，并满足其阈值设置要求，此时光纤1对应的位置从光纤衰减异常的可疑起始采样点变更为确认的光纤衰减异常起始采样点，并得到相应的光纤衰减异常距离段。进一步的，在得到光纤衰减距离后，需要分析后续光纤采样点只是临时恢复了衰减斜率，还是保持一段可信距离的正常衰减。如果只是临时恢复了正常的衰减斜率，但后续又变为异常衰减，则需要扩大异常衰减的范围。其中，系统可配置连续正常采样点个数或连续正常采样的光纤距离，本次OTDR测试的采样分辨率对应的采样精度为Dis，一般的，如果设置连续采样正常点光纤距离为s2，则要求其距离大于OTDR采样精度Dis，否则向上取整为1，则连续正常采样点个数。之后从光纤l + m 处开始，一直到l + m + n 处，如果满足k–k＜δ，且，表明从光纤l + m处开始，一直到系统阈值设置的s2距离处，这段距离的光纤衰减已恢复；此时，如果满足：n＞λ2，则从光纤l + m处开始到l + m + n处的光纤质量符合预期，后续分析从l + m + n + 1 处继续迭代。将l 到 l + m 对应的光纤段保存到不符合预期光纤质量的数据库中；如果不满足n＞λ2，则因为需要斜率衰减稳定的过程并没有稳定，将光纤衰减范围从 l + m 扩充到 l + m + n,并重新执行该步骤寻找正常采样点序列。参见说明书附图4，在步骤S4中，所述根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置，包括以下步骤：S401、获取所述中断事件数组中进行正向OTDR测试的第一中断事件点；S402、若相邻两次正向OTDR测试的第一中断事件点之间的距离小于设置的距离误差阈值，将其归并为同一地点发生的第一中断事件点，得到第一中断事件数组；S403、获取所述中断事件数组中进行反向OTDR测试的第二中断事件点；S404、若相邻两次反向OTDR测试的第二中断事件点之间的距离小于设置的距离误差阈值，将其归并为同一地点发生的第二中断事件点，并且根据光纤链路长度将所述第二中断事件点进行反向替换得到第二中断事件数组；S405、将所述第一中断事件数组和所述第二中断事件数组按照中断事件点位置从小到大进行排序，并且若相邻两个中断事件点之间的距离小于设置的距离误差阈值将其归并为同一地点发生的第三中断事件点，得到第三中断事件数组，以确定纤芯中断位置。在步骤S401-步骤S405中，首先，过滤正向OTDR测试列表中的纤芯中断事件，如果存在，记录每个纤芯中断事件点位置，在一实施例中，第m次的OTDR正向测试中有纤芯中断事件，第m+1次的OTDR正向测试中有 纤芯中断事件，将第m次与第m+1次纤芯中断事件数组按照纤芯中断事件点位置从小到大排序，得到纤芯中断事件数组，OTDR通过对纤芯中断事件的位置进行阈值分析，如果系统设置的同一地点的距离误差阈值为δ2，则有Abs–x)＜δ2，则归并为同一地点发生的OTDR纤芯中断事件点。归并后得到纤芯中断事件数组；之后，依此得到反向OTDR测试的纤芯中断事件，完成后将列表中的纤芯中断事件位置根据光纤链路长度做反向替换，将从Z到A的纤芯中断位置转换为从A到Z的纤芯中断点位置数组。r处转换的过程为Dis) = Dis - r，即得到相对正向OTDR测试的距离。其中，光纤总距离为Dis =采样点个数m采样点间距Dis；最后，比较正向纤芯中断事件数组与经过转换的反向纤芯中断事件数组，将纤芯中断事件数组与纤芯中断事件数组按照纤芯中断事件点位置从小到大排序，得到纤芯中断事件数组, 通过对纤芯中断事件的位置进行阈值分析，如果系统设置的同一地点的距离误差阈值为δ2，则有Abs–x)＜δ2，则认为是同一个纤芯中断点，最终得到纤芯中断数组，定位纤芯的中断位置。另外，在得到所述光纤衰减异常距离段和确定所述纤芯中断位置之后，生成相应的光纤纤芯质量异常告警信息和成光纤纤芯中断告警信息；并且使用WebSocket技术，将告警信息进行推送，如手机短信，微信等。步骤S5中，在实时得到所述光纤衰减异常距离段和确定所述纤芯中断位置之后，还获取同一光纤多次测试的历史OTDR数据，将OTDR采样点数据分发给不同Map节点并由Reduce节点汇总，对光纤衰减斜率变化较大的异常点进行趋势分析，得到直观的位置、光纤衰减值、衰减历经时间的三维表，从而更加有效完成OTDR数据的整合分析。具体的，先得到同一光纤的正向或反向OTDR测试数据。例如，根据Flink保存的信息，获取相同测试链路的OTDR数据，其数据格式为键值对形式，其中键为OTDR测试时间，值为经Flink计算后的OTDR子衰减数组集合信息，并按OTDR测试时间顺序排序；对每个采样点上的光纤衰减数据进行时间维度上的分析。由于每次OTDR采样分辨率可能不同，有的可能较高，有的可能较低，导致计算出的光纤衰减斜率变化对应的光纤采样的精度基准也不相同，为了使得OTDR斜率变化数据归一化到同一采样分辨率，需要遍历不同键值对应的OTDR测试数据，得到OTDR最低采样分辨率n，以该采样精度为基准，为下一步归一化OTDR斜率变化数据做准备；其中，如果所有OTDR测试所采用的采样分辨率相同，即采样精度都为n，则无需归一化光纤衰减斜率；否则，如果第I次OTDR采样精度为m，与得到的最低采样精度n不同，则需要以采样精度n为基准，格式化高采样精度为m的光纤衰减斜率变化值以使得它们在光纤距离采样间隔上保持一致，有：m＞n，T = m / n。即，第I次OTDR采样T个数据采样点，对应基准采样分辨率采样1个数据采样点。根据斜率计算公式: k=–LOSE_OTDR ) / Dis，及距离Dis = TDis，可得k =/ T 。依此，将该光纤路由OTDR测试的数据归一化到最低采样精度n上。即光纤衰减斜率变化大小为m的光纤衰减数组变换为光纤衰减斜率变化大小为n的数组，同时采样分辨率从m调整到采样分辨率n。为后续相同点光纤衰减时序变化做准备；分析OTDR数据随时间的变化，即依次从时间上进行比对，根据归一化OTDR衰减斜率变化后，依次比较每个采样点在时序上的变化情况。比较采样点g对应的第I次与第J次OTDR测试中的斜率变化，其变化的阈值δ可由系统配置设置，需满足Abs–k)＜δ，记录第一次满足该不等式中第I次OTDR测试时间为t1，直到无法满足该不等式，说明两次OTDR测试中该点斜率变化较大，超过了阈值设置，记录该次OTDR测试时间为t2，得到此处g的光纤链路损耗从时间变化维度来观测，OTDR衰减 Abs–k) 经过时间δt = t2–t1，将得到的结果转为该点变化的衰减值Abs–k)，耗时δt，所在本段光纤偏移位置为g，本段偏移保存在数据库中的起始距离为start ：则， Dis = start + Index归一化采样精度n，遍历该点位置所经历的所有时间，反复进行上步骤迭代计算，最终得到该点变化的三维数据) 。至此，形成位置g所在位置的光纤链路衰减变化值，所经时间；对每个采样点均执行上述完整操作后，汇总该段长度为Length的OTDR分析数据，形成该段采样点位置的一维光纤采样点时间汇总对象数组，每一个光纤采样点时间汇总对象有光纤位置，对应的光纤链路衰减值与所经时间形成的一维数组，具体的，Array-Length)发送至Reduce节点。Reduce根据Dis信息，按照光纤路由点位的位置从小到大将J个Map节点键值对归并为一个键值对。最终得到完整的位置，光纤衰减值，经历时间的三维数据，具体为Array-All )，从而为光纤质量评估提供数据基础及底层分析。可见，在本申请提供的一种OTDR数据分析诊断方法，通过实时OTDR数据结合OTDR产生的相关事件信息完成光纤局部质量的诊断，分析出该光纤相对脆弱的部分；根据系统配置的光纤衰减参数阈值，根据正反双向的OTDR数据及相关事件点，分析纤芯损耗衰减斜率变化较大的段位并根据OTDR产生的相关事件定位纤芯中断的位置。并且对同一光纤链路多次测试的OTDR数据及产生的相关事件信息从采样点位置、光纤链路衰减、衰减历经时间进行三维分析，使得系统能反映出该光纤随着时间推移在每个采样点的衰减趋势变化，从而有效完成OTDR数据的整合分析。基于同一发明构思，本申请实施例中还提供了一种OTDR数据分析诊断装置，由于本申请实施例中的装置解决问题的原理与本申请实施例上述一种OTDR数据分析诊断方法相似，因此装置的实施可以参见方法的实施，重复之处不再赘述。如说明书附图5所示，本申请实施例提供的一种OTDR数据分析诊断装置，所述装置包括：采集模块501，用于对不同光纤资源管理系统中的OTDR异构数据进行采集，并将采集的所述OTDR异构数据归一化为设定格式的OTDR数据；其中，所述OTDR数据包括采样分辨率、采样点个数、衰减数组、测试时间和事件数组；第一分析模块502，用于根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据；其中，所述事件数组包括中断事件数组；第二分析模块503，用于对所述正常衰减区的OTDR数据进行分析，得到其中每相邻两个采样点间的光纤衰减斜率，并且根据所述光纤衰减斜率得到光纤衰减异常距离段；确定模块504，用于根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置；第三分析模块505，用于获取同一光纤多次测试的OTDR数据，并对光纤衰减斜率异常的采样点进行趋势分析，得到其位置、光纤衰减值和衰减历经时间的三维表。在一实施例中，所述采集模块501采用数据库驱动适配器或者调用相应API接口的方式，对不同光纤资源管理系统中的OTDR异构数据进行采集，并将采集的所述OTDR异构数据采用数据聚合的方式归一化为设定格式的OTDR数据。在一实施例中，所述第一分析模块502根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据，包括：根据所述OTDR数据中的事件数组，查找产生非中断事件的相关采样点；将查找到的所述相关采样点在所述衰减数组中排除，得到正常衰减区的OTDR数据；其中，所述非中断事件包括光纤始端事件、非反射事件、反射事件和末端事件。在一实施例中，所述第二分析模块503根据所述光纤衰减斜率得到光纤衰减异常距离段，包括：根据设置的光纤衰减斜率变化阈值对所述光纤衰减斜率进行分析，得到光纤衰减异常的可疑起始采样点；利用所述光纤衰减斜率变化阈值获取所述可疑起始采样点对应的第一目标采样点，若所述可疑起始采样点与所述第一目标采样点之间的个数大于设置的连续采样异常点个数，将所述可疑起始采样点确定为光纤衰减异常起始采样点，并得到所述光纤衰减异常起始采样点与所述第一目标采样点构成的光纤衰减异常距离段；利用所述光纤衰减斜率变化阈值获取所述光纤衰减异常起始采样点对应的第二目标采样点，若所述光纤衰减异常起始采样点与所述第二目标采样点之间的个数小于设置的连续采样正常点个数，得到所述光纤衰减异常起始采样点与所述第二目标采样点构成的所述光纤衰减异常距离段的扩充段。在一实施例中，所述确定模块504根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置，包括：获取所述中断事件数组中进行正向OTDR测试的第一中断事件点；若相邻两次正向OTDR测试的第一中断事件点之间的距离小于设置的距离误差阈值，将其归并为同一地点发生的第一中断事件点，得到第一中断事件数组；获取所述中断事件数组中进行反向OTDR测试的第二中断事件点；若相邻两次反向OTDR测试的第二中断事件点之间的距离小于设置的距离误差阈值，将其归并为同一地点发生的第二中断事件点，并且根据光纤链路长度将所述第二中断事件点进行反向替换得到第二中断事件数组；将所述第一中断事件数组和所述第二中断事件数组按照中断事件点位置从小到大进行排序，并且若相邻两个中断事件点之间的距离小于设置的距离误差阈值将其归并为同一地点发生的第三中断事件点，得到第三中断事件数组，以确定纤芯中断位置。在一实施例中，所述装置还包括：推送模块，用于基于得到的所述光纤衰减异常距离段生成光纤纤芯质量异常告警信息，以及基于确定的所述纤芯中断位置生成光纤纤芯中断告警信息；对生成的所述光纤纤芯质量异常告警信息和所述光纤纤芯中断告警信息进行推送。在一实施例中，所述第三分析模块505获取同一光纤多次测试的OTDR数据，并对光纤衰减斜率异常的采样点进行趋势分析，得到其位置、光纤衰减值和衰减历经时间的三维表，包括：基于历史存储的OTDR数据，获取同一光纤多次测试的OTDR数据；根据获取的同一光纤多次测试的OTDR数据确定基准采样分辨率，并基于所述基准采样分辨率归一化光纤衰减斜率；对每个采样点上的归一化OTDR衰减斜率按照时序分析，得到光纤衰减斜率异常的采样点的位置、光纤衰减值和衰减历经时间的三维表。本申请提供的一种OTDR数据分析诊断装置，通过CIA采集模块对不同光纤资源管理系统中的OTDR异构数据进行采集，并将采集的所述OTDR异构数据归一化为设定格式的OTDR数据；其中，所述OTDR数据包括采样分辨率、采样点个数、衰减数组、测试时间和事件数组；通过第一分析模块根据所述OTDR数据中的事件数组对所述衰减数组进行分析，得到正常衰减区的OTDR数据；其中，所述事件数组包括中断事件数组；通过第二分析模块对所述正常衰减区的OTDR数据进行分析，得到其中每相邻两个采样点间的光纤衰减斜率，并且根据所述光纤衰减斜率得到光纤衰减异常距离段；通过确定模块根据所述中断事件数组和设置的距离误差阈值确定纤芯中断位置；通过第三分析模块获取同一光纤多次测试的OTDR数据，并对光纤衰减斜率异常的采样点进行趋势分析，得到其位置、光纤衰减值和衰减历经时间的三维表，从而，实现对光纤相对脆弱部分以及纤芯中断位置的快速分析和诊断，并且利用历史OTDR数据，离线反映出光纤路由中每个采样点衰减趋势变化。基于本发明的同一构思，说明书附图6所示，本申请实施例提供的一种电子设备600的结构，该电子设备600包括：至少一个处理器601，至少一个网络接口604或者其他用户接口603，存储器605，至少一个通信总线602。通信总线602用于实现这些组件之间的连接通信。该电子设备600可选的包含用户接口603，包括显示器或者投影等），键盘或者点击设备，触感板或者触摸屏等）。存储器605可以包括只读存储器和随机存取存储器，并向处理器601提供指令和数据。存储器605的一部分还可以包括非易失性随机存取存储器。在一些实施方式中，存储器605存储了如下的元素，可执行模块或者数据结构，或者他们的子集，或者他们的扩展集：操作系统6051，包含各种系统程序，用于实现各种基础业务以及处理基于硬件的任务；应用程序模块6052，包含各种应用程序，例如桌面、媒体播放器、浏览器等，用于实现各种应用业务。在本申请实施例中，通过调用存储器605存储的程序或指令，处理器601用于执行如一种OTDR数据分析诊断方法中的步骤，能够实现对光纤相对脆弱部分以及纤芯中断位置的快速分析和诊断，并且离线分析出相同纤芯OTDR数据在时间变化上的趋势。本申请还提供了一种计算机可读存储介质，该计算机可读存储介质上存储有计算机程序，该计算机程序被处理器运行时执行如OTDR数据分析诊断方法中的步骤。具体地，该存储介质能够为通用的存储介质，如移动磁盘、硬盘等，该存储介质上的计算机程序被运行时，能够执行上述OTDR数据分析诊断方法。在本申请所提供的实施例中，应该理解到，所揭露装置和方法，可以通过其它的方式实现。以上所描述的装置实施例仅仅是示意性的，例如，单元的划分，仅仅为一种逻辑功能划分，实际实现时可以有另外的划分方式，又例如，多个单元或组件可以结合或者可以集成到另一个系统，或一些特征可以忽略，或不执行。另一点，所显示或讨论的相互之间的耦合或直接耦合或通信连接可以是通过一些通信接口，装置或单元的间接耦合或通信连接，可以是电性，机械或其它的形式。作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部单元来实现本实施例方案的目的。另外，在本申请提供的实施例中的各功能单元可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中。功能如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本申请的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台计算机设备执行本申请各个实施例方法的全部或部分步骤。而前述的存储介质包括：U盘、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质。最后应说明的是：以上实施例，仅为本申请的具体实施方式，用以说明本申请的技术方案，而非对其限制，本申请的保护范围并不局限于此，尽管参照前述实施例对本申请进行了详细的说明，本领域的普通技术人员应当理解：任何熟悉本技术领域的技术人员在本申请揭露的技术范围内，其依然可以对前述实施例所记载的技术方案进行修改或可轻易想到变化，或者对其中部分技术特征进行等同替换；而这些修改、变化或者替换，并不使相应技术方案的本质脱离本申请实施例技术方案的精神和范围。都应涵盖在本申请的保护范围之内。因此，本申请的保护范围应以权利要求的保护范围为准。
