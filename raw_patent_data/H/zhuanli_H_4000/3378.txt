标题title
一种场景自适应的AEC目标亮度控制方法
摘要abst
本发明提供一种场景自适应的AEC目标亮度控制方法，包括以下步骤：步骤S1：获得L路图像的第一亮度直方图和S路图像的第二亮度直方图，并根据所述第一亮度直方图、所述第二亮度直方图、L路图像的曝光时间和L路图像的增益，分别计算出环境亮度表征值、所述L路图像的第一过曝光点值和所述S路图像的第二过曝光点值；以及步骤S2：根据所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值，判断当前场景并根据所述当前场景控制所述L路图像的AEC目标亮度，可以区分白天和晚上，又能区分有无车灯的环境，消除或减小最终HDR图像中的车灯周围灰色区域。
权利要求书clms
1.一种场景自适应的AEC目标亮度控制方法，其特征在于，包括以下步骤：步骤S1：获得L路图像的第一亮度直方图和S路图像的第二亮度直方图，并根据所述第一亮度直方图、所述第二亮度直方图、L路图像的曝光时间和L路图像的增益，分别计算出环境亮度表征值、所述L路图像的第一过曝光点值和所述S路图像的第二过曝光点值；以及步骤S2：根据所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值，判断当前场景并根据所述当前场景控制所述L路图像的AEC目标亮度。2.如权利要求1所述的场景自适应的AEC目标亮度控制方法，其特征在于，步骤S1包括：设置HDR传感器L路的所述当前AEC目标亮度的阈值、最大曝光时间和最大增益；使用所述HDR传感器L路获得所述L路图像，使用所述HDR传感器S路获得所述S路图像；根据所述L路图像获得所述第一亮度直方图，根据所述S路图像获得所述第二亮度直方图；以及根据所述第一亮度直方图、所述第二亮度直方图、所述最大曝光时间和所述最大增益，分别计算出所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值。3.如权利要求2所述的场景自适应的AEC目标亮度控制方法，其特征在于，所述当前AEC目标亮度T在T1～T2之间，其中，T1和T2均为T的阈值，且T1＜T2。4.如权利要求2所述的场景自适应的AEC目标亮度控制方法，其特征在于，获得所述第一亮度直方图和所述第二亮度直方图之后还包括：将所述第一亮度直方图和所述第二亮度直方图分别按照亮度划分成K个区块，且亮度从第一个区块至第K个区块逐渐增大，其中，每个所述区块大小相同，且每个所述区块对应的亮度值域相同，所述第一亮度直方图和所述第二亮度直方图均对应有亮度最低区域和亮度过曝区域；以及记录所述第一亮度直方图中所述亮度最低区域后第一个像素点所在区块的区块位置。5.如权利要求4所述的场景自适应的AEC目标亮度控制方法，其特征在于，记录所述区块位置的方法包括：设置落在所述第一亮度直方图中所述亮度最低区域的像素点数百分比Dpercent，并根据所述像素点数百分比从所述第一个区块开始逐一统计落在所述亮度最低区域的像素点数SumD，并在SumD≥DpercentⅹWⅹH时，记录像素点数SumD所在区块的区块位置，其中，所述像素点数百分比Dpercent的取值小于100％。6.如权利要求4所述的场景自适应的AEC目标亮度控制方法，其特征在于，计算所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值的方法包括：根据所述最大曝光时间和所述最大增益，对所述区块位置的取值进行归一化处理，以计算出所述环境亮度表征值；以及统计所述第一亮度直方图中落在所述亮度过曝光区域中的像素点数，以得到所述第一过曝光像素点数；统计所述第二亮度直方图落在所述亮度过曝光区域中的像素点数，以得到所述第二过曝光像素点数。7.如权利要求6所述的场景自适应的AEC目标亮度控制方法，其特征在于，所述第一亮度直方图为线性域亮度直方图，所述环境亮度表征值DP满足以下公式：DP＝ⅹMaxEⅹMaxG/E0/G0-1；其中，MaxE为最大曝光时间，MaxG为最大增益，E0为当前曝光时间，G0为当前增益，DP0为所述第一亮度直方图中亮度最低区域后第一个像素点所在区块的区块位置。8.如权利要求6所述的场景自适应的AEC目标亮度控制方法，其特征在于，所述第一亮度直方图为log域亮度直方图，所述环境亮度表征值DP满足以下公式：DP＝DP0+log/Y0；其中，MaxE为最大曝光时间，MaxG为最大增益，E0为当前曝光时间，G0为当前增益，Y0为所述第一亮度直方图的每个区块对应的亮度值域，DP0为所述第一亮度直方图中亮度最低区域后第一个像素点所在区块的区块位置。9.如权利要求6所述的场景自适应的AEC目标亮度控制方法，其特征在于，统计所述第一过曝光像素点数和所述第二过曝光像素点数的方法包括：设置所述L路图像落在所述亮度过曝光区域的统计开始区块位置KL，设置所述S路图像落在所述亮度过曝光区域的统计开始区块位置KS，设置所述当前AEC目标亮度升高后所述L路图像落在所述亮度过曝光区域的统计开始区块位置K'L，其中，K'L＜KL；以及统计所述第一亮度直方图中落在KL～K间的像素点数，以得到所述第一过曝光像素点数，统计所述第二亮度直方图中落在KS～K间的像素点数，以得到所述第二过曝光像素点数，统计所述第一亮度直方图中落在K'L～K间的像素点数，以得到第三过曝光像素点数。10.如权利要求9所述的场景自适应的AEC目标亮度控制方法，其特征在于，统计所述开始区块位置K'L满足公式：K'L＝KLⅹT/；其中，T为当前AEC目标亮度，A为调节参数。11.如权利要求9所述的场景自适应的AEC目标亮度控制方法，其特征在于，步骤S2包括：设置所述第一过曝光像素点数的阈值、所述第二过曝光像素点数的阈值和所述第三过曝光像素点数的阈值；以及对所述环境亮度表征值与其阈值进行比较，分别对所述第一过曝光像素点数与其阈值，所述第二过曝光像素点数与其阈值以及所述第三过曝光像素点数与其阈值进行比较，并根据比较结果判断当前场景，以控制所述L路图像的AEC目标亮度。12.如权利要求11所述的场景自适应的AEC目标亮度控制方法，其特征在于，判断当前场景的方法包括：满足条件a：T＞T1，DP≤DPTh1，B1≥SLTh1，B2≥SSTh时，则当前场景处于晚上有车灯环境，此时，将所述当前AEC目标亮度降低，以得到调整后的AEC目标亮度；满足条件b：T＜T2，DP≥DPTh2，或者，T＜T2，B3≤SLTh2时，则当前场景处于白天或者晚上无车灯环境，此时，将所述当前AEC目标亮度升高，以得到调整后的AEC目标亮度；不满足条件a和b时，所述当前AEC目标亮度保持不变；以及其中，B1为所述第一过曝光像素点数，B2为所述第二过曝光像素点数，B3为所述第三过曝光像素点数，DP为环境亮度表征值，DPTh1和DPTh2均为DP的阈值，SLTh1和SLTh2均为B1的阈值，SSTh为B2的阈值，T1和T2均为T的阈值，DPTh1＜DPTh2，SLTh2＜SLTh1，T1＜T＜T2。13.如权利要求12所述的场景自适应的AEC目标亮度控制方法，其特征在于，所述当前AEC目标亮度降低得到的调整后的AEC目标亮度Tnext1为：Tnext1＝T-A；所述当前AEC目标亮度升高得到的调整后的AEC目标亮度Tnext2为：Tnext2＝T+A；其中，T为当前AEC目标亮度，A为调节参数。
说明书desc
技术领域本发明涉及图像显示领域，特别涉及一种场景自适应的AEC目标亮度控制方法。背景技术随着电子技术的发展，照相功能已成为移动终端中不可缺少的核心功能。车载摄像头在成像时需要解决LED闪烁的问题，为此，使用了包含有大尺寸像素和小尺寸像素的HDR传感器，由于L路图像由大尺寸像素曝光生成，且L路图像为亮图像，S路图像由小尺寸像素曝光生成，且S路图像为暗图像，同时通过短曝光通道来保证最小曝光时间。但是，如图1所示，由于大尺寸像素和小尺寸像素的灵敏度相差太大，对于晚上有车灯的环境，L路图像往往在车灯周围有较大面积的亮度过曝区域，而S路图像往往只有在车灯中心是亮的，其它区域均是暗的。这样，在L路图像与S路图像结合形成HDR图像时，由于车灯周围区域在L路图像和S路图像中都没有足够的信息而呈现灰色，即HDR图像在车灯周围形成一圈较大的灰色区域a，影响了HDR成像效果。目前，在HDR成像方案中，通常采用以下三种方式来控制AEC目标亮度：第一种，各曝光通道的AEC目标亮度始终固定并保持不变，但是，这种控制方法存在不能适应不同的场景，并在晚上有车灯的环境会在车灯周围形成灰色区域a的问题；第二种，基于亮度直方图中对应的亮度过曝光区域来调节AEC目标亮度，但是，这种控制方法只考虑了图像中的过曝光区域，无法区分白天和晚上，依然存在在晚上有车灯的环境会在车灯周围形成灰色区域a的问题；第三种，利用曝光时间和增益来区分白天和晚上，并结合亮度过曝光区域来设置不同的AEC目标亮度，但是这种控制方法单纯使用曝光时间和增益来判断白天和晚上，其并不准确，造成误判率非常高，并且由于其没有考虑改变AEC目标亮度后对判断结果的影响，往往导致AEC目标亮度不稳定，从而造成HDR图像亮度振荡。发明内容本发明的目的在于，提供一种场景自适应的AEC目标亮度控制方法，可以改善在晚上有车灯的环境会在车灯周围形成灰色区域的问题。为了解决上述问题，本发明提供一种场景自适应的AEC目标亮度控制方法，包括以下步骤：步骤S1：获得L路图像的第一亮度直方图和S路图像的第二亮度直方图，并根据所述第一亮度直方图、所述第二亮度直方图、L路图像的曝光时间和L路图像的增益，分别计算出环境亮度表征值、所述L路图像的第一过曝光点值和所述S路图像的第二过曝光点值；以及步骤S2：根据所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值，判断当前场景并根据所述当前场景控制所述L路图像的AEC目标亮度。可选的，步骤S1包括：设置HDR传感器L路的所述当前AEC目标亮度的阈值、最大曝光时间和最大增益；使用所述HDR传感器L路获得所述L路图像，使用所述HDR传感器S路获得所述S路图像；根据所述L路图像获得所述第一亮度直方图，根据所述S路图像获得所述第二亮度直方图；以及根据所述第一亮度直方图、所述第二亮度直方图、所述最大曝光时间和所述最大增益，分别计算出所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值。进一步的，所述当前AEC目标亮度T在T1～T2之间，其中，T1和T2均为T的阈值，且T1＜T2。进一步的，获得所述第一亮度直方图和所述第二亮度直方图之后还包括：将所述第一亮度直方图和所述第二亮度直方图分别按照亮度划分成K个区块，且亮度从第一个区块至第K个区块逐渐增大，其中，每个所述区块大小相同，且每个所述区块对应的亮度值域相同，所述第一亮度直方图和所述第二亮度直方图均对应有亮度最低区域和亮度过曝区域；以及记录所述第一亮度直方图中所述亮度最低区域后第一个像素点所在区块的区块位置。进一步的，记录所述区块位置的方法包括：设置落在所述第一亮度直方图中所述亮度最低区域的像素点数百分比Dpercent，并根据所述像素点数百分比从所述第一个区块开始逐一统计落在所述亮度最低区域的像素点数SumD，并在SumD≥DpercentⅹWⅹH时，记录像素点数SumD所在区块的区块位置，其中，所述像素点数百分比Dpercent的取值小于100％。进一步的，计算所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值的方法包括：根据所述最大曝光时间和所述最大增益，对所述区块位置的取值进行归一化处理，以计算出所述环境亮度表征值；以及统计所述第一亮度直方图中落在所述亮度过曝光区域中的像素点数，以得到所述第一过曝光像素点数；统计所述第二亮度直方图落在所述亮度过曝光区域中的像素点数，以得到所述第二过曝光像素点数。进一步的，所述第一亮度直方图为线性域亮度直方图，所述环境亮度表征值DP满足以下公式：DP＝ⅹMaxEⅹMaxG/E0/G0-1；其中，MaxE为最大曝光时间，MaxG为最大增益，E0为当前曝光时间，G0为当前增益，DP0为所述第一亮度直方图中亮度最低区域后第一个像素点所在区块的区块位置。进一步的，所述第一亮度直方图为log域亮度直方图，所述环境亮度表征值DP满足以下公式：DP＝DP0+log/Y0；其中，MaxE为最大曝光时间，MaxG为最大增益，E0为当前曝光时间，G0为当前增益，Y0为所述第一亮度直方图的每个区块对应的亮度值域，DP0为所述第一亮度直方图中亮度最低区域后第一个像素点所在区块的区块位置。进一步的，统计所述第一过曝光像素点数和所述第二过曝光像素点数的方法包括：设置所述L路图像落在所述亮度过曝光区域的统计开始区块位置KL，设置所述S路图像落在所述亮度过曝光区域的统计开始区块位置KS，设置所述当前AEC目标亮度升高后所述L路图像落在所述亮度过曝光区域的统计开始区块位置K'L，其中，K'L＜KL；统计所述第一亮度直方图中落在KL～K间的像素点数，以得到所述第一过曝光像素点数，统计所述第二亮度直方图中落在KS～K间的像素点数，以得到所述第二过曝光像素点数，统计所述第一亮度直方图中落在K'L～K间的像素点数，以得到第三过曝光像素点数。进一步的，统计所述开始区块位置K'L满足公式：K'L＝KLⅹT/；其中，T为当前AEC目标亮度，A为调节参数。进一步的，步骤S2包括：设置所述第一过曝光像素点数的阈值、所述第二过曝光像素点数的阈值和所述第三过曝光像素点数的阈值；以及对所述环境亮度表征值与其阈值进行比较，分别对所述第一过曝光像素点数与其阈值，所述第二过曝光像素点数与其阈值以及所述第三过曝光像素点数与其阈值进行比较，并根据比较结果判断当前场景，以控制所述L路图像的AEC目标亮度。进一步的，判断当前场景的方法包括：满足条件a：T＞T1，DP≤DPTh1，B1≥SLTh1，B2≥SSTh时，则当前场景处于晚上有车灯环境，此时，将所述当前AEC目标亮度降低，以得到调整后的AEC目标亮度；满足条件b：T＜T2，DP≥DPTh2，或者，T＜T2，B3≤SLTh2时，则当前场景处于白天或者晚上无车灯环境，此时，将所述当前AEC目标亮度升高，以得到调整后的AEC目标亮度；不满足条件a和b时，所述当前AEC目标亮度保持不变；其中，B1为所述第一过曝光像素点数，B2为所述第二过曝光像素点数，B3为所述第三过曝光像素点数，DP为环境亮度表征值，DPTh1和DPTh2均为DP的阈值，SLTh1和SLTh2均为B1的阈值，SSTh为B2的阈值，T1和T2均为T的阈值，DPTh1＜DPTh2，SLTh2＜SLTh1，T1＜T＜T2。进一步的，所述当前AEC目标亮度降低得到的调整后的AEC目标亮度Tnext1为：Tnext1＝T-A；所述当前AEC目标亮度升高得到的调整后的AEC目标亮度Tnext2为：Tnext2＝T+A；其中，T为当前AEC目标亮度，A为调节参数。与现有技术相比，本发明具有以下有益效果：本发明提供一种场景自适应的AEC目标亮度控制方法，包括以下步骤：步骤S1：获得L路图像的第一亮度直方图和S路图像的第二亮度直方图，并根据所述第一亮度直方图、所述第二亮度直方图、L路图像的曝光时间和L路图像的增益，分别计算出环境亮度表征值、所述L路图像的第一过曝光点值和所述S路图像的第二过曝光点值；以及步骤S2：根据所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值，判断当前场景并根据所述当前场景控制所述L路图像的AEC目标亮度，可以区分白天和晚上，又能区分有无车灯的环境，消除或减小最终HDR图像中的车灯周围灰色区域。进一步的，根据所述最大曝光时间和所述最大增益，对所述区块位置的取值进行归一化处理，以计算出所述环境亮度表征值，可以避免了由于曝光时间和增益的变化使亮度直方图变化导致计算出的环境亮度表征值变化。附图说明图1为在晚上有车灯的环境下在车灯周围形成灰色区域的示意图；图2为本发明一实施例的一种场景自适应的AEC目标亮度控制方法的流程示意图；图3为本发明一实施例的步骤S1的流程示意图；图4为本发明一实施例的步骤S2的流程示意图。具体实施方式以下将对本发明的一种场景自适应的AEC目标亮度控制方法作进一步的详细描述。下面将参照附图对本发明进行更详细的描述，其中表示了本发明的优选实施例，应该理解本领域技术人员可以修改在此描述的本发明而仍然实现本发明的有利效果。因此，下列描述应当被理解为对于本领域技术人员的广泛知道，而并不作为对本发明的限制。为了清楚，不描述实际实施例的全部特征。在下列描述中，不详细描述公知的功能和结构，因为它们会使本发明由于不必要的细节而混乱。应当认为在任何实际实施例的开发中，必须做出大量实施细节以实现开发者的特定目标，例如按照有关系统或有关商业的限制，由一个实施例改变为另一个实施例。另外，应当认为这种开发工作可能是复杂和耗费时间的，但是对于本领域技术人员来说仅仅是常规工作。为使本发明的目的、特征更明显易懂，下面结合附图对本发明的具体实施方式作进一步的说明。需说明的是，附图均采用非常简化的形式且均使用非精准的比率，仅用以方便、明晰地辅助说明本发明实施例的目的。由于HDR传感器L路图像为亮图像，HDR传感器S路图像为暗图像，因此，在夜晚环境下的S路图像整体亮度非常低，若通过控制夜晚环境下的HDR传感器S路的AEC目标亮度是无法解决灰色区域的问题的，因此本发明通过控制HDR传感器L路的AEC目标亮度来解决灰色区域的问题。基于此，图2为本实施例的一种场景自适应的AEC目标亮度控制方法的流程示意图。如图2所示，本实施例提供一种场景自适应的AEC目标亮度控制方法，包括以下步骤：步骤S1：获得L路图像的第一亮度直方图和S路图像的第二亮度直方图，并根据所述第一亮度直方图、所述第二亮度直方图、L路图像的曝光时间和L路图像的增益，分别计算出环境亮度表征值、所述L路图像的第一过曝光点值和所述S路图像的第二过曝光点值；以及步骤S2：根据所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值，判断当前场景并根据所述当前场景控制所述L路图像的AEC目标亮度。以下结合图3和4对本实施例提供的一种场景自适应的AEC目标亮度控制方法进行详细说明。图3为本实施例的步骤S1的流程示意图。如图3所示，首先执行步骤S1，获得L路图像的第一亮度直方图和S路图像的第二亮度直方图，并根据所述第一亮度直方图、所述第二亮度直方图、L路图像的曝光时间和L路图像的增益，分别计算出环境亮度表征值、所述L路图像的第一过曝光点值和所述S路图像的第二过曝光点值。本步骤利用亮度直方图、曝光时间和增益，有利于完成当前场景判断，自适应地调节HDR传感器L曝光通道的AEC目标亮度，从而消除或减小了最终的HDR图像中的车灯周围灰色区域。本步骤具体包括：步骤S11，设置HDR传感器L路的所述当前AEC目标亮度的阈值T、最大曝光时间和最大增益，其中，T在T1～T2之间，T1和T2均为T的阈值，且T1＜T2。所述当前AEC目标亮度T是可调的，且所述当前AEC目标亮度T可以分阶段进行调节，每次只能调节一个调节参数A，使得所述当前AEC目标亮度T可以升高，且升高后的AEC目标亮度为T+A，所述当前AEC目标亮度T也可以降低，且降低后的AEC目标亮度为T-A，且在L路的当前曝光时间小于所述最大曝光时间，L路的当前增益小于所述最大增益。步骤S12，使用所述HDR传感器L路获得所述L路图像，使用所述HDR传感器S路获得所述S路图像。由于大尺寸像素的透光率比小尺寸像素的透光率高，使得所述L路图像为亮图像，所述S路图像为暗图像，也就是说，L路图像的整体亮度较S路图像的整体亮度高。在当前AEC目标亮度T升高时，L路图像的整体亮度变大，当前AEC目标亮度T降低时，L路图像的整体亮度变小。其中，所述L路图像的分辨率与所述S路图像的分辨率相同，使得所述L路图像的分辨率与所述S路图像的分辨率均为WⅹH，W为L路图像或S路图像中每行像素点数，此处称为图像宽，H为L路图像或S路图像中每列像素点数，此处称为图像高。步骤S13，根据所述L路图像获得第一亮度直方图，根据所述S路图像获得第二亮度直方图。接着，将所述第一亮度直方图和所述第二亮度直方图分别按照亮度划分成K个区块，且亮度从第一个区块至第K个区块逐渐增大，使得第一个区块的亮度最低，第K个区块的亮度最高。其中，每个所述区块大小相同，且每个所述区块对应的亮度值域相同，且为Y0，所述第一亮度直方图和第二亮度直方图均对应有亮度最低区域和亮度过曝区域，使得部分所述区块中的像素点落在亮度最低区域，部分所述区块中的像素点落在亮度过曝区域，且所述亮度最低区域可以根据总像素点数的像素点百分比来统计数量，并从亮度最低的第一个区块开始统计；亮度过曝区域根据亮度过曝阈值来统计。接着，记录所述第一亮度直方图中所述亮度最低区域后第一个像素点所在区块的区块位置DP0。详细的，设置落在所述第一亮度直方图中所述亮度最低区域的像素点数百分比Dpercent，并根据所述像素点数百分比从所述第一个区块开始逐一统计落在所述亮度最低区域的像素点数SumD，即SumD＝DpercentⅹWⅹH，并在SumD≥DpercentⅹWⅹH时，记录像素点数SumD所在区块的区块位置，其中，所述像素点数百分比Dpercent的取值小于100％。步骤S14，根据所述第一亮度直方图、所述第二亮度直方图、所述最大曝光时间和所述最大增益，分别计算出所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值。本步骤具体包括：首先，根据所述最大曝光时间和所述最大增益，对所述区块位置的取值DP0进行归一化处理，以计算出环境亮度表征值DP，避免了由于曝光时间和增益的变化使亮度直方图变化引起环境亮度表征值变化。所述第一亮度直方图为线性域亮度直方图，所述环境亮度表征值DP满足以下公式：DP＝ⅹMaxEⅹMaxG/E0/G0-1；所述第一亮度直方图为log域亮度直方图，所述环境亮度表征值DP满足以下公式：DP＝DP0+log/Y0；其中，MaxE为最大曝光时间，MaxG为最大增益，E0为当前曝光时间，G0为当前增益，Y0为第一亮度直方图的每个区块对应的亮度值域，DP0为第一亮度直方图中亮度最低区域后第一个像素点所在区块的区块位置。接着，统计所述第一亮度直方图中落在所述亮度过曝光区域中的像素点数，以得到所述第一过曝光像素点数；统计所述第二亮度直方图落在所述亮度过曝光区域中的像素点数，以得到所述第二过曝光像素点数。详细的，首先，设置所述L路图像落在所述亮度过曝光区域的统计开始区块位置KL，设置所述S路图像落在所述亮度过曝光区域的统计开始区块位置KS，设置所述当前AEC目标亮度升高后所述L路图像落在所述亮度过曝光区域的统计开始区块位置K'L。其中，由于AEC目标亮度值增加，使得所述L路图像的整体亮度变大，这样变量后的L路图像的开始区块位置从KL变为K'L，且K'L＜KL。统计所述开始区块位置K'L满足公式：K'L＝KLⅹT/；其中，T为当前AEC目标亮度，A为一个调节阶段。其次，统计所述第一亮度直方图中落在KL～K间的像素点数，以得到所述第一过曝光像素点数，统计所述第二亮度直方图中落在KS～K间的像素点数，以得到所述第二过曝光像素点数，统计所述第一亮度直方图中落在K'L～K间的像素点数，以得到第三过曝光像素点数。本步骤通过考虑第一亮度直方图中对应的亮度最低区域和亮度过曝区域，以及第二亮度直方图的亮度过曝区域，既能得到环境亮度表征值来区分白天和晚上，又能区分有无车灯的环境。图4为本实施例的步骤S2的流程示意图。如图4所示，接着执行步骤S2，根据所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值，判断当前场景，并根据所述当前场景控制所述L路图像的AEC目标亮度。本步骤具体包括：首先，设置所述第一过曝光像素点数的阈值、第二过曝光像素点数的阈值和第三过曝光像素点数的阈值。接着，对所述环境亮度表征值与其阈值进行比较，分别对所述第一过曝光像素点数与其阈值，所述第二过曝光像素点数与其阈值以及所述第三过曝光像素点数与其阈值进行比较，并根据比较结果判断当前场景，以控制所述L路图像的AEC目标亮度。根据比较结果判断当前场景具体包括：满足条件a：T＞T1，DP≤DPTh1，B1≥SLTh1，B2≥SSTh时，则当前场景处于晚上有车灯环境，此时，将所述当前AEC目标亮度降低，以得到降低后的AEC目标亮度Tnext1为：Tnext1＝T-A，以减小L路图像的亮度过曝光区域，从而消除或减小了最终的HDR图像中的车灯周围灰色区域。满足条件b：T＜T2，DP≥DPTh2，或者，T＜T2，B3≤SLTh2时，则当前场景处于白天或者晚上无车灯环境，此时，将所述当前AEC目标亮度升高，以得到升高后的AEC目标亮度Tnext2为：Tnext2＝T+A，以保证正常的成像质量。其中，B1为所述第一过曝光像素点数，B2为所述第二过曝光像素点数，B3为所述第三过曝光像素点数，DP为环境亮度表征值，DPTh1和DPTh2均为DP的阈值，SLTh1和SLTh2均为B1的阈值，T1和T2均为T的阈值，SSTh为B2的阈值，DPTh1＜DPTh2，SLTh2＜SLTh1，T1＜T＜T2。不满足条件a和b时，则表示目前场景不明，无法判断，此时，所述当前AEC目标亮度保持不变。综上所述，本发明提供一种场景自适应的AEC目标亮度控制方法，包括以下步骤：步骤S1：获得L路图像的第一亮度直方图和S路图像的第二亮度直方图，并根据所述第一亮度直方图、所述第二亮度直方图、L路图像的曝光时间和L路图像的增益，分别计算出环境亮度表征值、所述L路图像的第一过曝光点值和所述S路图像的第二过曝光点值；以及步骤S2：根据所述环境亮度表征值、所述第一过曝光点值和所述第二过曝光点值，判断当前场景并根据所述当前场景控制所述L路图像的AEC目标亮度，使得本发明利用亮度直方图、曝光时间和增益，完成当前场景判断，自适应地调节L曝光通道的AEC目标亮度，消除或减小了最终的HDR图像中的车灯周围灰色区域。此外，需要说明的是，除非特别说明或者指出，否则说明书中的术语“第一”、“第二”的描述仅仅用于区分说明书中的各个组件、元素、步骤等，而不是用于表示各个组件、元素、步骤之间的逻辑关系或者顺序关系等。可以理解的是，虽然本发明已以较佳实施例披露如上，然而上述实施例并非用以限定本发明。对于任何熟悉本领域的技术人员而言，在不脱离本发明技术方案范围情况下，都可利用上述揭示的技术内容对本发明技术方案作出许多可能的变动和修饰，或修改为等同变化的等效实施例。因此，凡是未脱离本发明技术方案的内容，依据本发明的技术实质对以上实施例所做的任何简单修改、等同变化及修饰，均仍属于本发明技术方案保护的范围内。
