标题title
流量的调度方法、装置、存储介质及电子装置
摘要abst
本发明实施例提供了一种流量的调度方法、装置、存储介质及电子装置，其中，该方法包括：确定与目标报文关联的目标容器组的目标标识信息，其中，目标标识信息为在确定目标容器组存在目标网络服务质量需求的情况下，为目标容器组分配的信息；基于目标标识信息将目标报文的第一字段修改为目标字段，其中，第一字段用于标识目标报文；确定与目标字段对应的队列类型；将目标报文发送至队列类型所对应的目标队列中，以调度目标容器组的流量。通过本发明，解决了相关技术中存在的流量调度速度慢的问题，达到提高流量调度的效率的效果。
权利要求书clms
1.一种流量的调度方法，其特征在于，包括：确定与目标报文关联的目标容器组的目标标识信息，其中，所述目标标识信息为在确定所述目标容器组存在目标网络服务质量需求的情况下，为所述目标容器组分配的信息；基于所述目标标识信息将所述目标报文的第一字段修改为目标字段，其中，所述第一字段用于标识所述目标报文；确定与所述目标字段对应的队列类型；将所述目标报文发送至所述队列类型所对应的目标队列中，以调度所述目标容器组的流量。2.根据权利要求1所述的方法，其特征在于，确定与目标报文关联的目标容器组的目标标识信息包括：在所述目标报文为所述目标容器组发送的报文的情况下，获取所述目标容器组的注释信息，基于所述注释信息确定所述目标容器组的所述网络服务质量需求，确定基于所述网络服务质量需求为所述目标容器组分配的所述目标标识信息；在所述目标报文为待发送至容器组中的报文的情况下，获取所述目标报文所携带的目标网络地址，将网络地址为所述目标网络地址的容器组确定为所述目标容器组，确定所述目标容器组的所述目标标识信息。3.根据权利要求1所述的方法，其特征在于，基于所述目标标识信息修改所述目标报文的目标字段包括：通过目标程序将所述目标字段修改为所述目标标识信息。4.根据权利要求1所述的方法，其特征在于，在将所述目标报文发送至所述队列类型所对应的目标队列中之前，所述方法还包括：确定所述目标容器组所在的目标节点；在所述目标节点中创建所述目标队列。5.根据权利要求4所述的方法，其特征在于，在所述目标节点中创建所述目标队列包括：确定所述目标容器组的目标网络服务质量需求；基于所述目标网络服务质量需求以及所述目标标识信息在所述目标节点的物理网卡和虚拟网卡中创建所述目标队列。6.根据权利要求4所述的方法，其特征在于，在确定所述目标容器组所在的目标节点之前，所述方法还包括：基于所述目标容器组的注释信息确定所述目标网络服务质量需求中包括的最小带宽；从集群中包括的节点中确定出剩余带宽大于所述最小带宽的第一节点；从所述第一节点中确定出满足预定条件的所述目标节点；在所述目标节点中创建所述目标容器组。7.根据权利要求6所述的方法，其特征在于，在所述目标节点中创建所述目标容器组之后，所述方法还包括：在创建所述目标容器组成功的情况下，确定所述目标节点的剩余带宽与所述最小带宽的差值，得到差值带宽；将所述目标节点的剩余带宽更新为所述差值带宽。8.一种流量的调度装置，其特征在于，包括：第一确定模块，用于确定与目标报文关联的目标容器组的目标标识信息，其中，所述目标标识信息为在确定所述目标容器组存在目标网络服务质量需求的情况下，为所述目标容器组分配的信息；修改模块，用于基于所述目标标识信息将所述目标报文的第一字段修改为目标字段，其中，所述第一字段用于标识所述目标报文；第二确定模块，用于确定与所述目标字段对应的队列类型；调度模块，用于将所述目标报文发送至所述队列类型所对应的目标队列中，以调度所述目标容器组的流量。9.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质中存储有计算机程序，其中，所述计算机程序被设置为运行时执行所述权利要求1至7任一项中所述的方法。10.一种电子装置，包括存储器和处理器，其特征在于，所述存储器中存储有计算机程序，所述处理器被设置为运行所述计算机程序以执行所述权利要求1至7任一项中所述的方法。
说明书desc
技术领域本发明实施例涉及容器云技术领域，具体而言，涉及一种流量的调度方法、装置、存储介质及电子装置。背景技术在相关技术中，在进行流量调度时，通常需要对容器组的IP地址进行过滤，通过tc filter，用于Linux内核的流量控制，主要是通过在输出端口处建立一个队列来实现流量控制）确定接收报文的tc class。由此可知，相关技术中存在流量调度速度慢的问题。针对相关技术中存在的上述问题，目前尚未提出有效的解决方案。发明内容本发明实施例提供了一种流量的调度方法、装置、存储介质及电子装置，以至少解决相关技术中存在的流量调度速度慢的问题。根据本发明的一个实施例，提供了一种流量的调度方法，包括：确定与目标报文关联的目标容器组的目标标识信息，其中，所述目标标识信息为在确定所述目标容器组存在目标网络服务质量需求的情况下，为所述目标容器组分配的信息；基于所述目标标识信息将所述目标报文的第一字段修改为目标字段，其中，所述第一字段用于标识所述目标报文；确定与所述目标字段对应的队列类型；将所述目标报文发送至所述队列类型所对应的目标队列中，以调度所述目标容器组的流量。根据本发明的另一个实施例，提供了一种流量的调度装置，包括：第一确定模块，用于确定与目标报文关联的目标容器组的目标标识信息，其中，所述目标标识信息为在确定所述目标容器组存在目标网络服务质量需求的情况下，为所述目标容器组分配的信息；修改模块，用于基于所述目标标识信息将所述目标报文的第一字段修改为目标字段，其中，所述第一字段用于标识所述目标报文；第二确定模块，用于确定与所述目标字段对应的队列类型；调度模块，用于将所述目标报文发送至所述队列类型所对应的目标队列中，以调度所述目标容器组的流量。根据本发明的又一个实施例，还提供了一种计算机可读存储介质，所述计算机可读存储介质中存储有计算机程序，其中，所述计算机程序被设置为运行时执行上述任一项方法实施例中的步骤。根据本发明的又一个实施例，还提供了一种电子装置，包括存储器和处理器，所述存储器中存储有计算机程序，所述处理器被设置为运行所述计算机程序以执行上述任一项方法实施例中的步骤。通过本发明，确定与目标报文关联的目标容器组的目标标识信息，其中，目标标识信息为在确定目标容器组存在目标网络服务质量需求的情况下，为目标容器组分配的信息，根据目标标识信息将目标报文的第一字段修改为目标字段，确定与目标字段对应的队列类型，将目标报文发送至队列类型所对应的目标队列中，以调度目标容器组的流量。由于在调度目标容器组的流量时，可以根据为目标容器组分配的目标标识信息确定目标队列，无需进行过滤，因此，可以解决相关技术中存在的流量调度速度慢的问题，达到提高流量调度的效率的效果。附图说明图1是本发明实施例的一种流量的调度方法的移动终端的硬件结构框图；图2是根据本发明实施例的流量的调度方法的流程图；图3是根据本发明实施例的目标容器组发送流量的流程图；图4是根据本发明实施例的容器组接收流量的流程图；图5是根据本发明实施例的目标容器组所在集群的集群系统结构示意图；图6是根据本发明实施例的在目标节点中创建目标队列流程示意；图7是根据本发明实施例的节点带宽上报剩余带宽流程图；图8是根据本发明实施例的调度目标容器组的流程示意图；图9是根据本发明实施例的流量的调度装置的结构框图。具体实施方式下文中将参考附图并结合实施例来详细说明本发明的实施例。需要说明的是，本发明的说明书和权利要求书及上述附图中的术语“第一”、“第二”等是用于区别类似的对象，而不必用于描述特定的顺序或先后次序。本申请实施例中所提供的方法实施例可以在移动终端、计算机终端或者类似的运算装置中执行。以运行在移动终端上为例，图1是本发明实施例的一种流量的调度方法的移动终端的硬件结构框图。如图1所示，移动终端可以包括一个或多个处理器102和用于存储数据的存储器104，其中，上述移动终端还可以包括用于通信功能的传输设备106以及输入输出设备108。本领域普通技术人员可以理解，图1所示的结构仅为示意，其并不对上述移动终端的结构造成限定。例如，移动终端还可包括比图1中所示更多或者更少的组件，或者具有与图1所示不同的配置。存储器104可用于存储计算机程序，例如，应用软件的软件程序以及模块，如本发明实施例中的流量的调度方法对应的计算机程序，处理器102通过运行存储在存储器104内的计算机程序，从而执行各种功能应用以及数据处理，即实现上述的方法。存储器104可包括高速随机存储器，还可包括非易失性存储器，如一个或者多个磁性存储装置、闪存、或者其他非易失性固态存储器。在一些实例中，存储器104可进一步包括相对于处理器102远程设置的存储器，这些远程存储器可以通过网络连接至移动终端。上述网络的实例包括但不限于互联网、企业内部网、局域网、移动通信网及其组合。传输装置106用于经由一个网络接收或者发送数据。上述的网络具体实例可包括移动终端的通信供应商提供的无线网络。在一个实例中，传输装置106包括一个网络适配器，其可通过基站与其他网络设备相连从而可与互联网进行通讯。在一个实例中，传输装置106可以为射频模块，其用于通过无线方式与互联网进行通讯。在本实施例中提供了一种流量的调度方法，图2是根据本发明实施例的流量的调度方法的流程图，如图2所示，该流程包括如下步骤：步骤S202，确定与目标报文关联的目标容器组的目标标识信息，其中，所述目标标识信息为在确定所述目标容器组存在目标网络服务质量需求的情况下，为所述目标容器组分配的信息；步骤S204，基于所述目标标识信息将所述目标报文的第一字段修改为目标字段，其中，所述第一字段用于标识所述目标报文；步骤S206，确定与所述目标字段对应的队列类型；步骤S208，将所述目标报文发送至所述队列类型所对应的目标队列中，以调度所述目标容器组的流量。在上述实施例中，目标容器组即Pod，Pod是Kubernetes创建或部署的最小单位。一个Pod封装一个或多个容器、存储资源、一个独立的网络IP以及管理控制容器运行方式的策略选项。Kubernetes又称k8s或“kube” ，是一种可自动实施Linux 容器操作的开源平台。网络服务质量，即QoS指一个网络能够利用各种基础技术，为指定的网络通信提供更好的服务能力，是网络的一种安全机制，是用来解决网络延迟和阻塞等问题的一种技术。在上述实施例中，目标报文可以是目标容器组发送的报文，也可以是待发送到目标容器组中的报文。在接收到目标报文时，可以确定与目标报文相关联的目标容器组的目标标识信息，根据目标标识信息将目标报文的第一字段修改为目标字段。其中，第一字段可以是skb→priority。根据skb→priority可以确定预先为目标容器组创建的目标队列，即htbclass。其中，上述步骤的执行主体可以为处理器等，但不限于此。通过本发明，确定与目标报文关联的目标容器组的目标标识信息，其中，目标标识信息为在确定目标容器组存在目标网络服务质量需求的情况下，为目标容器组分配的信息，根据目标标识信息将目标报文的第一字段修改为目标字段，确定与目标字段对应的队列类型，将目标报文发送至队列类型所对应的目标队列中，以调度目标容器组的流量。由于在调度目标容器组的流量时，可以根据为目标容器组分配的目标标识信息确定目标队列，无需进行过滤，因此，可以解决相关技术中存在的流量调度速度慢的问题，达到提高流量调度的效率的效果。在一个示例性实施例中，确定与目标报文关联的目标容器组的目标标识信息包括：在所述目标报文为所述目标容器组发送的报文的情况下，获取所述目标容器组的注释信息，基于所述注释信息确定所述目标容器组的所述网络服务质量需求，确定基于所述网络服务质量需求为所述目标容器组分配的所述目标标识信息；在所述目标报文为待发送至容器组中的报文的情况下，获取所述目标报文所携带的目标网络地址，将网络地址为所述目标网络地址的容器组确定为所述目标容器组，确定所述目标容器组的所述目标标识信息。在本实施例中，当目标报文是目标容器组发送的报文的情况下午，可以根据目标容器组的注释信息，如pod annotation。可以根据注释信息确定目标容器组的网络服务质量需求，其中，网络服务质量需求可以包括目标容器组所需要保证的最小带宽、最大带宽等。可以根据网络服务质量需求为目标容器组分配唯一目标标识信息。其中，目标标识信息可以是16位的标识。在上述实施例中，当目标报文是待发送至容器组中的报文的情况下，可以确定目标报文的目的IP，即目标网络地址，从容器组中确定出与目标网络地址相同的目标容器组，根据目标容器组的注释信息确定目标容器组的目标标识信息。在一个示例性实施例中，基于所述目标标识信息修改所述目标报文的目标字段包括：通过目标程序将所述目标字段修改为所述目标标识信息。在本实施例中，目标程序可以是ebpf程序，ebpf程序是 Linux 内核中一个非常灵活与高效的类虚拟机组件， 能够在许多内核 hook 点安全地执行字节码。在上述实施例中，当目标报文为目标容器组发送的报文时，目标容器组发送流量的流程图可参见附图3，如图3所示，该流程包括：步骤S302，当pod发送报文时，attach，即附在pod网卡tc filter上的ebpf程序会将发出报文的skb→priority修改为对应的pod id。步骤S304，判断发送的目的地是否在本节点之外，在判断结果为是的情况下，执行步骤S306，在判断结果为否的情况下，执行步骤S308。步骤S306，当要发送的报文目的ip不在本节点上时，报文会被发送的物理网卡的接口上，物理网卡接口通过匹配skb→priority将该报文送到预先为此pod创建好的htbclass中，完成流量的调度。步骤S308，直接转发。当目标报文为待发送至容器组中的报文的情况下，容器组接收流量的流程图可参见附图4，如图4所示，该流程包括：步骤S402，发往pod的流量先进入节点的物理网卡接口，物理网卡接口接收到流量。步骤S404，通过tc filter mirred转发到ifb接口上。步骤S406，报文通过attach在ifb接口tc filter上的ebpf程序，根据报文的目的ip找到对应的pod id，修改报文的skb→priority字段。步骤S408，ifb接口htb qdisc通过报文的skb→priority直接将报文送往预先配置的htb class完成流量调度。步骤S410，报文被转发到pod中，完成通信。在上述实施例中，使用ebpf程序修改skb→priority直接匹配tc class，可以降低使用传统的维护tc filter的成本并提高性能。在一个示例性实施例中，在将所述目标报文发送至所述队列类型所对应的目标队列中之前，所述方法还包括：确定所述目标容器组所在的目标节点；在所述目标节点中创建所述目标队列。在本实施例中，在将目标报文发送到目标队列中之前，可以确定目标容器组所在的目标节点，在目标节点中创建目标队列。在一个示例性实施例中，在所述目标节点中创建所述目标队列包括：确定所述目标容器组的目标网络服务质量需求；基于所述目标网络服务质量需求以及所述目标标识信息在所述目标节点的物理网卡和虚拟网卡中创建所述目标队列。在本实施例中，在虚拟网卡中创建目标队列可以是在虚拟网卡的ifb接口上创建目标队列。目标容器组所在集群的集群系统结构示意图可参见附图5，如图5所示，该集群包括调度器和节点，每个节点中包括qos管理模块和cni插件。其中，调度器可以是K8s调度器。在上述实施例中，在目标节点中创建目标队列流程示意图可参见附图6，如图6所示，该流程包括：步骤S602，pod被调度到节点上开始创建。步骤S604，cni插件根据pod annotation判断该pod是否有qos需求，在有需求的情况下，执行步骤S606。步骤S606，Pod id管理模块为pod分配一个节点范围内唯一的16位的pod id，对应于目标标识信息。步骤S608，epbf程序管理模块将ebpf程序attach到pod网卡的tc filter上。该ebpf程序会根据pod id修改pod发出报文的skb→priority为对应的pod id值，并将pod id和pod的ip存在ebpf map中。步骤S610，Htb qdisc管理模块根据pod的网络带宽需求在物理网卡和ifb接口上创建于pod id和qos需求对应的htb class用以调度该pod的流量。在一个示例性实施例中，在确定所述目标容器组所在的目标节点之前，所述方法还包括：基于所述目标容器组的注释信息确定所述目标网络服务质量需求中包括的最小带宽；从集群中包括的节点中确定出剩余带宽大于所述最小带宽的第一节点；从所述第一节点中确定出满足预定条件的所述目标节点；在所述目标节点中创建所述目标容器组。在本实施例中，在创建目标容器组之前，可以根据目标容器组的目标网络服务质量需求确定在集群中包括的多个节点中确定出满足目标网络服务质量需求的目标节点。在上述实施例中，在确定目标节点时，可以根据注释信息确定目标容器组需要保证的最小带宽，从集群中包括的节点中确定出剩余带宽大于最小带宽的第一节点，从第一节点中确定出满足预定条件的目标节点。其中，预定条件可以是剩余带宽最大。还可以根据每个节点的剩余带宽和内存等对节点进行评分，将评分最大的节点确定为目标节点，即预定条件还可以是评分最大。在上述实施例中，集群中的节点可以将自身的剩余带宽发送给调度器，调度器可以根据上报的剩余带宽确定每个节点所能保证的最小带宽是多少，以用来计算节点是否满足将要调度的pod的网络带宽需求。节点带宽上报模块首先会获取其物理网卡带宽的大小，将其乘以一个可用百分比系数后上报。其中，节点带宽上报剩余带宽流程图可参见附图7。在一个示例性实施例中，在所述目标节点中创建所述目标容器组之后，所述方法还包括：在创建所述目标容器组成功的情况下，确定所述目标节点的剩余带宽与所述最小带宽的差值，得到差值带宽；将所述目标节点的剩余带宽更新为所述差值带宽。在本实施例中，在目标容器组在目标节点中创建成功后，可以更新目标节点的剩余带宽。在上述实施例中，调度目标容器组的流程示意图可参见附图8，如图8所示，该流程包括：步骤S802，调度器在调度有网络带宽需求的pod时，根据其annotation取出pod要求的最小出入向带宽。步骤S804，在filter阶段筛根据节点所剩的出入向保证带宽筛选出能满足pod最小出入向带宽的节点。步骤S806，在score阶段通过计算节点剩余的出入向保证带宽，选出评分最高的节点部署pod，在reserve阶段预先扣除该pod调度到选中节点后将占用的最小保证带宽值。步骤S808，判断是否调度成功，在调度成功的情况下，执行步骤S812，在调度失败的情况下，执行步骤S810。步骤S810，如果调度失败，在unreserve阶段还回预扣除的节点保证带宽。步骤S812，结束。在前述实施例中，用户可以根据自己pod的带宽需求，在pod annotation中注明：入方向的最小保证带宽和最大限制带宽，出方向的最小保证带宽和最大限制带宽。调度器根据pod annotation中的最小保证带宽要求，将其调度到满足其要求的节点上。在创建pod的过程中，cni插件根据pod annotation将pod的网络带宽需求发送给qos管理模块。Qos管理模块按其对网络带宽的需求设置tc规则满足其需求。实现了保证pod最小带宽的需求。在前述实施例中，每个pod拥有节点内唯一16位标识，使用ebpf程序修改skb→priority为pod标识来区分服务不同的pod流量。将保证带宽当做K8S集群内节点上的一种资源，保证调度的过程中节点上pod所有需要保证带宽总和不超过节点可用的保证带宽。将物理网卡带宽作为pod调度时的资源，真正保证pod需要的带宽量，并且可以使部署在相同节点的pod之间的通信时不受限制。通过以上的实施方式的描述，本领域的技术人员可以清楚地了解到根据上述实施例的方法可借助软件加必需的通用硬件平台的方式来实现，当然也可以通过硬件，但很多情况下前者是更佳的实施方式。基于这样的理解，本发明的技术方案本质上或者说对现有技术做出贡献的部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台终端设备执行本发明各个实施例所述的方法。在本实施例中还提供了一种流量的调度装置，该装置用于实现上述实施例及优选实施方式，已经进行过说明的不再赘述。如以下所使用的，术语“模块”可以实现预定功能的软件和/或硬件的组合。尽管以下实施例所描述的装置较佳地以软件来实现，但是硬件，或者软件和硬件的组合的实现也是可能并被构想的。图9是根据本发明实施例的流量的调度装置的结构框图，如图9所示，该装置包括：第一确定模块92，用于确定与目标报文关联的目标容器组的目标标识信息，其中，所述目标标识信息为在确定所述目标容器组存在目标网络服务质量需求的情况下，为所述目标容器组分配的信息；修改模块94，用于基于所述目标标识信息将所述目标报文的第一字段修改为目标字段，其中，所述第一字段用于标识所述目标报文；第二确定模块96，用于确定与所述目标字段对应的队列类型；调度模块98，用于将所述目标报文发送至所述队列类型所对应的目标队列中，以调度所述目标容器组的流量。在一个示例性实施例中，第一确定模块92可以通过如下方式实现确定与目标报文关联的目标容器组的目标标识信息：在所述目标报文为所述目标容器组发送的报文的情况下，获取所述目标容器组的注释信息，基于所述注释信息确定所述目标容器组的所述网络服务质量需求，确定基于所述网络服务质量需求为所述目标容器组分配的所述目标标识信息；在所述目标报文为待发送至容器组中的报文的情况下，获取所述目标报文所携带的目标网络地址，将网络地址为所述目标网络地址的容器组确定为所述目标容器组，确定所述目标容器组的所述目标标识信息。在一个示例性实施例中，修改模块94可以通过如下方式实现基于所述目标标识信息修改所述目标报文的目标字段：通过目标程序将所述目标字段修改为所述目标标识信息。在一个示例性实施例中，所述装置可以用于在将所述目标报文发送至所述队列类型所对应的目标队列中之前，确定所述目标容器组所在的目标节点；在所述目标节点中创建所述目标队列。在一个示例性实施例中，所述装置可以通过如下方式实现在所述目标节点中创建所述目标队列：确定所述目标容器组的目标网络服务质量需求；基于所述目标网络服务质量需求以及所述目标标识信息在所述目标节点的物理网卡和虚拟网卡中创建所述目标队列。在一个示例性实施例中，所述装置可以用于在确定所述目标容器组所在的目标节点之前，基于所述目标容器组的注释信息确定所述目标网络服务质量需求中包括的最小带宽；从集群中包括的节点中确定出剩余带宽大于所述最小带宽的第一节点；从所述第一节点中确定出满足预定条件的所述目标节点；在所述目标节点中创建所述目标容器组。在一个示例性实施例中，所述装置还可以用于在所述目标节点中创建所述目标容器组之后，在创建所述目标容器组成功的情况下，确定所述目标节点的剩余带宽与所述最小带宽的差值，得到差值带宽；将所述目标节点的剩余带宽更新为所述差值带宽。需要说明的是，上述各个模块是可以通过软件或硬件来实现的，对于后者，可以通过以下方式实现，但不限于此：上述模块均位于同一处理器中；或者，上述各个模块以任意组合的形式分别位于不同的处理器中。本发明的实施例还提供了一种计算机可读存储介质，该计算机可读存储介质中存储有计算机程序，其中，该计算机程序被设置为运行时执行上述任一项方法实施例中的步骤。在一个示例性实施例中，上述计算机可读存储介质可以包括但不限于：U盘、只读存储器、随机存取存储器、移动硬盘、磁碟或者光盘等各种可以存储计算机程序的介质。本发明的实施例还提供了一种电子装置，包括存储器和处理器，该存储器中存储有计算机程序，该处理器被设置为运行计算机程序以执行上述任一项方法实施例中的步骤。在一个示例性实施例中，上述电子装置还可以包括传输设备以及输入输出设备，其中，该传输设备和上述处理器连接，该输入输出设备和上述处理器连接。本实施例中的具体示例可以参考上述实施例及示例性实施方式中所描述的示例，本实施例在此不再赘述。显然，本领域的技术人员应该明白，上述的本发明的各模块或各步骤可以用通用的计算装置来实现，它们可以集中在单个的计算装置上，或者分布在多个计算装置所组成的网络上，它们可以用计算装置可执行的程序代码来实现，从而，可以将它们存储在存储装置中由计算装置来执行，并且在某些情况下，可以以不同于此处的顺序执行所示出或描述的步骤，或者将它们分别制作成各个集成电路模块，或者将它们中的多个模块或步骤制作成单个集成电路模块来实现。这样，本发明不限制于任何特定的硬件和软件结合。以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
