标题title
一种摄像机视场角与转台转速联动方法及装置
摘要abst
本发明提供了一种摄像机视场角与转台转速联动方法，属于安防监控技术领域，包括：获取摄像机镜头在长焦状态下每个像素所占的角度，基于所述摄像机镜头在长焦状态下每个像素所占的角度确认转台在适合的转速下，每秒划过的像素个数；根据所述像素个数确定任意焦段下转台适合的转速；根据所述适合的转速确定对应的步进电机驱动频率。本发明发明了非线性转台转速拟合方法，能够实现摄像机倍率变化与转台转速的无级速度匹配，减少了标定时间，提高了生产效率。
权利要求书clms
1.一种摄像机视场角与转台转速联动方法，其特征在于，包括：获取摄像机镜头在长焦状态下每个像素所占的角度，基于所述摄像机镜头在长焦状态下每个像素所占的角度确认转台在适合的转速下，每秒划过的像素个数；根据所述像素个数确定任意焦段下转台适合的转速；根据所述适合的转速确定对应的步进电机驱动频率。2.根据权利要求1所述的摄像机视场角与转台转速联动方法，其特征在于，所述摄像机镜头在长焦状态下每个像素所占的角度的公式为：其中，PA为摄像机镜头在长焦状态下每个像素所占的角度，TFOV为长焦视场角，R为探测器水平分辨率。3.根据权利要求2所述的摄像机视场角与转台转速联动方法，其特征在于，所述每秒划过的像素个数的公式为：其中，VT为长焦状态下对应适合的转台转速，NT为所述像素个数。4.根据权利要求3所述的摄像机视场角与转台转速联动方法，其特征在于，所述任意焦段下转台适合的转速的公式为：其中，XFOV为任意倍率下的水平视场角值，VX为所述适合的转速。5.根据权利要求4所述的摄像机视场角与转台转速联动方法，其特征在于，所述电机驱动频率的公式为：其中，RR为步进电机轴到转台转轴间的机械减速比，SS为步进电机的细分值，f为任意焦段下，转台适合的转速对应的步进电机驱动频率。6.根据权利要求5所述的摄像机视场角与转台转速联动方法，其特征在于，在根据所述适合的转速确定对应的步进电机驱动频率之后，还包括：针对所述任意焦段下，转台适合的转速进行调节，得到改进后的任意焦段下，转台适合的转速对应的步进电机驱动频率。7.根据权利要求6所述的摄像机视场角与转台转速联动方法，其特征在于，所述改进后的任意焦段下，转台适合的转速对应的步进电机驱动频率的公式为：B为补偿频率，K为系数。8.一种摄像机视场角与转台转速联动装置，适用于权利要求1至7中任一项所述的一种摄像机视场角与转台转速联动方法，其特征在于，所述摄像机视场角与转台转速联动装置包括：摄像机、转台、蜗杆、涡轮、同步带、步进电机和单片机；所述步进电机与同步带、蜗杆、涡轮和转台转轴依次连接，所述单片机用于给所述步进电机提供驱动脉冲。9.根据权利要求8所述的摄像机视场角与转台转速联动装置，其特征在于，所述摄像机包括可见光摄像机和热成像摄像机，所述摄像机的镜头为变焦距镜头。
说明书desc
技术领域本发明涉及安防监控技术领域，特别是涉及一种摄像机视场角与转台转速联动方法及装置。背景技术现有实现视场角与转台速度联动的技术方法如下：两点标定法首先，摄像机在广角时，手动控制转台转动，得到一个适合人眼观测的旋转速度。此时记录下摄像机变倍数值和转台转速值。然后，在最长焦状态下，以同样的方法记录变倍位置数值和转台转速值，最后，在摄像机从广角变倍到长焦的全行程中，采用线性插值的方法，根据摄像机反馈输出的为每一个变倍位置插入一个转速值，实现摄像机视场角变化与转台转速联动。多点标定法多点标定法是在两点标定法的基础上，再在变倍行程中，多标定几组变倍位置值和转台转速值数据，在相邻两组标定数据间，仍然采用线性插值的方法，实现变倍全行程内的转台转速联动功能。所有的变焦距摄像机，变倍倍率与摄像机反馈的变倍位置数值是非线性的，以海康iDS-2ZMC4007S一体机为例，其镜头具有40倍的光学变倍，镜头倍率与变倍位置值之间的关系如图2所示，其中，横坐标为摄像机倍率值，纵坐标为变倍位置值，横坐标1倍表示为广角状态，横坐标40倍代表最长焦状态。可以看出摄像机的倍率与变倍位置值之间是非线性关系。两点标定法只在广角和长焦对转台转速进行标定，两点之间采用线性插值的方法，会导致在中焦段的转台转速不匹配，某些倍率下转速偏快，某些转速下转速偏慢，不利于人眼对目标的观测，人机交互性差，设备操作体验差。多点标定法是在两点标定基础上，在变焦过程中多增加表定点。虽然对上述问题有所改善，但是如果标定的点数过少，也会出现转速不匹配的问题。如果标定点数过多，会消耗大量的时间。现有标定方法，针对不同厂家的镜头、不同型号的镜头都需要人为标定，且标定也存在误差。耗费时间的同时，也不精准。发明内容为了克服现有技术的不足，本发明的目的是提供一种摄像机视场角与转台转速联动方法及装置，本发明不需要对摄像机倍率与转台转速进行标定，减少生产时间，算法实现简单，速度快，提高生产效率。为实现上述目的，本发明提供了如下方案：一种摄像机视场角与转台转速联动方法，包括：获取摄像机镜头在长焦状态下每个像素所占的角度，基于所述摄像机镜头在长焦状态下每个像素所占的角度确认转台在适合的转速下，每秒划过的像素个数；根据所述像素个数确定任意焦段下转台适合的转速；根据所述适合的转速确定对应的步进电机驱动频率。优选地，所述摄像机镜头在长焦状态下每个像素所占的角度的公式为：其中，PA为摄像机镜头在长焦状态下每个像素所占的角度，TFOV为长焦视场角，R为探测器水平分辨率。优选地，所述每秒划过的像素个数的公式为：其中，VT为长焦状态下对应适合的转台转速，NT为所述像素个数。优选地，所述任意焦段下转台适合的转速的公式为：其中，XFOV为任意倍率下的水平视场角值，VX为所述适合的转速。优选地，所述电机驱动频率的公式为：其中，RR为步进电机轴到转台转轴间的机械减速比，SS为步进电机的细分值，f为任意焦段下，转台适合的转速对应的步进电机驱动频率。优选地，在根据所述适合的转速确定对应的步进电机驱动频率之后，还包括：针对所述任意焦段下，转台适合的转速进行调节，得到改进后的任意焦段下，转台适合的转速对应的步进电机驱动频率。优选地，所述改进后的任意焦段下，转台适合的转速对应的步进电机驱动频率的公式为：B为补偿频率，K为系数。一种摄像机视场角与转台转速联动装置，适用于权利要求1至7中任一项所述的一种摄像机视场角与转台转速联动方法，所述摄像机视场角与转台转速联动装置包括：摄像机、转台、蜗杆、涡轮、同步带、步进电机和单片机；所述步进电机与同步带、蜗杆、涡轮和转台转轴依次连接，所述单片机用于给所述步进电机提供驱动脉冲。优选地，所述摄像机包括可见光摄像机和热成像摄像机，所述摄像机的镜头为变焦距镜头。根据本发明提供的具体实施例，本发明公开了以下技术效果：本发明提供了一种摄像机视场角与转台转速联动方法及装置，发明了非线性转台转速拟合方法，能够实现摄像机倍率变化与转台转速的无级速度匹配，减少了标定时间，提高了生产效率。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例提供的摄像机视场角与转台转速联动方法流程图；图2为本发明实施例提供的现有技术镜头倍率与变倍位置值之间的关系图；图3为本发明实施例提供的本发明中摄像机倍率与转台转速的联动关系曲线图；图4为本发明实施例提供的本发明中摄像机与转台结构图；图5为本发明实施例提供的本发明中摄像机广角示意图；图6为本发明实施例提供的本发明中摄像机长焦示意图；图7为本发明实施例提供的本发明中改进后摄像机倍率与转台转速的联动关系曲线图；图8为本发明实施例提供的本发明中转台内部机械机构图。附图标记说明：1-摄像机，2-转台，3-步进电机，4-涡轮，5-同步带，6-蜗杆。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。在本文中提及“实施例”意味着，结合实施例描述的特定特征、结构或特性可以包含在本申请的至少一个实施例中。在说明书中的各个位置出现该短语并不一定均是指相同的实施例，也不是与其它实施例互斥的独立的或备选的实施例。本领域技术人员显式地和隐式地理解的是，本文所描述的实施例可以与其它实施例相结合。本申请的说明书和权利要求书及所述附图中的术语“第一”、“第二”、“第三”和“第四”等是用于区别不同对象，而不是用于描述特定顺序。此外，术语“包括”和“具有”以及它们任何变形，意图在于覆盖不排他的包含。例如包含了一系列步骤、过程、方法等没有限定于已列出的步骤，而是可选地还包括没有列出的步骤，或可选地还包括对于这些过程、方法、产品或设备固有的其它步骤元。本发明的目的是提供一种摄像机1视场角与转台2转速联动方法及装置，发明了非线性转台2转速拟合方法，能够实现摄像机1倍率变化与转台2转速的无级速度匹配，减少了标定时间，提高了生产效率。为使本发明的上述目的、特征和优点能够更加明显易懂，下面结合附图和具体实施方式对本发明作进一步详细的说明。如图1所示，本发明提供了一种摄像机1视场角与转台2转速联动方法，包括：步骤100：获取摄像机1镜头在长焦状态下每个像素所占的角度，基于所述摄像机1镜头在长焦状态下每个像素所占的角度确认转台2在适合的转速下，每秒划过的像素个数；步骤200：根据所述像素个数确定任意焦段下转台2适合的转速；步骤300：根据所述适合的转速确定对应的步进电机3驱动频率。如图3所示，其中横坐标为摄像机倍率值，纵坐标为转台转速值。本发明发明了非线性转台2转速拟合方法，能够实现摄像机1倍率变化与转台2转速的无级速度匹配，减少了标定时间，提高了生产效率。摄像机1倍率的变化与视场角变化是一一对应的，这里可近似认为是同一类型物理量，当摄像机1处于最广角状态时，视场角最大，转台2可以以更高的转速旋转，不影响对目标的观测。当摄像机1处于长焦状态时，视场角变小，观测的目标被放大，当观测远距离目标时，转台2转动速度应减小。摄像机1在从最广角变倍到最长焦过程中，本发明可以保障在每个倍率下，转台2转速都与倍率匹配，达到最利于人眼观测的目的。根据摄像机1视场角得到的摄像机1倍率与转台2转速的联动关系曲线，其中横坐标为摄像机1倍率值，纵坐标为转台2转速值。可以看出转台2转速与摄像机1倍率成曲线关系，低倍率时转速高，高倍率时转速低，曲线与摄像机1变倍位置值是互补的，实现了倍率变化与转台2转速无级联动。进一步的，所述摄像机1镜头在长焦状态下每个像素所占的角度的公式为：其中，PA为摄像机1镜头在长焦状态下每个像素所占的角度，TFOV为长焦视场角，R为探测器水平分辨率。进一步的，所述每秒划过的像素个数的公式为：其中，VT为长焦状态下对应适合的转台2转速，NT为所述像素个数。进一步的，所述任意焦段下转台2适合的转速的公式为：其中，XFOV为任意倍率下的水平视场角值，VX为所述适合的转速。进一步的，所述电机驱动频率的公式为：其中，RR为步进电机3轴到转台2转轴间的机械减速比，SS为步进电机3的细分值，f为任意焦段下，转台2适合的转速对应的步进电机3驱动频率。进一步的，在根据所述适合的转速确定对应的步进电机3驱动频率之后，还包括：针对所述任意焦段下，转台2适合的转速进行调节，得到改进后的任意焦段下，转台2适合的转速对应的步进电机3驱动频率。更进一步的，所述改进后的任意焦段下，转台2适合的转速对应的步进电机3驱动频率的公式为：B为补偿频率，K为系数。如图4所示，一种摄像机1视场角与转台2转速联动装置，所述摄像机1视场角与转台2转速联动装置包括：摄像机1、转台2、蜗杆6、涡轮4、同步带5、步进电机3和单片机；所述步进电机3与同步带5、蜗杆6、涡轮4和转台2转轴依次连接，所述单片机用于给所述步进电机3提供驱动脉冲。转台2采用步进电机3+同步带5+蜗轮蜗杆6的方式。涡轮4与转台2转轴固定，步进电机3转动经同步带5，带动蜗杆6转动，蜗杆6带动涡轮4，从而实现转台2转动；使用单片机定时器产生步进电机3转动所需的脉冲信号，脉冲信号经驱动器输出给步进电机3。单片机每输出一个脉冲，可控制步进电机3转动固定角度，经同步带5和蜗轮蜗杆6减速后，带动转台2旋转一个固定角度。单片机输出的脉冲频率f越高，转台2转速越高；转台2上安装有摄像机1，转台2转动可带动摄像机1转动。摄像机1包括可见光摄像机和热成像摄像机，摄像机1的镜头为变焦距镜头，在广角状态和长焦状态的视场角不同进一步的，所述摄像机1包括可见光摄像机和热成像摄像机，所述摄像机1的镜头为变焦距镜头。如图5-6所示，本实施例公布了摄像机1视场角与转台2转速联动方法具体过程：定义：单片机输出给步进电机3驱动频率f，单位为Hz；长焦视场角TFOV，这里的视场角为水平视场角，单位为°；探测器水平分辨率：R，若探测器分辨率为1920*1080，则R＝1920；转台2在长焦时对应的适合转速：VT，单位为°/s；转台2在任意焦段时对应的适合转速：VX，单位为°/s；由于人眼在摄像机1长焦状态下，对视场内的景物移动更为敏感，所以应优先将摄像机1推到长焦状态，然后确定下来此时的适合转速VT，然后再推导出趋近广角Wfov位置的各个视场角下所对应的转台2转速。长焦状态下，每个像素所占角度那么，在长焦状态下，转台2在适合的转速下转动，每秒划过的像素个数为将公式带入公式，得到虽然摄像机1在广角状态下和在长焦状态下，所拍摄景物大小不同，但是摄像机1内图像传感器并不能感知远近目标的深度，他只对光线强弱敏感，所以对图像传感器而言，不管是什么尺寸的目标，他们都是一个平面，都是充满整个靶面的目标。所以，在任意焦段下，每秒划过像素的个数NX，与长焦状态下是相同的。NX＝NT 经过试验验证，分别在广角和长焦状态下，控制转台2以不同的转速转动，满足NX＝NT的条件下，测试结果显示，视频画面都是适合观测的，画面移动速度适中。将公式带入等式，我们可以得到其中XFOV是指任意倍率下的水平视场角值根据公式，我们可以得到在任意焦段下，转台2适合转速由公式可知，任意倍率下的转台2适合转速，只与视场角和长焦状态下的适合速度有关。而每个厂家所提供的摄像机1，都会向用户提供各个焦段对应视场角的测试文件，所以，我们在实际应用中，只需确定摄像机1处于最长焦状态时，适合观测的转台2转速就可以了。确定最长焦状态下的适合观测的转台2转速方法：将镜头推到最长焦状态，手控控制转台2左右转动，找到一个合适的利于观测的速度，并记录下来，即为VT。在一般的设计中，转台2的转动是通过单片机输出一定的频率f的脉冲给步进电机3驱动器，控制步进电机3转动，再进过减速机构控制转台2转动的。假定步进电机3轴到转台2转轴间的机械减速比是RR，这个值是设计时固定的。步进电机3的细分值SS，这个值是软件设计时确定的，可以是1/2/8/16/32/64/256等。则步进电机3轴的转速为经过机械结构的减速，最终转台2的转速为将公示带入公式得到化简后得到，任意倍率下，转台2适合速度对应的步进电机3的驱动频率为其中，SS和RR是通过设计确定的，是已知数；VT是在长焦下的适合观测速度，是标定值；XFOV和TFOV是摄像机1的视场角，可以通过厂家的标定文件得到；通过以上参数，即可在程序中设计输出一个频率为f的脉冲序列，驱动步进电机3，带动转台2转动，实现视场角与转台2转速匹配联动。在实际的应用中，有可能每个人对转速的感觉不同，这就存在着视觉误差。为满足不同客户的需求，可以引入一个系数K，和一个补偿频率B，对转速进行一定量的调节，对公式的最终改进如下：利用公式，分别拟合在K＝0.5、K＝1、K＝1.5条件下的匹配曲线，其中横坐标为摄像机1倍率，纵坐标为转台2适合转速。如图7所示，其中横坐标为摄像机倍率，纵坐标为转台适合转速，调节系数K大于1时，匹配曲线斜率变大，会在一定程度上提高某点的速度。当K小于1时，转台2速度会降低。无论K大于1还是小于1，都会使中焦段的匹配速度发生偏移，这需要根据实际用户需求而选择合适的调节系数。如图8所述，附图8左侧3为水平轴步进电机，4为水平轴涡轮，5为水平轴同步带，6为水平轴蜗杆；附图8右侧3为俯仰轴步进电机，4为俯仰轴涡轮，5为俯仰轴同步带，6为俯仰轴蜗杆。本发明的有益效果如下：不需要对摄像机1倍率与转台2转速进行标定，减少生产时间，提高生产效率。算法适应性强，不同的厂家的摄像机1可以通用，不需要重复标定算法实现曲线拟合，速度一致性好，匹配度高。算法实现简单，不包含高次方程，执行速度快，只需要导入厂家提供的视场角数据表，确定最长焦时的转台2运行速度即可。本说明书中各个实施例采用递进的方式描述，每个实施例重点说明的都是与其他实施例的不同之处，各个实施例之间相同相似部分互相参见即可。对于实施例公开的装置而言，由于其与实施例公开的方法相对应，所以描述的比较简单，相关之处参见方法部分说明即可。本文中应用了具体个例对本发明的原理及实施方式进行了阐述，以上实施例的说明只是用于帮助理解本发明的方法及其核心思想；同时，对于本领域的一般技术人员，依据本发明的思想，在具体实施方式及应用范围上均会有改变之处。综上所述，本说明书内容不应理解为对本发明的限制。
