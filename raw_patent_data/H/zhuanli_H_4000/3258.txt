标题title
一种存储多路径中路径失效管理方法、装置、设备及介质
摘要abst
本发明涉及计算机技术领域，尤其涉及一种存储多路径中路径失效管理方法、装置、设备及介质。所述方法包括：设置多个路径组，并在多路径发现时为每个路径组指定备用路径组、所属控制器和所属双活站点，其中，每个路径组用于保存属于同一条物理路径的所有路径；若存在失效路径则遍历每个路径组以确定从多个路径组中找到失效路径所属的目标路径组；从除目标路径组以外的剩余路径组中为失效路径寻找可切换路径，并基于目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表；若找到可切换路径则遍历每条路径以将属于失效链表的路径标记为失效。本发明的方案大大提高多路径故障切换效率，大大减少故障分析及处理时的资源占用。
权利要求书clms
1.一种存储多路径中路径失效管理方法，其特征在于，所述方法包括：设置多个路径组，并在多路径发现时为每个路径组指定备用路径组、所属控制器和所属双活站点，其中，每个路径组用于保存属于同一条物理路径的所有路径；若存在失效路径则遍历每个路径组以确定从所述多个路径组中找到所述失效路径所属的目标路径组；从除所述目标路径组以外的剩余路径组中为所述失效路径寻找可切换路径，并基于所述目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表；若找到可切换路径则遍历每条路径以将属于所述失效链表的路径标记为失效。2.根据权利要求1所述的存储多路径中路径失效管理方法，其特征在于，所述遍历每个路径组以确定从所述多个路径组中找到所述失效路径所属的目标路径组，包括：将路径组下标i设置为0；判断路径组下标i是否小于路径组总数目；若路径组下标i小于路径组总数目，则判断路径组下标i的ID与失效路径的ID是否一致；若一致则确认失效路径对应的目标路径组找到；若不一致则将路径组下标i加1并返回执行判断路径组下标i是否小于路径组总数目。3.根据权利要求1所述的存储多路径中路径失效管理方法，其特征在于，所述从除所述目标路径组以外的剩余路径组中为所述失效路径寻找可切换路径，并基于所述目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表，包括：判断目标路径组对应的备用路径组是否可用；若目标路径组对应的备用路径组可用，则从所述目标路径组对应的备用路径组中寻找可切换路径；若目标路径组对应的备用路径组不可用，则将目标路径组对应的备用路径组ID加入失效链表，并判断目标路径组所属控制器下所有路径组是否均不可用、判断目标路径组属双活站点下所有路径组是否均不可用；若目标路径组所属控制器下所有路径组均不可用，则将目标路径所属控制器下所有路径组ID加入失效链表；若目标路径组属双活站点下所有路径组是否均不可用，则将目标路径组所属双活站点的所有路径组ID加入失效链表；再次遍历每个路径组以从除目标路径组及其备用路径组以外的路径组中寻找可切换路径。4.根据权利要求1所述的存储多路径中路径失效管理方法，其特征在于，所述若找到可切换路径则遍历每条路径以将属于所述失效链表的路径标记为失效，包括：将多路径设备下标k设置0，将多路径设备路径下标j设置0；判断多路径设备下标k是否小于多路径总数目，如果为真则继续执行，否则结束；判断多路径设备路径下标j是否小于多路径设备下标k的路径总数目，如果为真则继续执行，否则多路径设备下标k加1并返回执行判断多路径设备下标k是否小于多路径总数目；判断多路径设备k路径j的ID是否等于失效路径的ID；如果为真则将多路径设备k路径j设置为失效，否则继续执行；判断多路径设备k路径j的ID是否等于失效链表中的ID；如果为真则将多路径设备k路径j设置为失效，否则将多路径设备路径下标j加1并返回执行判断多路径设备路径下标j是否小于多路径设备的路径总数目。5.一种存储多路径中路径失效管理装置，其特征在于，所述装置包括：设置模块，配置用于设置多个路径组，并在多路径发现时为每个路径组指定备用路径组、所属控制器和所属双活站点，其中，每个路径组用于保存属于同一条物理路径的所有路径；确定模块，配置用于若存在失效路径则遍历每个路径组以确定从所述多个路径组中找到所述失效路径所属的目标路径组；查找模块，配置用于从除所述目标路径组以外的剩余路径组中为所述失效路径寻找可切换路径，并基于所述目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表；标记模块，配置用于若找到可切换路径则遍历每条路径以将属于所述失效链表的路径标记为失效。6.根据权利要求5所述的存储多路径中路径失效管理装置，其特征在于，所述确定模块进一步配置用于：将路径组下标i设置为0；判断路径组下标i是否小于路径组总数目；若路径组下标i小于路径组总数目，则判断路径组下标i的ID与失效路径的ID是否一致；若一致则确认失效路径对应的目标路径组找到；若不一致则将路径组下标i加1并返回执行判断路径组下标i是否小于路径组总数目。7.根据权利要求5所述的存储多路径中路径失效管理装置，其特征在于，所述查找模块进一步配置用于：判断目标路径组对应的备用路径组是否可用；若目标路径组对应的备用路径组可用，则从所述目标路径组对应的备用路径组中寻找可切换路径；若目标路径组对应的备用路径组不可用，则将目标路径组对应的备用路径组ID加入失效链表，并判断目标路径组所属控制器下所有路径组是否均不可用、判断目标路径组属双活站点下所有路径组是否均不可用；若目标路径组所属控制器下所有路径组均不可用，则将目标路径所属控制器下所有路径组ID加入失效链表；若目标路径组属双活站点下所有路径组是否均不可用，则将目标路径组所属双活站点的所有路径组ID加入失效链表；再次遍历每个路径组以从除目标路径组及其备用路径组以外的路径组中寻找可切换路径。8.根据权利要求5所述的存储多路径中路径失效管理装置，其特征在于，所述标记模块进一步配置用于：将多路径设备下标k设置0，将多路径设备路径下标j设置0；判断多路径设备下标k是否小于多路径总数目，如果为真则继续执行，否则结束；判断多路径设备路径下标j是否小于多路径设备下标k的路径总数目，如果为真则继续执行，否则多路径设备下标k加1并返回执行判断多路径设备下标k是否小于多路径总数目；判断多路径设备k路径j的ID是否等于失效路径的ID；如果为真则将多路径设备k路径j设置为失效，否则继续执行；判断多路径设备k路径j的ID是否等于失效链表中的ID；如果为真则将多路径设备k路径j设置为失效，否则将多路径设备路径下标j加1并返回执行判断多路径设备路径下标j是否小于多路径设备的路径总数目。9.一种计算机设备，其特征在于，包括：至少一个处理器；以及存储器，所述存储器存储有可在所述处理器中运行的计算机程序，所述处理器执行所述程序时执行权利要求1-4任意一项所述的方法。10.一种计算机可读存储介质，所述计算机可读存储介质存储有计算机程序，其特征在于，所述计算机程序被处理器执行时执行权利要求1-4任意一项所述的方法。
说明书desc
技术领域本发明涉及计算机技术领域，尤其涉及一种存储多路径中路径失效管理方法、装置、设备及介质。背景技术存储多路径技术是指在一台主机和存储阵列端使用多条路径连接，使主机到阵列的可见路径大于一条，其间可以跨过多个交换机，避免单点故障，提供更高的可用性和性能优势。高可用性体现在：SAN网络环境的任意一个节点出现故障，IO请求可以通过其它路径发送，避免中断。高吞吐率性能优势体现在：IO请求可以同时通过多条路径负载均衡的发送，提高IO吞吐率。传统多路径设置路径失效方法，以单个多路径卷为单位，当单个卷故障进行错误处理时，检测到链路故障，会置该卷的该路径失效。各个卷之间相互独立，一方面不能在确认故障为链路故障的第一时间将所有受影响的多路径卷的该路径设置失效，从而影响故障切换的时效性以及I/O中断时间；另一方面在单个多路径卷未对故障路径设置失效时，故障路径仍然会接收I/O，从而增大后续故障分析及处理的资源占用。发明内容有鉴于此，有必要针对映射大量卷的场景，在主机和存储的链路出现故障的情况下，传统多路径设置路径失效的方法存在设置路径失效的失效性差，故障切换效率低的问题，本发明提供一种存储多路径中路径失效管理方法、装置、设备及介质。根据本发明的第一方面，提供了一种存储多路径中路径失效管理方法，所述方法包括：设置多个路径组，并在多路径发现时为每个路径组指定备用路径组、所属控制器和所属双活站点，其中，每个路径组用于保存属于同一条物理路径的所有路径；若存在失效路径则遍历每个路径组以确定从所述多个路径组中找到所述失效路径所属的目标路径组；从除所述目标路径组以外的剩余路径组中为所述失效路径寻找可切换路径，并基于所述目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表；若找到可切换路径则遍历每条路径以将属于所述失效链表的路径标记为失效。在一些实施例中，所述遍历每个路径组以确定从所述多个路径组中找到所述失效路径所属的目标路径组，包括：将路径组下标i设置为0；判断路径组下标i是否小于路径组总数目；若路径组下标i小于路径组总数目，则判断路径组下标i的ID与失效路径的ID是否一致；若一致则确认失效路径对应的目标路径组找到；若不一致则将路径组下标i加1并返回执行判断路径组下标i是否小于路径组总数目。在一些实施例中，所述从除所述目标路径组以外的剩余路径组中为所述失效路径寻找可切换路径，并基于所述目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表，包括：判断目标路径组对应的备用路径组是否可用；若目标路径组对应的备用路径组可用，则从所述目标路径组对应的备用路径组中寻找可切换路径；若目标路径组对应的备用路径组不可用，则将目标路径组对应的备用路径组ID加入失效链表，并判断目标路径组所属控制器下所有路径组是否均不可用、判断目标路径组属双活站点下所有路径组是否均不可用；若目标路径组所属控制器下所有路径组均不可用，则将目标路径所属控制器下所有路径组ID加入失效链表；若目标路径组属双活站点下所有路径组是否均不可用，则将目标路径组所属双活站点的所有路径组ID加入失效链表；再次遍历每个路径组以从除目标路径组及其备用路径组以外的路径组中寻找可切换路径。在一些实施例中，所述若找到可切换路径则遍历每条路径以将属于所述失效链表的路径标记为失效，包括：将多路径设备下标k设置0，将多路径设备路径下标j设置0；判断多路径设备下标k是否小于多路径总数目，如果为真则继续执行，否则结束；判断多路径设备路径下标j是否小于多路径设备下标k的路径总数目，如果为真则继续执行，否则多路径设备下标k加1并返回执行判断多路径设备下标k是否小于多路径总数目；判断多路径设备k路径j的ID是否等于失效路径的ID；如果为真则将多路径设备k路径j设置为失效，否则继续执行；判断多路径设备k路径j的ID是否等于失效链表中的ID；如果为真则将多路径设备k路径j设置为失效，否则将多路径设备路径下标j加1并返回执行判断多路径设备路径下标j是否小于多路径设备的路径总数目。根据本发明的第二方面，提供了一种存储多路径中路径失效管理装置，所述装置包括：设置模块，配置用于设置多个路径组，并在多路径发现时为每个路径组指定备用路径组、所属控制器和所属双活站点，其中，每个路径组用于保存属于同一条物理路径的所有路径；确定模块，配置用于若存在失效路径则遍历每个路径组以确定从所述多个路径组中找到所述失效路径所属的目标路径组；查找模块，配置用于从除所述目标路径组以外的剩余路径组中为所述失效路径寻找可切换路径，并基于所述目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表；标记模块，配置用于若找到可切换路径则遍历每条路径以将属于所述失效链表的路径标记为失效。在一些实施例中，所述确定模块进一步配置用于：将路径组下标i设置为0；判断路径组下标i是否小于路径组总数目；若路径组下标i小于路径组总数目，则判断路径组下标i的ID与失效路径的ID是否一致；若一致则确认失效路径对应的目标路径组找到；若不一致则将路径组下标i加1并返回执行判断路径组下标i是否小于路径组总数目。在一些实施例中，所述查找模块进一步配置用于：判断目标路径组对应的备用路径组是否可用；若目标路径组对应的备用路径组可用，则从所述目标路径组对应的备用路径组中寻找可切换路径；若目标路径组对应的备用路径组不可用，则将目标路径组对应的备用路径组ID加入失效链表，并判断目标路径组所属控制器下所有路径组是否均不可用、判断目标路径组属双活站点下所有路径组是否均不可用；若目标路径组所属控制器下所有路径组均不可用，则将目标路径所属控制器下所有路径组ID加入失效链表；若目标路径组属双活站点下所有路径组是否均不可用，则将目标路径组所属双活站点的所有路径组ID加入失效链表；再次遍历每个路径组以从除目标路径组及其备用路径组以外的路径组中寻找可切换路径。在一些实施例中，所述标记模块进一步配置用于：将多路径设备下标k设置0，将多路径设备路径下标j设置0；判断多路径设备下标k是否小于多路径总数目，如果为真则继续执行，否则结束；判断多路径设备路径下标j是否小于多路径设备下标k的路径总数目，如果为真则继续执行，否则多路径设备下标k加1并返回执行判断多路径设备下标k是否小于多路径总数目；判断多路径设备k路径j的ID是否等于失效路径的ID；如果为真则将多路径设备k路径j设置为失效，否则继续执行；判断多路径设备k路径j的ID是否等于失效链表中的ID；如果为真则将多路径设备k路径j设置为失效，否则将多路径设备路径下标j加1并返回执行判断多路径设备路径下标j是否小于多路径设备的路径总数目。根据本发明的第三方面，还提供了一种计算机设备，该计算机设备包括：至少一个处理器；以及存储器，存储器存储有可在处理器上运行的计算机程序，处理器执行程序时执行前述的存储多路径中路径失效管理方法。根据本发明的第四方面，还提供了一种计算机可读存储介质，计算机可读存储介质存储有计算机程序，计算机程序被处理器执行时执行前述的存储多路径中路径失效管理方法。上述一种存储多路径中路径失效管理方法，采用既简单又高效的方式实现设置多路径的路径失效，大大提高多路径故障切换效率，大大减少故障分析及处理时的资源占用。此外，本发明还提供了一种存储多路径中路径失效管理装置、一种计算机设备和一种计算机可读存储介质，同样能实现上述技术效果，这里不再赘述。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的实施例。图1为本发明一个实施例提供的一种存储多路径中路径失效管理方法的流程图；图2为本发明另一个实施例提供的另一种存储多路径中路径失效管理方法的流程图；图3为本发明另一个实施例提供的一种存储多路径中路径失效管理装置的结构示意图；图4为本发明另一个实施例中计算机设备的内部结构图。具体实施方式为使本发明的目的、技术方案和优点更加清楚明白，以下结合具体实施例，并参照附图，对本发明实施例进一步详细说明。需要说明的是，本发明实施例中所有使用“第一”和“第二”的表述均是为了区分两个相同名称非相同的实体或者非相同的参量，可见“第一”“第二”仅为了表述的方便，不应理解为对本发明实施例的限定，后续实施例对此不再一一说明。在一个实施例中，请参照图1所示，本发明提供了一种存储多路径中路径失效管理方法100，具体来说，所述方法包括以下步骤：步骤101，设置多个路径组，并在多路径发现时为每个路径组指定备用路径组、所属控制器和所属双活站点，其中，每个路径组用于保存属于同一条物理路径的所有路径；步骤102，若存在失效路径则遍历每个路径组以确定从所述多个路径组中找到所述失效路径所属的目标路径组；步骤103，从除所述目标路径组以外的剩余路径组中为所述失效路径寻找可切换路径，并基于所述目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表；步骤104，若找到可切换路径则遍历每条路径以将属于所述失效链表的路径标记为失效。上述一种存储多路径中路径失效管理方法，采用既简单又高效的方式实现设置多路径的路径失效，大大提高多路径故障切换效率，大大减少故障分析及处理时的资源占用。在一些实施例中，前述步骤102，遍历每个路径组以确定从所述多个路径组中找到所述失效路径所属的目标路径组，包括：将路径组下标i设置为0；判断路径组下标i是否小于路径组总数目；若路径组下标i小于路径组总数目，则判断路径组下标i的ID与失效路径的ID是否一致；若一致则确认失效路径对应的目标路径组找到；若不一致则将路径组下标i加1并返回执行判断路径组下标i是否小于路径组总数目。在一些实施例中，步骤103，所述从除所述目标路径组以外的剩余路径组中为所述失效路径寻找可切换路径，并基于所述目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表，包括：判断目标路径组对应的备用路径组是否可用；若目标路径组对应的备用路径组可用，则从所述目标路径组对应的备用路径组中寻找可切换路径；若目标路径组对应的备用路径组不可用，则将目标路径组对应的备用路径组ID加入失效链表，并判断目标路径组所属控制器下所有路径组是否均不可用、判断目标路径组属双活站点下所有路径组是否均不可用；若目标路径组所属控制器下所有路径组均不可用，则将目标路径所属控制器下所有路径组ID加入失效链表；若目标路径组属双活站点下所有路径组是否均不可用，则将目标路径组所属双活站点的所有路径组ID加入失效链表；再次遍历每个路径组以从除目标路径组及其备用路径组以外的路径组中寻找可切换路径。在一些实施例中，前述步骤104，所述若找到可切换路径则遍历每条路径以将属于所述失效链表的路径标记为失效，包括：将多路径设备下标k设置0，将多路径设备路径下标j设置0；判断多路径设备下标k是否小于多路径总数目，如果为真则继续执行，否则结束；判断多路径设备路径下标j是否小于多路径设备的路径总数目，如果为真则继续执行，否则多路径设备下标k加1并返回执行判断多路径设备下标k是否小于多路径总数目；判断多路径设备k路径j的ID是否等于失效路径的ID；如果为真则将多路径设备k路径j设置为失效，否则继续执行；判断多路径设备k路径j的ID是否等于失效链表中的ID；如果为真则将多路径设备k路径j设置为失效，否则将多路径设备路径下标j加1并返回执行判断多路径设备路径下标j是否小于多路径设备的路径总数目。在又一个实施例中，为了便于理解本发明的方案，下面以映射大量卷的场景下，在主机和存储的链路出现故障情形为例，本实施例提供了另一种存储多路径中路径失效管理方法200，具体方式过程参考如下：首先通过下列步骤为设置路径失效提供基础准备工作：步骤一，路径组保存了同一条物理路径所上报的所有物理盘信息。同一条路径指，通过Host:Channel:Target信息唯一确定的路径，SCSI类型设备由H:C:T确定，NVMe类似。步骤二，在多路径的路径刚上来时，为每个路径组指定备用路径组。例如，路径组1,路径组2,路径组3,路径组4；其备用路径设置举例为：例如路径组1的备用路径组为路径组2，路径组2的备用路径组为路径组3，路径组3的备用路径组为路径组4，路径组4的备用路径组为路径组1；步骤三，在多路径的路径刚上来时，为每个路径组指定所属控制器路径组链表。例如，路径组1,路径组2,路径组3,路径组4；路径组1,路径组2同属控制器A，路径组3,路径组4同属控制器B；路径组1指向控制器A链表；路径组2指向控制器A链表；路径组3指向控制器B链表；路径组4指向控制器B链表；步骤四，在多路径的路径刚上来时，为每个路径组指定所属双活站点路径组链表。例如，路径组1,路径组2,路径组3,路径组4；路径组1,路径组2同属站点A，路径组3,路径组4同属站点B；路径组1指向站点A链表；路径组2指向站点A链表；路径组3指向站点B链表；路径组4指向站点B链表请结合图2所示，下面将详细说明路径失效标记具体方式：步骤S201:路径组下标i设置0；步骤S202：获取路径组i的备用路径组；步骤S203：判断i是否小于路径组总数目；如果为真，跳转步骤S204，否则跳转步骤S213；步骤S204：判断路径组i的ID与失效路径X的ID是否一致；如果为真，说明失效路径对应的路径组找到，则跳转步骤S205，否则跳转步骤S206；步骤S205：判断路径组i的备用路径组是否为可用状态；如果为真，说明可能仅仅为单条链路故障，则跳转步骤S207，否则跳转步骤S208；步骤S206：路径组下标加1，然后跳转步骤S203；步骤S207：设置新切换的路径N为路径组i的备用路径组ID,同时设置新切换路径N找到标志；步骤S208：将路径组i的备用路径组ID加入失效链表；步骤S209：判断路径组i的所属控制器的路径组是否均不可用；如果为真，说明发生了存储控制器故障，跳转步骤S210；否则跳转步骤S213；步骤S210：将路径组i的所属控制器的所有路径组ID加入失效链表；步骤S211：判断路径组i的所属双活站点的路径组是否均不可用；如果为真，说明发生了双活站点故障，跳转步骤S212；否则跳转步骤S213；步骤S212：将路径组i的所属双活站点的所有路径组ID加入失效链表；步骤S213：判断新切换路径N找到标志是否为真；如果为真，说明重新选择的新路径找到，跳转步骤S220；否则跳转步骤S214；步骤S214：路径组下标i设置0；步骤S215：判断i是否小于路径组总数目；如果为真，跳转步骤S216，否则跳转步骤S220；步骤S216：判断路径组i的ID是否为空或路径组i的ID是否等于失效路径X的ID；如果为真，跳转步骤S219，否则跳转步骤S217；步骤S217：路径组i的状态是否为可用状态，如果为真，说明找到一个可以的路径组，跳转步骤S218，否则跳转步骤S219；步骤S218：设置新切换的路径N为路径组i的ID，设置新切换路径N找到标志为真；步骤S219：路径组下标加1，然后跳转步骤S215；步骤S220：判断新切换路径N找到标志是否为真；如果为真，说明重新选择的新路径找到，跳转步骤S221；否则结束；步骤S221：多路径设备下标k设置0，多路径设备路径下标j设置0；步骤S222：判断k是否小于多路径总数目；如果为真，跳转步骤S223，否则结束；步骤S223：判断j是否小于多路径设备k的路径总数目；，如果为真，跳转步骤S224，否则跳转步骤S228；步骤S224：判断多路径设备k路径j的ID是否等于失效路径X的ID；如果为真，跳转步骤S226，否则跳转步骤S225；步骤S225：判断多路径设备k路径j的ID是否等于失效链表中的ID；如果为真，跳转步骤S226，否则，跳转步骤S227步骤S226：设置多路径k设备路径j为失效状态；步骤S227：路径下标j加1；步骤S228：设备下标k加1；本实施例的一种存储多路径中路径失效管理方法，提供了既简单又高效的方式实现设置多路径的路径失效方式，大大提高多路径故障切换效率；大大减少故障分析及处理时的资源占用。在又一个实施例中，请参照图3所示，本发明还提供了一种存储多路径中路径失效管理装置300，所述装置包括：设置模块301，配置用于设置多个路径组，并在多路径发现时为每个路径组指定备用路径组、所属控制器和所属双活站点，其中，每个路径组用于保存属于同一条物理路径的所有路径；确定模块302，配置用于若存在失效路径则遍历每个路径组以确定从所述多个路径组中找到所述失效路径所属的目标路径组；查找模块303，配置用于从除所述目标路径组以外的剩余路径组中为所述失效路径寻找可切换路径，并基于所述目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表；标记模块304，配置用于若找到可切换路径则遍历每条路径以将属于所述失效链表的路径标记为失效。上述一种存储多路径中路径失效管理装置，采用既简单又高效的方式实现设置多路径的路径失效，大大提高多路径故障切换效率，大大减少故障分析及处理时的资源占用。在一些实施例中，所述确定模块302进一步配置用于：将路径组下标i设置为0；判断路径组下标i是否小于路径组总数目；若路径组下标i小于路径组总数目，则判断路径组下标i的ID与失效路径的ID是否一致；若一致则确认失效路径对应的目标路径组找到；若不一致则将路径组下标i加1并返回执行判断路径组下标i是否小于路径组总数目。在一些实施例中，所述查找模块303进一步配置用于：判断目标路径组对应的备用路径组是否可用；若目标路径组对应的备用路径组可用，则从所述目标路径组对应的备用路径组中寻找可切换路径；若目标路径组对应的备用路径组不可用，则将目标路径组对应的备用路径组ID加入失效链表，并判断目标路径组所属控制器下所有路径组是否均不可用、判断目标路径组属双活站点下所有路径组是否均不可用；若目标路径组所属控制器下所有路径组均不可用，则将目标路径所属控制器下所有路径组ID加入失效链表；若目标路径组属双活站点下所有路径组是否均不可用，则将目标路径组所属双活站点的所有路径组ID加入失效链表；再次遍历每个路径组以从除目标路径组及其备用路径组以外的路径组中寻找可切换路径。在一些实施例中，所述标记模块304进一步配置用于：将多路径设备下标k设置0，将多路径设备路径下标j设置0；判断多路径设备下标k是否小于多路径总数目，如果为真则继续执行，否则结束；判断多路径设备路径下标j是否小于多路径设备的路径总数目，如果为真则继续执行，否则多路径设备下标k加1并返回执行判断多路径设备下标k是否小于多路径总数目；判断多路径设备k路径j的ID是否等于失效路径的ID；如果为真则将多路径设备k路径j设置为失效，否则继续执行；判断多路径设备k路径j的ID是否等于失效链表中的ID；如果为真则将多路径设备k路径j设置为失效，否则将多路径设备路径下标j加1并返回执行判断多路径设备路径下标j是否小于多路径设备的路径总数目。需要说明的是，关于存储多路径中路径失效管理装置的具体限定可以参见上文中对存储多路径中路径失效管理方法的限定，在此不再赘述。上述存储多路径中路径失效管理装置中的各个模块可全部或部分通过软件、硬件及其组合来实现。上述各模块可以硬件形式内嵌于或独立于计算机设备中的处理器中，也可以以软件形式存储于计算机设备中的存储器中，以便于处理器调用执行以上各个模块对应的操作。根据本发明的另一方面，提供了一种计算机设备，该计算机设备可以是服务器，其内部结构图请参照图4所示。该计算机设备包括通过系统总线连接的处理器、存储器、网络接口和数据库。其中，该计算机设备的处理器用于提供计算和控制能力。该计算机设备的存储器包括非易失性存储介质、内存储器。该非易失性存储介质存储有操作系统、计算机程序和数据库。该内存储器为非易失性存储介质中的操作系统和计算机程序的运行提供环境。该计算机设备的数据库用于存储数据。该计算机设备的网络接口用于与外部的终端通过网络连接通信。该计算机程序被处理器执行时实现以上所述的存储多路径中路径失效管理方法，具体来说，所述方法包括以下步骤：设置多个路径组，并在多路径发现时为每个路径组指定备用路径组、所属控制器和所属双活站点，其中，每个路径组用于保存属于同一条物理路径的所有路径；若存在失效路径则遍历每个路径组以确定从所述多个路径组中找到所述失效路径所属的目标路径组；从除所述目标路径组以外的剩余路径组中为所述失效路径寻找可切换路径，并基于所述目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表；若找到可切换路径则遍历每条路径以将属于所述失效链表的路径标记为失效。根据本发明的又一方面，提供了一种计算机可读存储介质，其上存储有计算机程序，计算机程序被处理器执行时实现以上所述的存储多路径中路径失效管理方法，具体来说，包括执行以下步骤：设置多个路径组，并在多路径发现时为每个路径组指定备用路径组、所属控制器和所属双活站点，其中，每个路径组用于保存属于同一条物理路径的所有路径；若存在失效路径则遍历每个路径组以确定从所述多个路径组中找到所述失效路径所属的目标路径组；从除所述目标路径组以外的剩余路径组中为所述失效路径寻找可切换路径，并基于所述目标路径组对应的备用路径组、所属控制器和所属双活站点维护失效链表；若找到可切换路径则遍历每条路径以将属于所述失效链表的路径标记为失效。本领域普通技术人员可以理解实现上述实施例方法中的全部或部分流程，是可以通过计算机程序来指令相关的硬件来完成，所述的计算机程序可存储于一非易失性计算机可读取存储介质中，该计算机程序在执行时，可包括如上述各方法的实施例的流程。其中，本申请所提供的各实施例中所使用的对存储器、存储、数据库或其它介质的任何引用，均可包括非易失性和/或易失性存储器。非易失性存储器可包括只读存储器、可编程ROM、电可编程ROM、电可擦除可编程ROM或闪存。易失性存储器可包括随机存取存储器或者外部高速缓冲存储器。作为说明而非局限，RAM以多种形式可得，诸如静态RAM、动态RAM、同步DRAM、双数据率SDRAM、增强型SDRAM、同步链路DRAM、存储器总线直接RAM、直接存储器总线动态RAM、以及存储器总线动态RAM等。以上实施例的各技术特征可以进行任意的组合，为使描述简洁，未对上述实施例中的各个技术特征所有可能的组合都进行描述，然而，只要这些技术特征的组合不存在矛盾，都应当认为是本说明书记载的范围。以上所述实施例仅表达了本申请的几种实施方式，其描述较为具体和详细，但并不能因此而理解为对发明专利范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本申请构思的前提下，还可以做出若干变形和改进，这些都属于本申请的保护范围。因此，本申请专利的保护范围应以所附权利要求为准。
