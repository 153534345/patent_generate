标题title
设备控制方法、装置、电子设备及存储介质
摘要abst
本申请实施例提供了一种设备控制方法、装置、电子设备及存储介质，涉及嵌入式通信技术领域。其中，该方法包括：通过目标设备的物理层，接收设备控制指令，并将所述设备控制指令传输至已注册应用协议的传输控制层，所述设备控制指令用于指示所述目标设备处理目标业务，所述应用协议与所述目标业务相关；通过传输控制层，将所述设备控制指令根据所述应用协议转换为设备控制数据，并向应用层传输所述设备控制数据；通过所述应用层，调用与所述应用协议对应的应用接口处理所述设备控制数据，以控制所述目标设备处理所述目标业务。本申请实施例解决了相关技术中设备通信复杂时开发效率低下的问题。
权利要求书clms
1.一种设备控制方法，其特征在于，所述方法包括：通过目标设备的物理层，接收设备控制指令，并将所述设备控制指令传输至已注册应用协议的传输控制层，所述设备控制指令用于指示所述目标设备处理目标业务，所述应用协议与所述目标业务相关；通过所述传输控制层，将所述设备控制指令根据所述应用协议转换为设备控制数据，并向应用层传输所述设备控制数据；通过所述应用层，调用与所述应用协议对应的应用接口处理所述设备控制数据，以控制所述目标设备处理所述目标业务。2.如权利要求1所述的方法，其特征在于，所述将所述设备控制指令传输至已注册应用协议的传输控制层之前，所述方法还包括：针对所述目标业务，在所述传输控制层中注册与所述目标业务相关的所述应用协议。3.如权利要求1所述的方法，其特征在于，通过所述传输控制层，将所述设备控制指令根据所述应用协议转换为设备控制数据，包括：通过所述传输控制层，根据所述设备控制指令指示的所述目标业务，确定与所述目标业务相关的所述应用协议；根据所述应用协议中的设定字段，将所述设备控制指令封装为所述设备控制数据。4.如权利要求3所述的方法，其特征在于，所述设定字段是根据所述应用协议相关的所述目标业务进行配置的。5.如权利要求4所述的方法，其特征在于，所述设定字段包括以下至少一种：数据头字段，用于表示当前报文的数据头，所述当前报文为所述设备控制数据中的其中一个报文，所述当前报文的数据头至少指示了与所述目标业务相关的所述应用协议；第一校验字段，用于表示所述数据头字段的校验和；数据字段，用于表示所述当前报文中的数据；第二校验字段，用于表示所述当前报文的校验和，所述当前报文包括所述数据头字段、所述第一校验字段、所述数据字段。6.如权利要求1所述的方法，其特征在于，所述通过传输控制层，向应用层传输所述设备控制数据，包括：通过所述传输控制层，针对所述设备控制数据中的每一个报文，确定所述报文的优先级，将所述报文传输至所述优先级对应的收发集合；通过所述传输控制层，在优先级不同的每一个所述收发集合中，确定优先级最高的所述报文，作为当前报文，并向所述应用层传输所述当前报文。7.如权利要求6所述的方法，其特征在于，所述方法还包括：通过所述传输控制层，若所述收发集合在设定时间内获得所述当前报文，则对所述当前报文进行响应；或者，若所述收发集合在所述设定时间内未获得所述当前报文，则请求重传所述当前报文。8.如权利要求1至7任一项所述的方法，其特征在于，所述物理层是指在所述目标设备的外部接口与内部接口之间建立的物理链路；所述通过目标设备的物理层，接收设备控制指令，并将所述设备控制指令传输至已注册应用协议的传输控制层，包括：通过所述外部接口，接收用户终端发送的所述设备控制指令，并向所述内部接口传输所述设备控制指令；通过所述内部接口，将所述设备控制指令传输至所述传输控制层。9.一种设备控制装置，其特征在于，包括：所述装置包括：接收模块，用于通过目标设备的物理层，接收设备控制指令，并将所述设备控制指令传输至已注册应用协议的传输控制层，所述设备控制指令用于指示所述目标设备处理目标业务，所述应用协议与所述目标业务相关；传输模块，用于通过传输控制层，将所述设备控制指令根据所述应用协议转换为设备控制数据，并向应用层传输所述设备控制数据；执行模块，用于通过所述应用层，调用与所述应用协议对应的应用接口处理所述设备控制数据，以控制所述目标设备处理所述目标业务。10.一种电子设备，其特征在于，包括：至少一个处理器、至少一个存储器、以及至少一条通信总线，其中，所述存储器上存储有计算机程序，所述处理器通过所述通信总线读取所述存储器中的所述计算机程序；所述计算机程序被所述处理器执行时实现权利要求1至8中任一项所述的设备控制方法。11.一种存储介质，其上存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现如权利要求1至8中任一项所述的设备控制方法。
说明书desc
技术领域本申请涉及嵌入式通信技术领域，具体而言，本申请涉及一种设备控制方法、装置、电子设备及存储介质。背景技术在嵌入式通信中，例如，该嵌入式通信可以是串口通信、IIC通信、SPI通信等，目前侧重于硬件驱动层，应用层面的协议通常由开发人员或者各个厂家自行定义。协议开发过程中，往往涉及一台设备内部或者多台设备之间进行较为复杂的通信，例如，设备A与设备B之间的通信既支持红外通信，还支持无线通信，传统的设计方案存在耦合，使得开发过于复杂，不利于多人协同开发，导致开发效率低下。由上可知，设备通信复杂时如何提高开发效率亟待解决。发明内容本申请各实施例提供了一种设备控制方法、装置、电子设备及存储介质，可以解决相关技术中存在的设备通信复杂时开发效率低下的问题。所述技术方案如下：根据本申请实施例的一个方面，一种设备控制方法，所述方法包括：通过目标设备的物理层，接收设备控制指令，并将所述设备控制指令传输至已注册应用协议的传输控制层，所述设备控制指令用于指示所述目标设备处理目标业务，所述应用协议与所述目标业务相关；通过传输控制层，将所述设备控制指令根据所述应用协议转换为设备控制数据，并向应用层传输所述设备控制数据；通过所述应用层，调用与所述应用协议对应的应用接口处理所述设备控制数据，以控制所述目标设备处理所述目标业务。根据本申请实施例的一个方面，一种设备控制装置，包括：所述装置包括：接收模块，用于通过目标设备的物理层，接收设备控制指令，并将所述设备控制指令传输至已注册应用协议的传输控制层，所述设备控制指令用于指示所述目标设备处理目标业务，所述应用协议与所述目标业务相关；传输模块，用于通过传输控制层，将所述设备控制指令根据所述应用协议转换为设备控制数据，并向应用层传输所述设备控制数据；执行模块，用于通过所述应用层，调用与所述应用协议对应的应用接口处理所述设备控制数据，以控制所述目标设备处理所述目标业务。在一示例性实施例中，所述装置还包括：协议注册模块，用于针对所述目标业务，在所述传输控制层中注册与所述目标业务相关的所述应用协议。在一示例性实施例中，所述传输模块，包括：调度单元，用于通过所述传输控制层，根据所述设备控制指令指示的所述目标业务，确定与所述目标业务相关的所述应用协议；封装单元，用于根据所述应用协议中的设定字段，将所述设备控制指令封装为所述设备控制数据。在一示例性实施例中，所述设定字段是根据所述应用协议相关的所述目标业务进行配置的。在一示例性实施例中，所述设定字段包括以下至少一种：数据头字段，用于表示当前报文的数据头，所述当前报文为所述设备控制数据中的其中一个报文，所述当前报文的数据头至少指示了与所述目标业务相关的所述应用协议；第一校验字段，用于表示所述数据头字段的校验和；数据字段，用于表示所述当前报文中的数据；第二校验字段，用于表示所述当前报文的校验和，所述当前报文包括所述数据头字段、所述第一校验字段、所述数据字段。在一示例性实施例中，所述传输模块，还包括：优先级确定单元，用于通过所述传输控制层，针对所述设备控制数据中的每一个报文，确定所述报文的优先级，将所述报文传输至所述优先级对应的收发集合；报文传输单元，用于通过所述传输控制层，在优先级不同的每一个所述收发集合中，确定优先级最高的所述报文，作为当前报文，并向所述应用层传输所述当前报文。在一示例性实施例中，所述装置还包括：报文响应模块，用于通过所述传输控制层，若所述收发集合在设定时间内获得所述当前报文，则对所述当前报文进行响应；或者，若所述收发集合在所述设定时间内未获得所述当前报文，则请求重传所述当前报文。在一示例性实施例中，所述物理层是指在所述目标设备的外部接口与内部接口之间建立的物理链路；所述接收模块，包括：第一传输单元，用于通过所述外部接口，接收用户终端发送的所述设备控制指令，并向所述内部接口传输所述设备控制指令；第二传输单元，用于通过所述内部接口，将所述设备控制指令传输至所述传输控制层。根据本申请实施例的一个方面，一种电子设备，包括：至少一个处理器、至少一个存储器、以及至少一条通信总线，其中，存储器上存储有计算机程序，处理器通过通信总线读取存储器中的计算机程序；计算机程序被处理器执行时实现如上所述的设备控制方法。根据本申请实施例的一个方面，一种存储介质，其上存储有计算机程序，计算机程序被处理器执行时实现如上所述的设备控制方法。根据本申请实施例的一个方面，一种计算机程序产品，计算机程序产品包括计算机程序，计算机程序存储在存储介质中，计算机设备的处理器从存储介质读取计算机程序，处理器执行计算机程序，使得计算机设备执行时实现如上所述的设备控制方法。本申请提供的技术方案带来的有益效果是：在上述技术方案中，对于目标设备而言，通过物理层，接收设备控制指令，并将设备控制指令传输至已注册应用协议的传输控制层，进而通过传输控制层将设备控制指令根据已注册的应用协议转换为设备控制数据，并向应用层传输该设备控制数据，最终通过应用层调用与该应用协议对应的应用接口处理所述设备控制数据，使得目标设备按照设备控制指令的指示处理与该应用协议相关的目标业务，也就是说，较为复杂的设备通信被转移至传输控制层，使得应用层不再关注较为复杂的设备通信，仅需要提供应用接口即可，以此实现协议开发过程中的去耦合，进而有利于多人协同开发，从而能够有效地解决相关技术中存在的设备通信复杂时开发效率低下的问题。附图说明为了更清楚地说明本申请实施例中的技术方案，下面将对本申请实施例描述中所需要使用的附图作简单地介绍。图1是根据本申请实施例所涉及的一种嵌入式通信架构的示意图；图2是根据本申请实施例所涉及的实施环境的示意图；图3是根据本申请实施例所涉及的另一种嵌入式通信架构的示意图；图4是根据一示例性实施例示出的一种设备控制方法的流程图；图5是根据一示例性实施例示出的嵌入式通信架构中物理层的示意图图；图6是图4对应实施例中步骤310在一个实施例的流程图；图7是图4对应实施例中步骤330在一个实施例的流程图；图8是图4对应实施例中步骤330在另一个实施例的流程图；图9是图8对应实施例示出的报文正确接收的时序图；图10是图8对应实施例示出的报文重传的时序图；图11是一应用场景所涉及的一种设备控制方法的流程示意图；图12是根据一示例性实施例示出的一种设备控制装置的结构框图；图13是根据一示例性实施例示出的一种电子设备的硬件结构图；图14是根据一示例性实施例示出的一种电子设备的结构框图。具体实施方式下面详细描述本申请的实施例，所述实施例的示例在附图中示出，其中自始至终相同或类似的标号表示相同或类似的元件或具有相同或类似功能的元件。下面通过参考附图描述的实施例是示例性的，仅用于解释本申请，而不能解释为对本申请的限制。本技术领域技术人员可以理解，除非特意声明，这里使用的单数形式“一”、“一个”、“所述”和“该”也可包括复数形式。应该进一步理解的是，本申请的说明书中使用的措辞“包括”是指存在所述特征、整数、步骤、操作、元件和/或组件，但是并不排除存在或添加一个或多个其他特征、整数、步骤、操作、元件、组件和/或它们的组。应该理解，当我们称元件被“连接”或“耦接”到另一元件时，它可以直接连接或耦接到其他元件，或者也可以存在中间元件。此外，这里使用的“连接”或“耦接”可以包括无线连接或无线耦接。这里使用的措辞“和/或”包括一个或更多个相关联的列出项的全部或任一单元和全部组合。如前所述，传统的设计方案由于存在耦合，使得开发过于复杂，不利于多人协同开发，导致设备通信复杂时开发效率低下。图1示出了本申请实施例所涉及的一种嵌入式通信架构的示意图，在图1中，嵌入式通信架构100包括物理层101和应用层103。其中，物理层101用于接收外部设备的指令，例如，该指令可以是用于指示智能设备处理业务的设备控制指令，并向应用层传输该指令。应用层103用于处理该指令，以此控制智能设备完成业务所请求实现的功能，例如，业务可以是用户请求智能设备实现红外开机功能，还可以是用户请求智能设备实现无线温控功能等等。不同开发人员针对上述不同业务进行应用层面的协议开发时，不仅需要考虑是否存在不同通信方式，例如红外或者无线，还需要考虑不同业务请求实现的不同功能，例如开机或者温控，进而容易造成开发存在耦合，例如开机功能和温控功能之间的部分信息或者参数相互依赖，而使得开发过于复杂，不利于多人协同开发，从而影响了开发效率。由上可知，相关技术中仍存在设备通信复杂时开发效率低下的缺陷。为此，本申请提供的设备控制方法，能够实现协议开发过程中的去耦合，进而有效地提升设备通信复杂时的开发效率，相应地，该设备控制方法适用于设备控制装置、该设备控制装置可部署于电子设备，例如，该电子设备可以是智能设备等等。为使本申请的目的、技术方案和优点更加清楚，下面将结合附图对本申请实施方式作进一步地详细描述。图2为一种设备控制方法所涉及的实施环境的示意图。该实施环境包括用户终端110、智能设备130、网关150、服务器端170和路由器190。具体地，具体地，用户终端110，也可以认为是用户端或者终端，可进行智能设备130关联的客户端的部署，此用户终端110可以是智能手机、平板电脑、笔记本电脑、台式电脑等电子设备，在此不进行限定。其中，客户端，与智能设备130关联，实质是用户在客户端中进行账户注册，并在客户端中对智能设备130进行配置，例如，该配置包括为智能设备130添加设备标识等，以使得用户终端110中运行客户端时，能够为用户提供关于智能设备130的设备控制等功能，此客户端可以是应用程序形式，也可以是网页形式，相应地，客户端进行设备控制的界面则可以是程序窗口形式，还可以是网页页面形式的，此处也并未加以限定。智能设备130部署在网关150中，并通过其自身所配置的通信模块与网关150通信，进而受控于网关150。应当理解，智能设备130泛指多个智能设备130中的一个，本申请实施例仅以智能设备130举例说明，也即是，本申请实施例对部署在网关150中的智能设备的数量和设备类型并未加以限定。在一个应用场景中，智能设备130通过局域网络接入网关150，从而部署于网关150中。智能设备130通过局域网络接入网关150的过程包括：由网关150首先建立一个局域网络，智能设备130通过连接该网关150，从而加入该网关150建立的局域网络中。此局域网络包括但不限于：ZigBee或者蓝牙。其中，智能设备130可以是智能打印机、智能传真机、智能摄像机、智能空调、智能门锁、智能灯或者配置了通信模块的人体传感器、门窗传感器、温湿度传感器、水浸传感器、天然气报警器、烟雾报警器、墙壁开关、墙壁插座、无线开关、无线墙贴开关、魔方控制器、窗帘电机等电子设备。用户终端110与智能设备130之间的交互，可以通过局域网络实现，还可以通过广域网络实现。在一个应用场景中，用户终端110通过路由器190与网关150之间建立有线或者无线等方式的通信连接，例如，该有线或者无线等方式包括但不限于WIFI等，使得用户终端110与网关150部署于同一个局域网络，进而使得用户终端110可通过局域网络路径实现与智能设备130之间的交互。在另一个应用场景中，用户终端110通过服务器端170与网关150之间建立有线或者无线等方式的通信连接，例如，该有线或者无线等方式包括但不限于2G、3G、4G、5G、WIFI等，使得用户终端110与网关150部署于同一个广域网络，进而使得用户终端110可通过广域网络路径实现与智能设备130之间的交互。其中，服务器端170，也可以认为是云端、云平台、平台端、服务端等等，此服务器端170可以是一台服务器，也可以是由多台服务器构成的一个服务器集群，或者是由多台服务器构成的云计算中心，以便于更好地向海量用户终端110提供后台服务。例如，后台服务包括设备控制服务。随着客户端运行于用户终端110，用户便能够借助该客户端，请求与该客户端关联的智能设备130实现相应的功能。在一个应用场景中，用户终端130通过网关150向智能设备130发送设备控制指令，使得智能设备130接收到该设备控制指令，并按照该设备控制指令的指示处理业务以实现用户所请求的功能。图3示出了本申请实施例所涉及的另一种嵌入式通信架构的示意图，图4示出了本申请实施例提供的一种设备控制方法的流程图。现结合图3和图4，以设备控制方法各步骤的执行主体为电子设备为例，对该设备控制方法各步骤进行说明，但是并非对此构成具体限定。该电子设备具体可以是图2所示出实施环境中的智能设备130。如图3所示，智能设备130中部署有嵌入式通信架构，该嵌入式通信架构200包括物理层201、传输控制层203和应用层205，基于该嵌入式通信架构200，如图4所示，设备控制方法可以包括以下步骤：步骤310，通过目标设备的物理层201，接收设备控制指令，并将设备控制指令传输至已注册应用协议的传输控制层203。其中，设备控制指令用于指示目标设备处理目标业务。首先说明的是，目标业务用于指示用户请求目标设备实现的功能。例如，以温控器作为目标设备，该温控器支持红外开机和无线温控等功能，若用户请求温控器实现红外开机功能，则目标业务可以是基于红外通信实现温控器的开机，即红外开机业务，或者，若用户请求温控器实现无线温控功能，则目标业务可以是基于无线通信实现温控器的温度调节，即无线温控业务。其中，传输控制层是用于对数据进行传输的协议层，定义了数据帧如何进行传输。具体可以是介质访问控制层，例如介质访问控制层可以为MAC层。其次，与目标业务相关的应用协议的注册，是指针对目标业务，在传输控制层中注册与目标业务相关的应用协议，具体是指在基础的应用协议中额外地配置根据目标业务定义的设定字段，形成包含设定字段的应用协议，即完成注册的应用协议，以使得注册的应用协议不仅能够满足基础的设备通信业务，还能够适用于不同的目标业务。也就是说，目标业务不同，所配置的设定字段有所差别，相关的应用协议也各不相同，例如，若目标业务为红外开机业务，则应用协议可以是IrDA应用协议，或者，若目标业务为无线温控业务，则应用协议可以是ZigBee应用协议。此种方式下，通过应用协议的注册，一方面，目的在于去耦合，以使得应用层不再关注较为复杂的设备通信；另一方面，目的在于协议扩展，以使得应用层通过提供不同的应用接口，完成用户请求目标设备实现的不同功能，例如，应用接口是指应用程序接口。步骤330，通过传输控制层203，将设备控制指令根据应用协议转换为设备控制数据，并向应用层205传输设备控制数据。在一个可能的实施方式，基于应用协议的转换，是指将遵循相同/不同接口通信协议的设备控制指令转换为遵循统一接口通信协议的设备控制数据。在一个可能的实施方式，接口通信协议的转换，是指按照统一接口通信协议封装设备控制指令，具体是指按照串口通信协议封装设备控制指令。仍以前述例子进行说明，若设备控制指令用于指示用户请求温控器实现红外开机功能，即目标业务为红外开机业务，则设备控制指令遵循红外通信协议，或者，若设备控制指令用于指示用户请求温控器实现无线温控功能，即目标业务为无线温控业务，则设备控制指令遵循无线通信协议，通过应用协议的注册，上述设备控制指令便能够转换为遵循串口通信协议的设备控制数据。由上可知，基于应用协议的转换，应用层便能够获得遵循统一接口通信协议的设备控制数据，并能够调用不同应用协议对应的不同应用接口，使得目标设备按照设备控制指令的指示处理不同的目标业务，进而完成用户请求目标设备实现的不同功能。步骤350，通过应用层205，调用与应用协议对应的应用接口处理设备控制数据。也就是说，在目标设备中，用户终端发送的设备控制指令经由物理层201、传输控制层203传输至应用层205，以使应用层205调用对应的应用接口，最终控制目标设备处理目标业务，来完成用户请求目标设备实现的功能。通过上述过程，通过在物理层与应用层之间增设传输控制层，将较为复杂的设备通信转移至传输控制层，使得应用层不再关注较为复杂的设备通信，仅需要提供应用接口即可，以此实现协议开发过程中的去耦合，进而有利于多人协同开发，从而能够有效地解决相关技术中存在的设备通信复杂时开发效率低下的问题。在一个可能的实施方式，物理层是指在目标设备的外部接口与内部接口之间建立的物理链路。图5示出了本申请实施例所涉及的嵌入式通信架构中物理层的示意图。在部署了嵌入式通信架构的目标设备400中，尤其是指嵌入式通信架构部署于目标设备400的主控模块。如图5所示，目标设备400包括主控模块410，该主控模块410包括外部接口411和内部接口413，则外部接口411与内部接口413之间建立的物理链路可以视为物理层401；如图5所示，目标设备400包括至少一个通信模块430和主控模块410，该通信模块430包括外部接口431和内部接口433，该主控模块410包括内部接口413，则外部接口431、内部接口433、以及内部接口413之间建立的物理链路可以视为物理层401。通过物理层401，便能够将设备控制指令由用户终端传输至目标设备400的主控模块410，进而再经由目标设备400的主控模块410中的传输控制层403传输至应用层405，以控制目标设备400处理目标业务。请参阅图6，本申请实施例中提供了一种可能的实现方式，步骤310可以包括以下步骤：步骤311，通过外部接口，接收用户终端发送的设备控制指令，并向内部接口传输设备控制指令。在一个可能的实施方式，外部接口包括红外接口、USB接口、蓝牙接口、ZigBee接口、WIFI接口中的任意一种。在一个可能的实施方式，内部接口包括串口、IIC接口、SPI接口中的任意一种。步骤313，通过内部接口，将设备控制指令传输至传输控制层。对于传输控制层而言，在获得设备控制指令之后，便能够根据目标业务相关的应用协议，将来自于不同外部接口的设备控制指令转换为遵循统一接口通信协议的设备控制数据。现结合图5至图7，对设备控制指令的转换过程进行以下说明：请参阅图7，本申请实施例中提供了一种可能的实现方式，步骤330可以包括以下步骤：步骤331，通过传输控制层，根据设备控制指令指示的目标业务，确定与目标业务相关的应用协议。也就是说，在进行设备控制指令的转换之前，要先根据目标业务的不同，调度不同的应用协议，方才能够根据调度得到的应用协议进行设备控制指令的转换。例如，若设备控制指令指示的目标业务为红外开机业务，则调度该目标业务相关的IrDA应用协议，后续便基于IrDA应用协议进行设备控制指令的转换；或者，若设备控制指令指示的目标业务为无线温控业务，则调度该目标业务相关的ZigBee应用协议，后续便基于ZigBee应用协议进行设备控制指令的转换。步骤333，按照应用协议中的设定字段，将设备控制指令封装为设备控制数据。步骤335，向传输控制层传输设备控制数据。其中，设备控制数据由若干个报文组成，基于此，封装，实质是按照应用协议中的设定字段将设备控制指令解析为若干个报文，并由该若干个报文组成设备控制数据。在一个可能的实施方式，设定字段是根据应用协议相关的目标业务进行配置的。其中，设定字段包括但不限于：数据头字段、第一校验字段、数据字段、第二校验字段。在一个可能的实施方式，数据头字段用于表示当前报文的数据头，当前报文为设备控制数据中的其中一个报文，当前报文的数据头至少指示了与目标业务相关的应用协议。其中，数据头字段包括但不限于：首部标识字段、协议控制字段、报文序号字段、协议类型字段、数据长度字段。具体地，设定字段包括以下至少一种：首部标识字段，用于指示当前报文的首部；该当前报文为设备控制数据中的其中一个报文；协议控制字段，用于指示当前报文是否正确接收；报文序号字段，用于表示当前报文在设备控制数据中的报文序号；协议类型字段，用于指示与目标业务相关的应用协议；数据长度字段，用于表示当前报文中数据的长度；第一校验字段，用于表示数据头的校验和，数据头包括首部标识字段、协议控制字段、报文序号字段、协议类型字段、数据长度字段；数据字段，用于表示当前报文中的数据；第二校验字段，用于表示当前报文的校验和，当前报文包括数据头、第一校验字段、数据字段。举例来说，请求报文/响应报文中的各设定字段如表1所示：表1请求报文/响应报文中的各设定字段偏移量123456n+1字段名称STARTCTRLSEQPIDLENHeadchecksumDATACRC8其中，START表示首部标识字段，例如，该首部标识字段为0xAA，共8比特；当然，在其他实施例中，可以根据实际需要灵活地设置首部标识字段的长度和内容，此处并非构成具体限定，例如，该首部标识字段为0xFF，共8比特；CTRL表示协议控制字段，例如，1表示正确接收当前报文；SEQ表示报文序号字段；PID表示协议类型字段，例如，0表示与目标业务相关的IrDA应用协议，该目标业务为红外开机业务，以指示用户请求温控器实现红外开机功能；1表示与目标业务相关的ZigBee应用协议，该目标业务为无线温控业务，以指示用户请求温控器实现无线温控功能；由此，基于该协议类型字段，应用层首先确定与目标业务相关的应用协议，进而便能够确定该应用协议对应的应用接口，进而通过不同应用接口的调用，控制温控器处理不同的目标业务，以此来实现用户请求温控器实现的红外开机功能或者无线温控功能；LEN表示数据长度字段，取值范围为0至MAX，例如，MAX＝255；当然，在其他实施例中，可以根据实际需要灵活地调整MAX的取值，此处并未加以限定；Headchecksum表示第一校验字段，是对偏移量1至偏移量5的设定字段的校验和；DATA表示数据字段，若LEN＝0，则DATA＝0；CRC8表示第二校验字段，是对偏移量1至偏移量n的设定字段的校验和。在一个可能的实施方式，协议控制字段包括以下至少一种：报文类型标识，用于指示当前报文是否为请求报文；是否响应标识，用于指示当前报文是否返回响应报文；简单响应报文标识，用于指示若当前报文为请求报文，则是否返回简单响应报文，或者，用于指示若当前报文为响应报文，则响应报文是否为简单响应报文。举例来说，协议控制字段共8比特，具体定义如下：第0-4比特保留；第5比特表示AACK，即简单响应报文标识，若当前报文为请求报文，1表示需要返回简单响应报文，若当前报文为响应报文，1表示该响应报文为简单响应报文；第6比特表示RACK，即是否响应标识，0表示不返回响应报文，1表示返回响应报文；第7比特表示ACK，即报文类型标识，0表示请求报文，1表示响应报文。那么，针对某一个请求报文，若响应报文中的协议控制字段包括ACK＝1，RACK＝0，AACK＝1，则表示正确接收到请求报文。在一个可能的实施方式，简单响应报文是指不携带数据的响应报文。在一个可能的实施方式，简单响应报文至少包括：响应状态标识，用于指示请求报文的响应状态。具体地，该响应状态包括但不限于：接收成功、接收错误、接收超时、校验错误。举例来说，简单响应报文中的各设定字段如表2所示：表2简单响应报文中的各设定字段偏移量1234567字段名称0xAA0xA0SEQPID1STATUSCRC8在该简单响应报文中，0xAA用于指示报文的首部，0xA0表示报文为简单响应报文，SEQ为报文序号字段，PID为协议类型字段，1表示第一校验字段，STATUS表示响应状态标识，共2比特，具体定义如下：00表示接收成功，01表示接收错误，10表示接收超时，11表示校验错误，CRC8为第二校验字段。由此可见，简单响应报文并未包含数据字段，即LEN＝0，DATA＝0，这不仅有利于减少数据传输过程中的数据量，而且有利于提高数据传输效率，避免长时间等待携带数据的响应报文。在上述实施例的作用下，无论设备控制指令通过何种通信方式传输至物理层，通过封装，对于传输控制层而言，获得的设备控制数据均遵循统一接口通信协议，例如，串口通信协议，也可以理解为，使得开发人员无需关注不同通信方式，仅需设计对应于不同业务的应用协议，从而实现协议开发过程中的去耦合，有利于多人协同开发，例如，开发人员A从应用层面设计用于实现温控器红外开机功能的应用协议，开发人员B从应用层面设计用于实现温控器无线温控功能的应用协议，进而能够有效地提升设备通信复杂时的开发效率。请参阅图8，本申请实施例中提供了一种可能的实现方式，步骤330可以包括以下步骤：步骤431，通过传输控制层，针对设备控制数据中的每一个报文，确定报文的优先级，将报文传输至优先级对应的收发集合。发明人意识到，对于目标设备而言，在面对多个用户时，可能同时接收到来自于不同用户终端发送的设备控制指令，那么，对于传输控制层来说，就可能同时接收到多个设备控制数据，容易理解，如果按照先进先出原则，就有可能对应于非紧急业务逻辑的设备控制数据先处理或者暂不处理，而导致对应于紧急业务逻辑的设备控制数据后处理或者无法处理。为此，本实施例中，设置不同业务逻辑的优先级，以使得优先级高的业务逻辑能够被优先处理。也可以认为是，对应于不同业务逻辑的设备控制数据具有不同的优先级，或者是，设备控制数据中报文的优先级可能有所区别。其中，优先级可以根据实际需要灵活地设置，例如，优先级的数值越大，表示优先级越高，对应的业务逻辑越紧急，此处并未加以限定。在一个可能的实施方式，收发集合为先进先出队列。应当理解，对于同一个设备控制数据中的报文，将传输至相同的先进先出队列，对应于不同业务逻辑的不同设备控制数据中的报文，则传输至不同的先进先出队列。步骤433，通过传输控制层，在优先级不同的每一个收发集合中，确定优先级最高的报文，作为当前报文，并向应用层传输当前报文。以收发集合为先进先出队列举例来说，假设存在4个优先级不同的先进先出队列，分别是：优先级为0的OTA队列、优先级为1的ZCL订阅队列、优先级为2的ZCL使用队列、以及优先级为3的事件使用队列，那么，若优先级为3的事件使用队列中存在3个报文，报文序号分别为31、32、33，优先级为2的ZCL使用队列存在2个报文，报文序号分别为21、22，优先级为0的OTA队列存在1个报文，报文序号分别为01，则向应用层传输的当前报文依次是：31、32、33、21、22、01。换而言之，在不同队列中，优先级高的报文先传输，在相同队列中，则遵循先进先出原则。进一步地，在一个示例性实施例中，步骤333之后，设备控制方法还可以包括以下步骤：通过传输控制层，若收发集合在设定时间内获得当前报文，则返回简单响应报文；或者，若收发集合在设定时间内未获得当前报文，则请求重传当前报文。其中，设定时间可以根据实际需要灵活地调整，此处并未加以限定。如图9所示，物理层发送报文R1至介质访问层，介质访问层将该报文R1传输至收发集合，以通过该收发集合，将该报文R1传输至应用层。由于报文R1中的协议控制字段包括ACK＝0，RACK＝1，AACK＝1，即表示报文R1为请求报文，该请求报文需要返回简单响应报文，因此，对于传输控制层而言，若收发集合在设定时间内获得报文R1，便会向返回简单响应报文SIMPLE ACK，在介质访问层获得该简单响应报文SIMPLE ACK之后，便可将报文R1从收发集合中删除。如图10所示，物理层发送报文R1至介质访问层，介质访问层将该报文R1传输至收发集合，以通过该收发集合，将该报文R1传输至应用层。由于报文R1中的协议控制字段包括ACK＝0，RACK＝1，AACK＝1，即表示报文R1为请求报文，该请求报文需要返回简单响应报文，因此，对于传输控制层而言，若收发集合在设定时间内未获得报文R1，则返回简单响应报文，该简单响应报文中的响应状态标识可以是接收超时，还可以是接收错误、校验错误，以使传输控制层确定请求报文丢失或者错包，进而请求重传报文R1。通过上述实施例的配合，数据传输过程中的校验、重发、队列缓冲等均由传输控制层保证，而无需应用层保证，一方面，使得应用层不再关注较为复杂的设备通信，仅需要提供应用接口即可，实现了协议开发过程中的去耦合，进而有利于多人协同开发，有利于提高设备通信复杂时的开发效率；另一方面，由于应用层无需返回携带数据的响应报文，而是通过收发集合返回简单响应报文替代，避免传输控制层长时间等待携带数据的响应报文，从而有利于提高数据传输效率。现结合图2和图11，对本申请涉及的一应用场景中设备控制过程加以说明，该应用场景适用于图2所示出的实施环境，用户终端130通过网关150向智能设备130发送设备控制指令，以指示智能设备130处理目标业务。其中，智能设备130为温控器，该温控器能够处理的目标业务至少包括红外开机业务和无线温控业务。如图11所示，对于温控器而言，既可以通过红外接口接收设备控制指令，该设备控制指令用于指示温控器处理红外开机业务，又可以通过无线通信接口接收设备控制指令，该设备控制指令用于指示温控器处理无线温控业务。在外部接口接收到设备控制指令之后，便会进一步通过内部接口将该设备控制指令传输至传输层。就传输层来说，首先根据设备控制指令进行应用协议的调度。例如，若设备控制指令指示的目标业务为红外开机业务，则调度IrDA应用协议；若设备控制指令指示的目标业务为无线温控业务，则调度ZigBee应用协议。其次，基于调度得到的应用协议进行设备控制指令的转换。例如，针对红外开机业务的设备控制指令，基于IrDA应用协议进行转换；针对无线温控业务的设备控制指令，基于ZigBee应用协议进行转换。最后，将转换得到的设备控制数据传输至应用层。就应用层来说，在获得设备控制数据之后，便能够调用对应的应用接口处理设备控制数据。例如，针对红外开机业务相关的IrDA应用协议，调用红外开机的API处理设备控制数据；针对无线温控业务相关的ZigBee应用协议，调用无线温控的API处理设备控制数据。在一些实施例中，温控器处理完毕相关目标业务之后，还可以对用户终端进行状态反馈，例如，反馈温控器的设备状态，或者反馈温控器已完成目标业务的处理。对于用户而言，用户便能够及时了解到温控器是否已完成了相关的目标业务，亦即是温控器是否完成了用户所请求实现的功能。例如，用户能看到温控器已开机，表示温控器处理了红外开机业务，或者，用户能看到温控器的温度已调节，表示温控器处理了无线温控业务。下述为本申请装置实施例，可以用于执行本申请所涉及的设备控制方法。对于本申请装置实施例中未披露的细节，请参照本申请所涉及的设备控制方法的方法实施例。请参阅图12，本申请实施例中提供了一种设备控制装置900，包括但不限于：接收模块910、传输模块930以及执行模块950。其中，接收模块910，用于通过目标设备的物理层，接收设备控制指令，并将所述设备控制指令传输至已注册应用协议的传输控制层，设备控制指令用于指示目标设备处理目标业务，应用协议与目标业务相关。传输模块930，用于通过传输控制层，将所述设备控制指令根据所述应用协议转换为设备控制数据，并向应用层传输设备控制数据。执行模块950，用于通过应用层，调用与应用协议对应的应用接口处理设备控制数据，以控制目标设备处理目标业务。在一示例性实施例中，所述装置还包括：协议注册模块，用于针对所述目标业务，在所述传输控制层中注册与所述目标业务相关的所述应用协议。在一示例性实施例中，所述传输模块，包括：调度单元，用于通过所述传输控制层，根据所述设备控制指令指示的所述目标业务，确定与所述目标业务相关的所述应用协议；封装单元，用于根据所述应用协议中的设定字段，将所述设备控制指令封装为所述设备控制数据。在一示例性实施例中，所述设定字段是根据所述应用协议相关的所述目标业务进行配置的。在一示例性实施例中，所述设定字段包括以下至少一种：数据头字段，用于表示当前报文的数据头，所述当前报文为所述设备控制数据中的其中一个报文，所述当前报文的数据头至少指示了与所述目标业务相关的所述应用协议；第一校验字段，用于表示所述数据头字段的校验和；数据字段，用于表示所述当前报文中的数据；第二校验字段，用于表示所述当前报文的校验和，所述当前报文包括所述数据头字段、所述第一校验字段、所述数据字段。在一示例性实施例中，所述传输模块，还包括：优先级确定单元，用于通过所述传输控制层，针对所述设备控制数据中的每一个报文，确定所述报文的优先级，将所述报文传输至所述优先级对应的收发集合；报文传输单元，用于通过所述传输控制层，在优先级不同的每一个所述收发集合中，确定优先级最高的所述报文，作为当前报文，并向所述应用层传输所述当前报文。在一示例性实施例中，所述装置还包括：报文响应模块，用于通过所述传输控制层，若所述收发集合在设定时间内获得所述当前报文，则对所述当前报文进行响应；或者，若所述收发集合在所述设定时间内未获得所述当前报文，则请求重传所述当前报文。在一示例性实施例中，所述物理层是指在所述目标设备的外部接口与内部接口之间建立的物理链路；所述接收模块，包括：第一传输单元，用于通过所述外部接口，接收用户终端发送的所述设备控制指令，并向所述内部接口传输所述设备控制指令；第二传输单元，用于通过所述内部接口，将所述设备控制指令传输至所述传输控制层。需要说明的是，上述实施例所提供的设备控制装置在进行设备控制时，仅以上述各功能模块的划分进行举例说明，实际应用中，可以根据需要而将上述功能分配由不同的功能模块完成，即设备控制装置的内部结构将划分为不同的功能模块，以完成以上描述的全部或者部分功能。另外，上述实施例所提供的设备控制装置与设备控制方法的实施例属于同一构思，其中各个模块执行操作的具体方式已经在方法实施例中进行了详细描述，此处不再赘述。图13根据一示例性实施例示出的一种电子设备的结构示意。该电子设备适用于图2所示出实施环境中的智能设备130。需要说明的是，该电子设备只是一个适配于本申请的示例，不能认为是提供了对本申请的使用范围的任何限制。该电子设备也不能解释为需要依赖于或者必须具有图13示出的示例性的电子设备2000中的一个或者多个组件。电子设备2000的硬件结构可因配置或者性能的不同而产生较大的差异，如图13所示，电子设备2000包括：电源210、接口230、至少一存储器250、以及至少一中央处理器270。具体地，电源210用于为电子设备2000上的各硬件设备提供工作电压。接口230包括至少一有线或无线网络接口，用于与外部设备交互。例如，进行图2所示出实施环境中用户终端110与智能设备130之间的交互。当然，在其余本申请适配的示例中，接口230还可以进一步包括至少一串并转换接口233、至少一输入输出接口235以及至少一USB接口237等，如图13所示，在此并非对此构成具体限定。存储器250作为资源存储的载体，可以是只读存储器、随机存储器、磁盘或者光盘等，其上所存储的资源包括操作系统251、应用程序253及数据255等，存储方式可以是短暂存储或者永久存储。其中，操作系统251用于管理与控制电子设备2000上的各硬件设备以及应用程序253，以实现中央处理器270对存储器250中海量数据255的运算与处理，其可以是WindowsServerTM、Mac OS XTM、UnixTM、LinuxTM、FreeBSDTM等。应用程序253是基于操作系统251之上完成至少一项特定工作的计算机程序，其可以包括至少一模块，每个模块都可以分别包含有对电子设备2000的计算机程序。例如，设备控制装置可视为部署于电子设备2000的应用程序253。数据255可以是存储于磁盘中的照片、图片等，还可以是设备控制数据等，存储于存储器250中。中央处理器270可以包括一个或多个以上的处理器，并设置为通过至少一通信总线与存储器250通信，以读取存储器250中存储的计算机程序，进而实现对存储器250中海量数据255的运算与处理。例如，通过中央处理器270读取存储器250中存储的一系列计算机程序的形式来完成设备控制方法。此外，通过硬件电路或者硬件电路结合软件也能同样实现本申请，因此，实现本申请并不限于任何特定硬件电路、软件以及两者的组合。请参阅图14，本申请实施例中提供了一种电子设备4000，该电子设备400可以包括：智能设备。在图14中，该电子设备4000包括至少一个处理器4001、至少一条通信总线4002以及至少一个存储器4003。其中，处理器4001和存储器4003相连，如通过通信总线4002相连。可选地，电子设备4000还可以包括收发器4004，收发器4004可以用于该电子设备与其他电子设备之间的数据交互，如数据的发送和/或数据的接收等。需要说明的是，实际应用中收发器4004不限于一个，该电子设备4000的结构并不构成对本申请实施例的限定。处理器4001可以是CPU，通用处理器，DSP，ASIC，FPGA或者其他可编程逻辑器件、晶体管逻辑器件、硬件部件或者其任意组合。其可以实现或执行结合本申请公开内容所描述的各种示例性的逻辑方框，模块和电路。处理器4001也可以是实现计算功能的组合，例如包含一个或多个微处理器组合，DSP和微处理器的组合等。通信总线4002可包括一通路，在上述组件之间传送信息。通信总线4002可以是PCI总线或EISA总线等。通信总线4002可以分为地址总线、数据总线、控制总线等。为便于表示，图14中仅用一条粗线表示，但并不表示仅有一根总线或一种类型的总线。存储器4003可以是ROM或可存储静态信息和指令的其他类型的静态存储设备，RAM或者可存储信息和指令的其他类型的动态存储设备，也可以是EEPROM、CD-ROM或其他光盘存储、光碟存储、磁盘存储介质或者其他磁存储设备、或者能够用于携带或存储具有指令或数据结构形式的期望的程序代码并能够由计算机存取的任何其他介质，但不限于此。存储器4003上存储有计算机程序，处理器4001通过通信总线4002读取存储器4003中存储的计算机程序。该计算机程序被处理器4001执行时实现上述各实施例中的设备控制方法。此外，本申请实施例中提供了一种存储介质，该存储介质上存储有计算机程序，该计算机程序被处理器执行时实现上述各实施例中的设备控制方法。本申请实施例中提供了一种计算机程序产品，该计算机程序产品包括计算机程序，该计算机程序存储在存储介质中。计算机设备的处理器从存储介质读取该计算机程序，处理器执行该计算机程序，使得该计算机设备执行上述各实施例中的设备控制方法。与相关技术相比，一方面，在嵌入式通信中引入软件分层，即嵌入式通信架构包括物理层、传输控制层和应用层；另一方面，通过在物理层与应用层之间增设传输控制层，将较为复杂的设备通信转移至传输控制层，使得应用层不再关注较为复杂的设备通信，仅需要提供应用接口即可，实现了协议开发过程中的去耦合，进而有利于多人协同开发，从而能够有效地解决相关技术中存在的设备通信复杂时开发效率低下的问题。应该理解的是，虽然附图的流程图中的各个步骤按照箭头的指示依次显示，但是这些步骤并不是必然按照箭头指示的顺序依次执行。除非本文中有明确的说明，这些步骤的执行并没有严格的顺序限制，其可以以其他的顺序执行。而且，附图的流程图中的至少一部分步骤可以包括多个子步骤或者多个阶段，这些子步骤或者阶段并不必然是在同一时刻执行完成，而是可以在不同的时刻执行，其执行顺序也不必然是依次进行，而是可以与其他步骤或者其他步骤的子步骤或者阶段的至少一部分轮流或者交替地执行。以上所述仅是本申请的部分实施方式，应当指出，对于本技术领域的普通技术人员来说，在不脱离本申请原理的前提下，还可以做出若干改进和润饰，这些改进和润饰也应视为本申请的保护范围。
