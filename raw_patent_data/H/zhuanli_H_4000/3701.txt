标题title
一种调用查询接口的请求方法及系统
摘要abst
本发明公开了一种调用查询接口的请求方法及系统，将该请求方法用于服务端调用查询接口领域，可简化处理逻辑，其技术方案：涉及代理API，所述代理API封装有多个代理函数，一个代理函数对应一个外部服务的接口API，包括如下步骤：获取查询请求；代理API执行所述代理函数将查询请求发送到外部服务的查询接口；查询接口返回查询结果，属于计算机领域。
权利要求书clms
1.一种调用查询接口的请求方法，其特征在于，涉及代理API，所述代理API封装有多个代理函数，一个代理函数对应一个外部服务的接口API，包括如下步骤：获取查询请求；代理API执行所述代理函数将查询请求发送到外部服务的查询接口；查询接口返回查询结果。2.根据权利要求1所述的调用查询接口的请求方法，其特征在于，还涉及一拦截组件，拦截组件用于拦截代理函数以获取代理函数携带的查询请求的数据长度，若数据长度大于预设阈值，则对查询请求进行分片处理，使查询请求形成多个查询请求段，多个查询请求段分别发送到查询接口以实现分段查询。3.根据权利要求2所述的调用查询接口的请求方法，其特征在于，对代理API设定自定义标识，拦截组件通过AOP方法对带有自定义标识的代理API的代理函数进行拦截。4.根据权利要求2所述的调用查询接口的请求方法，其特征在于，查询请求段发送到查询接口时，拦截组件将查询请求段返回代理API，由代理API执行对应的代理函数将查询请求段发送到查询接口。5.根据权利要求3所述的调用查询接口的请求方法，其特征在于，定义注解@EnablePartitionRequest，将注解@EnablePartitionRequest添加到带有自定义标识的代理API的代理函数上，拦截组件拦截到带有注解@EnablePartitionRequest的代理函数时才对查询请求进行分片处理。6.根据权利要求5所述的调用查询接口的请求方法，其特征在于，拦截组件拦截到没有注解@EnablePartitionRequest的代理函数时，若代理函数携带的查询请求的数据长度大于预设阈值，则生成告警提示。7.根据权利要求2所述的调用查询接口的请求方法，其特征在于，通过注解@ThresholdOfArrayLength定义预设阈值的大小。8.根据权利要求2所述的调用查询接口的请求方法，其特征在于，多个查询请求段得到多个查询结果，查询接口将多个查询结果返回代理API，代理API将多个查询结果返回拦截组件，由拦截组件汇总多个查询结果再将汇总后的查询结果返回代理API，由代理API将查询结果返回。9.一种调用查询接口的请求系统，其特征在于，包括：服务端、代理API组件、拦截组件以及查询接口端；其中，服务端包括多个调用单元，所述调用单元包括：第一查询请求发送模块：用于将查询请求发送到代理API组件；第一查询结果接收模块：用于接收返回的查询结果；代理API组件包括：第一查询请求接收模块：用于接收查询请求或查询请求段；代理函数储存模块：用于储存代理函数，一个代理函数对应一个外部服务的接口API；第二查询请求发送模块：用于执行所述代理函数将查询请求或查询请求段发送到查询接口；第二查询结果接收模块：用于接收返回的查询结果；第一查询结果发送模块：用于将查询结果发送到服务端或拦截组件；拦截组件包括：代理函数拦截模块：用于拦截带有自定义标识的代理API组件的代理函数；查询请求分析模块：用于分析查询请求的数据长度是否超过预设阈值；查询请求分片模块：用于对带有注解@EnablePartitionRequest的代理函数携带的数据长度超过预设阈值的查询请求进行分片处理以形成查询请求段；第三查询请求发送模块：用于将查询请求或查询请求段返回代理API；第三查询结果接收模块：用于接收代理API返回来的查询结果，查询结果对应查询请求段；查询结果段汇总模块：用于汇总对应查询请求段的查询结果；第二查询结果发送模块：用于将汇总后的查询结果返回代理API；告警提示生成模块：用于生成告警提示，告警提示基于数据长度超过预设阈值的调用没有注解@EnablePartitionRequest的代理函数的查询请求生成；查询接口端包括：第二查询请求接收模块：用于接收查询请求或查询请求段；查询结果储存模块：用于储存与查询请求或查询请求段对应的信息，该信息记为查询结果；第三查询结果发送模块：用于将查询结果发送给代理API组件。
说明书desc
技术领域本发明属于计算机领域，更具体而言，涉及一种调用查询接口的请求方法及系统。背景技术服务端一般会有多个调用外部服务查询接口的调用单元，当多个调用单元调用查询接口时，一般是由调用单元直接调用目标查询接口的；所以，调用单元中需要有调用查询接口的函数。在现有技术中，若多个调用单元调用同一个目标查询接口，则每个调用单元都需要调用自身的查询接口的函数，处理逻辑重复。发明内容本发明的主要目的在于提供一种调用查询接口的请求方法，用于服务端调用查询接口领域，可简化处理逻辑。根据本发明的第一方面，提供了一种调用查询接口的请求方法，涉及代理API，所述代理API封装有多个代理函数，一个代理函数对应一个外部服务的接口API，包括如下步骤：获取查询请求；代理API执行所述代理函数将查询请求发送到外部服务的查询接口；查询接口返回查询结果。本发明一个特定的实施例中，还涉及一拦截组件，拦截组件用于拦截代理函数以获取代理函数携带的查询请求的数据长度，若数据长度大于预设阈值，则对查询请求进行分片处理，使查询请求形成多个查询请求段，多个查询请求段分别发送到查询接口以实现分段查询。本发明一个特定的实施例中，对代理API设定自定义标识，拦截组件通过AOP方法对带有自定义标识的代理API的代理函数进行拦截。本发明一个特定的实施例中，查询请求段发送到查询接口时，拦截组件将查询请求段返回代理API，由代理API执行对应的代理函数将查询请求段发送到查询接口。本发明一个特定的实施例中，定义注解@EnablePartitionRequest，将注解@EnablePartitionRequest添加到带有自定义标识的代理API的代理函数上，拦截组件拦截到带有注解@EnablePartitionRequest的代理函数时才对查询请求进行分片处理。本发明一个特定的实施例中，拦截组件拦截到没有注解@EnablePartitionRequest的代理函数时，若代理函数携带的查询请求的数据长度大于预设阈值，则生成告警提示。本发明一个特定的实施例中，通过注解@ThresholdOfArrayLength定义预设阈值的大小。本发明一个特定的实施例中，多个查询请求段得到多个查询结果，查询接口将多个查询结果返回代理API，代理API将多个查询结果返回拦截组件，由拦截组件汇总多个查询结果再将汇总后的查询结果返回代理API，由代理API将查询结果返回。本发明还提出一种调用查询接口的请求系统，包括：服务端、代理API组件、拦截组件以及查询接口端；其中，服务端包括多个调用单元，所述调用单元包括：第一查询请求发送模块：用于将查询请求发送到代理API组件；第一查询结果接收模块：用于接收返回的查询结果；代理API组件包括：第一查询请求接收模块：用于接收查询请求或查询请求段；代理函数储存模块：用于储存代理函数，一个代理函数对应一个外部服务的接口API；第二查询请求发送模块：用于执行所述代理函数将查询请求或查询请求段发送到查询接口；第二查询结果接收模块：用于接收返回的查询结果；第一查询结果发送模块：用于将查询结果发送到服务端或拦截组件；拦截组件包括：代理函数拦截模块：用于拦截带有自定义标识的代理API组件的代理函数；查询请求分析模块：用于分析查询请求的数据长度是否超过预设阈值；查询请求分片模块：用于对带有注解@EnablePartitionRequest的代理函数携带的数据长度超过预设阈值的查询请求进行分片处理以形成查询请求段；第三查询请求发送模块：用于将查询请求或查询请求段返回代理API；第三查询结果接收模块：用于接收代理API返回来的查询结果，查询结果对应查询请求段；查询结果段汇总模块：用于汇总对应查询请求段的查询结果；第二查询结果发送模块：用于将汇总后的查询结果返回给代理API；告警提示生成模块：用于生成告警提示，告警提示基于没有注解@EnablePartitionRequest的代理函数所携带的查询请求的数据长度生成；查询接口端包括：第二查询请求接收模块：用于接收查询请求或查询请求段；查询结果储存模块：用于储存与查询请求或查询请求段对应的信息，该信息记为查询结果；第三查询结果发送模块：用于将查询结果发送给代理API组件。本发明上述技术方案中的一个技术方案至少具有如下优点或有益效果之一：在实际应用中，将本发明所述的一种调用查询接口的请求方法应用在服务端调用查询接口领域中，若服务端中多个调用单元调用的是同一个查询接口，即发送的是同一个查询请求，则多个调用单元均将查询请求发送给代理API，由代理API执行同一个代理函数将该查询请求发送到查询接口，再由代理API将查询接口返回的查询结果分别返回到服务端的多个调用单元，即，多个调用单元均无需执行调用查询接口的代理函数，简化了处理逻辑；在本发明中，还包括一拦截组件，拦截组件用于拦截代理函数，若多个调用单元发送的是同一个查询请求，且该查询请求数据长度大于预设阈值，则由拦截组件对携带该查询请求的代理函数进行拦截并对查询请求进行分片处理，使得查询请求形成查询请求段，再通过查询请求段实现分段查询，即，多个调用单元均无需对查询请求进行分片处理，进一步简化了处理逻辑。附图说明下面结合附图和实施例对本发明进一步地说明；图1是本发明的一种调用查询接口的请求方法的流程示意图；图2是本发明的一种调用查询接口的请求方法的应用在设备授权查询的时序图；图3是本发明的一种调用查询接口的请求系统的代理函数未被拦截时的应用示意图；图4是本发明的一种调用查询接口的请求系统的代理函数被拦截时的应用示意图；图5是本发明的一种调用查询接口的请求系统的代理函数未被拦截时的结构示意图；图6是本发明的一种调用查询接口的请求系统的代理函数被拦截时的结构示意图。具体实施方式下面详细描述本发明的实施方式，实施方式的示例在附图中示出，其中相同或类似的标号自始至终表示相同或类似的元件或具有相同或类似功能的元件。下面通过参考附图描述的实施方式是示例性的，仅用于解释本发明，而不能理解为对本发明的限制。服务端一般会有多个调用外部服务查询接口的调用单元，当多个调用单元调用查询接口时，一般是由调用单元直接调用目标查询接口的；所以，调用单元中需要有调用查询接口的方法。在现有技术中，若服务端的多个调用单元调用同一个目标查询接口，则每个调用单元都需要有调用查询接口的函数，在调用目标查询接口时，每个调用单元都要执行调用查询接口的函数，处理逻辑重复。本实施例提出了一种调用查询接口的请求方法，其核心思想为：将调用查询接口的函数封装为代理API；调用单元调用目标查询接口时，将调用请求发送给代理API，由代理API调用目标查询接口；将本实施例所述的调用查询接口的请求方法应用在服务端调用查询接口领域中，可简化处理逻辑。图1为本实施例的一种调用查询接口的请求方法的流程示意图；本实施例以服务端调用查询接口为例进行说明；参照图1所示，本实施例公开了一种调用查询接口的请求方法，涉及代理API，所述代理API封装有多个代理函数，一个代理函数对应一个外部服务的接口API，包括如下步骤：步骤1：获取查询请求；其中，查询请求由用户在服务端发起。步骤2：代理API执行所述代理函数将查询请求发送到外部服务的查询接口；在本实施例中，代理函数指的是调用查询接口的方法，如，Feign框架的微服务的服务端之间的查询接口的调用，其是通过FeignClient的接口方法实现调用的；对于此类的调用，代理API将其封装为一个代理函数，该代理函数的方法与FeignClient的接口方法及参数一一对应；又如，通过RestTemplate组件来调用外部系统GET接口的调用类型，代理API将RestTemplate组件的RestTemplate Get请求封装成一个代理函数。具体来说，代理API内设有调用所述代理函数的业务方法，由业务方法调用所述代理函数将查询请求发送到目标查询接口。在实际应用中，对于无法提前识别大数据请求的查询接口，若查询请求的数据过长且超过请求的最大长度限制，则会出现请求失败的情况；所以，作为本实施例的优选，还涉及一拦截组件，拦截组件用于拦截代理函数以获取代理函数携带的查询请求的数据长度，若数据长度大于预设阈值，则对查询请求进行分片处理，将查询请求按照预设阈值进行分片以形成多个查询请求段，多个查询请求段分别发送到查询接口以实现分段查询，有效地避免了请求失败的情况出现；查询请求段发送到查询接口时，拦截组件将查询请求段返回代理API，由代理API执行对应的代理函数将查询请求段发送到查询接口。具体来说，拦截组件通过AOP方法来拦截查询请求，拦截组件将查询请求的数据长度与预设阈值进行对比判断；当查询请求的数据长度小于或等于预设阈值时，则无需对查询请求进行分片处理，拦截组件将查询请求返回代理API，由代理API执行对应的代理函数将查询请求发送到查询接口。作为本实施例的具体实现，对代理API设定自定义标识，自定义标识如ApiRequestProxy，AOP方法对此类代理API进行拦截；对没有上述自定义标识的代理API不作拦截，由代理API调用对应的代理函数将查询请求直接发送到查询接口。在实际应用中，有些查询接口需要进行分片处理才能进行查询，而有些查询接口则不需要进行分片处理就能进行查询；所以，对于需要进行分片处理才能进行查询的查询接口，定义注解@EnablePartitionRequest，将该注解添加到该种查询接口对应的带有自定义标识的代理API中的代理函数上，拦截组件拦截到此类代理函数时才对其携带的查询请求进行分片处理，反之，则为普通调用，不对查询请求作分片处理；普通调用的代理函数为没有注解@EnablePartitionRequest的代理函数，对于此类普通调用的代理函数，若其携带的查询请求的数据长度大于预设阈值，则生成告警提示，如告警日志等方式进行提示，其内容包括请求的耗时时间等；总的来说，拦截组件对带有自定义标识的代理API进行拦截，拦截后对查询请求的处理情况如下；1、拦截到有注解@EnablePartitionRequest的代理函数，分析其携带的查询请求的数据长度是否超过预设阈值，若超过，则进行分片处理，使得查询请求形成多个查询请求段，拦截组件再将多个查询请求段依次返回代理API，由代理API执行对应的代理函数将查询请求段发送到查询接口；若不超过，则拦截组件将查询请求返回代理API，由代理API执行对应的代理函数将查询请求发送到查询接口；2、拦截到没有注解@EnablePartitionRequest的代理函数，分析其携带的查询请求的数据长度是否超过预设阈值，若超过，则生成告警提示，同时，拦截组件将查询请求返回代理API，由代理API执行对应的代理函数将查询请求发送到查询接口；若不超过，则拦截组件将查询请求返回代理API，由代理API执行对应的代理函数将查询请求发送到查询接口。作为本实施例的具体实现，通过注解@ThresholdOfArrayLength定义预设阈值的大小，注解@ThresholdOfArrayLength添加到代理函数上。图2为本实施例的一种调用查询接口的请求方法的应用在设备授权查询的时序图；查询请求的分片处理以及分段查询的过程可参考图2所示。步骤3：查询接口返回查询结果。具体来说，查询接口返回查询结果的情况如下：查询接口将查询结果返回到代理API，由代理API将查询结果返回到服务端；而对应查询请求段的查询结果，则由代理API将其返回到拦截组件，由拦截组件对查询结果进行汇总并将汇总后的查询结果返回到代理API，再由代理API将查询结果返回服务端。在实际应用中，将本实施例所述的一种调用查询接口的请求方法应用在服务端调用查询接口领域中，若服务端的多个调用单元调用的是同一个查询接口，即发送的是同一个查询请求，则多个调用单元均将查询请求发送给代理API，由代理API执行同一个代理函数将该查询请求发送到查询接口，再将查询接口返回的查询结果分别返回到多个调用单元，即，多个调用单元均无需执行调用查询接口的方法，简化了处理逻辑；在本实施例中，还包括一拦截组件，拦截组件用于拦截代理函数，若多个调用单元发送的是同一个查询请求，且该查询请求数据长度大于预设阈值，则由拦截组件对携带该查询请求的代理函数进行拦截并对查询请求进行分片处理，使得查询请求形成查询请求段，再通过查询请求段实现分段查询，即，多个调用单元均无需对查询请求进行分片处理，进一步简化了处理逻辑。图3是本实施例的一种调用查询接口的请求系统的代理函数未被拦截时的应用示意图；图4是本实施例的一种调用查询接口的请求系统的代理函数被拦截时的应用示意图；图5是本实施例的一种调用查询接口的请求系统的代理函数未被拦截时的结构示意图；图6是本实施例的一种调用查询接口的请求系统的代理函数被拦截时的结构示意图；参照图3至图6所示，本实施例还公开了一种调用查询接口的请求系统，包括：服务端1、代理API组件2、拦截组件3以及查询接口端4；其中，服务端1包括多个调用单元，所述调用单元包括：第一查询请求发送模块11：用于将查询请求发送到代理API组件；第一查询结果接收模块12：用于接收返回的查询结果；代理API组件2包括：第一查询请求接收模块21：用于接收查询请求或查询请求段；代理函数储存模块22：用于储存代理函数，一个代理函数对应一个外部服务的接口API；第二查询请求发送模块23：用于执行所述代理函数将查询请求或查询请求段发送到查询接口；第二查询结果接收模块24：用于接收返回的查询结果；第一查询结果发送模块25：用于将查询结果发送到服务端或拦截组件；拦截组件3包括：代理函数拦截模块31：用于拦截带有自定义标识的代理API组件的代理函数；查询请求分析模块32：用于分析查询请求的数据长度是否超过预设阈值；查询请求分片模块33：用于对带有注解@EnablePartitionRequest的代理函数携带的数据长度超过预设阈值的查询请求进行分片处理以形成查询请求段；第三查询请求发送模块34：用于将查询请求或查询请求段返回代理API；第三查询结果接收模块35：用于接收代理API返回来的查询结果，查询结果对应查询请求段；查询结果段汇总模块36：用于汇总对应查询请求段的查询结果；第二查询结果发送模块37：用于将汇总后的查询结果返回给代理API；告警提示生成模块38：用于生成告警提示，告警提示基于没有注解@EnablePartitionRequest的代理函数所携带的查询请求的数据长度生成；查询接口端4包括：第二查询请求接收模块41：用于接收查询请求或查询请求段；查询结果储存模块42：用于储存与查询请求或查询请求段对应的信息，该信息记为查询结果；第三查询结果发送模块43：用于将查询结果发送给代理API组件。在实际应用中，参照图3所示，服务端1将查询请求发送给代理API组件2，由代理API组件2执行对应的代理函数将查询请求发送到查询接口端4，由查询接口端4将查询结果返回到代理API组件2，再由代理API组件2将查询结果返回到服务端1；或，参照图4所示，在代理API组件2调用对应的代理函数将查询请求发送到查询接口端4时，由拦截组件3拦截代理函数，并分析代理函数所携带的查询请求的数据长度是否超过预设阈值，若查询请求的数据长度超过预设阈值，则对查询请求进行分片处理以形成查询请求段，拦截组件3再将查询请求段返回所述代理API组件2，由代理API组件2执行对应的代理函数将查询请求段逐一发送到查询接口端4，查询接口端4将多个查询结果逐一返回到代理API组件2，由代理API组件2将查询结果逐一返回到拦截组件3，再由拦截组件3将查询结果汇总并将汇总后的查询结果返回到代理API组件2，最后由代理API组件2将查询结果返回服务端1；若查询请求的数据长度小于或等于预设阈值、或查询请求的数据长度大于预设阈值但该查询请求无需分片处理，则拦截组件3将查询请求返回所述代理API组件2，由代理API组件执行对应的代理函数将查询请求发送到查询接口端4，查询接口端4将查询结果返回到代理API组件2，再由代理API组件2将查询结果返回到服务端1；其中，当查询请求的数据长度大于预设阈值但该查询请求无需分片处理时，拦截组件3生成告警提示。具体来说，通过本实施例所述一种调用查询接口的请求系统，服务端1的多个调用单元在调用同一个查询接口时，只需要由代理API执行对应查询接口的代理函数，无需每个调用单元都执行代理函数，简化处理逻辑；同时，本系统还可以对查询请求做分片处理以及分片查询，可避免出现因查询请求数据长度过大造成的请求失败的情况；拦截组件2的设置可对数据长度过大的查询请求进行分片处理，若服务端1的多个调用单元在调用同一个查询接口时，若其查询请求数据长度过大，则由拦截组件2进行分片处理，无需每个调用单元都对查询请求进行分片处理，可进一步简化处理逻辑。尽管已经示出和描述了本发明的实施方式，本领域的普通技术人员可以理解：在不脱离本发明的原理和宗旨的情况下可以对这些实施方式进行多种变化、修改、替换和变型，本发明的范围由权利要求及其等同物限定。
