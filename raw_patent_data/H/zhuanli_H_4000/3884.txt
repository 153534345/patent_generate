标题title
一种静态资源双重防盗链的方法及系统
摘要abst
本发明提供了一种静态资源双重防盗链的方法，所述方法包括以下步骤：步骤S1、生成唯一的资源id，生成域名校验码、日期码和地址校验码，根据url统一资源定位符的规则组成资源url统一资源定位符；步骤S2、当资源url统一资源定位符被访问时，判断请求头head中来源属性Referer域名是否在域名白名单集合中，是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致；否，则返回错误；步骤S3、判断资源url统一资源定位符中的日期码是否合法，是，则判断资源url统一资源定位符的地址校验码是否合法，否，则返回错误；从而实现根据请求头的来源来拦截非法的资源访问，并根据url统一资源定位符的预设参数进行合法性校验，起到了双重防盗链的作用。
权利要求书clms
1.一种静态资源双重防盗链的方法，其特征在于，所述方法包括以下步骤：步骤S1、生成唯一的资源id，生成域名校验码、日期码和地址校验码，根据url统一资源定位符的规则组成资源url统一资源定位符；步骤S2、当资源url统一资源定位符被访问时，判断请求头head中来源属性Referer域名是否在域名白名单集合中，是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致；否，则返回错误；步骤S3、判断资源url统一资源定位符中的日期码是否合法，是，则判断资源url统一资源定位符的地址校验码是否合法，否，则返回错误；从而实现根据请求头的来源来拦截非法的资源访问，并根据url统一资源定位符的预设参数进行合法性校验，起到了双重防盗链的作用。2.根据权利要求1所述的一种静态资源双重防盗链的方法，其特征在于：所述步骤S1进一步具体为：首先为上传的资源文件生成唯一的资源id，生成规则为文件名加上当前时间戳再加上固定密钥，三者相加进行md5函数得到摘要字符串，取摘要字符串的前6位作为资源id，并且判断资源id是否已经存在，是，则重新生成，直到资源id是唯一的，否，则生成完成；其次生成域名校验码，根据本资源应该被访问的域名加上固定密钥进行md5函数得到摘要字符串，取摘要字符串的前6位作为域名校验码；所述日期码为获取当日日期加上固定密钥进行md5函数后取前5位作为日期码；所述地址校验码为拼接资源id加域名校验码加日期码再加上固定密钥进行md5函数得到字符串，根据url统一资源定位符的规则得到url统一资源定位符。3.根据权利要求1所述的一种静态资源双重防盗链的方法，其特征在于：所述步骤S2进一步具体为：静态资源url统一资源定位符被访问时，获取请求头head的来源属性Referer域名，得到Referer域名，判断Referer域名是否在整个资源站的域名白名单中，然后判断请求头head中来源属性Referer域名是否在域名白名单集合中，否，则返回错误；是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致，是，则合法，否，则返回错误。4.根据权利要求1所述的一种静态资源双重防盗链的方法，其特征在于：所述步骤S3进一步具体为：根据当前日期，加上固定密钥进行md5函数得到前6位，判断资源url统一资源定位符的第3个参数是否等于前6位，是，则表示地址的日期码合法，否，则返回错误；获取资源url统一资源定位符的第2、3、4位参数，进行拼接，加上固定密钥进行md5函数得到摘要字符串，判断摘要字符串是否等于资源url统一资源定位符的第一个参数，是，则表示地址校验码合法，否，则返回错误。5.一种静态资源双重防盗链的系统，其特征在于：包括生成模块、访问模块和判断合法模块，所述生成模块，即生成唯一的资源id，生成域名校验码、日期码和地址校验码，根据url统一资源定位符的规则组成资源url统一资源定位符；所述访问模块，即当资源url统一资源定位符被访问时，判断请求头head中来源属性Referer域名是否在域名白名单集合中，是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致；否，则返回错误；所述判断合法模块，即判断资源url统一资源定位符中的日期码是否合法，是，则判断资源url统一资源定位符的地址校验码是否合法，否，则返回错误；从而实现根据请求头的来源来拦截非法的资源访问，并根据url统一资源定位符的预设参数进行合法性校验，起到了双重防盗链的作用。6.根据权利要求5所述的一种静态资源双重防盗链的系统，其特征在于：所述生成模块进一步具体为：首先为上传的资源文件生成唯一的资源id，生成规则为文件名加上当前时间戳再加上固定密钥，三者相加进行md5函数得到摘要字符串，取摘要字符串的前6位作为资源id，并且判断资源id是否已经存在，是，则重新生成，直到资源id是唯一的，否，则生成完成；其次生成域名校验码，根据本资源应该被访问的域名加上固定密钥进行md5函数得到摘要字符串，取摘要字符串的前6位作为域名校验码；所述日期码为获取当日日期加上固定密钥进行md5函数后取前5位作为日期码；所述地址校验码为拼接资源id加域名校验码加日期码再加上固定密钥进行md5函数得到字符串，根据url统一资源定位符的规则得到url统一资源定位符。7.根据权利要求5所述的一种静态资源双重防盗链的系统，其特征在于：所述访问模块进一步具体为：静态资源url统一资源定位符被访问时，获取请求头head的来源属性Referer域名，得到Referer域名，判断Referer域名是否在整个资源站的域名白名单中，然后判断请求头head中来源属性Referer域名是否在域名白名单集合中，否，则返回错误；是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致，是，则合法，否，则返回错误。8.根据权利要求5所述的一种静态资源双重防盗链的系统，其特征在于：所述判断合法模块进一步具体为：根据当前日期，加上固定密钥进行md5函数得到前6位，判断资源url统一资源定位符的第3个参数是否等于前6位，是，则表示地址的日期码合法，否，则返回错误；获取资源url统一资源定位符的第2、3、4位参数，进行拼接，加上固定密钥进行md5函数得到摘要字符串，判断摘要字符串是否等于资源url统一资源定位符的第一个参数，是，则表示地址校验码合法，否，则返回错误。
说明书desc
技术领域本发明涉及计算机技术领域，特别是一种静态资源双重防盗链的方法及系统。背景技术在以图片、文件等静态资源为主要内容的系统中，常被第三方恶意爬取静态资源地址为他们所用，所以静态资源的防盗链就显得尤为重要。传统的防盗链可能只是简单利用请求头中的Referer属性来判断是否为本域名下请求行为，这种防御手段只能起到基本的防盗链功能，如果第三方恶意模拟了Referer，也就破解了，并且也无法满足多域名下静态资源的使用权限问题。发明内容为克服上述问题，本发明的目的是提供一种能够实现据请求头的来源来拦截非法的资源访问，并根据url统一资源定位符的预设参数进行合法性校验，起到了双重防盗链作用的方法。本发明采用以下方案实现：一种静态资源双重防盗链的方法，所述方法包括以下步骤：步骤S1、生成唯一的资源id，生成域名校验码、日期码和地址校验码，根据url统一资源定位符的规则组成资源url统一资源定位符；步骤S2、当资源url统一资源定位符被访问时，判断请求头head中来源属性Referer域名是否在域名白名单集合中，是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致；否，则返回错误；步骤S3、判断资源url统一资源定位符中的日期码是否合法，是，则判断资源url统一资源定位符的地址校验码是否合法，否，则返回错误；从而实现根据请求头的来源来拦截非法的资源访问，并根据url统一资源定位符的预设参数进行合法性校验，起到了双重防盗链的作用。进一步的，所述步骤S1进一步具体为：首先为上传的资源文件生成唯一的资源id，生成规则为文件名加上当前时间戳再加上固定密钥，三者相加进行md5函数得到摘要字符串，取摘要字符串的前6位作为资源id，并且判断资源id是否已经存在，是，则重新生成，直到资源id是唯一的，否，则生成完成；其次生成域名校验码，根据本资源应该被访问的域名加上固定密钥进行md5函数得到摘要字符串，取摘要字符串的前6位作为域名校验码；所述日期码为获取当日日期加上固定密钥进行md5函数后取前5位作为日期码；所述地址校验码为拼接资源id加域名校验码加日期码再加上固定密钥进行md5函数得到字符串，根据url统一资源定位符的规则得到url统一资源定位符。进一步的，所述步骤S2进一步具体为：静态资源url统一资源定位符被访问时，获取请求头head的来源属性Referer域名，得到Referer域名，判断Referer域名是否在整个资源站的域名白名单中，然后判断请求头head中来源属性Referer域名是否在域名白名单集合中，否，则返回错误；是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致，是，则合法，否，则返回错误。进一步的，所述步骤S3进一步具体为：根据当前日期，加上固定密钥进行md5函数得到前6位，判断资源url统一资源定位符的第3个参数是否等于前6位，是，则表示地址的日期码合法，否，则返回错误；获取资源url统一资源定位符的第2、3、4位参数，进行拼接，加上固定密钥进行md5函数得到摘要字符串，判断摘要字符串是否等于资源url统一资源定位符的第一个参数，是，则表示地址校验码合法，否，则返回错误。本发明还提供了一种静态资源双重防盗链的系统，包括生成模块、访问模块和判断合法模块，所述生成模块，即生成唯一的资源id，生成域名校验码、日期码和地址校验码，根据url统一资源定位符的规则组成资源url统一资源定位符；所述访问模块，即当资源url统一资源定位符被访问时，判断请求头head中来源属性Referer域名是否在域名白名单集合中，是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致；否，则返回错误；所述判断合法模块，即判断资源url统一资源定位符中的日期码是否合法，是，则判断资源url统一资源定位符的地址校验码是否合法，否，则返回错误；从而实现根据请求头的来源来拦截非法的资源访问，并根据url统一资源定位符的预设参数进行合法性校验，起到了双重防盗链的作用。进一步的，所述生成模块进一步具体为：首先为上传的资源文件生成唯一的资源id，生成规则为文件名加上当前时间戳再加上固定密钥，三者相加进行md5函数得到摘要字符串，取摘要字符串的前6位作为资源id，并且判断资源id是否已经存在，是，则重新生成，直到资源id是唯一的，否，则生成完成；其次生成域名校验码，根据本资源应该被访问的域名加上固定密钥进行md5函数得到摘要字符串，取摘要字符串的前6位作为域名校验码；所述日期码为获取当日日期加上固定密钥进行md5函数后取前5位作为日期码；所述地址校验码为拼接资源id加域名校验码加日期码再加上固定密钥进行md5函数得到字符串，根据url统一资源定位符的规则得到url统一资源定位符。进一步的，所述访问模块进一步具体为：静态资源url统一资源定位符被访问时，获取请求头head的来源属性Referer域名，得到Referer域名，判断Referer域名是否在整个资源站的域名白名单中，然后判断请求头head中来源属性Referer域名是否在域名白名单集合中，否，则返回错误；是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致，是，则合法，否，则返回错误。进一步的，所述判断合法模块进一步具体为：根据当前日期，加上固定密钥进行md5函数得到前6位，判断资源url统一资源定位符的第3个参数是否等于前6位，是，则表示地址的日期码合法，否，则返回错误；获取资源url统一资源定位符的第2、3、4位参数，进行拼接，加上固定密钥进行md5函数得到摘要字符串，判断摘要字符串是否等于资源url统一资源定位符的第一个参数，是，则表示地址校验码合法，否，则返回错误。本发明的有益效果在于：本发明不仅能够根据请求头的来源来拦截非法的资源访问，还可以进一步根据url统一资源定位符固定位的预设参数来对资源访问的来源、时间等进行进一步的合法性校验，起到了双重防盗链的作用。附图说明图1是本发明的方法流程示意图。图2是本发明的系统原理框图。具体实施方式下面结合附图对本发明做进一步说明。请参阅图1所示，本发明的一种静态资源双重防盗链的方法，所述方法包括以下步骤：步骤S1、生成唯一的资源id，生成域名校验码、日期码和地址校验码，根据url统一资源定位符的规则组成资源url统一资源定位符；步骤S2、当资源url统一资源定位符被访问时，判断请求头head中来源属性Referer域名是否在域名白名单集合中，是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致；否，则返回错误；步骤S3、判断资源url统一资源定位符中的日期码是否合法，是，则判断资源url统一资源定位符的地址校验码是否合法，否，则返回错误；从而实现根据请求头的来源来拦截非法的资源访问，并根据url统一资源定位符的预设参数进行合法性校验，起到了双重防盗链的作用。下面通过一具体实施例对本发明作进一步说明：步骤一、生成唯一的资源id，生成域名校验码，生成日期码，生成地址校验码，根据url规则https://resource.com/{地址校验码}/{今日时间码}/{域名校验码}/{资源id}，组成资源url统一资源定位符。首先为上传的资源文件生成一个唯一的资源id，生成规则为文件名+当前时间戳+固定密钥，三者相加进行md5得到一个32位的摘要字符串，取摘要字符串的前6位作为资源id，并且判断资源id是否已经存在，如果存在则重新生成，直到资源id是唯一的。其次生成域名校验码，根据本资源应该被访问的域名为例，例如该资源仅允许被www.91.com访问，那么www.91.com+固定密钥进行md5函数得到一个32位的摘要字符串，取前6位作为域名校验码，由于域名的数量非常有限，白名单域名最多就是几十上百个，所以域名校验码重复的概率非常之地低，所以取前6位即可。接着生成今日的日期码，获取今日的日期＝2022-05-08，加上固定密钥，进行md5函数后取前5位作为日期校验码。日期码是每次访问静态资源之前都会重新生成的，目的是防止静态资源地址被无限期的使用，仅允许2022-05-08那天访问。最后拼接资源id+域名校验码+日期码+固定密钥，进行md5函数得到一个16位字符串，根据url规则https://resource.com/{地址校验码}/{今日时间码}/{域名校验码}/{资源id}得到url，举例url＝https://resource.com/6eed85693ef46b2d/4833ce/82abbe/cf9771。步骤二、资源被访问时，判断请求头head中来源属性Referer是否在域名白名单集合之中，如果不是则返回404，如果是则判断url中的域名校验码是否和Referer的域名一致，如果不一致则返回404，一致则合法；域名白名单集合是根据自己公司的域名来定义白名单的，例如https://resource.com这个资源站，例如公司需要使用资源站：xx1.gongsi.com、xx2.gongsi.com，那么白名单就是xx1.gongsi.com和xx2.gongsi.com。静态资源被访问时，获取请求头head中的来源属性Referer，举例得到Referer＝https://www.91.com/index，得到Referer域名＝www.91.com，判断Referer域名是否在整个资源站的域名白名单中，整个资源站的白名单维护的是所有允许能够访问资源站的一个基础过滤。接着判断url地址的第3个参数82abbe是否等于来源属性Referer的域名+固定密钥进行md5后的前6位，如果md5的前5位等于第3个参数82abbe则表示合法，不相等则表示非法请求，返回404。步骤三、判断url中的日期码是否合法，不合法返回404，合法则判断url中的地址校验码是否合法，不合法返回404，合法则返回静态资源。根据当前日期2022-05-08，加上固定密钥进行md5函数得到前6位＝82abbe，判断url的第3个参数是否等于82abbe，如果相等则表示地址的时间码合法。获取url的第2，3，4位的参数，进行拼接4833ce+82abbe+cf9771，加上固定密钥进行md5函数得到16位的摘要字符串，判断是否等于url的第1个参数6eed85693ef46b2d，如果相等，则表示地址合法，则根据url的第4个参数资源id cf9771读取实际的文件资源，返回给用户。请参阅图2所示，本发明还提供了一种静态资源双重防盗链的系统，包括生成模块、访问模块和判断合法模块，所述生成模块，即生成唯一的资源id，生成域名校验码、日期码和地址校验码，根据url统一资源定位符的规则组成资源url统一资源定位符；所述访问模块，即当资源url统一资源定位符被访问时，判断请求头head中来源属性Referer域名是否在域名白名单集合中，是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致；否，则返回错误；所述判断合法模块，即判断资源url统一资源定位符中的日期码是否合法，是，则判断资源url统一资源定位符的地址校验码是否合法，否，则返回错误；从而实现根据请求头的来源来拦截非法的资源访问，并根据url统一资源定位符的预设参数进行合法性校验，起到了双重防盗链的作用。所述生成模块进一步具体为：首先为上传的资源文件生成唯一的资源id，生成规则为文件名加上当前时间戳再加上固定密钥，三者相加进行md5函数得到摘要字符串，取摘要字符串的前6位作为资源id，并且判断资源id是否已经存在，是，则重新生成，直到资源id是唯一的，否，则生成完成；其次生成域名校验码，根据本资源应该被访问的域名加上固定密钥进行md5函数得到摘要字符串，取摘要字符串的前6位作为域名校验码；所述日期码为获取当日日期加上固定密钥进行md5函数后取前5位作为日期码；所述地址校验码为拼接资源id加域名校验码加日期码再加上固定密钥进行md5函数得到字符串，根据url统一资源定位符的规则得到url统一资源定位符。所述访问模块进一步具体为：静态资源url统一资源定位符被访问时，获取请求头head的来源属性Referer域名，得到Referer域名，判断Referer域名是否在整个资源站的域名白名单中，然后判断请求头head中来源属性Referer域名是否在域名白名单集合中，否，则返回错误；是，则判断资源url统一资源定位符中的域名校验码是否和来源属性Referer域名的域名一致，是，则合法，否，则返回错误。所述判断合法模块进一步具体为：根据当前日期，加上固定密钥进行md5函数得到前6位，判断资源url统一资源定位符的第3个参数是否等于前6位，是，则表示地址的日期码合法，否，则返回错误；获取资源url统一资源定位符的第2、3、4位参数，进行拼接，加上固定密钥进行md5函数得到摘要字符串，判断摘要字符串是否等于资源url统一资源定位符的第一个参数，是，则表示地址校验码合法，否，则返回错误。以上所述仅为本发明的较佳实施例，凡依本发明申请专利范围所做的均等变化与修饰，皆应属本发明的涵盖范围。
