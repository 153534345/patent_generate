标题title
卡模拟方法、NFC芯片及电子设备
摘要abst
本申请实施例提供一种卡模拟方法、NFC芯片及电子设备，涉及NFC领域，该方法包括：选取多套硬件特征参数中的一套硬件特征参数作为第一硬件特征参数；若NFC芯片配置第一硬件特征参数后，与第二电子设备通信失败，则将第一硬件特征参数切换为第二硬件特征参数，并根据第二硬件特征参数与第二电子设备再次进行通信。本申请实施例提供的方法，有助于工作在CE模式下的NFC设备兼容不同的读卡设备，从而可以提高工作在CE模式下的NFC设备的稳定性和兼容性。
权利要求书clms
1.一种卡模拟方法，其特征在于，应用于第一电子设备，所述第一电子设备具有近场通信NFC芯片，所述NFC芯片工作在卡模拟CE模式，所述第一电子设备预设多套硬件特征参数，所述方法包括：选取所述多套硬件特征参数中的一套硬件特征参数作为第一硬件特征参数；若所述NFC芯片配置所述第一硬件特征参数后，与第二电子设备通信失败，则将所述第一硬件特征参数切换为第二硬件特征参数，并根据所述第二硬件特征参数与所述第二电子设备再次进行通信。2.根据权利要求1所述的方法，其特征在于，所述多套硬件特征参数中的每套硬件特征参数与NFC模式、NFC技术及比特率的组合具有映射关系。3.根据权利要求2所述的方法，其特征在于，所述第一硬件特征参数与所述第二硬件特征参数对应的NFC技术和/或比特率不同。4.根据权利要求2所述的方法，其特征在于，所述第一硬件特征参数与所述第二硬件特征参数对应的NFC技术和比特率相同，参数值不同。5.根据权利要求4所述的方法，其特征在于，所述第一硬件特征参数由兼容性和/或覆盖率确定。6.根据权利要求1所述的方法，其特征在于，所述若所述NFC芯片配置所述第一硬件特征参数后，与第二电子设备通信失败，则将所述第一硬件特征参数切换为第二硬件特征参数包括：当定时器超时后，若所述NFC芯片配置所述第一硬件特征参数后，与第二电子设备通信失败，则将所述第一硬件特征参数切换为第二硬件特征参数，所述定时器在检测到外部存在所述第二电子设备的情况下启动。7.根据权利要求1所述的方法，其特征在于，所述若所述NFC芯片配置所述第一硬件特征参数后，与第二电子设备通信失败，则将所述第一硬件特征参数切换为第二硬件特征参数包括：响应于检测到的外部电磁场的快速减弱，将所述第一硬件特征参数切换为第二硬件特征参数。8.根据权利要求1-7任一项所述的方法，其特征在于，所述将所述第一硬件特征参数切换为第二硬件特征参数之前，所述方法还包括：使所述NFC芯片进入休眠；所述将所述第一硬件特征参数切换为第二硬件特征参数包括：当休眠结束后，唤醒所述NFC芯片，并将所述第一硬件特征参数切换为第二硬件特征参数。9.一种卡模拟方法，其特征在于，应用于第一电子设备，所述第一电子设备具有近场通信NFC芯片，所述NFC芯片工作在卡模拟CE模式，所述第一电子设备预设多套硬件特征参数，所述方法包括：在所述多套硬件特征参数中选取一套硬件特征参数作为第一硬件特征参数，并使用所述第一硬件特征参数对外部电磁场进行硬件检测；若所述第一硬件特征参数与所述外部电磁场适配，将所述NFC芯片配置为所述第一硬件特征参数，以使得所述第一电子设备基于所述第一硬件特征参数与第二电子设备进行通信；若所述第一硬件特征参数与所述外部电磁场不适配，将所述第一硬件特征参数切换为第二硬件特征参数，并使用所述第二硬件特征参数对外部电磁场再次进行硬件检测。10.一种NFC芯片，其特征在于，应用于第一电子设备，所述NFC芯片工作在卡模拟CE模式，所述第一电子设备预设多套硬件特征参数，所述NFC芯片包括：选取模块，用于选取所述多套硬件特征参数中的一套硬件特征参数作为第一硬件特征参数；通信模块，用于若所述NFC芯片配置所述第一硬件特征参数后，与第二电子设备通信失败，则将所述第一硬件特征参数切换为第二硬件特征参数，并根据所述第二硬件特征参数与所述第二电子设备再次进行通信。11.一种NFC芯片，其特征在于，应用于第一电子设备，所述NFC芯片工作在卡模拟CE模式，所述第一电子设备预设多套硬件特征参数，所述NFC芯片包括：检测模块，用于在所述多套硬件特征参数中选取一套硬件特征参数作为第一硬件特征参数，并使用所述第一硬件特征参数对外部电磁场进行硬件检测；通信模块，用于若所述第一硬件特征参数与所述外部电磁场适配，将所述NFC芯片配置为所述第一硬件特征参数，以使得所述第一电子设备基于所述第一硬件特征参数与第二电子设备进行通信；切换模块，用于若所述第一硬件特征参数与所述外部电磁场不适配，将所述第一硬件特征参数切换为第二硬件特征参数，并使用所述第二硬件特征参数对外部电磁场再次进行硬件检测。12.一种电子设备，其特征在于，包括：处理器和存储器，所述存储器用于存储计算机程序；所述处理器用于运行计算机程序，执行如权利要求1-8任一项所述的卡模拟方法，或执行如权利要求9所述的卡模拟方法。
说明书desc
技术领域本申请实施例涉及NFC领域，尤其涉及一种卡模拟方法、NFC芯片及电子设备。背景技术近场通信作为一种通信技术，已经在人们的生活中被大量使用。其中，NFC设备的工作模式主要包括两种，卡模拟模式及读卡模式。可以理解的是，NFC设备是具有NFC芯片的电子设备，当NFC设备处于CE模式下，该处于CE模式下的NFC设备具有卡模拟功能，此时，处于CE模式下的NFC设备可以模拟为一张NFC芯片卡，例如，门禁卡、交通卡、银行卡等，用于被读卡设备进行读写。而当NFC设备处于RW模式下，该处于RW模式下的NFC设备可以主动发射射频信号去识别和读写其他处于CE模式下的NFC设备，此时，处于RW模式下的NFC设备可以认为是一个NFC读卡器，如同POS机、门禁、闸机等。工作在CE模式下的不同的NFC设备可以配置不同的芯片卡硬件特征参数，硬件特征参数影响了NFC指令交互的成功率。通常，工作在CE模式下的NFC设备会预先配置一种芯片卡硬件特征参数。因此，工作在CE模式下的NFC设备难以兼容不同的读卡设备，其中，读卡设备可以包括上述工作在RW模式下的NFC设备，也可以包括普通的射频识别设备，由此会出现工作在CE模式下的NFC设备与读卡设备通信失败的情况，例如，门禁打不开，POS扣款失败等。发明内容本申请实施例提供了一种卡模拟方法、NFC芯片及电子设备，有助于工作在CE模式下的NFC设备兼容不同的读卡设备，从而可以提高工作在CE模式下的NFC设备的稳定性和兼容性。第一方面，本申请实施例提供了一种卡模拟方法，应用于第一电子设备，该第一电子设备具有NFC芯片，该NFC芯片工作在CE模式，该第一电子设备预设多套硬件特征参数，包括：选取多套硬件特征参数中的一套硬件特征参数作为第一硬件特征参数；若NFC芯片配置第一硬件特征参数后，与第二电子设备通信失败，则将第一硬件特征参数切换为第二硬件特征参数，并根据第二硬件特征参数与第二电子设备再次进行通信。本申请实施例中，通过在工作在CE模式下的NFC设备中预设多套硬件特征参数，在使用硬件特征参数与读卡设备通信失败后，切换硬件特征参数并再次进行通信，由此可以有助于工作在CE模式下的NFC设备兼容不同的读卡设备，从而可以提高工作在CE模式下的NFC设备的稳定性和兼容性。其中一种可能的实现方式中，多套硬件特征参数中的每套硬件特征参数与NFC模式、NFC技术及比特率的组合具有映射关系。本申请实施例中，通过将不同的硬件特征参数与NFC模式、NFC技术及比特率的组合进行映射，可以使得第一电子设备较快的根据NFC模式、NFC技术及比特率的组合选取硬件特征参数，由此可以提高通信的效率。其中一种可能的实现方式中，第一硬件特征参数与第二硬件特征参数对应的NFC技术和/或比特率不同。本申请实施例可以实现在对应不同NFC技术和/或比特率的硬件特征参数之间进行切换。其中一种可能的实现方式中，第一硬件特征参数与第二硬件特征参数对应的NFC技术和比特率相同，参数值不同。本申请实施例可以实现在对应相同NFC技术及相同比特率的硬件特征参数内进行切换。其中一种可能的实现方式中，第一硬件特征参数由兼容性和/或覆盖率确定。本申请实施例中，通过兼容性和/或覆盖率选取第一硬件特征参数，优先选取对于读卡设备具较高有兼容性和/或覆盖率的硬件特征参数，可以提高通信的成功率。其中一种可能的实现方式中，若NFC芯片配置第一硬件特征参数后，与第二电子设备通信失败，则将第一硬件特征参数切换为第二硬件特征参数包括：当定时器超时后，若NFC芯片配置第一硬件特征参数后，与第二电子设备通信失败，则将第一硬件特征参数切换为第二硬件特征参数，定时器在检测到外部存在第二电子设备的情况下启动。本申请实施例中，通过定时器触发硬件特征参数的切换，由此可以避免通信失败后的长时间的等待，从而可以尽快的进入休眠，以节省功耗。其中一种可能的实现方式中，若NFC芯片配置第一硬件特征参数后，与第二电子设备通信失败，则将第一硬件特征参数切换为第二硬件特征参数包括：响应于检测到的外部电磁场的快速减弱，将第一硬件特征参数切换为第二硬件特征参数。本申请实施例中，通过检测外部电磁场的强度触发硬件特征参数的切换，由此可以在通信失败后尽快发起再次通信，从而可以提高通信效率。其中一种可能的实现方式中，将第一硬件特征参数切换为第二硬件特征参数之前，上述方法还包括：使NFC芯片进入休眠；将第一硬件特征参数切换为第二硬件特征参数包括：当休眠结束后，唤醒NFC芯片，并将第一硬件特征参数切换为第二硬件特征参数。本申请实施例中，在硬件特征参数进行切换前，将NFC芯片进行休眠态，可以降低整个NFC系统的功耗。第二方面，本申请实施例还提供了一种卡模拟方法，应用于第一电子设备，该第一电子设备具有NFC芯片，该NFC芯片工作在CE模式，该第一电子设备预设多套硬件特征参数，包括：在多套硬件特征参数中选取一套硬件特征参数作为第一硬件特征参数，并使用第一硬件特征参数对外部电磁场进行硬件检测；若第一硬件特征参数与外部电磁场适配，将所述NFC芯片配置为第一硬件特征参数，以使得第一电子设备基于第一硬件特征参数与第二电子设备进行通信；若第一硬件特征参数与外部电磁场不适配，将第一硬件特征参数切换为第二硬件特征参数，并使用第二硬件特征参数对外部电磁场再次进行硬件检测。本申请实施例中，在一个TD内通过硬件检测手段使用硬件特征参数进行适配，并在适配后根据适配的硬件特征参数进行软件配置，由此可以避免软件运行时因硬件特征参数在多个TD内的切换引起的硬件特征参数的多次配置导致的效率降低，从而可以提高通信的效率。第三方面，本申请实施例提供了一种NFC芯片，包括：选取模块和通信模块，该选取模块和通信模块用于执行第一方面提供的任意一种的卡模拟方法。第四方面，本申请实施例还提供了一种NFC芯片，包括：检测模块、通信模块和切换模块，该检测模块、通信模块和切换模块用于执行第二方面提供的任意一种的卡模拟方法。第五方面，本申请实施例提供了一种电子设备，包括：处理器和存储器，存储器用于存储计算机程序；处理器用于运行计算机程序，执行如第一方面和第二方面所述的卡模拟方法。第六方面，本申请实施例提供了一种计算机可读存储介质，该计算机可读存储介质中存储有计算机程序，当其在计算机上运行时，使得计算机实现如第一方面和第二方面所述的卡模拟方法。附图说明图1为本申请提供的卡模拟方法一个实施例的流程示意图；图2为本申请实施例提供的一个TD的示意图；图3为本申请实施例提供的TD间硬件特征参数切换的示意图；图4为本申请提供的卡模拟方法另一个实施例的流程示意图；图5a-图5c为本申请实施例提供的硬件检测场景下的TD示意图；图6为本申请提供的NFC芯片一个实施例的结构示意图；图7为本申请提供的NFC芯片另一个实施例的结构示意图；图8为本申请实施例提供的电子设备的硬件结构示意图。具体实施方式本申请实施例中，除非另有说明，字符“/”表示前后关联对象是一种或的关系。例如，A/B可以表示A或B。“和/或”描述关联对象的关联关系，表示可以存在三种关系。例如，A和/或B，可以表示：单独存在A，同时存在A和B，单独存在B这三种情况。需要指出的是，本申请实施例中涉及的“第一”、“第二”等词汇，仅用于区分描述目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量，也不能理解为指示或暗示顺序。本申请实施例中，“至少一个”是指一个或者多个，“多个”是指两个或两个以上。此外，“以下至少一项”或者其类似表达，是指的这些项中的任意组合，可以包括单项或复数项的任意组合。例如，A、B或C中的至少一项，可以表示：A，B，C，A和B，A和C，B和C，或A、B和C。其中，A、B、C中的每个本身可以是元素，也可以是包含一个或多个元素的集合。本申请实施例中，“示例的”、“在一些实施例中”、“在另一实施例中”等用于表示作例子、例证或说明。本申请中被描述为“示例”的任何实施例或设计方案不应被解释为比其它实施例或设计方案更优选或更具优势。确切而言，使用示例的一词旨在以具体方式呈现概念。本申请实施例中的“的”、“相应的”和“对应的”有时可以混用，应当指出的是，在不强调其区别时，所要表达的含义是一致的。本申请实施例中，通信、传输有时可以混用，应当指出的是，在不强调其区别时，其所表达的含义是一致的。例如，传输可以包括发送和/或接收，可以为名词，也可以是动词。本申请实施例中涉及的等于可以与大于连用，适用于大于时所采用的技术方案，也可以与小于连用，适用于小于时所采用的技术方案。需要说明的是，当等于与大于连用时，不能与小于连用；当等于与小于连用时，不与大于连用。目前，工作在CE模式下的NFC设备具有NFC芯片，该NFC芯片具有卡模拟功能，例如，可以将工作在CE模式下的NFC设备模拟为一张卡片，该NFC芯片可以配置不同的硬件特征参数，用于与读卡设备进行通信。其中，硬件特征参数可以对应不同的NFC技术，例如，A、B、F及V等NFC技术，因此，根据NFC技术进行划分，硬件特征参数通常可以包括：CEA硬件特征参数、CEB硬件特征参数、CEF硬件特征参数及CEV硬件特征参数，也就是说，工作在CE模式下的NFC设备可以预先配置上述CEA硬件特征参数、CEB硬件特征参数、CEF硬件特征参数及CEV硬件特征参数中的任一硬件特征参数进行卡模拟。读卡设备通常也可以预先配置硬件特征参数，其中，读卡设备中的硬件特征参数可以包括：RWA硬件特征参数、RWB硬件特征参数、RWF硬件特征参数及RWV硬件特征参数等。读卡设备可以根据预先预置的硬件特征参数进行寻卡。可以理解的是，硬件特征参数影响了NFC指令交互的成功率。当工作在CE模式下的NFC设备的硬件特征参数与读卡设备的硬件特征参数适配时，可以较好的完成工作在CE模式下的NFC设备与读卡设备之间的通信。然而，在实际应用过程中，由于工作在CE模式下的不同的NFC设备可以预先配置不同NFC技术的硬件特征参数，对于某一个工作在CE模式下的NFC设备来说，其有固定的硬件特征参数，也就是说，配置某一NFC技术的硬件特征参数的工作在CE模式下的NFC设备与某一个读卡设备可以较好的完成通信，而另一个读卡设备会会预先配置不同的硬件特征参数，由此会发生与另一个读卡设备通信失败的情况，从而导致工作在CE模式下的不同的NFC设备难以兼容不同的读卡设备。例如，若工作在CE模式下的NFC设备配置的是CEA硬件特征参数中的其中一套参数值，读卡设备配置的是RWA硬件特征参数中的其中一套参数值。虽然工作在CE模式下的NFC设备与读卡设备采用的技术相同，然而CEA硬件特征参数中选取的参数值与RWA硬件特征参数中选取的参数值不适配，此时，会发生通信失败，也就是说，当前的工作在CE模式下的NFC设备无法兼容当前的读卡设备。基于上述问题，本申请实施例提出了一种卡模拟方法，应用于电子设备，其中，电子设备可以是具有NFC卡模拟功能的终端，例如，手机、平板电脑、可穿戴设备等；本申请实施例对电子设备的形式不作特殊限定。通过本申请实施例的方法，可以有助于工作在CE模式下的NFC设备兼容不同的读卡设备，从而可以提高工作在CE模式下的NFC设备的稳定性和兼容性。现结合图1对本申请实施例提供的卡模拟方法进行说明。如图1所示为本申请提供的卡模拟方法一个实施例的流程示意图，该卡模拟方法应用于第一电子设备，该第一电子设备具有NFC芯片，该NFC芯片工作在CE模式，该第一电子设备预设多套硬件特征参数，具体包括以下步骤：步骤101，选取多套硬件特征参数中的一套硬件特征参数作为第一硬件特征参数。具体地，第一电子设备中可以预先存储多套硬件特征参数，该硬件特征参数可以用于对NFC芯片进行配置，以便NFC芯片基于配置后的硬件特征参数与第二电子设备进行通信。其中，第二电子设备为读卡设备，该第二电子设备可以是工作在RW模式下的NFC设备，也可以是普通的RFID设备，本申请实施例对第二电子设备的具体形式不作特殊限定。上述多套硬件特征参数可以预先存储在NFC芯片中，也可以存储在第一电子设备的存储器或其他硬件电路中，也可以存储在服务器中，以便用户可以远程更新在第一电子设备预设的硬件特征参数。本申请实施例对上述多套硬件特征参数的存储方式不作特殊限定。可以理解的是，在将上述多套硬件特征参数存储在第一电子设备中时，还可以检测第一电子设备的存储空间，若第一电子设备的存储空间足够存储上述多套硬件特征参数，则可以直接将上述多套硬件特征参数存储在第一电子设备中，若第一电子设备的存储空间不足够存储上述多套硬件特征参数，则可以提示用户释放第一电子设备中的部分存储空间，以便存储上述多套硬件特征参数。其中，每套硬件特征参数可以预先与NFC模式、NFC技术及比特率的组合形成映射关系。每套硬件特征参数可以包括M个参数，M为大于或等于1的正整数。其中，NFC模式用于表征NFC芯片的工作模式，示例性的，NFC模式可以包括CE和RW两种模式；NFC技术用于表征NFC芯片所采用的技术，其中，NFC技术可以包括A、B、F和V；比特率用于表征NFC芯片的数据速率。以NFC技术为A、B和F为例，表1示例性的示出了硬件特征参数的组成形式。可以理解的是，上述示例仅示例性的示出了A、B及F等NFC技术，但并不构成对本申请实施例的限定，在一些实施例中，还可以包括更多的NFC技术，例如：V。表1如表1所示，可以包括12套硬件特征参数，其中，包括5套CE-A硬件特征参数、5套CE-B的硬件特征参数及2套CE-F的硬件特征参数。可以理解的是，上述12套硬件特征参数为待选的硬件特征参数，用户可以在上述12套硬件特征参数中选取多套硬件特征参数后，可以将用户选取的多套硬件特征参数预先存储在第一电子设备中。上述12套硬件特征参数仅为示例性说明，并不构成对本申请实施例的限定，在一些实施例中，还可以包括更多或更少的待选硬件特殊参数。参考表1，“ON”用于表征该参数可用，此时，用户可以对该参数预先设置相应的参数值，“OFF”用于表征该参数禁用，此时，用户不可以对该参数预先设置相应的参数值。通过“ON”和“OFF”等标志位，可以在用户对参数进行设置参数值时进行校验，由此可以对硬件特征参数的完整性进行校验，避免硬件特征参数中的某些参数为空值。此外，在用户对参数设置参数值时，还可以对参数值进行取值范围校验，例如，对任一参数的取值范围进行预先设定，若任一参数的参数值超过了预设的预置范围，则可以报错，由此可以对参数值的正确性进行校验，从而可以避免参数值由于人为疏忽导致设置错误。通过不同的NFC模式、NFC技术及比特率的组合与硬件特征参数的映射，可以得到多套不同的硬件特征参数。其中，不同的NFC模式、NFC技术及比特率的组合可以包括例如：NFC技术相同，比特率不同；又例如：比特率相同，NFC技术不同；再例如，比特率不同，NFC技术不同；再例如，NFC技术相同，比特率相同，参数值不同。可以理解的是，上述NFC模式、NFC技术及比特率的组合中，对于第一电子设备来说，NFC模式均为CE模式。表2示例性的示出了用户选取的多套硬件特征参数的组合示意图。表2参考表2，以比特率为106k的CE-B硬件特征参数及比特率为212k的CE-B硬件特征参数为例，比特率为106k的CE-B硬件特征参数及比特率为212k的CE-B硬件特征参数之间NFC技术相同，比特率不同；以比特率为106k的CE-A硬件特征参数及比特率为106k的CE-B硬件特征参数为例，比特率为106k的CE-A硬件特征参数及比特率为106k的CE-B硬件特征参数之间比特率相同，NFC技术不同；以比特率为106k的CE-A硬件特征参数及比特率为212k的CE-B硬件特征参数为例，比特率为106k的CE-A硬件特征参数及比特率为212k的CE-B硬件特征参数之间比特率不同，NFC技术不同；以编号1的比特率为106k的CE-A硬件特征参数及编号2的比特率为106k的CE-A硬件特征参数为例，编号1的比特率为106k的CE-A硬件特征参数及编号2的比特率为106k的CE-A硬件特征参数之间NFC技术相同，比特率相同，参数值不同。其中，参数值不同可以是具有不同的参数，例如，编号1的比特率为106k的CE-A硬件特征参数具有参数1，编号2的比特率为106k的CE-A硬件特征参数不具有参数1；或者，参数值不同也可以是具有相同的参数，但是相同的参数对应的参数值不同，例如，编号1的比特率为106k的CE-A硬件特征参数中的参数2的参数值为a12，而编号2的比特率为106k的CE-A硬件特征参数中的参数2的参数值为a22，其中，a12与a22不同。可以理解的是，NFC芯片在上电或复位后，NFC芯片会处于空闲态，该空闲态可以对应于NFC控制器接口规范中的RFST_IDLE态，具体的RFST_IDLE态的描述可以参考NCI规范，在此不再赘述。在空闲态下，NFC芯片可以认为正处于休眠中，不会与第二电子设备进行通信，由此可以降低第一电子设备中整个NFC系统的功耗。当NFC芯片休眠结束后，可以进入发现态，该发现态可以对应于NCI规范中的RFST_DISCOVERY态。具体的RFST_DISCOVERY态的描述可以参考NCI规范，在此不再赘述。在发现态，第一电子设备可以在预先存储的多套硬件特征参数中选取一套硬件特征参数作为第一硬件特征参数，并可以使用该第一硬件特征参数与第二电子设备进行通信。需要说明的是，该第一硬件特征参数可以是初始选取的硬件特征参数，也就是第一电子设备首次选取的硬件特征参数，也可以是切换后的硬件特征参数。其中，第一硬件特征参数可以在第一电子设备中预先存储的多套硬件特征参数中随机选取。优选地，第一硬件特征参数的具体选取方式还可以例如是：基于兼容性和/或覆盖率确定第一硬件特征参数。其中，兼容性用于表征NFC技术和比特率的兼容市面上第二电子设备的程度，覆盖率用于表征NFC技术和比特率对市面上的第二电子设备的覆盖范围。可以理解的是，若覆盖率越高，说明NFC技术和比特率被较多的第二电子设备覆盖，因此，可以选取该NFC技术和比特率对应的硬件特征参数，由此可以增加通信成功的概率。示例性的，以表2为例，假设编号1的比特率为106k的CE-A硬件特征参数能覆盖市面上70％的第二电子设备，编号2的比特率为106k的CE-A硬件特征参数能覆盖市面上30％的第二电子设备，且A技术的覆盖率高于其他NFC技术，则可以选取编号1的比特率为106k的CE-A硬件特征参数作为第一硬件特征参数。也就是说，上述第一硬件特征参数的兼容性和/或覆盖率大于等于切换后的第二硬件特征参数。通过优先选取对于读卡设备具较高有兼容性和/或覆盖率的硬件特征参数，可以提高通信的成功率，提升通信效率。步骤102，若NFC芯片配置初始硬件特征参数后，与第二电子设备通信失败，则将第一硬件特征参数切换为第二硬件特征参数，并根据第二硬件特征参数与第二电子设备再次进行通信。具体地，当确定第一硬件特征参数后，可以基于第一硬件特征参数对NFC芯片进行配置，由此可以使得第一电子设备基于配置后的第一硬件特征参数与第二电子设备进行通信。可以理解的是，若通信成功，第一电子设备与第二电子设备可以基于NFC方式进行业务交互，例如，刷门禁，进行移动支付等。若通信失败，也就是说，NFC芯片无法使用第一硬件特征参数对第二电子设备发送的数据帧进行解码，则第一电子设备可以将第一硬件特征参数切换为第二硬件特征参数，并可以根据切换后的第二硬件特征参数与第二电子设备再次进行通信。在具体实现时，上述对硬件特征参数进行切换的触发方式可以例如是：当定时器超时后，若NFC芯片配置第一硬件特征参数后，与第二电子设备通信失败，则可以触发对硬件特征参数的切换，其中，定时器可以在检测到外部存在第二电子设备的情况下启动，并可以在第一电子设备与第二电子设备成功通信后关闭，检测外部存在第二电子设备的具体方式可以是：若检测到外部有电磁场，则可以认为检测到第二电子设备。可以理解的是，若定时器未超时，第一电子设备与第二电子设备通信成功，则NFC芯片可以基于已配置的第一硬件特征参数与第二电子和设备进行业务交互，无需再进行硬件特征参数的切换，并可以在通信完成后进入休眠。可选地，对硬件特征参数进行切换的触发方式还可以是：对外部的电磁场进行检测，根据检测结果进行硬件特征参数的切换。当检测到外部电磁场快速减弱后，将第一硬件特征参数切换为第二硬件特征参数。例如，若NFC芯片配置第一硬件特征参数，并与第二电子设备成功通信后，当第一电子设备远离第二电子设备时，可以触发对硬件特征参数的切换，在这种场景中，可以认为是虚假的通信成功，此时，第一电子设备可以将硬件特征参数进行切换，并与第二电子设备再次通信；又例如，在NFC芯片配置第一硬件特征参数，与第二电子设备的通信过程中，当检测到外部电磁场快速减弱后，例如，用户将第一电子设备远离第二电子设备，第一电子设备可以进行硬件特征参数的切换。此外，将第一硬件特征参数切换为第二硬件特征参数的具体方式可以包括以下几种：方式1，将第一硬件特征参数切换为第二硬件特征参数，其中，第一硬件特征参数与第二硬件特征参数对应的NFC技术和/或比特率不同。以表2为例，若第一硬件特征参数为比特率为106k的CE-B硬件特征参数，则通信失败后，可以将第一硬件特征参数切换为第二硬件特征参数，其中，第二硬件特征参数为比特率为212k的CE-B硬件特征参数，比特率为106k的CE-B硬件特征参数与比特率为212k的CE-B硬件特征参数之间NFC技术相同，比特率不同。或者，若第一硬件特征参数为编号2的比特率为106k的CE-A硬件特征参数，则通信失败后，可以将第一硬件特征参数切换为第二硬件特征参数，其中，第二硬件特征参数为比特率为106k的CE-B硬件特征参数，编号2的比特率为106k的CE-A硬件特征参数与比特率为106k的CE-B硬件特征参数之间比特率相同，NFC技术不同。又或者，若第一硬件特征参数为编号2的比特率为106k的CE-A硬件特征参数，则通信失败后，可以将第一硬件特征参数切换为第二硬件特征参数，其中，第二硬件特征参数为比特率为212k的CE-B硬件特征参数，编号2的比特率为106k的CE-A硬件特征参数与比特率为212k的CE-B硬件特征参数之间比特率不同，NFC技术不同。方式2，将第一硬件特征参数切换为第二硬件特征参数，其中，第一硬件特征参数与第二硬件特征参数对应的NFC技术和比特率相同，参数值不同。以表2为例，若第一硬件特征参数为编号1的比特率为106k的CE-A硬件特征参数，则通信失败后，可以将第一硬件特征参数切换为第二硬件特征参数，其中，第二硬件特征参数为编号2的比特率为106k的CE-A硬件特征参数，编号1的比特率为106k的CE-A硬件特征参数与编号2的比特率为106k的CE-A硬件特征参数之间比特率相同，NFC技术相同，参数值不同。可选地，在将第一硬件特征参数进行切换前，还可以将NFC芯片进入休眠，由此可以节省第一电子设备中整个NFC系统的功耗。可以理解的是，当休眠结束后，第一电子设备可以唤醒NFC芯片，并可以在唤醒NFC芯片后将第一硬件特征参数切换为第二硬件特征参数。本申请实施例中，通过在工作在CE模式下的NFC设备中预设多套硬件特征参数，在使用硬件特征参数与读卡设备通信失败后，切换硬件特征参数并再次进行通信，由此可以有助于工作在CE模式下的NFC设备兼容不同的读卡设备，从而可以提高工作在CE模式下的NFC设备的稳定性和兼容性。接着，结合图2对本申请实施例提供的卡模拟方法进行进一步说明。图2为NFC完整工作周期的示意图。如图2所示，一个TD可以包括一个空闲期和一个发现期，其中，在空闲期内，NFC芯片可以处于空闲态，此时，NFC芯片不与第二电子设备通信，也就是说，NFC芯片处于省电状态。在发现期，NFC芯片处于发现态，NFC芯片可以与第二电子设备进行通信，例如，可以检测电磁场，用于发现第二电子设备，并可以接收第二电子设备发送的数据帧进行解码。可以理解的是，若解码成功，则可以认为通信成功，若解码失败，则可以认为通信失败。现结合图3，并以第一电子设备预设6套硬件特征参数为例进行说明，其中，上述6套硬件特征参数可以分别表示为CEA1、CEA2、CEB1、CEB2、CEF1及CEF2，上述6套硬件特征参数的具体创建方式可以参考上述实施例，在此不再赘述。示例性的，CEA1可以对应表2中的编号1的比特率为106k的CE-A硬件特征参数，CEA2可以对应表2中的编号2的比特率为106k的CE-A硬件特征参数，CEB1可以对应表2中的比特率为106k的CE-B硬件特征参数，CEB2可以对应表2中的比特率为212k的CE-B硬件特征参数，CEF1可以对应表2中的比特率为212k的CE-F硬件特征参数，CEF2可以对应表2中的比特率为424k的CE-F硬件特征参数。当NFC芯片上电后，可以对NFC芯片进行初始化，例如，可以将NFC芯片设置为工作在CE模式下，且可以将CE模式下的各项NFC技术使能，由此可以使得NFC芯片可以使用已使能的NFC技术。此时，NFC芯片处于空闲态。可以理解的是，本申请实施例以使能的A、B和F的NFC技术组合为例进行示例性说明，但并不构成对本申请的限定，在一些实施例中，也可以包含更多或更少的其他技术或技术组合，例如，A技术，或A和F的技术组合，或B和F的技术组合，或A和B技术组合，或A、B、F和V的技术组合等。当NFC芯片进入第一个TD后，NFC芯片进入第一个TD的发现期，也就是处于发现态。此时，NFC芯片可以在上述多套硬件特征参数中选取一套硬件特征参数作为首套硬件特征参数。然后，NFC芯片基于首套硬件特征参数进行配置，并通过已配置的首套硬件特征参数与第二电子设备进行通信。以首套硬件特征参数为CEA1为例，NFC芯片可以在A技术下，通过CEA1硬件特征参数与第二电子设备进行通信。若在第一个TD的发现期内通信成功，则NFC芯片使用CEA1硬件特征参数与第二电子设备进一步进行NFC指令交互，以完成本次业务。若在第一个TD的发现期内通信失败，则NFC芯片进入第一个TD的空闲期，由此可以进入休眠，从而可以节省第一电子设备整个NFC系统的功耗。在具体实现时，在发现期内，当NFC芯片检测到外部存在第二电子设备的情况时可以启动定时器，示例性的，该定时器的时长可以为100ms，也可以是其他数值，本申请实施例对此不作特殊限定发现期；当定时器超时后，可以认为定时器结束，若此时第一电子设备仍未与第二电子设备通信成功，则可以进入休眠。可以理解的是，若定时器未超时，且第一电子设备与第二电子设备通信成功，则第一电子设备可以关闭定时器，并与第二电子设备进一步进行NFC指令交互，以完成本次业务，并在完成本次业务后进入休眠。需要说明的是，第一电子设备还可以通过检测外部电磁场的方式触发硬件特征参数的切换，若检测到外部电磁场快速减弱，则可以停止与第二电子设备的通信，并进入休眠。当休眠结束后，NFC芯片进入第二个TD的发现期。可以理解的是，休眠结束指的是空闲期结束。此时，第一电子设备可以重新唤醒NFC芯片，NFC芯片再次进入发现态。接着，第一电子设备可以将上述首套硬件特征参数进行切换，由此可以将首套硬件特征参数切换至另一套硬件特征参数，例如，CEA2。然后，NFC芯片可以基于切换后的硬件特征参数进行配置，并通过已配置的硬件特征参数与第二电子设备进行通信。以切换后的硬件特征参数为CEA2为例，NFC芯片可以在A技术下，通过CEA2硬件特征参数与第二电子设备进行通信。若在第二个TD的发现期内通信成功，则第一电子设备与第二电子设备进一步进行NFC指令交互，以完成本次业务，并在完成本次业务后进入休眠。若在第二个TD的发现期内通信失败，则NFC芯片进入第二个TD的空闲期，再次进入休眠。当休眠结束后，NFC芯片进入第三个TD的发现期。此时，第一电子设备可以重新唤醒NFC芯片，NFC芯片再次进入发现态。接着，第一电子设备可以将上述切换后的硬件特征参数再次进行切换。以本次切换的硬件特征参数为CEB1为例，第一电子设备可以将CEA2切换为CEB1。然后，NFC芯片基于切换后的硬件特征参数进行配置，并通过已配置的硬件特征参数与第二电子设备进行通信。若在第三个TD的发现期内通信成功，则第一电子设备与第二电子设备进一步进行NFC指令交互，以完成本次业务，并在完成本次业务后进入休眠。若在第三个TD的发现期内通信失败，则NFC芯片进入第三个TD的空闲期，再次进入休眠。当休眠结束后，NFC芯片进入第四个TD的发现期。此时，第一电子设备可以重新唤醒NFC芯片，NFC芯片再次进入发现态。接着，第一电子设备可以将切换后的硬件特征参数进行再次切换。由此可以将切换后的硬件特征参数再次进行切换，例如，切换至CEB2。然后，NFC芯片基于切换后的硬件特征参数进行配置，并通过已配置的硬件特征参数与第二电子设备进行通信。以切换后的硬件特征参数为CEB2为例，NFC芯片可以在B技术下，通过CEB2硬件特征参数与第二电子设备进行通信。若在第四个TD的发现期内通信成功，则第一电子设备与第二电子设备进一步进行NFC指令交互，以完成本次业务，并在完成本次业务后进入休眠。若在第四个TD的发现期内通信失败，则NFC芯片进入第四个TD的空闲期，再次进入休眠。当休眠结束后，NFC芯片进入第五个TD的发现期。此时，第一电子设备可以重新唤醒NFC芯片，NFC芯片再次进入发现态。接着，第一电子设备可以将上述切换后的硬件特征参数再次进行切换。以本次切换的硬件特征参数为CEF1为例，第一电子设备可以将CEB2切换为CEF1。然后，NFC芯片基于切换后的硬件特征参数进行配置，并通过已配置的硬件特征参数与第二电子设备进行通信。若在第五个TD的发现期内通信成功，则第一电子设备与第二电子设备进一步进行NFC指令交互，以完成本次业务，并在完成本次业务后进入休眠。若在第五个TD的发现期内通信失败，则NFC芯片进入第五个TD的空闲期，再次进入休眠。当休眠结束后，NFC芯片进入第六个TD的发现期。此时，第一电子设备可以重新唤醒NFC芯片，NFC芯片再次进入发现态。接着，第一电子设备可以将切换后的硬件特征参数进行再次切换。由此可以将切换后的硬件特征参数再次进行切换，例如，切换至CEF2。然后，NFC芯片基于切换后的硬件特征参数进行配置，并通过已配置的硬件特征参数与第二电子设备进行通信。以切换后的硬件特征参数为CEF2为例，NFC芯片可以在F技术下，通过CEF2硬件特征参数与第二电子设备进行通信。若在第六个TD的发现期内通信成功，则第一电子设备与第二电子设备进一步进行NFC指令交互，以完成本次业务，并在完成本次业务后进入休眠。若在第六个TD的发现期内通信失败，则NFC芯片进入第六个TD的空闲期，再次进入休眠。可以理解的是，当第一电子设备尝试过所有预设的硬件特征参数后，仍无法与第二电子设备成功通信，此时，可以重新执行上述第一个TD至第六个TD的步骤。接着，结合图4、图5a、图5b和图5c对本申请实施例提供的卡模拟方法进行进一步说明。如图4所示为本申请提供的卡模拟方法另一个实施例的流程示意图，该卡模拟方法应用于第一电子设备，第一电子设备具有NFC芯片，NFC芯片工作在CE模式，第一电子设备预设多套硬件特征参数，具体包括以下步骤：步骤401，在多套硬件特征参数中选取一套硬件特征参数作为第一硬件特征参数，并使用第一硬件特征参数对外部电磁场进行硬件检测。具体地，NFC芯片的TD中的发现期可以用于进行硬件检测和/或配置硬件特征参数。当NFC芯片进入TD后，可以进行硬件检测。其中，执行硬件检测的硬件可以是NFC芯片、或NFC芯片中的模组、或外围硬件电路，本申请实施例对执行硬件检测的硬件类型不作特殊限定。执行硬件检测的具体方式可以是：在多套硬件特征参数中选取一套硬件特征参数作为第一硬件特征参数，并使用第一硬件特征参数对外部电磁场进行硬件检测。其中，外部电磁场可以是第二电子设备的射频场。可以理解的是，第一硬件特征参数的选取方式具体可以参考上述实施例，在此不再赘述。步骤402，若第一硬件特征参数与外部电磁场适配，将NFC芯片配置为第一硬件特征参数，以使得第一电子设备基于第一硬件特征参数与第二电子设备进行通信；若第一硬件特征参数与外部电磁场不适配，将第一硬件特征参数切换为第二硬件特征参数，并使用第二硬件特征参数对外部电磁场再次进行硬件检测。具体地，若第一硬件特征参数与外部电磁场适配，也就是说，若通过硬件检测确定第一硬件特征参数与第二电子设备适配后，NFC芯片可以在当前TD的发现期内配置硬件特征参数，例如，硬件可以通知软件当前适配的第一硬件特征参数对应的NFC技术、比特率以及参数值，，由此可以使得在软件运行时，第一电子设备根据通知的第一硬件特征参数对应的NFC技术、比特率以及参数值进行配置，并可以基于配置的第一硬件特征参数与第二电子设备进行通信。若第一硬件特征参数与外部电磁场不适配，第一电子设备可以将第一硬件特征参数切换为第二硬件特征参数，并使用切换后的第二硬件特征参数对外部电磁场进行再次检测。可以理解的是，若第二硬件特征参数仍适配失败，可以进一步进行硬件特征参数的切换，并基于切换后的硬件特征参数再次进行硬件检测，直至将电子设备中预先存储的所有硬件特征参数适配完为止，由此可以在一个TD内完成所有硬件特征的参数的适配，避免软件在多个TD内配置硬件特征参数与第二电子设备通信导致的效率减低。其中，硬件特征参数的具体切换方式可以参考上述实施例，在此不再赘述。接着，结合图5a图5c对上述硬件检测场景进行示例性说明。其中，图5a为硬件检测示意图。如图5a所示，NFC芯片可以在任一TD内的发现期内使用首个硬件特征参数进行硬件检测，其中，首个硬件特征参数的选取方式可以参考上述实施例，在此不再赘述。若首个硬件特征参数与外部电磁场适配，则可以在如图5b所示的当前TD内基于首个硬件特征参数对NFC芯片进行配置，以使得NFC芯片基于配置的硬件特征参数与第二电子设备进行通信。若首个硬件特征参数与外部电磁场不适配，则可以在如图5c所示的当前TD内进行硬件特征参数的切换，并基于切换后的硬件特征参数再次进行硬件检测，直至在当前TD内将所有的硬件特征参数适配完为止。本申请实施例中，在硬件检测阶段，可以在同一个TD内尝试不同的硬件特征参数与读卡设备进行适配，并在适配成功后将适配的硬件特征参数直接配置给NFC芯片，由此可以在一个TD内通过硬件检测手段完成硬件特征参数的适配，从而可以避免软件运行时因硬件特征参数在多个TD内的切换引起的硬件特征参数的多次配置，进而可以提高软件的执行效率。图6为本申请提供的NFC芯片一个实施例的结构示意图，如图6所示，上述NFC芯片60应用于第一电子设备，即第一电子设备具有该NFC芯片60，NFC芯片工作在CE模式，第一电子设备预设多套硬件特征参数，NFC芯片60可以包括：选取模块61及通信模块62；其中，选取模块61，用于选取多套硬件特征参数中的一套硬件特征参数作为第一硬件特征参数；通信模块62，用于若NFC芯片配置第一硬件特征参数后，与第二电子设备通信失败，则将第一硬件特征参数切换为第二硬件特征参数，并根据第二硬件特征参数与第二电子设备再次进行通信。其中一种可能的实现方式中，多套硬件特征参数中的每套硬件特征参数与NFC模式、NFC技术及比特率的组合具有映射关系。其中一种可能的实现方式中，第一硬件特征参数与第二硬件特征参数对应的NFC技术和/或比特率不同。其中一种可能的实现方式中，第一硬件特征参数与第二硬件特征参数对应的NFC技术和比特率相同，参数值不同。其中一种可能的实现方式中，第一硬件特征参数由兼容性和/或覆盖率确定。其中一种可能的实现方式中，上述通信模块62具体用于当定时器超时后，若NFC芯片配置第一硬件特征参数后，与第二电子设备通信失败，则将第一硬件特征参数切换为第二硬件特征参数，定时器在检测到外部存在第二电子设备的情况下启动。其中一种可能的实现方式中，上述通信模块62还用于响应于检测到的外部电磁场的快速减弱，将第一硬件特征参数切换为第二硬件特征参数其中一种可能的实现方式中，上述通信模块62具体用于使NFC芯片进入休眠；当休眠结束后，唤醒NFC芯片，并将第一硬件特征参数切换为第二硬件特征参数。可以理解的是，本申请实施例中的芯片60的有益效果具体可以参考上述方法实施例的有益效果，在此不再赘述。图7为本申请提供的NFC芯片另一个实施例的结构示意图，如图7所示，上述NFC芯片70应用于第一电子设备，即第一电子设备具有NFC芯片70，NFC芯片工作在CE模式，第一电子设备预设多套硬件特征参数，NFC芯片70可以包括：检测模块71、通信模块72及切换模块73；其中，检测模块71，用于在多套硬件特征参数中选取一套硬件特征参数作为第一硬件特征参数，并使用第一硬件特征参数对外部电磁场进行硬件检测；通信模块72，用于若第一硬件特征参数与外部电磁场适配，将NFC芯片配置为第一硬件特征参数，以使得第一电子设备基于第一硬件特征参数与第二电子设备进行通信；切换模块73，用于若第一硬件特征参数与外部电磁场不适配，将第一硬件特征参数切换为第二硬件特征参数，并使用第二硬件特征参数对外部电磁场再次进行硬件检测。可以理解的是，本申请实施例中的芯片70的有益效果具体可以参考上述方法实施例的有益效果，在此不再赘述。图8为本申请实施例提供的一种电子设备800的结构示意图，上述电子设备800可以包括：至少一个处理器；以及与上述处理器通信连接的至少一个存储器。上述电子设备800可以为NFC设备。上述存储器存储有可被上述处理器执行的程序指令，处理器可调用上述程序指令能够执行本申请实施例提供的NFC设备执行的动作。如图8所示，电子设备800可以以通用计算设备的形式表现。电子设备800的组件可以包括但不限于：一个或者多个处理器810，存储器820，连接不同系统组件的通信总线840及通信接口830。通信总线840表示几类总线结构中的一种或多种，包括存储器总线或者存储器控制器，外围总线，图形加速端口，处理器或者使用多种总线结构中的任意总线结构的局域总线。举例来说，这些体系结构包括但不限于工业标准体系结构总线，微通道体系结构总线，增强型ISA总线、视频电子标准协会局域总线以及外围组件互连总线。电子设备800典型地包括多种计算机系统可读介质。这些介质可以是任何能够被电子设备800访问的可用介质，包括易失性和非易失性介质，可移动的和不可移动的介质。存储器820可以包括易失性存储器形式的计算机系统可读介质，例如随机存取存储器和/或高速缓存存储器。电子设备800可以进一步包括其它可移动/不可移动的、易失性/非易失性计算机系统存储介质。尽管图8中未示出，可以提供用于对可移动非易失性磁盘读写的磁盘驱动器，以及对可移动非易失性光盘、数字多功能只读光盘或者其它光介质)读写的光盘驱动器。在这些情况下，每个驱动器可以通过一个或者多个数据介质接口与通信总线840相连。存储器820可以包括至少一个程序产品，该程序产品具有一组程序模块，这些程序模块被配置以执行本申请各实施例的功能。具有一组程序模块的程序/实用工具，可以存储在存储器820中，这样的程序模块包括但不限于操作系统、一个或者多个应用程序、其它程序模块以及程序数据，这些示例中的每一个或某种组合中可能包括网络环境的实现。程序模块通常执行本申请所描述的实施例中的功能和/或方法。电子设备800也可以与一个或多个外部设备通信，还可与一个或者多个使得用户能与该电子设备800交互的设备通信，和/或与使得该电子设备800能与一个或多个其它计算设备进行通信的任何设备通信。这种通信可以通过通信接口830进行。并且，电子设备800还可以通过网络适配器与一个或者多个网络，广域网和/或公共网络，例如因特网)通信，上述网络适配器可以通过通信总线840与电子设备的其它模块通信。应当明白，尽管图8中未示出，可以结合电子设备800使用其它硬件和/或软件模块，包括但不限于：微代码、设备驱动器、冗余处理单元、外部磁盘驱动阵列、磁盘阵列系统、磁带驱动器以及数据备份存储系统等。通过以上的实施方式的描述，所属领域的技术人员可以清楚地了解到，为描述的方便和简洁，仅以上述各功能模块的划分进行举例说明，实际应用中，可以根据需要而将上述功能分配由不同的功能模块完成，即将装置的内部结构划分成不同的功能模块，以完成以上描述的全部或者部分功能。上述描述的系统，装置和单元的具体工作过程，可以参考前述方法实施例中的对应过程，在此不再赘述。在本申请实施例各个实施例中的各功能单元可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中。上述集成的单元既可以采用硬件的形式实现，也可以采用软件功能单元的形式实现。所述集成的单元如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本申请实施例的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的全部或部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台计算机设备或处理器执行本申请各个实施例所述方法的全部或部分步骤。而前述的存储介质包括：快闪存储器、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质。以上所述，仅为本申请的具体实施方式，但本申请的保护范围并不局限于此，任何在本申请揭露的技术范围内的变化或替换，都应涵盖在本申请的保护范围之内。因此，本申请的保护范围应以所述权利要求的保护范围为准。
