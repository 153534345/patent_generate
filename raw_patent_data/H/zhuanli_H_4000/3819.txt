标题title
一种双栈网络下的业务处理方法、装置以及设备
摘要abst
本说明书实施例公开了一种双栈网络下的业务处理方法、装置以及设备。方案包括：接收指示了目标域名的业务请求；获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式；对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前；根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。
权利要求书clms
1.一种双栈网络下的业务处理方法，包括：接收指示了目标域名的业务请求；获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式；对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前；根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。2.如权利要求1所述的方法，所述对所述IP地址列表进行重排序，具体包括：将所述IPv4地址集合中的IPv4地址，与所述IPv6地址集合中的IPv6地址，进行交叉重排序，以使得IPv6地址与IPv4地址，交叉地出现在所述IP地址列表中顺序靠前的位置。3.如权利要求2所述的方法，所述进行交叉重排序，具体包括：计算所述IPv6地址集合中各IPv6地址之间的地域分离度；确定已重排序的任一个IPv6地址及其后邻接的一个IPv4地址；在尚未重排序的各IPv6地址中，确定与所述任一个IPv6地址之间的地域分离度高于预期的IPv6地址，作为下一个IPv6地址，将所述下一个IPv6地址排在所述一个IPv4地址邻接的下一个位置。4.如权利要求2所述的方法，所述进行交叉重排序之后，所述方法还包括：动态地将所述交叉重排序后的IPv4地址列表中，处于头部的IP地址流向尾部，其余的IP地址依次顺序前移，以实现顺序轮转的动态重排序。5.如权利要求1或2所述的方法，所述根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接，具体包括：确定轮询时对应的建立连接超时时间；设置短于所述建立连接超时时间的复合建立连接等待时间；在所述重排序后的IP地址列表中，尝试与顺序最靠前的一个IP地址建立连接，并对本次尝试建立连接的过程进行计时；若计时达到复合建立连接等待时间，则同时尝试与在所述重排序后的IP地址列表中，顺序在所述一个IP地址之后的下一个IP地址建立连接，并对所述同时尝试建立连接的过程也进行计时，以此类推，直至达成预定的连接建立目标。6.如权利要求4所述的方法，所述设置短于所述建立连接超时时间的复合建立连接等待时间，具体包括：判断所述建立连接超时时间是否过长；若是，则设置远短于所述建立连接超时时间的复合建立连接等待时间。7.如权利要求1或2所述的方法，应用于店铺中的收银终端，所述对所述IP地址列表进行重排序，具体包括：若所述收银终端自身具有IPv6地址，则将所述自身具有的IPv6地址插入至所述IP地址列表中顺序靠前的位置，以实现对所述IP地址列表的重排序；所述对所述IP地址列表进行重排序之后，所述方法还包括：将所述重排序后的IP地址列表发送给所述店铺中的顾客移动终端，以便所述顾客移动终端通过所述自身具有的IPv6地址，与所述重排序之前的IP地址列表对应的服务器进行间接交互。8.如权利要求7所述的方法，所述将所述自身具有的IPv6地址插入至所述IP地址列表中顺序靠前的位置之后，所述方法还包括：判断所述收银终端与轮询到的IPv6地址是否成功建立连接；若是，则在所述IP地址列表中，将所述轮询到的IPv6地址的顺序调整至所述自身具有的IPv6地址的顺序之前。9.如权利要求1所述的方法，应用于终端，所述尝试与轮询到的IPv6地址或者IPv4地址建立连接之后，所述方法还包括：对在所述终端上尝试与轮询的IPv6地址建立连接失败的情况进行记录统计；若连续失败的次数达到设定阈值，则将所述终端上的所述重排序后的IP地址列表中的IPv6地址进行过滤排除，以便之后只尝试与IPv4地址建立连接。10.如权利要求1或9所述的方法，所述业务请求用于进行支付相关业务。11.一种双栈网络下的业务处理装置，包括：业务请求接收模块，接收指示了目标域名的业务请求；IP地址获取模块，获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式；IP地址重排序模块，对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前；轮询建立连接模块，根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。12.如权利要求11所述的装置，所述IP地址重排序模块，将所述IPv4地址集合中的IPv4地址，与所述IPv6地址集合中的IPv6地址，进行交叉重排序，以使得IPv6地址与IPv4地址，交叉地出现在所述IP地址列表中顺序靠前的位置。13.如权利要求12所述的装置，所述IP地址重排序模块，计算所述IPv6地址集合中各IPv6地址之间的地域分离度；确定已重排序的任一个IPv6地址及其后邻接的一个IPv4地址；在尚未重排序的各IPv6地址中，确定与所述任一个IPv6地址之间的地域分离度高于预期的IP v6地址，作为下一个IPv6地址，将所述下一个IPv6地址排在所述一个IPv4地址邻接的下一个位置。14.如权利要求12所述的装置，所述IP地址重排序模块，在所述进行交叉重排序之后，还执行：动态地将所述交叉重排序后的IPv4地址列表中，处于头部的IP地址流向尾部，其余的IP地址依次顺序前移，以实现顺序轮转的动态重排序。15.如权利要求11或12所述的装置，所述轮询建立连接模块包括复合建立连接子模块；所述复合建立连接子模块，确定轮询时对应的建立连接超时时间；设置短于所述建立连接超时时间的复合建立连接等待时间；在所述重排序后的IP地址列表中，尝试与顺序最靠前的一个IP地址建立连接，并对本次尝试建立连接的过程进行计时；若计时达到复合建立连接等待时间，则同时尝试与在所述重排序后的IP地址列表中，顺序在所述一个IP地址之后的下一个IP地址建立连接，并对所述同时尝试建立连接的过程也进行计时，以此类推，直至达成预定的连接建立目标。16.如权利要求14所述的装置，所述轮询建立连接模块，判断所述建立连接超时时间是否过长；若是，则设置远短于所述建立连接超时时间的复合建立连接等待时间。17.如权利要求11或12所述的装置，应用于店铺中的收银终端，所述IP地址重排序模块，若所述收银终端自身具有IPv6地址，则将所述自身具有的IPv6地址插入至所述IP地址列表中顺序靠前的位置，以实现对所述IP地址列表的重排序；所述IP地址重排序模块，对所述IP地址列表进行重排序之后，还执行：将所述重排序后的IP地址列表发送给所述店铺中的顾客移动终端，以便所述顾客移动终端通过所述自身具有的IPv6地址，与所述重排序之前的IP地址列表对应的服务器进行间接交互。18.如权利要求17所述的装置，所述IP地址重排序模块，将所述自身具有的IPv6地址插入至所述IP地址列表中顺序靠前的位置之后，还执行：判断所述收银终端与轮询到的IPv6地址是否成功建立连接；若是，则在所述IP地址列表中，将所述轮询到的IPv6地址的顺序调整至所述自身具有的IPv6地址的顺序之前。19.如权利要求11所述的装置，应用于终端，所述装置还包括：终端IPv6降级模块，在所述尝试与轮询到的IPv6地址或者IPv4地址建立连接之后，对在所述终端上尝试与轮询的IPv6地址建立连接失败的情况进行记录统计；若连续失败的次数达到设定阈值，则将所述终端上的所述重排序后的IP地址列表中的IPv6地址进行过滤排除，以便之后只尝试与IPv4地址建立连接。20.如权利要求11或19所述的装置，所述业务请求用于进行支付相关业务。21.一种双栈网络下的业务处理设备，包括：至少一个处理器；以及，与所述至少一个处理器通信连接的存储器；其中，所述存储器存储有可被所述至少一个处理器执行的指令，所述指令被所述至少一个处理器执行，以使所述至少一个处理器能够：接收指示了目标域名的业务请求；获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式；对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前；根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。
说明书desc
技术领域本说明书涉及互联网和通信技术领域，尤其涉及一种双栈网络下的业务处理方法、装置以及设备。背景技术随着移动互联网及物联网的迅猛发展，越来越多的终端需要接入网络，IPv4地址逐渐枯竭，为了解决这一问题，各运营商、CDN服务商及应用开始进行IPv6升级改造。截至目前，根据国家IPv6发展检测平台提供的数据，IPv6活跃用户数达到6.44亿，占总体互联网用户的64％。但现阶段IPv6整体生态环境及稳定性尚不如IPv4，终端应用在使用IPv6进行通信的过程中，会遇到无法建立连接或连接耗时较长等问题，影响服务体验，甚至完全无法提供服务。基于此，在IPv6规模部署的整体环境下，需要改善用户使用双栈网络接入互联网的体验问题。发明内容本说明书一个或多个实施例提供一种双栈网络下的业务处理方法、装置、设备以及存储介质，用以解决如下技术问题：在IPv6规模部署的整体环境下，需要改善用户使用双栈网络接入互联网的体验问题。为解决上述技术问题，本说明书一个或多个实施例是这样实现的：本说明书一个或多个实施例提供的一种双栈网络下的业务处理方法，包括：接收指示了目标域名的业务请求；获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式；对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前；根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。本说明书一个或多个实施例提供的一种双栈网络下的业务处理装置，包括：业务请求接收模块，接收指示了目标域名的业务请求；IP地址获取模块，获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式；IP地址重排序模块，对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前；轮询建立连接模块，根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。本说明书一个或多个实施例提供的一种双栈网络下的业务处理设备，包括：至少一个处理器；以及，与所述至少一个处理器通信连接的存储器；其中，所述存储器存储有可被所述至少一个处理器执行的指令，所述指令被所述至少一个处理器执行，以使所述至少一个处理器能够：接收指示了目标域名的业务请求；获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式；对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前；根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。本说明书一个或多个实施例提供的一种非易失性计算机存储介质，所述介质存储有计算机可执行指令，所述计算机可执行指令设置为：接收指示了目标域名的业务请求；获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式；对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前；根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。本说明书一个或多个实施例采用的上述至少一个技术方案能够达到以下有益效果：在基于双栈进行IPv6规模部署时，通过标准DNS协议解析域名，终端获取对应的IP地址列表，由于目前都是根据RFC6724标准进行排序的，导致在IP地址列表中，IPv6地址集合顺序在前，IPv4地址集合顺序在后，而这种标准机制在遇到IPv6网络质量异常时，需要较长时间才能轮询到IPv4地址，通过对IP地址列表进行重排序，将IPv4地址在列表中的顺序有效地提前了，使得即使与最靠前的IPv6地址之间难以成功地或者高效地建立连接，也能够尽快轮询到IPv4地址，进而与IPv4地址建立连接，这相比标准机制大幅缩短了用户等待时间，改善了用户使用体验。附图说明为了更清楚地说明本说明书实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本说明书中记载的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其他的附图。图1为本说明书一个或多个实施例提供的一种双栈网络下的业务处理方法的流程示意图；图2、图2为本说明书一个或多个实施例提供的，复合建立连接和标准的串行建立连接这两种方式的比对示意图；图3为本说明书一个或多个实施例提供的一种店铺购物场景下，收银终端主动干预顾客终端的IP地址列表的方案的流程示意图；图4为本说明书一个或多个实施例提供的一种终端IPv6降级方案的示意图；图5为本说明书一个或多个实施例提供的一种应用场景下，图1中方法的具体实施方案；图6为本说明书一个或多个实施例提供的一种双栈网络下的业务处理装置的结构示意图；图7为本说明书一个或多个实施例提供的一种双栈网络下的业务处理设备的结构示意图。具体实施方式本说明书实施例提供双栈网络下的业务处理方法、装置、设备以及存储介质。为了使本技术领域的人员更好地理解本说明书中的技术方案，下面将结合本说明书实施例中的附图，对本说明书实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本申请一部分实施例，而不是全部的实施例。基于本说明书实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都应当属于本申请保护的范围。为了便于理解，先对一些概念进行解释。IPv4：即互联网通信协议第4版，IPv4使用32位地址，因此，地址空间中只有4,294,967,296个地址。随着地址不断被分配给用户，IPv4地址枯竭问题也在随之产生。IPv6：即互联网通信协议第6版，IPv6采用128位的地址，显然可用地址比IPv4多得多，因此，用IPv6来逐渐取代IPv4，以解决IPv4地址枯竭问题。同时，IPv6也在其他方面对于IPv4也有许多改进。双栈网络：指一台设备上同时支持IPv4协议栈和IPv6协议栈，既能与IPv4网络通信，又能与IPv6网络通信。双栈网络下通常优先使用IPv6网络通信。DNS协议：一个应用层协议，将便于人们理解的域名转换为机器可读的IP地址。随着物联网的迅猛发展及国内推进IPv6规模部署的要求，各大公司及应用开始进行IPv6部署工作，终端应用开始使用IPv6网络接入提供服务。但是，现阶段IPv6应用初期，IPv6的网络接入质量、稳定性尚不及IPv4成熟，探测数据表明部分省份运营商甚至存在长达几十天的IPv6无法连通的问题。在这种情况下，互联网应用使用IPv6进行通信，便会遇到连接建立过程异常等严重影响用户体验的问题。因此，本申请基于这样的情况，提出了能够提升双栈网络下用户体验的方案，使得终端上的应用在IPv6网络质量不佳的情况下，仍然能够顺利快速地为用户提供线上服务，完成诸如浏览、下单、支付等线上业务流程，保证用户体验。下面继续对本申请的方案进行详细说明。图1为本说明书一个或多个实施例提供的一种双栈网络下的业务处理方法的流程示意图。该方法可以应用于不同的业务领域中，这些业务领域比如包括：电子支付业务领域、电商业务领域、即时通讯业务领域、游戏业务领域、公务业务领域等。该流程可以在终端上执行，典型的如智能手机、平板电脑等，流程中的某些输入参数或者中间结果允许人工干预调节，以帮助提高准确性。图1中的流程可以包括以下步骤：S102：接收指示了目标域名的业务请求。业务请求所请求的业务，需要通过访问提供该业务的设备来实现。该设备预先注册有域名，该域名即为目标域名，该设备的IP地址与该域名之间具有对应关系，DNS服务器能够获得该对应关系，以用于解析该域名，确定其对应的IP地址，从而，才能够与该IP地址建立连接，通过该连接访问该设备。在本说明书一个或多个实施例中，用户在终端上进行操作，比如，点击付款按钮、转向指定的网页，等等，从而，终端上接收到相应的业务请求并执行后续步骤。付款按钮、网页等被操作对象具有预先关联的域名，该域名即为业务请求所指示的域名。S104：获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式。同一个目标域名对应的设备的IP地址可能有一个或者多个，本方案主要关注多个情况。这多个IP地址构成IP地址列表，其中，一部分是IPv6地址，一部分是IPv4地址。在标准的处理方式下，当一个域名具有一个IPv4地址时，DNS服务器会增加一条A记录以将该域名指向该IPv4地址，当一个域名具有一个IPv6地址时，DNS服务器会增加一条AAAA记录以将该域名指向该IPv6地址，之后，DNS服务器会根据这些记录向域名访问者返回由该域名的各IP地址构成的IP地址列表；若目标域名同时具备AAAA记录及A记录时，则通过标准DNS协议进行解析时，终端或其上应用获取到IP地址列表，其是根据RFC6724标准进行排序的，全部的IPv6地址顺序在前，全部的IPv4地址顺序在后。更直观地，举例说明，假定目标域名指向的IP地址包括：三个IPv6地址，三个IPv4地址，则IP地址列表中的顺序将是，可以看到，全部的IPv6地址顺序都在全部的IPv4地址顺序之前。在标准方案下，终端获得IP地址列表，会按顺序串行地轮询其中的IP地址，那么，在遇到IPv6网络质量异常时，需要较长时间才能轮询到IPv4地址。后面一些实施例会沿用该例子继续说明。S106：对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前。在本说明书一个或多个实施例中，为了使得在IPv6网络质量异常时，能够尽快轮询到IPv4地址，则将至少一个IPv4地址的顺序往前调整，调整到至少部分IPv6地址的顺序之前。比如，在IP地址列表中的第一个位置仍然放一个IPv6地址，然后第二个位置即放该IPv4地址，如此，既给了IPv6地址机会，又能尽快尝试IPv4地址，后面的位置怎么排是灵活多样的。S108：根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。在本说明书一个或多个实施例中，假定以上一段中列举的方式调整顺序，连接超时时间为10秒，则至多等待10秒就能轮询到第一个IPv4地址，相比原有机制大幅缩短用户等待时间，一定程度改善用户使用体验。若与IP地址列表中某个IP地址成功建立了连接，则可以不继续轮询，针对IP地址列表的其他进行中的连接建立操作也可以停止。在成功建立连接后，则终端可以通过所建立的连接与对端的设备通信，从而基于该通信，继续进行后续的业务处理，比如，支付、获取新网页内容等。通过图1的方法，在基于双栈进行IPv6规模部署时，通过对IP地址列表进行重排序，将IPv4地址在列表中的顺序有效地提前了，使得即使与最靠前的IPv6地址之间难以成功地或者高效地建立连接，也能够尽快轮询到IPv4地址，进而与IPv4地址建立连接，这相比标准机制大幅缩短了用户等待时间，改善了用户使用体验。基于图1的方法，本说明书还提供了该方法的一些具体实施方案和扩展方案，下面继续进行说明。在本说明书一个或多个实施例中，在重排序时，进一步提供了一种交叉排序方案，具体包括：将IPv4地址集合中的IPv4地址，与IPv6地址集合中的IPv6地址，进行交叉重排序，以使得IPv6地址与IPv4地址，交叉地出现在IP地址列表中顺序靠前的位置。如此更为合理，既兼顾了IPv6地址的优势，给予了其更多的尝试机会，又使得IP v4整体的顺序都有效提前了，避免了个别IPv6地址和IPv4地址的异常影响到全局的连接建立效率。沿用上面的例子，交叉重排序后的IP地址列表中各IP地址的顺序调整为，可以看到，IPv6地址和IPv4地址一个一个地交叉出现，若在交叉完后，还有多余一些的IPv6地址或者IPv4地址，则可以放在尾部。进一步地，在实际应用中，在一个IPv6地址列表中，大部分IP地址都是正常可连接的，在这种情况下，若各终端重排序后的IPv6地址列表是一致，则排序顺序靠后的IP地址很难轮上真正使用，而顺序在头部的少数几个IP地址则又负担过重。本方案通过在重排序时进行通过顺序轮转的动态重排序，来解决该问题，以使得各IP地址能够更均匀地为大量甚至海量终端服务。具体比如，动态地将交叉重排序后的IPv4地址列表中，处于头部的IP地址流向尾部，其余的IP地址依次顺序前移，每次前移多少可以由终端个性化决定，各终端可以将自身动态重排序的情况发送给DNS服务器，以便DNS服务器根据需要调整自身维护的这些IP地址，以协助实现服务的均匀化。在实际应用中，IPv6和IPv4的异常都具有地域集中性，比如，可能一个机房整体宕机了，一条光纤断路了，其影响到的是同一个地域中的一大批IP地址。如此导致，若某地域其中一个IP地址不可用，则同处该地域的其他一些IP地址可能也不可用。那么，在这样的情况下，对IP地址列表中的IP地址进行轮询时，若碰巧连续几个IP地址都是同处该地域，则均会由于异常而无法成功建立连接，白白耗费的时间和处理资源。针对于上一段的情况，本方案基于IP地址所反映出的至少部分地域信息，来让IP地址列表中地域接近的IP地址在顺序上尽量分散，以避免降低连续异常出现的可能性。具体比如，在重排序时，计算IPv6地址集合中各IPv6地址之间的地域分离度，确定已重排序的任一个IPv6地址及其后邻接的一个IPv4地址，在尚未重排序的各IPv6地址中，确定与任一个IPv6地址之间的地域分离度高于预期的IPv6地址，作为下一个IPv6地址，将所述下一个IPv6地址排在所述一个IPv4地址邻接的下一个位置。地域分离度越高，则表示对应的两个IP地址的设备之间在地理位置上相对越远。在重排序方案的基础上，本申请还进一步地提供了一种复合建立连接方案，以提高重排序方案可靠性。上面也有提到，在目前的标准机制下，终端获得IP地址列表，是按顺序串行地轮询其中的IP地址的，若与前一个IP地址尝试建立连接中的时间，超过了预定的建立连接超时时间，才会开始与下一个IP地址尝试建立连接。在这种情况下，若建立连接超时时间设置得较长，则IPv6地址出现异常时，相应地需要等待较长才能继续尝试下一个IP地址。针对上一段的问题，本方案通过通过额外设置复合建立连接等待时间，来提高尝试建立连接过程中的并行度。具体包括：确定轮询时对应的建立连接超时时间，设置短于建立连接超时时间的复合建立连接等待时间，在重排序后的IP地址列表中，尝试与顺序最靠前的一个IP地址建立连接，并对本次尝试建立连接的过程进行计时，若计时达到复合建立连接等待时间，则同时尝试与在所述重排序后的IP地址列表中，顺序在该一个IP地址之后的下一个IP地址建立连接，并对同时尝试建立连接的过程也进行计时，以此类推，直至达成预定的连接建立目标。复合建立连接等待时间具体多短，可以参考正常的连接建立所耗时间，或者当前设置的复合建立连接等待时间。比如，可以设置地在正常的连接建立所耗时间附近；再比如，可以判断建立连接超时时间是否过长，若是，则设置远短于建立连接超时时间的复合建立连接等待时间，从而有助于尽快尝试下一个IP地址，在这种情况下，同一时刻，终端可能在同时尝试分别与2个以上的IP地址建立连接，此即为复合建立连接。具体多短算远短于是相对而言的，可以按照一般人的感受理解，也可以预先进行定义，比如，差了多倍、差了至少一个数量级等等。更直观地，沿用前面的例子进行图示说明。图2、图2为本说明书一个或多个实施例提供的，复合建立连接和标准的串行建立连接这两种方式的比对示意图。在图2中，示出了两种连接建立方式直观的区别，假定IP地址列表已经经过了交叉重排序。在串行建立连接方式下，首先尝试与第一个IPv6地址V6_1建立连接，10秒时连接超时，则尝试使用下一个IP地址，即第一个IPv4地址V4_1，并在第11秒时建立成功了。在复合建立连接方式下，首先尝试与V6_1建立连接，在第3秒时到达复合建立连接等待时间，则不继续等待超时，而是开始尝试使用V4_1，并在第4秒时建立成功了。在图2中，示出了两种连接建立方式在TCP层的表现。客户端即表示终端上搭载的应用，服务器即为该应用的服务器。在串行建立连接方式下，在尝试与第一个IPv6地址V6_1建立连接的过程中，发了三次握手消息都没有被响应，10秒时连接超时，则向V4_1发送握手消息，并在第11秒时建立成功了。在复合建立连接方式下，在连续的短时间隔的两条消息发送后1秒，到达复合建立连接等待时间，则不继续等待超时，而是向V4_1发送握手消息，并在第4秒时建立成功了。由此可见，在上面的例子中，假定第一个IPv6地址V6_1无法连通，通过使用复合建立连接，则在第3秒后便能快速地使用V4_1来建立连接，而标准机制下串行建立连接只能在第10秒等V6_1超时后才能使用V4_1建立连接。在本说明书一个或多个实施例中，本方案关注的其中一种重要的应用场景是顾客在诸如智能手机等移动终端上进行支付相关业务，比如，扫码付款、展码付款等，这些业务对于通信的实时性要求很高。因此，在IPv6规模部署的背景下，尤其要注意这类用户和业务的体验。顾客在线下的店铺购物时，会到收银台前结账，则往往会有大量顾客排队，此时，对于支付相关业务的实时性要求进一步提高。而不同顾客的移动终端本身性能、采用的移动运营商，以及应用运行等情况都有所区别，在支付过程中，会需要与对应的支付服务器进行通信，则通信过程的实时性和稳定程度往往会出现个别突发的问题，某个顾客出问题，则整个排队队列都会受到影响，而IPv6部署所带来的不稳定因素又进一步加剧了该问题。针对这种场景及情况，本方案进一步对重排序过程进行改进，以将通过将支付服务器的域名指向具体店铺的收银终端的IPv6地址，通过收银终端来干预顾客终端的IP地址列表，来将店铺内不同顾客的支付相关通信请求收拢到收银终端上，从而，无需顾客与支付服务器直接进行实时通信，就能够顺利完成支付过程，在这种情况下，只要保证收银终端好好地维护IP地址列表即可，有效地屏蔽了多个顾客移动终端带来的不稳定因素。结合图3进行说明。图3为本说明书一个或多个实施例提供的一种店铺购物场景下，收银终端主动干预顾客终端的IP地址列表的方案的流程示意图。该流程的执行主体可以是店铺内的收银终端。图3中的流程可以包括以下步骤：S302：若收银终端自身具有IPv6地址，则将该自身具有的IPv6地址插入至IP地址列表中顺序靠前的位置，以实现对IP地址列表的重排序。由于不是收银终端自身具有的IPv6地址事实上并不是真正指向对应的服务器的域名，因此，可以预先请求该对应的服务器或者DNS服务器授权，得到授权后再做插入重排序的动作。否则，可以由了解真实指向关系的DNS服务器来向顾客移动终端通报收银终端可能具有的风险。S304：将重排序后的IP地址列表发送给店铺中的顾客移动终端，以便顾客移动终端通过该自身具有的IPv6地址，与重排序之前的IP地址列表对应的服务器进行间接交互。收银终端在利用自己的IPv6地址，主动干预IP地址列表后，可以通过诸如扫码展码、或者短距离无线通信等方式，将干预后的IP地址列表分享给店铺内的顾客移动终端使用。在这种情况下，顾客移动终端可以考虑优先使用干预后的IP地址列表，而无需自己从DNS服务器拿域名解析结果，以及重排序。S306：判断收银终端与轮询到的IPv6地址是否成功建立连接。由收银终端本身来对IP地址列表中的IPv6地址的可用性进行验证。以选择适用于本店铺业务要求的IPv6地址，比如，选择第一个成功建立连接的IPv6地址。或者通信时延最小的IPv6地址。S308：若是，则在IP地址列表中，将该轮询到的IPv6地址的顺序调整至该自身具有的IPv6地址的顺序之前。再次调整后可以分享给顾客移动终端，顾客移动终端可选地利用该轮询到的IPv6地址，直接连接支付服务器，而无需自己做重排序动作。在图3的流程中，S306和S308是可选的，比如可以在收银终端负担过重时执行。在该轮询到的IPv6地址的顺序调整后，则顾客移动终端则可以通过该IPv6地址与支付服务器直接进行交互，而且基本确保能够成功建立连接，而无需尝试其他的IP地址。在本说明书一个或多个实施例中，在终端尝试与轮询到的IPv6地址或者IPv4地址建立连接之后，可以对在终端上尝试与轮询的IPv6地址建立连接失败的情况进行记录统计，构建出该终端的统计数据，进而，根据统计数据，若连续失败的次数达到设定阈值，则将该终端上的重排序后的IP地址列表中的IPv6地址进行过滤排除，以便之后只尝试与IPv4地址建立连接。通过这种终端IPv6降级的方式，使得该终端后续能够降低在IPv6无谓地浪费时间。当然，也可以在DNS服务器上埋点监控IPv6的成功失败情况，若出现较多IPv6异常时，则通过DNS服务变更，将对应域名的AAAA记录摘除，使得各终端应用不再使用IPv6通信。但是，由于DNS服务器更新域名对应的A记录或者AAAA记录后，还会经过一段缓存时间，才能能够正式生效，那么，在这段时间内，终端还是容易受到影响，因此，实时性和灵活性不如上一段中的方案。直观地，本说明书一个或多个实施例提供了一种终端IPv6降级方案的示意图，如图4所示。在图4中，第一行为原始的IP地址列表，第二行为交叉重排序后的IP地址列表，第三行是终端IPv6降低后的IP地址列表。可以看到，IPv6降级后，IP地址列表中的各IP地址的顺序为，其中已经不再包含IPv6地址。通过上面的方案，在IPv6存在异常时，终端及其搭载的应用能够在秒级切换协议栈，快速高效感知网络环境，对用户的支付等业务体验几乎无影响，保证了服务的高可用性。根据上面的说明，本说明书一个或多个实施例提供了一种应用场景下，图1中方法的具体实施方案，如图5所示。假定在该场景下，用户针对终端上某支付应用发起了支付请求，示例性地利用了上面的一部分方案。图5中的方案概括如下：用户发起支付，DNS服务器解析出目标域名对应的IP地址列表，即。终端获得IP地址列表后，对其中的IP地址进行重排序，重排序后的IP地址列表，即。之后尝试采用复合建立连接的方式轮询列表中的IP地址，若轮询到的多个IPv6地址连续发生异常，不能正常与之建立连接，则在终端进行IPv6降级，降级后的IP地址列表，即，后续在降级后的IP地址列表中继续轮询。如此，在图5的方案中：通过IP地址重排序，使得IPv6和IPv4协议栈能够快速轮转，解决了IPv6异常场景下，长时间无法轮转到IPv4的问题。通过复合建立连接，区别于标准的串行建连方式，每隔很短时间就快速开启新的TCP连接，达到快速建立连接，使用较优IP地址建立连接的目的，进一步地提高了可用性，保证用户体验。通过终端IPv6降级，能够及时地排除过滤掉可能普遍存在异常的多个IPv6地址，只使用IPv4进行通信，从而保证后续通信体验。基于同样的思路，本说明书一个或多个实施例还提供了上述方法对应的装置和设备，如图6、图7所示，虚线方框表示可选的模块。图6为本说明书一个或多个实施例提供的一种双栈网络下的业务处理装置的结构示意图，所述装置包括：业务请求接收模块602，接收指示了目标域名的业务请求；IP地址获取模块604，获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式；IP地址重排序模块606，对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前；轮询建立连接模块608，根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。可选地，所述IP地址重排序模块606，将所述IPv4地址集合中的IPv4地址，与所述IPv6地址集合中的IPv6地址，进行交叉重排序，以使得IPv6地址与IPv4地址，交叉地出现在所述IP地址列表中顺序靠前的位置。可选地，所述IP地址重排序模块606，计算所述IPv6地址集合中各IPv6地址之间的地域分离度；确定已重排序的任一个IPv6地址及其后邻接的一个IPv4地址；在尚未重排序的各IPv6地址中，确定与所述任一个IPv6地址之间的地域分离度高于预期的IPv6地址，作为下一个IPv6地址，将所述下一个IPv6地址排在所述一个IPv4地址邻接的下一个位置。可选地，所述IP地址重排序模块606，在所述进行交叉重排序之后，还执行：动态地将所述交叉重排序后的IPv4地址列表中，处于头部的IP地址流向尾部，其余的IP地址依次顺序前移，以实现顺序轮转的动态重排序。可选地，所述轮询建立连接模块608包括复合建立连接子模块6082；所述复合建立连接子模块6082，确定轮询时对应的建立连接超时时间；设置短于所述建立连接超时时间的复合建立连接等待时间；在所述重排序后的IP地址列表中，尝试与顺序最靠前的一个IP地址建立连接，并对本次尝试建立连接的过程进行计时；若计时达到复合建立连接等待时间，则同时尝试与在所述重排序后的IP地址列表中，顺序在所述一个IP地址之后的下一个IP地址建立连接，并对所述同时尝试建立连接的过程也进行计时，以此类推，直至达成预定的连接建立目标。可选地，所述轮询建立连接模块608，判断所述建立连接超时时间是否过长；若是，则设置远短于所述建立连接超时时间的复合建立连接等待时间。可选地，应用于店铺中的收银终端，所述IP地址重排序模块606，若所述收银终端自身具有IPv6地址，则将所述自身具有的IPv6地址插入至所述IP地址列表中顺序靠前的位置，以实现对所述IP地址列表的重排序；所述IP地址重排序模块606，对所述IP地址列表进行重排序之后，还执行：将所述重排序后的IP地址列表发送给所述店铺中的顾客移动终端，以便所述顾客移动终端通过所述自身具有的IPv6地址，与所述重排序之前的IP地址列表对应的服务器进行间接交互。可选地，所述IP地址重排序模块606，将所述自身具有的IPv6地址插入至所述IP地址列表中顺序靠前的位置之后，还执行：判断所述收银终端与轮询到的IPv6地址是否成功建立连接；若是，则在所述IP地址列表中，将所述轮询到的IPv6地址的顺序调整至所述自身具有的IPv6地址的顺序之前。可选地，应用于终端，所述装置还包括：终端IPv6降级模块610，在所述尝试与轮询到的IPv6地址或者IPv4地址建立连接之后，对在所述终端上尝试与轮询的IPv6地址建立连接失败的情况进行记录统计；若连续失败的次数达到设定阈值，则将所述终端上的所述重排序后的IP地址列表中的IPv6地址进行过滤排除，以便之后只尝试与IPv4地址建立连接。可选地，所述业务请求用于进行支付相关业务。图7为本说明书一个或多个实施例提供的一种双栈网络下的业务处理设备的结构示意图，所述设备包括：至少一个处理器；以及，与所述至少一个处理器通信连接的存储器；其中，所述存储器存储有可被所述至少一个处理器执行的指令，所述指令被所述至少一个处理器执行，以使所述至少一个处理器能够：接收指示了目标域名的业务请求；获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式；对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前；根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。处理器与存储器之间可以通过总线通信，设备还可以包括与其他设备通信的输入/输出接口。基于同样的思路，本说明书一个或多个实施例还提供了对应于图1中方法的一种非易失性计算机存储介质，存储有计算机可执行指令，所述计算机可执行指令设置为：接收指示了目标域名的业务请求；获取通过DNS协议对所述目标域名解析得到的IP地址列表，所述IP地址列表采用了IPv6地址集合顺序在前，IPv4地址集合顺序在后的标准排序方式；对所述IP地址列表进行重排序，以将所述IPv4地址集合中的至少部分IPv4地址的顺序，调整至所述IPv6地址集合中的至少部分IPv6地址的顺序之前；根据所述重排序后的IP地址列表，按顺序轮询其中的IP地址，尝试与轮询到的IPv6地址或者IPv4地址建立连接。在20世纪90年代，对于一个技术的改进可以很明显地区分是硬件上的改进还是软件上的改进。然而，随着技术的发展，当今的很多方法流程的改进已经可以视为硬件电路结构的直接改进。设计人员几乎都通过将改进的方法流程编程到硬件电路中来得到相应的硬件电路结构。因此，不能说一个方法流程的改进就不能用硬件实体模块来实现。例如，可编程逻辑器件)就是这样一种集成电路，其逻辑功能由用户对器件编程来确定。由设计人员自行编程来把一个数字系统“集成”在一片PLD上，而不需要请芯片制造厂商来设计和制作专用的集成电路芯片。而且，如今，取代手工地制作集成电路芯片，这种编程也多半改用“逻辑编译器”软件来实现，它与程序开发撰写时所用的软件编译器相类似，而要编译之前的原始代码也得用特定的编程语言来撰写，此称之为硬件描述语言，而HDL也并非仅有一种，而是有许多种，如ABEL、AHDL、Confluence、CUPL、HDCal、JHDL、Lava、Lola、MyHDL、PALASM、RHDL等，目前最普遍使用的是VHDL与Verilog。本领域技术人员也应该清楚，只需要将方法流程用上述几种硬件描述语言稍作逻辑编程并编程到集成电路中，就可以很容易得到实现该逻辑方法流程的硬件电路。控制器可以按任何适当的方式实现，例如，控制器可以采取例如微处理器或处理器以及存储可由该处理器执行的计算机可读程序代码的计算机可读介质、逻辑门、开关、专用集成电路、可编程逻辑控制器和嵌入微控制器的形式，控制器的例子包括但不限于以下微控制器：ARC625D、Atmel AT91SAM、Microchip PIC18F26K20以及Silicone Labs C8051F320，存储器控制器还可以被实现为存储器的控制逻辑的一部分。本领域技术人员也知道，除了以纯计算机可读程序代码方式实现控制器以外，完全可以通过将方法步骤进行逻辑编程来使得控制器以逻辑门、开关、专用集成电路、可编程逻辑控制器和嵌入微控制器等的形式来实现相同功能。因此这种控制器可以被认为是一种硬件部件，而对其内包括的用于实现各种功能的装置也可以视为硬件部件内的结构。或者甚至，可以将用于实现各种功能的装置视为既可以是实现方法的软件模块又可以是硬件部件内的结构。上述实施例阐明的系统、装置、模块或单元，具体可以由计算机芯片或实体实现，或者由具有某种功能的产品来实现。一种典型的实现设备为计算机。具体的，计算机例如可以为个人计算机、膝上型计算机、蜂窝电话、相机电话、智能电话、个人数字助理、媒体播放器、导航设备、电子邮件设备、游戏控制台、平板计算机、可穿戴设备或者这些设备中的任何设备的组合。为了描述的方便，描述以上装置时以功能分为各种单元分别描述。当然，在实施本说明书时可以把各单元的功能在同一个或多个软件和/或硬件中实现。本领域内的技术人员应明白，本说明书实施例可提供为方法、系统、或计算机程序产品。因此，本说明书实施例可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本说明书实施例可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本说明书是参照根据本说明书实施例的方法、设备、和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。在一个典型的配置中，计算设备包括一个或多个处理器、输入/输出接口、网络接口和内存。内存可能包括计算机可读介质中的非永久性存储器，随机存取存储器和/或非易失性内存等形式，如只读存储器或闪存。内存是计算机可读介质的示例。计算机可读介质包括永久性和非永久性、可移动和非可移动媒体可以由任何方法或技术来实现信息存储。信息可以是计算机可读指令、数据结构、程序的模块或其他数据。计算机的存储介质的例子包括，但不限于相变内存、静态随机存取存储器、动态随机存取存储器、其他类型的随机存取存储器、只读存储器、电可擦除可编程只读存储器、快闪记忆体或其他内存技术、只读光盘只读存储器、数字多功能光盘或其他光学存储、磁盒式磁带，磁带磁磁盘存储或其他磁性存储设备或任何其他非传输介质，可用于存储可以被计算设备访问的信息。按照本文中的界定，计算机可读介质不包括暂存电脑可读媒体，如调制的数据信号和载波。还需要说明的是，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、商品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、商品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括所述要素的过程、方法、商品或者设备中还存在另外的相同要素。本说明书可以在由计算机执行的计算机可执行指令的一般上下文中描述，例如程序模块。一般地，程序模块包括执行特定任务或实现特定抽象数据类型的例程、程序、对象、组件、数据结构等等。也可以在分布式计算环境中实践本说明书，在这些分布式计算环境中，由通过通信网络而被连接的远程处理设备来执行任务。在分布式计算环境中，程序模块可以位于包括存储设备在内的本地和远程计算机存储介质中。本说明书中的各个实施例均采用递进的方式描述，各个实施例之间相同相似的部分互相参见即可，每个实施例重点说明的都是与其他实施例的不同之处。尤其，对于装置、设备、非易失性计算机存储介质实施例而言，由于其基本相似于方法实施例，所以描述的比较简单，相关之处参见方法实施例的部分说明即可。上述对本说明书特定实施例进行了描述。其它实施例在所附权利要求书的范围内。在一些情况下，在权利要求书中记载的动作或步骤可以按照不同于实施例中的顺序来执行并且仍然可以实现期望的结果。另外，在附图中描绘的过程不一定要求示出的特定顺序或者连续顺序才能实现期望的结果。在某些实施方式中，多任务处理和并行处理也是可以的或者可能是有利的。以上所述仅为本说明书的一个或多个实施例而已，并不用于限制本说明书。对于本领域技术人员来说，本说明书的一个或多个实施例可以有各种更改和变化。凡在本说明书的一个或多个实施例的精神和原理之内所作的任何修改、等同替换、改进等，均应包含在本说明书的权利要求范围之内。
