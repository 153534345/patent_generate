标题title
一种基于MQTT的物联网构建多联机的方法
摘要abst
本发明公开了一种基于MQTT的物联网构建多联机的方法，根据所提供的多联机设备唯一标识，让云端建立有效的智能模组进行通信，将多联机各个内外机进行构建。本发明的构建方法更加灵活，可直接向智能模组请求由智能模组返回冷媒、内外机数据进行构建，或将冷媒、内外机数据传输给智能模组由模组进行判断，并返回正确数据，云端平台再根据返回数据进行更新操作，此方式可多次进行构建，不会存在漏包、错包的情况。后续若需增加新的冷媒或更换内外机设备无需全部重复操作，只需发送构建请求即可；也能够便于对接各种不同类型，不同型号的设备。
权利要求书clms
1.一种基于MQTT的物联网构建多联机的方法，其特征在于，包括以下步骤：S1：用户在客户端录入设备信息包含设备唯一标识SN；S2：将智能通信模组上电，上电后根据配置好的MQTT地址进行请求，发送设备连接信息；S3：智能通信模组根据设备唯一标识SN生成秘钥将数据传输给MQTT，MQTT将数据转发到云端平台；S4：云端平台接收到数据后，将秘钥进行解密拿到SN与客户端录入的设备信息进行匹配；S5：匹配成功后，云端平台将秘钥信息进行存储，并将设备状态修改为激活状态，且MQTT设置完成设备信息传输通道；S6：将智能通信模组的冷媒地址、内外机地址根据设备唯一标识进行配置，并将所有的设备进行上电；S7：客户端下发构建命令，云端平台将指令进行加密并将秘钥一并传输给MQTT；S8：MQTT将数据转发给智能通信模组，模组解析指令并验证秘钥是否匹配；S9：匹配成功后，智能模组开始循环各个冷媒、内外机地址数据，将数量以及数据打包发送给MQTT，MQTT再将数据传输给云端平台；S10：云端平台接收到数据后进行解密并验证秘钥，验证通过后将各个冷媒、内外机数据写入系统中，多联机系统构建完成。2.如权利要求1所述的一种基于MQTT的物联网构建多联机的方法，其特征在于，多联机系统构建完成，后续新增冷媒或内外机，其步骤如下：S111：首先将新增设备配置好并上电，然后用户在客户端录入新增的冷媒或内外机数据，向云端平台发送反向构建请求；S112：云端平台收到请求后对数据进行加密并附上秘钥后传输给MQTT，MQTT将数据转发给智能通信模组；S113：智能通信模组接收到信息后进行解密并匹配秘钥，匹配成功后，智能模组进行设备数据的循环，查询到有此新增设备即将数据通过MQTT返回给云端平台；S114：云端平台对数据做解密处理后进行数据的更新操作，此时新的冷媒与内外机便建立好了连接。3.如权利要求1所述的一种基于MQTT的物联网构建多联机的方法，其特征在于，所述录入设备信息包含设备唯一标识信息SN、设备型号。4.如权利要求1所述的一种基于MQTT的物联网构建多联机的方法，其特征在于，所述步骤S2中需保证整个过程中设备都处于上电状态，且配置信息与当前使用环境匹配；若配置的通信模式为wifi模式，则需要配置好wifi名称以及密码，上电后智能通信模块会自动连接wifi。5.如权利要求1所述的一种基于MQTT的物联网构建多联机的方法，其特征在于，所述步骤S3的秘钥是根据设备唯一标识以及时间戳生成的秘钥，只在第一次上电请求的时候生成。6.如权利要求1所述的一种基于MQTT的物联网构建多联机的方法，其特征在于，所有数据进行加密传输，加解密算法是基于MD5的加解密算法，且每次都会将秘钥一并进行传输，云端平台拿到数据后先匹配秘钥，匹配成功后根据解密协议进行解密拿到数据，后续云端平台将数据传输给智能通信模块，智能通信模块同样的匹配秘钥后根据加解密协议进行解密数据。7.如权利要求1所述的一种基于MQTT的物联网构建多联机的方法，其特征在于，所述步骤S6中的冷媒、内外机逻辑地址是根据设备唯一标识进行配置，保证了每台设备的冷媒、内外机地址唯一。8.如权利要求1所述的一种基于MQTT的物联网构建多联机的方法，其特征在于，所述多联机是多个外机与多个内机的通信方式，只要其中一台外机在工作则可带动其对应冷媒下的所有内机进行工作，并且各个内机可独立进行状态控制操作，若所有外机处于关闭状态，则所有内机也将处于关闭状态。9.如权利要求1所述的一种基于MQTT的物联网构建多联机的方法，其特征在于，所述多联机系统都有一个设备唯一标识即SN，系统包含多个冷媒、冷媒下又包含多台外机、多台内机设备，其中每个冷媒都会有与之对应的唯一ID进行设备的区分。
说明书desc
技术领域本发明涉及物联网技术领域，尤其涉及一种基于MQTT的物联网构建多联机的方法。背景技术随着多联机中央空调蓬勃发展，各个商场、写字楼纷纷安装，为多联机的未来发展提供了一个重要方向，各大厂商纷纷推出自己的物联网中央空调，将多联机的用户体验提升到一个新的境界。但是市场的机遇与技术应用的成熟往往是矛盾的存在，由于安全防范不到位，多联机设备数据容易被非法劫持以及篡改，导致接受到的数据存在不可靠性，这时需要对设备数据进行安全认证与监管确保数据的真实性并能及时获得最新的有效数据反馈给用户。现有的多联机设备，防止产品数据被复制的常用方式是将设备加密，即采用加密芯片技术：在设备内部放置一颗加密芯片，在运行程序时与加密芯片进行密文交换，对加密后的随机码和解密后的解密值进行对比校验，校验一致则程序正常运行；或者是将设备运行的一部分关键代码放在加密芯片中执行，使得入侵方无法获得设备运行的完整代码，无法实现设备的完整复制。加密芯片的确可以起到一定的防破解作用，但性能良好的加密芯片价格高，加密芯片的使用增加了设备成本。因此，需要采用一种更加安全、简便的多联机构建方法，使得设备在激活构建以及数据传输中更加安全可靠。目前已有的专利申请，公开号：CN113865023A，名称：一种多联机空调系统。该专利申请包括：该发明公开了一种多联机空调系统，设备在接收到云端服务器发送的认证码上传指令后，将自身认证码上传至云端服务器；并接收云端服务器返回的认证结果，如果认证结果为失败，则该本地设备停机。此专利申请的缺点在于：第一，此专利申请的认证码将多联机的冷媒、内外机等设备都分开了，需逐步认证每一个设备的认证码，若其中有一个设备未上电或连接错误，整个过程将导致设备停机，无法进一步操作；第二，此专利申请中一个通信模组连接一台外机，若有多台外机或冷媒，此方法的的操作性有待考量。目前已有的专利申请，公开号：CN108562024A，名称：多联机空调系统的集控方法。该发明的调试终端基于识别码发送第一获取请求至云服务器，集控装置基于交付码发送第二请求至所述云服务器，集控装置基于所述工程信息装载交付码激活工程。此专利申请的缺点在于一旦后续需添加冷媒或内外机设备，只能全部重新再操作一次，过程繁琐且多余。目前已有的专利申请，公开号：CN204043128U，名称：一种多联机空调系统。该发明包括室外机、室内机和线控器，室外机和室内机通过第一层网络连接，室内机和线控器通过第二层网络连接，通讯网络间通过CAN总线协议通信。此专利申请的缺点在于：第一，此专利申请要求室内机数量不能超过16个，对内机数量有要求；第二，此系统只能通过线控器进行通信，无法切换通信模式导致模式单一，且线控器数量至少需要两个。发明内容本发明的目的就在于为了解决上述问题而提供一种基于MQTT的物联网构建多联机的方法，通过提供一种有线、4G、5G的物联网通信设备，根据所提供的多联机设备唯一标识，让云端建立有效的智能模组进行通信，将多联机各个内外机进行构建的方案，能够便于对接各种不同类型，不同型号的设备。本发明通过以下技术方案来实现上述目的：一种基于MQTT的物联网构建多联机的方法，包括以下步骤：S1：用户在客户端录入设备信息包含设备唯一标识SN；S2：将智能通信模组上电，上电后根据配置好的MQTT地址进行请求，发送设备连接信息；S3：智能通信模组根据设备唯一标识SN生成秘钥将数据传输给MQTT，MQTT将数据转发到云端平台；S4：云端平台接收到数据后，将秘钥进行解密拿到SN与客户端录入的设备信息进行匹配；S5：匹配成功后，云端平台将秘钥信息进行存储，并将设备状态修改为激活状态，且MQTT设置完成设备信息传输通道；S6：将智能通信模组的冷媒地址、内外机地址根据设备唯一标识进行配置，并将所有的设备进行上电；S7：客户端下发构建命令，云端平台将指令进行加密并将秘钥一并传输给MQTT；S8：MQTT将数据转发给智能通信模组，模组解析指令并验证秘钥是否匹配；S9：匹配成功后，智能模组开始循环各个冷媒、内外机地址数据，将数量以及数据打包发送给MQTT，MQTT再将数据传输给云端平台；S10：云端平台接收到数据后进行解密并验证秘钥，验证通过后将各个冷媒、内外机数据写入系统中，多联机系统构建完成。进一步方案为，多联机系统构建完成，后续新增冷媒或内外机，其步骤如下：S111：首先将新增设备配置好并上电，然后用户在客户端录入新增的冷媒或内外机数据，向云端平台发送反向构建请求；S112：云端平台收到请求后对数据进行加密并附上秘钥后传输给MQTT，MQTT将数据转发给智能通信模组；S113：智能通信模组接收到信息后进行解密并匹配秘钥，匹配成功后，智能模组进行设备数据的循环，查询到有此新增设备即将数据通过MQTT返回给云端平台；S114：云端平台对数据做解密处理后进行数据的更新操作，此时新的冷媒与内外机便建立好了连接。进一步方案为，所述录入设备信息包含设备唯一标识信息SN、设备型号。进一步方案为，所述步骤S2中需保证整个过程中设备都处于上电状态，且配置信息与当前使用环境匹配；若配置的通信模式为wifi模式，则需要配置好wifi名称以及密码，上电后智能通信模块会自动连接wifi。进一步方案为，所述步骤S3的秘钥是根据设备唯一标识以及时间戳生成的秘钥，只在第一次上电请求的时候生成。进一步方案为，所有数据进行加密传输，加解密算法是基于MD5的加解密算法，且每次都会将秘钥一并进行传输，云端平台拿到数据后先匹配秘钥，匹配成功后根据解密协议进行解密拿到数据，后续云端平台将数据传输给智能通信模块，智能通信模块同样的匹配秘钥后根据加解密协议进行解密数据。进一步方案为，所述步骤S6中的冷媒、内外机逻辑地址是根据设备唯一标识进行配置，保证了每台设备的冷媒、内外机地址唯一。进一步方案为，所述多联机是多个外机与多个内机的通信方式，只要其中一台外机在工作则可带动其对应冷媒下的所有内机进行工作，并且各个内机可独立进行状态控制操作，若所有外机处于关闭状态，则所有内机也将处于关闭状态。进一步方案为，所述多联机系统都有一个设备唯一标识即SN，系统包含多个冷媒、冷媒下又包含多台外机、多台内机设备，其中每个冷媒都会有与之对应的唯一ID进行设备的区分。本发明的有益效果在于：现有技术的数据加密手段是利用加密芯片进行加密，成本高，本发明是根据设备唯一标识加时间戳生成的秘钥，更加的安全，可做到一机一密，比已有的方法成本更低、更可靠。现有技术中，设备在构建过程中传输了大量的数据，包含了冷媒、内外机数据，众所周知，构建是需要一定的时间的，大量的数据会导致处理时间更长，并且一旦过程中有一台设备未进行上电或网络中断，设备将无法激活，导致整个过程都需要重走一遍，后续还需对每台冷媒、内外机都进行逐一排查，使得过程十分漫长，效率降低。本发明中，先进行设备的激活，后续再进行冷媒、内外机的构建，将步骤分开，大大的提高了构建效率。现有技术在构建中直接将冷媒、内外机数据传输给设备，数据得保证完整和正确，一旦有问题则构建失败。本发明的构建方法更加灵活，可直接向智能模组请求由智能模组返回冷媒、内外机数据进行构建，或将冷媒、内外机数据传输给智能模组由模组进行判断，并返回正确数据，云端平台再根据返回数据进行更新操作，此方式可多次进行构建，不会存在漏包、错包的情况。后续若需增加新的冷媒或更换内外机设备无需全部重复操作，只需发送构建请求即可。现有设备在配网方式中只能进行单一模式配网，不可随意选择，本发明智能模组可实现多种配网方式，如4G、5G、有线等，能满足不同的使用场景。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例或现有技术描述中所需要实用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明模组向云端平台进行认证示意图；图2为本发明云端平台向智能模组进行构建请求示意图；图3为本发明一个多联机系统结构示意图；图4为本发明一次多联机构建过程示意图。具体实施方式为使本发明的目的、技术方案和优点更加清楚，下面将对本发明的技术方案进行详细的描述。显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动的前提下所得到的所有其它实施方式，都属于本发明所保护的范围。在任一实施例中，如图1-4所示，本发明一种基于MQTT的物联网构建多联机的方法，包括以下步骤：S1：用户在客户端录入设备信息包含设备唯一标识SN；S2：将智能通信模组上电，上电后根据配置好的MQTT地址进行请求，发送设备连接信息；S3：智能通信模组根据设备唯一标识SN生成秘钥将数据传输给MQTT，MQTT将数据转发到云端平台；S4：云端平台接收到数据后，将秘钥进行解密拿到SN与客户端录入的设备信息进行匹配；S5：匹配成功后，云端平台将秘钥信息进行存储，并将设备状态修改为激活状态，且MQTT设置完成设备信息传输通道；S6：将智能通信模组的冷媒地址、内外机地址根据设备唯一标识进行配置，并将所有的设备进行上电；S7：客户端下发构建命令，云端平台将指令进行加密并将秘钥一并传输给MQTT；S8：MQTT将数据转发给智能通信模组，模组解析指令并验证秘钥是否匹配；S9：匹配成功后，智能模组开始循环各个冷媒、内外机地址数据，将数量以及数据打包发送给MQTT，MQTT再将数据传输给云端平台；S10：云端平台接收到数据后进行解密并验证秘钥，验证通过后将各个冷媒、内外机数据写入系统中，多联机系统构建完成。多联机系统构建完成，后续新增冷媒或内外机，其步骤如下：S111：首先将新增设备配置好并上电，然后用户在客户端录入新增的冷媒或内外机数据，向云端平台发送反向构建请求；S112：云端平台收到请求后对数据进行加密并附上秘钥后传输给MQTT，MQTT将数据转发给智能通信模组；S113：智能通信模组接收到信息后进行解密并匹配秘钥，匹配成功后，智能模组进行设备数据的循环，查询到有此新增设备即将数据通过MQTT返回给云端平台；S114：云端平台对数据做解密处理后进行数据的更新操作，此时新的冷媒与内外机便建立好了连接。在一个具体实施例中，本发明另一方面的一种基于MQTT的物联网构建多联机的方法的调节方法，包括，拿到智能模组信息后，确认模组的通信方式以及MQTT地址，客户端将智能模组SN号即设备唯一标识录入云端平台；将智能通信模组上电，上电后根据配置好的MQTT地址进行请求，发送设备连接信息；MQTT接收到秘钥信息后，请求云端平台；云端平台接收到信息后，对秘钥进行解码，解码后拿到设备唯一标识进行匹配，匹配成功后将秘钥进行保存，并将设备状态改为激活；云端平台将设备信息传输给MQTT与之建立起通信通道，通信通道建立好后将信息返回给智能通信模组；智能模组接收到激活信息后，就可开始下一步构建内外机工作；将设备内外机的地址分配好后，全部进行上电；客户端点击构建操作，云端接收到请求后将秘钥以及指令传输给MQTT；或客户端主动添加内外机地址等数据信息，然后发送构建请求。MQTT将数据传输给智能通信模组，模组将秘钥进行匹配，匹配成功后开始进行循环内外机地址信息，接着将设备内外机信息传输回MQTT。MQTT返回给云端平台，云端进行解析后将内外机数据进行存储处理。云端平台接收到数据信息后进行加密并将秘钥一并传输给MQTT，MQTT将数据传输给智能通信模组。智能通信模组将数据进行解密并对比秘钥，匹配成功后将内外机信息与之进行配对，配对成功的内外机信息将被返回给MQTT。MQTT将数据传输给云端平台，平台将数据进行处理，过滤到无效的内外机设备信息，对有效的数据进行更新。以上所述，仅为本发明的具体实施方式，但本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，可轻易想到变化或替换，都应涵盖在本发明的保护范围之内。因此，本发明的保护范围应以所述权利要求的保护范围为准。另外需要说明的是，在上述具体实施方式中所描述的各个具体技术特征，在不矛盾的情况下，可以通过任何合适的方式进行组合，为了避免不必要的重复，本发明对各种可能的组合方式不再另行说明。此外，本发明的各种不同的实施方式之间也可以进行任意组合，只要其不违背本发明的思想，其同样应当视为本发明所公开的内容。
