标题title
通信状态切换、端口配置方法、通信系统及介质
摘要abst
本申请实施例提供了一种通信装置及设备，通过设置调相电路，充电电路和天线，将电磁信号转换为电能为通信装置提供能源，从而实现对通信设备远距离无线供电和充电，减少供电线路，提升设备使用和安装部署的灵活性，降低安装和维护成本。
权利要求书clms
1.一种链路聚合系统通信状态切换方法，应用于包括网关设备、第一交换机、第二交换机和服务器的跨设备链路聚合系统，所述方法包括：所述第一交换机端口与所述服务器端口之间的通信故障；所述网关设备接收故障信息；所述第二交换机端口与所述服务器端口建立通信连接；所述第二交换机接收所述服务器端口对应的主机路由；所述第二交换机根据所述主机路由生成32位掩码子网路由；所述网关设备接收所述32位掩码子网路由；所述网关设备根据所述32位掩码子网路由，通过所述第二交换机与所述服务器端口建立通信连接。2.根据权利要求1所述的方法，其特征在于，在所述第一交换机端口与所述服务器端口之间的通信故障前，还包括：所述第一交换机端口与所述网关设备端口、所述服务器端口建立映射关系；所述第二交换机端口与所述网关设备端口、所述服务器端口建立映射关系。3.根据权利要求1或2所述的方法，其特征在于，所述跨设备链路聚合系统不包括连接第一交换机和所述第二交换机的直连聚合链路。4.根据权利要求1或2所述的方法，其特征在于，所述第一交换机至少包括第一端口，所述第二交换机至少包括第二端口，所述服务器至少包括第三端口；在所述第一交换机端口与所述服务器端口之间的通信故障前，还包括：所述第一交换机接收所述第三端口对应的主机路由；所述第一交换机根据所述第三端口对应的主机路由生成所述第三端口对应的32位掩码子网路由；所述网关设备获取所述第三端口对应的32位掩码子网路由。5.根据权利要求4所述的方法，其特征在于，所述第一交换机端口与所述服务器端口之间的通信故障，包括：所述第一端口与所述第三端口之间的链路故障；所述网关设备接收故障信息，包括：所述第一交换机与所述服务器的所述第三端口断开通信连接；所述第一交换机发送故障信息至所述网关设备，其中所述故障信息包括所述第一交换机也所述第三端口断开通信连接的信息；所述网关设备接收所述故障信息；所述第二交换机端口与所述服务器端口建立通信连接，包括：所述第二端口切换路径与所述第三端口之间建立通信连接；所述第二交换机接收所述服务器端口对应的主机路由，包括：所述第二交换机接收所述第三端口对应的主机路由；所述第二交换机根据所述主机路由生成32位掩码子网路由，包括：所述第二交换机根据所述第三端口对应的主机路由生成所述第三端口对应的32位掩码子网路由；所述网关设备接收所述32位掩码子网路由，包括：所述网关设备接收所述第三端口对应的32位掩码子网路由；所述网关设备根据所述32位掩码子网路由，通过所述第二交换机与所述服务器端口建立通信连接，包括：所述网关设备根据所述第三端口对应的32位掩码子网路由，通过所述第二交换机与所述第三端口建立通信连接。6.根据权利要求1、2、5任一项所述的方法，其特征在于，所述端口至少包括以下之一：物理端口；虚拟端口。7.一种链路聚合系统通信状态切换方法，应用于包括网关设备、第一交换机、第二交换机和服务器的跨设备链路聚合系统，所述方法包括：所述网关设备端口与所述第一交换机端口之间的通信故障；所述第一交换机与所述服务器断开通信连接；所述第二交换机端口与所述服务器端口建立通信连接；所述第二交换机接收所述服务器端口对应的主机路由；所述第二交换机根据所述主机路由生成32位掩码子网路由；所述网关设备接收所述32位掩码子网路由；所述网关设备根据所述32位掩码子网路由，通过所述第二交换机与所述服务器端口建立通信连接。8.根据权利要求7所述的方法，其特征在于，在所述网关设备端口与所述第一交换机端口之间的前，还包括：所述第一交换机端口与所述网关设备端口、所述服务器端口建立映射关系；所述第二交换机端口与所述网关设备端口、所述服务器端口建立映射关系。9.根据权利要求7或8所述的方法，其特征在于，所述跨设备链路聚合系统不包括连接第一交换机和所述第二交换机的直连聚合链路。10.根据权利要求7或8所述的方法，其特征在于，所述第一交换机至少包括第一端口，所述第二交换机至少包括第二端口，所述服务器至少包括第三端口；在所述网关设备端口与所述第一交换机端口之间的通信故障前，还包括：所述第一交换机接收所述第三端口对应的主机路由；所述第一交换机根据所述第三端口对应的主机路由生成所述第三端口对应的32位掩码子网路由；所述网关设备获取所述第三端口对应的32位掩码子网路由。11.根据权利要求10所述的方法，其特征在于，所述网关设备端口与所述第一交换机端口之间的通信故障，包括：所述网管设备与所述第一交换机的第一端口之间的链路故障；所述第一交换机与所述服务器断开通信连接，包括：所述第一交换机与所述第三端口断开通信连接；所述第二交换机端口与所述服务器端口建立通信连接，包括：所述第二端口与所述第三端口建立通信连接；所述第二交换机接收所述服务器端口对应的主机路由，包括：所述第二交换机接收所述第三端口对应的主机路由；所述第二交换机根据所述主机路由生成32位掩码子网路由，包括：所述第二交换机根据所述第三端口对应的主机路由生成所述第三端口对应的32位掩码子网路由；所述网关设备根据所述32位掩码子网路由，通过所述第二交换机与所述服务器端口建立通信连接，包括：所述网关设备根据所述第三端口对应的32位掩码子网路由，通过所述第二交换机与所述第三端口建立通信连接。12.根据权利要求7、8、10任一项所述的方法，其特征在于，所述端口至少包括以下之一：物理端口；虚拟端口。13.一种链路聚合系统端口的配置方法，应用于跨设备链路聚合系统的网关设备，其特征在于，所述方法包括：获取子网路由，其中，所述子网路由根据服务器发送的主机路由得到，所述子网路由为三十二位掩码子网路；与所述服务器的端口建立映射关系。14.根据权利要求13所述的方法，其特征在于，所述系统还包括交换机和服务器；所述子网路由根据服务器发送的主机路由得到，包括：所述交换机接收所述服务器发送的所述主机路由；所述交换机根据所述主机路由生成所述32位掩码子网路由。15.根据权利要求13或14所述的方法，其特征在于，所述与所述服务器端口建立映射关系，包括：与所述服务器端口建立状态映射关系，其中，所述状态映射关系包括至少以下之一：上行状态的映射关系；下行状态的映射关系。16.根据权利要求13或14所述的方法，其特征在于，所述跨设备链路聚合系统不包括直连聚合链路。17.一种通信系统，其特征在于，所述通信系统执行如权利要求1至12中任意一项所述的通信状态切换方法或执行如权利要求13至16中任意一项所述的配置方法。18.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质存储有计算机可执行指令，所述计算机可执行指令用于执行如权利要求1至12中任意一项所述的通信状态切换方法或执行如权利要求13至16中任意一项所述的配置方法。19.一种计算机程序产品，包括计算机程序或计算机指令，其特征在于，所述计算机程序或所述计算机指令存储在计算机可读存储介质中，计算机设备的处理器从所述计算机可读存储介质读取所述计算机程序或所述计算机指令，所述处理器执行所述计算机程序或所述计算机指令，使得所述计算机设备执行如权利要求1至12中任意一项所述的通信状态切换方法或执行如权利要求13至16中任意一项所述的配置方法。
说明书desc
技术领域本申请实施例涉及但不限于通信技术领域，特别涉及一种通信状态切换方法、通信系统端口配置方法、通信系统、存储介质及程序产品。背景技术跨设备链路聚合组是一种实现跨设备链路聚合的机制，通过将一台设备与另外两台设备进行跨设备链路聚合，从而把链路可靠性从单板级提高到了设备级，组成双活系统。相关技术中，为确保MLGA交换机系统中主设备和备设备互相之间冗余备份，需建立直连聚合链路。即主设备和备设备通过直连聚合链路连接。然而上述方式，提高了配置和维护难度。如何简化MLGA系统中设备之间的交互过程，降低维护难度，是当下亟待讨论和解决的问题。发明内容本申请实施例提供一种通信状态切换方法、通信系统端口配置方法、通信系统、存储介质及程序产品，旨在优化MLGA系统中设备之间的交互作业过程，提升设备的易维护性。第一方面，本申请实施例提供一种链路聚合系统通信状态切换方法，所述方法包括：所述第一交换机端口与所述服务器端口之间的通信故障；所述网关设备接收故障信息；所述第二交换机端口与所述服务器端口建立通信连接；所述第二交换机接收所述服务器端口对应的主机路由；所述第二交换机根据所述主机路由生成32位掩码子网路由；所述网关设备接收所述32位掩码子网路由；所述网关设备根据所述32位掩码子网路由，通过所述第二交换机与所述服务器端口建立通信连接。第二方面，本申请实施例提供一种链路聚合系统通信状态切换方法，所述方法包括：所述网关设备端口与所述第一交换机端口之间的通信故障；所述第一交换机与所述服务器断开通信连接；所述第二交换机端口与所述服务器端口建立通信连接；所述第二交换机接收所述服务器端口对应的主机路由；所述第二交换机根据所述主机路由生成32位掩码子网路由；所述网关设备接收所述32位掩码子网路由；所述网关设备根据所述32位掩码子网路由，通过所述第二交换机与所述服务器端口建立通信连接。第三方面，本申请实施例提供一种链路聚合系统端口的配置方法，所述方法包括：获取子网路由，其中，所述子网路由根据服务器发送的主机路由得到，所述子网路由为三十二位掩码子网路；与所述服务器的端口建立映射关系。第四方面，本申请实施例提供一种通信系统，所述通信系统执行如第一方面、第二方面或第三方面中任意一项所述方法。第五方面，本申请实施例提供一种计算机可读存储介质，所述计算机可读存储介质存储有计算机可执行指令，所述计算机可执行指令用于执行如第一方面、第二方面或第三方面中任意一项所述方法。第六方面，本申请实施例提供一种计算机程序产品，所述计算机程序或所述计算机指令存储在计算机可读存储介质中，计算机设备的处理器从所述计算机可读存储介质读取所述计算机程序或所述计算机指令，所述处理器执行所述计算机程序或所述计算机指令，使得所述计算机设备执行如第一方面、第二方面或第三方面中任意一项所述方法。附图说明图1是直连聚合链路的链路聚合通信系统示意图；图2是本申请一实施例应用通信系统示意图；图3是本申请一实施例链路聚合系统端口的配置方法示意图；图4是本申请一实施例链路聚合系统通信状态切换方法应用场景示意图；图5是本申请一实施例链路聚合系统通信状态切换方法示意图；图6是本申请一实施例链路聚合系统通信状态切换方法示意图；图7是本申请一实施例链路聚合系统通信状态切换方法示意图；图8是本申请一实施例链路聚合系统通信状态切换方法示意图；图9是本申请一实施例链路聚合系统通信状态切换方法示意图；图10是本申请一实施例链路聚合系统通信状态切换方法示意图。具体实施方式为了使本申请的目的、技术方案及优点更加清楚，以下结合附图及实施例，对本申请进行进一步详细说明。应当理解，此处所描述的具体实施例仅用以解释本申请，并不用于限定本申请。需要说明的是，虽然在装置示意图中进行了功能模块划分，在流程图中示出了逻辑顺序，但是在某些情况下，可以以不同于装置中的模块划分，或流程图中的顺序执行所示出或描述的步骤。说明书和权利要求书及上述附图中的术语“第一”、“第二”等是用于区别类似的对象，而不必用于描述特定的顺序或先后次序。本申请实施例的描述中，除非另有明确的限定，设置、安装、连接等词语应做广义理解，所属技术领域技术人员可以结合技术方案的具体内容合理确定上述词语在本申请实施例中的具体含义。本申请实施例中，“进一步地”、“示例性地”或者“可选地”等词用于表示作为例子、例证或说明，不应被解释为比其它实施例或设计方案更优选或更具有优势。使用“进一步地”、“示例性地”或者“可选地”等词旨在以具体方式呈现相关概念。本申请实施例可以在诸如一组计算机可执行指令的计算机系统中执行。并且，虽然在附图的流程图中示出了逻辑顺序，但是在某些情况下，可以以不同于此处的顺序执行所示出或描述的步骤。本申请实施例可以应用于各种通信系统，例如：全球移动通讯系统、码分多址系统、宽带码分多址系统、通用分组无线业务、长期演进系统、LIE-A系统、通用移动通信系统、5G、超5代、第6代系统等，本申请实施例并不限定。链路聚合通信系统一种实现跨设备链路聚合的机制。跨设备链路聚合交换机系统中，进行链路聚合的设备不仅可以是交换机，也可以是路由器等其他网络设备。本申请实施例将采用网关设备、交换机以及服务器作为示例进行说明，但本领域技术人员知晓，本申请中涉及的方法在其他网络设备构成的跨设备链路聚合系统中同样适用。链路聚合通信系统的两台设备之间，需要互相之间冗余备份，互相进行表项同步，因此需要在两台主备设备之间需要建立直连聚合链路。此链路担负着两台设备之间的协议交互，以及两台设备的链路出现故障时，数据交互的任务。为详尽阐述本技术方案，以直连聚合链路的链路聚合通信系统为例，对链路聚合通信系统做进一步解释说明。图1是直连聚合链路的链路聚合通信系统示意图。如图1所示，该系统包括至少包括网关设备100，第一交换机210，第二交换机220，服务器300。图1所示的服务器300包括第一服务器310和第二服务器320。为确保链路出现故障时，系统持续作业，第一交换机210和第二交换机220通过直连聚合链路连接。具体而言，第一交换机210和第二交换机220之间需要运行交互协议，保障两台设备之间的所有表项均同步，此时若链路出现故障，可以将所有流量切换至另外一台设备进行转发，避免上下行流量长时间的业务中断。上述链路聚合配置较为复杂，且需在主备设备之间运行交互协议，占用设备资源。此外，主备设备之间还需要同步表项，因此两台设备的表项资源并不仅包括自身设备连接的所有上下游设备的转发信息，还需要同步另外一台设备的所有上下游设备转发信息，对设备的表项资源存在比较大的浪费。本申请实施例提供了一种通信状态切换方法、通信系统端口配置方法、通信系统、存储介质及程序产品。采用本申请实施例的方法和系统，无需设置直连链路，即不涉及主备设备，之间的互相表项同步的过程，简化交互过程，降低占用资源。本申请实施例主备设备独立承担转发任务，当出现故障或需要进行主备切换的时候，采用整体链路切换的方法。采用本申请的方法可以使得跨设备链路聚合系统中的两台设备诸如交换机可以独立运转，无需在第一交换机和第二交换机之间建立直连链路，并且无需在两台交换机之间进行复杂的协议交互和数据交互，即可达到互相链路备份的效果。采用本申请实施例的方法仅可以起到跨设备链路聚合系统的链路级保护，又使两台交换机独立运作，优化设备之间的复杂交互过程，提升了网络设备的易维护性，同时也实现了网络设备的冗余保护，提升了网络的可靠性下面结合附图，对本申请实施列作进一步阐述。图2是本申请一实施例应用通信系统示意图。如图2所示，该系统包括至少包括网关设备100，第一交换机210，第二交换机220，服务器300。图2所示的服务器300包括第一服务器310和第二服务器320。可以理解，本申请实施例也适用于一个服务器的情形。与图1相比可知，本实施例的链路聚合系统无需在第一交换机210和第二交换机220之间设置直连链路。采用本技术方案，当系统出现链路级或者设备级故障时，通过对故障设备的端口联动和主机路由撤销的技术，以使得故障设备的转发链路可以快速切换到另一台设备上。从而既满足跨设备链路聚合系统的两台设备独立运行的效果，又能够达到第一交换机210和第二交换机220互为主备进行转发保护的效果。图3是本申请一实施例链路聚合系统端口的配置方法示意图。如图3所示，链路聚合系统的交换机设备200上行与网关设备100通信连接，下行与服务器300通信连接。在一实施例中，交换机设备200包括两个，以下以第一交换机210，第二交换机220为例进行说明。在一实施例中，服务器设备300可以包括两个，如第一服务器310，第二服务器320。也可以只包括一个，如包括多个虚拟机的一个服务器。本实施例链路聚合系统端口的配置方法，应用于跨设备链路聚合系统的网关设备，如图2所示的通信系统。所述方法至少包括：步骤S100：获取服务器设备300的子网路由。在一实施例中，服务器设备300发送服务器对应的主机路由给交换机设备200。交换机设备200根据服务器对应的主机路由设置为对应的32位掩码子网路由。交换机设备200发送服务器对应的32位掩码子网路由给网关设备100，即网关设备100获取服务器设备300对应的32位掩码子网路由。步骤S200：与所述服务器100的端口建立映射关系。在一实施方式中，网关设备100根据服务器设备300对应的32位掩码子网路由与服务器设备300的端口建立映射关系。进一步地，网关设备100根据服务器设备300对应的32位掩码子网路由与交换机设备200、服务器设备300的端口建立映射关系。在另一实施方式中，映射关系可以为状态映射关系。状态映射关系可以包括上行状态的映射关系、下行状态的映射关系。本实施例的配置方法，通过32位掩码子网路由的路由通告的方式，通过路由协议通告给上游设备，使得上游设备学习到下游所有服务器虚拟机的主机路由。在上游设备中，以32位掩码子网路的路由形式存在，代替子网路由通告的方式。此外，链路聚合系统的交换机设备200对接上游网关设备的端口，与下游所有服务器设备对接的端口进行端口联动捆绑。采用本实施例的配置方法，当链路聚合系统中的某链路或某设备出现故障时，可以实现整个跨设备链路聚合网络的整体切换，确保系统持续正常作业。此外，由于省去主备之间的直连链路，能够节省网络资源，提升网络设备的运行效率，简化网络操作，节约网络运维成本。图4是本申请一实施例链路聚合系统通信状态切换方法应用场景示意图。如图4所示，链路聚合系统包括网关设备100，第一交换机210，第二交换机220，第一服务器310，第二服务器320。第一交换机210包括端口A1、A2、A3。第二交换机220包括端口B1、B2、B3。网关设备100通过端口A1和第一交换机210通信连接，通过端口B1和第二交换机220通信连接。第一服务器310通过端口A2和第一交换机210建立主链路进行通信连接；通过端口B2和第二交换机220建立备链路。第二服务器320通过端口B3和第二交换机220建立主链路进行通信连接；通过端口A3和第一交换机210建立备链路。本实施例的链路聚合系统通过前文的配置方法进行配置后，能够实现在系统中某链路或某设备出现故障时，实现切换，确保系统持续正常作业。以下结合不同的故障情形，进一步阐述本实施例的通信状态切换方法。图5、6是本申请一实施例链路聚合系统通信状态切换方法示意图。如图5、6所示，链路聚合系统包括网关设备100，第一交换机210，第二交换机220，第一服务器310，第二服务器320。第一交换机210包括端口A1、A2、A3。第二交换机220包括端口B1、B2、B3。网关设备100通过端口A1和第一交换机210通信连接，通过端口B1和第二交换机220通信连接。第一服务器310通过端口A2和第一交换机210建立主链路进行通信连接；通过端口B2和第二交换机220建立备链路。第二服务器320通过端口B3和第二交换机220建立主链路进行通信连接；通过端口A3和第一交换机210建立备链路。当第一交换机210端口A2和第一服务器310之间出现链路或设备故障时，执行以下操作：第一交换机210端口A2和第一服务器310端口断开通信连接，如第一交换机210撤销服务器故障链路的端口对应的主机路由。第一交换机210发送故障信息给网关设备100，即通告网关设备100撤销链路的端口对应的32位掩码子网路。服务器310将被撤销端口切换至备用链路，即第二交换机220的端口B2，服务器300通过端口B2与第二交换机200建立通信连接。第二交换机220接收服务器310被撤销端口对应的主机路由。第二交换机220将上述主机路由转化为32位掩码子网路由。第二交换机220将上述32位掩码子网路由通过端口B1发送给网关设备100。网关设备100根据上述32位掩码子网路由通过第二交换机220与服务器310被撤销端口建立通信连接。图7是本申请一实施例链路聚合系统通信状态切换方法示意图。如图7所示，链路聚合系统包括网关设备G，交换机A、B，服务器C1、C2、C3、C4。交换机A包括端口A0、A1、A2、A3、A4。交换机B包括端口B0、B1、B2、B3、B4。服务器C1、C2、C3、C4分别和端口A1、A2、B3、B4建立主链路；服务器C1、C2、C3、C4分别和端口A3、A4、B1、B2建立备链路。具体地，交换机A通过主链路连接服务器C3和C4，IP地址分别是10.10.10.1和10.10.10.2；交换机B通过主链路连接服务器C1和C2，IP地址分别是10.10.10.4和10.10.10.5；服务器C1、C2、C3、C4配置IP地址的网络掩码为24位。服务器C3、C4通告主机路由10.10.10.1、10.10.10.2给交换机A，服务器C1、C2通告主机路由10.10.10.4、10.10.10.5给交换机B。交换机A、B对上游网关设备G通告的时候，不再通告24位子网路由10.10.10.1、10.10.10.2、10.10.10.3、10.10.10.4，而是将这4个主机路由转化为32位掩码子网路由对网关设备G进行通告。通告的方式可以通过例如OSPF动态路由协议进行通告，交换机A、B可以将原OSPF的通告10.10.10.1、10.10.10.2、10.10.10.3、10.10.10.4的LSA进行修改。交换机A用自身的下联主机路由10.10.10.1、10.10.10.2生成2个32位的子网路由10.10.10.1/32、10.10.10.2/32的OSPF的LSA；交换机B用自身的下联主机路由10.10.10.3、10.10.10.4生成2个32位的子网路由10.10.10.3/32、10.10.10.4/32的OSPF的LSA。交换机A和B分别通过OSPF路由协议的LSA报文将各自的2个32位掩码子网路由通告给网关设备G。通告可以采用各种动态路由协议，或者静态路由通告，不限于OSPF协议通告。网关设备G分别从交换机A、B学习到这4个32位掩码子网路由，即分别从交换机A、B的路由通告收到的这4个路由。由于10.10.10.1、10.10.10.2的32位子网路由是交换机A通告的，因此将这两条路由的下一跳指向交换机A，由于10.10.10.3、10.10.10.4的32位子网路由是交换机B通告的，因此将这两条路由的下一跳指向交换机B。当服务器C4 10.10.10.2的虚拟机与交换机A之间的链接出现故障，执行以下步骤：交换机A撤销其主机路由10.10.10.2，并且向上游网关设备G通告撤销10.10.10.2的32位子网路由。服务器侧C4 10.10.10.2的虚拟机切换到备用路径指向交换机B，与交换机B建立链接。则交换机B接收到10.10.10.2的主机路由，交换机B将此主机路由转化为32位子网路由10.10.10.2通告给网关设备G。上游网关设备G收到交换机B发出的10.10.10.2的32位子网路由通告，将10.10.10.2的路由下一跳指向交换机B。通过本申请实施例的方案，系统对发生的故障的可以通过整体链路切换后，确保后续的报文可正常的进行转发。图8、9是本申请一实施例链路聚合系统通信状态切换方法示意图。如图8、9所示，链路聚合系统包括网关设备100，第一交换机210，第二交换机220，第一服务器310，第二服务器320。第一交换机210包括端口A1、A2、A3。第二交换机220包括端口B1、B2、B3。网关设备100通过端口A1和第一交换机210通信连接，通过端口B1和第二交换机220通信连接。第一服务器310通过端口A2和第一交换机210建立主链路进行通信连接；通过端口B2和第二交换机220建立备链路。第二服务器320通过端口B3和第二交换机220建立主链路进行通信连接；通过端口A3和第一交换机210建立备链路。当网关设备100和第一交换机210之间出现链路或设备故障时，执行以下操作：第一交换机210和第一服务器310、第二服务器320都断开连接，即第一交换机210端口A1、A2断开通信连接，如第一交换机210撤销端口A1、A2对应的主机路由。服务器310与第二交换机220建立通信连接，具体地服务器310与第二交换机220端口B2建立通信连接；第二交换机220接收服务器310对应的主机路由。第二交换机220将上述主机路由转化为32位掩码子网路由。第二交换机220将上述32位掩码子网路由通过端口B1发送给网关设备100。网关设备100根据上述32位掩码子网路由通过第二交换机220与服务器310被建立通信连接。图10是本申请一实施例链路聚合系统通信状态切换方法示意图。如图10所示，链路聚合系统包括网关设备G，交换机A、B，服务器C1、C2、C3、C4。交换机A包括端口A0、A1、A2、A3、A4。交换机B包括端口B0、B1、B2、B3、B4。服务器C1、C2、C3、C4分别和端口A1、A2、B3、B4建立主链路；服务器C1、C2、C3、C4分别和端口A3、A4、B1、B2建立备链路。具体地，交换机A通过主链路连接服务器C3和C4，IP地址分别是10.10.10.1和10.10.10.2；交换机B通过主链路连接服务器C1和C2，IP地址分别是10.10.10.4和10.10.10.5；服务器C1、C2、C3、C4配置IP地址的网络掩码为24位。服务器C3、C4通告主机路由10.10.10.1、10.10.10.2给交换机A，服务器C1、C2通告主机路由10.10.10.4、10.10.10.5给交换机B。交换机A、B对上游网关设备G通告的时候，不再通告24位子网路由10.10.10.1、10.10.10.2、10.10.10.3、10.10.10.4，而是将这4个主机路由转化为32位掩码子网路由对网关设备G进行通告。通告的方式可以通过例如OSPF动态路由协议进行通告，交换机A、B可以将原OSPF的通告10.10.10.1、10.10.10.2、10.10.10.3、10.10.10.4的LSA进行修改。交换机A用自身的下联主机路由10.10.10.1、10.10.10.2生成2个32位的子网路由10.10.10.1/32、10.10.10.2/32的OSPF的LSA；交换机B用自身的下联主机路由10.10.10.3、10.10.10.4生成2个32位的子网路由10.10.10.3/32、10.10.10.4/32的OSPF的LSA。交换机A和B分别通过OSPF路由协议的LSA报文将各自的2个32位掩码子网路由通告给网关设备G。通告可以采用各种动态路由协议，或者静态路由通告，不限于OSPF协议通告。网关设备G分别从交换机A、B学习到这4个32位掩码子网路由，即分别从交换机A、B的路由通告收到的这4个路由。由于10.10.10.1、10.10.10.2的32位子网路由是交换机A通告的，因此将这两条路由的下一跳指向交换机A，由于10.10.10.3、10.10.10.4的32位子网路由是交换机B通告的，因此将这两条路由的下一跳指向交换机B。当网关设备G与交换机A之间的链接出现故障，执行以下步骤：网关设备G与交换机A之间的链路出现故障。由于交换机A已经配置了网关设备G接口与下游所有服务器C1、C2、C3、C4接口之间的端口联动，当交换机A发现与网关设备G连接链路出现故障的时，交换机A同步将所有的下游与服务器C3、C4 10.10.10.4、10.10.10.5的链路全部关断。服务器C3、C4 10.10.10.4、10.10.10.5感知到与交换机A的链路接口全部被关断，则此两台服务器切换到备份链路，与交换机B建立连接。由于交换机B与网关设备G的连接正常，因此服务器C3、C4 10.10.10.4、10.10.10.5的转发流量全部切换到交换机B与网关设备G建立转发通路。通过本申请实施例的方案，系统对发生的故障的可以通过整体链路切换后，确保后续的报文可正常的进行转发。本申请实施例的通信装置可应用于链路聚合通信系统，通信系统可以执行如上述通信状态切换方法或配置方法。本申请实施例的通信装置也可应用于计算机可读存储介质或计算机程序产品，计算机可读存储介质或计算机程序产品可以执行如上述通信状态切换方法或配置方法。本领域普通技术人员可以理解，上文中所公开方法中的全部或某些步骤、系统、设备中的功能模块/单元可以被实施为软件、固件、硬件及其适当的组合。在硬件实施方式中，在以上描述中提及的功能模块/单元之间的划分不一定对应于物理组件的划分；例如，一个物理组件可以具有多个功能，或者一个功能或步骤可以由若干物理组件合作执行。某些物理组件或所有物理组件可以被实施为由处理器，如中央处理器、数字信号处理器或微处理器执行的软件，或者被实施为硬件，或者被实施为集成电路，如专用集成电路。这样的软件可以分布在计算机可读介质上，计算机可读介质可以包括计算机存储介质和通信介质。如本领域普通技术人员公知的，术语计算机存储介质包括在用于存储信息的任何方法或技术中实施的易失性和非易失性、可移除和不可移除介质。计算机存储介质包括但不限于RAM、ROM、EEPROM、闪存或其他存储器技术、CD-ROM、数字多功能盘或其他光盘存储、磁盒、磁带、磁盘存储或其他磁存储装置、或者可以用于存储期望的信息并且可以被计算机访问的任何其他的介质。此外，本领域普通技术人员公知的是，通信介质通常包含计算机可读指令、数据结构、程序模块或者诸如载波或其他传输机制之类的调制数据信号中的其他数据，并且可包括任何信息递送介质。在本说明书中使用的术语“部件”、“模块”、“系统”等用于表示计算机相关的实体、硬件、固件、硬件和软件的组合、软件、或执行中的软件。例如，部件可以是但不限于，在处理器上运行的进程、处理器、对象、可执行文件、执行线程、程序或计算机。通过图示，在计算设备上运行的应用和计算设备都可以是部件。一个或多个部件可驻留在进程或执行线程中，部件可位于一个计算机上或分布在2个或更多个计算机之间。此外，这些部件可从在上面存储有各种数据结构的各种计算机可读介质执行。部件可例如根据具有一个或多个数据分组的信号通过本地或远程进程来通信。以上参照附图说明了本申请的一些实施例，并非因此局限本申请的权利范围。本领域技术人员不脱离本发明的范围和实质内所作的任何修改、等同替换和改进，均应在本申请的权利范围之内。
