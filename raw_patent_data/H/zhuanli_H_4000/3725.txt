标题title
视频处理方法及装置
摘要abst
本申请实施例提供一种视频处理方法及装置，应用于电子设备，所述方法包括：显示包括第一视频的封面以及视频处理控件的视频处理界面，检测到用户操作所述视频处理控件为第一视频选中第一主题后，向所述第一视频中的多个视频片段分别添加对象和音乐，其中，第一视频片段中添加的对象与第二视频片段中添加的对象不同。播放第一视频中添加了对象的各个视频片段。因为分别向视频片段添加不同的对象，所以，即使向视频中添加的主题相同，在视频片段不同的情况下，播放过程中对象出现的时机也不同，所以，能够使得对象的展示效果更加个性化，从而改善电子设备的视频处理功能。
权利要求书clms
1.一种视频处理方法，其特征在于，应用于电子设备，所述方法包括：显示视频处理界面，所述视频处理界面中包括第一视频的封面以及视频处理控件；当检测到用户操作所述视频处理控件为第一视频选中第一主题后，向所述第一视频中的多个视频片段分别添加对象和音乐，其中，第一视频片段中添加的对象与第二视频片段中添加的对象不同；播放所述第一视频中添加了对象的各个视频片段。2.根据权利要求1所述的方法，其特征在于，在所述向所述第一视频中的多个视频片段分别添加对象和音乐之前，还包括：确定所述视频的信息中存在转场信息；至少依据所述转场信息分割所述视频，得到所述多个视频片段。3.根据权利要求2所述的方法，其特征在于，所述至少依据所述转场信息分割所述视频，得到所述视频片段，包括：确定依据所述转场信息分割获得的片段的长度大于第一阈值；依据所述音乐，再次分割长度大于所述第一阈值的片段，得到所述视频片段。4.根据权利要求3所述的方法，其特征在于，所述依据所述音乐，再次分割长度大于所述第一阈值的片段，得到所述视频片段，包括：获取所述音乐对应的各个预设分割点，所述各个预设分割点依据所述音乐对应的预设分割步长确定；依据各个所述预设分割点与所述长度大于所述第一阈值的片段的中点的距离，从各个所述预设分割点中选择实际分割点；使用所述实际分割点，分割所述长度大于所述第一阈值的片段，得到所述视频片段。5.根据权利要求1-4任一项所述的方法，其特征在于，在所述向所述第一视频中的多个视频片段分别添加对象和音乐之前，还包括：确定所述视频的信息中不存在转场信息；依据所述音乐对应的分割规则，分割所述视频，得到所述多个视频片段。6.根据权利要求5所述的方法，其特征在于，所述依据所述音乐对应的分割规则，分割所述视频，包括：查询所述音乐对应的预设分割步长和片段时长区间；依据所述预设分割步长，生成各个预设分割点；依据所述预设分割点和所述片段时长区间，分割所述视频。7.根据权利要求6所述的方法，其特征在于，所述预设分割步长和片段时长区间依据所述音乐的节拍确定。8.根据权利要求1-7任一项所述的方法，其特征在于，所述对象包括：按照预设规则排列的M个对象；在所述播放添加所述对象的视频片段之前，还包括：将所述按照预设规则排列的M个对象中的第一个对象，分配给第一个视频片段，所述第一个视频片段为所述视频中最先播放的片段。9.根据权利要求8所述的方法，其特征在于，还包括：将所述按照预设规则排列的M个对象中的最后第一个对象，分配给最后一个视频片段，所述最后一个视频片段为所述视频中最后播放的片段。10.根据权利要求1-9任一项所述的方法，其特征在于，所述播放添加所述对象的视频片段包括：在第一个视频片段的第一时长区间，播放为所述第一个视频片段添加的对象，所述第一个视频片段为所述视频中最先播放的片段。11.根据权利要求10所述的方法，其特征在于，所述播放添加所述对象的视频片段还包括：在添加目标对象的视频片段的随机时长区间，播放所述目标对象，所述目标对象为向多个视频片段添加的对象。12.根据权利要求1-11任一项所述的方法，其特征在于，所述向所述第一视频中的多个视频片段分别添加对象，包括：向所述多个视频片段中的第一个视频片段，添加特效序列中的第一个特效。13.根据权利要求12所述的方法，其特征在于，所述向所述第一视频中的多个视频片段分别添加对象，还包括：向所述多个视频片段中至少最后一个视频片段，添加所述特效序列中的最后一个特效。14.根据权利要求12或13所述的方法，其特征在于，在所述播放所述第一视频中添加了对象的各个视频片段之前，还包括：设置所述第一个视频片段添加的特效的播放时机为所述第一个视频的开始区间。15.根据权利要求13所述的方法，其特征在于，在所述播放所述第一视频中添加了对象的各个视频片段之前，还包括：设置目标特效的播放时机为添加所述目标特效的视频片段的随机区间，所述目标特效为添加至多个视频片段的特效。16.一种电子设备，其特征在于，包括：一个或多个处理器、存储器、显示屏和摄像头；所述存储器和所述显示屏、以及所述摄像头与所述一个或多个所述处理器耦合，所述存储器用于存储计算机程序代码，所述计算机程序代码包括计算机指令，当所述一个或多个处理器执行所述计算机指令时，所述电子设备执行如权利要求1-15任一项所述的视频处理方法。17.一种计算机可读存储介质，其上存储有程序，其特征在于，在计算机设备运行所述应用程序时，实现权利要求1-15任一项所述的视频处理方法。
说明书desc
技术领域本申请涉及信息处理技术领域，尤其涉及一种视频处理方法及装置。背景技术随着短视频业务的兴起，视频录制、以及视频处理如剪辑等功能，成为电子设备的常见功能。目前电子设备的视频处理功能还有改善的空间。发明内容本申请提供了一种视频处理方法及装置，目的在于解决如何改善视频处理功能的问题。为了实现上述目的，本申请提供了以下技术方案：本申请的第一方面提供一种视频处理方法，应用于电子设备，所述方法包括：显示包括第一视频的封面以及视频处理控件的视频处理界面，检测到用户操作所述视频处理控件为第一视频选中第一主题后，向所述第一视频中的多个视频片段分别添加对象和音乐，其中，第一视频片段中添加的对象与第二视频片段中添加的对象不同。播放所述第一视频中添加了对象的各个视频片段。因为分别向视频片段添加不同的对象，所以，即使向视频中添加的主题相同，在视频片段不同的情况下，播放过程中对象出现的时机也不同，所以，能够使得对象的展示效果更加个性化，从而改善电子设备的视频处理功能。可选的，在所述向所述第一视频中的多个视频片段分别添加对象和音乐之前，还包括：确定所述视频的信息中存在转场信息，至少依据所述转场信息分割所述视频，得到所述多个视频片段。转场信息是指镜头变化前后或暂停前后的图像帧的信息，所以，按照转场信息分割视频，能够获得镜头变化前后或暂停前后的视频片段，为对象随着镜头变化或暂停而切换奠定基础。可选的，所述至少依据所述转场信息分割所述视频，得到所述视频片段，包括：确定依据所述转场信息分割获得的片段的长度大于第一阈值，依据所述音乐，再次分割长度大于所述第一阈值的片段，得到所述视频片段。将长度大于第一阈值的视频片段进行再分割，有利于减少视频片段的长度，使得特效等对象能够得到充分展示，依据音乐进行再分割，使得对象的切换与音乐更为匹配。可选的，所述依据所述音乐，再次分割长度大于所述第一阈值的片段，得到所述视频片段，包括：获取所述音乐对应的各个预设分割点，所述各个预设分割点依据所述音乐对应的预设分割步长确定，依据各个所述预设分割点与所述长度大于所述第一阈值的片段的中点的距离，从各个所述预设分割点中选择实际分割点，使用所述实际分割点，分割所述长度大于所述第一阈值的片段，得到所述视频片段。依据各个预设分割点与长度大于所述第一阈值的片段的中点的距离，选择实际分割点的方式，更为简便，便于操作。可选的，在所述向所述第一视频中的多个视频片段分别添加对象和音乐之前，还包括：确定所述视频的信息中不存在转场信息，依据所述音乐对应的分割规则，分割所述视频，得到所述多个视频片段。音乐伴随着视频播放，所以依据音乐分割视频，为对象的切换与音乐更为匹配奠定基础。可选的，所述依据所述音乐对应的分割规则，分割所述视频，包括：查询所述音乐对应的预设分割步长和片段时长区间，依据所述预设分割步长，生成各个预设分割点，依据所述预设分割点和所述片段时长区间，分割所述视频。通过分割步长和片段时长区间，为将音乐的特点进行量化提供了可能，依据预设分割点和片段时长区间分割视频，便于实现。可选的，所述预设分割步长和片段时长区间依据所述音乐的节拍确定，使得特效等对象的切换与音乐的节拍更为契合，从而提升用户的体验。可选的，所述对象包括：按照预设规则排列的M个对象。在所述播放添加所述对象的视频片段之前，还包括：将所述按照预设规则排列的M个对象中的第一个对象，分配给第一个视频片段，所述第一个视频片段为所述视频中最先播放的片段。因此，无论视频或者视频片段的数量是否相同，为第一个视频片段分配的均为第一个对象，所以，能够保证包含M个对象的主题等元素，具有统一的视觉效果。可选的，所述方法还包括：将所述按照预设规则排列的M个对象中的最后第一个对象，分配给最后一个视频片段，所述最后一个视频片段为所述视频中最后播放的片段，以进一步增强统一的视觉效果。可选的，所述播放添加所述对象的视频片段包括：在第一个视频片段的第一时长区间，播放为所述第一个视频片段添加的对象，所述第一个视频片段为所述视频中最先播放的片段。可见，无论视频或者视频片段的数量是否相同，均在第一个视频片段的第一时长区间播放对象，以进一步增强统一的视觉效果。可选的，所述播放添加所述对象的视频片段还包括：在添加目标对象的视频片段的随机时长区间，播放所述目标对象，所述目标对象为向多个视频片段添加的对象。也就是说，对于向多个视频片段添加的对象，在添加该对象的视频片段，随机播放该对象，以在保持统一视觉效果的基础上，增加视觉效果的丰富性和灵活性。可选的，所述向所述第一视频中的多个视频片段分别添加对象，包括：向所述多个视频片段中的第一个视频片段添加特效序列中的第一个特效，使得对于同一主题，在第一个视频片段播放相同的特效，以保持主题的特效效果的统一性，使得用户对于相同主题具有较为统一的视觉印象。可选的，所述向所述第一视频中的多个视频片段分别添加对象，还包括：向所述多个视频片段中至少最后一个视频片段，添加所述特效序列中的最后一个特效，以增强相同主题的统一的视觉印象。可选的，在所述播放所述第一视频中添加了对象的各个视频片段之前，还包括：设置所述第一个视频片段添加的特效的播放时机为所述第一个视频的开始区间，以增强相同主题的统一的视觉印象。可选的，在所述播放所述第一视频中添加了对象的各个视频片段之前，还包括：设置目标特效的播放时机为添加所述目标特效的视频片段的随机区间，所述目标特效为添加至多个视频片段的特效。对于相同的特效，因为在不同视频片段中播放，所以采用不同的播放区间，以获得更为丰富和灵活的视觉效果。本申请的第二方面提供一种电子设备，包括一个或多个处理器、存储器、显示屏和摄像头。所述存储器和所述显示屏、以及所述摄像头与所述一个或多个所述处理器耦合，所述存储器用于存储计算机程序代码，所述计算机程序代码包括计算机指令，当所述一个或多个处理器执行所述计算机指令时，所述电子设备执行本申请的第一方面提供的视频处理方法。本申请的第三方面提供一种计算机可读存储介质，其上存储有程序，在计算机设备运行所述应用程序时，实现本申请的第一方面提供的视频处理方法。附图说明图1a-图1h为本申请提供的视频处理方法的一种应用场景的示例图；图2a-图2c为本申请提供的视频处理方法的又一种应用场景的示例图；图3为本申请提供的电子设备的硬件结构图；图4为本申请提供的电子设备的软件架构图；图5为本申请提供的视频处理方法的流程图；图6为本申请提供的视频处理方法中，为视频片段分配特效和特效播放时机的示例图；图7a为本申请提供的视频处理方法中依据音乐分割视频的流程图；图7b为本申请提供的音乐对应的分割规则的示例图；图7c为依据音乐分割视频的示例图；图8a为本申请提供的视频处理方法中依据转场信息分割视频的流程图；图8b为依据转场信息分割视频并添加特效的示例图。具体实施方式下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述。以下实施例中所使用的术语只是为了描述特定实施例的目的，而并非旨在作为对本申请的限制。如在本申请的说明书和所附权利要求书中所使用的那样，单数表达形式“一个”、“一种”、“所述”、“上述”、“该”和“这一”旨在也包括例如“一个或多个”这种表达形式，除非其上下文中明确地有相反指示。还应当理解，在本申请实施例中，“一个或多个”是指一个、两个或两个以上；“和/或”，描述关联对象的关联关系，表示可以存在三种关系；例如，A和/或B，可以表示：单独存在A，同时存在A和B，单独存在B的情况，其中A、B可以是单数或者复数。字符“/”一般表示前后关联对象是一种“或”的关系。在本说明书中描述的参考“一个实施例”或“一些实施例”等意味着在本申请的一个或多个实施例中包括结合该实施例描述的特定特征、结构或特点。由此，在本说明书中的不同之处出现的语句“在一个实施例中”、“在一些实施例中”、“在其他一些实施例中”、“在另外一些实施例中”等不是必然都参考相同的实施例，而是意味着“一个或多个但不是所有的实施例”，除非是以其他方式另外特别强调。术语“包括”、“包含”、“具有”及它们的变形都意味着“包括但不限于”，除非是以其他方式另外特别强调。本申请实施例涉及的多个，是指大于或等于两个。需要说明的是，在本申请实施例的描述中，“第一”、“第二”等词汇，仅用于区分描述的目的，而不能理解为指示或暗示相对重要性，也不能理解为指示或暗示顺序。图1a-图1h所示为视频处理的场景示例：如图1a展示的相机的界面示例中，相机界面展示了拍照、录像、多镜录像三个工作模式。相机在多镜录像工作模式下，可实现利用相机的多个摄像头完成用户的一次录像操作。如图1a所示，电子设备的前置摄像头和后置摄像头同时运行，相机的界面的上半区域展示前置摄像头拍摄的图像，下半区域展示后置摄像头拍摄的图像。当然，相机的界面展示前置摄像头和后置摄像头拍摄的图像的方式，也可不限于图1a所示。如图1b所示，处于多镜录像工作模式下的相机的界面，展示有“美颜”按钮和“微电影”按钮。用户点击“微电影”按钮，电子设备可响应用户的点击操作，展示“微电影”的界面，如图1c所示，“微电影”的界面上显示多个风格主题，以及“一键拍”和“分段拍”两种拍摄模式的按钮。用户可选择“因为有你”风格主题，并点击“一键拍”按钮，实现在视频拍摄结束后，即得到带有特效的视频的目的。主题为包含特效、音乐等元素的模板，向视频添加主题后，主题中的特效、音乐等元素均被添加至视频中。图1d为“一键拍”模式下，拍摄过程的示例。图1e为视频拍摄结束后的界面，在图1e中，用户点击播放按钮1，触发播放添加主题后的视频，图1f为播放添加主题后的视频的界面示例。在图1e中，用户点击“风格”按钮2，可以进入图1h所示的主题选择界面，用户可以重新选择主题。在图1e中，用户点击音符状的按钮3，可以进入图1g所示的音乐的选择界面，重新选择伴随视频播放的音乐。图2a-图2c所示为视频处理的又一场景示例：图2a为电子设备的图库中已存储的视频的列表，如图2b所示，用户选中一个视频，进入图2c所示的界面，在图2c中，显示可触发对视频进行操作的按钮4，例如“Ai一键大片”。在用户点击“Ai一键大片”4后，进入图1e所示的界面，即添加默认主题的视频的预览界面，用户在图1e中，可点击不同的按钮，触发显示图1g或者图1h所示的界面，并进行相应操作，这里不再赘述。可以看出，无论是“一键拍”还是“Ai一键大片”，目的均为：无需用户逐帧编辑视频中的图像帧，而是通过“一键”操作，电子设备自动为视频中的图像帧增加音乐和画面效果。在以上举例中，画面效果为特效。但可以理解的是，在本申请的实施例中，画面效果包括但不限于：特效、滤镜、贴纸、边框以及动画等。发明人在研究的过程中发现，目前的“一键拍”或者“Ai一键大片”功能，使用固定的添加规则，将音乐和画面效果增加至视频的图像帧。也就是说，无论视频的长度、内容、拍摄手法、配合的音乐等有无区别，只要选择了同一个主题，为视频添加的画面效果均相同。这种画面效果的添加方式过于刻板，所以，目前的“一键拍”或者“Ai一键大片”功能，还有改进的空间。本申请实施例提供一种视频处理方法，目的在于，提供与视频和音乐的更为匹配的画面效果，改善视频处理的效果。本申请实施例所述的视频处理方法，应用于电子设备，电子设备包括但不限于手机，平板电脑，桌面型、膝上型、笔记本电脑，超级移动个人计算机，手持计算机，上网本，个人数字助理，可穿戴电子设备，智能手表等具有摄像头的电子设备。图3为本申请实施例提供的一种电子设备的组成示例。以手机为例，电子设备可以包括处理器110，内部存储器120，显示屏130，摄像头140，天线1，天线2，移动通信模块150，无线通信模块160以及音频模块170等。可以理解的是，本实施例示意的结构并不构成对该电子设备的具体限定。在另一些实施例中，该电子设备可以包括比图示更多或更少的部件，或者组合某些部件，或者拆分某些部件，或者不同的部件布置。图示的部件可以以硬件，软件或软件和硬件的组合实现。处理器110可以包括一个或多个处理单元，例如：处理器110可以包括应用处理器，调制解调处理器，图形处理器，图像信号处理器，控制器，视频编解码器，数字信号处理器，基带处理器，和/或神经网络处理器等。其中，不同的处理单元可以是独立的器件，也可以集成在一个或多个处理器中。内部存储器120可以用于存储计算机可执行程序代码，可执行程序代码包括指令。处理器110通过运行存储在内部存储器110的指令，从而执行电子设备的各种功能应用以及数据处理。内部存储器120可以包括存储程序区和存储数据区。其中，存储程序区可存储操作系统，至少一个功能所需的应用程序等。存储数据区可存储电子设备使用过程中所创建的数据等。此外，内部存储器120可以包括高速随机存取存储器，还可以包括非易失性存储器，例如至少一个磁盘存储器件，闪存器件，通用闪存存储器等。处理器110通过运行存储在内部存储器120的指令，和/或存储在设置于处理器中的存储器的指令，执行电子设备的各种功能应用以及数据处理。电子设备通过GPU，显示屏130，以及应用处理器等实现显示功能。GPU为图像处理的微处理器，连接显示屏130和应用处理器。GPU用于执行数学和几何计算，用于图形渲染。处理器110可包括一个或多个GPU，其执行程序指令以生成或改变显示信息。显示屏130用于显示图像，视频等。显示屏130包括显示面板。显示面板可以采用液晶显示屏，有机发光二极管，有源矩阵有机发光二极体或主动矩阵有机发光二极体，柔性发光二极管，Miniled，MicroLed，Micro-oled，量子点发光二极管等。在一些实施例中，电子设备可以包括1个或N个显示屏130，N为大于1的正整数。电子设备可以通过ISP，摄像头140，视频编解码器，GPU，显示屏194以及应用处理器等实现拍摄功能。ISP用于处理摄像头140反馈的数据。例如，拍照时，打开快门，光线通过镜头被传递到摄像头感光元件上，光信号转换为电信号，摄像头感光元件将所述电信号传递给ISP处理，转化为肉眼可见的图像。ISP还可以对图像的噪点，亮度，肤色进行算法优化。ISP还可以对拍摄场景的曝光，色温等参数优化。在一些实施例中，ISP可以设置在摄像头140中。摄像头140用于捕获静态图像或视频。物体通过镜头生成光学图像投射到感光元件。感光元件可以是电荷耦合器件或互补金属氧化物半导体光电晶体管。感光元件把光信号转换成电信号，之后将电信号传递给ISP转换成数字图像信号。ISP将数字图像信号输出到DSP加工处理。DSP将数字图像信号转换成标准的RGB，YUV等格式的图像信号。在一些实施例中，电子设备可以包括1个或N个摄像头140，N为大于1的正整数。一些实施例中，摄像头140用于拍摄本申请实施例提及的视频。数字信号处理器用于处理数字信号，除了可以处理数字图像信号，还可以处理其他数字信号。例如，当电子设备在频点选择时，数字信号处理器用于对频点能量进行傅里叶变换等。视频编解码器用于对数字视频压缩或解压缩。电子设备可以支持一种或多种视频编解码器。这样，电子设备可以播放或录制多种编码格式的视频，例如：动态图像专家组1，MPEG2，MPEG3，MPEG4等。内部存储器120可以用于存储计算机可执行程序代码，所述可执行程序代码包括指令。处理器110通过运行存储在内部存储器120的指令，从而执行电子设备的各种功能应用以及数据处理。内部存储器120可以包括存储程序区和存储数据区。其中，存储程序区可存储操作系统，至少一个功能所需的应用程序等。存储数据区可存储电子设备使用过程中所创建的数据等。此外，内部存储器120可以包括高速随机存取存储器，还可以包括非易失性存储器，例如至少一个磁盘存储器件，闪存器件，通用闪存存储器等。处理器110通过运行存储在内部存储器120的指令，和/或存储在设置于处理器中的存储器的指令，执行电子设备的各种功能应用以及数据处理。电子设备可以通过音频模块170，扬声器170A，麦克风170B以及应用处理器等实现音频功能。例如音乐播放，录音等。音频模块170用于将数字音频信息转换成模拟音频信号输出，也用于将模拟音频输入转换为数字音频信号。音频模块170还可以用于对音频信号编码和解码。在一些实施例中，音频模块170可以设置于处理器110中，或将音频模块170的部分功能模块设置于处理器110中。扬声器170A，也称“喇叭”，用于将音频电信号转换为声音信号。电子设备可以通过扬声器170A收听音乐，或收听免提通话。一些实施例中，扬声器170A可播放本申请实施例提及的带有特效的视频信息。麦克风170B，也称“话筒”，“传声器”，用于将声音信号转换为电信号。当拨打电话或发送语音信息时，用户可以通过人嘴靠近麦克风170B发声，将声音信号输入到麦克风170B。一些实施例中，麦克风170B可在相机拍摄带有特效的视频信息的过程中，采集电子设备所处环境的声音。电子设备的无线通信功能可以通过天线1，天线2，移动通信模块150，无线通信模块160，调制解调处理器以及基带处理器等实现。天线1和天线2用于发射和接收电磁波信号。移动通信模块150可以提供应用在电子设备上的包括2G/3G/4G/5G等无线通信的解决方案。移动通信模块150可以包括至少一个滤波器，开关，功率放大器，低噪声放大器等。移动通信模块150可以由天线1接收电磁波，并对接收的电磁波进行滤波，放大等处理，传送至调制解调处理器进行解调。移动通信模块150还可以对经调制解调处理器调制后的信号放大，经天线1转为电磁波辐射出去。无线通信模块160可以提供应用在电子设备上的包括无线局域网网络)，蓝牙，全球导航卫星系统，调频，近距离无线通信技术，红外技术等无线通信的解决方案。无线通信模块160可以是集成至少一个通信处理模块的一个或多个器件。无线通信模块160经由天线2接收电磁波，将电磁波信号调频以及滤波处理，将处理后的信号发送到处理器110。无线通信模块160还可以从处理器110接收待发送的信号，对其进行调频，放大，经天线2转为电磁波辐射出去。另外，在上述部件之上，运行有操作系统。例如iOS操作系统，Android操作系统，Windows操作系统等。在操作系统上可以安装运行应用程序。图4是本申请实施例的电子设备的软件结构框图。分层架构将软件分成若干个层，每一层都有清晰的角色和分工。层与层之间通过软件接口通信。在一些实施例中，将Android系统分为四层，从上至下分别为应用程序层，应用程序框架层，安卓运行时和系统库，以及内核层。应用程序层可以包括一系列应用程序包。如图4所示，应用程序包可以包括相机，图库，日历，通话，地图，导航，视频编辑等应用程序。一些实施例中，相机用于拍摄视频。并且，用户可在相机展示的界面选择主题模板。相机拍摄得到视频后，电子设备可跳转执行视频编辑应用程序，由视频编辑应用程序合并视频和主题模板提供的特效，形成带有特效的视频。应用程序框架层为应用程序层的应用程序提供应用编程接口和编程框架。应用程序框架层包括一些预先定义的函数。如图4所示，应用程序框架层可以包括窗口管理器，内容提供器，电话管理器，资源管理器，通知管理器，视图系统等。Android Runtime包括核心库和虚拟机。Android runtime负责安卓系统的调度和管理。在本申请一些实施例中，应用冷启动会在Android runtime中运行，Android runtime由此获取到应用的优化文件状态参数，进而Android runtime可以通过优化文件状态参数判断优化文件是否因系统升级而导致过时，并将判断结果返回给应用管控模块。核心库包含两部分：一部分是java语言需要调用的功能函数，另一部分是安卓的核心库。应用程序层和应用程序框架层运行在虚拟机中。虚拟机将应用程序层和应用程序框架层的java文件执行为二进制文件。虚拟机用于执行对象生命周期的管理，堆栈管理，线程管理，安全和异常的管理，以及垃圾回收等功能。系统库可以包括多个功能模块。例如：表面管理器，媒体库，三维图形处理库，二维图形引擎等。表面管理器用于对显示子系统进行管理，并且为多个应用程序提供了2D和3D图层的融合。媒体库Media Library支持多种常用的音频，视频格式回放和录制，以及静态图像文件等。媒体库可以支持多种音视频编码格式，例如:MPEG2，H.262，MP3，AAC，AMR，JPG，PNG等。三维图形处理库用于实现三维图形绘图，图像渲染、合成和图层处理等。二维图形引擎是2D绘图的绘图引擎。内核层是硬件和软件之间的层。内核层至少包含显示驱动，摄像头驱动，音频驱动，传感器驱动等。需要说明的是，本申请实施例虽然以Android系统为例进行说明，但是其基本原理同样适用于基于iOS、Windows等操作系统的电子设备。图5为本申请实施例公开的视频处理方法，可以应用的场景示例为：图1e中，用户点击“风格”控件2后，进入图1h所示的风格选择界面，用户在风格选择界面选择一个主题，并点击“√”控件后，执行图5所示的流程。或者，图1d所示的拍摄结束后，使用图5所示的流程生成预览视频。也就是说，在执行图5所示的流程之前，用户已经选定为视频配置的音乐以及主题。可以理解的是，以上界面仅为举例，可以统称为视频处理界面，视频处理界面中的控件可以称为视频处理控件。可以理解的是，场景举例中，均以多镜摄影模式为例，但本实施例所述的方法并不限于多镜拍摄的视频。图5包括以下步骤：S1、判断视频是否有转场信息，如果否，执行S2，如果是，执行S3。转场是指，拍摄视频的镜头的变化或者拍摄过程中的暂停，其中，镜头的变化包括但不限于：前后镜头的切换、焦距的变化、多镜模式下不同镜头的切换。暂停是指视频拍摄过程中停止拍摄后又继续拍摄。转场信息是指，指示发生转场的图像帧的信息。可以理解的是，图像帧的信息可以包括但不限于图像帧的唯一标识。在某些实现方式中，从视频的TAG信息中查询转场信息。TAG信息可理解成是用于描述相机拍摄视频过程的描述信息，相机拍摄视频得到视频信息的同时，视频的TAG信息会被同步保存。TAG信息还可以是对与视频同步保存的TAG信息进行修改后得到的TAG信息，修改的一种示例为增加转场信息。在某些实现方式中，TAG信息由底层传输至上层。S2、依据音乐分割视频，得到视频片段。S2之后，执行S4。结合图1g所示的场景，本步骤中使用的音乐，为用户选择的音乐。可以理解的是，有可能主题中包含音乐，或者视频录制中可能采集到音乐，所以，音乐还可以是主题中或者视频中包含的音乐，因此，在用户没有通过界面单独选择音乐的情况下，本步骤中使用的音乐，还可以为主题中包含的音乐或者视频中包含的音乐。S2的某种实现方式可参见图7a所示。依据音乐分割的目的在于，使得特效的展示融入音乐的节奏，从而特效的展示与音乐的节奏更匹配。S3、依据转场信息分割视频，得到视频片段。S3的某种实现方式可参见图8a所示。从前述转场信息的定义可知，转场信息反映的是视频的变化，依据转场信息分割视频的目的在于，使得特效的展示与视频的镜头变化和节奏更匹配。可以理解的是，还可以，依据镜头变化信息或暂停信息分割视频，这里不做限定。S4、依据特效分配规则，为视频片段分配选定的主题中包含的特效。特效分配规则是指，为各个视频片段分配特效的规则。可以理解的是，相机或视频编辑应用程序可提供多个特效，本实施例中，假设每种主题，均提供多个特效中的M个特效添加至视频中。将视频片段的数量记为N个，特效分配规则指示如何将M个特效分配给N个视频片段。本实施例中，特效分配规则的具体内容为：1、在N等于M的情况下：将M个特效分别分配给N个视频片段。可以理解的是，主题中的特效的播放顺序，通常是固定的，通过配置文件被预先配置在电子设备中。为了便于说明，按照在主题中的播放顺序，将主题中包含的特效分别称为第一个特效、第二个特效、……、第M个特效。在一些实现方式中，按照特效在主题中的播放顺序，将M个特效，分别分配给N个视频片段。以图6为例，假设用户从图1g选择的音乐为舒缓类型，从图1h中选择的主题为“美味人生”。该主题中包括三个特效，依次为特效1)、特效2)和特效3)。假设视频被划分为三个视频片段，即图6中视频片段数为3的情况下，为第一个视频片段分配特效1，为第二片段分配特效2，为第三片段分配特效3。在另一些实现方式中，将第一个特效分配给第一个视频片段，将除第一个特效之外的其它特效，随机分配给除第一个视频片段之外的其它视频片段。在又一些实现方式中，将第一个特效分配给第一个视频片段，将最后一个特效分配给最后一个视频片段，将除第一个特效和最后一个特效之外的其它特效，随机分配给除第一个视频片段和最后一个视频片段之外的其它视频片段。以主题中包括三个特效，按照播放顺序为特效1、特效2和特效3，且视频被划分为三个视频片段为例：为第一个视频片段分配特效1，为第二个视频片段分配特效2或特效3，为第三个视频片段分配特效3或特效2。2、在N小于M的情况下：在一些实现方式中，按照特效在主题中的排序，分别为N个视频片段分配特效。还以图6为例，在视频片段数为2的情况下，将特效1分配给第一片段，将特效2分配给第二片段。在另一些实现方式中，从M个特效中，选择N个特效，分别分配给N个视频片段。在某些实现方式中，选择的N个特效包括：主题中第一个特效和最后一个特效。选出特效后，具体分配方式可以参见N等于M的情况下的分配方式。还以主题中包括特效1、特效2和特效3为例，假设视频被划分为2个片段，即N＝2，M＝3，为第一个视频片段分配特效1，为第二个视频片段分配特效3。3、在N大于M的情况下：可以理解的是，某个特效需要分配给多个视频片段。在某些实现方式中，将第一个特效至少分配给第一个视频片段，将最后一个特效至少分配给最后一个视频片段。其它特效可以随机分配给其它视频片段。还以主题中包括特效1、特效2和特效3为例，在视频片段的数量为以下示例的情况下，对应的分配示例可参见图6：N＝4即视频片段数为4，为第一片段分配特效1，为第二片段和第三片段分配特效2，为第四片段分配特效3。N＝5即视频片段数为5，为第一片段分配特效1，为第二片段和第三片段分配特效2，为第四片段和第五片段分配特效3。N≥6即视频片段数≥6，为第一片段分配特效1，为最后两个片段分配特效3，为第二个视频片段至第N-2个片段分配特效2。可以理解的是，以上示例中，无论视频片段的数量如何，为第一个视频片段分配的均为特效1，而在N大于或等于M的情况下，为最后一个视频片段分配的均为特效3。目的在于，虽然视频片段数量的不同，而导致特效在视频中出现的时机和顺序不同，但对于同一个主题，还能保持特效的一致性。即，无论视频是否相同，且无论视频被划分为几个片段，对于不同视频，或同一视频被分割为不同数量的视频片段的情况，即图6中的不同行，第一个片段的特效均相同，在N大于或等于M的情况下，最后一个片段的特效也相同，给用户对该主题一个统一的感受。S5、依据特效播放规则，设置特效在各个视频片段中的播放时机。特效播放规则是指，在各个视频片段中播放特效的时机。可以理解的是，视频片段具有一定的时长，特效的播放时长通常小于视频片段的时长，在本实施例中，还对特效在视频片段中的播放时机进行设置。在某些实现方式中，将一个视频片段的播放时长划分为开始区间、中间区间以及结束区间。可以理解的是，这三个区间的长度可以相同，即对一个视频片段的时长均分，得到三个区间。这三个区间的长度也可以不同。在N小于或等于M的情况下，因为视频片段的数量不多，所以，可以均在每个视频片段的开始区间、中间区间或结束区间，播放为视频片段分配的特效。也就是说，在每个视频片段播放特效的时机相同。如图6中视频片段数为2或3的情况下，因为一种特效仅被分配给一个片段，即播放过程中仅被播放一次，所以，各个片段的特效播放时机相同，以视频片段数为2为例，第一片段播放特效1的时机和第二片段播放特效2的时机均为开始区间，以保持同一主题在视觉感受上的统一性。在N大于M的情况下，因为某些特效被分配给多个视频片段，为了实现更为丰富的视觉效果，在某些实现方式中，对于分配给多个视频片段的特效，在不同的视频片段中设置为随机播放。随机播放可以理解为，在视频片段的随机时长区间，即开始区间、中间区间和结束区间随机选择的一个区间播放。以图6中视频片段数为4为例，因为特效2被分配给第二片段和第三片段，所以，第二片段和第三片段中特效的播放时机均为随机，“随机”是指，在开始区间、中间区间以及结束区间中的任意一个区间播放。可以理解的是，随机导致的效果为，可能第二片段和第三片段中特效2的播放时机相同，也可能不同。可以理解的是，为了进一步丰富视觉效果，对于分配给多个视频片段的特效，为该特效在不同的视频片段中设置不同的播放时机。例如，对于分配给最后两个视频片段的特效3，设置在最后一个视频片段的中间区间播放，设置在倒数第二个视频片段的结束区间播放。综上所述且结合图6，对于被划分为不同数量的视频片段的视频，为第一片段分配的特效均为特效1)，且第一片段播放特效1的时机均为开始区间，以保持同一主题在视觉感受上的统一性。在视频片段的数量大于或等于特效的数量的情况下，为最后一个视频片段均分配特效3)，以增强同一主题在视觉感受上的统一性。将分配给多个视频片段的特效的播放时机设置为随机。因此，在保持同一主题在视觉感受上的统一性的前提下，能够依据视频被划分的片段的数量的不同，体现出差异，实现更为灵活的特效播放效果。可以理解的是，S4和S5的执行顺序不做限定。S6、播放添加主题的视频。可以理解的是，播放视频是指，按照视频片段在视频中的播放顺序，依次播放每个视频片段，在播放任意一个视频片段的过程中，在S5为该视频片段中的特效设置的播放时机，播放S4为该视频片段分配的特效。需要说明的是，特效的播放是实时播放，在播放视频片段之前，无需等待视频片段中的特效加载，而可以边播放边加载。从图5所示的流程可以看出，在用户为视频选定主题后，将视频划分为视频片段，再为视频片段分配特效以及设置特效在视频片段中的播放时机，因为视频片段依据音乐，或者视频的转场信息分割得到，所以，即使对于相同主题，只要用户选定的音乐不同，或者视频的转场信息不同，特效在视频中出现的位置和切换时机就不同，因此，能够实现更为个性化的特效添加。进一步的，为视频片段分配特效并设置特效在视频片段中的播放时机的方式，能够在保证主题的视觉统一性的基础上，使得特效展示更为个性化和灵活。图7a为依据音乐的信息，对视频进行分割的流程，包括以下步骤：S21、查询用户选择的音乐对应的预设分割步长和片段时长区间。可以理解的是，预先为可供用户选择的音乐设置分割规则，分割规则包括分割步长和片段时长区间。分割规则与音乐的对应关系可以被预先配置在电子设备中。分割步长可看作分割的最小单位，片段时长区间是指被分割的视频片段的长度的最小值和最大值构成的区间。为了使得特效与音乐更为匹配，在某些实现方式中，依据音乐的节拍，为音乐配置片段时长区间和分割步长。以图1g中可供用户选择的音乐为例，设置的分割规则的示例如图7b所示：图7b中，音乐类型为可供用户选择的音乐被划分的几种类型，时长是指音乐的演奏时长，名称是指音乐的名称，排序是指音乐在图1g所示的列表中的顺序，预设分割步长是指音乐对应的分割的最小单位。视频自动分割片段时长即为前述片段时长区间。本实施例中，假设用户选择的音乐为属于舒缓类型的，名称为“温暖”的、排序为3的音乐。从图7b中可以看出，该音乐的持续时长为20秒，分割步长为1.09秒。S22、依据分割步长的倍数，生成预设分割点。分割步长的倍数是指分割步长的整数倍，接上例，分割步长为1.09秒，则预设分割点为1.09秒、1.09*2秒、……1.09*P，P为大于2的整数。图7c所示包括一段视频中的各个图像帧，以及图7b中名称为“温暖”的音乐对应的预设分割点a、b和c，以及名称为“恬美”的音乐对应的预设分割点d和e。需要说明的是，为了便于突出依据音乐划分视频片段的特点，假设图7c所示的视频中的每帧图像相同，且不存在转场信息。S23、依据预设分割点和片段时长区间分割视频。为了便于理解，将最终分割视频的各个点，称为实际分割点。可以理解的是，S23的原理为：每个预设分割点均可以假设为实际分割点，将假设的实际分割点前后的图像帧划分为不同的视频片段，但因为有片段时长区间的限制，所以对于时长不在片段时长区间中的视频片段，需要依据预设分割点调整实际分割点，使得划分得到的视频片段的时长在片段时长区间中。具体的分割流程依据上述原理设计，例如，在某些实现方式中，将视频中前X秒的视频划分为一个视频片段，X为小于片段时长区间的上限且与该上限最接近的预设分割点。可以理解的是，某一个视频片段的长度有可能不在片段时长区间中，本实施例中，为了能够完整地播放特效，要求某个视频片段的长度可以大于片段时长区间的上限，但不能视频片段时长区间的下限。如果小于片段时长区间的下限，则需要重新调整实际分割点。假设图7c中所示的预设分割点a、b、c、d和e均恰好为实际分割点，可见，对于相同的视频，在用户选定名称为“温暖”的音乐的情况下，将视频划分为四个视频片段，按照上述特效分配规则和特效播放规则，添加主题1后视频的播放效果可能为：第一个视频片段的开始区间播放特效1，第二个视频片段的开始区间播放特效2，第三个视频片段的开始区间播放特效3，第四个视频片段的中间区间播放特效3。在用户选定名称为“恬美”的音乐的情况下，将视频划分为两个视频片段，按照上述特效分配规则和特效播放规则，添加主题1后视频的播放效果可能为：第一个视频片段的开始区间播放特效1，第二个视频片段的开始区间播放特效2。需要说明的是，视频中的图像帧有自身固定的时长，所以，有可能实际分割点处于某个图像帧的时长范围内，在此情况下，该图像帧要归属于该实际分割点划分的两个视频片段中的任意一个视频片段，例如，归属于该实际分割点之前的一个视频片段。可见，图7a所示的流程，依据音乐分割视频得到视频片段，因为视频片段为承载特效的载体，所以，使得特效与音乐更为匹配。并且，配置不同的音乐的视频，即使使用同一主题，也能呈现不同的特效播放效果，有利于改善用户的体验。图8a为依据视频的信息，对视频进行分割的流程，包括以下步骤：S31、将转场信息指示的图像帧之间的时间点，作为实际分割点，划分视频，得到视频片段。S32、判断视频片段的长度是否大于第一阈值，如果否，结束流程，如果是，执行S33。可以理解的是，第一阈值可以为上述片段时长区间的上限，也可以为预先配置的其它数值，这里不做限定。S33、将长度大于第一阈值的视频片段，依据音乐进行再次分割。在某些实现方式中，依据音乐分割的具体实现方式，可以参见图7a所示。在另一些实现方式中，为了简化处理流程，还可以，将长度大于第一阈值的视频片段中，距离中间时刻最近的预设分割点，作为实际分割点，再次分割长度大于第一阈值的视频片段。中间时刻是指视频所在的时间范围的中点时刻。如前所述，预设分割点依据音乐的预设分割步长确定。因为是二次分割，所以，二次分割后的视频片段的长度，可以不受最小长度的限制，即可以小于片段时长区间的下限。可以理解的是，在图8a所示的流程中，实际分割点处于某个图像帧的范围内的情况下，该图像帧归属于该实际分割点划分的任意一个视频片段。以图8b为例，假设多镜模式拍摄的视频中，存在转场：A表示第一次转场，B表示第二次转场，图8b中第一行所示为多镜模式拍摄的视频中的一些图像帧的示例，即未添加特效的图像帧。图8b中第二行所示为按照长度添加特效的示例，即每5秒切换一次特效。可以理解的是，这种按照长度添加特效的方式，无论视频长度、内容如何，只要选定了某个主题，则特效的展示效果均相同，如图8b所示，每5秒切换一次特效。图8b中第三行为按照图8a所示的流程分割视频，并添加特效的示例：依据A和B的转场信息，前10秒的图像帧被划分为一个视频片段I，添加一种特效，后5秒的图像帧被划为两个视频片段，分别记为II和III，各添加不同的特效。结合图8b可以看出，图8a所示的流程分割得到的视频片段，使得特效的切换与镜头的转换更为一致，有利于提高用户的使用体验，并且，对于采用了不同镜头模式拍摄的视频，即使在相同的主题下，也能得到不一样的视觉效果，能够提升用户的个性化乐趣。可以理解的是，以上均以主题和主题中包含的特效为例进行说明，但可以理解的是，主题中除了包含特效之外，还可以包含音乐、边框、贴纸、滤镜等元素，在以上实施例中，均可与“特效”替换。在将“特效”替换为“滤镜”的情况下，滤镜对视频片段的全部时长有效。还可以，将以上实施例中的“主题”替换为其它元素，例如边框、贴纸、或滤镜等。同样的，滤镜对视频片段的全部时长有效。因此，在视频中添加的主题、边框、贴纸、或滤镜等，主题中包含的特效、边框、贴纸、滤镜等用于显示的元素，均可统称为对象。本申请的实施例还公开一种计算机可读存储介质，其上存储有程序，在计算机设备运行所述应用程序时，实现上述实施例所述的视频处理方法。
