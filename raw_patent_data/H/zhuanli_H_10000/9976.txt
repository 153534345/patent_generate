标题title
一种大中型固定翼无人机遥测数据解析方法及系统
摘要abst
本发明公开了一种大中型固定翼无人机遥测数据解析方法及系统，包括如下步骤：步骤1、采用XML格式语言对无人机遥测数据通信协议进行ICD接口配置，得到XML格式的ICD接口配置信息；步骤2、以面向对象的程序设计方法实现动态链接库；步骤3、读取ICD接口配置信息中的数据块信息、数据字段信息及转换方法信息，创建数据块容器、数据字段容器以及转换方法容器；步骤4、对遥测数据缓冲区进行解析，得到帧识别码及遥测数据，对遥测帧数据缓冲区的遥测数据进行解析并存储，得到遥测帧数据字段实际值。本发明的有效降低了遥测帧协议变更带来的程序修改工作量，并具有较好的可扩展性，提高了地面站软件的通用性。
权利要求书clms
1.一种大中型固定翼无人机遥测数据解析方法，其特征在于，包括如下步骤：步骤1、采用XML格式语言对无人机遥测数据通信协议进行ICD接口配置，得到XML格式的ICD接口配置信息，所述ICD接口配置信息包括数据块信息、数据字段信息及转换方法信息，划分所述数据块信息、数据字段信息及转换方法信息的属性及交互关系；步骤2、根据所述步骤1得到的XML格式的ICD接口配置信息，以及所述数据块信息、数据字段信息及转换方法信息的属性及交互关系，以面向对象的程序设计方法实现动态链接库，所述动态链接库包括读取单元、解析单元以及查找单元；步骤3、调用步骤2中所述动态链接库的读取单元，分别读取所述ICD接口配置信息中的数据块信息、数据字段信息及转换方法信息，创建数据块容器、数据字段容器以及转换方法容器，依次将所述转换方法容器添加至所述数据字段容器，将所述数据字段容器添加至所述数据块容器中；步骤4、调用步骤2中所述动态链接库的解析单元，对遥测数据缓冲区进行解析，得到帧识别码及遥测数据，随之调用所述步骤3得到的数据块容器、数据字段容器以及转换方法容器，对地面站接收到的遥测帧数据缓冲区的遥测数据进行解析并存储，得到遥测帧数据字段实际值。2.如权利要求1所述的大中型固定翼无人机遥测数据解析方法，其特征在于，所述数据块容器中包括readBlockConfig函数和parseBlockBuff函数，所述readBlockConfig函数用于读取数据块信息，所述parseBlockBuff函数用于解析所述遥测数据中的数据块信息；所述数据字段容器中包括readSegmentConfig函数、parseSegmentBuff函数和getValue函数，所述readSegmentConfig函数用于读取数据字段信息，所述parseSegmentBuff函数用于解析所述遥测数据中的数据字段信息，所述getValue函数用于获取遥测帧数据字段实际值；所述转换方法容器中包括readConversionConfig函数、decodeValue函数和encodeValue函数，所述readConversionConfig函数用于读取转换方法信息，所述decodeValue函数用于将字段编码值转换为字段实际值，所述encodeValue函数用于将字段实际值转换为字段编码值。3.如权利要求2所述的大中型固定翼无人机遥测数据解析方法，其特征在于，所述步骤3包括如下操作：步骤31，地面站调用所述动态链接库中的读取单元，读取所述步骤1得到的ICD接口配置信息中的数据块信息的列表；步骤32，选取所述数据块信息列表中的数据块信息，创建数据块容器，调用所述数据块容器的readBlockConfig函数，读取所述数据块信息，初始化数据块容器属性，并添加至动态链接库的数据块容器列表中；步骤33，选取所述数据块信息中的数据字段信息，创建数据字段容器，调用数据字段容器的readSegmentConfig函数，读取所述数据字段信息，初始化数据字段容器属性；步骤34，根据步骤33中所述数据字段信息携带的转换方法类型，创建转换方法容器，调用转换方法容器中的readConversionConfig函数，读取所述转换方法信息，初始化转换方法容器属性；步骤35，将所述转换方法容器添加到所述数据字段容器中，随之将配置完成的数据字段容器添加到所述数据块容器的字段列表中；步骤36，若所述数据块信息中还有未读取的数据字段信息，则返回所述步骤33读取下一个数据字段信息，否则结束步骤3；步骤37，若所述数据块信息列表中还有未读取的数据块信息，则返回所述步骤32读取下一个数据块信息，否则结束步骤3。4.如权利要求2所述的大中型固定翼无人机遥测数据解析方法，其特征在于，所述步骤4包括如下操作：步骤41，地面站调用步骤2中动态链接库的解析单元，解析遥测帧数据缓冲区，得到帧识别码及遥测数据；步骤42，根据所述帧识别码在动态链接库中查找对应的数据块容器；步骤43，若未找到匹配的数据块容器，返回失败，结束解析过程；步骤44，若找到匹配的数据块容器，则调用所述数据块容器的parseBlockBuff函数，对步骤41得到的遥测数据进行解析得到数据字段信息；调用动态链接库的查找单元，查找数据块容器中的数据字段容器；步骤45，调用步骤44数据块容器中数据字段容器的parseSegmentBuff函数，解析数据字段容器中已配置的数据字段信息得到其属性，即得到字段编码值；步骤46，调用步骤45所述的数据字段容器中转换方法容器的decodeValue函数，将步骤45所述得字段编码值转换为字段实际值，并保存在步骤45所述的数据字段容器中；步骤47，重复步骤45、步骤46，解析步骤44所述数据块容器的字段列表，得到遥测帧数据字段实际值。5.如权利要求1所述的大中型固定翼无人机遥测数据解析方法，其特征在于，所述解析方法还包括：步骤5、地面站通过步骤1所述的动态链接库的查找函数，查找指定数据块和数据字段，获取指定的数据字段容器，得到遥测帧数据字段实际值，并于显示模块进行呈现。6.如权利要求1所述的大中型固定翼无人机遥测数据解析方法，其特征在于，所述ICD接口配置信息由至少一个数据块组成，所述数据块由至少一个数据字段组成，所述数据字段包括转换方法。7.一种实现权利要求5-6中任一项所述的大中型固定翼无人机遥测数据解析方法的系统，其特征在于，所述解析系统包括动态链接库，所述动态链接库包括读取单元、解析单元和查找单元；所述读取单元包括读取函数readStreamConfig，用于读取XML格式的ICD接口配置信息中的数据块信息的列表；所述解析单元包括解析入口函数parseRecvBuff，用于解析地面站接收到的遥测数据缓冲区；所述查找单元包括查找函数findDataSegment，用于查找指定的数据字段容器。
说明书desc
技术领域本发明属于无人机数据处理技术领域，具体涉及一种大中型固定翼无人机遥测数据解析方法及系统。背景技术近年来随着无人机及其他相关邻域学科的飞速发展，无人机已发展成集侦察、攻击于一体的有力武器，在未来无人机将具有全自主完成远程打击甚至空空作战任务的攻击能力，尤其是固定翼无人机，因其优良的功能、模块化集成，初始出现就能够应用在测绘、地质、石油、农林等领域，随着无人机的技术快速发展，其应用也得到了更广的扩展。在无人机系统中，无人机飞行控制计算机与地面指挥控制站的通讯数据一般可分为：飞控机发给地面站的遥测数据，以及地面站发给飞控机的遥控数据。无人机当前的状态数据，以及地面站下达的控制指令，都会遵从指定的接口控制文档来封装和识别。因此，根据ICD解析飞控机遥测帧也成为地面站最基本的一个功能组成模块。地面站对遥测数据的处理流程如图1所示。地面站通过地面视距链路终端接收到来自飞控计算机的遥测数据后，在接收数据缓冲区中根据帧同步字、帧长度、帧校验等信息识别出符合ICD规范的遥测数据帧。无人机系统为了降低遥测数据传输带宽消耗，提高遥测信息传输效率，遥测数据帧协议设计一般都具有格式紧凑、类型多样等特点，一些字段为了提高其数据精度，还会按比例尺进行编码，通信协议与解析算法耦合度较高会增大维护工作，此外，在无人机系统开发、维护过程中，地面站与飞控机的ICD协议的版本往往变更比较频繁，导致地面站的协议解析工作实现和维护工作量非常庞大。因此，在地面站中如何记录遥测数据帧的协议规则成为本领域技术人员亟待解决的技术问题。发明内容针对现有技术中存在的地面站协议解析工作量大的问题，本发明的目的在于，提供一种大中型固定翼无人机遥测数据解析方法及系统，以XML格式标记语言抽象化管理ICD协议，自动解析遥测数据帧，能够简便且清晰地为地面站记录遥测数据协议规则，很大程度地降低地面站的ICD协议的解析工作量。为了达到上述目的，本发明采用如下技术方案予以解决：一种大中型固定翼无人机遥测数据解析方法，包括如下步骤：步骤1、采用XML格式语言对无人机遥测数据通信协议进行ICD接口配置，得到XML格式的ICD接口配置信息，所述ICD接口配置信息包括数据块信息、数据字段信息及转换方法信息，划分所述数据块信息、数据字段信息及转换方法信息的属性及交互关系；步骤2、根据所述步骤1得到的XML格式的ICD接口配置信息，以及所述数据块信息、数据字段信息及转换方法信息的属性及交互关系，以面向对象的程序设计方法实现动态链接库，所述动态链接库包括读取单元、解析单元以及查找单元；步骤3、调用步骤2中所述动态链接库的读取单元，分别读取所述ICD接口配置信息中的数据块信息、数据字段信息及转换方法信息，创建数据块容器、数据字段容器以及转换方法容器，依次将所述转换方法容器添加至所述数据字段容器，将所述数据字段容器添加至所述数据块容器中；步骤4、调用步骤2中所述动态链接库的解析单元，对遥测数据缓冲区进行解析，得到帧识别码及遥测数据，随之调用所述步骤3得到的数据块容器、数据字段容器以及转换方法容器，对地面站接收到的遥测帧数据缓冲区的遥测数据进行解析并存储，得到遥测帧数据字段实际值。进一步的，所述数据块容器中包括readBlockConfig函数和parseBlockBuff函数，所述readBlockConfig函数用于读取数据块信息，所述parseBlockBuff函数用于解析所述遥测数据中的数据块信息；所述数据字段容器中包括readSegmentConfig函数、parseSegmentBuff函数和getValue函数，所述readSegmentConfig函数用于读取数据字段信息，所述parseSegmentBuff函数用于解析所述遥测数据中的数据字段信息，所述getValue函数用于获取遥测帧数据字段实际值；所述转换方法容器中包括readConversionConfig函数、decodeValue函数和encodeValue函数，所述readConversionConfig函数用于读取转换方法信息，所述decodeValue函数用于将字段编码值转换为字段实际值，所述encodeValue函数用于将字段实际值转换为字段编码值。进一步的，所述步骤3包括如下操作：步骤31，地面站调用所述动态链接库中的读取单元，读取所述步骤1得到的ICD接口配置信息中的数据块信息的列表；步骤32，选取所述数据块信息列表中的数据块信息，创建数据块容器，调用所述数据块容器的readBlockConfig函数，读取所述数据块信息，初始化数据块容器属性，并添加至动态链接库的数据块容器列表中；步骤33，选取所述数据块信息中的数据字段信息，创建数据字段容器，调用数据字段容器的readSegmentConfig函数，读取所述数据字段信息，初始化数据字段容器属性；步骤34，根据步骤33中所述数据字段信息携带的转换方法类型，创建转换方法容器，调用转换方法容器中的readConversionConfig函数，读取所述转换方法信息，初始化转换方法容器属性；步骤35，将所述转换方法容器添加到所述数据字段容器中，随之将配置完成的数据字段容器添加到所述数据块容器的字段列表中；步骤36，若所述数据块信息中还有未读取的数据字段信息，则返回所述步骤33读取下一个数据字段信息，否则结束步骤3；步骤37，若所述数据块信息列表中还有未读取的数据块信息，则返回所述步骤32读取下一个数据块信息，否则结束步骤3。进一步的，所述步骤4包括如下操作：步骤41，地面站调用步骤2中动态链接库的解析单元，解析遥测帧数据缓冲区，得到帧识别码及遥测数据；步骤42，根据所述帧识别码在动态链接库中查找对应的数据块容器；步骤43，若未找到匹配的数据块容器，返回失败，结束解析过程；步骤44，若找到匹配的数据块容器，则调用所述数据块容器的parseBlockBuff函数，对步骤41得到的遥测数据进行解析得到数据字段信息；调用动态链接库的查找单元，查找数据块容器中的数据字段容器；步骤45，调用步骤44数据块容器中数据字段容器的parseSegmentBuff函数，解析数据字段容器中已配置的数据字段信息得到其属性，即得到字段编码值；步骤46，调用步骤45所述的数据字段容器中转换方法容器的decodeValue函数，将步骤45所述得字段编码值转换为字段实际值，并保存在步骤45所述的数据字段容器中；步骤47，重复步骤45、步骤46，解析步骤44所述数据块容器的字段列表，得到遥测帧数据字段实际值。进一步的，所述解析方法还包括：步骤5：地面站通过步骤1所述的动态链接库的查找函数，查找指定数据块和数据字段，获取指定的数据字段容器，得到遥测帧数据字段实际值，并于显示模块进行呈现。进一步的，所述ICD接口配置信息由至少一个数据块组成，所述数据块由至少一个数据字段组成，所述数据字段包括转换方法。另一方面，本发明还提供一种实现上述大中型固定翼无人机遥测数据解析方法的系统，所述解析系统包括动态链接库，所述动态链链接库包括读取单元、解析单元和查找单元；所述读取单元包括读取函数readStreamConfig，用于读取XML格式的ICD接口配置信息中的数据块信息的列表；所述解析单元包括解析入口函数parseRecvBuff，用于解析地面站接收到的遥测数据缓冲区；所述查找单元包括查找函数findDataSegment，用于查找指定的数据字段容器。相较于现有技术，本发明具有如下技术效果：1、本发明通过以上XML格式实现将无人机遥测数据帧协议抽象化配置和管理，采用 XML格式管理的无人机遥测数据帧协议，能够大大减少ICD变更带来的地面站实现、维护工作量，并且可通过增加字段类型、转换公式等方法来扩展、适应其它机型的无人机系统，通用性强。2、本发明将遥测数据解析方法封装成为一个可移植的动态链库，使遥测数据解析方法具有更好的通用性，以实现对飞控机遥测数据的解析。综上，本发明的方法有效降低了遥测帧协议变更带来的程序修改工作量，并具有较好的可扩展性，提高了地面站软件的通用性。附图说明图1是地面站的遥测数据处理流程；图2是本发明的大中型固定翼无人机遥测数据解析方法的流程图；图3是数据块信息的示意图；图4是数据字段信息的示意图；图5是动态链接库ICDLib的数据容器示意图；图6是数据块容器、数据字段容器及转换方法容器配置流程图；图7是解析流程图。以下结合附图和具体实施方式对本发明进一步解释说明。具体实施方式首先，对本发明涉及到的相关知识进行介绍：无人机系统的遥测数据由多个遥测数据帧组成。无人机机载设备的测量信息、状态信息以及遥控指令的反馈信息都被封装在遥测数据帧中，按照一定周期循环发送到地面控制指挥中心，从而为地面指挥人员提供无人机当前的飞行、工作状态。一个遥测数据帧通常由帧头、帧尾、数据区组成，其中，帧头即同步字，用于接收端识别数据帧的起止范围，帧尾由校验和构成，用于验证遥测数据帧的传输正确性；数据区为无人机向地面控制站发送的遥测数据，包含的信息有无人机当前的位置、姿态、机载设备测量值、运行状态等。为了提高遥测数据的传输信息量，遥测数据以字段为单位紧凑排列在遥测数据帧中，一个字段可以由一个或多个字节组成，也可以由一个位组成。例如，一个遥测数据帧通讯协议如表1所示：表1遥测数据帧通讯协议表从表1可看出，无人机系统ICD中定义的遥测数据通常以多个数据帧 以及帧内多个数据字段组成。数据帧中，字段1是一个有符号的整数，字段2是一个无符号的整数，字段3、字段4是位域型数据。本发明提供的大中型固定翼无人机遥测数据解析方法，如图2所示，包括如下步骤：步骤1，采用XML格式语言对无人机遥测数据通信协议进行ICD接口配置，得到XML格式的ICD接口配置信息，所述ICD接口配置信息包括数据块信息、数据字段信息及转换方法信息，划分所述数据块信息、数据字段信息及转换方法信息的属性及交互关系；具体操作如下：将遥测数据中每个下行遥测通讯帧在XML格式的ICD接口配置信息中定义为一个数据块信息，XML格式的ICD接口配置信息包括至少一个数据块信息，如图2、3所示，每个数据块信息由至少一个数据字段信息组成；数据字段信息 包括转换方法信息。如图3所示，数据块信息的属性包括：title：标题；Name：数据块名称；id：标识。如图4所示，数据字段信息Segment的属性包括：Type：标识字段；Title：字段显示信息；Name：字段id；data-length：字段的长度；byte-offset：字段在数据帧中的字节偏移量；bit-offset：字段在数据帧中的位偏移量；通过后3个属性能够标识出该数据字段在遥测数据帧中的具体位置。如图4所示，数据字段信息的属性type标识字段的数据类型如下：FIXED_BYTE：整数型常数字段；FIXED_BIT：位域型常数字段；SBYTE_ARRAY：有符号整数字段；UBYTE_ARRAY：无符号整数字段；SBIT_ARRAY：有符号位域字段；UBIT_ARRAY：无符号位域字段；BUFF：字符串类型字段；FLOAT：单浮点数字段；DOUBLE：双精度浮点数字段。如图4所示，转换方法信息的属性包括type属性，以及子节点numeric或子节点preset；其中：type属性用于标识数据字段的转换类型，包括数值转换和常数型转换；当转换类型type为数值转换时，转换方法信息定义了子节点 numeric；当转换类型type为常数型转换时，转换方法信息定义了子节点preset。其中：子节点numeric用于描述数据字段segment的数学转换公式信息，numeric节点包括如下属性：Shift：变换差值。Numerator：变换系数分子；Denominator：变换系数分母；其中，变换系数是指：字段编码值到字段实际值的比例尺换算系数。字段编码值，即字段在数据帧内的数值，通常以整数形式封装和传输，字段实际值是整数或者是浮点数。字段实际值＝字段编码值*变换系数分子/变换系数分母+变换差值。子节点preset用于描述数据字段的常数预设值Value。常数型字段用于表示帧序列号、帧复用标志等信息，在解析时，通过判断字段与常数预设值是否相同来区分数据帧与通信协议是否匹配。本步骤通过以上XML格式实现将无人机遥测数据帧协议抽象化配置和管理，采用XML 格式管理的无人机遥测数据帧协议，能够大大减少ICD变更带来的地面站实现、维护工作量，并且可通过增加字段类型、转换公式等方法来扩展、适应其它机型的无人机系统，通用性强。步骤2，根据所述步骤1得到的XML格式的ICD接口配置信息，以及所述数据块信息、数据字段信息及转换方法信息的属性及交互关系，以面向对象的程序设计方法实现动态链接库，所述动态链接库包括读取单元、解析单元以及查找单元，如图 5所示。步骤3、调用步骤2中所述动态链接库的读取单元，分别读取所述ICD接口配置信息中的数据块信息、数据字段信息及转换方法信息，创建数据块容器、数据字段容器以及转换方法容器，依次将所述转换方法容器添加至所述数据字段容器，将所述数据字段容器添加至所述数据块容器中；如图6所示，数据块容器、数据字段容器及转换方法容器配置具体包括如下子步骤：步骤31，地面站调用所述动态链接库中的读取单元，读取所述步骤1得到的ICD接口配置信息中的数据块信息的列表；步骤32，选取所述数据块信息列表中的数据块信息，创建数据块容器，调用所述数据块容器的readBlockConfig函数，读取所述数据块信息，初始化数据块容器属性，并添加至动态链接库的数据块容器列表中；如图5所示，所述数据块容器中包括readBlockConfig函数和parseBlockBuff函数，所述readBlockConfig函数用于读取数据块信息，所述parseBlockBuff函数用于解析所述遥测数据中的数据块信息；步骤33，选取所述数据块信息中的数据字段信息，创建数据字段容器，调用数据字段容器的readSegmentConfig函数，读取所述数据字段信息，初始化数据字段容器属性；如图5所示，所述数据字段容器中包括readSegmentConfig函数、parseSegmentBuff 函数和getValue函数，所述readSegmentConfig函数用于读取数据字段信息，所述 parseSegmentBuff函数用于解析所述遥测数据中的数据字段信息，所述getValue函数用于获取遥测帧数据字段实际值；步骤34，根据步骤33中所述数据字段信息携带的转换方法类型，创建转换方法容器，调用转换方法容器中的readConversionConfig函数，读取所述转换方法信息，初始化转换方法容器属性；如图5所示，所述转换方法容器中包括readConversionConfig函数、decodeValue函数和encodeValue函数，所述readConversionConfig函数用于读取转换方法信息，所述decodeValue 函数用于将字段编码值转换为字段实际值，所述encodeValue函数用于将字段实际值转换为字段编码值。步骤35，将所述转换方法容器添加到所述数据字段容器中，随之将配置完成的数据字段容器添加到所述数据块容器的字段列表中；步骤36，若所述数据块信息中还有未读取的数据字段信息，则返回所述步骤33读取下一个数据字段信息，否则结束步骤3；步骤37，若所述数据块信息列表中还有未读取的数据块信息，则返回所述步骤32读取下一个数据块信息，否则结束步骤3。步骤4、调用步骤2中所述动态链接库的解析单元，对遥测数据缓冲区进行解析，得到帧识别码及遥测数据，随之调用所述步骤3得到的数据块容器、数据字段容器以及转换方法容器，对地面站接收到的遥测帧数据缓冲区的遥测数据进行解析并存储，得到遥测帧数据字段实际值。如图7所示，解析步骤包括如下子步骤：步骤41，地面站调用步骤2中动态链接库的解析单元，解析遥测帧数据缓冲区，得到帧识别码及遥测数据；步骤42，根据所述帧识别码在动态链接库中查找对应的数据块容器；步骤43，若未找到匹配的数据块容器，返回失败，结束解析过程；步骤44，若找到匹配的数据块容器，则调用所述数据块容器的parseBlockBuff函数，对步骤41得到的遥测数据进行解析得到数据字段信息；调用动态链接库的查找单元，查找数据块容器中的数据字段容器；步骤45，调用步骤44数据块容器中数据字段容器的parseSegmentBuff函数，解析数据字段容器中已配置的数据字段信息得到其属性，即得到字段编码值；步骤46，调用步骤45所述的数据字段容器中转换方法容器的decodeValue函数，将步骤45所述得字段编码值转换为字段实际值，并保存在步骤45所述的数据字段容器中；步骤47，重复步骤45、步骤46，解析步骤44所述数据块容器的字段列表，得到遥测帧数据字段实际值。步骤5：地面站通过步骤1所述的动态链接库的查找函数，查找指定数据块和数据字段，获取指定的数据字段容器，得到遥测帧数据字段实际值，并于显示模块进行呈现。本发明还给出了实现上述大中型固定翼无人机遥测数据解析系统，包括动态链接库，所述动态链链接库包括读取单元、解析单元和查找单元；所述读取单元包括读取函数readStreamConfig，用于读取XML格式的ICD接口配置信息中的数据块信息的列表；所述解析单元包括解析入口函数parseRecvBuff，用于解析地面站接收到的遥测数据缓冲区；所述查找单元包括查找函数findDataSegment，用于查找指定的数据字段容器。
