标题title
适用于云端LED照明节能系统的轻量认证方法
摘要abst
适用于云端LED照明节能系统的轻量认证方法，属于数据处理方法技术领域，包括以下步骤：步骤S1，注册并形成群组密钥：认证服务器收集家用网关所需服务对应的应用服务器的认证密钥，并将所有认证密钥和该家用网关的ID组合形成群组密钥并储存；步骤S2，家用网关使用应用服务的双重认证：家用网关将账号、密码以及应用服务代码传送至认证服务器进行认证；家用网关获得认证服务器传送的认证服务令牌和乱码顺序号码后，根据家用网关存储的乱码获得乱码解，并将乱码顺序号码和乱码解传送至应用服务器并与应用服务器存储的乱码进行比对。本方案使用轻量的计算资源，为家庭能源管理系统，带来更安全的云端使用环境，并能够维持云端的服务质量。
权利要求书clms
1.适用于云端LED照明节能系统的轻量认证方法，其特征在于，所述云端LED照明节能系统包括家庭能源管理系统和云整合端；所述家庭能源管理系统，包括家用网关、环境光感测装置、电源分配器、家用照明设备；所述云整合端包括认证服务器和应用服务器；其包括以下步骤：步骤S1，注册并形成群组密钥：家用网关，向认证服务器提出身份验证的需求并选择所需服务；认证服务器收集家用网关所需服务对应的应用服务器的认证密钥，并将所有认证密钥和该家用网关的ID组合形成群组密钥并储存，完成注册；步骤S2，家用网关使用应用服务的双重认证：家用网关和应用服务器共享乱码；家用网关将账号、密码以及应用服务代码传送至认证服务器进行认证，从而完成第一重的认证；家用网关获得认证服务器传送的认证服务令牌和乱码顺序号码后，根据家用网关存储的乱码获得乱码解，并将乱码顺序号码和乱码解传送至应用服务器并与应用服务器存储的乱码进行比对，从而完成第二重的认证；家用网关收到应用服务令牌之后，就将应用服务令牌和认证服务令牌合成一个令牌，然后将令牌传给应用服务器。2.根据权利要求1所述的适用于云端LED照明节能系统的轻量认证方法，其特征在于，步骤S1，包括以下步骤：步骤S101，家用网关向云整合端的认证服务器提出群组密钥的需求；步骤S102，当认证服务器收到需求后，先向家用网关提出验证身份的需求；步骤S103，家用网关回传账号以及密码给认证服务器进行身份的验证；步骤S104，认证服务器，验证家用网关的身份：如果身份验证成功，则将家用网关导向服务的选择；如果身份验证失败，则回传身份验证失败的消息并请家用网关重新回传身份验证信息，返回至步骤S103；步骤S105，家用网关选择自己所需的服务，并且将所需服务的信息传回给认证服务器；步骤S106，当认证服务器收到家用网关回传的所需服务后，就将家用网关的设备码、所需服务、以及家用网关ID传送给家用网关所需服务对应的所有应用服务器；步骤S107，当对应的应用服务器收到家用网关的设备码、所需服务、以及家用网关 ID后，随机产生认证密钥，并储存该应用服务器的认证密钥及家用网关 ID；然后，各个对应的应用服务器回传认证密钥给认证服务器，认证服务器则将各个对应的应用服务器的认证密钥和该家用网关的ID组合形成群组密钥并储存；群组密钥的形式为GK=，其中service-i表示家用网关所需服务对应的第i个应用服务器的认证密钥，且 1≤i≤n，n为家用网关所需服务对应的应用服务器的总个数。3.根据权利要求2所述的适用于云端LED照明节能系统的轻量认证方法，其特征在于，步骤S107中，如果家用网关增加所需服务，同时，增加的所需服务对应新的应用服务器，则认证服务器向增加的所需服务对应的应用服务器申请该服务的认证密钥，并将该认证密钥结合到群组密钥中。4.根据权利要求1或2所述的适用于云端LED照明节能系统的轻量认证方法，其特征在于，步骤S2，包括以下步骤：步骤S201，家用网关产生一组乱码，然后将乱码与所需服务传送给应用服务器；乱码为英文与数字结合的随机数；步骤S202，应用服务器收到乱码与所需服务后，回传应用服务代码给家用网关，并且将家用网关导向至认证服务器；步骤S203，家用网关将账号、密码以及应用服务代码传送至认证服务器进行认证；步骤S204，如果认证成功，认证服务器传送认证服务令牌以及乱码顺序号码给家用网关，如果认证失败，认证服务器回传失败的消息给家用网关；乱码顺序号码，为一组数字组成的数列，其中每个数字表示乱码中的字符位置数；步骤S205，家用网关收到认证服务令牌及乱码顺序号码之后，根据乱码顺序号码中的位置数获取乱码的数字产生乱码解，并将乱码顺序号码以及乱码解传送至应用服务器进行认证；步骤S206，应用服务器收到乱码顺序号码与乱码解后，与存储的乱码进行比对：如果比对成功，则会回传应用服务令牌给家用网关；如果比对失败，则回传失败消息给家用网关；步骤S207，家用网关收到应用服务令牌之后，就将应用服务令牌和认证服务令牌合成一个令牌，然后将令牌传给应用服务器开始使用应用服务器的服务。5.根据权利要求4所述的适用于云端LED照明节能系统的轻量认证方法，其特征在于，还包括步骤S3，对应用服务器和家用网关之间的通讯消息进行加密和解密；加密的方法采用取代加密和换位加密；解密的方法采用换位解密和取代解密。6.根据权利要求5所述的适用于云端LED照明节能系统的轻量认证方法，其特征在于，步骤S3，包括以下步骤：步骤S301，计算通讯消息明文的封包字的集合数s以及字符串长度l；步骤S302，利用随机数产生器产生取代移动的方向与位置数m；步骤S303，计算最后要移动的位置数k=m%s；步骤S304，将通讯消息明文带入E=%s进行取代加密，得到第一密文的字母的字母表序号E，从而得到第一密文，其中，x为通讯消息明文中字母的字母表序号；步骤S305，设置两个字母构成的移动消息，对第一密文进行换位加密得到第二密文，然后在第二密文前端加上移动消息得到第三密文；步骤S306，对第三密文和移动的位置数k，一并存储。7.根据权利要求6所述的适用于云端LED照明节能系统的轻量认证方法，其特征在于，步骤S305中：根据移动消息的第一个字母的字母表序号，决定第一密文中的字母移动方向和替换位置：如果移动消息第一个字母的字母表序号是奇数，则表示第一密文中的字母向左移动换位，并对第一密文中位置序号为奇数的字母进行替换；否则，第一密文中的字母向右移动换位，并对第一密文中位置序号为偶数的字母进行替换；令移动消息的第二个字母的字母表序号为k’，带入F=% l，得到加密移动换位的距离F，其中，z为第一密文的字符串的序号。8.根据权利要求7所述的适用于云端LED照明节能系统的轻量认证方法，其特征在于，步骤S3，还包括以下步骤：步骤S307，通讯消息进行换位解密，已得知通讯消息的封包字的集合数s和移动的位置数k，从第三密文的前端两个字母得到移动消息，并删除第三密文前端两个字母得到第二密文；根据移动消息第一个字母的字母表序号，确定加密时第一密文中的字母移动方向和替换位置，从而得到解密时字母的移动方向和替换位置；根据移动消息第二个字母的字母表序号k’，将第二密文带入Q=% l，得到解密移动换位的距离Q，其中，z为第二密文的字符串的序号；已知换位的字母的位置、方向和距离，进行换位的解密，得到第一密文；步骤S308，已知封包字的集合数s和移动的位置数k，将第一密文带入P=%s，进行密文的解密，得到通讯消息明文的字母的字母表序号P，从而得到通讯消息明文，其中，x为第一密文中字母的字母表序号。
说明书desc
技术领域本发明属于数据处理方法技术领域，具体涉及适用于云端LED照明节能系统的轻量认证方法。背景技术公开号为CN114364084A的中国专利，公开了基于云端的LED照明节能系统以及节能方法，其包括云整合端。云整合端，根据环境光感测装置上传的环境光中红光、绿光和蓝光的平均亮度Bt，基于场景，推导和执行照明亮度的PWM值，经MQTT broker发布到电源分配器的Raspberry Pi 3电路板，Raspberry Pi 3电路板调整家用照明设备的实际亮度。上述方案使用HEMS。HEMS是一项可以在提高用电效率并为节电和减少环境负荷做贡献的同时，还可以提高生活舒适度和生活质量的技术，其在家用设备上加装电量感测装置及控制模块，经由家用能源管理网关及智慧电表将资料连结云端作整合服务。如果将上述方案在市场上推广，则云整合端将同时连接多个HEMS，需要同时回应多个HEMS的服务需求。因此，云整合端的服务需求量是庞大的。目前，云整合端所提供的云端服务，其服务需求大多是没有安全机制的保护，无法确保单独的HEMS服务需求是否已被窃听或窜改。也有对云整合端的服务需求采用安全机制的方案，但是，这种方案必须经过许多道程序才能确保通信的安全性。即每个的HEMS服务需求必须经过繁复的程序以保障其安全。这种经过繁复的程序以保障通信安全的通讯方式，虽然可以获得安全保证，但是会为整体系统带来过量运算的负担，以致云整合端无法提供快速且安全的服务质量。考虑到与云整合端对接的HEMS的庞大数量，以及云整合端和HEMS之间的保密程度，有必要提供适用于云端LED照明节能系统的轻量认证方法，提供HEMS所需的安全程度的认证机制，并减少运算资源。发明内容鉴于上述现有技术的不足之处，本发明的目的在于提供适用于云端LED照明节能系统的轻量认证方法。为了达到上述目的，本发明采取了以下的技术方案。适用于云端LED照明节能系统的轻量认证方法，所述云端LED照明节能系统包括家庭能源管理系统和云整合端；所述家庭能源管理系统，包括家用网关、环境光感测装置、电源分配器、家用照明设备；所述云整合端包括认证服务器和应用服务器；其包括以下步骤：步骤S1，注册并形成群组密钥：家用网关，向认证服务器提出身份验证的需求并选择所需服务；认证服务器收集家用网关所需服务对应的应用服务器的认证密钥，并将所有认证密钥和该家用网关的ID组合形成群组密钥并储存，完成注册；步骤S2，家用网关使用应用服务的双重认证：家用网关和应用服务器共享乱码；家用网关将账号、密码以及应用服务代码传送至认证服务器进行认证，从而完成第一重的认证；家用网关获得认证服务器传送的认证服务令牌和乱码顺序号码后，根据家用网关存储的乱码获得乱码解，并将乱码顺序号码和乱码解传送至应用服务器并与应用服务器存储的乱码进行比对，从而完成第二重的认证；家用网关收到应用服务令牌之后，就将应用服务令牌和认证服务令牌合成一个令牌，然后将令牌传给应用服务器。进一步，步骤S1，包括以下步骤：步骤S101，家用网关向云整合端的认证服务器提出群组密钥的需求；步骤S102，当认证服务器收到需求后，先向家用网关提出验证身份的需求；步骤S103，家用网关回传账号以及密码给认证服务器进行身份的验证；步骤S104，认证服务器，验证家用网关的身份：如果身份验证成功，则将家用网关导向服务的选择；如果身份验证失败，则回传身份验证失败的消息并请家用网关重新回传身份验证信息，返回至步骤S103；步骤S105，家用网关选择自己所需的服务，并且将所需服务的信息传回给认证服务器；步骤S106，当认证服务器收到家用网关回传的所需服务后，就将家用网关的设备码、所需服务、以及家用网关ID传送给家用网关所需服务对应的所有应用服务器；步骤S107，当对应的应用服务器收到家用网关的设备码、所需服务、以及家用网关ID后，随机产生认证密钥，并储存该应用服务器的认证密钥及家用网关 ID；然后，各个对应的应用服务器回传认证密钥给认证服务器，认证服务器则将各个对应的应用服务器的认证密钥和该家用网关的ID组合形成群组密钥并储存；群组密钥的形式为GK=，其中service-i表示家用网关所需服务对应的第i个应用服务器的认证密钥，且 1≤i≤n，n为家用网关所需服务对应的应用服务器的总个数。进一步，步骤S107中，如果家用网关增加所需服务，同时，增加的所需服务对应新的应用服务器，则认证服务器向增加的所需服务对应的应用服务器申请该服务的认证密钥，并将该认证密钥结合到群组密钥中。进一步，步骤S2，包括以下步骤：步骤S201，家用网关产生一组乱码，然后将随机数与所需服务传送给应用服务器；乱码为英文与数字结合的随机数；步骤S202，应用服务器收到乱码与所需服务后，回传应用服务代码给家用网关，并且将家用网关导向至认证服务器；步骤S203，家用网关将账号、密码以及应用服务代码传送至认证服务器进行认证；步骤S204，如果认证成功，认证服务器传送认证服务令牌以及乱码顺序号码给家用网关，如果认证失败，认证服务器回传失败的消息给家用网关；乱码顺序号码，为一组数字组成的数列，其中每个数字表示乱码中的字符位置数；步骤S205，家用网关收到认证服务令牌及乱码顺序号码之后，根据乱码顺序号码中的位置数获取乱码的数字产生乱码解，并将乱码顺序号码以及乱码解传送至应用服务器进行认证；步骤S206，应用服务器收到乱码顺序号码与乱码解后，与存储的乱码进行比对：如果比对成功，则会回传应用服务令牌给家用网关；如果比对失败，则回传失败消息给家用网关；步骤S207，家用网关收到应用服务令牌之后，就将应用服务令牌和认证服务令牌合成一个令牌，然后将令牌传给应用服务器开始使用应用服务器的服务。适用于云端LED照明节能系统的轻量认证方法，还包括步骤S3，对应用服务器和家用网关之间的通讯消息进行加密和解密；加密的方法采用取代加密和换位加密；解密的方法采用换位解密和取代解密。进一步，步骤S3，包括以下步骤：步骤S301，通讯消息的明文进行加密时，首先计算通讯消息明文的封包字的集合数s以及字符串长度l；步骤S302，利用随机数产生器产生取代移动的方向与位置数m；步骤S303，利用公式k=m%s，计算最后要移动的位置数k；步骤S304，将通讯消息明文带入动态式加密算法公式E=%s，进行通讯消息明文的取代加密，得到第一密文的字母的字母表序号E，从而得到第一密文，其中，x为通讯消息明文中字母的字母表序号；步骤S305，设置两个字母构成的移动消息，对第一密文进行换位加密：根据移动消息的第一个字母的字母表序号，决定第一密文中的字母移动方向和替换位置：如果移动消息第一个字母的字母表序号是奇数，则表示第一密文中的字母向左移动换位，并对第一密文中位置序号为奇数的字母进行替换；否则，第一密文中的字母向右移动换位，并对第一密文中位置序号为偶数的字母进行替换；令移动消息的第二个字母的字母表序号为k’，带入换位加密算法公式F=% l，得到加密移动换位的距离F，其中，z为第一密文的字符串的序号；已知换位加密中，换位的字母的方向、位置和距离，对第一密文的进行换位加密得到第二密文，然后在第二密文前端加上移动消息得到第三密文；步骤S306，对第三密文和移动的位置数k，一并存储；步骤S307，通讯消息进行换位解密，已得知通讯消息的封包字的集合数s和移动的位置数k，从第三密文的前端两个字母得到移动消息，并删除第三密文前端两个字母得到第二密文；根据移动消息第一个字母的字母表序号，确定加密时第一密文中的字母移动方向和替换位置，从而得到解密时字母的移动方向和替换位置；根据移动消息第二个字母的字母表序号k’，将第二密文带入换位解密算法公式Q=% l，得到解密移动换位的距离Q，其中，z为第二密文的字符串的序号；已知换位的字母的位置、方向和距离，进行换位的解密，得到第一密文；步骤S308，已知封包字的集合数s和移动的位置数k，将第一密文带入动态式解密算法公式P=%s，进行密文的解密，得到通讯消息明文的字母的字母表序号P，从而得到通讯消息明文，其中，x为第一密文中字母的字母表序号。本方案，围绕家庭能源管理系统、认证服务器、应用服务器，在注册、使用认证、及通讯加解密，这三方面均设有轻量化的安全机制。由于云整合端将同时连接多个家庭能源管理系统，需要同时回应多个家庭能源管理系统的服务需求。因此，云整合端的服务需求量是庞大的。一方面要保证家庭能源管理系统的服务需求不被窃听或窜改，另一方面也要照顾安全运算的负担。考虑到与云整合端对接的家庭能源管理系统的庞大数量，以及云整合端和家庭能源管理系统之间的保密程度。本方案，在注册步骤，家用网关只需要注册一次，进行一次的身份验证，便可以获得多个应用服务器的认证，无需对不同的服务逐一进行注册，减少认证的通信流量，提升服务品质。在云端服务使用之前，进行双重认证，通过轻量认证方式，加强了家用网关的合法性验证以及提高了账户的安全性。因此，本方案使用轻量的计算资源，为家庭能源管理系统，带来更安全的云端使用环境，并能够维持云端的服务质量。附图说明图1是本发明的系统示意图；图2是本发明的步骤S1流程图；图3是本发明的步骤S2流程图；图4是本发明的步骤S4加密流程图；图5是本发明的步骤S4解密流程图。具体实施方式下面结合附图，对本发明作进一步详细说明。LED照明节能系统，如图1所示，包括家庭能源管理系统和云整合端；所述家庭能源管理系统，包括家用网关、环境光感测装置、电源分配器、家用照明设备。所述家用网关，连接有云整合端；所述环境光感测装置：连接有家用网关，收集环境光的平均亮度的信息，并将该信息通过家用网关上传至云整合端。所述电源分配器：开启或关闭家用照明设备，读取家用照明设备的电力资料，并将电力信息通过家用网关上传至云整合端。所述云整合端：根据环境光感测装置上传的平均亮度，推导和执行照明亮度的PWM值，并通过家用网关发布到电源分配器，调整家用照明设备的实际亮度；所述云整合端包括认证服务器和应用服务器。LED照明节能系统，采用申请号为202210262693.6，名称为《基于云端的LED照明节能系统以及节能方法》的发明专利中的LED照明节能系统，因此，不再赘述。适用于云端LED照明节能系统的轻量认证方法，包括以下步骤：步骤S1，注册并形成群组密钥：家用网关，向认证服务器提出身份验证的需求并选择所需服务；认证服务器收集家用网关所需服务对应的应用服务器的认证密钥，并将所有认证密钥和该家用网关的ID组合形成群组密钥并储存，完成注册。图2是步骤S1流程图；具体内容如下：步骤S101，家用网关向云整合端的认证服务器提出群组密钥的需求。步骤S102，当认证服务器收到需求后，先向家用网关提出验证身份的需求。步骤S103，家用网关回传账号以及密码给认证服务器进行身份的验证。步骤S104，认证服务器，验证家用网关的身份：如果身份验证成功，则将家用网关导向服务的选择；如果身份验证失败，则回传身份验证失败的消息并请家用网关重新回传身份验证信息，返回至步骤S103。步骤S105，家用网关选择自己所需的服务，并且将所需服务的信息传回给认证服务器。在本方案中，家用网关所需服务，包括但不限于：环境光的平均亮度的信息的收集、存储和归整服务；电力信息的收集、存储和归整服务；推导照明亮度的PWM值的服务。步骤S106，当认证服务器收到家用网关回传的所需服务后，就将家用网关的设备码、所需服务、以及家用网关ID传送给家用网关所需服务对应的所有应用服务器。步骤S107，当对应的应用服务器收到家用网关的设备码、所需服务、以及家用网关ID后，随机产生认证密钥，并储存该应用服务器的认证密钥及家用网关ID；然后，各个对应的应用服务器回传认证密钥给认证服务器，认证服务器则将各个对应的应用服务器的认证密钥和该家用网关的ID组合形成群组密钥并储存。群组密钥的形式为GK=，其中service-i表示家用网关所需服务对应的第i个应用服务器的认证密钥，且1≤i≤n，n为家用网关所需服务对应的应用服务器的总个数。如果家用网关增加所需服务，同时，增加的所需服务对应新的应用服务器，则认证服务器向增加的所需服务对应的应用服务器申请该服务的认证密钥，并将该认证密钥结合到群组密钥中。由于应用服务器是随机产生认证密钥，因此，每个家用网关的群组密钥均不会与其它的家用网关的群组密钥相同。认证密钥随机产生方式为常规手段，不作限定，例如应用密码生成器生成随机密钥。本注册步骤，家用网关只需要注册一次，进行一次的身份验证，便可以获得多个应用服务器的认证，无需对不同的服务逐一进行注册，减少认证的通信流量，提升服务品质。步骤S2，家用网关使用应用服务的双重认证：家用网关和应用服务器共享乱码RN；家用网关将账号UN、密码PWD以及应用服务代码SC传送至认证服务器进行认证，从而完成第一重的认证；家用网关获得认证服务器传送的认证服务令牌AuT和乱码顺序号码S后，根据家用网关存储的乱码RN获得乱码解sRN，并将乱码顺序号码S和乱码解sRN传送至应用服务器并与应用服务器存储的乱码RN进行比对，从而完成第二重的认证；家用网关收到应用服务令牌ApT之后，就将应用服务令牌ApT和认证服务令牌AuT合成一个令牌T，然后将令牌T传给应用服务器。图3是步骤S2流程图；具体的：步骤S201，家用网关产生一组乱码RN，然后将随机数RN与所需服务Request传送给应用服务器；乱码RN为英文与数字结合的随机数。步骤S202，应用服务器收到乱码RN与所需服务Request后，回传应用服务代码SC给家用网关，并且将家用网关导向至认证服务器。步骤S203，家用网关将账号UN、密码PWD以及应用服务代码SC传送至认证服务器进行认证。步骤S204，如果认证成功，认证服务器传送认证服务令牌AuT以及乱码顺序号码S给家用网关，如果认证失败，认证服务器回传失败的消息给家用网关。乱码顺序号码S，为一组数字组成的数列，其中每个数字表示乱码中的字符位置数。例如乱码为1a2b3c4d，若S为14，表示乱码中第1位和第4位的位置数，则乱码解sRN为1b；若S为836，则乱码解sRN为d2c。其中，sRN表示根据S的位置数所取出的乱码的数字。步骤S205，家用网关收到认证服务令牌AuT及乱码顺序号码S之后，根据乱码顺序号码S中的位置数获取乱码的数字产生乱码解sRN，并将乱码顺序号码S以及乱码解sRN传送至应用服务器进行认证。步骤S206，应用服务器收到乱码顺序号码S与乱码解sRN后，与存储的乱码进行比对：如果比对成功，则会回传应用服务令牌ApT给家用网关；如果比对失败，则回传失败消息给家用网关。步骤S207，家用网关收到应用服务令牌ApT之后，就将应用服务令牌ApT和认证服务令牌AuT合成一个令牌T，然后将令牌T传给应用服务器开始使用应用服务器的服务。由于传统使用应用服务的认证过程中，对于认证仅仅只需要提供账号及密码，并未再多要求其他资料，后续的认证流程都是由应用服务器与认证服务器沟通完成，这种认证方法，简单方便，但是，其安全性严重依赖账号及密码的复杂程度。账号及密码，如果简单，则容易被破解，而复杂的账号及密码对于用户来说是一种负担。本方案，在云端服务使用之前，进行双重认证，通过轻量认证方式，加强了家用网关的合法性验证以及提高了账户的安全性。步骤S3，对应用服务器和家用网关之间的通讯消息进行加密和解密。加密的方法采用取代加密和换位加密；解密的方法采用换位解密和取代解密。图4是步骤S4加密流程图；图5是步骤S4解密流程图；加密和解密的具体过程如下：步骤S301，通讯消息的明文进行加密时，首先计算通讯消息明文的封包字的集合数s以及字符串长度l。步骤S302，利用随机数产生器产生取代移动的方向与位置数m。步骤S303，利用公式k=m%s，计算最后要移动的位置数k。例如就是向左移动一格，就是向右移动五格。步骤S304，将通讯消息明文带入动态式加密算法公式E=%s，进行通讯消息明文的取代加密，得到第一密文的字母的字母表序号E，从而得到第一密文，其中，x为通讯消息明文中字母的字母表序号。步骤S305，设置两个字母构成的移动消息，对第一密文进行换位加密：根据移动消息的第一个字母的字母表序号，决定第一密文中的字母移动方向和替换位置：如果移动消息第一个字母的字母表序号是奇数，则表示第一密文中的字母向左移动换位，并对第一密文中位置序号为奇数的字母进行替换；否则，第一密文中的字母向右移动换位，并对第一密文中位置序号为偶数的字母进行替换；令移动消息的第二个字母的字母表序号为k’，带入换位加密算法公式F=% l，得到加密移动换位的距离F，其中，z为第一密文的字符串的序号；已知换位加密中，换位的字母的方向、位置和距离，对第一密文的进行换位加密得到第二密文，然后在第二密文前端加上移动消息得到第三密文。步骤S306，对第三密文和移动的位置数k，一并存储。步骤S307，通讯消息进行换位解密，已得知通讯消息的封包字的集合数s和移动的位置数k，从第三密文的前端两个字母得到移动消息，并删除第三密文前端两个字母得到第二密文；根据移动消息第一个字母的字母表序号，确定加密时第一密文中的字母移动方向和替换位置，从而得到解密时字母的移动方向和替换位置；根据移动消息第二个字母的字母表序号k’，将第二密文带入换位解密算法公式Q=% l，得到解密移动换位的距离Q，其中，z为第二密文的字符串的序号；已知换位的字母的位置、方向和距离，进行换位的解密，得到第一密文。步骤S308，已知封包字的集合数s和移动的位置数k，将第一密文带入动态式解密算法公式P=%s，进行密文的解密，得到通讯消息明文的字母的字母表序号P，从而得到通讯消息明文，其中，x为第一密文中字母的字母表序号。举例说明，对于动态式加密算法公式E=%s，其中 x 为通讯消息中字母的字母表序号，k 为移动的位置数，s 为封包字的集合数，m为取代移动的方向与位置数，例如就是向左移动一格，就是向右移动五格。然后利用k算出总共移动的位置数。经由加密过后，再由换位加密算法公式F=% l，进行密文的换位，其中z 为字符串的序号，l为字符串长度。而插入的消息则是第一个字的序号来决定移动方向：也决定是由奇数来做换位还是偶数做换位，偶数的则为向右移动；奇数则为向左移动，第二个字的字母表序号则为移动的位置，也作为换位的距离，若第一个字与第二个字的序号为奇数与偶数的配对，则在换位加解密的时候第二个字的序号会加1，a与z不使用。且换位法执行的次数是 l/4，字符串长度l若为奇数则是 + 1 的次数。假设“computer”为需要加密之明文，取代移动的方向与位置数m为，k = 4mod 26，求出 k 为 4。然后明文的第一个字母为“c”字母表序号 2，代入 E = %26，则 E = 6，字母表序号为6的字母是g。明文第二个字母为“o”的字母表序号为14，计算出来为 E = 18，字母表序号为18的字母是s。以此类推，经由动态式加密系统所算出来的密文为“gsqtyxhv”。再利用在前端加上移动消息“se”来进行换位，s的字母表序号为18是偶数，只进行偶数的换位，而e 的字母表序号为4，代入F =  % 8，计算出来为4，所以字符串序号为 0 的字与字符串序号为4的字交换“ysqtgxhv”，代入 F = %8，计算出来为6，字符串序号为2的字与字符串序号为 6 的字交换第二次就可以 算 出 密 文“yshtgxqv”， 加 上移动消息之后密文就会变成“seyshtgxqv”。当通讯消息密文要进行提取时，将利用动态式加密算法公式与换位法的解密算法公式，将要被提取的资料密文转换成明文。从“seyshtgxv”中的“se”可以得知是s移动偶位数，也可以得知是向右移动，e则可以知道换位距离以及移动位置为4。而解密过程可以先进行换位法再进行动态式加密法来进行解密，也可以颠倒进行解密的动作。传统的加解密算法种类非常的多样，但其运算量也会因安全强度的提升而耗费大量资源，虽然可以提升安全强度但却使服务质量降低，也拉长回应需求的时间。本方案，减轻加解密所需的运算量，同时，减少资源的耗费及提高服务的质量。对于注册的群组密钥，可以减少家用网关进行注册时的等待时间和通讯流量。传统的家用网关注册步骤，在取得各项服务时必须与认证服务器还有应用服务器进行多次的沟通。因此，若是家用网关要使用多项服务时，且各个服务分属于不同的供应商，例如环境光的平均亮度的信息的收集、存储和归整服务，由供应商A提供服务；电力信息的收集、存储和归整服务，由供应商B提供服务。用户必须要登入多次的账号及密码也必须等待服务器的回应。整体而言，使用传统的注册步骤，会为了要登入多项服务而浪费较多的时间。群组密钥，仅需要进行一次的身份验证，即可以取得多项服务，节省重复的进行登入动作的等待的时间。云整合端会有大量的服务需求，若是同时有很多登入服务，应用服务器不仅要处理其他服务需求，还必须将认证的需求传给认证服务器，很可能会造成服务器因为需求量过大而导致处理速度的降低与服务质量的降低。群组密钥，可以有效地减少进行身份认证的步骤，也可以减少资料在云端运算环境中的传送，从而减少家用网关与服务器之间的通信流量。对于应用服务的双重认证，提供更严谨的认证与授权；在云端运算共享资源的环境中，当隐密信息传送次数增加，则会增加风险使得使用服务的安全性下降。本方案，利用结合认证服务器与应用服务器两端的令牌的方式来进行验证的动作，通过结合两端的令牌来达到双重认证的动作，也利用产生英文与数字结合出来的随机数，并通过位置号码与随机数文字的方法来进行第二次的认证，提升使用者在验证时与取得服务时的安全性。在本方案中，传送账号与密码的次数只有一次，降低信息因重复传送而增加被截取的风险。攻击者若截取到账号与密码，使用重送的攻击方式想要通过验证，也仅取得认证服务器的认证，无法取得应用服务器的认证，无法顺利的达到双重验证成功来取得权限，并使用相关的应用服务。换言之，攻击者无论重送哪一方的信息，只要无法在认证服务器与应用服务器两端都认证成功，则无法顺利取得权限来获得服务的提供。对于通讯消息的混和加解密系统，则保障家用网关在进行信息通讯及资料储存时的安全性，确保家用网关在云端运算环境中服务的安全。通过实例可见，本加密系统并不需要复杂的运算即可进行加解密，加强云端运算环境中资讯通讯与资料储存的安全性。综上，本方案，围绕家庭能源管理系统、认证服务器、应用服务器，在注册、使用认证、及通讯加解密，这三方面均设有轻量化的安全机制。本方案，使用轻量的计算资源，为家庭能源管理系统，带来更安全的云端使用环境，并能够维持云端的服务质量。可以理解的是，对本领域普通技术人员来说，可以根据本发明的技术方案及其发明构思加以等同替换或改变，而所有这些改变或替换都应属于本发明所附的权利要求的保护范围。
