标题title
用户使用家庭智能设备的授权认证与密钥协商方法
摘要abst
本发明提供一种用户使用家庭智能设备的授权认证与密钥协商方法，所述方法包括：S1、所述智能家居中家庭主人设备绑定家庭网关；S2、所述智能家居中家庭智能设备向所述家庭网关进行注册；S3、所述家庭主人对家庭用户进行授权，并将授权信息向所述家庭网关备案；S4、所述家庭网关对家庭用户所能使用的家庭智能设备进行认证与密钥协商。本发明实施例能够解决一个智能家庭中不同类型的用户应该被授予不同家庭智能设备访问权限的问题，并且，本发明实施例在家庭智能设备中嵌入了一个物理不可克隆函数，提高了家庭网络临时会话密钥的安全性。
权利要求书clms
1.一种用户使用家庭智能设备的授权认证与密钥协商方法，其特征在于，所述方法包括：S1、所述智能家居中家庭主人设备绑定家庭网关；S2、所述智能家居中家庭智能设备向所述家庭网关进行注册；S3、所述家庭主人对家庭用户进行授权，并将授权信息向所述家庭网关备案；S4、所述家庭网关对家庭用户所能使用的家庭智能设备进行认证与密钥协商。2.根据权利要求1所述的用户使用家庭智能设备的授权认证与密钥协商方法，其特征在于，所述S1包括步骤：S1.1、移动设备MDo接收家庭主人随机选择的身份IDo和密码PWo，生成第一随机数ro，并将所述密码PWo与所述第一随机数ro合并后生成第一哈希值RPWo＝h，之后，MDo通过安全信道向家庭网关发送所述身份IDo与所述第一哈希值RPWo；S1.2、家庭网关收到所述身份IDo与所述第一哈希值RPWo，随机选择第一挑战ck，将所述第一挑战ck输入嵌入在家庭网关中的物理不可克隆函数PUFk中生成第一响应Rk＝PUFk，并将所述身份IDo与所述第一响应Rk合并后生成第二哈希值UIDo＝h，所述第二哈希值UIDo为家庭主人的身份假名；S1.3、家庭网关将所述家庭网关中的私钥s与所述第一响应Rk合并生成第三哈希值Ko＝h，所述第三哈希值Ko为家庭主人与家庭网关间认证的密钥；将所述Ko与所述第一哈希值RPWo异或后生成并通过安全信道向MDo发送所述第二哈希值UIDo与所述Ao；家庭网关将所述第二哈希值UIDo与所述第一挑战ck存入网关数据库中；S1.4、MDo收到所述第二哈希值UIDo与所述Ao后，将所述身份IDo与所述密码PWo合并后生成第四哈希值h，将所述第四哈希值h与所述第一随机数ro异或后生成并将所述身份IDo、所述密码PWo与所述第一随机数ro合并后生成第五哈希值Co＝h，之后，MDo将所述第二哈希值UIDo、所述Ao、所述Bo、所述第五哈希值Co与所述哈希函数h存入MDo内存中。3.根据权利要求2所述的用户使用家庭智能设备的授权认证与密钥协商方法，其特征在于，所述S2包括步骤：S2.1、家庭智能设备随机选择第二挑战cq，并将所述第二挑战cq输入嵌入在家庭智能设备中的物理不可克隆函数PUFq中生成第二响应Rq＝PUFq，之后，家庭智能设备通过安全信道向家庭网关发送所述第二挑战cq与所述第二响应Rq；S2.2、家庭网关收到所述第二挑战cq与所述第二响应Rq后为家庭智能设备随机生成一个假名PIDq，并提取存储在网关数据库中的所述第一挑战ck；S2.3、家庭网关将所述第一挑战ck输入嵌入在家庭网关中的物理不可克隆函数PUFk中生成所述第一响应Rk＝PUFk，将所述第一挑战ck哈希后生成第六哈希值h，并将所述第六哈希值h与所述假名PIDq合并，将合并后的值h||PIDq与所述第二响应Rq异或后生成S2.4、家庭网关通过安全信道向家庭智能设备发送所述假名PIDq，并将所述假名PIDq、所述fq与所述第二挑战cq存入网关数据库中，同时公开所述假名PIDq；S2.5、家庭智能设备收到所述假名PIDq后将所述假名PIDq存入家庭智能设备内存中。4.根据权利要求3所述的用户使用家庭智能设备的授权认证与密钥协商方法，其特征在于，所述S3包括步骤：S3.1、家庭用户与家庭主人通过面对面的方式协商一个秘密值k，家庭用户的移动设备MDi接收家庭用户随机选择的用户身份IDi、密码PWi和所述秘密k，生成第二随机数ri，使用所述用户身份IDi与所述第二随机数ri合并后生成第七哈希值UIDi＝h，所述第七哈希值UIDi为家庭用户的身份假名，将所述用户密码PWi与所述第二随机数ri合并后生成第八哈希值RPWi＝h；S3.2、MDi将所述第八哈希值RPWi与所述秘密k异或后得到将所述第七哈希值UIDi与所述第八哈希值RPWi合并后得到第九哈希值M2＝h，并通过公开信道向家庭主人的移动设备MDo发送所述第七哈希值UIDi、所述M1与所述第九哈希值M2；S3.3、家庭主人与家庭用户通过面对面的方式协商所述秘密值k后，MDo接收家庭主人输入的身份密码与所述秘密k，使用所述主人身份与所述主人密码合并生成第十哈希值将所述第十哈希值与存储MDo中的所述Bo异或后得到第三随机数将所述主人身份所述主人密码与所述第三随机数合并后生成第十一哈希值验证所述第十一哈希值是否与存储在MDo中的所述第五哈希值Co相等，如果不相等，用户授权阶段结束；否则继续执行S3.4；S3.4、MDo收到所述第七哈希值UIDi、所述M1与所述第九哈希值M2后，将所述M1与所述秘密k异或得到将所述第七哈希值UIDi与所述RPWi*合并生成第十二哈希值h，验证所述第十二哈希值h是否与用户发送的第九哈希值M2相等，如果不相等，用户授权阶段结束；否则继续执行S3.5；S3.5、MDo接收家庭主人输入的家庭用户能够访问的家庭智能设备假名{PIDg,...,PIDn}，将所述家庭主人密码PWo与所述第三随机数ro合并生成第十三哈希值RPWo＝h；将存储在MDo中的所述Ao与所述第十三RPWo异或得到将Ko与所述第七哈希值UIDi合并生成第十四哈希值所述第十四哈希值作为家庭用户与家庭网关间的认证密钥，将所述秘密值k哈希后得到第十五哈希值h；S3.6、MDo将所述第十四哈希值所述第十五哈希值h与所述第八哈希值RPWi异或后得到将所述M3合并所述秘密k后生成第十六哈希值M4＝h，MDo通过公开信道向MDi发送所述M3与所述第十六哈希值M4；S3.7、MDi收到所述所述M3与所述第十六哈希值M4后，将所述M3与所述秘密k合并生成所述第十七哈希值h，验证所述第十七哈希值h与MDo发送的所述第十六哈希值M4是否相等，如果不相等，用户授权阶段结束；否则继续执行S3.8；S3.8、MDi将所述秘密k哈希后生成所述第十八哈希值h，将所述M3与所述第十八哈希值h异或生成并接收家庭用户输入的生物特征BIOi，在模糊提取器生成函数GEN中输入所述生物特征BIOi得到生物特征密钥σi与生物特征模板参数τi，将所述用户身份IDi、密码PWi与生物特征密钥σi合并生成第十九哈希值h，将所述第十九哈希值h与所述第二随机数ri异或生成将所述用户身份IDi、密码PWi、生物特征密钥σi与所述第二随机数ri合并生成第二十哈希值Ci＝h，并将所述第七哈希值UIDi、Bi、第二十哈希值Ci、哈希函数h与所述生物特征模板参数τi存入MDi内存中；S3.9、MDo向MDi发送所述M3与所述第十六哈希值M4后，将所述第七哈希值UIDi、所述Ko与所述家庭智能设备假名{PIDg,...,PIDn}合并生成第二十一哈希值M5＝h，并通过公开信道向家庭网关发送所述第七哈希值UIDi、所述第二十一哈希值M5与所述家庭智能设备假名{PIDg,...,PIDn}；S3.10、家庭网关收到所述第七哈希值UIDi、所述第二十一哈希值M5与所述家庭智能设备假名{PIDg,...,PIDn}后，在网关数据库中提取所述第一挑战ck，将所述第一挑战ck输入嵌入在家庭网关中的物理不可克隆函数PUFk中得到第三响应将所述网关私钥s与所述第三响应合并生成第二十二哈希值并将所述第七哈希值UIDi、所述第二十二哈希值与所述家庭智能设备假名{PIDg,...,PIDn}合并生成所述第二十三哈希值验证所述第二十三哈希值与MDo发送的所述第二十一哈希值M5是否相等，如果不相等，用户授权阶段结束；否则家庭网关将所述第七哈希值UIDi、所述家庭智能设备假名{PIDg,...,PIDn}存入网关数据库中。5.根据权利要求4所述的用户使用家庭智能设备的授权认证与密钥协商方法，其特征在于，所述S4包括步骤：S4.1、家庭用户的移动设备MDi接收用户输入的身份密码PWi*与生物特征并在模糊提取器再现函数REP中输入生物特征与存储在MDi中的所述生物特征模板参数τi后得到生物特征密钥将所述身份所述密码PWi*与所述生物特征密钥合并生成所述第二十四哈希值使用存储在MDi中的Bi与所述第二十四哈希值异或生成第四随机数使用所述身份密码PWi*、生物特征密钥与所述第四随机数合并生成所述第二十五哈希值验证存储在MDi中的第二十哈希值Ci与所述第二十五哈希值是否相等，如果不相等，用户认证与密钥协商阶段结束；否则，继续执行S4.2；S4.2、MDi接收用户输入的家庭智能设备假名PIDg，生成第五随机数N1和第一时间戳T1，将所述密码PWi与所述第二随机数ri合并生成第二十六哈希值RPWi＝h，将所述第二十六哈希值RPWi与存储在MDi内存中的所述异或生成所述为用户与家庭网关间认证的密钥；S4.3、MDi使用所述第五随机数N1与所述异或生成使用存储MDi中的所述第七哈希值UIDi、所述家庭智能设备假名PIDq、所述第五随机数N1与所述第一时间戳T1合并生成第二十七哈希值M7＝h，并通过公开信道向家庭网关发送所述第七哈希值UIDi、所述家庭智能设备假名PIDq、所述M6、所述第二十七哈希值M7与所述第一时间戳T1；S4.4、家庭网关收到所述第七哈希值UIDi、所述家庭智能设备假名PIDq、所述M6、所述第二十七哈希值M7与所述第一时间戳T1后生成第二时间戳检查所述第一时间戳T1与所述第二时间戳间的时间差是否在最大时间延迟范围内如果所述时间差不在最大时间延迟范围内，用户认证与密钥协商阶段结束；否则，继续执行S4.5；S4.5、家庭网关提取存储在网关数据库中的所述第一挑战ck，将所述第一挑战ck输入嵌入在家庭网关中的物理不可克隆函数PUFk后生成第四响应将存储在网关中的私钥s与所述第四响应合并生成第二十八哈希值所述第二十八哈希值为家庭主人与家庭网关间的认证密钥；S4.6、家庭网关使用所述第二十八哈希值与所述第七哈希值UIDi合并生成第二十九哈希值所述第二十九哈希值为家庭用户与家庭网关间认证的密钥，使用所述M6与所述第二十九哈希值异或生成第六随机数使用所述第七哈希值UIDi、所述家庭智能设备假名PIDq、所述第六随机数与所述第一时间戳T1合并生成第三十哈希值验证所述第三十哈希值M7与MDi发送的所述第二十七哈希值M7是否相等，如果不相等，用户认证与密钥协商阶段结束；否则，继续执行S4.7；S4.7、家庭网关检查所述家庭智能设备假名PIDq是否存在于网关数据中的访问列表中，如果不存在，用户认证与密钥协商阶段结束，并向MDi返回没有该设备的的访问权限；否则，继续执行S4.8；S4.8、家庭网关生成第七随机数N2与第三时间戳T2，使用所述第四响应Rk生成第三十一哈希值h，将所述第三十一哈希值h与所述家庭智能设备假名PIDq合并，并使用存储在网关数据库中的所述fq与合并后的值h||PIDq异或生成第五响应S4.9、家庭网关将所述第五随机数N1与第七随机数N2拼接，并使用拼接后的值N1||N2与所述第五响应Rq异或生成使用所述第五随机数N1、所述第七随机数N2与存储在网关数据库中的所述第二挑战cq以及第三时间戳T2合并生成第三十二哈希值M10＝h，并通过公开信道向家庭智能设备发送所述M9、所述第三十二哈希值M10、所述第二挑战cq与所述第三时间戳T2；S4.10、家庭智能设备收到所述M9、所述第三十二哈希值M10、所述第二挑战cq与所述第三时间戳T2后生成第四时间戳检查所述第三时间戳T2与所述第四时间戳间的时间差是否在最大时间延迟范围内如果所述时间差不在最大时间延迟范围内，用户认证与密钥协商阶段结束；否则，继续执行S4.11；S4.11、家庭智能设备将所述第二挑战cq输入嵌入在家庭智能设备中的物理不可克隆函数PUFq中生成第六响应使用所述M9与所述第六响应异或生成所述第六随机数与第七随机数的拼接值拆分所述拼接值生成第八随机数与第九随机数使用所述第八随机数所述第九随机数所述第二挑战cq与所述第三时间戳T2合并生成所述第三十三哈希值S4.12、家庭智能设备生成第十随机数N3与第五时间戳T3；使用所述第八随机数N1、第九随机数N2与第十随机数N3合并生成第三十四哈希值SSKi＝h；所述第三十四哈希值SSKi为家庭用户与家庭智能设备间临时的安全会话密钥；S4.13、家庭智能设备使用存在内存中的所述家庭智能设备假名PIDq与所述第六响应Rq合并生成第三十五哈希值h；使用所述第十随机数N3与所述第三十五哈希值h异或生成使用所述家庭智能设备假名PIDq、所述第三十四哈希值SSKi与所述第五时间戳T3合并生成第三十七哈希值M12＝h，并向家庭网关发送所述M11、所述第三十七哈希值M12与所述第五时间戳T3；S4.14、家庭网关收到所述M10、所述第三十七哈希值M12与所述第五时间戳后T3生成第六时间戳检查所述第五时间戳T3与所述第六时间戳间的时间差是否在最大时间延迟范围内如果所述时间差不在最大时间延迟范围内，用户认证与密钥协商阶段结束；否则，继续执行S4.15；S4.15：家庭网关使用所述家庭智能设备假名PIDq与所述第五响应Rq合并生成所述第三十八哈希值h，使用所述M11与所述第三十八哈希值h异或生成第十一随机数使用所述第六随机数N1、所述第七随机数N2与所述第十一随机数合并生成所述第三十九哈希值使用所述家庭智能设备假名PIDq、所述第三十九哈希值与所述第五时间戳T3合并生成所述第四十哈希值验证所述第四十哈希值与家庭智能设备发送的所述第三十七哈希值M12是否相等，如果不相等，用户认证与密钥协商阶段结束；否则，继续执行S4.16；S4.16、家庭网关生成第七时间戳T4，使用所述第六随机数N1与所述第二十八哈希值合并生成第四十一哈希值使用所述第七哈希值UIDi与所述第二十九哈希值合并生成第四十二哈希值将所述第四十一哈希值与所述第四十二哈希值拼接生成使用所述第七随机数N2与所述第十一随机数N3拼接生成N2||N3，使用所述与所述N2||N3异或生成使用所述第七哈希值UIDi、所述第三十九哈希值SSKi与所述第七时间戳T4合并生成第四十三哈希值M14＝h，并通过公开信道向MDi发送所述M13、所述第四十三哈希值M14与所述第七时间戳T4；S4.17、MDi收到所述M12、所述第四十三哈希值M14与所述第七时间戳T4后生成第八时间戳检查所述第七时间戳T4与所述第八时间戳间的时间差是否在最大时间延迟范围内如果所述时间差不在最大时间延迟范围内，用户认证与密钥协商阶段结束；否则，继续执行S4.18；S4.18、MDi使用所述第五随机数N1与步骤S4.2中生成的所述合并生成第四十四哈希值使用所述第七哈希值UIDi与步骤S4.2中生成的所述合并生成第四十五哈希值将所述第四十四哈希值与所述第四十五哈希值拼接生成使用所述M13与所述异或后生成所述第七随机数与所述第十一随机数的拼接值拆分所述后生成第十二随机数与第十三随机数S4.19、MDi使用所述第五随机数N1、所述第十二随机数与所述第十三随机数合并后生成第四十六哈希值所述第四十六哈希值为家庭用户与家庭智能设备间临时的安全会话密钥，使用所述第七哈希值UIDi、所述第四十六哈希值与所述第七时间戳T4合并生成所述第四十七哈希值验证所述第四十七哈希值与家庭智能设备发送的所述第四十三哈希值M14是否相等，如果不相等，用户认证与密钥协商阶段结束；否则，家庭用户与家庭智能设备都将所述第四十七哈希值SSKi作为临时的安全会话密钥，至此用户认证与密钥协商阶段结束。6.一种计算设备，其特征在于，所述计算设备包括处理器和存储器，所述存储器中存储有至少一条指令、至少一段程序、代码集或指令集，所述至少一条指令、所述至少一段程序、所述代码集或指令集由所述处理器加载并执行以实现如权利要求1至5任一项所述的用户使用家庭智能设备的授权认证与密钥协商方法。7.一种计算机可读存储介质，其特征在于，所述存储介质中存储有至少一条指令、至少一段程序、代码集或指令集，所述至少一条指令、所述至少一段程序、所述代码集或指令集由处理器加载并执行以实现如权利要求1至5任一项所述的用户使用家庭智能设备的授权认证与密钥协商方法。
说明书desc
技术领域本发明涉及信息安全技术领域，特别是涉及一种用户使用家庭智能设备的授权认证与密钥协商方法、计算设备、可存储介质。背景技术当今智能家居发展迅猛，吸引了全社会各方面的关注。人们通过控制部署在家中的智能设备，例如监控摄像头、扫地机器人以及温度控制器等，给自己的生活带来了极大的舒适性，有效降低了生活的运营成本。在一个智慧家庭中，通常会部署大量的家庭智能设备。这些家庭智能设备可能会被家庭中不同的类型用户共同使用。例如，成人和小孩都可能使用家中智能烤箱等相对危险系数较高的电气设备，这就可能因为操作不当给该智能家庭带来财产安全甚至生命健康的威胁。同时，这些家庭智能设备中有的可能包含用户的个人隐私，该用户的个人隐私可能会被其他使用该家庭智能设备的用户获取。例如维修人员或家政保姆可能会访问家庭网络中某些智能设备上敏感的信息，这将给用户的个人隐私安全造成了威胁。因此，如何对不同身份的用户进行身份认证及授权管理还有待深入研究。为了解决上述问题，目前提出的方案有基于角色、基于属性和基于能力等授权管理方法。但这些方案为了保证安全性，使用了复杂的安全算法，而对于计算、存储能力都受限的家庭智能设备，并不适合使用这些复杂的安全协议。因此，如何在保证认证效率与认证安全的前提下，对不同类型的用户授予不同的访问权限亟待研究。同时，考虑到智能家庭网络会话密钥的安全性，如何解决家庭智能设备被物理捕获攻击也亟待社会各界的深入研究。发明内容有鉴于此，本发明实施例提供一种智能家居中用户使用智能家庭设备授权访问认证与密钥协商方法，有效地解决智能家庭中不同类型的用户被授予不同的家庭智能设备访问权限的问题，以及家庭智能设备被物理捕获攻击的问题。为实现上述发明目的，本发明实施例提供一种用户使用家庭智能设备的授权认证与密钥协商方法，所述方法包括：S1、所述智能家居中家庭主人设备绑定家庭网关；S2、所述智能家居中家庭智能设备向所述家庭网关进行注册；S3、所述家庭主人对家庭用户进行授权，并将授权信息向所述家庭网关备案；S4、所述家庭网关对家庭用户所能使用的家庭智能设备进行认证与密钥协商。第二方面，本发明实施例还提供了一种计算设备，所述计算设备包括处理器和存储器，所述存储器中存储有至少一条指令、至少一段程序、代码集或指令集，所述至少一条指令、所述至少一段程序、所述代码集或指令集由所述处理器加载并执行以实现如前所述的用户使用家庭智能设备的授权认证与密钥协商方法。第三方面，本发明实施例还提供了一种计算机可读存储介质，所述存储介质中存储有至少一条指令、至少一段程序、代码集或指令集，所述至少一条指令、所述至少一段程序、所述代码集或指令集由处理器加载并执行以实现如前所述的用户使用家庭智能设备的授权认证与密钥协商方法本发明实施例的智能家庭包括家庭主人、家庭用户、家庭网关、家庭智能设备：所述家庭主人是指给不同类型的家庭用户授予不同家庭智能设备访问权限的实体，并且一个家庭中只有一个家庭主人；所述家庭用户是指需要与家庭智能设备通信的实体；所述家庭网关是指帮助家庭用户与家庭智能设备建立起临时会话密钥的实体，并且家庭网关绑定一名家庭主人，一个家庭中只有一个家庭网关；所述家庭智能设备是指需要与家庭用户通信的实体。本发明实施例能够解决一个智能家庭中不同类型的用户应该被授予不同家庭智能设备访问权限的问题，并且，本发明实施例在家庭智能设备中嵌入了一个物理不可克隆函数，提高了家庭网络临时会话密钥的安全性。附图说明下面将结合附图说明对本发明的具体实施方式进行举例说明。图1为本发明实施例家庭主人绑定家庭网关流程图；图2为本发明实施例家庭智能设备注册流程图；图3为本发明实施例用户授权程图；图4为本发明实施例用户认证与密钥协商流程图；图5为本发明实施例用于用户认证与密钥协商的计算设备结构图。具体实施方式为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对照附图说明本发明的具体实施方式。显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图，并获得其他的实施方式。为使图面简洁，各图中的只示意性地表示出了与本发明相关的部分，它们并不代表其作为产品的实际结构。为了解决本发明实施例的技术问题，本发明实施例提供了以下技术方案：一种用户使用家庭智能设备的授权认证与密钥协商方法，包括以下步骤：S1、所述智能家居中家庭主人设备绑定家庭网关；S2、所述智能家居中家庭智能设备向所述家庭网关进行注册；S3、所述家庭主人对家庭用户进行授权，并将授权信息向所述家庭网关备案；S4、所述家庭网关对家庭用户所能使用的家庭智能设备进行认证与密钥协商。优选的，所述S1包括步骤：S1.1：移动设备MDo接收家庭主人随机选择的身份IDo和密码PWo，生成第一随机数ro，并将所述密码PWo与所述第一随机数ro合并后生成第一哈希值RPWo＝h，之后，MDo通过安全信道向家庭网关发送所述身份IDo与所述第一哈希值RPWo；这里的移动设备MDo可以是家庭主人的手机，也可以是其他设备。S1.2：家庭网关收到所述身份IDo与所述第一哈希值RPWo，随机选择第一挑战ck，将所述第一挑战ck输入嵌入在家庭网关中的物理不可克隆函数PUFk中生成第一响应Rk＝PUFk，并将所述身份IDo与所述第一响应Rk合并后生成第二哈希值UIDo＝h，所述第二哈希值UIDo为家庭主人的身份假名；S1.3：家庭网关将所述家庭网关中的私钥s与所述第一响应Rk合并后生成第三哈希值Ko＝h；所述第三哈希值Ko为家庭主人与家庭网关间认证的密钥；将所述第三哈希值Ko与所述第一哈希值RPWo异或后生成通过安全信道向MDo发送所述第二哈希值UIDo与所述Ao；家庭网关将所述第二哈希值UIDo与所述第一挑战ck存入网关数据库中；S1.4：MDo收到所述第二哈希值UIDo与所述Ao后，将所述身份IDo与所述密码PWo合并后生成第四哈希值h，将所述第四哈希值h与所述第一随机数ro异或后生成并将所述身份IDo、所述密码PWo与所述第一随机数ro合并后生成第五哈希值Co＝h；之后，MDo将所述第二哈希值UIDo、所述Ao、所述Bo、所述第五哈希值Co与所述哈希函数h存入MDo内存中；最后，本发明实施例中，一个家庭只能有一个家庭网关，一个家庭网关只能注册一个家庭主人。优选的，所述S2包括步骤：S2.1：家庭智能设备随机选择第二挑战cq，并将所述第二挑战cq输入嵌入在家庭智能设备中的物理不可克隆函数PUFq中生成第二响应Rq＝PUFq，之后，家庭智能设备通过安全信道向家庭网关发送所述第二挑战cq与所述第二响应Rq；S2.2：家庭网关收到所述第二挑战cq与所述第二响应Rq后为家庭智能设备随机生成一个假名PIDq，并提取存储在网关数据库中的所述第一挑战ck；S2.3：家庭网关将所述第一挑战ck输入嵌入在家庭网关中的物理不可克隆函数PUFk中生成所述第一响应Rk＝PUFk，将所述第一挑战Rk哈希后生成第六哈希值h，并将所述第六哈希值h与所述假名PIDq合并，将合并后的值h||PIDq与所述第二响应Rq异或后生成S2.4：家庭网关通过安全信道向家庭智能设备发送所述假名PIDq，并将所述假名PIDq、所述fq与所述第二挑战cq存入网关数据库中，同时公开所述假名PIDq；S2.5：家庭智能设备收到所述假名PIDq后将所述假名PIDq存入家庭智能设备内存中。进一步的，所述S3包括步骤：S3.1：家庭用户与家庭主人通过面对面的方式协商一个秘密值k，家庭用户的移动设备MDi接收家庭用户随机选择的用户身份IDi、密码PWi和所述秘密k，生成第二随机数ri，使用所述用户身份IDi与所述第二随机数ri合并后生成第七哈希值UIDi＝h，所述第七哈希值UIDi为家庭用户的身份假名，使用所述用户密码PWi与所述第二随机数ri合并后生成第八哈希值RPWi＝h；这里的家庭用户的移动设备MDi为家庭用户的手机，也可以是家庭用户所用的其他设备；S3.2：MDi将所述第八哈希值RPWi与所述秘密k异或，得到将所述第七哈希值UIDi与所述第八哈希值RPWi合并后得到第九哈希值M2＝h，并通过公开信道向家庭主人的移动设备MDo发送所述第七哈希值UIDi、所述M1与所述第九哈希值M2；S3.3：家庭主人与家庭用户通过面对面的方式协商所述秘密值k后，MDo接收家庭主人输入的身份密码与所述秘密k，使用所述主人身份与所述主人密码合并生成第十哈希值将所述第十哈希值与存储MDo中的所述Bo异或后得到第三随机数将所述主人身份所述主人密码与所述第三随机数合并后生成第十一哈希值验证所述第十一哈希值是否与存储在MDo中的所述第五哈希值Co相等，如果不相等，用户授权阶段结束；否则继续执行S3.4；S3.4：MDo收到所述第七哈希值UIDi、所述M1与所述第九哈希值M2后，将所述M1与所述秘密k异或得到将所述第七哈希值UIDi与所述合并生成第十二哈希值验证所述第十二哈希值是否与用户发送的第九哈希值M2相等，如果不相等，用户授权阶段结束；否则继续执行S3.5；S3.5：MDo接收家庭主人输入的家庭用户能够访问的家庭智能设备假名{PIDg,...,PIDn}，将所述家庭主人密码PWo与所述第一随机数ro合并生成第十三哈希值RPWo＝h，将存储在MDo中的所述Ao与所述第十三RPWo异或得到将Ko与所述第七哈希值UIDi合并生成第十四哈希值所述第十四哈希值作为家庭用户与家庭网关间的认证密钥，将所述秘密值k哈希后得到第十五哈希值h；S3.6：MDo将所述第十四哈希值所述第十五哈希值h与所述第八哈希值RPWi异或后得到将所述M3合并所述秘密k后生成第十六哈希值M4＝h，MDo通过公开信道向MDi发送所述M3与所述第十六哈希值M4；S3.7：MDi收到所述所述M3与所述第十六哈希值M4后，将所述M3与所述秘密k合并生成所述第十七哈希值h，验证所述第十七哈希值h与MDo发送的所述第十六哈希值M4是否相等，如果不相等，用户授权阶段结束；否则继续执行S3.8；S3.8：MDi将所述秘密k哈希后生成所述第十八哈希值h，将所述M3与所述第十八哈希值h异或生成并接收家庭用户输入的生物特征BIOi，在模糊提取器生成函数GEN中输入所述生物特征BIOi得到生物特征密钥σi与生物特征模板参数τi，将所述用户身份IDi、密码PWi与生物特征密钥σi合并生成第十九哈希值h，将所述第十九哈希值h与所述第二随机数ri异或生成将所述用户身份IDi、密码PWi、生物特征密钥σi与所述第二随机数ri合并生成第二十哈希值Ci＝h，并将所述第七哈希值UIDi、Bi、第二十哈希值Ci、哈希函数h与所述生物特征模板参数τi存入MDi内存中；S3.9：MDo向MDi发送所述M3与所述第十六哈希值M4后，将所述第七哈希值UIDi、所述Ko与所述家庭智能设备假名{PIDg,...,PIDn}合并生成第二十一哈希值M5＝h，并通过公开信道向家庭网关发送所述第七哈希值UIDi、所述第二十一哈希值M5与所述家庭智能设备假名{PIDg,...,PIDn}；S3.10：家庭网关收到所述第七哈希值UIDi、所述第二十一哈希值M5与所述家庭智能设备假名{PIDg,...,PIDn}后，在网关数据库中提取所述第一挑战ck，将所述第一挑战ck输入嵌入在家庭网关中的物理不可克隆函数PUFk中得到第三响应将所述网关私钥s与所述第三响应合并生成第二十二哈希值并将所述第七哈希值UIDi、所述第二十二哈希值与所述家庭智能设备假名{PIDg,...,PIDn}合并生成所述第二十三哈希值验证所述第二十三哈希值与MDo发送的所述第二十一哈希值M5是否相等，如果不相等，用户授权阶段结束；否则家庭网关将所述第七哈希值UIDi、所述家庭智能设备假名{PIDg,...,PIDn}存入网关数据库中。优选的，所述S4包括步骤：S4.1：家庭用户的移动设备MDi接收用户输入的身份密码与生物特征并在模糊提取器再现函数REP中输入生物特征与存储在MDi中的所述生物特征模板参数τi后得到生物特征密钥将所述身份所述密码与所述生物特征密钥合并生成所述第二十四哈希值使用存储在MDi中的Bi与所述第二十四哈希值异或生成第四随机数使用所述身份密码生物特征密钥与所述第四随机数合并生成所述第二十五哈希值验证存储在MDi中的第二十哈希值Ci与所述第二十五哈希值是否相等。如果不相等，用户认证与密钥协商阶段结束；否则，继续执行S4.2；S4.2：MDi接收用户输入的家庭智能设备假名PIDg，生成第五随机数N1和第一时间戳T1，将所述密码PWi与所述第二随机数ri合并生成第二十六哈希值RPWi＝h，将所述第二十六哈希值RPWi与存储在MDi内存中的所述异或生成所述为用户与家庭网关间认证的密钥；S4.3：MDi使用所述第五随机数N1与所述异或生成使用存储MDi中的所述第七哈希值UIDi、所述家庭智能设备假名PIDq、所述第五随机数N1与所述第一时间戳T1合并生成第二十七哈希值M7＝h，并通过公开信道向家庭网关发送所述第七哈希值UIDi、所述家庭智能设备假名PIDq、所述M6、所述第二十七哈希值M7与所述第一时间戳T1；S4.4：家庭网关收到所述第七哈希值UIDi、所述家庭智能设备假名PIDq、所述M6、所述第二十七哈希值M7与所述第一时间戳T1后生成第二时间戳检查所述第一时间戳T1与所述第二时间戳间的时间差是否在最大时间延迟范围内如果所述时间差不在最大时间延迟范围内，用户认证与密钥协商阶段结束；否则，继续执行S4.5；S4.5：家庭网关提取存储在网关数据库中的所述第一挑战ck，将所述第一挑战ck输入嵌入在家庭网关中的物理不可克隆函数PUFk后生成第四响应将存储在网关中的私钥s与所述第四响应合并生成第二十八哈希值所述第二十八哈希值为家庭主人与家庭网关间的认证密钥；S4.6：家庭网关使用所述第二十八哈希值与所述第七哈希值UIDi合并生成第二十九哈希值所述第二十九哈希值为家庭用户与家庭网关间认证的密钥，使用所述M6与所述第二十九哈希值异或生成第六随机数使用所述第七哈希值UIDi、所述家庭智能设备假名PIDq、所述第六随机数与所述第一时间戳T1合并生成第三十哈希值验证所述第三十哈希值M7与MDi发送的所述第二十七哈希值M7是否相等，如果不相等，用户认证与密钥协商阶段结束；否则，继续执行S4.7；S4.7：家庭网关检查所述家庭智能设备假名PIDq是否存在于网关数据中的访问列表中。如果不存在，用户认证与密钥协商阶段结束，并向MDi返回没有该设备的的访问权限；否则，继续执行S4.8；S4.8：家庭网关生成第七随机数N2与第三时间戳T2，使用所述第四响应Rk生成第三十一哈希值h；将所述第三十一哈希值h与所述家庭智能设备假名PIDq合并，并使用存储在网关数据库中的所述fq与合并后的值h||PIDq异或生成第五响应S4.9：家庭网关将所述第五随机数N1与第七随机数N2拼接，并使用拼接后的值N1||N2与所述第五响应Rq异或生成使用所述第五随机数N1、所述第七随机数N2与存储在网关数据库中的所述第二挑战cq以及第三时间戳T2合并生成第三十二哈希值M10＝h，并通过公开信道向家庭智能设备发送所述M9、所述第三十二哈希值M10、所述第二挑战cq与所述第三时间戳T2；S4.10：家庭智能设备收到所述M9、所述第三十二哈希值M10、所述第二挑战cq与所述第三时间戳T2后生成第四时间戳检查所述第三时间戳T2与所述第四时间戳间的时间差是否在最大时间延迟范围内如果所述时间差不在最大时间延迟范围内，用户认证与密钥协商阶段结束；否则，继续执行S4.11；S4.11：家庭智能设备将所述第二挑战cq输入嵌入在家庭智能设备中的物理间戳T2合并生成所述第三十三哈希值S4.12：家庭智能设备生成第十随机数N3与第五时间戳T3；使用所述第八随机数N1、第九随机数N2与第十随机数N3合并生成第三十四哈希值SSKi＝h；所述第三十四哈希值SSKi为家庭用户与家庭智能设备间临时的安全会话密钥；S4.13：家庭智能设备使用存在内存中的所述家庭智能设备假名PIDq与所述第六响应Rq合并生成第三十五哈希值h，使用所述第十随机数N3与所述第三十五哈希值h异或生成使用所述家庭智能设备假名PIDq、所述第三十四哈希值SSKi与所述第五时间戳T3合并生成第三十七哈希值M12＝h，并向家庭网关发送所述M11、所述第三十七哈希值M12与所述第五时间戳T3；S4.14：家庭网关收到所述M10、所述第三十七哈希值M12与所述第五时间戳后T3生成第六时间戳检查所述第五时间戳T3与所述第六时间戳间的时间差是否在最大时间延迟范围内如果所述时间差不在最大时间延迟范围内，用户认证与密钥协商阶段结束；否则，继续执行S4.15；S4.15：家庭网关使用所述家庭智能设备假名PIDq与所述第五响应Rq合并生成所述第三十八哈希值h，使用所述M11与所述第三十八哈希值h异或生成第十一随机数使用所述第六随机数N1、所述第七随机数N2与所述第十一随机数合并生成所述第三十九哈希值使用所述家庭智能设备假名PIDq、所述第三十九哈希值与所述第五时间戳T3合并生成所述第四十哈希值验证所述第四十哈希值与家庭智能设备发送的所述第三十七哈希值M12是否相等。如果不相等，用户认证与密钥协商阶段结束；否则，继续执行S4.16；S4.16：家庭网关生成第七时间戳T4，使用所述第六随机数N1与所述第二十八哈希值合并生成第四十一哈希值使用所述第七哈希值UIDi与所述第二十九哈希值合并生成第四十二哈希值将所述第四十一哈希值与所述第四十二哈希值拼接生成使用所述第七随机数N2与所述第十一随机数N3拼接生成N2||N3，使用所述与所述N2||N3异或生成使用所述第七哈希值UIDi、所述第三十九哈希值SSKi与所述第七时间戳T4合并生成第四十三哈希值M14＝h，并通过公开信道向MDi发送所述M13、所述第四十三哈希值M14与所述第七时间戳T4；S4.17：MDi收到所述M12、所述第四十三哈希值M14与所述第七时间戳T4后生成第八时间戳检查所述第七时间戳T4与所述第八时间戳间的时间差是否在最大时间延迟范围内如果所述时间差不在最大时间延迟范围内，用户认证与密钥协商阶段结束；否则，继续执行S4.18；S4.18：MDi使用所述第五随机数N1与步骤S4.2中生成的所述合并生成第四十四哈希值使用所述第七哈希值UIDi与所述合并生成第四十五哈希值将所述第四十四哈希值与所述第四十五哈希值拼接生成使用所述M13与所述异或后生成所述第七随机数与所述第十一随机数的拼接值拆分所述后生成第十二随机数与第十三随机数S4.19：MDi使用所述第五随机数N1、所述第十二随机数与所述第十三随机数合并后生成第四十六哈希值所述第四十六哈希值为家庭用户与家庭智能设备间临时的安全会话密钥，使用所述第七哈希值UIDi、所述第四十六哈希值与所述第七时间戳T4合并生成所述第四十七哈希值验证所述第四十七哈希值与家庭智能设备发送的所述第四十三哈希值M14是否相等。如果不相等，用户认证与密钥协商阶段结束；否则，家庭用户与家庭智能设备都将所述第四十七哈希值SSKi作为临时的安全会话密钥，至此用户认证与密钥协商阶段结束。请参考图5，其示出了本申请一个实施例提供的计算设备1500的结构示意图。该计算设备1500可用于实施上述实施例中提供的用户使用家庭智能设备的授权认证与密钥协商方法。具体来讲：所述计算设备1500包括中央处理单元1501、包括随机存取存储器1502和只读存储器1503的系统存储器1504，以及连接系统存储器1504和中央处理单元1501的系统总线1505。所述计算设备1500还包括帮助计算机内的各个器件之间传输信息的基本输入/输出系统1506，和用于存储操作系统1513、应用程序1514和其他程序模块1515的大容量存储设备1507。所述基本输入/输出系统1506包括有用于显示信息的显示器1508和用于用户输入信息的诸如鼠标、键盘之类的输入设备1509。其中，所述显示器1508和输入设备1509都通过连接到系统总线1505的输入输出控制器1510连接到中央处理单元1501。所述基本输入/输出系统1506还可以包括输入输出控制器1510以用于接收和处理来自键盘、鼠标、或电子触控笔等多个其他设备的输入。类似地，输入输出控制器1510还提供输出到显示屏、打印机或其他类型的输出设备。所述大容量存储设备1507通过连接到系统总线1505的大容量存储控制器连接到中央处理单元1501。所述大容量存储设备1507及其相关联的计算机可读介质为计算设备1500提供非易失性存储。也就是说，所述大容量存储设备1507可以包括诸如硬盘或者CD-ROM驱动器之类的计算机可读介质。不失一般性，所述计算机可读介质可以包括计算机存储介质和通信介质。计算机存储介质包括以用于存储诸如计算机可读指令、数据结构、程序模块或其他数据等信息的任何方法或技术实现的易失性和非易失性、可移动和不可移动介质。计算机存储介质包括RAM、ROM、EPROM、EEPROM、闪存或其他固态存储其技术，CD-ROM、DVD或其他光学存储、磁带盒、磁带、磁盘存储或其他磁性存储设备。当然，本领域技术人员可知所述计算机存储介质不局限于上述几种。上述的系统存储器1504和大容量存储设备1507可以统称为存储器。根据本申请的各种实施例，所述计算设备1500还可以通过诸如因特网等网络连接到网络上的远程计算机运行。也即计算设备1500可以通过连接在所述系统总线1505上的网络接口单元1511连接到网络1512，或者说，也可以使用网络接口单元1511来连接到其他类型的网络或远程计算机系统。所述存储器还包括一个或者一个以上的程序，所述一个或者一个以上程序存储于存储器中，且经配置以由一个或者一个以上处理器执行。上述一个或者一个以上程序包含用于实现上述用户使用家庭智能设备的授权认证与密钥协商方法。在示例性实施例中，还提供了一种计算设备，所述计算设备包括处理器和存储器，所述存储器中存储有至少一条指令、至少一段程序、代码集或指令集。所述至少一条指令、至少一段程序、代码集或指令集经配置以由所述处理器执行，以实现上述用户使用家庭智能设备的授权认证与密钥协商方法。在示例性实施例中，还提供了一种计算机可读存储介质，所述存储介质中存储有至少一条指令、至少一段程序、代码集或指令集，所述至少一条指令、所述至少一段程序、所述代码集或所述指令集在被终端的处理器执行时实现上述实施例的用户使用家庭智能设备的授权认证与密钥协商方法。可选地，上述计算机可读存储介质可以是ROM、RAM、CD-ROM、磁带、软盘和光数据存储设备等。在示例性实施例中，还提供了一种计算机程序产品，当该计算机程序产品被执行时，其用于实现上述用户使用家庭智能设备的授权认证与密钥协商方法。两个以上“和/或”，描述关联对象的关联关系，表示可以存在三种关系，例如，A和/或B，可以表示：单独存在A，同时存在A和B，单独存在B这三种情况。字符“/”一般表示前后关联对象是一种“或”的关系。另外，本文中描述的步骤编号，仅示例性示出了步骤间的一种可能的执行先后顺序，在一些其它实施例中，上述步骤也可以不按照编号顺序来执行，如两个不同编号的步骤同时执行，或者两个不同编号的步骤按照与图示相反的顺序执行，本申请实施例对此不作限定。以上所述仅为本申请的示例性实施例，并不用以限制本申请，凡在本申请的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本申请的保护范围之内。以上所述仅是本发明的部分实施方式，应当指出，对于本技术领域的普通技术人员来说，在不脱离本发明原理的前提下，还可以做出若干改进和润饰，这些改进和润饰也应视为本发明的保护范围。
