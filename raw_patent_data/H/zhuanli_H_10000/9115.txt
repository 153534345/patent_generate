标题title
一种适用于流通钢材溯源的联盟链
摘要abst
本发明公开了一种适用于流通钢材溯源的联盟链，本发明采用PoS共识算法替代PoW共识算法，避免了计算资源浪费，增强了事务处理吞吐量，通过设置专门的存储侧链，将过时钢材信息转移到的存储侧链存储，在不丢失过时钢材信息的前提下降低了主链的账本大小，新入网节点不必再浪费大量的存储空间和时间以存储过时钢材信息，降低了新入网节点的门槛。
权利要求书clms
1.一种适用于流通钢材溯源的联盟链，其特征在于，包括采用PoS共识算法的主链和存储侧链，存储侧链的节点均为同时在主链中的跨链节点；主链：存储钢材流通产业链中各环节的钢材信息；存储侧链：周期性检索主链中的过时钢材信息，将过时钢材信息转移至自身存储；在流通钢材溯源时，若溯源需要访问的钢材信息已被自身存储，将溯源需要访问钢材信息转移至主链存储。2.根据权利要求1所述的一种适用于流通钢材溯源的联盟链，其特征在于，在主链中，根据节点贡献和预设规则，确定下一个产块节点；其中，节点贡献为节点网络性能指标、节点存储性能指标、节点传输数据量指标和响应访问积极程度指标的加权和。3.根据权利要求2所述的一种适用于流通钢材溯源的联盟链，其特征在于，节点贡献的计算公式为：其中，CON表示主链中第i个节点的贡献；表示主链中第i个节点网络性能指标， Average表示计算平均值，Distance表示计算主链中第i个节点和第j个节点之间的距离；表示主链中第i个节点存储性能指标，Store表示主链中第i个节点已使用的硬盘存储量， Storeall表示主链中第i个节点计算机总存储量，P1表示Storeall- Store的权重，P2表示Storeall/Store的权重；表示主链中第i个节点传输数据量指标，表示主链中第i个节点上传的账本数据量，表示主链中第i个节点下载的账本数据量；表示主链中第i个节点响应访问积极程度指标，表示主链中第i个节点接收的访问请求，表示主链中第i个节点响应的访问请求；分别表示的权重。4.根据权利要求2所述的一种适用于流通钢材溯源的联盟链，其特征在于，预设规则为：在主链中，若第i个节点的产块概率最先达到产块目标值，则第i个节点为下一个产块节点；其中，产块概率根据第i个节点的贡献计算获得，产块目标值根据产上一块目标值的hash值计算获得。5.根据权利要求4所述的一种适用于流通钢材溯源的联盟链，其特征在于，产块概率的计算公式为：其中，CON表示主链中第i个节点的贡献，P表示主链中第i个节点的产块概率，表示主链中的产块间隔，t表示距上一块产出的时间；产块目标值的计算公式为：其中，表示产块b目标值，表示产块b-1目标值，块b-1表示上一产出的块，表示计算hash值，N表示控制运算值大小的参数，mod表示整除取余。6.根据权利要求1所述的一种适用于流通钢材溯源的联盟链，其特征在于，在存储侧链中，产块间隔随着主链的块高度增加速度和平均交易时间的增大而减小。7.根据权利要求1所述的一种适用于流通钢材溯源的联盟链，其特征在于，还包括若干访问侧链；访问侧链连接所在地区就近的主链节点，从所连主链节点获取主链账本，并将主链账本分割保存到各访问侧链节点中；在流通钢材溯源时，访问侧链接收普通商户或游客的溯源请求。8.根据权利要求1所述的一种适用于流通钢材溯源的联盟链，其特征在于，主链和存储侧链之间的钢材信息转移采用原子跨链技术。
说明书desc
技术领域本发明涉及一种适用于流通钢材溯源的联盟链，属于针对固定商品、全产业链的联盟链记账领域。背景技术流通钢材溯源是指对钢材的全生命周期进行跟踪和溯源。目前业内主要使用RFID方法对钢材进行出入库记录，相应的钢材溯源方法一般是逐条查询钢材出入库的数据库记录。这些记录数据以本地服务器保存为主，辅以云端备份。但是，对于集中式的服务器存储模式，存在以下问题：服务器易出现单点故障问题，导致数据库信息丢失或不匹配；服务器管理员的权限不受监管，管理员可以随意修改钢材信息；产业规模的不断扩大，致使系统所要处理的钢材溯源访问请求量也急速增加，服务器负载压力极大，而中心化服务器的升级成本高昂，这些成本均由上游厂商承担，不利于相关产业的良性发展。基于以上问题，联盟链技术被引入到了钢材溯源领域，有效解决了服务器单点故障和权限控制问题。但现有的联盟链解决方案仍存在一定问题：当前联盟链采用了工作量证明的共识机制，该机制下，大量计算设备被用于无意义的大整数分解计算，造成计算资源浪费；在现有共识机制下，联盟链的产块时间间隔较长，事务处理的吞吐量较低，无法应对高频访问；钢材作为流通性大宗商品，具有周期性流通特点，每过一个时间周期，就会有大量钢材从市场中退市，这些已处于使用阶段、不再流通的钢材信息却仍然在联盟链网络账本中普遍存储，直接导致了联盟链长度的快速增长和账本的臃肿，动辄数百GB的账本还大幅提高了新入网节点的门槛。发明内容本发明提供了一种联盟链及流通钢材溯源方法，解决了流通钢材溯源中联盟链存在计算资源浪费、事务处理吞吐量较低、新入网节点门槛高的问题。为了解决上述技术问题，本发明所采用的技术方案是：一种适用于流通钢材溯源的联盟链，包括采用PoS共识算法的主链和存储侧链，存储侧链的节点均为同时在主链中的跨链节点；主链：存储钢材流通产业链中各环节的钢材信息；存储侧链：周期性检索主链中的过时钢材信息，将过时钢材信息转移至自身存储；在流通钢材溯源时，若溯源需要访问的钢材信息已被自身存储，将溯源需要访问钢材信息转移至主链存储。在主链中，根据节点贡献和预设规则，确定下一个产块节点；其中，节点贡献为节点网络性能指标、节点存储性能指标、节点传输数据量指标和响应访问积极程度指标的加权和。节点贡献的计算公式为：其中，CON表示主链中第i个节点的贡献；表示主链中第i个节点网络性能指标， Average表示计算平均值，Distance表示计算主链中第i个节点和第j个节点之间的距离；表示主链中第i个节点存储性能指标，Store表示主链中第i个节点已使用的硬盘存储量， Storeall表示主链中第i个节点计算机总存储量，P1表示Storeall- Store的权重，P2表示Storeall/ Store的权重；表示主链中第i个节点传输数据量指标，表示主链中第i个节点上传的账本数据量，表示主链中第i个节点下载的账本数据量；表示主链中第i个节点响应访问积极程度指标，表示主链中第i个节点接收的访问请求，表示主链中第i个节点响应的访问请求；分别表示的权重。预设规则为：在主链中，若第i个节点的产块概率最先达到产块目标值，则第i个节点为下一个产块节点；其中，产块概率根据第i个节点的贡献计算获得，产块目标值根据产上一块目标值的hash值计算获得。产块概率的计算公式为：其中，CON表示主链中第i个节点的贡献，P表示主链中第i个节点的产块概率，表示主链中的产块间隔，t表示距上一块产出的时间；产块目标值的计算公式为：其中，表示产块b目标值，表示产块b-1目标值，块b-1表示上一产出的块，表示计算hash值，N表示控制运算值大小的参数，mod表示整除取余。在存储侧链中，产块间隔随着主链的块高度增加速度和平均交易时间的增大而减小。还包括若干访问侧链；访问侧链连接所在地区就近的主链节点，从所连主链节点获取主链账本，并将主链账本分割保存到各访问侧链节点中；在流通钢材溯源时，访问侧链接收普通商户或游客的溯源请求。主链和存储侧链之间的钢材信息转移采用原子跨链技术。本发明所达到的有益效果：本发明采用PoS共识算法替代PoW共识算法，避免了计算资源浪费，增强了事务处理吞吐量，通过设置专门的存储侧链，将过时钢材信息转移到的存储侧链存储，在不丢失过时钢材信息的前提下降低了主链的账本大小，新入网节点不必再浪费大量的存储空间和时间以存储过时钢材信息，降低了新入网节点的门槛。附图说明图1为主链区块结构如图；图2为主链过时钢材信息转移到存储侧链的流程图；图3为联盟链节点示意图；图4为流通钢材溯源实例流程图。具体实施方式下面结合附图对本发明作进一步描述。以下实施例仅用于更加清楚地说明本发明的技术方案，而不能以此来限制本发明的保护范围。一种适用于流通钢材溯源的联盟链，包括采用PoS共识算法的主链和存储侧链，存储侧链的节点均为同时在主链中的跨链节点；主链：存储钢材流通产业链中各环节的钢材信息；存储侧链：周期性检索主链中的过时钢材信息，将过时钢材信息转移至自身存储；在流通钢材溯源时，若溯源需要访问的钢材信息已被自身存储，将溯源需要访问钢材信息转移至主链存储。上述联盟链采用PoS共识算法替代PoW共识算法，避免了计算资源浪费，增强了事务处理吞吐量，通过设置专门的存储侧链，将过时钢材信息转移到的存储侧链存储，在不丢失过时钢材信息的前提下降低了主链的账本大小，新入网节点不必再浪费大量的存储空间和时间以存储过时钢材信息，降低了新入网节点的门槛。上述主链采用PoS共识算法搭建，在主链区块头中，额外设置专门的sidechain字段，主链区块中该字段值为00，主链区块结构如图1所示，图中Previous_Hash表示前一个区块的哈希值，Block_Number表示区块号，Sidechain表示侧链标识位，PoS_Hash表示PoS哈希值，Date表示区块数据，Block_Hash表示本区块的哈希值。主链搭建完成后，即可投入早期使用，此时，流通钢材产业链中的各环节，通过自有的计算机设备连接到主链，并以新入网节点身份向主链发起入网请求，提交注册信息。联盟链上部署的智能合约自动审核所提交的注册信息是否完备等，之后将上述信息交由专门的企业资质审核部门验证，验证通过后，提交注册信息的企业计算机账户将被认作为主链中的节点，根据需求企业可以选择担任主链节点，或者同时担任主链节点和存储侧链节点，即跨链节点。关于主链的PoS共识机制，由于本方案不发行数字货币，在主链中，根据节点贡献和预设规则，确定下一个产块节点。贡献这一指标综合考量了各节点的网络性能、存储性能以及该节点对本联盟链系统的参与积极性，具体为节点网络性能指标、节点存储性能指标、节点传输数据量指标和响应访问积极程度指标的加权和，具体计算公式可以如下：其中，CON表示主链中第i个节点的贡献，分别表示的权重，具体权重为比例参数，可根据实际情况动态调整。表示主链中第i个节点网络性能指标，具体为第i个节点和其最近的n个节点的平均距离，表征其延迟，n一般取值为10，Average表示计算平均值，Distance表示计算主链中第i个节点和第j个节点之间的距离，可以灵活选择曼哈顿距离、欧几里得距离等。表示主链中第i个节点存储性能指标，具体为第i个节点的存储剩余存储能力，Store表示主链中第i个节点已使用的硬盘存储量， Storeall表示主链中第i个节点计算机总存储量，P1表示Storeall- Store的权重，P2表示Storeall/ Store的权重。表示主链中第i个节点传输数据量指标，表示主链中第i个节点上传的账本数据量，表示主链中第i个节点下载的账本数据量。对于经常在线的活跃节点，其多次执行数据同步所下载的账本数据和向其他节点分发的账本数据必然高于不活跃的网络节点。表示主链中第i个节点响应访问积极程度指标，用于描述节点响应访问功能的积极程度，表示主链中第i个节点接收的访问请求，表示主链中第i个节点响应的访问请求；某节点，其所响应的访问请求越多，积极响应占收到的访问请求的比例越高，其产块概率越高。上述预设规则为：在主链中，若第i个节点的产块概率最先达到产块目标值，则第i个节点为下一个产块节点；其中，产块概率根据第i个节点的贡献计算获得，产块目标值根据产上一块目标值的hash值计算获得。产块概率的计算公式为：其中，CON表示主链中第i个节点的贡献，P表示主链中第i个节点的产块概率，表示主链中的产块间隔，t表示距上一块产出的时间；产块目标值的计算公式为：其中，表示产块b目标值，表示产块b-1目标值，块b-1表示上一产出的块，表示计算hash值，N表示控制运算值大小的参数，以免过大导致长期不产生新块，mod表示整除取余。在每次产出新块前，各节点依据的hash值，结合自身的贡献计算和 P，随着t的增大P会变大，最先达到产块目标值的节点，即，被选举为下一个产块节点。存储侧链采用主链相同的PoS共识算法搭建，在存储侧链区块头中，额外设置专门的sidechain字段，存储侧链区块中该字段值为10。存储侧链中，设置有一个专门的时间周期，用于描述主链的钢材信息失效时间，每经过一个时间周期，便代表整个主链账本中有一定数量的流通钢材信息已经过时，需要被清理。由于存储侧链节点均为跨链节点且均位于主链中，故存储侧链可以直接在跨链节点上执行跨链智能合约调用，智能合约从主链的最高区块开始进行溯源检索，筛选出其中长期未被访问的钢材信息，并将这些钢材的编号打包进存储侧链区块，并通过联盟链网络进行广播，其余跨链节点收到后对其进行正确性和时效性验证，在验证通过后对其签名，然后将签名后的信息继续转发。当存储侧链中三分之二以上的节点均已对该信息签名，则各存储节点采用原子跨链技术将过时钢材信息转移至存储侧链存储。在存储侧链中，部署有专门的周期监测智能合约。由于存储侧链节点本身已经部署在主链中，因此存储侧链上的智能合约能够持续监测主链的块高度的增加速度VB和平均交易时间AT，并根据这两项数据灵活调整跨链区块的产块间隔。具体表现为，在存储侧链中，产块间隔随着主链的块高度增加速度和平均交易时间的增大而减小，以控制存储侧链更快的将过时钢材信息进行转移，以降低主链的存储负载，用公式可以表示为：其中，表示存储侧链中产块间隔，该公式只是为了说明产块间隔和 VB、AT成反比，具体实现时，产块间隔还要考虑到其他因素参数，指代其他因素参数。在流通钢材溯源时，若溯源需要访问的钢材信息已被存储侧链存储，主链节点会向存储侧链节点发起“移回”的事务请求，存储侧链节点在接收到该事务后，会将存储侧链中的钢材信息重新提取并通过原子跨链技术将该信息转移回主链。此后，直到该钢材信息重新被认定为过时并转移回存储侧链前，其信息将一直在主链账本中存储。主链和存储侧链之间的钢材信息转移采用原子跨链技术，以如图2所示的主链过时钢材信息转移到存储侧链为例，具体过程可以为：1）跨链节点收集跨链事务到临时区块中，统计帐本中被修改的数据项，将其写入modified_List之中，跨链节点还要计算相关事务修改前后的区块状态的hash值，记作Hash_Origin和Hash_Update，当全部数据被写入后，跨链节点为其设置两个TimeLock值，分别为TimeLock_begin和TimeLock_over，最后跨链节点签名并将其广播到主链网络中。2）主链节点收到后，对跨链事务进行验证，验证通过后使用私钥签名，继续转发该跨链事务。3）跨链节点收到被转发的跨链事务，验证其同时满足M1 of N1的共识比例和当前时间小于TimeLock_begin后，对事务中的数据项上锁将跨链事务发送给存储侧链节点；4）如果主链节点未能在TimeLock_begin时间内收到满足共识要求的跨链事务，则自动解除数据项锁定，代表跨链事务启动失败；5）存储侧链节点收到跨链事务后，执行该事务，并将执行前后的结果与Hash_Origin和Hash_Update相比较，如无误，则对其签名后转发给其他存储侧链节点；6）存储侧链节点收到跨链事务后，验证其同时满足M2 of N2的共识比例和当前时间小于TimeLock_over后，将事务修改应用到当前帐本，并向跨链节点返回确认信息；7）跨链节点收到确认信息后，转发到主链网络中。主链节点收到确认信息后，验证其TimeLock_over，通过后将相应的数据项解除锁定并执行删除操作；8）如果主链节点未能在TimeLock_over时间内接收到确认信息，则代表跨链事务运行失败，自动解除相关数据项的锁定，放弃修改。存储侧链向主链转移钢材信息，则是上述的反向过程。在流通钢材溯源时，普通商户或游客用户只需执行一些轻量级操作，针对这些用户，上述联盟链中还设置若干访问侧链，访问侧链连接所在地区就近的主链节点，从所连主链节点获取主链账本，并将主链账本分割保存到各访问侧链节点中；在流通钢材溯源时，访问侧链接收普通商户或游客的溯源请求。访问侧链采用委员会共识算法，在访问侧链区块头中，设置专门的sidechain字段，访问侧链区块中该字段值为11，在该访问侧链下，普通商户或游客用户只需使用少量的计算资源和存储资源，即可完成轻量级操作，无需下载完整的主链账本或加入到共识流程之中。每个地区独自运行各自的访问侧链和内部委员会共识机制。对于某一地区的访问侧链从就近的主链节点处获取完整的主链账本，然后将其进行分割保存到该地区中的每个访问侧链节点中，各节点都要独立建立自己的邻近账本，并确保该地区内所有节点的邻近账本之和，不低于两份主链账本。访问侧链的内部委员会共识，主要用于同步各访问侧链节点间关于主链账本的协同保存，以及及时和主链账本之间保持同步更新，委员会内部采用简单的PBFT共识算法即可。通过设置了专门的访问侧链以供普通商户和游客使用，这部分事务借助账本的分割存储，可以得到快速执行，既减少了主链的访问处理负担，也降低了用户查询时的处理延迟，优化了用户体验。上述联盟链网络可以如图3所示，普通商户或游客作为访问侧链节点接入到访问侧链网络中后，发起对特定钢材的溯源请求的处理流程可以如下：A1）访问侧链节点收到请求后，首先检索本地的邻近账本，查询钢材信息；若本地有的钢材信息，将直接返回给用户显示；若本地查询不到相应的钢材信息，则将该请求转发给同一地区下的其他访问侧链节点；A2）其他访问侧链节点收到访问请求后，若本地有相应的钢材信息，则将其返回给所请求的节点，若本地没有，则继续转发请求信息；A3）在地区访问侧链网络内，必定能够查询到非过时的钢材信息，因此，对于所有请求，在最坏情况下只需遍历整个地区网络即可得到回复。同时，地区内存在部署于靠地区中心位置的主链节点，主链节点也会对请求做出响应，可以进一步缩短响应时间；A4）如果地区内的主链节点在接收到请求后，验证得用户访问的是过时的钢材信息，则向存储侧链申请资源调度，存储侧链采用原子跨链方式，将过时钢材信息重新转移到主链上以供访问。在请求转发时，采用就近原则转发，举例说明上述溯源过程，见图4：11）假设用户希望访问区块2、4、5、6、7的钢材信息，向访问访问侧链节点A发送请求；12）访问侧链节点A检索本地邻近账本后获得区块5、6，将区块5、6直接反馈给用户，按照就近原则，访问侧链节点A将访问区块2、4、7的请求发送给访问侧链节点B和C；13）访问侧链节点B检索本地邻近账本后获得区块7，通过访问侧链节点A向用户反馈区块7，按照就近原则，访问侧链节点B将访问区块2、4的请求发送给主链节点F；访问侧链节点C检索本地邻近账本后没有获得区块，按照就近原则，访问侧链节点C将访问区块2、4的请求发送给主链节点F；A、B、C为访问侧链中的3个节点，由于其他节点相较于主链节点F更远，因此不会向其他节点转发请求，而是直接向主链节点F转发请求；14）主链节点F检索区块4，通过访问侧链节点B、访问侧链节点A将区块4反馈给用户；主链节点F验证出区块2为过时钢材信息，向存储侧链发送请求，将该过时钢材信息转移至主链上以供访问。上述联盟链可以在不损失传统联盟链去中心化特性和数据完整性的情况下，有效降低钢材溯源场景中计算机设备的计算压力、显著提升事务处理的吞吐量，并降低新入网节点的存储门槛，方便用户使用。以上所述仅是本发明的优选实施方式，应当指出，对于本技术领域的普通技术人员来说，在不脱离本发明技术原理的前提下，还可以做出若干改进和变形，这些改进和变形也应视为本发明的保护范围。
