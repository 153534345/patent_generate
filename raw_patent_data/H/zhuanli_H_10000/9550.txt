标题title
基于加权概率编码的提升FTP传输安全性方法、设备及介质
摘要abst
本发明公开了一种基于加权概率编码的提升FTP传输安全性方法、设备及介质，本实施例方法利用加权概率编码方法编码原始消息得到第一哈希值，然后三次握手建立通道之后，同样利用加权概率编码方法编码待验证消息得到第二哈希值，通过第一哈希值和第二哈希值是否相同能够快速有效的校验原始消息是否被木马侵蚀，验证第二端口通道数据传输的正确性。
权利要求书clms
1.一种基于加权概率编码的提升FTP传输安全性方法，其特征在于，用于FTP客户端，包括如下步骤：与FTP服务器通过第一端口建立通信连接；基于加权概率编码方法根据原始消息生成第一哈希值，并将所述第一哈希值通过所述第一端口发送至所述FTP服务器；发送请求命令至所述FTP服务器，以使所述FTP服务器根据所述请求命令选择第二端口；将所述原始消息通过所述第二端口发送至所述FTP服务器，以使所述FTP服务器得到所述第二端口输出的待验证消息并基于所述第一哈希值加权概率编码方法根据所述待验证消息生成第二哈希值，并使所述FTP服务器根据所述第一哈希值与所述第二哈希值判断所述第二端口传输数据的正确性。2.根据权利要求1所述的基于加权概率编码的提升FTP传输安全性方法，其特征在于，所述发送请求命令至所述FTP服务器，以使所述FTP服务器根据所述请求命令选择第二端口，包括：发送PORT命令至所述FTP服务器，以使所述FTP服务器根据所述PORT命令选择TCP20端口作为第二端口；或者，发送PASV命令至所述FTP服务器，以使所述FTP服务器根据所述PASV命令随机选取一个端口号大于1024的端口作为第二端口。3.根据权利要求2所述的基于加权概率编码的提升FTP传输安全性方法，其特征在于，所述基于加权概率编码方法根据原始消息生成第一哈希值，并将所述第一哈希值通过所述第一端口发送至所述FTP服务器，包括：将所述原始消息转换成第一二进制序列X，当所述第一二进制序列X中符号0的概率p0大于所述第一二进制序列X中符号1的概率p1时，在所述原始消息的末尾添加k+8个字节，得到目标消息；其中，所述k为满足H≥512L的最小正整数，H表示所述第一二进制序列X的信息熵，H＝-p0log2p0-p1log2p1，n表示所述第一二进制序列X的比特长度，L表示预设的哈希值字节长度；计算权系数r，其中，r＝2H-8L/n；将所述目标消息转换成第二二进制序列Y，通过如下编码方式对所述第二二进制序列Y中的第j个符号Yj进行编码，直至编码完所述第二二进制序列Y中最后一个符号，得到第一哈希值：当Yj＝1，且p0≤p1，则通过和对所述Yj进行编码；当Yj＝1，且p0＞p1，则通过对所述Yj进行编码；当Yj＝0，且p0≤p1，则通过对所述Yj进行编码；当Yj＝1，且p0＞p1，则通过和对所述Yj进行编码；其中，表示所述目标消息中的第个字节，表示j/8向下取整，Lj，Rj，Lj-1，Rj-1为编码变量；当编码输出的第l个字节大于L时，对所述编码输出的第l个字节进行异或运算；将所述第一哈希值通过所述第一端口发送至所述FTP服务器。4.根据权利要求3所述的基于加权概率编码的提升FTP传输安全性方法，其特征在于，在所述原始消息的末尾添加k+8个字节，包括：先在所述原始消息的末尾添加64L-H个字节FF，再添加由8个字节组合成的字节串；其中，所述字节串是所述第一二进制序列X中符号0的概率p0的字节表示。5.一种基于加权概率编码的提升FTP传输安全性方法，其特征在于，用于FTP服务器，包括如下步骤：与FTP客户端通过第一端口建立通信连接；接收所述FTP客户端通过所述第一端口发送的第一哈希值；其中，所述第一哈希值是所述FTP客户端基于加权概率编码方法对原始消息进行编码生成；接收所述FTP客户端发送的请求命令，根据所述请求命令选择第二端口；接收到所述第二端口输出的待验证消息，按照所述第一哈希值加权概率编码方法对所述待验证消息进行编码，得到第二哈希值；根据所述第一哈希值与所述第二哈希值判断所述第二端口传输数据的正确性。6.根据权利要求5所述的基于加权概率编码的提升FTP传输安全性方法，其特征在于，所述接收所述FTP客户端发送的请求命令，根据所述请求命令选择第二端口，包括：接收所述FTP服务器发送的PORT命令，根据所述PORT命令选择TCP20端口作为第二端口；或者，接收所述FTP服务器发送的PASV命令，根据所述PASV命令随机选取一个端口号大于1024的端口作为第二端口。7.根据权利要求6所述的基于加权概率编码的提升FTP传输安全性方法，其特征在于，所述对所述待验证消息进行编码，得到第二哈希值，包括：将所述待验证消息转换成第一二进制序列X，当所述第一二进制序列X中符号0的概率p0大于所述第一二进制序列X中符号1的概率p1时，在所述待验证消息的末尾添加k+8个字节，得到目标消息；其中，所述k为满足H≥512L的最小正整数，H表示所述第一二进制序列X的信息熵，H＝-p0log2p0-p1log2p1，n表示所述第一二进制序列X的比特长度，L表示预设的哈希值字节长度；计算权系数r，其中，r＝2H-8L/n；将所述目标消息转换成第二二进制序列Y，通过如下编码方式对所述第二二进制序列Y中的第j个符号Yj进行编码，直至编码完所述第二二进制序列Y中最后一个符号，得到第二哈希值：当Yj＝1，且p0≤p1，则通过和对所述Yj进行编码；当Yj＝1，且p0＞p1，则通过对所述Yj进行编码；当Yj＝0，且p0≤p1，则通过对所述Yj进行编码；当Yj＝1，且p0＞p1，则通过和对所述Yj进行编码；其中，表示所述目标消息中的第个字节，表示j/8向下取整，Lj，Rj，Lj-1，Rj-1为编码变量；当编码输出的第l个字节大于L时，对所述编码输出的第l个字节进行异或运算。8.根据权利要求7所述的基于加权概率编码的提升FTP传输安全性方法，其特征在于，在所述原始消息的末尾添加k+8个字节，包括：先在所述原始消息的末尾添加64L-H个字节FF，再添加由8个字节组合成的字节串；其中，所述字节串是所述第一二进制序列X中符号0的概率p0的字节表示。9.一种电子设备，其特征在于：包括至少一个控制处理器和用于与所述至少一个控制处理器通信连接的存储器；所述存储器存储有可被所述至少一个控制处理器执行的指令，所述指令被所述至少一个控制处理器执行，以使所述至少一个控制处理器能够执行权利要求1至4任一项所述的基于加权概率编码的提升FTP传输安全性方法和权利要求5至8任一项所述的基于加权概率编码的提升FTP传输安全性方法。10.一种计算机可读存储介质，其特征在于：所述计算机可读存储介质存储有计算机可执行指令，所述计算机可执行指令用于使计算机执行权利要求1至4任一项所述的基于加权概率编码的提升FTP传输安全性方法和权利要求5至8任一项所述的基于加权概率编码的提升FTP传输安全性方法。
说明书desc
技术领域本发明涉及FTP协议技术领域，特别涉及一种基于加权概率编码的提升FTP传输安全性方法、设备及介质。背景技术在FTP是TCP/IP协议组中的协议之一。FTP协议包括两个组成部分，其一为FTP服务器，其二为FTP客户端。其中FTP服务器用来存储文件，用户可以使用FTP客户端通过FTP协议访问位于FTP服务器上的资源。在开发网站的时候，通常利用FTP协议把网页或程序传到Web服务器上。此外，由于FTP传输效率非常高，在网络上传输大的文件时，一般也采用该协议。默认情况下FTP协议使用TCP端口中的20和21这两个端口，其中20用于传输数据，21用于传输控制信息。但是，是否使用20作为传输数据的端口与FTP使用的传输模式有关，如果采用主动模式，那么数据传输端口就是20；如果采用被动模式，则具体最终使用哪个端口要服务器端和客户端协商决定。FTP协议是目前网站、云系统部署的主要手段。而文件传输过程或部署时经常出现木马等病毒篡改数据或文件，从而造成云端数据和文件的相互感染。发明内容本发明旨在至少解决现有技术中存在的技术问题。为此，本发明提出一种基于加权概率编码的提升FTP传输安全性方法、设备及介质。能够快速有效的校验原始消息是否被木马侵蚀，验证第二端口通道数据传输的正确性本发明的第一方面，提供了一种基于加权概率编码的提升FTP传输安全性方法，用于FTP客户端，包括如下步骤：与FTP服务器通过第一端口建立通信连接；基于加权概率编码方法根据原始消息生成第一哈希值，并将所述第一哈希值通过所述第一端口发送至所述FTP服务器；发送请求命令至所述FTP服务器，以使所述FTP服务器根据所述请求命令选择第二端口；将所述原始消息通过所述第二端口发送至所述FTP服务器，以使所述FTP服务器得到所述第二端口输出的待验证消息并基于所述第一哈希值加权概率编码方法根据所述待验证消息生成第二哈希值，并使所述FTP服务器根据所述第一哈希值与所述第二哈希值判断所述第二端口传输数据的正确性根据本发明的实施例，至少具有如下技术效果：利用加权概率编码方法编码原始消息得到第一哈希值，然后三次握手建立通道之后，同样利用加权概率编码方法编码待验证消息得到第二哈希值，通过第一哈希值和第二哈希值是否相同能够快速有效的校验原始消息是否被木马侵蚀，验证第二端口通道数据传输的正确性。本发明的第二方面，提供了一种基于加权概率编码的提升FTP传输安全性方法，用于FTP服务器，包括如下步骤：与FTP客户端通过第一端口建立通信连接；接收所述FTP客户端通过所述第一端口发送的第一哈希值；其中，所述第一哈希值是所述FTP客户端基于加权概率编码方法对原始消息进行编码生成；接收所述FTP客户端发送的请求命令，根据所述请求命令选择第二端口；接收到所述第二端口输出的待验证消息，按照所述第一哈希值加权概率编码方法对所述待验证消息进行编码，得到第二哈希值；根据所述第一哈希值与所述第二哈希值判断所述第二端口传输数据的正确性根据本发明的实施例，至少具有如下技术效果：利用加权概率编码方法编码原始消息得到第一哈希值，然后三次握手建立通道之后，同样利用加权概率编码方法编码待验证消息得到第二哈希值，通过第一哈希值和第二哈希值是否相同能够快速有效的校验原始消息是否被木马侵蚀，验证第二端口通道数据传输的正确性。本发明的第三方面，提供了一种电子设备，包括至少一个控制处理器和用于与所述至少一个控制处理器通信连接的存储器；所述存储器存储有可被所述至少一个控制处理器执行的指令，所述指令被所述至少一个控制处理器执行，以使所述至少一个控制处理器能够执行上述的基于加权概率编码的提升FTP传输安全性方法。本发明的第四方面，提供了一种计算机可读存储介质，所述计算机可读存储介质存储有计算机可执行指令，所述计算机可执行指令用于使计算机执行上述的基于加权概率编码的提升FTP传输安全性方法。需要注意的是，本发明的第三方面和第四方面与现有技术之间的有益效果与上述的基于加权概率编码的提升FTP传输安全性方法与现有技术之间的有益效果相同，此处不再细述。本发明的附加方面和优点将在下面的描述中部分给出，部分将从下面的描述中变得明显，或通过本发明的实践了解到。附图说明本发明的上述和/或附加的方面和优点从结合下面附图对实施例的描述中将变得明显和容易理解，其中：图1为本发明一个实施例提供的基于加权概率编码的提升FTP传输安全性方法的流程示意图。具体实施方式下面详细描述本发明的实施例，所述实施例的示例在附图中示出，其中自始至终相同或类似的标号表示相同或类似的元件或具有相同或类似功能的元件。下面通过参考附图描述的实施例是示例性的，仅用于解释本发明，而不能理解为对本发明的限制。原理介绍部分；为了便于本领域技术人员理解本申请实施例，先介绍本申请实施例所用到的基本原理：加权概率模型Hash方法以及加权概率模型信息熵。第一、加权概率模型Hash方法；令信源序列X＝是有限个值或可数个可能值的离散序列，Xi∈A＝{0，1，2，...，k}。于是对于A中一切数值有概率空间：由于随机过程必须转移到某个符号，所以在任意时刻有：于是，任意符号Xi的分布函数为：其中，p≤F≤1，s∈A。定义1：设离散随机变量X，X∈A＝{0，1，...，k}，P{X＝a}＝p，加权概率质量函数为p为的概率质量函数，0≤p≤1，r为权系数，且：F＝∑i≤ap若F满足F＝rF，则称F为加权累积分布函数，简称加权分布函数。显然，所有符号的加权概率之和为令离散信源序列X＝，Xi∈A，且令F＝F-p，序列X的加权分布函数记为F。当n＝1时：F＝rF+rp当n＝2时：F＝rF+r2Fp+r2pp当n＝3时：F＝rF+r2Fp+r3Fpp+r3ppp令类推得：将满足式的加权分布函数的集合定义为加权概率模型，简称加权模型，记为{F}。若Xi∈A＝{0，1}，则称{F}为二元加权模型。令：Hn＝F Ln＝Hn-Rn 其中Xi∈A，n＝1，2，...。当r＝1时：由式可得Hn＝F，即算术编码是基于r＝1时加权分布函数的无损编码方法。因Xi必须取A中的值，所以p＞0。显然式为区间列，需要注意的是，式包括以上三个式子。通过式对信源序列X进行加权概率模型编码运算，Ln为实数，是加权概率模型编码结果。Ln通过进制转换得到二进制序列。第二、加权概率模型信息熵；设离散无记忆信源序列X＝，当r＝1时，由香农信息熵定义，X的熵为：当r≠1时，定义具有概率的随机变量Xi的自信息量为：I＝-log2 p设集合{Xi＝a}中有ca个a。当r的值确定，信源序列X的总信息量为：于是平均每个符号的信息量为：定义2、令H为：根据定义2，在r的值确定时，通过加权概率模型编码后的二进制长度为nH比特。最简单的信源序列为二进制序列，设二进制信源序列X的比特长度为n，X中符号0和符号1有概率p和p，且经加权概率模型编码后得到长度为L的序列。当k＝1时由式可得：-n log2 r+nH＝L其中H序列X的信息熵，即H＝-plog2 p-plog2 p，化简式得：根据无失真编码定理，H是离散无记忆信源序列X的无失真编码极限，所以当H≥H时加权模型函数F可无失真还原信源序列X。当H＜H时，加权模型函数F无法还原信源X，即当L＜nH时编码结果Ln无法还原信源X。由式和可得，当H＞L/n时，有r＞1，H＜H，于是满足式且r＞1的加权模型函数F均是单向散列函数。基于哈希碰撞的分析条件，散列值中各符号的概率需均等。需要注意的是，在本申请中“散列值”相当于“哈希值”。定理1、任意二进制序列经加权概率模型哈希方法得出的散列值中符号0和符号1的概率均等。证明：设二进制序列经加权概率模型哈希方法得出的散列值的比特长度为L，散列值的二进制序列记为Y，其信息熵为H＝-plog2 p-plog2 p。根据定义2，nH＝-nlog2 r+nH，所以LH＝-nlog2r+nH。当且仅当H＝1时，式成立，即r满足式。否则r不满足式。又当且仅当p＝p＝0.5时，H＝1，所以序列Y中符号0和符号1的概率均等。实施例部分；FTP是TCP/IP协议组中的协议之一。FTP协议包括两个组成部分，其一为FTP服务器，其二为FTP客户端。其中FTP服务器用来存储文件，用户可以使用FTP客户端通过FTP协议访问位于FTP服务器上的资源。在开发网站的时候，通常利用FTP协议把网页或程序传到Web服务器上。此外，由于FTP传输效率非常高，在网络上传输大的文件时，一般也采用该协议。默认情况下FTP协议使用TCP端口中的20和21这两个端口，其中20用于传输数据，21用于传输控制信息。但是，是否使用20作为传输数据的端口与FTP使用的传输模式有关，如果采用主动模式，那么数据传输端口就是20；如果采用被动模式，则具体最终使用哪个端口要服务器端和客户端协商决定。在现有方案中，很多防火墙在设置的时候都是不允许接受外部发起的连接的，所以许多位于防火墙后或内网的FTP服务器不支持PASV模式，因为客户端无法穿过防火墙打开FTP服务器的高端端口；而许多内网的客户端不能用PORT模式登陆FTP服务器，因为从服务器的TCP 20无法和内部网络的客户端建立一个新的连接，造成无法工作。在建立新的连接之后，文件传输过程或部署时经常出现木马等病毒篡改数据或文件，从而造成云端数据和文件的相互感染。为了解决这一缺陷，参照图1，本发明的一个实施例，提供了一种基于加权概率编码的提升FTP传输安全性方法，包括如下步骤：步骤S100、FTP客户端与FTP服务器通过第一端口建立通信连接。步骤S200、FTP客户端基于加权概率编码方法根据原始消息生成第一哈希值，并将第一哈希值通过第一端口发送至FTP服务器。步骤S300、FTP客户端通过第一端口发送请求命令至FTP服务器。步骤S400、FTP服务器根据请求命令选择第二端口并通知FTP客户端。步骤S500、FTP客户端将原始消息通过第二端口发送至FTP服务器。步骤S600、FTP服务器接收到第二端口输出的待验证消息。步骤S700、FTP服务器基于加权概率编码方法根据待验证消息生成第二哈希值。步骤S800、FTP服务器比较第一哈希值和第二哈希值，当第一哈希值等于第二哈希值，则第二端口传输数据正确；当第一哈希值不等于第二哈希值，则第二端口传输数据出现错误。在本实施例中，第一端口是指TCP21端口，此处不限定原始消息的具体类型。在步骤S200中，FTP客户端先通过加权概率编码方法对原始消息编码生成第一哈希值并传输至FTP服务器。在步骤S400中，FTP服务器根据FTP客户端的命令选择第二端口，第二端口有两种情况：第一种情况是FTP服务器收到Port命令时，选择TCP20端口，第二种情况是FTP服务器收到PASV命令时，随机选择一个端口号大于1024的高端端口。FTP客户端在收到第二端口时，三次握手建立通道。在步骤S500中，FTP客户端通过第二端口传输数据。在步骤S600中，FTP服务器接收到第二端口的通道输出的待验证消息。在步骤S700至S800中，FTP服务器按照相同的加权概率编码方法对待验证消息进行编码，生成第二哈希值，然后对比第二哈希值和第一哈希值是否相同，来对第二端口通道传输数据的安全性进行验证。本实施例方法利用加权概率编码方法编码原始消息得到第一哈希值，然后三次握手建立通道之后，同样利用加权概率编码方法编码待验证消息得到第二哈希值，通过第一哈希值和第二哈希值是否相同能够快速有效的校验原始消息是否被木马侵蚀，验证第二端口通道数据传输的正确性。上述实施例在步骤S200和S700中，是基于加权概率编码方法对消息进行编码以得到相应的哈希值，现有的加权概率编码方法在计算过程中存在“哈希碰撞”，导致由两个不同的二进制序列在编码之后，得到的哈希值存在相同，那么当消息通过第二端口传输并被木马篡改时，存在第一哈希值和第二哈希值相同的情况，从而导致验证失败的问题。接着上述原理部分的介绍，以下详细说明产生“哈希碰撞”的原因以及本实施例提供的基于加权概率编码方法对消息进行编码以得到相应的哈希值的实现过程和原理：设输入为字节长度为N的消息，经过二进制加权概率编码，结束编码，然后输出字节长度为L的哈希值。设Bi为消息的第i个字节，则i＝1，2，...，N。Bi转换为8位二进制的方法很多，这里不作描述，设消息转换为n＝8N比特的二进制序列X。显然根据上述的式，任意改变二进制序列X的比特值，若符号0的统计值c相同，则p和r的值相同，所以p和r很轻易被碰撞。哈希编码方法的攻击手段归纳起来可以描述为两个目的：两个消息中至少存在一个比特差异，使得计算出的散列值相同；根据散列值推测出消息。首先基于目的可以给出两种情形，二进制序列X中至少存在一个比特差错，或当前消息的长度发生差错。根据上述式，当Xi＝0时，因为F＝rF，而则F＝0，于是：Ri＝Ri-1rpLi＝Li-1当Xi＝1时F＝p：Ri＝Ri-1r)Li＝Li-1+Ri-1rp设消息长度差错后比特长度为n′。当n′＜n且Xn′+1＝Xn′+2＝…＝Xn＝0时由上述式可得Ln′＝Ln，此时散列值必然相同。于是，Xn′+1，Xn′+2，…，Xn中至少有Xn＝1时由上述式可得Ln′≠Ln，则散列值必然不相同。同理，当n′＞n且Xn+1＝Xn+2＝…＝Xn′＝0时Ln′＝Ln，此时散列值必然相同。可得，消息最后一个有效符号1后增加任意个符号0并进行编码，均有Ln′＝Ln；消息最后一个有效符号1后增加任意个符号1并进行编码，均有Ln′≠Ln。设比特长度为n的消息中比特值Xi出现差错，编码结果为L′n，Xi的差错值记为X′i。由于Ri-1和Li-1正确，根据上述式有：当Xi＝0时F＝0，所以：于是X′i＝1，所以：可得：同理，当Xi＝1时X′i＝0，有：当且仅当L′n-Ln＝0时散列值相同，有：因所以当时，式不成立，此时L′n-Ln≠0。当时Xk+1＝Xk+2＝…＝Xn＝0，于是式不成立，则L′n-Ln≠0。显然，当时为任意值都无法使得式成立。可得，第i个符号出现差异时，无论Xi+1，Xi+2，…，Xn的值是否出现差异均无法使得式成立。即当时加权概率编码不可能产生相同散列值。消息存在所有可能性，于是有p＜p和p≥p两种情形。当p＜p时，编码时将序列X每个二进制符号Xi非运算，得于是中p＞p，此时式不成立。存在两种情形，分别为消息和消息X：a)则p＞p；b)X＝，则p＜p。a)和b)两种情形的编码结果相同，产生哈希碰撞。以字节为单位，若Bi和采用不同的权系数进行编码，则可解决a)和b)编码结果相同的问题。当p＜p则置换Bi为将Bi代入式，交换符号0和符号1的概率，编码中各比特；当p＞p时无需置换和无需交换概率，将Bi代入式，编码Bi中各比特。显然，a)和b)编码的二进制符号相同，但因为所以r不同，于是和F)的值不同，则编码结果Ln不同。因为p＞p，所以且式不成立，可得Ln′≠Ln，不会产生相同的哈希值。根据式，H为消息的信息熵，根据无失真编码定理，当8L≥nH时可无损编译码，即经散列值可无损译码，但无损译码必须p已知，p＝1-p。若p保留6位小数，则0.000001≤p≤0.999999，仅需106-1次遍历可得p，从而译码出消息。为此，本实施例提供的加权概率编码方法在现有加权概率编码方法的基础上提出了全新的解决方案，对消息进行填充，从消息末尾添加k个字节“FF”＞p)，然后添加由8个字节组成的串，该字节串是符号0概率p的字节表示。k是满足H≥512L的最小正整数，显然，因为H≥512L＞8L，所以散列值无法译码出消息。因填充后，消息的编码结果大于512L，设V为编码输出的第l个字节，当l＞L时进行字节异或运算。式中因V不可知，所以)mod L不可知。根据上述说明，步骤S200和S700基于加权概率编码方法对消息进行编码以得到相应的哈希值的流程包括：步骤S201、将原始消息转换成第一二进制序列X，当第一二进制序列X中符号0的概率p0大于第一二进制序列X中符号1的概率p1时，在原始消息的末尾添加k+8个字节，得到目标消息；其中，k为满足H≥512L的最小正整数，H表示第一二进制序列X的信息熵，H＝-p0 log2 p0-p1 log2 p1，n表示第一二进制序列X的比特长度，L表示预设的哈希值字节长度。这里，先在原始消息的末尾添加64L-H个字节“FF”，再添加由8个字节组合成的字节串；其中，字节串是第一二进制序列X中符号0的概率p0的字节表示。需要注意的是，在本实施例的相关介绍中，p和p，p0和p1都是指的二进制序列符号0和1的概率，但p和p是表示泛指，p0和p1表示特指，请注意区分。步骤S202、计算权系数r，其中，r＝2H-8L/n。步骤S203、将目标消息转换成第二二进制Y，通过如下编码方式对第二二进制Y中的第j个符号Yj进行编码，直至编码完第二二进制Y中最后一个符号，得到第一哈希值：当Yj＝1，且p0≤p1，则通过和对Yj进行编码；当Yj＝1，且p0＞p1，则通过对Yj进行编码；当Yj＝0，且p0≤p1，则通过对Yj进行编码：当Yj＝1，且p0＞p1，则通过和对Yj进行编码；其中，j取值范围为1至n+8k+64，表示目标消息中的第个字节，表示j/8向下取整，Lj，Rj，Lj-1，Rj-1为编码变量；当编码输出的第l个字节大于L时，对编码输出的第l个字节进行异或运算。本实施例提供一种新的加权概率编码方法，在编码过程中，当原始消息转换的二进制序列中符号0的概率小于符号1的概率时，存在哈希碰撞，为了避免出现“哈希碰撞”，对原始消息进行填充，使得填充后的原始消息进行加权概率编码之后不可能产生相同的哈希值，从而提升编码的安全性和准确性。而且本编码方法具有自定义的哈希值字节长度L，具备较强的安全性，，降低被木马侵蚀的风险。而且相较于现有加权概率编码方法，而且本编码方法优化了其使用因为轮函数复杂和记录随机数表的硬件实现资源问题。而且本编码方法根据原始消息转换的二进制序列的概率的不同，编码目标消息转换的二进制序列时将自行置换，提升了编码的安全性，降低被木马侵蚀的风险。将本加权概率编码方法应用于基于加权概率编码的提升FTP传输安全性方法的步骤S200和S700中，因为哈希值的唯一性，能够进一步提升FTP端口通道传输数据校验的准确性，进而提升FTP协议传输数据的安全性。而且还能优化硬件实现资源问题，提升编码的安全性，降低被木马侵蚀的风险。为了便于本领域技术员的理解，以下结合伪代码提供一种基于加权概率编码的提升FTP传输安全性方法，具体如下：FTP支持两种模式，一种方式叫做Standard，一种是Passive。Standard模式FTP的客户端发送PORT命令到FTP服务器。Passive模式FTP的客户端发送PASV命令到FTP服务器。以下介绍一下这两种方式的工作原理：第一种方式：FTP客户端首先和FTP服务器的TCP21端口建立连接，通过这个通道发送命令，客户端需要接收数据的时候在这个通道上发送PORT命令。PORT命令包含了客户端用什么端口接收数据。在传送数据的时候，服务器端通过自己的TCP20端口连接至客户端的指定端口发送数据。FTP服务器必须和客户端建立一个新的连接用来传送数据。第二种方式：在建立控制通道的时候和Standard模式类似，但建立连接后发送的不是Port命令，而是PASV命令。FTP服务器收到PASV命令后，随机打开一个高端端口并且通知客户端在这个端口上传送数据的请求，客户端连接FTP服务器此端口，通过三次握手建立通道，然后FTP服务器将通过这个端口进行数据的传送。很多防火墙在设置的时候都是不允许接受外部发起的连接的，所以许多位于防火墙后或内网的FTP服务器不支持PASV模式，因为客户端无法穿过防火墙打开FTP服务器的高端端口；而许多内网的客户端不能用PORT模式登陆FTP服务器，因为从服务器的TCP20无法和内部网络的客户端建立一个新的连接，造成无法工作。本方法实施例基于加权概率编码的提升FTP传输安全性方法主要包括两种情况：第一种情况：FTP客户端首先根据后续伪代码提供的编码方法计算出原始消息的哈希值，哈希值的字节长度从16-64随机给出。然后FTP客户端和FTP服务器的TCP21端口建立连接，通过这个通道发送命令和原始消息对应的第一哈希值和对应的长度给服务器，然后客户端需要接收数据的时候在这个通道上发送PORT命令。PORT命令包含了客户端用什么端口接收数据。在传送数据的时候，服务器端通过自己的TCP20端口连接至客户端的指定端口发送数据。FTP服务器必须和客户端建立一个新的连接用来传送数据。FTP服务器在新的连接上接收待验证消息后计算该消息的第二哈希值，如果符合第一哈希值等于第二哈希值，则消息在新的连接上传输正确。第二种情况：FTP客户端首先根据后续伪代码提供的编码方法计算出原始消息的哈希值，哈希值的字节长度从16-64随机给出。然后FTP客户端和FTP服务器的TCP21端口建立连接，通过这个通道发送命令和文件对应的第一哈希值和对应的长度给服务器，然后客户端需要接收数据的时候在这个通道上发送PASV命令。FTP服务器收到PASV命令后，随机打开一个高端端口并且通知客户端在这个端口上传送数据的请求，客户端连接FTP服务器此端口，通过三次握手建立通道，然后FTP服务器将通过这个端口进行数据的传送。FTP服务器在这个端口的输出端接收待验证消息后计算该消息的第二哈希值，如果符合第一哈希值等于第二哈希值，则消息在新的连接上传输正确。其中：FTP客户端将原始消息编码成第一哈希值的过程与FTP服务器将当前的待编码消息成第二哈希值的过程相同，以下以将原始消息编码成第一哈希值的过程为例：首先，统计原始消息的概率，计算信息熵和加权系数。在伪代码1中，“←”为左向赋值运算符。c表示二进制序列X中的符号0的个数。首先，考虑到二进制序列X为全0或全1序列，此时需通过伪代码1中的步骤9-15进行约定，避免发生异常。本实施例中p0和r精确到小数点后10位。其次，根据上述实施例的分析，判断是否对原始消息进行填充。当H≥512L时无需填充，当H＜512L时需填充k＝64L-H个字节“FF”或者填充8k个“1”。填充完毕后，再填充8个字节，该字节串是符号0概率p的字节表示。令填充后得到的目标消息的字节序列记为S，S为字节序列S的第i个字节，目标消息的第二二进制序列记为Y，Yj为二进制序列Y的第j个二进制符号，则根据上述式，l＝1，2，...，L，编码Yj时，F，D为编码过程中间变量，初始值为0。Lj，Rj和Hj的定义和初始值由上述的式给出。伪代码2得到的V为输出的第一哈希值，FTP服务器通过先后两个哈希值进行比较，当相同时，则证明端口传输没有出现错误，当不同时，则证明端口传输出现了错误。本发明的一个实施例，提供了一种电子设备；该电子设备可以是任意类型的智能终端，例如手机、平板电脑、个人计算机等。具体地，该电子设备包括：一个或多个控制处理器和存储器，本实例以一个控制处理器为例。控制处理器和存储器可以通过总线或者其他方式连接，本实例以通过总线连接为例。存储器作为一种非暂态计算机可读存储介质，可用于存储非暂态软件程序、非暂态性计算机可执行程序以及模块，控制处理器通过运行存储在存储器中的非暂态软件程序、指令以及模块，从而实现上述方法实施例的基于加权概率编码的提升FTP传输安全性方法。存储器可以包括存储程序区和存储数据区，其中，存储程序区可存储操作系统、至少一个功能所需要的应用程序；此外，存储器可以包括高速随机存取存储器，还可以包括非暂态存储器，例如至少一个磁盘存储器件、闪存器件、或其他非暂态固态存储器件。在一些实施方式中，存储器可选包括相对于控制处理器远程设置的存储器，这些远程存储器可以通过网络连接至该电子设备。上述网络的实例包括但不限于互联网、企业内部网、局域网、移动通信网及其组合。所述一个或者多个模块存储在所述存储器中，当被所述一个或者多个控制处理器执行时，执行上述方法实施例中的基于加权概率编码的提升FTP传输安全性方法。例如，执行以上描述的图1中的方法步骤S100至S800。本发明实施例还提供了一种计算机可读存储介质，所述计算机可读存储介质存储有计算机可执行指令，该计算机可执行指令被一个或多个控制处理器执行，例如，可使得上述一个或多个控制处理器执行上述方法实施例中的基于加权概率编码的提升FTP传输安全性方法。例如，执行以上描述的图1中的方法步骤S100至S800。通过以上的实施方式的描述，本领域技术人员可以清楚地了解到各实施方式可借助软件加通用硬件平台的方式来实现。本领域技术人员可以理解实现上述实施例方法中的全部或部分流程是可以通过计算机程序来指令相关的硬件来完成，所述的程序可存储于一计算机可读取存储介质中，该程序在执行时，可包括如上述方法的实施例的流程。其中，所述的存储介质可为磁碟、光盘、只读存储记忆体或随机存储记忆体等。在本说明书的描述中，参考术语“一个实施例”、“一些实施例”、“示意性实施例”、“示例”、“具体示例”、或“一些示例”等的描述意指结合该实施例或示例描述的具体特征、结构、材料或者特点包含于本发明的至少一个实施例或示例中。在本说明书中，对上述术语的示意性表述不一定指的是相同的实施例或示例。而且，描述的具体特征、结构、材料或者特点可以在任何的一个或多个实施例或示例中以合适的方式结合。尽管已经示出和描述了本发明的实施例，本领域的普通技术人员可以理解：在不脱离本发明的原理和宗旨的情况下可以对这些实施例进行多种变化、修改、替换和变型，本发明的范围由权利要求及其等同物限定。
