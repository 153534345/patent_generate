标题title
通讯接口的数据处理方法、装置、电子设备及存储介质
摘要abst
本发明涉及通讯接口的数据处理方法、装置、电子设备及存储介质，属于嵌入式系统技术领域。该方法包括：利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取数据帧中的应用层数据，其中，不同类型的通讯接口用于将数据帧的帧格式转换为第一数据帧格式；将应用层数据存入第一数据存储区；对第一数据存储区中的应用层数据进行单线程数据解析处理，得到处理后的应用层数据。本发明能够实现对不同类型的通讯接口的数据统一处理，有效减轻MCU处理数据的负担，且嵌入式系统增加通讯接口时无需额外创建数据解析线程，能够提高嵌入式系统的扩展性和通用性。
权利要求书clms
1.一种通讯接口的数据处理方法，其特征在于，所述方法包括：利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取所述数据帧中的应用层数据，其中，所述不同类型的通讯接口用于将数据帧的帧格式转换为所述第一数据帧格式；将所述应用层数据存入第一数据存储区；对所述第一数据存储区中的应用层数据进行单线程数据解析处理，得到处理后的应用层数据。2.根据权利要求1所述的方法，其特征在于，所述将所述应用层数据存入第一数据存储区，包括：响应于所述应用层数据符合设置条件，将所述应用层数据存入第二数据存储区，并重新利用所述不同类型的通讯接口，获取符合所述第一数据帧格式的数据帧，提取所述数据帧中的应用层数据；响应于所述应用层数据不符合所述设置条件，将所述应用层数据存入所述第一数据存储区，其中，所述设置条件为属于大数据类型的应用层数据。3.根据权利要求1所述的方法，其特征在于，所述将所述应用层数据存入第一数据存储区之前，还包括：对所述应用层数据进行循环冗余校验；若所述应用层数据不通过循环冗余校验，则删除所述应用层数据，并重新利用所述不同类型的通讯接口，获取符合所述第一数据帧格式的数据帧，提取所述数据帧中的应用层数据。4.根据权利要求3所述的方法，其特征在于，所述应用层数据包含应用层帧头数据，所述循环冗余校验为CRC8校验，所述对所述应用层数据进行循环冗余校验，包括：若所述应用层帧头数据不通过CRC8校验，则判定所述应用层数据不通过循环冗余校验；若所述应用层帧头数据通过CRC8校验，则判定所述应用层数据通过循环冗余校验。5.根据权利要求4所述的方法，其特征在于，所述应用层数据还包含帧校验字段的值，所述循环冗余校验还包含CRC32校验，所述若所述应用层帧头数据通过CRC8校验，则判定所述应用层数据通过循环冗余校验，包括：若所述应用层帧头数据通过CRC8校验，则基于所述应用层数据中的帧校验字段的值，对所述应用层数据进行CRC32校验；若所述应用层数据中的帧校验字段的值不通过CRC32校验，则判定所述应用层数据不通过循环冗余校验；若所述应用层数据中的帧校验字段的值通过CRC32校验，则判定所述应用层数据通过循环冗余校验。6.根据权利要求1至5中任一项所述的方法，其特征在于，所述第一数据帧格式为包含第一设置长度的帧头数据和第二设置长度的应用层数据的数据帧。7.根据权利要求1至5中任一项所述的方法，其特征在于，所述第一数据存储区中的应用层数据的类型包含控制帧类型、读写帧类型和调试帧类型中的至少一种。8.一种通讯接口的数据处理装置，其特征在于，包括：获取模块，用于利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取所述数据帧中的应用层数据，其中，所述不同类型的通讯接口用于将数据帧的帧格式转换为所述第一数据帧格式；存储模块，用于将所述应用层数据存入第一数据存储区；解析模块，用于对所述第一数据存储区中的应用层数据进行单线程数据解析处理，得到处理后的应用层数据。9.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质中存储有指令，当所述指令在终端设备上运行时，使得所述终端设备执行如权利要求1至7中任一项所述的通讯接口的数据处理方法的步骤。10.一种电子设备，包括存储器、处理器及存储在所述存储器上并在所述处理器上运行的程序，其特征在于，所述处理器执行所述程序时实现如权利要求1至7中任一项所述的通讯接口的数据处理方法的步骤。
说明书desc
技术领域本发明涉及嵌入式系统技术领域，尤其涉及到一种通讯接口的数据处理方法、装置、电子设备及存储介质。背景技术随着21世纪智能时代的到来，嵌入式系统所需的通讯接口也随之增多。不同类型的通讯接口具有不同的通讯方式，比如以太网、串口、RS485以及USB等通讯方式，而这些通讯方式又衍生出相对应的通讯协议，比如以太网使用TCP/IP协议，RS485使用MODBUS，串口使用自定义协议等。相关技术中，通常是对嵌入式系统中的不同类型的通讯接口的数据进行单独处理，例如对不同类型的通讯接口创建不同的线程来进行处理。而大量线程的创建和运行会增加微控制单元处理数据的负担，且会降低嵌入式系统的扩展性和通用性。发明内容为了解决现有的通讯接口的数据处理方法会增加MCU处理数据的负担，且会降低嵌入式系统的扩展性和通用性的缺陷，本发明提供了一种通讯接口的数据处理方法、装置、电子设备及存储介质。第一方面，为了解决上述技术问题，本发明提供了一种通讯接口的数据处理方法，该方法包括：利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取数据帧中的应用层数据，其中，不同类型的通讯接口用于将数据帧的帧格式转换为第一数据帧格式；将应用层数据存入第一数据存储区；对第一数据存储区中的应用层数据进行单线程数据解析处理，得到处理后的应用层数据。本发明的有益效果是：通过统一通讯接口的帧格式，从而统一数据帧中的应用层数据的解析方式，并建立单个线程对存入同一数据存储区中的应用层数据执行解析操作，能够实现对不同类型的通讯接口的数据统一处理，有效减轻MCU处理数据的负担，且嵌入式系统增加通讯接口时无需额外创建数据解析线程，能够提高嵌入式系统的扩展性和通用性。进一步，将应用层数据存入第一数据存储区，包括：响应于应用层数据符合设置条件，将应用层数据存入第二数据存储区，并重新利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取数据帧中的应用层数据；响应于应用层数据不符合设置条件，将应用层数据存入第一数据存储区，其中，设置条件为属于大数据类型的应用层数据。采用上述改进方案的有益效果是：将不需要进行解析处理的大数据放入独立的数据缓存区，以使上述的数据处理方法能够适用于对大数据等多种通讯接口数据的处理，进一步提高嵌入式系统的扩展性和通用性。进一步，将应用层数据存入第一数据存储区之前，还包括：对应用层数据进行循环冗余校验；若应用层数据不通过循环冗余校验，则删除应用层数据，并重新利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取数据帧中的应用层数据。采用上述改进方案的有益效果是：实现对应用层帧头数据的错误检测，保证应用层数据的正确性。进一步，应用层数据包含应用层帧头数据，循环冗余校验为CRC8校验，对应用层数据进行循环冗余校验，包括：若应用层帧头数据不通过CRC8校验，则判定应用层数据不通过循环冗余校验；若应用层帧头数据通过CRC8校验，则判定应用层数据通过循环冗余校验。采用上述改进方案的有益效果是：对应用层帧头数据进行CRC8校验，从而提高对应用层数据的检错效率。进一步，应用层数据还包含帧校验字段的值，循环冗余校验还包含CRC32校验，若应用层帧头数据通过CRC8校验，则判定应用层数据通过循环冗余校验，包括：若应用层帧头数据通过CRC8校验，则基于应用层数据中的帧校验字段的值，对应用层数据进行CRC32校验；若应用层数据中的帧校验字段的值不通过CRC32校验，则判定应用层数据不通过循环冗余校验；若应用层数据中的帧校验字段的值通过CRC32校验，则判定应用层数据通过循环冗余校验。采用上述改进方案的有益效果是：采用双重校验的方式，进一步提高对应用层数据的检错能力。进一步，第一数据帧格式为包含第一设置长度的帧头数据和第二设置长度的应用层数据的数据帧。采用上述改进方案的有益效果是：将不同类型的通讯接口的数据帧，转换为具有固定长度范围和固定数据内容的数据帧，从而实现通讯接口的物理层传输方式和物理层协议的统一，为不同类型的通讯接口的数据统一处理提供实现基础。进一步，第一数据存储区中的应用层数据的类型包含控制帧类型、读写帧类型和调试帧类型中的至少一种。采用上述改进方案的有益效果是：进一步提高上述通讯接口的数据处理方法的应用范围。第二方面，本发明提供了一种通讯接口的数据处理装置，包括：获取模块，用于利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取数据帧中的应用层数据，其中，不同类型的通讯接口用于将数据帧的帧格式转换为第一数据帧格式；存储模块，用于将应用层数据存入第一数据存储区；解析模块，用于对第一数据存储区中的应用层数据进行单线程数据解析处理，得到处理后的应用层数据。第三方面，本发明提供了一种计算机可读存储介质，该计算机可读存储介质中存储有指令，当指令在终端设备上运行时，使得终端设备执行如第一方面所述的通讯接口的数据处理方法的全部或部分步骤。第四方面，本发明提供了一种电子设备，包括存储器、处理器及存储在存储器上并在处理器上运行的程序，处理器执行程序时实现如第一方面所述的通讯接口的数据处理方法的全部或部分步骤。附图说明图1为本发明实施例提供的一种通讯接口的数据处理方法的流程示意图；图2为本发明实施例提供的一种通讯接口的数据处理装置的结构示意图；图3为本发明实施例提供的一种电子设备的结构示意图。具体实施方式下列实施例是对本发明的进一步解释和补充，对本发明不构成任何限制。以下结合附图描述本发明实施例的一种通讯接口的数据处理方法。参照图1所示，本发明提供了一种通讯接口的数据处理方法，包括如下步骤S1至步骤S3。在步骤S1中，利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取数据帧中的应用层数据，其中，不同类型的通讯接口用于将数据帧的帧格式转换为第一数据帧格式。可以理解的是，不同类型的通讯接口指使用不同的通讯方式或不同通讯协议的通讯接口，应用层数据指网络层中用于数据传输的数据包。在该实施例中，各个通讯接口对传输的数据添加相同结构的数据帧头，构成具有固定数据内容的数据帧，即将数据帧的帧格式转换为第一数据帧格式，从而统一各个通讯接口的帧格式，实现对各个数据帧中的应用层数据的解析方式的统一，为不同类型的通讯接口的数据统一处理提供实现基础。可选的，第一数据帧格式为包含第一设置长度的帧头数据和第二设置长度的应用层数据的数据帧。示例性地，第一数据帧格式中的第一设置长度为6Byte的固定长度值，第二设置长度为8Byte至16384Byte的长度范围中的任一个长度值，以使所构成的数据帧具有固定的长度范围，且数据帧包含数据内容固定的帧头数据和应用层数据，以使数据帧具有固定的数据内容。帧头数据的数据内容可以设为帧头标志，该帧头标志可以采用连续的6个0xEB表示，用于代表数据帧的起始；应用层数据的数据内容可以由帧类型、接收节点、发送节点、帧长度和负载构成。可以理解的是，第一数据帧格式可以根据实际需要自由设置，如帧头数据采用小端模式，其数据内容可以由帧头标志和帧控制字构成，此时帧头数据的第一设置长度对应设为8Byte的固定长度值。在步骤S2中，将应用层数据存入第一数据存储区。在该实施例中，将统一了格式的应用层数据存入一个数据存储区，即第一数据存储区，以便后续统一进行解析处理。其中，第一数据存储区可以指存储器中设置的缓存区。可选的，在一个实施例中，将应用层数据存入第一数据存储区的实现过程包括：响应于应用层数据符合设置条件，将应用层数据存入第二数据存储区，并重新利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取数据帧中的应用层数据；响应于应用层数据不符合设置条件，将应用层数据存入第一数据存储区，其中，设置条件为属于大数据类型的应用层数据。在该实施例中，大数据类型的应用层数据包括通过云服务器下发的控制指令、打印数据和模切数据等，其不需要进行解析即可进行应用，使得嵌入式系统能够通过云平台监控设备并实现打印、模切等功能。其中，第二数据存储区可以是设置的内存区，如同步动态随机存取内存。可选的，第一数据存储区中的应用层数据的类型包含控制帧类型、读写帧类型和调试帧类型中的至少一种。可以理解的是，控制帧类型、读写帧类型和调试帧类型等类型的应用层数据需要解析后，才能够进行后续应用。可选的，在一个实施例中，将应用层数据存入第一数据存储区之前，还包括：对应用层数据进行循环冗余校验；若应用层数据不通过循环冗余校验，则删除应用层数据，并重新利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取数据帧中的应用层数据。在该实施例中，基于应用层数据中的校验码所对应的计算方式，对应用层数据进行计算以得到计算结果，该计算结果和应用层数据中的校验码能够分别表征处于接收方的应用层数据和处于发送方的应用层数据，因此通过将该计算结果与应用层数据中的校验码进行比较，从而能够对应用层数据实现错误检查。若应用层数据不通过循环冗余校验，如接收到的应用层数据存在因干扰等原因导致其中的某一位或某些位发生错误的情况，则应将该错误的应用层数据删除，若应用层数据通过循环冗余校验，则判定应用层数据无错误，将该应用层数据存入第一数据存储区以进行解析。可选的，应用层数据包含应用层帧头数据，循环冗余校验为CRC8校验，对应用层数据进行循环冗余校验的实现过程包括：若应用层帧头数据不通过CRC8校验，则判定应用层数据不通过循环冗余校验；若应用层帧头数据通过CRC8校验，则判定应用层数据通过循环冗余校验。可选的，应用层数据还包含帧校验字段的值，循环冗余校验还包含CRC32校验，若应用层帧头数据通过CRC8校验，则判定应用层数据通过循环冗余校验的实现过程包括：若应用层帧头数据通过CRC8校验，则基于应用层数据中的帧校验字段的值，对应用层数据进行CRC32校验；若应用层数据中的帧校验字段的值不通过CRC32校验，则判定应用层数据不通过循环冗余校验；若应用层数据中的帧校验字段的值通过CRC32校验，则判定应用层数据通过循环冗余校验。作为一种可能的实施方式，应用层数据具有如下格式：其中，表中的N表示不小于零的整数，帧类型字段用于表示数据帧发送的内容，帧类型字段可以包括大数据类型、控制帧类型、读写帧类型或调试帧类型等字段值。帧长度字段用于表示帧类型、接收节点、发送节点、帧长度、会话计数、应用层帧头校验、负载等字段的总字节数。负载为应用层数据中的有效数据，本实施例对负载的长度不做限制，即对应用层数据的帧长度不做限制，可以由嵌入式系统涉及的设备和业务类型进行灵活设置其长度范围，如设置帧长度不超过2044字节。会话计数字段用于发起方识别会话。帧头校验字段的值通过对应用层帧头数据基于CRC8算法进行计算得到。其中，CRC8算法中的多项式采用0x07，初始值采用0x00，结果异或值采用0x00，输入、输出的二进制数据均不进行反转。帧校验字段的值通过对应用层数据中的帧类型、接收节点、发送节点、帧长度、会话计数、帧头校验和负载等字段的值，基于CRC32算法进行计算得到。其中，CRC32算法中的多项式采用0x04C11DB7，初始值和结果异或均采用0xFFFFFFFF，输入、输出的二进制数据均进行反转。在步骤S3中，对第一数据存储区中的应用层数据进行单线程数据解析处理，得到处理后的应用层数据。示例性地，对于Cortex-M7内核MCU+32M SDRAM+16M Flash硬件实现的嵌入式系统，为其设置USB、以太网和4G3种通讯接口，以使嵌入式系统能够与PC、手机APP、云平台等进行通信以对设备进行控制和监测。在MCU中对上述3种通讯接口设置统一的数据接收线程，利用该数据接收线程实时检测3种通讯接口的数据帧的帧头数据，当收到具有设置的帧头标志的帧头数据时，即认为该数据帧满足第一数据帧格式，数据接收线程执行上述实施例所述的通讯接口的数据处理方法的部分步骤以将数据帧中的应用层数据存入第一数据存储区；再由数据解析线程对第一数据存储区中的应用层数据进行解析处理，得到处理后的应用层数据；该处理后的应用层数据可由数据发送线程重新构建数据帧进行数据发送。上述的嵌入式系统能够基于数据接收、数据解析和数据发送三个单独的进程实现不同通讯接口之间的数据通讯，从而能够减少并优化代码，降低系统资源，进一步提高其通用性和扩展性。在上述各实施例中，虽然对步骤进行了编号，如S1、S2等，但只是本申请给出的具体实施例，本领域的技术人员可根据实际情况调整S1、S2等的执行顺序，此也在本发明的保护范围内，可以理解，在一些实施例中，可以包含如上述各实施方式中的部分或全部。如图2所示，本发明实施例提供的一种通讯接口的数据处理装置10，包括：获取模块20，用于利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取数据帧中的应用层数据，其中，不同类型的通讯接口用于将数据帧的帧格式转换为第一数据帧格式；存储模块30，用于将应用层数据存入第一数据存储区；解析模块40，用于对第一数据存储区中的应用层数据进行单线程数据解析处理，得到处理后的应用层数据。可选的，存储模块30，具体用于响应于应用层数据符合设置条件，将应用层数据存入第二数据存储区，并重新利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取数据帧中的应用层数据；响应于应用层数据不符合设置条件，将应用层数据存入第一数据存储区，其中，设置条件为属于大数据类型的应用层数据。可选的，存储模块30，还用于对应用层数据进行循环冗余校验；若应用层数据不通过循环冗余校验，则删除应用层数据，并调用获取模块20重新利用不同类型的通讯接口，获取符合第一数据帧格式的数据帧，提取数据帧中的应用层数据。可选的，应用层数据包含应用层帧头数据，循环冗余校验为CRC8校验；存储模块30，还用于若应用层帧头数据不通过CRC8校验，则判定应用层数据不通过循环冗余校验；若应用层帧头数据通过CRC8校验，则判定应用层数据通过循环冗余校验。可选的，应用层数据还包含帧校验字段的值，循环冗余校验还包含CRC32校验；存储模块30，还用于若应用层帧头数据通过CRC8校验，则基于应用层数据中的帧校验字段的值，对应用层数据进行CRC32校验；若应用层数据中的帧校验字段的值不通过CRC32校验，则判定应用层数据不通过循环冗余校验；若应用层数据中的帧校验字段的值通过CRC32校验，则判定应用层数据通过循环冗余校验。可选的，第一数据帧格式为包含第一设置长度的帧头数据和第二设置长度的应用层数据的数据帧。可选的，第一数据存储区中的应用层数据的类型包含控制帧类型、读写帧类型和调试帧类型中的至少一种。本发明实施例提供的一种计算机可读存储介质，该计算机可读存储介质中存储有指令，当指令在终端设备上运行时，使得终端设备执行上述任一实施例的通讯接口的数据处理方法的步骤。如图3所示，本发明实施例提供的一种电子设备500，包括存储器510、处理器520及存储在存储器510上并在处理器520上运行的程序530，处理器520执行程序530时实现上述任一实施例的通讯接口的数据处理方法的步骤。其中，电子设备500可以选用电脑、手机等，相对应地，其程序530为电脑软件或手机App等，且上述关于本发明的一种电子设备500中的各参数和步骤，可参考上文中通讯接口的数据处理方法的实施例中的各参数和步骤，在此不做赘述。所属技术领域的技术人员知道，本发明可以实现为系统、方法或计算机程序产品。因此，本公开可以具体实现为以下形式，即：可以是完全的硬件、也可以是完全的软件，还可以是硬件和软件结合的形式，本文一般称为“电路”、“模块”或“系统”。此外，在一些实施例中，本发明还可以实现为在一个或多个计算机可读介质中的计算机程序产品的形式，该计算机可读介质中包含计算机可读的程序代码。在本说明书的描述中，参考术语“一个实施例”、“一些实施例”、“示例”、“具体示例”、或“一些示例”等的描述意指结合该实施例或示例描述的具体特征、结构、材料或者特点包含于本发明的至少一个实施例或示例中。在本说明书中，对上述术语的示意性表述不必须针对的是相同的实施例或示例。而且，描述的具体特征、结构、材料或者特点可以在任一个或多个实施例或示例中以合适的方式结合。此外，在不相互矛盾的情况下，本领域的技术人员可以将本说明书中描述的不同实施例或示例以及不同实施例或示例的特征进行结合和组合。尽管上面已经示出和描述了本发明的实施例，可以理解的是，上述实施例是示例性的，不能理解为对本发明的限制，本领域的普通技术人员在本发明的范围内可以对上述实施例进行变化、修改、替换和变型。
