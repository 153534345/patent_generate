标题title
一种基于小程序平台实现WebRTC功能的系统
摘要abst
本发明涉及WebRTC网页即时通信技术领域，具体公开了一种基于小程序平台实现WebRTC功能的系统，包括：小程序代码层、小程序基础库以及小程序移动端SDK，所述小程序基础库包括小程序基础库逻辑层和小程序基础库视图层。本发明提供的基于小程序平台实现WebRTC功能的系统，基于WebRTCAPI标准，提供了能直接运行WebRTC代码的小程序环境，提供了WebRTC中的Media API和RTCPeerConnection两个标准接口，从而实现小程序平台直接运行标准WebRTC的代码，支持点对点通讯，实现音视频通讯功能。
权利要求书clms
1.一种基于小程序平台实现WebRTC功能的系统，其特征在于，包括：小程序代码层、小程序基础库以及小程序移动端SDK，所述小程序基础库包括小程序基础库逻辑层和小程序基础库视图层；所述小程序代码层，用于存储用户输入的WebRTC代码；所述小程序基础库逻辑层，用于当接收到用户输入的WebRTC功能调用请求时，从所述小程序代码层调用所述WebRTC代码，并将用户输入的WebRTC功能相关参数、服务器地址以及所述WebRTC代码调用方法名包装成一WebRTC功能调用数据块，并将所述WebRTC功能调用数据块发送到所述小程序移动端SDK；所述小程序移动端SDK，用于当接收到所述WebRTC功能调用数据块时，生成一个WebRTC功能连接；及根据所述WebRTC功能调用数据块中所述WebRTC代码调用方法名执行对应的接口逻辑，并传入所述WebRTC功能相关参数以及服务器地址，创建WebRTC功能，然后与所述WebRTC功能连接建立起绑定关系；以及返回流媒体数据和流媒体ID到所述小程序基础库逻辑层；所述小程序基础库逻辑层，用于将所述流媒体数据和流媒体ID返回至所述小程序代码层；所述小程序代码层，用于获取到所述流媒体ID，并将所述流媒体ID发送至所述小程序基础库视图层；所述小程序基础库视图层，用于根据所述流媒体ID创建一个视频和音频小程序组件，并将所述视频和音频小程序组件和流媒体ID传入到所述小程序移动端SDK；所述小程序移动端SDK，用于接收到所述小程序代码层发送的组件渲染请求时，根据所述流媒体ID在所述小程序代码层上渲染并展示所述视频和音频小程序组件，并播放相应的流媒体数据，到此所述小程序代码层实现音视频展示。2.如权利要求1所述的基于小程序平台实现WebRTC功能的系统，其特征在于，所述WebRTC代码包括RTCPeerConnection和MediaDevices接口的相关方法。3.如权利要求1所述的基于小程序平台实现WebRTC功能的系统，其特征在于，所述小程序基础库中植入了RTCPeerConnection和MediaDevices两个API接口。4.如权利要求1所述的基于小程序平台实现WebRTC功能的系统，其特征在于，所述WebRTC功能相关参数包括服务器账户密码和是否开启音视频。5.如权利要求1所述的基于小程序平台实现WebRTC功能的系统，其特征在于，所述小程序基础库逻辑层包括JSBridge模块，所述小程序基础库逻辑层和所述小程序移动端SDK之间通过所述JSBridge模块传递信息。6.如权利要求1所述的基于小程序平台实现WebRTC功能的系统，其特征在于，所述流媒体数据包括视频流和音频流。
说明书desc
技术领域本发明涉及WebRTC网页即时通信技术领域，更具体地，涉及一种基于小程序平台实现WebRTC功能的系统。背景技术WebRTC，名称源自网页即时通信的缩写，是一个支持网页浏览器进行实时语音对话或视频对话的接口。底层基于SRTP和UDP，弱网情况优化空间大，其中包含视频音频采集，编解码，数据传输，音视频展示等功能，可以实现点对点通信，通信双方延时低，通过相关技术可以快速地构建出一个音视频通讯应用。在web中，现有技术方案是基于Media API、RTCPeerConnection、Peer-to-peer Data API三类WebRTC标准API，使开发者能够容易地开发出类似于网络视频聊天的网页应用。现有技术方案是手机客户端通过生成Webview，使用常规的网页加载方式来渲染页面，在页面上使用WebRTC来建立通信，从而连接到远端的客户端。当前现有技术采用webview受限于手机系统版本，在iOS端需要较高版本才可以支持，在安卓端由于碎片化严重，有较多的碎片化问题。在小程序平台上，并不能直接使用WebRTC标准的接口，实现音视频应用会受到一定的限制，且网页上的WebRTC代码也无法在小程序中运行。发明内容针对现有技术中存在的上述弊端，本发明提供了一种基于小程序平台实现WebRTC功能的系统，以解决现有技术中存在的在小程序平台上，并不能直接使用WebRTC标准的接口，实现音视频应用会受到一定的限制，且网页上的WebRTC代码也无法在小程序中运行的问题。作为本发明的第一个方面，提供一种基于小程序平台实现WebRTC功能的系统，包括：小程序代码层、小程序基础库以及小程序移动端SDK，所述小程序基础库包括小程序基础库逻辑层和小程序基础库视图层；所述小程序代码层，用于存储用户输入的WebRTC代码；所述小程序基础库逻辑层，用于当接收到用户输入的WebRTC功能调用请求时，从所述小程序代码层调用所述WebRTC代码，并将用户输入的WebRTC功能相关参数、服务器地址以及所述WebRTC代码调用方法名包装成一WebRTC功能调用数据块，并将所述WebRTC功能调用数据块发送到所述小程序移动端SDK；所述小程序移动端SDK，用于当接收到所述WebRTC功能调用数据块时，生成一个WebRTC功能连接；及根据所述WebRTC功能调用数据块中所述WebRTC代码调用方法名执行对应的接口逻辑，并传入所述WebRTC功能相关参数以及服务器地址，创建WebRTC功能，然后与所述WebRTC功能连接建立起绑定关系；以及返回流媒体数据和流媒体ID到所述小程序基础库逻辑层；所述小程序基础库逻辑层，用于将所述流媒体数据和流媒体ID返回至所述小程序代码层；所述小程序代码层，用于获取到所述流媒体ID，并将所述流媒体ID发送至所述小程序基础库视图层；所述小程序基础库视图层，用于根据所述流媒体ID创建一个视频和音频小程序组件，并将所述视频和音频小程序组件和流媒体ID传入到所述小程序移动端SDK；所述小程序移动端SDK，用于接收到所述小程序代码层发送的组件渲染请求时，根据所述流媒体ID在所述小程序代码层上渲染并展示所述视频和音频小程序组件，并播放相应的流媒体数据，到此所述小程序代码层实现音视频展示。进一步地，所述WebRTC代码包括RTCPeerConnection和MediaDevices接口的相关方法。进一步地，所述小程序基础库中植入了RTCPeerConnection和MediaDevices两个API接口。进一步地，所述WebRTC功能相关参数包括服务器账户密码和是否开启音视频。进一步地，所述小程序基础库逻辑层包括JSBridge模块，所述小程序基础库逻辑层和所述小程序移动端SDK之间通过所述JSBridge模块传递信息。进一步地，所述流媒体数据包括视频流和音频流。本发明提供的基于小程序平台实现WebRTC功能的系统具有以下优点：基于WebRTCAPI标准，提供了能直接运行WebRTC代码的小程序环境，提供了WebRTC中的Media API和RTCPeerConnection两个标准接口，从而实现小程序平台直接运行标准WebRTC的代码，支持点对点通讯，实现音视频通讯功能。附图说明附图是用来提供对本发明的进一步理解，并且构成说明书的一部分，与下面的具体实施方式一起用于解释本发明，但并不构成对本发明的限制。图1为本发明提供的基于小程序平台实现WebRTC功能的系统的结构示意图。具体实施方式为更进一步阐述本发明为达成预定发明目的所采取的技术手段及功效,以下结合附图及较佳实施例，对依据本发明提出的基于小程序平台实现WebRTC功能的系统其具体实施方式、结构、特征及其功效，详细说明如后。显然，所描述的实施例为本发明的一部分实施例，而不是全部的实施例。基于本发明的实施例，本领域普通技术人员在没有作出创造性劳动前提下所获得的所有其他实施例，都属于本发明的保护范围。需要说明的是，本发明的说明书和权利要求书及上述附图中的术语“第一”、“第二”等是用于区别类似的对象，而不必用于描述特定的顺序或先后次序。应该理解这样使用的数据在适当情况下可以互换，以便这里描述的本发明的实施例。此外，术语“包括”和“具有”以及他们的任何变形，意图在于覆盖不排他的包括，例如，包含了一系列步骤或单元的过程、方法、系统、产品或设备不必限于清楚地列出的那些步骤或单元，而是可包括没有清楚地列出的或对于这些过程、方法、产品或设备固有的其它步骤或单元。在本发明的解释中，需要说明的是，术语“安装”、“相连”、“连接”应做广义理解，除非是特殊标明。例如，连接可以是固定连接，也可以是通过特殊的接口连接，也可以是中间媒介间接相连。对于本领域的普通技术人员而言，可以具体情况理解上述术语在本发明中的具体含义。在本实施例中提供了一种基于小程序平台实现WebRTC功能的系统，图1为本发明提供的基于小程序平台实现WebRTC功能的系统的结构示意图，如图1所示，所述基于小程序平台实现WebRTC功能的系统，包括：小程序代码层、小程序基础库以及小程序移动端SDK，所述小程序基础库包括小程序基础库逻辑层和小程序基础库视图层；所述小程序代码层，用于存储用户输入的WebRTC代码；所述小程序基础库逻辑层，用于当接收到用户输入的WebRTC功能调用请求时，从所述小程序代码层调用所述WebRTC代码，并将用户输入的WebRTC功能相关参数、服务器地址以及所述WebRTC代码调用方法名包装成一WebRTC功能调用数据块，并将所述WebRTC功能调用数据块发送到所述小程序移动端SDK；所述小程序移动端SDK，用于当接收到所述WebRTC功能调用数据块时，生成一个WebRTC功能连接；及根据所述WebRTC功能调用数据块中所述WebRTC代码调用方法名执行对应的接口逻辑，并传入所述WebRTC功能相关参数以及服务器地址，创建WebRTC功能，然后与所述WebRTC功能连接建立起绑定关系；以及返回流媒体数据和流媒体ID到所述小程序基础库逻辑层；需要说明的是，小程序移动端SDK是运行在APP的小程序环境，基于GoogleWebRTC标准库，实现Media API和RTCPeerConnection等标准WebRTC接口。所述小程序基础库逻辑层，用于将所述流媒体数据和流媒体ID返回至所述小程序代码层；所述小程序代码层，用于获取到所述流媒体ID，并将所述流媒体ID发送至所述小程序基础库视图层；所述小程序基础库视图层，用于根据所述流媒体ID创建一个视频和音频小程序组件，并将所述视频和音频小程序组件和流媒体ID传入到所述小程序移动端SDK；所述小程序移动端SDK，用于接收到所述小程序代码层发送的组件渲染请求时，根据所述流媒体ID在所述小程序代码层上渲染并展示所述视频和音频小程序组件，并播放相应的流媒体数据，到此所述小程序代码层实现音视频展示。优选地，所述WebRTC代码包括RTCPeerConnection和MediaDevices接口的相关方法。优选地，所述小程序基础库中植入了RTCPeerConnection和MediaDevices两个API接口。小程序基础库是小程序代码的运行环境，所有WebRTC代码均运行在这个环境中，基于该运行环境，在全局植入了RTCPeerConnection和MediaDevices两个API。需要说明的是，一个RTCPeerConnection对象允许用户在两个浏览器之间直接通讯。优选地，所述WebRTC功能相关参数包括服务器账户密码和是否开启音视频。优选地，所述小程序基础库逻辑层包括JSBridge模块，所述小程序基础库逻辑层和所述小程序移动端SDK之间通过所述JSBridge模块传递信息。应当理解的是，JSBridge模块为所述小程序移动端SDK与小程序基础库之间的通讯模块。优选地，所述流媒体数据包括视频流和音频流。具体地，小程序代码层：表示用户的小程序代码；小程序基础库视图层：管理视图组件的模块，负责视图组件的生成、更新和销毁；小程序基础库逻辑层：用于维护WebRTC实例的状态、数据等，处理接口的调用和转发；小程序移动端SDK：负责WebRTC实例的生成，处理基础库发送的事件，维护连接逻辑。本发明提供的基于小程序平台实现WebRTC功能的系统，基于WebRTC API标准，提供了能直接运行WebRTC代码的小程序环境，提供了WebRTC中的Media API和RTCPeerConnection两个标准接口，使用小程序移动端SDK在APP端实现webRTC通信，从而实现小程序平台直接运行标准WebRTC的代码，支持点对点通讯，实现音视频通讯功能。以上所述，仅是本发明的较佳实施例而已，并非对本发明作任何形式上的限制，虽然本发明已以较佳实施例揭露如上，然而并非用以限定本发明,任何熟悉本专业的技术人员，在不脱离本发明技术方案范围内,当可利用上述揭示的技术内容做出些许更动或修饰为等同变化的等效实施例，但凡是未脱离本发明技术方案的内容，依据本发明的技术实质对以上实施例所作的任何简单修改、等同变化与修饰，均仍属于本发明技术方案的范围内。
