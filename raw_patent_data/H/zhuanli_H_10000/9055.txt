标题title
一种读出电子学数据处理方法及系统
摘要abst
本申请公开一种读出电子学数据处理方法及系统，所述系统包括多个数据采集设备、至少一级数据读出汇总终端以及远端服务器。每级数据读出汇总终端包括至少一个数据读出汇总终端，下一级数据读出汇总终端与上一级数据读出汇总终端连接。最低级数据读出汇总终端可汇总数据采集设备采集的电子学数据，并将汇总后得到的汇总帧转发给下一级数据读出汇总终端，以此类推，最高级数据读出汇总终端得到最终的电子学汇总帧，再通过以太网的方式发送至远端服务器。这样无需依靠上位机也能够实现数据的转发，从而提高数据传输效率。另外，每个数据读出汇总终端可包括多个电子学汇总板，每个电子会汇总板具有数据实时备份功能，可避免电子学数据丢失。
权利要求书clms
1.一种读出电子学数据处理系统，其特征在于，所述方法应用于读出电子学数据处理系统，所述系统包括多个数据采集设备、N级数据读出汇总终端以及远端服务器，其中，每级数据读出汇总终端包括至少一个数据读出汇总终端，所述N级数据读出汇总终端中的第j级数据读出汇总终端与第j-1级数据读出汇总终端连接，每个数据读出汇总终端与至少一个所述数据采集设备连接，所述N级数据读出汇总终端中的最高级数据读出汇总终端通过以太网与所述远端服务器连接,，所述N为大于或等于1的整数，所述j为大于或等于1的整数；其中，所述数据采集设备用于采集粒子实验的实验数据并处理，获得电子学数据，并输出给与所述数据采集设备连接的第一级数据读出汇总终端；所述第j级数据读出汇总设备接收所述第j-1级数据读出汇总终端中各个数据读出汇总终端设备分别发送的第j-1级汇总帧；所述第j级数据读出汇总设备根据所接收的多个所述第j-1级汇总帧，生成第j级汇总帧，并将所述第j级汇总帧输出给第j+1级数据读出汇总终端，使得最高级数据读出汇总终端设备生成最高级汇总帧；所述最高级数据读出汇总终端通过以太网方式将所述最高级汇总帧发送给所述远端服务器。2.如权利要求1所述的系统，其特征在于，每个所述数据读出汇总终端包括M级电子学汇总板，其中，每级电子学汇总板包括至少一个电子学汇总板，所述M为大于或等于2的整数，其中，所述M级电子学汇总板中的第i级电子学汇总板与第i-1级电子学汇总板连接，所述数据读出汇总板具体用于：通过所述第i-1级电子学汇总板中的每个电子学汇总板将所接收的数据帧生成第i-1级汇总帧，并输出给所述第i级电子学汇总板；通过所述第i级电子学汇总板根据所接收的多个第i-1级汇总帧生成第i级汇总帧。3.如权利要求1或2所述的系统，其特征在于，所述系统还包括与每个所述电子学汇总板连接的存储设备，所述数据读出汇总终端还用于：在每个所述电子学汇总板汇总所接收的数据帧，并输出汇总后的汇总帧的同时，以并行的方式通过SATA协议，将所述汇总帧备份到所述存储设备；在部分实验数据丢失的情况下，则基于SATA协议，从所述存储设备读出所丢弃的汇总帧或电子学数据。4.如权利要求2所述的系统，其特征在于，所述数据读出汇总终端以及所述电子学汇总板为可编程逻辑器件。5.如权利要求2所述的系统，其特征在于，所述数据读出汇总终端具体用于：判断所输入的数据帧的帧头类型，所述帧头类型指示所述数据帧为电子学数据帧或汇总帧；根据所述帧头类型提取所输入的所述数据帧的信息，并将所述数据帧存储到先进先出FIFO中；以时分复用方式从所述FIFO中获取多个所述数据帧，并根据多个所述数据帧的帧头信息、帧长信息、以及帧级数生成完整的汇总帧，且所述完整的汇总帧的级数为所述多个数据帧的帧级数加1。6.如权利要求4所述的系统，其特征在于，所述数据读出汇总终端还用于：为所包括的各个电子学汇总板分别设置标识ID，所述ID为所述电子学汇总板的设备编号；其中，所述数据读出汇总终端在生成汇总帧时，将所述ID添加到所述电子学汇总板的汇总帧的ID字段。7.如权利要求5所述的系统，其特征在于，所述数据读出汇总终端还用于：根据帧长确定是否接收完整帧数据；根据所接收的整帧数据所包括的帧级数字段确定所述整帧数据的帧级数；根据帧级数以及与所述帧级数对应的帧长从所述整帧数据中获取原始电子学数据。8.一种读出电子学数据处理方法，其特征在于，所述方法应用于读出电子学数据处理系统，所述系统包括多个数据采集设备、N级数据读出汇总终端以及远端服务器，每级数据读出汇总终端包括至少一个数据读出汇总终端，所述N级数据读出汇总终端中的第j级数据读出汇总终端与第j-1级数据读出汇总终端连接，每个数据读出汇总设备与至少一个所述数据采集设备连接，所述N级数据读出汇总终端中的最高级数据读出汇总终端通过以太网与所述远端服务器连接,，所述N为大于或等于1的整数，所述j为大于或等于1的整数；所述方法包括：所述第j级数据读出汇总设备接收所述第j-1级数据读出汇总终端中各个数据读出汇总终端设备分别发送的第j-1级汇总帧；所述第j级数据读出汇总设备根据所接收的多个所述第j-1级汇总帧，生成第j级汇总帧，并将所述第j级汇总帧输出给第j+1级数据读出汇总终端，使得最高级数据读出汇总终端设备生成最高级汇总帧；所述最高级数据读出汇总终端设备将所述最高级汇总帧通过以太网发送至所述远端服务器。9.如权利要求7所述的方法，其特征在于，每个所述数据读出汇总终端包括M个一级电子学汇总板和一个二级电子学汇总板，所述系统还包括与每个所述电子学汇总板连接的存储设备，所述方法还包括：每级所述数据读出汇总终端通过每个所述电子学汇总板将所生成的汇总帧或电子学数据存储到所连接的所述存储设备，以通过所述存储设备对所述汇总帧或所述电子学数据进行备份。10.一种读出电子学数据处理装置，其特征在于，包括处理器，所述处理器与存储器相连，所述存储器用于存储计算机程序，所述处理器用于执行所述存储器中存储的所述计算机程序，使得所述装置实现如权利要求7或8所述的方法。
说明书desc
技术领域本申请涉及读出电子学技术领域，尤其涉及一种读出电子学数据处理方法及系统。背景技术粒子物理实验规模越来越大，测量精度要求越来越高，需要进行更大通量数据的读出。相应的，对读出电子学系统的要求也越来越高，例如要求读出电子学系统具有数据带宽高、通道数多等特性。因此，提出FELIX系统。然而虽然FELIX系统具有高带宽、多通道数等特点，但是需要上位机转发并处理数据。且还存在着由于停电或者设备故障等意外情况导致实验数据在读出传输过程中丢失的问题。发明内容本申请提供一种读出电子学数据处理方法及系统，无需依靠上位机也能够实现数据的转发，从而提高数据传输效率。第一方面，提供一种读出电子学数据处理方法，该方法应用于读出电子学数据处理系统，所述系统包括多个数据采集设备、N级数据读出汇总终端以及远端服务器。其中，每级数据读出汇总终端包括至少一个数据读出汇总终端。N级数据读出汇总终端中的第j级数据读出汇总终端与第j-1级数据读出汇总终端连接。每个数据读出汇总设备与至少一个数据采集设备连接。N级数据读出汇总终端中的最高级数据读出汇总终端通过以太网与远端服务器连接。N为大于或等于1的整数，j为大于或等于1的整数。所述方法包括：数据采集设备用于采集粒子实验的实验数据并处理，获得电子学数据，并输出给与所述数据采集设备连接的第一级数据读出汇总终端；第j级数据读出汇总设备接收第j-1级数据读出汇总终端中各个数据读出汇总终端设备分别发送的第j-1级汇总帧；第j级数据读出汇总设备根据所接收的多个所述第j-1级汇总帧，生成第j级汇总帧，并将第j级汇总帧输出给第j+1级数据读出汇总终端，使得最高级数据读出汇总终端设备生成最高级汇总帧；最高级数据读出汇总终端通过以太网方式将最高级汇总帧发送给所述远端服务器。该方案可应用于粒子实验，数据采集设备可理解为是前端电子学。数据读出汇总终端可以理解为是处理前端电子学输出的电子学数据的设备。数据读出汇总终端可对所接收的数据进行汇总。在本申请实施例中，处理电子学数据的系统可包括多级数据读出汇总终端，下一级数据读出汇总终端可以对上一级数据读出汇总终端输出的数据帧进行汇总，从而最高级数据读出汇总终端可以获得最终级汇总帧。再将最高级汇总帧发送通过以太网将汇总之后的汇总帧发送给远端服务器。从而无需依靠上位机也能够实现数据的转发，可以提高数据传输效率。另外，也可以将电子学数据及时传输给远端服务器。通过本申请实施例所通过的系统，可以根据电子学数据处理的实际需求，扩展任意级数的数据读出汇总终端，更为灵活。在可能的实现方式中，每个数据读出汇总终端包括M级电子学汇总板，其中，每级电子学汇总版包括至少一个电子学汇总板，M为大于或等于2的整数。其中，M级电子学汇总板中的第i级电子学汇总板与第i-1级电子学汇总板连接，所述数据读出汇总终端具体用于：通过第i-1级电子学汇总板中的每个电子学汇总板将所接收的数据帧生成第i-1级汇总帧，并输出给第i级电子学汇总板；再通过第i级电子学汇总板根据所接收的多个第i-1级汇总帧生成第i级汇总帧。即每个数据读出汇总终端可包括多级电子学汇总板，每个电子学汇总板连接前端电子学，下一级电子学汇总板可汇总来自上一级电子学汇总板的数据帧。可见，根据要处理的前端电子学数据，可以扩展电子学汇总板的级数一级电子学汇总板的数量，从而实现更多数据通道的目的。以每个数据读出汇总终端包括两级电子学汇总板为例，即包括多个一级电子学汇总板和一个二级电子学汇总板。这种情况下，数据读出汇总终端通过每个一级电子学汇总板将接收的电子学数据生成一级汇总帧，并输出给二级电子学汇总板；再通过二级电子学汇总板将所接收的多个一级汇总帧生成二级汇总帧。该方案中，每个数据读出汇总终端可包括多级电子学汇总板，不同级之间的电子学汇总板可基于高速串行总线标准VPX交互数据。例如，一级电子学汇总板可将前端电子学输出的电子学数据进行汇总，生成一级汇总帧，输出给二级电子学汇总板。二级电子学汇总板可以将接收的多个一级汇总帧进行汇总生成二级汇总帧。由于VPX具有高速等特性，因此，可尽量提高数据传输效率以每个数据读出汇总终端包括三级电子学汇总板为例，即数据读出汇总终端还包括一个三级电子学汇总板、多个二级电子学汇总板和多个一级电子学汇总板。应理解，三级电子学汇总板与多个二级电子学汇总板连接。这种情况下，数据读出汇总终端通过三级电子学汇总板将所接收的多个二级汇总帧生成三级汇总帧。本申请实施例不限制电子学汇总板的级数，可基于实际需求，扩展多级电子学汇总板。例如，可根据VPX总线支持的数据传输带宽扩展更多级电子学汇总板，从而满足粒子实验的数据量较大的处理需求。在可能的实现方式中，系统还包括与每个电子学汇总板连接的存储设备，所述方法还包括：数据读出汇总终端通过每个电子学汇总板将所生成的汇总帧存储到所连接的存储设备，以通过存储设备对汇总帧或电子学数据进行备份。且，每个电子学汇总板汇总所接收的数据帧，并输出汇总后的汇总帧的同时，以并行的方式通过串口硬盘协议将所述汇总帧备份到存储设备。当然，每个电子学汇总板接收电子学数据之后，在汇总电子学数据的同时，也可以并行的方式通过SATA协议将所述电子学数据备份到存储设备。本申请实施例中，每个电子学汇总板连接有存储设备，这样每个电子学汇总板传输汇总后的电子学数据的同时，可以将汇总后的电子学数据存储到存储设备，作为备份。在部分实验数据丢失的情况下，则基于SATA协议，基于电子学汇总板的地址信息可从存储设备读出所丢弃的汇总帧或电子学数据。这样即使数据读出汇总终端发生故障，例如由于停电或者设备故障等意外情况导致数据读出汇总终端发生故障，由于存储设备的备份，也可以从存储设备恢复丢失的数据。在可能的实现方式中，数据读出汇总终端以及电子学汇总板为可编程逻辑器件。从而即使数据读出汇总终端非本申请提供的数据读出汇总终端，也能够通过对本申请提供的电子学汇总板的器件进行编程达到与非本申请提供的数据读出汇总终端相适配的目的。同理，即使电子学汇总板非本申请提供的电子学汇总板，也能够通过对本申请提供的数据读出汇总终端的器件进行编程达到与非本申请提供的电子学汇总板相适配的目的。通过本申请实施例提供的数据读出汇总终端以及电子学汇总板，可以适用于多种实验场景的数据读出汇总，适用范围更广，具有与现有的数据读出汇总系统兼容性。在可能的实现方式中，所述方法还包括：数据读出汇总终端判断所输入的数据帧的帧头类型，该帧头类型指示所述数据帧为电子学数据帧或汇总帧；根据所述帧头类型提取所输入的数据帧的信息，并将数据帧存储到先进先出FIFO中；以时分方式从所述FIFO中获取多个数据帧，并根据多个数据帧生成完整的汇总帧，且对完整的汇总帧的级数加1。本申请实施例中，数据读出汇总终端包括级联的多级电子学汇总板，数据读出汇总终端中的任一级电子学汇总板都可根据所接收的数据帧的类型，相应提出数据帧的信息，并对数据帧进行汇总。在汇总时，可先将数据帧存储到FIFO中，从而后续从FIFO读出数据帧，再进行重组生成完整的汇总帧。在可能的实现方式中，所述方法还包括：数据读出汇总终端还用于：为所包括的各个电子学汇总办分别设置标识ID，所述ID用于指示电子学汇总板的设备编号。这样数据读出汇总终端设备在生成汇总帧时，将该ID添加到对应电子学汇总板的汇总帧的ID字段。从而通过ID可确定汇总帧是哪一级电子学汇总板的。这样电子学汇总板的位置不受限制，也就是说，多个数据读出汇总终端中的任意数据读出汇总终端的位置可以替换，多个电子学汇总板可以挂在任意数据读出汇总终端。从而通过ID实现电子学汇总板的扩展，从而满足实际需求，更为灵活。另外，在数据丢失的情况下，也可以通过汇总帧的ID知道哪个或哪些电子学汇总板的数据丢失。在可能的实现方式中，所述方法还包括：数据读出汇总终端根据帧长确定是否接收完整帧数据；根据所接收的整帧数据所包括的帧级数字段确定所述整帧数据的帧级数；根据帧级数以及与所述帧级数对应的帧长从所述整帧数据获取原始电子学数据。数据读出汇总终端在解析所接收的汇总帧时，可根据汇总帧的级数，从高级到低级依次解析。第二方面，提供了一种读出电子学处理系统，所述系统包括多个数据采集设备、N级数据读出汇总终端以及远端服务器。每级数据读出汇总终端包括至少一个数据读出汇总终端。N级数据读出汇总终端中的第j级数据读出汇总终端与第j-1级数据读出汇总终端连接。每个数据读出汇总设备与至少一个所述数据采集设备连接。N级数据读出汇总终端中的最高级数据读出汇总终端通过以太网与所述远端服务器连接。N为大于或等于1的整数，所述j为大于或等于1的整数。其中，第j级数据读出汇总设备接收第j-1级数据读出汇总终端中各个数据读出汇总终端设备分别发送的第j-1级汇总帧；第j级数据读出汇总设备根据所接收的多个第j-1级汇总帧，生成第j级汇总帧，并将第j级汇总帧输出给第j+1级数据读出汇总终端，使得最高级数据读出汇总终端设备生成最高级汇总帧；最高级数据读出汇总终端设备将最高级汇总帧通过以太网发送至远端服务器。在可能的实现方式中，每个所述数据读出汇总终端包括M级电子学汇总板，其中，每级电子学汇总版包括至少一个电子学汇总板，所述M为大于或等于2的整数，其中，所述M级电子学汇总板中的第i级电子学汇总板与第i-1级电子学汇总板连接。每级数据读出汇总终端通过所述第i-1级电子学汇总板中的每个电子学汇总板将所接收的数据帧生成第i-1级汇总帧，并输出给第i级电子学汇总板；通过第i级电子学汇总板根据所接收的多个第i-1级汇总帧生成第i级汇总帧。在可能的实现方式中，数据读出汇总终端具体用于：判断所输入的数据帧的帧头类型，所述帧头类型指示所述数据帧为电子学数据帧或汇总帧；根据所述帧头类型提取所输入的所述数据帧的信息，并将所述数据帧存储到先进先出FIFO中；以时分方式从所述FIFO中获取多个所述数据帧，并根据多个所述数据帧的帧头信息、帧长信息以及帧级数生成完整的汇总帧，且对所述完整的汇总帧的级数为所述多个数据帧的帧级数加1。在可能的实现方式中，数据读出汇总终端具体用于：为所包括的各个电子学汇总板分别设置标识ID，所述ID为所述电子学汇总板的设备编号。其中，数据读出汇总终端在生成汇总帧时，将所述ID添加到电子学汇总板的汇总帧的ID字段。在可能的实现方式中，所述数据读出汇总终端还用于：根据帧长确定是否接收完整帧数据；根据所接收的整帧数据所包括的帧级数字段确定所述整帧数据的帧级数；根据帧级数以及与所述帧级数对应的帧长从所述整帧数据获取原始电子学数据。第三方面，提供了一种读出电子学数据处理装置，例如该处理装置可为前述的数据读出汇总终端。该处理装置具有实现上述第一方面方法实施例中的行为的功能。所述功能可以通过硬件实现，也可以通过硬件执行相应的软件实现。所述硬件或软件包括一个或多个与上述功能相对应的模块。该通信装置包括通信接口以及处理器，可选的，还包括存储器。其中，该存储器用于存储计算机程序或指令，处理器与存储器、通信接口耦合，当处理器执行所述计算机程序或指令时，使处理装置执行上述方法实施例中由数据读出汇总终端所执行的方法。第四方面，本申请提供了一种计算机可读存储介质，该计算机可读存储介质存储有计算机程序，当该计算机程序被运行时，实现上述各方面中由数据读出汇总终端执行的方法。该方案可应用于粒子实验，前端电子学输出的电子学数据输入给第一级数据读出汇总终端包括的各个电子学汇总板。第一级数据读出汇总终端可以将各个电子学汇总板所接收的电子学数据进行汇总，并依次将汇总后的汇总帧转发给上一级数据读出汇总终端，直到最高级数据读出汇总终端生成最高级汇总帧。最高级数据读出汇总终端将最高级汇总帧通过以太网将汇总之后的汇总帧发送给远端服务器。从而无需依靠上位机也能够实现数据的转发，可以提高数据传输效率。附图说明图1为本申请实施例提供的读出电子学数据处理系统的原理框图。图2为本申请实施例提供的电子学板扩展的示意图；图3为本申请实施例提供的电子学数据处理方法的流程示意图；图4为本申请实施例提供的数据帧的格式示意图；图5为本申请实施例提供的汇总帧的格式示意图；图6为本申请实施例提供的汇总电子学数据帧的一种示意图；图7为本申请实施例提供的汇总电子学数据帧的另一种示意图；图8为本申请实施例提供的帧流检测处理模块的结构示意图；图9为本申请实施例提供的汇总帧信息生成模块的原理示意图；图10为本申请实施例提供的基于VPX总线的粒子物理实验数据二级汇总实现架构图。具体实施方式为了使本申请实施例的目的、技术方案和优点更加清楚，下面将结合附图对本申请实施例作进一步地详细描述。本申请实施例可以适用于粒子实验的电子数据处理。请参见图1，为本申请实施例提供的读出电子学数据处理系统。该系统包括至少一个数据采集设备、N级数据读出汇总终端以及多个远端服务器。其中，每级数据读出汇总终端包括至少一个数据读出汇总终端。N级数据读出汇总终端中的第j级数据读出汇总终端与第j-1级数据读出汇总终端连接。每个数据读出汇总设备与至少一个所述数据采集设备连接。N级数据读出汇总终端中的最高级数据读出汇总终端通过以太网与远端服务器连接。N为大于或等于1的整数，j为大于或等于1的整数。数据采集设备，可以理解为是前端电子学，包括探测器可以采集粒子实验所得到的电子学数据并处理，获得电子学数据，并输出给与数据采集设备连接的第一级数据读出汇总终端。第一级数据读出汇总终端可汇总所接收的电子学数据，生成汇总帧，再将该汇总帧转发给第二级数据读出汇总终端，由第二级数据读出汇总终端继续对所接收的汇总帧进行汇总，以此类推，直到最高级数据读出汇总终端获得最高级汇总帧。即第j级数据读出汇总设备接收第j-1级数据读出汇总终端中各个数据读出汇总终端设备分别发送的第j-1级汇总帧。第j级数据读出汇总设备根据所接收的多个第j-1级汇总帧，生成第j级汇总帧，并将第j级汇总帧输出给第j+1级数据读出汇总终端，这样使得最高级数据读出汇总终端设备生成最高级汇总帧。最终，最高级数据读出汇总终端通过以太网方式将所述最高级汇总帧发送给远端服务器。这样无需依靠上位机也能够实现数据的转发。由于以太网传相较于传统的上位机传输来说，传输速率更高，从而更加提高数据传输的效率。同时，也可以将电子学数据及时传输给远端服务器。具体的，每级数据读出汇总终端可包括多级电子学汇总板。例如，如图1所示，每个数据读出汇总终端包括M级电子学汇总板，其中，每级电子学汇总版包括至少一个电子学汇总板，M为大于或等于2的整数。其中，M级电子学汇总板中的第i级电子学汇总板与第i-1级电子学汇总板连接。第i-1级电子学汇总板中的每个电子学汇总板将所接收的数据帧生成第i-1级汇总帧，并输出给第i级电子学汇总板。第i级电子学汇总板根据所接收的多个第i-1级汇总帧生成第i级汇总帧。举例来说，每级数据读出汇总终端包括一个二级电子学汇总板和M个一级电子学汇总板，M为大于或等于1的整数。其中，一级电子学汇总板可以将接收的电子学数据进行汇总，生成一级汇总帧，输出给二级电子学汇总板。二级电子学汇总板可以将接收的多个一级汇总帧进行汇总，生成二级汇总帧。二级电子学汇总板可以将生成的汇总帧通过以太网方式发送给远端服务器。需要说明的是，图1仅是举例，本申请实施例提供的数据读出汇总终端对于电子学汇总板的级数不作限制。系统可按实际传输需求自适应进行扩展，即可按需求扩展更多路的数据输入和更多级的汇总，从而满足更大数据量、更多传输通道的前端电子学读出汇总需求。例如，每个数据汇总设备可包括多个三级电子学汇总板，多个二级电子学汇总板，多个一级电子学汇总板。其中，一个二级电子学汇总板连接多个一级电子学汇总板，一个三级电子学汇总板连接多个二级电子学汇总板。输出给三级电子学汇总板。三级汇总板也可以将接收的多个二级汇总帧进行汇总，生成三级汇总帧，以此类推。本申请实施例只需要在系统已有的基础上增加汇总通道数和汇总级数即可。多级电子学汇总板之间可基于VPX总线进行数据之间的交互。由于VPX总线具有传输带宽大，通道数高，可扩展性强的特性，因此，更加满足粒子实验数据量大的场景。本申请实施例中的数据读出汇总终端可扩展更多路的数据输入和更多级的汇总时，不需要重新进行复杂的编程设计，只需要在系统已有的基础上增加汇总通道数和汇总级数即可，可提高工作效率，缩短设计周期。如图2所示，为扩展N路输入的N级汇总扩展示意图。需要说明的是，每个电子学汇总板位置也支持灵活变换的。例如，二级电子学汇总板2也可以作为三级电子学汇总板1来使用。具体可以通过配置电子学汇总板的ID来实现。不同的电子学汇总板可基于ID唯一标识，从而通过ID可确定该电子学汇总板是哪一级电子学汇总板。这样电子学汇总板的位置不受限制，也就是说，多个数据读出汇总终端中的任意数据读出汇总终端的位置可以替换，多个电子学汇总板可以挂在任意数据读出汇总终端。从而通过ID实现电子学汇总板的扩展，从而满足实际需求，更为灵活。可以理解的是，可以扩展的数据输入的最大的路数以及汇总板的级数可根据链路的最大传输速率确定。另外，本申请实施例还可以扩展更多级数据读出汇总终端，也就是说，本申请实施例中数据读出汇总终端的级数可以扩展，每级数据读出汇总终端包括的电子学汇总板的级数也可以扩展，从而满足通道数量高，处理数据量大的实际需求。在本申请实施例中，数据读出汇总终端以及电子学汇总板为可编程逻辑器件。从而即使数据读出汇总终端非本申请提供的数据读出汇总终端，也能够通过对本申请提供的电子学汇总板的器件进行编程达到与非本申请提供的数据读出汇总终端相适配的目的。同理，即使电子学汇总板非本申请提供的电子学汇总板，也能够通过对本申请提供的数据读出汇总终端的器件进行编程达到与非本申请提供的电子学汇总板相适配的目的。通过本申请实施例提供的数据读出汇总终端以及电子学汇总板，可以适用于多种实验场景的数据读出汇总，适用范围更广，具有与现有的数据读出汇总系统兼容性。进一步地，请继续参见图1，每个电子学汇总板连接有存储设备，电子学数据在输入电子学汇总板的同时，以并行方式实时地存储在存储设备，作为备份。即使数据读出汇总终端发生故障，例如由于停电或者设备故障等意外情况导致数据读出汇总终端发生故障，由于存储设备的备份，也可以从存储设备恢复丢失的数据。例如，每个电子学汇总板汇总所接收的数据帧，并输出汇总后的汇总帧的同时，以并行的方式通过SATA协议将所述汇总帧备份到存储设备。当然，每个电子学汇总板接收电子学数据之后，在汇总电子学数据的同时，也可以并行的方式通过SATA协议将所述电子学数据备份到存储设备。即每个电子学汇总板传输汇总后的电子学数据的同时，可以将汇总后的电子学数据存储到存储设备，作为备份。在部分实验数据丢失的情况下，则基于SATA协议，基于电子学汇总板的地址信息可从存储设备读出所丢弃的汇总帧或电子学数据。这样即使数据读出汇总终端发生故障，例如由于停电或者设备故障等意外情况导致数据读出汇总终端发生故障，由于存储设备的备份，也可以从存储设备恢复丢失的数据。基于图1所示的系统，本申请实施例还提供了读出电子学数据处理方法。具体的，各个数据采集设备将采集的电子学数据输出给第一级数据读出汇总终端，第一级数据读出汇总终端对各个电子学汇总板所接收的电子学数据进行汇总之后，将汇总之后生成的汇总帧发送给第二级数据读出汇总终端，以此类推，直到最高级数据读出汇总终端获得最高级汇总帧，再通过以太网方式将汇总之后的电子学数据发送给远端服务器。下面重点介绍，每级数据读出汇总终端的工作流程。在下文的介绍中，以一级数据读出汇总终端为例。由于涉及到汇总数据，因为首先介绍数据的帧格式以及汇总机制和相应的解帧机制。可以理解的是，由于粒子物理实验前端探测器采集的信号是多种多样的，因此，为了传输收发两端理解一致，可定义传输的数据帧格式。请参见图3，为前端电子学的数据帧格式示意图。在本申请实施例中，基于VPX总线传输的前端电子学的数据帧由数据帧头、数据帧长、设备ID、HEC校验位、时间戳、通道号、触发号、数据字段和数据帧尾共九个部分组成。各个部分的具体定义可参考表1。其中，数据字段是可变的，即前端电子学采样点数是可变的，由目前粒子物理实验中常见的采样点数和AD的采样位宽16bit可以计算出数据字段的数据长度位宽。可以理解的是，数据字段位宽＝采样点数×采样位宽。可知，前端一帧数据的数据字段位宽范围：16×2:2048×2。即32:4096Bytes。表1前端电子学的数据帧在本申请实施例中，数据读出汇总终端包括的高级电子学汇总板对来自对个低级电子学汇总板的数据进行重组，获得汇总帧。且数据读出汇总终端灵活支持多级电子学汇总板，因此汇总帧需要考虑到各个电子学汇总板的编号和汇总数据的级数，以保证可以正确解析最终的汇总帧。请参见图4，为本申请实施例提供的汇总帧的格式示意图。在本申请实施例中，汇总帧包括同步头、帧级数、帧长、HEC校验位、设备ID和前级数据帧字段共六个部分。各个部分的具体定义可参考表2。表2汇总帧内容定义如上介绍了数据帧格式以及汇总帧格式，下面介绍汇总机制。请参见图5和图6，分别为一级汇总的数据帧汇总过程示意图和二级汇总的数据帧汇总过程示意图。其中，一级电子学汇总板可连接多块电子学板，每块电子学板输入一路数据帧。一级电子学汇总板将来自多路的数据帧重组，生成一级汇总帧。二级电子学汇总板连接多个一级电子学汇总板，每个一级电子学汇总板输出一级汇总帧。二级电子学汇总板将接收的多个一级汇总帧重组，生成二级汇总帧。具体来讲，任意电子学汇总板在对所接收的数据帧进行汇总时，首先对数据帧的帧头或同步头进行检测，如果检测到数据帧头，那么可确定输入的数据帧为电子学数据帧；如果检测到同步头，那么可确定输入的数据帧为汇总帧。根据帧头的不同，后续的处理流程也有所不同，包括以下两种情况。第一种情况，检测到数据帧头如果检测到数据帧头，说明输入的是前端电子学的数据帧，那么按照前端电子学的数据帧格式，提取数据帧的帧长信息，用于生成汇总帧的帧长。由于输入的是前端电子学的数据帧，那么可知当前电子学汇总板为一级电子学汇总板。这种情况下，帧级数字段生成为0x0001表示当前为一级汇总帧，其他的同步字段则是按照汇总帧格式生成即可。需要说明的是，前端的电子学数据帧完整的存入FIFO，按时分复用的方式读出重组成一帧完整的汇总帧。由于数据帧长可变，即前端的输入通道可变，所以在进行数据帧的缓存和读出汇总时，需对每路FIFO内部帧数量进行计数，以判断是否有完整数据帧输入。如果当前路有一帧数据缓存则读出，相反，如果当前路没有完整帧输入，则不读出当前路，这样可达到一帧汇总帧的数据字段长度可变的目的。第二种情况，检测到同步头如果检测到同步头，说明输入的是汇总帧，那么按照汇总帧的帧格式，提取出汇总帧的帧级数和帧长信息。之后，生成新的同步字段，重组帧的帧级数，并在之前的帧级数基础上加一，帧长则是以输入各路的帧长信息生成新汇总帧长。需要说明的是，由于输入的是汇总帧，在进行新的汇总帧数据字段重组时，需要将输入的前级汇总帧的同步头和帧级数字段去掉，新的汇总帧数据字段由多路的输入的前级汇总帧的帧长、帧长HEC、设备ID和前级子帧组成。数据汇总的方式和第一种情况类似，也可达到帧长可变的目的。远端服务器接收汇总帧之后，可对该汇总帧进行解析。可以理解的是，解析汇总帧的过程是汇总帧重组过程的逆过程。即首先对汇总帧的同步头进行检测，检测到同步头后，再通过帧长判断一帧汇总帧的长度，从而接收完成一帧数据。之后，可通过帧级数字段可以判断该数据是第几级汇总帧，然后按照汇总帧的格式根据每一级的帧长和帧级数信息一级一级解析，最后检测到的数据帧头，可获得前端的电子学数据帧。具体通过数据帧头和数据帧尾即可判断。按照原型系统的汇总机制，以N级汇总为例，假设每级汇总通道数相同为x，N级汇总后的汇总帧长度：其中有效数据长度：所以数据有效占比为：由式可以看出，随着汇总级数N和通道数x的增加，公式分母会逐渐减小，即有效数据占比增加，所以数据传输效率也是随着汇总级数N和通道数x的增加而增加的，最大约为97％。采用原型系统的汇总机制进行实际的数据汇总读出时，汇总实际传输数据率在排除掉传输协议的消耗后，也能达到一个很好的有效数据传输速率，满足极大部分的汇总传输需求，且随着汇总级数和输入通道数的增加，有效数据传输效率也会增加，很好的保证了实际的有效数据的传输速率。考虑到实际传输的传输速率和数据的连续性，本申请实施例基于汇总的帧格式和汇总机制，提出了用于实现多路数据汇总的架构，例如，请参见图7。前端多路电子学数据帧可通过双向光纤和高速收发器接口输入FPGA，存储在第一级的FIFO，例如FIFO1。FIFO1可对数据帧进行跨时钟域处理，从高速收发器的参考时钟域转换到FPGA内部时钟域，再对每路的数据帧进行帧流检测处理，从而获得帧信息。该帧信息作为汇总帧信息生成模块的输入，经过汇总帧信息生成模块处理后，输出汇总帧的同步字段数据。汇总帧的同步字段生成后，与从缓存FIFO，即FIFO2中读出的前端电子学数据帧一起输入到数据帧重组模块。数据帧重组模块按时分复用的方式将前端电子学数据帧和汇总帧重组为一帧汇总帧，最后通过高速收发器接口输出。需要说明的是，在数据帧写入和读出缓存FIFO2之前，需要对各路数据帧进行计数。例如，写入一帧数据后帧计数器值加一，读出后帧计数器值减一，帧计数器显示缓存FIFO2内部的数据帧个数。帧计数器的设置可解决前端输入通道数可变问题。如果某路对应的帧计数器有一帧数据时，那么可读出数据帧进行数据汇总帧重组。计数器值为0时，表示该路没有数据帧，因此，汇总帧的帧长可以根据前端输入变化而变化。下面介绍帧流检测处理模块，如图8所示，为帧流检测处理模块的结构示意图。帧流检测处理模块主要用于帧头检测、帧信息的提取、帧长校验、帧计数。也可以认为，帧流检测处理模块包括用于帧头检测的侦头检测模块、用于帧信息的提取的帧信息提取模块、用于帧长校验的帧长校验模块，用于帧计数的帧计数模块。帧流检测模块接收到子帧之后，根据已知的帧头序列进行判断，以确定所输入的子帧的帧头类型。假设数据帧的帧头检测序列为0xEEEE，汇总帧的帧头检测序列为0xAAAA。如果输入的子帧是电子学数据帧，那么检测序列为0xEEEE；如果输入的子帧是汇总帧，那么检测序列为0xAAAA。帧头检测模块对前端输入的子帧进行帧头检测的同时，使能FIFO2进行数据写入。由于前端输入的子帧可能是数据帧，也可能是汇总帧，本申请实施例可根据帧头检测模块的判断结果适应性使能帧信息提取模块。例如，如果是数据帧，那么使能帧信息提取模块进行数据帧信息的提取；如果是汇总帧，那么使能帧信息提取模块进行汇总帧信息的提取。帧信息提取模块根据输入的子帧是数据帧还是汇总帧的不同，提取的信息也有所不同。不管是数据帧还是汇总帧，帧信息提取模块都可以根据前端输入的子帧类型提取出前级输入子帧的帧信息，为后续的重组成帧提供依据。如果前端输入的子帧是数据帧，则提取数据帧长和HEC校验位以进行后续处理。如果输入的子帧是汇总帧，则提取帧级数、帧长和HEC校验位以进行后续处理。帧长校验模块可用于完成对帧头字段中帧长字段的检错处理。例如，帧长校验模块根据帧信息提取模块提取的帧长度进行HEC校验运算，与接收的HEC校验位比较。如果检错结果与前级输入的子帧校验位相同，表示输入的子帧正确。相反，如果检错结果与前级输入的子帧校验位不同，表示接收错误，那么舍弃该帧。帧计数模块可用于检测前级输入的子帧的帧尾信息，并计数写入FIFO2内部的前级输入的子帧的数量，为后续的处理模块提供前端输入数据的信息。如果输入的是电子学数据帧，则按一帧帧尾检测完毕计数加一。如果输入的是汇总帧，则按汇总帧的帧长信息进行计数，直到计数到帧长度完成后，汇总帧的帧计数加一。前端的输入子帧经过帧检测处理模块后，会输出该帧的信息，这些信息作为输入，输入到汇总帧信息生成模块。汇总帧信息生成模块生成对应的汇总帧同步字段数据，最后和前级输入的子帧重组为一帧新的汇总帧输出。例如，请参见图9，为汇总帧信息生成模块的原理示意图。帧流检测处理模块检测判断前级输入子帧的类型后，会使能对应的帧信息处理模块工作。之后，帧流检测处理模块将获取到的对应帧信息作为输入发送给帧信息处理模块。帧信息处理模块根据所接收的帧信息进行处理，生成帧长信息和帧级数信息。帧信息处理模块将帧长信息和帧级数信息以及接收的设备ID输出给汇总帧同步字段生成模块。汇总帧同步字段生成模块根据帧长信息和帧级数信息以及设备ID生成新的汇总帧同步字段数据，并将生成新的汇总帧同步字段数据发送给数据重组模块。可以理解的是，粒子物理实验的数据量庞大且数据率高。因此，在本申请实施例中，每个电子学汇总板接收到前端电子学数据时，每个电子学汇总板汇总电子学数据之后，在将汇总之后的数据发送给下一级电子学汇总板时，以并行方式将所接收的电子学数据发送给连接的存储设备。由于每个电子学汇总板传输汇总后的电子学数据的同时，将汇总后的电子学数据存储到存储设备，作为备份。这样即使数据读出汇总终端发生故障，例如由于停电或者设备故障等意外情况导致数据读出汇总终端发生故障，由于存储设备的备份，也可以从存储设备恢复丢失的数据。另外，电子学汇总板与存储设备之间可采用串口硬盘协议进行数据传输，完成数据的实时备份。例如，存储设备可以是SATA，以SATA作为本地存储设备，在数据汇总重组帧完成后以数据流的方式直接通过高速收发器传输进入下一级电子学汇总板，同时数据以并行传输方式通过SATA3.0接口和SATA3.0数据传输线备份到本地存储设备。本申请实施例可以使得电子学数据在各级电子学汇总板之间实时地转发，最终以以太网方式发送给远端服务器，当数据量更大时，只需要扩展电子学汇总板的数量即可，无需重新设计整个系统，兼容性更强。由于最终的汇总帧可以通过以太网发送给远端服务器，因此无需依靠上位机，即可以脱离上位机单独工作。另外，最终的汇总帧进入以太网子系统之后，可通过高速收发链路和子卡输出，再由光模块和万兆以太网光纤传输到远端服务器。其中，高速以太网IP子系统提供了连接到高速以太网核心的简便性。基于配置的参数，该以太网子系统会创建相应接口端口，实例化高速以太网子系统和高速串行和反串行块，提供适当的时钟信号。且连接到用户端接口，基于用户的配置，将汇总的数据帧转发。在进行数据转发时，只需将汇总后的数据输入到子系统数据输入接口，更改对应的MAC地址，即可完成数据转发。以太网子系统集成了串行高速收发器传输接口，可以直接通过FMC的GTH转发输出，通过光模块和万兆以太网光纤汇入远端服务器。为了方便理解，请参见图10，为基于VPX总线的粒子物理实验数据二级汇总实现架构图。其中，一级电子学汇总板前端通过SFP光模块和双向光纤接入多路的前端电子学数据，通过FMC的高速传输链路进入到一级电子学汇总板。在一级电子学汇总板，经过FPGA的多路高速收发器接口，接收多路的前端电子学数据帧后，由多路的数据汇总模块完成数据的汇总。多路数据汇总模块的实现架构如前述图7所示，此处不再赘述。完成第一级的数据汇总后，由高速收发器接口从FPGA内输出到板间GTH链路，传输到下一级的汇总板，即第二汇总板。可以理解的是，每个一级汇总板汇总完成后都会输出一路一级汇总帧数据，同一VPX机箱内部的所有一级汇总帧数据通过VPX机箱的背板GTH链路传输到二级汇总板，二级汇总板同样由FPGA内部使用多路的高速收发器接口进行多路一级汇总帧数据的接收。多路数据进入二级汇总板的多路数据汇总模块，汇总成为一路二级汇总帧。二级汇总完成后的数据，通过支持以太网协议的数据转发模块进行转发。数据转发模块将汇总数据输出到汇总板的高速收发器链路，最后由万兆光纤和交换机传输到远端服务器，完成高速数据的实时转发。在整个过程中，每级每个汇总板的数据完成汇总后，会通过SATA数据线备份到本地存储设备，完成实时的数据备份，保证实验的安全性。本申请实施例中还提供一种计算机可读存储介质，包括指令，当其在计算机上运行时，使得计算机执行上述方法示例中的方法，具体参见方法示例中的详细描述，此处事不再赘述。本领域普通技术人员可以理解：在上述实施例中，可以全部或部分地通过软件、硬件、固件或者其任意组合来实现。当使用软件实现时，可以全部或部分地以计算机程序产品的形式实现。所述计算机程序产品包括一个或多个计算机指令。在计算机上加载和执行所述计算机程序指令时，全部或部分地产生按照本申请实施例所述的流程或功能。所述计算机可以是通用计算机、专用计算机、计算机网络、或者其他可编程装置。所述计算机指令可以存储在计算机可读存储介质中，或者从一个计算机可读存储介质向另一个计算机可读存储介质传输，例如，所述计算机指令可以从一个网站站点、计算机、服务器或数据中心通过有线)或无线方式向另一个网站站点、计算机、服务器或数据中心进行传输。所述计算机可读存储介质可以是计算机能够存取的任何可用介质或者是包括一个或多个可用介质集成的服务器、数据中心等数据存储设备。所述可用介质可以是磁性介质，、光介质、或者半导体介质)等。本申请实施例中所描述的各种说明性的逻辑单元和电路可以通过通用处理器，数字信号处理器，专用集成电路，现场可编程门阵列或其它可编程逻辑装置，离散门或晶体管逻辑，离散硬件部件，或上述任何组合的设计来实现或操作所描述的功能。通用处理器可以为微处理器，可选地，该通用处理器也可以为任何传统的处理器、控制器、微控制器或状态机。处理器也可以通过计算装置的组合来实现，例如数字信号处理器和微处理器，多个微处理器，一个或多个微处理器联合一个数字信号处理器核，或任何其它类似的配置来实现。本申请实施例中所描述的方法或算法的步骤可以直接嵌入硬件、处理器执行的软件单元、或者这两者的结合。软件单元可以存储于RAM存储器、闪存、ROM存储器、EPROM存储器、EEPROM存储器、寄存器、硬盘、可移动磁盘、CD-ROM或本领域中其它任意形式的存储媒介中。示例性地，存储媒介可以与处理器连接，以使得处理器可以从存储媒介中读取信息，并可以向存储媒介存写信息。可选地，存储媒介还可以集成到处理器中。处理器和存储媒介可以设置于ASIC中。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。本领域内的技术人员应明白，本申请的实施例可提供为方法、系统、或计算机程序产品。因此，本申请可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本申请可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本申请是参照根据本申请的方法、设备、和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。显然，本领域的技术人员可以对本申请进行各种改动和变型而不脱离本申请的范围。这样，倘若本申请的这些修改和变型属于本申请权利要求及其等同技术的范围之内，则本申请也意图包含这些改动和变型在内。
