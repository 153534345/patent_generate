标题title
一种基于压力感知的室内人员标记定位方法
摘要abst
本发明公开了一种基于压力感知的室内人员标记定位方法，所述室内人员标记定位方法包括如下步骤：首先根据人员请求进入住宅信息执行同意或拒绝进入功能，并记录人员编号；其次对住宅内所有定位节点执行压力传输数据和内部定位相关参数初始化；当系统开始定位时，通过压力传感器数值计算定位坐标并向系统中心节点发送人员位置，当人员离开该区域时，节点与相邻节点进行信息交互直至相邻定位节点发送定位信息。本发明克服了原有的基于压力感应的室内定位技术受到其余物品干扰的缺点，可正确显示室内全体人员当前位置。
权利要求书clms
1.一种基于压力感知的室内人员标记定位方法，其特征在于所述方法包括如下步骤：步骤S1：室内定位系统根据室内当前人员列表记录检测室内是否有人员存在；若存在，则跳转至步骤S9，否则跳至步骤S2；步骤S2：室内全部定位节点进入休眠模式，节点根据当前压力传感器的采集数值进行压力信号归零处理；步骤S3：室内管理系统循环检测是否有人员请求进入住宅，直至收到请求进入住宅信息；步骤S4：室内管理系统通过入室人员信息与存储人员信息进行比对，判断是否为允许进入人员，若是，则跳至步骤S6，否则进入步骤S5；步骤S5：室内管理系统向住宅主人发送信息，询问是否允许该人员进入房屋，若是，则进入步骤S6，否则拒绝进入请求，直至进入请求得到确认；步骤S6：确认房屋允许进入，室内管理系统打开住宅门，向住宅其他录入人员发送消息，告知该人员进入住宅，并添加至室内当前人员列表；步骤S7：定位系统的中心节点C唤醒靠近住宅门的定位节点I，并向I发送进入房屋人员编号；步骤S8：定位节点I置位人员离开标记，根据剩余能量与中心节点距离选择路由路径，准备将定位信息发送至中心节点C；步骤S9：定位节点I等待接收其他节点发送的无线信息或该节点下属压力传感器采集的压力信号变化；步骤S10：定位节点I通过预设的压力感应阈值，判断当前所受压力是否超过阈值，若是则进入步骤S11，否则节点进入休眠模式，清除压力数据与人员编号信息；步骤S11：定位节点I离开休眠模式，并清除本节点存储在内部的离开标记；步骤S12：定位节点I根据自身的压力传感器，根据平面受力计算该定位节点的受力点坐标；步骤S13：判断定位节点I或其相邻节点J计算得出的压力坐标是否位于平面内有效定位区域，若是，则进入步骤S14，否则跳至步骤S15；步骤S14：判断定位节点I或J是否收到人员编号，若是，则I或J将含有坐标信息、定位节点编号、人员编号的信息通过无线网络发送给中心节点C和相应的相邻节点群φ或φ，以显示人员目前位置，同时置位φ或φ内所有定位节点离开标志并跳至步骤S21，否则跳至步骤S17；步骤S15：压力坐标在非有效定位区域，判定人员离开定位节点I或J，相应定位节点通过无线模块发送带有定位节点编号与人员编号的离开信息至对应相邻节点群φ或φ；步骤S16：若定位节点I的坐标位于有效定位区内，判断其相邻定位节点J计算的坐标是否位于有效定位区内，若是则进入步骤S17，否则返回S9；步骤S17：当人员运动至定位节点J所在区域内时，节点J判断是否收到其相邻节点I发送的离开信号，若是则进入步骤S18，否则返回步骤S9；步骤S18：定位节点I或J根据离开信息添加人员编号；步骤S19：定位节点I或J判断是否收到对应相邻节点发送的定位信息，若是则进入步骤S20，否则返回步骤S9；步骤S20：定位节点I或J停止发送离开信息并清除人员离开标志；步骤S21：定位系统运行过程中判断是否收到关闭系统操作，若是则结束全部定位过程，否则返回步骤S9。2.根据权利要求1所述的基于压力感知的室内人员标记定位方法，其特征在于所述定位信息Msg_P包含坐标信息、定位节点编号I和人员编号n。3.根据权利要求1所述的基于压力感知的室内人员标记定位方法，其特征在于所述离开信息Msg_L包含定位节点编号I和人员编号n。4.根据权利要求1所述的基于压力感知的室内人员标记定位方法，其特征在于所述室内定位系统包括定位单元、AD转换芯片、无线通信模块、中央处理器，其中：所述定位单元包括感压定位地板和压力传感器，感压定位地板左上、左下、右上、右下角的外部分别设置一个压力传感器；所述压力传感器输出的压力信号经过AD转换芯片转换后变为可以进行运算的压力数据，发送到定位区域的中央处理器，中央处理器计算得出受力点坐标，通过无线通信模块发送到上位机显示当前压力施加的具体位置。5.根据权利要求1所述的基于压力感知的室内人员标记定位方法，其特征在于所述有效区域的定位方法如下：步骤S1：住宅内全体感压定位地板上电，进行初始化工作，在无人状态下进行压力调零处理，收集到的每个压定位地板的四个压力传感器传输的压力数据作为初始压力值；步骤S2：无线通信模块组建无线传感器网络，无线通信模块进入低功耗休眠状态，不接收或发送无线射频信号；步骤S3：当室外人员进入房屋内，室内所有感压定位地板开始进行定位；步骤S4：进入第i轮压力数据循环检测，每一轮压力循环检测进入10次均值滤波环节，置均值滤波环节次数j＝1；步骤S5：判断该轮压力数据循环检测内是否已进行10次滤波；步骤S6：若步骤S5条件判断成立，则将第i轮的10次滤波输出值的平均值作为初始压力值，置i＝i+1，并返回至步骤S4，若步骤S5条件判断不成立则在滤波环节中，连续读取5次每个压定位地板的四个压力传感器的压力数据，计算平均值进行均值滤波，其结果作为此次滤波环节的滤波输出值；步骤S7：判断此次滤波环节是否为第i轮压力循环检测的首次滤波环节；步骤S8：若步骤S7条件判断成立，则计算本次滤波环节滤波输出值与第i-1轮压力循环检测的末次滤波环节滤波输出值的差值m0；若步骤S7条件判断不成立，则计算第i轮压力循环检测前j次滤波输出值的方差m0；步骤S9：计算步骤S8所得的方差或差值m0是否超过预设阈值m；步骤S10：若步骤S9条件判断成立，则压力发生突变情况，计算本次滤波环节与上一次滤波环节滤波输出值的差值m1，若步骤S9条件判断不成立，则保留此次滤波环节的滤波输出值作为初始压力值，置j＝j+1，并返回至步骤S5；步骤S11：判断步骤S10计算所得差值m1是否超过预设阈值m；步骤S12：若步骤S11条件判断成立，则搜索本次滤波环节中首次超过阈值m的压力数据读取次数k，若步骤S11条件判断不成立，则保留此次滤波环节的滤波输出值作为初始压力值，置j＝j+1，并返回至步骤S5；步骤S13：判断压力数据读取次数k的值为4或5；步骤S14：若步骤S13条件判断成立，则通过压力传感器连续读取两次压力数据，若步骤S13条件判断不成立，则判断最近三次压力读取数据是否连续三次超过阈值m；步骤S15：若步骤S14条件判断成立，则取k-1时的压力数据作为初始压力值计算三次读取数据k,k+1,k+2的平均值作为当前压力值若步骤S14条件判断不成立，则跳转至步骤S20；步骤S16：分别计算每个压定位地板的4个压力传感器当前压力值与初始压力值的差作为压力变化量步骤S17：根据压力变化量ΔFi,i＝1,2,3,4，通过平面受力公式计算得出该感压定位地板的受力点坐标P和感压定位地板总承重F；步骤S18：判断受力点坐标P是否在感压定位地板的有效定位区D内；步骤S19：若步骤S18条件判断成立，则受力点坐标P通过串口从处理器发送至无线通信模块，离开休眠状态，将发送至中转节点或上位机监测软件，若步骤S18条件判断不成立，则施加压力的位置位于感压定位地板相邻地板内，跳转至步骤S20；步骤S20：将此次滤波环节输出值修改为本次滤波环节中k-1时数据读取结果；步骤S21：感压定位地板的无线通信模块是否收到上位机发送的停止定位功能的指令，若收到则停止对传感器数据的采集处理，否则保留此次滤波环节的滤波输出值作为初始压力值，置j＝j+1，并返回至步骤S5。6.根据权利要求5所述的基于压力感知的室内人员标记定位方法，其特征在于所述计算受力点坐标的公式如下：式中，ΔFlu、ΔFld、ΔFru、ΔFrd依次代表感压定位地板左上、左下、右上、右下角的压力传感器测量计算的得出的压力变化量。7.根据权利要求5所述的基于压力感知的室内人员标记定位方法，其特征在于所述计算感压定位地板总承重的公式如下：8.根据权利要求5所述的基于压力感知的室内人员标记定位方法，其特征在于所述有效定位区D的范围计算公式如下：D＝{|x∈,y∈}；式中，ε为预设宽度，L为感压定位地板的边长。
说明书desc
技术领域本发明属于智能家居定位技术领域，涉及一种基于压力感知的对移动人员进行标记的室内人员标记定位方法。背景技术室内定位技术可以协助智能家居系统判断室内人员位置，从而为室内人员提供相应服务。不同于GPS等室外定位技术，室内定位技术需要在封闭、复杂、多信号源环境下提供快速、精准的定位。目前市场上常见的如蓝牙、地磁等室内定位技术，受干扰源与室内结构的影响较大。在地板下铺设大量的压力传感器，根据收集到的压力信号计算室内人员的位置，可以在保证精度的前提下避免室内无线信号的干扰。然而，考虑到现实生活中，大量存在家居物品的移动现象，将会引起基于压力的室内定位系统存在误判甚至导致系统崩溃。不仅如此，由于人员运动过程较为复杂，单纯依靠室内人员的运动轨迹与重力变化无法准确的判断当前移动人员身份。当房屋内有多人运动时，基于压力感知的室内定位系统容易产生错误。如果能够在基于压力信号定位的同时对室内移动人员进行标记跟踪，则可以正确的区分人员与其他家居物品，减少室内定位系统的误判。与此同时，可以实现室内多人定位，提高基于压力感知定位系统的实用性。发明内容为了正确识别室内移动人员身份，减少定位过程的误判，本发明基于室内感压定位地板提供了一种基于压力感知的室内人员标记定位方法。本发明的目的是通过以下技术方案实现的：一种基于压力感知的室内人员标记定位方法，首先根据人员请求进入住宅信息执行同意或拒绝进入功能，并记录人员编号；其次对住宅内所有定位节点执行压力传输数据和内部定位相关参数初始化；当系统开始定位时，通过压力传感器数值计算定位坐标并向系统中心节点发送人员位置，当人员离开该区域时，节点与相邻节点进行信息交互直至相邻定位节点发送定位信息。具体包括如下步骤：步骤S1：室内定位系统根据室内当前人员列表记录检测室内是否有人员存在；若存在，则跳转至步骤S9，否则跳至步骤S2；步骤S2：室内全部定位节点进入休眠模式，节点根据当前压力传感器的采集数值进行压力信号归零处理；步骤S3：室内管理系统循环检测是否有人员请求进入住宅，直至收到请求进入住宅信息；步骤S4：室内管理系统通过入室人员信息与存储人员信息进行比对，判断是否为允许进入人员，若是，则跳至步骤S6，否则进入步骤 S5；步骤S5：室内管理系统向住宅主人发送信息，询问是否允许该人员进入房屋，若是，则进入步骤S6，否则拒绝进入请求，直至进入请求得到确认；步骤S6：确认房屋允许进入，室内管理系统打开住宅门，向住宅其他录入人员发送消息，告知该人员进入住宅，并添加至室内当前人员列表；步骤S7：定位系统的中心节点C唤醒靠近住宅门的定位节点I，并向I发送进入房屋人员编号；步骤S8：定位节点I置位人员离开标记，根据剩余能量与中心节点距离选择路由路径，准备将定位信息发送至中心节点C；步骤S9：定位节点I等待接收其他节点发送的无线信息或该节点下属压力传感器采集的压力信号变化；步骤S10：定位节点I通过预设的压力感应阈值，判断当前所受压力是否超过阈值，若是则进入步骤S11，否则节点进入休眠模式，清除压力数据与人员编号信息；步骤S11：定位节点I离开休眠模式，并清除本节点存储在内部的离开标记；步骤S12：定位节点I根据自身的压力传感器，根据平面受力计算该定位节点的受力点坐标；步骤S13：判断定位节点I或其相邻节点J计算得出的压力坐标是否位于平面内有效定位区域，若是，则进入步骤S14，否则跳至步骤S15；步骤S14：判断定位节点I或J是否收到人员编号，若是，则I 或J将含有坐标信息、定位节点编号、人员编号的信息通过无线网络发送给中心节点C和相应的相邻节点群φ或φ，以显示人员目前位置，同时置位φ或φ内所有定位节点离开标志并跳至步骤S21，否则跳至步骤S17；步骤S15：压力坐标在非有效定位区域，判定人员离开定位节点 I或J，相应定位节点通过无线模块发送带有定位节点编号与人员编号的离开信息至对应相邻节点群φ或φ；步骤S16：若定位节点I的坐标位于有效定位区内，判断其相邻定位节点J计算的坐标是否位于有效定位区内，若是则进入步骤S17，否则返回S9；步骤S17：当人员运动至定位节点J所在区域内时，节点J判断是否收到其相邻节点I发送的离开信号，若是则进入步骤S18，否则返回步骤S9；步骤S18：定位节点I或J根据离开信息添加人员编号；步骤S19：定位节点I或J判断是否收到对应相邻节点发送的定位信息，若是则进入步骤S20，否则返回步骤S9；步骤S20：定位节点I或J停止发送离开信息并清除人员离开标志；步骤S21：定位系统运行过程中判断是否收到关闭系统操作，若是则结束全部定位过程，否则返回步骤S9。相比于现有技术，本发明具有如下优点：本发明克服了原有的基于压力感应的室内定位技术受到其余物品干扰的缺点，可正确显示室内全体人员当前位置。附图说明图1是基于压力感知的室内人员标记定位算法流程图。图2为感压定位地板硬件示意图。图3为基于感压定位地板的定位算法流程图。图4为应用基于压力感知的室内人员标记定位算法的定位系统的一个示例。具体实施方式下面结合附图对本发明的技术方案作进一步的说明，但并不局限于此，凡是对本发明技术方案进行修改或者等同替换，而不脱离本发明技术方案的精神和范围，均应涵盖在本发明的保护范围中。本发明提供了一种基于压力感知的室内人员标记定位算法，其实现定位功能的整体实施流程如下：预先在住宅部署含有压力传感器的定位地板，每一块定位地板的四角铺设压力传感器，并按照位置分成面积相同的带有编号的定位区域。当人员准备进入房屋时，室内管理系统利用人脸信息比对进入房屋的人员的身份信息，将人员编号发送至室内定位系统的定位节点以便进行标记。当人员进入房屋定位区域时，安装在定位区域中央的处理器芯片通过无线模块、压力传感器获得人员编号、压力信号等数据，进而计算人员的具体位置，并以无线通信的方式发送给其余节点；与此同时，该定位区域所属的定位节点通过对收集的人员运动过程产生的压力信号进行分析，根据人员所在定位区域周围的定位节点的压力变化情况与人员离开信号实现人员的区域运动定位。如图1所示，具体实施步骤如下：步骤S1：室内定位系统根据室内当前人员列表记录检测室内是否有人员存在；若存在，则跳转至步骤S9，否则跳至步骤S2；步骤S2：室内全部定位节点进入休眠模式，节点根据当前压力传感器的采集数值进行压力信号归零处理；步骤S3：室内管理系统循环检测是否有人员请求进入住宅，直至收到请求进入住宅信息；步骤S4：室内管理系统通过入室人员信息与存储人员信息进行比对，判断是否为允许进入人员，若是，则跳至步骤S6，否则进入步骤 S5；步骤S5：室内管理系统向住宅主人发送信息，询问是否允许该人员进入房屋，若是，则进入步骤S6，否则拒绝进入请求，直至进入请求得到确认；步骤S6：确认房屋允许进入，室内管理系统打开住宅门，向住宅其他录入人员发送消息，告知该人员进入住宅，并添加至室内当前人员列表；步骤S7：定位系统的中心节点C唤醒靠近住宅门的定位节点I，并向I发送进入房屋人员编号；步骤S8：定位节点I置位人员离开标记，根据剩余能量与中心节点距离选择路由路径，准备将定位信息发送至中心节点C；步骤S9：定位节点I等待接收其他节点发送的无线信息或该节点下属压力传感器采集的压力信号变化；步骤S10：定位节点I通过预设的压力感应阈值，判断当前所受压力是否超过阈值，若是则进入步骤S11，否则节点进入休眠模式，清除压力数据与人员编号信息；步骤S11：定位节点I离开休眠模式，并清除本节点存储在内部的离开标记；步骤S12：定位节点I根据自身的压力传感器，根据平面受力计算该定位节点的受力点坐标；步骤S13：判断定位节点I或其相邻节点J计算得出的压力坐标是否位于平面内有效定位区域，若是，则进入步骤S14，否则跳至步骤S15；步骤S14：判断定位节点I或J是否收到人员编号，若是，则I 或J将含有坐标信息、定位节点编号、人员编号的信息通过无线网络发送给中心节点C和相应的相邻节点群φ或φ，以显示人员目前位置，同时置位φ或φ内所有定位节点离开标志并跳至步骤S21，否则跳至步骤S17；步骤S15：压力坐标在非有效定位区域，判定人员离开定位节点 I或J，相应定位节点通过无线模块发送带有定位节点编号与人员编号的离开信息至对应相邻节点群φ或φ；步骤S16：若定位节点I的坐标位于有效定位区内，判断其相邻定位节点J计算的坐标是否位于有效定位区内，若是则进入步骤S17，否则返回S9；步骤S17：当人员运动至定位节点J所在区域内时，节点J判断是否收到其相邻节点I发送的离开信号，若是则进入步骤S18，否则返回步骤S9；步骤S18：定位节点I或J根据离开信息添加人员编号；步骤S19：定位节点I或J判断是否收到对应相邻节点发送的定位信息，若是则进入步骤S20，否则返回步骤S9；步骤S20：定位节点I或J停止发送离开信息并清除人员离开标志；步骤S21：定位系统运行过程中判断是否收到关闭系统操作，若是则结束全部定位过程，否则返回步骤S9。本发明中，如图2所示，所述室内定位系统包括定位单元、AD 转换芯片、无线通信模块、中央处理器，其中：所述定位单元包括感压定位地板和压力传感器，感压定位地板左上、左下、右上、右下角的外部分别设置一个压力传感器；所述压力传感器输出的压力信号经过AD转换芯片转换后变为可以进行运算的压力数据，发送到定位区域的中央处理器，中央处理器计算得出受力点坐标，通过无线通信模块发送到上位机显示当前压力施加的具体位置。本发明中，如图3所示，所述有效区域的定位方法如下：步骤S1：住宅内全体感压定位地板上电，进行初始化工作，在无人状态下进行压力调零处理，收集到的每个压定位地板的四个压力传感器传输的压力数据作为初始压力值；步骤S2：无线通信模块组建无线传感器网络，无线通信模块进入低功耗休眠状态，不接收或发送无线射频信号；步骤S3：当室外人员进入房屋内，室内所有感压定位地板开始进行定位；步骤S4：进入第i轮压力数据循环检测，每一轮压力循环检测进入10次均值滤波环节，置均值滤波环节次数j＝1；步骤S5：判断该轮压力数据循环检测内是否已进行10次滤波；步骤S6：若步骤S5条件判断成立，则将第i轮的10次滤波输出值的平均值作为初始压力值，置i＝i+1，并返回至步骤S4，若步骤S5 条件判断不成立则在滤波环节中，连续读取5次每个压定位地板的四个压力传感器的压力数据，计算平均值进行均值滤波，其结果作为此次滤波环节的滤波输出值；步骤S7：判断此次滤波环节是否为第i轮压力循环检测的首次滤波环节；步骤S8：若步骤S7条件判断成立，则计算本次滤波环节滤波输出值与第i-1轮压力循环检测的末次滤波环节滤波输出值的差值m0；若步骤S7条件判断不成立，则计算第i轮压力循环检测前j次滤波输出值的方差m0；步骤S9：计算步骤S8所得的方差或差值m0是否超过预设阈值m；步骤S10：若步骤S9条件判断成立，则压力发生突变情况，计算本次滤波环节与上一次滤波环节滤波输出值的差值m1，若步骤S9 条件判断不成立，则保留此次滤波环节的滤波输出值作为初始压力值，置j＝j+1，并返回至步骤S5；步骤S11：判断步骤S10计算所得差值m1是否超过预设阈值m；步骤S12：若步骤S11条件判断成立，则搜索本次滤波环节中首次超过阈值m的压力数据读取次数k，若步骤S11条件判断不成立，则保留此次滤波环节的滤波输出值作为初始压力值，置j＝j+1，并返回至步骤S5；步骤S13：判断压力数据读取次数k的值为4或5；步骤S14：若步骤S13条件判断成立，则通过压力传感器连续读取两次压力数据，若步骤S13条件判断不成立，则判断最近三次压力读取数据是否连续三次超过阈值m；步骤S15：若步骤S14条件判断成立，则取k-1时的压力数据作为初始压力值计算三次读取数据k,k+1,k+2的平均值作为当前压力值若步骤S14条件判断不成立，则跳转至步骤S20；步骤S16：分别计算每个压定位地板的4个压力传感器当前压力值与初始压力值的差作为压力变化量步骤S17：根据压力变化量ΔFi,i＝1,2,3,4，通过平面受力公式计算得出该感压定位地板的受力点坐标P和感压定位地板总承重F，其中：计算受力点坐标的公式如下：式中，ΔFlu、ΔFld、ΔFru、ΔFrd依次代表感压定位地板左上、左下、右上、右下角的压力传感器测量计算的得出的压力变化量；计算感压定位地板总承重的公式如下：步骤S18：判断受力点坐标P是否在感压定位地板的有效定位区 D内，其中，有效定位区D的范围计算公式如下：D＝{|x∈,y∈}式中，ε为预设宽度，用于避免相邻感压定位地板定位时造成的干扰，L为感压定位地板的边长；步骤S19：若步骤S18条件判断成立，则受力点坐标P通过串口从处理器发送至无线通信模块，离开休眠状态，将发送至中转节点或上位机监测软件，若步骤S18条件判断不成立，则施加压力的位置位于感压定位地板相邻地板内，跳转至步骤S20；步骤S20：将此次滤波环节输出值修改为本次滤波环节中k-1时数据读取结果；步骤S21：感压定位地板的无线通信模块是否收到上位机发送的停止定位功能的指令，若收到则停止对传感器数据的采集处理，否则保留此次滤波环节的滤波输出值作为初始压力值，置j＝j+1，并返回至步骤S5。实施例：为了便于理解，图4给出了应用基于压力感知的室内人员标记定位算法的定位系统的一个示例。图中C为中心节点，I、J、K、L、M、 N为室内定位节点。如图1所示，本实施例基于压力感知的室内人员标记定位算法的具体实施步骤如下：步骤S1：室内定位系统根据室内当前人员列表记录检测室内是否有人员存在；若存在，则跳转至步骤S9，否则跳至步骤S2。步骤S2：室内全部定位节点进入休眠模式，节点根据当前压力传感器的采集数值进行压力信号归零处理。在本实施例中，由于当前步骤下定位功能未开启，节点I、J、K、 L、M、N通过采集压力传感器得到的压力坐标应为，每个节点对其所属的4个压力传感器上传的值采集到的数据均应初始化置零处理。步骤S3：室内管理系统循环检测是否有人员请求进入住宅，直至收到请求进入住宅信息。在本实施例中，请求进入住宅信息应包含人员身份信息与请求进入命令信息。步骤S4：室内管理系统通过入室人员信息与存储人员信息进行比对，判断是否为允许进入人员，若是，则跳至步骤S6，否则进入步骤 S5。步骤S5：室内管理系统向住宅主人发送信息，询问是否允许该人员进入房屋，若是，则进入步骤S6，否则拒绝进入请求，直至进入请求得到确认。在本实施例中，室内管理系统向住宅主人发送的信息应包含人员身份信息与请求进入命令信息。步骤S6：确认房屋允许进入，室内管理系统打开住宅门，向住宅其他录入人员发送消息，告知该人员进入住宅，并添加至室内当前人员列表。在本实施例中，室内管理系统向住宅其他录入人员发送的消息应包含人员身份信息。步骤S7：定位系统的中心节点C唤醒靠近住宅门的定位节点I，并向I发送进入房屋人员编号。在本实施例中，C向I发送的信息包含房屋人员编号n，采用的通信方式为无线通信方式。步骤S8：定位节点I置位人员离开标记，根据剩余能量与中心节点距离选择路由路径，准备将定位信息发送至中心节点C。在本实施例中，节点I令其人员离开标记F_PL为1，并选择合适的定位节点内部的无线通信模块作为路由节点。路由节点的选择方式可选择低功耗自适应集簇分层型协议等。步骤S9：定位节点I等待接收其他节点发送的无线信息或该节点下属压力传感器采集的压力信号变化。在本实施例中，节点I等待接收其他节点发送的无线信息的类型包括定位信息和人员离开信息。步骤S10：定位节点I通过预设的压力感应阈值，判断当前所受压力是否超过阈值，若是则进入步骤S11，否则节点进入休眠模式，清除压力数据与人员编号信息。在本实施例中，对于节点I下属的4个压力传感器S1、S2、S3、 S4，若其初始化归零前的采集的压力值为F10、F20、F30、F40，该步骤中采集的压力值为F11、F21、F31、F41，设阈值为ε，若下式成立则进入S11：∨∨∨＝TRUE。步骤S11：定位节点I离开休眠模式，并清除本节点存储在内部的离开标记。在本实施例中，节点I令其人员离开标记F_PL为0。步骤S12：定位节点I根据自身的压力传感器，根据平面受力计算该定位节点的受力点坐标。在本实施例中，节点I通过4个压力传感器S1、S2、S3、S4采集到的压力值F11、F21、F31、F41计算的压力坐标公式为：步骤S13：判断定位节点I或其相邻节点J计算得出的压力坐标是否位于平面内有效定位区域，若是，则进入步骤S14，否则跳至步骤S15。在本实施例中，设定位节点I或其相邻节点J有效定位区域为Λ，其形状为正方形，分布于I或J定位区域正中央。I或J定位区域的边长为a，有效定位区域D边缘与定位区域的边缘距离为b，若下式成立，则压力坐标位于平面内有效定位区域：∧。步骤S14：判断定位节点I或J是否收到人员编号，若是，则I 或J将含有坐标信息、定位节点编号、人员编号的信息通过无线网络发送给中心节点C和相应的相邻节点群φ或φ，以显示人员目前位置，同时置位φ或φ内所有定位节点离开标志并跳至步骤S21，否则跳至步骤S17。在本实施例中，定位节点I的相邻节点群φ包含的节点为J、K、 L、M、N，I发送的定位信息Msg_P包含坐标信息、定位节点编号I、人员编号n，J、K、L、M、N收到Msg_P后，置F_PL为1。步骤S15：压力坐标在非有效定位区域，判定人员离开定位节点 I或J，相应定位节点通过无线模块发送带有定位节点编号与人员编号的离开信息至对应相邻节点群φ或φ。在本实施例中I发送的离开信息Msg_L包含定位节点编号I和人员编号n。步骤S16：若定位节点I的坐标位于有效定位区内，判断其相邻定位节点J计算的坐标是否位于有效定位区内，若是则进入步骤S17，否则返回S9。步骤S17：当人员运动至定位节点J所在区域内时，节点J判断是否收到其相邻节点I发送的离开信号，若是则进入步骤S18，否则返回步骤S9。步骤S18：定位节点I或J根据离开信息添加人员编号。步骤S19：定位节点I或J判断是否收到对应相邻节点发送的定位信息，若是则进入步骤S20，否则返回步骤S9。步骤S20：定位节点I或J停止发送离开信息并清除人员离开标志。步骤S21：定位系统运行过程中判断是否收到关闭系统操作，若是则结束全部定位过程，否则返回步骤S9。
