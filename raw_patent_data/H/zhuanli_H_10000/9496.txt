标题title
一种实现车载软件付费授权的车云平台架构系统及方法
摘要abst
本发明公开一种实现车载软件付费授权的车云平台架构系统及方法，所述系统包括智能网联汽车系统、手机APP和车云平台；所述智能网联汽车系统包括车载软件模块、车内软件权益模块、MQTT联网模块、数字证书模块等功能的软件系统；所述车云平台包括MQTT Broker集群、PKI服务集群、智能汽车云服务集群、车载软件OTA管理服务集群、车载软件权益服务集群、车载软件商品及付费服务集群。本发明提供的实现车载软件付费授权的车云平台架构系统，构架设计合理可靠，用户实现付费后，车企可以授权用户使用车载软件的付费功能。即车企可在车载软件中定义免费功能和付费功能，车主付费后，车企授权激活车载软件的付费功能给车主使用。
权利要求书clms
1.一种实现车载软件付费授权的车云平台架构系统，其特征在于，包括智能网联汽车系统、手机APP和车云平台；所述智能网联汽车系统包括车载软件模块、车内软件权益模块、MQTT联网模块、数字证书模块等功能的软件系统； 所述车云平台包括MQTT Broker集群、PKI服务集群、智能汽车云服务集群、车载软件OTA管理服务集群、车载软件权益服务集群、车载软件商品及付费服务集群。2.根据权利要求1所述实现车载软件付费授权的车云平台架构系统，其特征在于，所述智能网联汽车系统包括车载软件模块、车内软件权益模块、MQTT联网模块、数字证书模块等功能的软件系统；车载软件模块为车内提供各种智能功能的软件，其中的付费功能可被车内软件权益模块激活使用；车内软件权益模块为车内对车载软件的功能是否可以使用进行统一鉴权管理的模块，可与车云平台同步用户对车辆的软件权益；MQTT联网模块用于与车云平台进行联网并保持长连接，实现智能汽车系统与车云平台保持双向通讯；数字证书模块用于生成公私钥，并安全存储私钥、公钥证书。3.根据权利要求1所述实现车载软件付费授权的车云平台架构系统，其特征在于，所述智能汽车云服务集群：为智能网联汽车系统提供各类联网功能需要请求的API云服务；所述MQTT Broker集群：用于智能网联汽车系统与车云平台保持双向通讯的长连接服务；所述车载软件商品及付费服务集群：用于为手机APP应用提供车载软件商品的展示及付费入口服务；消息队列集群：用于为智能汽车云服务集群、车载软件权益服务集群等，提供异步的消息发送和监听通道；通常可以使用Kafka,RabbitMQ等消息队列中间件来构建消息队列集群。4.根据权利要求1所述实现车载软件付费授权的车云平台架构系统，其特征在于，所述PKI服务集群：用于为智能网联汽车系统与车云平台进行安全通讯或安全鉴权，提供公钥证书签发及查询服务。5.根据权利要求1所述实现车载软件付费授权的车云平台架构系统，其特征在于，所述车载软件OTA管理服务集群：用于为智能网联汽车的车载软件提供新版本软件包分发服务。6.根据权利要求1所述实现车载软件付费授权的车云平台架构系统，其特征在于，所述车载软件权益服务集群：用于记录用户车辆通过付费或被赠与所获得的软件权益，以及车载软件的激活信息。7.根据权利要求4所述实现车载软件付费授权的车云平台架构系统，其特征在于，所述PKI服务集群为多个PKI服务器；每个PKI服务器包括：公钥证书签发模块，用于将客户端提交的公钥签发为车云平台授信的公钥证书，并保存公钥证书和分配证书ID；其中，公钥算法支持RSA、SM2等；公钥证书查询模块，用于通过证书ID查询已签发的公钥证书。8.根据权利要求5所述实现车载软件付费授权的车云平台架构系统，其特征在于，所述车载软件OTA管理服务集群为多个OTA管理服务器；每个服务器包括：车载软件包分发模块，用于分发各个智能网联汽车系统可升级的新版本车载软件包。9.根据权利要求6所述实现车载软件付费授权的车云平台架构系统，其特征在于，所述车载软件权益服务集群为多个车载软件权益服务器；每个服务器包括：用户车辆软件权益授权模块，用于记录用户车辆已付费的或被赠与的软件权益；车载软件激活信息模块，用于记录各个车载软件的激活信息。10.一种实现车载软件付费授权的车云平台架构的方法，其特征在于，采用权利要求1至9任一车云平台架构系统；执行如下步骤：S1、由智能网联汽车系统使用RSA或国密SM2算法生成非对称公私钥对，并访问车云平台的智能汽车云服务集群提供的证书签发API云服务，提交智能汽车唯一标识和公钥，请求签发为车云平台授信的公钥证书；S2、智能汽车云服务集群收到证书签发请求后，调用PKI服务集群的公钥证书签发模块，将来自智能网联汽车系统的公钥签发为公钥证书，保存所签发的公钥证书和生成证书ID，并返回公钥证书和证书ID给到智能网联汽车系统；智能网联汽车系统收到公钥证书和证书ID后，将在数字证书模块安全保存证书ID、私钥、公钥证书及其关联关系；S3、智能网联汽车在使用时，智能网联汽车系统基于上述证书安全体系，通过MQTT联网模块与车云平台的MQTT Broker集群建立安全的双向认证长连接，实现汽车与车云平台的实时通讯；S4、用户在手机APP应用上查看车云平台的车载软件商品及付费服务集群提供的车载软件商品清单及付费入口；当用户希望能够使用某个车载软件的付费功能时，用户先在手机APP应用选择相应的车载软件商品，并按车载软件商品及付费服务集群提供的付费入口完成付费；用户付费完成后，车载软件商品及付费服务集群将用户车辆信息、对应的车载软件商品的软件权益信息提交给车载软件权益服务集群的用户车辆软件权益授权模块；S5、车载软件权益服务集群的用户车辆软件权益授权模块在接收到车载软件商品及付费服务集群提交的用户车辆信息、软件权益信息后，将保存并进行车载软件的授权激活；S6、所述S4的软件权益信息，若高于目标车载软件版本，智能网联汽车系统将需要进行OTA升级对应的车载软件到软件权益对应的新版本软件；S7、实现用户付费后，车企可以授权用户使用车载软件的付费功能。
说明书desc
技术领域本发明涉及车联网技术领域，特别是涉及一种实现车载软件付费授权的车云平台架构系统及方法。背景技术随着车联网的不断发展，主流车企都构建了自己的车云平台，从而在售车后，可以持续为车主提供基于车联网的售后增值服务，并希望通过为车主提供增值服务实现盈利。这类可盈利的增值服务，很大一部分可以通过在车载软件中提供付费功能来实现。例如CN113837828A 公开的“车载软件出售方法、装置、车辆及存储介质”，所述方法包括：接收车主的软件购买请求；根据软件购买请求生成目标车载软件的待付订单，并在待付订单完成缴费后，根据软件购买请求对应的目标车辆的身份标识向目标车辆发送软件清单变更信息，授权目标车辆对目标车载软件的使用权限；在检测到目标车辆不满足使用条件时，停止对目标车辆授权目标车载软件的使用权限。但是，其仅涉及软件售卖的管理办法，并不涉及系统架构及系统交互设计，更不涉及售卖后如何对软件更新。又如 CN108388439A公开的“一种车载软件的更新方法、系统、装置及可读存储介质”提供了一种车载软件的更新方法，包括：获取所述车载软件和输入秘钥；利用所述车载软件的属性特征生成验证秘钥；判断所述输入秘钥与所述验证秘钥是否一致；如果是，解除系统封闭，以对所述车载软件进行相关的操作。不同的车载软件的属性特征不同，所以对应不同的验证秘钥，当要对不同的车载软件进行操作时，必然对应不同的输入秘钥，除非掌握了验证秘钥的生成算法，否则无法获取与验证秘钥一致的输入秘钥，从而避免了没有秘钥或静态密码泄露时第三方解封系统、软件随意更新的情况，大幅度提高了车载系统的更新安全，保证了车载系统的稳定性。但是，仅涉及防止非法安装软件的方法。发明内容针对现有技术存在的上述不足，本发明的目的在于提供一种实现车载软件付费授权的车云平台架构系统，解决现有技术车载软件不能实现付费授权的问题。进一步提供所述实现车载软件付费授权的车云平台架构的方法。为实现上述目的，本发明采用如下技术方案：一种实现车载软件付费授权的车云平台架构系统，其特征在于，包括智能网联汽车系统、手机APP和车云平台；所述智能网联汽车系统包括车载软件模块、车内软件权益模块、MQTT联网模块、数字证书模块等功能的软件系统； 所述车云平台包括MQTT Broker集群、PKI服务集群、智能汽车云服务集群、车载软件OTA管理服务集群、车载软件权益服务集群、车载软件商品及付费服务集群。进一步，所述智能网联汽车系统包括车载软件模块、车内软件权益模块、MQTT联网模块、数字证书模块等功能的软件系统；车载软件模块为车内提供各种智能功能的软件，其中的付费功能可被车内软件权益模块激活使用；车内软件权益模块为车内对车载软件的功能是否可以使用进行统一鉴权管理的模块，可与车云平台同步用户对车辆的软件权益；MQTT联网模块用于与车云平台进行联网并保持长连接，实现智能汽车系统与车云平台保持双向通讯；数字证书模块用于生成公私钥，并安全存储私钥、公钥证书。所述智能汽车云服务集群：为智能网联汽车系统提供各类联网功能需要请求的API云服务；所述MQTT Broker集群：用于智能网联汽车系统与车云平台保持双向通讯的长连接服务；所述车载软件商品及付费服务集群：用于为手机APP应用提供车载软件商品的展示及付费入口服务；消息队列集群：用于为智能汽车云服务集群、车载软件权益服务集群等，提供异步的消息发送和监听通道。通常可以使用Kafka,RabbitMQ等消息队列中间件来构建消息队列集群。所述PKI服务集群：用于为智能网联汽车系统与车云平台进行安全通讯或安全鉴权，提供公钥证书签发及查询服务。所述车载软件OTA管理服务集群：用于为智能网联汽车的车载软件提供新版本软件包分发服务。所述车载软件权益服务集群：用于记录用户车辆通过付费或被赠与所获得的软件权益，以及车载软件的激活信息。本发明还提供实现车载软件付费授权的车云平台架构的方法，采用上述车云平台架构系统；执行如下步骤：S1、由智能网联汽车系统使用RSA或国密SM2算法生成非对称公私钥对，并访问车云平台的智能汽车云服务集群提供的证书签发API云服务，提交智能汽车唯一标识和公钥，请求签发为车云平台授信的公钥证书；S2、智能汽车云服务集群收到证书签发请求后，调用PKI服务集群的公钥证书签发模块，将来自智能网联汽车系统的公钥签发为公钥证书，保存所签发的公钥证书和生成证书ID，并返回公钥证书和证书ID给到智能网联汽车系统；智能网联汽车系统收到公钥证书和证书ID后，将在数字证书模块安全保存证书ID、私钥、公钥证书及其关联关系；S3、智能网联汽车在使用时，智能网联汽车系统基于上述证书安全体系，通过MQTT联网模块与车云平台的MQTT Broker集群建立安全的双向认证长连接，实现汽车与车云平台的实时通讯；S4、用户在手机APP应用上查看车云平台的车载软件商品及付费服务集群提供的车载软件商品清单及付费入口；当用户希望能够使用某个车载软件的付费功能时，用户先在手机APP应用选择相应的车载软件商品，并按车载软件商品及付费服务集群提供的付费入口完成付费；用户付费完成后，车载软件商品及付费服务集群将用户车辆信息、对应的车载软件商品的软件权益信息提交给车载软件权益服务集群的用户车辆软件权益授权模块。S5、车载软件权益服务集群的用户车辆软件权益授权模块在接收到车载软件商品及付费服务集群提交的用户车辆信息、软件权益信息后，将保存并进行车载软件的授权激活。S6、所述S4的软件权益信息，若高于目标车载软件版本，智能网联汽车系统将需要进行OTA升级对应的车载软件到软件权益对应的新版本软件。S7、实现用户付费后，车企可以授权用户使用车载软件的付费功能。相比现有技术，本发明具有如下有益效果：1、本发明从车云平台的系统架构和系统交互层面提供安全实现车载软件安全付费和激活使用的系统和方法，并支持付费后通过OTA更新车载软件，确保用户能够及时使用到最新的付费软件功能，提升用户软件使用体验。而且，本发明构架设计合理可靠，用户实现付费后，车企授权激活车载软件的付费功能给车主使用，用户体验感好。2、该授权用户使用车载软件的付费功能具有安全可靠、效率高等特点。车企可在车载软件中定义免费功能和付费功能。对于付费功能，车主付费后，车企可以立即授权激活车载软件的付费功能给车主使用；若付费功能涉及新的软件版本，车辆可通过OTA及时更新车载软件，并激活给车主使用。附图说明图1为本发明实现车载软件付费授权的车云平台架构系统的结构示意图；图2为本发明架构系统中智能网联汽车向车云平台请求签发公钥证书示意图；图3为本发明中智能网联汽车系统和智能汽车云服务集群保持实时通讯示意图；图4为本发明中用户可在手机APP应用上，查看并选购车载软件商品示意图；图5为本发明中用户付费后车载软件的授权激活详细步骤示意图；图6为本发明中车载软件OTA升级授权激活的详细步骤示意图。具体实施方式为了使本领域技术人员更好地理解本发明的技术方案，下面结合附图对本发明作进一步的说明，但本发明的实施方式不仅限于此。如图1所示，本发明提供的一种实现车载软件付费授权的车云平台架构系统，包括智能网联汽车系统、手机APP和车云平台；所述智能网联汽车系统包括车载软件模块、车内软件权益模块、MQTT联网模块、数字证书模块等功能的软件系统； 所述车云平台包括MQTTBroker集群、PKI服务集群、智能汽车云服务集群、车载软件OTA管理服务集群、车载软件权益服务集群、车载软件商品及付费服务集群。其中，所述智能网联汽车系统包括车载软件模块、车内软件权益模块、MQTT联网模块、数字证书模块等功能的软件系统；车载软件模块为车内提供各种智能功能的软件，其中的付费功能可被车内软件权益模块激活使用；车内软件权益模块为车内对车载软件的功能是否可以使用进行统一鉴权管理的模块，可与车云平台同步用户对车辆的软件权益；MQTT联网模块用于与车云平台进行联网并保持长连接，实现智能汽车系统与车云平台保持双向通讯；数字证书模块用于生成公私钥，并安全存储私钥、公钥证书。所述智能汽车云服务集群：为智能网联汽车系统提供各类联网功能需要请求的API云服务；所述MQTT Broker集群：用于智能网联汽车系统与车云平台保持双向通讯的长连接服务；所述车载软件商品及付费服务集群：用于为手机APP应用提供车载软件商品的展示及付费入口服务；消息队列集群：用于为智能汽车云服务集群、车载软件权益服务集群等，提供异步的消息发送和监听通道。通常可以使用Kafka,RabbitMQ等消息队列中间件来构建消息队列集群。所述PKI服务集群：用于为智能网联汽车系统与车云平台进行安全通讯或安全鉴权，提供公钥证书签发及查询服务。所述车载软件OTA管理服务集群：用于为智能网联汽车的车载软件提供新版本软件包分发服务。所述车载软件权益服务集群：用于记录用户车辆通过付费或被赠与所获得的软件权益，以及车载软件的激活信息。进一步，所述PKI服务集群为多个PKI服务器；每个PKI服务器包括：公钥证书签发模块，用于将客户端提交的公钥签发为车云平台授信的公钥证书，并保存公钥证书和分配证书ID。其中，公钥算法支持RSA、SM2等；公钥证书查询模块，用于通过证书ID查询已签发的公钥证书。所述车载软件OTA管理服务集群为多个OTA管理服务器；每个服务器包括：车载软件包分发模块，用于分发各个智能网联汽车系统可升级的新版本车载软件包。所述车载软件权益服务集群为多个车载软件权益服务器；每个服务器包括：用户车辆软件权益授权模块，用于记录用户车辆已付费的或被赠与的软件权益；车载软件激活信息模块，用于记录各个车载软件的激活信息。1）参见图2所示，智能网联汽车系统与车云平台的智能汽车云服务集群通过汽车唯一标识+公钥，以及公钥+证书ID进行信息确认。智能网联汽车生产时，由智能网联汽车系统使用RSA2048或国密SM2算法生成非对称公私钥对，并访问车云平台的智能汽车云服务集群提供的证书签发API云服务，提交智能汽车唯一标识和公钥，请求签发为车云平台授信的公钥证书。智能汽车云服务集群收到证书签发请求后，调用PKI服务集群的公钥证书签发模块，将来自智能网联汽车系统的公钥签发为公钥证书，保存所签发的公钥证书和生成证书ID，并返回公钥证书和证书ID给到智能网联汽车系统。智能网联汽车系统收到公钥证书和证书ID后，将在数字证书模块安全保存证书ID、私钥、公钥证书及其关联关系。2）如图3所示，智能网联汽车在使用时，智能网联汽车系统基于步骤1）的证书，通过MQTT联网模块与车云平台的MQTT Broker集群建立安全的双向认证长连接，智能汽车云服务集群与MQTT Broker集群也保持长连接。每个智能网联汽车系统和智能汽车云服务集群在MQTT Broker中使用一组独立的topic进行通信，该组topic命名示例可约定为：从而使得每辆智能网联汽车的智能网联汽车系统和智能汽车云服务集群可以保持实时通讯，并且智能网联汽车两两之间互不干扰。3）如图4所示，用户可以在手机APP应用上查看车云平台的车载软件商品及付费服务集群提供的车载软件商品清单及付费入口。特别说明，每个车载软件在车云平台有唯一的软件标识，设为软件件号；每个车载软件商品中，会包含软件功能描述和软件权益信息；软件权益信息由软件件号、软件版本号、可使用的有效期时长、可使用次数等信息组成。通常用户可以付费购买与该用户车辆车载软件版本相同或更高版本的软件功能。当用户希望能够使用某个车载软件的付费功能时，用户先在手机APP应用选择相应的车载软件商品，并按车载软件商品及付费服务集群提供的付费入口完成付费。用户付费完成后，车载软件商品及付费服务集群将用户车辆信息、对应的车载软件商品的软件权益信息提交给车载软件权益服务集群的用户车辆软件权益授权模块。车载软件权益服务集群的用户车辆软件权益授权模块在接收到车载软件商品及付费服务集群提交的用户车辆信息、软件权益信息后，将保存并进行车载软件的授权激活。4）如图5所示，为车载软件的授权激活详细过程。具体步骤如下：a)用户车辆软件权益授权模块，向消息队列集群发布软件权益变更信息。软件权益变更信息，由用户车辆信息、软件权益信息组成。b)智能汽车云服务集群中的用户车辆权益服务模块，可以从消息队列集群实时监听到软件权益变更信息。c)用户车辆权益服务模块，监听到软件权益变更信息后，将使用软件权益信息向车载软件权益服务集群的车载软件激活信息模块获取对应车载软件的激活信息。激活信息是一组有特殊信息的字符串，其内编制有指定车载软件的激活指令、激活时长、激活次数等信息。d)用户车辆权益服务模块，向PKI服务集群查询用户车辆的证书ID和公钥证书。e)用户车辆权益服务模块，使用步骤d）获取的公钥证书对步骤c)获取的软件权益信息和激活信息进行加密。可选的加密算法如下：用户车辆权益服务模块随机生成一个AES128对称密钥，设为AESKey，对软件权益信息和激活信息进行对称加密，得到密文设为EncrySoftRight，然后使用步骤c）获取的公钥证书对AESKey进行非对称加密得到密文设为AsyAESKey。用户车辆权益服务模块将证书ID、EncrySoftRight、AsyAESKey组合成待发送给用户车辆的授权信息，授权信息以json格式描述，示例如下：{ certID：证书ID， encrySoftRight：EncrySoftRight， asyAESKey：AsyAESKey}f)用户车辆权益服务模块，通过步骤2）对应的智能汽车云服务集群与MQTTBroker集群的长连接，使用约定的topic向指定车辆发送步骤e)得到的授权信息。g)智能网联汽车系统的MQTT联网模块，通过监听约定的topic，可以接收步骤f）发出的车载软件授权信息，并将授权信息在智能网联汽车系统内发送给车内软件权益模块。h)车内软件权益模块，收到授权信息并安全保存后，将读取其中的证书ID和EncryAESKey，发送给数字证书模块。数字证书模块查找证书ID对应的私钥，对EncryAESKey进行解密得到AESKey，返回给车内软件权益模块。车内软件权益模块再使用AESKey对EncrySoftRight进行解密得到软件权益信息和激活信息。车内软件权益模块使用软件权益信息识别待激活的车载软件功能，若待激活的目标车载软件的版本信息与软件权益信息中的版本信息一致，将向目标车载软件发送激活信息进行激活相应的付费功能。5）上述步骤4）的h）中的软件权益信息，若高于目标车载软件版本，智能网联汽车系统将需要进行OTA升级对应的车载软件到软件权益对应的新版本软件。如图6所示，具体车载软件OTA升级授权激活详细过程。具体步骤如下：a)智能网联汽车系统的车内软件权益模块，在识别到软件权益信息高于目标车载软件版本时，将使用软件权益向车云平台的智能汽车云服务集群请求新版本软件包。b)智能汽车云服务集群，转发新版本软件包请求到车载软件OTA管理服务集群。c)车载软件OTA管理服务集群收到新版本软件包请求后，使用请求中的软件权益信息向车载软件权益服务集群校验是否有效，若软件权益有效则生成对应软件包的下载地址并返回。d)、e)、f) 智能网联汽车系统的车内软件权益模块,接收到智能汽车系统云服务集群从车载软件OTA管理服务集群返回的新版本软件包下载地址后，将访问该下载地址下载相应的新版本软件包。新版本软件包下载后，将进行升级安装。成功安装后，将使用步骤5）的h）步骤保存的相应授权信息，向安装后的新版本车载软件发送激活信息进行激活相应的付费功能。综上，采用上述系统和方法可实现用户自主付费，车企可以授权用户使用车载软件的付费功能车企授权激活车载软件的付费功能给车主使用，可以提升用户的体验感。该授权用户使用车载软件的付费功能具有安全可靠、效率高等特点。车企可在车载软件中定义免费功能和付费功能。最后需要说明的是，以上实施例仅用以说明本发明的技术方案而非限制技术方案，本领域的普通技术人员应当理解，那些对本发明的技术方案进行修改或者等同替换，而不脱离本技术方案的宗旨和范围，均应涵盖在本发明的权利要求范围当中。
