标题title
刷新注册的容错处理方法、装置、CSCF以及介质
摘要abst
本公开提供了一种刷新注册的容错处理方法、装置、CSCF以及IMS、存储介质，其中的方法包括：配置预设协议请求消息的指标信息以及对应的告警阈值；如果指标信息达到告警阈值，则启动容错处理；在启动容错处理后并在接收到终端发送的注册消息时，确定与发送注册消息的用户相对应的用户类型；如果确定用户为已注册用户，则向终端返回刷新注册成功响应消息。本公开的方法、装置、CSCF以及IMS、存储介质，避免了已注册用户因刷新注册失败而掉线的业务缺陷，保证了用户的业务体验，减小了链路负荷和信令风暴发生的可能性，提升了网络的安全性和稳定性；并且能够保证了容错处理的时效性，能够提高用户的使用感受。
权利要求书clms
1.一种刷新注册的容错处理方法，应用于IP多媒体子系统中的呼叫会话控制功能中，所述方法包括：配置预设协议请求消息的指标信息以及对应的告警阈值；如果所述指标信息达到所述告警阈值，则启动容错处理；在启动容错处理后并在接收到终端发送的注册消息时，确定与发送所述注册消息的用户相对应的用户类型；如果确定所述用户为已注册用户，则向所述终端返回刷新注册成功响应消息。2.如权利要求1所述的方法，还包括：如果确定所述用户为初始注册用户，则向归属用户服务器发送预设协议查询请求；接收所述归属用户服务器返回的查询结果，基于所述查询结果进行注册处理。3.如权利要求2所述的方法，其中，所述指标信息包括：对于发出的预设协议请求消息所收到的失败响应数量，所述方法还包括：如果所述指标信息达到所述告警阈值，则确定所述归属用户服务器和/或代理节点出现故障、或者与所述归属用户服务器之间的预设协议链路出现故障；在接收到所述终端发送的注册消息时，如果确定所述用户为已注册用户，则向所述终端返回刷新注册成功响应消息，而不向归属用户服务器发送所述预设协议查询请求。4.如权利要求3所述的方法，所述确定与发送所述注册消息的用户相对应的用户类型包括：获取本地存储的用户数据，基于所述用户数据判断所述用户是否为已注册用户或初始注册用户。5.如权利要求2所述的方法，还包括：如果在预设的时长阈值内没有接收到归属用户服务器返回的查询结果，则确定所述初始注册用户注册失败，向所述终端返回注册失败消息。6.如权利要求1至5任一项所述的方法，其中，所述预设协议包括：Diameter协议；所述注册消息包括：SIP Register消息。7.一种刷新注册的容错处理装置，包括：指标设置单元，用于配置预设协议请求消息的指标信息以及对应的告警阈值；指标监测单元，用于如果所述指标信息达到所述告警阈值，则启动容错处理；注册类型分类单元，用于在启动容错处理后并在接收到终端发送的注册消息时，确定与发送所述注册消息的用户相对应的用户类型；容错处理实施单元，用于如果确定所述用户为已注册用户，则向所述终端返回刷新注册成功响应消息。8.如权利要求7所述的装置，还包括：初始注册处理单元，用于如果确定所述用户为初始注册用户，则向归属用户服务器发送预设协议查询请求；接收所述归属用户服务器返回的查询结果，基于所述查询结果进行注册处理。9.如权利要求8所述的装置，其中，所述指标信息包括：对于发出的预设协议请求消息所收到的失败响应数量；所述容错处理实施单元，还用于如果所述指标信息达到所述告警阈值，则确定所述归属用户服务器和/或代理节点出现故障，或者与所述归属用户服务器之间的预设协议链路出现故障；在接收到终端发送的注册消息时，如果所述用户为已注册用户，则向所述终端返回刷新注册成功响应消息，而不向归属用户服务器发送预设协议查询请求。10.如权利要求8所述的装置，其中，所述注册类型分类单元，具体用于获取本地存储的用户数据，基于所述用户数据判断所述用户是否为已注册用户或初始注册用户。11.如权利要求8所述的装置，其中，所述初始注册处理单元，具体用于如果在预设的时长阈值内没有接收到归属用户服务器返回的查询结果，则确定所述初始注册用户注册失败，向所述终端返回注册失败消息。12.一种刷新注册的容错处理装置，包括：存储器；以及耦接至所述存储器的处理器，所述处理器被配置为基于存储在所述存储器的指令执行如权利要求1至6任一项所述的方法。13.一种呼叫会话控制功能CSCF，包括：如权利要求7至12任一项所述的刷新注册的容错处理装置。14.一种IP多媒体子系统IMS，包括：如权利要求13所述的CSCF。15.一种计算机可读存储介质，其上存储有计算机程序指令，该指令被处理器执行时实现权利要求1至6任意一项所述的方法。
说明书desc
技术领域本发明涉及通信技术领域，尤其涉及一种刷新注册的容错处理方法、装置、CSCF以及IMS、存储介质。背景技术在基于IMS的VoLTE和VOBB业务实现中，会话控制基于SIP协议实现，而鉴权信息、业务信息的传递则基于Diameter协议实现。在注册过程中，未注册用户发起的初始注册Register请求和已注册用户发起的刷新注册Register请求到达IMS CSCF后，IMS CSCF会通过DRA网络或直接向HSS发送Diameter鉴权、用户及业务信息查询请求，在得到正常响应后，注册成功，未注册用户成功注册到IMS网络，已注册用户继续保持IMS在线。但是，在业务的实际运营中，由于传输质差、链路闪断导致的Diameter链路故障和DRA/HSS设备本身故障的情况并不少见，而这些故障所引发的Diameter信令风暴，已经成为现网VoLTE和VOBB业务重大故障的主因之一。发明内容有鉴于此，本发明要解决的一个技术问题是提供一种刷新注册的容错处理方法、装置、CSCF以及IMS、存储介质。根据本公开的第一方面，提供一种刷新注册的容错处理方法，应用于IP多媒体子系统中的呼叫会话控制功能中，所述方法包括：配置预设协议请求消息的指标信息以及对应的告警阈值；如果所述指标信息达到所述告警阈值，则启动容错处理；在启动容错处理后并在接收到终端发送的注册消息时，确定与发送所述注册消息的用户相对应的用户类型；如果确定所述用户为已注册用户，则向所述终端返回刷新注册成功响应消息。可选地，如果确定所述用户为初始注册用户，则向归属用户服务器发送预设协议查询请求；接收所述归属用户服务器返回的查询结果，基于所述查询结果进行注册处理。可选地，所述指标信息包括：对于发出的预设协议请求消息所收到的失败响应数量；如果所述指标信息达到所述告警阈值，则确定所述归属用户服务器和/或代理节点出现故障、或者与所述归属用户服务器之间的预设协议链路出现故障；在接收到所述终端发送的注册消息时，如果确定所述用户为已注册用户，则向所述终端返回刷新注册成功响应消息，而不向归属用户服务器发送所述预设协议查询请求。可选地，所述确定与发送所述注册消息的用户相对应的用户类型包括：获取本地存储的用户数据，基于所述用户数据判断所述用户是否为已注册用户或初始注册用户。可选地，如果在预设的时长阈值内没有接收到归属用户服务器返回的查询结果，则确定所述初始注册用户注册失败，向所述终端返回注册失败消息。可选地，所述预设协议包括：Diameter协议；所述注册消息包括：SIP Register消息。根据本公开的第二方面，提供一种刷新注册的容错处理装置，包括：指标设置单元，用于配置预设协议请求消息的指标信息以及对应的告警阈值；指标监测单元，用于如果所述指标信息达到所述告警阈值，则启动容错处理；注册类型分类单元，用于在启动容错处理后并在接收到终端发送的注册消息时，确定与发送所述注册消息的用户相对应的用户类型；容错处理实施单元，用于如果确定所述用户为已注册用户，则向所述终端返回刷新注册成功响应消息。可选地，初始注册处理单元，用于如果确定所述用户为初始注册用户，则向归属用户服务器发送预设协议查询请求；接收所述归属用户服务器返回的查询结果，基于所述查询结果进行注册处理。可选地，所述指标信息包括：对于发出的预设协议请求消息所收到的失败响应数量；所述容错处理实施单元，还用于如果所述指标信息达到所述告警阈值，则确定所述归属用户服务器和/或代理节点出现故障，或者与所述归属用户服务器之间的预设协议链路出现故障；在接收到终端发送的注册消息时，如果所述用户为已注册用户，则向所述终端返回刷新注册成功响应消息，而不向归属用户服务器发送预设协议查询请求。可选地，所述注册类型分类单元，具体用于获取本地存储的用户数据，基于所述用户数据判断所述用户是否为已注册用户或初始注册用户。可选地，所述初始注册处理单元，具体用于如果在预设的时长阈值内没有接收到归属用户服务器返回的查询结果，则确定所述初始注册用户注册失败，向所述终端返回注册失败消息。根据本公开的第三方面，提供一种刷新注册的容错处理装置，包括：存储器；以及耦接至所述存储器的处理器，所述处理器被配置为基于存储在所述存储器的指令执行如上所述的方法。根据本公开的第四方面，提供一种呼叫会话控制功能CSCF，包括：如上所述的刷新注册的容错处理装置。根据本公开的第五方面，提供一种IP多媒体子系统IMS，包括：如上所述的CSCF。根据本公开的第六方面，提供一种计算机可读存储介质，所述计算机可读存储介质存储有计算机指令，所述指令被处理器执行如上所述的方法。本公开的刷新注册的容错处理方法、装置、CSCF以及IMS、存储介质，避免了已注册用户因刷新注册失败而掉线的业务缺陷，保证了用户的业务体验，压缩了CSCF对HSS的Diameter查询量以及减小了链路负荷和信令风暴发生的可能性，提升了网络的安全性和稳定性；并且能够保证了容错处理的时效性，能够提高用户的使用感受。附图说明为了更清楚地说明本公开实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作一简单地介绍，显而易见地，下面描述中的附图仅仅是本公开的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其他的附图。图1为根据本公开的刷新注册的容错处理方法的一个实施例的流程示意图；图2为根据本公开的刷新注册的容错处理方法的另一个实施例的流程示意图；图3为根据本公开的刷新注册的容错处理方法的一个实施例的信令处理示意图；图4为根据本公开的刷新注册的容错处理装置的一个实施例的模块示意图；图5为根据本公开的刷新注册的容错处理装置一个实施例的在CSCF中部署的模块示意图；图6为根据本公开的刷新注册的容错处理装置的另一个实施例的模块示意图。具体实施方式下面参照附图对本公开进行更全面的描述，其中说明本公开的示例性实施例。下面将结合本公开实施例中的附图，对本公开实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本公开一部分实施例，而不是全部的实施例。基于本公开中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本公开保护的范围。在现有技术中，在Diameter链路故障和DRA/HSS设备本身故障的情况下，未注册用户发起的初始注册Register请求和已注册用户发起的刷新注册Register请求到达IMSCSCF后，IMS CSCF通过Diameter链路发往HSS的鉴权、用户及业务信息查询请求会得到失败或超时响应。但初始/刷新注册失败的用户将会尝试再次注册，注册请求Register消息会触发IMS CSCF频繁发送Diameter查询请求，造成信令消息量剧增，Diameter链路逐渐拥塞。Diameter协议本身的重传机制，会使IMS CSCF发出的Diameter查询请求消息成倍发送，会导致信令风暴的产生，进一步加剧链路拥塞直至全阻。此时，初始注册用户一直无法成功注册，已在线用户由于刷新注册失败纷纷掉线，导致重大故障发生。有鉴于此，本公开的实施例提供了一种刷新注册的容错处理方法，应用于IP多媒体子系统中的呼叫会话控制功能CSCF中。图1为根据本公开的刷新注册的容错处理方法的一个实施例的流程示意图，如图1所示：步骤101，配置预设协议请求消息的指标信息以及对应的告警阈值。在一个实施例中，预设协议包括Diameter协议等，指标信息包括对于发出的预设协议请求消息所收到的失败响应数量等。例如，运维人员设置的指标信息包括对于所发出Diameter请求消息所收到的3002、超时等失败响应的数量。步骤102，如果指标信息达到告警阈值，则启动容错处理。步骤103，在启动容错处理后并在接收到终端发送的注册消息时，确定与发送注册消息的用户相对应的用户类型；注册消息包括SIP Register消息等。步骤104，如果确定用户为已注册用户，则向终端返回刷新注册成功响应消息。在一个实施例中，确定与发送注册消息的用户相对应的用户类型可以有多种方法。例如，获取本地存储的用户数据，基于用户数据判断用户是否为已注册用户或初始注册用户。如果确定用户为初始注册用户，则向归属用户服务器发送预设协议查询请求。接收归属用户服务器返回的查询结果，基于查询结果进行注册处理。如果在预设的时长阈值内没有接收到归属用户服务器返回的查询结果，则确定初始注册用户注册失败，向终端返回注册失败消息。如果指标信息达到告警阈值，则确定归属用户服务器和/或代理节点出现故障、或者与归属用户服务器之间的预设协议链路出现故障；在接收到终端发送的注册消息时，如果确定用户为已注册用户，则向终端返回刷新注册成功响应消息，而不向归属用户服务器发送预设协议查询请求。在Diameter链路或DRA/HSS出现故障，并且指标达到告警阈值时进行告警指示时，立即启动处理措施；对后续过程中用户发来的Register消息进行分类处理，对已注册用户的周期刷新Register消息不再触发Diameter查询，而是根据已本地保存的用户数据直接返回刷新注册成功响应；能够保证Diameter链路或DRA/HSS发生故障时已注册用户不掉线，减小Diameter链路压力，降低信令风暴和链路拥塞发生的概率。上述实施例中的刷新注册的容错处理方法，根据运维人员所设置的指标信息和告警阈值对CSCF所发出Diameter请求消息进行监测，在指标达到告警阈值时进行告警指示时，立即启动处理措施：对后续过程中用户发来的Register消息进行分类处理，对已注册用户的周期刷新Register消息不再触发Diameter查询，根据已本地保存的用户数据直接返回刷新注册成功响应。图2为根据本公开的刷新注册的容错处理方法的另一个实施例的流程示意图，如图2所示：步骤201，接收运维人员通过接口设置的需要监测的、对于Diameter协议消息相对应的相关指标及告警阀值。步骤202，对CSCF所发出Diameter请求消息的指标信息进行监测。步骤203，判断所监测的指标是否达到告警阀值；如果是，则进入步骤205，如果否，则进入步骤204。步骤204，指标未达到告警阀值，不做其他处理，继续监测。步骤205，指标达到告警阀值，发送指标告警。步骤206，自动开启容错处理开关，立即启动处理措施。步骤207，CSCF收到用户发来的Register消息。步骤208，对Register消息进行分类，判断用户注册类型分类。步骤209，如果为未注册用户的初始注册，则不在容错处理范围，继续通常初始注册流程，向HSS发起Diameter查询请求。步骤210，如果为已注册用户的刷新注册，进行容错处理，改变通常注册流程，不再向HSS发起Diameter查询请求。步骤211，查询注册信息存储模块，根据已本地保存的用户数据，直接向UE返回刷新注册成功响应。图3为根据本公开的刷新注册的容错处理方法的一个实施例的信令处理示意图，如图3所示，现有技术中的处理流程包括步骤301-308：步骤301和302，用户发起刷新注册Register消息。步骤303-步骤306，CSCF根据所收到的Register消息向HSS发起鉴权信息查询，HSS正常返回查询结果响应。步骤307-步骤308，CSCF向用户返回刷新注册成功响应。故障情况下的通常处理流程包括步骤401-405为：步骤401和步骤402，用户发起刷新注册Register消息。步骤403，CSCF根据所收到的Register消息向HSS发起鉴权信息查询，由于Diameter链路或DRA/HSS设备故障，导致查询失败。步骤404和步骤405，CSCF向用户返回403禁止响应，用户被注销，掉线。故障情况下采用本公开后的处理流程包括步骤501-504：步骤501和步骤502，用户发起刷新注册Register消息。步骤503和步骤504，容错功能启动，CSCF不再向HSS发起鉴权信息查询，而是根据本地保存的用户注册信息向用户返回刷新注册成功响应，用户继续保持在线。在一个实施例中，如图4所示，本公开提供一种刷新注册的容错处理装置40，包括：指标设置单元41、指标监测单元42、注册类型分类单元43、容错处理实施单元44和初始注册处理单元45。指标设置单元41配置预设协议请求消息的指标信息以及对应的告警阈值。如果指标信息达到告警阈值，则指标监测单元42启动容错处理。注册类型分类单元43在启动容错处理后并在接收到终端发送的注册消息时，确定与发送注册消息的用户相对应的用户类型。如果确定用户为已注册用户，则容错处理实施单元44向终端返回刷新注册成功响应消息。在一个实施例中，注册类型分类单元43获取本地存储的用户数据，基于用户数据判断用户是否为已注册用户或初始注册用户。如果确定用户为初始注册用户，则初始注册处理单元45向归属用户服务器发送预设协议查询请求。接收归属用户服务器返回的查询结果，基于查询结果进行注册处理。如果在预设的时长阈值内没有接收到归属用户服务器返回的查询结果，则初始注册处理单元45用于确定初始注册用户注册失败，向终端返回注册失败消息。如图5所示，指标设置单元41提供接口，供运维人员设置需要监测的、预设协议请求消息的指标信息和告警阀值，并将指标和阈值传送至指标监测单元42。指标监测单元42根据指标设置单元41发来的指标名称，对相应指标进行实时监测。在指标裂化至告警阀值时，向容错处理实施单元发出指示。如果指标信息达到告警阈值，则指标监测单元42确定归属用户服务器和/或代理节点出现故障，或者与归属用户服务器之间的预设协议链路出现故障。在接收到终端发送的注册消息时，如果用户为已注册用户，则容错处理实施单元44向终端返回刷新注册成功响应消息，而不向归属用户服务器发送预设协议查询请求。在一个实施例中，注册类型分类单元43对CSCF网元所收到的SIP Register消息进行注册类型分类，将Register消息分为已存储注册信息的用户发来的刷新注册和未存储注册信息的用户发来的初始注册。容错处理实施单元44根据指标监测单元43发来的Diameter消息裂化告警指示，对已注册用户的刷新注册Register消息进行容错处理，不再通过Diameter链路或直接向HSS发送Diameter查询消息，而是根据本地保存的用户数据直接返回刷新注册成功响应，保证已注册用户能够继续保持在线。图6为根据本公开的刷新注册的容错处理装置的另一个实施例的模块示意图。如图6所示，该装置可包括存储器61、处理器62、通信接口63以及总线64。存储器61用于存储指令，处理器62耦合到存储器61，处理器62被配置为基于存储器61存储的指令执行实现上述的刷新注册的容错处理方法。存储器61可以为高速RAM存储器、非易失性存储器等，存储器81也可以是存储器阵列。存储器61还可能被分块，并且块可按一定的规则组合成虚拟卷。处理器62可以为中央处理器CPU，或专用集成电路ASIC，或者是被配置成实施本公开的刷新注册的容错处理方法的一个或多个集成电路。在一个实施例中，本公开提供一种呼叫会话控制功能CSCF，包括：如上任一实施例中的刷新注册的容错处理装置。在一个实施例中，本公开提供一种IP多媒体子系统IMS，包括：如上任一实施例中的CSCF。在一个实施例中，本公开提供一种计算机可读存储介质，计算机可读存储介质存储有计算机指令，指令被处理器执行如上任一实施例中的刷新注册的容错处理方法。本公开是参照根据本公开实施例的方法、设备和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。上述实施例中的刷新注册的容错处理方法、装置、CSCF以及IMS、存储介质，避免了Diameter请求发送不成功，导致已注册用户因刷新注册失败而掉线的业务缺陷，保证了用户的业务体验；在Diameter链路出现故障时大大压缩了CSCF对HSS的Diameter查询量，降低了Diameter链路负荷和信令风暴发生的可能性，提升了网络的安全性和稳定性；能够对设定指标进行自动监测、指标超阀值后自动告警、根据告警自动启动的处理机制，保证了容错处理的时效性；可以向运维人员提供接口，便于运维人员根据已有经验设置并调整需要监测的Diameter指标类型和告警阀值；解决了因Diameter链路或DRA/HSS设备故障导致的已注册用户掉线的问题，极大降低了Diameter信令风暴的发生概率，且具备高度的自适应性和时效性，能够提高用户的使用感受。可能以许多方式来实现本公开的方法和系统。例如，可通过软件、硬件、固件或者软件、硬件、固件的任何组合来实现本公开的方法和系统。用于方法的步骤的上述顺序仅是为了进行说明，本公开的方法的步骤不限于以上具体描述的顺序，除非以其它方式特别说明。此外，在一些实施例中，还可将本公开实施为记录在记录介质中的程序，这些程序包括用于实现根据本公开的方法的机器可读指令。因而，本公开还覆盖存储用于执行根据本公开的方法的程序的记录介质。本公开的描述是为了示例和描述起见而给出的，而并不是无遗漏的或者将本公开限于所公开的形式。很多修改和变化对于本领域的普通技术人员而言是显然的。选择和描述实施例是为了更好说明本公开的原理和实际应用，并且使本领域的普通技术人员能够理解本公开从而设计适于特定用途的带有各种修改的各种实施例。
