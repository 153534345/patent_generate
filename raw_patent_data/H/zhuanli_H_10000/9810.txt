标题title
用于WiFi宽带收发通路的IQ失衡补偿方法及应用
摘要abst
本发明公开了用于WiFi宽带收发通路的IQ失衡补偿方法及应用，涉及数字信号处理技术领域。所述方法适用于发射通路和接收通路，将IQ信号输入到频率相关的IQ失衡补偿装置FD‑IQMC中，FD‑IQMC先通过频率无关的IQ失衡补偿模块FI‑iqmc对IQ失衡进行一个频率无关的整体补偿，再从IQ信号选择一路信号输入到分数时延滤波器Frac‑delay filter和实数对称的幅度滤波器Amp‑FIR filter中分别进行相位和幅度补偿；另一路信号输入到时延模块处理以进行时间对齐。本发明具有结构易于控制、资源开销低、补偿精度高的优点，适用于高宽带和和高阶调制的系统，比如WiFi6/WiFi6E系统。
权利要求书clms
1.一种用于WiFi宽带收发通路的IQ失衡补偿方法，其特征在于，对于发射通路，将发射基带TX Baseband输出的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到数模转换器DAC；或者，对于接收通路，将模数转换器ADC接收到的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到接收基带RXBaseband；其中，所述FD-IQMC用于对输入的IQ信号，根据前述发射通路或接收通路的IQ不平衡参数估计值，通过频率无关的IQ失衡补偿模块FI-iqmc对输入的I路信号和Q路信号选取一个频点的幅度和相位误差进行单点补偿以对IQ失衡进行一个频率无关的整体补偿；以及，对从FI-iqmc中输出的I路信号和Q路信号，选择其中一路信号输入到分数时延滤波器Frac-delay filter中进行相位补偿以补偿频率选择性相位上的失衡，再将从Frac-delayfilter输出的信号输入到实数对称的幅度滤波器Amp-FIR filter中进行幅度补偿以补偿频率选择性幅度上的失衡；未被选择的另一路信号则通过时延模块进行处理以与选择的一路信号进行时间对齐。2.根据权利要求1所述的IQ失衡补偿方法，其特征在于，对于前述发射通路或接收通路的IQ不平衡参数估计值，通过单音测试获取；多个频点的单音对应有多个频点的IQ不平衡参数估计值。3.根据权利要求1所述的IQ失衡补偿方法，其特征在于，所述频率无关的IQ失衡补偿模块FI-iqmc被配置为执行如下步骤：对于信号x＝cos+jsin，其中j为复数表示，根据IQ不平衡参数估计值中的相位不平衡因子Δφ和幅度不平衡因子Δm，令I路信号需要的补偿相位和补偿幅度分别为-Δφ/2和-Δm/2，Q路信号需要的补偿相位和补偿幅度分别为Δφ/2和Δm/2，通过以下补偿算法对IQ失衡进行整体补偿，其中，x表示输入FI-iqmc的IQ信号，Mcomp表示相位和幅度的补偿矩阵。4.根据权利要求3所述的IQ失衡补偿方法，其特征在于：当前述Δφ小于预设值时，令sin等于Δφ，cos等于1，带入前述补偿矩阵Mcomp中得到简化后的M’comp，通过以下补偿算法对IQ失衡进行整体补偿，此时，所述频率无关的IQ失衡补偿模块FI-iqmc通过4个乘法器对输入的信号进行一个矩阵乘法以补偿频率无关的IQ失衡。5.根据权利要求1所述的IQ失衡补偿方法，其特征在于，通过分数时延滤波器Frac-delay filter对FI-iqmc输出的I路信号或Q路信号进行相位补偿的步骤如下：通过多个频点的单音测试，获取宽带内采样频点的相位误差；对获取的相位误差，进行线性拟合；对线性拟合后的相位误差，通过如下公式计算宽带内的相位误差群时延Group delay，其中，Δφ为Δω频段内的相位误差变化，radian表示弧度；根据计算得到的群时延Group delay的值计算需要补偿的分数时延样点值，基于需要补偿的分数时延样点值通过拉格朗日插值法设计分数时延滤波器的分数时延值；根据设计的分数时延滤波器对选择的I路信号或Q路信号进行相位补偿，得到相位补偿后的I路信号或Q路信号。6.根据权利要求5所述的IQ失衡补偿方法，其特征在于：在前述Frac-delay filter对FI-iqmc输出的I路信号或Q路信号进行相位补偿时，将未被选择的另一路信号输入到第一时延模块D1中进行时延处理以使两路信号的时间对齐。7.根据权利要求6所述的IQ失衡补偿方法，其特征在于：通过实数对称的幅度滤波器Amp-FIR filter对Frac-delay filter输出的信号进行幅度补偿的步骤如下：通过多个频点的单音测试，获取宽带内采样频点的幅度误差；对正负频率对称的频点的幅度误差，进行取平均操作；设计一个阶数为N的实数滤波器，其滤波器频点的幅度误差参数通过测试频点的分段线性内插获取，所述N为2的整数倍；根据前述滤波器频点的幅度误差参数，通过快速傅里叶逆变换方式计算前述实数滤波器的滤波系数，所述滤波系数为实数且系数对称；通过前述滤波系数对改前述信号进行滤波处理，得到幅度补偿后的信号。8.根据权利要求7所述的IQ失衡补偿方法，其特征在于：在前述Amp-FIR filter对Frac-delay filter输出的信号进行幅度补偿时，将从第一时延模块D1中输出的信号输入到第二时延模块D2中进行时延处理以使两路信号的时间对齐。9.一种用于WiFi宽带收发通路的IQ失衡三级补偿系统，其特征在于：包括一个频率相关的IQ失衡补偿装置FD-IQMC，所述FD-IQMC设置在发射通路中用于对待输入数模转换器DAC的IQ信号进行预补偿处理，或者所述FD-IQMC设置在接收通路中用于对模数转换器ADC输出的IQ信号进行后补偿处理；所述频率相关的IQ失衡补偿装置FD-IQMC被配置为：对于输入的IQ信号，根据前述发射通路或接收通路的IQ不平衡参数估计值，通过频率无关的IQ失衡补偿模块FI-iqmc对输入的I路信号和Q路信号选取一个频点的幅度和相位误差进行单点补偿以对IQ失衡进行一个频率无关的整体补偿；以及，对从FI-iqmc中输出的I路信号和Q路信号，选择其中一路信号输入到分数时延滤波器Frac-delay filter中进行相位补偿以补偿频率选择性相位上的失衡，再将从Frac-delay filter输出的信号输入到实数对称的幅度滤波器Amp-FIR filter中进行幅度补偿以补偿频率选择性幅度上的失衡；未被选择的另一路信号则通过时延模块进行处理以与选择的一路信号进行时间对齐。10.一种用于WiFi宽带收发通路的IQ失衡补偿方法，其特征在于：对于发射通路，将发射基带TX Baseband输出的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到数模转换器DAC；或者，对于接收通路，将模数转换器ADC接收到的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到接收基带RXBaseband；其中，所述FD-IQMC用于对输入的IQ信号，根据前述发射通路或接收通路的IQ不平衡参数估计值，通过频率无关的IQ失衡补偿模块FI-iqmc对输入的I路信号和Q路信号选取一个频点的幅度和相位误差进行单点补偿以对IQ失衡进行一个频率无关的整体补偿；以及，对从FI-iqmc中输出的I路信号和Q路信号，选择其中一路信号输入到单路滤波器进行处理以补偿频率选择性的相位和幅度，所述单路滤波器的滤波器系数是将分数时延滤波器系数和幅度滤波器系数卷积后生成，其相频响应能够补偿分数时延，幅频响应能够补偿幅度误差，所述单路滤波器的滤波器系数为实数非对称形式；未被选择的另一路信号则通过时延模块进行处理以与选择的一路信号进行时间对齐。11.一种用于WiFi宽带收发通路的IQ失衡补偿系统，其特征在于：包括一个频率相关的IQ失衡补偿装置FD-IQMC，所述FD-IQMC设置在发射通路中用于对待输入数模转换器DAC的IQ信号进行预补偿处理，或者所述FD-IQMC设置在接收通路中用于对模数转换器ADC输出的IQ信号进行后补偿处理；所述频率相关的IQ失衡补偿装置FD-IQMC被配置为：对于输入的IQ信号，根据前述发射通路或接收通路的IQ不平衡参数估计值，通过频率无关的IQ失衡补偿模块FI-iqmc对输入的I路信号和Q路信号选取一个频点的幅度和相位误差进行单点补偿以对IQ失衡进行一个频率无关的整体补偿；以及，对从FI-iqmc中输出的I路信号和Q路信号，选择其中一路信号输入到单路滤波器进行处理以补偿频率选择性的相位和幅度，所述单路滤波器的滤波器系数是将分数时延滤波器系数和幅度滤波器系数卷积后生成，其相频响应能够补偿分数时延，幅频响应能够补偿幅度误差，所述单路滤波器的滤波器系数为实数非对称形式；未被选择的另一路信号则通过时延模块进行处理以与选择的一路信号进行时间对齐。
说明书desc
技术领域本发明涉及数字信号处理技术领域，尤其涉及一种用于WiFi宽带收发通路的IQ失衡补偿方法及应用。背景技术随着近几年无线通信技术朝着高速化、小型化、集成化方向不断发展，零中频ZIF架构的收发机由于其低成本、易于集成等优势备受青睐，目前已广泛应用于具有高带宽和高采样率的电子系统中。零中频架构采用模拟正交混频技术，直接将射频信号转换为基带同相信号和正交信号，因此相比于传统的超外差式架构需要更少的模拟器件。然而，模拟器件由于设计的限制因素存在一定的非理想特性，使得I信号和Q信号之间幅度和相位不匹配而发生I/Q失衡，导致了星座图的失真、误码率上升和EVM恶化等问题，影响了通信系统性能。在具有更高硅集成度和更大调制阶数的宽带通信系统中，上述I/Q失衡问题往往会进一步加剧，考虑到WiFi6/WiFi6E需要支持更大的带宽和更高的调制方式，高宽带和和高阶调制的系统设计对射频前端的非理想特性的校准和补偿提出了更加严苛的标准与要求。目前，业界提出了多种IQ失衡的估计方法和数字补偿方案，以提高通信质量。传统的解决IQ失衡问题的研究通常采用与频率无关的失衡误差，FI失衡误差值为常数，上述方法难以满足宽带系统的性能需求：对于宽带系统，I/Q通道间器件频响不一致等因素引入的幅度和相位失衡误差会随着信号频率的变化而变化，为频率相关误差。随着在第五代无线网络技术和第六代网络技术中使用了更大带宽，传统的与频率无关的IQ补偿方式已经无法满足系统的性能要求，需要根据IQ失衡的频率选择性，利用数字信号处理技术，进行宽带频率相关IQ补偿，以提升大带宽信号的整体质量。作为举例，结合图1所示的发射通路的零中频模型和图2所示接收通路的零中频模型描述宽带上IQ失衡的频率选择性。图1中TX通路IQ不平衡的主要来源是DAC、低通滤波器、IQ放大器和混频器；图2中RX通路的IQ不平衡的主要来源是混频器、IQ放大器、低通滤波器和ADC。由于混频器的本振LO失衡是对IQ产生了一个固定偏差，所以模型中提供频率选择性的主要是DAC/ADC、低通滤波器、IQ放大器三种器件。IQ两路信号在经过这三种器件时，幅度增益和相位变化出现了不匹配，并且在频域上表现为不同特征，带宽越大，IQ误差的变化越明显，这就是在宽带上IQ失衡的频率选择性的来源。目前处理上述宽带IQ失衡的方法主要有以下三种方法。第一种方法，是通过训练序列，在信号中加入一段已知良好特性的序列，并在通信中需要不断的发送和接收该序列用于校准，再将计算获取的特性进行补偿。该校准方法流程较为繁琐，降低了传输效率。第二种方法，是通过单音测试IQ特性后进行频域补偿，该校准方法容易受到频偏等因素的影响，影响精度。第三种方法，是盲估计方法，通过发送宽带信号，计算和统计IQ特性，再进行复数滤波器的设计和补偿。这种校准方法需要大量的统计数据，计算过程慢，且补偿结构资源开销大。另一方面，对于DAC/ADC、低通滤波器、IQ放大器等三类器件，其在基带频率、级联后的双边带响应呈现对称特性，即幅度响应对称为偶函数，相位响应为奇函数。同时，在研究中发现，IQ误差的频率选择性可以近似表现为幅度对称和相位线性变化的分布特性，参见图3所示实测的宽带IQ幅度误差的分布图，图4所示实测的宽带IQ相位误差的分布图。上述类型的零中频结构具有低通特性更强、带通效应不显著的特性。综上所述，是否可以基于上述零中频结构的特性，提供一种能够补偿具有频率选择性的IQ失衡，且结构易于控制、资源开销低、补偿精度高的补偿方案，是当前亟需解决的技术问题。发明内容本发明的目的在于：克服现有技术的不足，提供了一种用于WiFi宽带收发通路的IQ失衡补偿方法及应用。本发明提供的IQ失衡补偿方法，通过频率相关的IQ失衡补偿装置FD-IQMC对IQ信号进行IQ失衡补偿，其中FD-IQMC包括非频选补偿结构和分别对应相位和幅度的频选补偿结构，在发射通路基于预补偿方式进行IQ失衡补偿，在接收通路基于后补偿方式进行IQ失衡补偿。本发明具有结构易于控制、资源开销低、补偿精度高的优点，能够有效降低镜像抑制比IRR、EVM恶化和误码率。为实现上述目标，本发明提供了如下技术方案：一种用于WiFi宽带收发通路的IQ失衡补偿方法，包括步骤：对于发射通路，将发射基带TX Baseband输出的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到数模转换器DAC；或者，对于接收通路，将模数转换器ADC接收到的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到接收基带RX Baseband；其中，所述FD-IQMC用于对输入的IQ信号，根据前述发射通路或接收通路的IQ不平衡参数估计值，通过频率无关的IQ失衡补偿模块FI-iqmc对输入的I路信号和Q路信号选取一个频点的幅度和相位误差进行单点补偿以对IQ失衡进行一个频率无关的整体补偿；以及，对从FI-iqmc中输出的I路信号和Q路信号，选择其中一路信号输入到分数时延滤波器Frac-delay filter中进行相位补偿以补偿频率选择性相位上的失衡，再将从Frac-delayfilter输出的信号输入到实数对称的幅度滤波器Amp-FIR filter中进行幅度补偿以补偿频率选择性幅度上的失衡；未被选择的另一路信号则通过时延模块进行处理以与选择的一路信号进行时间对齐。进一步，对于前述发射通路或接收通路的IQ不平衡参数估计值，通过单音测试获取；多个频点的单音对应有多个频点的IQ不平衡参数估计值。进一步，所述FI-iqmc被配置为执行如下步骤：对于信号x＝cos+jsin，其中j为复数表示，根据IQ不平衡参数估计值中的相位不平衡因子Δφ和幅度不平衡因子Δm，令I路信号需要的补偿相位和补偿幅度分别为-Δφ/2和-Δm/2，Q路信号需要的补偿相位和补偿幅度分别为Δφ/2和Δm/2，通过以下补偿算法对IQ失衡进行整体补偿，其中，x表示输入FI-iqmc的IQ信号，Mcomp表示相位和幅度的补偿矩阵。进一步，当前述Δφ小于预设值时，令sin等于Δφ，cos等于1，带入前述补偿矩阵Mcomp中得到简化后的M’comp，通过以下补偿算法对IQ失衡进行整体补偿，此时，所述FI-iqmc通过4个乘法器对输入的IQ信号进行一个矩阵乘法以补偿频率无关的IQ失衡。进一步，通过分数时延滤波器Frac-delay filter对FI-iqmc输出的I路信号或Q路信号进行相位补偿的步骤如下：通过多个频点的单音测试，获取宽带内采样频点的相位误差；对获取的相位误差，进行线性拟合；对线性拟合后的相位误差，通过如下公式计算宽带内的相位误差群时延Groupdelay，其中，Δφ为Δω频段内的相位误差变化，radian表示弧度；根据计算得到的群时延Group delay的值计算需要补偿的分数时延样点值，基于需要补偿的分数时延样点值通过拉格朗日插值法设计分数时延滤波器的分数时延值；根据设计的分数时延滤波器对选择的I路信号或Q路信号进行相位补偿，得到相位补偿后的I路信号或Q路信号。进一步，在前述Frac-delay filter对FI-iqmc输出的I路信号或Q路信号进行相位补偿时，将未被选择的另一路信号输入到第一时延模块D1中进行时延处理以使两路信号的时间对齐。进一步，通过实数对称的幅度滤波器Amp-FIR filter对Frac-delay filter输出的信号进行幅度补偿的步骤如下：通过多个频点的单音测试，获取宽带内采样频点的幅度误差；对正负频率对称的频点的幅度误差，进行取平均操作；设计一个阶数为N的实数滤波器，其滤波器频点的幅度误差参数通过测试频点的分段线性内插获取，所述N为2的整数倍；根据前述滤波器频点的幅度误差参数，通过快速傅里叶逆变换方式计算前述实数滤波器的滤波系数，所述滤波系数为实数且系数对称；通过前述滤波系数对改前述信号进行滤波处理，得到幅度补偿后的信号。进一步，在前述Amp-FIR filter对Frac-delay filter输出的信号进行幅度补偿时，将从第一时延模块D1中输出的信号输入到第二时延模块D2中进行时延处理以使两路信号的时间对齐。本发明还提供了一种用于WiFi宽带收发通路的IQ失衡三级补偿系统，所系统包括一个频率相关的IQ失衡补偿装置FD-IQMC，所述FD-IQMC设置在发射通路中用于对待输入数模转换器DAC的IQ信号进行预补偿处理，或者所述FD-IQMC设置在接收通路中用于对模数转换器ADC输出的IQ信号进行后补偿处理；所述频率相关的IQ失衡补偿装置FD-IQMC被配置为：对于输入的IQ信号，根据前述发射通路或接收通路的IQ不平衡参数估计值，通过频率无关的IQ失衡补偿模块FI-iqmc对输入的I路信号和Q路信号选取一个频点的幅度和相位误差进行单点补偿以对IQ失衡进行一个频率无关的整体补偿；以及，对从FI-iqmc中输出的I路信号和Q路信号，选择其中一路信号输入到分数时延滤波器Frac-delay filter中进行相位补偿以补偿频率选择性相位上的失衡，再将从Frac-delay filter输出的信号输入到实数对称的幅度滤波器Amp-FIRfilter中进行幅度补偿以补偿频率选择性幅度上的失衡；未被选择的另一路信号则通过时延模块进行处理以与选择的一路信号进行时间对齐。本发明还提供了一种用于WiFi宽带收发通路的IQ失衡补偿方法，对于发射通路，将发射基带TX Baseband输出的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到数模转换器DAC；或者，对于接收通路，将模数转换器ADC接收到的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到接收基带RX Baseband；其中，所述FD-IQMC用于对输入的IQ信号，根据前述发射通路或接收通路的IQ不平衡参数估计值，通过频率无关的IQ失衡补偿模块FI-iqmc对输入的I路信号和Q路信号选取一个频点的幅度和相位误差进行单点补偿以对IQ失衡进行一个频率无关的整体补偿；以及，对从FI-iqmc中输出的I路信号和Q路信号，选择其中一路信号输入到单路滤波器进行处理以补偿频率选择性的相位和幅度，所述单路滤波器的滤波器系数是将分数时延滤波器系数和幅度滤波器系数卷积后生成，其相频响应能够补偿分数时延，幅频响应能够补偿幅度误差，所述单路滤波器的滤波器系数为实数非对称形式；未被选择的另一路信号则通过时延模块进行处理以与选择的一路信号进行时间对齐。本发明还提供了一种用于WiFi宽带收发通路的IQ失衡补偿系统，所述系统包括一个频率相关的IQ失衡补偿装置FD-IQMC，所述FD-IQMC设置在发射通路中用于对待输入数模转换器DAC的IQ信号进行预补偿处理，或者所述FD-IQMC设置在接收通路中用于对模数转换器ADC输出的IQ信号进行后补偿处理；所述频率相关的IQ失衡补偿装置FD-IQMC被配置为：对于输入的IQ信号，根据前述发射通路或接收通路的IQ不平衡参数估计值，通过频率无关的IQ失衡补偿模块FI-iqmc对输入的I路信号和Q路信号选取一个频点的幅度和相位误差进行单点补偿以对IQ失衡进行一个频率无关的整体补偿；以及，对从FI-iqmc中输出的I路信号和Q路信号，选择其中一路信号输入到单路滤波器进行处理以补偿频率选择性的相位和幅度，所述单路滤波器的滤波器系数是将分数时延滤波器系数和幅度滤波器系数卷积后生成，其相频响应能够补偿分数时延，幅频响应能够补偿幅度误差，所述单路滤波器的滤波器系数为实数非对称形式；未被选择的另一路信号则通过时延模块进行处理以与选择的一路信号进行时间对齐。本发明由于采用以上技术方案，与现有技术相比，作为举例，具有以下的优点和积极效果：所述IQ失衡补偿方法，通过频率相关的IQ失衡补偿装置FD-IQMC对IQ信号进行IQ失衡补偿，其中FD-IQMC包括非频选补偿结构和分别对应相位和幅度的频选补偿结构，在发射通路基于预补偿方式进行IQ失衡补偿，在接收通路基于后补偿方式进行IQ失衡补偿。通过上述补偿方法进行宽带的IQ校准，能够补偿具有频率选择性的IQ失衡，本发明具有结构易于控制、资源开销低、补偿精度高的优点，能够有效降低镜像抑制比IRR、EVM恶化和误码率等指标，提升通信质量。附图说明图1为现有技术中的TX零中频模型示意图。图2为现有技术中的RX零中频模型示意图。图3为实测的宽带IQ幅度误差的分布图。图4为实测的宽带IQ相位误差的分布图。图5为本发明实施例提供的发射通路IQ失衡补偿结构的逻辑结构图。图6为本发明实施例提供的接收通路IQ失衡补偿结构的逻辑结构图。图7为本发明实施例提供的补偿前后的IQ幅度误差变化图。图8为本发明实施例提供的补偿前后的IQ相位误差变化图。图9为本发明实施例提供的补偿前后的镜像抑制比IRR变化图。具体实施方式以下结合附图和具体实施例对本发明公开的用于WiFi宽带收发通路的IQ失衡补偿方法及应用作进一步详细说明。应当注意的是，下述实施例中描述的技术特征或者技术特征的组合不应当被认为是孤立的，它们可以被相互组合从而达到更好的技术效果。在下述实施例的附图中，各附图所出现的相同标号代表相同的特征或者部件，可应用于不同实施例中。因此，一旦某一项在一个附图中被定义，则在随后的附图中不需要对其进行进一步讨论。需说明的是，本说明书所附图中所绘示的结构、比例、大小等，均仅用以配合说明书所揭示的内容，以供熟悉此技术的人士了解与阅读，并非用以限定发明可实施的限定条件，任何结构的修饰、比例关系的改变或大小的调整，在不影响发明所能产生的功效及所能达成的目的下，均应落在发明所揭示的技术内容所能涵盖的范围内。本发明的优选实施方式的范围包括另外的实现，其中可以不按所述的或讨论的顺序，包括根据所涉及的功能按基本同时的方式或按相反的顺序，来执行功能，这应被本发明的实施例所属技术领域的技术人员所理解。对于相关领域普通技术人员已知的技术、方法和设备可能不作详细讨论，但在适当情况下，所述技术、方法和设备应当被视为说明书的一部分。在这里示出和讨论的所有示例中，任何具体值应被解释为仅仅是示例性的，而不是作为限制。因此，示例性实施例的其它示例可以具有不同的值。实施例本发明提供了一种用于WiFi宽带收发通路的IQ失衡补偿方法，通过在信号数字处理通路中设置一个频率相关的IQ失衡补偿装置FD-IQMC来实现频率相关的IQ补偿，其适用于发射和接收通路的频率选择性IQ失衡补偿。对于发射通路，参见图5所示，将发射基带TX Baseband输出的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到数模转换器DAC。对于接收通路，参见图6所示，将模数转换器ADC接收到的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到接收基带RX Baseband。本实施例中，发射通路和接收通路的IQ不平衡参数的估计值，可以通过单音测试获取。具体的，发送单音信号，采集环路信号，通过相关计算法估计IQ不平衡参数，所述IQ不平衡参数具体可以包括幅度不平衡因子、相位不平衡因子。不同频点的单音对应不同的IQ不平衡参数估计值，多个频点的单音测试就可以获取多个频点的IQ不平衡参数估计值。发射通过和接收通路的参数估计值通过切换内部电路开关分别测量。在一个优选的实施方式中，所述频率相关的IQ失衡补偿装置FD-IQMC采用三级补偿结构，包括级联的第一级非频选补偿结构、第二级相位滤波器结构和第三级幅度滤波器结构。对输入FD-IQMC装置中的IQ信号，根据前述发射通路或接收通路的IQ不平衡的参数估计值，依次通过第一级非频选补偿结构、第二级相位滤波器结构和第三级幅度滤波器结构进行处理。具体的，所述第一级非频选补偿结构为频率无关的IQ失衡补偿模块FI-iqmc。继续参见图5和6所示，IQ信号的I路信号和Q路信号输入到FI-iqmc中，选取一个频点的幅度和相位误差进行单点补偿，以对IQ失衡进行一个频率无关的整体补偿。单音信号可以表示为x＝cos+jsin，其中j为复数表示，FI-iqmc的整体补偿原理如下。对于单音信号x＝cos+jsin，通过单音测试获取的IQ不平衡参数估计值中的相位不平衡因子为Δφ，幅度不平衡因子为Δm，由于IQ失衡，令I路和Q路需要补偿的相位分别为-Δφ/2和Δφ/2，则补偿相位后的信号表达式为：令I路和Q路需要补偿的幅度分别为-Δm/2和Δm/2，则补偿幅度后的信号表达式为：则经过相位和幅度补偿后的信号表达式为：可以得到补偿矩阵Mcomp的计算公式为：可以得到FI-iqmc的补偿算法为：其中，x表示输入FI-iqmc的IQ信号，Mcomp表示相位和幅度的补偿矩阵。本实施例中，考虑到前述相位不平衡因子Δφ一般比较小，而当Δφ较小时，sin≈Δφ，Cos≈1，因此对Mcomp进行简化以降低补偿结构资源开销。具体实施时，可以将前述Δφ与预设值进行比较，当Δφ小于预设值时，可以令sin等于Δφ，cos等于1，即有sin等于Δφ/2，cos等于1，带入前述补偿矩阵Mcomp中，可得到如下公式：由于Δφ较小，式子的乘积值也非常小，令＝0，可以得到简化后的补偿矩阵M’comp：即通过以下补偿算法对IQ失衡进行整体补偿：此时，在所述频率无关的IQ失衡补偿模块FI-iqmc，通过使用4个乘法器对输入的信号进行一个矩阵乘法，就可以补偿频率无关的IQ失衡。从FI-iqmc模块中输出的I路信号和Q路信号，从其中选择一路信号依次输入到第二级相位滤波器结构和第三级幅度滤波器结构进行处理，未被选择的另一路信号则通过时延模块进行延时处理以与选择的一路信号进行时间对齐。本实施例中，所述第二级相位滤波器结构为分数时延滤波器Frac-delayfilter，可以对信号进行相位补偿以补偿频率选择性相位上的失衡。对于DAC/ADC、低通滤波器、IQ放大器等零中频结构，其IQ失衡的频率选择性相位误差的表现一般为线性，即在宽带内的IQ相位误差呈现相位变化或近似相位变化，利用上述线性特性，本实施例在设置相位滤波器结构时，通过分数时延滤波器Frac-delay filter来补偿这种相位上的不均衡。所述分数时延滤波器Frac-delay filter采用单路滤波器，只对I路和Q路中的一路进行补偿处理。具体的，通过分数时延滤波器Frac-delay filter模块对FI-iqmc输出的I路信号或Q路信号进行相位补偿的步骤如下。S211，通过多个频点的单音测试，获取宽带内采样频点的相位误差。S212，对获取的相位误差，进行线性拟合。S213，对线性拟合后的相位误差，通过如下公式计算宽带内的相位误差群时延Group delay，计算公式如下：其中，Δφ为Δω频段内的相位误差变化，radian表示弧度。S214，根据计算得到的群时延Group delay的值计算需要补偿的分数时延样点值，基于需要补偿的分数时延样点值通过拉格朗日插值法设计分数时延滤波器的分数时延值；S215，根据设计的分数时延滤波器对选择的I路信号或Q路信号进行相位补偿，得到相位补偿后的I路信号或Q路信号。在前述Frac-delay filter模块对FI-iqmc输出的I路信号或Q路信号进行相位补偿时，将未被选择的另一路信号输入到第一时延模块D1中进行时延处理以使两路信号的时间对齐。参见图5和图6，示例了通过Frac-delay filter模块对Q路信号进行处理，即选择Q路信号，则I路信号输入到第一时延模块D1中进行时延处理以使两路信号的时间对齐。从Frac-delay filter模块输出的信号，再输入到第三级幅度滤波器结构进行处理。本实施例中，所述第三级幅度滤波器结构为实数对称的幅度滤波器Amp-FIRfilter，可以对信号进行幅度补偿以补偿频率选择性幅度上的失衡。对于DAC/ADC、低通滤波器、IQ放大器等零中频结构，其IQ失衡的频率选择性幅度误差一般表现为偶函数分布，即表现为正负频率双边对称特性，利用上述对称性特性，本实施例在设置幅度滤波器结构时，采用实数对称的幅度滤波器Amp-FIR filter用来补偿这种幅度上的不均衡；相比常规的直接使用复数滤波器进行补偿，本实施例在保证性能精度符合要求的同时，能显著降低资源开销和芯片面积。具体的，通过实数对称的幅度滤波器Amp-FIR filter对Frac-delay filter输出的信号进行幅度补偿的步骤如下。S311，通过多个频点的单音测试，获取宽带内采样频点的幅度误差。S312，对正负频率对称的频点的幅度误差，进行取平均操作。S313，设计一个阶数为N的实数滤波器，其滤波器频点的幅度误差参数通过测试频点的分段线性内插获取，所述N一般为2的整数倍。S314，根据前述滤波器频点的幅度误差参数，通过快速傅里叶逆变换方式计算前述实数滤波器的滤波系数，所述滤波系数为实数且系数对称。S315，通过前述滤波系数对改前述信号进行滤波处理，得到幅度补偿后的信号。继续参见图5和6所示，在前述Amp-FIR filter模块对Frac-delay filter输出的相位补偿后的Q路信号进行幅度补偿时，将从第一时延模块D1中输出的I路信号输入到第二时延模块D2中进行时延处理以使两路信号的时间对齐。本发明提供的上述技术方案，基于宽带中的单音信号测试方法进行IQ不平衡参数估计，采用时域补偿方法，不需要特定的训练序列，也不使用宽带信号进行大量计算统计，且时域补偿比频域补偿方式更稳定；同时，利用DAC/ADC、低通滤波器、IQ放大器等零中频结构的特性规律，设计级联的实数滤波器补偿方法，与常规的采用复数滤波器相比，降低了资源开销和芯片面积，同时性能精度能够保证。本发明的另一实施例，还提供了基于前述方法的一种用于WiFi宽带收发通路的IQ失衡三级补偿系统。所系统包括一个频率相关的IQ失衡补偿装置FD-IQMC，所述FD-IQMC设置在发射通路中用于对待输入数模转换器DAC的IQ信号进行预补偿处理，或者所述FD-IQMC设置在接收通路中用于对模数转换器ADC输出的IQ信号进行后补偿处理。所述频率相关的IQ失衡补偿装置FD-IQMC被配置为：对于输入的IQ信号，根据前述发射通路或接收通路的IQ不平衡参数，通过频率无关的IQ失衡补偿模块FI-iqmc对输入的I路信号和Q路信号选取一个频点的幅度和相位误差进行单点补偿以对IQ失衡进行一个频率无关的整体补偿，所述IQ不平衡参数包括相位误差和幅度误差信息；以及，对从FI-iqmc中输出的I路信号和Q路信号，选择其中一路信号输入到分数时延滤波器Frac-delay filter中进行相位补偿以补偿频率选择性相位上的失衡，再将从Frac-delay filter输出的信号输入到实数对称的幅度滤波器Amp-FIR filter中进行幅度补偿以补偿频率选择性幅度上的失衡；未被选择的另一路信号则通过时延模块进行处理以与选择的一路信号进行时间对齐。通过上述实施例提供的三级补偿系统，就可以将宽带IQ失衡补偿掉，发射通路使用预补偿方式，接收通路通过后补偿方式。从资源开销上，本实施例的第一级非频选补偿相当于一阶结构，只需要四个乘法器完成；第二级相位滤波器，只需要几阶便可以达到分数时延的精度要求；第三级幅度滤波器，阶数和单音测试精度需求以及系统采样率有关，经实测一般16阶至32阶也可满足需求。本实施例具有结构清晰易于控制，资源使用量低，补偿精度高，对于IRR，EVM和误码率等有明显提升，参见图7至图9中示例的实测中的补偿前后的相位误差、幅度误差和IRR的变化。其它技术特征参考在前实施例，在此不再赘述。本发明的另一实施例中，还可以将第二级相位滤波器和第三级幅度滤波器合并，设计一个具有分数时延、且具有幅度补偿效果的单路滤波器FIR模块。与前述实施例的区别仅在于频率相关的IQ失衡补偿装置FD-IQMC内部的第二级相位滤波器和第三级幅度滤波器合并为一个模块了，对应的，图5和图6中的时延模块也调整为一个，其它技术特征不变。具体的，提供了一种用于WiFi宽带收发通路的IQ失衡补偿方法。对于发射通路，将发射基带TX Baseband输出的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到数模转换器DAC。对于接收通路，将模数转换器ADC接收到的IQ信号输入到频率相关的IQ失衡补偿装置FD-IQMC中进行频率相关的IQ失衡补偿，将补偿后的输出信号I’Q’输入到接收基带RXBaseband。其中，所述FD-IQMC用于对输入的IQ信号，根据前述发射通路或接收通路的IQ不平衡参数，通过频率无关的IQ失衡补偿模块FI-iqmc对输入的I路信号和Q路信号选取一个频点的幅度和相位误差进行单点补偿以对IQ失衡进行一个频率无关的整体补偿，所述IQ不平衡参数包括相位误差和幅度误差信息；以及，对从FI-iqmc中输出的I路信号和Q路信号，选择其中一路信号输入到单路滤波器进行处理以补偿频率选择性的相位和幅度，所述单路滤波器的滤波器系数是将分数时延滤波器系数和幅度滤波器系数卷积后生成，其相频响应能够补偿分数时延，幅频响应能够补偿幅度误差，所述单路滤波器的滤波器系数为实数非对称形式；未被选择的另一路信号则通过时延模块进行处理以与选择的一路信号进行时间对齐。此时，频率相关的IQ失衡补偿装置FD-IQMC被配置为二级补偿结构，IQ信号经第一级的FI-iqmc模块整体补偿后，从I路信号和Q路信号中选择一路信号输入到第二级的单路滤波器FIR模块进行补偿处理，该单路滤波器可以补偿频选的相位和幅度。作为举例，比如选择Q路信号进入单路滤波器进行频选的相位和幅度补偿，未被选择的另一路信号——即I路信号，则通过一个时延模块进行处理以与选择的Q路信号进行时间对齐。具体的，所述单路滤波器的滤波器系数是将分数时延滤波器系数和幅度滤波器系数卷积后生成，其相频响应可以补偿分数时延、幅频响应可以补偿幅度误差。该单路滤波器包含合并前两个滤波器的特性。作为举例，比如令分数时延滤波器系数为H1，幅度滤波器系数为H2，则单路滤波器的滤波器系数H＝conv，函数conv表示返回系数H1，H2的卷积，H就是卷积后的滤波器系数。对系数H1和H2进行卷积运算可以基于软件来计算，然后计算结果配置到存储器RAM中。相比于前述实施例的三级补偿结构，将分数时延和幅度补偿合并到一个单路滤波器进行补偿处理后，滤波器系数H会变成实数非对称形式，相比于实数对称的滤波器，资源开销会有所增加，本领域技术人员可根据需求进行适应性选择。需要说明的是，所述合并方案与常规的采用复数滤波器相比，资源开销仍然较小。对应前述第二级相位滤波器和第三级幅度滤波器的合并方案，本发明还提供了一种用于WiFi宽带收发通路的IQ失衡补偿系统，该补偿系统为FI-iqmc模块加单路滤波器的二级补偿结构。所述系统包括一个频率相关的IQ失衡补偿装置FD-IQMC，所述FD-IQMC设置在发射通路中用于对待输入数模转换器DAC的IQ信号进行预补偿处理，或者所述FD-IQMC设置在接收通路中用于对模数转换器ADC输出的IQ信号进行后补偿处理。所述频率相关的IQ失衡补偿装置FD-IQMC被配置为：对于输入的IQ信号，根据前述发射通路或接收通路的IQ不平衡参数估计值，通过频率无关的IQ失衡补偿模块FI-iqmc对输入的I路信号和Q路信号选取一个频点的幅度和相位误差进行单点补偿以对IQ失衡进行一个频率无关的整体补偿；以及，对从FI-iqmc中输出的I路信号和Q路信号，选择其中一路信号输入到单路滤波器进行处理以补偿频率选择性的相位和幅度，所述单路滤波器的滤波器系数是将分数时延滤波器系数和幅度滤波器系数卷积后生成，其相频响应能够补偿分数时延，幅频响应能够补偿幅度误差，所述单路滤波器的滤波器系数为实数非对称形式；未被选择的另一路信号则通过时延模块进行处理以与选择的一路信号进行时间对齐。其它技术特征参考在前实施例，在此不再赘述。在上面的描述中，本发明的公开内容并不旨在将其自身限于这些方面。而是，在本公开内容的目标保护范围内，各组件可以以任意数目选择性地且操作性地进行合并。结合本文中所公开的实施例描述的方法或算法的步骤可以直接用硬件、处理器执行的软件模块，或者二者的结合来实施。软件模块可以置于随机存储器、内存、只读存储器、电可编程ROM、电可擦除可编程ROM、寄存器、硬盘、可移动磁盘、CD-ROM、或技术领域内所公知的任意其它形式的存储介质中。另外，像“包括”、“囊括”以及“具有”的术语应当默认被解释为包括性的或开放性的，而不是排他性的或封闭性，除非其被明确限定为相反的含义。所有技术、科技或其他方面的术语都符合本领域技术人员所理解的含义，除非其被限定为相反的含义。在词典里找到的公共术语应当在相关技术文档的背景下不被太理想化或太不实际地解释，除非本公开内容明确将其限定成那样。本发明领域的普通技术人员根据上述揭示内容做的任何变更、修饰，均属于权利要求书的保护范围。
