标题title
一种无损高效的RDMA传送方法
摘要abst
本发明涉及网络传输技术领域，且公开了一种无损高效的RDMA传送方法，所述传送方法包括RDMA数据包重传和RDMA智能流控机制，所述RDMA智能流控机制包括有链路状态反馈机制和流量控制机制；所述RDMA数据包重传包括以下步骤：S1、发送节点维护发送窗口，记录当前待发送及已发送为收到确认的数据包编号；S2、依窗口记录的编号顺序依次向接受方发送数据包；S3、接受方收到数据后，构建确认数据包。该无损高效的RDMA传送方法，通过研究在广域分布式网络环境下，将网络拓扑、流量特征、机器学习的传输特征实现有机的整合，提出一种无损高效的RDMA传送技术，通过精细化拥塞控制与流控制策略来最大化带宽利用率解决数据处理效率低和传输时延过长问题。
权利要求书clms
1.一种无损高效的RDMA传送方法，其特征在于：所述传送方法包括RDMA数据包重传和RDMA智能流控机制，所述RDMA智能流控机制包括有链路状态反馈机制和流量控制机制；所述RDMA数据包重传包括以下步骤：S1、发送节点维护发送窗口，记录当前待发送及已发送为收到确认的数据包编号；S2、依窗口记录的编号顺序依次向接受方发送数据包；S3、接受方收到数据后，构建确认数据包；S4、送方收到确认数据包后，根据确认数据包中的确认位更新发送窗口，并计算每个数据发的发送延迟，并根据期待位发送对应的数据；S5、发送方计算最近N个数据的平均发送延迟T，及方差delta；S6、发送方以时间阈值k为周期，遍历窗口内所有数据包，对于当前遍历的数据包，如果属于数据已经发送且尚未收到确认，计算其确认等待时延W，如果W大于或者等于T+delta，重新发送该数据，并将其发送时间更新为当前时间。2.根据权利要求1所述的一种无损高效的RDMA传送方法，其特征在于：所述步骤S3中，确认位记录当前已经收到且尚未发送确认信息的数据包编号，以及希望立刻收到的数据包的编号，并将该数据包发送给发送方。3.根据权利要求1所述的一种无损高效的RDMA传送方法，其特征在于：所述发送延迟为收到确认包的时间减去数据发送的时间，所述等待时延为当前时间减去数据发送时间。4.根据权利要求1所述的一种无损高效的RDMA传送方法，其特征在于：所述链路状态反馈机制包括以下步骤：S1、当出现超过参数x个数据包超时没有收到确认包时，发送方发送链路状态咨询包；S2、网络链路中的每一跳交换节点，如果能够理解该数据包，则构建被动反馈包，将本交换节点的处理速度、转发队列长度等信息加入被动反馈包，并将被动反馈包发送给发送方；S3、交换节点将咨询包发送给下一跳节点；S4、每一跳交换节点当前处理速度超过低于阈值，或者转发队列长度高于阈值时，构建主动反馈包，将处理速度及转发队列长度加入主动反馈包，并发送给控制模块。5.根据权利要求1所述的一种无损高效的RDMA传送方法，其特征在于：所述流量控制机制包括以下步骤：S1、收到被动反馈包后，判断发生拥塞的链路数目；S2、收到主动反馈包后，由控制模块判断发生拥塞的链路数据超过阈值，如果没有超过阈值，调整路由策略，避开拥塞链路，否则，给发送方发送控制数据包；S3、发送方收到控制数据包后，降低准备发送给该接收方数据的优先级，降低数据发送速度，将该接受方加入管控队列；S4、以m为时间周期轮训管控队列，对于管控队列当前接收方，其当前数据确认等待时延降低至阈值时，提升该接收方数据发送优先级，提升数据发送速度。6.根据权利要求5所述的一种无损高效的RDMA传送方法，其特征在于：所述步骤S2中，如果发生拥塞的链路数据超过阈值，则降低对应接收方数据包的优先级，降低数据发送速度，将该接收方加入管控队列，否则，将信息发送给控制模块，由控制模块调整路由策略，避开拥塞链路。
说明书desc
技术领域本发明涉及网络传输技术领域，具体为一种无损高效的RDMA传送方法。背景技术分布式网络环境下机器学习跨域数据传输爆炸式增长，为了降低网络延迟，提高处理效率，RDMA技术允许用户态的应用程序直接读取和写入远程内存，而无需CPU介入多次拷贝内存，并可绕过内核直接向网卡写数据，实现了高吞吐量、超低时延和低CPU开销的效果。当前RDMA在以太网上的传输协议是RoCEv2，但其不像TCP协议那样有滑动窗口、确认应答等机制来实现可靠传输，一旦出现丢包，依靠上层应用检查到了再做重传，会大大降低RDMA的传输效率，导致了基于优先级的流量控制传输的远程直接数据存取网络抖动与乱序激增等问题。随着分布式网络乱序、丢包和拥塞的出现，当前RDMA技术的丢包重传机制导致重传流量占比直线上升，造成RDMA性能下降，进而导致了数据处理效率低和传输时延过长，为此我们提出了一种无损高效的RDMA传送方法。发明内容针对现有技术的不足，本发明提供了一种无损高效的RDMA传送方法，研究在广域分布式网络环境下，将网络拓扑、流量特征、机器学习的传输特征实现有机的整合，提出一种无损高效的RDMA传送技术，通过精细化拥塞控制与流控制策略来最大化带宽利用率解决数据处理效率低和传输时延过长问题。为实现上述目的，本发明提供如下技术方案：一种无损高效的RDMA传送方法，所述传送方法包括RDMA数据包重传和RDMA智能流控机制，所述RDMA智能流控机制包括有链路状态反馈机制和流量控制机制。所述RDMA数据包重传包括以下步骤：S1、发送节点维护发送窗口，记录当前待发送及已发送为收到确认的数据包编号。S2、依窗口记录的编号顺序依次向接受方发送数据包。S3、接受方收到数据后，构建确认数据包。S4、送方收到确认数据包后，根据确认数据包中的确认位更新发送窗口，并计算每个数据发的发送延迟，并根据期待位发送对应的数据。S5、发送方计算最近N个数据的平均发送延迟T，及方差delta。S6、发送方以时间阈值k为周期，遍历窗口内所有数据包，对于当前遍历的数据包，如果属于数据已经发送且尚未收到确认，计算其确认等待时延W，如果W大于或者等于T+delta，重新发送该数据，并将其发送时间更新为当前时间。优选的，所述步骤S3中，确认位记录当前已经收到且尚未发送确认信息的数据包编号，以及希望立刻收到的数据包的编号，并将该数据包发送给发送方。优选的，所述发送延迟为收到确认包的时间减去数据发送的时间，所述等待时延为当前时间减去数据发送时间。优选的，所述链路状态反馈机制包括以下步骤：S1、当出现超过参数x个数据包超时没有收到确认包时，发送方发送链路状态咨询包。S2、网络链路中的每一跳交换节点，如果能够理解该数据包，则构建被动反馈包，将本交换节点的处理速度、转发队列长度等信息加入被动反馈包，并将被动反馈包发送给发送方。S3、交换节点将咨询包发送给下一跳节点。S4、每一跳交换节点当前处理速度超过低于阈值，或者转发队列长度高于阈值时，构建主动反馈包，将处理速度及转发队列长度加入主动反馈包，并发送给控制模块。优选的，所述流量控制机制包括以下步骤：S1、收到被动反馈包后，判断发生拥塞的链路数目。S2、收到主动反馈包后，由控制模块判断发生拥塞的链路数据超过阈值，如果没有超过阈值，调整路由策略，避开拥塞链路，否则，给发送方发送控制数据包。S3、发送方收到控制数据包后，降低准备发送给该接收方数据的优先级，降低数据发送速度，将该接受方加入管控队列。S4、以m为时间周期轮训管控队列，对于管控队列当前接收方，其当前数据确认等待时延降低至阈值时，提升该接收方数据发送优先级，提升数据发送速度。优选的，所述步骤S2中，如果发生拥塞的链路数据超过阈值，则降低对应接收方数据包的优先级，降低数据发送速度，将该接收方加入管控队列，否则，将信息发送给控制模块，由控制模块调整路由策略，避开拥塞链路。有益效果如下：该无损高效的RDMA传送方法，通过研究在广域分布式网络环境下，将网络拓扑、流量特征、机器学习的传输特征实现有机的整合，提出一种无损高效的RDMA传送技术，通过精细化拥塞控制与流控制策略来最大化带宽利用率解决数据处理效率低和传输时延过长问题。具体实施方式基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。本发明提供一种技术方案：一种无损高效的RDMA传送方法，传送方法包括RDMA数据包重传和RDMA智能流控机制，RDMA智能流控机制包括有链路状态反馈机制和流量控制机制。1.RDMA数据包重传技术1.1发送节点维护发送窗口，记录当前待发送及已发送为收到确认的数据包编号。1.2依窗口记录的编号顺序依次向接受方发送数据包。1.3接受方收到数据后，构建确认数据包，数据包包括确认位和期待位，其中确认位记录当前已经收到且尚未发送确认信息的数据包编号，以及希望立刻收到的数据包的编号，并将该数据包发送给发送方。1.4发送方收到确认数据包后，根据确认数据包中的确认位更新发送窗口，并计算每个数据发的发送延迟，并根据期待位发送对应的数据。1.5发送方计算最近N个数据的平均发送延迟T，及方差delta。1.6发送方以时间阈值k为周期，遍历窗口内所有数据包，对于当前遍历的数据包，如果属于数据已经发送且尚未收到确认，计算其确认等待时延W，如果W大于或者等于T+delta，重新发送该数据，并将其发送时间更新为当前时间。2.RDMA智能流控机制2.1链路状态反馈机制2.1.1当出现超过参数x个数据包超时没有收到确认包时，发送方发送链路状态咨询包。2.1.2网络链路中的每一跳交换节点，如果能够理解该数据包，则构建被动反馈包，将本交换节点的处理速度、转发队列长度等信息加入被动反馈包，并将被动反馈包发送给发送方。2.1.3交换节点将咨询包发送给下一跳节点。2.1.4每一跳交换节点当前处理速度超过低于阈值，或者转发队列长度高于阈值时，构建主动反馈包，将处理速度及转发队列长度加入主动反馈包，并发送给控制模块。2.2流量控制机制2.2.1收到被动反馈包后，判断发生拥塞的链路数目，如果发生拥塞的链路数据超过阈值，则降低对应接收方数据包的优先级，降低数据发送速度，将该接收方加入管控队列，否则，将信息发送给控制模块，由控制模块调整路由策略，避开拥塞链路。2.2.2收到主动反馈包后，由控制模块判断发生拥塞的链路数据超过阈值，如果没有超过阈值，调整路由策略，避开拥塞链路，否则，给发送方发送控制数据包。2.2.3发送方收到控制数据包后，降低准备发送给该接收方数据的优先级，降低数据发送速度，将该接受方加入管控队列。2.2.4以m为时间周期轮训管控队列，对于管控队列当前接收方，其当前数据确认等待时延降低至阈值时，提升该接收方数据发送优先级，提升数据发送速度。尽管已经示出和描述了本发明的实施例，对于本领域的普通技术人员而言，可以理解在不脱离本发明的原理和精神的情况下可以对这些实施例进行多种变化、修改、替换和变型，本发明的范围由所附权利要求及其等同物限定。
