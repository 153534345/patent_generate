标题title
一种以太网自协商方法、设备、存储介质
摘要abst
本申请提供一种以太网自协商方法、设备、存储介质，该方法包括：通过物理层检测链路连接状态；根据检测到的链路连接状态确定以太网自协商方案；基于以太网协商方案进行以太网自协商。本申请在以太网自协商之前通过物理层检测链路连接状态，根据检测到的链路连接状态确定以太网自协商方案，实现了基于链路连接状态的以太网自协商方案动态调整，避免了现有技术中必须从1000M开始向下协商导致的协商时间较长问题。
权利要求书clms
1.一种以太网自协商方法，其特征在于，所述方法包括：通过物理层检测链路连接状态；根据检测到的链路连接状态确定以太网自协商方案；基于所述以太网协商方案进行以太网自协商。2.根据权利要求1所述的方法，其特征在于，所述链路包括4个差分对；其中，两个差分对为第一类差分对，另外两个差分对为第二类差分对；第一类差分对的状态对与第二类差分对的状态均正常时支持1000兆工作模式，仅第二类差分对状态正常时支持100兆和10兆工作模式。3.根据权利要求2所述的方法，其特征在于，链路连接状态包括第一类差分对状态和第二类差分对状态；所述通过物理层检测链路连接状态，包括：通过物理层检测各差分对的网线与连接器连接情况；根据所述连接情况确定各差分对状态；其中，任一差分对状态为正常或异常；根据各差分对状态确定第一类差分对状态和第二类差分对状态；其中，任一类差分对状态为正常或异常。4.根据权利要求3所述的方法，其特征在于，所述根据各差分对状态确定第一类差分对状态和第二类差分对状态，包括：对于任一类差分对，若属于所述任一类差分对的两个差分对均正常时，所述任一类差分对状态为正常，否则，所述任一类差分对状态为异常。5.根据权利要求3所述的方法，其特征在于，所述根据检测到的链路连接状态确定以太网自协商方案，包括：若第二类差分对状态为异常，则确定以太网自协商方案为不进行以太网自协商。6.根据权利要求5所述的方法，其特征在于，所述方法还包括：若第二类差分对状态为异常，则提示以太网自协商方案确定依据为端口不能正常工作。7.根据权利要求3所述的方法，其特征在于，所述根据检测到的链路连接状态确定以太网自协商方案，包括：若第二类差分对状态为正常，但第一类差分对状态为异常，则确定以太网自协商方案为跳过1000兆模式的协商，从100兆模式开始协商。8.根据权利要求7所述的方法，其特征在于，所述方法还包括：若第二类差分对状态为正常，但第一类差分对状态为异常，则提示以太网自协商方案确定依据为1000兆模式使用的两个差分对异常。9.根据权利要求3所述的方法，其特征在于，所述根据检测到的链路连接状态确定以太网自协商方案，包括：若第二类差分对状态为正常，且第一类差分对状态也为正常，则确定以太网自协商方案为从1000兆模式开始协商。10.根据权利要求3所述的方法，其特征在于，所述通过物理层检测各差分对的网线与连接器连接情况，包括：控制物理层进入copper模式；在所述copper模式中访问物理层地址空间，关闭睡眠模式，对各差分对进行测试；根据所述测试结果确定各差分对的网线与连接器连接情况；其中，任一差分对的网线与连接器连接情况为如下的一种：开路，短路，正常，检测失败。11.根据权利要求10所述的方法，其特征在于，所述根据所述连接情况确定各差分对状态，包括：对于任一差分对，若所述任一差分对的连接情况为正常，则确定所述任一差分对状态为正常，否则，确定所述任一差分对状态为异常。12.根据权利要求3所述的方法，其特征在于，所述通过物理层检测各差分对的网线与连接器连接情况，包括：通过物理层的扩展寄存器确定各差分对的网线与连接器连接情况。13.根据权利要求12所述的方法，其特征在于，所述根据所述连接情况确定各差分对状态，包括：对于任一差分对，根据所述任一差分对的连接情况，确定所述任一差分对在各模式下的信噪比；根据所述任一差分对在各模式下的信噪比确定所述任一差分对状态。14.根据权利要求13所述的方法，其特征在于，所述根据所述任一差分对的连接情况，确定所述任一差分对在各模式下的信噪比，包括：通过如下公式确定所述任一差分对在各模式下的信噪比：其中，i为差分对标识，SNR为差分对i在各模式下的信噪比，a为模式参数，mse为差分对i的连接情况；若1000兆模式，则a＝5，若100兆模式，则a＝3。15.根据权利要求14所述的方法，其特征在于，所述根据所述任一差分对在各模式下的信噪比确定所述任一差分对状态，包括：若所述任一差分对为第一类差分对，则当所述任一差分对在1000兆模式的信噪比大于23dB时，确定所述任一差分对状态为正常，否则，确定所述任一差分对状态为异常。16.根据权利要求14所述的方法，其特征在于，所述根据所述任一差分对在各模式下的信噪比确定所述任一差分对状态，包括：若所述任一差分对为第二类差分对，则当所述任一差分对在100兆模式的信噪比大于21.5dB时，确定所述任一差分对状态为正常，否则，确定所述任一差分对状态为异常。17.根据权利要求12所述的方法，其特征在于，所述根据所述连接情况确定各差分对状态，包括：对于任一差分对，若所述任一差分对为第一类差分对，则根据所述任一差分对的连接情况，确定所述任一差分对在1000兆模式下的信噪比；根据所述任一差分对在1000兆模式下的信噪比确定所述任一差分对状态；若所述任一差分对为第二类差分对，则根据所述任一差分对的连接情况，确定所述任一差分对在100兆模式下的信噪比；根据所述任一差分对在100兆模式下的信噪比确定所述任一差分对状态。18.根据权利要求17所述的方法，其特征在于，所述根据所述任一差分对的连接情况，确定所述任一差分对在1000兆模式下的信噪比，包括：通过如下公式确定所述任一差分对在1000兆模式下的信噪比：其中，i为差分对标识，SNR1000为差分对i在1000兆模式下的信噪比，mse为差分对i的连接情况；所述根据所述任一差分对的连接情况，确定所述任一差分对在100兆模式下的信噪比，包括：通过如下公式确定所述任一差分对在100兆模式下的信噪比：其中，SNR100为差分对i在100兆模式下的信噪比。19.根据权利要求18所述的方法，其特征在于，所述根据所述任一差分对在1000兆模式下的信噪比确定所述任一差分对状态，包括：若所述任一差分对在1000兆模式下的信噪比大于23dB，则确定所述任一差分对状态为正常，否则，确定所述任一差分对状态为异常；根据所述任一差分对在100兆模式下的信噪比确定所述任一差分对状态，包括：若所述任一差分对在100兆模式下的信噪比大于21.5dB，则确定所述任一差分对状态为正常，否则，确定所述任一差分对状态为异常。20.根据权利要求3所述的方法，其特征在于，所述通过物理层检测各差分对的网线与连接器连接情况，包括：在物理层设置链路诊断测试控制寄存器和链路诊断状态测试寄存器；通过所述链路诊断测试控制寄存器对各差分对进行使能链路测试；通过所述链路诊断状态测试寄存器读取各差分对的使能链路测试结果；将使能链路测试结果确定为其对应差分对的网线与连接器连接情况；其中，任一差分对的网线与连接器连接情况为如下的一种：开路，短路，正常，检测失败。21.根据权利要求20所述的方法，其特征在于，所述通过所述链路诊断状态测试寄存器读取各差分对的使能链路测试结果之后，还包括：根据使能链路测试时间计算出链路长度。22.根据权利要求20所述的方法，其特征在于，所述根据所述连接情况确定各差分对状态，包括：对于任一差分对，若所述任一差分对的连接情况为正常，则确定所述任一差分对状态为正常，否则，确定所述任一差分对状态为异常。23.一种电子设备，其特征在于，包括：存储器；处理器；以及计算机程序；其中，所述计算机程序存储在所述存储器中，并被配置为由所述处理器执行以实现如权利要求1-22任一项所述的方法。24.一种计算机可读存储介质，其特征在于，其上存储有计算机程序；所述计算机程序被处理器执行以实现如权利要求1-22任一项所述的方法。
说明书desc
技术领域本申请涉及以太网通信技术领域，尤其涉及一种以太网自协商方法、设备、存储介质。背景技术自从20世纪80年代起，以太网以其低成本、组网灵活、简单易用的特点一直占据着局域网连通的主导地位，在嵌入式领域也成为设备之间和设备内模块之间连接的主要通信接口之一。按照电子和电器工程师协会802.3标准，以太网有自协商和强制两种模式。在日常使用中大部分都使用自协商模式。当连接以太网两端的设备都配置为自协商模式时，上电后设备的物理层先用协商码流传递各自的工作速度和双工信息，如果两端协商失败或是协商不一致则降速再次协商。常见的以太网接口都支持10M/100M/1000M三种速度，在自协商时从高速向低速模式协商，即1000M协商失败，尝试协商100M，再失败尝试协商10M。连接以太网端口的标准网线应该是4个差分对共8根线，只有1000M工作模式才需要所有的8根线，在10M/100M工作模式只需要4根线。如图1所示的网线一共有8根线，两根在一起成为一个差分对，在千兆网的工作时两对虚线差分对用来数据传输。两对实线差分对作为协商使用。在百兆工作时只使用两对虚线差分对，当网线只有两对虚线差分对时，最高只能协商成100M。该链路由网线+连接器组成。也就是说，只有8根线都正常才能写生成1000M否则只能协商成100M/10M。在实际使用中出于节约成本和其他考虑很多时候都只用4根线来链接以太网，或是由于线路接头损坏等原因导致部分线路损坏。此时由于缺少1000M工作模式所需要的另外两个差分对，1000M协商不会成功，最高只能协商成100M，但是因为物理层并不能主动感知网线的情况，在自协商过程还是从1000M开始向下协商的，这会导致协商时间较长。比如现有的一种PHY在1000M协商过程的时间超过15秒。发明内容为了解决上述技术缺陷之一，本申请提供了一种以太网自协商方法、设备、存储介质。本申请第一个方面，提供了一种以太网自协商方法，所述方法包括：通过物理层检测链路连接状态；根据检测到的链路连接状态确定以太网自协商方案；基于所述以太网协商方案进行以太网自协商。本申请第二个方面，提供了一种电子设备，包括：存储器；处理器；以及计算机程序；其中，所述计算机程序存储在所述存储器中，并被配置为由所述处理器执行以实现如上述第一个方面所述的方法。本申请第三个方面，提供了一种计算机可读存储介质，其上存储有计算机程序；所述计算机程序被处理器执行以实现如上述第一个方面所述的方法。本申请提供一种以太网自协商方法、设备、存储介质，该方法包括：通过物理层检测链路连接状态；根据检测到的链路连接状态确定以太网自协商方案；基于以太网协商方案进行以太网自协商。本申请在以太网自协商之前通过物理层检测链路连接状态，根据检测到的链路连接状态确定以太网自协商方案，实现了基于链路连接状态的以太网自协商方案动态调整，避免了现有技术中必须从1000M开始向下协商导致的协商时间较长问题。附图说明此处所说明的附图用来提供对本申请的进一步理解，构成本申请的一部分，本申请的示意性实施例及其说明用于解释本申请，并不构成对本申请的不当限定。在附图中：图1为现有的以太网端口的标准网线示意图；图2为本申请实施例提供的一种以太网自协商方法的流程示意图；图3为本申请实施例提供的另一种以太网自协商方法的流程示意图。具体实施方式为了使本申请实施例中的技术方案及优点更加清楚明白，以下结合附图对本申请的示例性实施例进行进一步详细的说明，显然，所描述的实施例仅是本申请的一部分实施例，而不是所有实施例的穷举。需要说明的是，在不冲突的情况下，本申请中的实施例及实施例中的特征可以相互组合。在实现本申请的过程中，发明人发现，常见的以太网接口都支持10M/100M/1000M三种速度，在自协商时从高速向低速模式协商，即1000M协商失败，尝试协商100M，再失败尝试协商10M。现有方案并不能主动感知网线的情况，无论网线是否支持1000M，其在自协商过程还是从1000M开始向下协商的，这会导致协商时间较长。针对上述问题，本申请实施例中提供了一种以太网自协商方法、设备、存储介质，该方法包括：通过物理层检测链路连接状态；根据检测到的链路连接状态确定以太网自协商方案；基于以太网协商方案进行以太网自协商。本申请在以太网自协商之前通过物理层检测链路连接状态，根据检测到的链路连接状态确定以太网自协商方案，实现了基于链路连接状态的以太网自协商方案动态调整，避免了现有技术中必须从1000M开始向下协商导致的协商时间较长问题。参见图2，本实施利提供一种以太网自协商方法，本实施例针对的链路为现有链路，如图1所示，该链路包括4个差分对。其中，两个差分对为第一类差分对，另外两个差分对为第二类差分对。第一类差分的状态对与第二类差分对的状态均正常时支持1000兆工作模式，仅第二类差分对状态正常时支持100兆和10兆工作模式。如图1所示的网线一共有8根线，两根在一起成为一个差分对，在千兆网的工作时两对虚线差分对用来数据传输。两对实线差分对作为协商使用。在百兆工作时只使用两对虚线差分对，当网线只有两对虚线差分对时，最高只能协商成100M。该链路由网线+连接器组成。也就是说，只有8根线都正常才能写生成1000M否则只能协商成100M/10M。因此，两对实线差分对为第一类差分对，两对虚线差分对为第二类差分对。那么本步骤在具体实现时，会确定第一类差分对状态和第二类差分对状态，将第一类差分对状态和第二类差分对状态均作为连接状态。也就是说，链路连接状态包括第一类差分对状态和第二类差分对状态。例如，4个差分对分别为MDI±、MDI±、MDI±、MDI±。其中只有在1000M模式下使用所有的4个差分对，100M和10M模式下只需要2个差分对。详情如表1所示：表1由此可知当链路只有MDI±、MDI±两个差分对时，是不可能工作在1000M模式的。此时是从1000M模式进行协商就是在浪费时间。通过本实施例的方法，会基于该链路连接状态的以太网自协商方案动态调整，避免了现有技术中必须从1000M开始向下协商导致的协商时间较长问题。具体的，本实施例的实现流程如下：101，通过物理层检测链路连接状态。具体的，即通过物理层检测链路连接状态，包括：1、通过物理层检测各差分对的网线与连接器连接情况。由于目前主流的物理层芯片都支持针对链路每一个差分对的检测功能，但不同的物理层芯片采用的对差分对检测功能实现方案所有不同，例如，VCT方案，CDT方案，加SNR方案，无论采用何种实现方案其都可以根据这个功能检测出链路每个差分对的状态，这个状态根据物理层芯片不同，有的是检测出开路、短路状态；有的是信噪比值，有的是检测等效链路长度。因此，本步骤在具体实现时可以采用不同的实现方案。例如，1)第一种通过物理层检测各差分对的网线与连接器连接情况的实现方案：控制物理层进入copper模式。在copper模式中访问物理层地址空间，关闭睡眠模式，对各差分对进行测试。根据测试结果确定各差分对的网线与连接器连接情况。其中，任一差分对的网线与连接器连接情况为如下的一种：开路，短路，正常，检测失败。2)第二种通过物理层检测各差分对的网线与连接器连接情况的实现方案：通过物理层的扩展寄存器确定各差分对的网线与连接器连接情况。3)第三种通过物理层检测各差分对的网线与连接器连接情况的实现方案：在物理层设置链路诊断测试控制寄存器和链路诊断状态测试寄存器。通过链路诊断测试控制寄存器对各差分对进行使能链路测试。通过链路诊断状态测试寄存器读取各差分对的使能链路测试结果。将使能链路测试结果确定为其对应差分对的网线与连接器连接情况。其中，任一差分对的网线与连接器连接情况为如下的一种：开路，短路，正常，检测失败。2、根据连接情况确定各差分对状态。其中，任一差分对状态为正常或异常。上述步骤中，通过物理层检测各差分对的网线与连接器连接情况的实现方案不同，本步骤中根据连接情况确定各差分对状态的实现方案也有所差异。例如，1)若上步骤中采用第一种通过物理层检测各差分对的网线与连接器连接情况的方案，那么在根据连接情况确定各差分对状态时，会对于任一差分对，若任一差分对的连接情况为正常，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。2)若上步骤中采用第二种通过物理层检测各差分对的网线与连接器连接情况的方案，那么在根据连接情况确定各差分对状态时，会对于任一差分对，根据任一差分对的连接情况，确定任一差分对在各模式下的信噪比，根据任一差分对在各模式下的信噪比确定任一差分对状态。具体的，通过如下公式确定任一差分对在各模式下的信噪比：其中，i为差分对标识，SNR为差分对i在各模式下的信噪比，a为模式参数，mse为差分对i的连接情况。若1000兆模式，则a＝5，若100兆模式，则a＝3。在根据任一差分对在各模式下的信噪比确定任一差分对状态时，若任一差分对为第一类差分对，则当任一差分对在1000兆模式的信噪比大于23dB时，确定任一差分对状态为正常，否则，确定任一差分对状态为异常。若任一差分对为第二类差分对，则当任一差分对在100兆模式的信噪比大于21.5dB时，确定任一差分对状态为正常，否则，确定任一差分对状态为异常。在此种方案中，会确定每个差分对在各模式下的SNR，在基于差分对所属类别，进行不同的方案的状态确定。但是对于任一差分对，其只对一种模式起绝对作用，例如第一类差分对，其只涉及1000兆模式，第二类差分对，其只涉及100兆模式。上述方案会计算每个差分对分别在1000兆模式和100兆模式下的SNR，这样会浪费一个SNR，因为在后续确定该差分对时，要么该差分对为第一类差分对，则只会基于其在1000兆模式的信噪比与23dB之间的关系确定该差分对状态，不会考虑其在100兆模式的信噪比与21.5dB之间的关系。要么该差分对为第二类差分对，则只会基于其在100兆模式的信噪比与21.5dB之间的关系确定该差分对状态，不会考虑其在1000兆模式的信噪比与23dB之间的关系。为了减少浪费，本步骤在具体实现时，可以采用如下优化方案：对于任一差分对，若任一差分对为第一类差分对，则根据任一差分对的连接情况，确定任一差分对在1000兆模式下的信噪比。根据任一差分对在1000兆模式下的信噪比确定任一差分对状态。例如，通过如下公式确定任一差分对在1000兆模式下的信噪比：其中，i为差分对标识，SNR1000为差分对i在1000兆模式下的信噪比，mse为差分对i的连接情况。若任一差分对在1000兆模式下的信噪比大于23dB，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。若任一差分对为第二类差分对，则根据任一差分对的连接情况，确定任一差分对在100兆模式下的信噪比。根据任一差分对在100兆模式下的信噪比确定任一差分对状态。例如，通过如下公式确定任一差分对在100兆模式下的信噪比：其中，SNR100为差分对i在100兆模式下的信噪比。若任一差分对在100兆模式下的信噪比大于21.5dB，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。优化方案会根据差分对所属类别，针对性的确定其在一种模式下的信噪比，仅对该信噪比进行比对，减少信噪比计算的浪费。3)若上步骤中采用第三种通过物理层检测各差分对的网线与连接器连接情况的方案，那么在根据连接情况确定各差分对状态时，会对于任一差分对，若任一差分对的连接情况为正常，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。另外，还会根据使能链路测试时间计算出链路长度。例如，对于第一种通过物理层检测各差分对的网线与连接器连接情况的方案及其对应的根据连接情况确定各差分对状态方案，可以采用VCT实现。VCT对网线内的各个差分对做检测可以检测出4中状态：开路、短路、正常、检测失败。其中除了正常状态都可以认为是链路有问题；例如PHY芯片YT8521S进入含copper的一种模式，然后进行如下流程：步骤一，把common ext reg0xa000写为0x0；#访问phy地址空间。步骤二，把phy ext reg0x98写为0xb0a6。步骤三，把phy ext reg0x27的bit15清0；#关掉sleep模式。步骤四，把phy ext reg0x80的bit0置1；#进入VCT测试。步骤五，当phy ext reg0x84的bit15变为0，VCT测试结束。通过读phy extreg0x84的bit7～0，判断pair内open和short状态。步骤六，通过读取phy ext reg0x87～8a的值可以得到pair0～3出问题的点，单位为cm。再例如，对于第二种通过物理层检测各差分对的网线与连接器连接情况的方案及其对应的根据连接情况确定各差分对状态方案，可以采用SNR实现。检测网线内的各个差分对的信噪比。根据信噪比确定这个链路状态能否协商成1000M。例如PHY芯片YT8521S进行如下流程：步骤一，将phy ext扩展寄存器0x59的bit15置1。步骤二，将phy ext扩展寄存器0xf8的bit10清0。步骤三，分别读取phy ext扩展寄存器0x5A，0x5B，0x5C，0x5D的bit。将其记为mse，i＝0,1,2,3。步骤四，按照如下公式计算SNR。1000M模式下，a＝5；100M模式下，a＝3。要达到稳定连接，SNR值应大于23dB；21.5dB。还例如，对于第三种通过物理层检测各差分对的网线与连接器连接情况的方案及其对应的根据连接情况确定各差分对状态方案，可以采用CDT实现。对网线内的各个差分对做检测可以检测出4中状态：开路、短路、正常、检测失败。其中除了正常状态都可以认为是链路有问题；例如高通的PHY芯片AR8033的检测方法：步骤一，设置链路诊断测试控制寄存器的bit9,8选择要测试链路的差分对。步骤二，设置链路诊断测试控制寄存器的bit0为1使能链路测试。步骤三，读取链路诊断状态测试寄存器的bit9,8判断检测结果的状态。步骤四，读取链路诊断状态测试寄存器的bit7:0可以根据处理时间计算出链路长度。除了上述三种之外，还可能有其他的办法可以检测链路状态。3、根据各差分对状态确定第一类差分对状态和第二类差分对状态。其中，任一类差分对状态为正常或异常。具体的，对于任一类差分对，若属于任一类差分对的两个差分对均正常时，任一类差分对状态为正常，否则，任一类差分对状态为异常。例如，对于第一类差分对，其包括两个差分对，如果两个差分对的状态均为正常，那么第一类差分对状态为正常。如果两个差分对中的一个状态为正常，另一个状态为异常，那么第一类差分对状态为异常。如果两个差分对的状态均为异常，那么第一类差分对状态为异常。对于第二类差分对，其包括两个差分对，如果两个差分对的状态均为正常，那么第二类差分对状态为正常。如果两个差分对中的一个状态为正常，另一个状态为异常，那么第二类差分对状态为异常。如果两个差分对的状态均为异常，那么第二类差分对状态为异常。102，根据检测到的链路连接状态确定以太网自协商方案。具体的，若第二类差分对状态为异常，则确定以太网自协商方案为不进行以太网自协商。若第二类差分对状态为正常，但第一类差分对状态为异常，则确定以太网自协商方案为跳过1000M模式的协商，从100M模式开始协商。若第二类差分对状态为正常，且第一类差分对状态也为正常，则确定以太网自协商方案为从1000M模式开始协商。另外，在确定以太网自协商方案的同时，还可以对确定该方案的原因进行提示。例如，若第二类差分对状态为异常，则提示以太网自协商方案确定依据为端口不能正常工作。若第二类差分对状态为正常，但第一类差分对状态为异常，则提示以太网自协商方案确定依据为1000M模式使用的两个差分对异常。103，基于以太网协商方案进行以太网自协商。例如，若步骤102中确定以太网协商方案为不进行以太网自协商，则步骤103会不再执行以太网自协商，除此之外，还会反馈描述端口不能正常工作的相关内容。若步骤102中确定以太网协商方案为跳过1000M模式的协商，从100M模式开始协商，则步骤103会不再进行过1000M模式的协商，而是直接从100M模式开始协商，除此之外，还会反馈描述1000M模式使用的两个差分对异常的相关内容。若步骤102中确定以太网协商方案为从1000M模式开始协商，则步骤103会按现有的以太网协商方案进行协商，即从1000M模式开始协商。本实施例提供的以太网自协商方法，在以太网接口开始自协商前，先利用物理层的链路检测功能检测链路链接状态。当检测到MDI±、MDI±两个差分对异常时，直接控制物理层关掉1000M协商能力，从100M开始向下协商。这样就可以节约1000M协商的时间，从而提高自协商速度。这样可以使设备更快的进入正常工作状态。当检测到MDI±、MDI±两个差分对异常时，可以直接判断以太网端口不能进入正常工作状态。不需要再做自协商尝试。如图3所示，在执行本实施例提供的以太网自协商方法之后，检查链路张图，确定MDI±、MDI±两个差分对是否异常，1)如果异常，则确定端口不能正常工作，完成本实施例提供的以太网自协商方法。2)如果不异常，则确定1000M模式使用的MDI±、MDI±两个差分对是否异常。2-1)如果异常，则进行100M协商，2-1-1)如果协商成功则进入100M工作状态，完成本实施例提供的以太网自协商方法。2-1-2)如果协商不成功，则确定是否达到重试次数，A-1)如果没有达到，则重新执行进行100M协商的步骤及后续步骤。A-2)如果达到，则进行10M协商，a-1)如果协商成功则进入10M工作状态，完成本实施例提供的以太网自协商方法。a-2)如果协商不成功，则确定是否达到重试次数，I-1)如果没有达到，则重新执行进行10M协商的步骤及后续步骤。I-2)如果达到，则确定端口不能正常工作，完成本实施例提供的以太网自协商方法。2-2)如果不异常，则进行1000M协商2-2-1)如果协商成功则进入1000M工作状态，完成本实施例提供的以太网自协商方法。2-2-2)如果协商不成功，则确定是否达到重试次数，B-1)如果没有达到，则重新执行进行1000M协商的步骤及后续步骤。B-2)如果达到，则进行100M协商，b-1)如果协商成功则进入100M工作状态，完成本实施例提供的以太网自协商方法。b-2)如果协商不成功，则确定是否达到重试次数，I-1)如果没有达到，则重新执行进行100M协商的步骤及后续步骤。I-2)如果达到，则进行10M协商，i-1)如果协商成功则进入10M工作状态，完成本实施例提供的以太网自协商方法。i-2)如果协商不成功，则确定是否达到重试次数，如果没有达到，则重新执行进行10M协商的步骤及后续步骤。如果达到，则确定端口不能正常工作，完成本实施例提供的以太网自协商方法。本实施例提供的以太网自协商方法通过物理层检测链路连接状态；根据检测到的链路连接状态确定以太网自协商方案；基于以太网协商方案进行以太网自协商。本实施例在以太网自协商之前通过物理层检测链路连接状态，根据检测到的链路连接状态确定以太网自协商方案，实现了基于链路连接状态的以太网自协商方案动态调整，避免了现有技术中必须从1000M开始向下协商导致的协商时间较长问题。基于以太网自协商方法的同一发明构思，本实施例提供一种电子设备，该电子设备包括：存储器，处理器，以及计算机程序。其中，计算机程序存储在存储器中，并被配置为由处理器执行以实现上述图1所示的以太网自协商方法。具体的，通过物理层检测链路连接状态。根据检测到的链路连接状态确定以太网自协商方案。基于以太网协商方案进行以太网自协商。可选地，链路包括4个差分对。其中，两个差分对为第一类差分对，另外两个差分对为第二类差分对。第一类差分对的状态对与第二类差分对的状态均正常时支持1000兆工作模式，仅第二类差分对状态正常时支持100兆和10兆工作模式。可选地，链路连接状态包括第一类差分对状态和第二类差分对状态。通过物理层检测链路连接状态，包括：通过物理层检测各差分对的网线与连接器连接情况。根据连接情况确定各差分对状态。其中，任一差分对状态为正常或异常。根据各差分对状态确定第一类差分对状态和第二类差分对状态。其中，任一类差分对状态为正常或异常。可选地，根据各差分对状态确定第一类差分对状态和第二类差分对状态，包括：对于任一类差分对，若属于任一类差分对的两个差分对均正常时，任一类差分对状态为正常，否则，任一类差分对状态为异常。可选地，根据检测到的链路连接状态确定以太网自协商方案，包括：若第二类差分对状态为异常，则确定以太网自协商方案为不进行以太网自协商。可选地，方法还包括：若第二类差分对状态为异常，则提示以太网自协商方案确定依据为端口不能正常工作。可选地，根据检测到的链路连接状态确定以太网自协商方案，包括：若第二类差分对状态为正常，但第一类差分对状态为异常，则确定以太网自协商方案为跳过1000兆模式的协商，从100兆模式开始协商。可选地，方法还包括：若第二类差分对状态为正常，但第一类差分对状态为异常，则提示以太网自协商方案确定依据为1000兆模式使用的两个差分对异常。可选地，根据检测到的链路连接状态确定以太网自协商方案，包括：若第二类差分对状态为正常，且第一类差分对状态也为正常，则确定以太网自协商方案为从1000兆模式开始协商。可选地，通过物理层检测各差分对的网线与连接器连接情况，包括：控制物理层进入copper模式。在copper模式中访问物理层地址空间，关闭睡眠模式，对各差分对进行测试。根据测试结果确定各差分对的网线与连接器连接情况。其中，任一差分对的网线与连接器连接情况为如下的一种：开路，短路，正常，检测失败。可选地，根据连接情况确定各差分对状态，包括：对于任一差分对，若任一差分对的连接情况为正常，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。可选地，通过物理层检测各差分对的网线与连接器连接情况，包括：通过物理层的扩展寄存器确定各差分对的网线与连接器连接情况。可选地，根据连接情况确定各差分对状态，包括：对于任一差分对，根据任一差分对的连接情况，确定任一差分对在各模式下的信噪比。根据任一差分对在各模式下的信噪比确定任一差分对状态。可选地，根据任一差分对的连接情况，确定任一差分对在各模式下的信噪比，包括：通过如下公式确定任一差分对在各模式下的信噪比：其中，i为差分对标识，SNR为差分对i在各模式下的信噪比，a为模式参数，mse为差分对i的连接情况。若1000兆模式，则a＝5，若100兆模式，则a＝3。可选地，根据任一差分对在各模式下的信噪比确定任一差分对状态，包括：若任一差分对为第一类差分对，则当任一差分对在1000兆模式的信噪比大于23dB时，确定任一差分对状态为正常，否则，确定任一差分对状态为异常。可选地，根据任一差分对在各模式下的信噪比确定任一差分对状态，包括：若任一差分对为第二类差分对，则当任一差分对在100兆模式的信噪比大于21.5dB时，确定任一差分对状态为正常，否则，确定任一差分对状态为异常。可选地，根据连接情况确定各差分对状态，包括：对于任一差分对，若任一差分对为第一类差分对，则根据任一差分对的连接情况，确定任一差分对在1000兆模式下的信噪比。根据任一差分对在1000兆模式下的信噪比确定任一差分对状态。若任一差分对为第二类差分对，则根据任一差分对的连接情况，确定任一差分对在100兆模式下的信噪比。根据任一差分对在100兆模式下的信噪比确定任一差分对状态。可选地，根据任一差分对的连接情况，确定任一差分对在1000兆模式下的信噪比，包括：通过如下公式确定任一差分对在1000兆模式下的信噪比：其中，i为差分对标识，SNR1000为差分对i在1000兆模式下的信噪比，mse为差分对i的连接情况。根据任一差分对的连接情况，确定任一差分对在100兆模式下的信噪比，包括：通过如下公式确定任一差分对在100兆模式下的信噪比：其中，SNR100为差分对i在100兆模式下的信噪比。可选地，根据任一差分对在1000兆模式下的信噪比确定任一差分对状态，包括：若任一差分对在1000兆模式下的信噪比大于23dB，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。根据任一差分对在100兆模式下的信噪比确定任一差分对状态，包括：若任一差分对在100兆模式下的信噪比大于21.5dB，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。可选地，通过物理层检测各差分对的网线与连接器连接情况，包括：在物理层设置链路诊断测试控制寄存器和链路诊断状态测试寄存器。通过链路诊断测试控制寄存器对各差分对进行使能链路测试。通过链路诊断状态测试寄存器读取各差分对的使能链路测试结果。将使能链路测试结果确定为其对应差分对的网线与连接器连接情况。其中，任一差分对的网线与连接器连接情况为如下的一种：开路，短路，正常，检测失败。可选地，通过链路诊断状态测试寄存器读取各差分对的使能链路测试结果之后，还包括：根据使能链路测试时间计算出链路长度。可选地，根据连接情况确定各差分对状态，包括：对于任一差分对，若任一差分对的连接情况为正常，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。本实施例提供的电子设备，其上计算机程序被处理器执行以通过物理层检测链路连接状态；根据检测到的链路连接状态确定以太网自协商方案；基于以太网协商方案进行以太网自协商。本实施例在以太网自协商之前通过物理层检测链路连接状态，根据检测到的链路连接状态确定以太网自协商方案，实现了基于链路连接状态的以太网自协商方案动态调整，避免了现有技术中必须从1000M开始向下协商导致的协商时间较长问题。基于以太网自协商方法的同一发明构思，本实施例提供一种计算机可其上存储有计算机程序。计算机程序被处理器执行以实现上述图1所示的以太网自协商方法。具体的，通过物理层检测链路连接状态。根据检测到的链路连接状态确定以太网自协商方案。基于以太网协商方案进行以太网自协商。可选地，链路包括4个差分对。其中，两个差分对为第一类差分对，另外两个差分对为第二类差分对。第一类差分对的状态对与第二类差分对的状态均正常时支持1000兆工作模式，仅第二类差分对状态正常时支持100兆和10兆工作模式。可选地，链路连接状态包括第一类差分对状态和第二类差分对状态。通过物理层检测链路连接状态，包括：通过物理层检测各差分对的网线与连接器连接情况。根据连接情况确定各差分对状态。其中，任一差分对状态为正常或异常。根据各差分对状态确定第一类差分对状态和第二类差分对状态。其中，任一类差分对状态为正常或异常。可选地，根据各差分对状态确定第一类差分对状态和第二类差分对状态，包括：对于任一类差分对，若属于任一类差分对的两个差分对均正常时，任一类差分对状态为正常，否则，任一类差分对状态为异常。可选地，根据检测到的链路连接状态确定以太网自协商方案，包括：若第二类差分对状态为异常，则确定以太网自协商方案为不进行以太网自协商。可选地，方法还包括：若第二类差分对状态为异常，则提示以太网自协商方案确定依据为端口不能正常工作。可选地，根据检测到的链路连接状态确定以太网自协商方案，包括：若第二类差分对状态为正常，但第一类差分对状态为异常，则确定以太网自协商方案为跳过1000兆模式的协商，从100兆模式开始协商。可选地，方法还包括：若第二类差分对状态为正常，但第一类差分对状态为异常，则提示以太网自协商方案确定依据为1000兆模式使用的两个差分对异常。可选地，根据检测到的链路连接状态确定以太网自协商方案，包括：若第二类差分对状态为正常，且第一类差分对状态也为正常，则确定以太网自协商方案为从1000兆模式开始协商。可选地，通过物理层检测各差分对的网线与连接器连接情况，包括：控制物理层进入copper模式。在copper模式中访问物理层地址空间，关闭睡眠模式，对各差分对进行测试。根据测试结果确定各差分对的网线与连接器连接情况。其中，任一差分对的网线与连接器连接情况为如下的一种：开路，短路，正常，检测失败。可选地，根据连接情况确定各差分对状态，包括：对于任一差分对，若任一差分对的连接情况为正常，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。可选地，通过物理层检测各差分对的网线与连接器连接情况，包括：通过物理层的扩展寄存器确定各差分对的网线与连接器连接情况。可选地，根据连接情况确定各差分对状态，包括：对于任一差分对，根据任一差分对的连接情况，确定任一差分对在各模式下的信噪比。根据任一差分对在各模式下的信噪比确定任一差分对状态。可选地，根据任一差分对的连接情况，确定任一差分对在各模式下的信噪比，包括：通过如下公式确定任一差分对在各模式下的信噪比：其中，i为差分对标识，SNR为差分对i在各模式下的信噪比，a为模式参数，mse为差分对i的连接情况。若1000兆模式，则a＝5，若100兆模式，则a＝3。可选地，根据任一差分对在各模式下的信噪比确定任一差分对状态，包括：若任一差分对为第一类差分对，则当任一差分对在1000兆模式的信噪比大于23dB时，确定任一差分对状态为正常，否则，确定任一差分对状态为异常。可选地，根据任一差分对在各模式下的信噪比确定任一差分对状态，包括：若任一差分对为第二类差分对，则当任一差分对在100兆模式的信噪比大于21.5dB时，确定任一差分对状态为正常，否则，确定任一差分对状态为异常。可选地，根据连接情况确定各差分对状态，包括：对于任一差分对，若任一差分对为第一类差分对，则根据任一差分对的连接情况，确定任一差分对在1000兆模式下的信噪比。根据任一差分对在1000兆模式下的信噪比确定任一差分对状态。若任一差分对为第二类差分对，则根据任一差分对的连接情况，确定任一差分对在100兆模式下的信噪比。根据任一差分对在100兆模式下的信噪比确定任一差分对状态。可选地，根据任一差分对的连接情况，确定任一差分对在1000兆模式下的信噪比，包括：通过如下公式确定任一差分对在1000兆模式下的信噪比：其中，i为差分对标识，SNR1000为差分对i在1000兆模式下的信噪比，mse为差分对i的连接情况。根据任一差分对的连接情况，确定任一差分对在100兆模式下的信噪比，包括：通过如下公式确定任一差分对在100兆模式下的信噪比：其中，SNR100为差分对i在100兆模式下的信噪比。可选地，根据任一差分对在1000兆模式下的信噪比确定任一差分对状态，包括：若任一差分对在1000兆模式下的信噪比大于23dB，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。根据任一差分对在100兆模式下的信噪比确定任一差分对状态，包括：若任一差分对在100兆模式下的信噪比大于21.5dB，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。可选地，通过物理层检测各差分对的网线与连接器连接情况，包括：在物理层设置链路诊断测试控制寄存器和链路诊断状态测试寄存器。通过链路诊断测试控制寄存器对各差分对进行使能链路测试。通过链路诊断状态测试寄存器读取各差分对的使能链路测试结果。将使能链路测试结果确定为其对应差分对的网线与连接器连接情况。其中，任一差分对的网线与连接器连接情况为如下的一种：开路，短路，正常，检测失败。可选地，通过链路诊断状态测试寄存器读取各差分对的使能链路测试结果之后，还包括：根据使能链路测试时间计算出链路长度。可选地，根据连接情况确定各差分对状态，包括：对于任一差分对，若任一差分对的连接情况为正常，则确定任一差分对状态为正常，否则，确定任一差分对状态为异常。本实施例提供的计算机可读存储介质，其上的计算机程序被处理器执行以通过物理层检测链路连接状态；根据检测到的链路连接状态确定以太网自协商方案；基于以太网协商方案进行以太网自协商。本实施例在以太网自协商之前通过物理层检测链路连接状态，根据检测到的链路连接状态确定以太网自协商方案，实现了基于链路连接状态的以太网自协商方案动态调整，避免了现有技术中必须从1000M开始向下协商导致的协商时间较长问题。本领域内的技术人员应明白，本申请的实施例可提供为方法、系统、或计算机程序产品。因此，本申请可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本申请可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本申请实施例中的方案可以采用各种计算机语言实现，例如，面向过程的C语言，面向对象的程序设计语言Java和直译式脚本语言JavaScript等。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。尽管已描述了本申请的优选实施例，但本领域内的技术人员一旦得知了基本创造性概念，则可对这些实施例作出另外的变更和修改。所以，所附权利要求意欲解释为包括优选实施例以及落入本申请范围的所有变更和修改。显然，本领域的技术人员可以对本申请进行各种改动和变型而不脱离本申请的精神和范围。这样，倘若本申请的这些修改和变型属于本申请权利要求及其等同技术的范围之内，则本申请也意图包含这些改动和变型在内。
