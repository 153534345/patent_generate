标题title
一种基于通信方式的TWS耳机的汗液检测方法
摘要abst
一种基于通信方式的TWS耳机的汗液检测方法，应用于电池仓系统和耳机系统，方法包括：在电池仓系统的充电触点与耳机系统的POGO针接触后，电池仓系统通过POGO针发送基于单线通讯协议的通信指令至耳机系统，通信指令为一可被耳机系统识别的电平信号；耳机系统对通信指令进行识别，在识别成功后，耳机系统发送确认信号至电池仓系统；电池仓系统在接收到确认信号后，启动充电程序，若没有接收到，则不启动充电程序。本发明提出一种汗液检测机制，基于通信原理，可以直接利用现有TWS耳机的资源，复用了充电仓系统与耳机系统现成的通讯机制，既不需要A/D型高成本MCU，也不需要外部隔离管，能快速检测汗液附着，降低系统面积及成本。
权利要求书clms
1.一种基于通信方式的TWS耳机的汗液检测方法，应用于电池仓系统和耳机系统，其特征在于，所述方法包括：在所述电池仓系统的充电触点与所述耳机系统的POGO针接触后，所述电池仓系统通过所述POGO针发送基于单线通讯协议的通信指令至所述耳机系统，所述通信指令为一可被所述耳机系统识别的电平信号；所述耳机系统对所述通信指令进行识别，在识别成功后，所述耳机系统发送确认信号至所述电池仓系统，若识别失败，则不与所述电池仓系统通讯；所述电池仓系统在接收到所述确认信号后，启动充电程序，若没有接收到，则不启动充电程序。2.根据权利要求1所述的基于通信方式的TWS耳机的汗液检测方法，其特征在于，所述电池仓系统包括第一通讯控制模块、所述耳机系统包括第二通讯控制模块，在所述充电触点与所述POGO针接触后，所述第一通讯控制模块发送所述通信指令至所述第二通讯控制模块。3.根据权利要求2所述的基于通信方式的TWS耳机的汗液检测方法，其特征在于，所述电池仓系统还包括第一接收模块、第一发送模块，所述耳机系统包括第二接收模块、第二发送模块，所述通信指令由所述第一通讯控制模块控制所述第一发送模块发出至所述第二接收模块，所述第二接收模块被配置为可识别高于预设值的信号电平，在高于预设值的所述通信指令被所述第二接收模块识别后发送知乎所述第二通讯控制模块，所述第二通讯控制模块根据所述通信指令控制所述第二发送模块发送出所述确认信号至所述第一接收模块，所述第一接收模块将所述确认信号发送至所述第一通讯控制模块，其中，所述第一接收模块、所述第二接收模块、所述第一发送模块、所述第二发送模块组成单线通讯电路。4.根据权利要求3所述的基于通信方式的TWS耳机的汗液检测方法，其特征在于，所述电池仓系统还包括有用于将所述通信指令的电压值上拉到可被所述第二接收模块识别的上拉模块。5.根据权利要求4所述的基于通信方式的TWS耳机的汗液检测方法，其特征在于，所述上拉模块为上拉电流、上拉电阻中的一种。
说明书desc
技术领域本发明涉及TWS耳机领域，尤其涉及一种基于通信方式的TWS耳机的汗液检测方法。背景技术人们日常使用TWS耳机场景复杂，包含大量如跑步，爬山等剧烈运动场景。运动过程中人体汗液会粘连到TWS耳机的POGO针上，导致POGO针引脚之间短路。在POGO针短路情况下，如果有持续的高电压加载在POGO针两端，将导致汗液中的氯化钠等电离，从而腐蚀POGO针。因此现有TWS耳机需要增加汗液检测功能以避免POGO针被腐蚀，影响耳机使用寿命。现有类型方案先通过一个低压电源给POGO针供电，然后采集POGO针上的电压。采样后的电压经过模数转换器和比较器判断POGO针是否有汗液附着。如果有汗液附着则不对POGO针供电。如果没有汗液附着，则开启对POGO针供电。现有技术的缺陷是需要一个ADC电路，系统比较复杂，实现成本高。传统的汗液检测系统如图1所示，通常是指在POGO针上电之前，系统先不输出高压充电电平，而先通过一个上拉模块给POGO针供电，上拉模块的供电为VDD。该汗液检测系统还包含模数转换器模块和比较器，以及相应的R1和C1组成的滤波电路。如果有汗液附着，那么ADC检测到的电压显著低于供电电压VDD，系统将限制在POGO针上输出高电平。当POGO针上的电压与供电电压VDD相等时，说明没有汗液附着。该汗液检测系统的具体缺点为检测系统需要一个模数转换器和比较器，这往往由微控制器提供。在TWS耳机系统里，带A/D型MCU成本比不带A/D型MCU成本高很多。另外检测电路需要与供电电路隔离，外部需要隔离管Q。否则耳机正常充电时的高压会倒灌给MCU，存在漏电以及烧毁MCU的风险。这也将增加系统成本。发明内容鉴于以上技术问题，本发明提供了一种基于通信方式的TWS耳机的汗液检测方法，、利用TWS耳机现有的硬件条件进行汗液检测，不需要外围ADC，节省生产成本。本发明的目的是提供一种基于通信方式的TWS耳机的汗液检测方法，应用于电池仓系统和耳机系统，所述方法包括：在所述电池仓系统的充电触点与所述耳机系统的POGO针接触后，所述电池仓系统通过所述POGO针发送基于单线通讯协议的通信指令至所述耳机系统，所述通信指令为一可被所述耳机系统识别的电平信号；所述耳机系统对所述通信指令进行识别，在识别成功后，所述耳机系统发送确认信号至所述电池仓系统，若识别失败，则不与所述电池仓系统通讯；所述电池仓系统在接收到所述确认信号后，启动充电程序，若没有接收到，则不启动充电程序。进一步的，所述电池仓系统包括第一通讯控制模块、所述耳机系统包括第二通讯控制模块，在所述充电触点与所述POGO针接触后，所述第一通讯控制模块发送所述通信指令至所述第二通讯控制模块。进一步的，所述电池仓系统还包括第一接收模块、第一发送模块，所述耳机系统包括第二接收模块、第二发送模块，所述通信指令由所述第一通讯控制模块控制所述第一发送模块发出至所述第二接收模块，所述第二接收模块被配置为可识别高于预设值的信号电平，在高于预设值的所述通信指令被所述第二接收模块识别后发送知乎所述第二通讯控制模块，所述第二通讯控制模块根据所述通信指令控制所述第二发送模块发送出所述确认信号至所述第一接收模块，所述第一接收模块将所述确认信号发送至所述第一通讯控制模块，其中，所述第一接收模块、所述第二接收模块、所述第一发送模块、所述第二发送模块组成单线通讯电路。进一步的，所述电池仓系统还包括有用于将所述通信指令的电压值上拉到可被所述第二接收模块识别的上拉模块。进一步的，所述上拉模块为上拉电流、上拉电阻中的一种。采用上述方案，本发明的有益效果是：本发明提出一种汗液检测机制，基于单线通信原理，可以直接利用现有TWS耳机的资源，复用了充电仓系统与耳机系统现成的通讯机制，既不需要A/D型高成本MCU，也不需要外部隔离管，还能快速检测汗液附着，降低系统面积及成本。附图说明图1为本发明一种传统的汗液检测模块的电路原理图；图2为本发明一个实施例中基于通信方式的TWS耳机的汗液检测方法的流程图；图3为本发明一个实施例中充电仓系统和耳机系统的连接图示；图4为本发明一个实施例中充电仓系统和耳机系统实现汗液检测的电路图。具体实施方式体现本发明特征与优点的典型实施方式将在以下的说明中详细叙述。应理解的是本发明能够在不同的实施方式上具有各种的变化，其皆不脱离本发明的范围，且其中的说明及图示在本质上是当作说明之用，而非用以限制本发明。在本发明的描述中，需要理解的是，术语“第一”、“第二”仅用于描述目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量。由此，限定有“第一”、“第二”的特征可以明示或者隐含地包括一个或者更多个所述特征。在本发明的描述中，需要说明的是，除非另有明确的规定和限定，术语“连接”是指本发明为实现其技术目的使相关元件按其固有特性和方案逻辑关系而进行的电连接，可以是直接相连而构成的电连接关系，也可以通过中间媒介间接电连接。对于本领域的普通技术人员而言，可以根据具体情况理解本申请文件中各术语在本发明中的具体含义。如图2所示，本发明实施例提供一种基于通信方式的TWS耳机的汗液检测方法，应用于电池仓系统和耳机系统，所述方法包括步骤S1～S3。在步骤S1中，在所述电池仓系统的充电触点与所述耳机系统的POGO针接触后，所述电池仓系统通过所述POGO针发送基于单线通讯协议的通信指令至所述耳机系统，所述通信指令为一可被所述耳机系统识别的电平信号；在步骤S2中，所述耳机系统对所述通信指令进行识别，在识别成功后，所述耳机系统发送确认信号至所述电池仓系统，若识别失败，则不与所述电池仓系统通讯；在步骤S3中，所述电池仓系统在接收到所述确认信号后，启动充电程序，若没有接收到，则不启动充电程序。其中，通信指令和确认信号可以是一种基于单线通讯协议的脉冲协议信号，正常状态下，电池仓系统输出脉冲协议信号时耳机系统可以接收脉冲协议信号，反过来，耳机系统输出脉冲协议信号时电池仓系统可以接收脉冲协议信号。再具体的，确认信号可以是一种ACK信号。在单线通讯总线存在汗液的情况，会降低脉冲协议信号的电压值，从而导致耳机系统不能识别接收到的脉冲协议信号，因此，利用此点便可以用来检测耳机系统是否存在汗液。在一实施方式中，如图3所示，所述电池仓系统包括第一通讯控制模块、所述耳机系统包括第二通讯控制模块，在所述充电触点与所述POGO针接触后，所述第一通讯控制模块发送所述通信指令至所述第二通讯控制模块。其中，第一通讯控制模块、第二通讯控制模块，具体是MCU控制的电路。其中，电池仓系统在给耳机系统充电之前，电池仓系统中的第一通讯控制模块发送一个通讯指令给耳机系统，耳机系统从POGO针上接收到通讯指令后，耳机系统的第二接收模块将信号送给第二通讯控制模块。如果第二通讯控制模块可以正常识别电池仓系统发送的信号，第二通讯模块通过自有发送接口给电池仓系统反馈一个确认信号，如果电池仓系统成功接收到来自耳机的确认信号，则通信成功，说明没有汗液附着。电池仓系统可以正常启动给耳机充电流程或者其他交互动作。如果有汗液附着，电池仓可以做相应的保护控制作为补充的，所述电池仓系统还包括第一接收模块、第一发送模块，所述耳机系统包括第二接收模块、第二发送模块，所述通信指令由所述第一通讯控制模块控制所述第一发送模块发出至所述第二接收模块，所述第二接收模块被配置为可识别高于预设值的信号电平，在高于预设值的所述通信指令被所述第二接收模块识别后发送知乎所述第二通讯控制模块，所述第二通讯控制模块根据所述通信指令控制所述第二发送模块发送出所述确认信号至所述第一接收模块，所述第一接收模块将所述确认信号发送至所述第一通讯控制模块，其中，所述第一接收模块、所述第二接收模块、所述第一发送模块、所述第二发送模块组成单线通讯电路。所述电池仓系统还包括有用于将所述通信指令的电压值上拉到可被所述第二接收模块识别的上拉模块。以下，将对本发明的工作原理作进一步的说明。如图4所示，电池仓系统中有一路上拉电流I1，如设定为10uA，同时电池仓系统对耳机系统发送信号时由MOS管Q1驱动。正常情况下，上拉电流将端口IO的电压拉到一个预设值V1的供电电压上，其中预设值V1是一个电池仓系统和耳机系统都可以识别的高电平，比如现有技术中一般是2.7V。当发生汗液附着时，汗液等效阻抗R2将端口IO的输出拉到一个极低的V2的电平，该电平由上拉模块上拉能力以及汗液等效电阻共同决定。比如，R2阻抗为10K，那么端口IO上的电压只有100mV，10uA*10KΩ＝100mV，这个电压显著低于接收接口可以识别的高电平。因此当电池仓系统需要在端口IO上传输高电平信号时，即使电池仓系统中的MOS管Q1已经处于断开状态，端口IO上的的输出高电平信号电压将只能达到V2的高度，远低于耳机接口电路可以识别的高电平。电池仓系统与耳机系统的通信将无法建立，通信失败。电池仓系统即识别到POGO针上存在汗液情况，给耳机系统的充电电压将暂不输出。另外，值得注意的是，上述所指的单线通讯协议，具体可以是私有协议，也可以是标准的单线协议，比如UART、SPI等。单线通讯的原理是用一根信号线实现半双工的通讯，具体在发明中，该信号线即为充电仓系统的充电触点和耳机系统的POGO针。通过以上实施例得知，本发明提出一种TWS耳机的汗液检测机制，基于单线通信原理，可以直接利用现有TWS耳机的资源，复用了充电仓系统与耳机系统现成的通讯机制，既不需要A/D型高成本MCU，也不需要外部隔离管，还能快速检测汗液附着，降低系统面积及成本。虽然已参照几个典型实施方式描述了本公开，但应当理解，所用的术语是说明和示例性、而非限制性的术语。由于本公开能够以多种形式具体实施而不脱离发明的精神或实质，所以应当理解，上述实施方式不限于任何前述的细节，而应在随附权利要求所限定的精神和范围内广泛地解释，因此落入权利要求或其等效范围内的全部变化和改型都应为随附权利要求所涵盖。
