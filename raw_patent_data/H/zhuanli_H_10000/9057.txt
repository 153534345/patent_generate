标题title
一种基于双线以太网的网关系统
摘要abst
本发明涉及一种基于双线以太网的网关系统，包括双线以太网网关装置、常规边缘终端和双线以太网边缘终端；双线以太网网关装置包括主控制芯片，以及分别连接主控制芯片的双线以太网PHY模块、常规以太网PHY模块、电源模块、SD卡模块、串口模块、RS485模块、CAN总线模块和MQTT通信模块；一个或多个双线以太网边缘终端通过单对双绞线连接双线以太网PHY模块的接口；一个或多个常规边缘终端通过双线以太网转换设备进行接口转换后，通过单对双绞线连接双线以太网接口PHY模块的接口；或者，一个或多个常规边缘终端直接连接常规以太网PHY模块的接口。与现有技术相比，本发明具有简化现场布线、兼容性好、平台扩展性强等优点。
权利要求书clms
1.一种基于双线以太网的网关系统，其特征在于，包括双线以太网网关装置、常规边缘终端和双线以太网边缘终端；所述双线以太网网关装置包括主控制芯片，以及分别连接主控制芯片的双线以太网PHY模块、常规以太网PHY模块、电源模块、SD卡模块、串口模块、RS485模块、CAN总线模块和MQTT通信模块；所述串口模块、RS485模块、CAN总线模块和MQTT通信模块分别连接串口接口平台、RS485接口平台、CAN总线接口平台和MQTT协议物联网平台；一个或多个双线以太网边缘终端通过单对双绞线连接双线以太网PHY模块的接口；一个或多个常规边缘终端通过双线以太网转换设备进行接口转换后，通过单对双绞线连接双线以太网接口PHY模块的接口；或者，一个或多个常规边缘终端直接连接常规以太网PHY模块的接口；所述双线以太网网关装置从常规边缘终端和双线以太网边缘终端通过Modbus/TCP协议获取数据信息后，转发至串口接口平台、RS485接口平台、CAN总线接口平台，以及MQTT协议物联网平台中的一个或多个平台。2.根据权利要求1所述的一种基于双线以太网的网关系统，其特征在于，所述双线以太网PHY模块包括采用IEEE802.3cg、10Base-T1L标准的双线以太网芯片。3.根据权利要求1所述的一种基于双线以太网的网关系统，其特征在于，所述主控制芯片上集成MAC单元，所述双线以太网PHY模块包括RMII接口，并且通过RMII接口连接MAC单元。4.根据权利要求3所述的一种基于双线以太网的网关系统，其特征在于，所述常规以太网PHY模块包括RMII接口，并且通过RMII接口连接MAC单元。5.根据权利要求1所述的一种基于双线以太网的网关系统，其特征在于，所述双线以太网网关装置被配置为Modbus/TCP协议的Client端。6.根据权利要求1所述的一种基于双线以太网的网关系统，其特征在于，所述主控制芯片采用Cortext-A7内核芯片。7.根据权利要求1所述的一种基于双线以太网的网关系统，其特征在于，所述SD卡模块用于配合BOOT启动电路，可进行从网络启动网关系统。
说明书desc
技术领域本发明涉及一种以太网网关技术，尤其是涉及一种基于双线以太网的网关系统。背景技术根据双线以太网的发展趋势，在将来必然会有大量双线以太网远程I/O设备或者双线以太网传感器等边缘终端设备进入工业领域。而较多办公电脑、交换机、路由器和网关等设备由于成本、性能和时间问题，难以短时间进行更新换代，仍然维持四对双绞线的常规以太网接口设计。另一方面，随着大数据和边缘计算的需求，网关系统能同时支持多平台的性能要求尤为重要。因此，市场需要一种可以支持双线以太网接口的多平台数据转发网关系统。发明内容本发明的目的就是为了克服上述现有技术存在的缺陷而提供一种基于双线以太网的网关系统，支持双线以太网接口的多平台数据转发，有效避免不同平台获取数据的延迟性和复杂性，提升网络通信的安全性，增强系统兼容性。本发明的目的可以通过以下技术方案来实现：一种基于双线以太网的网关系统，包括双线以太网网关装置、常规边缘终端和双线以太网边缘终端；所述双线以太网网关装置包括主控制芯片，以及分别连接主控制芯片的双线以太网PHY模块、常规以太网PHY模块、电源模块、SD卡模块、串口模块、RS485模块、CAN总线模块和MQTT通信模块；所述串口模块、RS485模块、CAN总线模块和MQTT通信模块分别连接串口接口平台、RS485接口平台、CAN总线接口平台和MQTT协议物联网平台；一个或多个双线以太网边缘终端通过单对双绞线连接双线以太网PHY模块的接口；一个或多个常规边缘终端通过双线以太网转换设备进行接口转换后，通过单对双绞线连接双线以太网接口PHY模块的接口；或者，一个或多个常规边缘终端直接连接常规以太网PHY模块的接口；所述双线以太网网关装置从常规边缘终端和双线以太网边缘终端通过Modbus/TCP协议获取数据信息后，转发至串口接口平台、RS485接口平台、CAN总线接口平台，以及MQTT协议物联网平台中的一个或多个平台。进一步地，所述双线以太网PHY模块包括采用IEEE802.3cg、10Base-T1L标准的双线以太网芯片。进一步地，所述主控制芯片上集成MAC单元，所述双线以太网PHY模块包括RMII接口，并且通过RMII接口连接MAC单元。进一步地，所述常规以太网PHY模块包括RMII接口，并且通过RMII接口连接MAC单元。进一步地，所述双线以太网网关装置被配置为Modbus/TCP协议的Client端。进一步地，所述主控制芯片采用Cortext-A7内核芯片。进一步地，所述SD卡模块用于配合BOOT启动电路，可进行从网络启动网关系统。进一步地，所述MQTT协议物联网平台为阿里云物联网平台。进一步地，网关系统采用Linux操作系统。与现有技术相比，本发明具有以下有益效果：1、本发明设计了全新的网关系统，可以支持未来即将大量使用的双线以太网边缘终端和传感器设备接入，具有系统兼容性好、节约大量通信线缆等优点。2、传统的网关系统一般仅支持一对一形式的数据转发，而本网关系统支持多个平台数据转发具平台兼容性强等优点。附图说明图1为本发明的网关系统结构示意图。图2为本发明的网关系统双网口设计示意图。图3为本发明的网关系统平台转发示意图。图4为本发明的网关系统软件流程图。具体实施方式下面结合附图和具体实施例对本发明进行详细说明。本实施例以本发明技术方案为前提进行实施，给出了详细的实施方式和具体的操作过程，但本发明的保护范围不限于下述的实施例。如图1所示，本实施例提供了一种基于双线以太网的网关系统，包括双线以太网网关装置、多个常规边缘终端和多个双线以太网边缘终端。双线以太网网关装置可以支持双线以太网边缘终端和常规边缘终端的接入。双线以太网网关装置，主控制芯片，以及分别连接主控制芯片的双线以太网PHY模块、常规以太网PHY模块、电源模块、SD卡模块、串口模块、RS485模块、CAN总线模块和MQTT通信模块。串口模块、RS485模块、CAN总线模块和MQTT通信模块分别连接串口接口平台、RS485接口平台、CAN总线接口平台和MQTT协议物联网平台。所有双线以太网边缘终端通过单对双绞线连接双线以太网PHY模块的接口。部分常规边缘终端通过双线以太网转换设备进行接口转换后接入单对双绞线，并通过单对双绞线连接双线以太网接口PHY模块的接口，其余常规边缘终端直接连接常规以太网PHY模块的接口。双线以太网网关装置从常规边缘终端和双线以太网边缘终端通过Modbus/TCP协议获取数据信息后，转发至串口接口平台、RS485接口平台、CAN总线接口平台，以及MQTT协议物联网平台中的一个或多个平台。双线以太网网关装置作为Modbus/TCP协议的Client端，配有传感器的边缘终端设备，即常规边缘终端和双线以太网边缘终端作为Modbus/TCP协议Server端。Server端可以实时采集传感器数据，Client端用于建立连接，从Server端读取寄存器数据。双线以太网网关装置采用Modbus/TCP协议读取边缘终端采集到的数据，并对接收到的数据进行缓存和转发。双线以太网网关装置采用Cortext-A7内核芯片作为网关系统核心控制器。Modbus/TCP协议物理层通信PHY采用双线以太网技术，实现单对双绞线传输Modbus/TCP协议数据帧，系统兼容常规以太网PHY。支持双线以太网PHY模块和常规以太网PHY模块无缝切换，PHY模块与主控制器之间采用通用RMII接口相连，切换PHY模块时内核驱动自动切换。可以接收支持双线以太网接口或者常规以太网接口的边缘终端设备传感器数据。双线以太网网关装置可以将接收到的传感器数据转发到相应接口的平台，支持转发的平台包括串口接口平台、RS485接口的平台、CAN总线协议接口的管理平台和、MQTT协议接口的阿里云物联网平台，实现多平台数据对接，增强系统兼容性。电源模块采用3.3V电源供电。CAN总线通信接口芯片采用NXP公司研发的TJA1050高速CAN总线收发器。RS485和串口通信接口采用TTL电平转RS485方式和TTL转串口方式设计，采用的芯片分别为SP3485和SP3232芯片设计。MQTT协议接口和Modbus/TCP协议接口共用一个PHY网络通信接口，根据需要可以选择常规以太网接口PHY芯片或者双线以太网接口PHY芯片所设计的通信模块。常规以太网接口芯片采用LAN8720A PHY芯片设计，双线以太网芯片采用市场最新研发的SPEPHY芯片设计。边缘终端将各通道传感器数据采集到边缘终端并存储到寄存器中，初始状态下边缘终端并不主动对外发送数据。由于通信协议采用Modbus/TCP协议，数据提供方一般作为Server端，考虑将提供数据的边缘终端设备作为Modbus/TCP Server端。基于Cortex-A7内核主控芯片所设计的网关数据来源是通过Modbus/TCP协议所读取的边缘终端设备数据，负责从终端设备获取传感器数据，将网关设备设计成Client端。Modbus/TCP具备读线圈、写单个线圈、写多个线圈、读离散量输入、读写单个或者多个输入寄存器和保持寄存器等功能。基于双线以太网的Modbus/TCP网关设备作为Modbus/TCP协议客户端，需要根据Server端存储数据的寄存器种类和帧格式读取相应的寄存器数据。Server端将读取的数据转发到串口或者RS485、CAN接口，同时可以打包成MQTT协议传输到阿里云云平台。如图2所示，为双线以太网网关装置的设计示意图。网络通信接口配有双线以太网PHY接口和常规以太网PHY接口，两种网络通信接口根据接入网关设备的边缘终端接口类型进行二选一即可。双线以太网PHY接口采用单对双绞线，用于接收双线以太网接口的边缘终端数据，网关兼容常规以太网接口的以太网边缘终端设备。双线以太网网关装置中，常规以太网PHY和双线以太网PHY均采用RMII接口与Cortex-A7内核主控芯片的MAC相连接。网络通信接口是Modbus/TCP通信协议的物理层载体，是基于TCP/IP通信协议的一种应用层通信方式。实现网络通信需要PHY和MAC两部分，PHY芯片主要将外部模拟电气信号进行解码，然后通过RMII接口发送至MAC外设。网络通信根据主控芯片是否集成MAC外设，需采用两种不同的电路设计。如果主控SOC内部没有集成MAC外设，则需要外扩MAC外设，使用集成MAC外设和PHY的芯片，并和主控制器之间使用SRAM接口或者SPI接口等其他通信接口传递数据。本发明所述的网关设备内部已经集成了MAC外设，无需集成MCA和PHY为一体的网络通信芯片，有效降低网络通信部分电路设计复杂度。如图3所示，为双线以太网网关装置平台转发示意图。所述的网关系统软件主要实现网关的各个功能，包括接收边缘终端设备数据上传功能、CAN总线接口转发功能、MQTT阿里云平台数据转发功能和RS485/串口接口转发功能等。首先边缘终端和网关设备建立连接，进行数据上传。网关设备通过Modbus/TCP协议接收到边缘终端设备上传的数据，然后通过Modbus/TCP协议接口、CAN总线接口、MQTT协议阿里云物联网接口和RS485/串口接口进行数据转发，分别接入支持Modbus/TCP协议接口管理平台、CAN总线接口的管理平台、阿里云物联网管理平台和RS485/串口接口平台。如图4所示，为双线以太网网关装置软件流程图。本实施例中采用Linux开源操作系统作为软件程序，新版Linux内核是支持设备树的一种系统，故通过设备树初始化系统。网关装置选用Cortex-A7内核控制芯片，内核程序自带CAN总线驱动，需要在系统设备树中启用驱动程序即可使用CAN总线通信。RS485/串口共用一个片内外设输出，外部接口采用RS485和SP3232进行电气转换，驱动为内核自带驱动，同一时刻只可二选一进行通信。网关系统首先手动初始化CAN总线通信频率，通信频率根据需要接入的CAN总线平台进行设定，将网关系统中CAN通信的频率和待接入的CAN总线平台设为相同的通信频率。然后启动网关程序，网关程序属于Modbus/TCP客户端，需要通过IP地址和端口号连接Modbus/TCP服务端。网关程序启动时通过外部参数输入Modbus/TCP服务端IP和端口号，服务端和客户端连接成功之后才可以顺利进行数据读写等操作。初始化程序中主要进行Modbus/TCP服务器程序线程和阿里云云平台SDK包接口线程启动。ModbusTCPServer_thread_exe和iot_ali_thread_exe为具体的线程初始化程序，主要进行连接初始化和参数初始化等任务。ModbusTCPServer_thread_exe线程中主要实现服务端连接程序初始化、Modbus/TCP线圈和保持寄存器等专有寄存器使用C语言方式实现地址映射。iot_ali_thread_exe初始化线程中主要实现阿里云物联网平台登录SDK包初始化、MQTT客户端初始化、服务器地址和端口初始化和三元组初始化。阿里云物联网平台三元组包括product_key、device_name和device_secret，用于网关设备连接阿里云物联网平台凭证。网关设备配置正确的三元组数据即可正常连接阿里云物联网平台产品对应的device设备，最后进入循环转发数据的流程，数据来源为Modbus/TCP客户端接收到服务端的本地缓存数据。当网关装置Client端和边缘终端Server端建立Modbus/TCP通信连接之后，网关装置启动读寄存器命令。边缘终端作为Server端，接收到Client读数据请求命令，将传感器数据打包成Modbus/TCP协议，作为响应数据返回给网关Client端。Client端接收到各通道传感器数据，将原始数据缓存到网关本地存储器。为保证数据传输实时性，网关本地接收到的数据立刻通过CAN和RS485/串口进行数据直接转发。考虑到不同网络之间数据帧格式差异性，转发传输的数据格式均采用通道编号和该通道编号数据一一对应的数据帧格式进行数据传输。当其他上位平台接收到CAN或者RS485/串口转发的数据后，可以根据数据帧格式解析通道和对应通道的采样数据。当网关系统和阿里云物联网平台建立连接之后，直接读取网关接收到的缓存数据。并将缓存数据打包成MQTT协议帧格式，通过阿里云物联网平台建立好产品和设备后下载的SDK包、API接口函数进行云平台数据发送。具体展开如下：1)启动网关程序，并通过参数输入Modbus/TCP服务端IP地址和端口号。2)双线以太网网关装置分配数据缓存寄存器空间。3)采用多线程技术，启动Modbus/TCP客户端线程，启动MQTT阿里云物联网平台数据转发线程。4)双线以太网网关装置尝试与边缘终端设备建立Modbus/TCP连接，连接成功之后，网关装置将通过Modbus/TCP协议读取数据并解析。同时将数据通过CAN接口转发至CAN接口平台、通过RS485/串口将数据转发至RS485或者串口接口平台，并将数据缓存到网关系统寄存器。5)双线以太网网关系统另一条线程同时启动MQTT协议，尝试与阿里云物联网平台建立连接，连接成功之后可以读取步骤4)中缓存的数据，并打包成指定MQTT协议数据帧格式进行数据转发至阿里云物联网平台。以上详细描述了本发明的较佳具体实施例。应当理解，本领域的普通技术人员无需创造性劳动就可以根据本发明的构思作出诸多修改和变化。因此，凡本技术领域中技术人员依本发明的构思在现有技术的基础上通过逻辑分析、推理或者有限的实验可以得到的技术方案，皆应在由权利要求书所确定的保护范围内。
