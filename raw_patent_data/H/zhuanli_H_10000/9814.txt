标题title
基于空中唤醒的LoRa-Mesh组网方法及移动终端入网方法
摘要abst
本发明提供一种基于空中唤醒的LoRa‑Mesh组网方法，包括：S0：将采集到信息的监测终端作为源节点，将网关作为目的节点；S1：源节点启动发送任务；S2：判断源节点能否单跳至目的节点，若是则转到S6，否则继续S3；S3：判断源节点的路由表中是否存在可用路由；若存在，则执行S5；否则，执行S4；S4：源节点启用融合唤醒与等待机制的AODV协议的路由发现；S5：向源节点单播RREP，更新源节点的路由表；S6：建立源节点到目的节点的连接。本发明还提供相应的移动终端入网方法。本发明的组网及移动终端入网方法对地面关键公共基础设施的监测范围更广，保证收发无线数据稳定性的同时，最大限度降低网络功耗。
权利要求书clms
1.一种基于空中唤醒的LoRa-Mesh组网方法，其特征在于，包括：步骤S0：提供网关和多个作为LoRa节点的监测终端，将采集到信息的监测终端作为源节点，将网关作为目的节点；步骤S1：源节点启动发送任务，添加源节点和目的节点对应的设备编号；步骤S2：判断源节点是否能单跳至目的节点，若是，则转到步骤S6，否则继续步骤S3；步骤S3：判断存储在源节点上的路由表中是否存在源节点到目的节点的可用的路由或者经修复变为可用的路由；若存在，则直接执行步骤S5；否则，继续执行步骤S4；步骤S4：源节点启用融合唤醒与等待机制的AODV协议的路由发现；步骤S5：向源节点单播RREP，以获取最优路径，更新源节点的路由表；步骤S6：建立源节点到目的节点的连接。2.根据权利要求1所述的基于空中唤醒的LoRa-Mesh组网方法，其特征在于，每个节点都存储并维护一个对应的路由表，所述路由表包括该节点的下一跳节点、该节点的上游节点列表、该节点到目的节点所需跳数、以及路由生存时间。3.根据权利要求1所述的基于空中唤醒的LoRa-Mesh组网方法，其特征在于，所述步骤S3包括：步骤S31：判断存储在源节点上的路由表中是否存在源节点到目的节点的对应路由，若是则继续步骤S32，否则转到步骤S4；步骤S32：判断对应路由是否可用，若否，则继续步骤S33，若是则转到步骤S5；步骤S33：开启融合空中唤醒的AODV协议的路由修复；步骤S34：判断路由修复是否成功，若是，则执行步骤S5，否则，执行步骤S4。4.根据权利要求3所述的基于空中唤醒的LoRa-Mesh组网方法，其特征在于，在步骤S32中，判断对应路由是否可用是利用路由表中的信息来判断的；路由表中的信息通过以下方式来进行日常的更新：开启定时器，定期空中唤醒源节点到目的节点的对应路由中的各个节点及其邻居节点，利用唤醒的节点广播Hello消息；若唤醒的节点的邻近节点超过定时器的定时仍未收到Hello消息，则判断为对应路由不可用，相应地更新路由表中对应路由的标志位以及路由生存时间；否则，判断为对应路由可用，更新路由表中对应路由的路由生存时间。5.根据权利要求3所述的基于空中唤醒的LoRa-Mesh组网方法，其特征在于，在所述步骤S33中，开启融合空中唤醒的AODV协议的路由修复，包括：步骤S331：判断节点断裂处到达目的节点的跳数是否小于到源节点的跳数，若是，则继续步骤S332，否则，转至步骤S333；步骤S332：当前节点将其路由表中相应的目的节点的序列号加一，向目的节点发送RREQ并设置限定时间，判断在所述限定时间内是否收到来自目的节点的RREP，同时记录来自源节点的数据；如果超过限定时间依旧没有收到来自目的节点的RREP，则转至步骤S333，否则，证明链路成功修复，记录来自源节点的数据，并转至步骤S5；步骤S333：空中唤醒节点断裂处的上游节点，向其发送RERR；上游节点删除路由表中对应路由信息；判断源节点是否收到RERR，若是，则转至步骤S4，否则重复所述步骤S333。6.根据权利要求1所述的基于空中唤醒的LoRa-Mesh组网方法，其特征在于，在所述步骤S4中，源节点启用融合唤醒与等待机制的AODV协议的路由发现，包括：步骤S41：当前节点向邻近节点广播前导码和添加节点的剩余能量字段的RREQ报文；步骤S42：周期性空中唤醒邻近节点；步骤S43：唤醒的邻近节点接收所述前导码和RREQ报文，并解析所述前导码，根据RREQ报文判断目标节点的地址是否与本邻近节点的地址一致，若否，则转至步骤S44，若是，则将邻近节点芯片设置为工作模式，以用于接收有效数据，并转至步骤S5；步骤S44：对于唤醒的邻近节点，判断当前的邻近节点的路由表中是否有到目标节点的有效路由，若是，则将邻近节点芯片设置为工作模式，以用于接收有效数据，并转至步骤S5，否则，继续步骤S45；步骤S45：将当前节点的邻近节点作为当前节点，首先判断当前节点的等待时长△t是否大于睡眠周期T，若否，则当前节点保持唤醒状态；若是，则当前节点睡眠，循环次数加1，并继续判断循环次数i是否大于N，若是，则当前节点结束广播，否则，返回步骤S41。7.根据权利要求6所述的基于空中唤醒的LoRa-Mesh组网方法，其特征在于，在所述步骤S41中，通过MAC层获得节点的剩余能量，在RREQ消息中添加节点的剩余能量的字段，使得在源节点向邻近节点广播添加节点的剩余能量字段的RREQ报文。8.根据权利要求6所述的基于空中唤醒的LoRa-Mesh组网方法，其特征在于，所述步骤S42包括：每个邻近节点在每个唤醒周期判断自身的剩余能量是否＞Q，对于结果为否的邻近节点则继续睡眠，对于结果为是的邻近节点则周期性地进入唤醒状态。9.根据权利要求6所述的基于空中唤醒的LoRa-Mesh组网方法，其特征在于，在所述步骤S43中，所述工作模式为RX单一或者RX连续模式。10.一种基于空中唤醒的LoRa-Mesh移动设备入网方法，其特征在于，包括：步骤S1’：执行根据权利要求1-8置于的基于空中唤醒的LoRa-Mesh组网方法，以建立源节点到目的节点的连接并获得各个源节点采集到的历史信息；智能移动终端开启巡检任务；步骤S2’：空中唤醒LoRa节点；步骤S3’：智能移动终端启用融合唤醒与等待机制的AODV协议的路由发现，以寻找到智能移动终端到目的节点的路由；步骤S4’：建立智能移动终端到目的节点的连接；步骤S5’：对于各个LoRa节点，判断LoRa节点是否有历史数据上传失败，若是，则向智能移动终端上传历史数据再上传最新数据，若否则直接向智能移动终端上传最新数据；步骤S6’：在所有LoRa节点的历史数据和最新数据上传完成时，智能移动终端结束巡检任务。
说明书desc
技术领域本发明涉及无线传感器网络接入领域，特别是基于空中唤醒的LoRa-Mesh组网的方法及移动终端入网方法。背景技术在特大型城市的路桥隧场景下存在海量的地面关键基础设施，为实现对地面关键公共设施的运行体征系统化、智能化物联监测，需要对关键公共基础设施的泛在接入进行研究。目前已有将无线传感器网络引入城市监测中，提高城市地面关键基础设施生命体征监测的稳定性和高效性。在无线通信方面Wi-Fi、蓝牙、ZigBee等高频无线通信技术由于传输距离较短，应用会受到诸多限制。在长距离低功耗无线技术中主要有LoRa和NB-IoT两种接入技术，其中NB-IoT依赖于移动蜂窝网络，在不少路桥隧经过的区域，信号质量不佳，影响监测网络的可靠性。LoRa技术因为传输距离较长，支持独立组网，扩展性能优异，节点容量大，可供海量传感器接入，电池寿命长且通讯成本低，可以作为路桥隧场景下地面关键公共基础设施监测终端入网技术。但是传统的LoRa组网方式使用星型拓扑结构，存在诸多缺点，连接距离短、扩展性差，远端节点连接不稳定或者无法连接。比如在路桥隧环境中，具有横截面积小、空间有限且空间封闭等特征，LoRa技术单跳的通信范围受限，采用星型的LoRa组网方式对隧道进行监测，距离网关较远的节点无法入网，致使目标监测区域采集的数据无法上传至网关，无法为整条隧道中的监测设备提供真正普遍的连接，造成数据丢失，导致网络使用困难。因此，急需一种基于空中唤醒设计的LoRa-Mesh组网方案来满足隧道关键公共基础设施监测终端入网的要求。目前为止，常用的无线网络协议主要是表驱动路由协议以及按需路由协议。其中采用表驱动路由协议时，若网络拓扑更改，节点将在整个网络中传播、更新消息，以维护有关整个网络的一致且最新的路由信息，电池能量消耗高，网络生存时间相对较短。AODV协议属于按需路由协议，当节点遇到屏蔽或者干扰，网络通信受阻时，网络会通过AODV协议实现节点跳转，自动寻找新的通信路径，提高容错能力，且当开启AODV协议的路由维护过程中，若在周期性向邻近节点广播Hello时发现节点之间链路断裂，只有在前链路中有传输数据的需求时，才会启动路由修复过程，减少能量消耗。发明内容本发明的目的在于提供一种基于空中唤醒的LoRa-Mesh组网方法及移动终端入网方法，以对地面关键公共基础设施的监测范围更广，保证收发无线数据稳定性的同时，最大限度降低网络功耗。为了实现上述目的，本发明提供了一种基于空中唤醒的LoRa-Mesh组网方法，包括：S0：提供网关和多个作为LoRa节点的监测终端，将采集到信息的监测终端作为源节点，将网关作为目的节点；S1：源节点启动发送任务，添加源节点和目的节点对应的设备编号；S2：判断源节点是否能单跳至目的节点，若是则转到步骤S6，否则继续步骤S3；S3：判断存储在源节点上的路由表中是否存在源节点到目的节点的可用的路由或者经修复变为可用的路由；随后，根据判断结果，若存在，则直接执行步骤S5；否则，继续执行步骤S4；S4：源节点启用融合唤醒与等待机制的AODV协议的路由发现；S5：向源节点单播RREP，以获取最优路径，更新源节点的路由表；S6：建立源节点到目的节点的连接。每个节点都存储并维护一个对应的路由表，所述路由表包括该节点的下一跳节点、该节点的上游节点列表、该节点到目的节点所需跳数、以及路由生存时间。所述步骤S3包括：S31：判断存储在源节点上的路由表中是否存在源节点到目的节点的对应路由，若是则继续步骤S32，否则转到步骤S4；S32：判断对应路由是否可用，若否，则继续步骤S33，若是则转到步骤S5；S33：开启融合空中唤醒的AODV协议的路由修复；S34：判断路由修复是否成功，若是，则执行步骤S5，否则，执行步骤S4。在步骤S32中，判断对应路由是否可用是利用路由表中的信息来判断的；路由表中的信息通过以下方式来进行日常的更新：开启定时器，定期空中唤醒源节点到目的节点的对应路由中的各个节点及其邻居节点，利用唤醒的节点广播Hello消息；若唤醒的节点的邻近节点超过定时器的定时仍未收到Hello消息，则判断为对应路由不可用，相应地更新路由表中对应路由的标志位以及路由生存时间；否则，判断为对应路由可用，更新路由表中对应路由的路由生存时间。在所述步骤S33中，开启融合空中唤醒的AODV协议的路由修复，包括：S331：判断节点断裂处到达目的节点的跳数是否小于到源节点的跳数，若是，则继续步骤S332，否则，转至步骤S333；S332：当前节点将其路由表中相应的目的节点的序列号加一，向目的节点发送RREQ并设置限定时间，判断在所述限定时间内是否收到来自目的节点的RREP，同时记录来自源节点的数据；如果超过限定时间依旧没有收到来自目的节点的RREP，则转至步骤S333，否则，证明链路成功修复，记录来自源节点的数据，并转至步骤S5；S333：空中唤醒节点断裂处的上游节点，向其发送RERR；上游节点删除路由表中对应路由信息；判断源节点是否收到RERR，若是，则转至步骤S4，否则重复所述步骤S333。在所述步骤S4中，源节点启用融合唤醒与等待机制的AODV协议的路由发现，包括：S41：当前节点向邻近节点广播前导码和添加节点的剩余能量字段的RREQ报文；S42：周期性空中唤醒邻近节点；S43：唤醒的邻近节点接收所述前导码和RREQ报文，并解析所述前导码，根据RREQ报文判断目标节点的地址是否与本邻近节点的地址一致，若否，则转至步骤S44，若是，则将邻近节点芯片设置为工作模式，以用于接收有效数据，并转至步骤S5；S44：对于唤醒的邻近节点，判断当前的邻近节点的路由表中是否有到目标节点的有效路由，若是，则将邻近节点芯片设置为工作模式，以用于接收有效数据，并转至步骤S5，否则，继续步骤S45；S45：将当前节点的邻近节点作为当前节点，首先判断当前节点的等待时长△t是否大于睡眠周期T，若否，则当前节点保持唤醒状态；若是，则当前节点睡眠，循环次数加1，并继续判断循环次数i是否大于N，若是，则当前节点结束广播，否则，返回步骤S41。在所述步骤S41中，通过MAC层获得节点的剩余能量，在RREQ消息中添加节点的剩余能量的字段，使得在源节点向邻近节点广播添加节点的剩余能量字段的RREQ报文。所述步骤S42包括：每个邻近节点在每个唤醒周期判断自身的剩余能量是否＞Q，对于结果为否的邻近节点则继续睡眠，对于结果为是的邻近节点则周期性地进入唤醒状态。在所述步骤S43中，所述工作模式为RX单一或者RX连续模式。另一方面，本发明提供一种基于空中唤醒的LoRa-Mesh移动设备入网方法，包括：S1’：执行根据权利要求1-8置于的基于空中唤醒的LoRa-Mesh组网方法，以建立源节点到目的节点的连接并获得各个源节点采集到的历史信息；智能移动终端开启巡检任务；S2’：空中唤醒LoRa节点；S3’：智能移动终端启用融合唤醒与等待机制的AODV协议的路由发现，以寻找到智能移动终端到目的节点的路由；S4’：建立智能移动终端到目的节点的连接；S5’：对于各个LoRa节点，判断LoRa节点是否有历史数据上传失败，若是，则向智能移动终端上传历史数据再上传最新数据，若否则直接向智能移动终端上传最新数据；S6’：在所有LoRa节点的历史数据和最新数据上传完成时，智能移动终端结束巡检任务。本发明的基于空中唤醒的LoRa-Mesh组网方法应用LoRa空中唤醒技术，并将LoRa与Mesh技术结合，使远端节点通过中继节点稳定入网，对地面关键公共基础设施的监测范围更广；并且当节点掉线且有数据传输任务时启动路由修复，以在保证收发无线数据稳定性的同时，最大限度降低网络功耗。LoRa节点和网关形成整条路上的LoRa-Mesh网络，即以网关为核心，向周围扩展网络覆盖，可以有效解决区域内信号的广覆盖、大量节点的接入问题。另外，本发明的基于空中唤醒的LoRa-Mesh移动终端入网方法基于LoRa空中唤醒技术运用智能移动检测设备，用于临时检测，可实现对网络的集中管理、实时检测，降低人工排查的成本和风险。本发明扩大了对地面关键公共基础设施的监测范围，可以动态自组织和自配置，进行动态分配工作负载，从而减少了安装开销，实现了可靠的无线网络通信。当遇到屏蔽或者干扰，网络通信受阻无法直接和网关建立连接时，网络会通过融合唤醒与等待机制的AODV协议实现节点跳转，自动寻找新的通信路径，提高容错能力并降低维护成本。智能移动检测终端通过空中唤醒技术快速地采集数据，实现对网络的集中管理、实时检测。附图说明图1为本发明的基于空中唤醒的LoRa-Mesh组网方法的适用场景的架构图。图2为本发明的基于空中唤醒的LoRa-Mesh组网方法的流程图；图3为本发明的基于空中唤醒的LoRa-Mesh组网方法中判断路由是否可用及开启融合空中唤醒的AODV协议的路由修复的流程图；图4为本发明的基于空中唤醒的LoRa-Mesh组网方法中融合唤醒与等待机制的AODV协议的路由发现的流程图；图5为本发明的基于空中唤醒的LoRa-Mesh组网装置的组成框图；图6为本发明中临时检测模式下智能移动检测终端的工作流程图。具体实施方式下面结合具体实施例，进一步阐述本发明。应理解，这些实施例仅用于说明本发明而不用于限制本发明的范围。此外应理解，在阅读了本发明讲授的内容之后，本领域技术人员可以对本发明作各种改动或修改，这些等价形式同样落于本申请所附权利要求书所限定的范围。本发明的基于空中唤醒的LoRa-Mesh组网方法用于满足隧道关键公共基础设施监测终端入网的要求。如图1所示，本发明所适用的场景包括隧道、安装在隧道中的多个作为LoRa节点的监测终端、用于与LoRa节点组网的网关、与网关通信连接的云服务器、以及通过API接口与云服务器连接的多个应用终端。LoRa节点用于采集隧道中关键公共基础设施的相关信息，以实时稳定、高效智能地对隧道空间结构安全进行精细化管理。传统的LoRa组网方式属于星状网络，连接距离短、扩展性差，远端节点连接不稳定或者无法连接。而本发明基于LoRa-Mesh组网方式，其属于混合网络，连接距离远、扩展性强，远端节点通过中继节点稳定入网，并且节点支持掉线重连，采用多种智能重连机制保证网络的稳定性。本发明基于AODV协议，并在AODV协议的基础上融入唤醒与等待机制，以实现路由发现和路由维护，将路由表中的路由生命周期设置为大于所有节点的上传周期，进一步降低损耗，延长网路使用寿命并降低维护成本。本发明的基于空中唤醒的LoRa-Mesh组网技术包括节点主动上报和临时检测两种工作模式，所述方法主要有以下步骤：首先采集到信息的监测终端作为源节点启动发送任务，判断源节点是否能单跳至网关，若是则直接建立连接，若否则继续判断源节点是否存在到目的节点的有效路由，若有则建立连接，若否则源节点启用融合唤醒与等待机制的AODV协议，寻找到目的节点的路由、更新路由表，并建立连接。具体来说，本发明的基于空中唤醒的LoRa-Mesh组网方法包括：步骤S0：提供网关和多个作为LoRa节点的监测终端，将采集到信息的监测终端作为源节点，将网关作为目的节点；其中，源节点是采集到信息的监测终端，目的节点是指网关，所有源节点发送的目的地都是网关。步骤S1：源节点启动发送任务，添加源节点和目的节点对应的设备编号；步骤S2：判断源节点是否能单跳至目的节点，若是则转到步骤S6，否则继续步骤S3；步骤S3：对源节点到目的节点的路由进行路由维护，并判断路由维护结果；随后，根据判断结果，若存在，则直接执行步骤S5；否则，继续执行步骤S4；其中，每个节点都存储并维护一个对应的路由表，所述路由表主要包括：该节点的下一跳节点、该节点的上游节点列表、该节点到目的节点所需跳数、以及路由生存时间等。步骤S4：源节点启用融合唤醒与等待机制的AODV协议的路由发现；步骤S5：向源节点单播RREP，以获取最优路径，更新源节点的路由表；由此，通过单播RREP告知发送RREQ消息的源节点其到目的节点的路由。步骤S6：建立源节点到目的节点的连接。其中，所述步骤S3具体包括：步骤S31：判断存储在源节点上的路由表中是否存在源节点到目的节点的对应路由，若是则继续步骤S32，否则转到步骤S4；步骤S32：判断对应路由是否可用，若否，则继续步骤S33，若是则转到步骤S5；步骤S33：开启融合空中唤醒的AODV协议的路由修复；步骤S34：判断路由修复是否成功，若是，则执行步骤S5，否则，执行步骤S4。其中，步骤S33的路由修复的过程中加入定期空中唤醒，即LoRa默认处于睡眠模式，有任务时需要先唤醒。如图3所示，在步骤S32中，判断对应路由是否可用是利用路由表中的信息来判断的。而路由表中的信息通过以下方式来进行日常的更新：开启定时器，定期空中唤醒源节点到目的节点的对应路由中的各个节点及其邻居节点，利用唤醒的节点广播Hello消息；若唤醒的节点的邻近节点超过定时器的定时仍未收到Hello消息，则判断为对应路由不可用，相应地更新路由表中对应路由的标志位以及路由生存时间，从而在之后步骤S32判断为路由不可用时相应执行步骤S33以进行路由修复；否则，判断为对应路由可用，更新路由表中对应路由的路由生存时间。Hello是AODV路由协议规定的路由维护的一种机制；具体通过规定时间内是否收到邻近节点的回复消息来判断路由是否可用；而Hello用于日常定期的路由维护。在判断为对应路由可用之后，在执行步骤S5向源节点单播RREP时，可以进一步判断是否存在对应的反向路由，若存在对应的反向路由则更新源节点的路由表，否则丢弃Hello消息。在所述步骤S33中，开启融合空中唤醒的AODV协议的路由修复，包括：步骤S331：判断节点断裂处到达目的节点的跳数是否小于到源节点的跳数，若是，则继续步骤S332，否则，转至步骤S333；步骤S332：启动本地路由修复：当前节点将其路由表中相应的目的节点的序列号加一，向目的节点发送RREQ并设置时间限制，判断在限定时间内是否收到来自目的节点的RREP，同时记录来自源节点的数据，如果超过限定时间依旧没有收到来自目的节点的RREP，说明修复不成功，则转至步骤S333，否则，即目的节点收到RREQ后在限定时间回复RREP，就证明链路成功修复，转至步骤S5；步骤S333：开始源节点路由修复：空中唤醒节点断裂处的上游节点，向其发送RERR；上游节点删除路由表中对应路由信息；判断源节点是否收到RERR，若是，则转至步骤S4，以使得源节点重新路由发现，否则继续唤醒上游节点以重复所述步骤S333。在所述步骤S4中，融合唤醒与等待机制的AODV协议是相比于现有技术经过改进的AODV协议，具体来说，唤醒机制是LoRa组网的机制，其用于保证节点的低功耗工作；而AODV协议是已有的路由协议，默认节点是工作状态，所以在该应用场景下需要将二者结合，实现优势互补。融合唤醒与等待机制的AODV协议基于以下原理：每个LoRa节点都有自己的唤醒周期，有效数据前加一段前导码，LoRa节点默认会周期性自动醒来，自动监听下网络，采用CAD检测数据包的前导码，一旦捕捉到前导码就进入正常的接收流程，查看有没有需要自己处理的任务，如果没有，就继续休眠，等待下一次唤醒；如果有，则被唤醒进入接收状态。不是需要所有节点都同步一起醒来。如图4所示，在所述步骤S4中，源节点启用融合唤醒与等待机制的AODV协议的路由发现，包括：步骤S41：当前节点向邻近节点广播前导码和添加节点的剩余能量字段的RREQ报文；其中，在第一次执行步骤S41时，源节点为最初的当前节点；邻近节点可限定为接收到信号的RSSI＞-110dB的LoRa节点。其中，前导码用于保持接收机与输入的数据流同步。默认情况下，数据包含有12个符号长度的前导码。前导码的长度是一个可以通过编程来设置的变量，所以前导码的长度可以扩展。接收机的前导码的长度应与发射机一致。在所述步骤S41中，通过MAC层获得节点的剩余能量，在RREQ消息中添加节点的剩余能量的字段，使得在源节点向邻近节点广播添加节点的剩余能量字段的RREQ报文。步骤S42：周期性空中唤醒邻近节点；所述步骤S42包括：每个邻近节点在每个唤醒周期判断自身的剩余能量是否＞Q，对于结果为否的邻近节点则继续睡眠，对于结果为是的邻近节点则周期性地进入唤醒状态以进行自动监听，以继续执行步骤S43。步骤S43：唤醒的邻近节点接收所述前导码和RREQ报文，并解析所述前导码，根据RREQ报文判断目标节点的地址是否与本邻近节点的地址一致，若否，则转至步骤S44，若是，则将邻近节点芯片设置为工作模式，以用于接收有效数据，并转至步骤S5；步骤S44：对于唤醒的邻近节点，判断当前的邻近节点的路由表中是否有到目标节点的有效路由，若是，则将邻近节点芯片设置为工作模式，以用于接收有效数据，并转至步骤S5，否则，继续步骤S45；其中，在转至步骤S5时，向源节点单播RREP是指每个邻近节点仅仅在第一次收到RREQ报文时发送RREP来进行应答，使得每个邻近节点能够选择出从自身最早抵达源节点的路径，此外，根据步骤S42，节点选择时若节点剩余能量太低则不选，所以最终的最优路径其实是在满足对节点能量要求的前提下最早抵达源节点的路径。步骤S45：将当前节点的邻近节点作为各个当前节点，进行当前节点等待时长与广播次数的判断。具体来说，首先判断当前节点的等待时长△t是否大于睡眠周期T，若否，则当前节点继续等待；若是，则当前节点睡眠，循环次数加1，继续判断循环次数i是否大于N，若是，则当前节点结束广播，以等待移动智能终端检测或路由修复，否则，返回步骤S41。也就是说，若判断为等待时长与广播次数超过预设值，则结束广播，等待移动智能终端检测或路由修复；否则，说明判断为等待时长与广播次数超过预设值之前，已经回到步骤S41且步骤S43被最终判断为“是”，因此最终转至步骤S5。N的具体值通过实际环境仿真确定。由此，本发明在路由发现过程中，增加了空中唤醒以及等待时长与LoRa节点的睡眠周期的判断，以节约节点的电量。如图5所示，基于上文所述的基于空中唤醒的LoRa-Mesh组网方法，所实现的基于空中唤醒的LoRa-Mesh组网装置，包括任务启动模块、LoRa节点等待处理模块、LoRa节点空中唤醒模块、最佳路由发现和路由维护模块以及连接建立模块。具体来说，节点等待处理模块的计时单元：用于计算当前节点等待时长；判断单元：用于当前节点的等待时常与节点的睡眠周期的比较；处理单元：根据判断单元的比较结果，选择相应的处理方式：继续等待回应或者结束广播等待移动检测终端。LoRa节点空中唤醒模块的发送单元设置为：向邻近节点广播前导码和添加节点的剩余能量字段的RREQ报文；判断单元设置为：判断目标地址是否与本节点的地址一致，用于决定是否唤醒；接收单元设置为：根据判断单元的判断结果决定是否唤醒转为接收模式，用于接收RREQ有效数据。最佳路由发现和路由维护模块的发现单元设置为：试图发现一条从源节点到目的节点的新的最优路径；存储单元设置为：存储该节点的下一跳节点、该节点的上游节点列表、该节点到目的节点所需跳数、以及路由生存时间等信息，用于路由维护以及便于下次快速建立连接；维护单元设置为：判断节点之间的链路情况以及链路断裂且有数据传输任务时的路由修复；更新单元设置为：更新路由表中对应的信息，可用于判断路由是否有效可用等。其中，任务启动模块设置为执行所述步骤S0-步骤S1，以启动发送任务。LoRa节点空中唤醒模块，其设置为执行所述步骤S41-所述步骤S44，从而唤醒处于睡眠模式下的LoRa节点，将其置于RX单一或者RX连续模式，收发有效数据。所述LoRa节点等待处理模块设置为执行所述步骤S45，从而通过限制当前节点等待响应的时长和广播次数，保证空中唤醒的有效性，避免节点出现无限循环广播，延长节点的使用寿命。所述最佳路由发现和路由维护模块，设置为执行所述步骤S3和所述步骤S5，用于最优路径的发现和路由表的维护更新。连接建立模块设置为执行所述步骤S2和所述步骤S6，从而建立连接。具体地说，LoRa节点空中唤醒模块可用于路由发现时对邻近节点的唤醒、路由维护过程中广播Hello报文时对邻近节点的唤醒、启动路由修复时对上游节点的唤醒、智能移动检测设备开启临时检测任务时对节点的唤醒，减少LoRa节点在线工作的时间。最佳路由发现和路由维护模块，考虑了节点剩余能量，因此不仅可以提高网络能量利用率也能提高网络数据传输的稳定性。LoRa源节点等待处理模块，通过对广播后等待时长和广播次数的判断，避免生成网络环路或产生无限循环广播，其中的智能移动设备可实现对网络的集中管理、实时检测，降低人工排查的成本和风险。综上所述，基于空中唤醒的地面关键公共基础设施监测终端LoRa-Mesh组网的实现装置的应用，实现了地面监测终端高效可靠的无线网络接入，扩展网络覆盖范围，并延长网络使用寿命。基于上文所述的基于空中唤醒的LoRa-Mesh组网方法，所实现的基于空中唤醒的LoRa-Mesh移动设备入网方法，其用于使智能移动终端入网，实现突发状况下的临时检测。所述智能移动终端为智能移动检测设备，其安装于巡检车或地铁、汽车等。如图6所示，基于空中唤醒的LoRa-Mesh移动设备入网方法，包括：步骤S1’：执行上文所述的基于空中唤醒的LoRa-Mesh组网方法，以建立源节点到目的节点的连接并获得各个源节点采集到的历史信息；智能移动终端开启巡检任务；步骤S2’：空中唤醒LoRa节点；步骤S3’：智能移动终端启用融合唤醒与等待机制的AODV协议的路由发现，以寻找到智能移动终端到目的节点的路由；步骤S4’：建立智能移动终端到目的节点的连接；步骤S5’：对于各个LoRa节点，判断LoRa节点是否有历史数据上传失败，若是，则向智能移动终端上传历史数据再上传最新数据，若否则直接向智能移动终端上传最新数据；步骤S6’：在所有LoRa节点的历史数据和最新数据上传完成时，智能移动终端结束巡检任务。本发明的基于空中唤醒的LoRa-Mesh组网方法，使得对地面关键公共基础设施的监测范围更广，提高容错能力，降低维护成本，有效解决区域内信号的覆盖、大量节点的接入问题。本发明的基于空中唤醒的LoRa-Mesh组网装置，实现了地面监测终端高效可靠的无线网络接入，并延长网络使用寿命。本发明的基于空中唤醒的LoRa-Mesh移动终端入网方法，可应用于临时检测场景下，能够对网络进行集中管理、实时检测，降低人工排查的成本和风险。以上所述的，仅为本发明的较佳实施例，并非用以限定本发明的范围，本发明的上述实施例还可以做出各种变化。凡是依据本发明申请的权利要求书及说明书内容所作的简单、等效变化与修饰，皆落入本发明专利的权利要求保护范围。本发明未详尽描述的均为常规技术内容。
