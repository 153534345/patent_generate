标题title
用于数字图像传感器的像素级增益调整的数字转换
摘要abst
本申请描述了用于CMOS图像传感器中像素信号的数字转换技术。该CIS包括列并行模数转换器，每个ADC都有一个支持N个增益设置的可编程增益放大器。每个ADC可以针对该N个增益设置中的每个增益设置执行各自的重置阶段转换，以获得与该Gn相关联的各自的基线偏移。可以将预判值确定为像素信号的函数，该预判值对应于该增益设置中所选的一个增益设置。可以通过使用该预判值将该PGA的增益设置为Gs并获得信号偏移来转换该像素信号。可以针对作为该SO和该BOs的函数的像素信号计算数字像素输出，其中该BOs是对应于Gs的BOn。
权利要求书clms
1.一种用于CMOS图像传感器CIS的可编程增益模数转换器系统，所述系统包括：可编程增益放大器PGA，用于从CMOS图像传感器CIS的像素输出接收像素信号，所述像素输出是所述CIS的多个像素输出之一，每个像素输出与多个PGA相关联的PGA之一相耦合，每个PGA具有N个增益设置，N为大于1的整数；以及处理器，与所述PGA耦合，用于：针对所述N个增益设置中的每个增益设置Gn执行各自的重置阶段转换，以获得与所述Gn相关联的各自的基线偏移BOn,将预判值确定为像素信号的函数，所述预判值对应于所述增益设置Gs中所选的一个增益设置,通过使用所述预判值将所述PGA的增益设置为所述Gs并获得信号偏移SO来转换所述像素信号,以及针对作为所述SO和所述BOs的函数的像素信号计算数字像素输出，其中所述BOs是对应于Gs的BOn。2.根据权利要求1所述的系统，其中，所述处理器用于通过执行数字相关双采样来计算所述数字像素输出，使得所述数字像素输出与所述SO和所述BOs之间的差值相关。3.根据权利要求1所述的系统，其中，N等于2，使得每个PGA具有高增益设置和低增益设置。4.根据权利要求1所述的系统，其中：所述PGA包括运算放大器，所述运算放大器具有经由输入电容器网络接收所述像素信号的输入节点，以及经由具有多个反馈电容器的反馈电容器网络通过反馈路径与所述输入节点耦合的输出节点；所述PGA的增益根据所述输入电容器网络与所述反馈电容器网络的电容比来确定；以及所述处理器用于通过选择性地将一些或所有所述反馈电容器切换到所述反馈路径中，以调整所述反馈电容器网络的总电容来设置所述PGA的增益。5.根据权利要求4所述的系统，其中：所述反馈电容器网络包括通过第一开关与所述输入节点耦合，且通过第二开关与所述输出节点耦合的第一反馈电容器，所述第一开关和所述第二开关始终闭合，使得所述第一反馈电容器始终处于所述反馈路径；以及所述反馈电容器网络包括通过第三开关与所述输入节点耦合，且通过第四开关与所述输出节点耦合的第二反馈电容器，所述第三开关和所述第四开关根据所述增益设置进行操作，使得所述第三开关和所述第四开关均根据所述PGA处于所述N增益设置的第一个而关闭，并且所述第三开关和所述第四开关均根据所述PGA处于所述N增益设置的第二个而打开。6.根据权利要求1所述的系统，还包括：比较器，所述比较器具有与由所述PGA产生的PGA输出信号耦合的第一输入比较器节点，与参考电压耦合的第二输入比较器节点，以及输出比较器节点，当所述PGA输出信号高于所述参考电压时，所述输出比较器节点输出第一比较器值，当所述参考电压高于所述PGA输出信号时，所述输出比较器节点输出第二比较器值；以及计数器，与所述比较器耦合，并且用于对应于当检测到从所述第一比较器值到所述第二比较器值的变化时而停止计数，并且输出计数值。7.根据权利要求6所述的系统，其中，所述处理器用于通过以下方式为每个Gn反复地执行各自的重置阶段转换：根据所述Gn设定所述PGA的增益，所述PGA对应于处于自动归零AZ模式的像素信号而产生所述PGA输出信号；将所述参考电压从低参考电平斜升到AZ阈值电平，所述低参考电平低于所述PGA输出信号的预判最低电平，而所述AZ阈值电平高于所述PGA输出信号；以及随着斜升的开始触发所述计数器开始计数，使得停止所述计数时的计数值指示对应于Gn的BOn。8.根据权利要求6所述的系统，还包括：锁存器，所述锁存器具有与所述输出比较器节点耦合的锁存输入以及与PGA增益控制耦合的锁存输出，其中，所述处理器用于通过以下方式来确定所述预判值:根据高增益设置来设置所述PGA的增益，所述PGA产生所述PGA输出信号，所述PGA输出信号对应于处于传输信号TS模式的所述像素信号；将所述参考电压设置为TS阈值电平；以及在预判使能时间触发所述锁存器，以将所述输出比较器节点处的值记录为所述预判值，从而所述预判值通过所述PGA增益控制来指导所述PGA的增益设置之一的选择。9.根据权利要求8所述的系统，其中，根据所述高增益设置，所述TS阈值电平对应于预判阈值电平乘以所述PGA的增益。10.根据权利要求6所述的系统，其中，所述处理器用于通过以下方式转换所述像素信号：根据对应于确定所述预判值的所述Gs，设置所述PGA的增益，所述PGA产生所述PGA输出信号，所述PGA输出信号对应于处于传输信号TS模式的所述像素信号；将所述参考电压从低参考电平斜升到高参考电平，所述低参考电平低于所述PGA输出信号的预判最低电平，而所述高参考电平高于所述PGA输出信号的预判最高电平；以及随着斜升的开始触发所述计数器开始计数，使得停止所述计数时的计数值指示所述SO。11.根据权利要求10所述的系统，其中：在所有所述N个增益设置中，SO具有0到2^M-1的满量程范围；所述增益设置中的第一个与所述满量程范围的第一部分相关联，所述满量程范围的第一部分从0扩展到所述满量程范围的第一中间值；所述增益设置中的第二个与所述满量程范围的第二部分相关联，所述满量程范围的第二部分从所述满量程范围的第二中间值延伸到2^M-1，所述第二部分与所述第一部分重叠；所述计数器的基本计数器分辨率为K位，其中，K＝M-X；以及转换所述像素信号包括：具有对应于所述增益设置的第一个的Gs，所述计数器用于表示从0到2^K-1的值，所述第一中间值小于2^K-1，以及具有对应于所述增益设置的第二个的Gs，所述计数器用于表示从2^X到2^M-1的值，所述第二中间值大于2^X。12.一种CMOS图像传感器CIS，包括：一列像素，每个像素包括光电检测器电路，所述光电检测器电路用于记录对应于在曝光窗口期间暴露于一定量的光的像素信号电平，所述阵列具有多个像素行和多个像素列；多个列并行模数转换器ADC，每个ADC与所述多个像素列中的相应一个耦合，每个ADC包括：可编程增益放大器PGA，用于从CMOS图像传感器CIS的像素输出接收像素信号，所述像素输出是所述CIS的多个像素输出之一，每个像素输出与多个PGA相关联的PGA之一相耦合，每个PGA具有N个增益设置，N为大于1的整数；以及处理器，与所述PGA耦合，用于：针对所述N个增益设置中的每个增益设置Gn执行各自的重置阶段转换，以获得与所述Gn相关联的各自的基线偏移BOn，将预判值确定为像素信号的函数，所述预判值对应于所述增益设置Gs中所选的一个增益设置，通过使用所述预判值将所述PGA的增益设置为所述Gs并获得信号偏移SO来转换所述像素信号，以及针对作为所述SO和所述BOs的函数的像素信号计算数字像素输出，其中所述BOs是对应于Gs的BOn。13.一种用于从CMOS图像传感器CIS生成数字像素级输出的方法，所述方法包括：在与所述CIS的像素输出耦合的可编程增益放大器PGA处接收像素信号，所述像素输出是所述CIS的多个像素输出之一，每个像素输出与多个PGA相关联的PGA之一相耦合，每个PGA具有N个增益设置，N为大于1的整数；针对所述N个增益设置中的每个增益设置Gn执行各自的重置阶段转换，以获得与所述Gn相关联的各自的基线偏移BOn；将预判值确定为像素信号的函数，所述预判值对应于所述增益设置Gs中所选的一个增益设置；通过使用所述预判值将所述PGA的增益设置为所述Gs并获得信号偏移SO来转换所述像素信号；以及针对作为所述SO和所述BOs的函数的像素信号计算数字像素输出，其中所述BOs是对应于Gs的BOn。14.根据权利要求13所述的方法，其中，计算所述数字像素输出包括执行数字相关双采样，使得所述数字像素输出与所述SO和所述BOs之间的差值相关。15.根据权利要求13所述的方法，其中，N等于2，使得每个PGA具有高增益设置和低增益设置。16.根据权利要求13所述的方法，其中：执行各自的重置阶段转换，确定所述预判值以及转换所述像素信号是利用比较器和计数器进行的；所述比较器具有与由所述PGA输出的PGA输出信号耦合的第一输入比较器节点，与参考电压耦合的第二输入比较器节点，以及输出比较器节点，当所述PGA输出信号高于所述参考电压时，所述输出比较器节点输出第一比较器值，当所述参考电压高于所述PGA输出信号时，所述输出比较器节点输出第二比较器值；以及所述计数器，用于对应于当检测到从所述第一比较器值到所述第二比较器值的变化时而停止计数，并且输出计数值。17.根据权利要求16所述的方法，其中，执行所述相应的重置阶段转换包括，对每个Gn反复地：根据所述Gn设定所述PGA的增益，所述PGA对应于处于自动归零AZ模式的像素信号而产生所述PGA输出信号；将所述参考电压从低参考电平斜升到AZ阈值电平，所述低参考电平低于所述PGA输出信号的预判最低电平，而所述AZ阈值电平高于所述PGA输出信号；以及随着斜升的开始触发所述计数器开始计数，使得停止所述计数时的计数值指示对应于Gn的BOn。18.根据权利要求16所述的方法，其中，确定所述预判值包括:根据高增益设置来设置所述PGA的增益，所述PGA产生所述PGA输出信号，所述PGA输出信号对应于处于传输信号TS模式的所述像素信号；将所述参考电压设置为TS阈值电平；以及在预判使能时间触发锁存器，以将所述输出比较器节点处的值记录为所述预判值。19.根据权利要求16所述的方法，其中，所述转换像素信号包括:根据对应于确定所述预判值的所述Gs，设置所述PGA的增益，所述PGA产生所述PGA输出信号，所述PGA输出信号对应于处于传输信号TS模式的所述像素信号；将所述参考电压从低参考电平斜升到高参考电平，所述低参考电平低于所述PGA输出信号的预判最低电平，而所述高参考电平高于所述PGA输出信号的预判最高电平；以及随着斜升的开始触发所述计数器开始计数，使得停止所述计数时的计数值指示所述SO。20.根据权利要求19所述的方法，其中：在所有所述N个增益设置中，SO具有0到2^M-1的满量程范围；所述增益设置中的第一个与所述满量程范围的第一部分相关联，所述满量程范围的第一部分从0扩展到所述满量程范围的第一中间值；所述增益设置中的第二个与所述满量程范围的第二部分相关联，所述满量程范围的第二部分从所述满量程范围的第二中间值延伸到2^M-1，所述第二部分与所述第一部分重叠；所述计数器的基本计数器分辨率为K位，其中，K＝M-X；以及转换所述像素信号包括：具有对应于所述增益设置的第一个的Gs，所述计数器用于表示从0到2^K-1的值，所述第一中间值小于2^K-1，以及具有对应于所述增益设置的第二个的Gs，所述计数器用于表示从2^X到2^M-1的值，所述第二中间值大于2^X。
说明书desc
优先权要求和相关申请的交叉引用本申请要求于2020年1月15日提交的美国申请号为16/742,969的优先权，其全部内容通过引用结合在本申请中。技术领域本发明总体上涉及数字图像传感器。更具体地，实施例涉及在互补金属氧化物半导体数字图像传感器中使用可编程增益放大器的像素级增益调整的数字转换。背景技术许多电子设备包括相机以及依赖于数字图像传感器的其他功能。例如，大多数现代智能手机包括一台或多台数码相机，这些数码相机依赖于数字图像传感硬件和软件来捕获和处理图像。此类应用通常使用互补金属氧化物半导体图像传感器来进行图像感测。随着时间的推移，消费者们希望这些图像传感器具有更高的性能，包括更高的分辨率和更低的噪音。此外，特别是在便携式电子设备中，消费者们希望其能在提供此类功能的同时，不对功耗和动态范围产生不利的影响。例如，模拟电源如果无法驱动现代CIS功耗的主要部分，其就驱动着现代CIS功耗的一个重要部分。因此，在便携式电子设备中实现高性能CIS会涉及到在严格的功率效率和噪声限制内设计模数转换器和其他组件。发明内容实施例提供CMOS图像传感器中像素信号的像素级、可编程增益和数字转换。所述CIS包括列并行模数转换器，每个列并行模数转换器都有一个支持N个增益设置的可编程增益放大器。每个ADC可以针对所述N个增益设置中的每个增益设置执行各自的重置阶段转换，以获得与所述Gn相关联的各自的基线偏移。可以将预判值确定为像素信号的函数，所述预判值对应于所述增益设置中所选的一个增益设置。可以通过使用所述预判值将所述PGA的增益设置为Gs并获得信号偏移来转换所述像素信号。可以针对作为所述SO和所述BOs的函数的像素信号计算数字像素输出，其中所述BOs是对应于Gs的BOn。附图说明本文提及并构成本文一部分的附图示出了本公开的实施例。附图与说明书一起用于解释本发明的原理。图1示出了说明性互补金属氧化物半导体图像传感器，作为本文中描述的各种实施例的上下文。图2示出了根据各种实施例的与说明性列并行模数转换器耦合的说明性像素的电路框图。图3示出了常规像素读出的说明性时序图。图4示出了使用常规像素级增益调整的最终转换像素输出对像素信号的说明性曲线图，如图3所述。图5示出了根据各种实施例的像素级增益调整的读出和转换的说明性时序图。图6A和6B示出了根据各种实施例的支持多个增益设置的可编程增益放大器的示意性实现。图7示出了PGA增益切换误差容限相对于电子数量的预判值电平的曲线图。图8示出了根据各种实施例的示意性计数器实现。图9示出了根据各种实施例的用于从CMOS图像传感器生成数字像素级输出的方法的流程图。在附图中，相似的组件和/或特征可以具有相同的附图标记。此外，相同类型的各个组件可以通过在附图标记后的第二标记进行区分，该第二标记用于在相似组件之间进行区分。如果在说明书中仅使用了第一附图标记，则描述内容可应用于具有相同的第一附图标记的相似组件中的任何一个，而不考虑第二附图标记。具体实施方式在以下描述中，提供了许多特定细节以透彻理解本发明。然而，本领域技术人员应当想到，本发明在没有这些细节中的一个或多个的情况下也可以实现。在其他示例中，出于简洁的目的，本领域已知的特征和技术将不再描述。许多电子设备包括相机以及依赖于数字图像传感器的其他功能。例如，大多数现代智能手机包括一台或多台数码相机，这些数码相机依赖于数字图像传感硬件和软件来捕获和处理图像。此类应用通常使用互补金属氧化物半导体图像传感器来进行图像感测。图1示出了说明性互补金属氧化物半导体图像传感器100，作为本文中描述的各种实施例的上下文。如图所示，CIS包括大量排列成一列像素110的光电探测器。所述像素由一组列并行模数转换器125组成的读取块120逐行读取。例如，光学信息由所述的一列像素110捕获。为了从所述像素110中读出数据，这些行被顺序地一次一个地位移到所述读取块120。当每一行依次到达所述读取块120时，所述ADC125并行读取该行的所有列。这些操作由附加组件辅助，例如行驱动器、列控制电路和各种参考信号。来自所述列并行ADC125的数据可由图像传感器处理器130处理，并由图像输出接口140输出。随着时间的推移，消费者们希望这些图像传感器具有更高的性能，包括更高的分辨率和更低的噪音。例如，一些现代CIS包括超过一亿像素的阵列。此外，特别是在便携式电子设备中，消费者们希望其能在提供此类功能的同时，不对功耗和动态范围产生不利的影响。例如，模拟电源如果无法驱动现代CIS功耗的主要部分，其就驱动着现代CIS功耗的一个重要部分，消费者可能对缩短电池寿命的功能很敏感。因此，在便携式电子设备中实现高性能CIS会涉及到在严格的功率效率和噪声限制内设计模数转换器和其他组件。通过使用可编程增益放大器像素级调整增益，一些常规实施例可达到理想的功率和噪声水平，这一功率和噪声水平具有理想数量的动态范围。图2示出了根据各种实施例的与说明性列并行模数转换器125耦合的说明性像素110的电路框图220。所述说明性像素110电路通常示出一组光电二极管，其被设置为捕获和存储光学信息，例如，指示在该像素110处检测到的光量。所述像素110可以是CIS阵列的多列中的一列中的所述像素110之一的实现，例如图1所示。所示的ADC125可以是所述CIS的列并行ADC125之一的实现，特别是与包括所述像素110的列耦合的ADC125。如上所述，像素110的每一行被顺序地移位到列平行ADC125以用于读出。因此，在每次顺序移位进行之后，为每个ADC125提供像素信号205，所述像素信号205对应于在将其列向下移位直到到达所述列平行ADC125之后来自特定像素110的输出。如图所示，所述像素信号205在所述PGA220的输入处被接收。所述PGA220包括运算放大器210，在其输入具有输入电容器网络207，并具有耦合在其输出和输入之间以形成反馈路径的反馈电容器网络209。在这种配置中，所述放大器的总增益对应于C1与C2的比率。因此，在所述PGA 220的输出处看到的PGA输出信号215对应于所述像素信号205，该所述像素信号205由所述PGA220根据所述PGA220应用的增益放大。从PGA输出信号215到所述比较器输入的耦合在曲线中表示为DC，但它也可以表示为DC或AC，这取决于实施例。如本文所述，当像素110的每一行被所述列并行ADC125读取时，每个ADC 125的读出包括重置阶段和信号阶段。每个ADC 125包括可编程增益放大器220。在重置阶段期间，执行多个重置阶段转换以获得与所述PGA220的多个增益设置相关联的相应的基线偏移。例如，所述PGA 220可以支持高增益设置和低增益设置，和/或所述PGA 220可以支持任何合适的附加或替代增益设置。在所述信号阶段期间，对从所述像素110输出的像素信号205进行估计以确定预判值，并且所述预判值对应于所述PGA 220支持的所选增益设置之一。然后,可根据预判值设置所述PGA220的增益，并可通过所述PGA 220对所述像素信号205进行转换以获得信号偏移量。然后,可以使用对应于所述所选增益设置的所述信号偏移和所述各自的基线偏移来计算所述像素信号205的数字像素输出。如图所示，所述ADC 125可以包括ADC处理器290以指导各种特征的实现。所述处理器290可以包括任何合适的处理器，如中央处理单元、专用集成电路、特定于应用程序的指令集处理器、图形处理单元、物理处理器、数字信号处理器、现场可编程门阵列、可编程逻辑器件、控制器，微控制器单元、简化指令集处理器、复杂指令集处理器、微处理器等，或其任何组合，或其任何部分。所述处理器290可以控制所述ADC 125的一些或所有组件。例如，所述处理器290可以通过控制所述PGA 220是直接接收所述像素输出信号205还是接收一些其他信号，并通过选择所述PGA 220要使用的增益设置来控制所述PGA 220的操作。类似地，如本文所述，所述处理器290可以控制比较器230的操作、锁存器270的操作、计数器250的操作等。虽然未明确示出，但一些实施例还具有一种或多种附加类型的存储，例如寄存器、锁存器、固态存储器等，这些储存器存储各种阈值、基线偏移值、信号偏移值和其他合适的信息；并且与这种存储有关的存储器操作可由所述处理器290控制。实际上，在每个像素读出时，可以估计像素信号电平以获得预判，并且所述预判可以用于所述PGA增益的像素级调整。例如，对低电平信号应用高增益以降低噪声，对高电平信号应用低增益以避免组件过载。当今的高端CIS正朝着更高分辨率和更低噪声的方向发展。同时，消费者们希望功耗和动态范围不受到影响，尤其是在移动设备中。模拟电源如果不是所述CIS功耗的主要部分，则是所述CIS功耗的一个重要部分，因此，高能效和低噪声ADC设计对于高性能CIS产品至关重要。在此描述的实施例的实现可以降低读出噪声，同时保持高动态范围、放宽下游电路并降低总功率。常规的CIS实现倾向于使用固定增益放大器，或具有由系统为整个图像编程一次的增益的放大器等。在有限的情况下，常规的CIS方法包括一些像素级增益调整。然而，这样的常规实现往往具有各种限制，例如明显的线性误差。此外，这样的常规实现往往依赖于添加复杂的硬件，随着操作条件的变化往往不具有稳定性，并且往往也会引起其他不良影响。为了更清楚起见，图3示出了一种常规像素读出的说明性时序图300。所述时序图300示出了重置阶段和信号阶段。如图所示，重置触发信号310可以触发所述重置阶段的开始，并且信号触发信号315可以触发所述信号阶段的开始。所述重置信号310将像素信号325强制为预定义的重置值，并且自动归零信号320将PGA输出信号335强制为不同的预定义低电平。所述PGA也被设置为高增益条件。值得注意的是，所述PGA输出信号335不会降至零，从而为电路提供适当的偏置并为某些自然偏移和自动归零误差提供裕度。在所述像素信号325和所述PGA输出信号335稳定到它们的自动归零电平之后，参考电压330被触发以开始斜升。同时，计数器输出信号345追踪所述参考电压330电平穿过所述PGA输出信号335电平所花费的时间。随着所述参考电压330斜升，它可以与所述自动归零的PGA输出信号335进行比较；当所述参考电压330达到所述自动归零的PGA输出信号335的电平时，可以停止计数。在停止计数时，所述计数器输出信号345对应于所述自动归零的PGA输出信号335的基线偏移。例如，基线偏移量可预测地与所述参考电压330电平以给定斜率斜升至所述自动归零的PGA输出信号335电平所需的时间相关。获得基线偏移后，所述信号阶段开始，实际所述像素信号325通过所述PGA。预判子阶段由预判使能信号350触发。所述PGA保持在其高增益状态，所述PGA输出信号335相对于预判阈值电平337而被监控。如果所述像素信号325是低光信号，则即使在高增益下，所述PGA输出信号335也往往达不到所述预判阈值337。然而，如果所述像素信号325是高光信号，则在高增益时，所述PGA输出信号335往往会短暂地超过所述预判阈值电平337。生成对应于该预判子阶段的预判输出信号340。所述PGA的增益为对应于该预判输出信号340而设置。例如，将信号估计为低光会导致驱动所述PGA高增益设置的预判，而将信号估计为高光会导致驱动所述PGA低增益设置的预判。然后，将这些增益调整应用到所述PGA并反映在所述PGA输出信号335中，如所指示。例如，在低光条件下，所述PGA输出信号335以所述PGA应用的高增益追踪所述低光像素信号325a；在高光条件下，所述PGA输出信号335以所述PGA应用的高增益追踪所述高光像素信号325b。然后，可以使用调整后的增益设置来转换所述像素信号325。同样，所述参考电压330可以斜升并且与所述PGA输出信号335比较以获得指示所述PGA输出信号335的信号偏移的计数。值得注意的是，该信号偏移电平对应于所述像素信号325电平，但也包括在重置阶段确定的所述PGA的基线偏移。一些方法通过在信号的最终转换期间有效地减去基线偏移来减轻这种影响。然而，这种减法往往会产生线性误差。例如，基线偏移通常是使用所述PGA的高增益设置来确定的，但是当处于低增益设置时，所述PGA可能表现出不同的基线偏移。如果最终使用所述低增益设置执行数字转换，则转换偏移可能与基线偏移不同。例如，图4示出了使用常规的像素级增益调整的最终转换像素输出405对所述像素信号325的说明性曲线图400，如图3所述。曲线400示出了高增益范围410和低增益范围420。当所述像素信号325相对较低时，应用高增益以实现转换后的像素输出405；所述当像素信号325相对较高时，应用低增益以实现转换后的像素输出405。当所述像素信号325正好处于所述预判阈值电平337时，往往存在表现为不连续性的线性误差415。所述线性误差415可以对应于所述PGA显示的高增益基线偏移与所述PGA显示的低增益基线偏移之间的差异。除了偏移失配误差之外，gain_ratio＝high-gain/low-gain，gratio_err＝gain_ratio/gain_ratio_ideal-1的相对变化会在Vsig＝Vth_pred处引入-gratio_err*Vth_pred的非线性误差。一些常规方法试图补偿相对较大的线性误差415。例如，使用两个控制良好的信号来校准偏移差和gratio_err，并且为每个ADC单独存储校准代码。数字校正是在实时图像捕捉读出过程中进行的。这种补偿往往很复杂并且涉及额外的校正硬件。此外，随着温度和使用时间的变化，这种补偿往往不具有稳定性。此外，由于列ADC之间的不匹配，未消除的模拟偏移和增益误差会导致垂直固定模式噪声，许多应用都有严格的FPN设计限制。由于这些实际的限制，常规技术被认为对实际图像传感器产品的实施不具吸引力。在此描述的实施例提供了一种用于像素级增益调整转换的新颖方法，其避免了常规方法的限制。图5示出了根据各种实施例的像素级增益调整读出和转换的说明性时序图500。对于增加的上下文，图5的时序图500是结合图2的框图200的上下文而描述的。时序图500示出了重置阶段和信号阶段。如图所示，重置触发信号510可以触发重置阶段的开始，而信号触发信号515可以触发信号阶段的开始。所述PGA220可以包括N个可能的增益设置，其中，N是大于1的整数。为避免该图过于复杂，时序图500和描述假设N为2，使得所述PGA220包括两个增益设置：高增益设置和低增益设置。在重置阶段开始时，可以将所述PGA 220设置为其增益设置中的第一个。在所示的情况下，所述PGA 220首先被设置为低增益设置，如PGA增益设置信号550所示。所述重置信号510将所述像素信号205强制为预定义的重置值，并且自动归零信号520将所述PGA输出信号215强制为不同的预定义低电平。如上所述，所述PGA输出信号215不会降至零，从而为电路提供适当的偏置并为某些自然偏移和自动归零误差提供裕度。当设置为所述第一增益设置时，该偏移是所述PGA 220的基线偏移。如图2所示，所述PGA输出信号215与比较器230的一个输入耦合，所述比较器230的另一输入与参考电压233耦合，所述比较器230的输出为比较器输出信号235。所述比较器输出信号235与根据计数器时钟信号253计时的计数器250耦合。所述计数器250的输出是计数器输出信号255。所述比较器输出信号235还与锁存器270的输入耦合，该锁存器270由预判使能信号273使能，并且所述锁存器270的输出是所述预判输出信号275。然后，所述预判输出信号275可以与到所述PGA 220的可变反馈电容器209的控制输入耦合，使得可以对应于所述预判输出信号275来控制所述PGA220的增益。在所述像素信号205和所述PGA输出信号215在所述第一增益设置条件下稳定到它们的自动归零电平之后，所述比较器230输入的参考电压233被触发以开始斜升。同时，计数器250可以开始计数，如计数器输出信号255所示。随着所述参考电压233斜升，它与所述自动归零的PGA输出信号215进行比较。所述比较器输出信号235可以对应于所述参考电压233达到所述自动归零的PGA输出信号215的电平而翻转。例如，所述比较器输出信号235可以从“1”转变为“0”，或从“0”转变为“1”，从而产生转变边缘。这个转变边缘可以触发所述计数器250以停止计数。在停止计数时，所述计数器输出信号255对应与所述自动归零的PGA输出信号215的第一基线偏移560a，其对应于被设置为第一增益设置的PGA 220。该第一基线偏移560a可以存储在寄存器、存储器位置或以任何合适的方式进行储存。随后，可以针对所述PGA 220支持的N个增益设置中的每一个重复上述重置阶段转换。在所示的情况下，所述PGA 220被切换到第二增益设置，如PGA增益设置信号550所示。在该配置中，所述比较器230输入的所述参考电压233被重置为初始电平并再次被触发以开始斜升；并且所述计数器250同时被触发以重置和重新开始计数，如计数器输出信号255所示。以与针对所述第一增益设置所描述的相同方式，所述比较器230和所述计数器250用于获得并记录自动归零的PGA输出信号215的第二基线偏移560b，其对应于被设置为所述第二增益设置的PGA。通过使用相同的比较器230、相同的计数器250、相同的参考电压233和对应的斜坡斜率、相同的计数器时钟信号253等，实施方案可以确保每个各自的基线偏移560即使是在不同增益条件下获得和记录的，也具有可比性。在获得多个各自的基线偏移560之后，所述信号阶段开始，并且所述实际像素信号205通过所述PGA 220。预判子阶段用于估计所述像素信号205以生成用于控制所述PGA 220的增益设置的预判。在一些实施例中，不是使用外部设置的预判阈值电平，而是将所述参考电压233设置为对应与预判阈值电平530的高电平。例如，将所述参考电压233设置为预判阈值电压乘以由所述PGA 220应用的高增益电平。将所述PGA 220设置为其高增益设置条件。当所述像素信号205稳定时，所述PGA输出信号215在应用高增益的情况下追踪所述像素信号205。在使用所述参考电压233来建立所述预判阈值电平530的环境中，相同的比较器230可以用于相对于所述预判阈值电平530来比较所述PGA输出信号215。如果所述像素信号205是低光信号，则即使在高增益下，所述PGA输出信号215也往往达不到所述预判阈值电平530。然而，如果所述像素信号205是高光信号，则所述PGA输出信号215往往在高增益下短暂地超过所述预判阈值电平530。如两个箭头所示，在高增益下超过所述预判阈值电平530会导致所述预判输出信号275记录高光预判，从而导致所述增益切换到低增益设置，从而导致所述PGA输出信号215开始下降到较低的应用增益之下。通过使用相同的比较器230来做出预判可以提供各种特征。一个特征是使用相同的比较器230避免了对附加硬件的依赖。另一个特征是使用相同的比较器230可以消除所述比较器230在重置阶段产生的任何偏移，从而提高所述预判阈值电平530的精度。在这个子阶段期间，所述预判使能信号273可以使能所述锁存器270以记录所述比较器输出信号235的值。如此，当所述预判使能信号273不再被致动时，所述锁存器270在其输出处具有所述预判输出信号275，其对应于所述PGA输出信号215与所述预判阈值电平530之间的比较，如所述比较器输出信号235所示。例如，如果在所述预判使能信号273被致动期间，所述PGA输出信号215穿过所述预判阈值电平530，所述预判输出信号275可以被锁存为“1”；如果在所述预判使能信号273被致动期间，所述PGA输出信号215没有穿过所述预判阈值电平530，所述预判输出信号275可以被锁存为“0”。所述PGA220的增益对应于该预判输出信号275而设置。例如，遵循曲线525a的低光像素信号205导致电平540a的预判输出信号275，从而驱动所述PGA 220的高增益设置；遵循曲线525b的高光像素信号205导致电平540b的预判输出信号275，从而驱动所述PGA 220的低增益设置。然后，将这些增益调整应用到所述PGA 220并反映在所述PGA输出信号215中，如所指示。例如，在低光条件下，所述PGA输出信号215以所述PGA 220应用的高增益追踪所述低光曲线525a；在高光条件下，所述PGA输出信号215追踪由所述PGA 220应用的高增益的所述高光曲线525b。然后，可以使用调整的增益设置来转换所述像素信号205。同样，所述参考电压233可以斜升并且与所述PGA输出信号215进行比较，并且可以使用计数器来将所述PGA输出信号215的转换电平指示为信号偏移570。如上所述，该信号偏移570对应于所述像素信号205的电平，但还包括对应于转换中使用的增益设置的所述PGA 220的基线偏移560。所述基线偏移560贡献可以从最终转换中减去，以获得转换后的像素输出。例如，数字相关双采样用于将DN计算为所述信号偏移570和所述基线偏移560之间的差除以理想增益比。值得注意的是，由于每个支持的增益设置都与各自获得和记录的基线偏移560相关联，所以可以使用与转换中使用的增益设置相对应的基线偏移560来执行所述CDS。例如，对于增益设置Gn，最终的数字CDS操作可以计算为：DN＝/GRI。实施例可以对所有转换使用相同的参考斜坡斜率以消除任何斜率匹配问题。由于所述数字CDS结果是在具有相同偏移的相同信号路径配置下生成的两个转换结果之间的差异，基线偏移在参照常规方法没有上述线性误差的情况下被取消。如本文所述，可以将所述PGA 220设计为支持多种增益设置。图6A和6B示出了根据各种实施例的支持多个增益设置的可编程增益放大器220的示意性实现。图6A示出了低增益配置中的所述PGA 220a，而图6B示出了高增益配置中的所述PGA 220b。图6A和6B所示的所述PGA 220可以是图2中所示的所述PGA 220的实施例。如图所示，所述PGA 220接收像素信号205并输出PGA输出信号215。所述PGA220包括运算放大器210，在其输入具有输入电容器网络207，并具有耦合在其输出和输入之间以形成反馈路径的反馈电容器网络209。在这种配置中，所述放大器的总增益对应于C1与C2的比率。因此，在所述PGA 220的输出处看到的PGA输出信号215对应于所述像素信号205，该所述像素信号205由所述PGA220根据所述PGA220应用的增益放大。如图所示，所述反馈电容器网络209可以包括一组并联的多个电容器610，每个电容器被配置为选择性地切换到或切换出网络。在一些实施例中，所述电容器610是为了匹配目的而实施为MOM或MIM电容器的单元电容器。例如，所述反馈电容器网络209包括第一反馈电容器610a和第二反馈电容器610b。在低增益设置中，所述第一反馈电容器610a和所述第二反馈电容器610b都被切换到反馈路径中；并且所述PGA 220a的增益可以计算为C1/。在高增益设置中，只有所述第一反馈电容器610a被切换到所述反馈路径中；并且所述PGA 220b的增益可以计算为C1/C2a。因此，所述增益比可以计算为1+C2b/C2a。可以以任何合适的方式将所述反馈电容器610切换到或切换所述出反馈路径。例如，一些或所有反馈电容器610可以在一侧或两侧具有开关615。在一些实施例中，所述第一反馈电容器610a始终在所述反馈路径中并且不经由开关耦合。然而，即使在这样的固定路径中包含开关能有助于确保所述反馈电容器网络的并联支路之间的正确匹配，从而获得更好的性能。在一些实施例中，每个反馈电容器610仅在其一侧上包括开关615。然而，在一些实施例中，在所述反馈电容器610的两侧包括开关可以提高模拟性能。尽管没有明确示出控制信号，但是可以以任何合适的方式控制所述开关615。在一些实施例中，参考图2，对应于所述预判输出信号275来控制所述开关。例如，所述开关615被配置为使得所述开关615a和615b始终保持闭合，而开关615c和615d在所述预判输出信号275为‘0’时打开，并在所述预判输出信号275为‘1’时闭合。在这样的示例中，估计所述像素信号205是低光信号可导致预判输出信号275为‘0’，导致开关615c和516d打开，从而在高增益设置中配置所述PGA 220；估计所述像素信号205是高光信号可导致预判输出信号275为‘1’，导致开关615c和516d闭合，从而在低增益设置中配置所述PGA 220。设计如图6A和图6B所示的PGA 220可以提供各种特征。一个特征是增益比误差和其他相关问题可以通过仔细匹配并联反馈电容器路径来缓解。例如，使用仔细匹配的反馈电容器610和仔细匹配的开关615的配置和实现可导致相对低的增益比误差。一些实施例通过精心规划的预判阈值电平选择来进一步减少错误和/或以其他方式提高性能。CIS中的像素信号由像素光电二极管中收集的电子在曝光时间内产生。收集到的电子信号具有固有散粒噪声，其方差水平等于电子数，以及其相对误差为sqrt/NE＝sqrt。根据经验，低于散粒噪声20dB的线性误差是微不足道的，并且是可以容忍的。例如，图7示出了PGA增益切换误差容限相对于电子数量的预判阈值电平的曲线图700。例如，选择在100到400电子范围内的阈值电平提供1到0.5％的增益偏差容忍。使用仔细匹配的反馈电容器可以产生小于0.5％的PGA增益切换误差。这种误差可能足够低，以至于不需要使用仔细选择的阈值进行增益校准。在阈值下限时，散粒噪声可能远高于读出噪声；而在阈值上限时，所述增益误差容限可以低于0.5％。可以相对于电容器匹配特性和/或其他设计特征来调整列出的阈值400。可能需要有一个足够宽的阈值范围来解决所述ADC 125中的自动归零误差。可以根据从电子到电压的转换增益来计算电压阈值的值。例如，在每电子0.15毫伏的增益下，100到400个电子的范围在像素输出处转换为大约15到60毫伏的范围。在一些实施例中，仔细选择的增益比可以促进某些反相关特征。图8示出了根据各种实施例的示意性的计数器实现800。所述计数器实现800假设所述PGA 220支持两种增益设置：对应于1x增益的低增益设置；以及对应于4x增益的高增益设置。如上所述，当正在转换信号时，预判已经进行，使得系统知道是将转换具有高增益的低光像素信号205，还是转换具有低增益的高光像素信号205。可以得知，转换具有高增益转换的低光像素信号205将落在计数器输出信号255值的特定第一范围内，而转换具有低增益转换的高光像素信号205将落在计数器输出信号255值的特定第二范围内。尽管所述第一和第二范围可能重叠，但所述第一范围将可预测地以较低值开始并且小于所述第一范围。例如，假设信号输出的满量程范围对应于12位计数器范围。可能需要最低有效位来描述所述第一范围的信号输出值，但所述第一范围可能永远不会接近接近所述12位范围的顶部的任何值。但是，如果可以预测所述第二范围将始终以固有散粒噪声水平远高于最低有效位的水平开始，则由那些最低有效位提供的附加分辨率可能不需要描述所述第二范围。因此，实施例可以使用与所述预判输出信号275相关的这种知识来放宽计数器要求。如其所示，所示为10位计数器，而不是使用12位计数器。在高增益模式下运行时，所述10位计数器可用于表示从十进制“0”到十进制“1023”的值，尽管所述第一范围可能要小得多。在所述低增益模式下工作时，同一个10位计数器的输出可以移位两位。因此，所有计数器输出值都被有效地处理为具有固定两个最低有效位的12位计数器的输出。例如，在这种配置中，‘0000000000’的计数器值现在可以表示‘4’的十进制值，‘1111111111’的计数器值可以表示‘4095’的十进制值。这样，10位计数器可以有效地具有12位分辨率。此外，计数器中的量化噪声降低了四倍，对于大于所述阈值电平的信号，计数器转换的次数减少到四分之一，因此将数字计数功率减少到大约四分之一。图9示出了根据各种实施例的用于从CMOS图像传感器生成数字像素级输出的方法900的流程图。所述方法900的实施例开始于阶段904，在与所述CIS的像素输出耦合的可编程增益放大器处接收像素信号。所述像素输出是所述CIS的多个像素输出之一，每个像素输出与多个PGA相关联的PGA之一相耦合。例如，每个PGA都是列并行模数转换器的一部分。每个PGA支持N个增益设置。例如，N可以等于2，使得所述PGA支持高增益设置和低增益设置。在阶段908，实施例针对所述N个增益设置中的每个增益设置执行各自的重置阶段转换，以获得与所述Gn相关联的各自的基线偏移。在一些实施例中，在阶段908执行所述相应的重置阶段转换包括，对每个Gn反复地：根据所述Gn设定所述PGA的增益，所述PGA对应于处于自动归零模式的像素信号而产生所述PGA输出信号；将参考电压从低参考电平斜升到AZ阈值电平，所述低参考电平低于所述PGA输出信号的预判最低电平，而所述AZ阈值电平高于所述PGA输出信号；以及随着斜升的开始触发计数器开始计数，使得停止所述计数时的计数值指示对应于Gn的BOn。在阶段912，实施例确定作为像素信号的函数的预判值，所述预判值对应于所述增益设置中所选的一个增益设置。在一些实施例中，确定在阶段912的所述预判值包括：根据高增益设置来设置所述PGA的增益，所述PGA产生所述PGA输出信号，所述PGA输出信号对应于处于传输信号模式的所述像素信号；将所述参考电压设置为TS阈值电平；以及在预判使能时间触发锁存器，以将所述输出比较器节点处的值记录为所述预判值。在阶段916，实施例通过使用所述预判值将所述PGA的增益设置为所述Gs并获得信号偏移来转换所述像素信号。在一些实施例中，在阶段916转换所述像素信号包括根据对应于确定所述预判值的所述Gs，设置所述PGA的增益，所述PGA产生所述PGA输出信号，所述PGA输出信号对应于处于传输信号模式的所述像素信号；将所述参考电压从低参考电平斜升到高参考电平，所述低参考电平低于所述PGA输出信号的预判最低电平，而所述高参考电平高于所述PGA输出信号的预判最高电平；以及随着斜升的开始触发所述计数器开始计数，使得停止所述计数时的计数值指示所述SO。在阶段920，实施例针对作为所述SO和所述BOs的函数的像素信号计算数字像素输出，其中所述BOs是对应于Gs的BOn。在一些实施例中，在阶段920的计算包括执行数字相关双采样，使得所述数字像素输出与所述SO和所述BOs之间的差值相关。应理解，当元件或组件在本文中被称为“连接到”或“耦合到”另一元件或组件时，其可以连接或耦合到另一元件或组件，或者也可以存在介于中间的元件或组件。相反，当元件或组件被称为“直接连接到”或“直接耦合到”另一元件或组件时，它们之间不存在介于中间的元件或组件。应理解，尽管术语“第一”、“第二”、“第三”等可用于描述各种元件、组件，但这些元件、组件、区域不应受到这些术语的限制。这些术语仅用于将一个元件，组件与另一个元件，组件区分开。因此，在不脱离本发明的教导的情况下，以下讨论的第一元件，组件可以被称为第二元件，组件。如本文所用，术语“逻辑低”、“低状态”、“低水平”、“逻辑低水平”、“低”或“0”可互换使用。术语“逻辑高”、“高状态”、“高电平”、“逻辑高电平”、“高”或“1”可互换使用。如本文所用，术语“a”，“an”和“the”可包括单数和复数指代。将进一步理解，当本说明书中使用术语“包括”、“包含”、“具有”及其变型时，说明存在所述特征、步骤、操作、元件和/或组件，但不排除存在或添加一个或多个其他特征、步骤、操作、元件、组件和/或其组合。相反，当本说明书中使用术语“由......组成”时，说明所述特征、步骤、操作、元件和/或组件，并且排除附加特征、步骤、操作、元件和/或组件。如在此使用的，词语“和/或”可以指并且可以包括一个或多个相关联的列出的项目的任何可能组合。虽然本文中参考示意性实施例描述了本发明，但是该描述并不旨在以限制意义来解释。相反，示意性实施例的目的是使本发明的精神更好地被本领域技术人员理解。为了不模糊本发明的范围，省略了公知的工艺和制造技术的许多细节。参考该描述，示意性实施例的各种修改以及其他实施例对本领域技术人员来说是显而易见的。因此，所附权利要求旨在涵盖任何这样的修改。此外，本发明的优选实施例的一些特征可以在没有相应使用其他特征的情况下有利地使用。因此，上述的描述应被认为仅是本发明原理的说明，而不是对其的限制。本领域技术人员能够想到落入本发明范围内的上述实施例的变型。因此，本发明不限于上面讨论的特定实施例和描述，而是由所附权利要求及其等同限制。
