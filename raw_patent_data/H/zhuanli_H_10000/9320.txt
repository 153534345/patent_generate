标题title
一种基于TTDP协议的列车骨干网节点故障恢复方法及装置
摘要abst
本发明公开了一种基于TTDP协议的列车骨干网节点故障恢复方法及装置，方法步骤包括：1)当列车骨干网节点完成初运行，初运行禁止指令下达时，将初运行过程中获取的列车骨干网节点的信息写入指定存储单元；2)当节点发生故障时，在节点故障恢复过程中，进入节点故障前的网络状态，调用指定存储单元中的信息以使节点重新加入网络。本发明解决了标准TTDP协议存在的缺陷，在初运行禁止状态下，确保任意位置的节点在故障恢复后，无论其他节点是否处于故障环境下，都能实现直接加入网络，维持原有的网络通信功能。
权利要求书clms
1.一种基于TTDP协议的列车骨干网节点故障恢复方法，其特征在于，步骤包括：1)当列车骨干网节点完成初运行，初运行禁止指令下达时，将初运行过程中获取的列车骨干网节点的信息写入指定存储单元；2)当节点发生故障时，在节点故障恢复过程中，进入节点故障前的网络状态，调用指定存储单元中的信息以使节点重新加入网络。2.根据权利要求1所述的基于TTDP协议的列车骨干网节点故障恢复方法，其特征在于，所述步骤1)中列车骨干网节点初运行的具体步骤为：1.1)收集相邻节点信息；1.2)节点依次转发信息；1.3)收集全网节点信息；1.4)计算各节点的拓扑计数值，将拓扑计数值发送给其他节点；1.5)当所有节点确认拓扑计数值一致，分配IP地址。3.根据权利要求1所述的基于TTDP协议的列车骨干网节点故障恢复方法，其特征在于，所述步骤1)中列车骨干网节点在初始化时，还包括对指定存储单元的校验流程。4.根据权利要求1所述的基于TTDP协议的列车骨干网节点故障恢复方法，其特征在于，所述步骤2)中还包括故障识别流程，具体步骤为：2.1)确认相邻节点是否为禁止状态，若否，则判别本节点为正常启动，若是，则转入执行步骤2.2)；2.2)匹配禁止的相邻节点发送的拓扑计数值与指定存储单元中的拓扑计数值是否一致；若匹配一致，则判别为故障恢复；若匹配不一致，则判别为非常规故障恢复。5.根据权利要求4所述的基于TTDP协议的列车骨干网节点故障恢复方法，其特征在于，故障识别流程完成后，故障恢复的步骤具体为：若判别为正常启动或为非常规故障恢复，按照TTDP标准流程重新加入网络；若判别为故障恢复，调用指定存储单元中的信息以使节点重新加入网络。6.根据权利要求1至5任意一项所述的基于TTDP协议的列车骨干网节点故障恢复方法，其特征在于，写入指定存储单元的信息至少包括其他节点信息、物理和逻辑拓扑信息、拓扑计数值、IP地址设置、网络中丢失的节点信息、丢失部分拓扑计数值信息中的一种或多种。7.一种基于TTDP协议的列车骨干网节点故障恢复装置，其特征在于，包括：指定存储模块，用于存储当列车骨干网节点完成初运行，初运行禁止指令下达时，初运行过程中获取的列车骨干网节点的信息；故障恢复模块，用于当节点发生故障时调用指定存储单元中的信息以使节点重新加入网络。8.根据权利要求7所述的基于TTDP协议的列车骨干网节点故障恢复装置，其特征在于，还包括供电模块，用于给指定存储模块供电。9.根据权利要求7所述的基于TTDP协议的列车骨干网节点故障恢复装置，其特征在于，还包括第一存储模块，用于存储初运行过程中获取的列车骨干网节点的信息。10.根据权利要求7所述的基于TTDP协议的列车骨干网节点故障恢复装置，其特征在于，还包括第二存储模块，用于存储节点的配置信息。11.根据权利要求7所述的基于TTDP协议的列车骨干网节点故障恢复装置，其特征在于，还包括控制模块，所述控制模块用于将初运行过程中获取的列车骨干网节点的信息写入指定存储单元以及调用指定存储单元中的信息以使节点重新加入网络。
说明书desc
技术领域本发明主要涉及列车网络通信技术领域，特指基于TTDP协议的列车骨干网节点故障恢复方法及装置。背景技术在广泛应用与动车、城轨、机车车辆的车载以太网络中，骨干网作为车载网络的上级网络，负责连通各单列车内车辆编组的通信，其特点在于灵活组网，高可靠性。列车骨干网专用协议TTDP，由技术标准IEC 61375-2-5中提出，依据该协议的规定，在列车正常运行过程中，部分网络节点出现故障后恢复，可以通过一定机制重新加入原有网络。列车以太网组网如图1所示，其中，ETBN为骨干网络节点，ETBN之间相互连接的网络称为骨干网。TTDP全称Train Topology Discovery Protocol，列车拓扑发现协议，该协议由IEC61375-2-5标准定义，是广泛应用于列车骨干以太网的组网通信协议，专用于一辆列车内各车辆之间设备相互通信。由于列车运营有增编、解编、重联等需要，一辆列车的拓扑可能会发生变化，因此，TTDP在各网络设备启动后，设计了一种“初运行”行为，通过该行为，使骨干网的各节点能发现网络中的其他节点和全网拓扑，实现自组网并完成IP地址分配和映射。在列车运行的过程中，为保证网络稳定，通常采用“禁止初运行”命令使网络拓扑强制固定，防止因拓扑变更带来的全体网络中断。在禁止初运行状态下，如果其中的部分节点出现故障，TTDP同样具备一定的机制，在优先保证网络通信的前提下，等待故障的节点加入。目前在初运行禁止的情况下，遇到故障然后恢复的节点需满足下列两个条件的其中一个，才能重新加入网络：1、涉及中间节点丢失，故障恢复节点获取到原有网络的全部节点信息，计算出正确的拓扑计数值；2、涉及端节点丢失，所有故障节点全部恢复，并且可以自行组网成功，原有网络通过“丢失部分拓扑计数值”将其加入网络。除了上述两种条件外，依据IEC 61375-2-5:2015定义的TTDP协议，在初运行禁止状态下，仍存在某些节点在发生故障恢复后无法加入原有网络的缺陷，主要为以下两类：1)如图2所示，在初运行禁止状态下，若出现多个中间节点丢失，先恢复的节点由于无法获取到未恢复节点的信息，无法通过获取全网节点信息计算拓扑计数值加入原有网络；原有网络节点也由于丢失的节点未完成自组网，无法匹配丢失部分拓扑计数值。2)如图3所示，在初运行禁止状态下，多个丢失的非相邻节点中如果包含一个端节点，则该端节点恢复后，由于相邻的节点成为新端节点并停止转发信息，恢复的端节点无法获取其他节点的信息，并且无法与其他丢失的节点自组网，无法生成匹配的丢失拓扑计数值，即该情况下，所有的丢失节点将永远被排除在网络外，直到禁止初运行解除。在列车实际运营的过程中，上述故障场景时有发生，并造成部分车辆的网络不可用，并可能导致列车降级运行。发明内容针对现有技术存在的技术问题，本发明解决了标准TTDP协议存在的缺陷，在初运行禁止状态下，确保任意位置的节点在故障恢复后，无论其他节点是否处于故障环境下，都能实现直接加入网络，维持原有的网络通信功能。为解决上述技术问题，本发明采用以下技术方案：一种基于TTDP协议的列车骨干网节点故障恢复方法，步骤包括：1)当列车骨干网节点完成初运行，初运行禁止指令下达时，将初运行过程中获取的列车骨干网节点的信息写入指定存储单元；2)当节点发生故障时，在节点故障恢复过程中，进入节点故障前的网络状态，调用指定存储单元中的信息以使节点重新加入网络。作为本发明的进一步改进：所述步骤1)中列车骨干网节点初运行的具体步骤为：1.1)收集相邻节点信息；1.2)节点依次转发信息；1.3)收集全网节点信息；1.4)计算各节点的拓扑计数值，将拓扑计数值发送给其他节点；1.5)当所有节点确认拓扑计数值一致，分配IP地址。作为本发明的进一步改进：所述步骤1)中列车骨干网节点在初始化时，还包括对指定存储单元的校验流程。作为本发明的进一步改进：所述步骤2)中还包括故障识别流程，具体步骤为：2.1)确认相邻节点是否为禁止状态，若否，则判别本节点为正常启动，若是，则转入执行步骤2.2)；2.2)匹配禁止的相邻节点发送的拓扑计数值与指定存储单元中的拓扑计数值是否一致；若匹配一致，则判别为故障恢复；若匹配不一致，则判别为非常规故障恢复。作为本发明的进一步改进：故障识别流程完成后，故障恢复的步骤具体为：若判别为正常启动或为非常规故障恢复，按照TTDP标准流程重新加入网络；若判别为故障恢复，调用指定存储单元中的信息以使节点重新加入网络。作为本发明的进一步改进：写入指定存储单元的信息至少包括其他节点信息、物理和逻辑拓扑信息、拓扑计数值、IP地址设置、网络中丢失的节点信息、丢失部分拓扑计数值信息中的一种或多种。本发明还提供了一种基于TTDP协议的列车骨干网节点故障恢复装置，包括：指定存储模块，用于存储当列车骨干网节点完成初运行，初运行禁止指令下达时，初运行过程中获取的列车骨干网节点的信息；故障恢复模块，用于当节点发生故障时调用指定存储单元中的信息以使节点重新加入网络。作为本发明的进一步改进：还包括供电模块，用于给指定存储模块供电。作为本发明的进一步改进：还包括第一存储模块，用于存储初运行过程中获取的列车骨干网节点的信息。作为本发明的进一步改进：还包括第二存储模块，用于存储节点的配置信息。作为本发明的进一步改进：还包括控制模块，所述控制模块用于将初运行过程中获取的列车骨干网节点的信息写入指定存储单元以及调用指定存储单元中的信息以使节点重新加入网络。与现有技术相比，本发明的优点在于：1、本发明通过在初运行禁止命令下达时，将初运行过程中获取的列车骨干网节点的信息写入指定存储单元，当节点发生故障时，在节点故障恢复过程中，进入节点故障前的网络状态，通过调用指定存储单元中的信息以使节点重新加入网络，解决了标准TTDP协议存在的缺陷，在初运行禁止状态下，确保任意位置的节点在故障恢复后，节点可以通过指定存储单元获取到可靠的原有信息实现直接加入网络，维持原有的网络通信功能，无需重新获取节点信息并计算，极大地提高了效率。2、本发明通过故障识别流程，实现了快速判别为正常启动还是故障恢复，避免依据标准TTDP协议全部初始化处理，充分利用故障前留存的信息，为节点重新加入网络提升效率；本发明还能识别是否为非常规故障，对于非常规故障可依照标准流程处理，保证了故障恢复期间的安全性和可靠性。3、本发明通过指定存储单元和故障恢复模块，实现了初运行过程中获取的列车骨干网节点的信息存储，当节点发生故障时，能通过故障恢复模块调用指定存储单元中的信息以使节点重新加入网络，解决了标准TTDP协议存在的缺陷，在初运行禁止状态下，确保任意位置的节点在故障恢复后，节点可以通过指定存储单元获取到可靠的原有信息实现直接加入网络，维持原有的网络通信功能，无需重新获取节点信息并计算，极大地提高了效率。附图说明图1是列车以太网拓扑图。图2是多个中间节点故障恢复图。图3是不相邻且包含端节点的故障恢复图。图4是本实施例基于TTDP协议的列车骨干网节点故障恢复方法的流程示意图。图5是本实施例中对指定存储单元进行校验的流程示意图。图6是本实施例中故障识别流程示意图。图7是本实施例中故障恢复流程示意图。图8是本实施例基于TTDP协议的列车骨干网节点故障恢复装置的结构示意图。具体实施方式以下将结合说明书附图和具体实施例对本发明做进一步详细说明，但并因此而限制本发明的保护范围。如图4所示，本实施例基于TTDP协议的列车骨干网节点故障恢复方法，步骤为：1)当列车骨干网节点完成初运行，初运行禁止指令下达时，将初运行过程中获取的列车骨干网节点的信息写入指定存储单元；2)当节点发生故障时，在节点故障恢复过程中，进入节点故障前的网络状态，调用指定存储单元中的信息以使节点重新加入网络。本实施例通过在初运行禁止命令下达时，将初运行过程中获取的列车骨干网节点的信息写入指定存储单元，当节点发生故障时，在节点故障恢复过程中，进入节点故障前的网络状态，通过调用指定存储单元中的信息以使节点重新加入网络，解决了标准TTDP协议存在的缺陷，在初运行禁止状态下，确保任意位置的节点在故障恢复后，节点可以通过指定存储单元获取到可靠的原有信息实现直接加入网络，维持原有的网络通信功能，无需重新获取节点信息并计算，极大地提高了效率。本实施例中，步骤1)中列车骨干网节点初运行的具体步骤为：1.1)收集相邻节点信息；1.2)节点依次转发信息；1.3)收集全网节点信息；1.4)计算各节点的拓扑计数值，将拓扑计数值发送给其他节点；1.5)当所有节点确认拓扑计数值一致，根据网络拓扑以及TTDP的规则进行IP地址分配。列车运营有增编、解编、重联等需要，一辆列车的拓扑可能会发生变化，因此，TTDP在各网络设备启动后，设计了一种“初运行”行为，通过该行为，使列车骨干网的各节点能发现网络中的其他节点和全网拓扑，实现自组网并完成IP地址分配和映射。如图5所示，本实施例中，步骤1)中列车骨干网节点在初始化时，还包括对指定存储单元的校验流程，具体包括：初运行时，检查指定存储单元中的拓扑计数值，如校验成功，则对指定存储单元设置为只读，如校验失败，则对指定存储单元进行擦除处理，之后再设置为只读。通过对指定存储单元存储信息进行校验，确保其正确，能提高列车设备的安全性。如图6所示，本实施例中，步骤2)中还包括故障识别流程，具体步骤为：2.1)确认相邻节点是否为禁止状态，若否，则判别本节点为正常启动，若是，则转入执行步骤2.2)；2.2)匹配禁止的相邻节点发送的拓扑计数值与指定存储单元中的拓扑计数值是否一致；若匹配一致，则判别为故障恢复；若匹配不一致，则判别为非常规故障恢复。通过故障识别流程，实现了快速判别为正常启动还是故障恢复，避免依据标准TTDP协议全部初始化处理，充分利用故障前留存的信息，为节点重新加入网络提升效率；本发明还能识别是否为非常规故障，对于非常规故障可依照标准流程处理，保证了故障恢复期间的安全性和可靠性。如图7所示，本实施例中，故障识别流程完成后，故障恢复的步骤具体为：若判别为正常启动，按照TTDP标准流程重新加入网络；若判别为故障恢复，调用指定存储单元中的信息以使节点重新加入网络；若判别为非常规的故障恢复，无法按照本实施例中的方法加入网络时，通过对指定存储单元进行擦除处理，并设置为只读，按照TTDP标准流程开展自组网或等待加入网络。本实施例中，写入指定存储单元的信息至少包括其他节点信息、物理和逻辑拓扑信息、拓扑计数值、IP地址设置、网络中丢失的节点信息、丢失部分拓扑计数值信息中的一种或多种。如图8所示，本实施例基于TTDP协议的列车骨干网节点故障恢复装置，包括：指定存储单元，用于存储当列车骨干网节点完成初运行，初运行禁止指令下达时，初运行过程中获取的列车骨干网节点的信息；故障恢复模块，用于当节点发生故障时调用指定存储单元中的信息以使节点重新加入网络。通过指定存储单元和故障恢复模块，实现了初运行过程中获取的列车骨干网节点的信息存储，当节点发生故障时，能通过故障恢复模块调用指定存储单元中的信息以使节点重新加入网络，解决了标准TTDP协议存在的缺陷，在初运行禁止状态下，确保任意位置的节点在故障恢复后，节点可以通过指定存储单元获取到可靠的原有信息实现直接加入网络，维持原有的网络通信功能，无需重新获取节点信息并计算，极大地提高了效率。本实施例中，还包括供电模块，用于给指定存储单元供电。指定存储单元可以为非易失存储器。由于列车设备的高可靠性，为保证非易失存储存储器的寿命，应避免频繁写入，采用独立供电模块为指定存储单元供电。在其他实施例中，也可以采用非独立供电的方式。本实施例中还包括第一存储模块，用于存储初运行过程中获取的列车骨干网节点的信息；第二存储模块；用于存储节点的配置信息，电源模块，用于给第一存储模块和第二存储模块供电。本实施例中，还包括控制模块，所述控制模块用于将初运行过程中获取的列车骨干网节点的信息写入指定存储单元以及调用指定存储单元中的信息以使节点重新加入网络。本实施例中，故障恢复模块设置在控制模块中，在其他实施例中，故障恢复模块与控制模块为独立模块。以上仅是本发明的优选实施方式，本发明的保护范围并不仅局限于上述实施例，凡属于本发明思路下的技术方案均属于本发明的保护范围。应当指出，对于本技术领域的普通技术人员来说，在不脱离本发明原理前提下的若干改进和润饰，应视为本发明的保护范围。
