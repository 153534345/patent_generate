标题title
虚拟房间的分配方法、装置和电子设备
摘要abst
本发明提供了一种虚拟房间的分配方法、装置和电子设备，其中，该方法包括：服务集群中的第一服务节点接收用户代理服务发送的房间分配请求；房间分配请求中包括用户属性信息；将房间分配请求广播至服务集群中的第二服务节点，以确定服务集群中的服务节点控制的虚拟房间中，是否存在与用户属性信息相匹配的目标虚拟房间；如果存在，向第一服务节点发送请求成功信息；请求成功信息中包括目标虚拟房间的房间标识；如果接收到请求成功信息，基于目标虚拟房间为房间分配请求对应的用户账户分配虚拟房间。该方式中，多个服务节点可以保障房间分配服务的持续稳定运行，当业务量增大时，通过增加服务节点即可保障服务正常运行，具有较大的横向扩展能力。
权利要求书clms
1.一种虚拟房间的分配方法，其特征在于，预设服务集群中运行有多个服务节点；每个所述服务节点用于接收用户代理服务发送的房间分配请求，还用于控制至少部分虚拟房间；所述方法应用于所述服务集群中的第一服务节点，所述方法包括：接收所述用户代理服务发送的房间分配请求；其中，所述房间分配请求中包括用户属性信息；将所述房间分配请求广播至所述服务集群中的第二服务节点，以确定所述服务集群中的服务节点控制的虚拟房间中，是否存在与所述用户属性信息相匹配的目标虚拟房间；如果存在，向所述第一服务节点发送请求成功信息；所述请求成功信息中包括所述目标虚拟房间的房间标识；所述第二服务节点为所述服务集群中所述第一服务节点以外的服务节点；如果接收到所述请求成功信息，基于所述目标虚拟房间为所述房间分配请求对应的用户账户分配虚拟房间。2.根据权利要求1所述的方法，其特征在于，如果接收到所述请求成功信息，基于所述目标虚拟房间为所述房间分配请求对应的用户账户分配虚拟房间的步骤，包括：如果接收到多个所述请求成功信息，按照预设规则从多个所述请求成功信息中确定第一成功信息；为所述房间分配请求对应的用户账户分配所述第一成功信息对应的目标虚拟房间。3.根据权利要求2所述的方法，其特征在于，为所述房间分配请求对应的用户账户分配所述第一成功信息对应的目标虚拟房间的步骤之后，所述方法还包括：向发送所述第一成功信息的服务节点返回确认信息；其中，所述确认信息用于：指示所述第一成功信息对应的目标虚拟房间已分配给所述房间分配请求对应的用户账户。4.根据权利要求1所述的方法，其特征在于，所述第一服务节点中设置有指定房间标识，所述指定房间标识为第一标识；所述第一标识对应的虚拟房间为未分配用户账户的可用房间；所述方法还包括：如果没有接收到所述请求成功信息，基于所述第一标识向所述服务集群中的第二服务节点发送共识请求；其中，所述共识请求用于：确定所述第二服务节点中的指定房间标识是否是所述第一标识；并更新所述第二服务节点中的指定房间标识为第二标识，所述第二标识对应的虚拟房间为未分配用户账户的可用房间；如果所述共识请求对应的共识操作成功，为所述房间分配请求对应的用户账户分配所述第一标识对应的虚拟房间，更新所述指定房间标识为所述第二标识。5.根据权利要求4所述的方法，其特征在于，如果所述共识请求对应的共识操作成功，为所述房间分配请求对应的用户账户分配所述第一标识对应的虚拟房间的步骤，包括：接收所述服务集群中的第二服务节点返回的共识成功信息；其中，所述共识成功信息用于：指示所述第二服务节点中的指定房间标识为所述第一标识，且将所述指定房间标识更新为所述第二标识；统计接收到的所述共识成功信息的第一信息数量，如果所述第一信息数量满足第一预设条件，确定所述共识请求对应的共识操作成功，为所述房间分配请求对应的用户账户分配所述指定房间标识对应的虚拟房间。6.根据权利要求4所述的方法，其特征在于，如果所述共识请求对应的共识操作成功，为所述房间分配请求对应的用户账户分配所述第一标识对应的虚拟房间，更新所述指定房间标识为所述第二标识的步骤之后，所述方法还包括：将所述第一标识对应的虚拟房间设置为所述第一服务节点控制的虚拟房间。7.根据权利要求4所述的方法，其特征在于，所述方法还包括：如果所述共识请求对应的共识操作失败，更新所述指定房间标识；继续执行将所述房间分配请求广播至所述服务集群中的第二服务节点的步骤。8.根据权利要求7所述的方法，其特征在于，如果所述共识请求对应的共识操作失败，更新所述指定房间标识的步骤，包括：接收所述服务集群中的第二服务节点返回的共识失败信息；其中，所述共识失败信息用于：指示所述第二服务节点中的指定房间标识不是所述第一标识；所述共识失败信息中包括所述第二服务节点中的指定房间标识；统计接收到的所述共识失败信息的第二信息数量，如果所述第二信息数量满足第二预设条件，确定所述共识请求对应的共识操作失败，从所述共识失败信息中获取最新的指定房间标识，将所述第一服务节点的指定房间标识更新为所述最新的指定房间标识。9.一种虚拟房间的分配装置，其特征在于，预设服务集群中运行有多个服务节点；每个所述服务节点用于接收用户代理服务发送的房间分配请求，还用于控制至少部分虚拟房间；所述装置应用于所述服务集群中的第一服务节点，所述装置包括：请求接收模块，用于接收所述用户代理服务发送的房间分配请求；其中，所述房间分配请求中包括用户属性信息；广播模块，用于将所述房间分配请求广播至所述服务集群中的第二服务节点，以确定所述服务集群中的服务节点控制的虚拟房间中，是否存在与所述用户属性信息相匹配的目标虚拟房间；如果存在，向所述第一服务节点发送请求成功信息；所述请求成功信息中包括所述目标虚拟房间的房间标识；所述第二服务节点为所述服务集群中所述第一服务节点以外的服务节点；分配模块，用于如果接收到所述请求成功信息，基于所述目标虚拟房间为所述房间分配请求对应的用户账户分配虚拟房间。10.一种电子设备，其特征在于，包括处理器和存储器，所述存储器存储有能够被所述处理器执行的机器可执行指令，所述处理器执行所述机器可执行指令以实现权利要求1-8任一项所述的虚拟房间的分配方法。11.一种机器可读存储介质，其特征在于，所述机器可读存储介质存储有机器可执行指令，所述机器可执行指令在被处理器调用和执行时，所述机器可执行指令促使所述处理器实现权利要求1-8任一项所述的虚拟房间的分配方法。
说明书desc
技术领域本发明涉及服务运行领域，尤其是涉及一种虚拟房间的分配方法、装置和电子设备。背景技术部分游戏中设置有多个游戏房间，玩家需要进入其中一个游戏房间中参与游戏对局。游戏房间分配服务，用于按照一定的条件把玩家分配到合适的游戏房间。相关技术中，通常采用中心化的架构实现游戏房间分配服务。具体的，在业务量平稳的时候，可以采用一台服务器运行该游戏房间分配服务，在业务量增大时，可以通过主从架构或多主架构运行游戏房间分配服务。主从架构或多主架构中，在某一时段内，依然是通过一台服务器运行游戏房间分配服务，当该服务器出现故障或运维人员手动干预时，会更换运行服务的服务器。上述中心化的服务运行方式，一旦运行服务的服务器发生故障，在故障恢复期或服务器切换过程中，影响服务的正常运行，且横向扩展能力较弱，设备性能会限制服务的业务量。发明内容有鉴于此，本发明的目的在于提供一种虚拟房间的分配方法、装置和电子设备，以保障房间分配服务的持续稳定运行，当业务量增大时，具有较大的横向扩展能力，可承载较大的服务业务量。第一方面，本发明实施例提供了一种虚拟房间的分配方法，预设服务集群中运行有多个服务节点；每个服务节点用于接收用户代理服务发送的房间分配请求，还用于控制至少部分虚拟房间；方法应用于服务集群中的第一服务节点，方法包括：接收用户代理服务发送的房间分配请求；其中，房间分配请求中包括用户属性信息；将房间分配请求广播至服务集群中的第二服务节点，以确定服务集群中的服务节点控制的虚拟房间中，是否存在与用户属性信息相匹配的目标虚拟房间；如果存在，向第一服务节点发送请求成功信息；请求成功信息中包括目标虚拟房间的房间标识；第二服务节点为服务集群中第一服务节点以外的服务节点；如果接收到请求成功信息，基于目标虚拟房间为房间分配请求对应的用户账户分配虚拟房间。上述如果接收到请求成功信息，基于目标虚拟房间为房间分配请求对应的用户账户分配虚拟房间的步骤，包括：如果接收到多个请求成功信息，按照预设规则从多个请求成功信息中确定第一成功信息；为房间分配请求对应的用户账户分配第一成功信息对应的目标虚拟房间。上述为房间分配请求对应的用户账户分配第一成功信息对应的目标虚拟房间的步骤之后，方法还包括：向发送第一成功信息的服务节点返回确认信息；其中，确认信息用于：指示第一成功信息对应的目标虚拟房间已分配给房间分配请求对应的用户账户。上述第一服务节点中设置有指定房间标识，指定房间标识为第一标识；第一标识对应的虚拟房间为未分配用户账户的可用房间；上述方法还包括：如果没有接收到请求成功信息，基于第一标识向服务集群中的第二服务节点发送共识请求；其中，共识请求用于：确定第二服务节点中的指定房间标识是否是第一标识；并更新第二服务节点中的指定房间标识为第二标识，第二标识对应的虚拟房间为未分配用户账户的可用房间；如果共识请求对应的共识操作成功，为房间分配请求对应的用户账户分配第一标识对应的虚拟房间，更新指定房间标识为第二标识。上述如果共识请求对应的共识操作成功，为房间分配请求对应的用户账户分配第一标识对应的虚拟房间的步骤，包括：接收服务集群中的第二服务节点返回的共识成功信息；其中，共识成功信息用于：指示第二服务节点中的指定房间标识为第一标识，且将指定房间标识更新为第二标识；统计接收到的共识成功信息的第一信息数量，如果第一信息数量满足第一预设条件，确定共识请求对应的共识操作成功，为房间分配请求对应的用户账户分配指定房间标识对应的虚拟房间。上述如果共识请求对应的共识操作成功，为房间分配请求对应的用户账户分配第一标识对应的虚拟房间，更新指定房间标识为第二标识的步骤之后，方法还包括：将第一标识对应的虚拟房间设置为第一服务节点控制的虚拟房间。上述方法还包括：如果共识请求对应的共识操作失败，更新指定房间标识；继续执行将房间分配请求广播至服务集群中的第二服务节点的步骤。上述如果共识请求对应的共识操作失败，更新指定房间标识的步骤，包括：接收服务集群中的第二服务节点返回的共识失败信息；其中，共识失败信息用于：指示第二服务节点中的指定房间标识不是第一标识；共识失败信息中包括第二服务节点中的指定房间标识；统计接收到的共识失败信息的第二信息数量，如果第二信息数量满足第二预设条件，确定共识请求对应的共识操作失败，从共识失败信息中获取最新的指定房间标识，将第一服务节点的指定房间标识更新为最新的指定房间标识。第二方面，本发明实施例提供了一种虚拟房间的分配装置，预设服务集群中运行有多个服务节点；每个服务节点用于接收用户代理服务发送的房间分配请求，还用于控制至少部分虚拟房间；装置应用于服务集群中的第一服务节点，装置包括：请求接收模块，用于接收用户代理服务发送的房间分配请求；其中，房间分配请求中包括用户属性信息；广播模块，用于将房间分配请求广播至服务集群中的第二服务节点，以确定服务集群中的服务节点控制的虚拟房间中，是否存在与用户属性信息相匹配的目标虚拟房间；如果存在，向第一服务节点发送请求成功信息；请求成功信息中包括目标虚拟房间的房间标识；第二服务节点为服务集群中第一服务节点以外的服务节点；分配模块，用于如果接收到请求成功信息，基于目标虚拟房间为房间分配请求对应的用户账户分配虚拟房间。第三方面，本发明实施例提供了一种电子设备，包括处理器和存储器，存储器存储有能够被处理器执行的机器可执行指令，处理器执行机器可执行指令以实现上述虚拟房间的分配方法。第四方面，本发明实施例提供了一种机器可读存储介质，机器可读存储介质存储有机器可执行指令，机器可执行指令在被处理器调用和执行时，机器可执行指令促使处理器实现上述虚拟房间的分配方法。本发明实施例带来了以下有益效果：上述虚拟房间的分配方法、装置和电子设备，预设服务集群中运行有多个服务节点；每个服务节点用于接收用户代理服务发送的房间分配请求，还用于控制至少部分虚拟房间；服务集群中的第一服务节点接收用户代理服务发送的房间分配请求；其中，房间分配请求中包括用户属性信息；将房间分配请求广播至服务集群中的第二服务节点，以确定服务集群中的服务节点控制的虚拟房间中，是否存在与用户属性信息相匹配的目标虚拟房间；如果存在，向第一服务节点发送请求成功信息；请求成功信息中包括目标虚拟房间的房间标识；第二服务节点为服务集群中第一服务节点以外的服务节点；如果接收到请求成功信息，基于目标虚拟房间为房间分配请求对应的用户账户分配虚拟房间。该方式中，服务集群中的任一服务节点均可接收用户的房间分配请求，并在服务集群中进行广播，找到相匹配的虚拟房间后，将用户分配至该虚拟房间。由于服务节点包括多个，即使某些服务节点发生故障，其他服务节点依然可以正常为用户分配房间，保障房间分配服务的持续稳定运行，当业务量增大时，通过增加服务节点即可保障服务正常运行，具有较大的横向扩展能力，可承载较大的服务业务量。本发明的其他特征和优点将在随后的说明书中阐述，并且，部分地从说明书中变得显而易见，或者通过实施本发明而了解。本发明的目的和其他优点在说明书、权利要求书以及附图中所特别指出的结构来实现和获得。为使本发明的上述目的、特征和优点能更明显易懂，下文特举较佳实施例，并配合所附附图，作详细说明如下。附图说明为了更清楚地说明本发明具体实施方式或现有技术中的技术方案，下面将对具体实施方式或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施方式，对于本领域技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例提供的一种用于分配虚拟房间的服务集群场景示意图；图2为本发明实施例提供的一种虚拟房间的分配方法的流程图；图3为本发明实施例提供的另一种虚拟房间的分配方法的流程图；图4为本发明实施例提供的一种虚拟房间的分配装置的结构示意图；图5为本发明实施例提供的一种电子设备的结构示意图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合附图对本发明的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。使用中心化的架构运行游戏房间分配服务具有较多的缺陷，尽管中心化的架构可以在服务的业务量大增时切换到主从架构或者多主架构，但单点故障影响大、故障恢复时间长和横向扩展能力弱等缺点始终无法克服。基于上述问题，本实施例提供一种虚拟房间的分配方法、装置和电子设备，该技术可以应用于游戏房间的分配，也可以应用于其他场景中的虚拟房间分配。为便于对本实施例进行理解，首先参见图1所示的用于分配虚拟房间的服务集群场景示意图。预设服务集群中运行有多个服务节点；图1中以三个服务节点为例进行说明，服务节点可以随着虚拟房间的数量或服务业务量的变化而变化。用户可以通过用户代理服务访问任一服务节点，或者基于用户账户所处的大厅、区域等参数，为用户划分优先访问的服务节点，当优先访问的服务节点故障时，可以访问其他服务节点。在游戏场景中，用户也可以称为玩家。每个服务节点用于接收用户代理服务发送的房间分配请求，还用于控制至少部分虚拟房间；具体的，用户通过终端设备发送房间分配请求至用户代理服务，用户代理服务将房间分配请求转发至服务节点。每个服务节点可以控制虚拟房间，服务节点可以统计控制的虚拟房间内的用户数量，监控每个虚拟房间的状态，当接收到房间分配请求时，从自身控制的虚拟房间中查找是否具有可分配的虚拟房间。服务节点可以是独立启动的服务器，也可以是集成在游戏大厅中的插件，或者运行在云服务器中的插件。用户的客户端与服务节点之间使用消息传递通信，服务节点与虚拟房间之间使用消息传递通信，各个服务节点之间使用消息传递通信，以实现分布式的虚拟房间的分配服务。基于上述服务集群，下面对本发明实施例所公开的一种虚拟房间的分配方法进行详细介绍，如图2所示，该方法应用于服务集群中的第一服务节点，需要说明的是，第一服务节点可以理解为服务集群中的任一服务节点，第二服务节点可以理解为第一服务节点以外的全部或部分服务节点。下述方法实现的步骤可以应用于服务集群中的任一服务节点，当服务节点运行该方法对应的步骤时，该服务节点即可作为第一服务节点。具体的，该方法包括如下步骤：步骤S202，接收用户代理服务发送的房间分配请求；其中，该房间分配请求中包括用户属性信息；用户想要进入虚拟房间参与游戏时，会发送房间分配请求；用户代理服务将该房间分配请求发送至第一服务节点。考虑到游戏的公平性和趣味性，分配虚拟房间时需要考虑用户属性信息，例如，用户的等级、段位等信息。因此，房间分配请求中包括用户属性信息。步骤S204，将房间分配请求广播至服务集群中的第二服务节点，以确定服务集群中的服务节点控制的虚拟房间中，是否存在与用户属性信息相匹配的目标虚拟房间；如果存在，向第一服务节点发送请求成功信息；请求成功信息中包括目标虚拟房间的房间标识；第二服务节点为服务集群中第一服务节点以外的服务节点；第一服务节点为接收房间分配请求的服务节点，第一服务节点接收到房间分配请求后，在服务集群中广播该请求，以使服务集群中的第二服务节点接收到该房间分配请求。上述第二服务节点可以为第一服务节点以外的全部服务节点，也可以为第一服务节点以外的部分服务节点。请求被广播后，第一服务节点和第二服务节点均接收到房间分配请求，则第一服务节点与每个第二服务节点均可以从自身控制的虚拟房间中，查找是否存在与用户属性信息相匹配的目标虚拟房间。在实际实现时，可以在服务节点中预先存储每个控制的虚拟房间对应的准入条件，服务节点接收到房间分配请求后，将用户属性信息与每个虚拟房间的准入条件进行匹配，将匹配成功的虚拟房间作为目标虚拟房间。虚拟房间的准入条件可以显示用户的等级、段位等属性，以使具有相同或相近等级、段位的用户进入同一虚拟房间参与游戏对局。步骤S206，如果接收到请求成功信息，基于目标虚拟房间为房间分配请求对应的用户账户分配虚拟房间。需要说明的是，第一服务节点中如果存在与用户属性相匹配的目标虚拟房间，也可生成请求成功信息。如果生成或接收到的请求成功信息只有一个，则将该请求成功信息中包括的目标虚拟房间分配给房间分配请求对应的用户账户。如果请求成功信息包括多个，可以按照预设的规则从中选择一个请求成功信息，将选择的请求成功信息中包括的目标虚拟房间分配给房间分配请求对应的用户账户。房间分配请求对应的用户账户分配至目标虚拟房间后，即可控制用户账户进入该目标虚拟房间参与游戏对局。用户账户进入目标虚拟房间后，可以成为目标虚拟房间的成员，也可以成为目标虚拟房间的房主。上述虚拟房间的分配方法，预设服务集群中运行有多个服务节点；每个服务节点用于接收用户代理服务发送的房间分配请求，还用于控制至少部分虚拟房间；服务集群中的第一服务节点接收用户代理服务发送的房间分配请求；其中，房间分配请求中包括用户属性信息；将房间分配请求广播至服务集群中的第二服务节点，以确定服务集群中的服务节点控制的虚拟房间中，是否存在与用户属性信息相匹配的目标虚拟房间；如果存在，向第一服务节点发送请求成功信息；请求成功信息中包括目标虚拟房间的房间标识；第二服务节点为服务集群中第一服务节点以外的服务节点；如果接收到请求成功信息，基于目标虚拟房间为房间分配请求对应的用户账户分配虚拟房间。该方式中，服务集群中的任一服务节点均可接收用户的房间分配请求，并在服务集群中进行广播，找到相匹配的虚拟房间后，将用户分配至该虚拟房间。由于服务节点包括多个，即使某些服务节点发生故障，其他服务节点依然可以正常为用户分配房间，保障房间分配服务的持续稳定运行，当业务量增大时，通过增加服务节点即可保障服务正常运行，具有较大的横向扩展能力，可承载较大的服务业务量。下述实施例提供分配虚拟房间的具体实现方式。如果接收到多个请求成功信息，按照预设规则从多个请求成功信息中确定第一成功信息；为房间分配请求对应的用户账户分配第一成功信息对应的目标虚拟房间。预设规则具体可以为，房间分配请求广播后，首次接收到的请求成功信息作为第一成功信息。在实际实现时，可以在第一服务节点中运行一个组件，用于接收请求成功信息，第一服务节点中如果存在目标虚拟房间，也生成请求成功信息并向该组件发送请求成功信息。该组件将接收到的第一个请求成功信息作为上述第一成功信息，后续接收到的请求成功信息则不再处理。为房间分配请求对应的用户账户分配第一成功信息对应的目标虚拟房间之后，向发送第一成功信息的服务节点返回确认信息；其中，该确认信息用于：指示第一成功信息对应的目标虚拟房间已分配给房间分配请求对应的用户账户。此时，接收到确认信息的服务节点可以将该用户账户统计至目标虚拟房间中的用户列表中，同时，在该服务节点中更新该目标房间的在线人数、可接收人数等信息。进一步的，在本实施例中，多个服务节点之间需要进行状态共识。每个服务节点中保存有该服务节点控制的虚拟房间的相关信息，例如，服务节点控制的虚拟房间列表，该列表中可以包括虚拟房间的地址、虚拟房间的容量、虚拟房间内用户数量、用户信息等。除此之外，服务节点中还保存有一个指定房间标识。对于第一服务节点而言，第一服务节点中设置有指定房间标识，指定房间标识为第一标识；第一标识对应的虚拟房间为未分配用户账户的可用房间；指定房间标识中保存在标识，也可以理解为下一个将被分配的虚拟房间，如果当前可分配的房间中不存在与用户属性信息相匹配的虚拟房间，则开启指定房间标识中保存的标识所对应的虚拟房间。上述指定房间标识可以将当前不活跃的虚拟房间分配给用户账户，还用于维护服务集群中，指定房间标识的状态一致，即，第一服务节点通过指定房间标识，向服务集群中的其他服务节点发起共识算法，以维护集群中的各个服务节点的指定房间标识的状态一致。具体而言，如果没有接收到请求成功信息，基于第一标识向服务集群中的第二服务节点发送共识请求；其中，该共识请求用于：确定第二服务节点中的指定房间标识是否是第一标识；并更新第二服务节点中的指定房间标识为第二标识，第二标识对应的虚拟房间为未分配用户账户的可用房间；如果共识请求对应的共识操作成功，为房间分配请求对应的用户账户分配第一标识对应的虚拟房间，更新指定房间标识为第二标识。在上述过程中，如果第一服务节点没有接收到请求成功信息，说明服务集群内各个服务节点控制的虚拟房间与用户属性信息均不匹配，此时，需要为该用户账户开设新的虚拟房间。本实施例中，为了为该用户账户开设新的虚拟房间，需要向第二服务节点发送共识请求。对于某一第二服务节点而言，第二服务节点接收到上述共识请求后，从共识请求中获取第一标识，将该第一标识与第二服务节点自身存储的指定房间标识进行比对，如果第二服务节点自身存储的指定房间标识与第一标识相同，则更新第二服务节点中的指定房间标识为第二标识，该第二标识对应的虚拟房间为未分配用户账户的可用房间。一种具体的实现方式中，当第二服务节点自身存储的指定房间标识与第一标识相同，且已将指定房间标识更新为第二标识，则向第一服务节点返回共识成功信息。第一服务节点接收服务集群中的第二服务节点返回的共识成功信息；其中，该共识成功信息用于：指示第二服务节点中的指定房间标识为第一标识，且将指定房间标识更新为第二标识；统计接收到的共识成功信息的第一信息数量，如果第一信息数量满足第一预设条件，确定共识请求对应的共识操作成功，为房间分配请求对应的用户账户分配指定房间标识对应的虚拟房间。例如，上述第一预设条件可以为，第一信息数量到达服务节点数量的50％，或者其他阈值。通常，虚拟房间的状态可以包括活跃、非活跃和不可用。其中，活跃的虚拟房间为已分配有用户，但用户数量没有满员的房间；非活跃的虚拟房间为未被分配任何用户的房间；不可用的虚拟房间为已满员或者正在进行游戏对局的房间。例如，上述第一标识对象的虚拟房间在分配上述房间分配请求对应的用户账户之前，属于非活跃的虚拟房间；被分配该用户账户之后，且满员之前，属于活跃的虚拟房间；该虚拟房间开始游戏对局后，属于不可用户的虚拟房间。即，服务节点内存储的指定房间标识对应的虚拟房间均属于非活跃的虚拟房间，指定房间标识内存储的标识被分配用户后，该指定房间标识随即更新其他标识，即第二标识，该第二标识对应的虚拟房间也属于非活跃的虚拟房间。第一标识对应的虚拟房间分配给上述用户账户后，将第一标识对应的虚拟房间设置为第一服务节点控制的虚拟房间，即，第一服务节点拥有了第一标识对应的虚拟房间的控制权。该第一服务节点监控该虚拟房间的状态、当前用户人数等数据。当接收到房间分配请求后，判断该虚拟房间是否与用户属性信息相匹配。进一步地，如果共识请求对应的共识操作失败，更新指定房间标识；继续执行将房间分配请求广播至服务集群中的第二服务节点的步骤。具体的，接收服务集群中的第二服务节点返回的共识失败信息；其中，该共识失败信息用于：指示第二服务节点中的指定房间标识不是第一标识；共识失败信息中包括第二服务节点中的指定房间标识；统计接收到的共识失败信息的第二信息数量，如果第二信息数量满足第二预设条件，确定共识请求对应的共识操作失败，从共识失败信息中获取最新的指定房间标识，将第一服务节点的指定房间标识更新为最新的指定房间标识。例如，上述第二预设条件可以为，第二信息数量到达服务节点数量的50％，或者其他阈值。对于第二服务节点而言，接收到来自第一服务节点的共识请求后，从共识请求中获取第一标识，将该第一标识与第二服务节点自身存储的指定房间标识进行比对，如果第二服务节点自身存储的指定房间标识与第一标识不同，则向第一服务节点返回共识失败信息。该共识失败信息中包括第二服务节点自身存储的指定房间标识。如果第一服务节点接收到的来自各个第二服务节点的共识失败信息的总量，超过服务节点数量的预设阈值，如50％，则可以认为共识请求对应的共识操作失败。该情况下，说明第一服务节点中的指定房间标识与服务集群中大部分服务节点中的指定房间标识不同。可能的原因是，第一服务节点是新加入集群的服务节点，或者是出现故障后又恢复正常的服务节点，此时的第一服务节点中的指定房间标识与其他服务节点中的指定房间标识不同。在实际实现时，每个虚拟房间的房间标识可以按照虚拟房间由非活跃状态转换为活跃状态的顺序由小到大进行设置。当接收到多个共识失败信息后，逐一从每个共识失败信息中获取指定房间标识，从获取到的多个指定房间标识中，标识最大的指定房间标识，作为第一服务节点的指定房间标识。第一服务节点更新了指定房间标识后，此时第一服务节点的状态与服务集群中大部分的服务节点的状态相同，再次执行将房间分配请求广播至服务集群中的第二服务节点的步骤，以完成对房间分配请求的用户账户的房间分配。为了便于理解，图3示出了本实施例提供的虚拟房间的分配方法的另一种实现方式，首先，用户发起房间分配请求；第一服务节点广播房间分配请求，以确认服务集群中是否存在处于活跃状态的房间；如果存在，将用户分配到处于活跃状态的房间，并判断是否分配成功；如果分配成功，控制用户进入分配的房间；如果分配不成功，则再由第一服务节点广播房间分配请求，以确认服务集群中是否存在处于活跃状态的房间。这里需要说明的是，如果集群中存在处于活跃状态的房间，但没有分配成功，可能是因为处于活跃状态的房间在分配给用户之前，突然由活跃状态变成了不可用状态，例如，该房间的虚拟人数已满，或开始游戏对局。此时，则再次执行再由第一服务节点广播房间分配请求，以确认服务集群中是否存在处于活跃状态的房间，如果存在，说明在此期间有虚拟房间由其他状态转变为了活跃状态，则继续将该用户分配该处于活跃状态的房间，如果不存在，则第一服务节点发起共识算法，以更新自身和其他服务节点中的指定房间标识。当服务集群中不存在处于活跃状态的房间时，第一服务节点发起共识算法，以更新自身和其他服务节点中的指定房间标识；第一服务节点判断是否共识成功，如果成功，为用户分配虚拟房间后，控制用户进入分配的房间；如果不成功，更新自身的指定房间标识，继续广播房间分配请求。本实施例提供的虚拟房间的分配方法，在服务集群中设置任意数量的服务节点，用户可在任意服务器入口请求任意服务节点。服务节点响应用户的房间分配请求后，为其分配一个符合条件的虚拟房间，并将此用户账户接入到该虚拟房间。该过程符合分布式一致性，即，用户无论请求集群中的哪个服务节点，都可以分配至同一个虚拟房间。另外，本实施例的分布式的服务节点之间，无需保证服务节点之前全部信息的一致性，仅需要保证指定房间标识的一致性即可，避免了多个状态更新可能存在的互相等待等降低效率的情况，提高了服务集群的运行效率，进而提高了虚拟房间分配的效率。本实施例提供的虚拟房间的分配方法，具有下述优点：1、去中心化。房间状态分布在任意多个服务节点中，不存在任何无法恢复的单点故障，也不存在普通分布式架构中普遍存在的故障恢复中的业务中断时间。2、完全容灾。集群中节点数量大于等于1即可正常提供虚拟房间的分配服务。任意正在工作中的服务节点离线不会导致无法恢复的业务失败，请求方只需要在请求超时后重试请求即可。3、无限伸缩性。受益于单一状态的分布式一致性，节点数量上升不会带来性能瓶颈。对应于上述方法实施例，参见图4所示的一种虚拟房间的分配装置的结构示意图，预设服务集群中运行有多个服务节点；每个服务节点用于接收用户代理服务发送的房间分配请求，还用于控制至少部分虚拟房间；装置应用于服务集群中的第一服务节点，该装置包括：请求接收模块40，用于接收用户代理服务发送的房间分配请求；其中，房间分配请求中包括用户属性信息；广播模块42，用于将房间分配请求广播至服务集群中的第二服务节点，以确定服务集群中的服务节点控制的虚拟房间中，是否存在与用户属性信息相匹配的目标虚拟房间；如果存在，向第一服务节点发送请求成功信息；请求成功信息中包括目标虚拟房间的房间标识；第二服务节点为服务集群中第一服务节点以外的服务节点；分配模块44，用于如果接收到请求成功信息，基于目标虚拟房间为房间分配请求对应的用户账户分配虚拟房间。上述虚拟房间的分配装置，预设服务集群中运行有多个服务节点；每个服务节点用于接收用户代理服务发送的房间分配请求，还用于控制至少部分虚拟房间；服务集群中的第一服务节点接收用户代理服务发送的房间分配请求；其中，房间分配请求中包括用户属性信息；将房间分配请求广播至服务集群中的第二服务节点，以确定服务集群中的服务节点控制的虚拟房间中，是否存在与用户属性信息相匹配的目标虚拟房间；如果存在，向第一服务节点发送请求成功信息；请求成功信息中包括目标虚拟房间的房间标识；第二服务节点为服务集群中第一服务节点以外的服务节点；如果接收到请求成功信息，基于目标虚拟房间为房间分配请求对应的用户账户分配虚拟房间。该方式中，服务集群中的任一服务节点均可接收用户的房间分配请求，并在服务集群中进行广播，找到相匹配的虚拟房间后，将用户分配至该虚拟房间。由于服务节点包括多个，即使某些服务节点发生故障，其他服务节点依然可以正常为用户分配房间，保障房间分配服务的持续稳定运行，当业务量增大时，通过增加服务节点即可保障服务正常运行，具有较大的横向扩展能力，可承载较大的服务业务量。上述分配模块，还用于：如果接收到多个请求成功信息，按照预设规则从多个请求成功信息中确定第一成功信息；为房间分配请求对应的用户账户分配第一成功信息对应的目标虚拟房间。上述装置还包括：信息发送模块，用于：向发送第一成功信息的服务节点返回确认信息；其中，确认信息用于：指示第一成功信息对应的目标虚拟房间已分配给房间分配请求对应的用户账户。上述第一服务节点中设置有指定房间标识，指定房间标识为第一标识；第一标识对应的虚拟房间为未分配用户账户的可用房间；上述装置还包括：共识模块，用于如果没有接收到请求成功信息，基于第一标识向服务集群中的第二服务节点发送共识请求；其中，共识请求用于：确定第二服务节点中的指定房间标识是否是第一标识；并更新第二服务节点中的指定房间标识为第二标识，第二标识对应的虚拟房间为未分配用户账户的可用房间；如果共识请求对应的共识操作成功，为房间分配请求对应的用户账户分配第一标识对应的虚拟房间，更新指定房间标识为第二标识。上述共识模块，还用于：接收服务集群中的第二服务节点返回的共识成功信息；其中，共识成功信息用于：指示第二服务节点中的指定房间标识为第一标识，且将指定房间标识更新为第二标识；统计接收到的共识成功信息的第一信息数量，如果第一信息数量满足第一预设条件，确定共识请求对应的共识操作成功，为房间分配请求对应的用户账户分配指定房间标识对应的虚拟房间。上述装置还包括：设置模块，用于：将第一标识对应的虚拟房间设置为第一服务节点控制的虚拟房间。上述装置还包括：更新模块，用于：如果共识请求对应的共识操作失败，更新指定房间标识；继续执行将房间分配请求广播至服务集群中的第二服务节点的步骤。上述更新模块，还用于：接收服务集群中的第二服务节点返回的共识失败信息；其中，共识失败信息用于：指示第二服务节点中的指定房间标识不是第一标识；共识失败信息中包括第二服务节点中的指定房间标识；统计接收到的共识失败信息的第二信息数量，如果第二信息数量满足第二预设条件，确定共识请求对应的共识操作失败，从共识失败信息中获取最新的指定房间标识，将第一服务节点的指定房间标识更新为最新的指定房间标识。本实施例还提供一种电子设备，包括处理器和存储器，存储器存储有能够被处理器执行的机器可执行指令，处理器执行机器可执行指令以实现上述虚拟房间的分配方法。该电子设备可以是服务器，也可以是终端设备。参见图5所示，该电子设备包括处理器100和存储器101，该存储器101存储有能够被处理器100执行的机器可执行指令，该处理器100执行机器可执行指令以实现上述虚拟房间的分配方法。进一步地，图5所示的电子设备还包括总线102和通信接口103，处理器100、通信接口103和存储器101通过总线102连接。其中，存储器101可能包含高速随机存取存储器，也可能还包括非不稳定的存储器，例如至少一个磁盘存储器。通过至少一个通信接口103实现该系统网元与至少一个其他网元之间的通信连接，可以使用互联网，广域网，本地网，城域网等。总线102可以是ISA总线、PCI总线或EISA总线等。所述总线可以分为地址总线、数据总线、控制总线等。为便于表示，图5中仅用一个双向箭头表示，但并不表示仅有一根总线或一种类型的总线。处理器100可能是一种集成电路芯片，具有信号的处理能力。在实现过程中，上述方法的各步骤可以通过处理器100中的硬件的集成逻辑电路或者软件形式的指令完成。上述的处理器100可以是通用处理器，包括中央处理器、网络处理器等；还可以是数字信号处理器、专用集成电路、现场可编程门阵列或者其他可编程逻辑器件、分立门或者晶体管逻辑器件、分立硬件组件。可以实现或者执行本发明实施例中的公开的各方法、步骤及逻辑框图。通用处理器可以是微处理器或者该处理器也可以是任何常规的处理器等。结合本发明实施例所公开的方法的步骤可以直接体现为硬件译码处理器执行完成，或者用译码处理器中的硬件及软件模块组合执行完成。软件模块可以位于随机存储器，闪存、只读存储器，可编程只读存储器或者电可擦写可编程存储器、寄存器等本领域成熟的存储介质中。该存储介质位于存储器101，处理器100读取存储器101中的信息，结合其硬件完成前述实施例的方法的步骤。本实施例还提供一种机器可读存储介质，机器可读存储介质存储有机器可执行指令，机器可执行指令在被处理器调用和执行时，机器可执行指令促使处理器实现上述虚拟房间的分配方法。本发明实施例所提供的虚拟房间的分配方法、装置、电子设备及存储介质的计算机程序产品，包括存储了程序代码的计算机可读存储介质，所述程序代码包括的指令可用于执行前面方法实施例中所述的方法，具体实现可参见方法实施例，在此不再赘述。所属领域的技术人员可以清楚地了解到，为描述的方便和简洁，上述描述的系统和装置的具体工作过程，可以参考前述方法实施例中的对应过程，在此不再赘述。另外，在本发明实施例的描述中，除非另有明确的规定和限定，术语“安装”、“相连”、“连接”应做广义理解，例如，可以是固定连接，也可以是可拆卸连接，或一体地连接；可以是机械连接，也可以是电连接；可以是直接相连，也可以通过中间媒介间接相连，可以是两个元件内部的连通。对于本领域技术人员而言，可以具体情况理解上述术语在本发明中的具体含义。所述功能如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本发明的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台计算机设备执行本发明各个实施例所述方法的全部或部分步骤。而前述的存储介质包括：U盘、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质。在本发明的描述中，需要说明的是，术语“中心”、“上”、“下”、“左”、“右”、“竖直”、“水平”、“内”、“外”等指示的方位或位置关系为基于附图所示的方位或位置关系，仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本发明的限制。此外，术语“第一”、“第二”、“第三”仅用于描述目的，而不能理解为指示或暗示相对重要性。最后应说明的是：以上实施例，仅为本发明的具体实施方式，用以说明本发明的技术方案，而非对其限制，本发明的保护范围并不局限于此，尽管参照前述实施例对本发明进行了详细的说明，本领域技术人员应当理解：任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，其依然可以对前述实施例所记载的技术方案进行修改或可轻易想到变化，或者对其中部分技术特征进行等同替换；而这些修改、变化或者替换，并不使相应技术方案的本质脱离本发明实施例技术方案的精神和范围，都应涵盖在本发明的保护范围之内。因此，本发明的保护范围应以权利要求的保护范围为准。
