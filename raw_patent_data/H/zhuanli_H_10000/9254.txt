标题title
一种报文处理方法及装置
摘要abst
本申请提供一种报文处理方法及装置。该方法应用于确定性网络中的任一转发设备，且包括：在接收到报文时，确定报文的发送周期及其对应的调度队列；在判断出调度队列中的报文数量不小于针对调度队列设置的设定数量阈值时，根据接收到报文时的时间、预设的偏移时间、预设的发送周期时长和预设的发送周期的总个数值，重新计算报文的发送周期；从队列编号大于调度队列的队列编号的调度队列中，选择满足预设条件的调度队列，并将选择出的调度队列确定为重新计算出的发送周期对应的调度队列；以及将相关报文缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。本申请可提高报文转发效率。
权利要求书clms
1.一种报文处理方法，其特征在于，所述方法应用于确定性网络中的任一转发设备，所述方法包括：在接收到报文时，确定所述报文的发送周期及其对应的调度队列；在判断出所述调度队列中的报文数量不小于针对所述调度队列设置的设定数量阈值时，根据接收到所述报文时的时间、预设的偏移时间、预设的发送周期时长和预设的发送周期的总个数值，重新计算所述报文的发送周期；从队列编号大于所述调度队列的队列编号的调度队列中，选择满足预设条件的调度队列，并将选择出的调度队列确定为重新计算出的发送周期对应的调度队列，其中，选择出的调度队列中的报文数量小于所述调度队列中的报文数量；在所述报文为原始数据报文时，将所述报文封装为SRv6报文，并缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在所述报文为携带有原始数据报文的SRv6报文、且自身为中转节点时，将所述报文缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在所述报文为携带有原始数据报文的SRv6报文、且在自身为尾节点时，将所述报文解封装为原始数据报文后缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。2.根据权利要求1所述的方法，其特征在于，所述方法还包括：在判断出所述调度队列中的报文数量小于针对所述调度队列设置的设定数量阈值时，若所述报文为原始数据报文，则将所述报文封装为SRv6报文，并缓存到所述调度队列中等待到达确定出的发送周期时转发；若所述报文为携带有原始数据报文的SRv6报文、且自身为中转节点，则将所述报文缓存到所述调度队列中等待到达确定出的发送周期时转发；若所述报文为携带有原始数据报文的SRv6报文、且自身为尾节点，则将所述报文解封装为原始数据报文后缓存到所述调度队列中等待到达确定出的发送周期时转发。3.根据权利要求1所述的方法，其特征在于，通过以下方式重新计算所述报文的发送周期：通过以下公式一重新计算得到所述报文的发送周期：公式一：A＝【/D】％E，其中，A为重新计算出的所述报文的发送周期；B为该转发设备接收到所述报文时的时间；C为预设的偏移时间；D为预设的发送周期时长；E为预设的发送周期的总个数值。4.根据权利要求1所述的方法，其特征在于，从队列编号大于所述调度队列的队列编号的调度队列中，选择满足预设条件的调度队列，具体包括：从队列编号大于所述调度队列的队列编号的调度队列中，选择队列编号与所述调度队列的队列编号的差值最小、且空闲率不小于设定阈值的调度队列。5.一种报文处理装置，其特征在于，所述装置应用于确定性网络中的任一转发设备，所述装置包括：确定模块，用于在接收到报文时，确定所述报文的发送周期及其对应的调度队列；计算模块，用于在判断出所述调度队列中的报文数量不小于针对所述调度队列设置的设定数量阈值时，根据接收到所述报文时的时间、预设的偏移时间、预设的发送周期时长和预设的发送周期的总个数值，重新计算所述报文的发送周期；第一处理模块，用于从队列编号大于所述调度队列的队列编号的调度队列中，选择满足预设条件的调度队列，并将选择出的调度队列确定为重新计算出的发送周期对应的调度队列，其中，选择出的调度队列中的报文数量小于所述调度队列中的报文数量；以及在所述报文为原始数据报文时，将所述报文封装为SRv6报文，并缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在所述报文为携带有原始数据报文的SRv6报文、且自身为中转节点时，将所述报文缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在所述报文为携带有原始数据报文的SRv6报文、且在自身为尾节点时，将所述报文解封装为原始数据报文后缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。6.根据权利要求5所述的装置，其特征在于，所述装置还包括：第二处理模块，用于在判断出所述调度队列中的报文数量小于针对所述调度队列设置的设定数量阈值时，若所述报文为原始数据报文，则将所述报文封装为SRv6报文，并缓存到所述调度队列中等待到达确定出的发送周期时转发；若所述报文为携带有原始数据报文的SRv6报文、且自身为中转节点，则将所述报文缓存到所述调度队列中等待到达确定出的发送周期时转发；若所述报文为携带有原始数据报文的SRv6报文、且自身为尾节点，则将所述报文解封装为原始数据报文后缓存到所述调度队列中等待到达确定出的发送周期时转发。7.根据权利要求5所述的装置，其特征在于，所述计算模块，具体用于通过以下方式重新计算所述报文的发送周期：通过以下公式一重新计算得到所述报文的发送周期：公式一：A＝【/D】％E，其中，A为重新计算出的所述报文的发送周期；B为该转发设备接收到所述报文时的时间；C为预设的偏移时间；D为预设的发送周期时长；E为预设的发送周期的总个数值。8.根据权利要求5所述的装置，其特征在于，所述第一处理模块，具体用于通过以下方式选择满足预设条件的调度队列：从队列编号大于所述调度队列的队列编号的调度队列中，选择队列编号与所述调度队列的队列编号的差值最小、且空闲率不小于设定阈值的调度队列。9.一种电子设备，其特征在于，包括处理器和机器可读存储介质，所述机器可读存储介质存储有能够被所述处理器执行的机器可执行指令，所述处理器被所述机器可执行指令促使：实现权利要求1-4任一项所述的方法步骤。10.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质内存储有计算机程序，所述计算机程序被处理器执行时实现权利要求1-4任一项所述的方法步骤。
说明书desc
技术领域本申请涉及通信技术领域，尤其涉及一种报文处理方法及装置。背景技术确定性网络是指可以保证互联网协议保障技术，其核心为周期调度机制。在一种应用场景下，对于确定性网络中的任一转发设备而言，通常使用基于分段路由的周期性排队转发机制处理接收到的报文。但是，在这种报文处理过程中，由于该转发设备确定出的报文的发送周期和需要缓存报文的调度队列是确定性网络中的软件定义网络控制器事先规划出的，这就容易出现某些发送周期对应的调度队列中的报文较少，如图1所示的发送周期2对应的调度队列和发送周期3对应的调度队列，从而导致报文转发率较低。发明内容为克服相关技术中存在的问题，本申请提供了一种报文处理方法及装置。根据本申请实施例的第一方面，提供一种报文处理方法，所述方法应用于确定性网络中的任一转发设备，所述方法包括：在接收到报文时，确定所述报文的发送周期及其对应的调度队列；在判断出所述调度队列中的报文数量不小于针对所述调度队列设置的设定数量阈值时，根据接收到所述报文时的时间、预设的偏移时间、预设的发送周期时长和预设的发送周期的总个数值，重新计算所述报文的发送周期；从队列编号大于所述调度队列的队列编号的调度队列中，选择满足预设条件的调度队列，并将选择出的调度队列确定为重新计算出的发送周期对应的调度队列，其中，选择出的调度队列中的报文数量小于所述调度队列中的报文数量；在所述报文为原始数据报文时，将所述报文封装为SRv6报文，并缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在所述报文为携带有原始数据报文的SRv6报文、且自身为中转节点时，将所述报文缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在所述报文为携带有原始数据报文的SRv6报文、且在自身为尾节点时，将所述报文解封装为原始数据报文后缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。根据本申请实施例的第二方面，提供报文处理装置，所述装置应用于确定性网络中的任一转发设备，所述装置包括：确定模块，用于在接收到报文时，确定所述报文的发送周期及其对应的调度队列；计算模块，用于在判断出所述调度队列中的报文数量不小于针对所述调度队列设置的设定数量阈值时，根据接收到所述报文时的时间、预设的偏移时间、预设的发送周期时长和预设的发送周期的总个数值，重新计算所述报文的发送周期；第一处理模块，用于从队列编号大于所述调度队列的队列编号的调度队列中，选择满足预设条件的调度队列，并将选择出的调度队列确定为重新计算出的发送周期对应的调度队列，其中，选择出的调度队列中的报文数量小于所述调度队列中的报文数量；以及在所述报文为原始数据报文时，将所述报文封装为SRv6报文，并缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在所述报文为携带有原始数据报文的SRv6报文、且自身为中转节点时，将所述报文缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在所述报文为携带有原始数据报文的SRv6报文、且在自身为尾节点时，将所述报文解封装为原始数据报文后缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。本申请的实施例提供的技术方案可以包括以下有益效果：在本申请实施例中，对于确定性网络中的任一转发设备而言，在接收到报文之后，先确定该报文的发送周期及其对应的调度队列；然后再判断该调度队列中的报文数量是否不小于针对该调度队列设置的设定数量阈值，并在判断结果为是的情形下，再根据接收到报文时的时间、预设的偏移时间、预设的发送周期时长和预设的发送周期的总个数值，重新计算报文的发送周期，以及从队列编号大于该调度队列的队列编号的调度队列中，选择满足预设条件的调度队列，并将选择出的调度队列确定为重新计算出的发送周期对应的调度队列；最后，在报文为原始数据报文时，将报文封装为SRv6报文，并缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在报文为携带有原始数据报文的SRv6报文、且自身为中转节点时，将报文缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在报文为携带有原始数据报文的SRv6报文、且在自身为尾节点时，将报文解封装为原始数据报文后缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。在这种报文处理流程中，该转发设备可以基于报文的发送周期对应的调度队列中的报文缓存情况，灵活调整报文的发送的周期及其对应的调度队列，在一定程度上提高了报文转发率。应当理解的是，以上的一般描述和后文的细节描述仅是示例性和解释性的，并不能限制本申请。附图说明此处的附图被并入说明书中并构成本申请的一部分，示出了符合本申请的实施例，并与说明书一起用于解释本申请的原理。图1为现有的报文的转发发送周期及其对应的发送队列的对应关系的示意图；图2为本申请实施例提供的一种报文处理方法的流程示意图；图3为本申请实施例提供的确定性网络的结构示意图；图4为本申请实施例提供的一种报文处理装置的结构示意图；图5为本申请实施例提供的一种电子设备的结构示意图。具体实施方式这里将详细地对示例性实施例进行说明，其示例表示在附图中。下面的描述涉及附图时，除非另有表示，不同附图中的相同数字表示相同或相似的要素。以下示例性实施例中所描述的实施方式并不代表与本申请相一致的所有实施方式。相反，它们仅是与如所附权利要求书中所详述的、本申请的一些方面相一致的装置和方法的例子。在本申请使用的术语是仅仅出于描述特定实施例的目的，而非旨在限制本申请。在本申请和所附权利要求书中所使用的单数形式的“一种”、“所述”和“该”也旨在包括多数形式，除非上下文清楚地表示其他含义。还应当理解，本文中使用的术语“和/或”是指并包含一个或多个相关联的列出项目的任何或所有可能组合。应当理解，尽管在本申请可能采用术语第一、第二、第三等来描述各种信息，但这些信息不应限于这些术语。这些术语仅用来将同一类型的信息彼此区分开。例如，在不脱离本申请范围的情况下，第一信息也可以被称为第二信息，类似地，第二信息也可以被称为第一信息。取决于语境，如在此所使用的词语“如果”或者“若”可以被解释成为“在……时”或“当……时”。接下来对本申请实施例进行详细说明。本申请实施例提供了一种报文处理方法，该方法应用于确定性网络中的任一转发设备，如图1所示，该方法可以包括如下步骤：S2、在接收到报文时，确定报文的发送周期及其对应的调度队列。S22、在判断出调度队列中的报文数量不小于针对调度队列设置的设定数量阈值时，根据接收到报文时的时间、预设的偏移时间、预设的发送周期时长和预设的发送周期的总个数值，重新计算报文的发送周期。S23、从队列编号大于调度队列的队列编号的调度队列中，选择满足预设条件的调度队列，并将选择出的调度队列确定为重新计算出的发送周期对应的调度队列。在本步骤中，选择出的调度队列中的报文数量小于上述调度队列中的报文数量。S24、在报文为原始数据报文时，将报文封装为SRv6报文，并缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。S25、在报文为携带有原始数据报文的SRv6报文、且自身为中转节点时，将报文缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。S26、在报文为携带有原始数据报文的SRv6报文、且在自身为尾节点时，将报文解封装为原始数据报文后缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。需要说明的是，在本申请实施例中，该转发设备在执行完上述步骤S21之后，如果判断出调度队列中的报文数量小于针对调度队列设置的设定数量阈值，那么，仍然按照现有方式进行处理，即，在报文为原始数据报文时，将报文封装为SRv6报文，并缓存到确定出的发送周期对应的调度队列中等待到达确定出的发送周期时转发。在这里，该转发设备为源节点。在报文为携带有原始数据报文的SRv6报文、且自身为中转节点时，将报文缓存到确定出的发送周期对应的调度队列中等待到达确定出的发送周期时转发。在报文为携带有原始数据报文的SRv6报文、且自身为尾节点时，将报文解封装为原始数据报文后缓存到确定出的发送周期对应的调度队列中等待到达确定出的发送周期时转发。具体地，在上述步骤S21中，不管该转发设备是源节点，还是中转节点，又或者是尾节点，确定上述报文的发送周期及其对应的调度队列的具体确定过程为现有技术，在此不再详述。需要说明的是，源节点、中转节点和尾节点确定出的上述报文的发送周期及其对应的调度队列均为确定性网络中的SDN控制器事先部署的。其中，源节点直接从本地确定上述报文的发送周期及其对应的调度队列；中转节点和尾节点均通过解析上述报文中的Argument字段得到上述报文的发送周期及其对应的调度队列。在上述步骤S22中，上述设定数量阈值、预设的偏移时间、预设的发送周期时长和预设的发送周期的总个数值均可根据确定性网络的实际网络需求来设定。另外，在上述步骤S22中，该转发设备具体可以通过以下方式重新计算报文的发送周期：通过以下公式一重新计算得到报文的发送周期：公式一：A＝【/D】％E，其中，A为重新计算出的报文的发送周期；B为该转发设备接收到报文时的时间；C为预设的偏移时间；D为预设的发送周期时长；E为预设的发送周期的总个数值。具体地，在上述步骤S23中，该转发设备在从队列编号大于调度队列的队列编号的调度队列中，选择满足预设条件的调度队列时，具体可以从队列编号大于调度队列的队列编号的调度队列中，选择队列编号与调度队列的队列编号的差值最小、且空闲率不小于设定阈值的调度队列。当然，该转发设备还可以采用其他选择方式选择，在此不再一一列举。下面结合具体实施例对上述报文处理方法进行详细说明。如图3所示，假设主机A和主机B之间需要传输确定性流的报文，又假设主机A发出的确定性流的报文会经过转发设备R1、转发设备R2、转发设备R3、转发设备R7、转发设备R8和转发设备R9到达主机B。在这里，图3中的SDN控制器与相关转发设备的交互过程为现有技术，在此不再详述。以转发设备R1接收到主机A发出的确定性流的原始数据报文为例，假设转发设备R1接收到该原始数据报文时的时间为0000000000000100，假设预设的偏移时间为0000000000000020，假设预设的发送周期时长为10us，假设预设的发送周期的总个数值为90。转发设备R1在接收到该原始数据报文之后，先确定该原始数据报文的发送周期及其对应的调度队列。在这里，具体的确定过程为现有技术，在此不再详述。假设确定出的发送周期为第2个发送周期，确定出的调度队列为Q5，那么，转发设备R1再判断该调度队列中的报文数量是否不小于针对该调度队列设置的设定数量阈值，由于转发设备R1判断出该调度队列中的报文数量不小于针对该调度队列设置的设定数量阈值，此时，转发设备R1使用上述公式一重新计算出该原始数据报文的发送周期，即，第3个发送周期。转发设备R1还从队列编号大于调度队列的队列编号的调度队列中，选择队列编号与该调度队列的队列编号的差值最小、且空闲率不小于60％的调度队列。假设选择出的调度队列为Q6，在这种情形下，转发设备R1将该原始数据报文封装为SRv6报文，并将封装完的SRv6报文缓存到Q6中，等待到达第3个发送周期时再进行转发。由以上技术方案可以看出，在本申请实施例中，对于确定性网络中的任一转发设备而言，在接收到报文之后，先确定该报文的发送周期及其对应的调度队列；然后再判断该调度队列中的报文数量是否不小于针对该调度队列设置的设定数量阈值，并在判断结果为是的情形下，再根据接收到报文时的时间、预设的偏移时间、预设的发送周期时长和预设的发送周期的总个数值，重新计算报文的发送周期，以及从队列编号大于该调度队列的队列编号的调度队列中，选择满足预设条件的调度队列，并将选择出的调度队列确定为重新计算出的发送周期对应的调度队列；最后，在报文为原始数据报文时，将报文封装为SRv6报文，并缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在报文为携带有原始数据报文的SRv6报文、且自身为中转节点时，将报文缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在报文为携带有原始数据报文的SRv6报文、且在自身为尾节点时，将报文解封装为原始数据报文后缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。在这种报文处理流程中，该转发设备可以基于报文的发送周期对应的调度队列中的报文缓存情况，灵活调整报文的发送的周期及其对应的调度队列，在一定程度上提高了报文转发率。基于同一发明构思，本申请还提供了一种报文处理装置，所述装置应用于确定性网络中的任一转发设备，其结构示意图如图4所示，具体包括：确定模块41，用于在接收到报文时，确定所述报文的发送周期及其对应的调度队列；计算模块42，用于在判断出所述调度队列中的报文数量不小于针对所述调度队列设置的设定数量阈值时，根据接收到所述报文时的时间、预设的偏移时间、预设的发送周期时长和预设的发送周期的总个数值，重新计算所述报文的发送周期；第一处理模块43，用于从队列编号大于所述调度队列的队列编号的调度队列中，选择满足预设条件的调度队列，并将选择出的调度队列确定为重新计算出的发送周期对应的调度队列，其中，选择出的调度队列中的报文数量小于所述调度队列中的报文数量；以及在所述报文为原始数据报文时，将所述报文封装为SRv6报文，并缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在所述报文为携带有原始数据报文的SRv6报文、且自身为中转节点时，将所述报文缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在所述报文为携带有原始数据报文的SRv6报文、且在自身为尾节点时，将所述报文解封装为原始数据报文后缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。优选地，所述装置还包括：第二处理模块，用于在判断出所述调度队列中的报文数量小于针对所述调度队列设置的设定数量阈值时，若所述报文为原始数据报文，则将所述报文封装为SRv6报文，并缓存到所述调度队列中等待到达确定出的发送周期时转发；若所述报文为携带有原始数据报文的SRv6报文、且自身为中转节点，则将所述报文缓存到所述调度队列中等待到达确定出的发送周期时转发；若所述报文为携带有原始数据报文的SRv6报文、且自身为尾节点，则将所述报文解封装为原始数据报文后缓存到所述调度队列中等待到达确定出的发送周期时转发。优选地，所述计算模块42，具体用于通过以下方式重新计算所述报文的发送周期：通过以下公式一重新计算得到所述报文的发送周期：公式一：A＝【/D】％E，其中，A为重新计算出的所述报文的发送周期；B为该转发设备接收到所述报文时的时间；C为预设的偏移时间；D为预设的发送周期时长；E为预设的发送周期的总个数值。优选地，所述第一处理模块43，具体用于通过以下方式选择满足预设条件的调度队列：从队列编号大于所述调度队列的队列编号的调度队列中，选择队列编号与所述调度队列的队列编号的差值最小、且空闲率不小于设定阈值的调度队列。由以上技术方案可以看出，在本申请实施例中，对于确定性网络中的任一转发设备而言，在接收到报文之后，先确定该报文的发送周期及其对应的调度队列；然后再判断该调度队列中的报文数量是否不小于针对该调度队列设置的设定数量阈值，并在判断结果为是的情形下，再根据接收到报文时的时间、预设的偏移时间、预设的发送周期时长和预设的发送周期的总个数值，重新计算报文的发送周期，以及从队列编号大于该调度队列的队列编号的调度队列中，选择满足预设条件的调度队列，并将选择出的调度队列确定为重新计算出的发送周期对应的调度队列；最后，在报文为原始数据报文时，将报文封装为SRv6报文，并缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在报文为携带有原始数据报文的SRv6报文、且自身为中转节点时，将报文缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发；在报文为携带有原始数据报文的SRv6报文、且在自身为尾节点时，将报文解封装为原始数据报文后缓存到选择出的调度队列中等待到达重新计算出的发送周期时转发。在这种报文处理流程中，该转发设备可以基于报文的发送周期对应的调度队列中的报文缓存情况，灵活调整报文的发送的周期及其对应的调度队列，在一定程度上提高了报文转发率。本申请实施例还提供了一种电子设备，如图5所示，包括处理器51和机器可读存储介质52，所述机器可读存储介质52存储有能够被所述处理器51执行的机器可执行指令，所述处理器51被所述机器可执行指令促使：实现上述报文处理方法的步骤。上述的机器可读存储介质可以包括随机存取存储器，也可以包括非易失性存储器，例如至少一个磁盘存储器。可选的，机器可读存储介质还可以是至少一个位于远离前述处理器的存储装置。上述的处理器可以是通用处理器，包括中央处理器、网络处理器等；还可以是数字信号处理器、专用集成电路、现场可编程门阵列或者其他可编程逻辑器件、分立门或者晶体管逻辑器件、分立硬件组件。在本申请提供的又一实施例中，还提供了一种计算机可读存储介质，该计算机可读存储介质内存储有计算机程序，所述计算机程序被处理器执行时实现上述报文处理方法的步骤。以上所述仅为本申请的较佳实施例而已，并不用以限制本申请，凡在本申请的精神和原则之内，所做的任何修改、等同替换、改进等，均应包含在本申请保护的范围之内。
