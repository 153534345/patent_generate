标题title
一种流量转发方法、装置、设备及存储介质
摘要abst
本申请公开了一种流量转发方法、装置、设备及存储介质，涉及云计算技术领域，包括：对当前网络中的流量进行识别以确定出大象流，并将所述大象流对应的大象流流表存储至目标芯片的cache内存中；在转发目标大象流之前，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表；基于所述目标大象流流表转发所述目标大象流。本申请通过将识别出的大象流流表存储至目标芯片的cache内存中，当转发目标大象流时，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表，避免访问DDR内存，从而提升流量匹配速率，然后基于所述目标大象流流表转发所述目标大象流，提升了流量转发速率。
权利要求书clms
1.一种流量转发方法，其特征在于，包括：对当前网络中的流量进行识别以确定出大象流，并将所述大象流对应的大象流流表存储至目标芯片的cache内存中；在转发目标大象流之前，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表；基于所述目标大象流流表转发所述目标大象流。2.根据权利要求1所述的流量转发方法，其特征在于，所述对当前网络中的流量进行识别以确定出大象流，包括：构建流量检测模型，并通过所述流量检测模型检测当前网络中的流量以确定出大象流。3.根据权利要求2所述的流量转发方法，其特征在于，所述构建流量检测模型，包括：利用预先确定的AI探测技术探测当前网络中各流量对应的持续时间和流量大小；基于各所述流量对应的所述持续时间和所述流量大小构建相应的流量检测模型。4.根据权利要求2至3任一项所述的流量转发方法，其特征在于，所述通过所述流量检测模型检测当前网络中的流量以确定出大象流之前，还包括：将当前网络中各流量的状态设置为初始态，得到初始态流量；相应地，所述通过所述流量检测模型检测当前网络中的流量以确定出大象流，包括：利用所述流量检测模型对当前网络中的所述初始态流量进行检测，得到满足预设条件的目标初始态流量；基于预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流。5.根据权利要求4所述的流量转发方法，其特征在于，所述基于预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流，包括：实时监测所述目标初始态流量以确定所述目标初始态流量对应的命中情况；基于所述命中情况和预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流。6.根据权利要求5所述的流量转发方法，其特征在于，所述基于所述命中情况和预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流，包括：如果所述目标初始态流量对应的第一命中情况表明所述目标初始态流量长期命中，则基于预设状态转换规则将所述目标初始态流量的状态由初始态转换为中频态，得到中频态流量；判断所述中频态流量对应的第二命中情况是否为长期命中；若所述中频态流量对应的所述第二命中情况为长期命中，则基于所述预设状态转换规则将所述中频态流量的状态由中频态转换为高频态，得到高频态流量，并基于所述流量检测模型将所述高频态流量确定为大象流。7.根据权利要求6所述的流量转发方法，其特征在于，所述基于所述流量检测模型将所述高频态流量确定为大象流之后，还包括：利用所述流量检测模型判断所述大象流是否满足预设条件，若是，则基于所述预设状态转换规则将所述大象流的状态由高频态转换为固化态，得到固化态流量，并将所述固化态流量确定为大象流。8.一种流量转发装置，其特征在于，包括：大象流识别模块，用于对当前网络中的流量进行识别以确定出大象流；流表存储模块，用于将所述大象流对应的大象流流表存储至目标芯片的cache内存中；流表查询模块，用于在转发目标大象流之前，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表；大象流转发模块，用于基于所述目标大象流流表转发所述目标大象流。9.一种电子设备，其特征在于，包括：存储器，用于保存计算机程序；处理器，用于执行所述计算机程序，以实现如权利要求1至7任一项所述的流量转发方法的步骤。10.一种计算机可读存储介质，其特征在于，用于存储计算机程序；其中，所述计算机程序被处理器执行时实现如权利要求1至7任一项所述的流量转发方法的步骤。
说明书desc
技术领域本发明涉及云计算技术领域，特别涉及一种流量转发方法、装置、设备及存储介质。背景技术当前，在云计算领域中的OVS转发主要是利用EMC来缓存流量cache，但是流量的更迭会导致EMC缓存大量更迭，造成cache振荡，而且在实际应用中大象流通常有量级从MB至GB的数据字节，占数据中心总流量总数的80％以上。例如，OpenFlow流表查询到结果后，下发给datapath流表，然后再下发给EMC流表，最后卸载到网卡上，OpenFlow流表卸载到芯片的外挂DDR内存，然后芯片上的流量通过与外挂DDR内存上的流量进行匹配进而转发，这样未充分利用芯片本身的内存，而去访问DDR内存会影响流量匹配速率。发明内容有鉴于此，本发明的目的在于提供一种流量转发方法、装置、设备及存储介质，能够提升流量匹配速率，进而提升流量转发速率。其具体方案如下：第一方面，本申请公开了一种流量转发方法，包括：对当前网络中的流量进行识别以确定出大象流，并将所述大象流对应的大象流流表存储至目标芯片的cache内存中；在转发目标大象流之前，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表；基于所述目标大象流流表转发所述目标大象流。可选的，所述对当前网络中的流量进行识别以确定出大象流，包括：构建流量检测模型，并通过所述流量检测模型检测当前网络中的流量以确定出大象流。可选的，所述构建流量检测模型，包括：利用预先确定的AI探测技术探测当前网络中各流量对应的持续时间和流量大小；基于各所述流量对应的所述持续时间和所述流量大小构建相应的流量检测模型。可选的，所述通过所述流量检测模型检测当前网络中的流量以确定出大象流之前，还包括：将当前网络中各流量的状态设置为初始态，得到初始态流量；相应地，所述通过所述流量检测模型检测当前网络中的流量以确定出大象流，包括：利用所述流量检测模型对当前网络中的所述初始态流量进行检测，得到满足预设条件的目标初始态流量；基于预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流。可选的，所述基于预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流，包括：实时监测所述目标初始态流量以确定所述目标初始态流量对应的命中情况；基于所述命中情况和预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流。可选的，所述基于所述命中情况和预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流，包括：如果所述目标初始态流量对应的第一命中情况表明所述目标初始态流量长期命中，则基于预设状态转换规则将所述目标初始态流量的状态由初始态转换为中频态，得到中频态流量；判断所述中频态流量对应的第二命中情况是否为长期命中；若所述中频态流量对应的所述第二命中情况为长期命中，则基于所述预设状态转换规则将所述中频态流量的状态由中频态转换为高频态，得到高频态流量，并基于所述流量检测模型将所述高频态流量确定为大象流。可选的，所述基于所述流量检测模型将所述高频态流量确定为大象流之后，还包括：利用所述流量检测模型判断所述大象流是否满足预设条件，若是，则基于所述预设状态转换规则将所述大象流的状态由高频态转换为固化态，得到固化态流量，并将所述固化态流量确定为大象流。第二方面，本申请公开了一种流量转发装置，包括：大象流识别模块，用于对当前网络中的流量进行识别以确定出大象流；流表存储模块，用于将所述大象流对应的大象流流表存储至目标芯片的cache内存中；流表查询模块，用于在转发目标大象流之前，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表；大象流转发模块，用于基于所述目标大象流流表转发所述目标大象流。第三方面，本申请公开了一种电子设备，包括：存储器，用于保存计算机程序；处理器，用于执行所述计算机程序，以实现前述公开的流量转发方法的步骤。第四方面，本申请公开了一种计算机可读存储介质，用于存储计算机程序；其中，所述计算机程序被处理器执行时实现前述公开的流量转发方法的步骤。可见，本申请提供了一种流量转发方法，包括：对当前网络中的流量进行识别以确定出大象流，并将所述大象流对应的大象流流表存储至目标芯片的cache内存中；在转发目标大象流之前，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表；基于所述目标大象流流表转发所述目标大象流。由此可知，本申请通过将识别出的大象流对应的大象流表存储至目标芯片的cache内存中，当转发目标大象流时，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表，避免访问DDR内存，从而提升流量匹配速率，然后基于所述目标大象流流表转发所述目标大象流，提升了流量转发速率。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据提供的附图获得其他的附图。图1为本申请公开的一种流量转发方法流程图；图2为本申请公开的一种流量匹配流程图；图3为本申请公开的一种具体的流量转发方法流程图；图4为本申请公开的一种二维逻辑回归的拟合直线示意图；图5为本申请公开的一种流量转发装置结构示意图；图6为本申请公开的一种电子设备结构图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。当前，大象流在数据中心中占据总流量的很大比例，由于网络带宽是有限，需要将流量转发出去，释放网络带宽，在流量转发的过程中，需要访问DDR内存查找流表，没有充分利用芯片本身的内存，去访问DDR内存比较影响匹配速率，从而影响转发速率。为此，本申请提供了一种流量转发方案，能够提升流量匹配速率，进而提升流量转发速率。本发明实施例公开了一种流量转发方法，参见图1所示，该方法包括：步骤S11：对当前网络中的流量进行识别以确定出大象流，并将所述大象流对应的大象流流表存储至目标芯片的cache内存中。本实施例中，对当前网络中的流量进行识别以确定出大象流，然后将该大象流对应的大象流流表存储至目标芯片的cache内存中，也就是说，识别当前网络中的流量，从而找出大象流，然后将大象流对应的大象流表单独存储至芯片内存中，其余流量对应的流表继续存放至DDR内存上，进而在转发流量的时候能够提升流量匹配速率。步骤S12：在转发目标大象流之前，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表。本实施例中，在转发目标大象流之前，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表。可以理解的是，在转发目标大象流之前，可以直接访问目标芯片的所述cache内存，从该cache内存中查询与所述目标大象流对应的目标大象流流表，避免访问DDR内存，从而提升流量匹配速率，转发非大象流时，即老鼠流，则可以访问DDR内存查询与老鼠流对应的老鼠流流表。步骤S13：基于所述目标大象流流表转发所述目标大象流。本实施例中，查询到目标大象流对应的流表，从而基于所述目标大象流流表将所述目标大象流转发出去。如图2所示，当前网络中的流量来了之后，首先从硬件芯片cache流量中查找流表，如果在硬件芯片中找不到，就去DDR内存中查找，如果在DDR内存中也无法找到，则通过软件先去查EMC流表再去查datapath流表，如果仍然找不到，进而查OpenFlow流表，查到OpenFlow流表后一定可以找到目标流表，找到之后，将流表提炼出来，首先在datapath EMC流表下载一份，然后载下在一份给DPDKPMD和芯片保存，这样在转发流量的时候就能够直接在芯片里面找到相应的流表。其中，OVS DATAPATH表示OVS的datapath流表；软件流表存储模块为用于保存卸载OVS datapath流表到硬件流表的缓存流表的存储模块；算法配置模块保证软件读取硬件寄存器信息后，根据硬件的内存信息等计算出软件需要申请的软件流表存储模块所需的内存空间，并计算出所需的hash算法和桶深，并配置到硬件的模块上；流表卸载模块用于卸载软件流表到硬件流表；命令通道模块为基于DMA的为了提升软件和硬件交互大数据量的特殊软硬件通道模块；寄存器通道模块为软件配置和下发逻辑寄存器的通道模块；流表卸载模块为调用命令通道模块卸载软件流表到硬件流表的模块；DDR流表存储模块为用于保存卸载的流表在DDR内存空间的模块；Cache流表存储模块为用于保存大象流流表在芯片自身内存空间的模块。可见，本申请实施例通过将识别出的大象流对应的大象流表存储至目标芯片的cache内存中，当转发目标大象流时，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表，避免访问DDR内存，从而提升流量匹配速率，然后基于所述目标大象流流表转发所述目标大象流，提升了流量转发速率。参见图3所示，本发明实施例公开了一种具体的流量转发方法，相较于上一实施例，本实施例对技术方案作了进一步的说明和优化。步骤S21：构建流量检测模型，并通过所述流量检测模型检测当前网络中的流量以确定出大象流。本实施例中，所述流量检测模型的构建过程可以包括：利用预先确定的AI探测技术探测当前网络中各流量对应的持续时间和流量大小；基于各所述流量对应的所述持续时间和所述流量大小构建相应的流量检测模型。可以理解的是，通过AI探测技术在实际端口中探测各种流量持续时间与流量大小，再基于所述持续时间和所述流量大小建立对应的流量检测模型，进而通过该流量检测模型识别出当前网络中的大象流。例如，在实际网络环境中，依据实际流量大小、持续时间、单位时间内流量占总流量比重建立三维模型。其中，流量检测模型主要利用逻辑回归模型实现流量二分类，从而识别出top k流。例如，最大cache为10K，固化top k流为2k。并且代价损失函数为满足正相关的流量数目最接近2k。如图4所示，所述图4示出了一个二维逻辑回归的最佳拟合直线，满足正相关，直线上方的各种流量数目接近2k。并且可以为各种流量xi加上权重系数w1、w2、…、wi，去满足特定大象流流的快速转发的要求，公式如下：本实施例中，所述通过所述流量检测模型检测当前网络中的流量以确定出大象流之前，还包括：将当前网络中各流量的状态设置为初始态，得到初始态流量。然后利用所述流量检测模型对当前网络中的所述初始态流量进行检测，得到满足预设条件的目标初始态流量；基于预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流。其中，所述基于预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流，具体地，可以包括：实时监测所述目标初始态流量以确定所述目标初始态流量对应的命中情况；基于所述命中情况和预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流。可以理解的是，如果所述目标初始态流量对应的第一命中情况表明所述目标初始态流量长期命中，则基于预设状态转换规则将所述目标初始态流量的状态由初始态转换为中频态，得到中频态流量；判断所述中频态流量对应的第二命中情况是否为长期命中；若所述中频态流量对应的所述第二命中情况为长期命中，则基于所述预设状态转换规则将所述中频态流量的状态由中频态转换为高频态，得到高频态流量，并基于所述流量检测模型将所述高频态流量确定为大象流。并且，在所述将所述高频态流量确定为大象流之后，还可以包括：利用所述流量检测模型判断所述大象流是否满足预设条件，若是，则基于所述预设状态转换规则将所述大象流的状态由高频态转换为固化态，得到固化态流量，并将所述固化态流量确定为大象流。也就是说，将流量cache中的大象流由初始态转化成高频态，然后将高频使用的流量cache由初始态转化为中频态。其中，更新cache方式可以为：如果大象流cache长期未命中则将其降级为高频态；如果高频态流量长期未命中则将其降级为中频态；如果中频态流量长期未命中则将其降级为初始态；初始态流量长期未命中则将其正常老化；如果初始态流量长期命中则将其升级为中频态；中频态流量长期命中则将其升级为高频态；大象流长期命中且持续时间很长很稳定，则将其升级为固化态。然后将高频态流量和固化态流量对应的流表均写入芯片自身内存中，根据需要仅更新高频流流表，从而减少cache振荡，也就是说，通过状态转移的方式能够减少cache miss率，提升cache命中率，并降低cache振荡。其中，通过记录流量的持续性和流量大小，进而确定流量的状态，这样能够防止突发流量被误判为大象流，例如，如果记录到当前流量的流量大小是满足状态为高频态对应的预设流量大小条件，并且，当前流量的持续时间也满足高频态对应的预设持续时间条件，则将当前流量的状态确定为高频态。步骤S22：将所述大象流对应的大象流流表存储至目标芯片的cache内存中。步骤S23：在转发目标大象流之前，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表。步骤S24：基于所述目标大象流流表转发所述目标大象流。关于上述步骤S22至步骤S24的具体内容可以参考前述实施例中公开的相应内容，在此不再进行赘述。可见，本申请实施例通过AI预测与建模的方式识别出的大象流，并将大象流流表对应的大象流表固化至目标芯片的cache内存中，然后通过状态转移的方式减少cachemiss率，提升cache命中率，并降低了cache振荡。当转发目标大象流时，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表，避免访问DDR内存，从而提升流量匹配速率，然后基于所述目标大象流流表转发所述目标大象流，提升了流量转发速率。相应的，本申请实施例还公开了一种流量转发装置，参见图5所示，该装置包括：大象流识别模块11，用于对当前网络中的流量进行识别以确定出大象流；流表存储模块12，用于将所述大象流对应的大象流流表存储至目标芯片的cache内存中；流表查询模块13，用于在转发目标大象流之前，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表；大象流转发模块14，用于基于所述目标大象流流表转发所述目标大象流。由上可见，本申请实施例通过将识别出的大象流对应的大象流表存储至目标芯片的cache内存中，当转发目标大象流时，从所述目标芯片的所述cache内存中查询与所述目标大象流对应的目标大象流流表，避免访问DDR内存，从而提升流量匹配速率，然后基于所述目标大象流流表转发所述目标大象流，提升了流量转发速率。在一些具体的实施例中，所述大象流识别模块11，具体可以包括：第一检测模型构建单元，用于构建流量检测模型；第一流量检测单元，用于通过所述流量检测模型检测当前网络中的流量以确定出大象流。在一些具体的实施例中，所述检测模型构建单元，具体可以包括：流量探测单元，用于利用预先确定的AI探测技术探测当前网络中各流量对应的持续时间和流量大小；第二检测模型构建单元，用于基于各所述流量对应的所述持续时间和所述流量大小构建相应的流量检测模型。在一些具体的实施例中，所述流量转发装置，具体还可以包括：状态设置模块，用于将当前网络中各流量的状态设置为初始态，得到初始态流量。在一些具体的实施例中，所述流量检测单元，具体可以包括：第二流量检测单元，用于利用所述流量检测模型对当前网络中的所述初始态流量进行检测，得到满足预设条件的目标初始态流量；第一状态转换单元，用于基于预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流。在一些具体的实施例中，所述第一状态转换单元，具体可以包括：流量监测单元，用于实时监测所述目标初始态流量以确定所述目标初始态流量对应的命中情况；第二状态转换单元，用于基于所述命中情况和预设状态转换规则对所述目标初始态流量进行状态转换以确定大象流。在一些具体的实施例中，所述第二状态转换单元，具体可以包括：第三状态转换单元，用于当所述目标初始态流量对应的第一命中情况表明所述目标初始态流量长期命中，则基于预设状态转换规则将所述目标初始态流量的状态由初始态转换为中频态，得到中频态流量；第一判断单元，用于判断所述中频态流量对应的第二命中情况是否为长期命中；第四状态转换单元，用于当所述中频态流量对应的所述第二命中情况为长期命中，则基于所述预设状态转换规则将所述中频态流量的状态由中频态转换为高频态，得到高频态流量，并基于所述流量检测模型将所述高频态流量确定为大象流。在一些具体的实施例中，所述第二状态转换单元，具体还可以包括：第二判断单元，用于利用所述流量检测模型判断所述大象流是否满足预设条件；第四状态转换单元，用于当所述大象流满足预设条件时，则基于所述预设状态转换规则将所述大象流的状态由高频态转换为固化态，得到固化态流量，并将所述固化态流量确定为大象流。进一步的，本申请实施例还提供了一种电子设备。图6是根据一示例性实施例示出的电子设备20结构图，图中的内容不能认为是对本申请的使用范围的任何限制。图6为本申请实施例提供的一种电子设备20的结构示意图。该电子设备20，具体可以包括：至少一个处理器21、至少一个存储器22、电源23、通信接口24、输入输出接口25和通信总线26。其中，所述存储器22用于存储计算机程序，所述计算机程序由所述处理器21加载并执行，以实现前述任一实施例公开的流量转发方法中的相关步骤。另外，本实施例中的电子设备20具体可以为电子计算机。本实施例中，电源23用于为电子设备20上的各硬件设备提供工作电压；通信接口24能够为电子设备20创建与外界设备之间的数据传输通道，其所遵循的通信协议是能够适用于本申请技术方案的任意通信协议，在此不对其进行具体限定；输入输出接口25，用于获取外界输入数据或向外界输出数据，其具体的接口类型可以根据具体应用需要进行选取，在此不进行具体限定。另外，存储器22作为资源存储的载体，可以是只读存储器、随机存储器、磁盘或者光盘等，其上所存储的资源可以包括操作系统221、计算机程序222等，存储方式可以是短暂存储或者永久存储。其中，操作系统221用于管理与控制电子设备20上的各硬件设备以及计算机程序222，其可以是Windows Server、Netware、Unix、Linux等。计算机程序222除了包括能够用于完成前述任一实施例公开的由电子设备20执行的流量转发方法的计算机程序之外，还可以进一步包括能够用于完成其他特定工作的计算机程序。进一步的，本申请实施例还公开了一种计算机可读存储介质，所述计算机可读存储介质中存储有计算机程序，所述计算机程序被处理器加载并执行时，实现前述任一实施例公开的流量转发方法步骤。本说明书中各个实施例采用递进的方式描述，每个实施例重点说明的都是与其它实施例的不同之处，各个实施例之间相同或相似部分互相参见即可。对于实施例公开的装置而言，由于其与实施例公开的方法相对应，所以描述的比较简单，相关之处参见方法部分说明即可。最后，还需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括所述要素的过程、方法、物品或者设备中还存在另外的相同要素。以上对本发明所提供的一种流量转发方法、装置、设备及存储介质进行了详细介绍，本文中应用了具体个例对本发明的原理及实施方式进行了阐述，以上实施例的说明只是用于帮助理解本发明的方法及其核心思想；同时，对于本领域的一般技术人员，依据本发明的思想，在具体实施方式及应用范围上均会有改变之处，综上所述，本说明书内容不应理解为对本发明的限制。
