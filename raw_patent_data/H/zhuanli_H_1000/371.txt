标题title
一种平滑过渡视频掩膜快速生成方法
摘要abst
本发明公开了一种平滑过渡视频掩膜快速生成方法，所述方法包括以下步骤：步骤1、勾画参考掩膜；步骤2、确定量化控制点参考掩膜；步骤3：生成平滑过渡掩膜。本发明所述方法，能够根据前后两个相邻参考掩膜，无条件限制快速生成平滑过渡掩膜，计算方式简便，效率与精度高，实现了掩膜形状渐变不受限，能够让编辑人员在只需提供少量视频掩膜形态的情况下，完成整个时间段的掩膜生成，有效地降低了人力与时间成本，大幅度提高了编辑人员的工作效率。
权利要求书clms
1.一种平滑过渡视频掩膜快速生成方法，其特征在于，所述方法包括以下步骤：步骤1、勾画参考掩膜：在待编辑视频文件上某个时间位置处勾画出待处理的区域即参考掩膜一，移动时间线，在另一个时间位置处勾画出待处理的区域即参考掩膜二，根据需要依次勾画出若干个基于不同时间位置的参考掩膜；步骤2、确定量化控制点参考掩膜：根据用户指定的视频文件任意时间位置，找到已勾画出的在所述指定时间位置前后两个相邻近的参考掩膜，并确定量化控制点参考掩膜；步骤3、生成平滑过渡掩膜：根据量化控制点参考掩膜，确定量化控制点的数量，根据确定的量化控制点的数量将两个参考掩膜分别按各自的等分长度，沿着闭合曲线的走向，计算出闭合曲线上的点，将两个闭合曲线上的点，按照时间距离比例进行点对点的插值，生成新控制点，按顺序将这些新控制点勾画出闭合曲线，所述闭合曲线围成的区域即为过渡掩膜。2.根据权利要求1所述的一种平滑过渡视频掩膜快速生成方法，其特征在于，步骤2中所述确定量化控制点参考掩膜的方式包括两种，分别为：第一种方式：分别对前后两个参考掩膜的周长进行计算，把两者中周长更大的参考掩膜作为量化控制点参考掩膜；第二种方式：分别对前后两个参考掩膜的周长以及区域面积进行计算，然后分别计算前后两个参考掩膜的周长与面积的比值，把两者中周长与面积比值更大的参考掩膜作为量化控制点参考掩膜。3.根据权利要求1所述的一种平滑过渡视频掩膜快速生成方法，其特征在于，步骤3中所述确定量化控制点的数量的具体过程为：根据量化控制点参考掩膜的曲折状态，计算出总曲线长度，并找出最小折线长度，总曲线长度除以最小折线长度，即可计算出控制点数量。
说明书desc
技术领域本发明属于视频编辑技术领域，尤其涉及一种平滑过渡视频掩膜快速生成方法。背景技术随着泛媒体的发展，视频编辑应用越来越广泛，例如在视频剪辑中，需要对视频图像局部颜色校正、人脸美化、被采访人的图像信息保密遮挡等，而如何快速实现这种长时间渐变的视频遮罩掩膜是制约编辑效率的关键。视频遮罩掩膜简称视频掩膜，是指视频画面中闭合曲线圈住的区域，视频掩膜的形状是由多条直线段以及多条贝塞尔曲线围成的一个平滑的区域。在视频编辑过程中，掩膜是随着时间变化的，这是由于编辑人员在不同时间段圈住的形状是不同的。参考掩膜是指用于生成过渡掩膜的起始与终点两个掩膜。过渡掩膜是指根据起始与终点两个参考掩膜，根据距离比例生成的渐变掩膜。掩膜平滑过渡是指在一条视频中，任意两个在不同时间位置的相邻掩膜，实现在该时间段内圈住的形状是由掩膜A逐渐变化到掩膜B平滑转换过去的，不存在突变状态。掩膜形状渐变不受限是指在两个参考掩膜之间生成过渡掩膜，这个生成过程不受两个参考掩膜的参数条件限制，掩膜参数条件是指封闭曲线的控制形态或者其它的曲线控制方式）。在视频剪辑编辑过程中，有时需要对特定的视频区域即视频掩膜进行特殊处理，根据需要处理的方式不同，形状也不一样。而且随着时间进度，视频掩膜会发生位移，形状改变等，因此编辑人员需要在不同时间点改变掩膜形态，前后组成掩膜的闭合曲线参数可能会发生很大改变，例如组成闭合曲线的线段个数不同，位置不同等。生成的掩膜用于二次开发，例如对掩膜区域的人脸进行模糊处理，对掩膜区域的人脸进行美颜，对掩膜区域的天空变蓝等等。编辑人员如果要在每帧图像都绘制掩膜，那么无论是时间成本还是人力成本是非常大的。因此需要实现快速平滑的中间掩膜态，才能解决此类问题。原有的掩膜过渡方式是以掩膜曲线上的线段个数为基础，线段控制点互相对应进行变换的。编辑人员在一个轮廓上为改变形状增加一个或多个控制点时，很难快速生成过渡掩膜。因此如何快速生成过渡掩膜以实现掩膜平滑过渡是本领域亟需解决的技术问题。发明内容本发明的目的在于提供一种平滑过渡视频掩膜快速生成方法，以解决上述技术问题。为实现上述目的，本发明提供如下技术方案：本发明公开一种平滑过渡视频掩膜快速生成方法，所述方法包括以下步骤：步骤1、勾画参考掩膜：在待编辑视频文件上某个时间位置处勾画出待处理的区域即参考掩膜一，移动时间线，在另一个时间位置处勾画出待处理的区域即参考掩膜二，根据需要依次勾画出若干个基于不同时间位置的参考掩膜；步骤2、确定量化控制点参考掩膜：根据用户指定的视频文件任意时间位置，找到已勾画出的在所述指定时间位置前后两个相邻近的参考掩膜，并确定量化控制点参考掩膜；步骤3、生成平滑过渡掩膜：根据量化控制点参考掩膜，确定量化控制点的数量，根据确定的量化控制点的数量将两个参考掩膜分别按各自的等分长度，沿着闭合曲线的走向，计算出闭合曲线上的点，将两个闭合曲线上的点，按照时间距离比例进行点对点的插值，生成新控制点，按顺序将这些新控制点勾画出闭合曲线，所述闭合曲线围成的区域即为过渡掩膜。进一步的是，步骤2中所述确定量化控制点参考掩膜的方式包括两种，分别为：第一种方式：分别对前后两个参考掩膜的周长进行计算，把两者中周长更大的参考掩膜作为量化控制点参考掩膜；第二种方式：分别对前后两个参考掩膜的周长以及区域面积进行计算，然后分别计算前后两个参考掩膜的周长与面积的比值，把两者中周长与面积比值更大的参考掩膜作为量化控制点参考掩膜。进一步的是，步骤3中所述确定量化控制点的数量的具体过程为：根据量化控制点参考掩膜的曲折状态，计算出总曲线长度，并找出最小折线长度，总曲线长度除以最小折线长度，即可计算出控制点数量。本发明的有益效果是：本发明所述的一种平滑过渡视频掩膜快速生成方法，能够根据前后两个相邻参考掩膜，无条件限制快速生成平滑过渡掩膜，计算方式简便，效率与精度高，实现了掩膜形状渐变不受限，能够让编辑人员在只需提供少量视频掩膜形态的情况下，完成整个时间段的掩膜生成，有效地降低了人力与时间成本，大幅度提高了编辑人员的工作效率。下面结合附图及具体实施方式对本发明作进一步详细说明。附图说明图1为本发明所述方法流程图。具体实施方式本发明公开一种平滑过渡视频掩膜快速生成方法，如图1所示，所述方法包括以下步骤：步骤1、勾画参考掩膜：将待编辑视频文件放在非编故事板上，在视频文件上某个时间位置处用鼠标勾画出待处理的区域即参考掩膜一，移动时间线，在另一个时间位置处用鼠标勾画出待处理的区域即参考掩膜二，根据需要依次可以勾画出若干个基于不同时间位置的参考掩膜。步骤2、确定量化控制点参考掩膜：根据用户指定的视频文件任意时间位置，找到已勾画出的在所述指定时间位置前后两个相邻近的参考掩膜，并确定量化控制点参考掩膜。所述确定量化控制点参考掩膜的方式包括两种，分别为：第一种方式：分别对前后两个参考掩膜的周长进行计算，把两者中周长更大的参考掩膜作为量化控制点参考掩膜；第二种方式：分别对前后两个参考掩膜的周长以及围绕区域面积进行计算，然后分别计算前后两个参考掩膜的周长与面积比值，周长与面积比值越大，代表曲线复杂度以及曲率变化越大，把两者中周长与面积比值更大的参考掩膜作为量化控制点参考掩膜。以上两种方式的目的在于确定过渡掩膜的量化控制点个数，量化控制点的个数越多，精度越高，但速度变慢；生成控制点的数量太少，又不能满足封闭曲线的光滑与形态的精确性，因此需要确定合适的量化控制点数量。步骤3、生成平滑过渡掩膜：根据量化控制点参考掩膜，确定量化控制点的数量，根据确定的量化控制点的数量将两个参考掩膜分别按各自的等分长度，沿着闭合曲线的走向，计算出闭合曲线上的点，将两个闭合曲线上的点，按照时间距离比例进行点对点的插值，生成新控制点，按顺序将这些插值出来的新控制点勾画出闭合曲线，所述闭合曲线围成的区域即为过渡掩膜。所述确定量化控制点的数量的具体过程为：根据量化控制点参考掩膜的曲折状态，计算出总曲线长度，并找出最小折线长度，总曲线长度除以最小折线长度，即可计算出控制点数量。对于封闭曲线，首先用多边形近似出封闭曲线，多边形的生成方式是：首先在封闭曲线上，划分出间距为一个像素点的密集线段，然后将这些密集线段简化为近似稀疏的线段，即将多个近似在一条直线的多个相邻线段整合为一个大直线段，这样即可生成一个由少数线段构成的多边形，从中找出这个多边形最短的线段即为曲线的最小折线。根据上述步骤，可以在视频编辑的任意时间位置生成新的过渡掩膜，用于二次渲染等，从而实现视频掩膜平滑过渡，并且生成过程不受两个参考掩膜的参数条件限制，即实现了掩膜形状渐变不受限。最后应说明的是，以上所述仅用以说明本发明的技术方案而非限制，尽管参照较佳布置方案对本发明进行了详细说明，本领域的普通技术人员应当理解，可以对本发明的技术方案进行修改或者等同替换，而不脱离本发明技术方案的精神和范围。
