标题title
一种5G卫星通信地面终端业务报文传输方法
摘要abst
本发明公开了一种5G卫星通信地面终端业务报文传输方法，属于卫星通信领域，本发明中，接收方向的用户业务报文通过5G卫星通信地面终端的有线业务网口和无线WiFi送入地面终端交换芯片，交换芯片传输至协处理FPGA进行预处理后，通过以太网发送至基带处理单元与核心网进行交互；发送方向的用户业务报文由核心网发送至终端基带处理单元后，经过以太网传输至协处理FPGA预处理后，通过交换芯片转发给对应归属用户，本发明通过在协处理FPGA进行报文预处理，解决了基带处理单元发送方向业务报文无法区分归属用户的问题；同时释放了5G卫星地面终端基带处理单元处理业务报文的资源占用，解决了基带处理单元CPU资源紧张的问题。
权利要求书clms
1.一种5G卫星通信地面终端业务报文传输方法，其特征在于，采用协处理FPGA预处理的方式：在接收方向，将用户业务报文在5G卫星通信地面终端协处理FPGA中进行预处理后，再经过5G卫星通信地面终端基带处理单元与核心网交互；在发送方向，核心网返回的用户业务报文在5G卫星通信地面终端协处理FPGA中进行预处理后，交换芯片通过识别MAC地址，将用户业务报文传输给归属用户。2.根据权利要求1所述的一种5G卫星通信地面终端业务报文传输方法，其特征在于：用户业务报文接收/发送方向协处理FPGA的预处理包括以下步骤：接收方向：S1、判断当前业务报文是否处理完成，若当前业务报文处理完成，则将用户业务报文送入报文类型识别模块，若未处理完成，则先将用户业务报文进行缓存；S2、报文类型识别模块根据IP报文头协议字段来区分用户业务报文类型；S3、端口号分配维护模块将用户业务报文源端口号替换成归属指示端口号，并将分配的归属指示端口号、对应源MAC地址和替换前的源端口号对应存入内容查找表；S4、报文校验更新模块将重新计算并更新修改源端口号后的用户业务报文的校验值，完成后将当前报文处理完成标志发送给报文缓存模块；发送方向：S1、判断当前业务报文是否处理完成，若当前业务报文处理完成，则将用户业务报文送入报文类型识别模块，若未处理完成，则先将用户业务报文进行缓存；S2、报文类型识别模块根据IP报文头协议字段来区分用户业务报文类型；S3、MAC地址查询还原模块根据用户业务报文的目的端口号，通过内容查表的方式，查找当前用户业务报文接收时的源MAC地址，并且填入当前报文的目的MAC地址；S4、报文校验更新模块将重新计算并更新修改目的MAC地址后的用户业务报文的校验值，完成后将当前报文处理完成标志发送给报文缓存模块。3.根据权利要求2所述的一种5G卫星通信地面终端业务报文传输方法，其特征在于：端口号分配维护模块，具有学习及自主维护归属指示端口号池的能力；端口号分配维护模块会先判断当前处理的用户业务报文是否已经分配归属指示端口号，归属指示端口号为5G卫星通信地面终端中协处理FPGA为用户业务报文分配的端口号，与接收方向用户业务报文的源MAC地址一一对应，用于识别用户业务报文的归属用户设备的MAC地址。4.根据权利要求3所述的一种5G卫星通信地面终端业务报文传输方法，其特征在于：若对应源MAC地址的用户业务报文已经分配归属指示端口号，则会将已分配归属指示端口号替换至用户业务报文的源端口号字段；若对应MAC地址的用户业务报文未分配归属指示端口号，协处理FPGA则会分配新的归属指示端口号来更换用户业务报文的源端口号字段，并且将分配的归属指示端口号和对应的源MAC地址存入协处理FPGA内容查找表中。5.根据权利要求4所述的一种5G卫星通信地面终端业务报文传输方法，其特征在于：根据源MAC地址识别，已经分配的归属指示端口号的用户设备，如果超过归属指示端口号保留时间未连接终端，则将这个归属指示端口号释放给其他用户设备使用，端口保留时间能够通过配置协处理FPGA寄存器来修改。6.根据权利要求5所述的一种5G卫星通信地面终端业务报文传输方法，其特征在于：端口号分配维护模块具有端口号溢出保护机制，归属指示端口号保留时间内，若归属指示端口号已经全部分配，没有余量，终端将会对清除所有已分配的归属指示端口号和对应源MAC地址缓存，全部重新分配以保证终端正常运行。7.根据权利要求2所述的一种5G卫星通信地面终端业务报文传输方法，其特征在于：协处理FPGA能够兼容TCP/UDP报文，报文类型识别模块能够进行TCP/UDP协议识别并将识别结果传输给报文校验更新模块。8.根据权利要求7所述的一种5G卫星通信地面终端业务报文传输方法，其特征在于：报文校验更新模块通过报文识别模块的Flag标记判断当前处理的用户业务报文类型。9.根据权利要求8所述的一种5G卫星通信地面终端业务报文传输方法，其特征在于：当报文类型为TCP时，报文校验更新模块的计算方法包括：S1、取伪首部数据，合并为16位一组相加；S2、取TCP数据，将校验和部分置为00 00后，合并16位一组相加；S3、将伪首部和TCP数据相加结果相加，得到TCP数据报文校验和；S4、重新计算二层报文，尾部FCS校验。10.根据权利要求8所述的一种5G卫星通信地面终端业务报文传输方法，其特征在于：当报文类型为UDP时，报文校验更新模块的计算方法包括：S1、取伪首部数据，合并为16位一组相加；S2、取UDP头部和数据部分，将校验和部分置为00 00后，合并16位一组相加；S3、将伪首部和UDP数据相加结果相加；S4、用0xFFFF减去S3高16位和低16位相加的结果，得到UDP校验和；S5、重新计算二层报文，尾部FCS校验。
说明书desc
技术领域本发明涉及卫星通信技术领域，尤其涉及一种5G卫星通信地面终端业务报文传输方法。背景技术随着我国社会经济和科学技术的飞速发展，使得现有卫星通信领域已经取得了一定的成效。在我国，卫星互联网早已被纳入了基建的统筹范围内，为国家的通信事业做出了巨大的贡献。国家和相关部门对卫星通信网络给予了高度的重视，这使得我国的卫星网络发展成为了现代人们关注的重要焦点。目前，卫星通信在军事、应急救援、海事以及民生等各领域发挥了重要作用。但由于卫星通讯网络出现的时间不长，相关的技术尚且没有发展完善，在实践过程当中依然存在着许多的问题。对于5G卫星通信地面终端来说，目前卫星通信大带宽的数据量处理以及卫星轨道变换、波束切换、星历计算、加解密数据处理等相关算法，需要满足相当严格的数据处理性能要求，因此消耗了基带处理单元BBU相当多的CPU资源，使得基带处理单元BBU的设计迎来较大的挑战，同时大大增加了卫星地面终端的设计成本。除此以外，5G卫星通信地面终端侧挂载了大量用户，如何保证实时正确的传输用户业务数据成为一个十分重要的课题。综上所述，如何在满足5G卫星通信地面终端用户业务数据传输要求的前提下，降低基带处理单元BBU的CPU资源消耗，从而降低卫星地面终端成本是一项十分重要的研究。发明内容针对上述卫星通信地面终端基带处理单元CPU资源紧张、用户业务报文处理困难等问题，本发明提出一种5G卫星地面终端业务报文传输方法，通过在协处理FPGA进行报文预处理，解决发送方向业务报文无法区分归属用户的问题；同时释放5G卫星地面终端基带处理单元处理业务报文的资源占用，解决基带处理单元CPU资源紧张的问题。为了解决上述问题，本发明采用协处理FPGA预处理的方式，接收方向的用户业务报文通过5G卫星通信地面终端的有线业务网口和无线WiFi送入地面终端交换芯片，交换芯片传输至协处理FPGA进行预处理后，通过以太网发送至基带处理单元与核心网进行交互；发送方向的用户业务报文由核心网发送至终端基带处理单元后，经过以太网传输至协处理FPGA预处理后，通过交换芯片转发给对应归属用户。本发明中，用户业务报文接收方向协处理FPGA的预处理包括以下步骤：S1、判断当前业务报文是否处理完成，若当前业务报文处理完成，则将用户业务报文送入报文类型识别模块，若未处理完成，则先将用户业务报文进行缓存；S2、报文类型识别模块根据IP报文头协议字段来区分用户业务报文类型；S3、端口号分配维护模块将用户业务报文源端口号替换成归属指示端口号，并将分配的归属指示端口号、对应源MAC地址和原端口号存入内容查找表；S4、报文校验更新模块将重新计算并更新修改源端口号后的用户业务报文的校验值，完成后将当前报文处理完成标志发送给报文缓存模块。用户业务报文发送方向协处理FPGA的预处理包括以下步骤：S1、判断当前业务报文是否处理完成，若当前业务报文处理完成，则将用户业务报文送入报文类型识别模块，若未处理完成，则先将用户业务报文进行缓存；S2、报文类型识别模块根据IP报文头协议字段来区分用户业务报文类型；S3、MAC地址查询还原模块根据用户业务报文的目的端口号，通过内容查表的方式，查找当前用户业务报文接收时的源MAC地址，并且填入当前报文的目的MAC地址；S4、报文校验更新模块将重新计算并更新修改目的MAC地址后用户业务报文的校验值，完成后将当前报文处理完成标志发送给报文缓存模块。本发明中报文缓存模块，在FPGA通过先进先出队列实现，确保报文处理不会乱序，当前报文处理完成的指示则由报文校验更新模块提供。本发明中报文类型识别模块主要进行TCP/UDP协议识别。本方法中协处理FPGA的设计兼容TCP/UDP报文，但是这两种协议的报文头有所区别，在后续计算校验时，不同的报文类型需要区分计算方法；因此，报文类型识别模块，会将当前正在处理报文的类型传输给报文校验更新模块。本发明中端口号分配维护模块，具有学习及自主维护归属指示端口号池的能力。分配维护模块会先判断当前处理的用户业务报文是否已经分配归属指示端口号。若对应源MAC地址的用户业务报文已经分配归属指示端口号，则会将已分配归属指示端口号替换至用户业务报文的源端口号字段；若对应MAC地址的用户业务报文未分配归属指示端口号，协处理FPGA则会分配新的归属指示端口号来更换用户业务报文的源端口号字段，并且将分配的归属指示端口号Port和对应的源MAC地址存入协处理FPGA{归属指示端口号Port，源MAC地址}内容查找表中。当然由于报文类型的不同，源端口号在报文中的位置也有所区别，本模块针对不同类型用户业务报文，处理上具有相应适配。根据源MAC地址识别，已经分配的归属指示端口号Port的用户设备，如果超过归属指示端口号保留时间Ts未连接终端，则将这个归属指示端口号Port释放给其他用户设备使用。端口保留时间Ts 可以通过配置协处理FPGA寄存器来修改。另外，端口号分配维护模块具有端口号溢出保护机制，归属指示端口号保留时间Ts 内，若归属指示端口号Port已经全部分配，没有余量，终端将会对清除所有已分配的归属指示端口号Port和对应源MAC地址缓存，全部重新分配以保证终端正常运行。本发明中MAC地址查询还原模块会根据端口号分配维护模块维护的{归属指示端口号Port，源MAC地址}内容查找表，根据当前处理报文的目的端口号查询对应的源MAC地址后，将查询到的源MAC地址替换当前报文的目的MAC地址。每个设备单一网口的MAC地址具有唯一性，因此交换芯片便可以根据目的MAC地址来分配发送方向的用户业务报文的归属。报文校验更新模块通过报文识别模块的Flag标记判断当前处理的用户业务报文类型。当报文类型为TCP时，计算方法如下：S1、取伪首部数据，合并为16位一组相加；S2、取TCP数据，将校验和部分置为00 00后，合并16位一组相加；S3、将伪首部和TCP数据相加结果相加，得到TCP数据报文校验和；S4、重新计算二层报文，尾部FCS校验。当报文类型为UDP时，计算方法如下：S1、取伪首部数据，合并为16位一组相加；S2、取UDP头部和数据部分，将校验和部分置为00 00后，合并16位一组相加；S3、将S1和S2结果相加；S4、用0xFFFF减去S3高16位和低16位相加的结果，得到UDP校验和；S5、重新计算二层报文，尾部FCS校验。与现有技术相比，本发明具有以下优点：1、本发明通过协处理FPGA预处理用户业务报文的方式，大大减少了业务报文归属分配对基带处理单元BBU的CPU资源消耗，很好地降低卫星地面终端基带处理单元BBU的成本；2、本发明端口号分配维护模块的归属端口号分配机制十分灵活，可以根据不同使用场景的用户数量，调整终端归属端口号池的大小，以节省协处理FPGA逻辑资源。附图说明图1为本发明中5G卫星通信地面终端的结构框图。图2为本发明中协处理FPGA的功能框图。图3为本发明中协处理FPGA用户业务报文接收/发送方向的处理流程图。图4为本实施例中5G卫星通信地面终端的结构连接关系示意图。具体实施方式为了便于本领域技术人员理解，下面结合具体实施方式和说明书附图对本发明作进一步说明。如图1和图4所示，本实施例中5G卫星通信地面终端，包括基带处理单元、协处理FPGA以及交换芯片。所述基带处理单元主要与核心网进行交互；所述协处理FPGA主要负责对用户业务报文进行预处理；所述交换芯片负责进行有线业务网口、无线WiFi、协处理FPGA网口之间业务报文的交换。5G卫星地面终端中基带处理单元、协处理FPGA通过万兆网口连接；协处理FPGA、有线业务网口、无线WiFi模组都经过千兆网口连接在交换芯片上。本实施例将通过有线业务网口连接5G卫星通信地面终端的用户定义为有线用户M，通过无线WiFi连接5G卫星通信地面终端的用户定义为有线用户N。M含义为表示有线用户编号的正整数，N含义为表示无线用户编号的正整数。如图2所示，本实施例将核心网到5G卫星通信地面终端，再到用户侧的业务报文流向定义为发送方向；将用户侧到5G卫星通信地面终端，再到核心网的业务报文流向定义为接收方向。现有技术中，发送方向业务报文无法区分归属用户的问题原因在于，接收方向用户业务报文从协处理FPGA进入基带处理单元后，发送至核心网时，源MAC地址都变成了基带处理单元的源MAC地址，各用户的源MAC地址失效。这导致核心网返回的报文目的MAC地址为基带处理单元，源MAC地址为核心网MAC地址。当基带处理单元在发送方向将用户业务报文传输至协处理FPGA时，目的MAC地址只能选择协处理FPGA的MAC地址，下发至协处理FPGA后，交换芯片无法通过MAC地址来区分报文归属用户。为了解决上述问题，本实施例采用协处理FPGA预处理的方式，将用户业务报文在传输至终端基带处理单元之前进行处理后再送至基带处理单元与核心网交互；核心网返回的用户业务报文，基带处理单元发送至协处理FPGA预处理后，再传输给交换芯片转发至对应归属用户。如图3所示，其中，用户业务报文接收方向协处理FPGA的预处理包括以下步骤：S1、判断当前业务报文是否处理完成，若当前业务报文处理完成，则将用户业务报文送入报文类型识别模块，若未处理完成，则先将用户业务报文进行缓存；S2、报文类型识别模块根据IP报文头协议字段来区分用户业务报文类型；S3、端口号分配维护模块将用户业务报文源端口号替换成归属指示端口号，并将分配的归属指示端口号、对应源MAC地址和原端口号存入内容查找表；S4、报文校验更新模块将重新计算并更新修改源端口号后的用户业务报文的校验值，完成后将当前报文处理完成标志发送给报文缓存模块。用户业务报文发送方向协处理FPGA的预处理包括以下步骤：S1、判断当前业务报文是否处理完成，若当前业务报文处理完成，则将用户业务报文送入报文类型识别模块，若未处理完成，则先将用户业务报文进行缓存；S2、报文类型识别模块根据IP报文头协议字段来区分用户业务报文类型；S3、MAC地址查询还原模块根据用户业务报文的目的端口号，通过内容查表的方式，查找当前用户业务报文接收时的源MAC地址，并且填入当前报文的目的MAC地址；S4、报文校验更新模块将重新计算并更新修改目的MAC地址后用户业务报文的校验值，完成后将当前报文处理完成标志发送给报文缓存模块。本实施例中的报文类型识别模块在协处理FPGA实现时，可以利用IP报文头中的协议字段进行区别。字段值为6表示该报文为TCP报文；字段值为17表示该报文为UDP报文。报文类型识别模块判断完成后，可以生成一个flag指示信号传递给报文校验更新模块。本实施例中端口号分配维护模块，具有学习及自主维护归属指示端口号池的能力。分配维护模块会先判断当前处理的用户业务报文是否已经分配归属指示端口号Port。归属指示端口号Port为5G卫星通信地面终端中协处理FPGA为用户业务报文分配的端口号，与接收方向用户业务报文的源MAC地址一一对应，用于识别用户业务报文的归属用户设备的MAC地址。x的范围取决于实际用户数量，x的大小需要大于M+N的和。本实施例中端口号分配维护模块，在协处理FPGA实现时可以通过遍历已有的{归属指示端口号Port，源MAC地址}内容查找表判断当前处理的用户业务报文是否已经分配归属指示端口号Port。若对应源MAC地址的用户业务报文已经分配归属指示端口号Port，则会将已分配归属指示端口号Port替换至用户业务报文的源端口号字段；若对应MAC地址的用户业务报文未分配归属指示端口号Port，协处理FPGA则会分配新的归属指示端口号Port来更换用户业务报文的源端口号字段，并且将分配的归属指示端口号Port和对应的源MAC地址存入协处理FPGA{归属指示端口号Port，源MAC地址}内容查找表中。根据源MAC地址识别，已经分配的归属指示端口号Port的用户设备，如果超过归属指示端口号Port保留时间Ts未连接终端，则将这个归属指示端口号Port释放给其他用户设备使用。端口保留时间Ts 可以通过配置协处理FPGA寄存器来修改。在实际应用中，协处理FPGA可选择ARM+PL架构的FPGA，便于实现上述功能。另外，端口号分配维护模块具有端口号溢出保护机制，归属指示端口号Port保留时间Ts 内，若归属指示端口号Port已经全部分配，没有余量，终端将会对清除所有已分配的归属指示端口号Port和对应源MAC地址缓存，全部重新分配以保证终端正常运行。实际应用中，可以通过缓存已满标志，来清除CAM内容查表实现。本实施例中MAC地址查询还原模块会根据端口号分配维护模块维护的{归属指示端口号Port，源MAC地址}内容查找表，根据当前处理报文的目的端口号查询对应的源MAC地址后，将查询到的源MAC地址替换当前报文的目的MAC地址。每个设备单一网口的MAC地址具有唯一性，因此交换芯片便可以根据目的MAC地址来分配发送方向的用户业务报文的归属。报文校验更新模块通过报文识别模块的Flag标记判断当前处理的用户业务报文类型。当报文类型为TCP时，计算方法如下：S1、取伪首部数据，合并为16位一组相加；S2、取TCP数据，将校验和部分置为00 00后，合并16位一组相加；S3、将伪首部和TCP数据相加结果相加，得到TCP数据报文校验和；S4、重新计算二层报文，尾部FCS校验。当报文类型为UDP时，计算方法如下：S1、取伪首部数据，合并为16位一组相加；S2、取UDP头部和数据部分，将校验和部分置为00 00后，合并16位一组相加；S3、将S1和S2结果相加；S4、用0xFFFF减去S3高16位和低16位相加的结果，得到UDP校验和；S5、重新计算二层报文，尾部FCS校验。上述计算均可用协处理FPGA的PL逻辑部分实现。显然，以上述的实施例是本发明一部分实施例，而不是全部实施例。基于发明中的实施例，本领域普通技术人员在没有付出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护范围。
