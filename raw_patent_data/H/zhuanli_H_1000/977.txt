标题title
一种用于纵向联邦XGboost模型训练的梯度聚合方法
摘要abst
本发明公开了一种用于纵向联邦XGboost模型训练的梯度聚合方法。它包括以下步骤：发起方计算出一阶梯度向量g、二阶梯度向量h，将一阶梯度向量g、二阶梯度向量h秘密分享给参与方和计算方；计算方对得到的分片进行同态加密后发送给参与方；参与方基于得到的分片和计算方同态加密后的分片计算出一阶梯度聚合值向量密文、二阶梯度聚合值向量密文；参与方将一阶梯度聚合值向量密文、二阶梯度聚合值向量密文秘密分享给发起方、计算方；计算方对密文分片进行解密，得到对应的明文值并发送给发起方；发起方计算出明文的一阶梯度聚合值向量G、二阶梯度聚合值向量H。本发明在保护各方数据隐私的基础上引入计算方，有效解决了发起方的计算压力。
权利要求书clms
1.一种用于纵向联邦XGboost模型训练的梯度聚合方法，发起方、参与方持有用于训练的交集样本集合，其特征在于，包括以下步骤：S1：发起方根据每个样本的标签值计算出交集样本集合对应的一阶梯度向量g、二阶梯度向量h，将一阶梯度向量g进行秘密分享得到第一分片g1、第二分片g2，将二阶梯度向量h进行秘密分享得到第一分片h1、第二分片h2，将第一分片g1、第一分片h1发送给参与方，将第二分片g2、第二分片h2发送给计算方；S2：计算方对第二分片g2、第二分片h2进行同态加密，得到第二分片密文enc、第二分片密文enc，并发送给参与方；S3：参与方根据第一分片g1、第二分片密文enc计算出一阶梯度聚合值向量密文enc，根据第一分片h1、第二分片密文enc计算出二阶梯度聚合值向量密文enc；S4：参与方将一阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片G2，将二阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片H2，将第一分片enc、第一分片enc发送给计算方，将第二分片G2、第二分片H2发送给发起方；S5：计算方对第一分片enc、第一分片enc进行解密，得到明文的第一分片G1、第一分片H1，并发送给发起方；S6：发起方根据第一分片G1、第二分片G2计算出明文的一阶梯度聚合值向量G，根据第一分片H1、第二分片H2计算出明文的二阶梯度聚合值向量H。2.根据权利要求1所述的一种用于纵向联邦XGboost模型训练的梯度聚合方法，其特征在于，所述步骤S2包括以下步骤：计算方生成公钥pk、私钥sk，使用公钥pk对第二分片g2、第二分片h2进行同态加密，得到第二分片密文enc、第二分片密文enc，并发送给参与方。3.根据权利要求1或2所述的一种用于纵向联邦XGboost模型训练的梯度聚合方法，其特征在于，所述步骤S3包括以下步骤：S31：参与方计算出一阶梯度向量g对应的一阶梯度向量密文enc、二阶梯度向量h对应的二阶梯度向量密文enc，enc=g1+enc，enc=h1+enc；S32：参与方根据一阶梯度向量密文enc计算出一阶梯度聚合值向量密文enc，根据二阶梯度向量密文enc计算出密文的二阶梯度聚合值向量密文enc。4.根据权利要求3所述的一种用于纵向联邦XGboost模型训练的梯度聚合方法，其特征在于，所述步骤S1还包括以下步骤：发起方、参与方对交集样本集合内的样本进行分箱处理，得到m个分箱，m≥2；所述步骤S32包括以下步骤：S321：参与方根据每个分箱内的样本对应的一阶梯度密文值计算出每个分箱对应的一阶梯度聚合值密文，m个分箱对应的一阶梯度聚合值密文组成一阶梯度聚合值向量密文enc；S322：参与方根据每个分箱内的样本对应的二阶梯度密文值计算出每个分箱对应的二阶梯度聚合值密文，m个分箱对应的二阶梯度聚合值密文组成二阶梯度聚合值向量密文enc。5.根据权利要求1所述的一种用于纵向联邦XGboost模型训练的梯度聚合方法，其特征在于，所述步骤S1中将一阶梯度向量g进行秘密分享得到第一分片g1、第二分片g2的方法如下：发起方生成随机数向量rg，随机数向量rg与一阶梯度向量g的维数一致，将随机数向量rg作为第一分片g1，将g-rg作为第二分片g2。6.根据权利要求1所述的一种用于纵向联邦XGboost模型训练的梯度聚合方法，其特征在于，所述步骤S1中将二阶梯度向量h进行秘密分享得到第一分片h1、第二分片h2的方法如下：发起方生成随机数向量rh，随机数向量rh与二阶梯度向量h的维数一致，将随机数向量rh作为第一分片h1，将h-rh作为第二分片h2。7.根据权利要求1所述的一种用于纵向联邦XGboost模型训练的梯度聚合方法，其特征在于，所述步骤S4中将一阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片G2的方法如下：参与方生成随机数向量rG，随机数向量rG与一阶梯度聚合值向量密文enc的维数一致，将随机数向量rG作为明文的第二分片G2，将enc-rG作为密文的第一分片enc。8.根据权利要求1所述的一种用于纵向联邦XGboost模型训练的梯度聚合方法，其特征在于，所述步骤S4中将二阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片H2的方法如下：参与方生成随机数向量rH，随机数向量rH与二阶梯度聚合值向量密文enc的维数一致，将随机数向量rH作为明文的第二分片H2，将enc-rH作为密文的第二分片enc。9.根据权利要求5或6或7或8所述的一种用于纵向联邦XGboost模型训练的梯度聚合方法，其特征在于，所述随机数向量内的随机数不为0。10.根据权利要求1或2所述的用于纵向联邦XGboost模型训练的梯度聚合方法，其特征在于，所述步骤S6包括以下步骤：发起方计算G=G1+G2，H=H1+H2，得到明文的一阶梯度聚合值向量G，明文的二阶梯度聚合值向量H。
说明书desc
技术领域本发明涉及联邦学习技术领域，尤其涉及一种用于纵向联邦XGboost模型训练的梯度聚合方法。背景技术联邦学习的出现很大程度上解决了数据孤岛的问题，而XGBoost是一种基于梯度提升决策树的机器学习算法，其具有高效的实现和计算速度，并具有一定的可解释性，因而成为实际应用中的首选算法之一，联邦XGBoost算法是联邦学习中非常重要的一种算法，使用频率极高。当前的联邦XGBoost算法大都是基于半同态算法来实现隐私保护，而半同态算法对计算资源的需要很高，在某些应用场景中，参与联邦学习的某一方并没有足够的算力支撑，例如：数据使用方只有较少的计算资源，无法承担昂贵的同态加解密计算，而数据持有方的计算资源较充分，因此数据使用方就需要具有充足计算资源的第三方帮助计算，但是这样会使得数据使用方的数据泄露给第三方。发明内容本发明为了解决上述技术问题，提供了一种用于纵向联邦XGboost模型训练的梯度聚合方法，其在保护发起方、参与方数据隐私的基础上引入计算方，有效解决了发起方的计算压力。为了解决上述问题，本发明采用以下技术方案予以实现：本发明的一种用于纵向联邦XGboost模型训练的梯度聚合方法，发起方、参与方持有用于训练的交集样本集合，包括以下步骤：S1：发起方根据每个样本的标签值计算出交集样本集合对应的一阶梯度向量g、二阶梯度向量h，将一阶梯度向量g进行秘密分享得到第一分片g1、第二分片g2，将二阶梯度向量h进行秘密分享得到第一分片h1、第二分片h2，将第一分片g1、第一分片h1发送给参与方，将第二分片g2、第二分片h2发送给计算方；S2：计算方对第二分片g2、第二分片h2进行同态加密，得到第二分片密文enc、第二分片密文enc，并发送给参与方；S3：参与方根据第一分片g1、第二分片密文enc计算出一阶梯度聚合值向量密文enc，根据第一分片h1、第二分片密文enc计算出二阶梯度聚合值向量密文enc；S4：参与方将一阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片G2，将二阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片H2，将第一分片enc、第一分片enc发送给计算方，将第二分片G2、第二分片H2发送给发起方；S5：计算方对第一分片enc、第一分片enc进行解密，得到明文的第一分片G1、第一分片H1，并发送给发起方；S6：发起方根据第一分片G1、第二分片G2计算出明文的一阶梯度聚合值向量G，根据第一分片H1、第二分片H2计算出明文的二阶梯度聚合值向量H。在本方案中，发起方先根据样本的标签值计算出每个样本对应的一阶梯度、二阶梯度，所有样本的一阶梯度构成一阶梯度向量g，所有样本的二阶梯度构成二阶梯度向量h，采用秘密分享算法将一阶梯度向量g、二阶梯度向量h拆分为对应的两个分片，分别发送给参与方和计算方，由计算方对得到的分片进行同态加密后发送给参与方。参与方基于得到的分片和计算方同态加密后的分片计算出一阶梯度聚合值向量密文enc、二阶梯度聚合值向量密文enc，一阶梯度聚合值向量密文enc对应解密后的明文就是一阶梯度聚合值向量G，二阶梯度聚合值向量密文enc 对应解密后的明文就是二阶梯度聚合值向量H。参与方采用秘密分享算法将一阶梯度聚合值向量密文enc、二阶梯度聚合值向量密文enc 分别拆分为对应的一个明文分片和一个密文分片，将明文分片发送给发起方，将密文分片发送给计算方，计算方对密文分片进行解密，得到对应的明文值并发送给发起方，发起方计算出明文的一阶梯度聚合值向量G、二阶梯度聚合值向量H。由于发起方通过秘密分享的方式将数据发送给参与方、计算方，参与方通过秘密分享的方式将数据发送给发起方、计算方，参与方得到的是同态加密后的数据，所以发起方、参与方的数据都没有泄露，而发起方不用对数据进行同态加解密计算，由计算方进行同态加解密计算，有效解决了发起方的计算压力。作为优选，所述步骤S2包括以下步骤：计算方生成公钥pk、私钥sk，使用公钥pk对第二分片g2、第二分片h2进行同态加密，得到第二分片密文enc、第二分片密文enc，并发送给参与方。作为优选，所述步骤S3包括以下步骤：S31：参与方计算出一阶梯度向量g对应的一阶梯度向量密文enc、二阶梯度向量h对应的二阶梯度向量密文enc，enc=g1+enc，enc=h1+enc；S32：参与方根据一阶梯度向量密文enc计算出一阶梯度聚合值向量密文enc，根据二阶梯度向量密文enc计算出密文的二阶梯度聚合值向量密文enc。作为优选，所述步骤S1还包括以下步骤：发起方、参与方对交集样本集合内的样本进行分箱处理，得到m个分箱，m≥2；所述步骤S32包括以下步骤：S321：参与方根据每个分箱内的样本对应的一阶梯度密文值计算出每个分箱对应的一阶梯度聚合值密文，m个分箱对应的一阶梯度聚合值密文组成一阶梯度聚合值向量密文enc；S322：参与方根据每个分箱内的样本对应的二阶梯度密文值计算出每个分箱对应的二阶梯度聚合值密文，m个分箱对应的二阶梯度聚合值密文组成二阶梯度聚合值向量密文enc。作为优选，所述步骤S1中将一阶梯度向量g进行秘密分享得到第一分片g1、第二分片g2的方法如下：发起方生成随机数向量rg，随机数向量rg与一阶梯度向量g的维数一致，将随机数向量rg作为第一分片g1，将g-rg作为第二分片g2。作为优选，所述步骤S1中将二阶梯度向量h进行秘密分享得到第一分片h1、第二分片h2的方法如下：发起方生成随机数向量rh，随机数向量rh与二阶梯度向量h的维数一致，将随机数向量rh作为第一分片h1，将h-rh作为第二分片h2。作为优选，所述步骤S4中将一阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片G2的方法如下：参与方生成随机数向量rG，随机数向量rG与一阶梯度聚合值向量密文enc的维数一致，将随机数向量rG作为明文的第二分片G2，将enc-rG作为密文的第一分片enc。作为优选，所述步骤S4中将二阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片H2的方法如下：参与方生成随机数向量rH，随机数向量rH与二阶梯度聚合值向量密文enc的维数一致，将随机数向量rH作为明文的第二分片H2，将enc-rH作为密文的第二分片enc。作为优选，所述随机数向量内的随机数不为0。作为优选，所述步骤S6包括以下步骤：发起方计算G=G1+G2，H=H1+H2，得到明文的一阶梯度聚合值向量G，明文的二阶梯度聚合值向量H。本发明的有益效果是：通过将秘密分享与同态加密相结合的方式在保护发起方、参与方数据隐私的基础上引入计算方，避免发起方、参与方数据泄露，有效解决了发起方的计算压力。附图说明图1是实施例的流程图；图2是实施例的数据处理流程示意图。具体实施方式下面通过实施例，并结合附图，对本发明的技术方案作进一步具体的说明。实施例：本实施例的一种用于纵向联邦XGboost模型训练的梯度聚合方法，发起方、参与方持有用于训练的交集样本集合，如图1、图2所示，包括以下步骤：S1：发起方、参与方对交集样本集合内的样本进行分箱处理，得到m个分箱，m≥2；发起方根据交集样本集合中每个样本的的标签值计算出交集样本集合对应的一阶梯度向量g、二阶梯度向量h，将一阶梯度向量g进行秘密分享得到第一分片g1、第二分片g2，g=g1+g2，将二阶梯度向量h进行秘密分享得到第一分片h1、第二分片h2，h=h1+h2，将第一分片g1、第一分片h1发送给参与方，将第二分片g2、第二分片h2发送给计算方；将交集样本集合记为d，d=，g=，h=，g1=，g2=，h1=，h2=；其中，n为交集样本集合中的样本个数，d表示交集样本集合中的第i个样本，g表示d对应的一阶梯度值，h表示d对应的二阶梯度值，g1表示g的第一分片，g2表示g的第二分片，h1表示h的第一分片，h2表示h的第二分片，g=g1+g2，h=h1+h2，1≤i≤n；将一阶梯度向量g进行秘密分享得到第一分片g1、第二分片g2的方法如下：发起方生成随机数向量rg，rg=，随机数向量rg内的随机数不为0，将随机数向量rg作为第一分片g1，将g-rg作为第二分片g2，即g1=rg，g2=g-rg；将二阶梯度向量h进行秘密分享得到第一分片h1、第二分片h2的方法如下：发起方生成随机数向量rh，rh=，随机数向量rh内的随机数不为0，将随机数向量rh作为第一分片h1，将h-rh作为第二分片h2，即h1=rh，h2=h-rh；S2：计算方生成公钥pk、私钥sk，使用公钥pk对第二分片g2、第二分片h2进行同态加密，得到第二分片密文enc、第二分片密文enc，并发送给参与方，其中，enc表示采用公钥pk对数据X进行同态加密得到的密文；S3：参与方计算出一阶梯度向量g对应的一阶梯度向量密文enc、二阶梯度向量h对应的二阶梯度向量密文enc，enc=g1+enc，enc=h1+enc，enc=，enc=，enc)表示一阶梯度值g对应的密文，enc)表示二阶梯度值h对应的密文；参与方采用XGboost算法根据每个分箱内的样本对应的一阶梯度密文值计算出每个分箱对应的一阶梯度聚合值密文，m个分箱对应的一阶梯度聚合值密文组成一阶梯度聚合值向量密文enc，enc=，1≤j≤m，enc)表示第j个分箱对应的一阶梯度聚合值密文；参与方采用XGboost算法根据每个分箱内的样本对应的二阶梯度密文值计算出每个分箱对应的二阶梯度聚合值密文，m个分箱对应的二阶梯度聚合值密文组成二阶梯度聚合值向量密文enc，enc=，1≤j≤m，enc)表示第j个分箱对应的二阶梯度聚合值密文；S4：参与方将一阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片G2，enc=enc+G2，将二阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片H2，enc=enc+H2，将第一分片enc、第一分片enc发送给计算方，将第二分片G2、第二分片H2发送给发起方；将一阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片G2的方法如下：参与方生成随机数向量rG，rG=，随机数向量rG内的随机数不为0，随机数向量rG与一阶梯度聚合值向量密文enc的维数一致，将随机数向量rG作为明文的第二分片G2，将enc-rG作为密文的第一分片enc，即G2=rG，enc=enc-rG；将二阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片H2的方法如下：参与方生成随机数向量rH，rH=，随机数向量rH内的随机数不为0，随机数向量rH与二阶梯度聚合值向量密文enc的维数一致，将随机数向量rH作为明文的第二分片H2，将enc-rH作为密文的第二分片enc，即H2=rH，enc=enc-rH；S5：计算方采用私钥sk对第一分片enc、第一分片enc进行解密，得到明文的第一分片G1、第一分片H1，并发送给发起方；S6：发起方计算G=G1+G2，H=H1+H2，得到明文的一阶梯度聚合值向量G，明文的二阶梯度聚合值向量H。在本方案中，首先，发起方、参与方对交集样本集合内的样本进行分箱处理，得到m个分箱。接着，发起方先根据样本的标签值计算出每个样本对应的一阶梯度、二阶梯度，所有样本的一阶梯度构成一阶梯度向量g，所有样本的二阶梯度构成二阶梯度向量h，采用秘密分享算法将一阶梯度向量g、二阶梯度向量h拆分为对应的两个分片，分别发送给参与方和计算方，由计算方对得到的分片进行同态加密后发送给参与方。参与方基于得到的分片和计算方同态加密后的分片计算出每个分箱对应的一阶梯度聚合值密文、二阶梯度聚合值密文，m个分箱对应的一阶梯度聚合值密文组成一阶梯度聚合值向量密文enc，m个分箱对应的二阶梯度聚合值密文组成二阶梯度聚合值向量密文enc，一阶梯度聚合值向量密文enc对应解密后的明文就是一阶梯度聚合值向量G，二阶梯度聚合值向量密文enc 对应解密后的明文就是二阶梯度聚合值向量H。参与方采用秘密分享算法将一阶梯度聚合值向量密文enc、二阶梯度聚合值向量密文enc 分别拆分为对应的一个明文分片和一个密文分片，将明文分片发送给发起方，将密文分片发送给计算方，计算方对密文分片进行解密，得到对应的明文值并发送给发起方，发起方计算出明文的一阶梯度聚合值向量G、二阶梯度聚合值向量H。由于发起方通过秘密分享的方式将数据发送给参与方、计算方，参与方通过秘密分享的方式将数据发送给发起方、计算方，参与方得到的是同态加密后的数据，所以发起方、参与方的数据都没有泄露，而发起方不用对数据进行同态加解密计算，由计算方进行同态加解密计算，有效解决了发起方的计算压力。举例说明：小型科技公司A与大型科技公司B进行纵向联邦XGboost模型训练的梯度聚合计算，小型科技公司A由于计算资源不足，引入计算方帮助计算，小型科技公司A作为发起方，大型科技公司B作为参与方，发起方、参与方持有用于训练的交集样本集合d，d=，发起方、参与方对交集样本集合内的样本进行分箱处理，得到分箱f1、分箱f2，样本d, d , d属于分箱f1，d , d属于分箱f2。发起方根据每个样本的的标签值计算出对应的一阶梯度向量g、二阶梯度向量h，g=，h=，发起方生成随机数向量rg，rg=，随机数向量rg内的随机数不为0，将一阶梯度向量g进行秘密分享得到第一分片g1、第二分片g2，g1=rg，g2= g-rg=，发起方生成随机数向量rh，rg=，随机数向量rh内的随机数不为0，将二阶梯度向量h进行秘密分享得到第一分片h1、第二分片h2，h1=rh，h2= h-rh=，将第一分片g1、第一分片h1发送给参与方，将第二分片g2、第二分片h2发送给计算方；计算方生成公钥pk、私钥sk，使用公钥pk对第二分片g2、第二分片h2进行同态加密，得到第二分片密文enc、第二分片密文enc，并发送给参与方；参与方计算g1+enc=enc=enc，h1+enc=enc=enc，得到一阶梯度向量g对应的一阶梯度向量密文enc、二阶梯度向量h对应的二阶梯度向量密文enc，其中，enc表示采用公钥pk对数据X进行同态加密得到的密文。参与方采用XGboost算法根据分箱f1内的样本d, d , d对应的一阶梯度密文值enc)、enc)、enc)计算出分箱f1对应的一阶梯度聚合值密文enc)，根据分箱f2内的样本d, d对应的一阶梯度密文值enc)、enc)计算出分箱f2对应的一阶梯度聚合值密文enc)，从而得到一阶梯度聚合值向量密文enc，enc=。参与方采用XGboost算法根据分箱f1内的样本d, d , d对应的二阶梯度密文值enc)、enc)、enc)计算出分箱f1对应的二阶梯度聚合值密文enc)，根据分箱f2内的样本d, d对应的二阶梯度密文值enc)、enc)计算出分箱f2对应的二阶梯度聚合值密文enc)，从而得到二阶梯度聚合值向量密文enc，enc=。参与方生成随机数向量rG，rG=，随机数向量rG内的随机数不为0，将一阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片G2，G2=rG，enc=enc-rG=，参与方生成随机数向量rH，rH=，随机数向量rH内的随机数不为0，将二阶梯度聚合值向量密文enc进行秘密分享得到密文的第一分片enc和明文的第二分片H2，H2=rH，enc=enc-rH=，将第一分片enc、第一分片enc发送给计算方，将第二分片G2、第二分片H2发送给发起方；计算方采用私钥sk对第一分片enc、第一分片enc进行解密，得到明文的第一分片G1、第一分片H1，并发送给发起方，G1=，H1=。发起方计算G1+G2=+==G，H1+H2=+==H，得到明文的一阶梯度聚合值向量G，明文的二阶梯度聚合值向量H。
