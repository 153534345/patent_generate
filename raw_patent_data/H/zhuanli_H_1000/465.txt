标题title
步进式漫游中全景图的切换方法、系统及存储介质
摘要abst
本发明公开了步进式漫游中全景图的切换方法、系统及存储介质，属于步进式全景技术领域，方法包括：设定用户在两个步进式点位之间单次移动的时间为t1，两个步进式点位之间全景图片切换的时间为t2；设定全景图片的原亮度为场景画面的默认亮度，且在默认亮度时点光源的亮度值为k；开启步进检测，监听用户的操作消息；接收指令消息后，同时执行全景图片切换和用户移动，在t2时间内，控制当前步进式点位的点光源的亮度值从k逐渐降低至0，目标步进式点位的点光源的亮度值从0逐渐升高至k；在t1时间内，完成用户从当前步进式点位到目标步进式点位的移动。本发明通过调整全景图片亮度实现画面的切换，方案运行起来简单高效。
权利要求书clms
1.一种步进式漫游中全景图的切换方法，应用于基于图案化光照投影出的步进式虚拟场景中，在所述虚拟场景内，设置多个点光源，所述点光源表面包围有全景图片，通过所述点光源投影所述全景图片形成所述虚拟场景的画面，设置每个所述点光源的位置作为步进式点位，其特征在于，该方法包括以下步骤：设定用户在两个步进式点位之间单次移动的时间为t1，两个步进式点位之间全景图片切换的时间为t2，设置t1和t2的大小为t1＞t2；设定全景图片的原亮度为场景画面的默认亮度，且在所述默认亮度时点光源的亮度值为k，在亮度最低时点光源的亮度值为0，调整所述点光源的亮度值可改变场景画面的亮度；开启步进检测，监听用户的操作消息，所述操作消息为用户输入的从当前步进式点位移动到目标步进式点位的指令消息；接收所述指令消息后，同时执行全景图片切换和用户移动，全景图片切换方法为：在t2时间内，控制当前步进式点位的点光源的亮度值从k逐渐降低至0，目标步进式点位的点光源的亮度值从0逐渐升高至k；用户移动方法为：在t1时间内，完成用户从当前步进式点位到目标步进式点位的移动。2.根据权利要求1所述的步进式漫游中全景图的切换方法，其特征在于，所述设置t1和t2的大小为1.5*t2≤t1≤2.5*t2。3.根据权利要求1所述的步进式漫游中全景图的切换方法，其特征在于，所述点光源的亮度值在t2时间内变动时，亮度值的大小与时间之间呈线性变换。4.根据权利要求1或3所述的步进式漫游中全景图的切换方法，其特征在于，所述全景图片切换中，当前步进式点位的点光源的亮度值和目标步进式点位的点光源的亮度值之和始终为k。5.根据权利要求1所述的步进式漫游中全景图的切换方法，其特征在于，所述用户输入的从当前步进式点位移动到目标步进式点位的指令消息的方法为：用户通过点击场景界面的步进式点位使客户端接收到目标步进式点位的消息作为输入的指令消息，或者用户通过场景界面的移动操作杆朝向步进式点位移动使客户端接收到目标步进式点位的消息作为输入的指令消息。6.一种步进式漫游中全景图的切换的系统，该系统应用于基于图案化光照投影出的步进式虚拟场景中，在所述虚拟场景内，设置多个点光源，所述点光源表面包围有全景图片，通过所述点光源投影所述全景图片形成所述虚拟场景的画面，设置每个所述点光源的位置作为步进式点位，其特征在于，该系统包括：时间设置单元，用于设定用户在两个步进式点位之间单次移动的时间为t1，两个步进式点位之间全景图片切换的时间为t2，设置t1和t2的大小为t1＞t2；亮度设置单元，用于设定全景图片的原亮度为场景画面的默认亮度，且在所述默认亮度时点光源的亮度值为k，在亮度最低时点光源的亮度值为0，调整所述点光源的亮度值可改变场景画面的亮度；步进检测单元，用于开启步进检测，监听用户的操作消息，所述操作消息为用户输入的从当前步进式点位移动到目标步进式点位的指令消息；画面切换单元，用于接收所述指令消息后，同时执行全景图片切换和用户移动，全景图片切换方法为：在t2时间内，控制当前步进式点位的点光源的亮度值从k逐渐降低至0，目标步进式点位的点光源的亮度值从0逐渐升高至k；用户移动方法为：在t1时间内，完成用户从当前步进式点位到目标步进式点位的移动。7.根据权利要求6所述的步进式漫游中全景图的切换的系统，其特征在于，所述时间设置单元中设置t1和t2的大小为1.5*t2≤t1≤2.5*t2。8.根据权利要求6所述的步进式漫游中全景图的切换的系统，其特征在于，所述亮度设置单元中，点光源的亮度值在t2时间内变动时，亮度值的大小与时间之间呈线性变换。9.根据权利要求6或8所述的步进式漫游中全景图的切换的系统，其特征在于，所述画面切换单元的全景图片切换中，当前步进式点位的点光源的亮度值和目标步进式点位的点光源的亮度值之和始终为k。10.一种存储介质，其特征在于，其上存储有计算机程序，在所述计算机程序被处理器执行时，实现如权利要求1-5任一项所述的步进式漫游中全景图的切换方法。
说明书desc
技术领域本发明涉及步进式全景技术领域，特别涉及步进式漫游中全景图的切换方法、系统及存储介质。背景技术步进式全景是一种全景摄影技术，通过拍摄多张图像，然后将它们连接在一起，以呈现出360度全景视角。步进式全景通常通过一定的间隔拍摄多张相邻区域的图像，并使用特殊的软件将这些图像合成为一个连续的全景图。这种技术可以让观看者仿佛置身于拍摄场景当中，获得更加真实和全面的视觉体验。步进式全景广泛应用于旅游景点的展示、房地产营销、虚拟现实等领域。在步进式全景中用户采用跳点的方式实现漫游，通过在场景中预先设置步进式点位，用户处于某一点位时加载该点位的全景图片，走向下一点位时，再重新加载出下一点位的全景图片，通过在不同点位加载全景图片的切换，提供给用户步进式漫游的视觉效果，由于全景画面需要在用户每移动一个点位时切换一次，因此在传统的画面切换方法中，图片之间替换生硬会导致用户感受到全景的割裂感，从而导致视觉感受变差，而且传统的画面切换方法也需要不同的切换全景图片进行投影，这种方式运行操作复杂，也会导致后台资源占用率变高，不利于实际使用。发明内容本发明的目的就在于为了解决上述全景画面切换时视觉效果差，操作复杂资源占用较高的问题提出步进式漫游中全景图的切换方法、系统及存储介质，具有切换画面时，场景变化柔顺，视觉效果好，操作简单高效，不占用较多的资源的优点。第一方面，本发明通过以下技术方案来实现上述目的，一种步进式漫游中全景图的切换方法，应用于基于图案化光照投影出的步进式虚拟场景中，在所述虚拟场景内，设置多个点光源，所述点光源表面包围有全景图片，通过所述点光源投影所述全景图片形成所述虚拟场景的画面，设置每个所述点光源的位置作为步进式点位，该方法包括以下步骤：设定用户在两个步进式点位之间单次移动的时间为t1，两个步进式点位之间全景图片切换的时间为t2，设置t1和t2的大小为t1＞t2；设定全景图片的原亮度为场景画面的默认亮度，且在所述默认亮度时点光源的亮度值为k，在亮度最低时点光源的亮度值为0，调整所述点光源的亮度值可改变场景画面的亮度；开启步进检测，监听用户的操作消息，所述操作消息为用户输入的从当前步进式点位移动到目标步进式点位的指令消息；接收所述指令消息后，同时执行全景图片切换和用户移动，全景图片切换方法为：在t2时间内，控制当前步进式点位的点光源的亮度值从k逐渐降低至0，目标步进式点位的点光源的亮度值从0逐渐升高至k；用户移动方法为：在t1时间内，完成用户从当前步进式点位到目标步进式点位的移动。优选的，所述设置t1和t2的大小为1.5*t2≤t1≤2.5*t2。优选的，所述点光源的亮度值在t2时间内变动时，亮度值的大小与时间之间呈线性变换。优选的，所述全景图片切换中，当前步进式点位的点光源的亮度值和目标步进式点位的点光源的亮度值之和始终为k。优选的，所述用户输入的从当前步进式点位移动到目标步进式点位的指令消息的方法为：用户通过点击场景界面的步进式点位使客户端接收到目标步进式点位的消息作为输入的指令消息，或者用户通过场景界面的移动操作杆朝向步进式点位移动使客户端接收到目标步进式点位的消息作为输入的指令消息。第二方面，本发明通过以下技术方案来实现上述目的，一种步进式漫游中全景图的切换系统，该系统应用于基于图案化光照投影出的步进式虚拟场景中，在所述虚拟场景内，设置多个点光源，所述点光源表面包围有全景图片，通过所述点光源投影所述全景图片形成所述虚拟场景的画面，设置每个所述点光源的位置作为步进式点位，该系统包括：时间设置单元，用于设定用户在两个步进式点位之间单次移动的时间为t1，两个步进式点位之间全景图片切换的时间为t2，设置t1和t2的大小为t1＞t2；亮度设置单元，用于设定全景图片的原亮度为场景画面的默认亮度，且在所述默认亮度时点光源的亮度值为k，在亮度最低时点光源的亮度值为0，调整所述点光源的亮度值可改变场景画面的亮度；步进检测单元，用于开启步进检测，监听用户的操作消息，所述操作消息为用户输入的从当前步进式点位移动到目标步进式点位的指令消息；画面切换单元，用于接收所述指令消息后，同时执行全景图片切换和用户移动，全景图片切换方法为：在t2时间内，控制当前步进式点位的点光源的亮度值从k逐渐降低至0，目标步进式点位的点光源的亮度值从0逐渐升高至k；用户移动方法为：在t1时间内，完成用户从当前步进式点位到目标步进式点位的移动。优选的，所述时间设置单元中设置t1和t2的大小为1.5*t2≤t1≤2.5*t2。优选的，所述亮度设置单元中，点光源的亮度值在t2时间内变动时，亮度值的大小与时间之间呈线性变换。优选的，所述画面切换单元的全景图片切换中，当前步进式点位的点光源的亮度值和目标步进式点位的点光源的亮度值之和始终为k。第三方面，本发明通过以下技术方案来实现上述目的，一种存储介质，其上存储有计算机程序，在所述计算机程序被处理器执行时，实现如第一方面所述的步进式漫游中全景图的切换方法。与现有技术相比，本发明的有益效果是：本发明通过调整前一步进式点位和目标步进式点位的点光源的亮度来实现用户处于不同点位时显示的全景画面，因此在全景画面切换时，只需控制点光源的亮度，就能提供用户漫游的视觉的效果，该方案实施起来简单高效，并且在调整两个步进式点位的点光源的亮度时，亮度值随时间变化呈线性变换，画面的变换也更加丝滑，提供用户视觉上更加柔和丝滑的画面切换效果，在切换过程中，两个点光源的亮度值之和始终等于全景图片的默认亮度，这样在两个全景图片切换时能保证画面的亮度始终维持平稳，视觉效果更佳。附图说明图1为本发明的步进式漫游中全景图的切换方法流程图。图2为本发明的步进式点位的点光源的亮度值的变化示意图。图3为本发明的步进式漫游中全景图的切换系统示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。实施例1在基于图案化光照投影出的步进式虚拟场景中，使用点光源代替球形模型来投影全景图片，从而搭建出虚拟场景，具体的搭建如下：在所述虚拟场景内，设置多个点光源，所述点光源表面包围有全景图片，通过所述点光源投影所述全景图片形成所述虚拟场景的画面，设置每个所述点光源的位置作为步进式点位，这样用户处于任意一个步进式点位的位置上，都能观看到这一步进式点位对应的投影画面。如图1所示，提出了一种步进式漫游中全景图的切换方法，用于针对使用上述方法搭建的步进式全景，并在该全景中画面的切换方法，该方法包括以下步骤：步骤S1、设定用户在两个步进式点位之间单次移动的时间为t1，两个步进式点位之间全景图片切换的时间为t2，设置t1和t2的大小为t1＞t2，在步进式漫游中，用户在两个步进式点位之间移动需要一定的时间，在这个时间内，虚拟场景需要做到使用后一个步进式点位的画面替换掉前一个步进式点位的画面，为了不让画面之间的替换显得突兀，因此需要将替换画面的时间变长，这样才能提供用户一种过渡的画面感受，为了防止用户移动完毕后全景画面还未替换完成的情况发生，所以需要设置成用户在两个步进式点位之间移动过程中将全景画面替换完毕，因此将t1和t2的大小设置为t1＞t2，需要知道的是，在上述方法中，必须满足在虚拟场景内漫游时，每次移动都只能移动到下一点位的漫游规则，用户无法跳点，这样所有相邻点位之间移动的时间都能确定是t1，且所有相邻点位之间的全景图片切换的时间都能确定是t2。步骤S2、设定全景图片的原亮度为场景画面的默认亮度，且在所述默认亮度时点光源的亮度值为k，在亮度最低时点光源的亮度值为0，调整所述点光源的亮度值可改变场景画面的亮度，点光源是通过自发光将包围的全景图片投影到建筑模型上形成全景画面的，为了保证投影出的全景画面环境亮度反映出全景图片的真实亮度，需要设置点光源的亮度值，使投影出的全景画面与原图亮度一致，保留这一亮度值作为场景画面的默认亮度，这里的亮度值k是一个常数，可以自定义设置，例如设置成数字1，则说明亮度值是1时，场景画面的亮度是默认亮度，通过改变数值大小，就能调整场景画面的亮度，例如将亮度值调整为0.5，则场景画面的亮度变为原全景图片的一半，k值的设定不同，调节场景画面的亮度的比例也不同，但是始终遵循亮度值为0时，点光源无法产生光亮，此时场景画面为原建筑模型的初始颜色，一般为白色，步骤S1和S2均属于预先设定好的规则，因此不细分先后执行顺序。步骤S3、开启步进检测，监听用户的操作消息，所述操作消息为用户输入的从当前步进式点位移动到目标步进式点位的指令消息，在步骤S1和S2中设定完毕后，步进检测则变为一直打开的状态，实时监听用户的操作消息，只要用户进入场景，步进检测也随之开启，用户在场景显示界面上对步进式漫游进行操控，所述用户输入的从当前步进式点位移动到目标步进式点位的指令消息的方法为：用户通过点击场景界面的步进式点位使客户端接收到目标步进式点位的消息作为输入的指令消息，或者用户通过场景界面的移动操作杆朝向步进式点位移动使客户端接收到目标步进式点位的消息作为输入的指令消息，上述两种方式均是为了后天判定用户是否选择移动的方式，本方案仅以这两种交互方式举例，但是不局限于这两种操控方式。步骤S4、接收所述指令消息后，同时执行全景图片切换和用户移动，全景图片切换方法为：在t2时间内，控制当前步进式点位的点光源的亮度值从k逐渐降低至0，目标步进式点位的点光源的亮度值从0逐渐升高至k；用户移动方法为：在t1时间内，完成用户从当前步进式点位到目标步进式点位的移动，在全景图片切换过程中，随着当前步进式点位的点光源亮度逐渐降低，此时该点位对应的全景画面也逐渐透明，而目标步进式点位的点光源亮度此时逐渐从0往上增加，所以目标步进式点位的全景画面逐渐从透明变得清晰，随着这一过程的结束，目标步进式点位的全景画面逐渐清晰为原全景图片的亮度，将之前的全景画面替代，完成一次全景图片的切换。根据步骤S1可知t1和t2之间需要设置为t1＞t2，经过多次实验找到两个时间的最佳大小区间为，所述设置t1和t2的大小为1.5*t2≤t1≤2.5*t2，特别是将t1的大小设置成等于2*t2，通过放慢漫游的过程可以看出，当用户移动到两个步进式点位中间位置时，目标步进式点位上的全景画面刚好全部显示，直到用户完全漫游到目标步进式点位，全景画面依然保持全部显示的状态，这样既不会因为画面切换太快造成视觉割裂，也不会因为画面切换太慢影响转景。在步骤S4中可以看出两个步进式点位的点光源的亮度值是在不同变动的，所述点光源的亮度值在t2时间内变动时，亮度值的大小与时间之间呈线性变换，线性变换的亮度值能给用户带来渐进的视觉感受，不会因为亮度陡变而造成视觉上的割裂感，如图2所示是两个步进式点位的点光源的亮度值的变化情况，在图2中s1代表当前步进式点位的点光源的亮度值变化，s2代表目标步进式点位的点光源的亮度值变化，横坐标代表时间，纵坐标代表亮度值，在0时刻时，用户可以看到清晰的当前步进式点位的全景画面，在t2/2时刻时，s1和s2的亮度值相等，此时用户看到的是当前步进式点位的全景画面和目标步进式点位的全景画面叠加的图片，在t2时刻时，用户看到的是清晰的目标步进式点位的全景画面。由上述对图2的解释可以看出，在t2时间内，除了初始时刻和结尾时刻，用户所能看到的画面均为两个步进式点位的点光源投影的叠加画面，为了提高用户的感观，所述全景图片切换中，当前步进式点位的点光源的亮度值和目标步进式点位的点光源的亮度值之和始终为k，由于二者的亮度值之和始终为k，这样就算用户看到两个步进式点位的点光源投影的叠加画面，叠加起来的亮度也不会超过默认亮度，从而在切换画面时，不会出现亮度变化，稳定的亮度可以给用户带来最佳的视觉效果。实施例2一种步进式漫游中全景图的切换系统，与实施例1针对相同方法搭建的步进式虚拟场景，如图3所示，该系统包括：时间设置单元，用于设定用户在两个步进式点位之间单次移动的时间为t1，两个步进式点位之间全景图片切换的时间为t2，设置t1和t2的大小为t1＞t2；所述时间设置单元中设置t1和t2的大小为1.5*t2≤t1≤2.5*t2。亮度设置单元，用于设定全景图片的原亮度为场景画面的默认亮度，且在所述默认亮度时点光源的亮度值为k，在亮度最低时点光源的亮度值为0，调整所述点光源的亮度值可改变场景画面的亮度；所述亮度设置单元中，点光源的亮度值在t2时间内变动时，亮度值的大小与时间之间呈线性变换。步进检测单元，用于开启步进检测，监听用户的操作消息，所述操作消息为用户输入的从当前步进式点位移动到目标步进式点位的指令消息；用户输入的从当前步进式点位移动到目标步进式点位的指令消息的方法为：用户通过点击场景界面的步进式点位使客户端接收到目标步进式点位的消息作为输入的指令消息，或者用户通过场景界面的移动操作杆朝向步进式点位移动使客户端接收到目标步进式点位的消息作为输入的指令消息。画面切换单元，用于接收所述指令消息后，同时执行全景图片切换和用户移动，全景图片切换方法为：在t2时间内，控制当前步进式点位的点光源的亮度值从k逐渐降低至0，目标步进式点位的点光源的亮度值从0逐渐升高至k；用户移动方法为：在t1时间内，完成用户从当前步进式点位到目标步进式点位的移动，所述画面切换单元的全景图片切换中，当前步进式点位的点光源的亮度值和目标步进式点位的点光源的亮度值之和始终为k。实施例2和实施例1本质相同，因此不在赘述实施例2中各单元的工作原理。实施例3本实施例提出了一种存储介质，存储介质包括存储程序区和存储数据区，其中存储程序区可存储操作系统，以及运行即时通讯功能所需的程序等；存储数据区可存储各种即时通讯信息和操作指令集等。计算机程序存储在存储程序区，在所述计算机程序被处理器执行时，实现如实施例1所述的步进式漫游中全景图的切换方法。处理器可以包括一个或多个中央处理单元或者为数字处理单元等等。对于本领域技术人员而言，显然本发明不限于上述示范性实施例的细节，而且在不背离本发明的精神或基本特征的情况下，能够以其他的具体形式实现本发明。因此，无论从哪一点来看，均应将实施例看作是示范性的，而且是非限制性的，本发明的范围由所附权利要求而不是上述说明限定，因此旨在将落在权利要求的等同要件的含义和范围内的所有变化囊括在本发明内。此外，应当理解，虽然本说明书按照实施方式加以描述，但并非每个实施方式仅包含一个独立的技术方案，说明书的这种叙述方式仅仅是为清楚起见，本领域技术人员应当将说明书作为一个整体，各实施例中的技术方案也可以经适当组合，形成本领域技术人员可以理解的其他实施方式。
