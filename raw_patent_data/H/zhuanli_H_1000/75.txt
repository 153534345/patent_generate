标题title
一种基于身份信息的车内网络通信方法
摘要abst
本发明涉及车内网络安全的防护技术领域，公开了一种基于身份信息的车内网络通信方法。该方法包括步骤S1.基于ECU的身份信息为车内的各个ECU生成相应的公私钥对。S2.密钥管理器生成对称密钥和MAC生成密钥，然后采用非对称加密算法将其传输至各个ECU。S3.发送方ECU利用所要发送的消息和MAC生成密钥生成第一消息认证码MAC1，并通过对称密钥将消息及MAC1加密后发送给接收方ECU。S4.接收方ECU通过对称密钥对密文进行解密，并利用消息和MAC生成密钥生成第二消息认证码MAC2，随后通过对比MAC1和MAC2是否一致以判断消息的安全性。本发明使得车内网络通信更为安全，验证了消息的完整性。
权利要求书clms
1.一种基于身份信息的车内网络通信方法，其特征在于，包括步骤：S1.基于ECU的身份信息为车内的各个ECU生成相应的公私钥对；S2.密钥管理器生成对称密钥和MAC生成密钥；然后基于公私钥对并采用非对称加密算法将对称密钥和MAC生成密钥传输至各个ECU；S3.发送方ECU利用所要发送的消息和MAC生成密钥生成第一消息认证码MAC1，并通过对称密钥将消息及MAC1加密后发送给接收方ECU；S4.接收方ECU通过对称密钥对收到的密文进行解密，并利用消息和MAC生成密钥生成第二消息认证码MAC2，随后通过对比MAC1和MAC2是否一致以判断消息的安全性。2.根据权利要求1所述的一种基于身份信息的车内网络通信方法，其特征在于，步骤S1中，车内的密钥管理器产生第一随机数R1以用作根密钥的种子，基于所有ECU的身份信息，使用根密钥生成相应的公钥PK；同时密钥管理器确定好系统的安全参数，并发送给各个ECU；ECU接收到安全参数后，根据自身的身份信息与安全参数，生成相对应的私钥SK，从而根据公钥PK和私钥SK形成所述公私钥对。3.根据权利要求2所述的一种基于身份信息的车内网络通信方法，其特征在于，步骤S2中，密钥管理器使用公钥PK将所述对称密钥和所述MAC生成密钥进行加密以形成第一密文，并将第一密文发送给所有的ECU；每个ECU接收到第一密文后，使用自身的私钥SK对密文进行解密，从而获取所述对称密钥和所述MAC生成密钥。4.根据权利要求2所述的一种基于身份信息的车内网络通信方法，其特征在于，在密钥管理器生成公钥PK后，还将公钥PK存储在可读存储器中。5.根据权利要求2所述的一种基于身份信息的车内网络通信方法，其特征在于，步骤S2中，密钥管理器还产生第二随机数R2和第三随机数R3，分别作为所述对称密钥和所述MAC生成密钥。6.根据权利要求5所述的一种基于身份信息的车内网络通信方法，其特征在于，第一随机数R1、第二随机数R2和第三随机数R3均为量子随机数。7.根据权利要求1所述的一种基于身份信息的车内网络通信方法，其特征在于，步骤S3中，发送方ECU将消息M输入自身的消息认证码生成器中，利用MAC生成密钥生成所述第一消息认证码MAC1；随后发送方ECU形成消息组合＜消息ID|消息M|MAC1|时间戳ts＞，并通过对称密钥加密所述消息组合，形成第二密文并发送给接收方ECU；步骤S4中，接收方ECU收到第二密文后，先使用对称密钥进行解密以获取所述消息组合，验证时间戳ts是否在设定范围内，若不在则判定所述消息组合存在安全隐患，反之则将接收到的消息M输入自身的消息认证码生成器中，利用MAC生成密钥计算生成第二消息认证码MAC2；随后接收方ECU将MAC2与MAC1进行对比，若两者一致则判定所述消息组合安全可信，反之仍判定所述消息组合存在安全隐患。8.根据权利要求7所述的一种基于身份信息的车内网络通信方法，其特征在于，消息认证码的生成过程如下：选择一个哈希函数，用于将消息M和MAC生成密钥组合并生成一个固定长度的哈希值，该哈希值即为消息认证码。9.根据权利要求8所述的一种基于身份信息的车内网络通信方法，其特征在于，发送方ECU在将包含有第一消息认证码MAC1的消息组合发送给接收方ECU；接收方ECU接收到消息组合后，使用与发送方ECU相同的加密密钥和哈希函数，对消息进行计算以得到第二消息认证码MAC2。10.根据权利要求1所述的一种基于身份信息的车内网络通信方法，其特征在于，所述非对称加密算法采用RSA算法。
说明书desc
技术领域本发明涉及车内网络安全的防护技术领域，具体是一种基于身份信息的车内网络通信方法。背景技术随着智能化和信息化的发展，汽车电气系统变得日益复杂。当前汽车普遍拥有数十个电子控制单元，而攻击者可以通过车载ECU的自身漏洞，对ECU之间的通信进行远程攻击，造成汽车信息安全事件的频发。目前传统的车内网络通信协议缺乏对数据的认证和加密，也缺乏消息完整性验证，无法判断消息在传输过程中是否经过中间人攻击或者数据篡改。另外，还缺乏有效的方法来防止重放攻击，即攻击者截获并重新发送已经发送过的消息。发明内容为了避免和克服现有技术中存在的技术问题，本发明提供了一种基于身份信息的车内网络通信方法。本发明基于ECU的身份信息生成公私钥对，以此将对称密钥和MAC生成密钥加密传输至ECU，使得车内网络通信更为安全，并在发送方ECU和接收方ECU之间引入消息认证码机制，从而验证了消息的完整性。为实现上述目的，本发明提供如下技术方案：本发明公开一种基于身份信息的车内网络通信方法，包括步骤S1-S4。S1.基于ECU的身份信息为车内的各个ECU生成相应的公私钥对。S2.密钥管理器生成对称密钥和MAC生成密钥；然后基于公私钥对并采用非对称加密算法将对称密钥和MAC生成密钥传输至各个ECU。S3.发送方ECU利用所要发送的消息和MAC生成密钥生成第一消息认证码MAC1，并通过对称密钥将消息及MAC1加密后发送给接收方ECU。S4.接收方ECU通过对称密钥对收到的密文进行解密，并利用消息和MAC生成密钥生成第二消息认证码MAC2，随后通过对比MAC1和MAC2是否一致以判断消息的安全性。作为上述方案的进一步改进，步骤S1中，车内的密钥管理器产生第一随机数R1以用作根密钥的种子，基于所有ECU的身份信息，使用根密钥生成相应的公钥PK；同时密钥管理器确定好系统的安全参数，并发送给各个ECU。ECU接收到安全参数后，根据自身的身份信息与安全参数，生成相对应的私钥SK，从而根据公钥PK和私钥SK形成公私钥对。作为上述方案的进一步改进，步骤S2中，密钥管理器使用公钥PK将对称密钥和MAC生成密钥进行加密以形成第一密文，并将第一密文发送给所有的ECU。每个ECU接收到第一密文后，使用自身的私钥SK对密文进行解密，从而获取对称密钥和MAC生成密钥。作为上述方案的进一步改进，在密钥管理器生成公钥PK后，还将公钥PK存储在可读存储器中。作为上述方案的进一步改进，步骤S2中，密钥管理器还产生第二随机数R2和第三随机数R3，分别作为对称密钥和MAC生成密钥。作为上述方案的进一步改进，第一随机数R1、第二随机数R2和第三随机数R3均为量子随机数。作为上述方案的进一步改进，步骤S3中，发送方ECU将消息M输入自身的消息认证码生成器中，利用MAC生成密钥生成第一消息认证码MAC1。随后发送方ECU形成消息组合＜消息ID|消息M|MAC1|时间戳ts＞，并通过对称密钥加密消息组合，形成第二密文并发送给接收方ECU。步骤S4中，接收方ECU收到第二密文后，先使用对称密钥进行解密以获取消息组合，验证时间戳ts是否在设定范围内，若不在则判定消息组合存在安全隐患，反之则将接收到的消息M输入自身的消息认证码生成器中，利用MAC生成密钥计算生成第二消息认证码MAC2。随后接收方ECU将MAC2与MAC1进行对比，若两者一致则判定消息组合安全可信，反之仍判定消息组合存在安全隐患。作为上述方案的进一步改进，消息认证码的生成过程如下：选择一个哈希函数，用于将消息M和MAC生成密钥组合并生成一个固定长度的哈希值，该哈希值即为消息认证码。作为上述方案的进一步改进，发送方ECU在将包含有第一消息认证码MAC1的消息组合发送给接收方ECU。接收方ECU接收到消息组合后，使用与发送方ECU相同的加密密钥和哈希函数，对消息进行计算以得到第二消息认证码MAC2。作为上述方案的进一步改进，非对称加密算法采用RSA算法。与现有技术相比，本发明的有益效果是：1、本发明通过在车内网中使用基于身份信息的加密广播通信，即通过ECU的身份信息来生成私钥和公钥，系统可以在不需要中心密钥管理的情况下，安全地协商对称密钥，这提升了通信的安全性，特别是在一个分散的车内网络中。在此基础上，通过在通信过程中引入消息验证码的验证机制，可以验证消息在传输过程中是否被篡改，降低了伪造消息的可能，进一步保障了通信的安全性。2、本发明采用量子随机数作为根密钥的种子，量子随机数在理论上是真正随机的，这意味着根密钥是真正随机的，而不是基于伪随机算法的，这使得根密钥不可破解。同时还将量子随机数作为对称密钥和MAC生成密钥，进一步保障了通信的安全。3、本发明引入了时间戳验证，可以防止重放攻击。这确保了每条消息都是当前有效的，而不是过时的或者被重复利用的。同时，由于MAC是基于消息内容和时间戳生成的，攻击者无法伪造一个有效的MAC，除非他们知道消息的内容和时间戳，进一步降低了伪造消息的可能。4、本发明通过将对称加密应用于组合消息，实现了安全性和效率之间的平衡。对称加密提供了高效的加密和解密过程，同时保护了消息的隐私性。附图说明图1为本发明实施例中基于身份信息的车内网络通信方法的流程图。图2为本发明实施例中车内通信阶段的信号传输示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。请参阅图1，本发明实施例中，一种基于身份信息的车内网络通信方法，整体可包括两大阶段，具体可包括步骤S1-S4。一、密钥初始化阶段：S1.基于ECU的身份信息为车内的各个ECU生成相应的公私钥对。在一些实施例中，ECU的身份信息可以是原始设备制造商在汽车出厂时为每个ECU生成一个唯一的身份信息。当然，也可以由其他用户为ECU生成身份信息，这个身份信息需要是唯一且不可预测的，以确保通信的安全性。通常，ECUID会以数字、字母或符号的组合形式表示，然后分别分配给各个ECU，同时将所有ECU的身份信息发送给密钥管理器。这确保了每个ECU拥有独特的标识符，为后续通信提供了安全基础。车内的密钥管理器产生第一随机数R1以用作根密钥的种子，基于所有ECU的身份信息，使用根密钥生成相应的公钥PK，并将公钥PK存储在可读存储器中，这保证了公钥的安全性和可靠性。同时密钥管理器确定好系统的安全参数，并发送给各个ECU，需要说明的是，使用椭圆曲线算法生成公私钥对依赖于一系列参数，如椭圆曲线方程、有限域大小p、基点G和曲线阶n。一般是公私钥由一个设备生成，这里是密钥管理器生成各个ECU的公钥，将参数发给ECU后，由ECU来生成自己的私钥。ECU接收到安全参数后，根据自身的身份信息与安全参数，生成相对应的私钥SK，从而根据公钥PK和私钥SK形成公私钥对。本实施例可使用安全哈希函数来确保从身份信息ECUID到私钥SK的映射是不可逆的，同时保护了ECU的身份信息。S2.密钥管理器生成对称密钥和MAC生成密钥。具体地，密钥管理器产生第二随机数R2和第三随机数R3，将其分别作为接下来车内通信的对称密钥Ke和MAC生成密钥Km。本实施例中，第一随机数R1、第二随机数R2和第三随机数R3均为量子随机数。可利用量子随机数发生器产生量子随机数，量子随机数在理论上是真正随机的，这意味着系统根密钥也是真正随机的，而不是基于伪随机算法的，这使得根密钥的不可破解，保证了通信安全。当然在一些实施例中，第一随机数R1、第二随机数R2和第三随机数R3还可以是其他类型的真随机数，由真随机数生成的密钥具有更高的安全性，真随机数是通过物理系统生成的随机数，量子随机数是真随机数，电压波动、磁盘磁头读/写时的寻道空间，电磁波噪声、掷硬币等也是真随机数。然后，密钥管理器基于公私钥对并采用非对称加密算法将对称密钥和MAC生成密钥传输至各个ECU。非对称加密算法中，有两个密钥：公钥和私钥。它们是一对，如果用公钥进行加密，只有用对应的私钥才能解密；如果用私钥进行加密，只有用对应的公钥才能解密。非对称加密算法实现机密信息的交换过程为：甲方生成一对密钥并将其中一个作为公钥向其他方公开；得到该公钥的乙方使用该密钥对机密信息进行加密后发送给甲方；甲方再用自己的另一个专用密钥对加密后的信息进行解密。本实施例中，非对称加密算法可采用RSA算法。具体地，密钥管理器使用公钥PK将对称密钥和MAC生成密钥进行加密以形成第一密文，并将第一密文发送给所有的ECU。这确保了通信数据的保密性和完整性。每个ECU接收到第一密文后，使用自身的私钥SK对密文进行解密，从而获取对称密钥Ke和MAC生成密钥Km。对称密钥Ke用于加密和解密通信数据，而MAC生成密钥Km用于生成消息认证码以保证通信的完整性和真实性。由于每个ECU根据自己的身份信息和安全参数生成对应的私钥，这确保了每个ECU都能通过自己身份信息生成私钥，使得通信更为安全。二、车内通信阶段：S3.发送方ECU利用所要发送的消息和MAC生成密钥生成第一消息认证码MAC1，并通过对称密钥将消息及MAC1加密后发送给接收方ECU。消息认证码即为MAC。请参阅图2，具体地，发送方ECU将消息M输入自身的消息认证码生成器中，通过AES-CMAC算法并根据MAC生成密钥Km生成第一消息认证码MAC1。随后发送方ECU形成消息组合＜消息ID|消息M|MAC1|时间戳ts＞，此时的时间戳是ts1，并通过对称密钥Ke加密消息组合，形成第二密文并发送给接收方ECU。S4.接收方ECU通过对称密钥对收到的密文进行解密，并利用消息和MAC生成密钥生成第二消息认证码MAC2，随后通过对比MAC1和MAC2是否一致以判断消息的安全性。具体地，接收方ECU收到第二密文后，先使用对称密钥Ke进行解密以获取消息组合，此时的时间戳为ts2，验证时间戳ts是否在设定范围内，若不在则说明这是一包被重放的数据，有安全隐患，需要丢弃；若在则将接收到的消息M输入自身的消息认证码生成器中，根据自身存储的MAC生成密钥Km计算生成第二消息认证码MAC2。随后接收方ECU将MAC2与MAC1进行对比，若两者一致则该包数据安全可信；若不一致，则说明该包数据存在安全隐患，需要丢弃。消息认证码是一种用于验证消息完整性、真实性和来源认证的技术。它是通过对消息使用密钥和加密算法生成的一段固定长度的数据，附加在消息中以确保消息在传输过程中不被篡改或伪造。在通信过程中，为了确保消息在传输过程中不受到未经授权的修改或篡改，以及确保消息的来源可信，使用消息认证码是一种常见的做法。MAC的生成过程涉及密钥和哈希函数，通常使用哈希函数来计算密钥和消息的哈希值，并将这个哈希值作为认证码添加到原始消息中。消息认证码的生成过程如下：选择一个哈希函数，用于将消息M和MAC生成密钥组合并生成一个固定长度的哈希值，该哈希值即为消息认证码。哈希运算可将不同长度的输入都返回一个固定长度的输出。哈希运算之所以在密码学中得到广泛的应用，是因为具有以下特征：、确定性：对同一个输入无论进行多少次哈希运算，得到的哈希值都是一个定值；、快速计算能力：哈希计算相较于其他安全算法计算迅速，耗时短；、原像抗力：通过哈希值反推出原值十分困难；、输入值有微小的改变，哈希值都会完全不同；、碰撞抗力：输入值不同，哈希运算后输出值却相同的的概率几乎为0。其中，发送方ECU在将包含有第一消息认证码MAC1的消息组合发送给接收方ECU。接收方ECU接收到消息组合后，使用与发送方ECU相同的加密密钥和哈希函数，对消息进行计算以得到第二消息认证码MAC2。上述生成消息认证码的方式，可以验证消息在传输过程中是否被篡改。如果MAC验证失败，接收方可以确定消息已被修改或损坏。同时，由于MAC是基于消息内容和时间戳生成的，攻击者无法伪造一个有效的MAC，除非他们知道消息的内容和时间戳，大大降低了伪造消息的可能性，确保了接收方接收到的数据的完整性和真实性。通过将对称加密应用于已经组合了ID、M、MAC和ts的数据，实现了安全性和效率之间的平衡。对称加密提供了高效的加密和解密过程，同时保护了消息的隐私性。并且，通过验证时间戳是否在设定的时间范围内，可以检测和防范重放攻击，这确保了每条消息都是当前有效的，而不是过时的或者被重复利用的，保障了通信的安全性。在一些实施例中，除了时间戳，还可以考虑其他替代方案来确保通信的安全性和完整性，只要是能够与时间戳的作用相类似并且用于防重放攻击的方式，皆可。例如：、序列号/计数器：每个消息都附带一个递增的序列号或计数器值。接收方可以检查序列号，确保消息按照正确的顺序到达，同时可以防止重放攻击。、挑战-应答协议：发送方发送一个随机挑战给接收方，接收方根据挑战计算一个应答值。这可以确保通信双方都拥有正确的密钥，并防止了中间人攻击。新鲜值机制：通过多个计数器，完成新鲜值的更新，通过新鲜值来防止防重放攻击。以上所述，仅为本发明较佳的具体实施方式，但本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，根据本发明的技术方案及其发明构思加以等同替换或改变，都应涵盖在本发明的保护范围之内。
