标题title
一种3D全脸检测设备及其检测方法
摘要abst
本发明公开了一种3D全脸检测设备及其检测方法，包括：不透光遮罩、以及位于不透光遮罩一侧设置的面罩和上位机，面罩包括：红外光源、可见光源、一个相机和主板；相机的感光波段的波长范围为300nm‑1200nm，上位机用于根据用户指令向主板发送图像生成指令，主板用于根据图像生成指令控制红外光源点亮或可见光源点亮，并控制相机启动以采集用户脸部的图像并输出用户图像；并将用户图像传送至上位机，上位机用于处理用户图像并进行显示；减少了体积、重量和成本。提升了用户满意度。
权利要求书clms
1.一种3D全脸检测设备，其特征在于，包括：不透光遮罩、以及位于所述不透光遮罩一侧设置的面罩和上位机，所述面罩包括：红外光源、可见光源、一个相机和主板；所述红外光源、所述可见光源、所述相机均与所述主板电连接，所述主板与所述上位机通信连接；所述上位机用于根据用户指令向所述主板发送第一图像生成指令，所述主板用于根据所述第一图像生成指令控制所述红外光源点亮或所述可见光源点亮，并控制所述相机启动以采集用户脸部的图像并输出用户图像；所述主板还用于将所述用户图像传送至所述上位机，所述上位机用于处理所述用户图像并进行显示；其中，所述相机的感光波段的波长范围为300nm-1200nm；所述第一图像生成指令包括彩色与深度融合图像生成指令、彩色图像生成指令、深度图像生成指令以及彩色点云图像生成指令中的至少一种；所述用户图像包括RAW格式图像、mono格式图像、RGB格式图像或YUV格式图像中的其中一种，所述3D全脸检测设备还包括：深度处理模块、图像融合模块、点云图生成模块和ISP图像处理模块；所述ISP图像处理模块用于处理所述RAW格式图像或所述mono格式图像形成RGB格式图像或YUV格式图像的彩色图像，还用于处理所述RAW格式图像或所述RGB格式图像或YUV格式图像形成所述mono格式图像，所述深度处理模块用于处理所述mono格式图像形成深度图像；所述图像融合模块用于融合所述彩色图像和所述深度图像，形成彩色与深度融合图像；所述点云图生成模块用于基于所述融合图像生成点云图像。2.根据权利要求1所述的3D全脸检测设备，其特征在于，所述上位机包括：控制模块、及其与所述控制模块连接的图像处理芯片、图像输出模块和交互模块；所述主板包括：微处理器、串口控制接口和图像数据传输接口；所述控制模块通过所述串口控制接口与所述微处理器连接，所述图像处理芯片的接收端与所述图像数据传输接口连接，所述图像处理芯片的输出端与所述图像数据传输模块的输入端连接，所述图像数据传输模块的输出端与所述交互模块连接；其中，所述深度处理模块、所述图像融合模块、所述点云图生成模块集成在所述图像处理芯片中；所述ISP图像处理模块集成在所述图像处理芯片中，和/或，集成在所述相机中。3.根据权利要求2所述的3D全脸检测设备，其特征在于，所述主板包括：总电源口和外部触发接口，所述总电源口用于连接外部电源；所述外部触发接口与所述可见光源电连接；所述微处理器分别与所述红外光源、所述相机的控制端、所述图像数据传输接口的输入端、所述外部触发接口的输入端电连接；所述相机的输出端与所述微处理器电连接，所述微处理器分通道与所述图像数据传输接口的输入端连接，或者，所述相机的输出端与所述图像数据传接输口的输入端连接。4.根据权利要求1所述的3D全脸检测设备，其特征在于，所述相机包括成像芯片和成像透镜，所述相机为黑白相机时，所述成像芯片包括感光层，所述感光层包括多个感光像素单元；或者，所述相机为彩色相机时，所述成像芯片还包括，设置在所述感光层之上的彩色滤光片阵列层。5.根据权利要求4所述的3D全脸检测设备，其特征在于，所述成像芯片还包括超表面微结构层；所述超表面微结构层位于所述感光层之上；或者，所述超表面微结构层位于所述彩色滤光片阵列层之上；所述超表面微结构层包括周期性排列的微结构单元，每个所述微结构单元对应K个感光像素单元，K≥2，K个所述感光像素单元相邻；其中，每个所述微结构单元用于将接收的无偏振特性的成像光束分解成K种偏振状态的偏振光束，K种偏振状态的光束分别聚焦在K个不同的感光像素单元上。6.根据权利要求5所述的3D全脸检测设备，其特征在于，所述红外光源包括散斑结构光投射器或编码结构光投射器，所述散斑结构光投射器或编码结构光投射器能够投射出带特征图案的红外结构光斑；所述红外光源还包括泛光投射器，所述泛光投射器能够投射出均匀的红外光；所述成像芯片包括感光层以及设置在所述感光层之上的彩色滤光片阵列层时，所述可见光源为白光补光灯或由红、绿、蓝三种颜色的补光灯组成；所述成像芯片包括感光层时，所述可见光源由红、绿、蓝三种颜色的补光灯组成；所述第一图像生成指令还包括偏振图像生成指令。7.根据权利要求1所述的3D全脸检测设备，其特征在于，所述面罩还包括紫外光源，所述紫外光源与所述主板电连接，所述上位机用于根据用户指令向所述主板发送第二图像生成指令，所述主板用于根据所述第二图像生成指令控制所述红外光源点亮或所述紫外光源点亮；所述第二图像生成指令包括紫外与深度融合图像生成指令、紫外图像生成指令、深度图像生成指令以及紫外点云图像生成指令中的至少一种。8.一种3D全脸检测设备的检测方法，其特征在于，基于如权利要求1所述的3D全脸检测设备实现，包括以下步骤：上位机接收用户输入的用户指令，并生成彩色图像生成指令发送至所述主板；所述主板接收所述彩色图像生成指令，并根据所述彩色图像生成指令控制所述可见光源点亮，控制所述相机启动以采集用户脸部的图像并输出用户图像，所述ISP图像处理模块对所述用户图像进行处理，形成彩色图像，所述上位机对所述彩色图像进行显示；上位机接收用户输入的用户指令，并生成深度图像生成指令发送至所述主板；所述主板接收所述深度图像生成指令，并根据所述深度图像生成指令控制所述红外光源点亮，控制所述相机启动以采集用户脸部的图像并输出用户图像；若所述用户图像为RAW格式图像或RGB格式图像或YUV格式图像，则所述ISP图像处理模块对所述RAW格式图像RGB格式图像或YUV格式图像进行处理，形成mono格式图像，所述深度图像处理模块对所述mono格式进行深度处理形成深度图像，所述上位机对所述深度图像进行显示；若所述用户图像为mono格式图像，则所述深度图像处理模块对所述mono格式图像进行深度处理形成深度图像，所述上位机对所述深度图像进行显示；上位机接收用户输入的用户指令，并生成彩色与深度融合图像生成指令发送至所述主板；所述主板控制所述红外光源和所述可见光源交替点亮；所述图像融合模块融合所述彩色图像和所述深度图像，形成彩色与深度融合图像，所述上位机对所述彩色与深度融合图像进行显示；上位机接收用户输入的用户指令，并生成彩色点云图像生成指令发送至所述主板；所述主板控制所述红外光源和所述可见光源交替点亮；所述点云图像生成模块对所述彩色与深度融合图像进行处理，形成彩色点云图像，所述上位机对所述彩色点云图像进行显示。9.一种3D全脸检测设备的检测方法，其特征在于，基于如权利要求7所述的3D全脸检测设备实现，包括以下步骤：上位机接收用户输入的用户指令，并生成紫外图像生成指令发送至所述主板；所述主板接收所述紫外图像生成指令，并根据所述紫外图像生成指令控制所述紫外光源点亮，控制所述相机启动以采集用户脸部的图像并输出用户图像，所述ISP图像处理模块对所述用户图像进行处理，形成紫外图像，所述上位机对所述紫外图像进行显示；上位机接收用户输入的用户指令，并生成深度图像生成指令发送至所述主板；所述主板接收所述深度图像生成指令，并根据所述深度图像生成指令控制所述红外光源点亮，控制所述相机启动以采集用户脸部的图像并输出用户图像；若所述用户图像为RAW格式图像或RGB格式图像或YUV格式图像，则所述ISP图像处理模块对所述RAW格式图像或RGB格式图像或YUV格式图像，进行处理，形成mono格式图像，所述深度图像处理模块对所述mono格式图像进行深度处理形成深度图像，所述上位机对所述深度图像进行显示；若所述用户图像为mono格式图像，则所述深度图像处理模块对所述mono格式图像进行深度处理形成深度图像，所述上位机对所述深度图像进行显示；上位机接收用户输入的用户指令，并生成紫外与深度融合图像生成指令发送至所述主板；所述主板控制所述红外光源和所述紫外光源交替点亮；所述图像融合模块融合所述紫外图像和所述深度图像，形成紫外与深度融合图像，所述上位机对所述紫外与深度融合图像进行显示；上位机接收用户输入的用户指令，并生成紫外点云图像生成指令发送至所述主板；所述主板控制所述红外光源和所述紫外光源交替点亮；所述点云图像生成模块对所述紫外与深度融合图像进行处理，形成紫外点云图像，所述上位机对所述紫外点云图像进行显示。10.一种3D全脸检测设备的检测方法，其特征在于，基于如权利要求6所述的3D全脸检测设备实现，包括以下步骤：上位机接收用户输入的用户指令，并生成偏振图像生成指令发送至所述主板；所述主板控制所述泛光投射器点亮；所述相机将原始曝光一次得到的一帧图像数据按照不同偏振方向分解成k个子帧图像数据输出；并赋值每个子帧图像数据对应的偏振方向，其中，k≥2。
说明书desc
技术领域本发明涉及医疗美容技术领域，尤其涉及一种3D全脸检测设备及其检测方法。背景技术目前人们越来越关注自己的外在容貌，通过整形美容的人也越来越多。整形美容机构的数量也顺势而涨，竞争越来越激烈。许多消费者对整形美容预期不能准确表达，整形医生也无法准确向消费者介绍术后效果，只能凭借经验向消费者描述。这样可能导致，消费者与整形医生之间的沟通出现障碍。虽然，3D人脸模型技术的出现，可以向消费者更直观的展现出术前效果与术后效果。但是，相关技术中的全脸检测仪结构复杂，体积庞大，形成3D人脸模型的过程繁琐，用户满意度低。发明内容本发明提供了一种3D全脸检测设备及其检测方法，以解决相关技术中设备比较笨重，检测过程繁琐的问题，用户满意度低的问题。为解决上述问题，本发明第一方面实施例提出了一种3D全脸检测设备，包括：包括：不透光遮罩、以及位于所述不透光遮罩一侧设置的面罩和上位机，所述面罩包括：红外光源、可见光源、一个相机和主板；所述红外光源、所述可见光源、所述相机均与所述主板电连接，所述主板与所述上位机通信连接；所述上位机用于根据用户指令向所述主板发送第一图像生成指令，所述主板用于根据所述第一图像生成指令控制所述红外光源点亮或所述可见光源点亮，并控制所述相机启动以采集用户脸部的图像并输出用户图像；所述主板还用于将所述用户图像传送至所述上位机，所述上位机用于处理所述用户图像并进行显示；其中，所述相机的感光波段的波长范围为300nm-1200nm；所述第一图像生成指令包括彩色与深度融合图像生成指令、彩色图像生成指令、深度图像生成指令以及彩色点云图像生成指令中的至少一种；所述用户图像包括RAW格式图像、mono格式图像、RGB格式图像或YUV格式图像中的其中一种；其中，所述3D全脸检测设备还包括：深度处理模块、图像融合模块、点云图生成模块和ISP图像处理模块；所述ISP图像处理模块用于处理所述RAW格式图像或所述mono格式图像形成RGB格式图像或YUV格式图像的彩色图像，还用于处理所述RAW格式图像或RGB格式图像或YUV格式图像形成所述mono格式图像，所述深度处理模块用于处理所述mono格式图像形成深度图像；所述图像融合模块用于融合所述彩色图像和所述深度图像，形成彩色与深度融合图像；所述点云图生成模块用于基于所述融合图像生成点云图像。为解决上述问题，本发明另一方面实施例还提出了一种3D全脸检测设备的检测方法，包括以下步骤：上位机接收用户输入的用户指令，并生成彩色图像生成指令发送至所述主板；所述主板接收所述彩色图像生成指令，并根据所述彩色图像生成指令控制所述可见光源点亮，控制所述相机启动以采集用户脸部的图像并输出用户图像，所述ISP图像处理模块对所述用户图像进行处理，形成彩色图像，所述上位机对彩色图像进行显示；上位机接收用户输入的用户指令，并生成深度图像生成指令发送至所述主板；所述主板接收所述深度图像生成指令，并根据所述深度图像生成指令控制所述红外光源点亮，控制所述相机启动以采集用户脸部的图像并输出用户图像；若所述用户图像为RAW格式图像或RGB格式图像或YUV格式图像，则所述ISP图像处理模块对所述RAW格式图像或RGB格式图像或YUV格式图像进行处理，形成mono格式图像，所述深度图像处理模块对所述mono格式进行深度处理形成深度图像，所述上位机对所述深度图像进行显示；若所述用户图像为mono格式图像，则所述深度图像处理模块对所述mono格式图像进行深度处理形成深度图像，所述上位机对所述深度图像进行显示；上位机接收用户输入的用户指令，并生成彩色与深度融合图像生成指令发送至所述主板；所述主板控制所述红外光源和所述可见光源交替点亮；所述图像融合模块融合所述彩色图像和所述深度图像，形成彩色与深度融合图像，所述上位机对所述彩色与深度融合图像进行显示；上位机接收用户输入的用户指令，并生成彩色点云图像生成指令发送至所述主板；所述主板控制所述红外光源和所述可见光源交替点亮；所述点云图像生成模块对所述彩色与深度融合图像进行处理，形成彩色点云图像，所述上位机对所述彩色点云图像进行显示。为解决上述问题，本发明另一方面实施例还提出了一种3D全脸检测设备的检测方法，包括以下步骤：上位机接收用户输入的用户指令，并生成紫外图像生成指令发送至所述主板；所述主板接收所述紫外图像生成指令，并根据所述紫外图像生成指令控制所述紫外光源点亮，控制所述相机启动以采集用户脸部的图像并输出用户图像，所述ISP图像处理模块对所述用户图像进行处理，形成紫外图像，所述上位机对所述紫外图像进行显示；上位机接收用户输入的用户指令，并生成深度图像生成指令发送至所述主板；所述主板接收所述深度图像生成指令，并根据所述深度图像生成指令控制所述红外光源点亮，控制所述相机启动以采集用户脸部的图像并输出用户图像；若所述用户图像为RAW格式图像或RGB格式图像或YUV格式图像，则所述ISP图像处理模块对所述RAW格式图像或RGB格式图像或YUV格式图像，进行处理，形成mono格式图像，所述深度图像处理模块对所述mono格式图像进行深度处理形成深度图像，所述上位机对所述深度图像进行显示；若所述用户图像为mono格式图像，则所述深度图像处理模块对所述mono格式图像进行深度处理形成深度图像，所述上位机对所述深度图像进行显示；上位机接收用户输入的用户指令，并生成紫外与深度融合图像生成指令发送至所述主板；所述主板控制所述红外光源和所述紫外光源交替点亮；所述图像融合模块融合所述紫外图像和所述深度图像，形成紫外与深度融合图像，所述上位机对所述紫外与深度融合图像进行显示；上位机接收用户输入的用户指令，并生成紫外点云图像生成指令发送至所述主板；所述主板控制所述红外光源和所述紫外光源交替点亮；所述点云图像生成模块对所述紫外与深度融合图像进行处理，形成紫外点云图像，所述上位机对所述紫外点云图像进行显示。为解决上述问题，本发明另一方面实施例还提出了一种3D全脸检测设备的检测方法，包括以下步骤：上位机接收用户输入的用户指令，并生成偏振图像生成指令发送至所述主板；所述主板控制所述泛光投射器点亮；所述相机将原始曝光一次得到的一帧图像数据按照不同偏振方向分解成k个子帧图像数据输出；并赋值每个子帧图像数据对应的偏振方向，其中，k≥2。根据本发明实施例提出的3D全脸检测设备，包括：不透光遮罩、以及位于不透光遮罩一侧设置的面罩和上位机，面罩包括：红外光源、可见光源、一个相机和主板；红外光源、可见光源、相机均与主板电连接，主板与上位机通信连接；上位机用于根据用户指令向主板发送第一图像生成指令，主板用于根据第一图像生成指令控制红外光源点亮或可见光源点亮，并控制相机启动以采集用户脸部的图像并输出用户图像；主板还用于将用户图像传送至上位机，上位机用于处理用户图像并进行显示；其中，相机的感光波段的波长范围为300nm-1200nm，第一图像生成指令包括彩色与深度融合图像生成指令、彩色图像生成指令、深度图像生成指令以及彩色点云图像生成指令中的至少一种；用户图像包括RAW格式图像、mono格式图像、RGB格式图像或YUV格式图像中的其中一种，其中，3D全脸检测设备还包括：深度处理模块、图像融合模块、点云图生成模块和ISP图像处理模块；ISP图像处理模块用于处理RAW格式图像或mono格式图像形成RGB格式图像或YUV格式图像，还用于处理RAW格式图像或RGB格式图像或YUV格式图像形成mono格式图像；深度处理模块用于处理mono格式图像形成深度图像；图像融合模块用于融合彩色图像和深度图像，形成彩色与深度融合图像；点云图生成模块用于基于融合图像生成点云图像。由此，通过不透光遮罩的设置，可以避免设备中滤光片的使用，减少设备的光学元件的布置，降低成本，减轻设备重量。另外，相机的感光波段为300nm-1200nm，基本包括了全波段成像，一个相机实现了多个相机的功能，使得最终成像的图像均在一个相机坐标系下，有利于图像的融合，减小融合图像的误差，提升了融合图像的精度，并且相机个数的减少，进一步缩小了设备的体积，减轻了设备了重量，降低了设备成本。应当理解，本部分所描述的内容并非旨在标识本发明的实施例的关键或重要特征，也不用于限制本发明的范围。本发明的其它特征将通过以下的说明书而变得容易理解。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明实施例提出的3D全脸检测设备的结构示意图；图2是本发明实施例提出的3D全脸检测设备的方框示意图；图3是本发明一个实施例提出的3D全脸检测设备的方框示意图；图4是本发明一个实施例提出的3D全脸检测设备中的相机成像芯片光电转换效率的示意图；图5是本发明一个实施例提出的3D全脸检测设备中的相机成像芯片的彩色滤光片阵列示意图；图6是本发明另一个实施例提出的3D全脸检测设备中的相机成像芯片光电转换效率的示意图；图7是本发明一个实施例提出的3D全脸检测设备中的相机成像芯片的结构示意图；图8是本发明另一个实施例提出的3D全脸检测设备中的相机成像芯片的结构示意图；图9是本发明一个实施例提出的3D全脸检测设备中的相机成像芯片的俯视结构示意图；图10是本发明一个实施例提出的3D全脸检测设备中的相机成像芯片的不同像素单元偏振状态的示意图；图11是本发明另一个实施例提出的3D全脸检测设备的方框示意图；图12是本发明一个具体实施例提出的3D全脸检测设备的方框示意图；图13是本发明另一个具体实施例提出的3D全脸检测设备的方框示意图；图14是本发明另一个具体实施例提出的3D全脸检测设备的方框示意图；图15是图10中同一偏振状态对应的感光像素单元输出的亮度值示意图；图16是处理后的图10中同一偏振状态对应的感光像素单元输出的亮度值示意图。具体实施方式为了使本技术领域的人员更好地理解本发明方案，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分的实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都应当属于本发明保护的范围。需要说明的是，本发明的说明书和权利要求书及上述附图中的术语“第一”、“第二”等是用于区别类似的对象，而不必用于描述特定的顺序或先后次序。应该理解这样使用的数据在适当情况下可以互换，以便这里描述的本发明的实施例能够以除了在这里图示或描述的那些以外的顺序实施。此外，术语“包括”和“具有”以及他们的任何变形，意图在于覆盖不排他的包含，例如，包含了一系列步骤或单元的过程、方法、系统、产品或设备不必限于清楚地列出的那些步骤或单元，而是可包括没有清楚地列出的或对于这些过程、方法、产品或设备固有的其它步骤或单元。相关技术中的脸部检测设备一般设置红外成像相机和RGB成像相机两个相机，并且需要在各相机的成像芯片之前设置滤光片和成像透镜，滤光片主要是过滤掉相机成像不需要的波段的光，示例性的，红外成像相机中的滤光片主要透过红外光，而彩色相机中的滤光片主要透过可见光。若用户需要生成融合图像时，红外成像相机和RGB成像相机由于本身安装位置差异，使得融合图像时，需要先对红外成像相机和RGB成像相机的位置进行标定，并对输出的图像进行配准，过程繁琐，影响3D建模效果。并且，由于设备设置了两个相机以及滤光片，不但增加了成本，而且增加了设备的体积以及重量，图像融合不精准，使得用户满意度低。由此，为解决上述问题，本发明实施例提出了一种3D全脸检测设备，减少了设备的体积、重量，降低了成本，提升了图像融合的精确度。下面来详细介绍本发明实施例提出的3D全脸检测设备。图1是本发明实施例提出的3D全脸检测设备的结构示意图。图2是本发明实施例提出的3D全脸检测设备的方框示意图。包括：不透光遮罩102、以及位于不透光遮罩102一侧设置的面罩101和上位机108，面罩101包括：红外光源104、可见光源105、一个相机106和主板107；红外光源104、可见光源105、相机106均与主板107电连接，主板107与上位机108通信连接；上位机108用于根据用户指令向主板107发送第一图像生成指令，主板107用于根据图像生成指令控制红外光源104点亮或可见光源105点亮，并控制相机106启动以采集用户脸部的图像并输出用户图像；主板107还用于将用户图像传送至上位机108，上位机108用于处理用户图像并进行显示；其中，相机106的感光波段的波长范围为300nm-1200nm，红外光源104为红外光源，可见光源105为可见光源；第一图像生成指令包括彩色与深度融合图像生成指令、彩色图像生成指令、深度图像生成指令以及彩色点云图像生成指令中的至少一种；用户图像包括RAW格式图像、mono格式图像、RGB格式图像或YUV格式图像中的其中一种，其中，3D全脸检测设备还包括：深度处理模块、图像融合模块、点云图生成模块和ISP图像处理模块；ISP图像处理模块用于RAW格式图像或mono格式图像形成RGB格式图像或YUV格式图像，还用于处理RAW格式图像或RGB格式图像或YUV格式图像形成mono格式图像，深度处理模块用于处理mono格式图像形成深度图像；图像融合模块用于融合彩色图像和深度图像，形成彩色与深度融合图像；点云图生成模块用于基于融合图像生成点云图像。需要说明的是，不透光遮罩102为柔性遮罩，并且不透光遮罩102底部具有开口103，用户可以通过开口103进入不透光遮罩102内部，其中，在不透光遮罩102上设置有面罩101，在面罩101中设置有3D人脸检测设备100的核心器件，面罩101可以为符合人脸轮廓的硬性支撑面罩。可知的，不透光遮罩102可以为透气但遮光的材质，示例性的，可以为纺织布等。由于用户在不透光遮罩102中被进行图像采集，即在全黑环境下进行，进而，无需在相机106的前方设置滤光片，以滤除不需要波段的光。降低了设备100的成本、体积和重量。如图2所示，在面罩101中设置有主板107、红外光源104、可见光源105和相机106。其中，上位机108可以为移动终端、台式电脑等，与主板107之间可以进行有线或无线通信。用户可以与上位机108进行交互。并且上位机108在接收到用户指令后，可以生成图像生成指令，并传达给主板107。主板107依据该图像生成指令来控制光源的启亮，相机106的启动等，最终主板107将相机106采集的图像传输给上位机108，上位机108显示给用户。由于相机106的感光波段在300nm-1200nm，本发明实施例仅用一个接收相机就可以替代相关技术中的两个接收相机，节省了一个相机，降低了3D人脸检测设备的物料和组装成本，且结构光成像和可见光成像由一个相机完成，不需要对多个相机之间的位置做标定，降低了3D人脸检测仪的组装难度，以及简化了深度图和彩色图的匹配和融合计算。下面来介绍图2所示的实施例的3D全脸检测设备的检测过程。首先，彩色图像生成的过程如下：若上位机108接收用户输入的用户指令，并生成彩色图像生成指令发送至主板107；主板107接收彩色图像生成指令，并根据彩色图像生成指令控制可见光源105点亮，控制相机106启动以采集用户脸部的图像并输出用户图像，ISP图像处理模块对用户图像进行处理，形成彩色图像，上位机108对彩色图像进行显示。其中，ISP图像处理模块可以对RAW格式图像或mono格式图像进行黑电平校正、伽马校正、白平衡、色彩校正、色彩插值等操作后，生成RGB格式图像、YUV格式图像。深度图像形成过程如下：上位机108接收用户输入的用户指令，并生成深度图像生成指令发送至主板107；主板107接收深度图像生成指令，并根据深度图像生成指令控制红外光源104点亮，控制相机106启动以采集用户脸部的图像并输出用户图像；若用户图像为RAW格式图像或RGB格式图像或YUV格式图像，则ISP图像处理模块对RAW格式图像RGB格式图像或YUV格式图像进行处理，形成mono格式图像，深度图像处理模块对mono格式图像进行深度处理形成深度图像，上位机108对深度图像进行显示；若用户图像为mono格式图像，则深度图像处理模块对mono格式图像进行深度处理形成深度图像，上位机108对深度图像进行显示。彩色与深度融合图像形成过程如下：上位机108接收用户输入的用户指令，并生成彩色与深度融合图像生成指令发送至主板107；主板107控制红外光源104和可见光源105交替点亮；生成彩色图像和深度图像，图像融合模块融合彩色图像和深度图像，形成彩色与深度融合图像，上位机108对彩色与深度融合图像进行显示。彩色点云图像形成过程如下：上位机108接收用户输入的用户指令，并生成彩色点云图像生成指令发送至主板107；主板107控制红外光源104和可见光源105交替点亮；点云图像生成模块对彩色与深度融合图像进行处理，形成彩色点云图像，上位机108对彩色点云图像进行显示。其中，彩色图像的指令的设置，可以得到用户的脸部带颜色信息的2D图像。深度图像的指令的设置，可以得到用户的脸部的深度图像。深度图像和彩色图像的融合，可以得到用户的脸部的带颜色信息3D图像。并且，单相机106的设置，有利于用户的脸部的3D图像的精度的提升，使得用户对自己的脸部轮廓有更好的了解。并且，在整形前期，通过一些技术对用户的脸部模型进行处理，可以让用户直观的看到术前与术后的对比情况。用户可以根据自己的不同需求来与上位机108进行交互。图3是本发明一个实施例提出的3D全脸检测设备的方框示意图。上位机108包括：控制模块109、及其与控制模块109连接的图像处理芯片110、图像输出模块111和交互模块112；主板107包括：微处理器113、串口控制接口114和图像数据传输接口115；控制模块109通过串口控制接口114与微处理器113连接，图像处理芯片110的接收端与图像数据传输接口115连接，图像处理芯片110的输出端与图像数据传输模块115的输入端连接，图像数据传输模块115的输出端与交互模块112连接；其中，深度处理模块1102、图像融合模块1103、点云图生成模块1104集成在图像处理芯片110中，ISP图像处理模块1101集成在图像处理芯片110中和/或相机106中。其中，在上述实施例中，控制模块109可以为PLC控制器。交互模块112可以为交互界面，示例性的，可以为触摸显示屏、按键键盘和显示屏的叠加等。交互界面上可以设置各种图像生成指令模块，供用户选择。可选地，主板107包括：总电源口117和外部触发接口116，总电源口117用于连接外部电源；外部触发接口116与可见光源105电连接；微处理器113分别与红外光源104、相机106的控制端、图像数据传输接口115的输入端、外部触发接口116的输入端电连接；相机106的输出端与微处理器113电连接，微处理器113分通道与图像数据传输接口115的输入端连接，或者，相机106的输出端与图像数据传接输接115口的输入端连接。可以理解的是，微处理器113和控制模块109通过串口控制接口114进行数据传输。微处理器113通过串口控制接口114接收到控制模块109的图像生成指令，然后微处理器113控制相机106启动，以及控制与图像生成指令相对应的波段的光源启动。其中，若相机106的输出端与微处理器113连接，则相机106将采集的图像输出至微处理器113，然后由微处理器113通过图像数据传输接口115传输至图像处理芯片110。若相机106的输出端与图像数据传输接口115连接，则相机106直接通过图像数据传输接口115传输图像至图像处理芯片110。其中，微处理器113可以分通道通过图像数据传输接口115传输图像，也就是说，可以一个通道传输RAW格式图像或RGB格式图像或YUV格式图像，一个通道传输mono格式图像。其中，总电源口117需适配微处理器113和红外光源104的供电需求，一般与12V的电源连接，给主板107和相关器件供电，串口控制接口114主要用于接收外部上位机108的指令，并将指令传输至微处理器113，微处理器113主要处理各种指令的收发与控制，图像数据传输口115主要是将接收相机106输出的图像数据输出至上位机108进行后续处理，图像数据传输口115一般有POE、LAN、MIPI、DVP、LVDS、USB3.0等类型，外部触发接口116用于接收微处理器113打开可见光源105的指令，接到相关指令后驱动可见光源105开始工作；此外主板107还有驱动模块，存储模块，供电模块等。红外光源104、相机106可直接集成在主板107上，也可以通过连接器或插头的方式与主板107电联，可见光源105此实施例中属于外接光源，由外部供电，且由主板107来触发其启动打光。在一些实施例中，可可见光源也可以直接集成在主板107上，或通过连接器或插座的方式与主板107电联，直接由微处理器113控制，不需要通过外部触发接口来控制；此外主板107也可以不接外接电源直接由上位机108供电。在其他的实施例中，红外光源相对相机可以倾斜一定角度放置，现有红外光源相对相机在基线方向上有一定距离，红外光源的投射视场不能与相机的接收视场完全重合，导致红外光源发出的部分光斑未能被相机接收到，成为无效光斑，通过将红外光源相对相机倾斜一定角度放置，可以尽量减少无效光斑，提供红外光源的光能利用率。此外在一些实施例中可见光源可以与红外光源通过共支架或共光学器件的方式集成在一个投射器模组中，类似的方案均在本发明的保护范围内；此外在一些实施例中，由于相机接收视场角不够大，在同一位置采集人脸图像时，不能将人脸的侧脸与正脸的图像信息同时采集到，此时可以通过一起旋转相机和红外光源，对人脸进行多角度拍摄，对多角度的RGBD图进行拼接处理，得到包括人的正脸和侧脸完整的3D模型图。可选地，相机106包括成像芯片和成像透镜，若相机为黑白相机，成像芯片包括感光层，感光层包括多个感光像素单元；或者，若相机为彩色相机，成像芯片还包括，设置在感光层之上的彩色滤光片阵列层。若相机106中的成像芯片包括感光层和成像透镜，每个像素单元均只输出感应到的光束的亮度信息，该相机106可以为黑白相机，由于像素单元上没有滤光片对光的吸收或反射，使得像素单元的光电转换效率较集成彩色滤光片阵列的芯片的要高得多。图4是本发明一个实施例提出的3D全脸检测设备中的相机成像芯片光电转换效率的示意图。一般黑白相机300-1000nm波段的光电转换效率如图4所示。若相机106成像芯片还包括，设置在感光层之上的彩色滤光片阵列层，成像芯片中的彩色滤光片阵列由多个子单元组成。图5是本发明一个实施例提出的3D全脸检测设备中的相机成像芯片彩色滤光片阵列的示意图，可以参见图5，子单元按拜耳序列排列，可以是如图5所示的RGGB，还可以是GBRG、BGGR等，有些实施例还可以将两个G通道中的一个替换为W通道来提高芯片的感光效率，每个彩色滤光片子单元与一个像素单元对应，理论上R通道只允许可见光中的红光通过、G通道只允许可见光中的绿光通过，B通道只允许可见光中的蓝光通过，不同通道通过的光谱没有重叠，相应通道的像素单元可以将接收到的光信号转换为电信号，再通过数电转换变为数字信号，输出每个通道对应的亮度值。图6是本发明另一个实施例提出的3D全脸检测设备中的相机成像芯片光电转换效率的示意图。但由于生产制作条件的限制，实际R、G、B通道对应的像素单元对光谱的响应曲线如图6所示，图6中的横坐标为不同的波长，纵坐标为光电转换效率，图中6条曲线分别对应B、G、R通道的像素单元对应不同波长光束的光电转换效率，可以看到B、G、R通道除了对可见光波段有响应外，对红外波段如800-100nm，或紫外波段如300-400nm都有一定的响应。该相机106可以为彩色相机。由此，通过图4和图6可以看出，黑白相机和彩色相机均能对300-1200nm波段范围的光进行响应。并且，图4所示的相机的光电转换效率相较于图6所示的相机的光电转换效率高。可选地，成像芯片还包括超表面微结构层；超表面微结构层位于感光层之上；或者，超表面微结构层位于彩色滤光片阵列之上；超表面微结构层包括周期性排列的微结构单元，每个微结构单元对应K个感光像素单元，K≥2，K个感光像素单元相邻；其中，每个微结构单元用于将接收的无偏振特性的成像光束分解成K种偏振状态的偏振光束，K种偏振状态的光束分别聚焦在K个不同的感光像素单元上。图7是本发明一个实施例提出的3D全脸检测设备中的相机成像芯片的结构示意图。图8是本发明另一个实施例提出的3D全脸检测设备中的相机成像芯片的结构示意图。如图7所示，沿成像光束接收方向，成像芯片依次设置有，超表面微结构层205，基材层204，彩色滤光片阵列层203，感光层202和电路层201。其中，电路层201为感光层202提供相应电路，感光层202将光信号转换为电信号，电信号经数字模拟转换电路转换为数字信号输出，彩色滤光片阵列层203用于通过不同颜色的光并被感光层202感应。基于广义斯涅耳定律，通过引入表面亚波长尺寸单元结构来产生突变相位，使超表面的二维平面结构具有特殊电磁属性，可实现对入射光的振幅，相位，偏振等灵活的调控，具有强大的光场操控能力，其中基材204是具有高透过率的基材，常用的有石英、SiO2、聚合物材料、PC等，超表面微结构层205是由多个亚波长尺寸单元按一定规律排列的微结构面，常用的材料有铜、铝、金、钛等金属，或是硅、氮化硅、TiO2、砷化铝等介质材料。通过定义输入场和输出场的光场分布及光场信息，即可求出超表面在不同位置下的相位分布，通过相位分布及超表面基材204和超表面微结构层205的材料选取，计算可得到超表面微结构层205的结构分布。图8与图7不同的是，未设置彩色滤光片阵列层203。其余器件均与图7相同，功能描述可参照图7，此处不再赘述。由此，通过超表面微结构层205的设置，可以实现对入射光的振幅，相位，偏振等灵活的调控，进而成像光束入射至超表面微结构层205后可变为偏振光束。由于在平行偏振光模式下，更容易观察皮肤表层问题而不受更深层反射光干扰，进而可以用来观察皮肤表面细纹、毛孔斑点等皮肤状态；交叉偏振光可以突出漫反射，消除镜面反射，在交叉偏振光模式下，可以完全过滤去皮肤表面的镜面反射光干扰，可以观察皮肤更深层次的反射光，进而可以用来观察皮肤表层下的敏感、炎症、红血丝和浅层的色素，研究痘印色沉、斑纹、晒伤等皮肤问题。其中，每个微结构单元对应K个感光像素单元，K≥2，K个感光像素单元相邻；每个微结构单元用于将接收的无偏振特性的成像光束分解成K种偏振状态的偏振光束，K种偏振状态的光束分别聚焦在K个不同的感光像素单元上。图9是本发明一个实施例提出的3D全脸检测设备中的相机成像芯片的俯视结构示意图。如图9所示，超表面微结构层205包括微结构单元206，当K=4时，该微结构单元206用于将接收的无偏振特性的成像光束分解成4种偏振状态的偏振光束，4种偏振状态的光束分别聚焦在4个不同的感光像素单元上对应四个感光像素单元207，四个感光像素单元207包括第一感光像素单元2071，第二感光像素单元2072，第三感光像素单元2073，第四感光像素单元2074。当外界单色光通过成像透镜聚焦在四个像素单元207上后，四个像素单元207将会聚的光束中包含的不同偏振特性的光分离一定的角度，并将不同偏振特性的光各自会聚在不同的像素单元成像。如图10所示，这四种偏振状态可以是45°、90°、0°和135°。成像芯片通过曝光一次即可以得到四种/张不同偏振特性的偏振图像，常规芯片曝光一次只得到一张图像。此实施例曝光一次得到四张图像的方法是：将原始曝光一次得到的一帧图像数据分解成四个子帧图像数据输出，如：可以通过寄存器控制使相机只选取具有相同偏振特性的像素单元作为一张图像数据，并输出对应像素单元的亮度值，与其偏振状态不相同的像素对应的亮度输出值为0，然后此图像数据可以输出至ISP图像处理模块，对像素单元的亮度值为0的位置的亮度值可以通过周边有亮度值的像素单元插值计算来赋予新的亮度值，同样也可以直接将一个微结构单元206对应的四个像素单元的亮度值赋值为一样的值，即把第一像素单元2071的亮度赋值给临近的第二像素单元2072、第三像素单元2073、第四像素单元2074，如此输出得到一帧带特定偏振特性的图像，同理，其它偏振特征对应的成像像素单元的数据也可以重复上述操作，分别输出45°、90°、135°线偏振特性的图像，如此便可以得到四张带偏振特性的图像，一次获取多张不同偏振光状态的成像图片，丰富了采集到的人脸图像信息，有助于人脸皮肤问题的准确全面的诊断。由于超表面结构层只对特定波长的光束有此偏振分光特性，而对该波长以外的光束只有聚焦而没有偏振分光作用，所以可以使用某一特定波长的激光光源作为偏振成像的光源。可选地，红外光源104包括散斑结构光投射器或编码结构光投射器，散斑结构光投射器或编码结构光投射器投射出带特征图案的红外结构光斑；红外光源104还包括泛光投射器，泛光投射器投射出均匀的红外光；成像芯片包括感光层以及设置在感光层之上的彩色滤光片阵列层时，可见光源105为白光补光灯或由红、绿、蓝三种颜色的补光灯组成；成像芯片包括感光层时，可见光源105由红、绿、蓝三种颜色的补光灯组成；第一图像生成指令还包括偏振图像生成指令。可以理解的是，红外光源104中的散斑结构光投射器或编码结构光投射器打开时，用于得到深度图像。红外光源104中的泛光投射器打开时，用于得到偏振图像。当相机为彩色相机时，可见光源105中的白光补光灯打开，用于得到彩色图像，或者，红、绿、蓝三种颜色的补光灯同时打开，用于得到彩色图像。当相机为黑白相机时，红、绿、蓝三种颜色的补光灯分别打开，用于合成得到彩色图像。其中，结构光投射器一般有两种方案，其一，激光光源+准直镜+衍射光学元件，激光光源可以是vcsel、hcsel等红外光源，激光光源发出的光经准直镜准直为平行光束后，再经衍射光学元件复制扩散为一定视场角的带特征图案的红外结构光斑，某些实施例中准直镜和衍射光学元件的功能会集成在一片光学元件中，即激光光源发出的球面波直接经过准直衍射一体化的光学元件后复制扩散为一定视场角的带特征图案的红外结构光斑；其二，光源+准直镜+mask+投射物镜，光源可以是led、vcsel、ld等红外光源，光源发出的光经准直镜准直后，经过mask，mask上有一层图案层，图案层由透光和不透光部分组成，光束透过透光部分后由投射物镜投射出去，投射形成与mask图案层图案一致的编码结构光斑；现有结构光投射器中光源所选的波长一般为940nm、905nm或850nm，原因是因为外界自然光光谱中此种波长对应的成分较少，深度测量时，会尽量减少外界环境光作为背景噪声影响测量结果。可选地，如图11所示，面罩101还包括紫外光源118，紫外光源118与主板107电连接，上位机108用于根据用户指令向主板107发送第二图像生成指令，主板107用于根据图像生成指令控制红外光源104点亮或紫外光源118点亮；第二图像生成指令包括紫外与深度融合图像生成指令、紫外图像生成指令、深度图像生成指令以及紫外点云图像生成指令中的至少一种。进一步的，该方案中除了使用现有可见光波段的补光灯外，还可以添加其它光谱或其它特殊性能的补光灯，用于分析皮肤不同层面的问题；如可以添加紫外补光灯，一般紫外光波段范围为300-400nm，优选365-400nm波段的光作为紫外补光灯，由于黑色素在表皮下的积累，会出现紫外线色斑，是皮肤受日晒损伤的结果，紫外线色斑通过正常肉眼和彩色图像是看不见的，使用微量紫外线照射，可以输出紫外人脸图，能检测到皮肤表层下的问题，如粉刺、深斑、荧光残留、激素、深层皮炎等问题。其中，第二图像生成指令的执行，可参照第一图像生成指令的执行，只需将第三波段光源类比于第二波段光源即可。由此，在上述的3D全脸检测设备中，主要有以下几种结构，示例性的，第一种，相机使用彩色相机，红外光源为结构光投射器，可见光源为白光补光灯或红绿蓝三色补光灯，ISP图像处理模块集成在图像处理芯片中。第二种，相机使用彩色相机，红外光源为结构光投射器，可见光源为白光补光灯或红绿蓝三色补光灯，ISP图像处理模块集成在相机中。第三种，相机使用彩色相机，红外光源为结构光投射器，可见光源为白光补光灯或红绿蓝三色补光灯，紫外光源，ISP图像处理模块集成在相机中。第四种，相机使用彩色相机，红外光源为结构光投射器，可见光源为白光补光灯或红绿蓝三色补光灯，紫外光源，ISP图像处理模块集成在图像处理芯片中。第五种，相机使用黑白相机，红外光源为结构光投射器，可见光源为红绿蓝三种灯，ISP图像处理模块集成在图像处理芯片中。第六种，相机使用黑白相机，红外光源为结构光投射器，可见光源为红绿蓝三种灯，ISP图像处理模块集成在相机中。第七种，相机使用黑白相机，红外光源为结构光投射器，可见光源为红绿蓝三种灯，紫外光源，ISP图像处理模块集成在图像处理芯片中。第八种，相机使用黑白相机，红外光源为结构光投射器，可见光源为红绿蓝三种灯，紫外光源，ISP图像处理模块集成在相机中。在上述第一至第八种实施例的基础上，相机的成像芯片表面还可以设置有超表面微结构层。红外光源中的泛光投射器打开，可以得到偏振图像。下面以具体实施例为例来介绍3D全脸检测设备的检测方法。该3D全脸检测设备的检测方法，包括以下步骤：上位机接收用户输入的用户指令，并生成彩色图像生成指令发送至主板；主板接收彩色图像生成指令，并根据彩色图像生成指令控制可见光源点亮，控制相机启动以采集用户脸部的图像并输出用户图像，ISP图像处理模块对用户图像进行处理，形成彩色图像，上位机对彩色图像进行显示；上位机接收用户输入的用户指令，并生成深度图像生成指令发送至主板；主板接收深度图像生成指令，并根据深度图像生成指令控制红外光源点亮，控制相机启动以采集用户脸部的图像并输出用户图像；若用户图像为RAW格式图像或RGB格式图像或YUV格式图像，则ISP图像处理模块对RAW格式图像或RGB格式图像或YUV格式图像，进行处理，形成mono格式图像，深度图像处理模块对mono格式图像进行深度处理形成深度图像，上位机对深度图像进行显示；若用户图像为mono格式图像，则深度图像处理模块对mono格式图像进行深度处理形成深度图像，上位机对深度图像进行显示；上位机接收用户输入的用户指令，并生成彩色与深度融合图像生成指令发送至主板；主板控制红外光源和可见光源交替点亮；图像融合模块融合彩色图像和深度图像，形成彩色与深度融合图像，上位机对彩色与深度融合图像进行显示；上位机接收用户输入的用户指令，并生成彩色点云图像生成指令发送至主板；主板控制红外光源和可见光源交替点亮；点云图像生成模块对彩色与深度融合图像进行处理，形成彩色点云图像，上位机对彩色点云图像进行显示。图12是本发明又一个实施例提出的3D全脸检测设备的方框示意图，当相机为彩色相机，3D全脸检测设备包括红外光源和可见光源，ISP图像处理模块集成在相机中，该3D全脸检测设备的检测方法包括：其中，当彩色相机集成ISP图像处理模块时，彩色相机输出RGB格式图像，或者，YUV格式图像，或者mono格式图像。在当上位机通过交互界面接收到操作者需求输出RGB图像时，控制模块将RGB成像指令通过串口控制接口传输至微处理器，微处理器通过外部触发接口开启可见光补光灯，并同步开启彩色相机，使相机接收到人脸反射的可见光后，曝光成像，此时彩色相机默认输出RGB或YUV等彩色格式图像，图像数据直接通过图像数据传输口传输至图像处理芯片，此时传入图像处理芯片的是RGB或YUV等彩色格式图像，图像处理芯片不对其做任何图像处理，控制模块直接控制该图像输出至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出RGB或YUV等彩色格式图像。当上位机通过交互界面接收到操作者需求输出深度图像时，控制模块将深度成像指令通过串口控制接口传输至微处理器，微处理器控制结构光投射器开始打光，并同步开启彩色相机，使相机接收到人脸反射的结构光后，曝光成像，此时微处理器通过寄存器控制彩色相机输出mono格式图像，图像数据直接通过图像数据传输口传输至图像处理芯片，此时输出的mono格式图像，每个通道对应的都是像素单元对红外光响应的亮度值，控制模块启动深度处理模块处理该黑白图，一般深度处理模块会对mono图进行预处理、块匹配、深度计算等操作，最终输出人脸的深度图至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出深度图。当上位机通过交互界面接收到操作者需求输出RGBD图时，控制模块将RGBD成像指令通过串口控制接口传输至微处理器，微处理器控制结构光投射器和可见光补光灯间隔打光；分时打开可见光补光灯和结构光投射器，可以使得输出结构光斑图时不受可见光的影响，输出彩色图时不受红外光的影响；当可见光补光灯启动时，同步启动彩色相机，彩色相机曝光输出彩色RGB或YUV格式图像。当结构光投射器启动时，同步启动彩色相机，彩色相机输出图像的格式根据设定可以有两种：一种是，彩色相机曝光默认输出红外RGB或YUV格式图像；另一种是，微处理器通过寄存器控制彩色相机，使其切换成mono格式图像。也就是说，当彩色相机间隔输出一帧彩色RGB格式图像和一帧mono格式图像时，彩色RGB格式图像和mono格式图像直接通过图像传输接口传输至图像处理芯片，mono格式图像传输出至深度处理模块，经处理后得到深度图，后将彩色图与深度图均输出至图像融合模块，对彩色图的每个像素点附深度值或对深度图的每个像素点附颜色值，最终输出RGBD图至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出RGBD图。当彩色相机间隔输出一帧彩色RGB/YUV格式图像和一帧红外RGB/YUV格式图像时，此时，上位机中还需要集成ISP图像处理模块，彩色RGB/YUV格式图像和红外RGB/YUV格式图像直接通过图像传输接口传输至图像处理芯片，上位机中的ISP图像处理模块对红外RGB/YUV格式图像进行去彩色等操作，最终输出mono格式图像，mono格式图像传输出至深度处理模块，经处理后得到深度图，后将彩色图像与深度图均输出至图像融合模块，对彩色图的每个像素点附深度值或对深度图的每个像素点附颜色值，最终输出RGBD图至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出RGBD图；需说明的是此情况下上位机中的ISP图像处理模块不对彩色帧的RGB/YUV格式图像做处理，只是对红外帧的RGB/YUV格式图像做去彩色处理，功能较简单。在获得融合图像之后，可以通过点云处理模块处理融合图像形成点云图像。也就是说，当上位机通过交互界面接收到操作者需求输出点云图时，同上述得到RGBD的步骤一样，只是多一步，将RGBD图输出至点云图生成模块，获得各成像点的三维坐标信息和对应的颜色信息，生成人脸的点云图至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出点云图。图13是本发明又一个实施例提出的3D全脸检测设备的方框示意图，相机使用彩色相机，3D全脸检测设备包括红外光源和可见光源，与上一实施例不同的是，ISP图像处理模块集成在图像处理芯片中。彩色相机中未集成ISP图像处理模块时，彩色相机输出的图像格式为RAW格式图像。由此，当上位机通过交互界面接收到操作者需求输出RGB图时，控制模块将RGB成像指令通过串口控制接口传输至微处理器，微处理器通过外部触发接口开启可见光补光灯，并同步开启彩色相机，使相机接收到人脸反射的可见光后，曝光成像，此时彩色相机默认输RAW格式图像，图像信息输出至微处理器后，微处理器再将图像信息通过图像数据传输口传输至图像处理芯片，此时传入图像处理芯片的RAW格式图像，需经过ISP图像处理模块，控制模块启动ISP图像处理模块处理该RAW图，一般ISP图像处理模块会对RAW图进行黑电平校正、伽马校正、白平衡、色彩校正、色彩插值等操作，还原真实人脸的颜色信息，最终以RGB/YUV等图像格式输出至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出RGB图像。当上位机通过交互界面接收到操作者需求输出深度图像时，控制模块将深度成像指令通过串口控制接口传输至微处理器，微处理器控制结构光投射器开始打光，并同步开启彩色相机，使相机接收到人脸反射的结构光后，曝光成像，此时微处理器通过控制彩色相机输出RAW格式图像，图像数据直接通过图像数据传输口传输至图像处理芯片，通过ISP图像处理模块输出的mono格式图像。每个通道对应的都是像素单元对红外光响应的亮度值，控制模块启动深度处理模块处理该黑白图，一般深度处理模块会对mono格式图像进行预处理、块匹配、深度计算等操作，最终输出人脸的深度图至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出深度图。当上位机通过交互界面接收到操作者需求输出RGBD图时，控制模块将RGBD成像指令通过串口控制接口传输至微处理器，微处理器控制结构光投射器和可见光补光灯间隔打光；分时打开可见光补光灯和结构光投射器，可以使得输出结构光斑图时不受可见光的影响，输出彩色图时不受红外光的影响；当可见光补光灯启动时，同步启动彩色相机，彩色相机曝光输出RAW格式图像，此时RAW格式图像中每个像素单元对应的为R、G、B通道感光的亮度值；当结构光投射器启动时，同步启动彩色相机，彩色相机曝光默认输出RAW格式图像，此时RAW格式图像中每个像素单元对应的都是感应红外光IR的亮度值，也就是说，彩色相机间隔输出一帧彩色RAW格式图像和一帧红外RAW格式图像。当彩色相机间隔输出一帧彩色RAW格式图像和一帧红外RAW格式图像时，彩色RAW格式图像和红外RAW格式图像通过微处理器和图像传输接口传输至ISP图像处理模块，对彩色RAW格式图像进行黑电平校正、伽马校正、白平衡、色彩校正、色彩插值等操作，最终得到RGB/YUV等格式的彩色图像，对红外RAW进行去彩色等操作，最终输出mono格式图像，mono格式图像传输出至深度处理模块，经处理后得到深度图，后将彩色图与深度图均输出至图像融合模块，对彩色图的每个像素点附深度值或对深度图的每个像素点附颜色值，最终输出RGBD图至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出RGBD图。另外的实施例中，彩色相机中也可集成ISP图像处理模块，彩色相机直接输出mono格式图像。当彩色相机间隔输出一帧彩色RAW格式图像和一帧mono格式图像时，彩色RAW格式图像通过微处理器和图像传输接口传输至ISP图像处理模块，对彩色RAW格式图像进行黑电平校正、伽马校正、白平衡、色彩校正、色彩插值等操作，最终得到RGB/YUV等格式的彩色图像，mono格式图像通过微处理器和图像传输接口直接传输至深度处理模块，经处理后得到深度图，后将彩色图与深度图均输出至图像融合模块，对彩色图的每个像素点附深度值或对深度图的每个像素点附颜色值，最终输出RGBD图至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出RGBD图。此实施例中是先将相机输出的一路图像数据输出至微处理器，微处理器再将一路图像数据转成两路图像数据输出，这样不同的图像数据通过上位机的控制模块可以直接传输到图像处理芯片中对应的模块进行下一步处理，无需再通过控制模块将一路图像数据进行分解，示例性的，比如一路为可见光图像，一路为红外图像。在其他的实施例中，相机输出的图像可以直接通过图像数据传输口传输到上位机。在获得融合图像之后，可以通过点云处理模块处理融合图像形成点云图像。也就是说，当上位机通过交互界面接收到操作者需求输出点云图时，同上述得到RGBD的步骤一样，只是多一步，将RGBD图输出至点云图生成模块，获得各成像点的三维坐标信息和对应的颜色信息，生成人脸的点云图至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出点云图。图14是本发明又一个实施例提出的3D全脸检测设备的方框示意图，相机使用黑白相机，红外光源为红外光光源，可见光源为红绿蓝三种灯，ISP图像处理模块集成在图像处理芯片中。当上位机通过交互界面接收到操作者需求输出RGB格式图像时，控制模块将RGB成像指令通过串口控制接口传输至微处理器，微处理器通过外部触发接口交替开启红绿蓝补光灯，并同步开启黑白相机，使相机接收到人脸反射的可见光后，曝光成像。当补光灯的红光启动时，同步启动黑白相机，黑白相机曝光输出带红光亮度信息的mono格式图像，当补光灯的绿光启动时，同步启动黑白相机，黑白相机曝光输出带绿光亮度信息的mono格式图像，当补光灯的蓝光启动时，同步启动黑白相机，黑白相机曝光输出带蓝光亮度信息的mono格式图像，即黑白相机间隔输出带红、绿、蓝光亮度信息的mono格式图像，其中带红、绿、蓝光亮度信息的mono格式图像，通过微处理器和图像传输接口传输至ISP图像处理模块，对三张图进行融合、黑电平校正、伽马校正、白平衡、色彩校正等操作，最终得到RGB/YUV等格式的彩色图像。当上位机通过交互界面接收到操作者需求输出深度图像时，控制模块将深度成像指令通过串口控制接口传输至微处理器，微处理器控制结构光投射器开始打光，并同步开启黑白相机，使相机接收到人脸反射的结构光后，曝光成像，此时微处理器通过寄存器控制黑白相机输出mono格式图像，图像数据直接通过图像数据传输口传输至图像处理芯片，每个通道对应的都是像素单元对红外光响应的亮度值，控制模块启动深度处理模块处理该黑白图，一般深度处理模块会对mono格式图像进行预处理、块匹配、深度计算等操作，最终输出人脸的深度图至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出深度图。当上位机通过交互界面接收到操作者需求输出RGBD图时，控制模块将RGBD成像指令通过串口控制接口传输至微处理器，微处理器控制红绿蓝三色补光灯及结构光投射器间隔打光；当补光灯的红光启动时，同步启动黑白相机，黑白相机曝光输出带红光亮度信息的mono格式图像，当补光灯的绿光启动时，同步启动黑白相机，黑白相机曝光输出带绿光亮度信息的mono格式图像，当补光灯的蓝光启动时，同步启动黑白相机，黑白相机曝光输出带蓝光亮度信息的mono格式图像，当结构光投射器启动时，同步启动黑白相机，黑白相机曝光输出带红外光亮度信息的mono格式图像，即黑白相机间隔输出带红、绿、蓝、红外光亮度信息的mono格式图像，其中带红、绿、蓝光亮度信息的mono格式图像通过微处理器和图像传输接口传输至ISP图像处理模块，对三张图进行融合、黑电平校正、伽马校正、白平衡、色彩校正等操作，最终得到RGB/YUV等格式的彩色图像，带红外光亮度信息的mono格式图像传输出至深度处理模块，经处理后得到深度图，后将彩色图与深度图均输出至图像融合模块，对彩色图的每个像素点附深度值或对深度图的每个像素点附颜色值，最终输出RGBD图至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出RGBD图。该实施例中，每个像素点的颜色信息是通过每个像素实际感光亮度值计算得到，颜色更加准确真实。在获得融合图像之后，可以通过点云处理模块处理融合图像形成点云图像。也就是说，当上位机通过交互界面接收到操作者需求输出点云图时，同上述得到RGBD的步骤一样，只是多一步，将RGBD图输出至点云图生成模块，获得各成像点的三维坐标信息和对应的颜色信息，生成人脸的点云图至图像输出模块，控制模块通过操作者的需求控制图像输出模块，输出点云图。图11是本发明又一个实施例提出的3D全脸检测设备的方框示意图。在该实施例中，3D全脸检测设备的检测方法，包括以下步骤：上位机接收用户输入的用户指令，并生成紫外图像生成指令发送至主板；主板接收紫外图像生成指令，并根据紫外图像生成指令控制紫外光源点亮，控制相机启动以采集用户脸部的图像并输出用户图像，ISP图像处理模块对用户图像进行处理，形成紫外图像，上位机对紫外图像进行显示；上位机接收用户输入的用户指令，并生成深度图像生成指令发送至主板；主板接收深度图像生成指令，并根据深度图像生成指令控制红外光源点亮，控制相机启动以采集用户脸部的图像并输出用户图像；若用户图像为RAW格式图像或RGB格式图像或YUV格式图像，则ISP图像处理模块对RAW格式图像或RGB格式图像或YUV格式图像进行处理，形成mono格式图像，深度图像处理模块对mono格式图像进行深度处理形成深度图像，上位机对深度图像进行显示；若用户图像为mono格式图像，则深度图像处理模块对mono格式图像进行深度处理形成深度图像，上位机对深度图像进行显示；上位机接收用户输入的用户指令，并生成紫外与深度融合图像生成指令发送至主板；主板控制红外光源和紫外光源交替点亮；图像融合模块融合紫外图像和深度图像，形成紫外与深度融合图像，上位机对紫外与深度融合图像进行显示；上位机接收用户输入的用户指令，并生成紫外点云图像生成指令发送至主板；主板控制红外光源和紫外光源交替点亮；点云图像生成模块对紫外与深度融合图像进行处理，形成紫外点云图像，上位机对紫外点云图像进行显示。其中，该实施例中的紫外光源点亮的方式可以类比前一实施例的可见光源的点亮的方式，此处不再赘述。本发明另一方面实施例还提出了一种3D全脸检测设备的检测方法，包括以下步骤：上位机接收用户输入的用户指令，并生成偏振图像生成指令发送至主板；主板控制泛光投射器点亮；相机将原始曝光一次得到的一帧图像数据按照不同偏振方向分解成k个子帧图像数据输出；并赋值每个子帧图像数据对应的偏振方向，其中，k≥2。其中，图15是图10中同一偏振状态对应的感光像素单元输出的亮度值示意图，示例性的，比如超表面的微结构单元示意图中显示有四个，每个微结构单元对应四个感光像素单元，每个微结构单元可以将光束分成四种不同状态的偏振光束分别聚焦在四个不同的感光像素单元上，图15中示出了其中一种偏振状态对应的感光像素单元输出的亮度值，不同微结构单元对应的感光像素单元的亮度值输出依次为Y1,Y2,Y3,Y4，与其偏振状态不相同的像素对应的亮度输出值为0，对像素单元的亮度值为0的位置的亮度值可以通过周边有亮度值的像素单元插值计算来赋予新的亮度值，同样也可以直接将同一个微结构单元对应的四个像素单元的亮度值赋值为一样的值，如图16所示。图16是处理后的图10中同一偏振状态对应的感光像素单元输出的亮度值示意图。在该实施例中，若要获取偏振图像，则需要主板控制泛光投射器点亮，并执行上述步骤获取偏振图像。与相关技术相比，相关技术通过旋转偏振片的角度来获得不同状态的偏振光，实现方式需要外部机械结构的配合，整体相机一般偏大，不利于系统的小型化设计，且成本高，本实施例的结构利于小型化设计；相关技术搭配偏振片使用，对于偏振方向与偏振片不一致的光会被偏振片吸收或反射掉，不能参与有效成像，对光能量造成一定的浪费，本实施例将光束分解成多个偏振状态的光，不涉及对光的吸收和反射，光能利用率高，系统耗能少；相关技术需将光源调整为需求状态的偏振光后再采图，采图时间比较长，本实施例只需要一帧曝光就可以记录四种状态的偏振状态，高效快速。综上所述，根据本发明实施例提出的3D全脸检测设备，包括：不透光遮罩、以及位于不透光遮罩一侧设置的面罩和上位机，面罩包括：红外光源、可见光源、一个相机和主板；红外光源、可见光源、相机均与主板电连接，主板与上位机通信连接；上位机用于根据用户指令向主板发送第一图像生成指令，主板用于根据第一图像生成指令控制红外光源点亮或可见光源点亮，并控制相机启动以采集用户脸部的图像并输出用户图像；主板还用于将用户图像传送至上位机，上位机用于处理用户图像并进行显示；其中，相机的感光波段的波长范围为300nm-1200nm，第一图像生成指令包括彩色与深度融合图像生成指令、彩色图像生成指令、深度图像生成指令以及彩色点云图像生成指令中的至少一种；用户图像包括RAW格式图像、mono格式图像、RGB格式图像或YUV格式图像中的其中一种；其中，3D全脸检测设备还包括：深度处理模块、图像融合模块、点云图生成模块和ISP图像处理模块；ISP图像处理模块用于处理RAW格式图像或mono格式图像形成RGB格式图像或YUV格式图像，还用于处理RAW格式图像或RGB格式图像或YUV格式图像形成mono格式图像；深度处理模块用于处理mono格式图像形成深度图像；图像融合模块用于融合彩色图像和深度图像，形成彩色与深度融合图像；点云图生成模块用于基于融合图像生成点云图像。由此，通过不透光遮罩的设置，可以避免设备中滤光片的使用，减少设备的光学元件的布置，降低成本，减轻设备重量。另外，相机的感光波段为300nm-1200nm，基本包括了全波段成像，一个相机实现了多个相机的功能，使得最终成像的图像均在一个相机坐标系下，有利于图像的融合，减小融合图像的误差，提升了融合图像的精度，并且相机个数的减少，进一步缩小了设备的体积，减轻了设备了重量，降低了设备成本。应该理解，可以使用上面所示的各种形式的流程，重新排序、增加或删除步骤。例如，本发明中记载的各步骤可以并行地执行也可以顺序地执行也可以不同的次序执行，只要能够实现本发明的技术方案所期望的结果，本文在此不进行限制。上述具体实施方式，并不构成对本发明保护范围的限制。本领域技术人员应该明白的是，根据设计要求和其他因素，可以进行各种修改、组合、子组合和替代。任何在本发明的精神和原则之内所作的修改、等同替换和改进等，均应包含在本发明保护范围之内。
