标题title
一种基于云原生的多集群网关及其工作方法
摘要abst
本发明实施例提供一种基于云原生的多集群网关及其工作方法，所述网关包括：管理模块和多个集群；所述管理模块，用于进行网关的配置，将网关配置信息下发到各个集群的网关实例；每个集群包括：代理模块、配置存储中间件和网关实例；所述代理模块，用于接收所述管理模块下发的网关配置信息，并将所述网关配置信息下发到所述配置存储中间件；所述配置存储中间件，用于存储所述网关配置信息；所述网关实例，用于从所述配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力。不同业务需要网关实例隔离，而现有的云网关无法统一管理基于业务纵向扩展的网关实例。本发明实施例多集群网关，可以解决多实例多集群网关统一纳管问题。
权利要求书clms
1.一种基于云原生的多集群网关，其特征在于，包括：管理模块和多个集群；所述管理模块，用于进行网关的配置，将网关配置信息下发到各个集群的网关实例；每个集群包括：代理模块、配置存储中间件和网关实例；所述代理模块，用于接收所述管理模块下发的网关配置信息，并将所述网关配置信息下发到所述配置存储中间件；所述配置存储中间件，用于存储所述网关配置信息；所述网关实例，用于从所述配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力。2.根据权利要求1所述的基于云原生的多集群网关，其特征在于，不同网关实例以实例名作为区分，同一集群下相同实例名的网关实例视为同一网关实例的多个节点；在同一个集群中多个网关实例共用一个配置存储中间件或者网关实例与配置存储中间件一一对应；每个网关实例承载一个或多个业务流量；所述网关实例，具体用于当业务侧的请求到达时，根据业务侧的请求的信息和预先配置的路由规则，确定业务侧的请求应该被转发到的后端服务，将业务侧的请求转发给所述后端服务，并将所述后端服务的响应返回给业务侧。3.根据权利要求1所述的基于云原生的多集群网关，其特征在于，所述管理模块包括：管理模块前端和管理模块后端，所述管理模块前端用于作为用户交互图形化界面，接收用户输入的网关配置信息和/或管理信息；所述管理模块后端包括实例纳管子模块，用于：响应于部署指令，在集群中部署好目标集群的具有预设实例名的网关实例和目标集群的代理模块；将所述预设实例名配置到所述目标集群的代理模块的环境变量中；响应于配置指令，配置所述目标集群的集群名和所述目标集群的代理模块的服务地址；定时轮询所述目标集群的代理模块的服务地址，接收所述代理模块返回的预设实例名，其中所述代理模块通过读取环境变量获得配置的预设实例名；感知到具有预设实例名的网关实例，并且根据所述代理模块返回的预设实例名更新实例表以将具有预设实例名的网关实例纳管进来；所述实例表中包括多条记录，每条记录包括一一对应地存储的实例名、集群名和集群代理模块服务地址；所述管理模块前端，还用于响应于用户的切换指令，切换到所述具有预设实例名的网关实例的配置界面，接收用户对所述具有预设实例名的网关实例的配置信息。4.根据权利要求3所述的基于云原生的多集群网关，其特征在于，所述管理模块前端，还用于响应于用户在管理模块的前端界面上切换到具有预设实例名的网关实例并维护网关配置，根据前端界面上的操作向所述管理模块后端发送维护网关配置的http请求；所述管理模块后端还包括网关配置信息下发子模块，用于：收到所述请求后，将所述网关配置信息保存到数据库；根据目标集群的集群名查询出所述目标集群的代理模块的服务地址；根据所述目标集群的代理模块的服务地址构造出代理模块接口，通过所述代理模块接口下发网关配置信息到目标集群中的网关实例；目标集群的代理模块，用于在收到所述请求后，把所述网关配置信息写入到具有预设实例名的目标网关实例对应的配置存储中间件；具有预设实例名的目标网关实例，用于感知到路由配置变更，根据实例名重新加载最新的网关配置，对外提供网关能力。5.一种基于云原生的多集群网关的工作方法，其特征在于，所述方法包括：管理模块进行网关的配置，将网关配置信息下发到各个集群的网关实例；本集群中的代理模块接收所述管理模块下发的网关配置信息，并将所述网关配置信息下发到本集群中的配置存储中间件；本集群中的网关实例从所述配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力。6.根据权利要求5所述的基于云原生的多集群网关的工作方法，其特征在于，不同网关实例以实例名作为区分，同一集群下相同实例名的网关实例视为同一网关实例的多个节点；在同一个集群中多个网关实例共用一个配置存储中间件或者网关实例与配置存储中间件一一对应；每个网关实例承载一个或多个业务流量；所述方法还包括：当业务侧的请求到达时，网关实例根据业务侧的请求的信息和预先配置的路由规则，确定业务侧的请求应该被转发到的后端服务，将业务侧的请求转发给所述后端服务，并将所述后端服务的响应返回给业务侧。7.根据权利要求5所述的基于云原生的多集群网关的工作方法，其特征在于，所述管理模块包括：管理模块前端，用于作为用户交互图形化界面，接收用户输入的网关配置信息和/或管理信息；以及管理模块后端；所述方法还包括：管理模块后端响应于部署指令，在集群中部署好目标集群的具有预设实例名的网关实例和目标集群的代理模块；管理模块后端将所述预设实例名配置到所述目标集群的代理模块的环境变量中；管理模块后端响应于配置指令，配置所述目标集群的集群名和所述目标集群的代理模块的服务地址；管理模块后端定时轮询所述目标集群的代理模块的服务地址，接收所述代理模块返回的预设实例名，其中所述代理模块通过读取环境变量获得配置的预设实例名；管理模块后端感知到具有预设实例名的网关实例，并且根据所述代理模块返回的预设实例名更新实例表以将具有预设实例名的网关实例纳管进来；所述实例表中包括多条记录，每条记录包括一一对应地存储的实例名、集群名和集群代理模块服务地址；管理模块前端响应于用户的切换指令，切换到所述具有预设实例名的网关实例的配置界面，接收用户对所述具有预设实例名的网关实例的配置信息。8.根据权利要求7所述的基于云原生的多集群网关的工作方法，其特征在于，所述的管理模块进行网关的配置，将网关配置信息下发到各个集群的网关实例，具体包括：所述管理模块前端响应于用户在管理模块的前端界面上切换到具有预设实例名的网关实例并维护网关配置，根据前端界面上的操作向所述管理模块后端发送维护网关配置的http请求；所述管理模块后端收到所述请求后，将与维护网关配置操作相关联的网关配置信息保存到数据库；根据目标集群的集群名查询出所述目标集群的代理模块的服务地址；根据所述目标集群的代理模块的服务地址构造出代理模块接口，通过所述代理模块接口下发网关配置信息到目标集群中的网关实例；所述的本集群中的代理模块接收所述管理模块下发的网关配置信息，并将所述网关配置信息下发到本集群中的配置存储中间件，具体包括：目标集群的代理模块在收到所述请求后，把所述网关配置信息写入到具有预设实例名的目标网关实例对应的配置存储中间件；所述的本集群中的网关实例从所述配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力，具体包括：具有预设实例名的目标网关实例感知到路由配置变更，根据实例名重新加载最新的网关配置，对外提供网关能力。9.一种计算机可读存储介质，其上存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现如权利要求1-4中任意一项所述的基于云原生的多集群网关的工作方法。10.一种计算机设备，其特征在于，其包括：一个或多个处理器；存储装置，用于存储一个或多个程序；当所述一个或多个程序被所述一个或多个处理器执行时，使得所述一个或多个处理器实现如权利要求1-4中任一所述的基于云原生的多集群网关的工作方法。
说明书desc
技术领域本发明涉及云原生网关，具体涉及一种基于云原生的多集群网关及其工作方法。背景技术业内常见的云原生网关采用控制面、数据面和配置存储的方式。其中控制面用于下发网关路由信息、上游服务的配置等各项配置信息到存储中间件。具体地，控制面负责管理网关的各项配置信息，包括路由规则、上游服务的地址、负载均衡策略、安全策略等。控制面将经过管理的配置信息下发到配置存储中间件中，以便数据面实例可以从存储中间件中加载配置信息。控制面能够实时地响应配置的变化，将更新后的配置信息下发到存储中间件，以便数据面实例可以及时获取最新的配置信息。数据面从存储中间件中加载网关配置，对外提供负载均衡、权限安全、限流、熔断，请求响应改写等各项能力，如图1所示。负载均衡功能是指根据预先配置的负载均衡策略，将请求分发到后端服务实例，以实现流量的均衡分配。权限安全功能是指执行访问控制、认证、授权等安全策略，确保只有经过授权的请求可以访问后端服务。限流功能是指对请求进行限流，防止突发流量对后端服务造成影响，保护后端服务的稳定性。熔断功能是指根据预设的熔断策略，对异常请求进行熔断处理，避免异常请求对后端服务造成连锁影响。请求响应改写功能是指根据配置对请求和响应进行修改，例如添加、删除或修改请求头、响应头等信息。在实现本发明过程中，发明人发现现有技术中至少存在如下问题：现有的云原生网关尽管能横向扩展支持多实例，但仍旧无法解决基于业务的纵向扩展多实例统一纳管问题。发明内容有鉴于此，本发明实施例的目的在于提供一种基于云原生的多集群网关及其工作方法，以解决现有技术中的上述问题。为达上述目的，第一方面，本发明实施例提供了一种基于云原生的多集群网关，其包括：管理模块和多个集群；所述管理模块，用于进行网关的配置，将网关配置信息下发到各个集群的网关实例；每个集群包括：代理模块、配置存储中间件和网关实例；所述代理模块，用于接收所述管理模块下发的网关配置信息，并将所述网关配置信息下发到所述配置存储中间件；所述配置存储中间件，用于存储所述网关配置信息；所述网关实例，用于从所述配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力。在一些可能的实施方式中，不同网关实例以实例名作为区分，同一集群下相同实例名的网关实例视为同一网关实例的多个节点；在同一个集群中多个网关实例共用一个配置存储中间件或者网关实例与配置存储中间件一一对应；每个网关实例承载一个或多个业务流量；所述网关实例，具体用于当业务侧的请求到达时，根据业务侧的请求的信息和预先配置的路由规则，确定业务侧的请求应该被转发到的后端服务，将业务侧的请求转发给所述后端服务，并将所述后端服务的响应返回给业务侧。在一些可能的实施方式中，所述管理模块包括：管理模块前端和管理模块后端，所述管理模块前端用于作为用户交互图形化界面，接收用户输入的网关配置信息和/或管理信息；所述管理模块后端包括实例纳管子模块，用于：响应于部署指令，在集群中部署好目标集群的具有预设实例名的网关实例和目标集群的代理模块；将所述预设实例名配置到所述目标集群的代理模块的环境变量中；响应于配置指令，配置所述目标集群的集群名和所述目标集群的代理模块的服务地址；定时轮询所述目标集群的代理模块的服务地址，接收所述代理模块返回的预设实例名，其中所述代理模块通过读取环境变量获得配置的预设实例名；感知到具有预设实例名的网关实例，并且根据所述代理模块返回的预设实例名更新实例表以将具有预设实例名的网关实例纳管进来；所述实例表中包括多条记录，每条记录包括一一对应地存储的实例名、集群名和集群代理模块服务地址；所述管理模块前端，还用于响应于用户的切换指令，切换到所述具有预设实例名的网关实例的配置界面，接收用户对所述具有预设实例名的网关实例的配置信息。在一些可能的实施方式中，所述管理模块前端，还用于响应于用户在管理模块的前端界面上切换到具有预设实例名的网关实例并维护网关配置，根据前端界面上的操作向所述管理模块后端发送维护网关配置的http请求；所述管理模块后端还包括网关配置信息下发子模块，用于：收到所述请求后，将与维护网关配置操作相关联的网关配置信息保存到数据库；根据目标集群的集群名查询出所述目标集群的代理模块的服务地址；根据所述目标集群的代理模块的服务地址构造出代理模块接口，通过所述代理模块接口下发网关配置信息到目标集群中的网关实例；目标集群的代理模块，用于在收到所述请求后，把所述网关配置信息写入到具有预设实例名的目标网关实例对应的配置存储中间件；具有预设实例名的目标网关实例，用于感知到路由配置变更，根据实例名重新加载最新的网关配置，对外提供网关能力。在一些可能的实施方式中，所述代理模块，还用于收集和查询集群内的运行状态监测信息，上报所述集群内信息给所述管理模块；所述管理模块用于根据上报的所述集群内的运行状态监测信息对本集群进行管理或调整。第二方面，提供一种基于云原生的多集群网关的工作方法，所述方法包括：管理模块进行网关的配置，将网关配置信息下发到各个集群的网关实例；本集群中的代理模块接收所述管理模块下发的网关配置信息，并将所述网关配置信息下发到本集群中的配置存储中间件；本集群中的网关实例从所述配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力。在一些可能的实施方式中，不同网关实例以实例名作为区分，同一集群下相同实例名的网关实例视为同一网关实例的多个节点；在同一个集群中多个网关实例共用一个配置存储中间件或者网关实例与配置存储中间件一一对应；每个网关实例承载一个或多个业务流量；所述方法还包括：当业务侧的请求到达时，网关实例根据业务侧的请求的信息和预先配置的路由规则，确定业务侧的请求应该被转发到的后端服务，将业务侧的请求转发给所述后端服务，并将所述后端服务的响应返回给业务侧。在一些可能的实施方式中，所述管理模块包括：管理模块前端，用于作为用户交互图形化界面，接收用户输入的网关配置信息和/或管理信息；以及管理模块后端；所述方法还包括：管理模块后端响应于部署指令，在集群中部署好目标集群的具有预设实例名的网关实例和目标集群的代理模块；管理模块后端将所述预设实例名配置到所述目标集群的代理模块的环境变量中；管理模块后端响应于配置指令，配置所述目标集群的集群名和所述目标集群的代理模块的服务地址；管理模块后端定时轮询所述目标集群的代理模块的服务地址，接收所述代理模块返回的预设实例名，其中所述代理模块通过读取环境变量获得配置的预设实例名；管理模块后端感知到具有预设实例名的网关实例，并且根据所述代理模块返回的预设实例名更新实例表以将具有预设实例名的网关实例纳管进来；所述实例表中包括多条记录，每条记录包括一一对应地存储的实例名、集群名和集群代理模块服务地址；管理模块前端响应于用户的切换指令，切换到所述具有预设实例名的网关实例的配置界面，接收用户对所述具有预设实例名的网关实例的配置信息。在一些可能的实施方式中，所述的管理模块进行网关的配置，将网关配置信息下发到各个集群的网关实例，具体包括：所述管理模块前端响应于用户在管理模块的前端界面上切换到具有预设实例名的网关实例并维护网关配置，根据前端界面上的操作所述向管理模块后端发送维护网关配置的http请求；所述管理模块后端收到所述请求后，将与维护网关配置操作相关联的网关配置信息保存到数据库；根据目标集群的集群名查询出所述目标集群的代理模块的服务地址；根据所述目标集群的代理模块的服务地址构造出代理模块接口，通过所述代理模块接口下发网关配置信息到目标集群中的网关实例；所述的本集群中的代理模块接收所述管理模块下发的网关配置信息，并将所述网关配置信息下发到本集群中的配置存储中间件，具体包括：目标集群的代理模块在收到所述请求后，把所述网关配置信息写入到具有预设实例名的目标网关实例对应的配置存储中间件；所述的本集群中的网关实例从所述配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力，具体包括：具有预设实例名的目标网关实例感知到路由配置变更，根据实例名重新加载最新的网关配置，对外提供网关能力。第三方面，提供一种计算机可读存储介质，其上存储有计算机程序，所述计算机程序被处理器执行时实现如第二方面所述的基于云原生的多集群网关的工作方法。第四方面，提供一种计算机设备，其包括：一个或多个处理器；存储装置，用于存储一个或多个程序；当所述一个或多个程序被所述一个或多个处理器执行时，使得所述一个或多个处理器实现如第二方面所述的基于云原生的多集群网关的工作方法。上述技术方案具有如下有益效果：本发明实施例的基于云原生的多集群网关包括：管理模块和多个集群；所述管理模块，用于进行网关的配置，将网关配置信息下发到各个集群的网关实例；每个集群包括：代理模块、配置存储中间件和网关实例；所述代理模块，用于接收所述管理模块下发的网关配置信息，并将所述网关配置信息下发到所述配置存储中间件；所述配置存储中间件，用于存储所述网关配置信息；所述网关实例，用于从所述配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力。由于不同业务需要网关实例隔离，而现有的云网关无法统一管理基于业务纵向扩展的网关实例。本发明实施例多集群网关，可以解决多实例多集群网关统一纳管问题和基于业务纵向扩展问题。本发明实施例的多集群统一网关，可以解决多网关数据面统一管理问题，此外代理端可以做成适配器模式，对业内常见的网关例如apisix，kong进行纳管，完成网关配置的统一下发。对于大企业，本发明实施例对外提供服务的统一管理与出口；对内解耦业务侧流量，使业务流量更易于扩展，管理更加清晰。本发明实施例的多个实例基于同一个存储中间件和代理模块组成网关集群，管理模块通过代理模块实现多集群的管理。多集群、多实例的统一网关可以灵活应对业务流量规划与管理。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是现有技术的云原生网关的逻辑结构示意图；图2是本发明实施例的分布式多集群统一网关的逻辑结构功能框图；图3是本发明实施例的基于云原生的多集群网关的工作方法的整体流程图；图4是本发明实施例的实例纳管的流程图；图5是本发明实施例的控制面将网关配置信息下发到网关实例的流程图；图6是本发明实施例的多集群统一网关的功能框图；图7是本发明实施例的一种计算机设备的功能框图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。随着云计算时代的发展，大企业陆续使用云网关管理内部庞大的流量，云厂商也开始依托于云网关对外提供网关能力。因此，不同业务需要网关实例隔离，而现有的云网关无法统一管理基于业务纵向扩展的网关实例。本发明实施例多集群网关，可以解决多实例多集群网关统一纳管问题。如图2所示，本发明实施例提供了一种基于云原生的多集群网关，其包括：管理模块和多个集群；管理模块，用于进行网关的配置，将网关配置信息下发到各个集群的网关实例；每个集群包括：代理模块、配置存储中间件和网关实例；代理模块，用于接收管理模块下发的网关配置信息，并将网关配置信息下发到配置存储中间件；配置存储中间件，用于存储网关配置信息；网关实例，用于从配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力。在一些实施例中，不同网关实例以实例名作为区分，同一集群下相同实例名的网关实例视为同一网关实例的多个节点；在同一个集群中多个网关实例共用一个配置存储中间件或者网关实例与配置存储中间件一一对应；每个网关实例承载一个或多个业务流量；网关实例，具体用于当业务侧的请求到达时，根据业务侧的请求的信息和预先配置的路由规则，确定业务侧的请求应该被转发到的后端服务，将业务侧的请求转发给后端服务，并将后端服务的响应返回给业务侧。在一些实施例中，管理模块包括：管理模块前端和管理模块后端，该管理模块前端用于作为用户交互图形化界面，接收用户输入的网关配置信息和/或管理信息；管理模块后端包括实例纳管子模块，用于：响应于部署指令，在集群中部署好目标集群的具有预设实例名的网关实例和目标集群的代理模块；将预设实例名配置到目标集群的代理模块的环境变量中；响应于配置指令，配置目标集群的集群名和目标集群的代理模块的服务地址；定时轮询目标集群的代理模块的服务地址，接收代理模块返回的预设实例名，其中代理模块通过读取环境变量获得配置的预设实例名；感知到具有预设实例名的网关实例，并且根据代理模块返回的预设实例名更新实例表以将具有预设实例名的网关实例纳管进来；实例表中包括多条记录，每条记录包括一一对应地存储的实例名、集群名和集群代理模块服务地址；管理模块前端，还用于响应于用户的切换指令，切换到具有预设实例名的网关实例的配置界面，接收用户对具有预设实例名的网关实例的配置信息。在一些实施例中，管理模块前端，还用于响应于用户在管理模块的前端界面上切换到具有预设实例名的网关实例并维护网关配置，根据前端界面上的操作向管理模块后端发送维护网关配置的http请求；网关配置包括上游、路由、证书等，操作也包括新增、修改、删除。在一个示例中，这个请求可以是请求用户新增一条路由操作完成后，前端向后端发起的新增一条路由信息的http请求。上游指的是数据流向的源头，例如上一级网络设备或者服务提供商。在网关配置中，上游设置关联到网关如何与上游服务器或服务进行通信，这包括定义通信协议、端口号、数据传输格式等。路由决定了网络数据包从源地址到目的地址的传输路径。在网关配置中，路由设置涉及定义静态路由或动态路由协议，确保数据能够按照设定的最佳路径进行传输。数字证书用于验证通信双方的身份，确保数据传输的安全性。网关配置中的证书管理涉及生成、导入或更新证书，以及配置证书相关的加密算法和密钥长度等，用于加密通过网关传输的数据。管理模块后端还包括网关配置信息下发子模块，用于：收到请求后，将与维护网关配置操作相关联的网关配置信息保存到数据库；根据目标集群的集群名查询出目标集群的代理模块的服务地址；根据目标集群的代理模块的服务地址构造出代理模块接口，通过代理模块接口下发网关配置信息到目标集群中的网关实例；目标集群的代理模块，用于在收到请求后，把网关配置信息写入到具有预设实例名的目标网关实例对应的配置存储中间件；具有预设实例名的目标网关实例，用于感知到路由配置变更，根据实例名重新加载最新的网关配置，对外提供网关能力。在一些实施例中，代理模块，还用于收集和查询集群内的运行状态监测信息，上报集群内信息给管理模块；管理模块用于根据上报的集群内的运行状态监测信息对本集群进行管理或调整。以下进行更加详细的说明：图2是本发明实施例的分布式多集群统一网关的逻辑结构功能框图，如图2所示，本发明实施例的分布式多集群统一网关包含如下几个模块：管理模块：作为网关的控制台，在控制面进行网关的配置，可以将这些配置信息下发到各个集群的各个网关实例。控制台指的是用户交互界面或管理界面，是用户用来进行网关配置和管理的图形化界面。控制台提供了用户友好的操作界面，用户可以通过控制台进行网关配置、监控和管理等操作。控制面则是指网关系统中的一个功能模块，用于管理和控制网关的配置信息、路由规则、上游服务等。控制面负责将配置信息下发到配置存储中间件中，以便数据面实例可以从配置存储中间件中加载配置信息并应用到实际的数据流量处理中。存储层：用于存储配置信息，网关实例从存储层中加载网关配置，对外提供路由负载等能力。多个网关实例可以共用一个存储中间件。存储层是整个系统中用于存储数据的逻辑概念，而配置存储中间件是实际用于存储和管理数据的具体软件组件或服务。配置存储中间件是存储层的一部分，用于实现存储层的功能。在网关系统中，配置存储中间件用于存储网关的配置信息，以便网关实例可以从中加载配置信息并应用到实际的数据流量处理中。存储层为配置存储中间件的逻辑概念，用来负责存储网关配置。代理模块：作为集群的入口，一方面用于接收控制面下发的配置信息，并将该配置信息下发到配置存储中间件，另一方面用于收集和查询集群内信息，上报这些信息给控制面。具体来说，代理模块会负责收集集群内部的各种信息，例如节点的健康状态、负载情况、服务的运行状态等。这些信息对于控制面来说是非常重要的，可以帮助控制面更好地了解集群的运行情况，及时发现和处理问题。一旦代理模块收集到这些信息，它会将这些信息上报给控制面，以便控制面可以根据这些信息来做出相应的调整和决策。例如，如果代理模块发现某个上游服务中的其中某个节点无法工作，它可以将这个信息上报给控制面，控制面可以根据这个信息来进行负载均衡的调整。因此，代理模块在这里具有信息收集和上报功能，帮助控制面更好地了解集群的运行情况，从而实现对集群的动态管理和调整。网关实例：用于接收业务侧请求进行转发。实例有自己的实例名，不同实例以实例名作为区分，同一集群下相同实例名的实例视为同一实例的多个节点，各个实例从配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力。具体来说，当业务侧的请求到达网关实例时，网关实例会根据请求的信息以及预先配置的路由规则，确定请求应该被转发到哪个后端服务或应用程序。这个过程可能涉及到负载均衡策略的选择，以确保请求能够被均衡地分发到后端服务的各个实例上。一旦确定了请求应该被转发到的后端服务，网关实例会将请求转发给后端服务，并将后端服务的响应再返回给业务侧。这样，网关实例就起到了一个请求转发的作用，将业务侧的请求转发到后端服务，同时也可能会对请求和响应进行一些处理，如请求头的修改、响应的缓存等。如图3所示，本发明实施例提供一种基于云原生的多集群网关的工作方法，该方法包括：S110：管理模块进行网关的配置，将网关配置信息下发到各个集群的网关实例；S120：本集群中的代理模块接收管理模块下发的网关配置信息，并将网关配置信息下发到本集群中的配置存储中间件；S130：本集群中的网关实例从配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力。在一些实施例中，不同网关实例以实例名作为区分，同一集群下相同实例名的网关实例视为同一网关实例的多个节点；在同一个集群中多个网关实例共用一个配置存储中间件或者网关实例与配置存储中间件一一对应；每个网关实例承载一个或多个业务流量；该方法还包括：当业务侧的请求到达时，网关实例根据业务侧的请求的信息和预先配置的路由规则，确定业务侧的请求应该被转发到的后端服务，将业务侧的请求转发给后端服务，并将后端服务的响应返回给业务侧。在一些实施例中，管理模块包括：管理模块前端，用于作为用户交互图形化界面，接收用户输入的网关配置信息和/或管理信息；以及管理模块后端；该方法还包括：管理模块后端响应于部署指令，在集群中部署好目标集群的具有预设实例名的网关实例和目标集群的代理模块；管理模块后端将预设实例名配置到目标集群的代理模块的环境变量中；管理模块后端响应于配置指令，配置目标集群的集群名和目标集群的代理模块的服务地址；管理模块后端定时轮询目标集群的代理模块的服务地址，接收代理模块返回的预设实例名，其中代理模块通过读取环境变量获得配置的预设实例名；管理模块后端感知到具有预设实例名的网关实例，并且根据代理模块返回的预设实例名更新实例表以将具有预设实例名的网关实例纳管进来；实例表中包括多条记录，每条记录包括一一对应地存储的实例名、集群名和集群代理模块服务地址；管理模块前端响应于用户的切换指令，切换到具有预设实例名的网关实例的配置界面，接收用户对具有预设实例名的网关实例的配置信息。在一些实施例中，步骤S110中的管理模块进行网关的配置，将网关配置信息下发到各个集群的网关实例，具体包括：管理模块前端响应于用户在管理模块的前端界面上切换到具有预设实例名的网关实例并维护网关配置，前端界面上的操作会向管理模块后端发送维护网关配置的http请求；网关配置包括上游、路由、证书等，操作也包括新增、修改、删除；管理模块后端收到请求后，将与维护网关配置操作相关联的网关配置信息保存到数据库；根据目标集群的集群名查询出目标集群的代理模块的服务地址；根据目标集群的代理模块的服务地址构造出代理模块接口，通过代理模块接口下发网关配置信息到目标集群中的网关实例；步骤S120中的本集群中的代理模块接收所述管理模块下发的网关配置信息，并将所述网关配置信息下发到本集群中的配置存储中间件，具体包括：目标集群的代理模块在收到请求后，把网关配置信息写入到具有预设实例名的目标网关实例对应的配置存储中间件；步骤S130中的本集群中的网关实例从所述配置存储中间件中按实例名加载对应的网关配置信息，对外提供网关能力，具体包括：具有预设实例名的目标网关实例感知到路由配置变更，根据实例名重新加载最新的网关配置，对外提供网关能力。以下对上述方法进行更加详细的说明：本发明实施例纳管集群实例及分发配置到实例的技术方案如下：1.实例纳管的流程：图4是本发明实施例的实例纳管的流程图，如图4所示，其包括如下步骤：S11：运维人员在集群中部署好网关实例后及集群代理模块。本步骤响应于接收到配置指令、操作指令或部署指令，在集群中部署好网关实例后及集群代理模块。S12：将实例名instance_a配置或添加到集群的代理模块的环境变量中。将实例名添加到代理模块的环境变量中可以提高系统的灵活性、可移植性和安全性。具体地，通过将实例名添加到环境变量中，可以实现动态配置，在运行时，代理模块可以根据环境变量的取值来确定要连接的网关实例，而不需要修改代码或重新部署。通过环境变量的方式，可以在不同的环境中轻松地部署和运行代理模块，而不需要修改代码，这样可以提高系统的灵活性和可移植性。将实例名存储在环境变量中可以提高安全性，因为敏感信息不会直接硬编码在代码中，减少了泄露的风险。S13：运维人员在管理模块配置集群名及集群的代理模块的服务地址。本步骤响应于接收到配置指令，执行相应的配置操作。管理模块需要与代理模块进行通信和交互，以下发配置信息、接收状态信息等，因此管理模块需要知道代理模块的服务地址，以便建立通信连接。通过配置代理模块的服务地址，可以实现动态配置，如果代理模块的服务地址发生变化，管理模块可以通过修改配置来适应变化，而不需要修改代码或重新部署。通过配置代理模块的服务地址，可以在不同的环境中轻松地部署和运行管理模块，而不需要硬编码代理模块的地址，这样可以提高系统的灵活性和可移植性。S14：管理模块定时轮询集群的代理模块的服务地址，代理模块通过读取环境变量，获得配置的实例名instance_a返回给管理模块。S15：管理模块感知到网关实例instance_a，并且根据代理模块返回的实例instance_a信息更新实例表。在本例中， instance_a被管理模块感知并且纳管进来。此时实例表中关于实例intance_a的记录如表1:表1：实例表S16：纳管完成。S17：管理模块前端可以切换到实例instance_a进行配置。用户可以在管理模块前端界面选择切换不同的网关实例，当用户切换到实例instance_a时，用户在管理模块前端界面上配置上游、路由等网关信息，都将在实例instance_a上生效。上述的用户在管理模块前端界面上配置上游、路由等网关信息，是指用户通过管理模块提供的图形化界面，在前端页面上进行设置和配置，以定义网关实例的上游服务和路由规则等相关信息，从而影响网关实例对请求的处理和转发。具体地，用户会在管理模块的前端界面上进行以下操作：配置上游服务：用户可以指定网关实例需要连接的上游服务，包括上游服务的地址、端口、协议等信息。这些信息可以帮助网关实例将请求转发到正确的上游服务。配置路由规则：用户可以定义路由规则，指定不同的请求应该被转发到哪个上游服务，以及如何进行请求的转发和处理。这些路由规则可以包括路径匹配、请求方法、请求头等条件，以及对应的上游服务信息。通过在管理模块的前端界面上进行这些配置，用户可以定制化地定义网关实例的行为，以满足特定的业务需求和场景。一旦用户完成了这些配置，这些配置信息将会被保存并生效在用户选择的网关实例上，从而影响网关实例的行为和请求处理。图5是本发明实施例的控制面将网关配置信息下发到网关实例的流程图，如图5所示，控制面将网关配置信息下发到网关实例的流程如下：管理模块后端及集群代理模块接口均遵守restful规范构建，路径格式如下：管理模块：{管理模块后端地址}/gateway/apiserver/v1/clusters/{集群名}/instances/{实例名}/{resources}。代理模块：{代理模块服务地址}/agent/apiserver/v1/instances/{实例名}/{resources}。S21：用户在管理模块的前端界面上切换到实例instance_a并执行维护网关配置操作，例如新增一条路由。S22：管理模块前端将向管理模块后端发送请求，格式如下：gateway/apiserver/v1/clusters/{集群名}/instances/{实例名}/route。具体地为：POST{管理模块后端地址}/gateway/apiserver/v1/clusters/cluster_default/instances/intance_a/route。管理模块后端指的是管理模块的后端服务或后端系统，它通常是一个运行在服务器端的应用程序，负责处理业务逻辑、数据存储、与数据库交互等功能。管理模块的后端通常提供API接口，用于接收和处理来自前端的请求，并进行相应的业务逻辑处理。而管理模块前端则指的是管理模块的前端界面，其是一个运行在用户浏览器中的Web应用程序，用于向用户展示界面、接收用户输入、发起请求等。管理模块的前端通过浏览器与用户进行交互，向用户展示可视化的界面，以便用户进行操作和配置。S23：管理模块后端收到上述请求后，先将配置信息保存到数据库。S24：管理模块后端再根据集群名cluster_default查询出集群的代理模块的服务地址cluster_default_svc。S25：最后管理模块通过请求代理模块接口下发配置信息到集群实例，格式如下：{代理模块服务地址}/agent/apiserver/v1/instances/{实例名}/route。具体地为：POST{cluster_default_svc}/agent/apiserver/v1/instances/intance_a/route。用户在界面上对网关配置的增删改查都是操作的数据库，数据库生效以后，再通过代理模块下发到集群的配置存储中间件中，网关实例从配置存储中间件加载配置对外提供负载能力。数据库是给管理模块用的，负责存储系统各集群所有实例的配置，各个实例的数据按instance这个字段隔离。配置存储中间件是集群层面的，存储着能让网关工作的配置。配置信息指的是管理模块后端收到的关于维护网关配置操作例如但不限于新增一条路由的具体配置内容。这些配置信息可以包括路由的路径、请求方法、目标服务的地址、负载均衡策略、安全策略等。具体地，可以包括以下内容：路由规则，其定义了请求的路径匹配规则，以及匹配成功后的转发目标。上游服务信息，其包括上游服务的地址、端口、协议等信息，用于指定请求应该被转发到哪个上游服务。负载均衡策略，其定义了请求应该如何被分发到后端服务的各个实例上。安全策略，其包括访问控制、认证、授权等安全相关的配置信息。代理模块接口是代理模块提供的用于接收配置信息并下发到集群实例的API接口。而代理模块的服务地址则是代理模块的网络地址，用于标识代理模块在网络中的位置。当管理模块需要向代理模块发起请求时，需要使用代理模块的服务地址来构造请求的URL，以便能够正确地发送请求到代理模块。因此，代理模块接口与代理模块的服务地址是相关联的，通过代理模块的服务地址可以构造出代理模块接口的完整请求URL。S26：集群的代理模块收到请求后，把路由信息保存或写入到实例instance_a对应的配置存储中间件中。即代理模块按实例名将路由写到存储。这里的路由route是前面提到的配置信息。路由route指的是管理模块后端收到的新增一条路由的具体配置内容，包括路由的路径、请求方法、目标服务的地址、负载均衡策略、安全策略等信息。S27：网关实例instance_a感知到路由配置变更，根据实例名重新加载最新的网关配置，对外提供能力。图6是本发明实施例的多集群统一网关的功能框图，如图6所示，网关实例instance_a纳管及配置完成后，由系统管理员或运维人员根据实际的各个业务来统一规划业务流量、管理实例，网关实例instance_a作为多集群统一网关，诸多网关实例中的一个承载一个业务或者多个业务的流量。作为举例，网关实例instance_a承载业务A流量，网关实例instance_e承载业务E流量和业务F流量。在一些替代实施例中，可以采用etcd作为网关的存储中间件，业内云原生网关可以采用关系型数据库作为替代方案，例如mysql，postgresql。etcd是一个开源的、分布式的键值存储系统，它被设计用于可靠地存储关键数据，并且能够提供高可用性和一致性。etcd用于存储分布式系统中的配置数据、元数据和状态信息，以及作为分布式协调服务的后端存储。在一些替代实施例中，可以采用apisix作为标品输出的网关实例，也可采用kong。APISIX是一个基于OpenResty的动态API网关，它提供了高性能的API网关功能，支持动态路由、负载均衡、限流、熔断等功能，同时具有灵活的插件扩展机制。Kong是一个API网关和微服务管理平台，它提供了API网关、服务发现、负载均衡、认证授权等功能，并且支持插件扩展。上述技术方案的有益技术效果在于：本发明实施例的多集群统一网关，可以解决多网关数据面统一管理问题，此外代理端可以做成适配器模式，对业内常见的网关例如apisix，kong进行纳管，完成网关配置的统一下发。对于大企业，本发明实施例对外提供服务的统一管理与出口；对内解耦业务侧流量，使业务流量更易于扩展，管理更加清晰。本发明实施例的多个实例基于同一个存储中间件和代理模块组成网关集群，管理模块通过代理模块实现多集群的管理。多集群、多实例的统一网关可以灵活应对业务流量规划与管理。所属领域的技术人员可以清楚地了解到，为了描述的方便和简洁，仅以上述各功能单元、模块的划分进行举例说明，实际应用中，可以根据需要而将上述功能分配由不同的功能单元、模块完成，即将所述装置的内部结构划分成不同的功能单元或模块，以完成以上描述的全部或者部分功能。实施例中的各功能单元、模块可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中，上述集成的单元既可以采用硬件的形式实现，也可以采用软件功能单元的形式实现。另外，各功能单元、模块的具体名称也只是为了便于相互区分，并不用于限制本申请的保护范围。上述系统中单元、模块的具体工作过程，可以参考前述方法实施例中的对应过程，在此不再赘述。本发明实施例还提供了一种计算机可读存储介质，计算机可读存储介质内存储有计算机程序，计算机程序被处理器执行时实现上述一种基于云原生的多集群网关的工作方法的各步骤。所述集成的模块/单元如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本发明实现上述实施例方法中的全部或部分流程，也可以通过计算机程序来指令相关的硬件来完成，所述的计算机程序可存储于一计算机可读存储介质中，该计算机程序在被处理器执行时，可实现上述各个方法实施例的步骤。其中，所述计算机程序包括计算机程序代码，所述计算机程序代码可以为源代码形式、对象代码形式、可执行文件或某些中间形式等。所述计算机可读介质可以包括：能够携带所述计算机程序代码的任何实体或装置、记录介质、U盘、移动硬盘、磁碟、光盘、计算机存储器、只读存储器、随机存取存储器、电载波信号、电信信号以及软件分发介质等。当然，还有其他方式的可读存储介质，例如量子存储器、石墨烯存储器等等。需要说明的是，所述计算机可读介质包含的内容可以根据司法管辖区内立法和专利实践的要求进行适当的增减，例如在某些司法管辖区，根据立法和专利实践，计算机可读介质不包括电载波信号和电信信号。本发明实施例还提供了一种计算机设备，如图7所示，包括一个或多个处理器301、通信接口302、存储器303和通信总线304，其中，处理器301，通信接口302，存储器303通过通信总线304完成相互间的通信。存储器303，用于存放计算机程序；处理器301，用于执行存储器303上所存放的程序时，实现上述.一种基于云原生的多集群网关的工作方法的各步骤。处理器301可以是通用处理器，包括中央处理器、网络处理器等；还可以是数字信号处理器、专用集成电路、现场可编程门阵列或者其他可编程逻辑器件、分立门或者晶体管逻辑器件、分立硬件组件。存储器303可以包括用于数据或指令的大容量存储器。举例来说而非限制，存储器303可包括硬盘驱动器、软盘驱动器、闪存、光盘、磁光盘、磁带或通用串行总线驱动器或者两个或更多个以上这些的组合。在合适的情况下，存储器303可包括可移除或不可移除的介质。在特定实施例中，存储器303是非易失性固态存储器。在特定实施例中，存储器303包括只读存储器。在合适的情况下，该ROM可以是掩模编程的ROM、可编程ROM、可擦除PROM、电可擦除PROM、电可改写ROM或闪存或者两个或更多个以上这些的组合。通信总线304包括硬件、软件或两者，用于将上述部件彼此耦接在一起。举例来说，总线可包括加速图形端口或其他图形总线、增强工业标准架构总线、前端总线、超传输互连、工业标准架构总线、无限带宽互连、低引脚数总线、存储器总线、微信道架构总线、外围组件互连总线、PCI-Express总线、串行高级技术附件总线、视频电子标准协会局部总线或其他合适的总线或者两个或更多个以上这些的组合。在合适的情况下，总线可包括一个或多个总线。尽管本发明实施例描述和示出了特定的总线，但本发明考虑任何合适的总线或互连。上述对本说明书特定实施例进行了描述。其它实施例在所附权利要求书的范围内。在一些情况下，在权利要求书中记载的动作或步骤可以按照不同于实施例中的顺序来执行并且仍然可以实现期望的结果。另外，在附图中描绘的过程不一定要求示出的特定顺序或者连续顺序才能实现期望的结果。在某些实施方式中，多任务处理和并行处理也是可以的或者可能是有利的。虽然本申请提供了如实施例或流程图的方法操作步骤，但基于常规或者无创造性的劳动可以包括更多或者更少的操作步骤。实施例中列举的步骤顺序仅仅为众多步骤执行顺序中的一种方式，不代表唯一的执行顺序。在实际中的装置或客户端产品执行时，可以按照实施例或者附图所示的方法顺序执行或者并行执行。本发明是参照根据本发明实施例的方法、设备、和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。本发明中应用了具体实施例对本发明的原理及实施方式进行了阐述，以上实施例的说明只是用于帮助理解本发明的方法及其核心思想；同时，对于本领域的一般技术人员，依据本发明的思想，在具体实施方式及应用范围上均会有改变之处，综上所述，本说明书内容不应理解为对本发明的限制。
