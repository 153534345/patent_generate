标题title
一种PIN码设备认证管理方法及装置
摘要abst
本发明公开了一种PIN码设备认证管理方法及装置，涉及信息安全技术领域，对PIN码设备使用非对称加密和对称加密组成数字信封格式，安全性有保障，在硬件系统中增加获取硬件系统信息模块、封装数字信封模块和解析数字信封模块，将PIN码写入到PIN码保护文件中并封装成数字信封，再根据数字信封解析出系统或硬件设备的唯一性信息，定位到具体的硬件系统，进一步解析出明文PIN码，从而避免客户遗忘设备PIN码，造成无法进行设备权限认证，无法登录系统进行后续业务操作。
权利要求书clms
1.一种PIN码设备认证管理方法，其特征在于，包括以下步骤：步骤1：硬件系统生成公私密钥对，根据加密算法、公私密钥对中的公钥和使用者生成申请者信息，并发送申请者信息至证书颁发机构申请证书；步骤2：证书颁发机构核实申请者信息，核实通过后颁发证书给硬件系统；步骤3：硬件系统对证书进行验证，验证通过后保存证书；步骤4：将PIN码输入硬件系统中并进行权限验证，验证通过后使用PIN码对应的PIN码设备登陆到硬件系统，登录成功后在PIN码设备中通过查询是否存在PIN码保护文件来判断是否为首次认证；如果为首次认证，则在PIN码设备中创建一个PIN码保护文件并进入步骤5，否则进入步骤6；步骤5：硬件系统利用证书的公钥采用加密算法加密随机对称密钥生成随机对称密钥密文，利用随机对称密钥采用加密算法加密PIN码生成PIN码密文，将随机对称密钥密文和PIN码密文制作成数字信封；步骤6：获取硬件系统中唯一性信息，将唯一性信息和数字信封以设定格式封装成新的数字信封并写入PIN码保护文件中；步骤7：在硬件系统中配置flag标志，如果flag标志表示忘记PIN码，则PIN码设备从PIN码保护文件中读取新的数字信封，并进入步骤8；否则利用PIN码及对应的PIN码设备登录硬件系统；步骤8：根据新的数字信封解析出唯一性信息，定位到对应的硬件系统；步骤9：从定位的硬件系统中获取证书，根据证书中公钥对应的私钥解密新的数字信封中的随机对称密钥密文，得到随机对称密钥，使用随机对称密钥解密PIN码密文，得出PIN码，利用PIN码及对应的PIN码设备登录硬件系统。2.根据权利要求1所述的一种PIN码设备认证管理方法，其特征在于，步骤3中硬件系统利用证书颁发机构公布的可信根证书验证颁发的证书中的机构签名、证书有效期，以及验证证书中的公钥和硬件系统中的公钥是否一致。3.根据权利要求1所述的一种PIN码设备认证管理方法，其特征在于，PIN码保护文件的读权限为任何人权限，写权限为PIN权限。4.根据权利要求1所述的一种PIN码设备认证管理方法，其特征在于，获取的硬件系统中的唯一性信息包括设备序列号，设定格式包括LV格式。5.根据权利要求1所述的一种PIN码设备认证管理方法，其特征在于，flag标志满足后才执行解密PIN码密文。6.根据权利要求1所述的一种PIN码设备认证管理方法，其特征在于，硬件系统中保存的证书为单证或双证，其中单证为签名证书，双证为签名证书和加密证书；保存单证时，硬件系统生成签名公私密钥对，向证书颁发机构申请证书，证书颁发机构颁发签名证书后，硬件系统根据可信根证书验证签名证书，如果签名证书中的公钥和签名公私密钥对中的公钥一致，则将签名证书保存在硬件系统中；保存双证时，硬件系统生成签名公私密钥对，向证书颁发机构申请证书，证书颁发机构生成签名证书、加密证书、加密密钥对和随机对称密钥，签名公私密钥对中的公钥加密随机对称密钥，随机对称密钥加密加密密钥对中的明文加密私钥生成密文私钥，将随机对称密钥密文和密文私钥封装成密钥数字信封,将签名证书、加密证书和数字信封下发给硬件系统后，硬件系统利用可信根证书中的公钥验证签名证书中的机构签名，如果验证通过，则使用签名公私密钥对中的私钥解密数字信封中的随机对称密钥密文，用解密后的随机对称密钥解密密文私钥获得明文加密私钥，如果解密出的明文加密私钥和加密证书中的公钥是一对，则将明文加密私钥、加密密钥对中的加密公钥、签名证书、加密证书保存至硬件系统；如果签名证书的验证不通过，则不保存签名证书和加密证书。7.一种PIN码设备认证管理装置，其特征在于，应用权利要求1-6任一项所述的一种PIN码设备认证管理方法，包括PIN码设备、硬件系统和证书颁发机构；硬件系统包括封装数字信封模块和解析数字信封模块；硬件系统，生成证书请求并发送至证书颁发机构，接收证书并进行验证保存，封装数字信封模块根据证书生成数字信封发送至PIN码设备，解析数字信封模块从PIN码设备中读取数字信封并解密获得PIN码；证书颁发机构，核实证书请求后向硬件系统颁发证书；PIN码设备，创建PIN码保护文件并写入数字信封。
说明书desc
技术领域本发明涉及信息安全技术领域，更具体的说是涉及一种PIN码设备认证管理方法及装置。背景技术随着信息技术的快速发展，信息安全已成为人们在信息空间中生存与发展的重要保证条件。PIN码做为信息安全的一种载体，作为权限认证的一种途径，有其各种应用场景，在使用过程中，经常有忘记PIN码情况，而用户忘记PIN码后需要重新做初始化、设备系统无法使用等各种情况。例如现有技术中：第一种，将密码直接存储至以时间信息为主键预先建立密码库中，但是该方法的密码存储于密码库中，未密文保存，安全性存在隐患；第二种，将密码备份至密码管理中心进行加密存储，可以通过忘记密码指令通过验证找回密码，但是这种方法的密码加密依赖键盘输入信息，对于软键盘这种密码输入输入方式并不适用，且加密方法不是最优的加密方法；第三种，通过生成包括公钥和私钥的公钥-私钥对并向远程密码管理服务器注册公钥，账户名称和密码可以与公钥相关联地存储在密码管理服务器处，通过向密码管理服务器发送包括公钥的请求，从存储的密码中确定密码并使用公钥对密码进行加密，获取公户装置获取加密密码后利用私钥进行解密，但是该方法的公私钥存储依赖用户装置，只使用了非对称加密，并未说明用户装置在使用过程中修改了密码后的认证过程。因此，在PIN码设备忘记PIN码后，如何实现安全找回PIN码是本领域技术人员亟需解决的问题。发明内容有鉴于此，本发明提供了一种PIN码设备认证管理方法及装置，使PIN码设备忘记PIN码后，能够重新找回，避免无法进入硬件设备、系统、重新格式化PIN码设备等，避免造成重大损失，即使中间使用过程中修改了用户设备PIN码，也能够进行PIN码找回。为了实现上述目的，本发明采用如下技术方案：一种PIN码设备认证管理方法，包括以下步骤：步骤1：硬件系统生成公私密钥对，根据加密算法、公私密钥对中的公钥和使用者生成申请者信息，并发送申请者信息至证书颁发机构申请证书；步骤2：证书颁发机构核实申请者信息，核实通过后颁发证书给硬件系统；步骤3：硬件系统对证书进行验证，验证通过后保存证书；步骤4：用户将PIN码输入硬件系统中并进行权限验证，验证通过后使用PIN码对应的PIN码设备登陆到硬件系统进行权限认证，登录成功后在PIN码设备中通过查询是否存在PIN码保护文件来判断是否为首次认证；如果为首次认证，则在PIN码设备中创建一个PIN码保护文件并进入步骤5，否则进入步骤6；步骤5：硬件系统利用证书中公私密钥对的公钥采用加密算法加密随机对称密钥生成随机对称密钥密文，利用随机对称密钥采用加密算法加密PIN码生成PIN码密文，将随机对称密钥密文和PIN码密文制作成数字信封并写入到PIN码设备；步骤6：PIN码设备获取硬件系统中唯一性信息，将唯一性信息和数字信封以设定格式封装成新的数字信封并写入PIN码保护文件中；步骤7：在硬件系统中配置flag标志，如果flag标志表示忘记PIN码，则PIN码设备从PIN码保护文件中读取新的数字信封传输至硬件系统，并进入步骤8；否则利用PIN码及对应的PIN码设备登录硬件系统；步骤8：硬件系统根据新的数字信封解析出唯一性信息，定位到对应的硬件系统；步骤9：将PIN码设备连接定位的硬件系统，从定位的硬件系统中获取证书，根据证书中公钥对应的私钥解密新的数字信封中的随机对称密钥密文，得到随机对称密钥，使用随机对称密钥解密PIN码密文，得出PIN码，利用PIN码及对应的PIN码设备登录硬件系统。上述技术方案的技术效果为，将唯一性信息和数字信封以设定格式写入到PIN码保护文件中，比如LV格式L+唯一性信息+L+数字信封，这个格式可以组成一个新的格式的数字信封，PIN码设备此时已经插在或者存放在硬件系统上，PIN码设备和硬件系统通信获取到新的格式的数字信封，然后先解析出前面的LV格式的硬件信息，就可以定位到具体的硬件系统，如果这个硬件信息是当前这台硬件系统的唯一性信息，那就可以使用这台硬件系统的私钥解密出后面的数字信封中的随机对称密钥，随机对称密钥就可以解析出PIN码，如果不是当前这台硬件系统的唯一性硬件信息，就需要将PIN码设备放到定位到的硬件系统上来重新执行解析数字信封模块来解析出明文PIN，不是对应的硬件系统，即使解密，也会解密数字信封失败，解密需要使用加密PIN码的公钥对应的私钥才能解密成功，也即只有定位到具体的硬件系统才能解密成功。优选的，加密算法包括非对称算法、对称算法和摘要算法，其中非对称算法可以为SM2、RSA、ECDSA、EdDSA、DSA，对称算法可以为SM1、SM4、SM7、DES、3DES、AES，摘要算法可以为SM3、SHA1、SHA224、SHA256、SHA384、SHA512。硬件系统利用证书的公钥采用非对称算法加密随机对称密钥，随机对称密钥采用对称算法加密PIN码。优选的，步骤3中硬件系统利用证书颁发机构公布的可信根证书验证颁发的证书中的机构签名、证书有效期，以及验证证书中的公钥和硬件系统中的公钥是否一致。证书有效期是为硬件系统颁发证书时由证书颁发机构确定的。硬件系统利用可信根证书采用摘要算法和非对称算法验证证书中的机构签名。优选的，PIN码保护文件的读权限为任何人权限，写权限为PIN权限，避免随意对PIN码保护文件内容进行写操作，只有使用PIN登陆后才能进行写操作。优选的，获取的硬件系统中的唯一性信息包括设备序列号，设定格式包括LV格式。优选的，flag标志满足后才执行解密PIN码密文。优选的，硬件系统中保存的证书为单证或双证，其中单证为签名证书，双证为签名证书和加密证书；保存单证时，硬件系统生成签名公私密钥对，向证书颁发机构申请证书，证书颁发机构颁发签名证书后，硬件系统根据可信根证书验证签名证书，如果签名证书中的公钥和签名公私密钥对中的公钥一致，则将签名证书保存在硬件系统中；保存双证时，硬件系统生成签名公私密钥对，向证书颁发机构申请证书，证书颁发机构生成签名证书、加密证书、加密密钥对和随机对称密钥；签名公私密钥对中的公钥加密随机对称密钥，随机对称密钥加密加密密钥对中的明文加密私钥生成密文私钥，将随机对称密钥密文和密文私钥封装成密钥数字信封,将签名证书、加密证书和密钥数字信封下发给硬件系统后，硬件系统根据可信根证书对签名证书进行验证，利用可信根证书中的公钥验证签名证书中的机构签名，如果验证通过，则使用签名公私密钥对中的私钥解密密钥数字信封中的随机对称密钥密文，用解密后的随机对称密钥解密密文私钥获得明文加密私钥，如果解密出的明文加密私钥和加密证书中的公钥是一对，则将明文加密私钥、加密密钥对中的加密公钥、签名证书、加密证书保存至硬件系统；如果签名证书的验证不通过，则不保存。优选的，硬件系统为具有密钥生成功能的硬件设备、系统，可以为服务器密码机、密钥管理系统等。一种PIN码设备认证管理装置，包括PIN码设备、硬件系统和证书颁发机构；硬件系统包括封装数字信封模块和解析数字信封模块；硬件系统，生成证书请求并发送至证书颁发机构，接收证书并进行验证保存，封装数字信封模块根据证书生成数字信封发送至PIN码设备，解析数字信封模块从PIN码设备中读取数字信封并解密获得PIN码；证书颁发机构，核实证书请求后向硬件系统颁发证书；PIN码设备，创建PIN码保护文件并写入数字信封。经由上述的技术方案可知，与现有技术相比，本发明公开提供了一种PIN码设备认证管理方法及装置，对PIN码设备使用非对称加密和对称加密组成数字信封格式，安全性有保障，在硬件系统中定制两个接口来处理解析数字信封功能，一个接口用来封装数字信封，封装完毕后将数字信封内容写到PIN码设备的PIN码保护文件中，一个接口用来从PIN码保护文件中读出数字信封后进行数字信封的解析，解析出最终的PIN码，方便易用，根据数字信封解析出系统或硬件设备的唯一性信息，定位到具体的硬件系统，进一步解析出明文PIN码，从而避免客户遗忘设备PIN码，造成无法进行设备权限认证，无法登录系统进行后续业务操作。本发明中需要有能够保存证书的硬件系统等和PIN码设备进行交互，进行权限认证，且解析用户密文PIN码不可随意解析，必须达到一定条件下才能执行，首先是客户真正忘PIN码，PIN码没有被锁死，硬件系统端可配置一个flag标志，只有flag标志满足后方可执行解密密文PIN码,可在硬件系统中增加获取硬件系统信息模块、封装数字信封模块和解析数字信封模块三个模块，获取硬件系统信息模块负责获取硬件系统中的相关信息，封装数字信封模块负责封装PIN码设备的PIN码组成数字信封，解析数字信封模块负责解析数字信封返回出PIN码设备原始PIN码；写到PIN码保护文件中时使用获取硬件系统信息模块、封装数字信封模块，忘记PIN码后进行获取明文PIN码时使用获取硬件系统信息模块、解析数字信封模块，定位到具体某硬件设备、系统，解析数字信封模块负责解析数字信封返回出PIN码设备原始PIN码。写入到硬件系统中的数字信封最终安全性依赖于私钥，因私钥不出设备、系统，外人拿不到私钥，无法解析数字信封，从而无法解密出对称密钥，解析不出明文PIN码，从而保证了密文PIN码的安全存储，进而解决了遗忘PIN码这一问题。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据提供的附图获得其他的附图。图1为本发明提供的一种PIN码设备认证管理装置结构示意图；图2为本发明提供的一种PIN码设备认证管理方法流程示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。本发明实施例公开了一种PIN码设备认证管理装置，如图1所示，包括PIN码设备、硬件系统和证书颁发机构；其中，PIN码设备安全存储用户PIN码：在用户首次使用PIN码设备登陆系统进行权限认证时，使用证书颁发机构签发的保存在硬件系统中的设备证书，用硬件系统中的证书和随机密钥对PIN码加密做成数字信封，使用随机密钥做对称密钥，对称密钥采用对称算法加密PIN码，使用证书中的公钥采用非对称算法加密对称密钥，这样做成数字信封格式，同时获取系统或硬件设备中的系统信息，比如设备序列号，将系统信息和数字信封以一定格式写到PIN码设备中的一个PIN码保护文件中。硬件系统证书：硬件系统证书由可信任的证书颁发机构CA签发，先由硬件系统生成签名密钥对，将算法、公钥、申请者信息等生成P10请求将P10请求发给CA，CA核实申请者信息后颁发对应证书，硬件系统验证证书合法性，在硬件系统申请证书之前已保存了CA公布的可信根证书，使用CA提供的可信根证书采用摘要算法和非对称算法验证颁发的证书中的CA签名，验证证书有效期等，验证证书中的公钥和硬件系统中的公钥是否一致，证书验证通过后保存在硬件系统中；如果硬件系统中证书是双证，下发签名证书同时，由CA生成加密密钥对和加密证书，加密密钥对保护方式可以由硬件系统中公私密钥对中的公钥保护一个对称密钥，对称密钥保护加密密钥对中的明文加密私钥生成密文私钥，最终组成数字信封，同签名证书和加密证书一同下发给硬件系统；硬件系统首先对签名证书进行验证，使用CA可信根证书验证签名证书中的CA签名，验证证书有效期等，然后使用公私密钥对中的私钥解密随机对称密钥，随机对称密钥解密密文私钥，同时根据密文私钥解密出的明文加密私钥和加密证书中的公钥做非对称加解密验证，判断公私钥是否为一对，验证通过后将明文加密私钥和加密密钥对中的加密公钥导入到硬件系统中，并将加密证书保存在硬件系统中，这样硬件系统中具备了双证书。PIN码设备解密用户PIN码：如果用户将PIN码忘记，从PIN码设备中的PIN码保护文件中读出其内容，读出数字信封，解析出硬件系统信息，定位到某个硬件系统，使用其中的私钥解密数字信封中的对称密钥密文，得到对称密钥明文，使用对称密钥明文解密PIN码密文，得出明文PIN码，从而解析出PIN码。整个过程只需要首次登陆成功后在密码设备中创建一个PIN码保护文件，文件权限，写权限为用户权限，读权限为任何人权限，这样能保证此文件只有具备用户权限后才能够进行写操作，避免随意更改其内容。该密码设备包括但不限于密码机、加密机、SSL VPN网关、IPSec VPN网关、签名验签服务器、金融数据密码机、USBKey、IC卡、具有密码实体、能够存储证书的设备、系统等。本实施例中，写入到硬件系统中的数字信封最终安全性依赖于私钥，因私钥不出设备、系统，外人拿不到私钥，无法解析数字信封，从而无法解密出对称密钥，解析不出明文PIN码，从而保证了密文PIN码的安全存储，进而解决了遗忘PIN码这一问题。在整个过程中，需要注意对PIN码的修改情况，因为一旦PIN码设备里面已经写了PIN码的保护信息，保护信息包含PIN码密文的信息，后面再修改PIN码设备的PIN码，会造成解密出的密码和当前密码不一致，即修改后的PIN码和PIN码设备中写入的PIN码保护信息中的PIN码不一致，因此如果修改了用户PIN码，需要重新做一次如上的登陆硬件系统操作，重新将修改后的PIN码封装成数字信封写入到PIN码保护文件中，覆盖之前的PIN码的保护信息。实施例2基于上述实施例，在一个具体实施方式中，一种PIN码设备认证管理方法如图2所示，包括以下步骤：S1：PIN码设备生成公私密钥对，根据加密算法、公私密钥对中的公钥和使用者生成申请者信息，发送申请者信息给证书颁发机构CA申请证书；S2：CA核实申请者具体信息组织成证书下发给硬件系统；S3：硬件系统接收证书并验证证书合法性，使用CA提供的根证书验证颁发的证书中的CA签名，验证证书有效期等，验证证书中的公钥和硬件系统中的公钥是否一致，证书验证通过后保存在硬件系统中；S3：用户使用PIN码设备登陆到硬件系统进行权限认证，可通过判断PIN码设备中是否存在PIN码保护文件来判断是否是首次登陆；首次认证后在PIN码设备中创建一个PIN码保护文件，保护文件读权限为任何人，写权限为PIN权限，这样能保证此文件只有具备用户权限后才能够进行写操作，避免随意更改其内容；S4：用硬件系统中保存的证书中的公钥和随机对称密钥对PIN码加密做成数字信封；S5：获取硬件系统中相关的唯一性信息，比如设备序列号，将唯一性信息和数字信封以一定格式写到PIN码设备中的PIN密码保护文件中；S6：硬件系统配置一个flag标志，只有flag标志满足后方可执行解密密文PIN码；如当flag=0时表示忘记PIN码，执行解密密文PIN码，当flag=1时表示未忘记PIN码；S7：在硬件系统中定制获取硬件系统信息模块、封装数字信封模块和解析数字信封模块三个模块，获取硬件系统信息模块负责获取硬件系统中的相关信息，封装数字信封模块负责封装PIN码设备的PIN码组成数字信封，解析数字信封模块负责解析数字信封返回出PIN码设备原始PIN码，写到PIN码保护文件中时使用获取硬件系统信息模块、封装数字信封模块，忘记PIN码后进行获取明文PIN码使用获取硬件系统信息模块、解析数字信封模块，定位到具体某硬件设备、系统，解析数字信封模块负责解析数字信封返回出原始PIN码。本说明书中各个实施例采用递进的方式描述，每个实施例重点说明的都是与其他实施例的不同之处，各个实施例之间相同相似部分互相参见即可。对于实施例公开的装置而言，由于其与实施例公开的方法相对应，所以描述的比较简单，相关之处参见方法部分说明即可。对所公开的实施例的上述说明，使本领域专业技术人员能够实现或使用本发明。对这些实施例的多种修改对本领域的专业技术人员来说将是显而易见的，本文中所定义的一般原理可以在不脱离本发明的精神或范围的情况下，在其它实施例中实现。因此，本发明将不会被限制于本文所示的这些实施例，而是要符合与本文所公开的原理和新颖特点相一致的最宽的范围。
