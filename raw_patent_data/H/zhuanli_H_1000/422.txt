标题title
一种用于隐私计算的大整数数据相除运算方法及系统
摘要abst
本发明公开了一种用于隐私计算的大整数数据相除运算方法及系统。该方法包括以下步骤：统计数据Y的有效比特长度、数据X的有效比特长度，计算出数据Y与数据X的有效比特长度差值；根据有效比特长度差值创建数据提取窗口，根据数据X生成预计算表；数据提取窗口将数据Y内的数据分段取出与预计算表进行计算，得到商和余数。本发明能够提高大整数数据相除的计算效率，减少计算时间、计算开销。
权利要求书clms
1.一种用于隐私计算的大整数数据相除运算方法，计算方持有作为被除数的数据Y和作为除数的数据X，其特征在于，包括以下步骤：S1：统计数据Y的有效比特长度、数据X的有效比特长度，计算出数据Y与数据X的有效比特长度差值；S2：根据有效比特长度差值创建数据提取窗口，根据数据X生成预计算表；S3：数据提取窗口将数据Y内的数据分段取出与预计算表进行计算，得到商和余数。2.根据权利要求1所述的一种用于隐私计算的大整数数据相除运算方法，其特征在于，所述步骤S2中创建数据提取窗口的方法包括以下步骤：N1：创建数据提取窗口，所述数据提取窗口包括相接的固定窗口和滑动窗口，所述滑动窗口拼接在固定窗口的低位，数据提取窗口位于数据Y的最高位，设定滑动窗口的窗口宽度D、滑动步长W，窗口宽度D与滑动步长W相等；N2：计算出固定窗口的窗口宽度F，F=LX+V%W，V=LY-LX；计算出滑动窗口的滑动次数d，；其中，V为有效比特长度差值，LY为数据Y的有效比特长度，LX为数据X的有效比特长度，表示向下取整。3.根据权利要求2所述的一种用于隐私计算的大整数数据相除运算方法，其特征在于，所述步骤S2中生成预计算表的方法包括以下步骤：生成预计算表，将数据集合Q={0, X,2X……*X}写入预计算表。4.根据权利要求3所述的一种用于隐私计算的大整数数据相除运算方法，其特征在于，所述步骤S3包括以下步骤：S31：固定窗口取出在数据Y上覆盖的数据作为中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S32：设置k=0，滑动窗口取出当前初始位置在数据Y上覆盖的数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S33：滑动窗口从高位向低位以滑动步长W滑动一次，滑动完成后取出当前在数据Y上覆盖的数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S34：给k赋值为k=k+1，判断k是否大于d，如果是则执行步骤S35，否则跳转至步骤S33；S35：将所有中间结果r拼接在一起得到商，将中间数据A作为余数。5.根据权利要求4所述的一种用于隐私计算的大整数数据相除运算方法，其特征在于，所述将中间数据A与预计算表进行计算得到中间结果r和中间结果z的方法包括以下步骤：找到中间数据A在预计算表中所处的区间，当t*X≤A＜*X时，t=0,1,2……2W-2，中间结果r=t、中间结果z=A-t*X。6.根据权利要求4所述的一种用于隐私计算的大整数数据相除运算方法，其特征在于，所述将中间数据A与预计算表进行计算得到中间结果r和中间结果z的方法包括以下步骤：M1：判断中间数据A的有效比特长度是否小于数据X的有效比特长度，如果是，则中间结果r=0、中间结果z=A；否则，执行步骤M2；M2：在预计算表中查找出与中间数据A的有效比特长度一致的数据，从这些数据中找到中间数据A所处的区间，当p*X≤A＜*X时，p=1,2……2W-2，中间结果r=p、中间结果z=A-p*X。7.根据权利要求4所述的一种用于隐私计算的大整数数据相除运算方法，其特征在于，所述步骤S35中将所有中间结果r拼接在一起得到商的方法如下：将固定窗口取出的中间数据A与预计算表进行计算得到中间结果r记为r0；将滑动窗口在初始位置取出的数据拼接出的中间数据A与预计算表进行计算得到中间结果r记为r1；将滑动窗口第i次滑动后取出的数据拼接出的中间数据A与预计算表进行计算得到中间结果r记为ri+1，1≤i≤d；所有中间结果r拼接在一起得到商，，R为商，/＞为拼接符。8.根据权利要求2所述的一种用于隐私计算的大整数数据相除运算方法，其特征在于，所述固定窗口覆盖数据Y的第LY-F至第LY-1位。9.根据权利要求2所述的一种用于隐私计算的大整数数据相除运算方法，其特征在于，所述滑动窗口位于初始位置时覆盖数据Y的第LY-F-D至第LY-F-1位。10.一种用于隐私计算的大整数数据相除运算系统，用于权利要求1所述的一种用于隐私计算的大整数数据相除运算方法，其特征在于，包括：控制单元，用于计算数据Y与数据X的有效比特长度差值，创建数据提取窗口，生成预计算表，分配计算任务给各个线程；共享内存，用于存储预计算表，供各个线程访问获取预计算表内的数据；多个线程，用于并行执行控制单元分配的计算任务。
说明书desc
技术领域本发明涉及计算机技术领域，尤其涉及一种用于隐私计算的大整数数据相除运算方法及系统。背景技术在联邦学习相关应用场景中，拥有数据的各个参与方通过隐私计算来保护数据安全和用户隐私，例如采用同态加密方法对原始数据进行加密后再将加密后的密态数据用在模型训练、梯度计算、参数计算等。同态加密方法允许直接在密文上进行代数运算等有效操作例如加法运算和乘法运算，并且直接对密文进行计算的结果等效于解密后对明文进行计算的结果，从而仅根据公钥和密文进行计算而无需知道密钥。这些数据加密技术和密态运算技术统称为隐私计算。隐私计算需要使用大量复杂算子操作，其中包括大整数位宽的除法运算。例如，常见的一种同态加密方法是Paillier算法，Paillier算法的解密计算需要对大整数位宽的被除数和除数进行除法运算，并且被除数和除数的位宽可以是1024比特、2048比特、4096比特或者更大的位宽。但是，传统的除法运算计算复杂度过高，耗时较长，计算开销过大。如何提高运算效率，减少计算开销，成为了亟待解决的问题。发明内容本发明为了解决上述技术问题，提供了一种用于隐私计算的大整数数据相除运算方法及系统，其能够提高大整数数据相除的计算效率，减少计算时间、计算开销。为了解决上述问题，本发明采用以下技术方案予以实现：本发明的一种用于隐私计算的大整数数据相除运算方法，计算方持有作为被除数的数据Y和作为除数的数据X，包括以下步骤：S1：统计数据Y的有效比特长度、数据X的有效比特长度，计算出数据Y与数据X的有效比特长度差值；S2：根据有效比特长度差值创建数据提取窗口，根据数据X生成预计算表；S3：数据提取窗口将数据Y内的数据分段取出与预计算表进行计算，得到商和余数。作为优选，所述步骤S2中创建数据提取窗口的方法包括以下步骤：N1：创建数据提取窗口，所述数据提取窗口包括相接的固定窗口和滑动窗口，所述滑动窗口拼接在固定窗口的低位，数据提取窗口位于数据Y的最高位，设定滑动窗口的窗口宽度D、滑动步长W，窗口宽度D与滑动步长W相等；N2：计算出固定窗口的窗口宽度F，F=LX+V%W，V=LY-LX；计算出滑动窗口的滑动次数d，；其中，V为有效比特长度差值，LY为数据Y的有效比特长度，LX为数据X的有效比特长度，表示向下取整。作为优选，所述步骤S2中生成预计算表的方法包括以下步骤：生成预计算表，将数据集合Q={0, X,2X……*X}写入预计算表。作为优选，所述步骤S3包括以下步骤：S31：固定窗口取出在数据Y上覆盖的数据作为中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S32：设置k=0，滑动窗口取出当前初始位置在数据Y上覆盖的数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S33：滑动窗口从高位向低位以滑动步长W滑动一次，滑动完成后取出当前在数据Y上覆盖的数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S34：给k赋值为k=k+1，判断k是否大于d，如果是则执行步骤S35，否则跳转至步骤S33；S35：将所有中间结果r拼接在一起得到商，将中间数据A作为余数。滑动窗口从初始位置以滑动步长W从数据Y的高位向低位滑动，依次取出d+1个数据，每次取出数据时执行如下步骤：将取出的数据拼接到当前中间数据A的低位得到新的中间数据A，将新的中间数据A与预计算表进行计算得到对应的中间结果r和中间结果z，将中间数据A赋值为中间结果z。作为优选，所述将中间数据A与预计算表进行计算得到中间结果r和中间结果z的方法包括以下步骤：找到中间数据A在预计算表中所处的区间，当t*X≤A＜*X时，t=0,1,2……2W-2，中间结果r=t、中间结果z=A-t*X。作为优选，所述将中间数据A与预计算表进行计算得到中间结果r和中间结果z的方法包括以下步骤：M1：判断中间数据A的有效比特长度是否小于数据X的有效比特长度，如果是，则中间结果r=0、中间结果z=A；否则，执行步骤M2；M2：在预计算表中查找出与中间数据A的有效比特长度一致的数据，从这些数据中找到中间数据A所处的区间，当p*X≤A＜*X时，p=1,2……2W-2，中间结果r=p、中间结果z=A-p*X。作为优选，所述步骤S35中将所有中间结果r拼接在一起得到商的方法如下：将固定窗口取出的中间数据A与预计算表进行计算得到中间结果r记为r0；将滑动窗口在初始位置取出的数据拼接出的中间数据A与预计算表进行计算得到中间结果r记为r1；将滑动窗口第i次滑动后取出的数据拼接出的中间数据A与预计算表进行计算得到中间结果r记为ri+1，1≤i≤d；所有中间结果r拼接在一起得到商，，R为商，/＞为拼接符。作为优选，所述固定窗口覆盖数据Y的第LY-F至第LY-1位。数据Y的最低位为第0位。作为优选，所述滑动窗口位于初始位置时覆盖数据Y的第LY-F-D至第LY-F-1位。本发明的一种用于隐私计算的大整数数据相除运算系统，用于上述的一种用于隐私计算的大整数数据相除运算方法，包括：控制单元，用于计算数据Y与数据X的有效比特长度差值，创建数据提取窗口，生成预计算表，分配计算任务给各个线程；共享内存，用于存储预计算表，供各个线程访问获取预计算表内的数据；多个线程，用于并行执行控制单元分配的计算任务。本发明的有益效果是：将作为被除数的数据Y进行切分后分段与根据数据X生成的预计算表进行比较运算、减法运算，从而优化加速大整数数据相除计算，提高了计算效率，减少了计算时间、计算开销，进而提高了需要用到大整数数据相除的同态加密等隐私计算的计算效率。附图说明图1是实施例的流程图；图2是数据提取窗口的结构示意图；图3是举例说明的示意图。具体实施方式下面通过实施例，并结合附图，对本发明的技术方案作进一步具体的说明。实施例1：本实施例的一种用于隐私计算的大整数数据相除运算方法，计算方持有作为被除数的数据Y和作为除数的数据X，如图1所示，包括以下步骤：S1：统计数据Y的有效比特长度、数据X的有效比特长度，计算出数据Y与数据X的有效比特长度差值，V=LY-LX，V为有效比特长度差值，LY为数据Y的有效比特长度，LX为数据X的有效比特长度；S2：根据有效比特长度差值创建数据提取窗口，根据数据X生成预计算表；创建数据提取窗口的方法包括以下步骤：N1：创建数据提取窗口，如图2所示，数据提取窗口包括相接的固定窗口和滑动窗口，滑动窗口拼接在固定窗口的低位，数据提取窗口位于数据Y的最高位，设定滑动窗口的窗口宽度D、滑动步长W，窗口宽度D与滑动步长W相等；N2：计算出固定窗口的窗口宽度F，F=LX+V%W；计算出滑动窗口的滑动次数d，；其中，表示向下取整；生成预计算表的方法包括以下步骤：生成预计算表，将数据集合Q={0, X,2X……*X}写入预计算表；S3：数据提取窗口将数据Y内的数据分段取出与预计算表进行计算，得到商和余数。步骤S3包括以下步骤：S31：固定窗口取出在数据Y上覆盖的数据作为中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S32：设置k=0，滑动窗口取出当前初始位置在数据Y上覆盖的数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S33：滑动窗口从高位向低位以滑动步长W滑动一次，滑动完成后取出当前在数据Y上覆盖的数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S34：给k赋值为k=k+1，判断k是否大于d，如果是则执行步骤S35，否则跳转至步骤S33；S35：将所有中间结果r拼接在一起得到商，将中间数据A作为余数。将中间数据A与预计算表进行计算得到中间结果r和中间结果z的方法包括以下步骤：找到中间数据A在预计算表中所处的区间，当t*X≤A＜*X时，t=0,1,2……2W-2，中间结果r=t、中间结果z=A-t*X。步骤S35中将所有中间结果r拼接在一起得到商的方法如下：将固定窗口取出的中间数据A与预计算表进行计算得到中间结果r记为r0；将滑动窗口在初始位置取出的数据拼接出的中间数据A与预计算表进行计算得到中间结果r记为r1；将滑动窗口第i次滑动后取出的数据拼接出的中间数据A与预计算表进行计算得到中间结果r记为ri+1，1≤i≤d；所有中间结果r拼接在一起得到商，，R为商，/＞为拼接符。在本方案中，先计算出有效比特长度差值，根据有效比特长度差值创建数据提取窗口，根据数据X生成预计算表。数据提取窗口由固定窗口和滑动窗口组成，滑动窗口拼接在固定窗口的低位，数据Y的最低位为第0位，固定窗口覆盖数据Y的第LY-F至第LY-1位，滑动窗口位于初始位置时覆盖数据Y的第LY-F-D至第LY-F-1位。接着进行如下计算：S31：固定窗口先取出在数据Y上覆盖的数据作为中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，得到的中间结果r记为r0，得到的中间结果z记为z0，将中间数据A赋值为z0；S32：设置k=0，滑动窗口取出当前初始位置在数据Y上覆盖的数据G0，将取出的数据G0拼接到中间数据A的低位得到新的中间数据A，，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，得到的中间结果r记为r1，得到的中间结果z记为z1，将中间数据A赋值为z1；S33：滑动窗口从高位向低位以滑动步长W滑动一次，滑动完成后取出当前在数据Y上覆盖的数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；滑动窗口从高位向低位以滑动步长W滑动第i次时，滑动完成后取出当前在数据Y上覆盖的数据Gi，1≤i≤d，将取出的数据Gi拼接到中间数据A的低位得到新的中间数据A，，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，得到的中间结果r记为ri+1，得到的中间结果z记为zi+1，将中间数据A赋值为zi+1；S34：给k赋值为k=k+1，判断k是否大于d，如果是则执行步骤S35，否则跳转至步骤S33；S35：将所有中间结果r拼接在一起得到商R，，将最终的中间数据A作为余数。本方案将作为被除数的数据Y进行切分后分段与根据数据X生成的预计算表进行比较运算、减法运算，从而优化加速大整数数据相除计算，提高了计算效率，减少了计算时间、计算开销，进而提高了需要用到大整数数据相除的同态加密等隐私计算的计算效率。举例说明：计算方在进行隐私计算过程中，当遇到需要进行大整数数据相除运算时，采用本实施例的方法进行大整数数据相除运算，用于大整数数据相除运算的数据Y的有效比特长度为512 bit、数据X的有效比特长度为480bit，数据Y为被除数、数据X为除数，如图3所示，包括如下步骤：计算出数据Y与数据X的有效比特长度差值V，V=32 bit。创建数据提取窗口，数据提取窗口包括相接的固定窗口和滑动窗口，滑动窗口拼接在固定窗口的低位，数据提取窗口位于数据Y的最高位，设定滑动窗口的窗口宽度D为10bit、滑动步长W为10bit；计算出固定窗口的窗口宽度F，F=LX+V%W=480+32%10=482 bit；计算出滑动窗口的滑动次数d，，d=2；生成预计算表，将数据集合Q={0, 480,2*480……*480}写入预计算表。固定窗口取出在数据Y上覆盖的482 bit数据作为中间数据A，将中间数据A与预计算表进行计算得到中间结果r0和中间结果z0，将中间数据A赋值为z0；滑动窗口取出当前初始位置在数据Y上覆盖的10bit数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r1和中间结果z1，将中间数据A赋值为z1；滑动窗口从高位向低位以滑动步长W滑动一次，滑动完成后取出当前在数据Y上覆盖的数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r2和中间结果z2，将中间数据A赋值为z2；滑动窗口从高位向低位以滑动步长W滑动一次，滑动完成后取出当前在数据Y上覆盖的数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r3和中间结果z3，将中间数据A赋值为z3；将所有中间结果r拼接在一起得到商R，，将中间数据A作为余数，即余数=z3。本实施例的一种用于隐私计算的大整数数据相除运算系统，用于上述的一种用于隐私计算的大整数数据相除运算方法，包括：控制单元，用于计算数据Y与数据X的有效比特长度差值，创建数据提取窗口，生成预计算表，分配计算任务给各个线程；共享内存，用于存储预计算表，供各个线程访问获取预计算表内的数据；多个线程，用于并行执行控制单元分配的计算任务。多个线程并行执行计算任务，加速了大整数数据相除运算，提高了整体的计算效率。实施例2：本实施例的一种用于隐私计算的大整数数据相除运算方法，计算方持有作为被除数的数据Y和作为除数的数据X，包括以下步骤：S1：统计数据Y的有效比特长度、数据X的有效比特长度，计算出数据Y与数据X的有效比特长度差值，V=LY-LX，V为有效比特长度差值，LY为数据Y的有效比特长度，LX为数据X的有效比特长度；S2：根据有效比特长度差值创建数据提取窗口，根据数据X生成预计算表；创建数据提取窗口的方法包括以下步骤：N1：创建数据提取窗口，数据提取窗口包括相接的固定窗口和滑动窗口，滑动窗口拼接在固定窗口的低位，数据提取窗口位于数据Y的最高位，设定滑动窗口的窗口宽度D、滑动步长W，窗口宽度D与滑动步长W相等；N2：计算出固定窗口的窗口宽度F，F=LX+V%W；计算出滑动窗口的滑动次数d，；其中，表示向下取整；生成预计算表的方法包括以下步骤：生成预计算表，将数据集合Q={0, X,2X……*X}写入预计算表；S3：数据提取窗口将数据Y内的数据分段取出与预计算表进行计算，得到商和余数。步骤S3包括以下步骤：S31：固定窗口取出在数据Y上覆盖的数据作为中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S32：设置k=0，滑动窗口取出当前初始位置在数据Y上覆盖的数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S33：滑动窗口从高位向低位以滑动步长W滑动一次，滑动完成后取出当前在数据Y上覆盖的数据，将取出的数据拼接到中间数据A的低位得到新的中间数据A，将中间数据A与预计算表进行计算得到中间结果r和中间结果z，将中间数据A赋值为中间结果z；S34：给k赋值为k=k+1，判断k是否大于d，如果是则执行步骤S35，否则跳转至步骤S33；S35：将所有中间结果r拼接在一起得到商，将中间数据A作为余数。步骤S35中将所有中间结果r拼接在一起得到商的方法如下：将固定窗口取出的中间数据A与预计算表进行计算得到中间结果r记为r0；将滑动窗口在初始位置取出的数据拼接出的中间数据A与预计算表进行计算得到中间结果r记为r1；将滑动窗口第i次滑动后取出的数据拼接出的中间数据A与预计算表进行计算得到中间结果r记为ri+1，1≤i≤d；所有中间结果r拼接在一起得到商，，R为商，/＞为拼接符。数据Y的最低位为第0位，固定窗口覆盖数据Y的第LY-F至第LY-1位，滑动窗口位于初始位置时覆盖数据Y的第LY-F-D至第LY-F-1位。将中间数据A与预计算表进行计算得到中间结果r和中间结果z的方法包括以下步骤：M1：判断中间数据A的有效比特长度是否小于数据X的有效比特长度，如果是，则中间结果r=0、中间结果z=A；否则，执行步骤M2；M2：在预计算表中查找出与中间数据A的有效比特长度一致的数据，从这些数据中找到中间数据A所处的区间，当p*X≤A＜*X时，p=1,2……2W-2，中间结果r=p、中间结果z=A-p*X。本实施例与实施例1的不同之处在于中间数据A与预计算表进行计算得到中间结果r和中间结果z的方法不同，其余步骤方法相同。由于步骤S3中滑动窗口每次将取出的数据拼接到中间数据A的低位得到新的中间数据A后，新的中间数据A可能存在最前面的位为0的情况，因此存在两种情况：新的中间数据A的有效比特长度小于数据X的有效比特长度，表示新的中间数据A小于数据X，在此情况下中间结果r=0、中间结果z=A；新的中间数据A的有效比特长度等于或大于数据X的有效比特长度，则在预计算表中向上查找有效比特长度一致的数据，找到有效比特长度一致的数据后，从这些数据中找到中间数据A所处的区间，当p*X≤A＜*X时，p=1,2……2W-2，中间结果r=p、中间结果z=A-p*X。只和有效比特长度相同的数据进行对比是为了提高比较效率，降低比较次数，尤其是在预计算表较大时，从预计算表中最小数据开始比较是极其低效的。查找对应p值过程中涉及到比较运算，比较方法为新的中间数据A减去预计算表中所取的数据，查看减法计算有没有借位产生，如果没有借位产生则表明被减数大于或等于减数，如果最高位有借位产生则不需要算出最终的减法结果，立即跳出减法运算，同时表明被减数小于减数。本实施例的一种用于隐私计算的大整数数据相除运算系统，用于上述的一种用于隐私计算的大整数数据相除运算方法，包括：控制单元，用于计算数据Y与数据X的有效比特长度差值，创建数据提取窗口，生成预计算表，分配计算任务给各个线程；共享内存，用于存储预计算表，供各个线程访问获取预计算表内的数据；多个线程，用于并行执行控制单元分配的计算任务。
