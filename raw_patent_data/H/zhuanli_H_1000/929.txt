标题title
车辆智能灯光控制系统及方法
摘要abst
本发明公开了车辆智能灯光控制系统及方法，属于车辆灯光控制技术领域，包括：微控制单元MCU、车身陀螺仪、车把陀螺仪和摇杆模块，通过按动摇杆进行自动模式与手动模式的模式切换，通过拨动摇杆进行手动模式下的车灯角度及车灯亮度的调整；车灯组件，用于对车灯亮度进行调整；舵机，用于对车灯角度进行调整。本发明解决了现有车辆灯光角度为固定方向，影响行车的安全性，易发生事故的问题，本发明通过对车头角度及车身姿态的计算，预测车辆前进路线来实现对灯光照明角度的智能调整，提前引导灯光方向，避免发生安全事故，提升车辆行驶安全性。
权利要求书clms
1.车辆智能灯光控制系统，其特征在于，包括：微控制单元MCU，用于对车辆智能灯光进行综合控制，其中微控制单元MCU连接车身陀螺仪、车头陀螺仪、摇杆模块、光敏采样模块、车灯组件及舵机，微控制单元MCU通过与车身陀螺仪、车头陀螺仪、摇杆模块、光敏采样模块、车灯组件及舵机之间的交互通信，综合控制车辆智能灯光；车身陀螺仪，安装在车辆车身上，其数量为两个，通过车身陀螺仪获取车辆车身的三轴加速度ax、ay、az和三轴角速度gx、gy、gz；车把陀螺仪，安装在车辆车把上，其数量为两个，通过车把陀螺仪获取车辆车把的三轴加速度ax、ay、az和三轴角速度gx、gy、gz；摇杆模块，安装在车辆上，通过按动摇杆进行自动模式与手动模式的模式切换，通过拨动摇杆进行手动模式下的车灯角度及车灯亮度的调整；光敏采样模块，用于获取环境光强数字量，光敏采样模块模拟量输出AO与A/D模块相连，通过A/D转换，获取环境光强数字量；车灯组件，用于对车灯亮度进行调整，微控制单元MCU向车灯组件发送车灯亮度调整指令，车灯组件接收车灯亮度调整指令后，按照车灯亮度调整指令，且通过脉冲宽度调制对车灯亮度进行调整；舵机，用于对车灯角度进行调整，微控制单元MCU向舵机发送车灯角度调整指令，舵机接收车灯角度调整指令后，按照车灯角度调整指令对车灯角度进行调整。2.根据权利要求1所述的车辆智能灯光控制系统，其特征在于，还包括：数据提取模块，用于提取存储的环境光强预设值，基于获取的环境光强数字量，从数据存储单元内提取出与环境光强数字量相对应的环境光强预设值；数据对比模块，用于对环境光强数字量和环境光强预设值进行对比，获取环境光强数字量和环境光强预设值，基于环境光强预设值，对环境光强数字量进行对比，确定出数据对比结果，基于数据对比结果，确定出不同的智能灯光控制策略；数据存储单元，用于存储与环境光强数字量相对应的环境光强预设值，为环境光强数字量对比提供参照依据。3.根据权利要求2所述的车辆智能灯光控制系统，其特征在于，基于数据对比结果，确定出不同的智能灯光控制策略，执行以下操作：获取环境光强数字量和环境光强预设值，基于环境光强预设值，对环境光强数字量进行对比；针对环境光强数字量高于环境光强预设值的情况，则执行的智能灯光控制策略为关闭车辆灯光，并将舵机回中；针对环境光强数字量低于环境光强预设值的情况，则执行的智能灯光控制策略为对车辆灯光进行调整。4.根据权利要求3所述的车辆智能灯光控制系统，其特征在于，智能灯光控制策略中对灯光方向的确定如下：通过微控制单元MCU计算出车身倾斜角度和车把相对于车身的转动角度，获取车辆当前位置，检测车辆的历史行车记中是否有与当前位置相关的参考行车记录；若是，从所述参考行车记录中获取车辆在当前位置之后的历史行车路线；从所述历史行车路线中确定车辆转动角度，基于每条历史行车路线的车辆转动角度，确定车辆转动角度范围，并将出现最多的车辆转动角度作为参考车辆转动角度；基于车身倾斜角度和车把相对于车身的转动角度与参考车辆转动角度进行匹配得到角度匹配度，判断所述角度匹配度是否大于预设匹配度；若是，将所述参考车辆转动角度作为车辆的预测转动角度，否则，利用所述车辆转动角度范围和角度匹配度与预设匹配度的差值，对所述参考车辆转动角度进行调整，得到车辆的预测转动角度；否则，直接基于车身倾斜角度和车把相对于车身的转动角度，得到车辆的预测转动角度；基于车辆的预测转动角度确定车辆预测路线，确定在所述车辆预测路线下的环境分布，确定所述环境分布中的重要监测点，并基于车辆预测路线确定车辆位置和重要监测点的相对位置，基于所述相对位置，确定车辆在对应车辆位置的初始灯光方向，基于每个车辆位置的初始灯光方向得到灯光方向变化特征；基于所述灯光方向变化特征在灯光转向顺滑度方面对初始灯光方向进行调整，得到目标灯光方向，并将目标灯光方向加入至智能灯光控制策略中。5.根据权利要求4所述的车辆智能灯光控制系统，其特征在于，基于所述相对位置，确定车辆在对应车辆位置的初始灯光方向，包括：对当前重要监测点进行分析，确定当前监测点的监测面积，并确定当前重要监测点和下一监测点之间的监测点距离，结合如下公式计算得到当前重要监测点的监测难度系数K；其中，δ表示所述车辆预测路线的难度，Sa表示所述当前重要监测点的监测面积，S0表示所述重要监测点的标准监测面积，La表示当前重要监测点和下一重要监测点之间的监测点距离，L0表示标准监测点距离；基于当前重要监测点的监测难度系数，结合车辆位置和当前重要监测点的相对位置，包括相对距离和相对角度，计算车辆在当前对应车辆位置的初始灯光方向θ；其中，ha表示车辆位置和当前重要监测点的相对距离，hb表示灯光的横向照射距离，α表示车辆位置和当前重要监测点的相对角度，e表示自然常数，取值为2.72。6.根据权利要求3所述的车辆智能灯光控制系统，其特征在于，通过拨动摇杆进行手动模式下的车灯角度及车灯亮度的调整，其包括：向上拨动摇杆，则通过提高PWM空占比，增大车灯亮度；向下拨动摇杆，则通过减小PWM空占比，降低车灯亮度；向左拨动摇杆，则通过舵机向左转动车灯；向右拨动摇杆，则通过舵机向右转动车灯。7.车辆智能灯光控制方法，基于权利要求4所述的车辆智能灯光控制系统实现，其特征在于，包括如下步骤：S1：光敏采样模块模拟量输出AO与A/D模块相连，通过A/D转换，获取环境光强数字量；S2：车身陀螺仪和车把陀螺仪均通过I2C协议与微控制单元MCU通信，通过车身陀螺仪和车把陀螺仪获取车身和车把的三轴加速度ax、ay、az和三轴角速度gx、gy、gz；S3：微控制单元MCU对车身陀螺仪和车把陀螺仪输出的三轴加速度ax、ay、az和三轴角速度gx、gy、gz进行处理，通过四元数法计算获得当前车辆的欧拉角：俯仰角、偏航角和滚转角，且采用Kalman滤波算法对所得欧拉角进行优化，确定出车身倾斜角度和车把相对于车身的转动角度，基于车身倾斜角度和车把相对于车身的转动角度，确定出舵机所需转动角度，按照舵机所需转动角度对车辆智能灯光进行综合控制。8.根据权利要求7所述的车辆智能灯光控制方法，其特征在于，所述S1中，获取环境光强数字量，基于环境光强数字量，对车辆灯光亮度进行调整，执行以下操作：通过脉冲宽度调制对车辆灯光亮度进行调整，其中PWM空占比为：式中，D为计算所得的占空比，L为环境光强数字量，LM为数字量最大值，k为系数，通过上下拨动摇杆改变该值，用于对车辆灯光进行调高或调低亮度。9.根据权利要求8所述的车辆智能灯光控制方法，其特征在于，所述S3中，微控制单元MCU对车身陀螺仪和车把陀螺仪输出的三轴加速度ax、ay、az和三轴角速度gx、gy、gz进行处理，执行以下操作：获取车身陀螺仪和车把陀螺仪半秒内的平均数据，计算出车把的偏航角,与车身的偏航角和滚转角，得到车身倾斜角度和车把相对于车身的转动角度；其中车把转动角度为：Ti＝yai-ybi式中，Ti为车把转动角度，yai为车把陀螺仪计算所得的偏航角，ybi为车身陀螺仪计算所得的偏航角；其中车身倾斜角度为：Ri＝rbi式中，Ri为车身倾斜角度，rbi为车身陀螺仪计算所得的滚动角。10.根据权利要求9所述的车辆智能灯光控制方法，其特征在于，所述S3中，计算舵机所需转动角度，执行以下操作：计算舵机所需转动角度，舵机角度向右为正；式中，当车身倾斜角度Ri与车把转动角度Ti小于设定的最小值RMIN、TMIN时，舵机转动角度s保持初始角度ia，当车身倾斜幅度与车把转动角度在范围内时，舵机转动角度s随车身倾斜幅度与车把转动角度的改变而改变，当车身倾斜角度Ri或车把转动角度Ti大于设定的最大限度RMAX、TMAX时，舵机转动至左侧或右侧的最大角度。
说明书desc
技术领域本发明涉及车辆灯光控制技术领域，具体为车辆智能灯光控制系统及方法。背景技术传统车辆灯光角度为固定方向，只能照亮车身前面道路，自行车或电动自行车在夜间行驶常会经过较暗路段，在转弯时，由于车身尚未转动，而车头已开始转向，光线不能及时照射到拐歪处，存在一定延迟，会造成一定程度上的视觉盲区，影响行车的安全性，易发生事故。发明内容本发明的目的在于提供车辆智能灯光控制系统及方法，通过对车头角度及车身姿态的计算，预测车辆前进路线来实现对灯光照明角度的智能调整，提前引导灯光方向，避免发生安全事故，提升车辆行驶安全性，解决了上述背景技术中提出的问题。为实现上述目的，本发明提供如下技术方案：车辆智能灯光控制系统，包括：微控制单元MCU，用于对车辆智能灯光进行综合控制，其中微控制单元MCU连接车身陀螺仪、车头陀螺仪、摇杆模块、光敏采样模块、车灯组件及舵机，微控制单元MCU通过与车身陀螺仪、车头陀螺仪、摇杆模块、光敏采样模块、车灯组件及舵机之间的交互通信，综合控制车辆智能灯光；车身陀螺仪，安装在车辆车身上，其数量为两个，通过车身陀螺仪获取车辆车身的三轴加速度ax、ay、az和三轴角速度gx、gy、gz；车把陀螺仪，安装在车辆车把上，其数量为两个，通过车把陀螺仪获取车辆车把的三轴加速度ax、ay、az和三轴角速度gx、gy、gz；摇杆模块，安装在车辆上，通过按动摇杆进行自动模式与手动模式的模式切换，通过拨动摇杆进行手动模式下的车灯角度及车灯亮度的调整；光敏采样模块，用于获取环境光强数字量，光敏采样模块模拟量输出AO与A/D模块相连，通过A/D转换，获取环境光强数字量；车灯组件，用于对车灯亮度进行调整，微控制单元MCU向车灯组件发送车灯亮度调整指令，车灯组件接收车灯亮度调整指令后，按照车灯亮度调整指令，且通过脉冲宽度调制对车灯亮度进行调整；舵机，用于对车灯角度进行调整，微控制单元MCU向舵机发送车灯角度调整指令，舵机接收车灯角度调整指令后，按照车灯角度调整指令对车灯角度进行调整。优选的，还包括：数据提取模块，用于提取存储的环境光强预设值，基于获取的环境光强数字量，从数据存储单元内提取出与环境光强数字量相对应的环境光强预设值；数据对比模块，用于对环境光强数字量和环境光强预设值进行对比，获取环境光强数字量和环境光强预设值，基于环境光强预设值，对环境光强数字量进行对比，确定出数据对比结果，基于数据对比结果，确定出不同的智能灯光控制策略；数据存储单元，用于存储与环境光强数字量相对应的环境光强预设值，为环境光强数字量对比提供参照依据。优选的，基于数据对比结果，确定出不同的智能灯光控制策略，执行以下操作：获取环境光强数字量和环境光强预设值，基于环境光强预设值，对环境光强数字量进行对比；针对环境光强数字量高于环境光强预设值的情况，则执行的智能灯光控制策略为关闭车辆灯光，并将舵机回中；针对环境光强数字量低于环境光强预设值的情况，则执行的智能灯光控制策略为对车辆灯光进行调整。优选的，智能灯光控制策略中对灯光方向的确定如下：通过微控制单元MCU计算出车身倾斜角度和车把相对于车身的转动角度，获取车辆当前位置，检测车辆的历史行车记中是否有与当前位置相关的参考行车记录；若是，从所述参考行车记录中获取车辆在当前位置之后的历史行车路线；从所述历史行车路线中确定车辆转动角度，基于每条历史行车路线的车辆转动角度，确定车辆转动角度范围，并将出现最多的车辆转动角度作为参考车辆转动角度；基于车身倾斜角度和车把相对于车身的转动角度与参考车辆转动角度进行匹配得到角度匹配度，判断所述角度匹配度是否大于预设匹配度；若是，将所述参考车辆转动角度作为车辆的预测转动角度，否则，利用所述车辆转动角度范围和角度匹配度与预设匹配度的差值，对所述参考车辆转动角度进行调整，得到车辆的预测转动角度；否则，直接基于车身倾斜角度和车把相对于车身的转动角度，得到车辆的预测转动角度；基于车辆的预测转动角度确定车辆预测路线，确定在所述车辆预测路线下的环境分布，确定所述环境分布中的重要监测点，并基于车辆预测路线确定车辆位置和重要监测点的相对位置，基于所述相对位置，确定车辆在对应车辆位置的初始灯光方向，基于每个车辆位置的初始灯光方向得到灯光方向变化特征；基于所述灯光方向变化特征在灯光转向顺滑度方面对初始灯光方向进行调整，得到目标灯光方向，并将目标灯光方向加入至智能灯光控制策略中。6.优选的，基于所述相对位置，确定车辆在对应车辆位置的初始灯光方向，包括：对当前重要监测点进行分析，确定当前监测点的监测面积，并确定当前重要监测点和下一监测点之间的监测点距离，结合如下公式计算得到当前重要监测点的监测难度系数K；其中，δ表示所述车辆预测路线的难度，Sa表示所述当前重要监测点的监测面积，S0表示所述重要监测点的标准监测面积，La表示当前重要监测点和下一重要监测点之间的监测点距离，L0表示标准监测点距离；基于当前重要监测点的监测难度系数，结合车辆位置和当前重要监测点的相对位置，包括相对距离和相对角度，计算车辆在当前对应车辆位置的初始灯光方向θ；其中，ha表示车辆位置和当前重要监测点的相对距离，hb表示灯光的横向照射距离，α表示车辆位置和当前重要监测点的相对角度，e表示自然常数，取值为2.72。优选的，通过拨动摇杆进行手动模式下的车灯角度及车灯亮度的调整，其包括：向上拨动摇杆，则通过提高PWM空占比，增大车灯亮度；向下拨动摇杆，则通过减小PWM空占比，降低车灯亮度；向左拨动摇杆，则通过舵机向左转动车灯；向右拨动摇杆，则通过舵机向右转动车灯。根据本发明的另一个方面，提供了车辆智能灯光控制方法，基于上述所述的车辆智能灯光控制系统实现，包括如下步骤：S1：光敏采样模块模拟量输出AO与A/D模块相连，通过A/D转换，获取环境光强数字量；S2：车身陀螺仪和车把陀螺仪均通过I2C协议与微控制单元MCU通信，通过车身陀螺仪和车把陀螺仪获取车身和车把的三轴加速度ax、ay、az和三轴角速度gx、gy、gz；S3：微控制单元MCU对车身陀螺仪和车把陀螺仪输出的三轴加速度ax、ay、az和三轴角速度gx、gy、gz进行处理，通过四元数法计算获得当前车辆的欧拉角：俯仰角、偏航角和滚转角，且采用Kalman滤波算法对所得欧拉角进行优化，确定出车身倾斜角度和车把相对于车身的转动角度，基于车身倾斜角度和车把相对于车身的转动角度，确定出舵机所需转动角度，按照舵机所需转动角度对车辆智能灯光进行综合控制。优选的，所述S1中，获取环境光强数字量，基于环境光强数字量，对车辆灯光亮度进行调整，执行以下操作：通过脉冲宽度调制对车辆灯光亮度进行调整，其中PWM空占比为：式中，D为计算所得的占空比，L为环境光强数字量，LM为数字量最大值，k为系数，通过上下拨动摇杆改变该值，用于对车辆灯光进行调高或调低亮度。优选的，所述S3中，微控制单元MCU对车身陀螺仪和车把陀螺仪输出的三轴加速度ax、ay、az和三轴角速度gx、gy、gz进行处理，执行以下操作：获取车身陀螺仪和车把陀螺仪半秒内的平均数据，计算出车把的偏航角,与车身的偏航角和滚转角，得到车身倾斜角度和车把相对于车身的转动角度；其中车把转动角度为：Ti＝yai-ybi式中，Ti为车把转动角度，yai为车把陀螺仪计算所得的偏航角，ybi为车身陀螺仪计算所得的偏航角；其中车身倾斜角度为：Ri＝rbi式中，Ri为车身倾斜角度，rbi为车身陀螺仪计算所得的滚动角。优选的，所述S3中，计算舵机所需转动角度，执行以下操作：计算舵机所需转动角度，舵机角度向右为正；式中，当车身倾斜角度Ri与车把转动角度Ti小于设定的最小值RMIN、TMIN时，舵机转动角度s保持初始角度ia，当车身倾斜幅度与车把转动角度在范围内时，舵机转动角度s随车身倾斜幅度与车把转动角度的改变而改变，当车身倾斜角度Ri或车把转动角度Ti大于设定的最大限度RMAX、TMAX时，舵机转动至左侧或右侧的最大角度。与现有技术相比，本发明的有益效果是：本发明的车辆智能灯光控制系统及方法，通过对车头角度及车身姿态的计算，预测车辆前进路线来实现对灯光照明角度的智能调整，提前引导灯光方向，解决了车灯无法及时照亮前方道路的问题，一定程度上减少了视觉盲区的存在，避免发生安全事故，提升车辆行驶安全性。附图说明图1为本发明的车辆智能灯光控制方法的流程图；图2为本发明的车辆智能灯光控制系统的结构图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。为了解决现有的车辆灯光角度为固定方向，在转弯时，由于车身尚未转动，而车头已开始转向，光线不能及时照射到拐歪处，存在一定延迟，会造成一定程度上的视觉盲区，影响行车的安全性，易发生事故的问题，请参阅图1-图2，本实施例提供以下技术方案：实施例一车辆智能灯光控制系统，包括：微控制单元MCU，微控制单元MCU通过与车身陀螺仪、车头陀螺仪、摇杆模块、光敏采样模块、车灯组件及舵机之间的交互通信，综合控制车辆智能灯光；其中，光敏采样模块通过A/D模块连接微控制单元MCU，光敏采样模块模拟量输出AO与A/D模块相连，通过A/D转换，获取环境光强数字量，且将获取的环境光强数字量发送给微控制单元MCU；其中，车身陀螺仪和车把陀螺仪均通过I2C协议与微控制单元MCU通信，通过车身陀螺仪和车把陀螺仪获取车身和车把的三轴加速度ax、ay、az和三轴角速度gx、gy、gz，且将车身陀螺仪和车把陀螺仪输出的三轴加速度ax、ay、az和三轴角速度gx、gy、gz发送给微控制单元MCU，微控制单元MCU对车身陀螺仪和车把陀螺仪输出的三轴加速度ax、ay、az和三轴角速度gx、gy、gz进行处理。其中，摇杆模块通过TCP协议与微控制单元MCU通信，通过按动摇杆进行自动模式与手动模式的模式切换，通过拨动摇杆进行手动模式下的车灯角度及车灯亮度的调整；需要说明的是：向上拨动摇杆，则通过提高PWM空占比，增大车灯亮度；向下拨动摇杆，则通过减小PWM空占比，降低车灯亮度；向左拨动摇杆，则通过舵机向左转动车灯；向右拨动摇杆，则通过舵机向右转动车灯。车身陀螺仪，安装在车辆车身上，其数量为两个，通过车身陀螺仪获取车辆车身的三轴加速度ax、ay、az和三轴角速度gx、gy、gz；车把陀螺仪，安装在车辆车把上，其数量为两个，通过车把陀螺仪获取车辆车把的三轴加速度ax、ay、az和三轴角速度gx、gy、gz；需要说明的是，陀螺仪是用高速回转体的动量矩敏感壳体相对惯性空间绕正交于自转轴的一个或二个轴的角运动检测装置，利用其他原理制成的角运动检测装置起同样功能的也称陀螺仪，利用车身陀螺仪及车把陀螺仪可分别获取车辆车身的三轴加速度ax、ay、az和三轴角速度gx、gy、gz及车辆车把的三轴加速度ax、ay、az和三轴角速度gx、gy、gz。需要说明的是，车身陀螺仪和车把陀螺仪的数量均为两个，分别安装于车身与车把上，用于获取车身及车把姿态，用于计算车把转动角度与车身倾斜角度，各组内取数据均值提高准确性。摇杆模块，安装在车辆上，通过按动摇杆进行自动模式与手动模式的模式切换，通过拨动摇杆进行手动模式下的车灯角度及车灯亮度的调整；通过拨动摇杆进行手动模式下的车灯角度及车灯亮度的调整，其包括：向上拨动摇杆，则通过提高PWM空占比，增大车灯亮度；向下拨动摇杆，则通过减小PWM空占比，降低车灯亮度；向左拨动摇杆，则通过舵机向左转动车灯；向右拨动摇杆，则通过舵机向右转动车灯。光敏采样模块，用于获取环境光强数字量，光敏采样模块模拟量输出AO与A/D模块相连，通过A/D转换，获取环境光强数字量；需要说明的是，车身陀螺仪和车把陀螺仪均使用I2C与微控制单元MCU通信，利用车身陀螺仪和车把陀螺仪获取车身陀螺仪和车把陀螺仪输出的三轴加速度ax、ay、az和三轴角速度gx、gy、gz，将所得数据交由微控制单元MCU处理，通过四元数法计算获得当前的欧拉角：俯仰角、偏航角和滚转角；由于四元数法是一个积分的做法，在实际应用中不可避免的会出现误差发散，长时间之后这个办法给出的姿态就不具有太高的可信度，此外由于角速度测量的误差，四元数/姿态矩阵在一段时间后可能会不满足归一性/正交性，故采用Kalman滤波算法对所得欧拉角进行优化，以提高姿态解算的准确性。车灯组件，用于对车灯亮度进行调整，微控制单元MCU向车灯组件发送车灯亮度调整指令，车灯组件接收车灯亮度调整指令后，按照车灯亮度调整指令，且通过脉冲宽度调制对车灯亮度进行调整；舵机，用于对车灯角度进行调整，微控制单元MCU向舵机发送车灯角度调整指令，舵机接收车灯角度调整指令后，按照车灯角度调整指令对车灯角度进行调整。需要说明的是，通过按动摇杆进行自动模式与手动模式的模式切换，具体如下：一、手动模式驾驶员可左右拨动摇杆，微控制单元MCU检测后，控制舵机转动实现车灯角度调整，同时，上下拨动摇杆，可提高或降低车灯亮度，其中：向上拨动摇杆，则通过提高PWM空占比，增大车灯亮度；向下拨动摇杆，则通过减小PWM空占比，降低车灯亮度；向左拨动摇杆，则通过舵机向左转动车灯；向右拨动摇杆，则通过舵机向右转动车灯。二、自动模式1)通过光敏采样模块获得环境光强数字量light_value，微控制单元MCU将环境光强数字量与环境光强预设值比较后，若亮度高于阈值，则关闭灯光并将舵机回中；若亮度低于阈值，则进行后续步骤；2)通过脉冲宽度调制对灯光亮度经行调整，PWM空占比PWM_value为：式中，D为计算所得的占空比，L为环境光强数字量，LM为数字量最大值，k为系数，通过上下拨动摇杆改变该值，用于对车辆灯光进行调高或调低亮度。3)分别获取车身陀螺仪和车把陀螺仪半秒内的平均数据，计算出车把的偏航角，与车身的偏航角和滚转角，得到车身倾斜角度和车把相对于车身的转动角度；其中车把转动角度为：Ti＝yai-ybi式中，Ti为车把转动角度，yai为车把陀螺仪计算所得的偏航角，ybi为车身陀螺仪计算所得的偏航角；其中车身倾斜角度为：Ri＝rbi式中，Ri为车身倾斜角度，rbi为车身陀螺仪计算所得的滚动角。4)计算舵机所需转动角度，舵机角度向右为正；式中，当车身倾斜角度Ri与车把转动角度Ti小于设定的最小值RMIN、TMIN时，舵机转动角度s保持初始角度ia，当车身倾斜幅度与车把转动角度在范围内时，舵机转动角度s随车身倾斜幅度与车把转动角度的改变而改变，当车身倾斜角度Ri或车把转动角度Ti大于设定的最大限度RMAX、TMAX时，舵机转动至左侧或右侧的最大角度。具体的，通过对车头角度及车身姿态的计算，预测车辆前进路线来实现对灯光照明角度的智能调整，提前引导灯光方向，解决了车灯无法及时照亮前方道路的问题，一定程度上减少了视觉盲区的存在，避免发生安全事故，提升车辆行驶安全性。需要说明的是，车辆智能灯光控制系统，还包括：数据提取模块，用于提取存储的环境光强预设值，基于获取的环境光强数字量，从数据存储单元内提取出与环境光强数字量相对应的环境光强预设值；数据对比模块，用于对环境光强数字量和环境光强预设值进行对比，获取环境光强数字量和环境光强预设值，基于环境光强预设值，对环境光强数字量进行对比，确定出数据对比结果，基于数据对比结果，确定出不同的智能灯光控制策略；数据存储单元，用于存储与环境光强数字量相对应的环境光强预设值，为环境光强数字量对比提供参照依据。基于数据对比结果，确定出不同的智能灯光控制策略，执行以下操作：获取环境光强数字量和环境光强预设值，基于环境光强预设值，对环境光强数字量进行对比；针对环境光强数字量高于环境光强预设值的情况，则执行的智能灯光控制策略为关闭车辆灯光，并将舵机回中；针对环境光强数字量低于环境光强预设值的情况，则执行的智能灯光控制策略为对车辆灯光进行调整。智能灯光控制策略中对灯光方向的确定如下：通过微控制单元MCU计算出车身倾斜角度和车把相对于车身的转动角度，获取车辆当前位置，检测车辆的历史行车记中是否有与当前位置相关的参考行车记录；若是，从所述参考行车记录中获取车辆在当前位置之后的历史行车路线；从所述历史行车路线中确定车辆转动角度，基于每条历史行车路线的车辆转动角度，确定车辆转动角度范围，并将出现最多的车辆转动角度作为参考车辆转动角度；基于车身倾斜角度和车把相对于车身的转动角度与参考车辆转动角度进行匹配得到角度匹配度，判断所述角度匹配度是否大于预设匹配度；若是，将所述参考车辆转动角度作为车辆的预测转动角度，否则，利用所述车辆转动角度范围和角度匹配度与预设匹配度的差值，对所述参考车辆转动角度进行调整，得到车辆的预测转动角度；否则，直接基于车身倾斜角度和车把相对于车身的转动角度，得到车辆的预测转动角度；基于车辆的预测转动角度确定车辆预测路线，确定在所述车辆预测路线下的环境分布，确定所述环境分布中的重要监测点，并基于车辆预测路线确定车辆位置和重要监测点的相对位置，基于所述相对位置，确定车辆在对应车辆位置的初始灯光方向，基于每个车辆位置的初始灯光方向得到灯光方向变化特征；基于所述灯光方向变化特征在灯光转向顺滑度方面对初始灯光方向进行调整，得到目标灯光方向，并将目标灯光方向加入至智能灯光控制策略中。在该实施例中，车辆转动角度范围为历史行车路线的车辆转动角度的最大值和最小值之间的范围。在该实施例中，车身倾斜角度和车把相对于车身的转动角度实现参考车辆转动角度越容易，对应的角度匹配度越高。在该实施例中，角度匹配度与预设匹配度的差值越大，对应的参考车辆转动角度的调整幅度越大，且调整的范围在所述车辆转动角度范围内。在该实施例中，重要监测点例如为存在障碍物后路况不好的位置。再改实施例中，灯光方向变化特征为按顺序经过重要监测点的初始灯光方向的变化情况特征，可能存在变化幅度过大的情况，因此需要进行调整使得灯光方向的转动合理。上述设计方案的有益效果是：通过根据车辆的位置结合历史路线来预测车辆的路线，提高预测效率和预测准确性，通过预测车辆前进路线来实现对灯光照明角度的智能调整，提前引导灯光方向，解决了车灯无法及时照亮前方道路的问题，一定程度上减少了视觉盲区的存在，避免发生安全事故，提升车辆行驶安全性。基于所述相对位置，确定车辆在对应车辆位置的初始灯光方向，包括：对当前重要监测点进行分析，确定当前监测点的监测面积，并确定当前重要监测点和下一监测点之间的监测点距离，结合如下公式计算得到当前重要监测点的监测难度系数K；其中，δ表示所述车辆预测路线的难度，Sa表示所述当前重要监测点的监测面积，S0表示重要监测点的标准监测面积，La表示当前重要监测点和下一重要监测点之间的监测点距离，L0表示标准监测点距离；基于当前重要监测点的监测难度系数，结合车辆位置和当前重要监测点的相对位置，包括相对距离和相对角度，计算车辆在当前对应车辆位置的初始灯光方向θ；其中，ha表示车辆位置和当前重要监测点的相对距离，hb表示灯光的横向照射距离，α表示车辆位置和当前重要监测点的相对角度，e表示自然常数，取值为2.72。在该实施例中，标准监测面积根据车辆灯光的照射范围特征设定。在该实施例中，标准监测点距离根据车辆灯光的照射范围特征设定。在该实施例中，监测难度系数越大对应的初始灯光方向的幅度越大。在该实施例中，初始灯光方向与相对角度相关。上述设计方案的有益效果是：通过根据相对位置的分析计算，首先确定当前重要监测点的监测难度系数，来作为初始灯光方向确定的参数，结合相对距离和相对角度等计算得到初始灯光方向，保证得到的初始灯光方向的准确性和最优性，提前引导灯光方向，解决了车灯无法及时照亮前方道路的问题，一定程度上减少了视觉盲区的存在，避免发生安全事故，提升车辆行驶安全性。如：通过光敏采样模块获取的环境光强数字量为6000cd，环境光强预设值为7000cd，由于环境光强数字量低于环境光强预设值，则执行的智能灯光控制策略为对车辆灯光进行调整；手动模式下：向上拨动摇杆，则通过提高PWM空占比，增大车灯亮度；向下拨动摇杆，则通过减小PWM空占比，降低车灯亮度；如：通过光敏采样模块获取的环境光强数字量为7500cd，环境光强预设值为7000cd，由于环境光强数字量高于环境光强预设值，则执行的智能灯光控制策略为关闭车辆灯光，并将舵机回中。实施例二为了更好的展现车辆智能灯光控制流程，本实施例现提出车辆智能灯光控制方法，基于上述的车辆智能灯光控制系统实现，包括如下步骤：S1：光敏采样模块模拟量输出AO与A/D模块相连，通过A/D转换，获取环境光强数字量；S2：车身陀螺仪和车把陀螺仪均通过I2C协议与微控制单元MCU通信，通过车身陀螺仪和车把陀螺仪获取车身和车把的三轴加速度ax、ay、az和三轴角速度gx、gy、gz；S3：微控制单元MCU对车身陀螺仪和车把陀螺仪输出的三轴加速度ax、ay、az和三轴角速度gx、gy、gz进行处理，通过四元数法计算获得当前车辆的欧拉角：俯仰角、偏航角和滚转角，且采用Kalman滤波算法对所得欧拉角进行优化，确定出车身倾斜角度和车把相对于车身的转动角度，基于车身倾斜角度和车把相对于车身的转动角度，确定出舵机所需转动角度，按照舵机所需转动角度对车辆智能灯光进行综合控制。S1中，获取环境光强数字量，基于环境光强数字量，对车辆灯光亮度进行调整，执行以下操作：通过脉冲宽度调制对车辆灯光亮度进行调整，其中PWM空占比为：式中，D为计算所得的占空比，L为环境光强数字量，LM为数字量最大值，k为系数，通过上下拨动摇杆改变该值，用于对车辆灯光进行调高或调低亮度。S3中，微控制单元MCU对车身陀螺仪和车把陀螺仪输出的三轴加速度ax、ay、az和三轴角速度gx、gy、gz进行处理，执行以下操作：获取车身陀螺仪和车把陀螺仪半秒内的平均数据，计算出车把的偏航角,与车身的偏航角和滚转角，得到车身倾斜角度和车把相对于车身的转动角度；其中车把转动角度为：Ti＝yai-ybi式中，Ti为车把转动角度，yai为车把陀螺仪计算所得的偏航角，ybi为车身陀螺仪计算所得的偏航角；其中车身倾斜角度为：Ri＝rbi式中，Ri为车身倾斜角度，rbi为车身陀螺仪计算所得的滚动角。S3中，计算舵机所需转动角度，执行以下操作：计算舵机所需转动角度，舵机角度向右为正；式中，当车身倾斜角度Ri与车把转动角度Ti小于设定的最小值RMIN、TMIN时，舵机转动角度s保持初始角度ia，当车身倾斜幅度与车把转动角度在范围内时，舵机转动角度s随车身倾斜幅度与车把转动角度的改变而改变，当车身倾斜角度Ri或车把转动角度Ti大于设定的最大限度RMAX、TMAX时，舵机转动至左侧或右侧的最大角度。需要说明的是，开始，初始化设备，车灯关闭，舵机回中，开启自动模式，获得环境光强数字量，若环境光强数字量高于环境光强预设值，关闭灯光，舵机回中，重新启动自动模式，若环境光强数字量低于环境光强预设值，使用PWM调光亮，计算PWM空占比，获取车身陀螺仪和车把陀螺仪半秒内的平均数据，计算车身倾斜角度及车把相对于车身的转动角度，计算舵机所需转动角度调整灯光角度，若按动摇杆，关闭灯光，舵机回中，切换至手动模式，若未按动摇杆，重新启动自动模式；切换至手动模式后，若向上拨动摇杆，提高PWM空占比，增大亮度，若向下拨动摇杆，减小PWM空占比，降低亮度，若向左拨动摇杆，向左转动车灯，若向右拨动摇杆，向右转动车灯，若按动摇杆，关闭灯光，舵机回中，切换至自动模式。综上，本发明的车辆智能灯光控制系统及方法，通过对车头角度及车身姿态的计算，预测车辆前进路线来实现对灯光照明角度的智能调整，提前引导灯光方向，解决了车灯无法及时照亮前方道路的问题，一定程度上减少了视觉盲区的存在，避免发生安全事故，提升车辆行驶安全性。需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。尽管已经示出和描述了本发明的实施例，对于本领域的普通技术人员而言，可以理解在不脱离本发明的原理和精神的情况下可以对这些实施例进行多种变化、修改、替换和变型，本发明的范围由所附权利要求及其等同物限定。
