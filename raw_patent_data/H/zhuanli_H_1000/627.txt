标题title
图像聚焦方法、装置、计算机设备和存储介质
摘要abst
本申请涉及一种图像聚焦方法、装置、计算机设备和存储介质，其中，该方法包括：确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值；在每次自动聚焦时，基于位置补偿值，预测所述待聚焦设备的焦点位置；控制待聚焦设备的电机运行到焦点位置，进行自动聚焦的微调搜索，解决了相关技术中无法直接定位到高频分量最大值，导致需要二次搜索，造成搜索速度慢的问题，利用自动聚焦的粗调搜索中采样的位置补偿值直接定位到对应相关技术的高频分量最大值的焦点位置，再直接进行微调搜索，不再需要二次搜索，极大程度加快自动聚焦的速度和准确度。
权利要求书clms
1.一种图像聚焦方法，其特征在于，包括：确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值；在每次自动聚焦时，基于所述位置补偿值，预测所述待聚焦设备的焦点位置；控制所述待聚焦设备的电机运行到所述焦点位置，进行自动聚焦的微调搜索。2.根据权利要求1所述的图像聚焦方法，其特征在于，确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值，包括：在自动聚焦的粗调过程中，按预设采样间隔获取第一图像和对应的第一评价算子值；在获取到最大第一评价算子值时，记录每个所述第一评价算子值对应的第一电机位置，得到一组第一电机位置数组；所述第一图像为所述粗调过程中所述待聚焦设备采集的图像；在自动聚焦的微调过程中，确定第二图像对应的第二电机位置；所述第二图像的第二评价算子值满足预设模糊度要求；所述第二图像为所述微调过程中所述待聚焦设备采集的图像；根据所述第一电机位置数组和所述第二电机位置，确定自动聚焦的粗调搜索中采样的位置补偿值。3.根据权利要求2所述的图像聚焦方法，其特征在于，在自动聚焦的粗调过程中，按预设采样间隔获取第一图像和对应的第一评价算子值；在获取到最大第一评价算子值时，记录每个所述第一评价算子值对应的第一电机位置，得到一组第一电机位置数组，包括：在自动聚焦的粗调过程中，控制所述待聚焦设备中所述电机以预设速度持续运行；基于预设采样间隔，通过所述待聚焦设备在不同所述第一电机位置下获取所述第一图像；确定每个所述第一图像对应的第一评价算子值；在获取到最大第一评价算子值时，记录每个所述第一评价算子值对应的第一电机位置，得到一组第一电机位置数组。4.根据权利要求2所述的图像聚焦方法，其特征在于，在自动聚焦的微调过程中，确定第二图像对应的第二电机位置，包括：在自动聚焦的微调过程中，获取待聚焦设备中电机当前位置对应的第三图像，对所述第三图像的边缘进行图像模糊度检测，得到所述第三图像的模糊度评价指标；将所述模糊度评价指标转换到预设范围阈值中，得到所述第三图像的第二评价算子值；在所述第二评价算子值满足预设模糊度要求时，将所述第三图像作为所述第二图像，并将所述电机的所述当前位置作为所述第二图像对应的第二电机位置；在所述第二评价算子值不满足预设模糊度要求时，对所述电机的所述当前位置进行调整。5.根据权利要求4所述的图像聚焦方法，其特征在于，对所述第三图像的边缘进行图像模糊度检测，得到所述第三图像的模糊度评价指标，包括：对所述第三图像进行滤波，得到滤波图像；对所述滤波图像进行边缘增强，得到边缘图像；对所述边缘图像进行图像模糊度检测，得到所述第三图像的模糊度评价指标。6.根据权利要求2所述的图像聚焦方法，其特征在于，根据所述第一电机位置数组和所述第二电机位置，确定自动聚焦的粗调搜索中采样的位置补偿值，包括：将所述第二电机位置和所述第一电机位置数组中的各所述第一电机位置进行对比，筛选出与所述第二电机位置匹配的所述第一电机位置，得到对应的匹配采样序号；将所述最大第一评价算子值对应的极值采样序号和所述匹配采样序号的差值，作为自动聚焦的粗调搜索中采样的位置补偿值。7.根据权利要求6所述的图像聚焦方法，其特征在于，在每次自动聚焦时，基于所述位置补偿值，预测所述待聚焦设备的焦点位置，包括：获取当前聚焦过程中，粗调搜索得到的第二电机位置数组；基于所述位置补偿值确定所述第二电机位置数组中的目标电机位置值，将所述目标电机位置值作为所述待聚焦设备的焦点位置。8.根据权利要求1所述的图像聚焦方法，其特征在于，在进行自动聚焦的微调搜索之前，所述方法还包括：判断所述焦点位置处所采集的第一图像所对应的第一评价值算子值是否满足预设阈值范围条件；若所述第一评价值算子值不满足所述预设阈值范围条件，则对所述焦点位置进行调整；若所述第一评价值算子值满足所述预设阈值范围条件，则执行所述进行自动聚焦的微调搜索步骤。9.根据权利要求1所述的图像聚焦方法，其特征在于，所述方法还包括：重复确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值，得到多个所述位置补偿值；将多个所述位置补偿值的平均值，作为新的所述位置补偿值。10.一种图像聚焦装置，其特征在于，包括：处理模块、预测模块以及微调搜索模块；所述处理模块，用于确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值；所述预测模块，用于在每次自动聚焦时，基于所述位置补偿值，预测所述待聚焦设备的焦点位置；所述微调搜索模块，用于控制所述待聚焦设备的电机运行到所述焦点位置，进行自动聚焦的微调搜索。11.一种计算机设备，包括存储器和处理器，其特征在于，所述存储器中存储有计算机程序，所述处理器被设置为运行所述计算机程序以执行权利要求1至9中任一项所述的图像聚焦方法的步骤。12.一种计算机可读存储介质，其上存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现权利要求1至9中任一项所述的图像聚焦方法的步骤。
说明书desc
技术领域本申请涉及自动聚焦技术领域，特别是涉及图像聚焦方法、装置、计算机设备和存储介质。背景技术目前自动聚焦技术在家用数码摄像设备、显微镜、无人视频监控以及卫星遥感等系统中有着广泛的应用。图像模糊的本质是高频分量的损失。在自动聚焦的图像处理过程中，为了抑制时域噪声，通常会采用时域滤波算法，而时域滤波算法会影响自动聚焦过程中对高频分量统计的结果，进而会产生统计值滞后的现象。这种现象表现为在聚焦的粗调搜索过程中，高频分量最大值在过了实际焦点的位置才采样到。因此在搜索到峰值之后不能直接定位到高频分量最大值就结束，而是必须进行二次搜索，滞后的位置越多，搜索的速度越慢。针对相关技术中无法直接定位到高频分量最大值，导致需要二次搜索，造成搜索速度慢的问题，目前还没有提出有效的解决方案。发明内容在本实施例中提供了一种图像聚焦方法、装置、计算机设备和存储介质，以解决相关技术中无法直接定位到高频分量最大值，导致需要二次搜索，造成搜索速度慢的问题。第一个方面，在本实施例中提供了一种图像聚焦方法，包括：确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值；在每次自动聚焦时，基于所述位置补偿值，预测所述待聚焦设备的焦点位置；控制所述待聚焦设备的电机运行到所述焦点位置，进行自动聚焦的微调搜索。在其中一些实施例中，确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值，包括：在自动聚焦的粗调过程中，按预设采样间隔获取第一图像和对应的第一评价算子值；在获取到最大第一评价算子值时，记录每个所述第一评价算子值对应的第一电机位置，得到一组第一电机位置数组；所述第一图像为所述粗调过程中所述待聚焦设备采集的图像；在自动聚焦的微调过程中，确定第二图像对应的第二电机位置；所述第二图像的第二评价算子值满足预设模糊度要求；所述第二图像为所述微调过程中所述待聚焦设备采集的图像；根据所述第一电机位置数组和所述第二电机位置，确定自动聚焦的粗调搜索中采样的位置补偿值。在其中一些实施例中，在自动聚焦的粗调过程中，按预设采样间隔获取第一图像和对应的第一评价算子值；在获取到最大第一评价算子值时，记录每个所述第一评价算子值对应的第一电机位置，得到一组第一电机位置数组，包括：在自动聚焦的粗调过程中，控制所述待聚焦设备中所述电机以预设速度持续运行；基于预设采样间隔，通过所述待聚焦设备在不同所述第一电机位置下获取所述第一图像；确定每个所述第一图像对应的第一评价算子值；在获取到最大第一评价算子值时，记录每个所述第一评价算子值对应的第一电机位置，得到一组第一电机位置数组。在其中一些实施例中，在自动聚焦的微调过程中，确定第二图像对应的第二电机位置，包括：在自动聚焦的微调过程中，获取待聚焦设备中电机当前位置对应的第三图像，对所述第三图像的边缘进行图像模糊度检测，得到所述第三图像的模糊度评价指标；将所述模糊度评价指标转换到预设范围阈值中，得到所述第三图像的第二评价算子值；在所述第二评价算子值满足预设模糊度要求时，将所述第三图像作为所述第二图像，并将所述电机的所述当前位置作为所述第二图像对应的第二电机位置；在所述第二评价算子值不满足预设模糊度要求时，对所述电机的所述当前位置进行调整。在其中一些实施例中，对所述第三图像的边缘进行图像模糊度检测，得到所述第三图像的模糊度评价指标，包括：对所述第三图像进行滤波，得到滤波图像；对所述滤波图像进行边缘增强，得到边缘图像；对所述边缘图像进行图像模糊度检测，得到所述第三图像的模糊度评价指标。在其中一些实施例中，根据所述第一电机位置数组和所述第二电机位置，确定自动聚焦的粗调搜索中采样的位置补偿值，包括：将所述第二电机位置和所述第一电机位置数组中的各所述第一电机位置进行对比，筛选出与所述第二电机位置匹配的所述第一电机位置，得到对应的匹配采样序号；将所述最大第一评价算子值对应的极值采样序号和所述匹配采样序号的差值，作为自动聚焦的粗调搜索中采样的位置补偿值。在其中一些实施例中，在每次自动聚焦时，基于所述位置补偿值，预测所述待聚焦设备的焦点位置，包括：获取当前聚焦过程中，粗调搜索得到的第二电机位置数组；基于所述位置补偿值确定所述第二电机位置数组中的目标电机位置值，将所述目标电机位置值作为所述待聚焦设备的焦点位置。在其中一些实施例中，在进行自动聚焦的微调搜索之前，所述方法还包括：判断所述焦点位置处所采集的第一图像所对应的第一评价值算子值是否满足预设阈值范围条件；若所述第一评价值算子值不满足所述预设阈值范围条件，则对所述焦点位置进行调整；若所述第一评价值算子值满足所述预设阈值范围条件，则执行所述进行自动聚焦的微调搜索步骤。在其中一些实施例中，所述方法还包括：重复确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值，得到多个所述位置补偿值；将多个所述位置补偿值的平均值，作为新的所述位置补偿值。第二个方面，在本实施例中提供了一种图像聚焦装置，包括：处理模块、预测模块以及微调搜索模块；所述处理模块，用于确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值；所述预测模块，用于在每次自动聚焦时，基于所述位置补偿值，预测所述待聚焦设备的焦点位置；所述微调搜索模块，用于控制所述待聚焦设备的电机运行到所述焦点位置，进行自动聚焦的微调搜索。第三个方面，在本实施例中提供了一种计算机设备，包括存储器、处理器以及存储在所述存储器上并可在所述处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现上述第一个方面所述的图像聚焦方法。第四个方面，在本实施例中提供了一种存储介质，其上存储有计算机程序，该程序被处理器执行时实现上述第一个方面所述的图像聚焦方法。与相关技术相比，在本实施例中提供的图像聚焦方法、装置、计算机设备和存储介质，通过确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值；在每次自动聚焦时，基于位置补偿值，预测所述待聚焦设备的焦点位置；控制待聚焦设备的电机运行到焦点位置，进行自动聚焦的微调搜索，解决了相关技术中无法直接定位到高频分量最大值，导致需要二次搜索，造成搜索速度慢的问题，利用自动聚焦的粗调搜索中采样的位置补偿值直接定位到对应相关技术的高频分量最大值的焦点位置，再直接进行微调搜索，不再需要二次搜索，极大程度加快自动聚焦的速度和准确度。本申请的一个或多个实施例的细节在以下附图和描述中提出，以使本申请的其他特征、目的和优点更加简明易懂。附图说明此处所说明的附图用来提供对本申请的进一步理解，构成本申请的一部分，本申请的示意性实施例及其说明用于解释本申请，并不构成对本申请的不当限定。在附图中：图1是本申请一实施例提供的图像聚焦方法的终端设备的硬件结构框图；图2是本申请一实施例提供的图像聚焦方法的流程图；图3是图2中步骤S210的流程图；图4是本申请一实施例提供的高斯滤波模板H0水平的示意图；图5是本申请一实施例提供的高斯滤波模板H90垂直的示意图；图6是本申请一实施例提供的高斯滤波模板H45对角线的示意图；图7是本申请一实施例提供的高斯滤波模板H135对角线的示意图；图8是本申请一实施例提供的图像聚焦装置的结构框图。图中：102、处理器；104、存储器；106、传输设备；108、输入输出设备；210、处理模块；220、预测模块；230、微调搜索模块。具体实施方式为更清楚地理解本申请的目的、技术方案和优点，下面结合附图和实施例，对本申请进行了描述和说明。除另作定义外，本申请所涉及的技术术语或者科学术语应具有本申请所属技术领域具备一般技能的人所理解的一般含义。在本申请中的“一”、“一个”、“一种”、“该”、“这些”等类似的词并不表示数量上的限制，它们可以是单数或者复数。在本申请中所涉及的术语“包括”、“包含”、“具有”及其任何变体，其目的是涵盖不排他的包含；例如，包含一系列步骤或模块的过程、方法和系统、产品或设备并未限定于列出的步骤或模块，而可包括未列出的步骤或模块，或者可包括这些过程、方法、产品或设备固有的其他步骤或模块。在本申请中所涉及的“连接”、“相连”、“耦接”等类似的词语并不限定于物理的或机械连接，而可以包括电气连接，无论是直接连接还是间接连接。在本申请中所涉及的“多个”是指两个或两个以上。“和/或”描述关联对象的关联关系，表示可以存在三种关系，例如，“A和/或B”可以表示：单独存在A，同时存在A和B，单独存在B这三种情况。通常情况下，字符“/”表示前后关联的对象是一种“或”的关系。在本申请中所涉及的术语“第一”、“第二”、“第三”等，只是对相似对象进行区分，并不代表针对对象的特定排序。在本实施例中提供的方法实施例可以在终端、计算机或者类似的运算装置中执行。比如在终端上运行，图1是本实施例的图像聚焦方法的终端的硬件结构框图。如图1所示，终端可以包括一个或多个处理器102和用于存储数据的存储器104，其中，处理器102可以包括但不限于微处理器MCU或可编程逻辑器件FPGA等的处理装置。上述终端还可以包括用于通信功能的传输设备106以及输入输出设备108。本领域普通技术人员可以理解，图1所示的结构仅为示意，其并不对上述终端的结构造成限制。例如，终端还可包括比图1中所示更多或者更少的组件，或者具有与图1所示出的不同配置。存储器104可用于存储计算机程序，例如，应用软件的软件程序以及模块，如在本实施例中的图像聚焦方法对应的计算机程序，处理器102通过运行存储在存储器104内的计算机程序，从而执行各种功能应用以及数据处理，即实现上述的方法。存储器104可包括高速随机存储器，还可包括非易失性存储器，如一个或者多个磁性存储装置、闪存、或者其他非易失性固态存储器。在一些实例中，存储器104可进一步包括相对于处理器102远程设置的存储器，这些远程存储器可以通过网络连接至终端。上述网络的实例包括但不限于互联网、企业内部网、局域网、移动通信网及其组合。传输设备106用于经由一个网络接收或者发送数据。上述的网络包括终端的通信供应商提供的无线网络。在一个实例中，传输设备106包括一个网络适配器，其可通过基站与其他网络设备相连从而可与互联网进行通讯。在一个实例中，传输设备106可以为射频模块，其用于通过无线方式与互联网进行通讯。在本实施例中提供了一种图像聚焦方法，图2是本实施例的图像聚焦方法的流程图，如图2所示，该流程包括如下步骤：步骤S210，确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值；步骤S220，在每次自动聚焦时，基于位置补偿值，预测待聚焦设备的焦点位置；步骤S230，控制待聚焦设备的电机运行到焦点位置，进行自动聚焦的微调搜索。其中，待聚焦设备指的是需要聚焦的设备，其包括但不限于数码摄像设备、显微镜、无人视频监控以及卫星遥感等。这些待聚焦设备在使用过程中可以采集其视野范围内不同位置的图像，那么在采集的过程中需要不停的自动聚焦。在本实施例中，会事先利用标定、对图像的模糊度检测算法结合粗调搜索的数据比对等方式，来确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值。实际应用中，可以是在第一次自动聚集时，计算出待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值。还可以是在出厂设置时，对待聚焦设备进行位置补偿值的标定，来得到位置补偿值。其中，位置补偿值可以存储在待聚焦设备的存储模块中；位置补偿值也可以存储在服务器中，对位置补偿值的具体存储方式并不进行限制。在每次自动聚集时，从服务器或存储模块中获取到待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值；可以直接基于该位置补偿值，预测待聚焦设备的焦点位置；利用位置补偿值来抵消滞后的现象，避免在粗调搜索过程中出现需要二次搜索的情况发生；再控制待聚焦设备的电机运行到焦点位置，由于电机已经运行到焦点位置，相当于是直接完成粗调搜索过程，从而可以直接进行自动聚焦的微调搜索。在相关技术中，在聚焦的粗调搜索过程中，高频分量最大值在过了实际焦点的位置才采样到。因此在搜索到峰值之后不能直接定位到高频分量最大值就结束，而是必须进行二次搜索，滞后的位置越多，搜索的速度越慢。而本申请直接利用获取的位置补偿值来补偿滞后，使得待聚焦设备的电机可以直接运行到焦点位置，以完成粗调搜索过程，再直接进行自动聚焦的微调搜索；解决了相关技术中无法直接定位到高频分量最大值，导致需要二次搜索，造成搜索速度慢的问题，利用自动聚焦的粗调搜索中采样的位置补偿值直接定位到对应相关技术的高频分量最大值的焦点位置，再直接进行微调搜索，不再需要二次搜索，极大程度加快自动聚焦的速度和准确度。下面对上述各步骤进行详细说明：在其中的一些实施例中，如图3所示，步骤S210中的确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值，包括如下步骤：步骤S211，在自动聚焦的粗调过程中，按预设采样间隔获取第一图像和对应的第一评价算子值；在获取到最大第一评价算子值时，记录每个第一评价算子值对应的第一电机位置，得到一组第一电机位置数组；第一图像为粗调过程中待聚焦设备采集的图像；步骤S212，在自动聚焦的微调过程中，确定第二图像对应的第二电机位置；第二图像的第二评价算子值满足预设模糊度要求；第二图像为微调过程中待聚焦设备采集的图像；步骤S213，根据第一电机位置数组和第二电机位置，确定自动聚焦的粗调搜索中采样的位置补偿值。具体的，第一图像和第二图像可以认为是待聚焦设备在不同聚焦过程中采集固定目标对象得到的图像；该目标对象可以为标定板。其中，第一图像为粗调过程中待聚焦设备采集的图像；待聚焦设备的粗调过程中第一评价算子值具有滞后性。在粗调过程中，按预设采样间隔进行采样，每次采样获取第一图像和第一评价算子值。该第一评价算子值与采样的第一图像对应。在第一评价算子值达到最大值时；记录每个第一评价算子值对应的第二电机位置；将每个第二电机位置组成一组第一电机位置数组。其中，采样间隔是预先设置的，每次采样的采样间隔相同。其中，第二图像为微调过程中待聚焦设备采集的图像；该微调过程可以承接在步骤S211的粗调之后，也可以直接采用预设步长进行微调，从而找到第二图像。第二图像的第二评价算子值满足预设模糊度要求，可以认为第二图像是清晰的图像，那么此时电机所在的第二电机位置即为焦点位置。可以以第二电机位置作为依据来确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值。其中，确定自动聚焦的粗调搜索中采样的位置补偿值的过程可以为：将第一电机位置数组中的各第一电机位置和第二电机位置进行比较，根据比较结果确定自动聚焦的粗调搜索中采样的位置补偿值。其中，第一评价算子值和第二评价算子值包括但不限于：Sobel算子值、Laplacian算子值以及信息熵算子值等。第一评价算子值和第二评价算子值可以根据需求来选择对应的算子值，选择不同的算子值，及采样不同的图像清晰度评价算法来实现，比如：第二评价算子值为Sobel算子值，那么会采用Tenengrad梯度函数来对图像清晰度进行评价。通过本实施例，在自动聚焦的粗调过程中记录每个第一评价算子值对应的第一电机位置得到第一电机位置数组，结合第二评价算子值对应的第二电机位置，来确定位置补偿值，以保障位置补偿值计算的准确度。在其中的一些实施例中，步骤S211中的在自动聚焦的粗调过程中，按预设采样间隔获取第一图像和对应的第一评价算子值；在获取到最大第一评价算子值时，记录每个第一评价算子值对应的第一电机位置，得到一组第一电机位置数组，包括如下步骤：在自动聚焦的粗调过程中，控制待聚焦设备中电机以预设速度持续运行；基于预设采样间隔，通过待聚焦设备在不同第一电机位置下获取第一图像；确定每个第一图像对应的第一评价算子值；在获取到最大第一评价算子值时，记录每个第一评价算子值对应的第一电机位置，得到一组第一电机位置数组。具体的，在本实施例中自动聚焦采用爬山算法为例，该算法分成粗调过程M-P-P1，微调过程P1-P。在粗调过程中电机以最快的预设速度一直运行，确定最大第一评价算子值P点范围；微调过程中电机运行固定步长，并每运行一步等待图像稳定，更精细确认P点位置。由于电机在运行中采集的图像一直变化，相关算法也一直在调节中。因此以固定的采样间隔去获取第一评价算子值存在滞后性，T值位置是粗调过程中获取的高频分量最大值对应的第一评价算子值，与实际最高点P值位置存在距离。其中，在采集到第一图像后，可以利用相关算法或调用相关处理芯片，得到每个第一图像对应的第一评价算子值；在第一评价算子值达到最大时，可以认为搜索到高频分量最大值；此时，记录高频分量最大值对应的第一评价算子值及之前每个第一评价算子值对应的第二电机位置，得到一组第一电机位置数组。比如：第一个至第九个第二电机位置为Y1至Y9；其中，Y9为高频分量最大值对应的第一评价算子值对应的第二电机位置，那么会记录Y1至Y9。通过本实施例，确定每个第一图像对应的第一评价算子值，在获取到最大第一评价算子值时，记录每个第一评价算子值对应的第二电机位置，来实现第一评价算子值与粗调搜索过程中具有滞后性的匹配。在其中的一些实施例中，步骤S212中的在自动聚焦的微调过程中，确定第二图像对应的第二电机位置，包括如下步骤：在自动聚焦的微调过程中，获取待聚焦设备中电机当前位置对应的第三图像，对第三图像的边缘进行图像模糊度检测，得到第三图像的模糊度评价指标；将模糊度评价指标转换到预设范围阈值中，得到第三图像的第二评价算子值；在第二评价算子值满足预设模糊度要求时，将第三图像作为第二图像，并将电机的当前位置作为第二图像对应的第二电机位置；在第二评价算子值不满足预设模糊度要求时，对电机的当前位置进行调整。具体的，图像的边缘更能体现图像的清晰度，因此可以利用相关模糊度检测算法对第三图像的边缘进行图像模糊度检测，得到第三图像的模糊度评价指标，以提高检测效率。其次，将模糊度评价指标转换到预设范围阈值中，使得得到的第二评价算子值具有统一的量度，具有通用性。最后会判断第二评价算子值是否满足预设模糊度要求，如果满足则将第三图像作为第二图像，并将电机的当前位置作为第二图像对应的第二电机位置；如果不满足预设模糊度要求，则对电机的当前位置进行调整，重新获取第三图像进行相关处理，直到第三图像的第二评价算子值满足预设模糊度要求。通过上述实施例，利用图像模糊度检测，提高第二电机位置计算的准确度。在其中的一些实施例中，对第三图像的边缘进行图像模糊度检测，得到第三图像的模糊度评价指标，包括如下步骤：对第三图像进行滤波，得到滤波图像；对滤波图像进行边缘增强，得到边缘图像；对边缘图像进行图像模糊度检测，得到第三图像的模糊度评价指标。其中，利用滤波算法或滤波器等方式，对第三图像进行滤波，得到滤波图像，能够提高后续边缘检测的准确度。其中，采用高斯滤波器来对第三图像进行滤波，得到滤波图像；其具体包括如下步骤：对第三图像进行灰度转换，得到灰度图像；利用高斯滤波器，对灰度图像进行卷积处理，得到四个方向的滤波图像。其中，高斯滤波器是根据高斯函数的形状来选择权值的线性平滑滤波器。利用高斯滤波器中0均值的二维高斯函数，可以生成高斯卷积核，用于图像处理中的高斯滤波，实现高斯模糊的效果，有效去除高斯噪声。其中，二维高斯函数的表达式为：；式中，高斯滤波模板分别对灰度化图像进行卷积处理，得到滤波后的四个方向像素灰度图。其中，这四个方向的滤波模板如图4、图5、图6以及图7所示。图中的各数值M的表达式为：；式中，、、等，在此不一一举例。以两幅滤波图像为为例，采用非极大值抑制算法，将两幅滤波图像中相同像素位置的灰度值进行比较，保留灰度值大的作为比对结果，遍历两幅滤波图像的每个像素位置，从而得到增强中间图像；再将增强中间图像与剩余两幅滤波图像中的一幅，采用非极大值抑制算法，以灰度值的大小作为对比条件进行处理，更新增强中间图像；最后将更新的增强中间图像与最后一幅滤波图像，采用非极大值抑制算法，以灰度值的大小作为对比条件进行处理，得到边缘图像。通过本实施例，采用非极大值抑制算法，对滤波图像进行边缘增强，得到边缘图像，在提升对四副滤波图像处理效率的同时，对图像的边缘增强的完成度高。其中，对边缘图像进行图像模糊度检测，得到第三图像的模糊度评价指标；其具体包括如下步骤：按预设灰度阈值，对边缘图像进行筛选，计算筛选后的边缘图像的灰度平均值；将灰度平均值，作为第三图像的模糊度评价指标。具体的，经过边缘增强得到的边缘图像，该边缘图像像素点的邻域中有很多像素点的梯度值比较大，导致有些像素点需要剔除，以避免对模糊度评价指标准确度的影响。因此需要按预设灰度阈值，对边缘图像进行筛选，计算筛选后的边缘图像的灰度平均值；其中，灰度阈值可以根据使用要求来设置，比如：灰度阈值可以为50。筛选出灰度阈值为50以上的像素点，再对这些像素点的灰度值求平均，得到灰度平均值，该灰度平均值即为第三图像的模糊度评价指标。通过本实施例，利用先筛选，再求均值的方式得到第三图像的模糊度评价指标，能够提高计算的准确度。在其中的一些实施例中，将模糊度评价指标转换到预设范围阈值中，得到第三图像的第二评价算子值，包括如下步骤：将模糊度评价指标归一化到0至255的预设范围阈值中，得到第三图像的第二评价算子值。具体的，范围阈值为0至255，那么对模糊度评价指标进行归一化处理，即可将模糊度评价指标转换到该预设范围阈值中，得到第三图像的第二评价算子值。通过本实施例，采用归一化后的第二评价算子值来表示模糊度评价指标，能够直接应用于各类搜索算法，扩大使用的场景。在其中的一些实施例中，步骤S213中的根据第一电机位置数组和第二电机位置，确定动聚焦的粗调搜索中采样的位置补偿值，包括如下步骤：将第二电机位置和第一电机位置数组中的各第一电机位置进行对比，筛选出与第二电机位置匹配的第一电机位置，得到对应的匹配采样序号；将最大第一评价算子值对应的极值采样序号和匹配采样序号的差值，作为自动聚焦的粗调搜索中采样的位置补偿值。具体的，将第二电机位置和第一电机位置数组中的每个第一电机位置进行一一对比。比如：第二电机位置为X；记录的第一电机位置为Y1至Y9，最大第一评价算子值对应的极值采样序号为9号；以电机位置的数值为匹配依据，如果X与Y6最匹配；那么将9号和第二电机位置Y6对应的采用序号6号的差值3作为位置补偿值，从而实现快速计算位置补偿值。在其中的一些实施例中，图像聚焦方法，还包括如下步骤：重复确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值，得到多个位置补偿值；将多个位置补偿值的平均值，作为新的位置补偿值。具体的，为了进一步保障位置补偿值计算的准确度，可以重复确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值，即可以认为是重复执行步骤S211至步骤S213，每执行一轮得到一个位置补偿值；每次得到的位置补偿值都可以存储至数据库。执行多轮后再求平均值，将平均值作为新的位置补偿值。在其他实施例中，还可以对多个位置补偿值进行筛选，比如剔除异常值等，进一步提高准确度。在其中的一些实施例中，图像聚焦方法，还包括如下步骤：在进行自动聚焦的微调搜索后，获取第五图像，确定第五图像对应的第二评价算子值；在第五图像对应的第二评价算子值满足预设模糊度要求时，结束聚焦。其中，第五图像对应的第二评价算子值的实现过程为：对第五图像的边缘进行图像模糊度检测，得到第五图像的模糊度评价指标；将第五图像的模糊度评价指标转换到预设范围阈值中，得到第五图像的第二评价算子值；在第五图像的第二评价算子值满足预设模糊度要求时，结束聚焦；在第五图像的第二评价算子值不满足预设模糊度要求时，继续执行微调搜索。在其中的一些实施例中，步骤S220中的在每次自动聚焦时，基于位置补偿值，预测待聚焦设备的焦点位置，包括如下步骤：获取当前聚焦过程中，粗调搜索得到的第二电机位置数组；基于位置补偿值确定第二电机位置数组中的目标电机位置值，将目标电机位置值作为待聚焦设备的焦点位置。具体的，对于每次自动聚焦，会先完成一次粗调搜索，以获取一组第二电机位置数组；第二电机位置数组与第一电机位置数组区别只在于粗调搜索的时间不同，在此不对第二电机位置数组的获取展开阐述。基于位置补偿值对第二电机位置数组中的电机位置进行矫正；可以认为按位置补偿值从第二电机位置数组中筛选出目标电机位置值，再将目标电机位置值作为待聚焦设备的焦点位置。比如：第一电机位置数组为，其中，第一评价算子值对应的第一电机位置是50；第二评价算子值对应的第二电机位置为30；那么位置补偿值为2帧；再次自动聚焦时，再得到一组第二电机位置数组为，那么位置补偿值2帧，得到预测的焦点位置为35。通过本实施例，利用位置补偿值来实现焦点位置的快速预测，并且能够保障预测的准确性。在其中的一些实施例中，在进行自动聚焦的微调搜索之前，图像聚焦方法还包括如下步骤：判断焦点位置处所采集的第一图像所对应的第一评价值算子值是否满足预设阈值范围条件；若第一评价值算子值不满足预设阈值范围条件，则对焦点位置进行调整；若第一评价值算子值满足预设阈值范围条件，则执行进行自动聚焦的微调搜索步骤。具体的，为了进一步保证自动聚焦的微调搜索的正常进行，需要完成判断焦点位置处所采集的第一图像所对应的第一评价值算子值是否满足预设阈值范围条件；预设阈值范围条件只是用来保证微调搜索能够正常进行即可，预设阈值范围条件根据使用要求来设置，对此并不进行限制。若第一评价值算子值不满足预设阈值范围条件，则对焦点位置进行调整。比如：利用爬山算法中微调搜索步骤，来调整焦点位置，再继续判断调整后焦点位置处所采集的第一图像所对应的第一评价值算子值是否满足预设阈值范围条件；直到第一评价值算子值满足预设阈值范围条件。若第一评价值算子值满足预设阈值范围条件，则执行进行自动聚焦的微调搜索步骤。其中，自动聚焦的微调搜索步骤可以认为是爬山算法中微调搜索步骤，对此并不进行限制。通过本实施例，在自动聚焦的微调搜索步骤之前，通过第一评价值算子值与预设阈值范围条件的比较来保证焦点位置符合微调搜索的进行。需要说明的是，在本实施例中的具体示例可以参考上述实施例及可选实施方式中所描述的示例，在本实施例中不再赘述。通过本实施例，进一步保障聚焦效果，使其能够适用于对图像清晰度要求很高的使用场景中。需要说明的是，在上述流程中或者附图的流程图中示出的步骤可以在诸如一组计算机可执行指令的计算机系统中执行，并且，虽然在流程图中示出了逻辑顺序，但是在某些情况下，可以以不同于此处的顺序执行所示出或描述的步骤。在本实施例中还提供了一种图像聚焦装置，该装置用于实现上述实施例及优选实施方式，已经进行过说明的不再赘述。以下所使用的术语“模块”、“单元”、“子单元”等可以实现预定功能的软件和/或硬件的组合。尽管在以下实施例中所描述的装置较佳地以软件来实现，但是硬件，或者软件和硬件的组合的实现也是可能并被构想的。图8是本实施例的图像聚焦装置的结构框图，如图8所示，该装置包括：处理模块210、预测模块220以及微调搜索模块230；处理模块210，用于确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值；预测模块220，用于在每次自动聚焦时，基于位置补偿值，预测待聚焦设备的焦点位置；微调搜索模块230，用于控制待聚焦设备的电机运行到焦点位置，进行自动聚焦的微调搜索。通过上述装置，解决了相关技术中无法直接定位到高频分量最大值，导致需要二次搜索，造成搜索速度慢的问题，利用自动聚焦的粗调搜索中采样的位置补偿值直接定位到对应相关技术的高频分量最大值的焦点位置，再直接进行微调搜索，不再需要二次搜索，极大程度加快自动聚焦的速度和准确度。在其中的一些实施例中，处理模块210，还用于在自动聚焦的粗调过程中，按预设采样间隔获取第一图像和对应的第一评价算子值；在获取到最大第一评价算子值时，记录每个第一评价算子值对应的第一电机位置，得到一组第一电机位置数组；第一图像为粗调过程中待聚焦设备采集的图像；在自动聚焦的微调过程中，确定第二图像对应的第二电机位置；第二图像的第二评价算子值满足预设模糊度要求；第二图像为微调过程中待聚焦设备采集的图像；根据第一电机位置数组和第二电机位置，确定自动聚焦的粗调搜索中采样的位置补偿值。在其中的一些实施例中，处理模块210，还用于在自动聚焦的粗调过程中，控制待聚焦设备中电机以预设速度持续运行；基于预设采样间隔，通过待聚焦设备在不同第一电机位置下获取第一图像；确定每个第一图像对应的第一评价算子值；在获取到最大第一评价算子值时，记录每个第一评价算子值对应的第一电机位置，得到一组第一电机位置数组。在其中的一些实施例中，处理模块210，还用于在自动聚焦的微调过程中，获取待聚焦设备中电机当前位置对应的第三图像，对第三图像的边缘进行图像模糊度检测，得到第三图像的模糊度评价指标；将模糊度评价指标转换到预设范围阈值中，得到第三图像的第二评价算子值；在第二评价算子值满足预设模糊度要求时，将第三图像作为第二图像，并将电机的当前位置作为第二图像对应的第二电机位置；在第二评价算子值不满足预设模糊度要求时，对电机的当前位置进行调整。在其中的一些实施例中，处理模块210，还用于对第三图像进行滤波，得到滤波图像；对滤波图像进行边缘增强，得到边缘图像；对边缘图像进行图像模糊度检测，得到第三图像的模糊度评价指标。在其中的一些实施例中，处理模块210，还用于将第二电机位置和第一电机位置数组中的各第一电机位置进行对比，筛选出与第二电机位置匹配的第一电机位置，得到对应的匹配采样序号；将最大第一评价算子值对应的极值采样序号和匹配采样序号的差值，作为自动聚焦的粗调搜索中采样的位置补偿值。在其中的一些实施例中，预测模块220，还用于获取当前聚焦过程中，粗调搜索得到的第二电机位置数组；基于所述位置补偿值确定所述第二电机位置数组中的目标电机位置值，将所述目标电机位置值作为所述待聚焦设备的焦点位置。在其中的一些实施例中，图像聚焦装置还包括：判断模块；判断模块，用于判断所述焦点位置处所采集的第一图像所对应的第一评价值算子值是否满足预设阈值范围条件；若所述第一评价值算子值不满足所述预设阈值范围条件，则对所述焦点位置进行调整；若所述第一评价值算子值满足所述预设阈值范围条件，则执行所述进行自动聚焦的微调搜索步骤。在其中的一些实施例中，图像聚焦装置还包括：循环模块；循环模块，用于重复确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值，得到多个位置补偿值；将多个位置补偿值的平均值，作为新的位置补偿值。需要说明的是，上述各个模块可以是功能模块也可以是程序模块，既可以通过软件来实现，也可以通过硬件来实现。对于通过硬件来实现的模块而言，上述各个模块可以位于同一处理器中；或者上述各个模块还可以按照任意组合的形式分别位于不同的处理器中。在本实施例中还提供了一种计算机设备，包括存储器和处理器，该存储器中存储有计算机程序，该处理器被设置为运行计算机程序以执行上述任一项方法实施例中的步骤。可选地，上述计算机设备还可以包括传输设备以及输入输出设备，其中，该传输设备和上述处理器连接，该输入输出设备和上述处理器连接。可选地，在本实施例中，上述处理器可以被设置为通过计算机程序执行以下步骤：S1，确定待聚焦设备在自动聚焦的粗调搜索中采样的位置补偿值；S2，在每次自动聚焦时，基于位置补偿值，预测待聚焦设备的焦点位置；S3，控制待聚焦设备的电机运行到焦点位置，进行自动聚焦的微调搜索。需要说明的是，在本实施例中的具体示例可以参考上述实施例及可选实施方式中所描述的示例，在本实施例中不再赘述。此外，结合上述实施例中提供的图像聚焦方法，在本实施例中还可以提供一种存储介质来实现。该存储介质上存储有计算机程序；该计算机程序被处理器执行时实现上述实施例中的任意一种图像聚焦方法。应该明白的是，这里描述的具体实施例只是用来解释这个应用，而不是用来对它进行限定。根据本申请提供的实施例，本领域普通技术人员在不进行创造性劳动的情况下得到的所有其它实施例，均属本申请保护范围。显然，附图只是本申请的一些例子或实施例，对本领域的普通技术人员来说，也可以根据这些附图将本申请适用于其他类似情况，但无需付出创造性劳动。另外，可以理解的是，尽管在此开发过程中所做的工作可能是复杂和漫长的，但是，对于本领域的普通技术人员来说，根据本申请披露的技术内容进行的某些设计、制造或生产等更改仅是常规的技术手段，不应被视为本申请公开的内容不足。“实施例”一词在本申请中指的是结合实施例描述的具体特征、结构或特性可以包括在本申请的至少一个实施例中。该短语出现在说明书中的各个位置并不一定意味着相同的实施例，也不意味着与其它实施例相互排斥而具有独立性或可供选择。本领域的普通技术人员能够清楚或隐含地理解的是，本申请中描述的实施例在没有冲突的情况下，可以与其它实施例结合。以上所述实施例仅表达了本申请的几种实施方式，其描述较为具体和详细，但并不能因此而理解为对专利保护范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本申请构思的前提下，还可以做出若干变形和改进，这些都属于本申请的保护范围。因此，本申请的保护范围应以所附权利要求为准。
