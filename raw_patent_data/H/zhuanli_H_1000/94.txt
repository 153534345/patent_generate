标题title
一种重传报文的方法、电子设备及存储介质
摘要abst
本发明涉及通信技术领域，特别是涉及一种重传报文的方法、电子设备及存储介质。应用于第一节点的数据链路层MAC，所述方法还包括以下步骤：获取第二节点发送的第i个报文messi，messi的数据位中包括校验位FCSi域段和报文身份编码信息MPIDi域段，每个域段具有预设的数据长度；获取期望的报文身份编码信息；根据MPIDi与第一节点期望的报文身份编码信息MPIDi´是否相同，判断是否发生了丢包，并结合校验结果重传报文。由于在数据链路层进行的重传，因此可以将重传的延时控制在0.5‑5微秒，相较于网络拥塞管理机制的现有技术的重传延时100微秒的时间，大幅度的缩短了重传延时。
权利要求书clms
1.一种重传报文的方法，其特征在于，应用于第一节点的数据链路层MAC，所述方法还包括以下步骤：S100，获取第二节点发送的第i个报文messi，所述messi的数据位中包括校验位FCSi域段和报文身份编码信息MPIDi域段；S200，获取期望的报文身份编码信息MPIDi´；S300，根据FCSi校验messi得到messi的校验结果；S400，当messi的校验结果为校验通过，且MPIDi与MPIDi´相同时，将messi中的MPIDi删除，并将删除了MPIDi的messi发送给MAC的上一层；当messi的校验结果为校验失败，则等到下一个校验结果为校验通过的报文messi+r，根据messi+r中携带的报文身份编码信息MPIDi+r计算messi正确的报文身份编码信息MPIDi″，根据MPIDi″生成专用反馈报文bmessi，并将bmessi发送给第二节点，使第二节点重传具有MPIDi″的报文；当messi的校验结果为校验通过且MPIDi与MPIDi´不同时，根据messi中携带的报文身份编码信息MPIDi计算上一个报文messi-1的正确的报文身份编码信息MPIDi-1″，根据MPIDi-1″生成专用反馈报文bmessi-1，并将bmessi-1发送给第二节点，使第二节点重传具有MPIDi-1″的报文。2.根据权利要求1所述的方法，其特征在于，所述方法还包括：S10，向第二节点发送第j个报文messj，其中messj中包括报文身份编码信息MPIDj，MPIDj为报文的数据位中的生成报文身份编码信息域段。3.根据权利要求2所述的方法，其特征在于，S10还包括：S11，根据第j-1个报文messj-1的报文身份编码信息MPIDj-1获取第j个报文messj的报文身份编码信息MPIDj；S12，根据第j个报文messj的数据信息生成校验码；S13，根据MPIDj、第j个报文messj的数据信息和校验码生成messj，其中messi的数据位中包括数据信息域段、校验位FCSi域段和报文身份编码信息MPIDi域段，每个域段具有预设的数据长度。4.根据权利要求2所述的方法，其特征在于，S100中的MPIDj为有序编码。5.根据权利要求2所述的方法，其特征在于，所述MPIDj为哈希码、伪随机序列码或顺序编码中的一种。6.根据权利要求1所述的方法，其特征在于，当第二节点重传报文messi时，同时重传第二节点在发送messi之后且在重传messi之前已经发送给第一节点的k个报文。7.根据权利要求1所述的方法，其特征在于，所述报文身份编码信息还包括实际报文身份编码位和结束标记位，其中，结束标记位用于检测是否接收到所有的报文。8.根据权利要求7所述的方法，其特征在于，所述结束标记位为给最后一个报文配置的预设结束标记；或者，给最后L个报文配置预设的倒计时标记；或者，给所有报文配置的计数器。9.一种非瞬时性计算机可读存储介质，所述存储介质中存储有至少一条指令或至少一段程序，其特征在于，所述至少一条指令或所述至少一段程序由处理器加载并执行以实现如权利要求1-8中任意一项的所述方法。10.一种电子设备，其特征在于，包括处理器和权利要求9中所述的非瞬时性计算机可读存储介质。
说明书desc
技术领域本发明涉及通信技术领域，特别是涉及一种重传报文的方法、电子设备及存储介质。背景技术数据在从源端传输至目的端的过程中，衰变的电压信号，噪音、传输设备故障或其他因素都会导致误码，目的端在检测到误码时会丢弃产生误码的数据，进而导致数据传输失败。因此，当校验失败时需要重传校验失败的码字。目前针对丢包的问题，一般采用网络拥塞管理机制，也即结合PFC和ECN，其中，PFC 是在网络拥塞时暂停低优先级流量，以确保高优先级流量的传输。ECN是在网络拥塞时向数据包添加标记，以通知源端和目的端网络的拥塞情况。PFC主要用于保证数据包传输的优先级，而ECN则用于控制网络拥塞，这两种机制可以结合使用，以最大限度地减少网络拥塞和数据包丢失，提高网络的性能和可靠性。上述网络拥塞管理机制，适用于小规模组网结构，例如几十到几百个处理器组成的网络结构。对于大规模的组网结构，例如由上千个处理器组成的网络结构，需要重传的数据量很大，上述网络拥塞管理机制会导致重传的延时很大。因此亟需一种延时较小的数据重传方法。发明内容针对上述技术问题，本发明采用的技术方案为：一种重传报文的方法，应用于第一节点的数据链路层MAC，所述方法还包括以下步骤：S100，获取第二节点发送的第i个报文messi，所述messi的数据位中包括校验位FCSi域段和报文身份编码信息MPIDi域段。S200，获取期望的报文身份编码信息MPIDi´。S300，根据FCSi校验messi得到messi的校验结果。S400，当messi的校验结果为校验通过，且MPIDi与MPIDi´相同时，将messi中的MPIDi删除，并将删除了MPIDi的messi发送给MAC的上一层。当messi的校验结果为校验失败，则等到下一个校验结果为校验通过的报文messi+r，根据messi+r中携带的报文身份编码信息MPIDi+r计算messi正确的报文身份编码信息MPIDi″，根据MPIDi″生成专用反馈报文bmessi，并将bmessi发送给第二节点，使第二节点重传具有MPIDi″的报文。当messi的校验结果为校验通过且MPIDi与MPIDi´不同时，根据messi中携带的报文身份编码信息MPIDi计算上一个报文messi-1的正确的报文身份编码信息MPIDi-1″，根据MPIDi-1″生成专用反馈报文bmessi-1，并将bmessi-1发送给第二节点，使第二节点重传具有MPIDi-1″的报文。此外，本发明还提供了一种非瞬时性计算机可读存储介质，所述存储介质中存储有至少一条指令或至少一段程序，所述至少一条指令或所述至少一段程序由处理器加载并执行以实现上述方法。此外，本发明还提供了一种电子设备，包括处理器和上述非瞬时性计算机可读存储介质。本发明与现有技术相比具有明显的有益效果，借由上述技术方案，本发明提供的本发明提供了一种重传报文的方法、电子设备及存储介质可达到相当的技术进步性及实用性，并具有产业上的广泛利用价值，其至少具有以下有益效果：其通过在第二节点数据链路层发送的报文中增加报文身份编码信息MPIDi，根据报文身份编码信息MPIDi与第一节点期望的报文身份编码信息MPIDi´是否相同，判断是否发生了丢包；当两者相同且校验通过时，将增加的报文身份编码信息MPIDi删除，以符合原始的通信协议之后发送给上一层。当校验失败时，此时报文中的所有信息不可信，则需要根据接收到的下一个校验通过的报文计算校验失败的报文的正确的报文身份编码信息，进而将正确的报文身份编码信息发送给第二节点使其重传，由于在数据链路层进行的重传，因此可以将重传的延时控制在0.5-5微秒，相较于网络拥塞管理机制的现有技术的重传延时100微秒的时间，大幅度的缩短了重传延时。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例提供的一种重传报文的方法流程图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域技术人员在没有作出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。请参阅图1，其示出了一种重传报文的方法流程图，该方法应用于第一节点的数据链路层MAC，所述方法还包括以下步骤：S100，获取第二节点发送的第i个报文messi，所述messi的数据位中包括校验位FCSi域段和报文身份编码信息MPIDi域段，每个域段具有预设的数据长度。其中，第一节点和第二节点均为节点。可选的，节点为相互通信的两个通信终端。可选的，终端为GPU、GPGPU、CPU、AI芯片等处理器。还可以是包括处理器的设备，例如计算机、只能移动终端等。现有技术中，其他用于通信的节点也落入本发明的保护范围之内。其中，节点和节点之间可以通过交换机透传。其中，第一节点可以向第二节点发送报文，也可以接收第二节点发送的报文。可选的，节点之间的通信协议为以太网协议。以太网协议中网络接口层封装了OSI参考模型中的数据链路层MAC和物理层。现有技术中其他局域网协议也落入本发明的保护范围之内。可选的，在以太网协议中，数据链路层的报文包括帧起始位、数据位和帧结束位。数据位包括多个域段，具体包括：源地址、目的地址、期望数据类型、全局路由头、扩展传输头、有效载荷、固定校验位ICRC和帧检验序列，每个域段具有预设数据长度。其中，固定校验位ICRC仅包括对转发时不发生变化的域段进行校验，帧检验序列FCS包括了所有域段，每次转发时都会重新计算。数据位中的每个域段都按照以太网协议具有对应的数据长度。现有技术中由帧起始位、数据位和帧结束位组成的报文均落入本发明的保护范围之内。其中，在传统报文的数据位中并不包括报文身份编码信息MPIDi域段，本发明实施例通过在数据位中增加报文身份编码信息域段。增加的报文身份编码信息域段具有预设的域段长度。可选的，报文身份编码信息MPIDi域段插入到期望数据类型和全局路由头之间。进一步，根据MPIDi在报文中的偏移位置进行插入。现有技术中，将报文身份编码信息MPIDi域段插入到数据位的其他位置也落入本发明的保护范围之内。其中，报文身份编码信息MPIDi用于表示第二节点向第一节点发送的当前报文的有序编码。作为一个优选实施例，所述MPIDi为有序编码。可选的，MPIDi为哈希码、伪随机序列码或顺序编码中的一种。现有技术中其他有序编码也落入本发明的保护范围之内。需要说明的是，哈希码和伪随机序列码抗干扰能力强。顺序编码的生成算法简单，节约计算资源。S200，获取期望的报文身份编码信息MPIDi´。其中，第一节点和第二节点的通信协议相同，也即所采用的有序编码的类型相同。因此，当第二节点的报文中MPIDi为哈希码时，第一节点可以通过接收到的上一个报文中的报文身份编码信息预测下一个报文中的报文身份编码信息，预测得到的报文身份编码信息即为期望的报文身份编码信息。也即，第一节点可以通过接收到的第二节点发送的上一个报文的报文身份编码信息MPIDi-1预测期望的报文身份编码信息MPIDi´。S300，根据FCSi校验messi得到messi的校验结果。S400，当messi的校验结果为校验通过，且MPIDi与MPIDi´相同时，将messi中的MPIDi删除，并将删除了MPIDi的messi发送给MAC的上一层。此时，报文未出错也不存在丢失的报文，也即当前报文为正确传输的报文。将插入的报文身份编码信息MPIDi删除，符合原始的传输协议，能够使报文正确的传输到上一层中。其中，当通信协议为以太网协议时，上一层为网络层。需要说明的是，可能会在第二节点向第一节点发送的任意一个环节丢失，作为一个示例，第二节点经过交换机透传给第一节点，则丢失报文可能会发生在第二节点与交换机通信的过程中，也可能发生在交换机与第一节点通信的过程中，还可能发生在交换机内部丢失报文。进一步，当messi的校验结果为校验失败，则等到下一个校验结果为校验通过的报文messi+r，根据messi+r中携带的报文身份编码信息MPIDi+r计算messi正确的报文身份编码信息MPIDi″，根据MPIDi″生成专用反馈报文bmessi，并将bmessi发送给第二节点，使第二节点重传具有MPIDi″的报文。当校验失败时，说明接收到的报文在传输的过程中出错，出错的报文中的所有信息均不可信，也即其中携带的报文身份编码信息可能也出错了，因此需要等到下一个校验通过的报文推断该校验出错的报文的正确的报文身份编码信息。其中，报文messi+r为当前报文messi之后的第r个报文，r大于等于1。因为可能messi之后的第一个报文也出错了，需要一直等到校验通过的报文messi+r。根据在messi之前的正确报文messi-1以及报文messi+r即可计算出messi的报文身份编码。作为一个实例，当校验通过的第i+r个报文的报文身份编码信息为84，则计算出校验失败的第i+r-1个报文的报文身份编码信息为83，校验失败的第i+r-2个报文的报文身份编码信息为82，依次类推，得到校验失败的第i个报文的报文身份编码信息。进一步，当MPIDi与MPIDi´不同且messi的校验结果为校验通过时，根据messi中携带的报文身份编码信息MPIDi计算上一个报文messi-1的正确的报文身份编码信息MPIDi-1″，根据MPIDi-1″生成专用反馈报文bmessi-1，并将bmessi-1发送给第二节点，使第二节点重传具有MPIDi-1″的报文。需要说明的是，当报文中携带的报文身份编码信息与期望的报文身份编码信息不一致时，说明丢失了携带有期望的报文身份编码信息的报文，此时需要重传丢失的报文。可选的，当报文身份编码信息通过顺序编码的方式生成时，若MPIDi为84，MPIDi´为83，则说明83这条报文在传输的过程中丢失了，此时根据84计算上一个报文的报文身份编码信息为83，需要第二节点重传丢失的报文身份编码信息为83的报文。其中，本发明还包括：S10，向第二节点发送第j个报文messj，其中messj中包括报文身份编码信息MPIDj，MPIDj为报文的数据位中的生成报文身份编码信息域段。现有技术中，所有通过在报文的数据位中增加报文身份编码信息MPIDi域段生成第j个报文messj的方法均落入本发明的保护范围之内。在此基础上，本发明还提供一种新的作为一个优选实施例，所述方法还包括messj的生成步骤：S11，根据第j-1个报文messj-1的报文身份编码信息MPIDj-1获取第j个报文messj的报文身份编码信息MPIDj。可选的，获取MPIDj的算法为哈希算法，MPIDj为哈希码；获取MPIDj的算法为伪随机序列生成算法，MPIDj为伪随机序列码；获取MPIDj的算法为自增算法，MPIDj为顺序编码。现有技术中，用于生成有序编码的方法均落入本发明的保护范围之内。S12，根据第j个报文messj的数据信息生成校验码。可选的，生成校验码的校验算法为奇偶校验、校验和、循环冗余校验、纵向冗余校验、异或校验或者帧检验序列。所有用于生成校验码的其他校验算法均落入本发明的保护范围之内。S13，根据MPIDj、第j个报文messj的数据信息和校验码生成messj，其中messi的数据位中包括数据信息域段、校验位FCSi域段和报文身份编码信息MPIDi域段，每个域段具有预设的数据长度。可选的，数据信息域段还包括SA、DA、Ether-type、GRH、ETHs、IB payload和ICRC域段。现有技术中，由其他域段组成的数据信息域段都落入本发明的保护范围之内。需要说明的是，第一节点和第二节点在同一层组成报文的格式相同。作为一个优选实施例，当第二节点重传报文messi时，同时重传第二节点在发送messi之后且在重传messi之前已经发送给第一节点的k个报文，k大于0。同理，当第二节点重传报文messi-1时，同时重传第二节点在发送messi-1之后且在重传messi-1之前已经发送给第一节点的t个报文，t大于0。需要说明的是，第二节点还可以仅重传具有MPIDi的报文messi。作为一个优选实施例，报文身份编码信息还包括实际报文身份编码位和结束标记位，其中，结束标记位用于检测是否接收到所有的报文，防止由于通过校验通过的报文计算当前校验出错或丢失的报文身份编码信息，导致无法检测到最后一个报文是否丢失，使系统误认为已经接收到完整的数据的问题。可选的，所述结束标记位为给最后一个报文配置的预设结束标记，当检测到该预设标记时，说明接收到了所有的报文。或者，给最后L个报文配置预设的倒计时标记，倒计时完成时，说明接收到了所有的报文。或者，给所有报文配置的计数器，每接收到一个报文，计数器加1，当计数器的计数值等于预期的报文总数量时，说明接收到了所有的报文。综上所述，本发明提供了一种重传报文的方法，其通过在第二节点数据链路层发送的报文中增加报文身份编码信息MPIDi，通过报文身份编码信息MPIDi与第一节点期望的报文身份编码信息MPIDi´是否相同，判断是否发生了丢包；在向上一层发送报文时，将增加的报文身份编码信息MPIDi删除，以符合原始的通信协议。由于在数据链路层进行的重传，因此可以将重传的延时控制在0.5-5微秒，相较于网络拥塞管理机制的现有技术的重传延时100微秒的时间，大幅度的缩短了重传延时。本发明的实施例还提供了一种非瞬时性计算机可读存储介质，该存储介质可设置于电子设备之中以保存用于实现方法实施例中一种方法相关的至少一条指令或至少一段程序，该至少一条指令或该至少一段程序由该处理器加载并执行以实现上述实施例提供的方法。本发明的实施例还提供了一种电子设备，包括处理器和前述的非瞬时性计算机可读存储介质。本发明的实施例还提供一种计算机程序产品，其包括程序代码，当所述程序产品在电子设备上运行时，所述程序代码用于使该电子设备执行本说明书上述描述的根据本发明各种示例性实施方式的方法中的步骤。虽然已经通过示例对本发明的一些特定实施例进行了详细说明，但是本领域的技术人员应该理解，以上示例仅是为了进行说明，而不是为了限制本发明的范围。本领域的技术人员还应理解，可以对实施例进行多种修改而不脱离本发明的范围和精神。本发明公开的范围由所附权利要求来限定。
