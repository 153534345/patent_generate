标题title
一种基于分级式计数器的自适应CIC滤波系统
摘要abst
本申请公开了一种基于分级式计数器的自适应CIC滤波系统，属于信号处理领域，包括：积分单元，所述积分单元包括至少两个定时器、两个计数器，用于对输入信号进行积分；抽取单元，用于对积分后的信号进行抽取；滤波单元，用于将抽取后的信号进行平滑滤波；计算单元，用于计算滤波后信号的信噪比；判断单元，用于根据所述信噪比循环判断信号质量。用户通过设置信噪比的期望范围，经判断单元判断后对未处于期望范围内的信号调节滤波系统的级数和阶数，从而达到自适应信噪比的目的。本申请通过添加定时器和计数器的方式减少了滤波系统的计算复杂度，且通过自适应调节信噪比解决了因现有滤波器结构固定无法对多种应用场景下的信号进行滤波的问题。
权利要求书clms
1.一种基于分级式计数器的自适应CIC滤波系统，其特征在于，包括：积分单元，所述积分单元包括至少两个定时器、两个计数器，用于对输入信号进行积分；所述输入信号为经过调制后的1比特流数字信号，包括波形数据信号和采样时钟信号；抽取单元，用于对积分后的信号进行抽取；滤波单元，用于将抽取后的信号进行平滑滤波；计算单元，用于计算滤波后信号的信噪比；判断单元，用于根据所述信噪比循环判断信号质量。2.根据权利要求1所述的一种基于分级式计数器的自适应CIC滤波系统，其特征在于，在所述积分单元中，所述定时器用于设置延时时间，所述计数器在所述延时时间内对所述波形数据信号和所述采样时钟信号的上升沿计数。3.根据权利要求2所述的一种基于分级式计数器的自适应CIC滤波系统，其特征在于，根据所述定时器的延时时间对所述滤波系统进行分级。4.根据权利要求1所述一种基于分级式计数器的自适应CIC滤波系统，其特征在于，根据所述定时器的数量对所述滤波系统进行分阶。5.根据权利要求1所述的一种基于分级式计数器的自适应CIC滤波系统，其特征在于，预先设置信噪比的期望范围，通过所述判断单元判断经过所述滤波单元滤波后信号的信噪比是否在设置的信噪比期望范围内，对未处于信噪比期望范围内的信号进行自适应调节。6.根据权利要求5所述的一种基于分级式计数器的自适应CIC滤波系统，其特征在于，根据改变所述定时器的延时时间调节所述滤波系统的级数，通过改变所述滤波系统的级数自适应调节信号的信噪比。7.根据权利要求5所述的一种基于分级式计数器的自适应CIC滤波系统，其特征在于，根据改变所述定时器的数量调节所述滤波系统的阶数，通过改变所述滤波系统的阶数自适应调节信号的信噪比。8.根据权利要求5所述的一种基于分级式计数器的自适应CIC滤波系统，其特征在于，根据同时改变所述定时器的数量和所述定时器的延时时间调节所述滤波系统的阶数和级数，通过改变所述滤波系统的阶数和级数自适应调节信号的信噪比。
说明书desc
技术领域本申请涉及信号处理领域，具体而言，特别涉及一种基于分级式计数器的自适应CIC滤波系统。背景技术CIC滤波器由一对或多对积分-梳状滤波器组成，在抽取CIC中，输入信号依次经过积分、降采样以及与积分环节数目相同的梳状滤波器。在内插CIC中，输入信号依次经过梳状滤波器、升采样以及与梳状数目相同的积分环节。CIC滤波器的阶数是指滤波器内部级联的积分器和组合器的数量，CIC滤波器的级数是指滤波器多个CIC结构级联的数量。在信号通过传统的CIC滤波器滤波时，需要根据应用需求和性能优化预先选择滤波器的阶数以及级数，滤波器的阶数和级数决定了滤波器的频率响应和延迟，但因结构固定会导致应用场景受限。并且在现有的CIC滤波器中需要对采集到的数据进行多次积分，其计算复杂度较高、计算时间较长。发明内容基于现有技术的不足，针对现有滤波器结构固定且计算复杂度高的问题，本申请实施例提供了一种基于分级式计数器的自适应CIC滤波系统，包括：积分单元，所述积分单元包括至少两个定时器、两个计数器，用于对输入信号进行积分；所述输入信号为经过调制后的1比特流数字信号，包括波形数据信号和采样时钟信号；抽取单元，用于对积分后的信号进行抽取；滤波单元，用于将抽取后的信号进行平滑滤波；计算单元，用于计算滤波后信号的信噪比；判断单元，用于根据所述信噪比循环判断信号质量。可选地，在所述积分单元中，所述定时器用于设置延时时间，所述计数器在所述延时时间内对所述波形数据信号和所述采样时钟信号的上升沿计数。可选地，根据所述定时器的延时时间对所述滤波系统进行分级。可选地，根据所述定时器的数量对所述滤波系统进行分阶。可选地，预先设置信噪比的期望范围，通过所述判断单元判断经过所述滤波单元滤波后信号的信噪比是否在设置的信噪比期望范围内，对未处于信噪比期望范围内的信号进行自适应调节。可选地，根据改变所述定时器的延时时间调节所述滤波系统的级数，通过改变所述滤波系统的级数自适应调节信号的信噪比。可选地，根据改变所述定时器的数量调节所述滤波系统的阶数，通过改变所述滤波系统的阶数自适应调节信号的信噪比。可选地，根据同时改变所述定时器的数量和所述定时器的延时时间调节所述滤波系统的阶数和级数，通过改变所述滤波系统的阶数和级数自适应调节信号的信噪比。有益效果：本申请在CIC滤波系统中通过设计定时器和计数器代替积分器的方式对信号进行滤波，通过改变滤波系统的阶数和级数自适应调节信号的信噪比。在本申请中，用户可以根据需求预先设置输出信号的信噪比期望范围，对未处于期望范围内的输出信号自适应调节滤波系统阶数和级数使其信噪比能够处于期望范围内，其中调节滤波系统阶数的方式包括改变定时器的数量，调节滤波系统级数的方式包括改变定时器的延时时间，也可以同时改变滤波系统的阶数和级数自适应调节信噪比。通过本申请提出的自适应滤波系统可以解决因结构固定导致无法输出期望信号的问题，减少滤波系统的计算复杂度，降低了芯片的资源占用。附图说明此处所说明的附图用来提供对本申请的进一步理解，构成本申请的一部分，本申请的示意性实施例及其说明用于解释本申请，并不构成对本申请的不当限定。在附图中：图1是本申请实施例提出的一种基于分级式计数器的自适应CIC滤波系统示意图；图2是本申请实施例提出的自适应CIC滤波系统和传统滤波器的输出信号仿真示意图；图3是通过比较自适应CIC滤波系统和传统滤波器的输出信号相似度的变化趋势示意图；图4是本申请实施例提出的自适应CIC滤波系统在不同级数下调节信噪比的仿真变化趋势示意图；图5是本申请实施例提出的自适应CIC滤波系统在不同阶数下调节信噪比的仿真变化趋势示意图；图6是本申请实施例提出的自适应CIC滤波系统在不同阶数和不同级数下调节信噪比的仿真变化趋势示意图；其中，上述附图包括以下附图标记：1-第一定时器、2-第二定时器、3-第三定时器、4-第一计数器、5-第二计数器、6-抽取器、7-平滑滤波器、8-比较器、9波形数据信号、10-采样时钟信号、11-MCU。具体实施方式为了使本技术领域的人员更好地理解本申请方案，下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述。显然，所描述的实施例仅仅是本申请一部分的实施例，而不是全部的实施例。基于本申请中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都应当属于本申请保护的范围。需要说明的是，本申请的说明书和权利要求书及上述附图中的术语“第一”、“第二”等是用于区别类似的对象，而不必用于描述特定的顺序或先后次序。应该理解这样使用的数据在适当情况下可以互换，以便这里描述的本申请的实施例能够以除了在这里图示或描述的那些以外的顺序实施。此外，术语“包括”和“具有”以及他们的任何变形，意图在于覆盖不排他的包含，例如，包含了一系列步骤或单元的过程、方法、系统、产品或设备不必限于清楚地列出的那些步骤或单元，而是可包括没有清楚地列出的或对于这些过程、方法、产品或设备固有的其它步骤或单元。本申请实施例提供了一种基于分级式计数器的自适应CIC滤波系统，如图1所示，包括积分单元、抽取单元、滤波单元、计算单元和判断单元。其中积分单元包括至少两个定时器、两个计数器，在本申请实施例中包括三个定时器、两个计数器，具体体现为第一定时器1、第二定时器2、第三定时器3、第一计数器4、第二计数器5，在此申请实施例中不做具体限制，通过上述积分单元对输入信号进行积分。其中，输入信号为经sigma-delta调制器调制后的1bite流数字信号，数字信号包括波形数据信号9和采样时钟信号10。抽取单元包括抽取器6，用于对积分后的信号进行抽取，信号经过相应倍数的降采样抽取后输入至滤波单元，滤波单元包括平滑滤波器7，用于对抽取后的信号进行滑动平均滤波。计算单元用于计算信号经过积分、抽取、平滑滤波后的信噪比，计算方法为：首先对信号进行傅里叶变换计算得到功率谱密度函数，并寻找功率谱密度函数的最大值波段，将该波段的值进行平方即为有效信号功率 Ps，将功率谱密度函数进行积分即为信号总功率 Pa，取信号总功率的一半减去有效信号功率即为噪声功率 Pn，再根据公式计算出信号的信噪比。SNR=10log10  其中 SNR 为信噪比，Ps 为有效信号功率，Pn 为噪声功率。判断单元在此申请中具体为比较器8，用于判断计算后的信噪比是否符合要求，判断过程包括：预先设置信噪比的期望范围，比较器判断计算后信号的信噪比是否在期望范围内，对未处于期望范围内的信号进行自适应调节。此外，本申请实施例提出的自适应CIC滤波系统处于MCU11中，还可以在FPGA、微处理器中，在此申请中不做具体限制，通过控制MCU调节信号。基于上述实施例中提出的一种基于分级式计数器的自适应CIC滤波系统，其工作原理为：将经过sigma-delta调制器调制后的1bite流数字信号的波形数据信号作为第一定时器的外部时钟输入，采样时钟信号作为第二定时器的外部时钟输入，第一定时器和第二定时器分别使能第一计数器和第二计数器，并将第一计数器和第二计数器设置为上升沿计数模式。第二定时器设置延时时间，第二计数器获取在当前延时时间内采样时钟信号有多少个上升沿，当触发第二定时器的中断时，读取第一计数器中波形数据信号的上升沿个数，在当前延时时间内每有一个上升沿跳变即为累积一次计数，其中第一计数器累加的计数值与积分器积分后的数值相等，因此通过计数器对上升沿跳变的累加计数，就说明完成了对数字信号一阶积分。在对数字信号进行一阶积分后增加第三定时器，设置第三定时器的延时时间，当第三定时器的中断触发时，读取一阶积分后的计数值进行积分，以此类推完成高阶积分。由此可得，在此申请中CIC滤波系统的阶数是指内部级联的定时器的数量。例如，当积分单元包括2个定时器时，当前滤波系统为1阶滤波系统；当积分单元中包含3个定时器时，当前滤波系统为2阶滤波系统，在此申请中不做具体限制。CIC滤波器的级数是指定时器的延时时间。例如：设第二定时器的延时时间每级为1μs，则初始延时时间设置为5μs为5级，即当级数为1时，在初始延时时间为1μs时对信号进行积分，当级数为5时，在初始延时时间为5μs时对信号进行积分。通过积分单元将数字信号进行积分后输入至抽取器中，抽取器对积分后的信号进行降采样抽取，可以降低信号的输出速率。对信号进行抽取完成后再通过平滑滤波器对抽取后的信号进行滑动平均滤波，可以使信号平稳，并去除高频噪声。用户预先根据需求设置通过滤波系统滤波后输出信号的信噪比期望范围，例如在精度不小于13的情况下，所需信噪比的范围为85db，误差在5db之间。此时通过计算单元计算滤波后输出信号的信噪比，比较器通过比较输出信号的信噪比是否在当前期望范围内，对不在期望范围的信号需要循环调节滤波器阶数和级数来自适应调节信噪比，直至使信号的信噪比调节符合期望范围的要求。具体的自适应调节过程包括：通过增加定时器的个数，改变滤波系统的阶数，再对信号进行积分、抽取、平滑滤波，对调节后的信号计算其信噪比，循环调节，当信噪比调节至期望范围内时，输出当前信号。另一种调节过程可以通过改变定时器的级数，例如在上述实施例的二阶滤波系统中，改变第三定时器的延时时间为5μs，在当前延时时间内对其进行积分，进行相应倍数的降采样抽取，再对信号进行平滑滤波，对滤波后的信号计算其信噪比，循环调节，当信号的信噪比在期望范围内时，输出当前信号。自适应调节过程还可以通过同时改变滤波系统的级数和阶数，根据判断结果自适应调节，再对调节后的信号计算其信噪比，当信噪比在期望范围内时，输出当前信号。通过上述自适应过程，可以得到所需信噪比的信号。基于上述实施例中提出的一种基于分级式计数器的自适应CIC滤波系统进行仿真，设置输入信号是为频率10KHZ，幅值为4Vpp，偏移为2.5V的正旋信号，信号由信号发生器产生，输入至sigma-delta调制器的输入端CH+，CH-为+2.5V的调制电压，此时sigma-delta调制器的输出端输出1bit流的数字信号，其中包括波形数据信号和采样时钟信号。将数字信号输入至本申请提供的一种一阶滤波系统中，将调制器输出的波形数据信号和采样时钟信号作为第一定时器和第二定时器的外部时钟，并设置第一计数器和第二计数器为上升沿计数模式，再设置两个定时器的延时时间，完成CIC滤波系统的积分部分，随后进行N倍降采样抽取，后置平滑滤波器，将数字信号还原成模拟信号，输出滤波后的模拟信号。如图2所示是比较通过传统CIC滤波器以及本申请中自适应CIC滤波系统的输出信号对比仿真示意图，将本申请中CIC滤波得到的模拟信号和传统CIC滤波器滤波得到的模拟信号进行对比。此时计算两波形的相似度，如图3所示为两种滤波器在不同输入信号频率下滤波后输出信号的相似度变化趋势示意图，可以得到两种滤波器的相似度为99.7%，相似度极高，之后改变输入信号的频率再次实验得到相似度的变化趋势图。综上所述，通过定时器和计数器代替积分器的方式得到的输出信号与传统滤波器滤波后的输出信号相似度较高，即可以通过本申请的滤波系统代替传统滤波器对输入信号进行滤波，有效性较高。一种实施例中，如图4所示为通过改变滤波系统的级数调节信号的仿真变化趋势示意图，经过调制器调制后的1bite流数字信号将波形数据以及采样时钟发送给自适应CIC滤波系统，在一阶滤波系统中设置第二定时器的延时时间，每级为5μs，初始延时时间设置为10μs，信号通过本申请提出的CIC滤波系统滤波之后得到输出信号，计算输出信号的信噪比。此时增加第二定时器的延时时间，即滤波级数，得到当前所有级数下的信噪比，当前滤波系统延时时间和信号信噪比的变化趋势如图4所示。当用户设置输出信号的信噪比为80dB，误差在3dB时，由图4可得，在滤波级数为2级，初始时间为10μs时，信噪比为75.8dB，通过比较器判断当前信号不满足要求。此时滤波系统增加级数为3级，初始时间为15μs时，信噪比为76.0dB，判断当前信号依旧不满足要求。以此类推，通过循环判断滤波后输出信号的信噪比，可以得到当改变滤波系统的级数为5级，即设置第二定时器的初始延时时间为25μs时，信号的信噪比为79.5dB，当前延时时间下的信号最接近用户期望的信噪比，此时输出当前延时时间下的信号。另一种实施例中，如图5所示为通过改变滤波系统阶数调节信号的仿真变化趋势示意图，经过调制器调制后的1bite流数字信号将波形数据以及采样时钟发送给CIC滤波器，将定时器的初始延时时间均设置为15μs时，添加定时器的数量，再通过当前滤波系统进行滤波后得到输出信号，计算输出信号的信噪比。如图5所示为1-3阶滤波系统下定时器延时间为15μs的信噪比变化趋势图。当所需信号的精度为14位时，用户需设置输出信号的信噪比为86.04dB，误差在3dB左右。在滤波系统的定时器为2个即滤波阶数为1阶时，计算滤波后的信号信噪比为76.0dB，此时通过比较器判断当前信号的信噪比不满足期望范围的要求。添加定时器的个数为3个即滤波阶数为2阶时，计算滤波后的信号信噪比为76.5dB，通过比较器判断当前滤波阶数下的信号依旧不满足要求。滤波系统自适应调节滤波阶数为3阶时，计算经过滤波后信号的信噪比为83.6dB，经比较器判断符合期望范围的要求，则输出当前滤波阶数为3阶、初始延时时间为15μs的模拟信号。又一种实施例中，滤波系统可以通过同时改变滤波系统阶数以及级数自适应调节信号质量。经过调制器调制后的1bite流数字信号将波形数据以及采样时钟发送给CIC滤波系统，当在1阶滤波系统下调节第二定时器的初始延时间，得到信噪比的变化趋势图，再添加定时器的数量计算2阶和3阶滤波系统下不同级数的信噪比，得到其变化趋势图，如图6所示为在1-3阶滤波系统下改变滤波系统级数的变化趋势图。当滤波后信号所需的精度为14位时，信噪比的期望范围为86.04dB，通过比较器循环比较滤波后的输出信号，为了输出最合适信噪比的信号，首先改变滤波系统的级数，得到最接近当前信噪比期望范围的输出信号，再添加定时器的数量改变滤波系统的阶数，得到符合当前期望范围的输出信号。由于增加定时器的数量会导致计算复杂度的增加，因此尽可能选择滤波阶数较低情况下满足要求的滤波级数，并输出当前级数下的信号。基于上述仿真实施例的结果可以得到，通过本申请提出的一种基于分级式计数器的自适应CIC滤波系统对经过调制器调制后的1bite流数字信号进行滤波，滤波后的输出信号与传统CIC滤波器的滤波效果相同，从而可以达到减小计算复杂度的目的。且通过本申请中改变滤波系统的阶数和级数来自适应调节信号的信噪比，能够拓宽应用场景。上述本申请实施例序号仅仅为了描述，不代表实施例的优劣。在本申请的上述实施例中，对各个实施例的描述都各有侧重，某个实施例中没有详述的部分，可以参见其他实施例的相关描述。在本申请所提供的几个实施例中，应该理解到，所揭露的技术内容，可通过其它的方式实现。其中，以上所描述的装置实施例仅仅是示意性的，例如所述单元的划分，可以为一种逻辑功能划分，实际实现时可以有另外的划分方式，例如多个单元或组件可以结合或者可以集成到另一个系统，或一些特征可以忽略，或不执行。另一点，所显示或讨论的相互之间的耦合或直接耦合或通信连接可以是通过一些接口，单元或模块的间接耦合或通信连接，可以是电性或其它的形式。所述作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个单元上。可以根据实际的需要选择其中的部分或者全部单元来实现本实施例方案的目的。以上所述仅是本申请的优选实施方式，应当指出，对于本技术领域的普通技术人员来说，在不脱离本申请原理的前提下，还可以做出若干改进和润饰，这些改进和润饰也应视为本申请的保护范围。
