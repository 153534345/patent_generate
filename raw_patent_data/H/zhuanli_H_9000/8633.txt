标题title
一种光学成像设备的自动聚焦方法及相机电路
摘要abst
本发明公开了一种光学成像设备的自动聚焦方法及相机电路。包括粗调聚焦和精调聚焦阶段，在粗调聚焦阶段中，基于目标图像的聚焦区域的评价值，在设定搜索范围内以大步长驱动载物台的驱动电机移动进行聚焦峰值点搜索，直到驱动电机移至最大评价值对应的粗调焦点位置；在细调聚焦阶段，基于粗调焦点位置所在平面的目标图像中聚焦窗口的评价值，在设定搜索范围内控制驱动电机以小步长在粗调焦点位置周围移动进行聚焦峰值点搜索，直至驱动电机移至最大评价值对应的细调焦点位置。能够有效获取到目标内容作为聚焦区域，减少评价函数的计算量，提高聚焦的精度和速度。
权利要求书clms
1.一种光学成像设备的自动聚焦方法，其特征在于，包括：初始化：对光学成像设备初始化，将放置目标的载物台的驱动电机移动至初始位置；粗调聚焦：基于目标图像的聚焦区域的评价值，在设定搜索范围内以第一步长驱动载物台的驱动电机移动进行聚焦峰值点搜索，直到所述驱动电机移至聚焦区域的最大评价值对应的粗调焦点位置；细调聚焦：基于所述粗调焦点位置所在平面的目标图像中聚焦窗口的评价值，在设定搜索范围内驱动所述驱动电机以第二步长在所述粗调焦点位置周围移动进行聚焦峰值点搜索，直至所述驱动电机移至聚焦窗口的最大评价值对应的细调焦点位置，其中，所述第二步长小于所述第一步长。2.根据权利要求1所述的光学成像设备的自动聚焦方法，其特征在于，所述初始化的步骤，包括：根据光学成像原理，确定载物台的驱动电机的移动范围，所述移动范围包括所述驱动电机在Z轴上下移动的距离；将所述驱动电机移动至所述移动范围中的初始位置。3.根据权利要求1所述的光学成像设备的自动聚焦方法，其特征在于，所述粗调聚焦的步骤，包括：在设定搜索范围内以第一步长驱动载物台的驱动电机移动，进行聚焦峰值点搜索；在搜索过程中，每移动移一次则获取一帧目标图像，确定当前帧目标图像中的聚焦区域并计算所述聚焦区域的评价值，在所述评价值处于上升阶段的情况下继续搜索，在所述评价值出现下降阶段时，所述驱动电机移动至之前聚焦区域的最大评价值对应的位置，该位置为粗调的聚焦峰值点。4.根据权利要求3所述的光学成像设备的自动聚焦方法，其特征在于，所述确定当前帧目标图像中的聚焦区域并计算所述聚焦区域的评价值，包括：将当前帧目标图像分割为m*n个图像块，抽取所述m*n个图像块中处于对角线上的图像块构成聚焦区域，计算所述聚焦区域的评价值。5.根据权利要求4所述的光学成像设备的自动聚焦方法，其特征在于，所述计算所述聚焦区域的评价值，包括：利用基于Sobel算子的评价函数计算所述聚焦区域内图像块的评价值；将所述聚焦区域内的所有图像块的评价值进行相加，得到所述聚焦区域的评价值。6.根据权利要求1所述的光学成像设备的自动聚焦方法，其特征在于，所述细调聚焦的步骤，包括：在设定搜索范围内以第二步长驱动载物台的驱动电机在所述粗调焦点位置周围移动，进行聚焦峰值点搜索；在搜索过程中，每移动移一次则获取一帧所述粗调焦点位置所在平面的目标图像，以当前帧目标图像中标定的感兴趣区域为聚焦窗口并计算所述聚焦窗口的评价值，确定聚焦窗口的最大评价值的对应的位置为细调的聚焦峰值点。7.一种计算机设备，其特征在于，包括存储器和一个或多个处理器，所述存储器上存储有计算机程序，所述计算机程序被所述一个或多个处理器执行时实现如权利要求1至6中任一项所述的方法。8.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质上存储有计算机程序，所述计算机程序被一个或多个处理器执行时，实现如权利要求1至6中任一项所述的方法。9.一种相机电路，其特征在于，应用于光学成像设备，包括：图像传感器，用于采集目标图像；主控电路，与所述图像传感器连接，用于传输目标图像；计算机设备，与所述主控电路连接，用于实现如权利要求1至6中任一项所述的方法；电机控制模块，与所述主控电路连接，用于根据所述计算机设备发送的控制指令驱动载物台的驱动电机移动。10.根据权利要求9所述的相机电路，其特征在于，所述主控电路与所述计算机设备通过USB3.0接口电路连接，基于预先定义的UVC协议与所述计算机设备交互。
说明书desc
技术领域本发明涉及光学成像领域，具体涉及一种光学成像设备的自动聚焦方法及相机电路。背景技术目前，市场上以手动聚焦的显微镜为主，带自动聚焦功能的显微镜较少，且带自动聚焦功能的显微镜价格昂贵。自动聚焦显微镜系统核心由显微相机模块、控制Z轴移动模块、自动聚焦算法及控制模块组成。当前自动聚焦显微镜系统中存在以下问题：1.通用性能差：硬件通用差：市场上自动聚焦功能的显微镜采用一体机方案，显微镜和相机需配套使用，各类接口和协议由厂家自行定义，通用计算机无法获取相机的图像数据，甚至相同厂家不同型号的产品都无法使用。软件系统通用性差：显微镜系统是针对显微镜自带计算机而开发，系统无法在通用计算机上安装使用。2.接口复杂：通常自动聚焦显微镜连接计算机需要2个接口：显微图像数据采集接口和显微镜移动控制接口，占资源较多，且不易调试。3.传输速率慢：目前显微镜摄像机成像接口基本采用USB2.0接口，相比USB3.0接口传输速率较慢。4.固件更新繁琐目前显微镜成像相机基本上没有更新渠道。5.不易于传统显微镜改进为自动聚焦显微镜。相机没有预留接口，所以传统显微镜无法升级为自动聚焦显微镜。发明内容针对上述问题，本发明提供一种光学成像设备的自动聚焦方法及相机电路。本发明的第一个方面，提供一种光学成像设备的自动聚焦方法，包括：初始化：对光学成像设备初始化，将放置目标的载物台的驱动电机移动至初始位置；粗调聚焦：基于目标图像的聚焦区域的评价值，在设定搜索范围内以第一步长驱动载物台的驱动电机移动进行聚焦峰值点搜索，直到所述驱动电机移至聚焦区域的最大评价值对应的粗调焦点位置；细调聚焦：基于所述粗调焦点位置所在平面的目标图像中聚焦窗口的评价值，在设定搜索范围内驱动所述驱动电机以第二步长在所述粗调焦点位置周围移动进行聚焦峰值点搜索，直至所述驱动电机移至聚焦窗口的最大评价值对应的细调焦点位置，其中，所述第二步长小于所述第一步长。进一步地，所述初始化的步骤，可以包括：根据光学成像原理，确定载物台的驱动电机的移动范围，所述移动范围包括所述驱动电机在Z轴上下移动的距离；将所述驱动电机移动至所述移动范围中的初始位置。进一步地，所述粗调聚焦的步骤，可以包括：在设定搜索范围内以第一步长驱动载物台的驱动电机移动，进行聚焦峰值点搜索；在搜索过程中，每移动移一次则获取一帧目标图像，确定当前帧目标图像中的聚焦区域并计算所述聚焦区域的评价值，在所述评价值处于上升阶段的情况下继续搜索，在所述评价值出现下降阶段时，所述驱动电机移动至之前聚焦区域的最大评价值对应的位置，该位置为粗调的聚焦峰值点。进一步地，所述确定当前帧目标图像中的聚焦区域并计算所述聚焦区域的评价值，可以包括：将当前帧目标图像分割为m*n个图像块，抽取所述m*n个图像块中处于对角线上的图像块构成聚焦区域，计算所述聚焦区域的评价值。进一步地，所述计算所述聚焦区域的评价值，可以包括：利用基于Sobel算子的评价函数计算所述聚焦区域内图像块的评价值；将所述聚焦区域内的所有图像块的评价值进行相加，得到所述聚焦区域的评价值。进一步地，所述细调聚焦的步骤，可以包括：在设定搜索范围内以第二步长驱动载物台的驱动电机在所述粗调焦点位置周围移动，进行聚焦峰值点搜索；在搜索过程中，每移动移一次则获取一帧所述粗调焦点位置所在平面的目标图像，以当前帧目标图像中标定的感兴趣区域为聚焦窗口并计算所述聚焦窗口的评价值，确定聚焦窗口的最大评价值的对应的位置为细调的聚焦峰值点。本发明的第二方面，提供一种计算机设备，包括存储器和一个或多个处理器，所述存储器上存储有计算机程序，所述计算机程序被所述一个或多个处理器执行时实现如第一方面所述的方法。本发明的第三方面，提供一种计算机可读存储介质，所述计算机可读存储介质上存储有计算机程序，所述计算机程序被一个或多个处理器执行时，实现如第一方面所述的方法。本发明的第四方面，提供一种相机电路，应用于光学成像设备，包括：图像传感器，用于采集目标图像；主控电路，与所述图像传感器连接，用于传输目标图像；计算机设备，与所述主控电路连接，用于实现如第一方面所述的方法；电机控制模块，与所述主控电路连接，用于根据所述计算机设备发送的控制指令驱动载物台的驱动电机移动。进一步地，所述主控电路与所述计算机设备通过USB3.0接口电路连接，基于预先定义的UVC协议与所述计算机设备交互。本发明的技术方案与现有技术相比，至少能够带来如下有益效果：本发明的光学成像设备的自动聚焦方法包括粗调聚焦和精调聚焦阶段，在粗调聚焦阶段中，基于目标图像的聚焦区域的评价值，在设定搜索范围内以大步长驱动载物台的驱动电机移动进行聚焦峰值点搜索，直到驱动电机移至聚焦区域的最大评价值对应的粗调焦点位置；在细调聚焦阶段，基于粗调焦点位置所在平面的目标图像中聚焦窗口的评价值，在设定搜索范围内控制驱动电机以小步长在粗调焦点位置周围移动进行聚焦峰值点搜索，直至驱动电机移至聚焦窗口的最大评价值对应的细调焦点位置。能够有效获取到目标内容作为聚焦区域，减少评价函数的计算量，提高聚焦的精度和速度。附图说明为了更清楚地说明本发明实施例的技术方案，下面将对实施例中所需要使用的附图作简单地介绍，应当理解，以下附图仅示出了本发明的某些实施例，因此不应被看作是对范围的限定，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他相关的附图。图1是本发明实施例一提供的一种光学成像设备的自动聚焦方法流程图；图2是本发明实施例二提供的一种相机电路示意图；图3是OV2640图像传感器电路图；图4是TMC2209驱动芯片电路图；图5是程序调试更新及拓展接口电路图；图6是CH565W主控芯片电路图；图7是USB接口电路图；图8是W25Q32芯片电路图；图9是本发明实施例四提供的UVC协议示意图；图10是本发明实施例四提供的相机电路工作流程示例；图11是本发明实施例四提供的电机复位流程示例。具体实施方式下面将结合本发明实施例中附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。通常在此处附图中描述和示出的本发明实施例的组件可以以各种不同的配置来布置和设计。因此，以下对在附图中提供的本发明的实施例的详细描述并非旨在限制要求保护的本发明的范围，而是仅仅表示本发明的选定实施例。基于本发明的实施例，本领域技术人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。实施例一本实施例提供一种光学成像设备的自动聚焦方法，本实施例中的光学成像设备包括但不限于智能光学显微镜、一体化的CCD摄像头等，待成像的目标放置于载物台上，载物台由驱动电机驱动，驱动电机优选为步进电机，如图1所示，该方法包括：初始化：对光学成像设备初始化，将放置目标的载物台的驱动电机移动至初始位置；粗调聚焦：基于目标图像的聚焦区域的评价值，在设定搜索范围内以第一步长驱动载物台的驱动电机移动进行聚焦峰值点搜索，直到驱动电机移至聚焦区域的最大评价值对应的粗调焦点位置；细调聚焦：基于粗调焦点位置所在平面的目标图像中聚焦窗口的评价值，在设定搜索范围内驱动载物台的驱动电机以第二步长在粗调焦点位置周围移动进行聚焦峰值点搜索，直至驱动电机移至聚焦窗口的最大评价值对应的细调焦点位置，其中，第二步长小于第一步长。进一步地，上述初始化的步骤，可以包括：根据光学成像原理，确定载物台的驱动电机的移动范围，其中的移动范围包括驱动电机在Z轴上下移动的距离；以及将驱动电机移动至移动范围中的初始位置。例如，载物台的步进电机的移动范围为0～max，在初始化的步骤中，将驱动电机移动至移动范围中0对应的初始位置。上述粗调聚焦的步骤，可以包括：在设定搜索范围内以第一步长驱动载物台的驱动电机移动，进行聚焦峰值点搜索；在搜索过程中，每移动移一次则获取一帧目标图像，确定当前帧目标图像中的聚焦区域并计算聚焦区域的评价值，在评价值处于上升阶段的情况下继续搜索，在评价值出现下降阶段时，驱动电机移动至之前聚焦区域的最大评价值对应的位置，该位置为粗调的聚焦峰值点。在一个示例中，设定第一步长可以为max/200。在粗调聚焦阶段中，根据第一步长驱动步进电机驱动载物台移动，从而带动成像目标移动，每移动一次获取一帧目标图像，并计算目标图像的聚焦区域的评价值，利用大步长的搜索爬坡法进行本阶段的聚焦峰值点搜索，搜索过程中，利用聚焦曲线的单一性，即根据每一帧目标图像的评价值变化为上升或下降作为主要判断依据来寻找粗调的聚焦峰值点，若评价值一直处于上升阶段，表明最佳峰值聚焦点还未到达，继续保持往下搜索，一旦出现下降阶段，表明已超过最佳峰值聚焦点，此时只需控制载物台的步进电机返回评价值最大时对应的位置，即为粗调的聚焦峰值点，至此粗调完成。进一步地，确定当前帧目标图像中的聚焦区域并计算所述聚焦区域的评价值，可以包括：将当前帧目标图像分割为m*n个图像块，抽取所述m*n个图像块中处于对角线上的图像块构成聚焦区域，例如，m＝3，n＝3，抽取对角线对应5个图像块作为聚焦区域，计算聚焦区域的评价值。其中，计算聚焦区域的评价值，可以包括：利用基于Sobel算子的评价函数计算聚焦区域内图像块的评价值；以及将聚焦区域内的所有图像块的评价值进行相加，得到当前帧目标图像的聚焦区域的评价值。基于Sobel算子的评价函数如下：式中，FSobel表示基于Sobel算子的评价函数值，f表示图像点的灰度值，M*N表示图像大小，gx和gy分别表示图像与水平Sobel算子Sx的卷积和图像与垂直Sobel算子Sy的卷积。聚焦区域的评价值的计算式如下：式中，Ftotal表示聚焦区域的评价值，O～D为聚焦区域所对应图像块的位置，O对应图像分块的中心点区域，中心区域所占权重提升为3，以确保聚焦曲线的单峰性。上述细调聚焦的步骤，可以包括：在设定搜索范围内以第二步长驱动载物台的驱动电机在粗调焦点位置周围移动，进行聚焦峰值点搜索；在搜索过程中，每移动移一次则获取一帧粗调焦点位置所在平面的目标图像，以当前帧目标图像中标定的感兴趣区域为聚焦窗口并计算聚焦窗口的评价值，确定聚焦窗口的最大评价值的对应的位置为细调的聚焦峰值点。在实际应用中，以光学成像设备为智能光学显微镜来说，获取目标图像主要通过图像传感器进行光电转换，将光信号转化为电信号，并进一步引入计算机设备进行显示。可以通过观察目标细节，通过与计算机设备的界面进行交互操作，在当前帧目标图像中选取感兴趣的区域进行标定，将所标定的区域图作为聚焦窗口，并利用基于Sobel算子的评价函数计算聚焦窗口的评价值，计算式如下：式中，Ftotal表示聚焦窗口的评价值，A为聚焦窗口位置，FA为基于Sobel算子的评价函数值。在细调聚焦阶段中，当前聚焦平面位置对应粗调聚焦平面，在该聚焦平面位置利用最值法搜索，上下小范围进行小步长搜索，上下浮动范围为，xi最大不超过30，第二步长设定为1，利用基于评价值搜索聚焦峰值点，在当前聚焦点平面上下移动的过程中，不断比较评价值的大小，记录比较过程中评价值最大对应的焦点位置，直至上下搜索完成后，直接将载物台的驱动电机移动至聚焦窗口的最大评价值对应的焦点位置，至此完成细调聚焦。本实施例的方法中，自动聚焦的过程包括两个阶段：粗调聚焦阶段和细调聚焦阶段，其中，粗调聚焦阶段采用大步长爬坡搜索法，细调采用小步长最值搜索法；聚焦区域的选取上，粗调和细调阶段选择不同的方法，能够有效获取到目标内容作为聚焦区域，减少评价函数的计算量，提高聚焦的精度、速度。实施例二本实施例提供一种计算机设备，包括存储器和一个或多个处理器，存储器上存储有计算机程序，计算机程序被一个或多个处理器执行时实现实施例一的方法。本实施例中的计算机设备可以与光学成像设备的相机电路进行交互，获取目标图像和发送控制指令。实施例三本实施例提供一种计算机可读存储介质，计算机可读存储介质上存储有计算机程序，计算机程序被一个或多个处理器执行时，实现实施例一的方法。计算机可读存储介质可以包括但不限于：具有一个或多个导线的电连接、便携式计算机磁盘、硬盘、随机访问存储器、只读存储器、可擦式可编程只读存储器、光纤、便携式紧凑磁盘只读存储器、光存储器件、磁存储器件、或者上述的任意合适的组合。实施例四本实施例提供一种相机电路，应用于光学成像设备，如图2所示，包括：图像传感器，用于采集目标图像；主控电路，与图像传感器连接，用于打包并传输目标图像；计算机设备，与主控电路连接，用于实现前述实施例的方法，自动识别并安装驱动并实现光学成像设备的目标图像的高速采集，同时还可发送控制指令给主控电路完成相关控制功能。电机控制模块，与主控电路连接，用于根据计算机设备发送的控制指令驱动载物台的驱动电机移动。实际应用中，前述实施例中的方法可以以控制模块的方式在实现在计算机设备中，例如以图像处理算法和Z轴运动控制指令为核心组成的计算机软件。图像传感器可以选用OV2640图像传感器，如图3所示，该电路通过DVP接口与CH595W主控芯片相连，其中DP_D0至DP_D7为8位数据接口，HREF为行同步信号，SYNC为帧同步信号，PWDN掉电模式使能信号，RESETB为复位信号。采用IIC接口控制图像传感器的寄存器，SCI_C为时钟信号，SCI_D为数据信号，分别采用10K电阻上拉。X2为12MHz有源晶振，第三引脚产生时钟供OV2640工作。此电路中的电容为去耦电容，保证系统供电稳定。模拟地、数字地用R4 0欧姆电阻相连，然后分别连接到OV2640的引脚。OV2640供电：由U6电路稳压输出流电压1.3V，U7稳压输出电压经R7、C41一阶滤波器得直流2.8V作为电源。电机控制模块可以选用TMC2209驱动芯片，实现Z轴的电机控制，以TMC2209芯片作为步进电机控制核心，驱动能力强，静音效果好，自带无传感归零功能，简化模块设计更易于调试与维护。如图4所示，TMC2209驱动芯片工作电压5V，连接第8引脚。15引脚为通信电平供电引脚，与主控芯片供电电压一致为3.3V。22、28引脚为步进电机供电引脚，供电接外部直流电压为5-24V通过H2的VM接口供电。VREF参考电压为2.5V由R13、R14分压所得，设置驱动有效值最大电流为1.77A，R8、R10为电流采样电阻。MS2、MS1微步设置，其中MS2接地，MS1接VIO，及微步细分为64细分结合芯片内部自带256细分，使得Z轴电机运动得更加平滑，也使系统整体运行更稳定，图像采集质量更好，为自动聚焦提供良好保障。H1对外接口，通过PDN_UART引脚配置TMC2209的相关驱动参数。H2对外接口，连接步进电机及供电，其中，OA1、OA2连接步进电机一项，OB1、OB2为步进电机另外一项。CN5接口，外部供电接口和CH565W相关控制引脚相连，其中EN为主控使能，STEP为电机步进脉冲输入，DIR为电机方向控制端，DIAG输出诊断引脚用于无传感器归零，INDEX电芯片过温保护信息输出引脚。在一些实现方案中，该相机电路还可以包括：程序调试更新及拓展接口电路，与主控电路连接，主控可以通过程序调试更新及拓展接口电路完成程序更新、电机控制等相关工作。程序调试更新及拓展接口电路：CN1仿真调试电路。CN3串口下载电路，应用后期程序更新。CN2串口拓展电路，通过接口与外部主控相连接，方便拓展更多的电机驱动等功能。CN4为电机控制拓展电路，分别连接主控和电机控制模块，如图5所示。主控电路选用CH565W主控芯片，如图6所示，主控芯片工作在3.3V，内核电压1.2V，由芯片内部自带LDO提供。CH565W是一款带有高速接口的RISC-V内核的32位微控制器，最高主频为120MHz，内含16KB的32位和96KB的128位RAM，和一个128位宽的高速DMA以适应高速接口之间的数据转发。CH565W带有DVP接口，方便与摄像头传感器连接，采用RN1、RN2 33欧姆电阻匹配阻抗。X1、CX1、CX2电路为主控新芯片提供30MHz的工作时钟。SW1设置程序从USB更新程序，SW2设置为复位引脚。VIO为主控IO口电源。其它电容为滤波电容，滤除电源纹波。芯片功能强大，电路简单，性价比高。USB接口电路如图7所示，系统提供USB2.0接口D+，D-与主控芯片相连接，USB3.0接口，STDA_SSRX-、STDA_SSRX+，STDA_SSTX-、STDA_SSTX+差分信号线与主控芯片相连接。通过VBUS引脚给系统提供电源，经F1为自动恢复保险，C1、C2为滤波电容输出直流5V，经线性稳压器LD1117AG-33输出3.3V，经C3、C4稳压，经R1零欧姆电阻得VIO给主控芯片提供电压。R2和LED1为电源指示电路。在一些实现方案中，该相机电路还可以包括：信息存储电路，与主控电路连接，用于配置图像传感器的参数。信息存储电路可以选用W25Q32芯片，如图8所示。W25Q32芯片提供了32M-bit存储空间，用于存用户配置储图像传感器的相关参数等。芯片采用SPI接口与主控相连，3.3V电压供电，第3、7引脚接高电平，保证数据读写功能正常。在一些实现方案中，该相机电路还可以包括：USB3.0接口及供电电路，与主控电路、计算机设备连接；主控电路与计算机设备通过USB3.0接口电路连接，基于预先定义的UVC协议与计算机设备交互。采用单根USB3.0数据线作为通信集成了显微成像和显微控制功能，通用性强且降低了系统成本。在UVC协议里面，UVC相机终端描述符有对聚焦的参数要求，分别为绝对焦点D5、相对焦点D6两个标准焦点参数。一般采用绝对焦点控制相机成像距离，标准焦点参数中的2个字节及调节范围为0-65535，只有带能驱动镜头移动的相机才支持自动聚焦功能，且只采用了0-100左右的调节范围。此类图像传感器多采用音波马达驱动，驱动距离很短，通常是几毫米。为了能在光学显微镜中移动更远的距离。将对标准焦点参数中的2个字节的长度全部用完，及数据达到0-65535。本实施例的预先定义的UVC协议如图9所示，在USB同步传输视频流的情况下，根据设定的每帧图像大小、压缩格式参数并定时上传图像，在USB中断传输控制指令收发的情况下，调整视频流指令、调整图像传感器参数指令和自动聚焦参数控制Z轴电机运动指令，既保留了相机的通用性，有拓展了移动距离，将Z轴距离65536细分，每一个细分代表电机驱动Z轴移动的最小距离，假设Z轴距离为50mm，则50/65536＝0.076um，理论达到精度将会很高，采用高精度细分步进电机驱动电路，保证不破坏协议的同时，完成聚焦功能。在一个具体的示例中，如图10所示，相机电路工作流程可以如下：1、上电后主控电路自动复位，复位Z轴到系统零点，初始化图像传感器，图像数据通过DVP接口传输数据给主控芯片CH565W，主控芯片内部打包数据，采用UVC协议通过USB3.0接口将数据传输到计算机设备。2、计算机设备的上位机软件可以通过UVC协议将控制信号发送给CH565W主控芯片根据控制信息，调节图像传感器的成像和调整Z轴移动。3、上位机软件通过USB发送控制指令给主控电路，然后主控电路根据控制指令输出PWM波形和方向等给TMC2209电机控制模块，从而实现以下功能：控制步进电机在Z轴范围上下移动。复位Z轴位置结合无传感器归零结构配置DIAG、INDEX引脚输出电机防堵，芯片过温保护，两引脚分别连接到主控，结合方向，转动电机并检测引脚完成复位功能，该功能突破了传统必须连接传感器才能复位的弊端。4、通过串口拓展了程序更新接口和外部数据交互接口，可以通过该接口拓展更多的电机控制功能。5、用户通过上位机设置相机的一些参数存储在存储芯片W25Q32中，便于上电后恢复系统配置。本实施例的相机电路简洁，具有通用性强、接口简单、主控方案性价比高、USB3.0数据传输速度快、控制方法简单、聚焦响应速度快、固件更新方便、易于改进无自动聚焦功能的光学显微镜。电机复位一般采用霍尔传感器、光电传感器等接近开关，但本发明无需采用任何传感器，就可以实现位置检测及机器复位，结合如图11所示的电机复位流程，开始上电复位侯，先控制电机往上转，并在主控检测到DIAG＝1的情况下，控制电机往下转，再将电机一直往上转，直至主控再次检测到DIAG＝1，Z轴电机复位完成，复位流程结束，本实施例通过电流检测实现电机复位，可以省去以上接近开关，简化了电路，降低了成本，更易于维护。本实施例的相机电路尤其适于应用到但不限于光机电一体化的智能显微镜中，还可以应用于一体化的CCD摄像头。虽然本发明所揭露的实施方式如上，但所述的内容只是为了便于理解本发明而采用的实施方式，并非用以限定本发明。任何本发明所属技术领域内的技术人员，在不脱离本发明所揭露的精神和范围的前提下，可以在实施的形式上及细节上作任何的修改与变化，但本发明的专利保护范围，仍须以所附的权利要求书所界定的范围为准。
