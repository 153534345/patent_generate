标题title
一种数据转发方法和虚拟化云网络架构
摘要abst
本申请涉及云计算技术领域，尤其涉及一种数据转发方法和虚拟化云网络架构，云网络架构用于传输云主机与外网之间的交互数据包，包括至少一个报文转发节点虚拟路由器、多个网络节点虚拟路由器，针对任一由云主机向外网发送的数据包以及外网向云主机发送的数据包，均先转发至报文转发节点虚拟路由器；报文转发节点虚拟路由器接收数据包，并基于数据包属性信息与各网络节点虚拟路由器之间的关联关系，确定出与数据包属性信息关联的目标网络节点虚拟路由器；报文转发节点虚拟路由器将数据包转发至目标网络节点虚拟路由器；目标网络节点虚拟路由器确定数据包的目的地址，并对数据包进行转发处理。这样，能够提高网络性能和资源利用率。
权利要求书clms
1.一种数据转发方法，其特征在于，应用于部署在云计算平台的虚拟化云网络架构，所述云网络架构用于传输云主机与外网之间的交互数据包，包括至少一个报文转发节点虚拟路由器、多个网络节点虚拟路由器，所述方法包括：针对任一由所述云主机向外网发送的数据包以及外网向所述云主机发送的数据包，均先转发至所述报文转发节点虚拟路由器；所述报文转发节点虚拟路由器接收所述数据包，并基于数据包属性信息与各网络节点虚拟路由器之间的关联关系，确定出与所述数据包属性信息关联的目标网络节点虚拟路由器；所述报文转发节点虚拟路由器将所述数据包转发至所述目标网络节点虚拟路由器；所述目标网络节点虚拟路由器确定所述数据包的目的地址，并对所述数据包进行转发处理。2.如权利要求1所述的方法，其特征在于，所述数据包属性信息包含五元组信息，则基于所述数据包属性信息与各网络节点虚拟路由器之间的关联关系，确定出与所述数据包属性信息关联的目标网络节点虚拟路由器，具体包括：所述报文转发节点虚拟路由器对所述五元组信息进行哈希处理，获得所述数据包对应的哈希值；所述报文转发节点虚拟路由器基于预设的各哈希值与网络节点虚拟路由器之间的对应关系，从所述多个网络节点虚拟路由器中，确定出与所述哈希值对应的目标网络节点虚拟路由器。3.如权利要求1所述的方法，其特征在于，所述云网络架构还包括计算节点虚拟路由器，所述计算节点虚拟路由器接收所述云主机向外网发送的数据包，并转发至所述报文转发节点虚拟路由器，所述报文转发节点虚拟路由器接收所述数据包，具体包括：所述报文转发节点虚拟路由器接收所述计算节点虚拟路由器发送的数据包。4.如权利要求3所述的方法，其特征在于，当所述报文转发节点虚拟路由器的数量为多个时，所述计算节点虚拟路由器接收所述云主机向外网发送的数据包，并转发至所述报文转发节点虚拟路由器，包括：所述计算节点虚拟路由器基于等价路由将所述数据包转发至所述多个报文转发节点虚拟路由器中的一个。5.如权利要求4所述的方法，其特征在于，在所述计算节点虚拟路由器基于等价路由转发所述数据包之前，还包括：各所述报文转发节点虚拟路由器基于内网IP地址，分别与所述计算节点虚拟路由器建立ospf协议的邻居关系，并生成等价路由。6.如权利要求1所述的方法，其特征在于，在所述报文转发节点虚拟路由器接收所述数据包前，还包括：所述报文转发节点虚拟路由器基于外网IP地址，与所述网络节点虚拟路由器建立ospf协议的邻居关系。7.如权利要求1所述的方法，其特征在于，所述目标网络节点虚拟路由器确定所述数据包的目的地址，并对所述数据包进行转发处理，具体包括：所述目标网络节点虚拟路由器确定所述数据包的目的地址是否指向所述云主机，若是，则将所述数据包转发至所述云主机；若不是，则将所述数据包通过外网网关转发至外网。8.如权利要求1所述的方法，其特征在于，所述云网络架构还包括外网网关，所述报文转发节点虚拟路由器接收所述数据包，具体包括：所述报文转发节点虚拟路由器通过所述外网网关接收外网向所述云主机发送的数据包；其中，所述外网网关基于等价路由将所述数据包转发至所述报文转发节点虚拟路由器。9.如权利要求1所述的方法，其特征在于，在所述报文转发节点虚拟路由器接收所述数据包之前，所述方法还包括：在所述报文转发节点虚拟路由器所在的报文转发节点、以及所述网络节点虚拟路由器所在的网络节点下发openvswitch流表，以控制所述报文转发节点虚拟路由器及所述网络节点虚拟路由器的子网网关不向外发送ARP请求和回复。10.一种虚拟化云网络架构，其特征在于，所述网络架构用于传输云主机与外网之间的交互数据包，包括至少一报文转发节点虚拟路由器、多个网络节点虚拟路由器，其中，所述报文转发节点虚拟路由器，用于接收所述数据包，并基于数据包属性信息与各所述网络节点虚拟路由器之间的关联关系，从各所述网络节点虚拟路由器中确定出与所述数据包属性信息关联的所述网络节点路由器，作为目标网络节点虚拟路由器，并将所述数据包转发至所述目标网络节点虚拟路由器；所述目标网络节点虚拟路由器，用于确定所述数据包的目的地址，并对所述数据包进行转发处理。11.一种计算机程序产品，其包含计算程序，其特征在于，所述计算机程序被处理器执行时实现如权利要求1至9任一所述的方法。
说明书desc
技术领域本申请涉及云计算技术领域，尤其涉及一种数据转发方法和虚拟化云网络架构。背景技术目前，随着云计算技术的发展，虚拟化的云网络架构越来越多地应用到云计算的技术体系中。相关技术中，云网络架构中包括多节点虚拟路由器，节点虚拟路由器通常使用iptables和协议栈的方式来实现虚拟路由器功能。通常情况下，在主备模式中，节点虚拟路由器在接收到待处理数据包时，会生成连接跟踪记录，从而根据连接跟踪记录进行数据包转发。然而，由于不同的节点虚拟路由器各自对应的连接跟踪记录无法在各节点虚拟路由器之间同步，因此，在同一时刻内仅能有一个节点虚拟路由器处于转发状态，从而降低了网络性能和资源利用率。发明内容本申请实施例提供一种数据转发方法和虚拟化云网络架构，以提高网络性能和资源利用率。本申请实施例提供的具体技术方案如下：一种数据转发方法，应用于部署在云计算平台的虚拟化云网络架构，所述云网络架构用于传输云主机与外网之间的交互数据包，包括至少一个报文转发节点虚拟路由器、多个网络节点虚拟路由器，所述方法包括：针对任一由所述云主机向外网发送的数据包以及外网向所述云主机发送的数据包，均先转发至所述报文转发节点虚拟路由器；所述报文转发节点虚拟路由器接收所述数据包，并基于数据包属性信息与各网络节点虚拟路由器之间的关联关系，确定出与所述数据包属性信息关联的目标网络节点虚拟路由器；所述报文转发节点虚拟路由器将所述数据包转发至所述目标网络节点虚拟路由器；所述目标网络节点虚拟路由器确定所述数据包的目的地址，并对所述数据包进行转发处理。可选的，所述数据包属性信息包含五元组信息，则基于所述数据包属性信息与各网络节点虚拟路由器之间的关联关系，确定出与所述数据包属性信息关联的目标网络节点虚拟路由器，具体包括：所述报文转发节点虚拟路由器对所述五元组信息进行哈希处理，获得所述数据包对应的哈希值；所述报文转发节点虚拟路由器基于预设的各哈希值与网络节点虚拟路由器之间的对应关系，从所述多个网络节点虚拟路由器中，确定出与所述哈希值对应的目标网络节点虚拟路由器。可选的，所述云网络架构还包括计算节点虚拟路由器，所述计算节点虚拟路由器接收所述云主机向外网发送的数据包，并转发至所述报文转发节点虚拟路由器，所述报文转发节点虚拟路由器接收所述数据包，具体包括：所述报文转发节点虚拟路由器接收所述计算节点虚拟路由器发送的数据包。可选的，当所述报文转发节点虚拟路由器的数量为多个时，所述计算节点虚拟路由器接收所述云主机向外网发送的数据包，并转发至所述报文转发节点虚拟路由器，包括：所述计算节点虚拟路由器基于等价路由将所述数据包转发至所述多个报文转发节点虚拟路由器中的一个。可选的，在所述计算节点虚拟路由器基于等价路由转发所述数据包之前，还包括：各所述报文转发节点虚拟路由器基于内网IP地址，分别与所述计算节点虚拟路由器建立ospf协议的邻居关系，并生成等价路由。可选的，在所述报文转发节点虚拟路由器接收所述数据包前，还包括：所述报文转发节点虚拟路由器基于外网IP地址，与所述网络节点虚拟路由器建立ospf协议的邻居关系。可选的，所述目标网络节点虚拟路由器确定所述数据包的目的地址，并对所述数据包进行转发处理，具体包括：所述目标网络节点虚拟路由器确定所述数据包的目的地址是否指向所述云主机，若是，则将所述数据包转发至所述云主机；若不是，则将所述数据包通过外网网关转发至外网。可选的，所述云网络架构还包括外网网关，所述报文转发节点虚拟路由器接收所述数据包，具体包括：所述报文转发节点虚拟路由器通过所述外网网关接收外网向所述云主机发送的数据包；其中，所述外网网关基于等价路由将所述数据包转发至所述报文转发节点虚拟路由器。可选的，在所述报文转发节点虚拟路由器接收所述数据包之前，所述方法还包括：在所述报文转发节点虚拟路由器所在的报文转发节点、以及所述网络节点虚拟路由器所在的网络节点下发openvswitch流表，以控制所述报文转发节点虚拟路由器及所述网络节点虚拟路由器的子网网关不向外发送ARP请求和回复。一种虚拟化云网络架构，所述网络结构用于传输云主机与外网之间的交互数据包，包括至少一报文转发节点虚拟路由器、多个网络节点虚拟路由器，其中，所述报文转发节点虚拟路由器，用于接收所述数据包，并基于所述数据包属性信息与各所述网络节点虚拟路由器之间的关联关系，从各所述网络节点虚拟路由器中确定出与所述数据包属性信息关联的所述网络节点路由器，作为目标网络节点虚拟路由器，并将所述数据包转发至所述目标网络节点虚拟路由器；所述目标网络节点虚拟路由器，用于确定所述数据包的目的地址，并对所述数据包进行转发处理。一种计算机程序产品，其包含计算程序，所述计算机程序被处理器执行时实现上述数据转发方法的步骤。本申请实施例中，针对任一由云主机向外网发送的数据包，以及外网向云主机发送的数据包，均先转发至报文转发节点虚拟路由器，报文转发节点虚拟路由器接收数据包，由于数据包的数据包头部中至少包括数据包属性信息，因此，可以基于各数据包属性信息与各网络节点虚拟路由器之间的关联关系，确定出与数据包属性信息关联的目标网络节点虚拟路由器，将数据包转发至目标网络节点虚拟路由器，从而目标网络节点虚拟路由器确定数据包的目的地址，对数据包进行转发处理。这样，在云网络架构中，增加报文转发节点虚拟路由器，并根据数据包属性信息与各网络虚拟路由器之间的关联关系，确定出关联的目标网络节点虚拟路由器，从而请求数据和响应数据均由同一目标网络节点虚拟路由器进行处理，无需网络节点虚拟路由器之间进行连接跟踪记录的同步，即可实现网络节点虚拟路由器的水平扩展，网络节点虚拟路由器和报文转发节点虚拟路由器保持多主模式，在同一时刻能够有多个网络节点虚拟路由器处于转发状态，从而能够提高网络性能和资源利用率。附图说明图1为本申请实施例中一种数据转发方法的流程示意图；图2为本申请实施例中建立邻居关系与等价路由的流程示意图；图3为本申请实施例中建立对应关系的第一流程示意图；图4为本申请实施例中确定目标网络节点虚拟路由器的第一流程示意图；图5为本申请实施例中建立对应关系第二流程示意图；图6本申请实施例中确定目标网络虚拟路由器的流程示意图；图7为本申请实施例中建立对应关系的第三流程示意图；图8为本申请实施例中确定目标网络节点虚拟路由器的第二流程示意图；图9为本申请实施例中的第一流量转发路径示意图；图10为本申请实施例中的第二流量路径示意图；图11为本申请实施例中一种虚拟化云网络架构的示意图；图12为本申请实施例中数据转发的示例图。具体实施方式下面将结合本申请实施例中的附图，对本申请实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本申请一部分实施例，并不是全部的实施例。基于本申请中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本申请保护的范围。随着云计算技术的发展，虚拟化的云网络架构越来越多的应用到云计算的技术体系中，如，云网络架构中包含多个计算节点和多个网络节点，计算节点用于负责云计算平台中的云主机的运行，网络节点用于负责网络虚拟路由器的运行，用于为计算节点中的云主机提供内网及外网的网络通信服务。相关技术中，网络虚拟路由器通常使用iptables和协议栈的方式来实现虚拟路由器功能。在主备模式下，由于网络虚拟路由器在收到新建连接的待处理数据包时，会生成连接跟踪记录，而连接跟踪记录无法在多个网络虚拟路由器之间同步，因此，在任一时刻只能有一个网络虚拟路由器处于转发状态，无法做到水平扩展，存在性能瓶颈。本申请实施例中，为了解决上述问题，本申请实施例中提供了一种数据转发方法，针对任一由云主机向外网发送的数据包，以及外网向云主机发送的数据包，均先转发至报文转发节点虚拟路由器，报文转发节点虚拟路由器接收数据包，由于数据包的数据包头部中至少包括数据包属性信息，因此，可以基于各数据包属性信息与各网络节点虚拟路由器之间的关联关系，确定出与数据包属性信息关联的目标网络节点虚拟路由器，将数据包转发至目标网络节点虚拟路由器，从而目标网络节点虚拟路由器确定数据包的目的地址，对数据包进行转发处理，从而能够实现网络节点虚拟路由器的水平扩展，即各网络节点虚拟路由器均可用于数据转发，能够提高网络性能和资源利用率。基于上述实施例，参阅图1所示，为本申请实施例中一种数据转发方法的流程示意图，具体包括：步骤100：针对任一由云主机向外网发送的数据包以及外网向云主机发送的数据包，均先转发至报文转发节点虚拟路由器。本申请实施例中，若流量转发路径为云主机至外网，则针对任一由云主机向外网发送的数据包，需先转发至报文转发节点虚拟路由器，若流量转发路径为外网至云主机，则针对外网向云主机发送的数据包，需先转发至报文转发节点虚拟路由器。因此，本申请实施例中，当流量转发路径为云主机至外网时，数据包为云主机发送的，当流量转发路径为外网至云主机时，数据包为外网网关发送的，下面对本申请实施例中，向报文转发节点虚拟路由器发送数据包的过程进行说明。第一种情况：数据包为云主机发送的。具体包括：计算节点虚拟路由器接收云主机向外网发送的数据包，并转发至报文转发节点虚拟路由器。本申请实施例中，当存在一个报文转发节点虚拟路由器，则计算节点虚拟路由器接收云主机向外网发送的数据包，并将接收到的数据包转发至报文转发节点虚拟路由器。需要说明的是，为了实现负载均衡，当存在多个报文转发节点虚拟路由器，则可以基于等价路由，将数据包转发至相应的报文转发节点虚拟路由器，下面对本申请实施例中执行步骤100的过程进行说明：计算节点虚拟路由器基于等价路由将数据包转发至多个报文转发节点虚拟路由器中的一个。本申请实施例中，当流量转发路径为云主机至外网时，计算节点虚拟路由器在接收到数据包后，基于等价路由，确定出需要接收数据包的多个报文转发节点虚拟路由器中的一个，并将数据包转发至确定出的报文转发虚拟节点路由器中。需要说明的是，在进行数据包转发之前，报文转发节点虚拟路由器需要与计算节点虚拟路由器之间建立ospf邻居关系，同时生成等价路由，下面对本申请实施例中，报文转发节点虚拟路由器建立与计算节点虚拟路由器之间的ospf邻居关系和等价路由的过程进行说明，具体包括：各报文转发节点虚拟路由器基于内网IP地址，分别与计算节点虚拟路由器建立开放式最短路径优先协议的邻居关系，并生成等价路由。本申请实施例中，在云网络架构中包含有多个报文转发节点虚拟路由器，因此，每个报文转发节点虚拟路由器均需要基于内网IP地址与计算节点虚拟路由器建立邻居关系，使得计算节点路由器建立各数据包属性信息与相应的内网IP地址之间的等价路由，下面以任意一个报文转发虚拟路由器为例，介绍本申请实施例中建立邻居关系与等价路由的过程如下，参阅图2所示，为本申请实施例中建立邻居关系与等价路由的流程示意图，具体包括：S10：各报文转发节点虚拟路由器基于在内网网段中的第一内网IP地址，以及计算节点虚拟路由器在内网网段中的第二内网IP地址，分别与计算节点虚拟路由器建立ospf协议的邻居关系。本申请实施例中，内网IP地址包括第一内网IP地址和第二内网IP地址，由于各报文转发节点虚拟路由器上的子网网关均具有在预设的内网网段内的IP地址，因此，报文转发节点虚拟路由器确定其自身在预设的内网网段内的IP地址，获得第一内网IP地址，并且，由于计算节点虚拟路由器上的子网网关均具有在预设的内网网段内的IP地址，因此，确定计算节点虚拟路由器在预设的内网网段内的IP地址，获得第二内网IP地址。然后，针对各报文转发节点虚拟路由器，分别执行以下操作：任意一报文转发节点虚拟路由器基于其自身的第一内网IP地址，以及计算节点虚拟路由器的第二内网IP地址，与计算节点虚拟路由器建立ospf协议的邻居关系。例如，当内网网段为内网ospf网段，内网ospf网段为100.67.0.0/24，则报文转发节点虚拟路由器确定其自身在100.67.0.0/24上的第一内网IP地址为100.67.0.4/24，以及，确定计算节点虚拟路由器在100.67.0.0/24上的第二内网IP地址为100.67.0.2/24，然后，报文转发节点虚拟路由器基于第一内网IP地址为100.67.0.4/24，以及第二内网IP地址为100.67.0.2/24，与计算节点虚拟路由器建立ospf协议的邻居关系。需要说明的是，本申请实施例中的第一内网IP地址为报文转发节点虚拟路由器在内网网段中的内网IP地址，第二内网IP地址为计算节点虚拟路由器在内网网段中的内网IP地址。S11：生成等价路由。本申请实施例中，报文转发节点虚拟路由器通过ospf协议，向计算节点路由器发布一条默认路由，从而计算节点虚拟路由器能够获取到各报文转发节点虚拟路由器各自对应的第一内网IP地址，同时，确定各待处理数据包各自对应的数据包属性信息，基于各报文转发节点虚拟路由器各自对应的第一内网IP地址，以及各待处理数据包各自对应的数据包属性信息，结合预设的路由规则，通过路由器选择协议，生成一条具有多个下一跳的等价路由，生成的等价路由的下一跳为各报文转发节点虚拟路由器，这样，在数据转发的过程中，可以基于接收到的数据包的数据包属性信息，以及等价路由，将数据包转发至相应的报文转发节点虚拟路由器中。需要说明的是，本申请实施例中每个第一内网IP地址对应一个报文转发节点虚拟路由器，如，第一内网IP地址100.67.0.4对应的报文转发节点虚拟路由器为l2vs node1，第一内网IP地址100.67.0.6对应的报文转发节点虚拟路由器为l2vs node2，第一内网IP地址100.67.0.8对应的报文转发节点虚拟路由器为l2vs node3。另外，需要说明的是，各待处理数据包为样本数据包，用于建立等价路由。第二种情况：数据包为外网发送的。具体包括：针对任一由外网向云主机发送的数据包，转发至报文转发节点虚拟路由器。本申请实施例中，当流量转发路径为外网至云主机时，任意一个报文转发节点虚拟路由器建立与网络节点虚拟路由器之间的ospf协议的邻居关系。需要说明的是，本申请实施例中，在云网络架构中包含有多个报文转发节点虚拟路由器，因此，每个报文转发节点虚拟路由器均需要与网络节点虚拟路由器建立ospf协议的邻居关系，使得网络节点虚拟路由器建立各数据包属性信息与相应的第一外网IP地址之间的对应关系，下面以上述报文转发节点虚拟路由器为例，介绍本申请实施例中建立对应关系的过程如下，参阅图3所示，为本申请实施例中建立对应关系的第一流程示意图，具体包括：S20：基于在第一外网网段中的第一外网IP地址，以及网络节点虚拟路由器在第一外网网段中的第二外网IP地址，与网络节点虚拟路由器建立ospf协议的邻居关系。本申请实施例中，由于报文转发节点虚拟路由器具有其在预设的第一外网网段内的外网IP地址，因此，报文转发节点虚拟路由器确定其自身在预设的第一外网网段内的外网IP地址，获得第一外网IP地址，并且，确定网络节点虚拟路由器在预设的第一外网网段内的第二外网IP地址。然后，基于第一外网IP地址，以及第二外网IP地址，建立与网络节点虚拟路由器之间的ospf协议的邻居关系。例如，当外网网段为外网ospf网段，外网ospf网段为100.66.0.0/16，则报文转发节点虚拟路由器与网络节点虚拟路由器通过外网ospf网段100.66.0.0/16建立ospf协议的邻居关系。需要说明的是，本申请实施例中的第一外网IP地址为报文转发节点虚拟路由器在第一外网网段中的外网IP地址，第二外网IP地址为外网网关在第一外网网段中的外网IP地址。S21：将公网IP发送至外网网关，以使外网网关基于各第一外网IP地址和各数据包属性信息，生成具有多个下一跳的等价路由，以及，建立各数据包属性信息与相应的第一外网IP地址之间的对应关系。本申请实施例中，由于网络节点虚拟路由器上预先配置有公网IP，因此，首先，网络节点虚拟路由器将预先配置的公网IP发送给报文转发节点虚拟路由器，然后，报文转发节点虚拟路由器将通过ospf协议学习到的公网IP的公网路由，再通过ospf协议发布至外网网关，从而外网网关能够获取到各报文转发节点虚拟路由器各自对应的第一外网IP地址，同时，确定各待处理数据包各自对应的数据包属性信息，基于各报文转发节点虚拟路由器各自对应的第一外网IP地址，以及各待处理数据包各自对应的数据包属性信息，通过ospf协议，生成目的网段为公网IP，且具有多个下一跳的动态路由，生成的第一目标动态路由的下一跳为各报文转发节点虚拟路由器，同时，建立各数据包属性信息与相应的第一外网IP地址之间的对应关系，这样，在数据转发的过程中，可以基于数据包的数据包属性信息，确定出需要将数据包转发到哪个报文转发节点虚拟路由器中，从而基于确定出的报文转发节点虚拟路由器对应的第一外网IP地址，将数据包转发至该报文转发节点虚拟路由器中。需要说明的是，本申请实施例中每个第一外网IP地址对应一个报文转发节点虚拟路由器，如，当公网IP为1.2.3.4/32时，第一外网IP地址100.66.0.6对应的报文转发节点虚拟路由器为l2vs node1，第一外网IP地址100.66.0.8对应的报文转发节点虚拟路由器为l2vs node2，第一外网IP地址100.66.0.10对应的报文转发节点虚拟路由器为l2vs node3。步骤110：报文转发节点虚拟路由器接收数据包，并基于数据包属性信息与各网络节点虚拟路由器之间的关联关系，确定出与数据包属性信息关联的目标网络节点虚拟路由器。本申请实施例中，报文转发节点虚拟路由器接收数据包，从而基于接收到的数据包对应的数据包属性信息与各网络节点虚拟路由器之间的关联关系，确定出与数据包属性信息关联的目标网络节点虚拟路由器。具体地，报文转发节点虚拟路由器接收数据包时，可以接收计算节点虚拟路由器发送的数据包，具体包括：报文转发节点虚拟路由器接收计算节点虚拟路由器发送的数据包。本申请实施例中，计算节点虚拟路由器将数据包转发至报文转发节点虚拟路由器，从而报文转发节点虚拟路由器接收计算节点虚拟路由器发送的数据包。可选的，本申请实施例中，云网络架构还包括外网网关，报文转发节点虚拟路由器接收所述数据包，具体包括：报文转发节点虚拟路由器通过外网网关接收外网向云主机发送的数据包。其中，外网网关基于等价路由将数据包转发至报文转发节点虚拟路由器。本申请实施例中，外网网关基于如S20-21确定出的等价路由，将数据包转发至报文转发节点虚拟路由器，从而报文转发节点虚拟路由器接收外网网关发送的数据包。需要说明的是，在确定目标网络节点虚拟路由器时，是通过以下方式实现的：基于数据包的数据包属性信息，以及各数据包属性信息与各网络节点虚拟路由器之间的关联关系，从各网络节点虚拟路由器中，确定出与数据包属性信息关联的目标网络节点虚拟路由器。可选的，本申请实施例中，数据包的数据包属性信息可以包含五元组信息，下面对本申请实施例中，确定目标网络节点虚拟路由器的过程进行说明，参阅图4所示，为本申请实施例中确定目标网络节点虚拟路由器的第一流程示意图，具体包括：S30：报文转发节点虚拟路由器对五元组信息进行哈希处理，获得数据包对应的哈希值。本申请实施例中，采用预设的哈希计算方式，对五元组信息进行哈希计算，获得数据包对应的哈希值。需要说明的是，本申请实施例中，可以采用现有的哈希计算方式，在此不过多赘述。其中，五元组信息为源IP地址、目的IP地址、协议号、源端口、目的端口。S31：报文转发节点虚拟路由器基于预设的各哈希值与网络节点虚拟路由器之间的对应关系，从各网络节点虚拟路由器中，确定出与哈希值对应的目标网络节点虚拟路由器。本申请实施例中，基于获得的哈希值，以及预设的各哈希值与网络节点虚拟路由器之间的对应关系，从多个网络节点虚拟路由器中，确定出与获得的哈希值对应的网络节点虚拟路由器。具体的，本申请实施例中，当流量转发路径为云主机至外网时，首先需要建立各哈希值与网络节点虚拟路由器之间的对应关系，然后基于对应关系，确定出相应的网络节点虚拟路由器。下面对本申请实施例中建立各哈希值与各网络节点虚拟路由器之间的对应关系的过程进行说明，参阅图5所示，为本申请实施例中建立对应关系第二流程示意图，具体包括：S40：报文转发节点虚拟路由器基于外网IP地址，与网络节点虚拟路由器建立ospf协议的邻居关系。本申请实施例中，由于报文转发节点虚拟路由器的外网网关具有在预设的第二外网ospf网段中的外网IP地址，因此，报文转发节点虚拟路由器确定其自身在第二外网ospf网段中的外网IP地址，获得第三外网IP地址，并且，由于各网络节点虚拟路由器的外网网关均有在第二外网网段中的外网IP地址，因此，分别确定每个网络节点虚拟路由器在第二外网网段中的外网IP地址，从而获得各第四外网IP地址。然后，在获得第三外网IP地址，以及各第四外网IP地址后，分别针对各网络节点虚拟路由器，执行以下操作：基于第三外网IP地址，以及任意一个网络节点虚拟路由器对应的第四外网IP地址，与该网络节点虚拟路由器建立ospf协议的邻居关系。例如，第二外网ospf网段为100.65.0.0/16，则报文转发节点虚拟路由器确定其自身在100.65.0.0/16上的第三外网IP地址，以及，分别确定各网络节点虚拟路由器各自对应的第四外网IP地址。需要说明的是，本申请实施例中的第三外网IP地址为报文转发节点虚拟路由器在第二外网网段中的外网IP地址，第四外网IP地址为网络节点虚拟路由器在第二外网网段中的外网IP地址。S41：接收各网络节点虚拟路由器发布的默认路由。本申请实施例中，各网络虚拟节点路由器通过ospf协议，向报文转发节点虚拟路由器发布一条默认路由，因此，报文转发节点虚拟路由器接收各网络节点虚拟路由器发布的默认路由。S42：基于路由规则，以及各数据包属性信息各自对应的哈希值，生成具有多个下一跳的默认路由，以及，建立各哈希值，与相应的第四外网IP地址之间的对应关系。本申请实施例中，分别对各待处理数据包各自对应的数据包属性信息进行哈希处理，确定各数据包属性信息各自对应的哈希值，并根据预设的路由规则，以及各哈希值，生成具有多个下一跳的目标默认路由，生成的目标默认路由的下一跳为多个网络节点虚拟路由器，同时，建立各哈希值与相应的第四外网IP地址之间的对应关系。这样，在数据转发的过程中，可以对数据包的数据包属性信息进行哈希处理，获得数据包属性信息对应的哈希值，并根据确定出的哈希值，结合各哈希值与相应的第四外网IP地址之间的对应关系，确定出需要将数据包转发到的目标网络节点虚拟路由器，从而基于确定出的目标网络节点虚拟路由器对应的第四外网IP地址，将数据包转发至该目标网络节点虚拟路由器中。例如，当第二外网网段为100.65.0.0/16时，第四外网IP地址100.65.0.7对应的网络节点虚拟路由器为network node1，第四外网IP地址100.65.0.9对应的网络节点虚拟路由器为network node2，第四外网IP地址100.65.0.11对应的网络节点虚拟路由器为network node3。在建立各哈希值与相应的第四外网IP地址之间的对应关系后，即可根据哈希值与相应的第四外网IP地址之间的对应关系，确定出与哈希值对应的目标网络节点虚拟路由器，参阅图6所示，为本申请实施例中确定目标网络虚拟路由器的流程示意图，具体包括：S50：获取各哈希值与相应的第四外网IP地址之间的对应关系。本申请实施例中，获取各哈希值与相应的第四外网IP地址之间的对应关系。具体地，可以通过上述步骤建立各哈希值与相应的第四外网IP地址之间的对应关系，在此不过多赘述。S51：基于各哈希值与相应的第四外网IP地址之间的对应关系，确定出与哈希值对应的目标第四外网IP地址，以及目标第四外网IP地址对应的目标网络节点虚拟路由器。本申请实施例中，在确定出数据包属性信息对应的哈希值后，基于确定出的哈希值，从各哈希值与相应的第四外网IP地址之间的对应关系中，确定出与该哈希值对应的第四外网IP地址，并确定该第四外网IP地址对应的目标网络节点虚拟路由器。S52：将数据包发送至目标网络节点虚拟路由器。本申请实施例中，将数据包发送至该目标网络节点虚拟路由器。可选的，本申请实施例中，当流量转发路径为外网至云主机时，网络节点虚拟路由器对应的IP地址为公网IP中的第一公网IP地址。首先，对本申请实施例中建立各哈希值与相应的第一公网IP地址之间的对应关系的过程进行说明，参阅图7所示，为本申请实施例中建立对应关系的第三流程示意图，具体包括：S60：接收各网络节点虚拟路由器发送的公网IP。本申请实施例中，各网络节点虚拟路由器通过路由器选择协议，向报文转发节点虚拟路由器发送公网IP，因此，报文转发节点虚拟路由器接收各网络节点虚拟路由器发送的公网IP。S61：基于预设的路由规则，以及各数据包属性信息各自对应的哈希值，生成目的网段为公网IP的多个下一跳的动态路由，以及，建立各哈希值，与相应的第一公网IP地址之间的对应关系。本申请实施例中，分别对各待处理数据包各自对应的数据包属性信息进行哈希处理，确定各数据包属性信息各自对应的哈希值，并根据预设的路由规则，以及各数据包属性信息各自对应的哈希值，生成具有多个下一跳的动态路由，生成的动态路由的下一跳为多个网络节点虚拟路由器，每个网络节点虚拟路由器为目的网段为公网IP的网络节点虚拟路由器，同时，建立各哈希值与相应的第一公网IP地址之间的对应关系。这样，在数据转发的过程中，可以对数据包的数据包属性信息进行哈希处理，获得数据包属性信息对应的哈希值，并根据确定出的哈希值，结合各哈希值与相应的第一公网IP地址之间的对应关系，确定出需要将数据包转发到的目标网络节点虚拟路由器，从而基于确定出的目标网络节点虚拟路由器对应的第一公网IP地址，将数据包转发至该目标网络节点虚拟路由器中。例如，报文转发节点虚拟路由器通过ospf协议生成目的网段是公网IP，且下一跳是各网络节点虚拟路由器的动态路由，当公网IP为1.2.3.4/32时，第一公网IP地址100.65.0.7对应的网络节点虚拟路由器为network node1，第一公网IP地址100.65.0.9对应的网络节点虚拟路由器为network node2，第一公网IP地址100.65.0.11对应的网络节点虚拟路由器为network node3。在建立各哈希值与相应的第一公网IP地址之间的对应关系后，即可根据哈希值与相应的第一公网IP地址之间的对应关系，确定出与哈希值对应的目标网络节点虚拟路由器，参阅图8所示，为本申请实施例中确定目标网络节点虚拟路由器的第二流程示意图，具体包括：S70：获取各哈希值与相应的第一公网IP地址之间的对应关系。本申请实施例中，获取各哈希值与相应的第一公网IP地址之间的对应关系。具体地，可以通过上述步骤建立各哈希值与相应的第一公网IP地址之间的对应关系，在此不过多赘述。S71：基于各哈希值与相应的第一公网IP地址之间的对应关系，确定出与哈希值对应的目标第一公网IP地址，以及目标第一公网IP地址对应的目标网络节点虚拟路由器。本申请实施例中，在确定出数据包属性信息对应的哈希值后，基于确定出的哈希值，从各哈希值与相应的第一公网IP地址之间的对应关系中，确定出与该哈希值对应的第一公网IP地址，并确定该第一公网IP地址对应的目标网络节点虚拟路由器。步骤120：报文转发节点虚拟路由器将数据包转发至目标网络节点虚拟路由器。本申请实施例中，在确定出目标网络节点虚拟路由器后，报文转发节点虚拟路由器将数据包转发至目标网络节点虚拟路由器。步骤130：目标网络节点虚拟路由器确定数据包的目的地址，并对所述数据包进行转发处理。本申请实施例中，执行步骤130时，具体包括：目标网络节点虚拟路由器判断数据包的目的地址是否指向云主机。具体可以分为以下两种情况：第一种情况：目标网络节点虚拟路由器确定数据包的目的地址指向云主机，则将数据包转发至云主机。本申请实施例中，将待处理数据包转发至目标网络虚拟路由器，当目标网络虚拟路由器在获得待处理数据包后，对待处理数据包的五元组信息中的源IP地址进行修改，并通过默认路由将待处理数据包发送至相应的网络节点虚拟路由器中。第二种情况：目标网络节点虚拟路由器确定数据包的目的地址未指向云主机，则将数据包通过外网网关转发至外网。本申请实施例中，将数据包发送至目标网络虚拟路由器，当目标网络虚拟路由器在获得数据包后，对待处理数据包的五元组信息中的目的IP地址进行修改，并将待处理数据包发送给预先配置的静态MAC地址对应的云主机。需要说明的是，本申请实施例中，网络虚拟路由器通过配置静态MAC地址的方式来实现与云主机的通信，在创建云主机的时候，网络节点相关代理配置与云主机IP相关的静态MAC地址。本申请实施例中，增加多个报文转发节点虚拟路由器，能够实现网络节点中的网络节点虚拟路由器与计算节点中的各报文转发节点虚拟路由器保持多主模式，从而提高了网络性能。基于上述实施例，参阅图9所示，为本申请实施例中的第一流量转发路径示意图，具体包括：1、云主机。本申请实施例中，云主机向计算节点虚拟路由器发送数据包。需要说明的是，当云主机向计算节点虚拟路由器发送数据包时，采用的是分布式路由机制。2、计算节点虚拟路由器。本申请实施例中，计算节点虚拟路由器在接收到云主机发送的数据包后，基于数据包属性信息，结合各数据包属性信息与相应的第一内网IP地址之间的对应关系，确定出对应的报文转发节点虚拟路由器，并将数据包发送至确定出的报文转发节点虚拟路由器。3、报文转发节点虚拟路由器。本申请实施例中，报文转发节点虚拟路由器在接收到计算节点虚拟路由器发送的数据包后，对数据包对应的五元组信息进行哈希计算，获得数据包属性信息对应的哈希值，然后，获取各哈希值与相应的第四外网IP地址之间的对应关系，并基于确定出的哈希值，结合各哈希值与相应的第四外网IP地址之间的对应关系，确定出对应的目标网络节点虚拟路由器。其中，五元组信息包括源IP地址源地址转换后的地址、目的IP地址、协议号、源端口、目的端口。需要说明的是，多个报文转发节点虚拟路由器保持同一哈希算法，确保同一条流哈希到同一个网络节点虚拟路由器上。4、网络节点虚拟路由器。本申请实施例中，在接收到报文转发节点虚拟路由器发送的数据包后，对数据包进行SNAT处理，并通过默认路由将数据包发送至网络节点虚拟路由器。5、外网网关。本申请实施例中，外网网关接收目标网络节点虚拟路由器发送的数据包。基于上述实施例，参阅图10所示，为本申请实施例中的第二流量路径示意图，具体包括：1、外网网关。本申请实施例中，外网访问云主机的公网IP，外网网关在接收到数据包后，基于数据包对应的数据包属性信息，结合各数据包属性信息与相应的第一外网IP地址之间的对应关系，确定出对应的报文转发节点虚拟路由器，并将数据包发送给确定出的报文转发节点虚拟路由器。2、报文转发节点虚拟路由器。本申请实施例中，报文转发节点虚拟路由器在接收到数据包后，获取各哈希值与相应的第一公网IP地址之间的对应关系，并基于各哈希值与相应的第一公网IP地址之间的对应关系，确定出与哈希值对应的目标第一公网IP地址，以及目标第一公网IP地址对应的目标网络节点虚拟路由器，将数据包发送给确定出的目标网络节点虚拟路由器。其中，五元组信息包括源IP地址、目的IP地址、协议号、源端口、目的端口。需要说明的是，多个报文转发节点虚拟路由器保持同一哈希算法，确保同一条流哈希到同一个网络节点虚拟路由器上。3、网络节点虚拟路由器。本申请实施例中，接收报文转发节点虚拟路由器发送的数据包，并对数据包执行目的地址转换处理，将数据包发送给配置的静态MAC对应的计算节点虚拟路由器。4、计算节点虚拟路由器。本申请实施例中，接收目标网络节点虚拟路由器发送的数据包，并将接收到的数据包发送给云主机。5、云主机。本申请实施例中，接收计算节点虚拟路由器发送的数据包。基于上述实施例，参阅图11所示，为本申请实施例中一种虚拟化云网络架构的示意图，虚拟化云网络架构是基于虚拟路由器搭建的，各虚拟路由器部署在云计算平台的各节点上，一个节点可由一台服务器或一个服务器集群构成，虚拟化云网络架构包括至少一个报文转发节点虚拟路由器、多个网络节点虚拟路由器。1、报文转发节点虚拟路由器，用于接收数据包，并基于数据包属性信息与各网络节点虚拟路由器之间的关联关系，从各网络节点虚拟路由器中确定出与数据包属性信息关联的网络节点路由器，作为目标网络节点虚拟路由器，并将数据包转发至目标网络节点虚拟路由器。2、目标网络节点虚拟路由器，用于确定数据包的目的地址，并对数据包进行转发处理。基于上述实施例，参阅图12所示，为本申请实施例中数据转发的示例图。1、计算节点。本申请实施例中，计算节点包括云主机和计算节点虚拟路由器。当数据转发路径为云主机至外网时，云主机发往外网的数据包先到计算节点的计算节点虚拟路由器上。需要说明的是，采用的是DVR机制。当数据转发路径为外网至云主机时，接收网络节点虚拟路由器发送的待处理数据包，且目的MAC为配置的静态MAC。其中，云主机对应的IP地址为192.168.1.1/24。计算节点虚拟路由器包括网关1和网关2，网关1对应的第二内网IP地址为100.67.0.2/24，网关2对应的第二内网IP地址为100.67.0.3/24。另外，需要说明的是，在报文转发节点虚拟路由器所在的报文转发节点、以及网络节点虚拟路由器所在的网络节点下发openvswitch流表，以控制报文转发节点虚拟路由器及网络节点虚拟路由器的子网网关不能向外发送ARP请求和回复。2、报文转发节点。本申请实施例中，报文转发节点中包含有多个报文转发节点虚拟路由器。具体的，当数据转发路径为云主机至外网时，报文转发节点虚拟路由器对数据包头部的五元组信息进行哈希计算，获得数据包对应的哈希值，然后，基于哈希值确定出相应的目标网络节点虚拟路由器。具体的，当数据转发路径为外网至云主机时，报文转发节点虚拟路由器对数据包头部的五元组信息进行哈希计算，获得数据包对应的哈希值，然后，基于哈希值确定出相应的目标网络节点虚拟路由器。其中，报文转发节点包括报文转发节点虚拟路由器1和报文转发节点虚拟路由器2，报文转发节点虚拟路由器1对应的第一内网IP地址为100.67.0.5/24，报文转发节点虚拟路由器2对应的第一内网IP地址为100.67.0.4/24，100.65.0.5/16为下一跳的网络节点路由器对应的第四外网IP地址，100.66.0.6/16为下一跳的网络节点路由器对应的第四外网IP地址。需要说明的是，由于云主机至外网的流量路径中，和外网至云主机的流量路径中，网络节点虚拟路由器所在的网段不同，因此，确定出的目标网络节点虚拟路由器也是不同的。3、网络节点。本申请实施例中，网络节点中包含有多个网络节点虚拟路由器。具体的，当数据转发路径为云主机至外网时，网络节点虚拟路由器在接收到数据包后，做SNAT，并通过默认路由将数据包转发至网络节点虚拟路由器中。具体的，当数据转发路径为外网至云主机时，网络节点虚拟路由器做DNAT，并将数据包发送给云主机。其中，网络节点中包括网络节点虚拟路由器1和网络节点虚拟路由器2，网络节点虚拟路由器1对应的第一公网IP地址为192.168.1.1/24，网络节点虚拟路由器2对应的第一公网IP地址为192.168.2.1/24，100.65.0.6/16为将数据包发送到网络节点的报文转发虚拟路由器对应的第四外网IP地址。基于上述实施例，本申请实施例中，提供了一种计算机程序产品，其上存储有计算机程序，所述计算机程序被处理器执行时实现上述任意方法实施例中的数据转发方法。本领域内的技术人员应明白，本申请的实施例可提供为方法、系统、或计算机程序产品。因此，本申请可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本申请可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本申请是参照根据本申请的方法、设备、和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。显然，本领域的技术人员可以对本申请进行各种改动和变型而不脱离本申请的精神和范围。这样，倘若本申请的这些修改和变型属于本申请权利要求及其等同技术的范围之内，则本申请也意图包含这些改动和变型在内。
