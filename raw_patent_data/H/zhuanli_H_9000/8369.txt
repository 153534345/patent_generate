标题title
LIN协议波特率检测装置及芯片设备
摘要abst
本发明公开了一种LIN协议波特率检测装置及芯片设备，装置包括：边沿检测模块，用于在检测到主机节点发送的输入信号的上升沿和下降沿时，分别生成上升沿触发信号和下降沿触发信号；脉冲宽度计数模块，用于在接收到上升沿触发信号和下降沿触发信号时，分别对输入信号的低电平宽度和高电平宽度进行计数，得到负脉冲宽度和正脉冲宽度；帧头模式识别模块，用于在根据负脉冲宽度和正脉冲宽度，判断同步间隔段有效后，生成同步间隔检测有效标志和波特率分频比；波特率产生模块，用于在接收到同步间隔检测有效标志后，根据波特率产生模块的时钟频率和波特率分频比，计算主机节点设置的波特率。由此，能够自动检测主机节点的波特率，实现从机节点即插即用。
权利要求书clms
1.一种LIN协议波特率检测装置，其特征在于，包括：边沿检测模块，用于获取主机节点发送的输入信号，并在检测到所述输入信号的上升沿时，生成上升沿触发信号，以及在检测到所述输入信号的下降沿时，生成下降沿触发信号；脉冲宽度计数模块，与所述边沿检测模块连接，用于在接收到所述上升沿触发信号时，对所述输入信号的低电平宽度进行计数，得到负脉冲宽度，以及在接收到所述下降沿触发信号时，对所述输入信号的高电平宽度进行计数，得到正脉冲宽度；帧头模式识别模块，与所述脉冲宽度计数模块连接，用于根据所述负脉冲宽度和所述正脉冲宽度，判断同步间隔段是否有效，并在所述同步间隔段有效后，生成同步间隔检测有效标志和波特率分频比；波特率产生模块，与所述帧头模式识别模块连接，用于在接收到所述同步间隔检测有效标志后，根据所述波特率产生模块的时钟频率和所述波特率分频比，计算所述主机节点设置的波特率。2.如权利要求1所述的LIN协议波特率检测装置，其特征在于，所述帧头模式识别模块还与所述边沿检测模块连接，具体用于在接收到所述下降沿触发信号时，根据所述负脉冲宽度和正脉冲宽度，判断同步间隔段是否有效。3.如权利要求1所述的LIN协议波特率检测装置，其特征在于，所述脉冲宽度计数模块包括：负脉冲宽度计数器，与所述帧头模式识别模块连接；正脉冲宽度计数器，与所述帧头模式识别模块连接；脉冲宽度计数器，分别与所述边沿检测模块、所述负脉冲宽度计数器、所述正脉冲宽度计数器连接，用于在接收到所述上升沿触发信号时，将低电平宽度移位进所述负脉冲宽度计数器，以及在接收到所述下降沿触发信号时，将高电平宽度移位进所述正脉冲宽度计数器。4.如权利要求3所述的LIN协议波特率检测装置，其特征在于，所述负脉冲宽度计数器的数量为多个，且级联连接，各所述负脉冲宽度计数器还与所述边沿检测模块连接，用于在接收到所述上升沿触发信号时，将自身存储的低电平宽度移位进下一级负脉冲宽度计数器；所述正脉冲宽度计数器的数量为多个，且级联连接，各所述正脉冲宽度计数器还与所述边沿检测模块连接，用于在接收到所述下降沿触发信号时，将自身存储的高电平宽度移位进下一级正脉冲宽度计数器；其中，所述脉冲宽度计数器分别与最高级别的负脉冲宽度计数器、最高级别的正脉冲宽度计数器连接，用于在接收到所述上升沿触发信号时，将低电平宽度移位进所述最高级别的负脉冲宽度计数器，以及在接收到所述下降沿触发信号时，将高电平宽度移位进所述最高级别的正脉冲宽度计数器。5.如权利要求4所述的LIN协议波特率检测装置，其特征在于，所述负脉冲宽度计数器的数量为5个，5个所述负脉冲宽度计数器的计数值从最高级别到最低级别分别为n4、n3、n2、n1、n0。6.如权利要求5所述的LIN协议波特率检测装置，其特征在于，所述正脉冲宽度计数器的数量为5个，5个所述正脉冲宽度计数器的计数值从最高级别到最低级别分别为p4、p3、p2、p1、p0。7.如权利要求6所述的LIN协议波特率检测装置，其特征在于，所述帧头模式识别模块，具体用于在如下条件满足时，判定同步间隔段有效：n1=p1，n2=p2，n3=p3，n4=p4，n1=n2=n3=n4，p1=p2=p3=p4，n0≥13n1，p0≥p1。8.一种芯片设备，其特征在于，包括：如权利要求1-7中任一项所述的LIN协议波特率检测装置。9.根据权利要求8所述的芯片设备，其特征在于，所述芯片设备还包括：接收模块，与所述LIN协议波特率检测装置中的波特率产生模块连接，用于根据所述波特率产生模块计算出的波特率接收主机节点发送的后续受保护ID段。
说明书desc
技术领域本发明涉及LIN通信技术领域，尤其涉及一种LIN协议波特率检测装置及芯片设备。背景技术相关技术中的同步间隔段发现和波特率校准的方法为：在LIN通信协议实现中，一般要求在通信之前，事先将主机节点和从机节点设置同样的波特率，主机节点利用该波特率发送帧头，而从机节点用该波特率接收帧头。按照协议规定，主机发送的同步间隔段的显性电平至少是13位，从机则设定接收到11位及以上的显性电平为同步间隔段有效，并在检测到同步间隔段后启动波特率校准模块，在同步段接收过程中，从机节点通过接收到的同步段的位速率来校准从机节点的波特率，并利用校准后的波特率接收PID段。然而，该相关技术需要软件实现设定主从节点波特率，增加了软件开销，且从机节点难以做到即插即用，另外，该相关技术对主从时钟偏差的最大容限范围是±14%，如果时钟偏差更大，则没有办法正确的检测到同步间隔段。发明内容本发明的一个目的在于提出一种LIN协议波特率检测装置及芯片设备，能够自动检测主机节点发送帧头的波特率，实现从机节点即插即用，并且，在计算波特率的同时实现同步间隔的检测，不受±14%时钟偏差容限范围的限制。为达到上述目的，本发明第一方面实施例提出了一种LIN协议波特率检测装置，包括：边沿检测模块，用于获取主机节点发送的输入信号，并在检测到所述输入信号的上升沿时，生成上升沿触发信号，以及在检测到所述输入信号的下降沿时，生成下降沿触发信号；脉冲宽度计数模块，与所述边沿检测模块连接，用于在接收到所述上升沿触发信号时，对所述输入信号的低电平宽度进行计数，得到负脉冲宽度，以及在接收到所述下降沿触发信号时，对所述输入信号的高电平宽度进行计数，得到正脉冲宽度；帧头模式识别模块，与所述脉冲宽度计数模块连接，用于根据所述负脉冲宽度和所述正脉冲宽度，判断同步间隔段是否有效，并在所述同步间隔段有效后，生成同步间隔检测有效标志和波特率分频比；波特率产生模块，与所述帧头模式识别模块连接，用于在接收到所述同步间隔检测有效标志后，根据所述波特率产生模块的时钟频率和所述波特率分频比，计算所述主机节点设置的波特率。根据本发明实施例的LIN协议波特率检测装置，能够自动检测主机节点发送帧头的波特率，实现从机节点即插即用，并且，在计算波特率的同时实现同步间隔的检测，不受±14%时钟偏差容限范围的限制。另外，本发明实施例的LIN协议波特率检测装置，还具有如下附加的技术特征：根据本发明的一个实施例，所述帧头模式识别模块还与所述边沿检测模块连接，具体用于在接收到所述下降沿触发信号时，根据所述负脉冲宽度和正脉冲宽度，判断同步间隔段是否有效。根据本发明的一个实施例，所述脉冲宽度计数模块包括：负脉冲宽度计数器，与所述帧头模式识别模块连接；正脉冲宽度计数器，与所述帧头模式识别模块连接；脉冲宽度计数器，分别与所述边沿检测模块、所述负脉冲宽度计数器、所述正脉冲宽度计数器连接，用于在接收到所述上升沿触发信号时，将低电平宽度移位进所述负脉冲宽度计数器，以及在接收到所述下降沿触发信号时，将高电平宽度移位进所述正脉冲宽度计数器。进一步地，所述负脉冲宽度计数器的数量为多个，且级联连接，各所述负脉冲宽度计数器还与所述边沿检测模块连接，用于在接收到所述上升沿触发信号时，将自身存储的低电平宽度移位进下一级负脉冲宽度计数器；所述正脉冲宽度计数器的数量为多个，且级联连接，各所述正脉冲宽度计数器还与所述边沿检测模块连接，用于在接收到所述下降沿触发信号时，将自身存储的高电平宽度移位进下一级正脉冲宽度计数器；其中，所述脉冲宽度计数器分别与最高级别的负脉冲宽度计数器、最高级别的正脉冲宽度计数器连接，用于在接收到所述上升沿触发信号时，将低电平宽度移位进所述最高级别的负脉冲宽度计数器，以及在接收到所述下降沿触发信号时，将高电平宽度移位进所述最高级别的正脉冲宽度计数器。根据本发明的一个实施例，所述负脉冲宽度计数器的数量为5个，5个所述负脉冲宽度计数器的计数值从最高级别到最低级别分别为n4、n3、n2、n1、n0。根据本发明的一个实施例，所述正脉冲宽度计数器的数量为5个，5个所述正脉冲宽度计数器的计数值从最高级别到最低级别分别为p4、p3、p2、p1、p0。根据本发明的一个实施例，所述帧头模式识别模块，具体用于在如下条件满足时，判定同步间隔段有效：n1=p1，n2=p2，n3=p3，n4=p4，n1=n2=n3=n4，p1=p2=p3=p4，n0≥13n1，P0≥p1。为达到上述目的，本发明第二方面实施例提出了一种芯片设备，包括：所述的LIN协议波特率检测装置。根据本发明实施例的芯片设备，能够自动检测主机节点发送帧头的波特率，实现从机节点即插即用，并且，在计算波特率的同时实现同步间隔的检测，不受±14%时钟偏差容限范围的限制。另外，本发明实施例的芯片设备，还具有如下附加的技术特征：根据本发明的一个实施例，所述芯片设备还包括：接收模块，与所述LIN协议波特率检测装置中的波特率产生模块连接，用于根据所述波特率产生模块计算出的波特率接收主机节点发送的后续受保护ID段。本发明附加的方面和优点将在下面的描述中部分给出，部分将从下面的描述中变得明显，或通过本发明的实践了解到。附图说明图1是本发明一个实施例的LIN协议帧头的示意图；图2是本发明一个实施例的LIN协议波特率检测装置的结构示意图；图3是本发明第一个具体实施例的LIN协议波特率检测装置的结构示意图；图4是本发明第二个具体实施例的LIN协议波特率检测装置的结构示意图；图5是本发明第二个具体实施例的LIN协议帧头的结构示意图；图6是本发明一个实施例的芯片设备的结构示意图；图7是本发明一个具体实施例的芯片设备的结构示意图。具体实施方式首先，LIN协议是基于UART的低成本串行通信协议，可用于汽车，家电办公设备等领域。LIN协议定义了固定格式的帧头结构，其中包括同步间隔段，同步段以及受保护的ID字段。其中协议要求同步间隔段至少保持13位的显性电平，而同步段是8位的0x55，同步段用于校准主从节点由于时钟偏差而导致的波特率不一致，并将同步后的波特率应用于受保护ID的接收，以获得受保护ID段最好的接收效果。下面详细描述本发明的实施例，所述实施例的示例在附图中示出，其中自始至终相同或类似的标号表示相同或类似的元件或具有相同或类似功能的元件。下面通过参考附图描述的实施例是示例性的，旨在用于解释本发明，而不能理解为对本发明的限制。下面参考附图2-7描述本发明实施例的LIN协议波特率检测装置及芯片设备。图2是本发明一个实施例的LIN协议波特率检测装置的结构示意图。如图2所示，LIN协议波特率检测装置100，包括：边沿检测模块10，脉冲宽度计数模块20，帧头模式识别模块30和波特率产生模块40。其中，边沿检测模块10，用于获取主机节点发送的输入信号，并在检测到输入信号的上升沿时，生成上升沿触发信号，以及在检测到输入信号的下降沿时，生成下降沿触发信号；脉冲宽度计数模块20，与边沿检测模块10连接，用于在接收到上升沿触发信号时，对输入信号的低电平宽度进行计数，得到负脉冲宽度，以及在接收到下降沿触发信号时，对输入信号的高电平宽度进行计数，得到正脉冲宽度；帧头模式识别模块30，与脉冲宽度计数模块20连接，用于根据负脉冲宽度和正脉冲宽度，判断同步间隔段是否有效，并在同步间隔段有效后，生成同步间隔检测有效标志和波特率分频比；波特率产生模块40，与帧头模式识别模块30连接，用于在接收到同步间隔检测有效标志后，根据波特率产生模块40的时钟频率和波特率分频比，计算主机节点设置的波特率。具体地，参见图3，边沿检测模块10，获取主机节点发送的输入信号，并在检测到输入信号的上升沿时，生成上升沿触发信号，以及在检测到输入信号的下降沿时，生成下降沿触发信号。进一步地，脉冲宽度计数模块20在接收到边沿检测模块10生成的上升沿触发信号时，对输入信号的低电平宽度进行计数，得到负脉冲宽度，并在接收到边沿检测模块10生成的下降沿触发信号时，对输入信号的高电平宽度进行计数，得到正脉冲宽度。进一步地，帧头模式识别模块30根据脉冲宽度计数模块20得到的负脉冲宽度和正脉冲宽度，判断同步间隔段是否有效，并在同步间隔段有效后，生成同步间隔检测有效标志和波特率分频比。进一步地，波特率产生模块40在接收到帧头模式识别模块30生成的同步间隔检测有效标志后，根据波特率产生模块40的时钟频率和帧头模式识别模块30发送的波特率分频比，计算主机节点设置的波特率。由此，该LIN协议波特率检测装置，通过边沿检测模块，脉冲宽度计数模块，帧头模式识别模块和波特率产生模块，得到主机节点设置的波特率，能够自动检测主机节点发送帧头的波特率，不需要事先设定，从而使得从机节点做到即插即用，并且，在计算波特率的同时实现同步间隔的检测，不受±14%时钟偏差容限范围的限制。作为一个示例，参见图3，脉冲宽度计数模块20可包括：负脉冲宽度计数器21，正脉冲宽度计数器22和脉冲宽度计数器23。其中，负脉冲宽度计数器21，与帧头模式识别模块30连接；正脉冲宽度计数器22，与帧头模式识别模块30连接；脉冲宽度计数器23，分别与边沿检测模块10、负脉冲宽度计数器21、正脉冲宽度计数器22连接，用于在接收到上升沿触发信号时，将低电平宽度移位进负脉冲宽度计数器21，以及在接收到下降沿触发信号时，将高电平宽度移位进正脉冲宽度计数器22。具体地，脉冲宽度计数器23在接收到边沿检测模块10生成的上升沿触发信号时，将低电平宽度移位进负脉冲宽度计数器21，以及在接收到边沿检测模块10生成的下降沿触发信号时，将高电平宽度移位进正脉冲宽度计数器22。由此，通过边沿检测模块触发脉冲宽度计数器计数，通过脉冲宽度计数器将低电平宽度移位进负脉冲宽度计数器，以及将高电平宽度移位进正脉冲宽度计数器，得到输入信号的负脉冲宽度和正脉冲宽度。需要说明的是，负脉冲宽度计数器21和正脉冲宽度计数器22会在同步间隔段有效，波特率分频比计算完成后清零。也就是说，可将同步间隔检测有效标志输入负脉冲宽度计数器21和正脉冲宽度计数器22的清零端，清零负脉冲宽度计数器21和正脉冲宽度计数器22。作为一个示例，负脉冲宽度计数器21的数量为多个，且级联连接，各负脉冲宽度计数器21还与边沿检测模块10连接，用于在接收到上升沿触发信号时，将自身存储的低电平宽度移位进下一级负脉冲宽度计数器21；正脉冲宽度计数器22的数量为多个，且级联连接，各正脉冲宽度计数器22还与边沿检测模块10连接，用于在接收到下降沿触发信号时，将自身存储的高电平宽度移位进下一级正脉冲宽度计数器22。其中，脉冲宽度计数器23分别与最高级别的负脉冲宽度计数器21、最高级别的正脉冲宽度计数器22连接，用于在接收到上升沿触发信号时，将低电平宽度移位进最高级别的负脉冲宽度计数器21，以及在接收到下降沿触发信号时，将高电平宽度移位进最高级别的正脉冲宽度计数器22。举例而言，参见图4，负脉冲宽度计数器21的数量为5个，5个负脉冲宽度计数器21从最高级别到最低级别分别记为r4、r3、r2、r1、r0，5个负脉冲宽度计数器21的计数值从最高级别到最低级别分别为n4、n3、n2、n1、n0。正脉冲宽度计数器22的数量为5个，5个正脉冲宽度计数器22从最高级别到最低级别分别记为s4、s3、s2、s1、s0，5个正脉冲宽度计数器22的计数值从最高级别到最低级别分别为p4、p3、p2、p1、p0。脉冲宽度计数器23在接收到边沿检测模块10生成的上升沿触发信号时，将低电平宽度移位进最高级别的负脉冲宽度计数器r4，将最高级别的负脉冲宽度计数器r4存储的计数值n4移位进下一级负脉冲宽度计数器r3，将下一级负脉冲宽度计数器r3存储的计数值n3移位进下一级负脉冲宽度计数器r2，将下一级负脉冲宽度计数器r2存储的计数值n2移位进下一级负脉冲宽度计数器r1，将下一级负脉冲宽度计数器r1存储的计数值n1移位进最低级别的负脉冲宽度计数器r0。脉冲宽度计数器23在接收到边沿检测模块10生成的下降沿触发信号时，将高电平宽度移位进最高级别的正脉冲宽度计数器s4，将最高级别的正脉冲宽度计数器s4存储的计数值p4移位进下一级正脉冲宽度计数器s3，将下一级正脉冲宽度计数器s3存储的计数值p3移位进下一级正脉冲宽度计数器s2，将下一级正脉冲宽度计数器s2存储的计数值p2移位进下一级正脉冲宽度计数器s1，将下一级正脉冲宽度计数器s1存储的计数值p1移位进最低级别的正脉冲宽度计数器s0。由此，随着输入信号的输入，负脉宽计数器以及正脉宽计数器内存储的低电平宽度和高电平宽度，即为输入信号的负脉冲宽度和正脉冲宽度。需要说明的是，最低级别的负脉冲宽度计数器r0和最低级别的正脉冲宽度计数器s0，没有下一级，只需要在上升沿触发信号和下降沿触发信号到来的时候，将负脉冲宽度计数器r1和正脉冲宽度计数器s1存储的计数值采集到并覆盖最低级别的负脉冲宽度计数器r0和最低级别的正脉冲宽度计数器s0中的原有数据即可。进一步地，参见图3，帧头模式识别模块30还与边沿检测模块10连接，具体用于在接收到边沿检测模块10生成的下降沿触发信号时，根据脉冲宽度计数模块20得到的负脉冲宽度和正脉冲宽度，判断同步间隔段是否有效。具体地，帧头模式识别模块30用于在如下条件满足时，判定同步间隔段有效：n1=p1，n2=p2，n3=p3，n4=p4，n1=n2=n3=n4，p1=p2=p3=p4，n0≥13n1，p0≥p1。具体而言，根据LIN协议规定，同步间隔段至少为13位低电平，同步段为8位0x55，同步间隔段和同步段之间至少为一位高电平，所以在帧头模式识别模块30中需要设置上述条件，如果满足上述条件则判定同步间隔段有效，并在同步间隔段有效后，生成同步间隔检测有效标志。在同步间隔段有效后，由于LIN同步段由4位bit0以及4位bit1组成，根据同步间隔段有效时的各负脉冲宽度计数器21和各正脉冲宽度计数器22的值，计算波特率分频比，即波特率分频比=（n1+n2+n3+n4+p1+p2+p3+p4)/8。进一步地，波特率产生模块40，在接收到帧头模式识别模块30生成的同步间隔检测有效标志后，根据波特率产生模块40的时钟频率和帧头模式识别模块30生成的波特率分频比，计算主机节点设置的波特率，即主机节点设置的波特率=时钟频率/波特率分频比。综上所述，该LIN协议波特率检测装置，通过边沿检测模块，脉冲宽度计数模块，帧头模式识别模块和波特率产生模块，能够自动检测主机节点发送帧头的波特率，不需要事先设定，从而使得从机节点做到即插即用，并且，在计算波特率的同时实现同步间隔的检测，不受±14%时钟偏差容限范围的限制。图6是本发明一个实施例的芯片设备的结构示意图。如图6所示，芯片设备200，包括上述的LIN协议波特率检测装置100。具体地，参见图7，芯片设备200还可包括接收模块210，与LIN协议波特率检测装置100中的波特率产生模块40连接，用于根据波特率产生模块40计算出的波特率接收主机节点发送的后续受保护ID段。综上所述，该芯片设备，通过上述的LIN协议波特率检测装置和接收模块，能够自动检测主机节点发送帧头的波特率，实现从机节点即插即用，并且，在计算波特率的同时实现同步间隔的检测，不受±14%时钟偏差容限范围的限制。在本说明书的描述中，参考术语“一个实施例”、“一些实施例”、“示例”、“具体示例”、或“一些示例”等的描述意指结合该实施例或示例描述的具体特征、结构、材料或者特点包含于本发明的至少一个实施例或示例中。在本说明书中，对上述术语的示意性表述不一定指的是相同的实施例或示例。而且，描述的具体特征、结构、材料或者特点可以在任何的一个或多个实施例或示例中以合适的方式结合。在本发明的描述中，需要理解的是，术语“中心”、“纵向”、“横向”、“长度”、“宽度”、“厚度”、“上”、“下”、“前”、“后”、“左”、“右”、“竖直”、“水平”、“顶”、“底”“内”、“外”、“顺时针”、“逆时针”、“轴向”、“径向”、“周向”等指示的方位或位置关系为基于附图所示的方位或位置关系，仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本发明的限制。此外，术语“第一”、“第二”仅用于描述目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量。由此，限定有“第一”、“第二”的特征可以明示或者隐含地包括至少一个该特征。在本发明的描述中，“多个”的含义是至少两个，例如两个，三个等，除非另有明确具体的限定。在本发明中，除非另有明确的规定和限定，术语“安装”、“相连”、“连接”、“固定”等术语应做广义理解，例如，可以是固定连接，也可以是可拆卸连接，或成一体；可以是机械连接，也可以是电连接；可以是直接相连，也可以通过中间媒介间接相连，可以是两个元件内部的连通或两个元件的相互作用关系，除非另有明确的限定。对于本领域的普通技术人员而言，可以根据具体情况理解上述术语在本发明中的具体含义。在本发明中，除非另有明确的规定和限定，第一特征在第二特征“上”或“下”可以是第一和第二特征直接接触，或第一和第二特征通过中间媒介间接接触。而且，第一特征在第二特征“之上”、“上方”和“上面”可是第一特征在第二特征正上方或斜上方，或仅仅表示第一特征水平高度高于第二特征。第一特征在第二特征“之下”、“下方”和“下面”可以是第一特征在第二特征正下方或斜下方，或仅仅表示第一特征水平高度小于第二特征。尽管上面已经示出和描述了本发明的实施例，可以理解的是，上述实施例是示例性的，不能理解为对本发明的限制，本领域的普通技术人员在本发明的范围内可以对上述实施例进行变化、修改、替换和变型。
