标题title
流量拥塞控制方法、装置、计算机可读介质及电子设备
摘要abst
本公开涉及一种流量拥塞控制方法、装置、计算机可读介质及电子设备，该方法包括：将网卡带宽分给同一台物理机上的虚拟机，虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量；对于物理机上的任意一台虚拟机，将虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽，第一带宽用于传输第一传输协议流量，第二带宽用于传输第二传输协议流量；根据第一传输协议的实际使用带宽及第二传输协议的实际使用带宽，重新分配第一传输协议的带宽和第二传输协议的带宽。能够有效控制第一传输协议与第二传输协议之间的带宽比例，分配一定比例的缓冲带宽以避免流量拥塞，保证运行在同一个物理网络上的不同传输协议的性能。
权利要求书clms
1.一种流量拥塞控制方法，其特征在于，包括：将网卡带宽分给同一台物理机上的虚拟机；所述虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量；第一传输协议与第二传输协议为共享同一个物理网络的不同类型的传输协议；对于所述物理机上的任意一台虚拟机，将所述虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽；所述第一带宽用于传输所述第一传输协议流量，所述第二带宽用于传输所述第二传输协议流量；根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。2.根据权利要求1所述的方法，其特征在于，所述重新分配所述第一传输协议的带宽和所述第二传输协议的带宽的步骤包括:通过远程直接数据存取RDMA网卡重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。3.根据权利要求2所述的方法，其特征在于，所述RDMA网卡包括分类器、第一寄存器、第二寄存器、第三寄存器、第一限速器及第二限速器；通过所述分类器识别经过所述虚拟机的网络接口的流量的类型；通过所述第一寄存器记录经过所述虚拟机的网络接口的流量的类型；通过所述第一限速器第一次控制所述第一传输协议流量及所述第二传输协议流量；通过所述第二限速器用于第二次控制所述第一传输协议流量及所述第二传输协议流量；通过所述第二寄存器存储第一次流量控制的结果；通过所述第三寄存器存储第二次流量控制的结果。4.根据权利要求1所述的方法，其特征在于，所述根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽的步骤包括：在所述总带宽有剩余的情况下，控制所述第一传输协议或所述第二传输协议占用所述总带宽的剩余部分；在所述第一传输协议实际使用的带宽小于所述第一带宽且所述总带宽没有剩余的情况下，控制所述第二传输协议占用所述第一带宽的部分流量；在所述第二传输协议实际使用的带宽小于所述第二带宽且所述总带宽没有剩余的情况下，控制所述第一传输协议占用所述第二带宽的部分流量；在所述第一传输协议实际使用的带宽等于所述第一带宽且所述总带宽没有剩余的情况下，在所述第二传输协议的数据包中设置拥塞标志，以降低所述第二传输协议实际使用的带宽；在所述第二传输协议实际使用的带宽等于所述第二带宽且所述总带宽没有剩余的情况下，控制所述第二传输协议采用丢包回退机制，以降低所述第一传输协议及所述第二传输协议实际使用的带宽。5.根据权利要求4所述的方法，其特征在于，所述根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽还包括：在所述第一传输协议实际使用的带宽与所述第二传输协议实际使用的带宽之和大于预定阈值的情况下，控制所述第一传输协议及所述第二传输协议均采用丢包回退机制；所述预定阈值大于所述总带宽。6.根据权利要求1-5任意一项所述的方法，其特征在于，所述第一传输协议为RoCE，所述第二传输协议为TCP。7.根据权利要求6所述的方法，其特征在于，还包括：通过RDMA网卡控制所述虚拟机的入向流量和/或出向流量。8.一种流量拥塞控制装置，其特征在于，包括：处理模块，用于将网卡带宽分给同一台物理机上的虚拟机；所述虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量；第一传输协议与第二传输协议为共享同一个物理网络的不同类型的传输协议；所述处理模块，还用于对于所述物理机上的任意一台虚拟机，将所述虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽；所述第一带宽用于传输所述第一传输协议流量，所述第二带宽用于传输所述第二传输协议流量；分配模块，用于根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。9.一种计算机可读介质，其上存储有计算机程序，其特征在于，所述计算机程序被处理装置执行时实现权利要求1-7中任一项所述方法的步骤。10.一种电子设备，其特征在于，包括：存储装置，其上存储有至少一个计算机程序；至少一个处理装置，用于执行所述存储装置中的所述至少一个计算机程序，以实现权利要求1-7中任一项所述方法的步骤。
说明书desc
技术领域本公开涉及数据传输技术邻域，具体地，涉及一种流量拥塞控制方法、装置、计算机可读介质及电子设备。背景技术云计算从提出到现在发展了十多年，已经成为互联网的一个重要组成部分，越来越多的企业愿意将服务器署到公共云平台上。企业期望利用云平台的强大算力，在云平台内部完成大量的后台处理，并通过互联网提供简单的终端服务。然而云计算平台面临一个挑战。随着摩尔定律的失效，云计算服务器的CPU性能提升缓慢，网络带宽的增长速度远快于CPU处理性能的增长速度，导致CPU过多的用于网络通信。为加快业务的处理速度，尤其是对于大数据处理来说，用户期望网络带宽尽量高，延迟尽量低，这导致用户购买的计算资源中，有很大一部分被用于网络通信而浪费掉了。远程直接数据存取技术很好地解决了云平台面临的这一挑战。这一技术把网络通信相关的任务卸载到网卡上，节省了用户的计算开销，同时降低了延迟。RDMA网卡为支持这一技术所增加的成本远低于浪费的计算资源成本。因此逐渐成为云计算平台和大数据处理业务的标配。为了节省成本，将RDMA技术运行在以太网上，基于融合以太网的RDMA标准就被提了出来，基于RoCE标准，RDMA技术就可以利用以太网设备进行部署，但毕竟RoCE标准是一个与TCP/IP不同的协议，RoCE流量与TCP流量在同一物理网络上如何和平共处是个问题，因此亟需一种方法来控制RoCE流量与TCP流量之间的带宽。发明内容提供该发明内容部分以便以简要的形式介绍构思，这些构思将在后面的具体实施方式部分被详细描述。该发明内容部分并不旨在标识要求保护的技术方案的关键特征或必要特征，也不旨在用于限制所要求的保护的技术方案的范围。第一方面，本公开提供一种流量拥塞控制方法，包括：将网卡带宽分给同一台物理机上的虚拟机；所述虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量；第一传输协议与第二传输协议为共享同一个物理网络的不同类型的传输协议；对于所述物理机上的任意一台虚拟机，将所述虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽；所述第一带宽用于传输所述第一传输协议流量，所述第二带宽用于传输所述第二传输协议流量；根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。第二方面，本公开提供一种流量拥塞控制装置，包括：处理模块，用于将网卡带宽分给同一台物理机上的虚拟机；所述虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量；第一传输协议与第二传输协议为共享同一个物理网络的不同类型的传输协议；所述处理模块，还用于对于所述物理机上的任意一台虚拟机，将所述虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽；所述第一带宽用于传输所述第一传输协议流量，所述第二带宽用于传输所述第二传输协议流量；分配模块，用于根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。第三方面，本公开提供一种计算机可读介质，其上存储有计算机程序，该计算机程序被处理装置执行时实现前述的流量拥塞控制方法的步骤。第四方面，本公开提供一种计算机设备，包括：存储装置，其上存储有至少一个计算机程序；至少一个处理装置，用于执行所述存储装置中的所述至少一个计算机程序，以实现前述的流量拥塞控制方法的步骤。通过上述技术方案，将网卡带宽分给同一台物理机上的虚拟机，虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量，第一传输协议与第二传输协议为共享同一个物理网络的不同类型的传输协议；对于物理机上的任意一台虚拟机，将虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽，第一带宽用于传输第一传输协议流量，第二带宽用于传输第二传输协议流量；根据第一传输协议的实际使用带宽及第二传输协议的实际使用带宽，重新分配第一传输协议的带宽和第二传输协议的带宽。能够有效控制第一传输协议与第二传输协议之间的带宽比例，分配一定比例的缓冲带宽以避免流量拥塞，保证运行在同一个物理网络上的不同传输协议的性能。本公开的其他特征和优点将在随后的具体实施方式部分予以详细说明。附图说明结合附图并参考以下具体实施方式，本公开各实施例的上述和其他特征、优点及方面将变得更加明显。贯穿附图中，相同或相似的附图标记表示相同或相似的元素。应当理解附图是示意性的，原件和元素不一定按照比例绘制。在附图中：图1是本公开一个示例性实施例提供的虚拟机的带宽分配示意图。图2是本公开一个示例性实施例提供的流量拥塞控制方法的流程图。图3是本公开一个示例性实施例提供的虚拟机入向流量的处理流程图。图4是本公开一个示例性实施例提供的流量拥塞控制装置框图。图5是本公开一个示例性实施例提供的电子设备的结构示意图。附图标记说明120-交换机；140-云计算服务器；20-流量拥塞装置；201-处理模块；203-分配模块；600-计算机设备；601-处理装置；602-ROM；603-RAM；604-总线；605-I/O接口；606-输入装置；607-输出装置；608-存储装置；609-通信装置。具体实施方式下面将参照附图更详细地描述本公开的实施例。虽然附图中显示了本公开的某些实施例，然而应当理解的是，本公开可以通过各种形式来实现，而且不应该被解释为限于这里阐述的实施例，相反提供这些实施例是为了更加透彻和完整地理解本公开。应当理解的是，本公开的附图及实施例仅用于示例性作用，并非用于限制本公开的保护范围。应当理解，本公开的方法实施方式中记载的各个步骤可以按照不同的顺序执行，和/或并行执行。此外，方法实施方式可以包括附加的步骤和/或省略执行示出的步骤。本公开的范围在此方面不受限制。本文使用的术语“包括”及其变形是开放性包括，即“包括但不限于”。术语“基于”是“至少部分地基于”。需要注意，本公开中提及的“第一”、“第二”等概念仅用于对不同的装置、模块或单元进行区分，并非用于限定这些装置、模块或单元所执行的功能的顺序或者相互依存关系。可以理解的是，在使用本公开各实施例公开的技术方案之前，均应当依据相关法律法规通过恰当的方式对本公开所涉及个人信息的类型、使用范围、使用场景等告知用户并获得用户的授权。例如，在响应于接收到用户的主动请求时，向用户发送提示信息，以明确地提示用户，其请求执行的操作将需要获取和使用到用户的个人信息。从而，使得用户可以根据提示信息来自主地选择是否向执行本公开技术方案的操作的电子设备、应用程序、服务器或存储介质等软件或硬件提供个人信息。作为一种可选的但非限定性的实现方式，响应于接收到用户的主动请求，向用户发送提示信息的方式例如可以是弹窗的方式，弹窗中可以以文字的方式呈现提示信息。此外，弹窗中还可以承载供用户选择“同意”或者“不同意”向电子设备提供个人信息的选择控件。可以理解的是，上述通知和获取用户授权过程仅是示意性的，不对本公开的实现方式构成限定，其它满足相关法律法规的方式也可应用于本公开的实现方式中。同时，可以理解的是，本技术方案所涉及的数据应当遵循相应法律法规及相关规定的要求。“尽力而为”的互联网服务适应了早期的发展需求，促使互联网在人们的日常生活中得到了普及，并进一步渗透到了各行各业。但随着应用的展开，“尽力而为”的服务质量逐渐暴露出短板。一些工业生产领域对网络的带宽、时延、抖动等有很高的要求。因此互联网服务质量相关的研究也得到了进一步的重视。云计算服务已经成为互联网的一个重要组成部分，然而云计算服务器的CPU性能提升缓慢，网络带宽的增长速度远快于CPU处理性能的增长速度，同一台云计算服务器配置的网络带宽资源要远大于计算资源，导致CPU过多的用于网络通信。进而导致用户购买的计算资源中，有很大一部分被用于网络通信而浪费掉了。RDMA技术很好的解决了上述问题。为了使RDMA技术与传统以太网兼容，以太网作为互联网最重要的接入标准已经非常普及，几乎所有的数据中心内部都是以太网。为了节省成本，将RDMA技术运行在以太网上，RoCE标准就被提了出来，RoCE标准使得RDMA技术能与以太网无缝对接，减小了部署阻力。但RoCE标准只能运行在数据中心内部，对外提供服务时，还要依赖传统的TCP/IP协议。有了RoCE标准，RDMA技术就可以利用以太网设备进行部署，然而RoCE标准是一个与TCP/IP不同的协议，RoCE流量与TCP流量在同一物理网络上的如何分配带宽是个问题。在云计算平台多租户场景下，更是需要一些特殊的服务质量机制来保证两者都能平稳运行。云计算服务器上的虚拟机使用Linux操作系统，Linux内核流量控制的QoS机制提供了一套框架，通过三种对象对流量进行处理：qdisc、class和filter。其中可分类qdisc包括CBQ、HTB和PRIO等算法。CBQ是Class Based Queueing的缩写。它实现了一个丰富的连接共享类别结构，具有限制带宽和带宽优先级管理的能力。HTB是Hierarchy Token Bucket的缩写。它有丰富的连接共享类别体系，可以保证每个传输协议类别的带宽，也允许突破自己类别的带宽上限，占用别的传输协议的带宽。PRIO是Priority的缩写，它不能限制带宽，但可以很好地对流量进行优先级管理。然而Linux的TC框架比较复杂，使用了很多锁，性能比较差。如果在网卡上使用HTBqdisc来对RoCE流量和TCP流量进行限速，无法满足现有需求，而且RoCE流量对丢包非常敏感，直接使用丢包的方式进行限速会严重影响RoCE协议的性能。以太网交换机每个接口都有8个QoS队列，可以通过每个数据包的IP协议头的差分服务代码点字段识别流量类型，对RoCE流量和非RoCE流量进行分类后，送给不同的队列进行限速和调度。对于从交换机到云计算服务器的入向流量来说，交换机可以对RoCE和TCP流量进行识别，并进行限速和调度。但交换机上的QoS队列有限，且不同虚拟机的RoCE流量使用的是同一个DSCP值，无法同时对多个虚拟机的流量进行限速和调度。对于云计算服务器的虚拟网络来说，RoCE流量和TCP流量共享同一个物理网络，用户虚拟机中的同一个网络接口既可以传输RDMA流量，也可以传输TCP流量。因为RoCE流量的可靠传输和拥塞控制功能都在网卡上，所以需要在网卡上对RoCE流量和TCP流量进行限速为了解决上述问题，本公开一个示例性实施例提供一种流量拥塞控制方法。本公开实施方式中，将网卡带宽分给同一台物理机上的虚拟机，该虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量，其中第一传输协议与第二传输协议为共享同一个物理网络的不同类型的传输协议。示例性的，第一传输协议为RoCE，第二传输协议为TCP，网卡为RDMA网卡。请参阅图1，图1示出了本公开一个示例性实施例提供的虚拟机的带宽分配示意图。如图1所示，包括交换机120及云计算服务器140。假设网卡带宽为200Gbps，云计算服务器140上承载5个虚拟机，分别为VM1-VM5，该虚拟机的网络接口用于传输RoCE流量和TCP流量，在一种实施方式中，可以给每个虚拟机分配40G的带宽。对于交换机120传输至云计算服务器140的入向流量来说，交换机120可以通过每个数据包的IP协议头的DSCP字段识别该数据包的流量类型，对RoCE流量和TCP流量进行分类后，送给RDMA网卡的不同限速器进行限速和调度。需要说明的是，RDMA网卡支持数据平面开发工具包的rte_flow接口，rte_flow接口包括一些规则，如对流量进行分类，通过Meter对流量进行限速和调度，及根据寄存器的值来执行流量的限速和调度，因此通过级联Meter和这些规则可以实现RoCE流量和TCP流量的限速和带宽借用功能。请参阅图2，图2为本公开一个示例性实施例提供的流量拥塞控制方法的流程图。该方法由计算机设备来执行，例如，由图1所示的交换机或云计算服务器来执行。图2所示的流量拥塞控制方法包括以下步骤：在步骤S101中，对于物理机上的任意一台虚拟机，将虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽。第一带宽用于传输第一传输协议流量，第二带宽用于传输第二传输协议流量。第一带宽用于传输RoCE流量，第二带宽用于传输TCP流量。请继续参阅图1，如前述可以给每个虚拟机分配40G的总带宽，给RoCE流量和TCP流量分别分配30G和10G的带宽，5G作为缓冲带宽，以降低RoCE流量和TCP流量过渡抢占的概率；缓冲带宽的取值还可以根据线上运行情况具体调整，在此不作限制。例如，当缓冲带宽为5G时，如果RoCE和TCP都在尽力发数据包，RoCE流量可以达到30G，TCP流量可以达到10G；如果TCP流量为0时，RoCE通过抢占TCP的带宽，最多可以达到35G。在步骤S102中，根据第一传输协议的实际使用带宽及第二传输协议的实际使用带宽，重新分配第一传输协议的带宽和第二传输协议的带宽。示例性的，可以通过RDMA网卡重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。RDMA网卡位于物理机上，可以对物理机上的任意一台虚拟机进行限速和调度。RDMA网卡包括分类器、第一寄存器、第二寄存器、第三寄存器、第一限速器及第二限速器，其中，分类器用于识别经过虚拟机的网络接口的流量的类型，第一寄存器记录经过虚拟机的网络接口的流量的类型，第一限速器及第二限速器实现RoCE流量和TCP流量的限速和调度，第二寄存器及第三寄存器用于记录流量控制的结果。请参阅图3，图3为本公开一个示例性实施例提供的虚拟机入向流量的处理流程图。对于经过虚拟机的网络接口的入向流量，先通过RDMA网卡的分类器识别该入向流量的类型，是RoCE流量还是TCP流量，然后通过第一寄存器R1记录入向流量的类型；通过第一限速器第一次控制RoCE流量和TCP流量，第一限速器可以控制RoCE流量限速30G，控制TCP流量流量限速10G；通过第二寄存器R2存储第一次流量控制的结果，R2的值为G或Y，其中G表示RoCE流量或TCP流量未达到第一限速器的最高限速，Y表示RoCE流量或TCP流量已达到第一限速器的最高限速；通过第二限速器第二次控制RoCE流量和TCP流量，例如可以将RoCE流量与TCP流量之和限速为35G，通过第三寄存器R3存储第二限速器的流量控制的结果，R3的值为G或Y，其中G表示RoCE流量与TCP流量之和未达到第二限速器的最高限速，Y表示RoCE流量与TCP流量已达到第二限速器的最高限速。需要说明的是，根据第一传输协议的实际使用带宽及第二传输协议的实际使用带宽，重新分配第一传输协议的带宽和第二传输协议的带宽有以下几种情形，为了示例说明，这几种情形的带宽分配情形设置为：虚拟机分配有40G的总带宽，缓冲带宽为0，RoCE流量分配有30G的带宽，TCP流量分配有10G的带宽。情形一：在总带宽有剩余的情况下，控制第一传输协议或第二传输协议占用总带宽的剩余部分。总带宽还有剩余的情形，此时可能RoCE流量和TCP流量实际使用的带宽均有剩余，或者其中之一有剩余，此时可以控制没有剩余的一方借用有剩余的一方的带宽，即借用总带宽的剩余部分。情形二：在第一传输协议实际使用的带宽小于第一带宽且总带宽没有剩余的情况下，控制第二传输协议占用第一带宽的部分流量。示例性的，在RoCE流量实际使用的带宽小于30G，且虚拟机的总带宽没有剩余的情况下，此时RoCE流量自己的带宽未用完，总带宽已用完，表明TCP流量带宽已用完，可以控制TCP流量占用RoCE流量的部分带宽，以避免流量拥塞。情形三：在第二传输协议实际使用的带宽小于第二带宽且总带宽没有剩余的情况下，控制第一传输协议占用第二带宽的部分流量。示例性的，在TCP流量实际使用的带宽小于10G，且虚拟机的总带宽没有剩余的情况下，此时TCP流量自己的带宽未用完，总带宽已用完，表明RoCE流量带宽已用完，可以控制RoCE流量占用TCP流量的部分带宽，以避免流量拥塞。情形四：在第一传输协议实际使用的带宽等于第一带宽且总带宽没有剩余的情况下，在第二传输协议的数据包中设置拥塞标志，以降低第二传输协议实际使用的带宽。示例性的，RoCE流量实际使用的带宽逐渐增加，并达到30G，此时总带宽没有剩余，表明TCP流量实际使用的带宽也已经达到10G，由于RoCE流量对丢包更加敏感，直接使用丢包的方式进行限速会严重影响RoCE协议的性能，因此在TCP流量的数据包中设置拥塞标志，以降低TCP流量实际使用的带宽，进而避免流量拥塞。在TCP流量的数据包中设置拥塞标志的具体方式包括：接收TCP流量数据包的中间设备发现网络拥塞后，进而在该数据包中设置拥塞标志，接收端接收到设置有拥塞标志的数据包后，发送降速指示包至发送端，该降速指示包用于指示发送端减少发送数据包，以达到减低流量的目的。情形五：在第二传输协议实际使用的带宽等于第二带宽且总带宽没有剩余的情况下，控制第二传输协议采用丢包回退机制，以降低第一传输协议及第二传输协议实际使用的带宽。示例性的，TCP流量实际使用的带宽逐渐增加，并达到10G，此时总带宽没有剩余，表明RoCE流量实际使用的带宽也已经达到30G，由于RoCE流量对丢包更加敏感，直接使用丢包的方式进行限速会严重影响RoCE协议的性能，因此控制TCP流量采用丢包回退机制，以降低TCP流量实际使用的带宽，进而避免流量拥塞。丢包回退机制是指，丢弃当前正在传输的TCP数据包，等待预定时间后，检测到总带宽有剩余时，重新传输之前丢弃的TCP数据包。情形六：在第一传输协议实际使用的带宽与第二传输协议实际使用的带宽之和大于预定阈值的情况下，控制第一传输协议及第二传输协议均采用丢包回退机制。该预定阈值大于总带宽，例如可以是但不限于45G。虚拟机分配有40G的总带宽，例如，RoCE流量和TCP流量实际使用的带宽之和已经达到45G，此时网络已经不堪重负，十分拥塞，可以通过第三寄存器记录此时的拥塞情况，将第三寄存器的值置为red，RDMA网卡检测到第三寄存器的值为red后，控制RoCE流量和TCP流量均采用丢包回退机制，进而避免流量拥塞。综上所述，当RoCE流量实际使用的带宽不到30G时，TCP流量可以借用RoCE流量的带宽；当TCP流量实际使用的带宽未达到10G时，RoCE流量可以借用TCP流量的带宽；当RoCE流量和TCP流量都在争抢40G带宽时，可以控制二者的可用带宽达到30：10的平衡；需要说明的是，对于虚拟机的网络接口的出向流量，也可以采用本公开提供的流量拥塞控制方法来进行流量分配和调度。综上所述，本公开提供的流量拥塞控制方法，包括将网卡带宽分给同一台物理机上的虚拟机，虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量，第一传输协议与第二传输协议为共享同一个物理网络的不同类型的传输协议；对于物理机上的任意一台虚拟机，将虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽，第一带宽用于传输第一传输协议流量，第二带宽用于传输第二传输协议流量；根据第一传输协议的实际使用带宽及第二传输协议的实际使用带宽，重新分配第一传输协议的带宽和第二传输协议的带宽。能够有效控制第一传输协议与第二传输协议之间的带宽比例，分配一定比例的缓冲带宽以避免流量拥塞，保证运行在同一个物理网络上的不同传输协议的性能。图4是本公开一个示例性实施例示出的一种流量拥塞控制装置框图。参照图4，该装置20包括处理模块201和分配模块205。该处理模块201，用于将网卡带宽分给同一台物理机上的虚拟机；所述虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量；第一传输协议与第二传输协议为共享同一个物理网络的不同类型的传输协议；该处理模块201，还用于对于所述物理机上的任意一台虚拟机，将所述虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽；所述第一带宽用于传输所述第一传输协议流量，所述第二带宽用于传输所述第二传输协议流量；该分配模块203，用于根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。可选地，该分配模块203，还用于通过远程直接数据存取RDMA网卡重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。可选地，所述RDMA网卡包括分类器、第一寄存器、第二寄存器、第三寄存器、第一限速器及第二限速器；该处理模块201，还用于通过所述分类器识别经过所述虚拟机的网络接口的流量的类型；通过所述第一寄存器记录经过所述虚拟机的网络接口的流量的类型；通过所述第一限速器第一次控制所述第一传输协议流量及所述第二传输协议流量；通过所述第二限速器用于第二次控制所述第一传输协议流量及所述第二传输协议流量；通过所述第二寄存器存储第一次流量控制的结果；通过所述第三寄存器存储第二次流量控制的结果。可选地，该分配模块203，还用于在所述总带宽有剩余的情况下，控制所述第一传输协议或所述第二传输协议占用所述总带宽的剩余部分；在所述第一传输协议实际使用的带宽小于所述第一带宽且所述总带宽没有剩余的情况下，控制所述第二传输协议占用所述第一带宽的部分流量；在所述第二传输协议实际使用的带宽小于所述第二带宽且所述总带宽没有剩余的情况下，控制所述第一传输协议占用所述第二带宽的部分流量；在所述第一传输协议实际使用的带宽等于所述第一带宽且所述总带宽没有剩余的情况下，在所述第二传输协议的数据包中设置拥塞标志，以降低所述第二传输协议实际使用的带宽；在所述第二传输协议实际使用的带宽等于所述第二带宽且所述总带宽没有剩余的情况下，控制所述第二传输协议采用丢包回退机制，以降低所述第一传输协议及所述第二传输协议实际使用的带宽。可选地，该分配模块203，还用于在所述第一传输协议实际使用的带宽与所述第二传输协议实际使用的带宽之和大于预定阈值的情况下，控制所述第一传输协议及所述第二传输协议均采用丢包回退机制；所述预定阈值大于所述总带宽。可选地，所述第一传输协议为RoCE，所述第二传输协议为TCP。可选地，该分配模块203，还用于通过所述RDMA网卡控制所述虚拟机的入向流量和/或出向流量。下面参考图5，其示出了适于用来实现本公开实施例的电子设备600的结构示意图。图5示出的电子设备仅仅是一个示例，不应对本公开实施例的功能和使用范围带来任何限制。如图5所示，电子设备600可以包括处理装置601，其可以根据存储在只读存储器602中的程序或者从存储装置608加载到随机访问存储器603中的程序而执行各种适当的动作和处理。在RAM 603中，还存储有电子设备600操作所需的各种程序和数据。处理装置601、ROM 602以及RAM 603通过总线604彼此相连。输入/输出接口605也连接至总线604。通常，以下装置可以连接至I/O接口605：包括例如触摸屏、触摸板、键盘、鼠标、摄像头、麦克风、加速度计、陀螺仪等的输入装置606；包括例如液晶显示器、扬声器、振动器等的输出装置607；包括例如磁带、硬盘等的存储装置608；以及通信装置609。通信装置609可以允许电子设备600与其他设备进行无线或有线通信以交换数据。虽然图5示出了具有各种装置的电子设备600，但是应理解的是，并不要求实施或具备所有示出的装置。可以替代地实施或具备更多或更少的装置。特别地，根据本公开的实施例，上文参考流程图描述的过程可以被实现为计算机软件程序。例如，本公开的实施例包括一种计算机程序产品，其包括承载在非暂态计算机可读介质上的计算机程序，该计算机程序包含用于执行流程图所示的方法的程序代码。在这样的实施例中，该计算机程序可以通过通信装置609从网络上被下载和安装，或者从存储装置608被安装，或者从ROM 602被安装。在该计算机程序被处理装置601执行时，执行本公开实施例的方法中限定的上述功能。需要说明的是，本公开上述的计算机可读介质可以是计算机可读信号介质或者计算机可读存储介质或者是上述两者的任意组合。计算机可读存储介质例如可以是——但不限于——电、磁、光、电磁、红外线、或半导体的系统、装置或器件，或者任意以上的组合。计算机可读存储介质的更具体的例子可以包括但不限于：具有一个或多个导线的电连接、便携式计算机磁盘、硬盘、随机访问存储器、只读存储器、可擦式可编程只读存储器、光纤、便携式紧凑磁盘只读存储器、光存储器件、磁存储器件、或者上述的任意合适的组合。在本公开中，计算机可读存储介质可以是任何包含或存储程序的有形介质，该程序可以被指令执行系统、装置或者器件使用或者与其结合使用。而在本公开中，计算机可读信号介质可以包括在基带中或者作为载波一部分传播的数据信号，其中承载了计算机可读的程序代码。这种传播的数据信号可以采用多种形式，包括但不限于电磁信号、光信号或上述的任意合适的组合。计算机可读信号介质还可以是计算机可读存储介质以外的任何计算机可读介质，该计算机可读信号介质可以发送、传播或者传输用于由指令执行系统、装置或者器件使用或者与其结合使用的程序。计算机可读介质上包含的程序代码可以用任何适当的介质传输，包括但不限于：电线、光缆、RF等等，或者上述的任意合适的组合。上述计算机可读介质可以是上述电子设备中所包含的；也可以是单独存在，而未装配入该电子设备中。上述计算机可读介质承载有一个或者多个程序，当上述一个或者多个程序被该电子设备执行时，使得该电子设备：将网卡带宽分给同一台物理机上的虚拟机；所述虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量；第一传输协议与第二传输协议为共享同一个物理网络的不同类型的传输协议；对于所述物理机上的任意一台虚拟机，将所述虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽；所述第一带宽用于传输所述第一传输协议流量，所述第二带宽用于传输所述第二传输协议流量；根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。可以以一种或多种程序设计语言或其组合来编写用于执行本公开的操作的计算机程序代码，上述程序设计语言包括但不限于面向对象的程序设计语言—诸如Java、Smalltalk、C++，还包括常规的过程式程序设计语言——诸如“C”语言或类似的程序设计语言。程序代码可以完全地在用户计算机上执行、部分地在用户计算机上执行、作为一个独立的软件包执行、部分在用户计算机上部分在远程计算机上执行、或者完全在远程计算机或服务器上执行。在涉及远程计算机的情形中，远程计算机可以通过任意种类的网络——包括局域网或广域网——连接到用户计算机，或者，可以连接到外部计算机。附图中的流程图和框图，图示了按照本公开各种实施例的系统、方法和计算机程序产品的可能实现的体系架构、功能和操作。在这点上，流程图或框图中的每个方框可以代表一个模块、程序段、或代码的一部分，该模块、程序段、或代码的一部分包含一个或多个用于实现规定的逻辑功能的可执行指令。也应当注意，在有些作为替换的实现中，方框中所标注的功能也可以以不同于附图中所标注的顺序发生。例如，两个接连地表示的方框实际上可以基本并行地执行，它们有时也可以按相反的顺序执行，这依所涉及的功能而定。也要注意的是，框图和/或流程图中的每个方框、以及框图和/或流程图中的方框的组合，可以用执行规定的功能或操作的专用的基于硬件的系统来实现，或者可以用专用硬件与计算机指令的组合来实现。描述于本公开实施例中所涉及到的模块可以通过软件的方式实现，也可以通过硬件的方式来实现。其中，模块的名称在某种情况下并不构成对该模块本身的限定。本文中以上描述的功能可以至少部分地由一个或多个硬件逻辑部件来执行。例如，非限制性地，可以使用的示范类型的硬件逻辑部件包括：现场可编程门阵列、专用集成电路、专用标准产品、片上系统、复杂可编程逻辑设备等等。在本公开的上下文中，机器可读介质可以是有形的介质，其可以包含或存储以供指令执行系统、装置或设备使用或与指令执行系统、装置或设备结合地使用的程序。机器可读介质可以是机器可读信号介质或机器可读储存介质。机器可读介质可以包括但不限于电子的、磁性的、光学的、电磁的、红外的、或半导体系统、装置或设备，或者上述内容的任何合适组合。机器可读存储介质的更具体示例会包括基于一个或多个线的电气连接、便携式计算机盘、硬盘、随机存取存储器、只读存储器、可擦除可编程只读存储器、光纤、便捷式紧凑盘只读存储器、光学储存设备、磁储存设备、或上述内容的任何合适组合。根据本公开的一个或多个实施例，示例1提供了一种流量拥塞控制方法，包括：将网卡带宽分给同一台物理机上的虚拟机；所述虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量；第一传输协议与第二传输协议为共享同一个物理网络的不同类型的传输协议；对于所述物理机上的任意一台虚拟机，将所述虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽；所述第一带宽用于传输所述第一传输协议流量，所述第二带宽用于传输所述第二传输协议流量；根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。根据本公开的一个或多个实施例，示例2提供了示例1的方法，还包括：所述重新分配所述第一传输协议的带宽和所述第二传输协议的带宽的步骤包括:通过远程直接数据存取RDMA网卡重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。根据本公开的一个或多个实施例，示例3提供了示例2的方法，所述RDMA网卡包括分类器、第一寄存器、第二寄存器、第三寄存器、第一限速器及第二限速器；通过所述分类器识别经过所述虚拟机的网络接口的流量的类型；通过所述第一寄存器记录经过所述虚拟机的网络接口的流量的类型；通过所述第一限速器第一次控制所述第一传输协议流量及所述第二传输协议流量；通过所述第二限速器用于第二次控制所述第一传输协议流量及所述第二传输协议流量；通过所述第二寄存器存储第一次流量控制的结果；通过所述第三寄存器存储第二次流量控制的结果。根据本公开的一个或多个实施例，示例4提供了示例1的方法，所述根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽的步骤包括：在所述总带宽有剩余的情况下，控制所述第一传输协议或所述第二传输协议占用所述总带宽的剩余部分；在所述第一传输协议实际使用的带宽小于所述第一带宽且所述总带宽没有剩余的情况下，控制所述第二传输协议占用所述第一带宽的部分流量；在所述第二传输协议实际使用的带宽小于所述第二带宽且所述总带宽没有剩余的情况下，控制所述第一传输协议占用所述第二带宽的部分流量；在所述第一传输协议实际使用的带宽等于所述第一带宽且所述总带宽没有剩余的情况下，在所述第二传输协议的数据包中设置拥塞标志，以降低所述第二传输协议实际使用的带宽；在所述第二传输协议实际使用的带宽等于所述第二带宽且所述总带宽没有剩余的情况下，控制所述第二传输协议采用丢包回退机制，以降低所述第一传输协议及所述第二传输协议实际使用的带宽。根据本公开的一个或多个实施例，示例5提供了示例4的方法，所述根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽还包括：在所述第一传输协议实际使用的带宽与所述第二传输协议实际使用的带宽之和大于预定阈值的情况下，控制所述第一传输协议及所述第二传输协议均采用丢包回退机制；所述预定阈值大于所述总带宽。根据本公开的一个或多个实施例，示例6提供了示例1-5的方法，所述第一传输协议为RoCE，所述第二传输协议为TCP。根据本公开的一个或多个实施例，示例7提供了示例6的方法，还包括：通过RDMA网卡控制所述虚拟机的入向流量和/或出向流量。根据本公开的一个或多个实施例，示例8提供了一种流量拥塞控制装置，包括：处理模块，用于将网卡带宽分给同一台物理机上的虚拟机；所述虚拟机的网络接口用于传输第一传输协议流量及第二传输协议流量；第一传输协议与第二传输协议为共享同一个物理网络的不同类型的传输协议；所述处理模块，还用于对于所述物理机上的任意一台虚拟机，将所述虚拟机的总带宽分为第一带宽、第二带宽及缓冲带宽；所述第一带宽用于传输所述第一传输协议流量，所述第二带宽用于传输所述第二传输协议流量；分配模块，用于根据所述第一传输协议的实际使用带宽及所述第二传输协议的实际使用带宽，重新分配所述第一传输协议的带宽和所述第二传输协议的带宽。根据本公开的一个或多个实施例，示例9提供了一种计算机可读介质，其上存储有计算机程序，该计算机程序被处理装置执行时实现前述的流量拥塞控制方法的步骤。根据本公开的一个或多个实施例，示例10提供了一种电子设备，包括：存储装置，其上存储有至少一个计算机程序；至少一个处理装置，用于执行所述存储装置中的所述至少一个计算机程序，以实现前述的流量拥塞控制方法的步骤。以上描述仅为本公开的较佳实施例以及对所运用技术原理的说明。本领域技术人员应当理解，本公开中所涉及的公开范围，并不限于上述技术特征的特定组合而成的技术方案，同时也应涵盖在不脱离上述公开构思的情况下，由上述技术特征或其等同特征进行任意组合而形成的其它技术方案。例如上述特征与本公开中公开的具有类似功能的技术特征进行互相替换而形成的技术方案。此外，虽然采用特定次序描绘了各操作，但是这不应当理解为要求这些操作以所示出的特定次序或以顺序次序执行来执行。在一定环境下，多任务和并行处理可能是有利的。同样地，虽然在上面论述中包含了若干具体实现细节，但是这些不应当被解释为对本公开的范围的限制。在单独的实施例的上下文中描述的某些特征还可以组合地实现在单个实施例中。相反地，在单个实施例的上下文中描述的各种特征也可以单独地或以任何合适的子组合的方式实现在多个实施例中。尽管已经采用特定于结构特征和/或方法逻辑动作的语言描述了本主题，但是应当理解所附权利要求书中所限定的主题未必局限于上面描述的特定特征或动作。相反，上面所描述的特定特征和动作仅仅是实现权利要求书的示例形式。关于上述实施例中的装置，其中各个模块执行操作的具体方式已经在有关该方法的实施例中进行了详细描述，此处将不做详细阐述说明。
