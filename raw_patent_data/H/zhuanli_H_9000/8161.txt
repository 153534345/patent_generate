标题title
一种基于区块链的匿名消息传递方法及系统
摘要abst
本发明公开了一种基于区块链的匿名消息传递方法及系统，本发明包括：接收方R生成请求事务并提交到区块链，等待矿工回应，收到回应则选择一个矿工，基于请求事务生成包含检测密钥DSK的检测事务，并提交到区块链的检测事务交易池中以下发给矿工，从矿工采用模糊消息检测方法FMD基于检测密钥DSK执行检测事务生成的区块中获取由真实的消息事务和假阳性的消息事务构成的消息事务集合，从中提取出真实的消息事务，并从真实的消息事务中提取出发送方S所发送的明文消息。本发明能够实现基于区块链的匿名消息传递，可将消息检测任务外包给去中心化的不可信第三方，具有用户开销小、安全可信、高吞吐量的优点。
权利要求书clms
1.一种基于区块链的匿名消息传递方法，其特征在于，包括：S101，接收方R针对区块链的消息事务交易池中的消息事务生成请求事务，并提交到区块链的请求事务交易池中；S102，接收方R等待矿工从链下通道返回的回应，在收到回应后跳转步骤S103；S103，接收方R根据收到的回应选择一个矿工，基于请求事务生成包含检测密钥DSK的检测事务，并提交到区块链的检测事务交易池中以下发给矿工；S104，接收方R从矿工采用模糊消息检测方法FMD基于检测密钥DSK执行检测事务生成的区块中获取由真实的消息事务和假阳性的消息事务构成的消息事务集合，从中提取出真实的消息事务，并从真实的消息事务中提取出发送方S所发送的明文消息。2.根据权利要求1所述的基于区块链的匿名消息传递方法，其特征在于，步骤S101之前还包括发送方S将需传递的明文消息使用接收方R的公钥加密为密文消息、提交存储服务方SSP获得地址标签，将地址标签加密打包为消息事务并提交到区块链的消息事务交易池。3.根据权利要求2所述的基于区块链的匿名消息传递方法，其特征在于，步骤S104中从真实的消息事务中提取出发送方S所发送的明文消息包括：S201，接收方R从真实的消息事务中提取出加密地址标签；S202，接收方R对加密地址标签进行解密得到原始的地址标签；S203，接收方R根据原始的地址标签从存储服务方SSP中获取密文消息；S204，接收方R将密文消息使用接收方R的私钥解密得到原始的明文消息。4.根据权利要求3所述的基于区块链的匿名消息传递方法，其特征在于，所述接收方R的公钥的函数表达式为：pkFMD＝，上式中，pkFMD为接收方R的公钥，pk1～pkγ为接收方R的公钥中全部的γ个分量；步骤S103中检测密钥DSK的函数表达式为：DSK←，上式中，sk1～skn为接收方R的私钥sk中全部的γ个分量中的n个分量，且有0≤n≤γ以使得检测密钥DSK相对接收方R的公钥pkFMD包含更加弱化的检测条件，以使得矿工采用模糊消息检测方法FMD基于检测密钥DSK执行检测事务生成的区块中包括真实的消息事务和假阳性的消息事务，←表示加密过程。5.根据权利要求4所述的基于区块链的匿名消息传递方法，其特征在于，步骤S103中检测密钥DSK的计算函数表达式为：DSK←GeneratedDSK，上式中，GeneratedDSK表示预设的加密算法，sk表示接收方R的私钥，p表示假阳性率，←表示加密过程，所述假阳性率的计算函数表达式为：p＝2-n,，上式中，p表示假阳性率，n为检测密钥DSK的分量数量，γ为接收方R的公钥和私钥中的分量数量。6.根据权利要求1所述的基于区块链的匿名消息传递方法，其特征在于，步骤S101中生成的请求事务包含消息事务的匹配条件，所述匹配条件包括检测范围和时间限制中的至少一种约束条件。7.根据权利要求1所述的基于区块链的匿名消息传递方法，其特征在于，步骤S102中基于请求事务生成的检测事务包括矿工的地址、请求事务的地址、检测密钥DSK、时间戳以及接收方R的签名。8.根据权利要求1所述的基于区块链的匿名消息传递方法，其特征在于，步骤S104中接收方R从矿工采用模糊消息检测方法FMD基于检测密钥DSK执行检测事务生成的区块中，区块头的内容分别包括前一个区块的哈希、检测事务、请求事务、矿工地址和时间戳，区块体中包含消息事务集合。9.一种基于区块链的匿名消息传递系统，包括相互连接的微处理器和存储器，其特征在于，所述微处理器被编程或配置以执行权利要求1～8中任意一项所述基于区块链的匿名消息传递方法。10.一种计算机可读存储介质，所述计算机可读存储介质中存储有计算机程序，其特征在于，所述计算机程序用于被微处理器编程或配置以执行权利要求1～8中任意一项所述基于区块链的匿名消息传递方法。
说明书desc
技术领域本发明属于区块链的信息安全技术领域，具体涉及一种基于区块链的匿名消息传递方法及系统。背景技术Web3作为新一代以用户为中心的网络架构，通过与如区块链等技术相结合，能够在之前网络架构的基础上，进一步获得与加强了去中心化、可验证性、开放性、可信赖性等特性。而作为Web3的重要通信基础设施之一，端到端通信已经得到了广泛的研究。其中，匿名消息传递技术，作为一种保护隐私的端到端通信方法，可以保护通信数据和用户元数据。在建立一个安全和零信任的Web3生态系统中，有望发挥重要作用。然而，目前大多数的匿名消息传递方案都需要依赖于一小部分可信任第三方。随着用户数量的增加，这些TTP面临着单点失效与性能瓶颈的问题，进而限制了匿名消息传递系统的可扩展性。更糟糕的是，这样的系统可以称之为受控于TTP而非用户，此种情况与Web3初衷相违背。而对于现存不需要TTP的方案，大多都需要用户对消息自行检索，这对于用户来说是一个很大的负担，限制了这些方案实际部署的可行性。针对上述问题，现有技术中提出了一种称为模糊消息检测方案。该方案允许接收方R生成一个专门的检测密钥，可以对具有一定假阳性率的消息进行识别。在此基础上，接收方R可以将检测工作外包给不可信的第三方，而不透露他的私人元数据，从而减少用户的负担。虽然这个方案已经不需要TTP，但是仍然需要一个中心化的第三方参与，这与Web3的去中心化思想违背。发明内容本发明要解决的技术问题：针对现有技术的上述问题，提供一种基于区块链的匿名消息传递方法及系统，本发明能够实现基于区块链的匿名消息传递，可将消息检测任务外包给去中心化的不可信第三方，具有用户开销小、安全可信、高吞吐量的优点。为了解决上述技术问题，本发明采用的技术方案为：一种基于区块链的匿名消息传递方法，包括：S101，接收方R针对区块链的消息事务交易池中的消息事务生成请求事务，并提交到区块链的请求事务交易池中；S102，接收方R等待矿工从链下通道返回的回应，在收到回应后跳转步骤S103；S103，接收方R根据收到的回应选择一个矿工，基于请求事务生成包含检测密钥DSK的检测事务，并提交到区块链的检测事务交易池中以下发给矿工；S104，接收方R从矿工采用模糊消息检测方法FMD基于检测密钥DSK执行检测事务生成的区块中获取由真实的消息事务和假阳性的消息事务构成的消息事务集合，从中提取出真实的消息事务，并从真实的消息事务中提取出发送方S所发送的明文消息。可选地，步骤S101之前还包括发送方S将需传递的明文消息使用接收方R的公钥加密为密文消息、提交存储服务方SSP获得地址标签，将地址标签加密打包为消息事务并提交到区块链的消息事务交易池。可选地，步骤S104中从真实的消息事务中提取出发送方S所发送的明文消息包括：S201，接收方R从真实的消息事务中提取出加密地址标签；S202，接收方R对加密地址标签进行解密得到原始的地址标签；S203，接收方R根据原始的地址标签从存储服务方SSP中获取密文消息；S204，接收方R将密文消息使用接收方R的私钥解密得到原始的明文消息。可选地，所述接收方R的公钥的函数表达式为：pkFMD＝，上式中，pkFMD为接收方R的公钥，pk1～pkγ为接收方R的公钥中全部的γ个分量；步骤S103中检测密钥DSK的函数表达式为：DSK←，上式中，sk1～skn为接收方R的私钥sk中全部的γ个分量中的n个分量，且有0≤n≤γ以使得检测密钥DSK相对接收方R的公钥pkFMD包含更加弱化的检测条件，以使得矿工采用模糊消息检测方法FMD基于检测密钥DSK执行检测事务生成的区块中包括真实的消息事务和假阳性的消息事务，←表示加密过程。可选地，步骤S103中检测密钥DSK的计算函数表达式为：DSK←GeneratedDSK，上式中，GeneratedDSK表示预设的加密算法，sk表示接收方R的私钥，p表示假阳性率，←表示加密过程，所述假阳性率的计算函数表达式为：p＝2-n，，上式中，p表示假阳性率，n为检测密钥DSK的分量数量，γ为接收方R的公钥和私钥中的分量数量。可选地，步骤S101中生成的请求事务包含消息事务的匹配条件，所述匹配条件包括检测范围和时间限制中的至少一种约束条件。可选地，步骤S102中基于请求事务生成的检测事务包括矿工的地址、请求事务的地址、检测密钥DSK、时间戳以及接收方R的签名。可选地，步骤S104中接收方R从矿工采用模糊消息检测方法FMD基于检测密钥DSK执行检测事务生成的区块中，区块头的内容分别包括前一个区块的哈希、检测事务、请求事务、矿工地址和时间戳，区块体中包含消息事务集合。此外，本发明还提供一种基于区块链的匿名消息传递系统，包括相互连接的微处理器和存储器，所述微处理器被编程或配置以执行所述基于区块链的匿名消息传递方法。此外，本发明还提供一种计算机可读存储介质，所述计算机可读存储介质中存储有计算机程序，所述计算机程序用于被微处理器编程或配置以执行所述基于区块链的匿名消息传递方法。与现有技术相比，本发明的主要优点在于：1、本发明接收方R从矿工采用模糊消息检测方法FMD基于检测密钥DSK执行检测事务生成的区块中获取由真实的消息事务和假阳性的消息事务构成的消息事务集合，通过使用模糊消息检测方案，可将接收方R检测消息的工作外包给不可信的第三方，第三方对假阳性消息无法区分，而接收方R可以将其在接收时进行识别并丢弃。在整个消息的加密、检测、验证过程中，无需可信第三方，可有效确保隐私安全，用户开销小。2、本发明通过区块链技术来进行密文消息和外包消息检测信息的传输，各用户还可以将事务信息如密文地址、检测消息时间限制等存储在区块链上，可充分利用区块链的优点，提高了透明度，具有安全、可信的优点。附图说明图1为本发明实施例方法的核心流程示意图。图2为本发明实施例中接收方R、矿工和区块链的交互流程示意图。图3为本发明实施例中系统结构示意图。图4为本发明实施例中区块链中的区块结构示意图。图5为本发明实施例仿真实验中不同检测任务与矿工数目下的检测时间图。图6为本发明实施例仿真实验中不同假阳性率与矿工数目下的检测时间图。图7为本发明实施例仿真实验中不同消息事务与矿工数目下的时间延迟图。具体实施方式如图1和图2所示，本实施例基于区块链的匿名消息传递方法包括：S101，接收方R针对区块链的消息事务交易池中的消息事务生成请求事务，并提交到区块链的请求事务交易池中；S102，接收方R等待矿工从链下通道返回的回应，在收到回应后跳转步骤S103；S103，接收方R根据收到的回应选择一个矿工，基于请求事务生成包含检测密钥DSK的检测事务，并提交到区块链的检测事务交易池中以下发给矿工；S104，接收方R从矿工采用模糊消息检测方法FMD基于检测密钥DSK执行检测事务生成的区块中获取由真实的消息事务和假阳性的消息事务构成的消息事务集合，从中提取出真实的消息事务，并从真实的消息事务中提取出发送方S所发送的明文消息。参见图3，本实施例基于区块链的匿名消息传递系统中，涉及的角色主要包括用户、矿工和存储服务方SSP，其中用户包括发送方S与接收方R，发送方S用于发送消息，接收方R用于接收消息，它们角色是针对同一个消息而言，针对不同的消息而言，它们的角色可能会是用户中的任意两者。存储服务方SSP包含多个存储节点，每个存储节点即为一个存储位置。存储服务方SSP使用IPFS协议，达到去中心化分布式存储。用户与矿工通过区块链的链上通道和链下通道进行通信，实现信息与数据的交互。不限于本实施例的区块链，本领域普通技术人员可以根据实际情况实现区块链的部署。此外，在部署区块链时，系统管理者初始化与部署区块链系统，设置好必要的参数，发送方与接收方在区块链中注册并拥有一对公钥与私钥以便于执行消息传递。参见图3，本实施例步骤S101之前还包括发送方S将需传递的明文消息使用接收方R的公钥加密为密文消息、提交存储服务方SSP获得地址标签，将地址标签加密打包为消息事务并提交到区块链的消息事务交易池。具体地，本实施例中提交存储服务方SSP获得地址标签是指提交存储服务方SSP的星际文件系统中获得地址标签。作为一种可选的实施方式，本实施例中发送方S将地址标签加密打包为消息事务时，还需要附加事务费用以作为消息传递的代价，但是这只是一种商业模式的实现方式，在实际应用时，可根据实际的商业模式的选择不附加事务费用。和一般的区块链通信类似，消息事务等事务，都可以根据需要附加事务提交者的签名以防止事务伪造。基于本技术方案所公开的内容，本领域普通技术人员能够理解，服务器、用户、矿工通过区块链实现数据的传输，如发布消息事务、发布请求事务、发布检测事务、真实消息混合假阳性消息、检索并验证消息等过程，包括通过区块链实现的安全传输，即用户与矿工通过区块链发布事务与创建区块的过程，包括矿工通过区块链的链下通道回应接收方，也包括矿工如何使用DSK与标志密文进行检验判断是否为接收方需要的消息的过程。本实施例中，步骤S104中从真实的消息事务中提取出发送方S所发送的明文消息包括：S201，接收方R从真实的消息事务中提取出加密地址标签；S202，接收方R对加密地址标签进行解密得到原始的地址标签；S203，接收方R根据原始的地址标签从存储服务方SSP中获取密文消息；S204，接收方R将密文消息使用接收方R的私钥解密得到原始的明文消息。本实施例中，接收方R的公钥的函数表达式为：pkFMD＝，上式中，pkFMD为接收方R的公钥，pk1～pkγ为接收方R的公钥中全部的γ个分量；具体地，在本实施例中使用基于标签的哈希加密算法，对将消息进行加密的公钥进行生成。为了达到除了预期的接收方之外，任何一方都不能知道哪个公钥用于加密消息的目的，也就是不泄露消息的接收方是谁，方案使用ElGamal公钥加密算法生成公钥与私钥，之后的步骤S2中发送方对需要加密的消息使用生成的公钥进行加密生成标志密文。通过选取合适的公钥加密算法，方案能够达到接收方匿名的目的。本实施例中，步骤S103中检测密钥DSK的函数表达式为：DSK←，上式中，sk1～skn为接收方R的私钥sk中全部的γ个分量中的n个分量，且有0≤n≤γ以使得检测密钥DSK相对接收方R的公钥pkFMD包含更加弱化的检测条件，以使得矿工采用模糊消息检测方法FMD基于检测密钥DSK执行检测事务生成的区块中包括真实的消息事务和假阳性的消息事务，←表示加密过程。本实施例中，步骤S103中检测密钥DSK的计算函数表达式为：DSK←GeneratedDSK，上式中，GeneratedDSK表示预设的加密算法，sk表示接收方R的私钥，p表示假阳性率，←表示加密过程，假阳性率的计算函数表达式为：p＝2-n，，上式中，p表示假阳性率，n为检测密钥DSK的分量数量，γ为接收方R的公钥和私钥中的分量数量。检测密钥DSK的分量数量以及接收方R的公钥和私钥中的分量数量，在实际使用过程中，可根据消息总数、用户数量和接收方的预期流量来确定。通过上述计算假阳性率p，可实现隐私和效率之间的权衡，若选取一个低的假阳性率p，接收方R所收到的密文列表也就越长，虽然带来的是高隐私性，但接收方R需要做的工作也就随着假阳性率提高而增加，此时选取一个合适的假阳性率p对于整个方案来说尤为重要。通过选取合适的假阳性率，可以保证用户能够通过区块链进行消息检测的高效性与高隐私性。本实施例中，步骤S101中生成的请求事务用于表明其希望接收消息，一般包含消息事务的匹配条件，所述匹配条件包括检测范围和时间限制中的至少一种约束条件。作为一种可选的实施方式，请求事务还需要附加事务费用以作为消息接收的代价，但是这只是一种商业模式的实现方式，在实际应用时，可根据实际的商业模式的选择不附加事务费用。请求事务可以视为外包任务，请求事务保存在区块链的请求事务池中。当矿工希望生成新区块以获利时，它会从其本地同步请求事务池中选择接收方的请求，并向该接收方发送回应。回应包含与请求事务相关联的矿工签名，并通过链外隐私通道发送给接收方。只要请求尚未被响应，矿工就可以重复去响应该请求。接收方R根据收到的回应选择一个矿工，基于请求事务生成包含检测密钥DSK的检测事务，并提交到区块链的检测事务交易池中以下发给矿工。本实施例中，步骤S102中基于请求事务生成的检测事务包括矿工的地址、请求事务的地址、检测密钥DSK、时间戳以及接收方R的签名。矿工是检测事务的执行者，当矿工从接收方接收到检测事务时，它使用DSK解密所有接收到的消息事务中的标志密文，以找到符合条件的消息。这些消息事务被打包到块体中，块体包含发送方发送的真实事务和假阳性事务。然后，矿工将一些数据打包到块头中，如前一个块的哈希、本区块的哈希、时间戳、对应的请求事务和检测事务的地址等，区块的完整结构如图4所示。参见图4可知，步骤S104中接收方R从矿工采用模糊消息检测方法FMD基于检测密钥DSK执行检测事务生成的区块中，区块头的内容分别包括前一个区块的哈希、检测事务、请求事务、矿工地址和时间戳，区块体中包含消息事务集合，其中包括真实的消息事务和假阳性的消息事务，但是由于是矿工采用现有的模糊消息检测方法FMD基于检测密钥DSK执行检测事务得到，所以其不能区分真实的消息事务和假阳性的消息事务。完成后，矿工将新区块广播到区块链，区块链节点在区块链中验证该区块。在本实施例中，区块链使用了一种新的共识机制，与工作量证明类似，但矿工不需要做无用的、浪费精力的散列操作，这意味着，当矿工从接收方接收到新的请求时，矿工需要遍历所有事务以找到收件人的相应消息。因为PoW中的数学谜题类似于此场景中的检测任务，它们都很难找到，但很容易验证。为了对本实施例方法进行验证，本文中采用了仿真实验进行验证，具体为基于Go语言的基准测试工具评估消息检测的性能，并使用Python模拟区块链中实体的交互过程。如图5所示，当有50名矿工时，本实施例方法需要约240秒来检索10000封邮件中的100位收件人的邮件，这比集中检测的单个服务器快约95％。这是因为以用户为中心的块结构允许矿工并行执行检测任务，而不会相互干扰。图6示出了本实施例方法检测所需的开销随着假阳性率的降低而逐渐增加。此外，图7中可以评估出消息事务数量对时间延迟的影响。以一个较为直观的条件如只有一个集中式服务器时，时间延迟随着事务数的增加而线性增长。在添加更多矿工的同时，这些检测任务可以并行处理，这大大减少了时间延迟。然而，随着矿工人数的增加，效率并没有显著提高。这是因为矿工的数量接近于请求的数量，这导致了矿工之间的竞争。当存在竞争时，效率不会随矿工人数线性增加。在本文的仿真实验中，使用与现有的模糊消息检测方法FMD中相同的剩余设置，测试了在三种误报率下检测消息的时间延迟。当假阳性率为12.5％时，检测时间为0.274ms。当假阳性率为3.125％时，检测时间为0.371ms。当假阳性率为0.098％时，检测时间为0.647ms。在本实施例方法的方案中，消息检测外包给了区块链，减少了用户的开销，避免了对集中式服务器的依赖。同时区块链的结构也得到了改，以适应新的共识机制，本实施例方法中所提出的共识机制使匿名消息传递系统能够并行处理检测任务，从而实现高吞吐量。综上所述，本实施例方法能够实现一种可以匿名传递消息的方法，并将消息检测任务外包给去中心化的不可信第三方的基于区块链的匿名消息传递方法，具有用户开销小、安全可信、高吞吐量的优点。此外，本实施例还提供一种基于区块链的匿名消息传递系统，包括相互连接的微处理器和存储器，该微处理器被编程或配置以执行前述基于区块链的匿名消息传递方法。此外，本实施例还提供一种计算机可读存储介质，该计算机可读存储介质中存储有计算机程序，该计算机程序用于被微处理器编程或配置以执行前述基于区块链的匿名消息传递方法。本领域内的技术人员应明白，本申请的实施例可提供为方法、系统、或计算机程序产品。因此，本申请可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本申请可采用在一个或多个其中包含有计算机可用程序代码的计算机可读存储介质上实施的计算机程序产品的形式。本申请是参照根据本申请实施例的方法、设备、和计算机程序产品的流程图和/或方框图来描述的。应理解可由计算机程序指令实现流程图和/或方框图中的每一流程和/或方框、以及流程图和/或方框图中的流程和/或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和/或方框图一个方框或多个方框中指定的功能的步骤。以上所述仅是本发明的优选实施方式，本发明的保护范围并不仅局限于上述实施例，凡属于本发明思路下的技术方案均属于本发明的保护范围。应当指出，对于本技术领域的普通技术人员来说，在不脱离本发明原理前提下的若干改进和润饰，这些改进和润饰也应视为本发明的保护范围。
