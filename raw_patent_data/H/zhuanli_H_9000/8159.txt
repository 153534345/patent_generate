标题title
一种鸿蒙系统接入互联装置
摘要abst
本发明公开了一种鸿蒙系统接入互联装置，包括标准软总线接入模块，所述标准软总线接入模块与标准鸿蒙系统软总线可通信相连；外设接入模块，所述外设接入模块与所述标准软总线接入模块可通信相连；所述外设接入模块包括外围设备接口。该装置形成了一种不同协议间与鸿蒙软总线数据转换中间件，可实现如I2C、SPI、有线以太网、UART、CAN等典型接口的数据转换为鸿蒙软总线数据，同时将支持鸿蒙系统软总线发现功能以及软总线数据通信功能、软总线数据转换为典型外设接口功能。将不支持鸿蒙系统、未适配鸿蒙系统的设备通过已有外设接口接入鸿蒙网络，实现万物互联，更好的支持鸿蒙系统生态建设。
权利要求书clms
1.一种鸿蒙系统接入互联装置，其特征在于，包括：标准软总线接入模块，所述标准软总线接入模块与标准鸿蒙系统软总线可通信相连；外设接入模块，所述外设接入模块与所述标准软总线接入模块可通信相连；所述外设接入模块包括外围设备接口，所述外围设备接口用于实现与待接入外围设备可通信相连，以使所述待接入外围设备与所述标准鸿蒙系统软总线形成通信通道；所述待接入外围设备包括不支持鸿蒙系统或未适配鸿蒙系统的外围设备；其中，所述外设接入模块用于对收到的数据进行适配性转换，以使所述待接入外围设备与所述标准鸿蒙系统软总线通过所述通信通道实现数据交互。2.根据权利要求1所述的鸿蒙系统接入互联装置，其特征在于，所述标准软总线接入模块包括可通信相连的软总线模块以及通信模块，所述软总线模块与所述外设接入模块可通信相连，所述通信模块与所述标准鸿蒙系统软总线可通信相连。3.根据权利要求2所述的鸿蒙系统接入互联装置，其特征在于，所述通信模块包括有线通信模块或无线通信模块。4.根据权利要求3所述的鸿蒙系统接入互联装置，其特征在于，所述无线通信模块包括无线保真WiFi模块、第二代、第三代、第四代或第五代移动通信模块。5.根据权利要求1所述的鸿蒙系统接入互联装置，其特征在于，所述外围设备接口包括多个，多个所述外围设备接口具有相同或不同的接口类型。6.根据权利要求5所述的鸿蒙系统接入互联装置，其特征在于，所述外围设备接口包括I2C外围设备接口、UART外围设备接口、有线网卡外围设备接口、SPI外围设备接口中的任意一种或几种。7.根据权利要求1所述的鸿蒙系统接入互联装置，其特征在于，所述外设接入模块包括外设数据转换模块、驱动适配层以及拨码开关；所述外设数据转换模块与所述标准软总线接入模块可通信相连；所述驱动适配层以及所述拨码开关均与所述外设数据转换模块可通信相连；所述外围设备接口与所述驱动适配层相连。8.根据权利要求7所述的鸿蒙系统接入互联装置，其特征在于，所述外设数据转换模块包括与所述外围设备接口对应的子转换模块，所述外设数据转换模块用于根据所述拨码开关配置转换数据并发送。9.根据权利要求7所述的鸿蒙系统接入互联装置，其特征在于，所述驱动适配层包括设备树配置文件、设备树文件解析模块以及驱动程序模块；所述设备树配置文件包括标准json文件用于配置待接入外围设备信息；所述设备树文件解析模块用于将所述设备树配置文件存储的设备信息解析后告知所述驱动程序模块。10.根据权利要求9所述的鸿蒙系统接入互联装置，其特征在于，所述拨码开关包括横/纵向拨码开关以及外设接入拨码开关；所述横/纵向拨码开关用于选择接收到数据后的发送方向，横向则广播发送到所述外围设备接口，纵向则发往标准鸿蒙系统软总线；所述外设接入拨码开关用于告知所述驱动程序模块所述待接入外围设备对应的外围设备接口。
说明书desc
技术领域本发明涉及接入转换技术领域，特别是涉及一种可将拥有典型外设接口的数据转换为鸿蒙软总线数据，使不支持鸿蒙系统、未适配鸿蒙系统的设备接入鸿蒙软总线系统的鸿蒙系统接入互联装置。背景技术随着国产化基础操作系统开源鸿蒙愈加成熟，各类物联网设备选择使用开源鸿蒙作为设备操作系统，为国产化系统的生态建设作出了巨大贡献。软总线作为鸿蒙系统分布式通信的基座，以其自动发现、自动组网、高带宽、低延迟等优点，已经成为设备万物互联的首选方案，良好的操作系统生态逐渐建立完善成熟。但是开源鸿蒙尚未应用之前，大量的不支持鸿蒙系统或未适配鸿蒙系统的物联网设备已经用于实网运行且无法升级或更换使用开源鸿蒙设备的成本高，工作量大，导致短时间内无法更换，使得这些设备无法接入开源鸿蒙的软总线拓扑，同时大多数的物联网设备属于轻量级设备，其主控芯片可使用的资源极少，即使是轻量级开源鸿蒙也面临移植难度高、消耗系统资源多甚至无法移植的情况，导致设备无法接入开源鸿蒙系统，同时也使开源鸿蒙失去了小型物联网设备群体，影响开源鸿蒙操作系统生态建设。因此，如何提供一种鸿蒙系统接入装置，将所有不支持鸿蒙系统、未适配鸿蒙系统的设备通过已有外设接口进行数据转换，接入鸿蒙网络，实现万物互联，更好的支持鸿蒙系统生态建设，是迫切需要本领域技术人员解决的技术问题。发明内容鉴于上述问题，本发明提供用于克服上述问题或者至少部分地解决上述问题的一种鸿蒙系统接入互联装置，可以将所有不支持鸿蒙系统、未适配鸿蒙系统的设备通过已有外设接口进行数据转换，接入鸿蒙网络，实现万物互联，更好的支持鸿蒙系统生态建设。本发明提供了如下方案：一种鸿蒙系统接入互联装置，包括：标准软总线接入模块，所述标准软总线接入模块与标准鸿蒙系统软总线可通信相连；外设接入模块，所述外设接入模块与所述标准软总线接入模块可通信相连；所述外设接入模块包括外围设备接口，所述外围设备接口用于实现与待接入外围设备可通信相连，以使所述待接入外围设备与所述标准鸿蒙系统软总线形成通信通道；所述待接入外围设备包括不支持鸿蒙系统或未适配鸿蒙系统的外围设备；其中，所述外设接入模块用于对收到的数据进行适配性转换，以使所述待接入外围设备与所述标准鸿蒙系统软总线通过所述通信通道实现数据交互。优选地：所述标准软总线接入模块包括可通信相连的软总线模块以及通信模块，所述软总线模块与所述外设接入模块可通信相连，所述通信模块与所述标准鸿蒙系统软总线可通信相连。优选地：所述通信模块包括有线通信模块或无线通信模块。优选地：所述无线通信模块包括无线保真WiFi模块、第二代、第三代、第四代或第五代移动通信模块。优选地：所述外围设备接口包括多个，多个所述外围设备接口具有相同或不同的接口类型。优选地：所述外围设备接口包括I2C外围设备接口、UART外围设备接口、有线网卡外围设备接口、SPI外围设备接口中的任意一种或几种。优选地：所述外设接入模块包括外设数据转换模块、驱动适配层以及拨码开关；所述外设数据转换模块与所述标准软总线接入模块可通信相连；所述驱动适配层以及所述拨码开关均与所述外设数据转换模块可通信相连；所述外围设备接口与所述驱动适配层相连。优选地：所述外设数据转换模块包括与所述外围设备接口对应的子转换模块，所述外设数据转换模块用于根据所述拨码开关配置转换数据并发送。优选地：所述驱动适配层包括设备树配置文件、设备树文件解析模块以及驱动程序模块；所述设备树配置文件包括标准json文件用于配置待接入外围设备信息；所述设备树文件解析模块用于将所述设备树配置文件存储的设备信息解析后告知所述驱动程序模块。优选地：所述拨码开关包括横/纵向拨码开关以及外设接入拨码开关；所述横/纵向拨码开关用于选择接收到数据后的发送方向，横向则广播发送到所述外围设备接口，纵向则发往标准鸿蒙系统软总线；所述外设接入拨码开关用于告知所述驱动程序模块所述待接入外围设备对应的外围设备接口。根据本发明提供的具体实施例，本发明公开了以下技术效果：本申请实施例提供的一种鸿蒙系统接入互联装置，形成了一种不同协议间与鸿蒙软总线数据转换中间件，可实现如I2C、SPI、有线以太网、UART、CAN等典型接口的数据转换为鸿蒙软总线数据，同时将支持鸿蒙系统软总线发现功能以及软总线数据通信功能、软总线数据转换为典型外设接口功能。将不支持鸿蒙系统、未适配鸿蒙系统的设备通过已有外设接口接入鸿蒙网络，实现万物互联，更好的支持鸿蒙系统生态建设。另外，在优选的实施方式下，还可以形成不同协议间转换中间件，实现如I2C、SPI、有线以太网、UART、CAN等典型接口的数据转换为其它类型接口数据的功能，实现不同协议接口间的数据交换，可广泛应用于接口功能、性能测试。当然，实施本发明的任一产品并不一定需要同时达到以上所述的所有优点。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例中所需要使用的附图作简单地介绍。显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来说，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明实施例提供的一种鸿蒙系统接入互联装置的结构示意图;图2a是本发明实施例提供的一种鸿蒙系统接入互联装置的工作流程图的第一部分;图2b是本发明实施例提供的一种鸿蒙系统接入互联装置的工作流程图的第二部分;图2c是本发明实施例提供的一种鸿蒙系统接入互联装置的工作流程图的第三部分;图3是本发明实施例提供的多个不同接口类型设备通过同一接入装置接入鸿蒙系统示意图;图4是本发明实施例提供的多个不同接口类型设备各自通过接入装置接入鸿蒙系统示意图;图5是本发明实施例提供的多个不同接口类型设备进行数据交换示意图。图中：接入互联装置100、标准软总线接入模块1、软总线模块11、通信模块12、外设接入模块2、外围设备接口21、I2C外围设备接口21a、UART外围设备接口21b、有线网卡外围设备接口21c、SPI外围设备接口21d、外设数据转换模块22、子转换模块221、I2C转换模块221a、UART转换模块221b、有线网卡转换模块221c、SPI转换模块221d、驱动适配层23、设备树配置文件231、设备树文件解析模块232、驱动程序模块233、横/纵向拨码开关24a、外设接入拨码开关24b、标准鸿蒙系统软总线3、外围设备4A、外围设备4B、外围设备4C、外围设备4D、鸿蒙操作终端5。实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述。显然，所描述的实施例仅仅是本发明的一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员所获得的所有其他实施例，都属于本发明保护的范围。参见图1，为本发明实施例提供的一种鸿蒙系统接入互联装置100，如图1所示，该装置可以包括：标准软总线接入模块1，所述标准软总线接入模块1与标准鸿蒙系统软总线3可通信相连；外设接入模块2，所述外设接入模块2与所述标准软总线接入模块1可通信相连；所述外设接入模块2包括外围设备接口21，所述外围设备接口21用于实现与待接入外围设备可通信相连，以使所述待接入外围设备与所述标准鸿蒙系统软总线形成通信通道；所述待接入外围设备包括不支持鸿蒙系统或未适配鸿蒙系统的外围设备；其中，所述外设接入模块2用于对收到的数据进行适配性转换，以使所述待接入外围设备与所述标准鸿蒙系统软总线3通过所述通信通道实现数据交互。本申请实施例提供的鸿蒙系统接入互联装置，通过提供的标准软总线接入模块以及外设接入模块，可以建立不支持鸿蒙系统或未适配鸿蒙系统的外围设备与标准鸿蒙系统软总线之间的通信通道，通过外设接入模块可以对收到的数据进行适配性转换，使得通过标准外设接口输入的外围设备的外设数据与标准鸿蒙系统总线所需数据形式适配，或者使得标准鸿蒙系统软总线输入的鸿蒙系统数据与外围设备所需数据形式适配，从而达到待接入外围设备与标准鸿蒙系统软总线数据交互的目的。本申请实施例提供的标准鸿蒙系统软总线用于实现与基于鸿蒙系统的鸿蒙操作终端相连。本申请实施例提供的标准软总线接入模块的作用是，提供接入标准鸿蒙系统软总线的能力。具体的，本申请实施例可以提供所述标准软总线接入模块1包括可通信相连的软总线模块11以及通信模块12，所述软总线模块11与所述外设接入模块2可通信相连，所述通信模块12与所述标准鸿蒙系统软总线3可通信相连。其中软总线模块负责提供设备发现、设备组网、设备通信的能力给转换模块使用，同时将转换模块从其他外设接收到的数据通过通信模块发送到软总线对端设备。通信模块为转换模块的上联端口，将转换模块通过相应的通信方式接入标准鸿蒙软总线。进一步的，所述通信模块12包括有线通信模块或无线通信模块。具体的，所述无线通信模块包括无线保真WiFi模块、第二代、第三代、第四代或第五代移动通信模块。为了可以实现同时将多个外围设备接入标准鸿蒙系统软总线，或者实现具有不同的接口类型的外围设备接入标准鸿蒙系统软总线。本申请实施例可以提供所述外围设备接口21包括多个，多个所述外围设备接口21具有相同或不同的接口类型。进一步的，所述外围设备接口21包括I2C外围设备接口21a、UART外围设备接口21b、有线网卡外围设备接口21c、SPI外围设备接口21d中的任意一种或几种。在实际应用中，如图3所示，多个不同接口类型的外围设备可以通过本申请实施例提供的同一接入互联装置接入基于鸿蒙系统的鸿蒙操作终端。如图4所示，多个不同接口类型的外围设备可以各自通过本申请实施例提供的一个接入互联装置接入基于鸿蒙系统的鸿蒙操作终端。如图5所示，多个不同接口类型的外围设备还可以通过本申请实施例提供的装置进行数据交换。本申请实施例提供的外设接入模块用于实现外围设备的接入，以及数据形式的转换。具体的，本申请实施例可以提供所述外设接入模块2包括外设数据转换模块22、驱动适配层23以及拨码开关；所述外设数据转换模块22与所述标准软总线接入模块1可通信相连；所述驱动适配层23以及所述拨码开关均与所述外设数据转换模块22可通信相连；所述外围设备接口21与所述驱动适配层23相连。进一步的，所述外设数据转换模块包括与所述外围设备接口对应的子转换模块221，所述外设数据转换模块用于根据所述拨码开关配置转换数据并发送。各个子转换模块可以与接口类型相对应，例如，可以设置I2C转换模块221a、UART转换模块221b、有线网卡转换模块221c、SPI转换模块221d。所述驱动适配层23包括设备树配置文件231、设备树文件解析模块232以及驱动程序模块233；所述设备树配置文件231包括标准json文件用于配置待接入外围设备信息；所述设备树文件解析模块232用于将所述设备树配置文件存储的设备信息解析后告知所述驱动程序模块233。所述拨码开关包括横/纵向拨码开关24a以及外设接入拨码开关24b；所述横/纵向拨码开关24a用于选择接收到数据后的发送方向，横向则广播发送到所述外围设备接口，纵向则发往标准鸿蒙系统软总线；所述外设接入拨码开关24b用于告知所述驱动程序模块233所述待接入外围设备对应的外围设备接口21。本申请实施例提供的外设接入模块由外设数据转换模块22、驱动适配层23、拨码开关组成。外围设备接口21为数据接入装置的下联端口，丰富的接口类型为各类型设备提供了接入鸿蒙系统的可能性，也可实现多种协议的设备数据交换。驱动适配层由各外设驱动程序模块233，设备树配置文件231以及设备树文件解析模块232构成，外设驱动模块负责CPU和各外设设备通讯，包括外设设备初始化，发送数据，接收数据，中断挂接等子模块。设备树配置文件由标准json文件担当，负责配置外设设备信息，如外设基地址，从机地址等。设备树文件解析模块负责将设备树配置文件存储的设备信息解析后告知驱动程序模块。拨码开关由横/纵向拨码开关24a以及外设接入拨码开关24b组成，横/纵向拨码开关24a负责选择从外设接收到数据后的发送方向，横向则广播发送到所有接入外部设备的外设接口，纵向则发往软总线系统。外设接入拨码开关24b负责告知驱动程序哪些外设接口有外部设备接入。外设数据转换模块负责根据拨码开关配置转换数据并发送，如拨码到纵向开关则将来自软总线的数据转换后发送到驱动适配层，发送从驱动适配层接收到的数据到软总线系统。若拨码到横向开关，则广播发送数据到所有其他有外部设备接入的外设接口。如下图2a、图2b、图2c所示为数据接入装置的工作流程:步骤1:读取并解析设备树配置文件，按照设备树配置文件信息初始化外设以及外设所接外部设备。步骤2:读取外设接入拨码开关配置并存入全局变量，读取横/纵向拨码开关配置并存入全局变量，探测横/纵向信息，若为横向，则执行分支1，若为纵向，则执行分支2。分支1:步骤A:创建数据广播发送模块，该模块可向除数据接收口以外的所有外设接口发送数据。步骤B:根据外设接入配置信息为各外设接口均创建数据接收线程，数据发送队列以及数据发送线程。创建成功后同时执行分支1-1数据发送和分支1-2数据接收。分支1-1:步骤1:阻塞等待信号量，判断信号量是否大于0，若信号量大于0则执行步骤2，若等于0，则继续执行步骤1。步骤2:探测数据发送队列是否为空，若为空，则跳转至步骤1继续执行，若队列不为空，则执行步骤3。步骤3:取出队列头数据，将其广播发送到除接收端口以外的所有接口后，跳转至步骤1。分支1-2:步骤1:阻塞等待接收数据，若接收到数据则执行步骤2，若未接收到数据，则继续执行步骤1。步骤2:序列化接收到的数据，并将其推入数据发送队列。步骤3：向本外设发送线程发送信号量，通知其发送数据后，跳转至步骤1。分支2:步骤A:根据外设接入拨码开关配置，为每个使能外设创建运行线程并进入线程为每个使能外设发布软总线服务。步骤B:阻塞等待被其他鸿蒙设备发现，若检测到首次被发现，则创建软总线会话服务用于和其他鸿蒙设备通信。步骤C:创建外设数据接收线程，创建成功后同时执行分支2-1软总线接收和分支2-2外设数据接收。分支2-1:步骤1:软总线阻塞等待接收数据，若接收到数据则执行步骤2，若未接收到数据，则继续执行步骤1。步骤2:提取数据段，并将发送到对应外设接口后，跳转至步骤1。分支2-2:步骤1:外设阻塞等待接收数据，若接收到数据则执行步骤2，若未接收到数据，则继续执行步骤1。步骤2:提取数据段，并将发送到软总线接口后，跳转至步骤1。本申请实施例提供的鸿蒙系统接入互联装置，形成了一种不同协议间与鸿蒙软总线数据转换中间件，可实现如I2C、SPI、有线以太网、UART、CAN等典型接口的数据转换为鸿蒙软总线数据，同时将支持鸿蒙系统软总线发现功能以及软总线数据通信功能、软总线数据转换为典型外设接口功能。将不支持鸿蒙系统、未适配鸿蒙系统的设备通过已有外设接口接入鸿蒙网络，实现万物互联，更好的支持鸿蒙系统生态建设。还可以形成不同协议间转换中间件，实现如I2C、SPI、有线以太网、UART、CAN等典型接口的数据转换为其它类型接口数据的功能，实现不同协议接口间的数据交换，可广泛应用于接口功能、性能测试。需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括所述要素的过程、方法、物品或者设备中还存在另外的相同要素。通过以上的实施方式的描述可知，本领域的技术人员可以清楚地了解到本申请可借助软件加上必需的通用硬件平台的方式来实现。基于这样的理解，本申请的技术方案本质上或者说对现有技术做出贡献的部分可以以软件产品的形式体现出来，该计算机软件产品可以存储在存储介质中，如ROM/RAM、磁碟、光盘等，包括若干指令用以使得一台计算机设备执行本申请各个实施例或者实施例的某些部分所述的方法。本说明书中的各个实施例均采用递进的方式描述，各个实施例之间相同相似的部分互相参见即可，每个实施例重点说明的都是与其他实施例的不同之处。尤其，对于系统或系统实施例而言，由于其基本相似于方法实施例，所以描述得比较简单，相关之处参见方法实施例的部分说明即可。以上所描述的系统及系统实施例仅仅是示意性的，其中所述作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部模块来实现本实施例方案的目的。本领域普通技术人员在不付出创造性劳动的情况下，即可以理解并实施。以上所述仅为本发明的较佳实施例而已，并非用于限定本发明的保护范围。凡在本发明的精神和原则之内所作的任何修改、等同替换、改进等，均包含在本发明的保护范围内。
