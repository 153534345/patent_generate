标题title
使用非矩形融合模式协调加权预测的方法和装置
摘要abst
提供了一种译码方法，包括：获得当前图像的码流；根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是否存在于所述码流的图像头或条带头中；当所述第一指示符的值等于第一预设值，且所述第二指示符的值等于第二预设值时，从所述码流中解析所述当前图像的当前条带的当前块的加权预测参数的值，其中，所述第一预设值为整数值，所述第二预设值为整数值；根据所述加权预测参数的值预测所述当前块。
权利要求书clms
1.一种由解码设备实现的译码方法，其特征在于，所述方法包括：获得当前图像的码流；根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于图像头中还是存在于条带头中；当所述第一指示符的值等于第一预设值，且所述第二指示符的值等于第二预设值时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值；根据所述加权预测参数的值预测所述当前块。2.根据权利要求1所述的方法，其特征在于，所述第一指示符的值是根据所述码流中包括的图像头获得的，或者，所述第二指示符的值是根据所述码流中包括的图像参数集获得的，或者，所述加权预测参数的值从所述码流中包括的图像头解析出。3.根据权利要求1或2所述的方法，其特征在于，所述第一预设值为1，所述第二预设值为1。4.根据权利要求1至3中任一项所述的方法，其特征在于，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带。5.根据权利要求4所述的方法，其特征在于，所述帧间条带包括B条带或P条带。6.一种由解码设备实现的译码方法，其特征在于，所述方法包括：获得当前图像的码流；根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于图像头中还是存在于条带头中；根据所述码流获得所述当前图像的第三指示符的值，其中，所述第三指示符指示加权预测是否适用于帧间条带，所述帧间条带的条带类型为B条带或P条带；当所述第一指示符的值等于第一预设值，所述第二指示符的值等于第二预设值，且所述第三指示符的值指示加权预测适用于所述帧间条带时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值；根据所述加权预测参数的值预测所述当前块。7.根据权利要求6所述的方法，其特征在于，所述第一指示符的值是根据所述码流中包括的图像头获得的，或者，所述第二指示符的值是根据所述码流中包括的图像参数集获得的，或者，所述加权预测参数的值是根据所述码流中包括的图像头获得的，或者，所述第三指示符的值是根据所述码流中包括的图像参数集获得的。8.根据权利要求6或7所述的方法，其特征在于，所述第一预设值为1，所述第二预设值为1。9.根据权利要求6至8中任一项所述的方法，其特征在于，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带。10.根据权利要求6至9中任一项所述的方法，其特征在于，所述第三指示符的值为1，表示加权预测适用于所述帧间条带。11.一种解码器，其特征在于，包括处理电路，用于执行根据权利要求1至10中任一项所述的方法。12.一种计算机程序产品，其特征在于，所述计算机程序产品包括程序代码，当所述程序代码由计算机或处理器执行时，用于执行根据权利要求1至10中任一项所述的方法。13.一种解码器，其特征在于，包括：一个或多个处理器；非瞬时性计算机可读存储介质，其中，所述非瞬时性计算机可读存储介质与所述处理器耦合并存储由所述处理器执行的程序，当所述程序由所述处理器执行时，使得所述解码器执行根据权利要求1至10中任一项所述的方法。14.一种非瞬时性计算机可读介质，其特征在于，所述非瞬时性计算机可读介质携带程序代码，当所述程序代码由计算机设备执行时，使得所述计算机设备执行根据权利要求1至10中任一项所述的方法。15.一种解码设备，其特征在于，包括：码流获得单元，用于获得当前图像的码流；指示符值获得单元，用于：根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中；解析单元，用于：当所述第一指示符的值等于第一预设值，且所述第二指示符的值等于第二预设值时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值；预测单元，用于根据所述加权预测参数的值预测所述当前块。16.根据权利要求15所述的解码设备，其特征在于，所述指示符值获得单元用于根据所述码流中包括的图像头获得所述第一指示符的值，或者根据所述码流中包括的图像参数集获得所述第二指示符的值；或者所述解析单元用于从所述码流中包括的图像头解析所述加权预测参数的值。17.根据权利要求15或16所述的解码设备，其特征在于，所述第一预设值为1，所述第二预设值为1。18.根据权利要求15至17中任一项所述的解码设备，其特征在于，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带。19.根据权利要求18所述的解码设备，其特征在于，所述帧间条带包括B条带或P条带。20.一种解码设备，其特征在于，包括：码流获得单元，用于获得当前图像的码流；指示符值获得单元，用于：根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中；根据所述码流获得所述当前图像的第三指示符的值，其中，所述第三指示符指示加权预测是否适用于帧间条带，所述帧间条带的条带类型为B条带或P条带；解析单元，用于：当所述第一指示符的值等于第一预设值，所述第二指示符的值等于第二预设值，且所述第三指示符的值指示加权预测适用于所述帧间条带时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值；预测单元，用于根据所述加权预测参数的值预测所述当前块。21.根据权利要求20所述的解码设备，其特征在于，所述指示符值获得单元用于根据所述码流中包括的图像头获得所述第一指示符的值，或者根据所述码流中包括的图像参数集获得所述第二指示符的值，或者根据所述码流中包括的图像参数集获得所述第三指示符的值；或者所述解析单元用于从所述码流中包括的图像头解析所述加权预测参数。22.根据权利要求20或21所述的解码设备，其特征在于，所述第一预设值为1，所述第二预设值为1。23.根据权利要求20至22中任一项所述的解码设备，其特征在于，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带。24.根据权利要求20至23中任一项所述的解码设备，其特征在于，所述第三指示符的值为1，表示加权预测适用于所述帧间条带。25.一种非瞬时性存储介质，其特征在于，所述非瞬时性存储介质包括由图像解码设备进行解码或待解码的经编码码流，所述码流是通过将视频信号或图像信号的帧划分为多个块生成的，所述码流包括用于当前图像的第一指示符和用于所述当前图像的第二指示符，其中，所述第一指示符指示所述当前图像的条带的条带类型，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中。26.根据权利要求25所述的非瞬时性存储介质，其特征在于，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带。27.根据权利要求25所述的非瞬时性存储介质，其特征在于，所述帧间条带包括B条带或P条带。28.一种非瞬时性存储介质，其特征在于，所述非瞬时性存储介质包括由图像解码设备进行解码或待解码的经编码码流，所述码流是通过将视频信号或图像信号的帧划分为多个块生成的，并且所述码流包括用于当前图像的第一指示符，用于所述当前图像的第二指示符，以及用于所述当前图像的第三指示符，其中，所述第一指示符指示所述当前图像的条带的条带类型，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中，所述第三指示符指示加权预测是否适用于帧间条带，所述帧间条带的条带类型为B条带或P条带。29.根据权利要求28所述的非瞬时性存储介质，其特征在于，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带。30.根据权利要求28所述的非瞬时性存储介质，其特征在于，所述第三指示符的值为1，表示加权预测适用于所述帧间条带。
说明书desc
本申请是分案申请，原申请的申请号是202180008825.6，原申请日是2021年01月12日，原申请的全部内容通过引用结合在本申请中。相关申请交叉引用本专利申请要求于2020年1月12日提交的US62/960,134的优先权。上述专利申请的全部公开内容通过引用结合在本申请中。技术领域本申请实施例大体上涉及运动图像处理领域，更具体地涉及非矩形分割模式与加权预测组合用于译码淡变类型时的非矩形分割模式。背景技术视频译码广泛用于数字视频应用，例如广播数字电视、基于互联网和移动网络的视频传输、视频聊天、视频会议等实时会话应用、DVD和蓝光光盘、视频内容采集和编辑系统以及安全应用的可携式摄像机。即使是相对较短的视频，也需要大量的视频数据来描述，这可能会导致数据在带宽容量受限的通信网络中进行流式传输或以其它方式传输时遇到困难。因此，视频数据通常需要先进行压缩，然后通过现代电信网络进行传输。由于内存资源可能有限，在存储设备中存储视频时，该视频的大小也可能是一个问题。视频压缩设备通常在源侧使用软件和/或硬件对该视频数据进行译码，然后进行传输或存储，从而减少用于表示数字视频图像所需的数据量。然后，对视频数据进行解码的视频解压缩设备在目的地侧接收压缩后的数据。在网络资源有限以及对更高视频质量的需求不断增长的情况下，需要改进压缩和解压缩技术，从而能够在几乎不影响图像质量的情况下提高压缩比。特别地，对显示亮度变化的图像进行译码时，加权预测可以有利于进行帧间预测的上下文的运动补偿。非矩形分割例如三角分割/融合模式和几何运动/融合分割等可以用于以可能优于仅限于基于矩形分割的帧间预测的方式处理各种类型的运动。然而，对于支持加权预测和非矩形分割的编解码器，需要进行一些协调。发明内容实施例提供了用于对包括加权预测参数的视频序列进行译码的多种方法，其中，所述加权预测参数是由淡变加权参数和混合加权参数组合得到的。淡变加权参数的值是根据参考索引值和参考图像列表确定的，而混合加权参数是根据预测样本在预测块中的位置确定的。上述目的及其它目的通过独立权利要求请求保护的主题来实现。其它相互组合的实现方式在从属权利要求、说明书和附图中是显而易见的。第一方面，提供了一种译码方法，其中，所述方法由解码设备实现，并且包括以下步骤：获得当前图像的码流；根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中；当所述第一指示符的值等于第一预设值，且所述第二指示符的值等于第二预设值时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值；根据所述加权预测参数的值预测所述当前块。这样，根据对整个当前图像有效的第二指示符的值，可以使用针对所述第一指示符的值所指示的特定条带类型解析出的加权预测参数的值，在所述第二指示符指示加权预测参数存在于所述图像头中时，通过加权预测来确定是否对当前条带的当前块执行帧间预测。在较高层级即在图像头层级进行的指示允许明确地决定是否将加权预测用于所述当前图像的条带的块。如果使用加权预测，则可能不允许进行任何非矩形分割。在一种实现方式中，所述第一指示符的值是根据所述码流中包括的图像头获得的。在另一种实现方式中，所述第二指示符的值是根据所述码流中包括的图像参数集获得的。在又一种实现方式中，所述加权预测参数的值从所述码流中包括的图像头解析出。这样，所有在考虑中的相关值均可以通过较高层级的指示获得。因此，可以高效地指示加权帧间预测的使用。在一种实现方式中，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带，例如，包括或者为B条带或P条带。第二方面，提供了一种译码方法，其中，所述方法由解码设备实现，并且包括以下步骤：获得当前图像的码流；根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中；根据所述码流获得所述当前图像的第三指示符的值，其中，所述第三指示符指示加权预测是否适用于帧间条带，所述帧间条带的条带类型为B条带或P条带；当所述第一指示符的值等于第一预设值，所述第二指示符的值等于第二预设值，且所述第三指示符的值指示加权预测适用于所述帧间条带时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值；根据所述加权预测参数的值预测所述当前块。根据第二方面所述的方法，在多种替代的实现方式中，所述第一指示符的值是根据所述码流中包括的图像头获得的，或者，所述第二指示符的值是根据所述码流中包括的图像参数集获得的，或者，所述加权预测参数的值是根据所述码流中包括的图像头获得的，或者，所述第三指示符的值是根据所述码流中包括的图像参数集获得的。根据第二方面所述的方法，在一种实现方式中，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带，例如，包括或者为B条带或P条带。根据第二方面所述的方法，在一种实现方式中，所述第三指示符的值为1，表示加权预测适用于所述帧间条带。第二方面所述的方法以及其实现方式实现了与第一方面所述的方法及其实现方式相似或相同的优势。此外，提供了一种解码器，其中，所述解码器包括处理电路，用于执行根据上述实施例中的任一实施例所述的方法；还提供了一种计算机程序产品，其中，所述计算机程序产品包括程序代码，当所述计算机程序产品由计算机或处理器执行时，用于执行根据上述实施例中的任一实施例所述的方法。此外，提供了一种解码器，其中，所述解码器包括：一个或多个处理器；非瞬时性计算机可读存储介质，其中，所述非瞬时性计算机可读存储介质与所述处理器耦合并存储由所述处理器执行的程序，当所述程序由所述处理器执行时，使得所述解码器执行根据上述实施例中的任一实施例所述的方法；还提供了一种非瞬时性计算机可读介质，其中，非瞬时性计算机可读介质携带程序代码，当所述程序代码由计算机设备执行时，使得所述计算机设备执行上述实施例中的任一实施例所述的方法。此外，另一方面，提供了一种非瞬时性存储介质，其中，所述非瞬时性存储介质包括通过上述实施例中任一实施例所述的方法进行译码的码流。另一方面，提供了一种用于视频信号的经编码码流，其中，所述码流包括用于当前图像的第一指示符和用于所述当前图像的第二指示符，其中，第一指示符指示条带类型，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中。具体地，当所述第二指示符的值等于第二预设值时，所述码流还包括当前块的加权预测参数，其中，所述当前块包含在所述当前图像的当前条带中，所述第二预设值为整数值。在一种实现方式中，所述第一指示符包含在图像头中，和/或所述第二指示符包含在图像参数集中，和/或所述加权预测参数包含在所述码流中包括的图像头中。在一种实现方式中，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带，例如，包括或者为B条带或P条带。另一方面，提供了一种用于视频信号的经编码码流，其中，所述码流包括用于当前图像的第一指示符，用于所述当前图像的第二指示符，以及用于所述当前图像的第三指示符，所述第一指示符指示条带类型，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中，所述第三指示符指示加权预测是否适用于帧间条带，所述帧间条带的条带类型为B条带或P条带。具体地，当所述第二指示符的值等于第二预设值时，所述码流还包括加权预测参数，其中，所述当前块包含在所述当前图像的当前条带中，所述第二预设值为整数值。在多种替代的实现方式中，所述第一指示符包含在图像头中，和/或所述第二指示符包含在图像参数集中，和/或所述加权预测参数包含在图像头中，和/或所述第三指示符包含在所述码流中包括的图像参数集中。在一种实现方式中，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带，例如，包括或者为B条带或P条带；和/或所述第三指示符的值为1，表示加权预测适用于所述帧间条带。此外，另一方面，提供了一种非瞬时性存储介质，其中，所述非瞬时性存储介质包括由图像解码设备进行解码的经编码码流，所述码流是通过将视频信号或图像信号的帧划分为多个块生成的，并且所述码流包括用于当前图像的第一指示符和用于所述当前图像的第二指示符，其中，所述第一指示符指示条带类型，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中。具体地，当所述第二指示符的值等于第二预设值时，所述码流还包括当前块的加权预测参数，其中，所述当前块包含在所述当前图像的当前条带中，所述第二预设值为整数值。在一种实现方式中，所述第一指示符包含在图像头中，和/或所述第二指示符包含在图像参数集中，和/或所述加权预测参数包含在所述码流中包括的图像头中。在一种实现方式中，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带，例如，包括或者为B条带或P条带。此外，另一方面，提供了一种非瞬时性存储介质，其中，所述非瞬时性存储介质包括由图像解码设备进行解码的经编码码流，所述码流是通过将视频信号或图像信号的帧划分为多个块生成的，并且所述码流包括用于当前图像的第一指示符，用于所述当前图像的第二指示符，以及用于所述当前图像的第三指示符，其中，所述第一指示符指示条带类型，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中，所述第三指示符指示加权预测是否适用于帧间条带，所述帧间条带的条带类型为B条带或P条带。具体地，当所述第二指示符的值等于第二预设值时，所述码流还包括加权预测参数，其中，所述当前块包含在所述当前图像的当前条带中，所述第二预设值为整数值。在多种替代的实现方式中，所述第一指示符包含在图像头中，和/或所述第二指示符包含在图像参数集中，和/或所述加权预测参数包含在图像头中，和/或所述第三指示符包含在所述码流中包括的图像参数集中。在一种实现方式中，所述第一指示符的值等于所述第一预设值，表示所述当前图像中包括的至少一个条带的条带类型为帧间条带，例如，包括或者为B条带或P条带；和/或所述第三指示符的值为1，表示加权预测适用于所述帧间条带。所有上述方法都可以由下面描述的解码设备实现，并且这些设备可以用于执行上述相应方法中的流程步骤，并实现上文阐明的相同优势。提供了以下设备：一种解码设备，其中，所述解码设备包括：码流获得单元，用于获得当前图像的码流；指示符值获得单元，用于：根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中；解析单元，用于：当所述第一指示符的值等于第一预设值，且所述第二指示符的值等于第二预设值时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值；预测单元，用于根据所述加权预测参数的值预测所述当前块。在该解码设备中，所述指示符值获得单元可以用于根据所述码流中包括的图像头获得所述第一指示符的值，或者根据所述码流中包括的图像参数集获得所述第二指示符的值；或者，所述解析单元可以用于从所述码流中包括的图像头解析所述加权预测参数的值。所述第一指示符的值等于所述第一预设值，可以表示所述当前图像中包括的至少一个条带的条带类型为帧间条带，例如，包括或者为B条带或P条带。此外，提供了一种解码设备，其中，所述解码设备包括：码流获得单元，用于获得当前图像的码流；指示符值获得单元，用于：根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中；根据所述码流获得所述当前图像的第三指示符的值，其中，所述第三指示符指示加权预测是否适用于帧间条带，所述帧间条带的条带类型为B条带或P条带；解析单元，用于：当所述第一指示符的值等于第一预设值，所述第二指示符的值等于第二预设值，且所述第三指示符的值指示加权预测适用于所述帧间条带时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值；预测单元，用于根据所述加权预测参数的值预测所述当前块。在该解码设备中，所述指示符值获得单元可以用于根据所述码流中包括的图像头获得所述第一指示符的值，或者根据所述码流中包括的图像参数集获得所述第二指示符的值，或者根据所述码流中包括的图像参数集获得所述第三指示符的值；或者所述解析单元可以用于从所述码流中包括的图像头解析所述加权预测参数。同样，所述第一指示符的值等于所述第一预设值，可以表示所述当前图像中包括的至少一个条带的条带类型为帧间条带，例如，包括或者为B条带或P条带。所述第三指示符的值为1，可以表示加权预测适用于所述帧间条带。以下附图及说明书将详细阐述一个或多个实施例。其它特征、目的和优点在说明书、附图和权利要求书中是显而易见的。附图说明下面结合附图对本发明实施例进行更加详细地描述。图1A为用于实现本发明实施例的视频译码系统的一个示例的框图；图1B为用于实现本发明实施例的视频译码系统的另一个示例的框图；图2为用于实现本发明实施例的视频编码器的一个示例的框图；图3为用于实现本发明实施例的视频解码器的一个示例性结构的框图；图4为编码装置或解码装置的一个示例的框图；图5为编码装置或解码装置的另一个示例的框图；图6为加权预测编码器端决策制定和参数估计的流程图；图7示出了三角预测模式的一个示例；图8示出了几何预测模式的一个示例；图9示出了几何预测模式的另一个示例；图10为实现内容分发服务的内容提供系统3100的一种示例性结构的框图；图11为终端设备的一种示例性结构的框图；图12为本申请提供的一种帧间预测方法的一个示例的框图；图13为本申请提供的一种帧间预测装置的一个示例的框图；图14为本申请提供的一种帧间预测装置的另一个示例的框图；图15为本发明实施例提供的一种译码方法的流程图；图16a和图16b为另一个实施例提供的一种译码方法的流程图；图17示出了一个实施例提供的一种解码设备。在下文中，如果没有另外明确说明，相同的附图标记将指代相同特征或至少在功能上等效的特征。具体实施方式以下描述中参考了构成本发明的一部分并通过图示说明的方式示出本发明实施例的具体方面或可以使用本发明实施例的具体方面的附图。应当理解的是，本发明实施例可以在其它方面中使用，并且可以包括附图中未描绘的结构变化或逻辑变化。因此，以下详细描述不应以限制性的意义来理解，且本发明的范围由所附权利要求书进行界定。例如，应当理解的是，与所描述的方法有关的公开内容对于用于执行所述方法的对应设备或系统也同样适用，反之亦然。例如，如果描述一个或多个具体方法步骤，则对应的设备可以包括一个或多个单元来执行所描述的一个或多个方法步骤，即使附图中未明确描述或示出此类一个或多个单元。另一方面，例如，如果根据一个或多个单元来描述具体装置，则对应的方法可以包括一个或多个步骤来实现一个或多个单元的功能，即使附图中未明确描述或示出此类一个或多个步骤。此外，应当理解的是，除非另外明确说明，本文中所描述的各示例性实施例和/或方面的特征可以相互组合。视频译码通常指对构成视频或视频序列的图像序列进行处理。在视频译码领域中，术语“帧”与“图像”可以用作同义词。视频译码包括视频编码和视频解码两部分。视频编码在源侧执行，通常包括处理原始视频图像，以减少表示视频图像所需的数据量。视频解码在目的地侧执行，通常包括相对于编码器的逆处理过程，用于重建视频图像。实施例涉及的视频图像的“译码”应理解为视频图像或相应视频序列的“编码”或“解码”。编码部分和解码部分也合称为编解码。在无损视频译码的情况下，可以重建原始视频图像，即重建的视频图像具有与原始视频图像相同的质量。在有损视频译码的情况下，通过量化等执行进一步压缩，来减少表示视频图像所需的数据量，而解码器侧无法完全重建视频图像，即重建的视频图像的质量与原始视频图像的质量相比较低或较差。若干个视频译码标准属于“有损混合视频编解码器”组。视频序列的每个图像通常被分割成一组不重叠的块，并且译码通常在块层级进行。换句话说，编码器侧通常在块层级处理即编码视频，例如，通过空间预测和/或时间预测来生成预测块，从当前块中减去预测块以获得残差块，在变换域变换残差块并量化残差块以减少待传输的数据量；而解码器侧将相对于编码器的逆处理过程应用于经编码或经压缩的块，以重建用于表示的当前块。此外，编码器的处理环路与解码器的处理环路相同，使得编码器和解码器生成相同的预测和/或重建，用于处理即译码后续块。在下述视频译码系统10的实施例中，视频编码器20和视频解码器30基于图1至图3进行描述。图1A为示例性译码系统10的示意性框图，例如，视频译码系统10可以利用本申请的技术。视频译码系统10中的视频编码器20和视频解码器30代表可以用于根据本申请中描述的各种示例执行各种技术的设备的示例。如图1A所示，该译码系统10包括源设备12，源设备12用于将经编码图像数据21提供给目的地设备14等，以对经编码图像数据21进行解码。源设备12包括编码器20，并且可以另外包括图像源16、预处理器18和通信接口或通信单元22。图像源16可以包括或可以是任何类型的图像捕获设备，例如用于捕获真实世界图像的摄像机；和/或任何类型的图像生成设备，例如用于生成计算机动画图像的计算机图形处理器；或者用于获得和/或提供真实世界图像、计算机动画图像图像)和/或其任意组合图像)的任何类型的其它设备。图像源可以为存储任一上述图像的任何类型的存储器。为了区分预处理器18和预处理单元18所执行的处理，图像或图像数据17也可以称为原始图像或原始图像数据17。预处理器18用于接收图像数据17,并对图像数据17执行预处理，以获得经预处理的图像19或经预处理的图像数据19。预处理器18执行的预处理可以包括修剪、颜色格式转换、调色或去噪等。应当理解的是，预处理单元18可以是可选组件。视频编码器20用于接收经预处理的图像数据19并提供经编码图像数据21。源设备12中的通信接口22可以用于接收经编码图像数据21，并通过通信信道13将经编图像数据21发送给另一设备或任何其它设备，以便进行存储或直接重建。目的地设备14包括解码器30，并且可以另外包括通信接口或通信单元28、后处理器32和显示设备34。目的地设备14中的通信接口28用于直接从源设备12或从存储设备例如经编码图像数据存储设备等任何其它源端接收经编码图像数据21，并将经编码图像数据21提供给解码器30。通信接口22和通信接口28可以用于经由源设备12与目的地设备14之间的直接通信链路或者经由任何类型的网络发送或接收经编码图像数据21或经编码数据21。例如，通信接口22可以用于将经编码图像数据21封装成合适的格式，和/或通过任何类型的传输编码或处理方式来处理经编码图像数据，以便通过通信链路或通信网络进行传输。例如，与通信接口22对应的通信接口28可以用于接收传输的数据，并通过任何类型的对应传输解码或处理和/或解封装方式来处理传输数据，得到经编码图像数据21。通信接口22和通信接口28都可以配置为图1A中从源设备12指向目的地设备14的通信信道13的箭头所指示的单向通信接口，或者配置为双向通信接口，并且可以用于发送和接收消息等，以建立连接、确认并交换与通信链路和/或数据传输相关的任何其它信息，等等。解码器30用于接收经编码图像数据21并提供经解码图像数据31或经解码图像31。目的地设备14的后处理器32用于对经解码图像数据31进行后处理，以获得经后处理的图像数据33。例如，由后处理单元32执行的后处理可以包括颜色格式转换、调色、修剪、重采样，或任何其它处理，用于提供经解码图像数据31以供显示设备34等进行显示，等等。目的地设备14中的显示设备34用于接收经后处理的图像数据33，以便向用户或观看者显示图像。显示设备34可以为或可以包括用于表示重建图像的任何类型的显示器，例如，集成或外部显示器或显示屏。例如，显示器可以包括液晶显示器、有机发光二极管显示器、等离子显示器、投影仪、微型LED显示器、硅基液晶显示器、数字光处理器或任何类型的其它显示器。虽然图1A中将源设备12和目的地设备14显示为单独的设备，但是设备实施例也可以同时包括这两种设备或同时包括这两种设备的功能，即同时包括源设备12或其对应的功能以及目的地设备14或其对应的功能。在这些实施例中，可以采用相同的硬件和/或软件，或者采用单独的硬件和/或软件或其任意组合来实现源设备12或其对应的功能以及目的地设备14或其对应的功能。本领域技术人员根据上述描述明显可知，图1A中所示的源设备12和/或目的地设备14的不同单元或功能的存在和功能划分可以根据实际设备和应用的变化而变化。编码器20或解码器30或所述编码器20和所述解码器30两者都可以通过如图1B所示的处理电路实现，例如一个或多个微处理器、数字信号处理器、专用集成电路、现场可编程门阵列、离散逻辑、硬件、视频编码专用处理器或其任意组合。编码器20可以通过处理电路46实现，以体现参照图2的编码器20所描述的各种模块和/或本文中所描述的任何其它编码器系统或子系统。解码器30可以通过处理电路46实现，以体现参照图3的解码器30所描述的各种模块和/或本文中所描述的任何其它解码器系统或子系统。所述处理电路可以用于执行下文论述的各种操作。如图5所示，如果所述技术部分地以软件形式实现，则设备可以将该软件的指令存储在合适的非瞬时性计算机可读存储介质中，并且可以通过一个或多个处理器以硬件形式执行所述指令，以实现本发明的技术。视频编码器20和视频解码器30中的任一个可以作为组合编码器/解码器的一部分集成在单个设备中，如图1B所示。源设备12和目的地设备14可以包括多种设备中的任一种，包括任何类型的手持式或固定设备，例如，笔记本电脑或膝上型电脑、手机、智能手机、平板电脑、摄像机、台式计算机、机顶盒、电视机、显示设备、数字媒体播放器、视频游戏机、视频流设备、广播接收器设备、广播发送器设备等，并且可以不使用或使用任何类型的操作系统。在一些情况下，源设备12和目的地设备14可以配备用于无线通信。因此，源设备12和目的地设备14可以是无线通信设备。在一些情况下，图1A所示的视频译码系统10仅是示例性的，并且本申请的技术可以适用于视频译码设置，这些设置未必包括编码设备与解码设备之间的任何数据通信。在其它示例中，数据从本地存储器中检索，通过网络进行流式传输等。视频编码设备可以对数据进行编码并将数据存储到存储器中，和/或视频解码设备可以从存储器检索数据并对数据进行解码。在一些示例中，编码和解码由相互不通信而只是将数据编码到存储器和/或从存储器检索数据并对数据进行解码的设备来执行。为便于描述，本文参考由ITU-T视频编码专家组和ISO/IEC运动图像专家组的视频编码联合工作组开发的高效视频编码或通用视频编码参考软件等描述本发明实施例。本领域普通技术人员应理解本发明实施例不限于HEVC或VVC。编码器和编码方法图2为用于实现本申请的技术的一种示例性视频编码器20的示意性框图。在图2的示例中，视频编码器20包括输入端201、残差计算单元204、变换处理单元206、量化单元208、反量化单元210、逆变换处理单元212、重建单元214、环路滤波器单元220、解码图像缓冲区230、模式选择单元260、熵编码单元270和输出端272。模式选择单元260可以包括帧间预测单元244、帧内预测单元254和分割单元262。帧间预测单元244可以包括运动估计单元和运动补偿单元。图2所示的视频编码器20也可以称为混合视频编码器或基于混合视频编解码器的视频编码器。残差计算单元204、变换处理单元206、量化单元208和模式选择单元260可以组成编码器20的前向信号路径，而反量化单元210、逆变换处理单元212、重建单元214、缓冲区216、环路滤波器220、解码图像缓冲区230、帧间预测单元244和帧内预测单元254可以组成视频编码器20的后向信号路径，其中，视频编码器20的后向信号路径对应于解码器的信号路径。反量化单元210、逆变换处理单元212、重建单元214、环路滤波器220、解码图像缓冲区230、帧间预测单元244和帧内预测单元254还组成视频编码器20的“内置解码器”。图像和图像分割例如，编码器20可以用于通过输入端201接收图像17，例如，形成视频或视频序列的图像序列中的图像。接收到的图像或图像数据也可以是经预处理的图像19。为简单起见，下文均描述为图像17。图像17也可以称为当前图像或待译码图像中的其它图像区分开)。图像为或者可以视为具有强度值的样本组成的二维阵列或矩阵。阵列中的样本也可以称为像素。阵列或图像在水平方向和垂直方向上的样本数量限定了图像的大小和/或分辨率。为了表示颜色，通常采用三个颜色分量，即图像可以表示为或可以包括三个样本阵列。在RGB格式或颜色空间中，一个图像包括对应的红、绿、蓝样本阵列。但是，在视频译码中，每个像素通常以亮度和色度格式或颜色空间表示，例如YCbCr，包括Y表示的一个亮度分量和Cb和Cr表示的两个色度分量。所述亮度分量Y表示亮度或灰阶强度，而所述两个色度分量Cb和Cr表示色度或颜色信息分量。相应地，YCbCr格式的图像包括由亮度样本值组成的一个亮度样本阵列和由色度值组成的两个色度样本阵列。RGB格式的图像可以转换或变换成YCbCr格式，反之亦然，该过程也称为颜色转换或颜色变换。如果图像是黑白的，则该图像可以只包括亮度样本阵列。相应地，例如，图像可以为黑白格式的一个亮度样本阵列或4:2:0、4:2:2和4:4:4颜色格式的一个亮度样本阵列和两个对应的色度样本阵列。在一些实施例中，视频编码器20可以包括图像分割单元，用于将图像17分割成多个图像块203。这些块也可以称为根块、宏块，或编码树块或编码树单元。图像分割单元可以用于对视频序列中的所有图像使用相同的块大小并使用限定块大小的对应网格，或者在图像或图像子集或图像组之间改变块大小，并将每个图像划分成多个对应块。在其它实施例中，视频编码器可以用于直接接收图像17的块203，例如组成图像17的一个、几个或所有块。图像块203也可以称为当前图像块或待译码图像块。与图像17类似，图像块203同样为或者可以视为具有强度值的像素点组成的二维阵列或矩阵，但是图像块203的尺寸比图像17的尺寸小。换句话说，根据所应用的颜色格式，所述块203可以包括，例如，一个样本阵列或三个样本阵列或任何其它数量和/或类型的阵列。所述前块203在水平方向和垂直方向上的样本数量限定了块203的大小。相应地，一个块可以为M×N的样本阵列或M×N的变换系数阵列等。在一些实施例中，图2所示的视频编码器20可以用于对图像17进行逐块编码，例如对每个块203进行编码和预测。在一些实施例中，图2所示的视频编码器20还可以用于采用条带对图像进行分割和/或编码，其中，可以使用一个或多个条带对图像进行分割或编码，并且每个条带可以包括一个或多个块。在一些实施例中，图2所示的视频编码器20还可以用于采用条带/分块组和/或分块对图像进行分割和/或编码，其中，可以使用一个或多个分块组对图像进行分割或编码，每个分块组可以包括一个或多个块或一个或多个分块等，每个分块可以为例如矩形，并且可以包括一个或多个块，例如，完整块或部分块。残差计算残差计算单元204可以用于通过以下方式根据图像块203和预测块265来计算残差块205，例如通过逐样本从图像块203的样本值中减去预测块265的样本值，得到样本域中的残差块205。变换变换处理单元206可以用于对残差块205的样本值进行离散余弦变换或离散正弦变换等变换，得到变换域中的变换系数207。变换系数207也可以称为变换残差系数，表示变换域中的残差块205。变换处理单元206可以用于应用DCT/DST的整数近似，例如为H.265/HEVC中指定的变换。与正交DCT变换相比，这种整数近似通常为按一定的因子进行比例缩放。为了维持经正变换和逆变换处理的残差块的范数，应用其它比例缩放因子作为变换过程的一部分。比例缩放因子通常是根据某些约束条件选择的，例如，比例缩放因子是用于移位运算的2的幂、变换系数的位深度、精度与实现成本之间的权衡等。例如，通过逆变换处理单元212等为逆变换指定具体的比例缩放因子；相应地，可以在编码器20侧通过变换处理单元206等为正变换指定对应的比例缩放因子。在一些实施例中，视频编码器20可以用于，例如，直接输出或通过熵编码单元270进行编码或压缩后输出一种或多种变换的变换参数，使得视频解码器30可以接收并使用这些变换参数进行解码。量化量化单元208可以用于通过应用标量量化或矢量量化等来量化变换系数207，得到量化系数209。量化系数209也可以称为量化变换系数209或量化残差系数209。量化过程可以减小与部分或全部变换系数207相关的位深度。例如，可以在量化期间将n位变换系数向下舍入为m位变换系数，其中，n大于m，并且可以通过调整量化参数修改量化程度。例如，对于标量量化，可以进行不同的缩放来实现较细或较粗的量化。量化步长越小，对应的量化越细；而量化步长越大，对应的量化越粗。可以通过量化参数表示合适的量化步长。例如，量化参数可以为合适的量化步长的预定义集合的索引。例如，较小的量化参数可以对应较细的量化，较大的量化参数可以对应较粗的量化，反之亦然。量化可以包括除以量化步长以及例如通过反量化单元210执行的对应反量化或解量化，或者可以包括乘以量化步长。在一些实施例中，根据如HEVC等一些标准，可以使用量化参数来确定量化步长。通常，可以根据量化参数使用包括除法的等式的定点近似来计算量化步长。可以引入额外的比例缩放因子来进行量化和解量化，以恢复可能由于在用于量化步长和量化参数的等式的定点近似中使用缩放而被修改的残差块的范数。在一种示例性实现方式中，可以合并逆变换和解量化的缩放。可选地，可以使用自定义量化表并由编码器通过码流等方式向解码器进行指示。量化是有损操作，其中，量化步长越大，损耗越大。在一些实施例中，视频编码器20可以用于，例如，直接输出或通过熵编码单元270进行编码后输出量化参数，使得视频解码器30可以接收并使用量化参数进行解码。反量化反量化单元210用于对量化系数执行量化单元208执行的量化的反量化，得到解量化系数211，例如，根据或使用与量化单元208相同的量化步长执行量化单元208所执行的量化方案的反量化方案。解量化系数211也可以称为解量化残差系数211，对应于变换系数207，但是由于量化造成损耗，解量化系数211通常与变换系数不完全等同。逆变换逆变换处理单元212用于执行变换处理单元206执行的变换的逆变换，例如，逆离散余弦变换、逆离散正弦变换或其它逆变换，以获得样本域中的重建残差块213。重建残差块213也可以称为变换块213。重建重建单元214用于通过将重建残差块213的样本值与预测块265的样本值逐样本进行相加，将变换块213添加到预测块265，以得到样本域中的重建块215。滤波环路滤波器单元220用于对重建块215进行滤波，得到经滤波的块221，或者通常用于对重建样本进行滤波，得到滤波样本值。例如，环路滤波器单元用于平滑像素转变或提高视频质量。环路滤波器单元220可以包括一个或多个环路滤波器，例如去块效应滤波器、样本自适应偏移滤波器或一个或多个其它滤波器，例如双边滤波器，自适应环路滤波器、锐化或平滑滤波器、协作滤波器或其任意组合。尽管环路滤波器单元220在图2中示出为环内滤波器，但是在其它配置中，环路滤波器单元220可以实现为环后滤波器。经滤波的块221也可以称为经滤波的重建块221。在一些实施例中，视频编码器20可以用于，例如，直接输出或通过熵编码单元270进行编码后输出环路滤波器参数，使得解码器30可以接收并使用相同或不同的环路滤波器参数进行解码。解码图像缓冲区解码图像缓冲区230可以是存储参考图像或通常存储参考图像数据以供视频编码器20对视频数据进行编码时使用的存储器。DPB 230可以由多种存储器设备中的任何一种组成，例如动态随机存取存储器，包括同步DRAM、磁阻RAM、电阻RAM或其它类型的存储器设备。解码图像缓冲区230可以用于存储一个或多个经滤波的块221。解码图像缓冲区230还可以用于存储同一当前图像或不同图像中的其它先前经滤波的块，并且可以提供完整的先前经重建的图像和/或部分经重建的当前图像，以进行帧间预测等。解码图像缓冲区230还可以用于存储一个或多个未经滤波的重建块215，或者，例如，如果重建块215未由环路滤波器单元220进行滤波，则通常存储未经滤波的重建样本，或者存储未进行任何其它处理的重建块或重建样本。模式选择模式选择单元260包括分割单元262、帧间预测单元244和帧内预测单元254，用于从解码图像缓冲区230或其它缓冲区接收或获得原始块203等原始图像数据以及重建图像数据，例如，同一图像和/或一个或多个先前经解码图像的经滤波和/或未经滤波的重建样本或重建块。重建图像数据用作帧间预测或帧内预测等预测中的参考图像数据，以得到预测块265或预测值265。模式选择单元260可以用于为当前块预测模式确定或选择一种分割方式和一种预测模式，生成对应的预测块265，以对残差块205进行计算和对重建块215进行重建。在一些实施例中，模式选择单元260可以用于选择分割和预测模式。所述分割和预测模式提供最佳匹配或者说最小残差，或者提供最小信令开销，或者同时考虑或平衡以上两者。模式选择单元260可以用于根据率失真优化确定分割和预测模式，即选择提供最小率失真的预测模式。本文中，术语“最佳”、“最小”、“最优”等不一定指总体上“最佳”、“最小”、“最优”等，也可以指满足终止或选择标准的情况，例如，某个值超过或低于阈值或其它限制，可能导致“次优选择”，但会降低复杂度和处理时间。换言之，分割单元262可以通过以下方式用于将块203分割为更小的块分割块或子块，例如，可以通过迭代地使用四叉树分割、二叉树分割或三叉树分割或其任意组合，并且用于例如对分割块或子块中的每一个进行预测，其中，模式选择包括选择分割块203的树结构和选择应用于每个分割块或子块的预测模式。下文将详细地描述由示例性视频编码器20执行的分割和预测处理。分割分割单元262可以将当前块203分割成更小的分割块，例如正方形或矩形大小的较小块。这些较小块可以进一步分割为甚至更小的分割块。这也称为树分割或层次树分割，其中，例如在根树级别0的根块可以递归地分割为两个或更多下一较低级别的块，例如分割为树级别1的节点。这些块可以再次分割为两个或更多下一较低级别的块，例如树级别2的块，直到分割结束。未被进一步分割的块也称为树的叶块或叶节点。分割为两个分割块的树称为二叉树，分割为三个分割块的树称为三叉树，分割为四个分割块的树称为四叉树。如上所述，本文中使用的术语“块”可以是图像的一部分，特别是正方形或矩形部分。例如，参照HEVC和VVC，块可以为或可以对应于编码树单元、编码单元、预测单元和变换单元，和/或对应于多个对应块，例如编码树块、编码块、变换块或预测块。例如，编码树单元可以为或可以包括具有三个样本阵列的图像中的亮度样本组成的一个CTB以及色度样本组成的两个对应CTB，或者可以为或可以包括黑白图像或使用三个单独颜色平面和语法结构进行译码的图像中的样本组成的一个CTB，其中，这些语法结构用于对样本进行译码。相应地，编码树块可以为N×N个样本块，其中，N可以设为某个值，使得一个分量被划分为多个CTB，这就是一种分割方式。编码单元可以为或可以包括具有三个样本阵列的图像中的亮度样本组成的一个编码块以及色度样本组成的两个对应编码块，或者可以为或可以包括黑白图像或使用三个单独颜色平面和语法结构进行译码的图像中的样本组成的一个编码块，其中，这些语法结构用于对样本进行译码。相应地，编码块可以为M×N个样本块，其中，M和N可以设为某个值，使得一个CTB被划分为多个编码块，这就是一种分割方式。在一些实施例中，例如根据HEVC，可以通过表示为编码树的四叉树结构将编码树单元划分为多个CU。是否通过帧间预测或帧内预测对图像区域进行译码是在CU层级决定的。每个CU可以根据PU划分类型进一步划分为一个、两个或四个PU。一个PU内将执行相同的预测过程，并且以PU为单位向解码器发送相关信息。根据PU划分类型执行该预测过程获得残差块之后，可以根据与CU的编码树类似的其它四叉树结构将CU分割为变换单元。在一些实施例中，例如，根据当前正在开发的最新视频编码标准)，使用组合式四叉树和二叉树分割来分割编码块。在QTBT块结构中，CU可以为正方形或矩形。例如，编码树单元首先通过四叉树结构进行分割。然后，四叉树叶节点进一步通过二叉树或三叉树结构进行分割。分割树叶节点称为编码单元，这种分割用于预测和变换处理，无需任何进一步的分割。即，在QTBT编码块结构中，CU、PU和TU的块大小相同。与此同时，三叉树分割等多重分割可以与QTBT块结构一起使用。在一个示例中，视频编码器20中的模式选择单元260可以用于执行本文中描述的分割技术的任意组合。如上所述，视频编码器20用于从预测模式集合中确定或选择最佳或最优的预测模式。例如，预测模式集合可以包括帧内预测模式和/或帧间预测模式等。帧内预测帧内预测模式集合可以包括35种不同的帧内预测模式，例如，如DC模式和平面模式等非方向性模式，或如HEVC中定义的方向性模式，或者可以包括67种不同的帧内预测模式，例如，如DC模式和平面模式等非方向性模式，或如VVC中定义的方向性模式。帧内预测单元254用于根据帧内预测模式集合中的帧内预测模式，使用同一个当前图像中的邻块的重建样本来生成帧内预测块265。帧内预测单元254还用于将帧内预测参数以语法元素266的形式输出到熵编码单元270，以包含到经编码的图像数据21中，使得视频解码器30可以例如接收并使用预测参数以进行解码。帧间预测帧间预测模式集合取决于可用的参考图像和其它帧间预测参数，例如取决于是否使用整个参考图像或只使用参考图像的一部分来搜索最佳匹配的参考块，和/或例如取决于是否进行像素插值，例如二分之一像素和/或四分之一像素插值。除了上述预测模式之外，还可以使用跳过模式和/或直接模式。帧间预测单元244可以包括运动估计单元和运动补偿单元。运动估计单元可以用于接收或获得图像块203和经解码图像231，或者至少一个或多个先前重建块，以进行运动估计。例如，视频序列可以包括当前图像和先前经解码图像231，换句话说，当前图像和先前经解码图像231可以为一系列图像的一部分或组成一系列图像，这一系列图像组成视频序列。例如，编码器20可以用于从多个其它图像中的相同或不同图像的多个参考块中选择一个参考块，并将参考图像和/或参考块的位置与当前块的位置之间的偏移作为帧间预测参数提供给运动估计单元。这种偏移也称为运动矢量。运动补偿单元用于获得帧间预测参数，并且根据或使用帧间预测参数进行帧间预测，得到帧间预测块265。由运动补偿单元执行的运动补偿可以包括根据通过运动估计确定的运动/块矢量来获取或生成预测块，还可以包括对子像素精度执行插值。插值滤波可以根据已知的像素样本生成其它像素样本，从而可能增加可以用于对图像块进行译码的候选预测块的数量。在接收到当前图像块的PU对应的运动矢量后，运动补偿单元可以在其中一个参考图像列表中定位运动矢量所指向的预测块。运动补偿单元还可以生成与块和视频条带相关的语法元素，以供视频解码器30在解码视频条带的图像块时使用。除条带和相应语法元素之外或作为条带和相应语法元素的替代，还可以生成或使用分块组和/或分块以及相应的语法元素。熵编码熵编码单元270用于将熵编码算法或方案方案、上下文自适应VLC方案、算术编码方案、二值化，上下文自适应二进制算术编码、基于语法的上下文自适应二进制算术编码、概率区间分割熵编码或其它熵编码方法或技术)等应用于或不应用于量化系数209、帧间预测参数、帧内预测参数、环路滤波器参数和/或其它语法元素，以获得可以通过输出端272以经编码码流21等形式输出的经编码图像数据21，使得视频解码器30可以接收并使用这些参数进行解码等。可以将经编码码流21发送到视频解码器30，或者将其存储在存储器中，以供视频解码器30后续进行发送或检索。视频编码器20的其它结构变型可以用于对视频流进行编码。例如，基于非变换的编码器20可以在没有变换处理单元206的情况下直接量化某些块或帧的残差信号。在另一种实现方式中，编码器20可以包括组合成单个单元的量化单元208和反量化单元210。解码器和解码方法图3示出了用于实现本申请技术的视频解码器30的一个示例。视频解码器30用于接收例如由编码器20编码的经编码图像数据21，得到经解码图像331。经编码图像数据或码流包括用于解码该经编码图像数据的信息，例如表示经编码视频条带的图像块的数据和相关语法元素。在图3的示例中，解码器30包括熵解码单元304、反量化单元310、逆变换处理单元312、重建单元314、环路滤波器320、解码图像缓冲区330、模式应用单元360、帧间预测单元344和帧内预测单元354。帧间预测单元344可以为或可以包括运动补偿单元。在一些示例中，视频解码器30可以执行大体上与参照图2中的视频编码器20所描述的编码过程互逆的解码过程。如参照编码器20所述，反量化单元210、逆变换处理单元212、重建单元214、环路滤波器220、解码图像缓冲区230、帧间预测单元344和帧内预测单元354还组成视频编码器20的“内置解码器”。相应地，反量化单元310的功能可以与反量化单元210相同，逆变换处理单元312的功能可以与逆变换处理单元212相同，重建单元314的功能可以与重建单元214相同，环路滤波器320的功能可以与环路滤波器220相同，解码图像缓冲区330的功能可以与解码图像缓冲区230相同。因此，对视频编码器20的相应单元和功能的解释相应地适用于视频解码器30的相应单元和功能。熵解码熵解码单元304用于解析码流21，并对经编码图像数据21执行熵解码等，得到量化系数309和/或经解码的编码参数，例如帧间预测参数、帧内预测参数、变换参数、量化参数、环路滤波器参数和/或其它语法元素中的任何一个或全部。熵解码单元304可以用于应用与参照编码器20中的熵编码单元270所描述的编码方案对应的解码算法或方案。熵解码单元304还可以用于向模式应用单元360提供帧间预测参数、帧内预测参数和/或其它语法元素，以及向解码器30的其它单元提供其它参数。视频解码器30可以接收视频条带级和/或视频块级的语法元素。除条带和相应语法元素之外或作为条带和相应语法元素的替代，还可以接收和/或使用分块组和/或分块以及相应的语法元素。反量化反量化单元310可以用于从经编码图像数据21接收量化参数和量化系数，并根据这些量化参数对经解码量化系数309进行反量化，得到解量化系数311，其中，解量化系数311也可以称为变换系数311。反量化过程可以包括：使用视频编码器20为视频条带中的每个视频块所确定的量化参数来确定量化程度，同样也确定需要应用的反量化程度。逆变换逆变换处理单元312可以用于接收解量化系数311，并对解量化系数311进行变换，得到样本域中的重建残差块313。重建残差块313也可以称为变换块313。变换可以为逆变换，例如逆DCT、逆DST、逆整数变换或概念上类似的逆变换过程。逆变换处理单元312还可以用于从经编码图像数据21接收变换参数或对应的信息，以确定要对解量化系数311进行的变换。重建重建单元314可以用于通过以下方式将重建残差块313的样本值与预测块365的样本值相加，例如，将重建残差块313添加到预测块365，以得到样本域中的重建块315。滤波环路滤波器单元320可以用于对重建块315进行滤波，得到经滤波的块321，例如，以平滑像素转变或以其它方式提高视频质量等。环路滤波器单元320可以包括一个或多个环路滤波器，例如去块效应滤波器、样本自适应偏移滤波器或一个或多个其它滤波器，例如双边滤波器，自适应环路滤波器、锐化或平滑滤波器、协作滤波器或其任意组合。尽管环路滤波器单元320在图3中示出为环内滤波器，但是在其它配置中，环路滤波器单元320可以实现为环后滤波器。解码图像缓冲区然后，将图像的经解码视频块321存储在解码图像缓冲区330中，其中，解码图像缓冲区330存储经解码图像331作为参考图像，以便后续对其它图像进行运动补偿和/或进行输出并显示。解码器30用于通过输出端312等输出经解码图像311，以向用户呈现或供用户查看。预测帧间预测单元344的功能可以与帧间预测单元244相同，帧内预测单元354的功能可以与帧内预测单元254相同，并根据从经编码图像数据21接收的分割方式和/或预测参数或相应的信息来执行划分或分割决策并进行预测。模式应用单元360可以用于根据重建图像、块或相应的样本对每个块执行预测，得到预测块365。当视频条带被译码为经帧内译码条带时，模式应用单元360中的帧内预测单元354用于根据指示的帧内预测模式和来自当前图像的先前经解码块的数据为当前视频条带的图像块生成预测块365。当视频图像被译码为经帧间译码条带时，模式应用单元360的帧间预测单元344用于根据运动矢量和从熵解码单元304接收的其它语法元素为当前视频条带的视频块产生预测块365。对于帧间预测，可以根据其中一个参考图像列表内的其中一个参考图像产生这些预测块。视频解码器30可以根据存储在DPB 330中的参考图像，使用预设的构建技术来构建参考帧列表0和列表1。除条带之外或作为条带的替代，相同或类似的过程可以应用于使用分块组和/或分块的实施例或由这些实施例应用，例如，视频可以使用I、P或B分块组和/或分块进行译码。模式应用单元360用于通过解析运动矢量或相关信息以及其它语法元素，为当前视频条带的视频块确定预测信息，并使用该预测信息为正在解码的当前视频块产生预测块。例如，模式应用单元360使用接收到的一些语法元素来确定用于对视频条带的视频块进行译码的预测模式、帧间预测条带类型、用于条带的一个或多个参考图像列表的构建信息、用于条带的每个经帧间编码视频块的运动矢量、用于条带的每个经帧间译码视频块的帧间预测状态以及其它信息，以对当前视频条带中的视频块进行解码。除条带之外或作为条带的替代，相同或类似的过程可以应用于使用分块组和/或分块的实施例或由这些实施例应用，例如，视频可以使用I、P或B分块组和/或分块进行译码。在一些实施例中，图3所示的视频解码器30可以用于使用条带对图像进行分割和/或解码，其中，可以使用一个或多个条带对图像进行分割或解码，并且每个条带可以包括一个或多个块。在一些实施例中，图3所示的视频解码器30可以用于使用分块组和/或分块对图像进行分割和/或解码，其中，可以使用一个或多个分块组对图像进行分割或解码，每个分块组可以包括一个或多个块或一个或多个分块等，每个分块可以为例如矩形，并且可以包括一个或多个块，例如，完整块或部分块。视频解码器30的其它变型可以用于对经编码图像数据21进行解码。例如，解码器30能够在没有环路滤波器单元320的情况下产生输出视频流。例如，基于非变换的解码器30可以在没有逆变换处理单元312的情况下为某些块或帧直接反量化残差信号。在另一种实现方式中，视频解码器30可以包括组合成单个单元的反量化单元310和逆变换处理单元312。应当理解的是，在编码器20和解码器30中，可以对当前步骤的处理结果进行进一步的处理，然后输出到下一步骤。例如，在插值滤波、运动矢量推导或环路滤波之后，可以对插值滤波、运动矢量推导或环路滤波的处理结果进行进一步的运算，例如进行限幅或移位运算。需要说明的是，可以对当前块的推导出的运动矢量进行进一步的运算。例如，根据运动矢量的表示位将该运动矢量的值限制在预定义范围内。如果运动矢量的表示位为bitDepth，则运动矢量的取值范围为-2^至2^-1，其中，“^”符号表示幂次方。例如，如果bitDepth设置为等于16，则范围为-32768～32767；如果bitDepth设置为等于18，则范围为-131072～131071。例如，对推导出的运动矢量的值进行限制，使得这四个4×4子块的MV的整数部分之间的最大差值不超过N个像素，例如不超过1个像素。这里提供了两种根据bitDepth来限制运动矢量的方法。方法1：通过平滑操作来删除溢出的最高有效位ux ＝  ％ 2bitDepth mvx ＝  ？  : ux uy ＝  ％ 2bitDepth mvy ＝  ？  : uy 其中，mvx表示图像块或子块的运动矢量的水平分量；mvy表示图像块或子块的运动矢量的垂直分量；ux和uy表示中间值。例如，如果mvx的值为-32769，则使用公式和之后得到的值为32767。在计算机系统中，十进制数以二补码的形式进行存储。-32769的二补码为1,0111,1111,1111,1111，这时丢弃MSB，所得到的二补码为0111,1111,1111,1111，这与使用公式和之后得到的输出结果相同。ux＝％2bitDepth mvx＝？:ux uy＝％2bitDepth mvy＝？:uy 这些运算可以在mvp和mvd的求和过程中执行，如公式至所示。方法2：对值进行限幅来删除溢出的MSBvx＝Clip3vy＝Clip3其中，vx表示图像块或子块的运动矢量的水平分量；vy表示图像块或子块的运动矢量的垂直分量；x、y和z分别对应于MV限幅过程的三个输入值；函数Clip3定义如下：图4为本发明实施例提供的一种视频译码设备400的示意图。该视频译码设备400适用于实现本文中描述的公开实施例。在一个实施例中，该视频译码设备400可以是解码器或编码器。该视频译码设备400包括：用于接收数据的入端口410和接收单元420；用于处理数据的处理器、逻辑单元或中央处理器430；用于发送数据的发送单元440和出端口450；用于存储数据的存储器460。视频译码设备400还可以包括与入端口410、接收单元420、发送单元440和出端口450耦合的光电组件和电光组件，用作光信号或电信号的出口或入口。处理器430可以通过硬件和软件实现。处理器430可以实现为一个或多个CPU芯片、一个或多个核、一个或多个FPGA、一个或多个ASIC和一个或多个DSP。处理器430与入端口410、接收单元420、发送单元440、出端口450和存储器460通信。处理器430包括译码模块470。译码模块470实现上文描述的公开实施例。例如，译码模块470执行、处理、准备或提供各种译码操作。因此，将译码模块470包含在内可以实质性地改进视频译码设备400的功能，并且影响视频译码设备400到不同状态的转换。可选地，译码模块470实现为存储在存储器460中并由处理器430执行的指令。存储器460可以包括一个或多个磁盘、一个或多个磁带机以及一个或多个固态硬盘，并且可以用作溢出数据存储设备，以在选择程序来执行时存储这些程序并且存储在执行程序的过程中读取的指令和数据。例如，存储器460可以是易失性和/或非易失性的，并且可以是只读存储器、随机存取存储器、三态内容寻址存储器和/或静态随机存取存储器。图5为示例性实施例提供的装置500的简化框图，其中，该装置500可以用作图1中的源设备12和目的地设备14中的任一者或两者。装置500中的处理器502可以是中央处理单元。可选地，处理器502可以是现有的或今后将开发出的能够操作或处理信息的任何其它类型的设备或多个设备。虽然可以使用如图所示的处理器502等单个处理器来实现所公开的实现方式，但是可以通过使用多个处理器来提高速度和效率。在一种实现方式中，装置500中的存储器504可以是只读存储器设备或随机存取存储器设备。任何其它合适类型的存储设备都可以用作存储器504。存储器504可以包括处理器502通过总线512访问的代码和数据506。存储器504还可以包括操作系统508和应用程序510，应用程序510包括至少一个程序，这个程序使得处理器502执行本文所述的方法。例如，应用程序510可以包括应用程序1至N，还可以包括执行本文所述方法的视频译码应用程序。该装置500还可以包括一个或多个输出设备，例如显示器518。在一个示例中，显示器518可以是组合了显示器与触敏元件的触敏显示器，其中，该触敏元件能够用于感测触摸输入。显示器518可以通过总线512与处理器502耦合。虽然装置500中的总线512在本文中描述为单个总线，但是总线512可以包括多个总线。此外，辅助存储器514可以直接耦合到装置500中的其它组件或可以通过网络进行访问，并且可以包括单个集成单元例如一个存储卡或多个单元例如多个存储卡。因此，装置500可以通过多种配置实现。正如J.M.Boyce的论文“H.264/MPEG AVC视频编码标准中的加权预测”中所述，加权预测是一种工具，它特别有利于译码淡入淡出。H.264视频编码标准中的主配置文件和扩展配置文件中采用了这种加权预测工具，通过将乘法加权因子和加法偏移应用于运动补偿预测来进行加权预测，从而提高译码效率。在显式模式下，加权因子和偏移可以被译码至每个可允许参考图像索引对应的条带头中。在隐式模式下，加权因子不被译码，而是根据两个参考图像的相对图像顺序编号距离推导出。提供的实验结果表明了使用WP时对译码效率的提高程度。当对渐变黑序列进行译码时，码率的降低高达67％。当WP应用于单向预测时，如在P图像中一样，WP与先前针对抗误码提出的漏预测相似。漏预测是WP的一个特例，其中，缩放因子限制在0≤α≤1的范围内。H.264中的WP不仅可以使用负缩放因子，而且还可以使用大于1的缩放因子。加权因子通过经译码的标签字段逐个像素进行应用，以高效地压缩覆盖区域和未覆盖区域。H.264中的WP工具与涉及用于提高压缩效率的加权预测的先前提议之间的一个关键区别在于：参考图像索引与加权因子参数之间的关联关系，这允许在多参考图像环境中高效地指示这些参数。正如R.Zhang和G.Cote的论文“H.264视频压缩中用于加权预测的精确参数估计和高效淡变检测”，2008年10月，美国加利福尼亚州圣地亚哥，第2836-2839页)中所述，在实时编码系统中应用WP的流程可以形式化为图6所示的一系列步骤。首先，通过进行视频分析610生成一些统计数据611。接着，使用若干先前图像到当前图像的小窗口内的统计数据611进行淡变检测。每个图像都分配有状态值631，状态值631表示图像是否处于正常状态或淡变状态。为每个图像保存该状态值。当对图像进行编码时，如果当前图像或当前图像的多个参考图像中的一个参考图像处于淡变状态，则会对该当前图像和参考图像对使用WP。在步骤650中，处理当前图像和对应的参考图像的统计数据，以估计WP参数。然后，将这些参数发送给编码引擎660。否则，如果处于正常状态，则进行正常编码。正如A.Leontaris和A.M.Tourapis的论文“用于改进运动补偿的加权预测方法”，2009年11月，埃及开罗，第1029-1032页)中所述，H.264中的宏块被划分为宏块分割块。对于每个宏块分割块，参考块是从可用参考列表中选择的，即从P译码条带或B译码条带的参考列表0或B译码条带的参考列表1中选择的。每个分割块使用的参考图像可以不同。通过这些参考图像，使用可选地具有子像素精度的运动信息为每个列表生成预测块，即单向列表预测下的预测块P或者双向预测下的预测块PO和P1。这些预测块可以根据加权预测对当前条带的可用性进行进一步处理。对于P条带，WP参数在条带头中进行传输。对于B条带，有两种选择：对显式WP，这些参数在条带头中进行传输；对于隐式WP，这些参数根据在条带头中指示的图像顺序编号推导出。本文中将仅重点关注显式WP的情况以及如何使用这种方法来提高运动补偿性能。需要说明的是，在HEVC和VVC中，PB的使用方式与AVC中的宏块分割块的使用方式类似。对于B条带中的显式单向列表WP或P条带，预测块是根据单个参考图像得到的。假设p表示预测块P中的样本值。如果不使用加权预测，则最终的帧间预测样本为f＝p。否则，预测样本为：项wx和ox分别表示参考列表x的WP增益和偏移参数。项logWD在码流中进行传输，并控制加权预测过程的数学精度。当logWD≥1时，上述表达式在偏离零的方向进行舍入。类似地，双向预测中应考虑两个预测块，每个参考列表对应一个预测块。假设p0和p1表示两个预测块P0和P1中的样本。如果不使用加权预测，则执行如下预测：f＝＞＞1进行双向加权预测时，执行如下预测：f＝＞＞)+＞＞1)需要说明的是，加权预测可以补偿亮度变化，例如淡入、淡出或交错淡入淡出。在VVC中，加权预测是在高层级的序列参数集、图像参数集和条带头中进行指示的。在SPS中，以下语法元素用于：-sps_weighted_pred_flag等于1表示加权预测可以应用于参考所述SPS的P条带；sps_weighted_pred_flag等于0表示加权预测不应用于参考所述SPS的P条带。-sps_weighted_bipred_flag等于1表示显式加权预测可以应用于参考所述SPS的B条带；sps_weighted_bipred_flag等于0表示显式加权预测不应用于参考所述SPS的B条带。在PPS中，以下语法元素用于：-pps_weighted_pred_flag等于0表示加权预测不应用于参考所述PPS的P条带；pps_weighted_pred_flag等于1表示加权预测应用于参考所述PPS的P条带。当sps_weighted_pred_flag等于0时，pps_weighted_pred_flag的值应等于0。-pps_weighted_bipred_flag等于0表示显式加权预测不应用于参考所述PPS的B条带；pps_weighted_bipred_flag等于1表示显式加权预测应用于参考所述PPS的B条带。当sps_weighted_bipred_flag等于0时，pps_weighted_bipred_flag的值应等于0。在条带头中，加权预测参数被指示为pred_weight_table，其中，pred_weight_table的结构如表1所示并且包括以下元素：luma_log2_weight_denom表示所有亮度加权因子的分母以2为底的对数。luma_log2_weight_denom的取值范围可以为0至7。delta_chroma_log2_weight_denom表示所有色度加权因子的分母以2为底的对数的差值。当delta_chroma_log2_weight_denom不存在时，则推断delta_chroma_log2_weight_denom等于0。变量ChromaLog2WeightDenom推导为等于luma_log2_weight_denom+delta_chroma_log2_weight_denom，该变量的取值范围可以为0至7。luma_weight_l0_flag等于1表示存在通过RefPicList进行列表0预测的亮度分量的加权因子，luma_weight_l0_flag等于0表示不存在这些加权因子。chroma_weight_l0_flag等于1表示存在通过RefPicList进行列表0预测的色度预测值的加权因子，chroma_weight_l0_flag等于0表示不存在这些加权因子。当chroma_weight_l0_flag不存在时，则推断chroma_weight_l0_flag等于0。delta_luma_weight_l0表示应用于通过RefPicList进行列表0预测的亮度预测值的加权因子的差值。变量LumaWeightL0推导为等于+delta_luma_weight_l0。当luma_weight_l0_flag等于1时，delta_luma_weight_l0的取值范围可以为-128至127。当luma_weight_l0_flag等于0时，则推断LumaWeightL0等于2luma_log2_weight_denom。luma_offset_l0表示应用于通过RefPicList进行列表0预测的亮度预测值的附加偏移。luma_offset_l0的取值范围可以为-128至127。当luma_weight_l0_flag等于0时，则推断luma_offset_l0等于0。delta_chroma_weight_l0表示应用于通过RefPicList进行列表0预测的色度预测值的加权因子的差值，其中，对于Cb，j等于0，对于Cr，j等于1。变量ChromaWeightL0推导为等于+delta_chroma_weight_l0。当chroma_weight_l0_flag等于1时，delta_chroma_weight_l0的取值范围可以为-128至127。当chroma_weight_l0_flag等于0时，则推断ChromaWeightL0等于2ChromaLog2WeightDenom。delta_chroma_offset_l0表示应用于通过RefPicList进行列表0预测的色度预测值的附加偏移的差值，其中，对于Cb，j等于0，对于Cr，j等于1。变量ChromaOffsetL0推导如下：ChromaOffsetL0＝Clip3＞＞ChromaLog2WeightDenom)))delta_chroma_offset_l0的取值范围可以为-4*128至4*127。当chroma_weight_l0_flag等于0时，则推断ChromaOffsetL0等于0。Luma_weight_l1_flag、chroma_weight_l1_flag、delta_luma_weight_l1、luma_offset_l1、delta_chroma_weight_l1和delta_chroma_offset_l1分别与luma_weight_l0_flag、chroma_weight_l0_flag、delta_luma_weight_l0、luma_offset_l0、delta_chroma_weight_l0和delta_chroma_offset_l0具有相同的语义，其中，l0、L0、列表0和List0分别由l1、L1、列表1和List1替代。变量sumWeightL0Flags推导为等于luma_weight_l0_flag+2*chroma_weight_l0_flag之和，其中，i＝0..NumRefIdxActive-1。当slice_type等于B时，则推导变量sumWeightL1Flags等于luma_weight_l1_flag+2*chroma_weight_l1_flag之和，其中，i＝0..NumRefIdxActive-1。码流一致性的要求为：当slice_type等于P时，sumWeightL0Flags应小于或等于24；当slice_type等于B时，sumWeightL0Flags与sumWeightL1Flags之和应小于或等于24。表1：加权预测参数语法/＞在V.Seregin等的文献JVET-O0244“AHG17：关于参考图像结构中的零增量POC”中指出：在当前的VVC规范草案中，参考图像在参考图像结构中进行指示，其中，abs_delta_poc_st表示增量POC值，可以等于0。RPS可以在SPS和条带头中进行指示。需要通过这种功能为同一参考图像指示不同的权重，如果接入单元中支持分层扩展性和跨层使用同一POC值，则可能需要使用这种功能。其中指出，当加权预测未被启用时，不需要使用重复的参考图像。本文献中还提出，当加权预测未被启用时，不允许使用零增量POC值。表2：序列参数集RBSP语法/＞/＞/＞/＞/＞表3：参考图像列表结构语法语法结构ref_pic_list_struct可以存在于SPS中，或者可以存在于条带头中。根据该语法结构是包含在条带头中还是包含在SPS中，以下内容适用：-如果语法结构ref_pic_list_struct存在于条带头中，则该语法结构表示当前图像的参考图像列表listIdx。-否则，如果语法结构ref_pic_list_struct存在于SPS中，则该语法结构表示参考图像列表listIdx的候选，而且本节中其余部分指定的语义中的术语“当前图像”是指：包括一个或多个条带的每个图像，其中，一个或多个条带包括的ref_pic_list_idx等于SPS中包括的语法结构ref_pic_list_struct的列表中的索引，参考SPS的CVS中的每个图像。num_ref_entries表示语法结构ref_pic_list_struct中的条目的数量。num_ref_entries的取值范围可以为0至sps_max_dec_pic_buffering_minus1+14。ltrp_in_slice_header_flag等于0表示语法结构ref_pic_list_struct中的LTRP条目的POC LSB存在于语法结构ref_pic_list_struct中，ltrp_in_slice_header_flag等于1表示语法结构ref_pic_list_struct中的LTRP条目的POC LSB不存在于语法结构ref_pic_list_struct中。inter_layer_ref_pic_flag等于1表示语法结构ref_pic_list_struct中的第i个条目是ILRP条目，inter_layer_ref_pic_flag等于0表示语法结构ref_pic_list_struct中的第i个条目不是ILRP条目。当inter_layer_ref_pic_flag不存在时，则推断inter_layer_ref_pic_flag的值等于0。st_ref_pic_flag等于1表示语法结构ref_pic_list_struct中的第i个条目是STRP条目，st_ref_pic_flag等于0表示语法结构ref_pic_list_struct中的第i个条目是LTRP条目。当inter_layer_ref_pic_flag等于0，且st_ref_pic_flag不存在时，则推断st_ref_pic_flag的值等于1。变量NumLtrpEntries推导如下：forifNumLtrpEntries++abs_delta_poc_st表示变量AbsDeltaPocSt的值，具体如下所述：ifAbsDeltaPocSt＝abs_delta_poc_stelseAbsDeltaPocSt＝abs_delta_poc_st+1abs_delta_poc_st的取值范围可以为0至215-1。strp_entry_sign_flag等于1表示语法结构ref_pic_list_struct中的第i个条目的值大于或等于0，strp_entry_sign_flag等于0表示语法结构ref_pic_list_struct中的第i个条目的值小于0。当strp_entry_sign_flag不存在时，则推断strp_entry_sign_flag的值等于1。列表DeltaPocValSt推导如下：forifDeltaPocValSt＝？AbsDeltaPocSt:0-AbsDeltaPocStrpls_poc_lsb_lt表示由语法结构ref_pic_list_struct中第i个条目参考的图像的图像顺序编号对MaxPicOrderCntLsb取模的值。语法元素rpls_poc_lsb_lt的长度为个比特。ilrp_idc表示语法结构ref_pic_list_struct中第i个条目的ILRP在直接相关层列表中的索引。ilrp_idc的取值范围可以为0至GeneralLayerIdx-1。在表2中，加权预测参数是在指示了参考图像列表之后进行指示的。在表4中，这些语法元素被重新排序，从而根据加权预测标志的值限制增量POC语法元素的二值化。表4：修改后的序列参数集RBSP语法/＞此外，增量POC的值可以有条件地在解码端进行恢复，具体如下所述：abs_delta_poc_st表示变量AbsDeltaPocSt的值，具体如下所述：ifAbsDeltaPocSt＝abs_delta_poc_stelseAbsDeltaPocSt＝abs_delta_poc_st+1三角分割模式和几何运动分割模式还分别称为三角融合模式和几何融合模式，它们是实现预测分割块之间的非水平边界和非垂直边界的分割技术，其中，预测单元PU1和预测单元PU2通过其与不同颜色分量相关的样本子集的加权平均过程在区域中进行组合。采用TMP能够实现预测分割块之间的边界沿着矩形块的对角线，而采用GEO实现的边界可以位于任意位置。在应用加权平均过程的区域中，正方形内的整数数字表示应用于预测单元PU1的亮度分量的权重WPU1。在一个示例中，应用于预测单元PU2的亮度分量的权重WPU2计算如下：WPU2＝8-WPU1应用于对应预测单元的色度分量的权重可能与应用于对应预测单元的亮度分量的权重不同。关于TPM语法的详细信息如表5所示，其中，4个语法元素用于指示关于TPM的信息：MergeTriangleFlag是标识是否选择TPM的标志；merge_triangle_split_dir是TPM的划分方向标志；merge_triangle_idx0和merge_triangle_idx1表示用于TPM的融合候选0和1的索引。表5：包括用于TPM的语法的融合数据语法/＞具体地，TPM在以下提案即R-L.Liao和C.S.Lim的文献JVET-L0124“CE10.3.1.b：三角形预测单元模式”中有详细描述。GEO在以下论文：S.Esenlik、H.Gao、A.Filippov、V.Rufitskiy、A.M.Kotra、B.Wang、E.Alshina、M.和J.Sauer的文献JVET-O0489“非CE4：用于帧间块的几何分割”中进行了阐述。本发明中用于使TPM和/或GEO与WP协调的方法是在应用WP时禁用TPM和/或GEO。第一实施例如表6所示，可以通过检查编码单元的变量weightedPredFlag的值是否等于0来实现。变量weightedPredFlag推导如下：-如果slice_type等于P，则weightedPredFlag被设置为等于pps_weighted_pred_flag。-否则，如果slice_type等于B)，则weightedPredFlag被设置为等于pps_weighted_bipred_flag。条带级加权预测过程可以通过使用语法元素pps_weighted_pred_flag和sps_weighted_pred_flag分别在图像级和条带级之间进行切换。如上所述，变量weightedPredFlag表示是否可以在获得条带的帧间预测样本时使用条带级加权预测。表6：本发明中使TPM与WP协调的融合数据语法/＞ciip_flag表示帧间帧内联合融合预测模式是否应用于当前编码单元。阵列索引x0，y0表示所考虑的编码块的左上亮度样本相对于图像的左上亮度样本的位置。当ciip_flag不存在时，则ciip_flag推断如下：-如果以下所有条件均为true，则推断ciip_flag等于1：-sps_ciip_enabled_flag等于1；-general_merge_flag等于1；-merge_subblock_flag等于0；-regular_merge_flag等于0；-cbWidth小于128；-cbHeight小于128；-cbWidth*cbHeight大于或等于64。-否则，推断ciip_flag等于0。当ciip_flag等于1时，变量IntraPredModeY设置为等于INTRA_PLANAR，其中，x＝x0..x0+cbWidth-1，y＝y0..y0+cbHeight-1。变量MergeTriangleFlag表示基于三角形的运动补偿是否用于生成当前编码单元的预测样本，在解码B条带时，该变量推导如下：-如果以下所有条件均为true，则MergeTriangleFlag设置为等于1：-sps_triangle_enabled_flag等于1；-slice_type等于B；-general_merge_flag等于1；-MaxNumTriangleMergeCand大于或等于2；-cbWidth*cbHeight大于或等于64。-regular_merge_flag等于0；-merge_subblock_flag等于0；-ciip_flag等于0；-weightedPredFlag等于0。-否则，MergeTriangleFlag设置为等于0。第二实施例如表7所示。如果weightedPredFlag等于1，则语法元素max_num_merge_cand_minus_max_num_triangle_cand不存在，并且推断该语法元素具有一个值，使得MaxNumTriangleMergeCand小于2。表7：本发明中使TPM与WP协调的通用条带头语法/＞/＞/＞/＞/＞具体地，以下语义可以用于第二实施例：max_num_merge_cand_minus_max_num_triangle_cand表示从MaxNumMergeCand中减去条带中支持的三角融合模式候选的最大数量。当max_num_merge_cand_minus_max_num_triangle_cand不存在，sps_triangle_enabled_flag等于1，slice_type等于B，weightedPredFlag等于0，且MaxNumMergeCand大于或等于2时，则推断max_num_merge_cand_minus_max_num_triangle_cand等于pps_max_num_merge_cand_minus_max_num_triangle_cand_minus1+1。当max_num_merge_cand_minus_max_num_triangle_cand不存在，sps_triangle_enabled_flag等于1，slice_type等于B，weightedPredFlag等于1，且MaxNumMergeCand大于或等于2时，则推断max_num_merge_cand_minus_max_num_triangle_cand等于MaxNumMergeCand或MaxNumMergeCand-1。三角融合模式候选的最大数量MaxNumTriangleMergeCand推导如下：MaxNumTriangleMergeCand＝MaxNumMergeCand-max_num_merge_cand_minus_max_num_triangle_cand当max_num_merge_cand_minus_max_num_triangle_cand存在时，MaxNumTriangleMergeCand的取值范围可以为2至MaxNumMergeCand。当max_num_merge_cand_minus_max_num_triangle_cand不存在，且sps_triangle_enabled_flag等于0，或者MaxNumMergeCand小于2时，MaxNumTriangleMergeCand设置为等于0。当MaxNumTriangleMergeCand等于0时，不允许对当前条带使用三角融合模式。本发明公开的机制不仅适用于TPM和GEO，而且还适用于其它非矩形预测和分割模式，例如基于三角分割的帧内帧间联合预测模式。由于TPM和GEO只应用于B条带，因此上述实施例中的变量weightedPredFlag可以直接替换为变量pps_weighted_bipred_flag。第三实施例如表6所示，可以通过检查编码单元的变量weightedPredFlag的值是否等于0来实现。变量weightedPredFlag推导如下：-如果以下所有条件都为true，则weightedPredFlag设置为0：luma_weight_l0_flag等于0，其中，i的范围为0至NumRefIdxActive；luma_weight_l1_flag等于0，其中，i的范围为0至NumRefIdxActive；chroma_weight_l0_flag等于0，其中，i的范围为0至NumRefIdxActive；chroma_weight_l1_flag等于0，其中，i的范围为0至NumRefIdxActive。-否则，weightedPredFlag设置为1。weightedPredFlag的推导过程表示：如果亮度分量和色度分量的所有加权标志以及当前条带的所有参考索引的所有加权标志均为0，则加权预测对当前条带禁用；否则，加权预测可以用于当前条带。如上所述，变量weightedPredFlag表示是否可以在获得条带的帧间预测样本时使用条带级加权预测。第四实施例如表6所示，其中，weightedPredFlag替换为slice_weighted_pred_flag，而slice_weighted_pred_flag是在条带头中进行指示，如表8所示。如上所述，语法元素syntax slice_weighted_pred_flag表示是否可以在获得条带的帧间预测样本时使用条带级加权预测。表8：本发明中指示条带级加权预测标志的通用条带头语法/＞/＞/＞/＞/＞具体地，以下语义可以用于第四实施例：slice_weighted_pred_flag等于0表示加权预测不应用于当前条带，slice_weighted_pred_flag等于1表示加权预测应用于当前条带。当slice_weighted_pred_flag不存在时，则推断slice_weighted_pred_flag的值为0。第五实施例是通过一致性约束条件禁用块级TPM。对于TPM编码块，帧间预测值P0 710和P1 720对应的参考图像的亮度分量和色度分量的加权因子可以不存在。关于更多细节，refIdxA和predListFlagA分别表示帧间预测值P0的参考索引和参考图像列表；refIdxB和predListFlagB分别表示帧间预测值P1的参考索引和参考图像列表。变量lumaWeightedFlag和chromaWeightedFlag推导如下：lumaWeightedFlagA＝predListFlagA？luma_weight_l1_flag:luma_weight_l0_flaglumaWeightedFlagB＝predListFlagB？luma_weight_l1_flag:luma_weight_l0_flagchromaWeightedFlagA＝predListFlagA？chroma_weight_l1_flag:chroma_weight_l0_flagchromaWeightedFlagB＝predListFlagB？chroma_weight_l1_flag:chroma_weight_l0_flaglumaWeightedFlag＝lumaWeightedFlagA||lumaWeightedFlagBchromaWeightedFlag＝chromaWeightedFlagA||chromaWeightedFlagB码流一致性的要求为：lumaWeightedFlag和chromaWeightedFlag可以等于0。第六实施例是在使用显式加权预测时，对TPM编码块禁用混合加权样本预测过程。图7和图8分别说明了本发明中TPM和GEO的基本思想。需要说明的是，TPM的实施例也可以用于GEO模式。对于TPM编码块，如果帧间预测值P0 710或P1 720对应的参考图像的亮度分量或色度分量的加权因子存在，则使用基于WP参数的加权过程生成块的帧间预测值；否则，使用基于混合加权参数的加权过程生成块750的帧间预测值。如图9所示，帧间预测值901需要两个预测值P0 911和P1 912，这两个预测块具有重叠区域921，其中，非零权重应用于块911和912，以部分混合预测值P0 911和P1 912。在图9中，与块901相邻的块表示为块931、932、933、934、935和936。图8示出了TPM融合模式和GEO融合模式之间的区别。使用GEO融合模式时，预测值851和852之间的重叠区域不仅仅可以位于帧间预测块850的对角线上。可以通过从其它图像中复制块810和820来接收预测值P0 851和P1 852，而权重和偏移{w0,O0}830和{w1,O1}840可以分别应用于或者不应用于块810和820。关于更多细节，refIdxA和predListFlagA分别表示帧间预测值P0的参考索引和参考图像列表；refIdxB和predListFlagB分别表示帧间预测值P1的参考索引和参考图像列表。变量lumaWeightedFlag和chromaWeightedFlag推导如下：lumaWeightedFlagA＝predListFlagA？luma_weight_l1_flag:luma_weight_l0_flaglumaWeightedFlagB＝predListFlagB？luma_weight_l1_flag:luma_weight_l0_flagchromaWeightedFlagA＝predListFlagA？chroma_weight_l1_flag:chroma_weight_l0_flagchromaWeightedFlagB＝predListFlagB？chroma_weight_l1_flag:chroma_weight_l0_flaglumaWeightedFlag＝lumaWeightedFlagA||lumaWeightedFlagBchromaWeightedFlag＝chromaWeightedFlagA||chromaWeightedFlagB然后，如果lumaWeightedFlag为true，则调用显式加权过程；如果lumaWeightedFlag为false，则调用混合加权过程。此外，色度分量同样根据chromaWeightedFlag确定。在一个可选实施例中，考虑共同使用所有分量的加权标志。如果lumaWeightedFlag或chromaWeightedFlag中有一个为true，则调用显式加权过程；如果lumaWeightedFlag和chromaWeightedFalg均为false，则调用混合加权过程。使用双向预测机制进行预测的矩形块的显式加权过程执行如下：该过程的输入包括：-两个变量nCbW和nCbH，表示当前编码块的宽度和高度；-两个×阵列predSamplesA和predSamplesB；-预测列表标志predListFlagA和predListFlagB；-参考索引refIdxA和refIdxB；-变量cIdx，表示颜色分量索引；-样本位深度bitDepth。该过程的输出包括由预测样本值组成的×阵列pbSamples。变量shift1设置为等于Max。变量log2Wd、o0、o1、w0和w1推导如下：-如果亮度样本的cIdx等于0，则以下内容适用：log2Wd＝luma_log2_weight_denom+shift1w0＝predListFlagA？LumaWeightL1:LumaWeightL0w1＝predListFlagB？LumaWeightL1:LumaWeightL0o0＝＜＜o1＝＜＜-否则，如果色度样本的cIdx不等于0，则以下内容适用：log2Wd＝ChromaLog2WeightDenom+shift1w0＝predListFlagA？ChromaWeightL1:ChromaWeightL0w1＝predListFlagA？ChromaWeightL1:ChromaWeightL0o0＝＜＜o1＝＜＜预测样本pbSamples推导如下，其中，x＝0..nCbW-1，y＝0..nCbH-1：pbSamples＝Clip3-1,＜＜log2Wd))＞＞)条带级加权预测的参数可以表示为一组变量，这些变量被分配给参考图像列表中的每个元素。每个元素的索引进一步表示为“i”。这些参数可以包括：-LumaWeightL0；-luma_offset_l0表示应用于通过RefPicList进行列表0预测的亮度预测值的附加偏移。luma_offset_l0的取值范围可以为-128至127。当luma_weight_l0_flag等于0时，则推断luma_offset_l0等于0。变量LumaWeightL0推导为等于+delta_luma_weight_l0。当luma_weight_l0_flag等于1时，delta_luma_weight_l0的取值范围可以为-128至127。当luma_weight_l0_flag等于0时，则推断LumaWeightL0等于2luma_log2_weight_denom。使用双向预测机制进行预测的矩形块的混合加权过程执行如下：该过程的输入包括：-两个变量nCbW和nCbH，表示当前编码块的宽度和高度；-两个×阵列predSamplesLA和predSamplesLB；-变量triangleDir，表示分割方向；-变量cIdx，表示颜色分量索引。该过程的输出包括由预测样本值组成的×阵列pbSamples。变量nCbR推导如下：nCbR＝？:变量bitDepth推导如下：-如果cIdx等于0，则bitDepth设置为等于BitDepthY。-否则，bitDepth设置为等于BitDepthC。变量shift1和offset1推导如下：-变量shift1设置为等于Max；-变量offset1设置为等于1＜＜。根据triangleDir、wS和cIdx的值，预测样本pbSamples推导如下，其中，x＝0..nCbW-1，y＝0..nCbH-1：-变量wIdx推导如下：-如果cIdx等于0，且triangleDir等于0，则以下内容适用：wIdx＝？+4)):+4))-否则，如果cIdx等于0，且triangleDir等于1，则以下内容适用：wIdx＝？+4)):+4))-否则，如果cIdx大于0，且triangleDir等于0，则以下内容适用：wIdx＝？+2)):+2))-否则，如果cIdx大于0，且triangleDir等于1，则以下内容适用：wIdx＝？+2)):+2))-表示预测样本权重的变量wValue通过wIdx和cIdx推导如下：wValue＝？Clip3:Clip3-预测样本值推导如下：pbSamples＝Clip3-1,+offset1)＞＞shift1)对于几何模式，使用双向预测机制进行预测的矩形块的混合加权过程执行如下：该过程的输入包括：-两个变量nCbW和nCbH，表示当前编码块的宽度和高度；-两个×阵列predSamplesLA和predSamplesLB；-变量angleIdx，表示几何分割的角度索引；-变量distanceIdx，表示几何分割的距离索引；-变量cIdx，表示颜色分量索引。该过程的输出包括由预测样本值组成的×阵列pbSamples和变量partIdx。变量bitDepth推导如下：-如果cIdx等于0，则bitDepth设置为等于BitDepthY。-否则，bitDepth设置为等于BitDepthC。变量shift1和offset1推导如下：-变量shift1设置为等于Max；-变量offset1设置为等于1＜＜。亮度的权重阵列sampleWeightL和色度的权重阵列sampleWeightC推导如下，其中，x＝0..nCbW-1，y＝0..nCbH-1：以下变量的值设置如下：-hwRatio设置为nCbH/nCbW；-displacementX设置为angleIdx；-displacementY设置为％32-partIdx设置为angleIdx＞＝13&amp;&amp;angleIdx＜＝27？1:0；-rho通过表示为Dis的查找表设置为以下值：rho＝+如果以下条件的其中一个条件为true，则变量shiftHor设置为等于0：angleIdx％16等于8；angleIdx％16不等于0，且hwRatio≥1。否则，shiftHor设置为等于1。如果shiftHor等于0，则offsetX和offsetY推导如下：offsetX＝＞＞1offsetY＝＞＞1+angleIdx＜16？＞＞3:-＞＞3)否则，如果shiftHor等于1，则offsetX和offsetY推导如下：offsetX＝＞＞1+angleIdx＜16？＞＞3:-＞＞3)offsetY＝＞＞1变量weightIdx和weightIdxAbs通过查找表计算如下，其中，x＝0..nCbW-1，y＝0..nCbH-1：weightIdx＝＜＜1)+1)*Dis+＜＜1)+1))*Dis-rhoweightIdxAbs＝Clip3)sampleWeightL的值根据表示为GeoFilter的表10设置如下，其中，x＝0..nCbW-1，y＝0..nCbH-1：sampleWeightL＝weightIdx＜＝0？GeoFilter:8-GeoFiltersampleWeightC的值设置如下，其中，x＝0..nCbW-1，y＝0..nCbH-1：sampleWeightC＝sampleWeightL说明：样本sampleWeightL的值也可以根据sampleWeightL推导出。如果angleIdx大于4小于12，或者angleIdx大于20小于24，则shiftX等于划分角度的正切，shiftY等于1；否则，shiftX等于1，shiftY等于划分角度的余切。如果正切值为无穷大，则shiftX等于1，或者shiftY等于0。预测样本值推导如下，其中，X表示为L或C，cIdx等于0或不等于0：pbSamples＝partIdx？Clip3-1,+predSamplesLB*sampleWeightX+off set1)＞＞shift1):Clip3-1,+off set1)＞＞shift1)表9：用于推导几何分割距离的查找表Disidx0124678910121415Dis8888420-2-4-8-8-8idx161718202223242526283031Dis-8-8-8-8-4-2024888表10：用于推导几何分割滤波器权重的滤波器权重查找表GeoFilteridx012345678910111213GeoFilter44445555555666idx14151617181920212223242526GeoFilter6666777777778在VVC规范草案7)”，本文档包含在文件JVET-P2001-v14中：http://phenix.it-sudparis.eu/jvet/doc_end_user/documents/16_Geneva/wg11/JVET-P2001-v14.zip)中，引入了图像头的概念，从而将部分语法元素从条带头中移出到PH中，以减少由于为PH关联的每个SH中的相同语法元素分配相等或相似的值而造成的信令开销。如表11所示，用于控制TPM融合模式的融合候选的最大数量的语法元素在PH中进行指示，而如表12和表14所示，加权预测参数仍然在SH中进行指示。表12和表13中使用的语法元素的语义描述如下：表11：图像头RBSP语法图像头RBSP语义PH包括与PH关联的编码图像的所有条带共用的信息。non_reference_picture_flag等于1表示与PH关联的图像永不用作参考图像，non_reference_picture_flag等于0表示与PH关联的图像可以用作参考图像，也可以不用作参考图像。gdr_pic_flag等于1表示与PH关联的图像是逐步解码刷新图像，gdr_pic_flag等于0表示与PH关联的图像不是GDR图像。如果解码了不是码流中第一个图像的编码层视频序列起始图像，则no_output_of_prior_pics_flag会影响解码图像缓冲区中先前经解码的图像的输出。recovery_poc_cnt表示按输出顺序的解码图像的恢复点。如果当前图像是与PH关联的GDR图像，并且编码层视频序列中存在按解码顺序位于当前GDR图像之后的图像picA，而且该图像picA的PicOrderCntVal等于当前GDR图像的PicOrderCntVal加recovery_poc_cnt的值，则该图像picA称为恢复点图像。否则，将按输出顺序的PicOrderCntVal大于当前图像的PicOrderCntVal加recovery_poc_cnt的值的第一个图像称为恢复点图像。恢复点图像按解码顺序不可以位于当前GDR图像之前。recovery_poc_cnt的取值范围可以为0至MaxPicOrderCntLsb-1。说明1：当gdr_enabled_flag等于1，且当前图像的PicOrderCntVal大于或等于关联的GDR图像的RpPicOrderCntVal时，按输出顺序的当前经解码图像和后续经解码图像与从前一帧内随机接入点图像开始执行解码过程而产生的对应图像精确匹配。ph_pic_parameter_set_id表示当前正在使用的PPS的pps_pic_parameter_set_id的值。ph_pic_parameter_set_id的取值范围可以为0至63。码流一致性的要求为：PH的TemporalId的值应大于或等于pps_pic_parameter_set_id等于ph_pic_parameter_set_id的图像参数集的TemporalId的值。sps_poc_msb_flag等于1表示语法元素ph_poc_msb_cycle_present_flag存在于参考参考序列参数集的PH中，sps_poc_msb_flag等于0表示语法元素ph_poc_msb_cycle_present_flag不存在于参考SPS的PH中。ph_poc_msb_present_flag等于1表示语法元素poc_msb_val存在于PH中，ph_poc_msb_present_flag等于0表示语法元素poc_msb_val不存在于PH中。当vps_independent_layer_flag]等于0，且当前层的参考层中的当前接入单元中存在图像时，ph_poc_msb_present_flag的值可以等于0。poc_msb_val表示当前图像的图像顺序编号的最高有效位的值。语法元素poc_msb_val的长度为个比特。sps_triangle_enabled_flag表示基于三角形的运动补偿是否可以用于帧间预测。sps_triangle_enabled_flag等于0表示语法可以被约束为使得基于三角形的运动补偿不用于编码层视频序列中且merge_triangle_split_dir、merge_triangle_idx0和merge_triangle_idx1不存在于CLVS的编码单元语法中，sps_triangle_enabled_flag等于1表示基于三角形的运动补偿可以用于CLVS中。pps_max_num_merge_cand_minus_max_num_triangle_cand_plus1等于0表示pic_max_num_merge_cand_minus_max_num_triangle_cand存在于参考图像参数集的条带的PH中，pps_max_num_merge_cand_minus_max_num_triangle_cand_plus1大于0表示pic_max_num_merge_cand_minus_max_num_triangle_cand不存在于参考PPS的PH中。pps_max_num_merge_cand_minus_max_num_triangle_cand_plus1的取值范围可以为0至MaxNumMergeCand-1。pps_max_num_merge_cand_minus_max_num_triangle_cand_plus1等于0表示pic_max_num_merge_cand_minus_max_num_triangle_cand存在于参考PPS的条带的PH中，pps_max_num_merge_cand_minus_max_num_triangle_cand_plus1大于0表示pic_max_num_merge_cand_minus_max_num_triangle_cand不存在于参考PPS的PH中。pps_max_num_merge_cand_minus_max_num_triangle_cand_plus1的取值范围可以为0至MaxNumMergeCand-1。pic_six_minus_max_num_merge_cand表示从6中减去与PH关联的条带中支持的融合运动矢量预测候选的最大数量。融合MVP候选的最大数量MaxNumMergeCand推导如下：MaxNumMergeCand＝6-picsix_minus_max_num_merge_candMaxNumMergeCand的取值范围可以为1至6。当pic_six_minus_max_num_merge_cand不存在时，则推断pic_six_minus_max_num_merge_cand的值等于pps_six_minus_max_num_merge_cand_plus1-1。表12：通用条带头语法/＞通用条带头语义当条带头语法元素slice_pic_order_cnt_lsb存在时，该语法元素的值对于编码图像的所有条带头是相同的。变量CuQpDeltaVal表示包括cu_qp_delta_abs的编码单元的亮度量化参数与其预测参数之间的差值，该变量设置为等于0。变量CuQpOffsetCb、CuQpOffsetCr和CuQpOffsetCbCr分别表示为包括cu_chroma_qp_offset_flag的编码单元确定量化参数Qp′Cb、Qp′Cr和Qp′CbCr的值时所使用的值，这些变量均设置为等于0。slice_pic_order_cnt_lsb表示当前图像的图像顺序编号对MaxPicOrderCntLsb取模。语法元素slice_pic_order_cnt_lsb的长度为个比特。slice_pic_order_cnt_lsb的取值范围可以为0至MaxPicOrderCntLsb-1。当前图像是GDR图像时，变量RpPicOrderCntVal推导如下：RpPicOrderCntVal＝PicOrderCntVal+recovery_poc_cntslice_subpic_id表示包括条带的子图像的子图像标识符。如果slice_subpic_id存在，则推导变量SubPicIdx的值，使得SubpicIdList等于slice_subpic_id。否则，如果slice_subpic_id不存在，则推导变量SubPicIdx等于0。slice_subpic_id的长度推导如下：-如果sps_subpic_id_signalling_present_flag等于1，则slice_subpic_id的长度等于sps_subpic_id_len_minus1+1。-否则，如果ph_subpic_id_signalling_present_flag等于1，则slice_subpic_id的长度等于ph_subpic_id_len_minus1+1。-否则，如果pps_subpic_id_signalling_present_flag等于1，则slice_subpic_id的长度等于pps_subpic_id_len_minus1+1。-否则，slice_subpic_id的长度等于Ceil)。slice_address表示条带的条带地址。当slice_address不存在时，则推断slice_address的值等于0。如果rect_slice_flag等于0，则以下内容适用：-条带地址是光栅扫描分块的索引。-slice_address的长度为Ceil)个比特。-slice_address的取值范围可以为0至NumTilesInPic-1。否则，如果rect_slice_flag等于1，则以下内容适用：-条带地址是第SubPicIdx个子图像内的条带的条带索引。-slice_address的长度为Ceil)个比特。-slice_address的取值范围可以为0至NumSlicesInSubpic-1。码流一致性的要求为以下约束条件适用：-如果rect_slice_flag等于0，或者subpics_present_flag等于0，则slice_address的值可以不等于同一编码图像的任何其它译码条带网络抽象层单元的slice_address的值。-否则，slice_subpic_id和slice_address的一对值可以不等于同一编码图像的任何其它译码条带NAL单元的slice_subpic_id和slice_address的一对值。-当rect_slice_flag等于0时，图像中的条带可以按照条带的slice_address值升序排列。-图像中的条带的形状可以使得每个编码树单元在解码时，可以使每个编码树单元的整个左边界和整个上边界由图像边界组成或由先前一个或多个经解码的CTU的边界组成。num_tiles_in_slice_minus1+1表示条带中的分块的数量。num_tiles_in_slice_minus1的取值范围可以为0至NumTilesInPic-1。变量NumCtuInCurrSlice表示当前条带中的CTU的数量，列表CtbAddrInCurrSlice)表示条带内的第i个编码树块的图像光栅扫描地址，变量NumCtuInCurrSlice和列表CtbAddrInCurrSlice推导如下：变量SubPicLeftBoundaryPos、SubPicTopBoundaryPos、SubPicRightBoundaryPos和SubPicBotBoundaryPos推导如下：slice_type表示条带的编码类型，如表13所示。表13：名称与slice_type的关联关系slice_typeslice_type的名称slice_typeslice_type的名称0B1P2Islice_rpl_sps_flag等于1表示当前条带的参考图像列表i是根据SPS中listIdx等于i的多个语法结构ref_pic_list_struct中的一个语法结构推导的，slice_rpl_sps_flag等于0表示当前条带的参考图像列表i是根据直接包含在当前图像的条带头中的listIdx等于i的语法结构ref_pic_list_struct推导的。当slice_rpl_sps_flag不存在时，以下内容适用：-如果pic_rpl_present_flag等于1，则推断slice_rpl_sps_flag的值等于pic_rpl_sps_flag。-否则，如果num_ref_pic_lists_in_sps等于0，则推断ref_pic_list_sps_flag的值等于0。-否则，如果num_ref_pic_lists_in_sps大于0，且rpl1_idx_present_flag等于0，则推断slice_rpl_sps_flag的值等于slice_rpl_sps_flag。slice_rpl_idx表示用于推导当前图像的参考图像列表i的listIdx等于i的语法结构ref_pic_list_struct在SPS中包括的listIdx等于i的语法结构ref_pic_list_struct的列表中的索引。语法元素slice_rpl_idx通过Ceil)个比特表示。当slice_rpl_idx不存在时，则推断slice_rpl_idx的值等于0。slice_rpl_idx的取值范围可以为0到num_ref_pic_lists_in_sps-1。如果slice_rpl_sps_flag等于1，且num_ref_pic_lists_in_sps等于1，则推断slice_rpl_idx的值等于0。如果slice_rpl_sps_flag等于1，且rpl1_idx_present_flag等于0，则推断slice_rpl_idx的值等于slice_rpl_idx。变量RplsIdx推导如下：if RplsIdx＝PicRplsIdxelseRplsIdx＝slice_rpl_sps_flag？slice_rpl_idx:num_ref_pic_lists_in_spsslice_poc_lsb_lt表示第i个参考图像列表中的第j个LTRP条目的图像顺序编号对MaxPicOrderCntLsb取模的值。语法元素slice_poc_lsb_lt的长度为个比特。变量PocLsbLt推导如下：ifPocLsbLt＝PicPocLsbLtelsePocLsbLt＝ltrp_in_slice_header_flag]？slice_poc_lsb_lt:rpls_poc_lsb_lt]slice_delta_poc_msb_present_flag等于1表示slice_delta_poc_msb_cycle_lt存在，slice_delta_poc_msb_present_flag等于0表示slice_delta_poc_msb_cycle_lt不存在。假设prevTid0Pic为按解码顺序排列的前一个图像，该前一个图像与当前图像具有相同的nuh_layer_id，该前一个图像的TemporalId等于0，并且该前一个图像不是跳过随机接入前置图像或可解码随机接入前置图像。假设setOfPrevPocVals为以下内容组成的集合：-prevTid0Pic的PicOrderCntVal，-由prevTid0Pic的RefPicList或RefPicList中的条目参考并且与当前图像具有相同nuh_layer_id的每个图像的PicOrderCntVal，-按解码顺序位于prevTid0Pic之后、与当前图像具有相同nuh_layer_id并且按解码顺序位于当前图像之前的每个图像的PicOrderCntVal。当pic_rpl_present_flag等于0，且setOfPrevPocVals中存在多个值时，slice_delta_poc_msb_present_flag的值可以等于1。slice_delta_poc_msb_cycle_lt表示变量FullPocLt的值，如下所示：slice_delta_poc_msb_cycle_lt的取值范围可以为0至2。如果slice_delta_poc_msb_cycle_lt不存在，则推断slice_delta_poc_msb_cycle_lt的值等于0。num_ref_idx_active_override_flag等于1表示对于P条带和B条带存在语法元素num_ref_idx_active_minus1，并表示对B条带存在语法元素num_ref_idx_active_minus1；num_ref_idx_active_override_flag等于0表示语法元素num_ref_idx_active_minus1和num_ref_idx_active_minus1不存在。当num_ref_idx_active_override_flag不存在时，则推断num_ref_idx_active_override_flag的值等于1。num_ref_idx_active_minus1用于推导等式145中所示的变量NumRefIdxActive。num_ref_idx_active_minus1的取值范围可以为0至14。当i等于0或1时，如果当前条带为B条带，num_ref_idx_active_override_flag等于1，且num_ref_idx_active_minus1不存在时，则推断num_ref_idx_active_minus1等于0。如果当前条带为P条带，num_ref_idx_active_override_flag等于1，且num_ref_idx_active_minus1不存在时，则推断num_ref_idx_active_minus1等于0。变量NumRefIdxActive推导如下：NumRefIdxActive-1的值表示可以用于解码条带的参考图像列表i的最大参考索引。当NumRefIdxActive的值等于0时，参考图像列表i中的参考索引不可以用于解码条带。如果当前条带为P条带，NumRefIdxActive的值应大于0。如果当前条带为B条带，NumRefIdxActive和NumRefIdxActive均应大于0。表14：加权预测参数语法/＞加权预测参数语义luma_log2_weight_denom表示所有亮度加权因子的分母以2为底的对数。luma_log2_weight_denom的取值范围可以为0至7。delta_chroma_log2_weight_denom表示所有色度加权因子的分母以2为底的对数的差值。当delta_chroma_log2_weight_denom不存在时，则推断delta_chroma_log2_weight_denom等于0。变量ChromaLog2WeightDenom推导为等于luma_log2_weight_denom+delta_chroma_log2_weight_denom，该变量的取值范围可以为0至7。luma_weight_l0_flag等于1表示存在通过RefPicList进行列表0预测的亮度分量的加权因子，luma_weight_l0_flag等于0表示不存在这些加权因子。chroma_weight_l0_flag等于1表示存在通过RefPicList进行列表0预测的色度预测值的加权因子，chroma_weight_l0_flag等于0表示不存在这些加权因子。当chroma_weight_l0_flag不存在时，则推断chroma_weight_l0_flag等于0。delta_luma_weight_l0表示应用于通过RefPicList进行列表0预测的亮度预测值的加权因子的差值。变量LumaWeightL0推导为等于+delta_luma_weight_l0。当luma_weight_l0_flag等于1时，delta_luma_weight_l0的取值范围可以为-128至127。当luma_weight_l0_flag等于0时，则推断LumaWeightL0等于2luma_log2_weight_denom。luma_offset_l0表示应用于通过RefPicList进行列表0预测的亮度预测值的附加偏移。luma_offset_l0的取值范围可以为-128至127。当luma_weight_l0_flag等于0时，则推断luma_offset_l0等于0。delta_chroma_weight_l0表示应用于通过RefPicList进行列表0预测的色度预测值的加权因子的差值，其中，对于Cb，j等于0，对于Cr，j等于1。变量ChromaWeightL0推导为等于+delta_chroma_weight_l0。当chroma_weight_l0_flag等于1时，delta_chroma_weight_l0的取值范围可以为-128至127。当chroma_weight_l0_flag等于0时，则推断ChromaWeightL0等于2ChromaLog2WeightDenom。delta_chroma_offset_l0表示应用于通过RefPicList进行列表0预测的色度预测值的附加偏移的差值，其中，对于Cb，j等于0，对于Cr，j等于1。变量ChromaOffsetL0推导如下：ChromaOffsetL0＝Clip3＞＞ChromaLog2WeightDenom)))delta_chroma_offset_l0的取值范围可以为-4*128至4*127。当chroma_weight_l0_flag等于0时，则推断ChromaOffsetL0等于0。luma_weight_l1_flag、chroma_weight_l1_flag、delta_luma_weight_l1、luma_offset_l1、delta_chroma_weight_l1和delta_chroma_offset_l1分别与luma_weight_l0_flag、chroma_weight_l0_flag、delta_luma_weight_l0、luma_offset_l0、delta_chroma_weight_l0和delta_chroma_offset_l0具有相同的语义，其中，l0、L0、列表0和List0分别由l1、L1、列表1和List1替代。变量sumWeightL0Flags推导为等于luma_weight_l0_flag+2*chroma_weight_l0_flag之和，其中，i＝0..NumRefIdxActive-1。当slice_type等于B时，则推导变量sumWeightL1Flags等于luma_weight_l1_flag+2*chroma_weight_l1_flag之和，其中，i＝0..NumRefIdxActive-1。码流一致性的要求为：当slice_type等于P时，sumWeightL0Flags应小于或等于24；当slice_type等于B时，sumWeightL0Flags与sumWeightL1Flags之和应小于或等于24。参考图像列表结构语义语法结构ref_pic_list_struct可以存在于SPS中，或者可以存在于条带头中。根据该语法结构是包含在条带头中还是包含在SPS中，以下内容适用：-如果语法结构ref_pic_list_struct存在于条带头中，则该语法结构表示当前图像的参考图像列表listIdx。-否则，如果语法结构ref_pic_list_struct存在于SPS中，则该语法结构表示参考图像列表listIdx的候选。本节其余内容指定的语义中的术语“当前图像”是指：包括一个或多个条带的每个图像，其中，一个或多个条带包括的ref_pic_list_idx等于SPS中包括的语法结构ref_pic_list_struct的列表中的索引，参考SPS的编码视频序列中的每个图像。num_ref_entries表示语法结构ref_pic_list_struct中的条目的数量。num_ref_entries的取值范围可以为0至MaxDecPicBuffMinus1+14。ltrp_in_slice_header_flag等于0表示语法结构ref_pic_list_struct中的长期参考图像条目的POC LSB存在于语法结构ref_pic_list_struct中，ltrp_in_slice_header_flag等于1表示语法结构ref_pic_list_struct中的LTRP条目的POC LSB不存在于语法结构ref_pic_list_struct中。inter_layer_ref_pic_flag等于1表示语法结构ref_pic_list_struct中的第i个条目是层间参考图像条目，inter_layer_ref_pic_flag等于0表示语法结构ref_pic_list_struct中的第i个条目不是ILRP条目。当inter_layer_ref_pic_flag不存在时，则推断inter_layer_ref_pic_flag的值等于0。st_ref_pic_flag等于1表示语法结构ref_pic_list_struct中的第i个条目是STRP条目，st_ref_pic_flag等于0表示语法结构ref_pic_list_struct中的第i个条目是LTRP条目。当inter_layer_ref_pic_flag等于0，且st_ref_pic_flag不存在时，则推断st_ref_pic_flag的值等于1。变量NumLtrpEntries推导如下：forifNumLtrpEntries++abs_delta_poc_st表示变量AbsDeltaPocSt的值，具体如下所述：ifAbsDeltaPocSt＝abs_delta_poc_stelseAbsDeltaPocSt＝abs_delta_poc_st+1abs_delta_poc_st的取值范围可以为0至215-1。strp_entry_sign_flag等于1表示语法结构ref_pic_list_struct中的第i个条目的值大于或等于0，strp_entry_sign_flag等于0表示语法结构ref_pic_list_struct中的第i个条目的值小于0。当strp_entry_sign_flag不存在时，则推断strp_entry_sign_flag的值等于1。列表DeltaPocValSt推导如下：forifDeltaPocValSt＝？AbsDeltaPocSt:0-AbsDeltaPocStrpls_poc_lsb_lt表示由语法结构ref_pic_list_struct中第i个条目参考的图像的图像顺序编号对MaxPicOrderCntLsb取模的值。语法元素rpls_poc_lsb_lt的长度为个比特。ilrp_idx表示语法结构ref_pic_list_struct中的第i个条目的ILRP在直接参考层的列表中的索引。ilrp_idx的取值范围可以为0至NumDirectRefLayers]-1。因此，可以使用不同的机制控制GEO/TPM融合模式，这取决于WP是否应用于通过以下方式获得参考块P0和P1的参考图像：-将表14中列举出的WP参数从SH移动到PH中；-将GEO/TPM参数从PH移回到SH中；-改变MaxNumTriangleMergeCand的语义，即，当可以使用经过WP的参考图像)时，将这些条带的MaxNumTriangleMergeCand设置为等于0或1。对于TPM融合模式，参考块P0和P1在图7中例如分别表示为710和720。对于GEO融合模式，参考块P0和P1在图8中例如分别表示为810和820。在一个实施例中，当在图像头中指示启用非矩形模式和指示WP参数时，可以使用以下语法，如下表所示：表11：图像头RBSP语法/＞/＞……当luma_weight_l0_flag、chroma_weight_l0_flag、luma_weight_l1_flag和chroma_weight_l1_flag的值均设置为0时，变量WPDisabled设置为等于1，其中，i＝0..NumRefIdxActive，j＝0..NumRefIdxActive；否则，WPDisabled的值设置为等于0。当变量WPDisabled设置为等于0时，pic_max_num_merge_cand_minus_max_num_triangle_cand的值设置为等于MaxNumMergeCand。在第二实施例中，在条带头中指示WP参数和指示启用非矩形模式。下表示出了示例性语法。/＞/＞/＞/＞/＞……当luma_weight_l0_flag、chroma_weight_l0_flag、luma_weight_l1_flag和chroma_weight_l1_flag的值均设置为0时，变量WPDisabled设置为等于1，其中，i＝0..NumRefIdxActive，j＝0..NumRefIdxActive；否则，WPDisabled的值设置为等于0。当变量WPDisabled设置为等于0时，max_num_merge_cand_minus_max_num_triangle_cand的值设置为等于MaxNumMergeCand。在上述公开的实施例中，加权预测参数可以在图像头或条带头中进行指示。在第三实施例中，在考虑到针对块可以用于进行非矩形加权预测的情况的参考图像列表的同时，确定是启用TPM模式，还是启用GEO模式。当块的融合列表只包括一个参考图像列表k中的元素时，可以通过变量WPDisabled的值确定是否启用该融合模式。在第四实施例中，对非矩形帧间预测模式下的融合列表进行构造，使得该融合列表只包括未启用加权预测的元素。本说明书的以下部分通过举例阐述第四实施例：该过程的输入包括：-当前亮度编码块的左上样本相对于当前图像的左上亮度样本的亮度位置；-变量cbWidth，表示当前编码块的宽度，以亮度样本为单位；-变量cbHeight，表示当前编码块的高度，以亮度样本为单位。该过程的输出如下所述，其中，X为0或1：-相邻编码单元的可用性标志availableFlagA0、availableFlagA1、availableFlagB0、availableFlagB1和availableFlagB2；-相邻编码单元的参考索引refIdxLXA0、refIdxLXA1、refIdxLXB0、refIdxLXB1和refIdxLXB2；-相邻编码单元的预测列表使用标志predFlagLXA0、predFlagLXA1、predFlagLXB0、predFlagLXB1和predFlagLXB2；-相邻编码单元的1/16分数样本精度的运动矢量mvLXA0、mvLXA1、mvLXB0、mvLXB1和mvLXB2；-半样本插值滤波器索引hpelIfIdxA0、hpelIfIdxA1、hpelIfIdxB0、hpelIfIdxB1和hpelIfIdxB2；-双向预测权重索引bcwIdxA0、bcwIdxA1、bcwIdxB0、bcwIdxB1和bcwIdxB2。对于availableFlagB1、refIdxLXB1、predFlagLXB1、mvLXB1、hpelIfIdxB1和bcwIdxB1的推导，以下内容适用：-相邻亮度编码块内的亮度位置设置为等于。-调用第6.4.4节中指定的相邻块可用性的推导过程，其中，设置为等于的当前亮度位置、相邻亮度位置、设置为等于TRUE的checkPredModeY和设置为等于0的cIdx作为输入，并将输出赋值给块可用性标志availableB1。-变量availableFlagB1、refIdxLXB1、predFlagLXB1、mvLXB1、hpelIfIdxB1和bcwIdxB1推导如下：-如果availableB1等于FALSE，则availableFlagB1设置为等于0，mvLXB1的两个分量均设置为等于0，refIdxLXB1设置为等于-1，predFlagLXB1设置为等于0，hpelIfIdxB1设置为等于0，bcwIdxB1设置为等于0。-否则，availableFlagB1设置为等于1，并进行以下赋值：mvLXB1 ＝ MvLX refIdxLXB1 ＝ RefIdxLX predFlagLXB1 ＝ PredFlagLX hpelIfIdxB1 ＝ HpelIfIdx bcwIdxB1 ＝ BcwIdx 对于availableFlagA1、refIdxLXA1、predFlagLXA1、mvLXA1、hpelIfIdxA1和bcwIdxA1的推导，以下内容适用：-相邻亮度编码块内的亮度位置设置为等于。-调用第6.4.4节中指定的相邻块可用性的推导过程，其中，设置为等于的当前亮度位置、相邻亮度位置、设置为等于TRUE的checkPredModeY和设置为等于0的cIdx作为输入，并将输出赋值给块可用性标志availableA1。-变量availableFlagA1、refIdxLXA1、predFlagLXA1、mvLXA1、hpelIfIdxA1和bcwIdxA1推导如下：-如果以下一个或多个条件为true，则availableFlagA1设置为等于0，mvLXA1的两个分量均设置为等于0，refIdxLXA1设置为等于-1，predFlagLXA1设置为等于0，hpelIfIdxA1设置为等于0，且bcwIdxA1设置为等于0：-availableA1等于FALSE；-availableB1等于TRUE，亮度位置和具有相同的运动矢量和相同的参考索引；-WPDisabledX]设置为0，融合模式为非矩形融合模式上设置为等于1)；-WPDisabledX]设置为0，融合模式为非矩形融合模式上设置为等于1)。-否则，availableFlagA1设置为等于1，并进行以下赋值：mvLXA1 ＝ MvLX refIdxLXA1 ＝ RefIdxLX predFlagLXA1 ＝ PredFlagLX hpelIfIdxA1 ＝ HpelIfIdx bcwIdxA1 ＝ BcwIdx 对于availableFlagB0、refIdxLXB0、predFlagLXB0、mvLXB0、hpelIfIdxB0和bcwIdxB0的推导，以下内容适用：-相邻亮度编码块内的亮度位置设置为等于。-调用第6.4.4节中指定的相邻块可用性的推导过程，其中，设置为等于的当前亮度位置、相邻亮度位置、设置为等于TRUE的checkPredModeY和设置为等于0的cIdx作为输入，并将输出赋值给块可用性标志availableB0。-变量availableFlagB0、refIdxLXB0、predFlagLXB0、mvLXB0、hpelIfIdxB0和bcwIdxB0推导如下：-如果以下一个或多个条件为true，则availableFlagB0设置为等于0，mvLXB0的两个分量均设置为等于0，refIdxLXB0设置为等于-1，predFlagLXB0设置为等于0，hpelIfIdxB0设置为等于0，且bcwIdxB0设置为等于0：-availableB0等于FALSE；-availableB1等于TRUE，亮度位置和具有相同的运动矢量和相同的参考索引；-WPDisabledX]设置为0，融合模式为非矩形融合模式上设置为等于1)；-WPDisabledX]设置为0，融合模式为非矩形融合模式上设置为等于1)。-否则，availableFlagB0设置为等于1，并进行以下赋值：mvLXB0 ＝ MvLX refIdxLXB0 ＝ RefIdxLX predFlagLXB0 ＝ PredFlagLX hpelIfIdxB0 ＝ HpelIfIdx bcwIdxB0 ＝ BcwIdx 对于availableFlagA0、refIdxLXA0、predFlagLXA0、mvLXA0、hpelIfIdxA0和bcwIdxA0的推导，以下内容适用：-相邻亮度编码块内的亮度位置设置为等于。-调用第6.4.4节中指定的相邻块可用性的推导过程，其中，设置为等于的当前亮度位置、相邻亮度位置、设置为等于TRUE的checkPredModeY和设置为等于0的cIdx作为输入，并将输出赋值给块可用性标志availableA0。-变量availableFlagA0、refIdxLXA0、predFlagLXA0、mvLXA0、hpelIfIdxA0和bcwIdxA0推导如下：-如果以下一个或多个条件为true，则availableFlagA0设置为等于0，mvLXA0的两个分量均设置为等于0，refIdxLXA0设置为等于-1，predFlagLXA0设置为等于0，hpelIfIdxA0设置为等于0，且bcwIdxA0设置为等于0：-availableA0等于FALSE；-availableA1等于TRUE，亮度位置和具有相同的运动矢量和相同的参考索引；-WPDisabledX]设置为0，融合模式为非矩形融合模式上设置为等于1)；-WPDisabledX]设置为0，融合模式为非矩形融合模式上设置为等于1)。-否则，availableFlagA0设置为等于1，并进行以下赋值：mvLXA0 ＝ MvLX refIdxLXA0 ＝ RefIdxLX predFlagLXA0 ＝ PredFlagLX hpelIfIdxA0 ＝ HpelIfIdx bcwIdxA0 ＝ BcwIdx 对于availableFlagB2、refIdxLXB2、predFlagLXB2、mvLXB2、hpelIfIdxB2和bcwIdxB2的推导，以下内容适用：-相邻亮度编码块内的亮度位置设置为等于。-调用第6.4.4节中指定的相邻块可用性的推导过程，其中，设置为等于的当前亮度位置、相邻亮度位置、设置为等于TRUE的checkPredModeY和设置为等于0的cIdx作为输入，并将输出赋值给块可用性标志availableB2。-变量availableFlagB2、refIdxLXB2、predFlagLXB2、mvLXB2、hpelIfIdxB2和bcwIdxB2推导如下：-如果以下一个或多个条件为true，则availableFlagB2设置为等于0，mvLXB2的两个分量均设置为等于0，refIdxLXB2设置为等于-1，predFlagLXB2设置为等于0，hpelIfIdxB2设置为等于0，且bcwIdxB2设置为等于0：-availableB2等于FALSE；-availableA1等于TRUE，亮度位置和具有相同的运动矢量和相同的参考索引；-availableB1等于TRUE，亮度位置和具有相同的运动矢量和相同的参考索引；-availableFlagA0+availableFlagA1+availableFlagB0+availableFlagB1等于4；-WPDisabledX]设置为0，融合模式为非矩形融合模式上设置为等于1)；-WPDisabledX]设置为0，融合模式为非矩形融合模式上设置为等于1)。-否则，availableFlagB2设置为等于1，并进行以下赋值：mvLXB2 ＝ MvLX refIdxLXB2 ＝ RefIdxLX predFlagLXB2 ＝ PredFlagLX hpelIfIdxB2 ＝ HpelIfIdx bcwIdxB2 ＝ BcwIdx 在上述公开的实施例中，使用以下变量定义：当luma_weight_l0_flag和chroma_weight_l0_flag的值均设置为0时，变量WPDisabled0设置为等于1，其中，i＝0..NumRefIdxActive。否则，WPDisabled0的值设置为等于0。当luma_weight_l1_flag和chroma_weight_l1_flag的值均设置为0时，变量WPDisabled1设置为等于1，其中，i＝0..NumRefIdxActive。否则，WPDisabled1的值设置为等于0。在另一个实施例中，根据以下条件的其中一个条件，在条带头中定义变量SliceMaxNumTriangleMergeCand：-SliceMaxNumTriangleMergeCand＝？0:MaxNumTriangleMergeCand-SliceMaxNumTriangleMergeCand＝？1:MaxNumTriangleMergeCand-SliceMaxNumTriangleMergeCand＝slice_weighted_pred_flag？0:MaxNumTriangleMergeCand或者-SliceMaxNumTriangleMergeCand＝slice_weighted_pred_flag？1:MaxNumTriangleMergeCand上述列举出的不同情况用于不同的实施例中。该变量的值还用于在块级解析融合信息。下表示出了示例性语法。/＞当非矩形帧间预测模式为GEO模式时，以下实施例进一步描述如下。因此，可以使用不同的机制控制GEO/TPM融合模式，这取决于WP是否应用于通过以下方式获得参考块P0和P1的参考图像：-将表14中列举出的WP参数从SH移动到PH中；-将GEO参数从PH移回到SH中；-改变MaxNumGeoMergeCand的语义，即，当可以使用经过WP的参考图像)时，将这些条带的MaxNumGeoMergeCand设置为等于0或1。对于GEO融合模式，参考块P0和P1在图8中例如分别表示为810和820。在一个实施例中，当在图像头中指示启用非矩形模式和指示WP参数时，可以使用以下语法，如下表所示：表11：图像头RBSP语法/＞/＞……当luma_weight_l0_flag、chroma_weight_l0_flag、luma_weight_l1_flag和chroma_weight_l1_flag的值均设置为0时，变量WPDisabled设置为等于1，其中，i＝0..NumRefIdxActive，j＝0..NumRefIdxActive；否则，WPDisabled的值设置为等于0。当变量WPDisabled设置为等于0时，pic_max_num_merge_cand_minus_max_num_geo_cand的值设置为等于MaxNumMergeCand。在另一个实施例中，pic_max_num_merge_cand_minus_max_num_geo_cand设置为等于MaxNumMergeCand-1。在第二实施例中，在条带头中指示WP参数和指示启用非矩形模式。下表示出了示例性语法。/＞/＞/＞/＞当luma_weight_l0_flag、chroma_weight_l0_flag、luma_weight_l1_flag和chroma_weight_l1_flag的值均设置为0时，变量WPDisabled设置为等于1，其中，i＝0..NumRefIdxActive，j＝0..NumRefIdxActive；否则，WPDisabled的值设置为等于0。当变量WPDisabled设置为等于0时，max_num_merge_cand_minus_max_num_geo_cand的值设置为等于MaxNumMergeCand。在另一个实施例中，当变量WPDisabled设置为等于0时，max_num_merge_cand_minus_max_num_geo_cand的值设置为等于MaxNumMergeCand-1。在上述公开的实施例中，加权预测参数可以在图像头或条带头中进行指示。在其它实施例中，根据以下条件的其中一个条件，在条带头中定义变量SliceMaxNumGeoMergeCand：-SliceMaxNumGeoMergeCand＝？0:MaxNumGeoMergeCand-SliceMaxNumGeoMergeCand＝？1:MaxNumGeoMergeCand-SliceMaxNumGeoMergeCand＝slice_weighted_pred_flag？0:MaxNumGeoMergeCand或者-SliceMaxNumGeoMergeCand＝slice_weighted_pred_flag？1:MaxNumGeoMergeCand上述列举出的不同情况用于不同的实施例中。该变量的值还用于在块级解析融合信息。下表示出了示例性语法。7.3.9.7融合数据语法/＞/＞相关的图像头语义如下所述：pic_max_num_merge_cand_minus_max_num_geo_cand表示从MaxNumMergeCand中减去与图像头关联的条带中支持的geo融合模式候选的最大数量。当pic_max_num_merge_cand_minus_max_num_geo_cand不存在，sps_geo_enabled_flag等于1，且MaxNumMergeCand大于或等于2时，则推断pic_max_num_merge_cand_minus_max_num_geo_cand等于pps_max_num_merge_cand_minus_max_num_geo_cand_plus1-1。geo融合模式候选的最大数量MaxNumGeoMergeCand推导如下：MaxNumGeoMergeCand＝MaxNumMergeCand-pic_max_num_merge_cand_minus_max_num_geo_cand当pic_max_num_merge_cand_minus_max_num_geo_cand存在时，MaxNumGeoMergeCand的取值范围可以为2至MaxNumMergeCand。当pic_max_num_merge_cand_minus_max_num_geo_cand不存在，且sps_geo_enabled_flag等于0，或者MaxNumMergeCand小于2时，MaxNumGeoMergeCand设置为等于0。当MaxNumGeoMergeCand等于0时，不允许将geo融合模式用于PH关联的条带。以下实施例中考虑了若干与指示相关的方面。这些方面如下所述：-与融合模式候选的数量相关的语法元素在序列参数集中进行指示，这使得可以通过特定实现方式推导SPS级的非矩形融合模式候选的数量；-当图像仅包括一个条带时，PH可以在SH中进行指示；-定义一种PH/SH参数覆盖机制，包括以下内容：■PPS标志表示相关编码工具的语法元素是存在于PH中还是存在于SH中；■具体地，参考图像列表和加权预测表可以使用该机制；-预测权重表，即可以在PH或SH中进行指示的第五类数据；-当对图像启用加权预测时，要求该图像中的所有条带都具有相同的参考图像列表；-如果在与PH关联的图像中仅使用某些条带类型，则帧间和帧内相关语法元素将有条件地进行指示。■具体地，引入了两个标志：pic_inter_slice_present_flag和pic_intra_slice_present_flag。在实施例1中，与融合模式候选的数量相关的语法元素在序列参数集中进行指示，这使得可以通过特定实现方式推导SPS级的非矩形融合模式候选的数量。该方面可以根据以下语法通过编码过程或解码过程来实现：7.3.2.3序列参数集RBSP语法/＞上文描述的语法具有以下语义：sps_six_minus_max_num_merge_cand_plus1等于0表示pic_six_minus_max_num_merge_cand存在于参考PPS的PH中，sps_six_minus_max_num_merge_cand_plus1大于0表示pic_six_minus_max_num_merge_cand不存在于参考PPS的PH中。sps_six_minus_max_num_merge_cand_plus1的取值范围可以为0至6。sps_max_num_merge_cand_minus_max_num_geo_cand_plus1等于0表示pic_max_num_merge_cand_minus_max_num_geo_cand存在于参考PPS的条带的PH中，sps_max_num_merge_cand_minus_max_num_geo_cand_plus1大于0表示pic_max_num_merge_cand_minus_max_num_geo_cand不存在于参考PPS的PH中。sps_max_num_merge_cand_minus_max_num_geo_cand_plus1的取值范围可以为0至MaxNumMergeCand-1。PH中的对应元素的语义如下：pic_six_minus_max_num_merge_cand表示从6中减去与PH关联的条带中支持的融合运动矢量预测候选的最大数量。融合MVP候选的最大数量MaxNumMergeCand推导如下：MaxNumMergeCand ＝ 6-pic_six_minus_max_num_merge_cand MaxNumMergeCand的取值范围可以为1至6。当pic_six_minus_max_num_merge_cand不存在时，则推断pic_six_minus_max_num_merge_cand的值等于sps_six_minus_max_num_merge_cand_plus1-1。pic_max_num_merge_cand_minus_max_num_geo_cand表示从MaxNumMergeCand中减去与图像头关联的条带中支持的geo融合模式候选的最大数量。当sps_max_num_merge_cand_minus_max_num_geo_cand不存在，sps_geo_enabled_flag等于1，且MaxNumMergeCand大于或等于2时，则推断pic_max_num_merge_cand_minus_max_num_geo_cand等于sps_max_num_merge_cand_minus_max_num_geo_cand_plus1-1。geo融合模式候选的最大数量MaxNumGeoMergeCand推导如下：MaxNumGeoMergeCand＝MaxNumMergeCand -pic_max_num_merge_cand_minus_max_num_geo_cand当pic_max_num_merge_cand_minus_max_num_geo_cand存在时，MaxNumGeoMergeCand的取值范围可以为2至MaxNumMergeCand。当pic_max_num_merge_cand_minus_max_num_geo_cand不存在，且sps_geo_enabled_flag等于0，或者MaxNumMergeCand小于2时，MaxNumGeoMergeCand设置为等于0。当MaxNumGeoMergeCand等于0时，不允许将geo融合模式用于PH关联的条带。该实施例的可选语法和语义如下所示：sps_six_minus_max_num_merge_cand表示从6中减去与PH关联的条带中支持的融合运动矢量预测候选的最大数量。融合MVP候选的最大数量MaxNumMergeCand推导如下：MaxNumMergeCand ＝ 6-sps_six_minus_max_num_merge_cand MaxNumMergeCand的取值范围可以为1至6。sps_max_num_merge_cand_minus_max_num_geo_cand表示从MaxNumMergeCand中减去与图像头关联的条带中支持的geo融合模式候选的最大数量。geo融合模式候选的最大数量MaxNumGeoMergeCand推导如下：MaxNumGeoMergeCand ＝ MaxNumMergeCand -sps_max_num_merge_cand_minus_max_num_geo_cand当sps_max_num_merge_cand_minus_max_num_geo_cand存在时，MaxNumGeoMergeCand的取值范围可以为2至MaxNumMergeCand。当sps_max_num_merge_cand_minus_max_num_geo_cand不存在，且ps_geo_enabled_flag等于0，或者MaxNumMergeCand小于2时，MaxNumGeoMergeCand设置为等于0。当MaxNumGeoMergeCand等于0时，不使用geo融合模式。对于上述实施例和两种可选的语法定义，检查是否启用加权预测。这种检查会影响对变量MaxNumGeoMergeCand的推导，并且在以下情况的其中一种情况下，MaxNumGeoMergeCand的值设置为0：-当i＝0..NumRefIdxActive，j＝0..NumRefIdxActive时，luma_weight_l0_flag、chroma_weight_l0_flag、luma_weight_l1_flag和chroma_weight_l1_flag的值均设置为0或不存在；-当SPS或PPS中的标志指示存在双向加权预测时；-当在图像头或条带头中指示存在双向加权预测时。指示存在加权预测参数的SPS级标志可以进行如下指示：语法元素“sps_wp_enabled_flag”确定是否可以在较低层级启用加权预测。下文中描述了示例性的实现方式：在上表中，pps_weighted_pred_flag和pps_weighted_bipred_flag是码流中的标志，分别表示是否对单向预测块和双向预测块启用加权预测。在一个实施例中，当加权预测标志在图像头中指定为pic_weighted_pred_flag和pic_weighted_bipred_flag等时，以下对sps_wp_enabled_flag的依赖关系可以在码流语法中进行指定：在一个实施例中，当加权预测标志在条带头中指定为weighted_pred_flag和weighted_bipred_flag等时，以下对sps_wp_enabled_flag的依赖关系可以在码流语法中进行指定：在实施例2中，参考图像列表可以在PPS中或者在PH或SH中进行指示。根据现有最新技术可以了解到，参考图像列表的指示依赖于表示加权预测的存在性的语法元素。因此，根据参考图像列表是否在PPS、PH或SH中进行指示，加权预测参数在相应的PPS、PH或SH中指示参考图像列表之前进行指示。针对本实施例，可以指定以下语法：图像参数集语法/＞……rpl_present_in_ph_flag等于1表示不在参考PPS的条带头中指示参考图像列表，但可能在参考PPS的PH中指示参考图像列表；rpl_present_in_ph_flag等于0表示不在参考PPS的PH中指示参考图像列表，但可能在参考PPS的条带头中指示参考图像列表。sao_present_in_ph_flag等于1表示用于开启使用SAO的语法元素不存在于参考PPS的条带头中，但可能存在于参考PPS的PH中；sao_present_in_ph_flag等于0表示用于开启使用SAO的语法元素不存在于参考PPS的PH中，但可能存在于参考PPS的条带头中。alf_present_in_ph_flag等于1表示用于开启使用ALF的语法元素不存在于参考PPS的条带头中，但可能存在于参考PPS的PH中；alf_present_in_ph_flag等于0表示用于开启使用ALF的语法元素不存在于参考PPS的PH中，但可能存在于参考PPS的条带头中。……weighted_pred_table_present_in_ph_flag等于1表示加权预测表不存在于参考PPS的条带头中，但可能存在于参考PPS的PH中；weighted_pred_table_present_in_ph_flag等于0表示加权预测表不存在于参考PPS的PH中，但可能存在于参考PPS的条带头中。当weighted_pred_table_present_in_ph_flag不存在时，则推断weighted_pred_table_present_in_ph_flag的值等于0。……deblocking_filter_override_enabled_flag等于1表示去块效应滤波器的覆盖可能存在于参考PPS的PH或条带头中，deblocking_filter_override_enabled_flag等于0表示去块效应滤波器的覆盖不存在于参考PPS的PH或条带头中。当deblocking_filter_override_enabled_flag不存在时，则推断deblocking_filter_override_enabled_flag的值等于0。deblocking_filter_override_present_in_ph_flag等于1表示去块效应滤波器的覆盖不存在于参考PPS的条带头中，但可能存在于参考PPS的PH中；deblocking_filter_override_present_in_ph_flag等于0表示去块效应滤波器的覆盖不存在于参考PPS的PH中，但可能存在于参考PPS的条带头中。……/＞/＞/＞/＞图像头的一种可选语法如下所述：/＞/＞在实施例3中，对图像头和条带头元素的指示可以组合在单个过程中。本实施例中引入了指示是否组合图像头和条带头的标志。根据该实施例，码流的语法如下所述：图像头RBSP语法图像头结构语法通用条带头语法/＞picture_header_in_slice_header_flag的语义和相关码流约束条件如下所述：picture_header_in_slice_header_flag等于1表示图像头语法结构存在于条带头中，picture_header_in_slice_header_flag等于0表示图像头语法结构不存在于条带头中。码流一致性的要求为：picture_header_in_slice_header_flag的值在CLVS的所有条带中都是相同的。当picture_header_in_slice_header_flag等于1时，码流一致性的要求为：NAL单元类型等于PH_NUT的NAL单元不存在于CLVS中。当picture_header_in_slice_header_flag等于0时，码流一致性的要求为：NAL单元类型等于PH_NUT的NAL单元存在于PU中，该NAL单元位于PU的第一个VCL NAL单元之前。实施例2和实施例3的组合也非常重要，因为这两个实施例都涉及PH指示和SH指示。这些实施例的各个方面的组合如下所述：当picture_header_in_slice_header_flag等于0时，这些标志表示相关编码工具的语法元素是否存在于PH或SH中。否则，当picture_header_in_slice_header_flag等于1时，这些标志被推断为0，表示在条带级进行工具参数的指示。一种可选组合如下所述：当picture_header_in_slice_header_flag等于0时，这些标志表示相关编码工具的语法元素是否存在于PH或SH中。否则，当picture_header_in_slice_header_flag等于1时，这些标志被推断为0，表示在图像头级进行工具参数的指示。该组合具有以下语法：图像参数集语法在实施例4中，通过在参考图像列表中指示加权预测中参考的条目的数量，检查是否启用加权预测。该实施例中的语法和语义定义如下：/＞……num_l0_weighted_ref_pics表示参考图像列表0中进行加权的参考图像的数量。num_l0_weighted_ref_pics的取值范围可以为0至MaxDecPicBuffMinus1+14。码流一致性的要求为：当num_l0_weighted_ref_pics存在时，num_l0_weighted_ref_pics的值不可以小于与图像头关联的图像中的任何条带的L0的活动参考图像的数量。num_l1_weighted_ref_pics表示参考图像列表1中进行加权的参考图像的数量。num_l1_weighted_ref_pics的取值范围可以为0至MaxDecPicBuffMinus1+14。码流一致性的要求为：当num_l1_weighted_ref_pics存在时，num_l1_weighted_ref_pics的值不可以小于与图像头关联的图像中的任何条带的L1的活动参考图像的数量。……当num_l0_weighted_ref_pics或num_l1_weighted_ref_pics不为0时，MaxNumGeoMergeCand设置为0。以下语法是对如何利用这种依赖关系的举例：pic_max_num_merge_cand_minus_max_num_geo_cand在本实施例中的语义与上述实施例中的语义相同。在实施例5中，如果在与PH关联的图像中仅使用某些条带类型，则帧间和帧内相关语法元素将有条件地进行指示。下文详述了该实施例的语法：/＞/＞/＞7.3.7.1通用条带头语法/＞7.4.3.6图像头RBSP语义pic_inter_slice_present_flag等于1表示slice_type等于0或1的一个或多个条带可以存在于与PH关联的图像中，pic_inter_slice_present_flag等于0表示slice_type等于0或1的条带可以不存在于与PH关联的图像中。pic_intra_slice_present_flag等于1表示slice_type等于2的一个或多个条带可以存在于与PH关联的图像中，pic_intra_slice_present_flag等于0表示slice_type等于2的条带可以不存在于与PH关联的图像中。当pic_intra_slice_only_flag不存在时，则推断pic_intra_slice_only_flag的值等于1。说明：在与包括一个或多个子图像的图像关联的图像头中，pic_inter_slice_present_flag和pic_intra_slice_present_flag的值均设置为等于1，其中，该一个或多个子图像包括一个或多个帧内译码条带，并且该一个或多个帧内译码条带可以与包括该一个或多个帧间译码条带的一个或多个子图像融合。7.4.8.1通用条带头语义slice_type指定条带的编码类型，如表7-5所示。表7-5：名称与slice_type的关联关系slice_typeslice_type的名称0B1P2I当nal_unit_type的取值范围为IDR_W_RADL至CRA_NUT，且当前图像是接入单元中的第一个图像时，slice_type应等于2。当slice_type不存在时，则推断slice_type的值等于2。当pic_intra_slice_present_flag等于0时，slice_type的取值范围可以为0至1。实施例4可以与pred_weight_table在图像头中的指示组合使用。上述实施例中公开了pred_weight_table在图像头中进行指示。一种示例性语法如下所述：当指示pred_weight_table存在于图像头中时，以下语法可以与实施例3组合使用：一些可选实施例中可以使用以下语法：一些可选实施例中可以使用以下语法：在上述语法中，pic_inter_bipred_slice_present_flag表示存在参考图像头的所有条带类型：I条带、B条带和P条带。当pic_inter_bipred_slice_present_flag为0时，图像仅包括I类型条带或B类型条带。在这种情况下，不启用非矩形模式。实施例5中组合了上述公开的特征。一种示例性语法如下所述：/＞/＞在实施例6中，在不使用加权预测因子的情况下允许编码器选择所参考的图像的非矩形模式。在本实施例中，语义定义如下：7.4.10.7融合数据语义……变量MergeGeoFlag表示基于geo形状的运动补偿是否用于生成当前编码单元的预测样本，在解码B条带时，该变量推导如下：-如果以下所有条件均为true，则MergeGeoFlag设置为等于1：-sps_geo_enabled_flag等于1；-slice_type等于B；-general_merge_flag等于1；-MaxNumGeoMergeCand大于或等于2；-cbWidth大于或等于8；-cbHeight大于或等于8；-cbWidth小于8*cbHeight；-cbHeight小于8*cbWidth；-regular_merge_flag等于0；-merge_subblock_flag等于0；-ciip_flag等于0。-否则，MergeGeoFlag设置为等于0。码流一致性的要求为：如果CU的亮度显式加权标志或色度显式加权标志中的一个标志为true，则MergeGeoFlag可以等于0。实施例7作为VVC规范的一部分可以阐释如下：8.5.7geo帧间块的解码过程8.5.7.1概述当对MergeGeoFlag等于1的编码单元进行解码时，调用该过程。该过程的输入包括：-亮度位置，表示当前编码块的左上亮度样本相对于当前图像的左上亮度样本的位置；-变量cbWidth，表示当前编码块的宽度，以亮度样本为单位；-变量cbHeight，表示当前编码块的高度，以亮度样本为单位；-1/16分数样本精度的亮度运动矢量mvA和mvB；-色度运动矢量mvCA和mvCB；-参考索引refIdxA和refIdxB；-预测列表标志predListFlagA和predListFlagB。……假设predSamplesLAL和predSamplesLBL为预测亮度样本值组成的×阵列，predSamplesLACb、predSamplesLBCb、predSamplesLACr和predSamplesLBCr为预测色度样本值组成的×阵列。predSamplesL、predSamplesCb和predSamplesCr通过以下按顺序执行的步骤推导如下：1.当N分别为A或B时，以下内容适用：……2.表示geo融合模式下的分割角度和距离的变量angleIdx和distanceIdx根据表36中指定的merge_geo_partition_idx的值进行设置。3.变量explictWeightedFlag推导如下：lumaWeightedFlagA＝predListFlagA？luma_weight_l1_flag:luma_weight_l0_flaglumaWeightedFlagB＝predListFlagB？luma_weight_l1_flag:luma_weight_l0_flagchromaWeightedFlagA＝predListFlagA？chroma_weight_l1_flag:chroma_weight_l0_flagchromaWeightedFlagB＝predListFlagB？chroma_weight_l1_flag:chroma_weight_l0_flagweightedFlag＝lumaWeightedFlagA||lumaWeightedFlagB||chromaWeightedFlagA||chromaWeightedFlagB4.当前亮度编码块内的预测样本predSamplesL通过以下方式进行推导：如果weightedFlag等于0，则调用第8.5.7.2节中指定的geo融合模式的加权样本预测过程；如果weightedFlag等于1，则调用第8.5.6.6.3节中定义的显式加权样本预测过程，其中，设置为等于cbWidth的编码块宽度nCbW、设置为等于cbHeight的编码块高度nCbH、样本阵列predSamplesLAL和predSamplesLBL、变量angleIdx和distanceIdx，以及设置为等于0的cIdx作为输入。5.当前色度分量Cb编码块内的预测样本predSamplesCb通过以下方式进行推导：如果weightedFlag等于0，则调用第8.5.7.2节中指定的geo融合模式的加权样本预测过程；如果weightedFlag等于1，则调用第8.5.6.6.3节中定义的显式加权样本预测过程，其中，设置为等于cbWidth/SubWidthC的编码块宽度nCbW、设置为等于cbHeight/SubHeightC的编码块高度nCbH、样本阵列predSamplesLACb和predSamplesLBCb、变量angleIdx和distanceIdx，以及设置为等于1的cIdx作为输入。6.当前色度分量Cr编码块内的预测样本predSamplesCr通过以下方式进行推导：如果weightedFlag等于0，则调用第8.5.7.2节中定义的geo融合模式的加权样本预测过程；如果weightedFlag等于1，则调用第8.5.6.6.3节中定义的显式加权样本预测过程，其中，设置为等于cbWidth/SubWidthC的编码块宽度nCbW、设置为等于cbHeight/SubHeightC的编码块高度nCbH、样本阵列predSamplesLACr和predSamplesLBCr、变量angleIdx和distanceIdx，以及设置为等于2的cIdx作为输入。7.调用第8.5.7.3节指定的geo融合模式的运动矢量存储过程，其中，亮度编码块位置、亮度编码块宽度cbWidth、亮度编码块高度cbHeight、分割方向变量angleIdx和distanceIdx、亮度运动矢量mvA和mvB、参考索引refIdxA和refIdxB，以及预测列表标志predListFlagA和predListFlagB作为输入。表36：基于merge_geo_partition_idx值的angleIdx和distanceIdx值的规范8.5.6.6.3显式加权样本预测过程该过程的输入包括：-两个变量nCbW和nCbH，表示当前编码块的宽度和高度；-两个×阵列predSamplesL0和predSamplesL1；-预测列表使用标志predFlagL0和predFlagL1；-参考索引refIdxL0和refIdxL1；-变量cIdx，表示颜色分量索引；-样本位深度bitDepth。该过程的输出包括由预测样本值组成的×阵列pbSamples。变量shift1设置为等于Max。变量log2Wd、o0、o1、w0和w1推导如下：-如果亮度样本的cIdx等于0，则以下内容适用：log2Wd ＝ luma_log2_weight_denom+shift1w0 ＝ LumaWeightL0w1 ＝ LumaWeightL1 o0 ＝ luma_offset_l0 ＜＜ o1 ＝ luma_offset_l1 ＜＜  -否则，如果色度样本的cIdx不等于0，则以下内容适用：log2Wd ＝ ChromaLog2WeightDenom+shift1w0＝ChromaWeightL0w1＝ChromaWeightL1o0＝ChromaOffsetL0＜＜o1＝ChromaOffsetL1＜＜ 预测样本pbSamples推导如下，其中，x＝0..nCbW-1，y＝0..nCbH-1：-如果predFlagL0等于1，且predFlagL1等于0，则预测样本值推导如下：if pbSamples＝Clip3-1,＞＞log2Wd)+o0)else pbSamples＝Clip3-1,predSamplesL0*w0+o0)-否则，如果predFlagL0等于0，且predFlagL1等于1，则预测样本值推导如下：if pbSamples＝Clip3-1,＞＞log2Wd)+o1)else pbSamples＝Clip3-1,predSamplesL1*w1+o1)-否则，如果predFlagL0等于1，且predFlagL1等于1，则预测样本值推导如下：pbSamples＝Clip3-1,＜＜log2Wd))＞＞)实施例8中公开了融合数据参数的语法，该语法包括检查用于指示非矩形融合模式的存在性的变量。语法示例如下所述：/＞变量MaxNumGeoMergeCand是根据上述实施例中任一实施例推导的。实施例9中使用可选变量SliceMaxNumGeoMergeCand，该变量是根据变量MaxNumGeoMergeCand推导的。MaxNumGeoMergeCand的值是在较高的指示层级获得的。在本实施例中，SliceMaxNumGeoMergeCand是根据MaxNumGeoMergeCand的值以及对条带执行的其它检查推导的。-例如，SliceMaxNumGeoMergeCand＝？0:MaxNumGeoMergeCand。实施例10是实施例9的变型，该实施例中使用以下表达式来确定MaxNumGeoMergeCand的值：SliceMaxNumGeoMergeCand＝？0:MaxNumGeoMergeCand实施例11与实施例4组合使用。语法表定义如下：变量MaxNumGeoMergeCand推导如下：SliceMaxNumGeoMergeCand＝？0:MaxNumGeoMergeCand根据上述描述，具体地，本文提供了以下实施例。图15为本发明实施例提供的一种译码方法的流程图。图15中所示的方法包括：步骤1510：获得当前图像的码流。步骤1520：根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型。进一步地，所述方法包括：步骤1530：根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中。然后，步骤1540：当所述第一指示符的值等于第一预设值，且所述第二指示符的值等于第二预设值时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值。然后，步骤1550：根据解析出的加权预测参数的值预测所述当前块。图16a和图16b示出了本发明另一实施例提供的译码方法。该方法包括：步骤1610：获得当前图像的码流。获得多个指示符的值：因此，该方法包括：步骤1620：根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；步骤1630：根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中；步骤1640：根据所述码流获得所述当前图像的第三指示符的值，其中，所述第三指示符指示加权预测是否适用于帧间条带，所述帧间条带的条带类型为B条带或P条带。然后，步骤1650：当所述第一指示符的值等于第一预设值，所述第二指示符的值等于第二预设值，且所述第三指示符的值指示加权预测适用于所述帧间条带时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值。然后，步骤1660：根据解析出的加权预测参数的值预测所述当前块。上述方法可以植入到解码设备中，如下所述。提供了如图17所示的一种解码设备1700。所述解码设备1700包括码流获得单元1710、指示符值获得单元1720、解析单元1730和预测单元1740。所述码流获得单元1710用于获得当前图像的码流。根据一实施例，所述指示符值获得单元1720用于：根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中。在这种情况下，所述解析单元1730用于：当所述第一指示符的值等于第一预设值，且第二指示符的值等于第二预设值时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值；所述预测单元用于根据所述加权预测参数的值预测所述当前块。根据另一实施例，所述指示符值获得单元1720用于：根据所述码流获得所述当前图像的第一指示符的值，其中，所述第一指示符指示条带类型；根据所述码流获得所述当前图像的第二指示符的值，其中，所述第二指示符指示加权预测参数是存在于所述码流的图像头中还是存在于所述码流的条带头中；根据所述码流获得所述当前图像的第三指示符的值，其中，所述第三指示符指示加权预测是否适用于帧间条带，所述帧间条带的条带类型为B条带或P条带。在这种情况下，所述解析单元1730用于：当所述第一指示符的值等于第一预设值，所述第二指示符的值等于第二预设值，且所述第三指示符的值指示加权预测适用于所述帧间条带时，从所述码流中解析当前块的加权预测参数的值，其中，所述当前块包含在所述当前图像的当前条带中，所述第一预设值为整数值，所述第二预设值为整数值；所述预测单元1740用于根据所述加权预测参数的值预测所述当前块。图17中所示的解码设备1700可以为或可以包括图1A、图1B、和图3中所示的解码器30以及图11中所示的视频解码器3206。图17中所示的解码设备1700可以包含在图4所示的视频译码设备400、图5所示的装置500、图10所示的终端设备3106、图13所示的装置1300以及图14所示的装置1400中。下文对上述实施例中所述的编码方法和解码方法的应用以及使用这些应用的系统进行解释说明。图10为用于实现内容分发服务的内容提供系统3100的框图。所述内容提供系统3100包括捕获设备3102、终端设备3106，并且可选地包括显示器3126。捕获设备3102与终端设备3106通过通信链路3104进行通信。该通信链路可以包括上述通信信道13。通信链路3104包括但不限于Wi-Fi、以太网、电缆、无线、USB或者其任何种类的组合等。捕获设备3102生成数据，并且可以通过上述实施例所示的编码方法对该数据进行编码。或者，捕获设备3102可以将该数据分发到流媒体服务器，所述服务器对该数据进行编码并将经编码数据发送给终端设备3106。捕获设备3102包括但不限于摄像机、智能手机或平板电脑、计算机或笔记本电脑、视频会议系统、PDA、车载设备，或它们的任何组合等。例如，捕获设备3102可以包括如上所述的源设备12。当该数据包括视频时，捕获设备3102中包括的视频编码器20实际上可以执行视频编码处理。当该数据包括音频时，捕获设备3102中包括的音频编码器实际上可以执行音频编码处理。对于一些实际场景，捕获设备3102通过将经编码的视频数据和经编码的音频数据一起复用以分发该经编码的视频数据和该经编码的音频数据。对于其它实际场景，例如在视频会议系统中，经编码的音频数据和经编码的视频数据不进行复用。捕获设备3102将经编码的音频数据和经编码的视频数据分别分发到终端设备3106。在所述内容提供系统3100中，终端设备3106接收并再现经编码数据。终端设备3106可以是具有数据接收和恢复能力的设备，例如智能手机或平板电脑3108、计算机或笔记本电脑3110、网络视频录像机/数字视频录像机3112、电视3114、机顶盒3116、视频会议系统3118、视频监控系统3120、个人数字助理3122、车载设备3124或其任何组合，或者是能够解码上述经编码数据的设备。例如，终端设备3106可以包括如上所述的目的地设备14。当经编码数据包括视频时，终端设备中包括的视频解码器30优先进行视频解码处理。当经编码数据包括音频时，终端设备中包括的音频解码器优先进行音频解码处理。对于具有显示器的终端设备，例如智能手机或平板电脑3108、计算机或笔记本电脑3110、网络视频录像机/数字视频录像机3112、电视3114、个人数字助理3122或车载设备3124，终端设备可以将经解码数据馈送至终端设备的显示器。对于未配备显示器的终端设备，例如STB 3116、视频会议系统3118或视频监控系统3120，应连接外部显示器3126以接收和显示经解码数据。当该系统中的每个设备执行编码或解码时，可以使用如上述实施例中所示的图像编码设备或图像解码设备。图11为终端设备3106的一种示例性结构的示意图。终端设备3106从捕获设备3102接收到流后，协议处理单元3202分析该流的传输协议。该协议包括但不限于实时流协议、超文本传输协议、HTTP直播流媒体协议、MPEG-DASH、实时传输协议、实时消息传输协议，或其任何种类的组合等。协议处理单元3202对流进行处理后，生成流文件。该文件被输出到解复用单元3204。解复用单元3204可以将复用数据分离成经编码音频数据和经编码视频数据。如上所述，对于一些实际场景，例如在视频会议系统中，经编码音频数据和经编码视频数据不进行复用。在这种情况下，不使用解复用单元3204，就可以将经编码数据发送给视频解码器3206和音频解码器3208。通过解复用处理，生成视频基本流、音频ES和可选的字幕。视频解码器3206包括上述实施例中描述的视频解码器30，通过上述实施例中所示的解码方法对视频ES进行解码，以生成视频帧，并将此数据馈送到同步单元3212。音频解码器3208对音频ES进行解码以生成音频帧，并将此数据馈送到同步单元3212。可选地，在将视频帧馈送到同步单元3212之前，可以将视频帧存储在缓冲区中。类似地，在将音频帧馈送到同步单元3212之前，可以将该音频帧存储在缓冲区中。同步单元3212同步视频帧和音频帧，并将视频/音频提供给视频/音频显示器3214。例如，同步单元3212同步视频信息和音频信息的呈现。信息可以根据与经译码音频和可视数据的呈现有关的时间戳以及与数据流本身的分发有关的时间戳被译码到语法中。如果流中包括字幕，则字幕解码器3210对字幕进行解码，使字幕与视频帧和音频帧同步，并将视频/音频/字幕提供给视频/音频/字幕显示器3216。本发明并不限于上述系统，上述实施例中的图像编码设备或图像解码设备都可以结合到其它系统，例如汽车系统。数学运算符本申请中使用的数学运算符与C编程语言中使用的数学运算符类似。但是，本申请准确定义了整除运算和算术移位运算的结果，并且还定义了其它运算，如幂运算和实值除法运算。编号和计数规范通常从0开始，例如，“第一个”相当于第0个，“第二个”相当于第1个，以此类推。算术运算符算术运算符的定义如下：+加法运算-减法运算或者非运算*乘法运算，包括矩阵乘法运算xy 幂运算，表示x的y次幂。在其它上下文中，这种表示符用作上标，而不是理解为幂运算。/整除运算，向0方向对结果进行截断。例如，7/4和-7/-4被截断成1，-7/4和7/-4被截断成-1。÷ 用来表示数学等式中的除法运算，但不对结果进行截断或四舍五入操作。 用来表示数学等式中的除法运算，但不对结果进行截断或四舍五入操作。用于计算f的和，i取x到y之间的所有整数值，包括x和y。x％y 取模运算，表示x除y的余数，其中，x和y均为整数，且x＞＝0和y＞0。逻辑运算符逻辑运算符的定义如下：x&amp;&amp;y x和y的布尔逻辑“与”运算x||y x和y的布尔逻辑“或”运算！布尔逻辑“非”运算x？y:z如果x为TRUE或不等于0，则返回y的值，否则，返回z的值。关系运算符关系运算符的定义如下：＞大于＞＝大于或等于＜小于＜＝小于或等于＝＝ 等于！＝不等于当一个关系运算符应用于一个已被赋值“na”的语法元素或变量时，值“na”被视为该语法元素或变量的不同值。值“na”被视为不等于任何其它值。按位运算符按位运算符的定义如下：&amp;按位“与”运算。当对整数参数进行运算时，运算的是整数值的二补码表示。当对二进制参数进行运算时，如果该二进制参数包含的位数比另一个参数少，则通过添加更多等于0的有效位来扩展该较短的参数。|按位“或”运算。当对整数参数进行运算时，运算的是整数值的二补码表示。当对二进制参数进行运算时，如果该二进制参数包含的位数比另一个参数少，则通过添加更多等于0的有效位来扩展该较短的参数。^按位“异或”运算。当对整数参数进行运算时，运算的是整数值的二补码表示。当对二进制参数进行运算时，如果该二进制参数包含的位数比另一个参数少，则通过添加更多等于0的有效位来扩展该较短的参数。x＞＞y将x的二补码整数表示向右算术移动y个二进制位。只有当y为非负整数值时才定义该函数。右移的结果是移进最高有效位的比特位等于移位运算之前的x的MSB。x＜＜y将x的二补码整数表示向左算术移动y个二进制位。只有当y为非负整数值时才定义该函数。左移的结果是移进最低有效位的比特位等于0。赋值运算符赋值运算符的定义如下：＝赋值运算符++递增，即，x++等于x＝x+1；在阵列索引中使用时，进行自增运算之前先求取变量的值。--递减，即，x--等于x＝x-1；在阵列索引中使用时，在进行自减运算之前先求取变量的值。+＝ 自增指定值，例如：x+＝3相当于x＝x+3，x+＝相当于x＝x+。-＝ 自减指定值，例如：x-＝3相当于x＝x-3，x-＝相当于x＝x-。范围表示法以下表示法用来说明取值的范围：x＝y..z x取从y到z的整数值，其中，x、y和z均为整数，z大于y。数学函数数学函数的定义如下：Asin三角反正弦函数，对参数x进行运算，x在-1.0至1.0的范围之间，输出值在-π÷2至π÷2范围之间，单位为弧度。Atan三角反正切函数，对参数x进行运算，输出值在-π÷2至π÷2范围之间，单位为弧度。Ceil表示大于或等于x的最小整数。Clip1Y＝Clip3-1,x)Clip1C＝Clip3-1,x)Cos三角余弦函数，对参数x进行运算，单位为弧度。Floor表示小于或等于x的最大整数。Ln返回x的自然对数。Log2返回x的以2为底的对数。Log10返回x的以10为底的对数。Round＝Sign*Floor+0.5)Sin三角正弦函数，对参数x进行运算，单位为弧度。Swap＝Tan三角正切函数，对参数x进行运算，单位为弧度。运算优先级顺序当没有使用括号来显式地表示表达式中的优先顺序时，以下规则适用：-高优先级的运算在低优先级的任何运算之前进行。-相同优先级的运算从左到右依次进行。下表从最高到最低的顺序表示运算的优先级，下表中位置越高，优先级越高。如果在C编程语言中也使用这些运算符，则本文中采用的优先级顺序与C编程语言中采用的优先级顺序相同。表：运算优先级从最高到最低逻辑运算的文本说明在文本中，用数学形式描述如下逻辑运算语句：可以通过如下方式进行描述：……如下/……以下为准：-如果条件0，则语句0-否则，如果条件1，则语句1-……-否则，则语句n文本中每个“如果……否则，如果……否则，……”语句由“……如下”或“……以下为准”语句引入。最后一个条件“如果……否则，如果……否则，……”总跟着一个“否则，……”。中间的“如果……否则，如果……否则，……”语句可以通过匹配“……如下”或“……以下为准”与结束内容“否则，……”来识别。在文本中，用数学形式描述如下逻辑运算语句：可以通过如下方式进行描述：……如下/……以下为准：-如果以下条件均为真，则语句0：-条件0a-条件0b-否则，如果以下条件中的一个或多个条件为真，则语句1：-条件1a-条件1b-……-否则，语句n在文本中，用数学形式描述如下逻辑运算语句：if statement 0if statement 1可以通过如下方式进行描述：当条件0，语句0当条件1，语句1。编码器20和解码器30等的实施例以及本文参照编码器20和解码器30等描述的功能可以通过硬件、软件、固件或其任意组合实现。如果通过软件实现，这些功能可以作为一个或多个指令或代码存储在计算机可读介质中或通过通信介质发送，并由基于硬件的处理单元执行。计算机可读介质可以包括与有形介质例如数据存储介质对应的计算机可读存储介质，或者包括便于将计算机程序从一处发送到另一处的任何介质的通信介质。通过这种方式，计算机可读介质通常可以对应非瞬时性的有形计算机可读存储介质或信号或载波等通信介质。数据存储介质可以是能够通过一个或多个计算机或一个或多个处理器访问的任何可用介质，以检索用于实施本发明所述技术的指令、代码和/或数据结构。计算机程序产品可以包括计算机可读介质。作为示例而非限制，此类计算机可读存储介质可以包括RAM、ROM、EEPROM、CD-ROM或其它光盘存储器、磁盘存储器或其它磁性存储设备、闪存或可以用于存储指令或数据结构形式的所需程序代码且可以由计算机访问的任何其它介质。此外，任何连接也可以被适当地定义为计算机可读介质。例如，如果指令通过同轴电缆、光纤缆线、双绞线和数字用户线、或红外线、无线电和微波等无线技术从网站、服务器或其它远程源进行传输，则同轴电缆、光纤缆线、双绞线和DSL、或红外线、无线电和微波等无线技术也包含在上述介质的定义中。但是，应理解的是，计算机可读存储介质和数据存储介质不包括连接、载波、信号或其它瞬时性介质，而是指非瞬时性的有形存储介质。本文所使用的磁盘和光盘包括压缩光盘、激光光盘、光学光盘、数字多功能光盘、软盘和蓝光光盘，其中，磁盘通常以磁性方式再现数据，而光盘利用激光以光学方式再现数据。上述各项的组合也应包括在计算机可读介质的范围内。指令可以通过一个或多个处理器执行，例如，一个或多个数字信号处理器、一个或多个通用微处理器、一个或多个专用集成电路、一个或多个现场可编程逻辑阵列或其它同等集成或离散逻辑电路等。因此，本文使用的术语“处理器”可以指任何上述结构或适合实现本文所描述的技术的任何其它结构。另外，在一些方面中，本文描述的各种功能可以提供在用于编码和解码的专用硬件和/或软件模块内，或者并入在组合编解码器中。而且，这些技术可以在一个或多个电路或逻辑元件中完全实现。本发明的技术可以在多种设备或装置中实现，这些设备或装置包括无线手机、集成电路或一组IC。本发明描述了各种组件、模块或单元，以强调用于执行所公开技术的设备的功能方面，但这些组件、模块或单元不一定需要由不同的硬件单元实现。实际上，如上所述，各种单元可以结合合适的软件和/或固件组合在编解码器硬件单元中，或者通过包括如上所述的一个或多个处理器的互操作硬件单元的集合来提供。下文将描述本发明的其它实施例。需要说明的是，下文中使用的编号不一定需要与上文中使用的编号保持一致。实施例1：一种用于图像块的帧间预测方法，其中，为一组预测块指示加权预测参数并启用非矩形帧间预测，所述方法包括：获得块的帧间预测模式参数，其中，所述获得包括检查是否为所述一组包括预测块的块启用非矩形帧间预测模式；获得与所述块关联的加权预测参数、一个块相对于为所述块指示的参考图像的帧间预测模式参数以及为所述一组块指定的加权预测参数。实施例2：根据实施例1所述的方法，其中，通过指示三角融合候选的最大数量大于1来启用非矩形帧间预测。实施例3：根据实施例1或2所述的方法，其中，当加权预测参数表示对至少一个参考索引启用加权预测时，则推断禁用非矩形帧间预测。实施例4：根据实施例1至3中任一实施例所述的方法，其中，所述一组块是一个图像，非矩形帧间预测模式参数的启用和加权预测参数均在图像头中进行指示。实施例5：根据实施例1至4中任一实施例所述的方法，其中，所述一组块是一个条带，非矩形帧间预测模式参数的启用和加权预测参数均在条带头中进行指示。实施例6：根据实施例1至5中任一实施例所述的方法，其中，帧间预测模式参数包括用于确定参考图像的参考索引和用于确定参考块在所述参考图像中的位置的运动矢量信息。实施例7：根据实施例1至6中任一实施例所述的方法，其中，非矩形融合模式为三角分割模式。实施例8：根据实施例1至7中任一实施例所述的方法，其中，非矩形融合模式为GEO模式。实施例9：根据实施例1至8中任一实施例所述的方法，其中，加权预测是条带级亮度补偿机制。实施例10：根据实施例1至9中任一实施例所述的方法，其中，加权预测是块级亮度补偿机制，例如局部亮度补偿。实施例11：根据实施例1至10中任一实施例所述的方法，其中，加权预测参数包括：一组标志，指示加权预测是否应用于所述预测块的亮度分量和色度分量；线性模型参数alpha和etta，指定所述预测块的值的线性变换。根据本申请的第一方面，如图12所示，公开了一种帧间预测方法1200，其中，所述方法包括：S1201：确定是否允许将非矩形帧间预测模式用于一组块；S1202：获得所述一组块的一个或多个帧间预测模式参数和加权预测参数；S1203：根据所述一个或多个帧间预测模式参数和加权预测参数，获得当前块的预测值，其中，所述帧间预测模式参数中的一个帧间预测模式参数表示所述当前块的参考图像信息，所述一组块包括所述当前块。在一种可行的实现方式中，所述参考图像信息包括是否对参考图像索引启用加权预测；并且，如果启用加权预测，则禁用所述非矩形帧间预测模式。在一种可行的实现方式中，如果禁用加权预测，则启用所述非矩形帧间预测模式。在一种可行的实现方式中，所述确定允许使用非矩形帧间预测模式包括：指示三角融合候选的最大数量大于1。在一种可行的实现方式中，所述一组块组成一个图像，所述加权预测参数和用于确定是否允许使用所述非矩形帧间预测模式的指示信息均在所述图像的图像头中。在一种可行的实现方式中，所述一组块组成一个条带，所述加权预测参数和用于确定是否允许使用所述非矩形帧间预测模式的指示信息在所述条带的条带头中。在一种可行的实现方式中，所述非矩形帧间预测模式为三角分割模式。在一种可行的实现方式中，所述非矩形帧间预测模式为几何分割模式。在一种可行的实现方式中，所述加权预测参数用于条带级亮度补偿。在一种可行的实现方式中，所述加权预测参数用于块级亮度补偿。在一种可行的实现方式中，所述加权预测参数包括：多个标志，指示加权预测是否应用于预测块的亮度分量和/或色度分量；线性模型参数，指定所述预测块的值的线性变换。根据本申请的第二方面，如图13所示，公开了一种帧间预测装置1300，其中，所述装置包括：非瞬时性存储器1301，所述存储器中存储有处理器可执行指令；处理器1302，耦合到所述存储器1301并用于执行所述处理器可执行指令，以实现本申请第一方面中的任一可行的实现方式。根据本申请的第三方面，公开了一种用于帧间预测的码流，其中，所述码流包括：用于确定是否允许非矩形帧间预测模式用于一组块的指示信息；所述一组块的一个或多个帧间预测模式参数和加权预测参数，其中，当前块的预测值是根据所述一个或多个帧间预测模式参数和加权预测参数获得的，所述帧间预测模式参数中的一个帧间预测模式参数表示所述当前块的参考图像信息，所述一组块包括所述当前块。在一种可行的实现方式中，所述参考图像信息包括是否对参考图像索引启用加权预测；并且，如果启用加权预测，则禁用所述非矩形帧间预测模式。在一种可行的实现方式中，如果禁用加权预测，则启用所述非矩形帧间预测模式。在一种可行的实现方式中，所述指示信息包括：三角融合候选的最大数量大于1。在一种可行的实现方式中，所述一组块组成一个图像，所述加权预测参数和所述指示信息均在所述图像的图像头中。在一种可行的实现方式中，所述一组块组成一个条带，所述加权预测参数和所述指示信息均在所述条带的条带头中。在一种可行的实现方式中，所述非矩形帧间预测模式为三角分割模式。在一种可行的实现方式中，所述非矩形帧间预测模式为几何分割模式。在一种可行的实现方式中，所述加权预测参数用于条带级亮度补偿。在一种可行的实现方式中，所述加权预测参数用于块级亮度补偿。在一种可行的实现方式中，所述加权预测参数包括：多个标志，指示加权预测是否应用于预测块的亮度分量和/或色度分量；线性模型参数，指定所述预测块的值的线性变换。根据本申请的第四方面，如图14所示，公开了一种帧间预测装置1400，其中，所述装置包括：确定模块1401，用于确定是否允许非矩形帧间预测模式用于一组块；获得模块1402，用于获得所述一组块的一个或多个帧间预测模式参数和加权预测参数；预测模块1403，用于根据所述一个或多个帧间预测模式参数和加权预测参数，获得当前块的预测值，其中，所述帧间预测模式参数中的一个帧间预测模式参数表示所述当前块的参考图像信息，所述一组块包括所述当前块。在一种可行的实现方式中，所述参考图像信息包括是否对参考图像索引启用加权预测；并且，如果启用加权预测，则禁用所述非矩形帧间预测模式。在一种可行的实现方式中，如果禁用加权预测，则启用所述非矩形帧间预测模式。在一种可行的实现方式中，所述确定模块1401具体用于：指示三角融合候选的最大数量大于1。在一种可行的实现方式中，所述一组块组成一个图像，所述加权预测参数和用于确定是否允许使用所述非矩形帧间预测模式的指示信息均在所述图像的图像头中。在一种可行的实现方式中，所述一组块组成一个条带，所述加权预测参数和用于确定是否允许使用所述非矩形帧间预测模式的指示信息在所述条带的条带头中。在一种可行的实现方式中，所述非矩形帧间预测模式为三角分割模式。在一种可行的实现方式中，所述非矩形帧间预测模式为几何分割模式。在一种可行的实现方式中，所述加权预测参数用于条带级亮度补偿。在一种可行的实现方式中，所述加权预测参数用于块级亮度补偿。在一种可行的实现方式中，所述加权预测参数包括：多个标志，指示加权预测是否应用于预测块的亮度分量和/或色度分量；线性模型参数，指定所述预测块的值的线性变换。此外，本文还提供了以下实施例/方面，由于这些实施例/方面被认为适合用于实际应用中，因此可以相互任意组合使用。这些实施例/方面列举如下：根据本申请的第一方面，提供了一种帧间预测方法，其中，所述方法包括：确定是否允许非矩形帧间预测模式用于一组块；获得所述一组块的一个或多个帧间预测模式参数和加权预测参数；根据所述一个或多个帧间预测模式参数和加权预测参数，获得当前块的预测值，其中，所述帧间预测模式参数中的一个帧间预测模式参数表示所述当前块的参考图像信息，所述一组块包括所述当前块。在一种可行的实现方式中，所述参考图像信息包括是否对参考图像索引启用加权预测；并且，如果启用加权预测，则禁用所述非矩形帧间预测模式。在一种可行的实现方式中，如果禁用加权预测，则启用所述非矩形帧间预测模式。在一种可行的实现方式中，所述确定允许使用非矩形帧间预测模式包括：指示三角融合候选的最大数量大于1。在一种可行的实现方式中，所述一组块组成一个图像，所述加权预测参数和用于确定是否允许使用所述非矩形帧间预测模式的指示信息均在所述图像的图像头中。在一种可行的实现方式中，所述一组块组成一个条带，所述加权预测参数和用于确定是否允许使用所述非矩形帧间预测模式的指示信息在所述条带的条带头中。在一种可行的实现方式中，所述非矩形帧间预测模式为三角分割模式。在一种可行的实现方式中，所述非矩形帧间预测模式为几何分割模式。在一种可行的实现方式中，与融合模式候选的数量相关的语法元素在序列参数集中进行指示。这里，当一个图像仅包括一个条带时，图像头可以在条带头中进行指示。在一种可行的实现方式中，当一个图像仅包括一个条带时，图像头在条带头中进行指示。在一种可行的实现方式中，图像参数集包括一个标志，该标志的值指定加权预测参数是存在于图像头中还是存在于条带头中。在一种可行的实现方式中，图像头中的一个标志表示非帧内类型的条带是否存在，并表示是否为所述条带指示帧间预测模式参数。在一种可行的实现方式中，所述加权预测参数用于条带级亮度补偿。在一种可行的实现方式中，所述加权预测参数用于块级亮度补偿。在一种可行的实现方式中，所述加权预测参数包括：多个标志，指示加权预测是否应用于预测块的亮度分量和/或色度分量；线性模型参数，指定所述预测块的值的线性变换。根据本申请的第二方面，提供了一种帧间预测装置，其中，所述装置包括：非瞬时性存储器，所述存储器存储有处理器可执行指令；处理器，耦合到所述存储器并用于执行所述处理器可执行指令，以实现本申请第一方面中的任一可行的实现方式。根据本申请的第三方面，公开了一种用于帧间预测的码流，其中，所述码流包括：用于确定是否允许非矩形帧间预测模式用于一组块的指示信息；所述一组块的一个或多个帧间预测模式参数和加权预测参数，其中，当前块的预测值是根据所述一个或多个帧间预测模式参数和加权预测参数获得的，所述帧间预测模式参数中的一个帧间预测模式参数表示所述当前块的参考图像信息，所述一组块包括所述当前块。在一种可行的实现方式中，所述参考图像信息包括是否对参考图像索引启用加权预测；并且，如果启用加权预测，则禁用所述非矩形帧间预测模式。在一种可行的实现方式中，如果禁用加权预测，则启用所述非矩形帧间预测模式。在一种可行的实现方式中，所述指示信息包括：三角融合候选的最大数量大于1。在一种可行的实现方式中，所述一组块组成一个图像，所述加权预测参数和所述指示信息均在所述图像的图像头中。在一种可行的实现方式中，所述一组块组成一个条带，所述加权预测参数和所述指示信息均在所述条带的条带头中。在一种可行的实现方式中，所述非矩形帧间预测模式为三角分割模式。在一种可行的实现方式中，所述非矩形帧间预测模式为几何分割模式。在一种可行的实现方式中，所述加权预测参数用于条带级亮度补偿。在一种可行的实现方式中，所述加权预测参数用于块级亮度补偿。在一种可行的实现方式中，所述加权预测参数包括：多个标志，指示加权预测是否应用于预测块的亮度分量和/或色度分量；线性模型参数，指定所述预测块的值的线性变换。根据本申请的第四方面，提供了一种帧间预测装置，其中，所述装置包括：确定模块，用于确定是否允许非矩形帧间预测模式用于一组块；获得模块，用于获得所述一组块的一个或多个帧间预测模式参数和加权预测参数；预测模块，用于根据所述一个或多个帧间预测模式参数和加权预测参数，获得当前块的预测值，其中，所述帧间预测模式参数中的一个帧间预测模式参数表示所述当前块的参考图像信息，所述一组块包括所述当前块。在一种可行的实现方式中，所述参考图像信息包括是否对参考图像索引启用加权预测；并且，如果启用加权预测，则禁用所述非矩形帧间预测模式。在一种可行的实现方式中，如果禁用加权预测，则启用所述非矩形帧间预测模式。在一种可行的实现方式中，所述确定模块具体用于：指示三角融合候选的最大数量大于1。在一种可行的实现方式中，所述一组块组成一个图像，所述加权预测参数和用于确定是否允许使用所述非矩形帧间预测模式的指示信息均在所述图像的图像头中。在一种可行的实现方式中，所述一组块组成一个条带，所述加权预测参数和用于确定是否允许使用所述非矩形帧间预测模式的指示信息在所述条带的条带头中。在一种可行的实现方式中，所述非矩形帧间预测模式为三角分割模式。在一种可行的实现方式中，所述非矩形帧间预测模式为几何分割模式。在一种可行的实现方式中，所述加权预测参数用于条带级亮度补偿。在一种可行的实现方式中，所述加权预测参数用于块级亮度补偿。在一种可行的实现方式中，所述加权预测参数包括：多个标志，指示加权预测是否应用于预测块的亮度分量和/或色度分量；线性模型参数，指定所述预测块的值的线性变换。此外，本文还提供了以下实施例：1.一种对视频序列进行编码的方法，其中，所述方法包括：确定加权预测参数是否可以存在于图像头中或存在于条带头中，以获得一个确定结果；根据所述确定结果通过图像参数集中的一个标志指示所述加权预测参数可以存在于所述图像头中或存在于所述条带头中。2.根据实施例1所述的方法，其中，所述图像参数集中的所述标志等于1，表示所述加权预测参数不存在于参考所述图像参数集的条带头中，但可以存在于参考所述PPS的图像头中；所述图像参数集中的所述标志等于0，表示所述加权预测参数不存在于参考所述图像参数集的图像头中，但可以存在于参考所述图像参数集的条带头中。3.根据实施例1或2所述的方法，其中，所述方法还包括：在图像头中指示所述加权预测参数。4.根据上述实施例中任一实施例所述的方法，其中，所述方法还包括：仅当图像头中的另一个标志表示启用了帧间条带时，在所述图像头中指示所述加权预测参数。5.一种对经编码视频序列进行解码的方法，其中，所述方法包括：解析所述编码视频序列的码流中的图像参数集，以获得包含在所述图像参数集中的一个标志的值；根据所述获得的标志的值确定加权预测参数可以存在于所述经编码视频序列的图像头中或存在于所述经编码视频序列的的条带头中。6.根据实施例5所述的方法，其中，所述图像参数集中的所述标志等于1，表示所述加权预测参数不存在于参考所述图像参数集的条带头中，但可以存在于参考所述PPS的图像头中；所述图像参数集中的所述标志等于0，表示所述加权预测参数不存在于参考所述图像参数集的图像头中，但可以存在于参考所述图像参数集的条带头中。7.根据实施例5或6所述的方法，其中，所述方法还包括：解析所述视频序列的所述码流中的图像头，以从解析出的图像头中获得所述加权预测参数。8.根据实施例5至7中任一实施例所述的方法，所述方法包括：解析所述视频序列的所述码流中的图像头，其中，所述图像头包括另一个标志；仅当所述另一个标志表示启用了帧间条带时，从解析出的图像头中获得所述加权预测参数。9.一种用于对视频序列的一组块中的当前块进行帧间预测的方法，其中，所述方法包括实施例1至8中任一实施例所述的步骤，并且所述方法还包括：获得所述一组块的一个或多个帧间预测模式参数和加权预测参数；根据所述一个或多个帧间预测模式参数和加权预测参数，获得所述当前块的预测值，其中，所述帧间预测模式参数中的一个帧间预测模式参数表示所述当前块的参考图像信息。10.根据实施例9所述的方法，其中，所述参考图像信息包括关于是否为参考图像索引启用加权预测的信息；如果启用加权预测，则禁用至少一种非矩形帧间预测模式。11.根据实施例9或10所述的方法，其中，如果禁用加权预测，则启用所述非矩形帧间预测模式。12.根据实施例9至11中任一实施例所述的方法，其中，所述一组块组成一个图像，所述用于确定是否允许使用非矩形帧间预测模式的信息在所述图像的图像头中。13.根据实施例9至11中任一实施例所述的方法，其中，所述一组块组成一个条带，所述用于确定是否允许使用非矩形帧间预测模式的信息在所述条带的条带头中。14.根据实施例9至13中任一实施例所述的方法，其中，所述非矩形帧间预测模式为三角分割模式。15.根据实施例9至13中任一实施例所述的方法，其中，所述非矩形帧间预测模式为几何分割模式。16.根据实施例1至15中任一实施例所述的方法，其中，当一个图像仅包括一个条带时，图像头在条带头中进行指示。17.根据实施例1至16中任一实施例所述的方法，其中，所述加权预测参数用于条带级亮度补偿。18.根据实施例1至16中任一实施例所述的方法，其中，所述加权预测参数用于块级亮度补偿。19.根据实施例1至18中任一实施例所述的方法，其中，所述加权预测参数包括：多个标志，指示加权预测是否应用于预测块的亮度分量和/或色度分量；线性模型参数，指定所述预测块的值的线性变换。20.一种帧间预测装置，其中，所述装置包括：非瞬时性存储器，所述存储器存储有处理器可执行指令；处理器，耦合到所述存储器并用于执行所述处理器可执行指令，以实现实施例1至19中的任一实施例。
