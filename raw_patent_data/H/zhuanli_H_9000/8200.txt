标题title
一种边缘计算场景下的虚拟网络调度方法
摘要abst
本发明主要涉及边缘计算领域，尤其涉及一种边缘计算场景下的虚拟网络调度方法，客户端的边缘节点EdgeNode通过探测模块检测与其他边缘节点EdgeNode之间的通信质量，以及边缘节点EdgeNode与核心节点SuperNode之间的通信质量；根据业务通信质量的信息创建overlay网络的vxlan隧道，所述核心节点SuperNode接收各个所述边缘节点EdgeNode的时延信息，所述控制模块根据建立需要通信的边缘节点EdgeNode之间的业务类型建立时延最小的vxlan隧道，客户端的网络模块根据下发的路由信息建立vxlan隧道，vxlan隧道根据时延信息进行实时更新。
权利要求书clms
1.一种边缘计算场景下的虚拟网络调度方法，其特征在于：在服务端：为服务器配置独立的公有IP，并在所述服务器上搭建N2N网络的核心节点SuperNode；在所述服务器上配置用于接收网络配置信息的管理模块、用于接收管理模块的配置信息和接收网络质量信息并根据网络质量信息进行路由配置的控制模块；在边缘端：为每个客户端配置动态IP，并在所述客户端搭建N2N网络的边缘节点EdgeNode，并为每个边缘节点EdgeNode配置虚拟IP及对应的虚拟MAC地址；每个所述客户端均包括用于检测网络质量信息的探测模块和用于创建网络路由的网络模块；构建Underlay通信网络并进行客户端的动态IP信息、端口信息、虚拟IP及对应的虚拟MAC信息的交互；客户端的边缘节点EdgeNode通过探测模块检测与其他边缘节点EdgeNode之间的通信质量，以及边缘节点EdgeNode与核心节点SuperNode之间的通信质量，并将通信质量的信息传输给服务器端的控制模块，通信质量的信息包括时延信息；根据业务通信质量的信息创建overlay网络的vxlan隧道，所述核心节点SuperNode接收各个所述边缘节点EdgeNode的时延信息，所述控制模块根据建立需要通信的边缘节点EdgeNode之间的业务类型建立时延最小的vxlan隧道，客户端的网络模块根据下发的路由信息建立vxlan隧道，vxlan隧道根据时延信息进行实时更新。2.根据权利要求1所述的边缘计算场景下的虚拟网络调度方法，其特征在于：构建Underlay通信网络并进行客户端的动态IP信息、端口信息、虚拟IP及对应的虚拟MAC信息的交互时：各个所述边缘节点EdgeNode将自身的动态IP和端口以及虚拟IP和该虚拟IP对应的虚拟MAC地址发送给所述核心节点SuperNode，并由服务器的所述控制模块记录；所述核心节点SuperNode依据各个边缘节点EdgeNode的动态IP实现各个边缘节点EdgeNode之间的中转握手；边缘节点EdgeNode收到数据包，提取来源IP地址和端口，并进行直连，若直连成功，则数据包由边缘节点EdgeNode之间直接连接通信；数据包内包括各个边缘节点EdgeNode接收的所述核心节点SuperNode发送的其他各个边缘节点EdgeNode的动态IP和端口的信息以及虚拟IP和该虚拟IP对应的虚拟MAC地址信息并由各个边缘节点EdgeNode的所述探测模块记录。3.根据权利要求1所述的边缘计算场景下的虚拟网络调度方法，其特征在于：探测模块通过TCP方式获得网络质量信息时：客户端的探测模块在本地分别启动2个TCP端口，分别为p1和p2端口；p1端口作为发送测试报文的端口，p2端口做为接收测试报文的端口；探测模块接收核心节点SuperNode发送的所有其他边缘节点EdgeNode网关的IP地址及p1端口和p2端口，探测模块向除自己所有边缘节点EdgeNode建立TCP连接，并通过p1端口与其他边缘节点EdgeNode的p2端口进行通信；TCP连接建立后，由p1端口发送测试报文，其他边缘节点EdgeNode的p2端口接收测试报文；探测模块通过TCP的timestamp获得往返时延信息，通过计算TCP的报文的重传数量/TCP报文的的总数量获得丢包率信息。4.根据权利要求3所述的边缘计算场景下的虚拟网络调度方法，其特征在于：探测模块通过UDP方式获得网络质量信息时：探测模块直接向除自己所有其他边缘节点EdgeNode发送UDP测试报文，报文内生成一个随机seq＝x及时间戳t1，并由p1端口向其他边缘节点EdgeNode的p2端口发送；其他边缘节点EdgeNode接收到UDP测试报文后，返回一个包含ack＝x及接收到的时间戳t2的数据包；在测试的边缘节点EdgeNode的探测模块接收ack＝x的数据包后，获取时间戳t2，t2-t1为往返时延，未接收到ack＝x的则标记该包丢失。
说明书desc
技术领域本发明主要涉及边缘计算领域，尤其涉及一种边缘计算场景下的虚拟网络调度方法。背景技术在边缘计算的场景下，云端和边缘端的通信，一般采用专线或者VPN的方式。如果采用专线的方式，费用成本巨大。如果采用VPN的方式，信息主要依靠VPN服务进行数据中转，网络的可靠性无法满足，边缘端与VPN服务之间的网络质量不好时，就出现数据交互变，延时增高，甚至网络中断，导致业务交互失败。如采用VPN的FULL MESH方式，则不仅云端需要有公有IP，且每个边缘也需要有固定的公有IP，并且每个边缘端都需要部署VPN服务，VPN服务之间的连接数为n/2，网络的可靠性需要采用等价路由及策略路由的方式去实现，组网不够灵活且复杂，同时当边缘端数量增多时，网络配置将变得非常复杂，同时VPN服务的对CPU的资源消耗巨大，成本过高。发明内容为了解决上述技术问题，本发明提供一种边缘计算场景下的虚拟网络调度方法，本发明是通过以下技术方案实现的：一种边缘计算场景下的虚拟网络调度方法，在服务端：为服务器配置独立的公有IP，并在所述服务器上搭建N2N网络的核心节点SuperNode；在所述服务器上配置用于接收网络配置信息的管理模块、用于接收管理模块的配置信息和接收网络质量信息并根据网络质量信息进行路由配置的控制模块；在边缘端：为每个客户端配置动态IP，并在所述客户端搭建N2N网络的边缘节点EdgeNode，并为每个边缘节点EdgeNode配置虚拟IP及对应的虚拟MAC地址；每个所述客户端均包括用于检测网络质量信息的探测模块和用于创建网络路由的网络模块；构建Underlay通信网络并进行客户端的动态IP信息、端口信息、虚拟IP及对应的虚拟MAC信息的交互；客户端的边缘节点EdgeNode通过探测模块检测与其他边缘节点EdgeNode之间的通信质量，以及边缘节点EdgeNode与核心节点SuperNode之间的通信质量，并将通信质量的信息传输给服务器端的控制模块，通信质量的信息包括时延信息；根据业务通信质量的信息创建overlay网络的vxlan隧道，所述核心节点SuperNode接收各个所述边缘节点EdgeNode的时延信息，所述控制模块根据建立需要通信的边缘节点EdgeNode之间的业务类型建立时延最小的vxlan隧道，客户端的网络模块根据下发的路由信息建立vxlan隧道，vxlan隧道根据时延信息进行实时更新。优选的是，构建Underlay通信网络并进行客户端的动态IP信息、端口信息、虚拟IP及对应的虚拟MAC信息的交互时：各个所述边缘节点EdgeNode将自身的动态IP和端口以及虚拟IP和该虚拟IP对应的虚拟MAC地址发送给所述核心节点SuperNode，并由服务器的所述控制模块记录；所述核心节点SuperNode依据各个边缘节点EdgeNode的动态IP实现各个边缘节点EdgeNode之间的中转握手；边缘节点EdgeNode收到数据包，提取来源IP地址和端口，并进行直连，若直连成功，则数据包由边缘节点EdgeNode之间直接连接通信；数据包内包括各个边缘节点EdgeNode接收的所述核心节点SuperNode发送的其他各个边缘节点EdgeNode的动态IP和端口的信息以及虚拟IP和该虚拟IP对应的虚拟MAC地址信息并由各个边缘节点EdgeNode的所述探测模块记录。优选的是，探测模块通过TCP方式获得网络质量信息时：客户端的探测模块在本地分别启动2个TCP端口，分别为p1和p2端口；p1端口作为发送测试报文的端口，p2端口做为接收测试报文的端口；探测模块接收核心节点SuperNode发送的所有其他边缘节点EdgeNode网关的IP地址及p1端口和p2端口，探测模块向除自己所有边缘节点EdgeNode建立TCP连接，并通过p1端口与其他边缘节点EdgeNode的p2端口进行通信；TCP连接建立后，由p1端口发送测试报文，其他边缘节点EdgeNode的p2端口接收测试报文；探测模块通过TCP的timestamp获得往返时延信息，通过计算TCP的报文的重传数量/TCP报文的的总数量获得丢包率信息。优选的是，探测模块通过UDP方式获得网络质量信息时：探测模块直接向除自己所有其他边缘节点EdgeNode发送UDP测试报文，报文内生成一个随机seq＝x及时间戳t1，并由p1端口向其他边缘节点EdgeNode的p2端口发送；其他边缘节点EdgeNode接收到UDP测试报文后，返回一个包含ack＝x及接收到的时间戳t2的数据包；在测试的边缘节点EdgeNode的探测模块接收ack＝x的数据包后，获取时间戳t2，t2-t1为往返时延，未接收到ack＝x的则标记该包丢失。本发明的有益效果为：本发明提供的边缘计算场景下的虚拟网络调度方法，边缘客户端无固定公有IP，边缘端与边缘端、边缘与云端采用N2N的连接方式，并可根据网络的时延信息和带宽信息，动态的调度虚拟网络，以边缘端通信的灵活性及可靠性，解决了VPN方式中网络质量高度依赖云服务端中的VPN服务以及VPN方式中无法动态调度网络和网络配置繁琐的问题。附图说明图1为本发明的边缘计算场景下的虚拟网络调度方法的网络结构示意图。具体实施方式下面结合附图和具体实施方式对本发明做进一步的说明。如图1所示，一种边缘计算场景下的虚拟网络调度方法，在本专利中的服务端也是云端服务器，客户端为边缘端。在服务端：为服务器配置独立的公有IP，并在所述服务器上搭建N2N网络的服务端以及核心节点SuperNode。服务器配置有管理模块和控制模块，管理模块用于接收网络配置信息，控制模块用于接收管理模块的配置信息，并接收网络质量信息，同时根据网络质量信息进行路由配置。在边缘端：为每个客户端配置动态IP，并在所述客户端搭建N2N网络的客户端以及边缘节点EdgeNode，客户端无需类似服务端需要独有的公有IP，其可由运营商动态分配的公有动态IP即可，同时为每个边缘节点EdgeNode配置虚拟IP及对应的虚拟MAC地址。每个所述客户端均包括用于检测网络质量信息的探测模块和用于创建网络路由的网络模块。构建Underlay通信网络并进行客户端的动态IP信息和端口信息，以及虚拟IP及对应的虚拟MAC信息的交互，具体地：各个所述边缘节点EdgeNode将自身的动态IP和端口以及虚拟IP和该虚拟IP对应的虚拟MAC地址发送给所述核心节点SuperNode，并由服务器的所述控制模块记录。所述核心节点SuperNode依据各个边缘节点EdgeNode的动态IP实现各个边缘节点EdgeNode之间的首次中转握手。边缘节点EdgeNode收到数据包，提取数据包来源IP地址和端口，并进行直连，若直连成功，则数据包由边缘节点EdgeNode之间直接连接通信，无需再通过核心节点SuperNode的中转。数据包内包括各个边缘节点EdgeNode接收的所述核心节点SuperNode发送的其他各个边缘节点EdgeNode的动态IP和端口的信息以及虚拟IP和该虚拟IP对应的虚拟MAC地址信息并由各个边缘节点EdgeNode的所述探测模块记录。客户端的边缘节点EdgeNode通过探测模块检测与其他边缘节点EdgeNode之间的通信质量，以及边缘节点EdgeNode与核心节点SuperNode之间的通信质量，并将通信质量的信息传输给服务器端的控制模块，通信质量的信息为时延信息、带宽信息和丢包率，具体过程为：客户端的探测模块在本地分别启动2个TCP端口，分别为p1和p2端口。p1端口作为发送测试报文的端口，p2端口做为接收测试报文的端口。为了同时测试UDP的网络性能，探测模块也会启动UDP服务，并且复用上述p1端口和p2端口。探测模块，接收核心节点SuperNode发送的所有其他边缘节点EdgeNode网关的虚拟IP地址及p1端口和p2端口，探测模块向除自己所有边缘节点EdgeNode建立TCP连接，并通过p1端口与其他边缘节点EdgeNode的p2端口进行通信。TCP连接建立后，由p1端口发送测试报文，其他边缘节点EdgeNode的p2端口接收测试报文。探测模块通过TCP的timestamp可得到往返时延，通过计算TCP的报文的重传数量/TCP报文的的总数量，得到重传率即丢包率。或者在采用UDP探测时，由于UDP没有重传机制，需要探测模块自身实现探测，具体地：探测模块直接向除自己所有其他边缘节点EdgeNode发送UDP测试报文，报文内生成一个随机seq＝x及时间戳t1，并由p1端口向其他边缘节点EdgeNode的p2端口发送。其他边缘节点EdgeNode接收到UDP测试报文后，返回一个包含ack＝x及接收到的时间戳t2的数据包，表示已经收到了数据库。在测试的边缘节点EdgeNode的探测模块接收ack＝x的数据包后，获取时间戳t2，此时可计算丢包率及往返时延，无接收到ack＝x的则标记该包丢失，往返时延为t2-t1。根据业务通信质量创建overlay网络的vxlan隧道，所述核心节点SuperNode接收各个所述边缘节点EdgeNode的时延信息，所述控制模块根据建立需要通信的边缘节点EdgeNode之间的业务类型建立时延最小的vxlan隧道，客户端的网络模块根据下发的路由信息建立vxlan隧道，vxlan隧道根据时延信息进行实时更新。对于边缘节点EdgeNode均为时延敏感或者带宽敏感的业务类型时，例如边缘节点A需要向边缘节点B通信，此时服务器端的控制模块获得的信息为两者均为时延敏感型，同时边缘节点A与边缘节点B之间直连的延时为150ms，而边缘节点A至边缘节点C至边缘节点B之间的延时为80ms，则此时控制模块发路由变更的信息到对应的边缘节点A、边缘节点C、边缘节点B节点上，建立由边缘节点A至边缘节点C至边缘节点B的vxlan隧道。相应的边缘节点接收到路由变更的指令后，更新路由隧道，对于上层的隧道则无需变化。创建隧道时，边缘节点A的虚拟IP为:192.168.1.10/24，边缘节点B的虚拟IP为:192.168.1.11/24，边缘节点C的虚拟IP为：192.168.1.12/24。服务器端的控制模块下发建立边缘节点A至边缘节点B的隧道，相应的边缘节点A和边缘节点B的网络模块控制虚拟网络隧道的创建，在边缘节点A至边缘节点B之间创建一个172.16.1.0/24的网络。172.16.1.0/24为overlay网络的vxlan隧道，边缘节点A至边缘节点B可直接通过该隧道进行通信，无需服务器端的核心节点进行转发，此时缘节点A至边缘节点B的underlay网络为192.168.1.10与192.168.1.11。由于vxlan隧道是独立的一段网段且是隔离的，所以这些独立的网段是采用重叠的IP地址，例如在与边缘节点A至边缘节点B相互无关联的隧道，依然可以创建一个172.16.1.0/24的网络，vxlan隧道可以进行overlap的IP分配。在边缘节点A至边缘节点B的网络质量不佳，而边缘节点A至边缘节点C至边缘节点B为最佳网络质量时，此时overlay网络的vxlan隧道172.16.1.0/24组建在边缘节点A:192.168.1.10/24和边缘节点B:192.168.1.11/24之间，此时变更路由并建立新的vxlan隧道，边缘节点A的路由192.168.1.10到192.168.1.11/32的网关是192.168.1.12，Edge B的路由192.168.1.11到192.168.1.10/32的网关是192.168.1.12即建立由边缘节点A至边缘节点C至边缘节点B的vxlan隧道。
