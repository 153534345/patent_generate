标题title
一种基于FPGA的任意长度turbo码速率匹配方法
摘要abst
本发明公开了一种基于FPGA的任意长度turbo码速率匹配方法，该基于FPGA的任意长度turbo码速率匹配方法包括，步骤S1：根据Turbo编码输出的长度，对输入的比特数据进行补零，使得比特数据的总比特数为32的整倍数；步骤S2：根据Turbo编码的实际长度，定义hcnt和vcnt即行索引和列索引两个变量对数据进行遍历，在FPGA中，使用状态机对数据进行遍历并以此输出。本发明所述基于FPGA的任意长度turbo码速率匹配方法利用寄存器偏移有序缓存turbo码输入数据，可以根据实际码长，遍历输出速率匹配后的码流，针对第二路、第三路码流奇偶交叉，同时支持单比特和双比特输出，提高码流的输出速率，减少链路延时，最终可转化为统一固定位宽的连续并行数据，优化后续链路设计。
权利要求书clms
1.一种基于FPGA的任意长度turbo码速率匹配方法，其特征在于，包括如下步骤：步骤S1：根据Turbo编码输出的长度，对输入的比特数据进行补零，使得比特数据的总比特数为32的整倍数；步骤S2：根据Turbo编码的实际长度，定义hcnt和vcnt即行索引和列索引两个变量对数据进行遍历，在FPGA中，使用状态机对数据进行遍历并以此输出。2.根据权利要求1所述的基于FPGA的任意长度turbo码速率匹配方法，其特征在于，步骤S1具体包括：分别定义三路比特流，分别为Turbo码长最大为6144，定义的寄存器以rm_leng表示，则有计算补零的比特数公式如下：其中，valid为输入有效信号，为补零后的总长度，是32的整倍数；第一路输入延迟ZeroBit个时钟输入后为/＞第二路输入延迟ZeroBit个时钟输入后为/＞第二路输入延迟ZeroBit-1个时钟输入后为/＞3.根据权利要求2所述的基于FPGA的任意长度turbo码速率匹配方法，其特征在于，步骤S1还包括：记录三路比特流的矩阵首行补零的特征位置，并基于Turbo码速率匹配的列变换P向量关系对三路比特流按照P向量进行矩阵列变换；定义32*3个宽度为RTC的寄存器，利用寄存器移位操作存入寄存器中；通过计数器cnt控制寄存器的移位操作，cnt计数器中cnt取最低5比特作为索引，在0～31之间循环变换直到valid无效，并列出相应的表数据。4.根据权利要求1所述的基于FPGA的任意长度turbo码速率匹配方法，其特征在于，步骤S2具体包括：计算矩阵的偏移量；确定遍历的起始位置；分别对数据执行遍历；比特收集和输出，通过判断使能信号，确定输出的比特数量，并转换为并行数据输出。5.根据权利要求4所述的基于FPGA的任意长度turbo码速率匹配方法，其特征在于，步骤S2中，所述计算矩阵的偏移量具体包括：矩阵的偏移量为32的整倍数，定义偏移量的结果为k0，对k0求96的余数得到kr，将第一、二、三路的比特数据按顺序进行拼接。6.根据权利要求5所述的基于FPGA的任意长度turbo码速率匹配方法，其特征在于，步骤S2中，所述确定遍历的起始位置具体包括：定义0～31行为区间一，定义32～95行为区间二，定义kr行为区间，其中，vcnt从第kr行开始遍历，如果遍历到第96行，回到第一行继续遍历，直到第kr-1行为止。7.根据权利要求6所述的基于FPGA的任意长度turbo码速率匹配方法，其特征在于，步骤S2中，所述分别对数据执行遍历具体包括：对区间一的遍历，hcnt从表格中最右侧开始遍历，x的第一个比特可能包含填充的空比特，此处为零比特，通过Sel中的比特来判断是否为空比特，若为空比特则输出使能为2’b00，若有效则输出当前比特且输出使能为2’b00，向右遍历；对区间二的遍历，同时输出相邻的两行，可能一次性输出两个比特；hcnt从表格中最右侧开始遍历，x的第一个比特可能包含填充的空比特，此处为零比特，通过Sel和Sel2中的比特来判断是否为空比特，在连续两行输出都有效时则使能为2’b11，再只有第一行有效时输出使能为2’b01，在只有第二行有效时输出使能为2’b10。
说明书desc
技术领域本发明涉及通信技术领域，尤其涉及一种基于FPGA的任意长度turbo码速率匹配方法。背景技术进入21世纪后，移动互联网飞速发展，传统的2G网络开辟了移动终端上网的历史，3G网络成就了移动互联网，4G和5G又是持续演进的产物。Turbo码广泛应用于3G、4G和5G通信中，Turbo码的母2码率只有1/3，但是实际上物理信道的编码率可能不是1/3。速率匹配的作用是确保在传输信道复用后总的比特率与所分配的专用物理信道的总比特率是相同的。对于基站的发送端，速率匹配是非常重要的一个步骤，用以完成Turbo编码输出后的数据与信道上允许发送的数据的相互匹配的功能。3GPP协议定义了Turbo码的速率匹配的详细算法，在TD-LTE系统中，物理上行共享信道是采用Turbo码编码，为了减少链路的延时，通常采用FPGA去实现，具备效率高、延时低、可编程等特点。基站在实际工作中，特别是中小型基站，码块长度可能不固定导致进入速率匹配链路中比特流长度也不确定，而FPGA是一种硬件电路，对于长度不确定的比特流，容易消耗更多的资源和时间，从而增加了上行链路的延时。发明内容为了克服现有技术中相关产品的不足，本发明提出一种基于FPGA的任意长度turbo码速率匹配方法。本发明提供了一种基于FPGA的任意长度turbo码速率匹配方法，包括如下步骤：步骤S1：根据Turbo编码输出的长度，对输入的比特数据进行补零，使得比特数据的总比特数为32的整倍数；步骤S2：根据Turbo编码的实际长度，定义hcnt和vcnt即行索引和列索引两个变量对数据进行遍历，在FPGA中，使用状态机对数据进行遍历并以此输出。在本发明的某些实施方式中，步骤S1具体包括：分别定义三路比特流，分别为Turbo码长最大为6144，定义的寄存器以rm_leng表示，则有计算补零的比特数公式如下：其中，valid为输入有效信号，为补零后的总长度，是32的整倍数；第一路输入延迟ZeroBit个时钟输入后为/＞第二路输入延迟ZeroBit个时钟输入后为/＞/＞第二路输入延迟ZeroBit-1个时钟输入后为/＞在本发明的某些实施方式中，步骤S1还包括：记录三路比特流的矩阵首行补零的特征位置，并基于Turbo码速率匹配的列变换P向量关系对三路比特流按照P向量进行矩阵列变换；定义32*3个宽度为RTC的寄存器，利用寄存器移位操作存入寄存器中；通过计数器cnt控制寄存器的移位操作，cnt计数器中cnt取最低5比特作为索引，在0～31之间循环变换直到valid无效，并列出相应的表数据。在本发明的某些实施方式中，步骤S2具体包括：计算矩阵的偏移量；确定遍历的起始位置；分别对数据执行遍历；比特收集和输出，通过判断使能信号，确定输出的比特数量，并转换为并行数据输出。在本发明的某些实施方式中，步骤S2中，所述计算矩阵的偏移量具体包括：矩阵的偏移量为32的整倍数，定义偏移量的结果为k0，对k0求96的余数得到kr，将第一、二、三路的比特数据按顺序进行拼接。在本发明的某些实施方式中，步骤S2中，所述确定遍历的起始位置具体包括：定义0～31行为区间一，定义32～95行为区间二，定义kr行为区间，其中，vcnt从第kr行开始遍历，如果遍历到第96行，回到第一行继续遍历，直到第kr-1行为止。在本发明的某些实施方式中，步骤S2中，所述分别对数据执行遍历具体包括：对区间一的遍历，hcnt从表格中最右侧开始遍历，x的第一个比特可能包含填充的空比特，此处为零比特，通过Sel中的比特来判断是否为空比特，若为空比特则输出使能为2’b00，若有效则输出当前比特且输出使能为2’b00，向右遍历；对区间二的遍历，同时输出相邻的两行，可能一次性输出两个比特；hcnt从表格中最右侧开始遍历，x的第一个比特可能包含填充的空比特，此处为零比特，通过Sel和Sel2中的比特来判断是否为空比特，在连续两行输出都有效时则使能为2’b11，再只有第一行有效时输出使能为2’b01，在只有第二行有效时输出使能为2’b10。与现有技术相比，本发明有以下优点：本发明所述基于FPGA的任意长度turbo码速率匹配方法利用寄存器偏移有序缓存turbo码输入数据，可以根据实际码长，遍历输出速率匹配后的码流，针对第二路、第三路码流奇偶交叉，同时支持单比特和双比特输出，提高码流的输出速率，减少链路延时，最终可转化为统一固定位宽的连续并行数据，优化后续链路设计，而缓存turbo码输入数据时，可以一步完成缓存、换序、空比特特征值。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明所述基于FPGA的任意长度turbo码速率匹配方法的流程参考示意图。图2为本发明的时序图。图3-5为本发明对应的接口示意图。具体实施方式为了使本技术领域的人员更好地理解本发明方案，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述。显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例，附图中给出了本发明的较佳实施例。本发明可以以许多不同的形式来实现，并不限于本文所描述的实施例，相反地，提供这些实施例的目的是使对本发明的公开内容的理解更加透彻全面。结合图1所示，所述基于FPGA的任意长度turbo码速率匹配方法包括如下步骤：步骤S1：根据Turbo编码输出的长度，对输入的比特数据进行补零，使得比特数据的总比特数为32的整倍数；步骤S2：根据Turbo编码的实际长度，定义hcnt和vcnt即行索引和列索引两个变量对数据进行遍历，在FPGA中，使用状态机对数据进行遍历并以此输出。在本发明实施实施例中，结合图2的时序图所示，步骤S1中，通过延长使能信号，延迟输入比特数据实现补零操作。分别定义三路比特流，分别为Turbo码长最大为6144，定义的寄存器以rm_leng表示，则有计算补零的比特数公式如下：其中，valid为输入有效信号，为补零后的总长度，是32的整倍数；第一路输入延迟ZeroBit个时钟输入后为/＞第二路输入延迟ZeroBit个时钟输入后为/＞第二路输入延迟ZeroBit-1个时钟输入后为/＞其中，Turbo码速率匹配的列变换P向量关系见表1所示。表1记录三路比特流的矩阵首行补零的特征位置，并基于Turbo码速率匹配的列变换P向量关系对三路比特流按照P向量进行矩阵列变换；其中，第一路和第二路：Sgn＝,其中0的个数是rm_leng个，1的个数是32-rm_leng；第三路：Sgn2＝{Sgn,Sgn}。对Sgn和Sgn2按照P向量进行矩阵列变换：Sel＝Sgn]Sel2＝Sgn2]。FPGA的开发环境并不支持矩阵变换，由于最大长度为6144，本发明定义32*3个宽度为RTC的寄存器，利用寄存器移位操作存入寄存器中；可以根据实际情况调整大小，减少延时),利用寄存器移位操作存入寄存器中。通过计数器cnt控制寄存器的移位操作，cnt计数器的定义见表1，cnt取最低5比特作为索引，在0～31之间循环变换直到valid无效。以第一路为例最终结果见表2，第二路和第三路分别见表3、表4：表2寄存器RTC-1...............10x00...0r0r0...r0r0x160...0r0r0...r0r0x80...0r0r0...r0r0.........0........................0...............x150...0r0......r0r0x310...0r0r0...r0r0表2中，寄存器所在列已经按照表1进行换序。表3寄存器RTC-1...............10y00...0r1r1...r1r0y160...0r1r1...r1r1y80...0r1r1...r1r1.........0........................0...............y150...0r1......r1r1y310...0r1r1...r1r1表4/＞在本发明实施实施例中，步骤S2具体包括：计算矩阵的偏移量；确定遍历的起始位置；分别对数据执行遍历；比特收集和输出，通过判断使能信号，确定输出的比特数量，并转换为并行数据输出。根据实际长度，定义hcnt和vcnt即行索引和列索引两个变量对表2、表3、表4中的数据进行遍历。在FPGA中，此处为了减少遍历时间，使用状态机对表中数据进行遍历并以此输出。所述计算矩阵的偏移量具体包括：矩阵的偏移量为32的整倍数，定义偏移量的结果为k0，对k0求96的余数得到kr，将第一、二、三路的比特数据按顺序进行拼接，结果见表5：表5序号寄存器RTC-1...100x0RTC-1...x0x01x1RTC-1x1x1..................30x30RTC-1x30x3031x31RTC-1...x31x3132y0RTC-1...y0y033z0RTC-1...z0z034y1RTC-1...y1y135z1RTC-1...z1z1...................................92y30RTC-1y30y3093z30RTC-1z30z3094y31RTC-1...y31y3195z31RTC-1...z31z31所述确定遍历的起始位置参见表6：表6kr0～3132～95区间区间一区间二定义0～31行为区间一，定义32～95行为区间二，定义kr行为区间，其中，vcnt从第kr行开始遍历，如果遍历到第96行，回到第一行继续遍历，直到第kr-1行为止。所述分别对数据执行遍历具体包括：对区间一的遍历，hcnt从表格中最右侧开始遍历，x的第一个比特可能包含填充的空比特，此处为零比特，通过Sel中的比特来判断是否为空比特，若为空比特则输出使能为2’b00，若有效则输出当前比特且输出使能为2’b00，向右遍历；对区间二的遍历，同时输出相邻的两行，可能一次性输出两个比特；hcnt从表格中最右侧开始遍历，x的第一个比特可能包含填充的空比特，此处为零比特，通过Sel和Sel2中的比特来判断是否为空比特，在连续两行输出都有效时则使能为2’b11，再只有第一行有效时输出使能为2’b01，在只有第二行有效时输出使能为2’b10。实施例1本发明实施例所述基于FPGA的任意长度turbo码速率匹配方法的输入来自turbo编码，输入的接口如图3所示。本发明实施例的接口如图4所示，遵循36-212协议，利用子块收集缓存turbo编码，按照本设计的方案缓存到寄存器，根据turbo码长和特征码遍历寄存器中的比特，输出1～2位宽的比特。本发明实施例将遍历的比特转换为固定位宽输出，输出的接口参见图5所示。本发明实施例所述基于FPGA的任意长度turbo码速率匹配方法较现有技术具有以下优点：1、可以支持用于任意码长的turbo码的速率匹配计算，关于4G、5G基站的设计中，为了避免码长不确定的因素，目前现有技术多采用有限的几种长度，又要在其他流程上填充和剔除无效信息，消耗额外的硬件资源，属于固定关系映射，无需利用特征值和解奇偶交叉，也没有rv的偏移；而本发明则无限制，适配任意长度，对于码长不确定的应用场景具有较佳的适用效果。2、可以根据实际中最大的码长调整相应的参数，减少逻辑资源的占用。3、将矩阵变换转换为比特流的缓存和输出，改变使能信号实现填充空比特的操作，利用标记特征值剔除空比特。4、减少了turbo码速率匹配的延迟，只需要两倍最大码长个时钟周期，根据实际码长从寄存器中遍历出速率匹配后的码流。本说明书中未作详细描述的内容属于本领域专业技术人员公知的现有技术。以上仅为本发明的实施例，但并不限制本发明的专利范围，尽管参照前述实施例对本发明进行了详细的说明，对于本领域的技术人员来而言，其依然可以对前述各具体实施方式所记载的技术方案进行修改，或者对其中部分技术特征进行等效替换。凡是利用本发明说明书及附图内容所做的等效结构，直接或间接运用在其他相关的技术领域，均同理在本发明专利保护范围之内。
