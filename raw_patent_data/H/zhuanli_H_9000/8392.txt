标题title
POS机使用区域限制管理方法、系统及其可读介质
摘要abst
本发明公开了一种POS机使用区域限制管理方法、系统及其可读介质，该方法包括获取POS机当前注册区域内主基站以及邻近基站的位置信息，存储为当前位置信息集合，从安全存储区域读取并解密获得合法位置信息集合，当前位置信息集合与合法位置信息集合进行匹配运算；当当前位置信息集合与合法位置信息集合的交集元素数达到门限值时，判定POS机的当前注册区域属于安全使用区域。采用了多对多匹配算法从而提升相对定位稳定性，另外，通过自动更新合法位置信息实现对通讯网络环境的适应，从而达到降低误判率的目的；并通过添加门限值、根据安全使用区域位置属性调整门限值和合法位置信息上限值平衡稳定性和精确性。
权利要求书clms
1.一种POS机使用区域限制管理方法，其特征在于，所述方法包括：获取POS机当前注册区域内主基站以及邻近基站的位置信息，存储为当前位置信息集合；从安全存储区域读取并解密获得合法位置信息集合，所述当前位置信息集合与所述合法位置信息集合进行匹配运算；当所述当前位置信息集合与所述合法位置信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。2.根据权利要求1所述的POS机使用区域限制管理方法，其特征在于，所述方法还包括：在所述POS机设定的安全使用区域下，初次采集在所述安全使用区域下的当前位置信息，并将所述当前位置信息加密存储为合法位置信息集合。3.根据权利要求2所述的POS机使用区域限制管理方法，其特征在于，所述初次采集在所述安全使用区域下的当前位置信息，并将所述当前位置信息加密存储为合法位置信息集合的步骤还包括：根据所述安全使用区域内的基站密度设置所述门限值，以及所述合法位置信息集合中元素数量上限值；当所述POS机的当前注册区域属于安全使用区域时，将所采集当前位置信息中不属于所述合法位置信息集合按照信号强度顺序增加到所述合法位置信息集合，直至所述合法位置信息集合达到所述上限值。4.根据权利要求3所述的POS机使用区域限制管理方法，其特征在于，所述方法还包括：获取POS机当前注册区域内主基站以及邻近基站的位置信息之后，记录每一个基站位置信息出现在所述当前位置信息集合的时间和频次；当所述基站位置信息未出现的时间达到预设时间阈值时，从所述合法位置信息集合中移除所述基站位置信息；将在预设时间阈值内出现频次最多或者信号强度最大的所述基站位置信息加入到所述合法位置信息集合。5.根据权利要求4所述的POS机使用区域限制管理方法，其特征在于，所述方法还包括：当所述门限值大于所述当前位置信息集合或所述合法位置信息集合的元素数时，将所述当前位置信息集合的元素数、所述合法位置信息集合的元素数中最小的作为所述门限值；当所述当前位置信息集合与所述合法位置信息集合的交集元素数达到所述门限值时，判定所述POS机的当前注册区域属于安全使用区域。6.根据权利要求2所述的POS机使用区域限制管理方法，其特征在于，所述方法还包括：所述方法还包括：当所述POS机存在多个安全使用区域，对应每一个所述安全使用区域设定一合法位置信息集合；获取所述POS机当前注册区域的当前位置信息集合；将所述当前位置信息集合与多个所述合法位置信息集合进行一一匹配运算；当所述当前位置信息集合与其中某一所述合法位置信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。7.根据权利要求2所述的POS机使用区域限制管理方法，其特征在于，所述方法还包括：所述方法还包括：采集并判断POS机的网络制式，当所述POS机处于GSM制式时，采集当前注册区域内主基站和邻近基站的CGI信息，所述当前位置信息为基站CGI信息；当所述POS机处于CDMA制式时，采取当前注册区域内主基站的CGI信息以及主基站和邻近基站的PN导频码信息。8.根据权利要求7所述的POS机使用区域限制管理方法，其特征在于，所述方法还包括：所述POS机处于CDMA制式时，所述方法包括：将当前注册区域内主基站的CGI信息与预先存储的安全使用区域下的合法CGI信息集合进行匹配；若所述CGI信息属于所述合法CGI信息集合，则判定所述POS机的当前注册区域属于安全使用区域；若所述CGI信息不属于所述合法CGI信息集合，将当前注册区域内主基站和邻近基站的当前PN导频码信息集合与预先存储的安全使用区域下的合法PN导频码信息集合进行匹配运算；当所述当前PN导频码信息集合与所述合法PN导频码信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。9.一种POS相对定位系统，其特征在于，所述系统包括：位置信息采集模块，用于获取POS机当前注册区域内主基站以及邻近基站的位置信息，存储为当前位置信息集合；合法位置信息存取模块，在所述POS机设定的安全使用区域下，初次采集在所述安全使用区域下的当前位置信息，并将所述当前位置信息加密存储为合法位置信息集合；相对定位判断模块，用于从安全存储区域读取并解密获得合法位置信息集合，所述当前位置信息集合与所述合法位置信息集合进行匹配运算；当所述当前位置信息集合与所述合法位置信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。10.一种具有计算机可读存储介质，其特征在于，所述计算机可读存储介质用于存储程序数据，程序数据在被处理器执行时，用于实现如权利要求1-8任意一项所述的POS机使用区域限制管理方法。
说明书desc
技术领域本发明涉及POS机系统技术领域，特别涉及一种POS机使用区域限制管理方法、系统及其可读介质。背景技术POS机是用于进行金融支付活动的专用设备，支持磁条卡、芯片卡、闪付卡的支付。POS机的通信方式有很多，可以通过电话线、modem、无线蜂窝移动网络、蓝牙等等。无线POS机专指内含无线通讯器件、支持通过无线蜂窝移动网络进行通信的POS机。随着无线POS机的应用推广，其跨区使用的安全性逐渐受到银行等客户或监管方面的关注，并随之产生了限定无线POS机使用区域、防止移机的需求。这意味着定位技术在无线POS机中的重要性逐渐增大，当前移动互联网位置服务主要有终端发起，依靠终端主动发起全球定位系统或网络定位获取位置服务。GPS位置获取需要终端开启GPS及具备GPS服务条件，而网络定位则存在定位精度不高的问题。利用邻近基站信息列表进行定位，这种方式偏向于相对定位。这种定位方式是将邻近基站CGI全部采集，形成一个安全使用区域的基站列表，只要检测的时候采集的主基站CGI处于列表中，则当前区域一定是处于安全使用区域的范围内，而如果当前基站不处于列表中，则判断邻近基站是否在列表中，若处于列表中则判为处于安全使用区域，否则就通过基于单基站CGI转经纬度的算法的虚拟位置计算辅助定位，若距离小于一定的阈值则仍判为处于安全使用区域，否则判为处于非法区域。这种方式的优点在于主体算法简单，时空开销低，但是其辅助算法依赖基于传播参数定位的方法，同样引入了辅助算法的缺点。发明内容本发明要解决的技术问题是提供一种POS机使用区域限制管理方法、系统及其可读介质，能够实现在不依赖任何第三方数据库或服务器的相对定位算法，从而保证POS机使用区域限制管理可以保证独立长期地低成本使用。为解决上述技术问题，本申请采用的一个技术方案是：提供一种POS机使用区域限制管理方法，该方法包括：获取POS机当前注册区域内主基站以及邻近基站的位置信息，存储为当前位置信息集合；从安全存储区域读取并解密获得合法位置信息集合，所述当前位置信息集合与所述合法位置信息集合进行匹配运算；当所述当前位置信息集合与所述合法位置信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。进一步的，所述方法还包括：在所述POS机设定的安全使用区域下，初次采集在所述安全使用区域下的当前位置信息，并将所述当前位置信息加密存储为合法位置信息集合。进一步的，所述初次采集在所述安全使用区域下的当前位置信息，并将所述当前位置信息加密存储为合法位置信息集合的步骤还包括：根据所述安全使用区域内的基站密度设置所述门限值，以及所述合法位置信息集合中元素数量上限值；当所述POS机的当前注册区域属于安全使用区域时，将所采集当前位置信息中不属于所述合法位置信息集合按照信号强度顺序增加到所述合法位置信息集合，直至所述合法位置信息集合达到所述上限值。进一步的，所述方法还包括：获取POS机当前注册区域内主基站以及邻近基站的位置信息之后，记录每一个基站位置信息出现在所述当前位置信息集合的时间和频次；当所述基站位置信息未出现的时间达到预设时间阈值时，从所述合法位置信息集合中移除所述基站位置信息；将在预设时间阈值内出现频次最多或者信号强度最大的所述基站位置信息加入到所述合法位置信息集合。进一步的，所述方法包括：当所述门限值大于所述当前位置信息集合或所述合法位置信息集合的元素数时，将所述当前位置信息集合的元素数、所述合法位置信息集合的元素数中最小的作为所述门限值；当所述当前位置信息集合与所述合法位置信息集合的交集元素数达到所述门限值时，判定所述POS机的当前注册区域属于安全使用区域。进一步的，所述方法还包括：当所述POS机存在多个安全使用区域，对应每一个所述安全使用区域设定一合法位置信息集合；获取所述POS机当前注册区域的当前位置信息集合；将所述当前位置信息集合与多个所述合法位置信息集合进行一一匹配运算；当所述当前位置信息集合与其中某一所述合法位置信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。进一步的，所述方法还包括：所述初次采集在所述安全使用区域下的当前位置信息后，解析所述当前位置信息并记录当前主基站对应的MCC信息和MNC信息；检测到所述MCC信息和所述MNC信息发生变化时，上报并提示初始化所述合法位置信息集合。进一步的，所述方法还包括：采集并判断POS机的网络制式，当所述POS机处于GSM制式时，采集当前注册区域内主基站和邻近基站的CGI信息，所述当前位置信息为基站CGI信息；当所述POS机处于CDMA制式时，采取当前注册区域内主基站的CGI信息以及主基站和邻近基站的PN导频码信息。进一步的，所述POS机处于CDMA制式时，所述方法包括：将当前注册区域内主基站的CGI信息与预先存储的安全使用区域下的合法CGI信息集合进行匹配；若所述CGI信息属于所述合法CGI信息集合，则判定所述POS机的当前注册区域属于安全使用区域；若所述CGI信息不属于所述合法CGI信息集合，将当前注册区域内主基站和邻近基站的当前PN导频码信息集合与预先存储的安全使用区域下的合法PN导频码信息集合进行匹配运算；当所述当前PN导频码信息集合与所述合法PN导频码信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。可选的，当所述当前PN导频码信息集合与所述合法PN导频码信息集合的交集元素数达到门限值之后，所述方法还包括：判断当前注册区域内主基站的LAC信息是否属于合法位置信息集合：当前注册区域内主基站的LAC信息属于合法位置信息集合，则判断所述合法位置信息集合是否达到上限值，若是则判定所述POS机的当前注册区域属于安全使用区域；否则将当前注册区域内主基站的CGI信息增加到所述合法位置信息集合；当前注册区域内主基站的LAC信息不属于合法位置信息集合，则判定所述合法位置信息集合中不同的LAC信息是否超过3个，若是则判定所述POS机的当前注册区域不属于安全使用区域；若否则判断所述合法位置信息集合是否达到上限值。可选的，当所述POS机的当前注册区域属于安全使用区域时，将所采集主基站和邻近基站的PN导频码信息中不属于合法PN导频码信息集合按照信号强度顺序增加到所述合法PN导频码信息集合，直至所述合法PN导频码信息集合达到所述上限值。为解决上述技术问题，本申请采用的另一个技术方案是：提供一种POS相对定位系统，该系统包括：位置信息采集模块，用于获取POS机当前注册区域内主基站以及邻近基站的位置信息，存储为当前位置信息集合；合法位置信息存取模块，在所述POS机设定的安全使用区域下，初次采集在所述安全使用区域下的当前位置信息，并将所述当前位置信息加密存储为合法位置信息集合；相对定位判断模块，用于从安全存储区域读取并解密获得合法位置信息集合，所述当前位置信息集合与所述合法位置信息集合进行匹配运算；当所述当前位置信息集合与所述合法位置信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。为解决上述技术问题，本申请采用的另一个技术方案是：提供一种具有计算机可读存储介质，该计算机可读存储介质用于存储程序数据，程序数据在被处理器执行时，用于实现如上述的POS机使用区域限制管理方法。本发明技术方案的有益效果：本发明实施例的POS机使用区域限制管理方法、系统及其可读介质，采用当前位置信息集合与合法位置信息集合进行匹配运算，当前位置信息集合与合法位置信息集合的交集元素数达到门限值时，判定POS机的当前注册区域属于安全使用区域；采用了多对多匹配算法从而提升相对定位稳定性，另外，通过自动更新合法位置信息实现对通讯网络环境的适应，从而达到降低误判率的目的；通过合法位置信息自动扩充提高了相对定位的稳定性；并通过添加门限值、根据安全使用区域位置属性调整门限值和合法位置信息上限值平衡稳定性和精确性。从而低成本地实现POS机使用区域限制管理的功能，并且都有较低的误判率、较高的稳定性和足够的精确性。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其他的附图。图1是本发明实施例的POS机使用区域限制管理方法流程框图；图2是本发明实施例的门限值与上限值自适应方法流程框图；图3是本发明实施例的合法位置信息自适应更新方法流程框图；图4是本发明实施例的门限值自适应处理方法流程框图；图5是本发明实施例的多点定位处理方法流程框图；图6是本发明实施例的CDMA制式下POS机使用区域限制管理方法流程框图；图7是本发明实施例的多对多匹配算法示意图；图8是本发明实施例的POS机使用区域限制管理方系统硬件的结构示意图；具体实施方式下面结合附图对本发明的具体实施方式作进一步说明。在此需要说明的是，对于这些实施方式的说明用于帮助理解本发明，但并不构成对本发明的限定。此外，下面所描述的本发明各个实施方式中所涉及的技术特征只要彼此之间未构成冲突就可以相互组合。实施例1如图1所示，本发明实施例提供了一种POS机使用区域限制管理方法，该方法包括：S101、获取POS机当前注册区域内主基站以及邻近基站的位置信息，存储为当前位置信息集合；S102、从安全存储区域读取并解密获得合法位置信息集合，所述当前位置信息集合与所述合法位置信息集合进行匹配运算；S103、当所述当前位置信息集合与所述合法位置信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。当位置信息为CGI信息时，从蜂窝小区的模型出发，这个CGI集合的元素个数可以定为7，即1个主基站加上6个邻近基站。这样合法位置信息和当前位置信息就都是CGI集合，算法也就从多对一匹配算法演进为了多对多匹配算法，即两个位置信息集合的交集不为空集时判为当前处于安全使用区域，反之判为当前处于非法区域。如图7所示，导入多对多匹配算法之后，位置信息就成了图中两处阴影区域。当A基站被拆除而建立了X基站的时候，合法位置CGI集合仍然为M＝{CGI-A，CGI-B，CGI-C，CGI-D，CGI-E，CGI-F，CGI-G}，此时若无线POS机注册到C基站，则当前位置CGI集合理论上为N＝{CGI-X，CGI-B，CGI-C，CGI-D，CGI-H，CGI-I，CGI-J}，那么M∩N＝{CGI-B，CGI-C，CGI-D}不为0，即当前位置仍然判为处于合法位置。若无线POS机注册到X基站，当前CGI集合为N＝{CGI-X，CGI-B，CGI-C，CGI-D，CGI-E，CGI-F，CGI-G}，M∩N＝{CGI-B，CGI-C，CGI-D，CGI-E，CGI-F，CGI-G}不为0，同样判为当前处于合法位置。可选的，所述方法还包括：在所述POS机设定的安全使用区域下，初次采集在所述安全使用区域下的当前位置信息，并将所述当前位置信息加密存储为合法位置信息集合。如图2所示，所述初次采集在所述安全使用区域下的当前位置信息，并将所述当前位置信息加密存储为合法位置信息集合的步骤还包括：S201、根据所述安全使用区域内的基站密度设置所述门限值，以及所述合法位置信息集合中元素数量上限值；S202、当所述POS机的当前注册区域属于安全使用区域时，将所采集当前位置信息中不属于所述合法位置信息集合按照信号强度顺序增加到所述合法位置信息集合，直至所述合法位置信息集合达到所述上限值。例如，假设定义门限值为4，即M∩N的元素数要大于等于4的时候才判为处于安全使用区域，否则判为处于非法区域。如图3所示，所述方法还包括：S301、获取POS机当前注册区域内主基站以及邻近基站的位置信息之后，记录每一个基站位置信息出现在所述当前位置信息集合的时间和频次；S302、当所述基站位置信息未出现的时间达到预设时间阈值时，从所述合法位置信息集合中移除所述基站位置信息；S303、将在预设时间阈值内出现频次最多或者信号强度最大的所述基站位置信息加入到所述合法位置信息集合。实际环境中可能会因为城市规划或无线蜂窝移动网络规划的问题而拆除基站，或者增加的临时基站被加入合法列表，之后在实际环境中移除临时基站等情况。这些无效基站如果继续保留在合法位置信息集合中，将逐渐影响相对定位的稳定性，甚至无法正确判决而导致无法使用。要在合法位置信息集合中将无效基站移除，首先需要识别出无效基站。无效基站的特点是：长时间没有在当前位置信息集合中出现。如图4所示，所述方法包括：S401、当所述门限值大于所述当前位置信息集合或所述合法位置信息集合的元素数时，将所述当前位置信息集合的元素数、所述合法位置信息集合的元素数中最小的作为所述门限值；S402、当所述当前位置信息集合与所述合法位置信息集合的交集元素数达到所述门限值时，判定所述POS机的当前注册区域属于安全使用区域。交集数不会只有1、2、4、7四种可能，从而门限值应该是可调的，在1-7之间均可设置，但是门限值不应该高于合法位置信息集合中的元素总数。对于合法位置信息不足的情况，需要临时将门限值降低为当前合法位置信息集合中的元素个数，即在当前条件下，设置判决能力范围内最高级别的门限值，直到合法位置信息自动增长扩充到设定的门限值以上之后，门限值才不再发生变化。而对于当前位置信息获取的时候无线信号不好而获取不全邻近基站信息的情况，若当前位置信息集合的元素数小于门限值，则门限值也需要临时下降为当前位置信息集合的元素数合法位置信息集合的上限调整。如图5所示，所述方法还包括：S501、当所述POS机存在多个安全使用区域，对应每一个所述安全使用区域设定一合法位置信息集合；S502、获取所述POS机当前注册区域的当前位置信息集合；S503、将所述当前位置信息集合与多个所述合法位置信息集合进行一一匹配运算；S504、当所述当前位置信息集合与其中某一所述合法位置信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。合法位置信息由原来的一个集合改为多个集合，在代码上就从一维数组改为了二维数组。每个集合的存储都对应一次独立的相对定位初始化阶段。每次相对定位判决都依次对每一个集合进行交集运算，只要有一个集合的交集运算结果超过门限值就判为处于合法位置，而如果与所有的合法位置集合的交集运算都没有超过门限值，则判为处于非法位置。可选的，所述方法还包括：所述初次采集在所述安全使用区域下的当前位置信息后，解析所述当前位置信息并记录当前主基站对应的MCC信息和MNC信息；检测到所述MCC信息和所述MNC信息发生变化时，上报并提示初始化所述合法位置信息集合。可选的，所述方法还包括：采集并判断POS机的网络制式，当所述POS机处于GSM制式时，采集当前注册区域内主基站和邻近基站的CGI信息，所述当前位置信息为基站CGI信息；当所述POS机处于CDMA制式时，采取当前注册区域内主基站的CGI信息以及主基站和邻近基站的PN导频码信息。CGI是在全球范围内唯一识别一个无线基站的编码，在无线基站定位技术中，CGI是经常被使用的参数之一。CGI按其编码顺序由LAI和CID组成，而LAI按其编码顺序又由MCC、MNC、LAC组成。对于任何制式的网络，要获取当前注册的基站的CGI总是可以的。对于GSM制式的网络，可以查询到邻近基站的CGI。对于CDMA制式的网络，不能查询到邻近基站的CGI。CDMA系统的一般模型中一个蜂窝小区分为三个扇区，每个扇区120°，使用一个PN导频码区分，这个PN导频码可以表示实际使用的PN短码。PN短码有15位长，但是CDMA规定相邻的PN短码需要间隔64个码片，因此实际PN短码就只用了512个，用9位码长的PN导频码就可以表示了。从而PN导频码的取值在0到511之间。CDMA制式下的相对定位算法，使用PN导频码替代CGI之后，其算法本身没有太大的改动，但在数据结构方面要增加PN导频码集合，这里并不是对每个基站对应的数据结构增加3个PN导频码的成员变量而直接增加集合，因为获取PN导频码信息的时是一次性给出的，无法区分PN导频码与基站的对应关系。合法位置信息集合和当前位置信息集食就都是PN导频码的集合。如图6所示，所述POS机处于CDMA制式时，所述方法包括：S601、将当前注册区域内主基站的CGI信息与预先存储的安全使用区域下的合法CGI信息集合进行匹配；由于邻近基站的CGI信息无法获取，单纯只用3个PN导频码的组合也无法与CGI对应，因此这里使用的GSM制式下的相对定位算法，也只能是采用合法位置信息与当前主基站多对一匹配算法。S602、若所述CGI信息属于所述合法CGI信息集合，则判定所述POS机的当前注册区域属于安全使用区域；S603、若所述CGI信息不属于所述合法CGI信息集合，将当前注册区域内主基站和邻近基站的当前PN导频码信息集合与预先存储的安全使用区域下的合法PN导频码信息集合进行匹配运算；S604、当所述当前PN导频码信息集合与所述合法PN导频码信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。当用3个PN导频码取代一个CGI，那么必然也是计算两个PN导频码集合的交集数是否大于门限值。那么只要门限值足够髙，要遇到相同PN导频码组合的环境概率就非常低；PN导频码分布没有规律的前提下是可以用PN导频码在上述多对多匹配算法中取代CGI来实现相对定位功能的。当两个集合中有任何一个的元素数低于12就不能进行判决，直接按照处于非法位置处理，同时可以告知应用当前无线环境无法定位，以便应用程序提示用户，进而方便售后排查问题。特别的是，如果相对定位初始化阶段获取到的PN导频码数低于9，则直接提报相对定位初始化阶段失败。可选的，当所述当前PN导频码信息集合与所述合法PN导频码信息集合的交集元素数达到门限值之后，所述方法还包括：判断当前注册区域内主基站的LAC信息是否属于合法位置信息集合：当前注册区域内主基站的LAC信息属于合法位置信息集合，则判断所述合法位置信息集合是否达到上限值，若是则判定所述POS机的当前注册区域属于安全使用区域；否则将当前注册区域内主基站的CGI信息增加到所述合法位置信息集合；当前注册区域内主基站的LAC信息不属于合法位置信息集合，则判定所述合法位置信息集合中不同的LAC信息是否超过3个，若是则判定所述POS机的当前注册区域不属于安全使用区域；若否则判断所述合法位置信息集合是否达到上限值。可选的，当所述POS机的当前注册区域属于安全使用区域时，将所采集主基站和邻近基站的PN导频码信息中不属于合法PN导频码信息集合按照信号强度顺序增加到所述合法PN导频码信息集合，直至所述合法PN导频码信息集合达到所述上限值。实施例2如图8所示，本发明实施例提供的一种POS相对定位系统100，该系统包括：位置信息采集模块110，用于获取POS机当前注册区域内主基站以及邻近基站的位置信息，存储为当前位置信息集合；合法位置信息存取模块120，在所述POS机设定的安全使用区域下，初次采集在所述安全使用区域下的当前位置信息，并将所述当前位置信息加密存储为合法位置信息集合；相对定位判断模块130，用于从安全存储区域读取并解密获得合法位置信息集合，所述当前位置信息集合与所述合法位置信息集合进行匹配运算；当所述当前位置信息集合与所述合法位置信息集合的交集元素数达到门限值时，判定所述POS机的当前注册区域属于安全使用区域。具体的，位置信息采集模块负责调用无线通讯器件驱动获取当前无线POS机所处的无线环境信息，并将安全使用区域的环境信息交给合法位置信息存取模块，将当前位置信息交给相对定位判断模块；合法位置信息存取模块负责将位置信息采集模块传入的合法位置信息存取起来，并在需要进行相对定位判决的时候将合法位置信息提供给相对定位判断模块；相对定位判断模块根据传入的当前位置信息和合法位置信息做出当前位置是否处于安全使用区域的判决，并将判决结果输出。该系统工作流程基本分为两个阶段：相对定位功能初始化阶段就是位置信息采集模块采集安全使用区域信息并交由合法位置信息存取模块存储的过程，此阶段在开启相对定位功能的时候必须执行，否则在使用阶段相对定位判断模块将因没有合法位置信息而无法进行判断。但由于初始化阶段必然要求无线POS机处于安全使用区域，而此时相对定位功能还无法使用，所以此时必须由人工判决当前无线POS机是否处于安全使用区域。同时合法位置信息作为相对定位的判决基准，为避免攻击者通过在非法位置执行相对定位初始化阶段来篡改合法位置信息，因此人工判决必须有权限限制；在实际使用场景中就是经过授权的人员在安装无线POS机的时候通过口令或其他认证方式认证之后开启此功能。位置信息采集模块：在无线POS机中无线通讯器件通过串口与MCU相连。而无线通讯器件则通过AT命令与MCU交互。每个无线通讯器件都会有AT命令可以向无线通讯器件查询当前的基站信息。而AT命令的收发和解析是由无线通讯器件驱动实现的，因此位置信息采集模块只需要调用无线通讯器件驱动的相关接口从无线通讯器件获取当前的基站信息，并根据相对定位判断模块的算法要求，整理这些基站信息并组成算法所需要的数据结构传递给合法位置信息存取模块和相对定位判断模块。位置信息采集模块还需要通过无线通讯器件驱动获取SIM卡的运营商，若运营商与之前合法位置信息存取模块存储的不一致，则上报运营商变更，需要重新进行相对定位功能初始化。合法位置信息存取模块用于存储和读取在相对定位功能初始化阶段获取的合法位置信息，而因为合法位置信息是整个相对定位的判决基准，如果这个信息被篡改，整个相对定位就失去了其意义，因此合法位置信息必须加密后存于安全CPU的安全区域。相对定位判断模块，采用相对定位算法保证误判率低、相对稳定性以及精确性，采用了多对多匹配算法从而提升相对定位稳定性，另外，通过自动更新合法位置信息实现对通讯网络环境的适应，从而达到降低误判率的目的；通过合法位置信息自动扩充提高了相对定位的稳定性；并通过添加门限值、根据安全使用区域位置属性调整门限值和合法位置信息上限值平衡稳定性和精确性。从而低成本地实现POS机使用区域限制管理的功能，并且都有较低的误判率、较高的稳定性和足够的精确性。实施例3本发明实施例还提供了一种计算机可读存储介质，该计算机可读存储介质上存储有POS机使用区域限制管理程序，所述POS机使用区域限制管理程序被处理器执行时，实现上述POS机使用区域限制管理方法的步骤。可以理解的，本实施例中的计算机可读存储介质可以应用于服务器，其具体的实施可以参考上述实施例，这里不再赘述。本发明实施例的POS机使用区域限制管理方法、系统及其可读介质，采用当前位置信息集合与合法位置信息集合进行匹配运算，当前位置信息集合与合法位置信息集合的交集元素数达到门限值时，判定POS机的当前注册区域属于安全使用区域；采用了多对多匹配算法从而提升相对定位稳定性，另外，通过自动更新合法位置信息实现对通讯网络环境的适应，从而达到降低误判率的目的；通过合法位置信息自动扩充提高了相对定位的稳定性；并通过添加门限值、根据安全使用区域位置属性调整门限值和合法位置信息上限值平衡稳定性和精确性。从而低成本地实现POS机使用区域限制管理的功能，并且都有较低的误判率、较高的稳定性和足够的精确性。
