标题title
适用于级联全桥NPC逆变器的无缝开路故障模型预测容错控制方法
摘要abst
本发明公开了一种适用于级联全桥NPC逆变器的无缝开路故障模型预测容错控制方法，涉及级联多电平逆变器故障容错控制领域。容错拓扑由n+1个子模块串联构成；子模块1至n为普通子模块，子模块n+1为冗余子模块；普通子模块交流输出侧配置了双向晶闸管，冗余子模块交流输出侧未配置双向晶闸管。在正常运行阶段，普通子模块投入运行，冗余子模块旁路；在故障诊断阶段，普通子模块继续在故障条件下运行，冗余子模块对开路故障器件引起的电流跟踪误差进行实时补偿；在故障重构阶段，故障子模块切除，冗余子模块代替故障子模块投入运行。本发明可在故障诊断阶段维持级联全桥NPC逆变器输出电流波形的完整性，可在单个器件开路故障的条件下实现输出电流的无缝输出，提高系统可靠性。
权利要求书clms
1.一种适用于级联全桥NPC逆变器的无缝开路故障模型预测容错控制方法，其特征在于：所述控制方法在如下容错拓扑中实现：采用的容错拓扑由n+1个子模块串联构成，每个子模块的电路拓扑均为级联全桥NPC逆变器；子模块1至子模块n为普通子模块，子模块n+1为冗余子模块；普通子模块交流输出侧均配置了双向晶闸管，冗余子模块的交流输出侧未配置双向晶闸管；所述级联全桥NPC逆变器的运行包括正常运行、故障诊断、故障重构三个阶段，每个控制周期首先判断级联全桥NPC逆变器当前的运行阶段；所述控制方法具体步骤如下：一、若判断级联全桥NPC逆变器当前的运行阶段为正常运行：1)普通子模块的控制方法包括以下步骤：①依次按式和式计算总输出电平数M：式中，Lo表示级联全桥NPC逆变器交流输出侧滤波电感的电感值，Ro表示级联全桥NPC逆变器交流输出侧负载电阻的电阻值，Vdc表示子模块直流输入电源的电压；TS表示普通子模块模型预测控制的控制周期，ioref表示级联全桥NPC逆变器交流输出电流在第k+1个控制周期的瞬时值，io表示级联全桥NPC逆变器交流输出电流在第k个控制周期的采样值；函数round表示四舍五入函数；②依次按a、b、c将总输出电平数M分配至每个普通子模块：a、求所有普通子模块电容电压差值ΔUC1、ΔUC2、……、ΔUCn的绝对值|ΔUC1|、|ΔUC2|、……、|ΔUCn|；b、对|ΔUC1|、|ΔUC2|、……、|ΔUCn|进行降序排序；c、由前至后地进行第一趟电平分配：当M＞0时，每个子模块被分配得到+1电平，当M＜0时，每个子模块被分配得到-1电平，直至总电平数M被分配完；若第一趟未能将M分配完，则进行第二趟由后至前地反向分配，直至总电平数M被分配完；第一个子模块至第n个子模块最终被分配得到的电平数依次用M1、M2、……、Mn表示；③根据每个普通子模块分配得到的输出电平数确定该子模块的开关状态，所有普通子模块均采用相同的开关状态确定方法：若某子模块被分配得到+2电平，则该子模块的开关状态被确定为；若某子模块被分配得到+1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到0电平，则该子模块的开关状态被确定为；若某子模块被分配得到-1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到-2电平，则该子模块的开关状态被确定为；2)冗余子模块的控制方法为：将冗余子模块的开关状态SWn+1设置为；二、若判断级联全桥NPC逆变器当前的运行阶段为故障诊断：1)普通子模块的控制方法包括以下步骤：①依次按式和式计算总输出电平数M：②依次按a、b、c将总输出电平数M分配至每个普通子模块：a、求所有普通子模块电容电压差值ΔUC1、ΔUC2、……、ΔUCn的绝对值|ΔUC1|、|ΔUC2|、……、|ΔUCn|；b、对|ΔUC1|、|ΔUC2|、……、|ΔUCn|进行降序排序；c、由前至后地进行第一趟电平分配：当M＞0时，每个子模块被分配得到+1电平，当M＜0时，每个子模块被分配得到-1电平，直至总电平数M被分配完；若第一趟未能将M分配完，则进行第二趟由后至前地反向分配，直至总电平数M被分配完；第一个子模块至第n个子模块最终被分配得到的电平数依次用M1、M2、……、Mn表示；③根据每个普通子模块分配得到的输出电平数确定该子模块的开关状态，所有普通子模块均采用相同的开关状态确定方法：若某子模块被分配得到+2电平，则该子模块的开关状态被确定为；若某子模块被分配得到+1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到0电平，则该子模块的开关状态被确定为；若某子模块被分配得到-1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到-2电平，则该子模块的开关状态被确定为；2)冗余子模块的控制方法包括如下步骤：①依次按式和式计算冗余子模块输出电平数Mn+1：式中，Δio表示级联全桥NPC逆变器交流输出电流跟踪误差在第k个控制周期的采样值；TR表示冗余子模块模型预测控制的控制周期；TR与公式中TS的关系为：TS＝qTR，q＝1，2，……，10；②确定冗余子模块的开关状态SWn+1，方法为：若Mn+1＝+2，则该子模块的开关状态被确定为；若Mn+1＝+1，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若Mn+1＝0，则该子模块的开关状态被确定为；若Mn+1＝-1，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若Mn+1＝-2，则该子模块的开关状态被确定为；三、若判断级联全桥NPC逆变器当前的运行阶段为故障重构：1)普通子模块的控制方法包括以下步骤：①将故障子模块交流输出侧的双向晶闸管开通，即Tx＝1，x表示故障子模块的编号；②按式和式计算总输出电平数M；③将冗余子模块的电容电压差值ΔUCn+1赋值给故障子模块的电容差值ΔUCx，即ΔUCx＝ΔUCn+1；④依次按a、b、c将总输出电平数M分配至每个普通子模块：a、求所有普通子模块电容电压差值ΔUC1、ΔUC2、…、ΔUCx-1、ΔUCn+1、ΔUCx+1、…、ΔUCn的绝对值|ΔUC1|、|ΔUC2|、…、|ΔUCx-1|、|ΔUCn+1|、|ΔUCx+1|、…、|ΔUCn|；b、对|ΔUC1|、|ΔUC2|、…、|ΔUCx-1|、|ΔUCn+1|、|ΔUCx+1|、…、|ΔUCn|进行降序排序；c、由前至后地进行第一趟电平分配：当M＞0时，每个子模块被分配得到+1电平，当M＜0时，每个子模块被分配得到-1电平，直至总电平数M被分配完；若第一趟未能将M分配完，则进行第二趟由后至前地反向分配，直至总电平数M被分配完；⑤根据每个普通子模块分配得到的输出电平数确定该子模块的开关状态，所有普通子模块均采用相同的开关状态确定方法：若某子模块被分配得到+2电平，则该子模块的开关状态被确定为；若某子模块被分配得到+1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到0电平，则该子模块的开关状态被确定为；若某子模块被分配得到-1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到-2电平，则该子模块的开关状态被确定为；⑥将故障子模块的开关状态SWx赋值给冗余子模块的开关状态SWn+1，即SWn+1＝SWx；再将故障子模块的开关状态SWx置零，即SWx＝。
说明书desc
技术领域本发明涉及级联多电平逆变器故障容错控制领域，具体为一种适用于级联全桥NPC逆变器的无缝开路故障模型预测容错控制方法。背景技术由于单个电力电子器件的耐压值和通流能力有限，导致单模块型逆变器的输出功率和输出电压有限，无法满足高压、大功率场合的应用需求，因而可将多个单模块型逆变器串联以进一步增加逆变器的输出功率和输出电压。相对于单模块型逆变器，多模块级联型逆变器的优点在于：1)在不增加开关器件耐压的条件下增加了逆变器的输出电平数；2)减小了阶跃电压；3)以较低的开关频率获得较高的输出等效频率；4)提高了输出电压的波形质量；5)不同的子模块相互独立，便于进行冗余容错控制。级联全桥NPC逆变器是一种常用的多模块级联型逆变器，被应用于光伏发电系统、列车牵引供电系统以及数字功率放大系统。级联全桥NPC逆变器使用了很多电力电子器件，其安全稳定性受到电力电子器件可靠性的制约。电力电子器件的故障可被分为短路故障和开路故障两类，其中短路故障具备直接破坏性，可在短时间内造成子模块的永久性损坏，一般通过带硬件保护的驱动器对此类故障在10us内完成检测和隔离。开路故障不具备直接破坏性，但会间接地造成过电压、过电流、波形畸变等负面影响，严重时更有可能引发二次故障，因此开路故障一般通过软件方法进行诊断。但是，基于软件方法进行开路故障诊断必须使开路故障持续一定的时间才能提取足够的故障特征以得到精确的故障诊断结果，而在故障诊断阶段的输出波形畸变或波形缺失会严重影响负载的可靠运行。因此，如何在故障诊断阶段维持级联全桥NPC逆变器的输出波形完整性对其采用的故障容错方法形成了巨大挑战。已有适用于多模块级联型逆变器的故障容错方法可被分为热备用冗余和冷备用冗余两类，但这两类方法都是在完成故障诊断后通过故障重构实现的，它们无法应对开路故障诊断阶段级联全桥NPC逆变器的输出波形畸变或波形缺失问题。因此，目前迫切需要一种可在开路故障诊断阶段维持级联全桥NPC逆变器输出波形完整性的故障容错方法，以实现在单个器件故障的条件下实现输出电流的无缝输出，提高系统可靠性。发明内容本发明为了解决开路故障诊断阶段级联全桥NPC逆变器的波形不能完整输出，可能会存在波形畸变或波形缺失的问题，提供了一种适用于级联全桥NPC逆变器的无缝开路故障模型预测容错控制方法。本发明是通过如下技术方案来实现的：一种适用于级联全桥NPC逆变器的无缝开路故障模型预测容错控制方法，所述控制方法在如下容错拓扑中实现：采用的容错拓扑由n+1个子模块串联构成，每个子模块的电路拓扑均为级联全桥NPC逆变器；子模块1至子模块n为普通子模块，子模块n+1为冗余子模块；普通子模块交流输出侧均配置了双向晶闸管，冗余子模块的交流输出侧未配置双向晶闸管；所述级联全桥NPC逆变器的运行包括正常运行、故障诊断、故障重构三个阶段，每个控制周期首先判断级联全桥NPC逆变器当前的运行阶段；所述控制方法具体步骤如下：一、若判断级联全桥NPC逆变器当前的运行阶段为正常运行：1)普通子模块的控制方法包括以下步骤：①依次按式和式计算总输出电平数M：式中，Lo表示级联全桥NPC逆变器交流输出侧滤波电感的电感值，Ro表示级联全桥NPC逆变器交流输出侧负载电阻的电阻值，Vdc表示子模块直流输入电源的电压；TS表示普通子模块模型预测控制的控制周期，ioref表示级联全桥NPC逆变器交流输出电流在第k+1个控制周期的瞬时值，io表示级联全桥NPC逆变器交流输出电流在第k个控制周期的采样值；函数round表示四舍五入函数；②依次按a、b、c将总输出电平数M分配至每个普通子模块：a、求所有普通子模块电容电压差值ΔUC1、ΔUC2、……、ΔUCn的绝对值|ΔUC1|、|ΔUC2|、……、|ΔUCn|；b、对|ΔUC1|、|ΔUC2|、……、|ΔUCn|进行降序排序；c、由前至后地进行第一趟电平分配：当M＞0时，每个子模块被分配得到+1电平，当M＜0时，每个子模块被分配得到-1电平，直至总电平数M被分配完；若第一趟未能将M分配完，则进行第二趟由后至前地反向分配，直至总电平数M被分配完；第一个子模块至第n个子模块最终被分配得到的电平数依次用M1、M2、……、Mn表示；③根据每个普通子模块分配得到的输出电平数确定该子模块的开关状态，所有普通子模块均采用相同的开关状态确定方法：若某子模块被分配得到+2电平，则该子模块的开关状态被确定为；若某子模块被分配得到+1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到0电平，则该子模块的开关状态被确定为；若某子模块被分配得到-1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到-2电平，则该子模块的开关状态被确定为；2)冗余子模块的控制方法为：将冗余子模块的开关状态SWn+1设置为；二、若判断级联全桥NPC逆变器当前的运行阶段为故障诊断：1)普通子模块的控制方法包括以下步骤：①依次按式和式计算总输出电平数M：②依次按a、b、c将总输出电平数M分配至每个普通子模块：a、求所有普通子模块电容电压差值ΔUC1、ΔUC2、……、ΔUCn的绝对值|ΔUC1|、|ΔUC2|、……、|ΔUCn|；b、对|ΔUC1|、|ΔUC2|、……、|ΔUCn|进行降序排序；c、由前至后地进行第一趟电平分配：当M＞0时，每个子模块被分配得到+1电平，当M＜0时，每个子模块被分配得到-1电平，直至总电平数M被分配完；若第一趟未能将M分配完，则进行第二趟由后至前地反向分配，直至总电平数M被分配完；第一个子模块至第n个子模块最终被分配得到的电平数依次用M1、M2、……、Mn表示；③根据每个普通子模块分配得到的输出电平数确定该子模块的开关状态，所有普通子模块均采用相同的开关状态确定方法：若某子模块被分配得到+2电平，则该子模块的开关状态被确定为；若某子模块被分配得到+1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到0电平，则该子模块的开关状态被确定为；若某子模块被分配得到-1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到-2电平，则该子模块的开关状态被确定为；2)冗余子模块的控制方法包括如下步骤：①依次按式和式计算冗余子模块输出电平数Mn+1：式中，Δio表示级联全桥NPC逆变器交流输出电流跟踪误差在第k个控制周期的采样值；TR表示冗余子模块模型预测控制的控制周期；TR与公式中TS的关系为：TS＝qTR，q＝1，2，……，10；②确定冗余子模块的开关状态SWn+1，方法为：若Mn+1＝+2，则该子模块的开关状态被确定为；若Mn+1＝+1，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若Mn+1＝0，则该子模块的开关状态被确定为；若Mn+1＝-1，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若Mn+1＝-2，则该子模块的开关状态被确定为；三、若判断级联全桥NPC逆变器当前的运行阶段为故障重构：1)普通子模块的控制方法包括以下步骤：①将故障子模块交流输出侧的双向晶闸管开通，即Tx＝1，x表示故障子模块的编号；②按式和式计算总输出电平数M；③将冗余子模块的电容电压差值ΔUCn+1赋值给故障子模块的电容差值ΔUCx，即ΔUCx＝ΔUCn+1；④依次按a、b、c将总输出电平数M分配至每个普通子模块：a、求所有普通子模块电容电压差值ΔUC1、ΔUC2、…、ΔUCx-1、ΔUCn+1、ΔUCx+1、…、ΔUCn的绝对值|ΔUC1|、|ΔUC2|、…、|ΔUCx-1|、|ΔUCn+1|、|ΔUCx+1|、…、|ΔUCn|；b、对|ΔUC1|、|ΔUC2|、…、|ΔUCx-1|、|ΔUCn+1|、|ΔUCx+1|、…、|ΔUCn|进行降序排序；c、由前至后地进行第一趟电平分配：当M＞0时，每个子模块被分配得到+1电平，当M＜0时，每个子模块被分配得到-1电平，直至总电平数M被分配完；若第一趟未能将M分配完，则进行第二趟由后至前地反向分配，直至总电平数M被分配完；⑤根据每个普通子模块分配得到的输出电平数确定该子模块的开关状态，所有普通子模块均采用相同的开关状态确定方法：若某子模块被分配得到+2电平，则该子模块的开关状态被确定为；若某子模块被分配得到+1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到0电平，则该子模块的开关状态被确定为；若某子模块被分配得到-1电平，则当该子模块的电容电压差值与输出电流同号时该子模块的开关状态应被确定为，反之该子模块的开关状态应被确定为；若某子模块被分配得到-2电平，则该子模块的开关状态被确定为；⑥将故障子模块的开关状态SWx赋值给冗余子模块的开关状态SWn+1，即SWn+1＝SWx；再将故障子模块的开关状态SWx置零，即SWx＝。与现有技术相比本发明具有以下有益效果：本发明所提供的一种适用于级联全桥NPC逆变器的无缝开路故障模型预测容错控制方法，在故障诊断阶段利用冗余子模块对开路故障引起的输出电流跟踪误差进行实时补偿，可在故障诊断阶段维持级联全桥NPC逆变器输出电流波形的完整性，可在单个器件开路故障的条件下实现输出电流的无缝输出，提高系统可靠性。附图说明图1为适用于级联全桥NPC逆变器的无缝故障模型预测容错控制原理图，该图中为子模块数n＝3且输出电平数M＝2时电平分配原理图。图2为子模块数n＝3且输出电平数M＝-5时电平分配原理图。图3为开关状态选择流程图。图4为无缝故障模型预测容错控制结构图。图5为级联全桥NPC逆变器的电路拓扑图。图6为J和J1对h的变化曲线。具体实施方式以下结合具体实施例对本发明作进一步说明。本实施例中所采用的可实现无缝故障容错的多模块级联数字功放电路拓扑如图4所示，容错拓扑由n+1个子模块串联构成，每个子模块的电路拓扑均为级联全桥NPC逆变器；子模块1至子模块n为普通子模块，子模块n+1为冗余子模块；普通子模块交流输出侧均配置了双向晶闸管，冗余子模块的交流输出侧未配置双向晶闸管；以加快该子模块投入和切除的速度。在图4中IGBT的驱动信号用Sij表示，其中i∈{1,2,…,n,n+1}表示子模块编号，j∈{1,2,…,8}表示同一子模块内IGBT的编号。在正常运行时，左桥臂的Si1和Si3互补，Si2也Si4互补。同理，右桥臂的Si5、Si6、Si7、Si8也满足此约束条件。用UCi1和UCi2分别代表电容Ci1和Ci2的电压，用SWi＝表示第i个子模块的开关状态。此外，可用Mi表示第i个子模块的输出电平数。根据以上定义，Ci1和Ci2的电容电压之差ΔUCi可由式计算得到：ΔUCi＝UCi1-UCi2＝2UCi1-Vdc 表1给出了子模块i的输出电平Mi，输出电流io，电容电压偏差ΔUCi的变化以及9个有效开关状态之间的关系。表1 Mi，io，ΔUCi与SWi的关系假设所有子模块内两个电容电压均处于较好的平衡状态，则可以假设UCi1＝UCi2＝Vdc/2，i＝1，2，…，n，因而由图4可得级联全桥NPC逆变器的动态模型如式所示。进一步地，可将式化为式所示的微分方程：由于UCi1＝UCi2＝Vdc/2的假设，第i个子模块交流侧的输出电压Vabi可由式表示：因而级联全桥NPC逆变器交流侧总输出电压Vab应等于所有子模块交流侧输出电压之和，并由式计算得到：级联全桥NPC逆变器的总输出电平数M也可由式表示。由以上分析可知，M∈{-2n-2,-2n-1,…,2n+1,2n+2}。将式和式带入式可得式所示的微分方程，该式可表示为级联全桥NPC逆变系统的连续数学模型。为了便于进行数字控制，采用向前欧拉法对式按照采样周期TS进行离散化，可得到级联全桥NPC逆变系统的离散模型式，其中k和k+1分别表示kTS和TS时刻。级联全桥NPC逆变系统的运行可被分为正常运行、故障诊断、故障重构三个阶段。考虑无缝故障容错后，不同运行阶段的控制目标及控制方法略不相同，以下分别介绍。一、若判断级联全桥NPC逆变器当前的运行阶段为正常运行：正常运行阶段，冗余子模块处于旁路状态，其开关状态SWn+1被设置为S5＝，则该子模块输出电平Mn+1＝0，总输出电平数M应为所有普通子模块输出电平数之和。子模块1至子模块n等普通子模块投入运行，实现输出电流闭环控制以及子模块内电容电压平衡等控制目标，它们的外置双向闸管均设置为断开状态，亦即Ti＝0，i＝1，2，…，n。用ioref表示输出电流的给定值，则该系统的损耗函数由式表示，J＝|ioref-ioh|，h∈H＝{-2n,-2n+1,…,0,…,2n-1,2n}其中，ioh表示在第k个控制周期选择输出电平h时在TS时刻输出电流io的预测值。根据式可知，状态变量ioh可按照式进行预测。此外，定义函数J1如式所示。易知，J＝|J1|。如图5所示，当输出电平h被假设为连续变量时，函数J1与输出电平h的关系为线性关系。因此，J1与横坐标轴h的交点hsol亦即方程J1＝0的解，并可由式计算得到。由于J＝|J1|，因此使损耗函数J最小的最优输出电平M必定是距离hsol最近的整数，则M必定等于hsol四舍五入后的整数，如式所示，M＝argminh∈H|J1|＝round其中round表示四舍五入函数。按照式求解最优输出电平数M可有效避免传统有限集模型预测控制必须的重复预测状态变量与重复评价损耗函数，从而可减小控制器的计算量。但为了避免式的计算结果超出集合H的范围，可用式对式的计算结果进行修正。由式计算得到当前控制周期总输出电平数M后，需将M分配至每个普通子模块。由于每个子模块仅可输出-2、-1、0、1和2五个电平，则电平分配必须满足式所示的约束条件。推理可知，满足式所述约束条件的输出电平组合有很多组，这导致输出电平的分配较为复杂，同时也会增加控制器的计算负担。因此，增加如下三个原则对电平分配进行限制：1)当总输出电平数M＞0时，子模块输出电平数Mi仅从电平2、1和0中选择；2)当总输出电平数M＜0时，子模块输出电平数Mi仅从电平-2、-1和0中选择；3)当总输出电平数M＝0时，子模块输出电平数Mi置0。进一步地，由表1的分析可知，仅+1电平和-1电平可影响子模块的电容电压，因此电容电压差值较大的子模块应当被首先分配+1或-1电平。根据以上分析，本发明增加的电平分配步骤如下：第一步，求所有子模块电容电压差值的绝对值；第二步，对所有子模块电容电压差值的绝对值进行降序排序，使电容电压差值较大的排列在前，而差值较小的排列在后；第三步，据第二步的排序结果，首先进行第一趟由前至后地电平分配，每个子模块被分配得到+1电平＞0时)或-1电平＜0时)，直至总电平数M被分配完。若第一趟未能将M分配完，则进行第二趟由后至前地反向分配，直至总电平数M被分配完。图1和图2分别给出了子模块数为3，而M＝2和M＝-5时的电平分配过程。由图1和图2可知，电容电压差值较大的子模块更大概率地被分配得到+1电平或-1电平，而电容电压差值较小的子模块更大概率地被分配得到2、0或-2电平，从而可为电容电压平衡创造了条件。电平分配结束后，需根据每个子模块分配得到的电平数、子模块电容电压差值以及电流方向确定该子模块的开关状态。由表1可知，开关状态S4、S5以及S6均与0电平对应，开关状态S2和S3均与+1电平对应，开关状态S7和S8均与-1电平对应。因此，得到所有子模块的输出电平数后，每个子模块开关状态的确定仍需根据此分配电平进一步深入讨论。由于电平分配时增加的三个限制规则，子模块的分配电平Mi在总输出电平数M＞0时仅在+2、+1和0之间相互切换，表2统计了此三个电平相互切换时的开关动作次数。根据表1以及表2，可作如下分析：表2 +2、+1和0电平相互切换的开关动作1)当子模块i的分配电平Mi为+2时，该子模块的开关状态应当选择S1，因为仅开关状态S1可使该子模块输出+2电平。2)当子模块i的分配电平Mi为+1时，由于该输出电平可影响子模块内两电容电压，因而开关状态的选择应当以实现电容电压平衡为目的。因此，由表1可知，当子模块i内上侧电容Ci1的电压UCi1大于下侧电容Ci2的电压UCi2且输出电流io为正方向时，如果该子模块的开关状态选择为S2，则可使UCi1减小，UCi2增大，实现电容电压平衡。同理分析可知，当子模块i内上侧电容Ci1的电压UCi1小于下侧电容Ci2的电压UCi2且输出电流io为负方向时，则该子模块的开关状态也应选择为S2以实现电容电压平衡。反之，若子模块i内电容电压UCi1大于UCi2且输出电流io为负方向，或UCi1小于UCi2且输出电流io为正方向时，该子模块的开关状态应当选择为S3以实现电容电压平衡。3)由表2可知，当子模块i的分配电平Mi为0时，开关状态S4、S5、S6均可使该子模块输出0电平，但是与其他开关状态切换时所需的开关动作次数并不相同，因而此时更应选择开关动作次数较少的开关状态。根据以上分析，为了进行电容电压平衡，S2和S3均有可能被使用。当该子模块输出电平由+1向0电平切换时，若上个控制周期该子模块的开关状态为S2＝，而当前控制周期选择开关状态S6＝，则需要六个IGBT同时开通或关断。同样，若上个控制周期开关状态为S3＝，而当前控制周期选择开关状态S4＝，则也需要六个IGBT同时开通或关断。但是，若当前控制周期选择开关状态S5＝，无论上个控制周期开关状态是S2还是S3，都仅需两次开关动作即可。因此，当M＞0且该子模块被分配0电平时，该子模块的开关状态应当选择为S5。当总输出电平数M＜0时，子模块的分配电平Mi仅在-2、-1和0之间相互切换，表3统计了此三个电平相互切换时的开关动作次数。根据表1以及表3，可作如下分析：表3 -2、-1和0电平相互切换的开关动作1)当子模块i的分配电平Mi为-2时，该子模块的开关状态应当选择S9，因为仅开关状态S9可使该子模块输出-2电平。2)当子模块i的分配电平Mi为-1时，由于该输出电平也可影响子模块内两电容电压，因而开关状态的选择也应当以实现电容电压平衡为目的。因此，由表1可知，当子模块i内上侧电容Ci1的电压UCi1大于下侧电容Ci2的电压UCi2且输出电流io为正方向时，如果该子模块的开关状态选择为S8，则可使UCi1减小，UCi2增大，实现电容电压平衡。同理分析，当子模块i内上侧电容Ci1的电压UCi1小于下侧电容Ci2的电压UCi2且输出电流io为负方向时，该子模块的开关状态也应选择为S8以实现电容电压平衡。反之，若子模块i内电容电压UCi1大于UCi2且输出电流io为负方向，或UCi1小于UCi2且输出电流io为正方向，该子模块的开关状态应选择为S7以实现电容电压平衡。3)根据以上分析，为了进行电容电压平衡，S7和S8均有可能被使用。当该子模块的输出电平由-1向0电平切换时，若上个控制周期该子模块的开关状态为S7＝，而当前控制周期选择开关状态S6＝，则需要六个IGBT同时开通或关断。同样，若上个控制周期开关状态为S8＝，而当前控制周期选择开关状态S4＝，则也需要六个IGBT同时开通或关断。但是，若当前控制周期选择开关状态S5＝，无论上个控制周期开关状态是S7还是S8，都仅需两次开关动作即可。因此，当M＜0且该子模块被分配0电平时，该子模块的开关状态也应选择为S5。综上所述，每个子模块所用的开关状态选择流程如图3所示。二、若判断级联全桥NPC逆变器当前的运行阶段为故障诊断：故障诊断阶段，子模块1至子模块n等普通子模块仍正常运行阶段的模型预测控制运行，实现输出电流跟踪和电容电压平衡。虽因开路故障可能导致输出电流跟踪误差和电容电压发散，但精确的开路故障诊断必须使故障状态持续一段时间，以提供足够的故障特征。冗余子模块在故障诊断阶段需对开路故障引起的输出电流跟踪误差进行补偿，其控制可被分为两步：第一步计算补偿跟踪误差所需的最优输出电平，第二步确定冗余子模块的开关状态。在第一步中，根据叠加定理以及式可得输出电流的跟踪误差满足式，其中，Δio表示当前控制周期输出电流跟踪误差，Δio表示下个控制周期输出电流跟踪误差的预测值。Mn+1表示当前控制周期冗余子模块输出的电平数，其取值范围应为{-2，-1，0，1，2}。TR表示冗余子模块模型预测控制的控制周期。为获得较好的补偿效果，必须使控制周期TR小于等于普通子模块模型预测控制的控制周期TS，从而可获得更快的动态性能及更高的控制精度。因此，可设置普通子模块的控制周期TS与冗余子模块的控制周期TR满足式，其中，q为整数且q＝1,2，…,10。q的取值不能过大，否则所需的计算量将对控制器的计算性能形成巨大挑战，也可能使冗余子模块的器件开关频率过高而损坏。为补偿输出电流跟踪误差，应使式中Δio＝0，从而可求得冗余子模块最优输出电平Mn+1，如式所示。为保证式的计算结果在其取值范围内，需通过式对式的计算结果进一步修正。在第二步中，基于式得到的冗余子模块最优输出电平Mn+1，按照图3所示的开关状态选择方法确定冗余子模块的开关状态。三、若判断级联全桥NPC逆变器当前的运行阶段为故障重构：故障诊断算法对级联全桥NPC逆变器内的开路故障诊断完成后，会给出故障器件所在的子模块编号以及故障器件编号，则进入故障重构阶段后需首先将故障器件所在的子模块旁路，即通过设置Tx＝1使故障子模块交流输出侧的双向晶闸管导通。而后，冗余子模块将代替已故障的子模块x继续运行。首先将冗余子模块的电容电压偏差值ΔUCn+1赋值给故障子模块的电容电压偏差值ΔUCx，然后基于ΔUC1、ΔUC2、…、ΔUCx-1、ΔUCn+1、ΔUCx+1、…、ΔUCn进行电容电压偏差排序和输出电平分配。最后，故障子模块x被确定的开关状态SWx应赋值给冗余子模块的开关状态SWn+1，而SWx应全部置零，即SWx＝O1×8＝。本发明要求保护的范围不限于以上具体实施方式，而且对于本领域技术人员而言，本发明可以有多种变形和更改，凡在本发明的构思与原则之内所作的任何修改、改进和等同替换都应包含在本发明的保护范围之内。
