标题title
一种基于蓝牙AOA的室内定位方法及系统
摘要abst
本发明公开了一种基于蓝牙AOA的室内定位方法及系统，该方法包括获取AOA基站节点固定位置信息以生成高精度定位区域数据，RSSI基站节点在初始定位后，通过移动分布模型进行位置调整以实现普通精度定位需求区域的定位布局；RSSI基站节点将位置计算请求签名后在区块链网络内进行广播；获取蓝牙终端的位置信息，进行误差补偿，获取修正后的蓝牙终端的位置信息。本发明通过AOA基站与RSSI基站结合定位，以较低的成本实现了大范围室内定位的应用，RSSI基站节点可自适应进行位置调整满足不同的应用环境，并且通过请求的RSSI基站节点与区块链中其他节点分担定位运算，实现负载均衡，而通过AOA基站可对RSSI基站节点的定位进行修正，从而可以得到更为精确的定位。
权利要求书clms
1.一种基于蓝牙AOA的室内定位方法，应用于区块链网络，所述区块链网络包括输入节点、若干固定式AOA基站节点和若干移动式RSSI基站节点，其特征在于，所述方法包括：S1、输入节点获取AOA基站节点固定位置信息以生成高精度定位区域数据，并将高精度定位区域数据和普通精度定位需求区域数据签名后在区块链网络内进行广播；S2、RSSI基站节点在普通精度定位需求区域初始定位后，通过移动分布模型进行位置更新；S3、RSSI基站节点接收蓝牙终端发送的定位请求，计算蓝牙终端和RSSI基站节点之间的距离，将位置计算请求签名后在区块链网络内进行广播；S4、接收到网络广播的RSSI基站节点，计算出蓝牙终端的位置并进行广播；S5、RSSI基站节点获取蓝牙终端的位置信息，进行误差补偿，获取修正后的蓝牙终端的位置信息；所述S2中通过移动分布模型进行位置调整以实现普通精度定位需求区域的定位布局，具体包括：S24、第一RSSI基站节点和第二RSSI基站节点在区块链网络内进行广播其在普通精度定位需求区域的初始位置；S25、每个节点获取领域集合，并根据构建的移动分布模型选取每个邻域中的目标节点进行移动，并在区块链网络内进行广播新位置；S26、重复此操作，直至所有邻域的节点邻域密度值收敛至满足预设要求，完成位置更新以实现普通精度定位需求区域的定位布局；所述移动分布模型构建方法如下：定义排斥函数，其中,为RSSI基站节点i与相邻RSSI基站节点j在时间k的排斥值，为是RSSI基站节点i在时间k的位置，，为是RSSI基站节点j在时间k的位置，，N为第一RSSI基站节点和第二RSSI基站节点的总数量，CR为RSSI基站节点的通信距离，A为普通精度定位需求区域的面积，为RSSI基站节点i 在时间k的邻域密度，为预期密度，，，m为邻域中节点总数量，为节点间距，；其中，，其中，为施加在RSSI基站节点i与其相邻节点之间的力的排斥总值，定义RSSI基站节点相邻节点的集合，其中，RSSI基站节点的排斥总值大于集合其他节点；邻域排斥值，为RSSI基站节点i被选为目标节点以移动到时间k的次数，；定义邻域密度值；定义邻域合格值，其中，为调节系数，为第一RSSI基站节点和第二RSSI基站节点的总数量，每个邻域中合格值最高的节点作为目标节点；所述RSSI基站节点获取蓝牙终端的位置信息，进行误差补偿，获取修正后的蓝牙终端的位置信息，具体包括：S51、第一RSSI基站节点接收位于重叠区域内的蓝牙终端的固定频率的信号，计算蓝牙终端的第一位置信息并获取蓝牙终端的速度、加速度、方向信息，在区块链广播；S52、AOA基站节点接收所述蓝牙终端的固定频率的信号，计算蓝牙终端的第二位置信息，在区块链广播；S53、区块链网络中第一RSSI基站节点和第二RSSI基站节点共享所述信息，并根据第一位置信息和第二位置信息生成位置误差，将第一位置信息、速度、加速度、方向信息作为输入，将位置误差作为输出，以预先搭建好的DNN网络模型进行训练；S54、当第二RSSI基站节点接收位蓝牙终端的固定频率的信号时，获取蓝牙终端的位置信息，通过训练好的DNN网络模型预测位置误差，进行误差补偿，获取修正后的蓝牙终端的位置信息。2.根据权利要求1所述的基于蓝牙AOA的室内定位方法，其特征在于，所述S2中RSSI基站节点初始定位，具体包括：S21、将高精度定位区域数据和普通精度定位需求区域设定具有重叠区域；S22、位于重叠区域内的第一RSSI基站节点通过AOA基站节点进行初始定位，所述AOA基站节点通过蓝牙AOA技术计算出第一RSSI基站节点的初始位置；S23、位于普通精度定位需求区域且非重叠区域的第二RSSI基站节点通过第一RSSI基站节点进行初始定位，所述第一RSSI基站节点通过信号强度RSSI技术计算出第二RSSI基站节点的初始位置。3.根据权利要求2所述的基于蓝牙AOA的室内定位方法，其特征在于，所述方法还包括：S61、获取完成位置更新的第一RSSI基站节点、第二RSSI基站节点的位置数据；S62、位于重叠区域内的第一RSSI基站节点组成共识节点，位于高精度定位区域的AOA基站节点划分为第一分区，位于普通精度定位需求区域且非重叠区域的第二RSSI基站节点划分为第二分区；S63、当第二分区的第二RSSI基站节点接收蓝牙终端发送的定位请求，计算蓝牙终端与第二RRSSI基站节点之间的距离，并将携带距离数据的位置计算请求在区块链中广播；S64、基于预设的第一智能合约：同分区的各第二RSSI基站节点接收位置计算请求，通过信号强度RSSI技术计算蓝牙终端的位置，若接收到同分区其他节点发送的计算结果，则停止计算，否则将计算出的蓝牙终端的位置信息携带时间戳发送到区块链中；S65、共识节点将上个区块的区块哈希信息、计算任务信息和时间戳一起打包成新区块，并将该新区块加入区块链上。4.根据权利要求3所述的基于蓝牙AOA的室内定位方法，其特征在于，所述方法还包括：S66、当第一分区的AOA基站节点接收蓝牙终端发送的定位请求，计算到达角，并将携带到达角数据的位置计算请求在区块链中广播；S67、基于预设的第二智能合约：同分区的各AOA基站节点接收位置计算请求，通过蓝牙AOA技术计算蓝牙终端的位置，若接收到同分区其他节点发送的计算结果，则停止计算，否则将计算出的蓝牙终端的位置信息携带时间戳发送到区块链中；S68、共识节点将上个区块的区块哈希信息、计算任务信息和时间戳一起打包成新区块，并将该新区块加入区块链上。5.根据权利要求3所述的基于蓝牙AOA的室内定位方法，其特征在于，所述方法还包括：S71、当第二分区的第二RSSI基站节点接收蓝牙终端发送的定位请求，统计接收请求次数M；S72、若接收请求次数M＞次数阈值M0，则统计所述第二RSSI基站节点邻域中所有节点的广播位置计算请求次数M1；S73、判断是否存在有节点广播位置计算请求次数，为邻域中所有节点的广播位置计算请求的平均次数；S74、若存在，则认定该节点为可疑节点，所述邻域中所有节点在指定时间T内向可疑节点发送诊断数据包；S75、计算可疑指数F，若可疑指数S＞指数阈值S0，则认定该节点为失效节点；S76、普通精度定位需求区域的RSSI基站节点通过移动分布模型进行位置更新，直至所有邻域的节点邻域密度值收敛至满足预设要求。6.根据权利要求5所述的基于蓝牙AOA的室内定位方法，其特征在于，所述可疑指数F的计算公式如下：，其中，n表示给指定时间T内的周期数，i表示周期序号，α和表示调节系数，表示可疑节点第i期内未回复诊断数据包的数量，表示可疑节点指定时间T内未回复诊断数据包的平均数量，表示可疑节点第i周期内回复诊断数据包的累计时长，表示可疑节点指定时间T内回复诊断数据包的平均时长。7.一种基于蓝牙AOA的室内定位系统，其特征在于，所述系统包括由输入节点、若干固定式AOA基站节点和若干移动式RSSI基站节点构成的区块链网络，所述区块链网络被配置为执行权利要求1-6中任意一项所述的方法；其中，所述输入节点用于获取AOA基站节点固定位置信息以生成高精度定位区域数据，并将高精度定位区域数据和普通精度定位需求区域数据签名后在区块链网络内进行广播；所述RSSI基站节点包括：位置更新模块，用于在普通精度定位需求区域初始定位后，通过移动分布模型进行位置更新；请求模块，用于接收蓝牙终端发送的定位请求，计算蓝牙终端和RSSI基站节点之间的距离，将位置计算请求签名后在区块链网络内进行广播；计算模块，用于接收网络广播的位置计算请求，计算出蓝牙终端的位置并进行广播；修正模块，用于获取蓝牙终端的位置信息，进行误差补偿，获取修正后的蓝牙终端的位置信息。
说明书desc
技术领域本发明涉及室内定位技术领域，尤其涉及一种基于蓝牙AOA的室内定位方法及系统。背景技术由于室内GPS信号弱，无法满足室内定位服务的需求，而随着 5G 网络促进业务丰富发展，室内定位的需求越来越强烈。目前，最新的蓝牙5 .1标准引入了到达角/发送角技术。其中，蓝牙定位基站使用天线阵列接收蓝牙信号，计算出蓝牙信号到达角AoA，蓝牙定位基站将数据回传到服务器，服务器可以利用已知的蓝牙定位基站高度h、到达角AoA计算出蓝牙终端的位置。其中，AOA算法具有精度高，抗干扰性强的特点，但目前该算法的应用还存在一些条件限制：一是室内大场地大范围应用成本昂贵；二是安装布设需要复杂的测量和勘测，各基站相对位置要求比较严格，发生位移或改变时对整个定位系统影响较大；三是定位服务器运算压力较大，在大数量级场景下，定位运算负载极大；四是定位服务器的定位信息和定位记录的安全性得不到保障，易被攻击和篡改。发明内容有鉴于此，本发明实施例提供了一种基于蓝牙AOA的室内定位方法及系统。第一方面，本发明实施例提供了一种基于蓝牙AOA的室内定位方法，应用于区块链网络，所述区块链网络包括输入节点、若干固定式AOA基站节点和若干移动式RSSI基站节点，所述方法包括：S1、输入节点获取AOA基站节点固定位置信息以生成高精度定位区域数据，并将高精度定位区域数据和普通精度定位需求区域数据签名后在区块链网络内进行广播；S2、RSSI基站节点在普通精度定位需求区域初始定位后，通过移动分布模型进行位置更新；S3、RSSI基站节点接收蓝牙终端发送的定位请求，计算蓝牙终端和RSSI基站节点之间的距离，将位置计算请求签名后在区块链网络内进行广播；S4、接收到网络广播的RSSI基站节点，计算出蓝牙终端的位置并进行广播；S5、RSSI基站节点获取蓝牙终端的位置信息，进行误差补偿，获取修正后的蓝牙终端的位置信息。如上所述的方面和任一可能的实现方式，进一步提供一种实现方式，所述S2中RSSI基站节点初始定位，具体包括：S21、将高精度定位区域数据和普通精度定位需求区域设定具有重叠区域；S22、位于重叠区域内的第一RSSI基站节点通过AOA基站节点进行初始定位，所述AOA基站节点通过蓝牙AOA技术计算出第一RSSI基站节点的初始位置；S23、位于普通精度定位需求区域且非重叠区域的第二RSSI基站节点通过第一RSSI基站节点进行初始定位，所述第一RSSI基站节点通过信号强度RSSI技术计算出第二RSSI基站节点的初始位置。如上所述的方面和任一可能的实现方式，进一步提供一种实现方式，所述S2中通过移动分布模型进行位置调整以实现普通精度定位需求区域的定位布局，具体包括：S24、第一RSSI基站节点和第二RSSI基站节点在区块链网络内进行广播其在普通精度定位需求区域的初始位置；S25、每个节点获取领域集合，并根据构建的移动分布模型选取每个邻域中的目标节点进行移动，并在区块链网络内进行广播新位置；S26、重复此操作，直至所有邻域的节点邻域密度值收敛至满足预设要求，完成位置更新以实现普通精度定位需求区域的定位布局。如上所述的方面和任一可能的实现方式，进一步提供一种实现方式，所述移动分布模型构建方法如下：定义排斥函数，其中,为RSSI基站节点i与相邻RSSI基站节点j在时间k的排斥值，为是RSSI基站节点i在时间k的位置，，为是RSSI基站节点j在时间k的位置，，N为第一RSSI基站节点和第二RSSI基站节点的总数量，CR为RSSI基站节点的通信距离，A为普通精度定位需求区域的面积，为RSSI基站节点i 在时间k的邻域密度，为预期密度，，，m为邻域中节点总数量，为节点间距，；其中，，其中，为施加在RSSI基站节点i与其相邻节点之间的力的排斥总值，定义RSSI基站节点相邻节点的集合，其中，RSSI基站节点的排斥总值大于集合其他节点；邻域排斥值，为RSSI基站节点i被选为目标节点以移动到时间k的次数，；定义邻域密度值；定义邻域合格值，其中，为调节系数，为第一RSSI基站节点和第二RSSI基站节点的总数量，每个邻域中合格值最高的节点作为目标节点。如上所述的方面和任一可能的实现方式，进一步提供一种实现方式，所述方法还包括：S61、获取完成位置更新的第一RSSI基站节点、第二RSSI基站节点的位置数据；S62、位于重叠区域内的第一RSSI基站节点组成共识节点，位于高精度定位区域的AOA基站节点划分为第一分区，位于普通精度定位需求区域且非重叠区域的第二RSSI基站节点划分为第二分区；S63、当第二分区的第二RSSI基站节点接收蓝牙终端发送的定位请求，计算蓝牙终端与第二RRSSI基站节点之间的距离，并将携带距离数据的位置计算请求在区块链中广播；S64、基于预设的第一智能合约：同分区的各第二RSSI基站节点接收位置计算请求，通过信号强度RSSI技术计算蓝牙终端的位置，若接收到同分区其他节点发送的计算结果，则停止计算，否则将计算出的蓝牙终端的位置信息携带时间戳发送到区块链中；S65、共识节点将上个区块的区块哈希信息、计算任务信息和时间戳一起打包成新区块，并将该新区块加入区块链上。如上所述的方面和任一可能的实现方式，进一步提供一种实现方式，所述方法还包括：S66、当第一分区的AOA基站节点接收蓝牙终端发送的定位请求，计算到达角，并将携带到达角数据的位置计算请求在区块链中广播；S67、基于预设的第二智能合约：同分区的各AOA基站节点接收位置计算请求，通过蓝牙AOA技术计算蓝牙终端的位置，若接收到同分区其他节点发送的计算结果，则停止计算，否则将计算出的蓝牙终端的位置信息携带时间戳发送到区块链中；S68、共识节点将上个区块的区块哈希信息、计算任务信息和时间戳一起打包成新区块，并将该新区块加入区块链上。如上所述的方面和任一可能的实现方式，进一步提供一种实现方式，所述方法还包括：S71、当第二分区的第二RSSI基站节点接收蓝牙终端发送的定位请求，统计接收请求次数M；S72、若接收请求次数M＞次数阈值M0，则统计所述第二RSSI基站节点邻域中所有节点的广播位置计算请求次数M1；S73、判断是否存在有节点广播位置计算请求次数，为邻域中所有节点的广播位置计算请求的平均次数；S74、若存在，则认定该节点为可疑节点，所述邻域中所有节点在指定时间T内向可疑节点发送诊断数据包；S75、计算可疑指数F，若可疑指数S＞指数阈值S0，则认定该节点为失效节点；S76、普通精度定位需求区域的RSSI基站节点通过移动分布模型进行位置更新，直至所有邻域的节点邻域密度值收敛至满足预设要求。如上所述的方面和任一可能的实现方式，进一步提供一种实现方式，所述可疑指数F的计算公式如下：，其中，n表示给指定时间T内的周期数，i表示周期序号，α和表示调节系数，表示可疑节点第i期内未回复诊断数据包的数量，表示可疑节点指定时间T内未回复诊断数据包的平均数量，表示可疑节点第i周期内回复诊断数据包的累计时长，表示可疑节点指定时间T内回复诊断数据包的平均时长。如上所述的方面和任一可能的实现方式，进一步提供一种实现方式，所述RSSI基站节点获取蓝牙终端的位置信息，进行误差补偿，获取修正后的蓝牙终端的位置信息，具体包括：S51、第一RSSI基站节点接收位于重叠区域内的蓝牙终端的固定频率的信号，计算蓝牙终端的第一位置信息并获取蓝牙终端的速度、加速度、方向信息，在区块链广播；S52、AOA基站节点接收所述蓝牙终端的固定频率的信号，计算蓝牙终端的第二位置信息，在区块链广播；S53、区块链网络中第一RSSI基站节点和第二RSSI基站节点共享所述信息，并根据第一位置信息和第二位置信息生成位置误差，将第一位置信息、速度、加速度、方向信息作为输入，将位置误差作为输出，以预先搭建好的DNN网络模型进行训练；S54、当第二RSSI基站节点接收位蓝牙终端的固定频率的信号时，获取蓝牙终端的位置信息，通过训练好的DNN网络模型预测位置误差，进行误差补偿，获取修正后的蓝牙终端的位置信息。第二方面，本发明实施例提供了一种基于蓝牙AOA的室内定位系统，所述系统包括由输入节点、若干固定式AOA基站节点和若干移动式RSSI基站节点构成的区块链网络，所述区块链网络被配置为执行上述的方法；其中，所述输入节点用于获取AOA基站节点固定位置信息以生成高精度定位区域数据，并将高精度定位区域数据和普通精度定位需求区域数据签名后在区块链网络内进行广播；所述RSSI基站节点包括：位置更新模块，用于在普通精度定位需求区域初始定位后，通过移动分布模型进行位置更新；请求模块，用于接收蓝牙终端发送的定位请求，计算蓝牙终端和RSSI基站节点之间的距离，将位置计算请求签名后在区块链网络内进行广播；计算模块，用于接收网络广播的位置计算请求，计算出蓝牙终端的位置并进行广播；修正模块，用于获取蓝牙终端的位置信息，进行误差补偿，获取修正后的蓝牙终端的位置信息。上述技术方案中的一个技术方案具有如下有益效果：本发明实施例的方法中提出了一种基于蓝牙AOA的室内定位方法及系统，获取AOA基站节点固定位置信息以生成高精度定位区域数据，RSSI基站节点在初始定位后，通过移动分布模型进行位置调整以实现普通精度定位需求区域的定位布局；RSSI基站节点将位置计算请求签名后在区块链网络内进行广播；获取蓝牙终端的位置信息，进行误差补偿，获取修正后的蓝牙终端的位置信息。该方法通过AOA基站与RSSI基站结合定位，以较低的成本实现了大范围室内定位的应用，RSSI基站节点不同于传统的固定式，可自适应进行位置调整满足不同的应用环境，并且通过请求的RSSI基站节点与区块链中其他节点分担定位运算，实现负载均衡，而通过AOA基站可对RSSI基站节点的定位进行修正，从而可以得到更为精确的定位。【附图说明】为了更清楚地说明本发明实施例的技术方案，下面将对实施例中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其它的附图。图1是本发明实施例所提供的基于蓝牙AOA的室内定位方法的流程示意图；图2是本发明实施例所提供的S21- S23的流程示意图；图3为本发明实施例所提供的S24-S26的流程示意图；图4为本发明实施例所提供的S61-S65的流程示意图；图5为本发明实施例所提供的S66-S68的流程示意图；图6为本发明实施例所提供的S71-S76的流程示意图；图7为本发明实施例所提供的S51-S54的流程示意图；图8为本发明实施例所提供的RSSI基站节点的功能框图。【具体实施方式】为使本发明的目的、技术方案和优点更加清楚，下面将结合具体实施例及相应的附图对本发明的技术方案进行清楚、完整地描述。显然，所描述的实施例仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。请参考图1，其为本发明实施例所提供的基于蓝牙AOA的室内定位方法的流程示意图。本发明的基于蓝牙AOA的室内定位方法应用于区块链网络，所述区块链网络包括输入节点、若干固定式AOA基站节点和若干移动式RSSI基站节点。需要说明的是，AOA基站节点可设有阵列天线和处理器；移动式RSSI基站节点可以是搭载在可自行移动的装置上，例如可智能控制的移动式底座，例如工厂、商场或者地下车库里的咨询、引导、空气净化、垃圾回收等智能机器或者机器人上。如1图所示，该方法包括以下步骤：S1、输入节点获取AOA基站节点固定位置信息以生成高精度定位区域数据，并将高精度定位区域数据和普通精度定位需求区域数据签名后在区块链网络内进行广播；S2、RSSI基站节点在普通精度定位需求区域初始定位后，通过移动分布模型进行位置更新；S3、RSSI基站节点接收蓝牙终端发送的定位请求，计算蓝牙终端和RSSI基站节点之间的距离，将位置计算请求签名后在区块链网络内进行广播；S4、接收到网络广播的RSSI基站节点，计算出蓝牙终端的位置并进行广播；S5、RSSI基站节点获取蓝牙终端的位置信息，进行误差补偿，获取修正后的蓝牙终端的位置信息。本发明通过AOA基站与RSSI基站结合定位，以较低的成本实现了大范围室内定位的应用，RSSI基站节点不同于传统的固定式，可自适应进行位置调整满足不同的应用环境，并且通过请求的RSSI基站节点与区块链中其他节点分担定位运算，实现负载均衡，而通过AOA基站可对RSSI基站节点的定位进行修正，从而可以得到更为精确的定位。进一步地，请参考图2，图2为本发明实施例所提供的S21- S23的流程示意图。如图2所示，所述S2中RSSI基站节点初始定位，具体包括：S21、将高精度定位区域数据和普通精度定位需求区域设定具有重叠区域；S22、位于重叠区域内的第一RSSI基站节点通过AOA基站节点进行初始定位，所述AOA基站节点通过蓝牙AOA技术计算出第一RSSI基站节点的初始位置；S23、位于普通精度定位需求区域且非重叠区域的第二RSSI基站节点通过第一RSSI基站节点进行初始定位，所述第一RSSI基站节点通过信号强度RSSI技术计算出第二RSSI基站节点的初始位置。本发明的第一RSSI基站节点利用AOA基站节点进行初始定位，利用第二RSSI基站节点进行初始定位，无需繁杂的人工定位，简单高效。进一步地，请参考图3，图3为本发明实施例所提供的S24-S26的流程示意图。如图3所示，所述S2中通过移动分布模型进行位置调整以实现普通精度定位需求区域的定位布局，具体包括：S24、第一RSSI基站节点和第二RSSI基站节点在区块链网络内进行广播其在普通精度定位需求区域的初始位置；S25、每个节点获取领域集合，并根据构建的移动分布模型选取每个邻域中的目标节点进行移动，并在区块链网络内进行广播新位置；S26、重复此操作，直至所有邻域的节点邻域密度值收敛至满足预设要求，完成位置更新以实现普通精度定位需求区域的定位布局。具体的，所述移动分布模型构建方法如下：定义排斥函数，其中,为RSSI基站节点i与相邻RSSI基站节点j在时间k的排斥值，为是RSSI基站节点i在时间k的位置，，为是RSSI基站节点j在时间k的位置，，N为第一RSSI基站节点和第二RSSI基站节点的总数量，CR为RSSI基站节点的通信距离，A为普通精度定位需求区域的面积，为RSSI基站节点i 在时间k的邻域密度，为预期密度，，，m为邻域中节点总数量，为节点间距，；其中，，其中，为施加在RSSI基站节点i与其相邻节点之间的力的排斥总值，定义RSSI基站节点相邻节点的集合，其中，RSSI基站节点的排斥总值大于集合其他节点；邻域排斥值，为RSSI基站节点i被选为目标节点以移动到时间k的次数，；定义邻域密度值；定义邻域合格值，其中，为调节系数，为第一RSSI基站节点和第二RSSI基站节点的总数量，每个邻域中合格值最高的节点作为目标节点。本发明根据构建的移动分布模型选取每个邻域中的目标节点进行移动，克服集体移动的算法的复杂性和耗时，提高了RSSI基站节点位置更新的效率，使得分布更均匀分布，满足RSSI基站节点在普通精度定位需求区域的定位布局的要求；而且，不局限特定定位区域，可自适应应用于各范围的定位场景。进一步地，请参考图4，图4为本发明实施例所提供的S61-S65的流程示意图。如图4所示，所述方法还包括：S61、获取完成位置更新的第一RSSI基站节点、第二RSSI基站节点的位置数据；S62、位于重叠区域内的第一RSSI基站节点组成共识节点，位于高精度定位区域的AOA基站节点划分为第一分区，位于普通精度定位需求区域且非重叠区域的第二RSSI基站节点划分为第二分区；S63、当第二分区的第二RSSI基站节点接收蓝牙终端发送的定位请求，计算蓝牙终端与第二RRSSI基站节点之间的距离，并将携带距离数据的位置计算请求在区块链中广播；S64、基于预设的第一智能合约：同分区的各第二RSSI基站节点接收位置计算请求，通过信号强度RSSI技术计算蓝牙终端的位置，若接收到同分区其他节点发送的计算结果，则停止计算，否则将计算出的蓝牙终端的位置信息携带时间戳发送到区块链中；S65、共识节点将上个区块的区块哈希信息、计算任务信息和时间戳一起打包成新区块，并将该新区块加入区块链上。进一步地，请参考图5，图5为本发明实施例所提供的S66-S68的流程示意图。如图5所示，所述方法还包括：S66、当第一分区的AOA基站节点接收蓝牙终端发送的定位请求，计算到达角，并将携带到达角数据的位置计算请求在区块链中广播；S67、基于预设的第二智能合约：同分区的各AOA基站节点接收位置计算请求，通过蓝牙AOA技术计算蓝牙终端的位置，若接收到同分区其他节点发送的计算结果，则停止计算，否则将计算出的蓝牙终端的位置信息携带时间戳发送到区块链中；S68、共识节点将上个区块的区块哈希信息、计算任务信息和时间戳一起打包成新区块，并将该新区块加入区块链上。本发明通过第二RSSI基站节点计算蓝牙终端与其之间的距离，AOA基站节点计算到达角，这样通过基站本身承办较小运算任务，通过区块链利用其他闲置节点承担蓝牙终端具体位置的计算任务，这样一方面可以提高运算速度，另一方面，可实现运算负载的均衡。而第二RSSI基站节点基于第一智能合约、AOA基站节点基于第二智能合约进行分区运算，并共同通过共识节点进行共识，这样设计是因为AOA基站节点和RSSI基站节点的定位算法不同，而且高精度定位区域的定位需求少、定位要求更快更准确，普通精度定位需求区域的定位需求多、定位要求普通，因此，可以满足不同区域的不同情况和要求。三是定位服务器运算压力较大，在大数量级场景下，定位运算负载极大；四是定位服务器的定位信息和定位记录的安全性得不到保障，易被攻击和篡改。进一步地，请参考图6，图6为本发明实施例所提供的S71-S76的流程示意图。如图6所示，所述方法还包括：S71、当第二分区的第二RSSI基站节点接收蓝牙终端发送的定位请求，统计接收请求次数M；S72、若接收请求次数M＞次数阈值M0，则统计所述第二RSSI基站节点邻域中所有节点的广播位置计算请求次数M1；S73、判断是否存在有节点广播位置计算请求次数，为邻域中所有节点的广播位置计算请求的平均次数；S74、若存在，则认定该节点为可疑节点，所述邻域中所有节点在指定时间T内向可疑节点发送诊断数据包；S75、计算可疑指数F，若可疑指数S＞指数阈值S0，则认定该节点为失效节点；S76、普通精度定位需求区域的RSSI基站节点通过移动分布模型进行位置更新，直至所有邻域的节点邻域密度值收敛至满足预设要求。其中，本发明实施例的可疑指数F的计算公式如下：，其中，n表示给指定时间T内的周期数，i表示周期序号，α和表示调节系数，表示可疑节点第i期内未回复诊断数据包的数量，表示可疑节点指定时间T内未回复诊断数据包的平均数量，表示可疑节点第i周期内回复诊断数据包的累计时长，表示可疑节点指定时间T内回复诊断数据包的平均时长。本发明通过对第二分区的第二RSSI基站节点进行自检，从而发现失效节点，普通精度定位需求区域的RSSI基站节点通过移动分布模型进行位置更新，直至所有邻域的节点邻域密度值收敛至满足预设要求，完成对定位自我修复，不影响系统的正常运行。还可以根据需要设置报警节点，用于提示工作人员进行维护。进一步地，请参考图7，图7为本发明实施例所提供的S51-S54的流程示意图。如图7所示，所述RSSI基站节点获取蓝牙终端的位置信息，进行误差补偿，获取修正后的蓝牙终端的位置信息，具体包括：S51、第一RSSI基站节点接收位于重叠区域内的蓝牙终端的固定频率的信号，计算蓝牙终端的第一位置信息并获取蓝牙终端的速度、加速度、方向信息，在区块链广播；S52、AOA基站节点接收所述蓝牙终端的固定频率的信号，计算蓝牙终端的第二位置信息，在区块链广播；S53、区块链网络中第一RSSI基站节点和第二RSSI基站节点共享所述信息，并根据第一位置信息和第二位置信息生成位置误差，将第一位置信息、速度、加速度、方向信息作为输入，将位置误差作为输出，以预先搭建好的DNN网络模型进行训练；S54、当第二RSSI基站节点接收位蓝牙终端的固定频率的信号时，获取蓝牙终端的位置信息，通过训练好的DNN网络模型预测位置误差，进行误差补偿，获取修正后的蓝牙终端的位置信息。本发明通过AOA基站可对RSSI基站节点的定位进行修正，从而使得普通精度定位需求区域RSSI基站节点定位更为精确。需要说明的是，本发明采用的DNN网络模型可以是本发明人构建的深度神经网络模型，也可以是采用现有的深度神经网络模型进行替代。其中，本发明构建的DNN网络模型如下：将第一位置信息、速度、加速度、方向信息作为输入，将位置误差作为输出，在输入和输出之间设有多个隐藏层，每个隐藏层的节点数相同；不引起过拟合的隐藏层节点数量上限计算公式如下：，其中，I和O分别表示输入和输出节点的数量，S表示训练数据集中的样本数量，表示比例因子，为常数；定义，其中，表示第层所有输入的向量，表示第层所有输出的向量，表示第层所有偏移的向量，表示权重；因此，，其中，表示激活函数；其中，网络隐藏层使用的激活函数是ReLU函数，输出层使用的激活函数是Sigmoid函数；损失函数定义如下：，，其中，其中x和y分别表示输入和输出向量，表示损失函数的参数向量，n表示样本数，表示第i个样本的实际输出，表示第i个样本的期望输出；当网络有L层，，因此，根据损失函数求解输出层的梯度：，，其中，表示Hadamard乘积；进行参数更新：，，其中，表示学习率；当W和b的变化小于停止迭代阈值，结束训练。本发明实施例进一步给出实现上述方法实施例中各步骤及方法的系统实施例。本发明实施例还提供了一种基于蓝牙AOA的室内定位系统。该系统包括：所述系统包括由输入节点、若干固定式AOA基站节点和若干移动式RSSI基站节点构成的区块链网络，所述区块链网络被配置为上述的方法；其中，所述输入节点用于获取AOA基站节点固定位置信息以生成高精度定位区域数据，并将高精度定位区域数据和普通精度定位需求区域数据签名后在区块链网络内进行广播。请参考图8，其为本发明实施例所提供的RSSI基站节点的功能框图。其中，RSSI基站节点包括：位置更新模块，用于在普通精度定位需求区域初始定位后，通过移动分布模型进行位置更新；请求模块，用于接收蓝牙终端发送的定位请求，计算蓝牙终端和RSSI基站节点之间的距离，将位置计算请求签名后在区块链网络内进行广播；计算模块，用于接收网络广播的位置计算请求，计算出蓝牙终端的位置并进行广播；修正模块，用于获取蓝牙终端的位置信息，进行误差补偿，获取修正后的蓝牙终端的位置信息。由于本实施例中的各单元模块能够执行图1所示的方法，本实施例未详细描述的部分，可参考对图1的相关说明。在硬件层面，该系统可以包括处理器，可选地还包括内部总线、网络接口、存储器。其中，存储器可能包含内存，例如高速随机存取存储器，也可能还包括非易失性存储器，例如至少1个磁盘存储器等。当然，该系统还可能包括其他业务所需要的硬件。处理器、网络接口和存储器可以通过内部总线相互连接，该内部总线可以是ISA总线或EISA、输入/输出接口、网络接口和内存。内存可能包括计算机可读介质中的非永久性存储器，随机存取存储器和/或非易失性内存等形式，如只读存储器或闪存。内存是计算机可读介质的示例。计算机可读介质包括永久性和非永久性、可移动和非可移动媒体可以由任何方法或技术来实现信息存储。信息可以是计算机可读指令、数据结构、程序的模块或其他数据。计算机的存储介质的例子包括，但不限于相变内存、静态随机存取存储器、动态随机存取存储器、其他类型的随机存取存储器、只读存储器、电可擦除可编程只读存储器、快闪记忆体或其他内存技术、只读光盘只读存储器、数字多功能光盘或其他光学存储、磁盒式磁带，磁带磁磁盘存储或其他磁性存储设备或任何其他非传输介质，可用于存储可以被计算设备访问的信息。按照本文中的界定，计算机可读介质不包括暂存电脑可读媒体，如调制的数据信号和载波。还需要说明的是，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、商品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、商品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括所述要素的过程、方法、商品或者设备中还存在另外的相同要素。本领域技术人员应明白，本发明的实施例可提供为方法、系统或计算机程序产品。因此，本发明可采用完全硬件实施例、完全软件实施例或结合软件和硬件方面的实施例的形式。而且，本发明可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本发明可以在由计算机执行的计算机可执行指令的一般上下文中描述，例如程序模块。一般地，程序模块包括执行特定任务或实现特定抽象数据类型的例程、程序、对象、组件、数据结构等等。也可以在分布式计算环境中实践本发明，在这些分布式计算环境中，由通过通信网络而被连接的远程处理设备来执行任务。在分布式计算环境中，程序模块可以位于包括存储设备在内的本地和远程计算机存储介质中。本发明中的各个实施例均采用递进的方式描述，各个实施例之间相同相似的部分互相参见即可，每个实施例重点说明的都是与其他实施例的不同之处。尤其，对于系统实施例而言，由于其基本相似于方法实施例，所以描述的比较简单，相关之处参见方法实施例的部分说明即可。以上所述仅为本发明的实施例而已，并不用于限制本发明。对于本领域技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原理之内所作的任何修改、等同替换、改进等，均应包含在本发明的权利要求范围之内。
