标题title
基于区块链的加密智能合约检测系统
摘要abst
本发明公开了基于区块链的加密智能合约检测系统，属于信息安全技术领域，包括开发者节点、算力节点、规则处理节点以及检测节点，开发者节点与算力节点、检测节点互联，算力节点与开发者、规则处理节点、检测节点互联，且规则处理节点、检测节点互联。本发明通过引入的检测节点接收开发者发布的加密智能合约和随机令牌，并接收规则处理节点发布的模糊映射表，能够在不暴露有效负载的情况下，使用随机令牌与模糊映射表执行匹配检测，即在保证加密智能合约隐私性的基础上，实现了对加密智能合约的安全性检测。
权利要求书clms
1.基于区块链的加密智能合约检测系统，其特征在于：包括开发者节点、算力节点、规则处理节点以及检测节点，开发者节点与算力节点、检测节点互联，算力节点与开发者、规则处理节点、检测节点互联，且规则处理节点、检测节点互联；开发者节点用于将智能合约进行加密处理，并将密钥共享至算力节点，同时对智能合约的明文代码进行处理得到用于检测的随机令牌，并将加密智能合约和随机令牌写入交易信息并存储至交易池；算力节点选择用于进行规则处理的矿工作为规则处理节点，并将关键信息写入交易信息并存至交易池，关键信息包括哈希值、密钥、算力节点签名；规则处理节点用于计算并构建模糊映射表并存储至包含若干区块的私有链上，同时将包括模糊映射表地址的交易信息发布至交易池中；检测节点包括签名验证单元和令牌检测单元，检测节点根据开发者发布的交易信息获取加密智能合约、随机令牌集合T和开发者签名SigDEV，并根据规则处理节点发布的交易信息获得模糊映射表Obm和算力节点签名SigCP，模糊映射表Obm用于反映响应规则与隐藏内容选项的映射关系；签名验证单元用于对开发者签名SigDEV、算力节点签名SigCP进行验证处理，若验证成功，根据随机令牌集合T、模糊映射表Obm执行令牌检测操作，若检测通过，将加密智能合约和随机令牌存储至区块链，否则，认为智能合约中包含恶意行为，直接丢弃；在对开发者签名SigDEV、算力节点签名SigCP进行验证处理前还包括：比较算力节点发布的交易信息transInfoCP和开发者发布的交易信息transInfoDEV中的滑动窗口大小L是否相同，如果相同，对开发者签名SigDEV、算力节点签名SigCP进行验证处理；否则，需要在私有区块链上找到一个新的区块；模糊映射表的构建包括以下子步骤：根据算力节点发布的交易信息获取密钥；对规则集中的规则Ri进行预处理；对内容进行分割处理，得到包含等长的第一片段集合Segj；基于第一片段集合Segj对内容进行隐藏处理；对规则响应操作进行隐藏处理，生成τ个秘密共享拼接字符串和秘密共享得到拼接结果将的异或结果作为映射表的值插入模糊映射表Obm的位置，表示由第j个内容的第n个片段产生的伪随机数，f表示伪随机函数；Kh表示密钥；表示规则的第j个内容的第n个片段。2.根据权利要求1所述的基于区块链的加密智能合约检测系统，其特征在于：所述算力节点还用于对密钥进行验证：算力节点接收开发者发送的基于公钥对K'AES、密钥集K'SET和时间戳ts进行加密的加密信息采用私钥SKCP对加密信息进行解密，得到K'AES，K'SET和ts；以K'AES为种子，采用与开发者使用的相同伪随机数生成器生成一个新的密钥集，若新的密钥集与开发者通过相同伪随机数生成器得到的密钥集相同，不执行任何操作；反之，算力节点停止与开发者的通信。3.根据权利要求1所述的基于区块链的加密智能合约检测系统，其特征在于：所述算力节点在接收检测节点发送的包含加密智能合约地址的交易信息后，从区块链上获取智能合约密文和随机令牌，并基于开发者共享的密钥对加密智能合约进行解密，获取智能合约明文；通过随机令牌化操作生成新的随机令牌，并与来自开发者的随机令牌进行对比，验证智能合约的一致性，若不一致，丢弃对应智能合约。4.根据权利要求1所述的基于区块链的加密智能合约检测系统，其特征在于：所述开发者使用算力节点的公钥对K'AES、密钥集K'SET和时间戳ts对智能合约进行加密，并将加密信息传输至算力节点。5.根据权利要求1所述的基于区块链的加密智能合约检测系统，其特征在于：所述开发者执行一个基于滑动窗口的令牌化算法，将整个智能合约M划分为一个令牌集合W＝{W1,|,Wσ}，计算公式为：W＝{W1,|,Wσ}＝Token式中，Token是基于滑动窗口的令牌化算法，每个令牌Wi的长度与滑动窗口长度相同且均为L；开发者利用伪随机函数和密钥生成随机令牌集合T进行安全检测。
说明书desc
技术领域本发明涉及信息安全技术领域，尤其涉及基于区块链的加密智能合约检测系统。背景技术在现有的区块链系统中，所有参与共识的节点都必须拥有交易和智能合约的真实数据，才能完成计算工作并根据状态达成共识。然而，智能合约中可能会包含一些隐私信息，比如身份信息、企业机密、特定代码等，由于所有参与共识的节点都可以获得智能合约的真实数据，导致智能合约中的隐私数据存在泄露的风险，进而降低区块链的安全性和实用性。因此，为了保证智能合约的隐私性，一些关于智能合约加密的方法、系统或流程被提出。考虑这样一个场景，存在一个拥有强大算力和大量数据资源的算力节点，它可以为其他用户提供数据挖掘的操作。另外，存在一个用户，它作为智能合约的开发者，希望利用该算力节点的资源和算力进行数据挖掘，同时不想让除了该算力节点以外的其他节点获取智能合约的真实数据。此时，可行的操作为：首先，用户和算力节点进行协商获取密钥；之后，用户将智能合约加密后得到的合约密文存储到区块链上；最后，算力节点在收到用户的交易信息后，根据交易信息获取对应的合约密文，对密文解密获取智能合约明文。然而，此时又产生了另外的问题，如果智能合约的开发者存在无意的疏忽或故意的恶意行为，则智能合约代码中可能会存在安全漏洞，这将对交易及财产安全产生威胁。因此，在保护智能合约的隐私性的前提下，为了进一步保证加密智能合约的内容安全性，需要在加密智能合约部署在区块链上之前对其进行检测操作。发明内容本发明的目的在于克服现有技术的问题，提供基于区块链的加密智能合约检测系统。本发明的目的是通过以下技术方案来实现的：基于区块链的加密智能合约检测系统，该系统包括开发者节点、算力节点、规则处理节点以及检测节点，开发者节点与算力节点、检测节点互联，算力节点与开发者、规则处理节点、检测节点互联，且规则处理节点、检测节点互联；开发者节点用于将智能合约进行加密处理，并将密钥共享至算力节点，同时对智能合约的明文代码进行处理得到用于检测的随机令牌，并将加密智能合约和随机令牌写入交易信息并存储至交易池；算力节点选择用于进行规则处理的矿工作为规则处理节点，并将关键信息写入交易信息并存至交易池，关键信息包括哈希值、密钥、算力节点签名；规则处理节点用于计算并构建模糊映射表并存储至包含若干区块的私有链上，同时将包括模糊映射表地址的交易信息发布至交易池中；检测节点包括签名验证单元和令牌检测单元，检测节点根据开发者发布的交易信息获取加密智能合约、随机令牌集合T和开发者签名SigDEV，并根据规则处理节点发布的交易信息获得模糊映射表Obm和算力节点签名SigCP，模糊映射表Obm用于反映响应规则与隐藏内容选项的映射关系；签名验证单元用于对开发者签名SigDEV、算力节点签名SigCP进行验证处理，若验证成功，根据随机令牌集合T、模糊映射表Obm执行令牌检测操作，若检测通过，将加密智能合约和随机令牌存储至区块链，否则，认为智能合约中包含恶意行为，直接丢弃；在对开发者签名SigDEV、算力节点签名SigCP进行验证处理前还包括：比较算力节点发布的交易信息transInfoCP和开发者发布的交易信息transInfoDEV中的滑动窗口大小L是否相同，如果相同，对开发者签名SigDEV、算力节点签名SigCP进行验证处理；否则，需要在私有区块链上找到一个新的区块；模糊映射表的构建包括以下子步骤：根据算力节点发布的交易信息获取密钥；对规则集中的规则Ri进行预处理；对内容进行分割处理，得到包含等长的第一片段集合Segj；基于第一片段集合Segj对内容进行隐藏处理；对规则响应操作进行隐藏处理，生成τ个秘密共享拼接字符串和秘密共享得到拼接结果将的异或结果作为映射表的值插入模糊映射表Obm的位置，表示由第j个内容的第n个片段产生的伪随机数，f表示伪随机函数；Kh表示密钥；表示规则的第j个内容的第n个片段。在一示例中，所述算力节点还用于对密钥进行验证：算力节点接收开发者发送的基于公钥对K'AES、密钥集K'SET和时间戳ts进行加密的加密信息EncPKCP；采用私钥SKCP对加密信息进行解密，得到K'AES，K'SET和ts；以K'AES为种子，采用与开发者使用的相同伪随机数生成器生成一个新的密钥集，若新的密钥集与开发者通过相同伪随机数生成器得到的密钥集相同，不执行任何操作；反之，算力节点停止与开发者的通信。在一示例中，所述算力节点在接收检测节点发送的包含加密智能合约地址的交易信息后，从区块链上获取智能合约密文和随机令牌，并基于开发者共享的密钥对加密智能合约进行解密，获取智能合约明文；通过随机令牌化操作生成新的随机令牌，并与来自开发者的随机令牌进行对比，验证智能合约的一致性，若不一致，丢弃对应智能合约。在一示例中，所述开发者使用算力节点的公钥对K'AES、密钥集K'SET和时间戳ts对智能合约进行加密，并将加密信息传输至算力节点。在一示例中，所述开发者执行一个基于滑动窗口的令牌化算法，将整个智能合约M划分为一个令牌集合W＝{W1,|,Wσ}，计算公式为：W＝{W1,|,Wσ}＝Token式中，Token是基于滑动窗口的令牌化算法，每个令牌Wi的长度与滑动窗口长度相同且均为L；开发者利用伪随机函数和密钥生成随机令牌集合T进行安全检测。需要进一步说明的是，上述方法各示例对应的技术特征可以相互组合或替换构成新的技术方案。与现有技术相比，本发明有益效果是：1.在一示例中，本发明通过引入的检测节点接收开发者发布的加密智能合约和随机令牌，并接收规则处理节点发布的模糊映射表，能够在不暴露有效负载的情况下，使用随机令牌与模糊映射表执行匹配检测，即在保证加密智能合约隐私性的基础上，实现了对加密智能合约的安全性检测。2.在一示例中，本发明通过通过引入规则处理节点，建立响应规则与隐藏内容选项的映射关系的模糊映射表，仅使开发者与算力节点能够获取智能合约明文，进而在保证隐私的前提下实现了加密智能合约的安全性检测。附图说明下面结合附图对本发明的具体实施方式作进一步详细的说明，此处所说明的附图用来提供对本申请的进一步理解，构成本申请的一部分，在这些附图中使用相同的参考标号来表示相同或相似的部分，本申请的示意性实施例及其说明用于解释本申请，并不构成对本申请的不当限定。图1为智能合约结构示意图；图2为本发明一示例中的方法流程图；图3为本发明优选示例的方法流程图；图4为本发明一示例的系统结构图。图中：1-开发者、2-算力节点、3-规则处理节点、4-检测节点、5-交易池、6-区块、7-区块链、8-私有链、9-签名验证单元、10-令牌检测单元、11-智能合约、12-存储单元、13-代码单元。具体实施方式下面结合附图对本发明的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。在本发明的描述中，需要说明的是，属于“中心”、“上”、“下”、“左”、“右”、“竖直”、“水平”、“内”、“外”等指示的方向或位置关系为基于附图所述的方向或位置关系，仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本发明的限制。此外，使用序数词是为了对物体进行区分，并不限于该顺序，而不能理解为指示或暗示相对重要性。在本发明的描述中，需要说明的是，除非另有明确的规定和限定，属于“安装”、“相连”、“连接”应做广义理解，例如，可以是固定连接，也可以是可拆卸连接，或一体地连接；可以是机械连接，也可以是电连接；可以是直接相连，也可以通过中间媒介间接相连，可以是两个元件内部的连通。对于本领域的普通技术人员而言，可以具体情况理解上述术语在本发明中的具体含义。此外，下面所描述的本发明不同实施方式中所涉及的技术特征只要彼此之间未构成冲突就可以相互结合。本发明提出了一种基于区块链网络的数据训练平台中数据挖掘的高效隐私保护加密智能合约检测方法，该方法采用了轻量级加密操作实现了对加密智能合约内容的安全检测。其中，区块链网络由许多参与共识的节点构成，拥有数据交易平台的节点，为智能合约开发者提供算力和数据支持，使得智能合约可以正常部署并执行。具体地，区块链是比特币、以太坊等加密货币系统的核心支持技术。区块链本质上是一个去中心化的允许任何人参与的公共分布式账本。因此，当一个区块链节点出现故障时不会影响到其他节点。此外，整个区块链网络通过区块链节点之间的共识机制进行维护，允许每个区块链节点获得数据库的完整副本。因此，区块链系统只能按照严格的共识和规则进行修改。进一步地，区块链的主要组成包括区块和事务。每个区块由区块头和区块体组成，其中区块头中包含了软件/协议的版本号、前一区块的哈希值、Merkle树的根哈希值、创建时间戳、工作量证明难度目标以及用于证明工作量的计算参数，通过加密哈希算法和Merkle树结构确保了数据不会被篡改；区块体中包含了所有与区块确认的事务，每个事务都记录了一组特定的操作。进一步地，以太坊是一个具有开源代码的编程平台，使得开发人员能够基于智能合约构建分布式应用程序。由于共识机制的存在使得以太坊得到了认可，很多人通过购买服务器运行以太坊代码，这种矿工执行代码的操作称为挖矿，即验证和处理交易。每一个矿工都是一个节点，节点之间存在通信验证，以太坊的任意一个节点都可以是网络的入口和出口，做到了去中心化。具体来说，以太坊可以用于协议编程、行为保证和交易处理，如投票、公司管理、金融交易以及协议签署。与比特币系统相比，以太坊允许程序在区块链上执行。一旦部署了智能合约，以太坊节点就可以去中心化地执行合约。进一步地，智能合约是一种以信息化方式传播验证的，并可以根据其内容在区块链上自动执行的计算机程序。智能合约的结构如图1所示，一个完整的智能合约11存储在区块链7的某一区块6中，包括用于存储状态和值的存储单元12、用于响应条件的代码单元13。在部署智能合约时，需要预设触发条件和相应的响应规则，相关的状态和值也将记录在已部署的智能合约中。当条件触发时，将执行来自调用节点的相关操作进行响应。只有修改合约状态或值的行为最终会被记录在区块链中，其他行为不会被披露。进一步地，智能合约运行在本地的以太坊虚拟机EVM上，以太坊虚拟机可以将智能合约代码解释成字节码进行执行。以太坊可以被视为一个交易驱动的状态机，即，当调用智能合约的交易在区块链上发布时，每个矿工都会执行该交易，并确定地从当前状态转移到下一个状态。为了在加密智能合约存储至区块链之前，保证其隐私性和合法性，本发明提出了一个隐私保护的加密智能合约检测方案。在一示例中，如图2所示，一种基于区块链的加密智能合约检测方法，该方法以检测节点作为执行主体，具体包括以下步骤：根据开发者发布的交易信息获取加密智能合约随机令牌集合T和开发者签名SigDEV，并从规则处理节点的私有区块链上获得区块中的交易信息，进而得到模糊映射表Obm和算力节点签名SigCP，模糊映射表Obm用于反映响应规则与隐藏内容选项的映射关系；其中，检测节点、规则处理节点为不同矿工，矿工节点相互互联形成分布式网络。对开发者签名SigDEV、算力节点签名SigCP进行验证处理，若验证成功，根据随机令牌集合T、模糊映射表Obm执行令牌检测操作，若检测通过，将加密智能合约和随机令牌存储至区块链，否则，认为智能合约中包含恶意行为，直接丢弃。本示例中，通过检测节点接收开发者发布的加密智能合约和随机令牌，并接收规则处理节点发布的模糊映射表，能够在不暴露有效负载的情况下，使用随机令牌与模糊映射表执行匹配检测，即在保证加密智能合约隐私性的基础上，实现了对加密智能合约的安全性检测。在一示例中，对开发者签名SigDEV、算力节点签名SigCP进行验证处理，具体包括：分别使用开发者的公钥PKDEV、算力节点的公钥PKCP对开发者签名SigDEV、算力节点签名SigCP进行解密处理得到两个哈希值，若两个哈希值相同，继续执行下一步骤；否则，需要在私有区块链上找到一个新的合适的区块。通过随机令牌集合T、以及哈希函数计算一个哈希值，与交易信息中的哈希值HV比较，若相同，则验证成功，能够进行令牌检测操作；反之，验证失败，需要在规则处理节点的私有区块链上找到一个新的区块。进一步地，在对开发者签名SigDEV、算力节点签名SigCP进行验证处理前还包括：比较算力节点发布的交易信息transInfoCP和开发者发布的交易信息transInfoDEV中的滑动窗口大小L是否相同，如果相同，对开发者签名SigDEV、算力节点签名SigCP进行验证处理；否则，需要在私有区块链上找到一个新的合适的区块。在一示例中，检测节点使用随机令牌集合T和模糊映射表Obm执行检测操作，即执行多项式时间算法Match：以模糊映射表Obm和一组由σ个消息生成的随机令牌集{T1,…,Tσ}作为输入，一个多项式时间算法Match输出一组布尔值{V1,|,Vσ}。1表示令牌匹配成功；0表示该令牌未发现匹配。具体地，执行令牌检测操作包括以下子步骤：A)对每个随机令牌Ti进行分割处理，得到左边部分的随机令牌和右边部分的随机令牌将按序的Ti的位置信息存入表Tablelen；具体地，对于i∈，分割每个Ti获得和其中，Wi为第i个明文令牌；Ks，Kh，Kc，Kl构成密钥集KSET，其中Ks为伪随机函数F的密钥，Kh为伪随机函数f的密钥，Kc为伪哈希函数H的密钥，Kl为伪随机数生成器G的密钥，Ks，Kh，Kc，Kl用于生成模糊映射表和随机令牌。B)根据开发者生成的密钥确定模糊映射表Obm在位置loc存储的值Obm；具体地，计算并在Obm中找到loc处存储的值其中表示由第j个内容的第n个片段产生的伪随机数。C)对Obm、进行异或处理得到id和秘密共享p的拼接，id为规则的总编号；D)维护表Tablecon，储存分割得到的id和秘密共享p，并更新表Tablecon中秘密共享p；在存储过程中，如果该id在表中已有记录，则令id对应的p与表Tablecon中id对应的值执行异或操作，然后将表Tablecon中id对应的值更新为异或的结果；如果秘密共享恢复成功，则可以在表Tablecon中找到总编号为id的规则的一个被隐藏的内容；同时，维护存储“id-令牌位置信息”键值对的表Tablelen，以使用表Tablecon中恢复的con中包含的modCollection验证表Tablecon中的长度和位置信息；E)对于单个规则，id包含规则编号id1、规则中内容选项编号id2、和内容选项总数id3；当具有相同规则编号id1的内容选项数量达到总数id3时，并且通过了modCollection所规定的修饰选项的验证后，认为该规则中的所有内容选项都已成功匹配；此时，维护中间表Tableact存储规则编号id1作为键，并以con分离的第一秘密共享q作为值，当同样的id1到来时，将第一秘密共享q与中间表Tableact中的值进行异或，并将结果更新到中间表Tableact中；F)若中间表Tableact中恢复出规则集规定的响应操作，则认为智能合约包括恶意信息，直接丢弃；反之，认为智能合约合法，将加密智能合约、随机令牌集合T和哈希值HV存储至区块链上。在一示例中，本发明方法以开发者作为执行主体时，包括以下步骤：将智能合约进行加密处理，并将密钥共享至算力节点，同时对智能合约的明文代码进行处理得到用于检测的随机令牌，具体通过以Ks为密钥的伪随机函数F、以Kh为密钥的伪随机函数f计算得到随机令牌。将加密智能合约和随机令牌写入交易信息并存储至交易池。具体地，开发者即用户使用算力节点的公钥对K'AES、密钥集K'SET和时间戳ts对智能合约进行加密，并将加密信息传输至算力节点。进一步地，为了实现对加密智能合约的检测，开发者除了需要生成传统的加密信息外，还需要生成一个随机的令牌集合T，其中M表示智能合约的明文。首先，为了得到T，开发者首先执行一个基于滑动窗口的令牌化算法，将整个智能合约M划分为一个令牌集合W＝{W1,…,Wσ}，具体计算公式为：W＝{W1,…,Wσ}＝Token式中，Token是基于滑动窗口的令牌化算法，每个令牌Wi的长度与滑动窗口长度相同且均为L。然后，开发者利用伪随机函数和密钥生成随机令牌集合T进行安全检测。具体地，对于每个i∈，开发者通过使用伪随机函数F、随机函数f，以及密钥Ks、Kh计算得到随机令牌：Ti＝F||f在检测时，除了需要匹配规则的内容选项外，还需要满足内容选项对应的修饰选项中的相应要求。由于明文令牌集W是通过基于滑动窗口的令牌化算法得到的，所以明文令牌的长度信息是确定的。此外，只要W中令牌按照处理顺序排列，便可确定令牌首字符在完整明文中的位置信息。对于每个i∈，通过下式进行处理：HV＝Hash,T2)…,Tσ)式中Hash是一个哈希函数，计算得到用于验证令牌顺序的哈希值HV。进一步地，开发者计算一个交易信息transInfoDEV，具体计算公式为：式中，tidDEV表示交易标识；addrDEV表示开发者的地址；addrdest表示目的地址；表示开发者签名，H为哈希函数的简写；KAES表示加密算法AES的对称密钥；KSET表示密钥集；ts表示时间戳；ids表示作为规则处理者的矿工。开发者将交易信息transInfoDEV放入交易池中，以进行后续的令牌检测操作。在一示例中，方法以算力节点作为执行主体时，还包括以下步骤：选择用于进行规则处理的矿工作为规则处理节点；具体地，在开发者和算力节点确定密钥后，算力节点需要从一组矿工节点Miner＝{miner1,…,minerτ}中选择一个矿工作为规则处理者来处理原始规则集，τ表示矿工数量。算力节点需要计算待选择矿工的编号，具体计算公式为：ids＝Hmodτ其中，ids表示作为规则处理者的矿工的编号；mod为求余计算符。然后算力节点用开发者的公钥PKDEV对ids进行加密得到作为规则处理者的加密矿工并将发送给开发者以进行通知。进一步地，算力节点还用于将关键信息写入交易信息并存至交易池，关键信息包括哈希值、密钥、算力节点签名。具体地，为了后续的规则处理阶段的开展，需要将一些重要信息作为交易信息放入交易池中，与规则处理节点共享。算力节点计算得到的交易信息的公式为：式中，tidCP表示交易标识；addrCP、addrRP分别为算力节点和规则处理节点的地址；PKRP是规则处理节点的公钥；表示算力节点签名，L是滑动窗口大小，其获取过程如下：由于规则处理节点拥有原始规则集，它根据所有规则中最短的“content”选项推导出滑动窗口应设置的大小L)，len为规则集R中全部规则的所有内容选项中最短内容选项的长度。之后，通过公钥加密将L分别发送给开发者和算力节点。从威胁模型来看，开发者可能是恶意的，并企图使用伪造的随机令牌来成功通过令牌检测。因此，在执行智能合约代码进行数据挖掘前，算力节点需要检测来自开发者的M与T的一致性。在一示例中，方法以算力节点作为执行主体时，还用于对智能合约的一致性进行验证，包括以下子步骤：接收检测节点发送的包含加密智能合约地址的交易信息后，从区块链上获取智能合约密文、随机令牌T以及哈希值HV，并使用密钥KAES解密得到智能合约明文M；通过随机令牌化操作生成新的随机令牌，并与来自开发者的随机令牌进行对比，验证智能合约的一致性，若不一致，丢弃对应智能合约。具体地，使用基于滑动窗口的令牌化算法Token以及随机令牌生成算法来获得随机令牌集合T'，并使用哈希函数对T'进行计算得到HV'。如果T'＝T，且HV'＝HV，则认为数据流和T一致；否则，算力节点认为开发者存在恶意篡改行为，不予执行并丢弃智能合约。在一示例中，方法以算力节点作为执行主体时，还包括以下步骤：接收开发者发送的基于公钥对K'AES、密钥集K'SET和时间戳ts进行加密的加密信息采用私钥SKCP对加密信息进行解密，得到K'AES，K'SET和ts；以K'AES为种子，采用与开发者使用的相同伪随机数生成器生成一个新的密钥集，若新的密钥集与开发者通过相同伪随机数生成器得到的密钥集相同，不执行任何操作；反之，认为开发者不诚实，算力节点立即停止与开发者的通信。在一示例中，方法以规则处理节点作为执行主体时，包括以下步骤：计算并构建模糊映射表并存储至自己的私有链上，并将包括模糊映射表地址的交易信息发布至交易池中。在此阶段，规则处理节点执行规则处理策略。为了提高效率和可扩展性，提出了一种高性能的模糊映射表生成算法。为了更接近实际的应用场景，选择了开源的Snort规则集R＝{R1,…,Rδ}作为检测规则。具体地，使用规则中的内容选项来匹配待检测的明文。与先前工作的加密索引设计不同，本申请所提出的模糊映射表通过只存储加密片段来缩小所需的存储空间，同时仍能够保持检测的正确性，具体以密钥KRP和一个规则集R作为输入，一个多项式时间算法ObRuleGen输出一个模糊映射表Obm，具体包括以下步骤：a)根据算力节点发布的交易信息获取密钥；b)对规则集中规则Ri进行预处理；c)对内容进行分割处理，得到包含等长的第一片段集合Segj；d)基于第一片段集合Segj对内容进行隐藏处理；e)对规则响应操作进行隐藏处理，生成τ个秘密共享j为规则的内容的序号，n为片段的序号；f)拼接字符串和秘密共享得到拼接结果其中，i∈，n∈，j∈。g)将的异或结果作为映射表的值插入模糊映射表Obm的位置，表示规则的第j个内容的第n个片段。具体地，步骤a)中，规则处理节点得到交易信息transInfoCP后，使用自己的私钥SKRP解密交易信息中的得到密钥集合KSET，并保存算力节点签名SigCP。具体地，步骤b)中，对于δ个规则，每个规则Ri，i∈，提取内容选项及其对应的修饰选项，并获取“{content:modCollection}”键值对，其中modCollection为该content对应的所有修饰选项的集合。同时，每个规则都有一个包含安全操作的规则头，规则头中定义了内容选项匹配后的响应操作action。首先根据规则本身结构对所有规则进行预处理，对任意i∈，每个规则Ri表示为：Ri＝{content1:modCollection1,…,contentω:modCollectionω,actioni}＝{CMi,actioni}上式中，规则Ri包含ω个用于匹配检测的内容选项，为方便描述定义Ri中的键值对集合为CMi。具体地，步骤c)中，由于内容选项长度的不同，会导致智能合约明文处理困难。为了统一长度以便于匹配，使用滑动窗口算法对明文和规则内容选项进行处理，其中滑动窗口大小设定为L。然后，一个内容-修饰键值对将被进一步处理为“{Seg:modCollection}”，其中Seg是content经过滑动窗口分割得到的片段集合：式中，使用基于滑动窗口的令牌化算法Token对规则中第j个内容进行分割，得到包含τ个元素的片段集合。对任意i∈，规则Ri进一步处理为：Ri＝{seg1:modCollection1,…,segω:modCollectionω,actioni}通过上述操作，对每个内容选项都进行了分割，得到包含等长片段的集合。此时，由于内容选项被分割，这就要求所有片段都匹配时才能说明匹配成功，然而不同content分割得到的不同片段集合中可能存在相同的片段，因此对内容选项的隐藏和恢复进行了设计。具体地，步骤d)中，首先，为每个规则定义一个编码，用于唯一地标识规则并方便后续操作。然后，通过哈希函数H和密钥Kc处理初始的内容选项，然后将该哈希值与其相应的修饰选项集合拼接，得到待隐藏的规则内容。对于规则的第j个内容选项contentj，j∈，进行如下计算：conj＝H||modCollectionj式中modCollectionj是经过填充的修饰选项，目的是使所有conj拥有相同长度。然后，考虑使用片段集合Segj中的所有片段对coni进行隐藏。为了实现高效、安全的隐藏和恢复操作，采用了一种高效的秘密共享方案。具体来说，给定一个带有τ个段的内容选项contentj，通过该内容选项计算得到的conj将被视为一个秘密。然后生成τ-1个与conj相同比特的随机字符串{p1,…,pτ-1}，并且定义P＝{p1,…,pτ-1,pτ}为秘密共享集合，其中每个元素都是关于conj的秘密共享。只有获得τ个秘密共享后，才能执行还原操作，有以下计算公式：通过隐藏每个内容选项及其修饰选项，对任意i∈，规则将进一步定义为下式所示的形式：令每个内容选项对应的秘密共享数与经过滑动窗口算法生成的片段数一致。idij表示一个与规则和内容选项相关的字符串，有其中表示规则编号，表示规则中内容选项编号，表示规则中内容选项总数。例如，一个规则的总编号为3，它有10个内容选项，则该规则的第5个内容选项可以表示为需要说明的是，与与真实规则中内容选项的信息对应，而则是在规则处理过程中按规则先后顺序进行的自动编号。具体地，步骤e)中，当一条规则的所有内容选项都匹配时，表示明文中包含该规则规定的内容，认为存在入侵行为。之后，便可执行在该规则的规则头中指定的响应操作，即“action”。因此，本发明设计的目标是：只有当一个规则中的所有相关内容选项都被匹配时，响应操作才会被恢复；否则，认为与规则不匹配，且不会透露任何与响应操作有关信息。具体来说，生成ω-1个随机字符串{q1,…,qω-1}，其中每个字符串的长度与规则响应操作actioni，i∈所对应字符串的长度相同。令得到第一秘密共享集合Q＝{q1,…,qω-1,qω}。当获取到ω个第一秘密共享后，可通过下式进行还原：将qj放入conj，j∈中。此时，只有当一个规则的所有conj都被恢复时，才可以用得到秘密共享恢复响应操actioni，以处理可能存在安全问题的加密数据流，有以下计算公式：conj＝qj||H||modCollectionj,j∈最后，对任意i∈，每个规则将被处理为下式所示形式：此时，响应操作actioni被隐藏。具体地，步骤g)中，通过伪随机函数和片段计算得到，即为了解决可能出现的碰撞，在映射表的每个位置都构建了可变长度的桶。将上述示例进行组合，得到本发明优选检测方法，如图3所示，包括以下步骤：S1：开发者将智能合约进行加密处理，并将密钥共享至算力节点，同时对智能合约的明文代码进行处理得到用于检测的随机令牌，并将加密智能合约和随机令牌写入交易信息并存储至交易池；S2：算力节点对密钥进行验证；具体地，算力节点接收开发者发送的基于公钥对K'AES、密钥集K'SET和时间戳ts进行加密的加密信息采用私钥SKCP对加密信息进行解密，得到K'AES，K'SET和ts；以K'AES为种子，采用与开发者使用的相同伪随机数生成器生成一个新的密钥集，若新的密钥集与开发者通过相同伪随机数生成器得到的密钥集相同，不执行任何操作；反之，算力节点停止与开发者的通信。S3：算力节点选择用于进行规则处理的矿工作为规则处理节点，并将关键信息写入交易信息并存至交易池，关键信息包括哈希值、密钥、算力节点签名；S4：规则处理节点计算并构建模糊映射表并存储至自己的私有链上，并将包括模糊映射表地址的交易信息发布至交易池中；S5：检测节点根据开发者发布的交易信息获取加密智能合约、随机令牌集合T和开发者签名SigDEV，并根据规则处理节点发布的交易信息获得模糊映射表Obm和算力节点签名SigCP；对开发者签名SigDEV、算力节点签名SigCP进行验证处理，若验证成功，根据随机令牌集合T、模糊映射表Obm执行令牌检测操作，若检测通过，将加密智能合约和随机令牌存储至区块链，否则，认为智能合约中包含恶意行为，直接丢弃；S6：算力节点接收检测节点发送的包含加密智能合约地址的交易信息后，从区块链上获取智能合约密文和随机令牌，并基于开发者共享的密钥对加密智能合约进行解密，获取智能合约明文；通过随机令牌化操作生成新的随机令牌，并与来自开发者的随机令牌进行对比，验证智能合约的一致性，若不一致，丢弃对应智能合约。本发明还包括一种基于区块链的加密智能合约检测系统，如图4所示，系统包括开发者节点、算力节点2、规则处理节点3以及检测节点4，开发者节点与算力节点2、检测节点4互联，算力节点2与开发者1、规则处理节点3、检测节点4互联，且规则处理节点3、检测节点4互联。其中，开发者节点用于将智能合约进行加密处理，并将密钥共享至算力节点2，同时对智能合约的明文代码进行处理得到用于检测的随机令牌，并将加密智能合约和随机令牌写入交易信息并存储至交易池5。算力节点2选择用于进行规则处理的矿工作为规则处理节点3，并将关键信息写入交易信息并存至交易池5，关键信息包括哈希值、密钥、算力节点签名。规则处理节点3用于计算并构建模糊映射表并存储至包含若干区块6的私有链8上，同时将包括模糊映射表地址的交易信息发布至交易池5中。检测节点4包括签名验证单元9和令牌检测单元10，检测节点4根据开发者1发布的交易信息获取加密智能合约、随机令牌集合T和开发者签名SigDEV，并根据规则处理节点3发布的交易信息获得模糊映射表Obm和算力节点签名SigCP。其中，签名验证单元9用于对开发者签名SigDEV、算力节点签名SigCP进行验证处理，若验证成功，令牌检测单元10根据随机令牌集合T、模糊映射表Obm执行令牌检测操作，若检测通过，将加密智能合约和随机令牌存储至包含若干区块6的区块链7，否则，认为智能合约中包含恶意行为，直接丢弃。在一示例中，算力节点还用于对密钥进行验证；具体地，算力节点接收开发者发送的基于公钥对K'AES、密钥集K'SET和时间戳ts进行加密的加密信息采用私钥SKCP对加密信息进行解密，得到K'AES，K'SET和ts；以K'AES为种子，采用与开发者使用的相同伪随机数生成器生成一个新的密钥集，若新的密钥集与开发者通过相同伪随机数生成器得到的密钥集相同，不执行任何操作；反之，算力节点停止与开发者的通信。在一示例中，算力节点在接收检测节点发送的包含加密智能合约地址的交易信息后，从区块链上获取智能合约密文和随机令牌，并基于开发者共享的密钥对加密智能合约进行解密，获取智能合约明文；通过随机令牌化操作生成新的随机令牌，并与来自开发者的随机令牌进行对比，验证智能合约的一致性，若不一致，丢弃对应智能合约。本申请还包括一种存储介质，与上述任一示例或多个示例组成的基于区块链的加密智能合约检测方法具有相同的发明构思，其上存储有计算机指令，计算机指令运行时执行上述基于区块链的加密智能合约检测方法的步骤。基于这样的理解，本实施例的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台计算机设备执行本发明各个实施例方法的全部或部分步骤。而前述的存储介质包括：U盘、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质。本申请还包括一种终端，与上述任一示例或多个示例组成的基于区块链的加密智能合约检测方法具有相同的发明构思，包括存储器和处理器，存储器上存储有可在处理器上运行的计算机指令，处理器运行计算机指令时执行上述基于区块链的加密智能合约检测方法的步骤。处理器可以是单核或者多核中央处理单元或者特定的集成电路，或者配置成实施本发明的一个或者多个集成电路。在本发明提供的实施例中的各功能单元可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中。以上具体实施方式是对本发明的详细说明，不能认定本发明的具体实施方式只局限于这些说明，对于本发明所属技术领域的普通技术人员来说，在不脱离本发明构思的前提下，还可以做出若干简单推演和替代，都应当视为属于本发明的保护范围。
