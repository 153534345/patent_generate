标题title
一种通过压感技术处理电容触摸防水系统
摘要abst
本发明公开了一种通过压感技术处理电容触摸防水系统，包括：压感传感器、信号调理模块、等效模型模拟单元、外围处理电路和SOC处理单元；所述压感传感器具有两路输出端：Vp1和Vn1，均耦接到信号调理模块；压感传感器将形变信号准确地转化为电信号，且将电信号送入信号调理模块内进行处理；所述信号调理模块包括级联连接的可编程增益放大模块1、可编程增益放大模块2、逐次逼近转换器SARADC和IDAC补偿电路；本发明实现了IPX5的防水级别，达到了车规级防水的要求。
权利要求书clms
1.一种通过压感技术处理电容触摸防水系统，其特征在于，包括：压感传感器，所述压感传感器具有两路输出端：Vp1和Vn1，所述Vp1和Vn1均耦接到信号调理模块，所述压感传感器将形变信号转化为电信号，且将电信号送入信号调理模块内处理；信号调理模块，包括：可编程增益放大模块1、可编程增益放大模块2、逐次逼近转换器SARADC以及IDAC补偿电路；所述可编程增益放大模块1输出端耦接可编程增益放大模块2，且所述可编程增益放大模块2的输出端耦接到所述逐次逼近转换器SARADC，且所述逐次逼近转换器SARADC的输出端加载到SOC处理单元；SOC处理单元，包括：力映射单元、用户建模配置单元、触摸SOC处理单元和防水逻辑单元；其中，所述力映射单元、用户建模配置单元、触摸SOC处理单元的输出端均加载到防水逻辑单元，所述SOC处理单元具有一反馈输出端，所述反馈输出端通过IDAC补偿电路耦接到可编程增益放大模块1的反向输入端；等效模型模拟单元，包括：水珠等效模型模拟单元、水幕等效模型模拟单元、冲水等效模型模拟单元、暴雨等效模型模拟单元和淹水等效模型模拟单元；且，所述等效模型模拟单元的输出端通过外围处理电路加载到SOC处理单元。2.根据权利要求1所述的通过压感技术处理电容触摸防水系统，其特征在于：所述可编程增益放大模块1包括放大器U1、放大器U2、电阻R1、电阻R2、电阻R3和电阻R4，所述电阻R1、电阻R2、电阻R3、电阻R4为串联连接组成电阻串联电路，且所述电阻串联电路的两端分别并联连接到放大器U1、放大器U2的输出端。3.根据权利要求2所述的通过压感技术处理电容触摸防水系统，其特征在于：所述电阻R1与电阻R4的阻值相同，所述电阻R2与电阻R3的阻值相同，且所述电阻R1与电阻R2之间具有一补偿点A，电阻R3与电阻R4之间具有另一补偿点B，补偿电流加载到所述A点或B点的其中一个补偿点。4.根据权利要求2所述的通过压感技术处理电容触摸防水系统，其特征在于：所述可编程增益放大模块1中的放大器U1和放大器U2的正向输入端依次耦接所述压感传感器的两路输出端Vp1和Vn1，且所述放大器U1和放大器U2的输出端作为所述可编程增益放大模块1的两路输出端耦接到所述可编程增益放大模块2的两路输入端。5.根据权利要求1所述的通过压感技术处理电容触摸防水系统，其特征在于：所述IDAC补偿电路包括：电流型数模转换器IDAC、开关K1和K2；所述电流型数模转换器IDAC产生一校准信号，所述校准信号为一电流信号，所述开关K1和K2的闭合或断开由软件单元控制，且补偿时只有一个开关闭合。6.根据权利要求1所述的通过压感技术处理电容触摸防水系统，其特征在于：所述外围处理电路包括等效电阻、等效电容、电容触摸电极、寄生电容和串联电阻；所述等效模型模拟单元的一路输出端通过等效电容与SOC处理单元共地连接，且所述等效模型模拟单元的另一路输出端依次串联耦接等效电阻、电容触摸电极和串联电阻加载到SOC处理单元的触摸SOC处理单元；所述电容触摸电极与等效电容之间并联连接寄生电容。7.根据权利要求6所述的通过压感技术处理电容触摸防水系统，其特征在于：所述等效电容用于体现水流的大小；所述等效电阻用于衡量水流呈现的电阻特性；所述电容触摸电极用于收集人手按压时的信号；所述寄生电容用于衡量电容触摸电极所呈现的电容特性；所述串联电阻用于增加系统的抗扰性。8.根据权利要求2所述的通过压感技术处理电容触摸防水系统，其特征在于：所述放大器U1的输出端电压与放大器U2输出端的电压相等。9.根据权利要求2所述的通过压感技术处理电容触摸防水系统，其特征在于：所述可编程增益放大模块1和可编程增益放大模块2均为单端供电，且所述放大器U1的输出端电压大于0。10.根据权利要求1所述的通过压感技术处理电容触摸防水系统，其特征在于：所述力映射单元用于压感电信号与力的大小的映射处理；所述用户建模配置单元用于用户的定制配置处理；所述触摸SOC处理单元用于将用户建模配置单元处理后的信号输出到防水逻辑单元内进行模式算法匹配。
说明书desc
技术领域本发明涉及一种压感技术领域，具体为一种通过压感技术处理电容触摸防水系统。背景技术传统电容触摸芯片，通常是使用屏蔽电极的方式来处理防水问题，也是目前电容触摸实现防水的主要实现方式，主要原理是当触摸表面存在水流或者水滴时，通过内部的压感传感器检测到水分的存在，禁用掉芯片内部的其他电容压感传感器的检测扫描，从而避免采集到水和人手共同作用下的数据，导致算法逻辑判断出错，引起误触。这种处理方式的关键在于芯片内部要能够准确地检测到水分的存在，需要建立准确可靠的模型来识别这种场景，但是水的成分比较复杂，可能是含盐分比较多的汗水，也可能是酸度比较大的雨水，或者掺杂有各种化学成分的污水，通过芯片硬件逻辑电路建立的模型很难做到百分之百的准确度，这种纯触摸的传统方案防水测试只能达到IPX2的防水级别；现有技术已经不能满足现阶段人们的需求，基于现状，急需对现有技术进行改革。发明内容本发明的目的在于提供一种通过压感技术处理电容触摸防水系统，以解决上述背景技术中提出的问题。本发明提供如下技术方案一种通过压感技术处理电容触摸防水系统，包括:压感传感器、信号调理模块、等效模型模拟单元、外围处理电路和SOC处理单元；所述压感传感器具有两路输出端：Vp1和Vn1，所述Vp1和Vn1均耦接到信号调理模块；压感传感器将形变信号准确地转化为电信号，且将电信号送入信号调理模块内进行处理；所述信号调理模块包括:可编程增益放大模块1、可编程增益放大模块2、逐次逼近转换器：SARADC和IDAC补偿电路；所述可编程增益放大模块1包括：放大器U1、放大器U2、电阻R1、电阻R2、电阻R3、电阻R4，所述电阻R1、电阻R2、电阻R3、电阻R4为串联连接组成电阻串联电路；所述可编程增益放大模块1中的放大器U1和放大器U2的正向输入端依次耦接压感传感器的两路输出端Vp1和Vn1，且放大器U1和放大器U2的输出端作为可编程增益放大模块1的两路输出端耦接到可编程增益放大模块2的两路输入端，且可编程增益放大模块2的两路输出端耦接到SARADC的两路输入端；所述SARADC的输出端加载到SOC处理单元；所述SOC处理单元包括：力映射单元、用户建模配置单元、触摸SOC处理单元和防水逻辑单元；其中，力映射单元、用户建模配置单元、触摸SOC处理单元的输出端均加载到防水逻辑单元；所述SOC处理单元具有一反馈输出端，该反馈输出端通过IDAC补偿电路耦接到可编程增益放大模块1的反向输入端；所述等效模型模拟单元包括：水珠等效模型模拟单元、水幕等效模型模拟单元、冲水等效模型模拟单元、暴雨等效模型模拟单元和淹水等效模型模拟单元；所述等效模型模拟单元的输出端通过外围处理电路加载到SOC处理单元。本发明具有如下有益效果：本发明通过压感传感器将形变信号准确地转化为电信号，且将电信号送入信号调理模块内，在信号调理模块内信号经过可编程增益放大模块1、可编程增益放大模块2、逐次逼近转换器SARADC和IDAC补偿电路的信号调理后送入到SOC处理单元，通过在SOC处理单元内设多种算法，能够处理水珠等效模型模拟单元、水幕等效模型模拟单元、冲水等效模型模拟单元、暴雨等效模型模拟单元和淹水等效模型模拟单元等等效模型，实现了IPX5的防水级别，达到了车规级防水的要求。附图说明图1为本发明整体结构示意图；图2为本发明IDAC补偿电路示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。参考图1，本发明提供如下技术方案一种通过压感技术处理电容触摸防水系统，包括:压感传感器、信号调理模块、等效模型模拟单元、外围处理电路和SOC处理单元。所述压感传感器具有两路输出端：Vp1和Vn1，所述Vp1和Vn1均耦接到信号调理模块；压感传感器将形变信号准确地转化为电信号，且将电信号送入信号调理模块内进行处理，所述信号调理模块包括级联连接的可编程增益放大模块1、可编程增益放大模块2、逐次逼近转换器SARADC和IDAC补偿电路；所述可编程增益放大模块1包括：放大器U1、放大器U2、电阻R1、电阻R2、电阻R3、电阻R4，所述电阻R1、电阻R2、电阻R3、电阻R4为串联连接组成电阻串联电路，该电阻串联电路的两端分别并联连接到放大器U1、放大器U2的输出端，所述电阻R1与电阻R2之间具有一补偿点A，且电阻R3与电阻R4之间具有另一补偿点B；所述可编程增益放大模块1中的放大器U1和放大器U2的正向输入端依次耦接压感传感器的两路输出端Vp1和Vn1，且放大器U1和放大器U2的输出端作为可编程增益放大模块1的两路输出端耦接到可编程增益放大模块2的两路输入端，且可编程增益放大模块2的两路输出端耦接到SARADC的两路输入端；所述SARADC的输出端加载到SOC处理单元。所述SOC处理单元包括：力映射单元、用户建模配置单元、触摸SOC处理单元和防水逻辑单元；其中，力映射单元、用户建模配置单元、触摸SOC处理单元的输出端均加载到防水逻辑单元；经过信号调理模块处理后的信号输出到SOC处理单元，SOC处理单元首先通过力映射单元进行压感电信号与力的大小的映射处理，然后再通过用户建模配置单元根据用户的定制配置处理，且最后经过触摸SOC处理单元处理后输出到防水逻辑单元内进行模式算法匹配，最后给出正确的逻辑判断结果。所述SOC处理单元具有一反馈输出端，该反馈输出端通过IDAC补偿电路耦接到可编程增益放大模块1的反向输入端；参考图2，所述IDAC补偿电路包括：电流型数模转换器IDAC、开关K1和K2，电流型数模转换器IDAC产生一校准信号，且该校准信号为一电流信号，校准信号可以通过其中一个开关K1或K2，加入到补偿点A或B。K1和K2的闭合或断开由软件单元控制，且补偿时只有一个开关闭合，即补偿电流只能加到A或B的其中一个补偿点。本发明提供一实施例，用于阐述IDAC补偿电路的工作机制，其中，可编程增益放大模块1中的电阻R1与电阻R4的阻值相同，且电阻R2与电阻R3的阻值相同，所以在下述计算时，统一采用电阻R1和R2计算即可。在实施例中，通过控制补偿电流的大小，使放大器U1的输出端电压Vo+与放大器U2输出端的电压Vo-相等；即V0+=V0-所需电流计算公式为：其中，流经A-Vo+的电流为：流经A-B-Vo-的电流为：考虑到可编程增益放大模块1和可编程增益放大模块2均为单端供电，Vo+点电压应高于0；所以，最大调整范围由输入共模电压Vi，可编程增益放大模块1增益Gain1确定。所述等效模型模拟单元包括：水珠等效模型模拟单元、水幕等效模型模拟单元、冲水等效模型模拟单元、暴雨等效模型模拟单元和淹水等效模型模拟单元；所述等效模型模拟单元的输出端通过外围处理电路加载到SOC处理单元。所述外围处理电路包括：等效电阻、等效电容、电容触摸电极、寄生电容和串联电阻；所述等效模型模拟单元的一路输出端通过等效电容与SOC处理单元共地连接，且所述等效模型模拟单元的另一路输出端通过依次串联耦接等效电阻、电容触摸电极和串联电阻加载到SOC处理单元的触摸SOC处理单元；且所述电容触摸电极与等效电容之间并联连接寄生电容；其中，等效电容用于体现水流的大小，等效电阻用于衡量水流呈现的电阻特性；电容触摸电极用于收集人手按压时的信号；寄生电容用于衡量电容触摸电极所呈现的电容特性；串联电阻用于增加系统的抗扰性。在实施例中，当有冲水或者洗车的动作时，压感传感器检测到一定大小的力的存在，例如1到10牛的范围，信号调理模块设有两级可编程增益放大模块能够加大信号调理模块的动态测量范围：即在不使能可编程增益放大模块1和可编程增益放大模块2时，可以测量的信号比较大，使能可编程增益放大模块1和可编程增益放大模块2之后可以测量的信号就可以做到很小，使得压感传感器对范围在0~1.1 微米的形变量都可以检测到，且对应的电信号从uV级别到mV级别都可以被精确的采集到；另外，对于超出这个动态范围的信号，通过IDAC补偿电路能够以电流补偿的方式将原始压感传感器信号进行修正，从而使得待测量信号的范围被拉回到信号调理模块的正常工作区间,从而准确的还原压感传感器上所施加的力的大小。防水逻辑单元通过力的数值滤波算法、窗口滑动滤波算法、防水模型特征匹配算法对输入的信号进行算法处理后达到防水的效果，其中防水模型特征值匹配算法的输入因子包括：电容触摸的原始数据、压感对应的力的大小和用户通过寄存器输入的配置，针对5种不同的等效模型，防水模型的特征因子也各有不同，具体分析如下：在实施例中，对于水珠等效模型，电容触摸的变化是主要考虑的因素，水珠等效模型会引起电容触摸的变化，但是电容触摸变化比正常人体触摸引起的电容的变化要小很多，压感传感器的压力在这个模型中变化几乎为0。在实施例中，对于水幕等效模型，特征类似与水珠等效模型，不同之处在于多个电容触摸电极同时变化，可以从电容触摸电极对应的通道上看到一个电容触摸的变化，这个模型的压感传感器的压力变化几乎为0。在实施例中，对于冲水等效模型，跟洗车模式一样，在电容触摸和压感传感器压力两个方面都有变化，电容触摸的变化比水幕等效模型和水珠等效模型都大，但是仍然小于人体触摸引起的变化，压感传感器的压力会检测到力的存在，范围在1牛到10牛之间。在实施例中，对于暴雨等效模型，与冲水模式类似，但是存在一个方向上的特征不同，冲水是可以从四面八方几乎360度无死角的选择角度，而暴雨模式基本在垂直方向上下波动30度以内，通过多个触摸电极和压感传感器的被触发的先后时间特征，可以对暴雨模式进行准确的判断。在实施例中，对于淹水等效模型，用于模拟掉进水里之后，信号调理模块还需要能够正确的识别到淹水等效模型的场景，电容触摸始终维持在一个恒定的基准上，这个基准比没有水的情况下要高，压感传感器可以正常地检测用户的按压动作。在实施例中，使用纯触摸的传统方案防水测试只能达到IPX2的防水级别，通过使用本发明中的方法可以做到IPX5的防水级别，达到了车规级防水的要求。尽管参照前述实施例对本发明进行了详细的说明，对于本领域的技术人员来说，其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换,凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
