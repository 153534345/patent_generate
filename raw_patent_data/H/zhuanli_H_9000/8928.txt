标题title
一种APF控制系统的谐波提取及合成器
摘要abst
本发明涉及电力电子控制电路的数字信号处理技术领域和有源电力滤波器设计技术领域，具体涉及一种APF控制系统的谐波提取及合成器，通过提出一种APF控制系统的谐波提取及合成器，谐波提取及合成器包括递归离散傅立叶变换模块；递归离散傅立叶变换模块包括采样数据处理模块和旋转指数模块；采样数据处理模块将网侧电流的采集信号按时序存储为数据队列，计算第n次进入该数据队列的数据和滑出的数据的差值∆x，并将∆x输出给旋转指数模块。通过采用改进的主控算法，滑动离散傅立叶变换结合非迭代离散傅立叶变换完成谐波提取，增加了主控算法的鲁棒性和稳定性；同时基于准比例谐振控制实现了对指令电流各频率分量的协调控制。
权利要求书clms
1.一种APF控制系统的谐波提取及合成器，其特征在于，所述谐波提取及合成器包括递归离散傅立叶变换模块；所述递归离散傅立叶变换模块包括采样数据处理模块和旋转指数模块；所述采样数据处理模块将网侧电流的采样信号按时序存储为数据队列，计算第n次进入该数据队列的数据和滑出的数据的差值∆x，并将所述∆x输出给所述旋转指数模块。2.如权利要求1所述的谐波提取及合成器，其特征在于，所述旋转指数模块包括：时序控制子模块、各次谐波DFT数据存储子模块、DFT主要计算子模块、DFT反变换和相角补偿子模块；所述时序控制子模块接收所述采样数据处理模块的完成计算信号后，在五个连续的时钟周期内完成一次DFT数据计算，具体包括以下步骤：在第一时钟周期，所述时序控制子模块输出读取使能信号，所述DFT主要计算子模块从所述各次谐波DFT数据存储子模块中读取上一次计算的DFT数据；在第二时钟周期，所述时序控制子模块输出读取完毕通知信号，所述DFT主要计算子模块将所述上一次计算的DFT数据锁存；在第三和第四时钟周期，所述DFT主要计算模块完成一次DFT数据计算；在第五时钟周期，所述时序控制模块输出写入使能信号，所述DFT主要计算模块将该次计算的DFT数据写入各次谐波DFT数据存储子模块中，同时所述DFT反变换和相角补偿模块进行DFT反变换。3.如权利要求2所述的谐波提取及合成器，其特征在于，所述旋转指数模块还包括旋转因子选择子模块，所述旋转因子选择子模块包括一个1024字节数的正弦函数表和一个1024字节数的余弦函数表；所述旋转因子选择子模块计算并输出旋转因子，具体包括以下步骤：记录当前采样信号的时序N对1024的余Nmod1024；分别在所述正弦函数表和所述余弦函数表中查找所述Nmod1024对应的正弦值和余弦值，并分别输出为所述旋转因子经过欧拉公式展开后对应的正弦值和余弦值。4.如权利要求3所述的谐波提取及合成器，其特征在于，所述DFT主要计算子模块在每个频率单元内完成一次DFT数据计算；所述DFT数据计算包括SDFT计算，具体包括以下步骤：获取所述旋转因子，所述旋转因子包括欧拉公式展开后对应的正弦值和余弦值；获取当次计算的所述采样信号的差；将所述旋转因子与所述当次计算的所述采样信号的差作乘法，并与上一个频率单元计算得到的SDFT数据累加，得到当前频率单元的SDFT数据；将每个频率单元的SDFT数据输出，并保持至所述各次谐波DFT数据存储子模块。5.如权利要求4所述的谐波提取及合成器，其特征在于，所述DFT数据计算还包括非迭代DFT计算，具体包括以下步骤：获取所述旋转因子，所述旋转因子包括欧拉公式展开后对应的正弦值和余弦值；获取当前的采样信号；将所述旋转因子与所述采样信号作乘法，并与上一个频率单元计算得到的非迭代DFT数据累加，得到当前频率单元的非迭代DFT数据；将每个频率单元的非迭代DFT数据输出，并保持至所述各次谐波DFT数据存储子模块；每当经过一个采样周期后，将非迭代DFT数据赋值给所述SDFT数据，并将在所述各次谐波DFT数据存储子模块中存储的各次谐波的所有频率单元的非迭代DFT数据置零。6.如权利要求2所述的谐波提取及合成器，其特征在于，所述旋转指数模块还包括：比例谐振控制调节器子模块、比例谐振控制调节器数据存储子模块、谐波合成子模块；所述旋转指数模块被配置为实现包括以下步骤：在第六时钟周期内，所述时序控制子模块输出比例谐振控制读取使能信号，读取所述比例谐振控制调节器子模块的数据存储单元中的所述比例谐振控制调节器子模块计算的中间值；在第七时钟周期内，所述时序控制子模块输出所述比例谐振控制调节器子模块的数据存储单元的数据读取完毕的通知信号后，将所述中间值数据锁存；若干个时钟周期后，所述比例谐振控制调节器子模块输出基准信号至所述谐波合成子模块，并将计算结果写入所述比例谐振控制调节器子模块的数据存储单元。7.如权利要求6所述的谐波提取及合成器，其特征在于，所述比例谐振控制调节器子模块采用预修正的Tustin变换算法。8.如权利要求7所述的谐波提取及合成器，其特征在于，所述旋转因子被量化到Q15。9.如权利要求5所述的谐波提取及合成器，其特征在于，所述采样数据处理模块基于随机存取存储器实现包括以下步骤：将最新采样信号送入写地址Wr_Addr对应的存储单元中，并输出读地址Rd_Addr对应存储单元中的数据，所述读地址始终超前1位于所述写地址；每连续采1024个信号作为一个所述采样周期，在每个所述采样周期中：随机存取存储器每次输出的数据为上一个采样信号，最新采样信号减去上一个采样信号的差为δx；输出每次计算得到的所述δx的同时输出一次所述完成计算信号；对所述δx进行溢出校验。10.如权利要求5所述的谐波提取及合成器，其特征在于，所述各次谐波DFT数据存储子模块基于四个可读可写的双口随机存取存储器实现；其中，每个所述可读可写的双口随机存取存储器被配置为：每一个地址对应一个频率单元；第一可读可写的双口随机存取存储器用于存储SDFT计算中的所述旋转因子经过欧拉变换得到的旋转因子正弦值；第二可读可写的双口随机存取存储器用于存储SDFT计算中的所述旋转因子经过欧拉变换得到的旋转因子余弦值；第三可读可写的双口随机存取存储器用于存储非迭代DFT计算中的所述旋转因子经过欧拉变换得到的旋转因子正弦值；第四可读可写的双口随机存取存储器用于存储非迭代DFT计算中的所述旋转因子经过欧拉变换得到的旋转因子余弦值；每个所述可读可写的双口随机存取存储器至少设有20个存储单元。
说明书desc
技术领域本发明涉及电力电子控制电路的数字信号处理技术领域和有源电力滤波器设计技术领域，具体涉及一种APF控制系统的谐波提取及合成器。背景技术电力电子设备的广泛应用导致配电系统总的谐波干扰增加，非线性负载可以从交流电源中吸收电流的谐波和无功功率分量，还会导致三相系统的不平衡。有源电力滤波器通过注入与谐波电流反向的补偿电流，可以抑制谐波，同时补偿无功功率。目前常见的APF电流跟踪控制的响应速度较慢，当负载电流快速变化时，线电流受到动态失真的影响，这种影响导致线电流中的谐波含量增加，总谐波失真比例增加。发明内容针对以上技术问题，本发明提出的技术方案对三相并联有源电力滤波器的核心模块进行了改进设计。通过提出一种APF控制系统的谐波提取及合成器，所述谐波提取及合成器包括递归离散傅立叶变换模块；所述递归离散傅立叶变换模块包括采样数据处理模块和旋转指数模块；所述采样数据处理模块将网侧电流的采样信号按时序存储为数据队列，计算第n次进入该数据队列的数据和滑出的数据的差值∆x，并将所述∆x输出给所述旋转指数模块。进一步地，所述旋转指数模块包括：时序控制子模块、各次谐波DFT数据存储子模块、DFT主要计算子模块、DFT反变换和相角补偿子模块；所述旋转指数模块被配置为实现包括以下步骤：所述时序控制子模块接收所述采样数据处理模块的完成计算信号后，在五个连续的时钟周期内完成一次DFT数据计算。进一步地，所述DFT主要计算子模块在每个频率单元内完成一次DFT数据计算；所述DFT数据计算包括SDFT计算。进一步地，所述DFT数据计算还包括非迭代DFT计算。本发明提出的技术方案对三相并联有源电力滤波器的核心模块进行了改进设计，通过采用改进的主控算法，滑动离散傅立叶变换结合非迭代离散傅立叶变换完成谐波提取，增加了主控算法的鲁棒性和稳定性；同时基于准比例谐振控制实现了对指令电流各频率分量的协调控制。附图说明图1、一些实施方式的谐波提取及合成器结构示意图；图2、一些具体实施方式的DFT主要计算模块结构框图，其中各标识具体表示：Data_In:输入采样信号；Cal_Ready：完成计算信号；numaddress：当前的计算时刻点；Data_new：最新采样信号； Data_Sub：滑出的采样信号；K：当前DFT运算的谐波次数；Xk：K次谐波的DFT计算中的第n个数据； Xk：K次谐波的DFT计算中的第n-1个数据；K_1、K_20：第1次、第20次谐波；Fre_Sel：需补偿谐波的频率；X_Out：输出信号；Out_done：输出完成信号；Rd_En：SDFT数据存储RAM的读取使能信号；Wr_En：SDFT数据存储RAM的写入使能信号；Rd_Q：SDFT数据存储RAM数据读取完毕的通知信号；Rd_Add：SDFT数据存储RAM的数据读取地址；Wr_Add：SDFT数据存储RAM的数据写入地址；Xout_Q：给定次谐波DFT完成信号；PI_Rd：PR数据存储模块的读取使能信号；PI_Wr：PR数据存储模块的写入使能信号；PI_Q：PR数据存储模块数据读取完毕的通知信号；j：当计算的第k个谐波。图3、一些具体实施方式的SDFT实现方法流程图；图4、一些具体实施方式的时序控制模块的时序图，其中各标识具体表示：Clock_100M：频率100M的时钟信号；Cal_Ready：完成计算信号；Rd_En：SDFT数据存储RAM的读取使能信号；Rd_Q：SDFT数据存储RAM数据读取完毕的通知信号；Wr_En：SDFT数据存储RAM的写入使能信号；PI_Rd：PR数据存储模块的读取使能信号；PI_Wr：PR数据存储模块的写入使能信号；PI_Q：PR数据存储模块数据读取完毕的通知信号；Xout_Q：给定次谐波DFT完成信号。具体实施方式一些实施方式的APF控制系统，包括谐波提取及合成器，通过递归离散傅立叶变换模块加载SDFT主控算法程序用于产生各相电流的谐波基准，该模块包括采样数据处理模块和旋转指数模块，各模块具体的模块结构如图1；谐波提取及合成器包括递归离散傅立叶变换模块；递归离散傅立叶变换模块包括采样数据处理模块和旋转指数模块；采样数据处理模块将网侧电流的采样信号按时序存储为数据队列，计算第n次进入该数据队列的数据和滑出的数据的差值∆x，并将∆x输出给旋转指数模块。首先，对SDFT算法进一步说明。由傅立叶级数的定义可知，任何周期性非正弦信号都可以分解为若干个周期性正弦信号的叠加。负载电流为周期性的非标准正弦信号，通过傅立叶级数将其展开即可求出负载电流各次谐波分量。术语“队列”指任何一种只允许在表的前端进行删除操作，而在表的后端进行插入操作的线性表，在实施方式中作为滑动窗的数据结构。术语“旋转因子”指代傅立叶变换的傅立叶级数中每项所乘的复数常数，此常数在复数平面上位于单位圆之上，对于被乘数在复数平面上面会有旋转的效果，故名为旋转因子。需要说明的是，一些优选的实施方式的谐波提取及合成器基于FPGA实现，采用并行处理和流水线作业，具有逻辑单元灵活、集成度高及适用范围宽等优点，适合于采用傅立叶变换对误差信号的基波和各次谐波分量的分离。一些实施方式涉及的旋转指数模块主要包括：时序控制子模块、各次谐波DFT数据存储子模块、DFT主要计算子模块、DFT反变换和相角补偿子模块；各子模块在时序控制子模块的协调下完成包括以下的步骤：时序控制子模块接收完成计算信号后，在五个连续的时钟周期内完成一次DFT数据计算，具体包括以下步骤：在第一时钟周期，时序控制子模块输出读取使能信号，DFT主要计算子模块从各次谐波DFT数据存储子模块中读取上一次计算的DFT数据；在第二时钟周期，时序控制子模块输出读取完毕通知信号，DFT主要计算子模块将上一次计算的DFT数据锁存；在第三和第四时钟周期，DFT主要计算模块完成一次DFT数据计算；在第五时钟周期，时序控制模块输出写入使能信号，DFT主要计算模块将该次计算的DFT数据写入各次谐波DFT数据存储子模块中，同时DFT反变换和相角补偿模块进行DFT反变换。一些实施方式的旋转指数模块还包括旋转因子选择子模块，旋转因子选择子模块包括一个1024字节数的正弦函数表和一个1024字节数的余弦函数表；旋转因子选择子模块计算并输出旋转因子，具体包括以下步骤：记录当前采样信号的时序N对1024的余Nmod1024；分别在正弦函数表和余弦函数表中查找Nmod1024对应的正弦值和余弦值，并分别输出为旋转因子经过欧拉公式展开后对应的正弦值和余弦值。一些实施方式涉及的DFT主要计算子模块在每个频率单元内完成一次DFT数据计算；DFT数据计算包括SDFT计算，具体包括以下步骤：获取旋转因子，旋转因子包括欧拉公式展开后对应的正弦值和余弦值；获取当次计算的采样信号的差；将旋转因子与当次计算的采样信号的差作乘法，并与上一个频率单元计算得到的SDFT数据累加，得到当前频率单元的SDFT数据；将每个频率单元的SDFT数据输出，并保持至各次谐波DFT数据存储子模块。在每个频率单元中完成一次DFT计算过程。旋转因子由旋转因子选择模块通过欧拉公式将复数因子展开为三角函数形式输出，优选地，将正弦值和余弦值分别以数据队列存储。滑动窗离散傅立叶变换迭代计算公式为式I：其中，为旋转因子，x为第n次网侧电流的采样信号，Xk为第n次计算的DFT数据，k表示对应的谐波次数。一些实施方式的谐波提取及合成器，DFT主要计算模块加载的计算还包括非迭代DFT计算，具体包括以下步骤：获取旋转因子，旋转因子包括欧拉公式展开后对应的正弦值和余弦值；获取当前的采样信号x；将旋转因子与x作乘法，并与上一个频率单元计算得到的非迭代DFT数据累加，得到当前频率单元的非迭代DFT数据；将每个频率单元的非迭代DFT数据输出，并保持至各次谐波DFT数据存储子模块；每当经过一个采样周期后，将非迭代DFT数据赋值给SDFT数据，并将在各次谐波DFT数据存储子模块中存储的各次谐波的所有频率单元的非迭代DFT数据置零。需要说明的是，如果DFT计算单用SDFT方法，容易产生不稳定问题，因此增加交互更新步骤，经过了一个采样周期后，将非迭代DFT计算的频率单元的值更新给DFT相应的频率单元值，并且置零非迭代DFT的各次谐波的频率单元的值。一些实施方式，在DFT主要计算子模块中，SDFT计算和非迭代DFT计算中的累加计算共用一个计算器。一些实施方式涉及的旋转指数模块还包括：比例谐振控制调节器子模块、比例谐振控制调节器数据存储子模块、谐波合成子模块；旋转指数模块被配置为实现包括以下步骤：在第六时钟周期内，时序控制子模块输出比例谐振控制读取使能信号，读取比例谐振控制调节器子模块的数据存储单元中的比例谐振控制调节器子模块计算的中间值；在第七时钟周期内，时序控制子模块输出比例谐振控制调节器子模块的数据存储单元的数据读取完毕的通知信号后，将中间值数据锁存；若干个时钟周期后，比例谐振控制调节器子模块输出基准信号至谐波合成子模块，并将计算结果写入比例谐振控制调节器子模块的数据存储单元。一些实施方式的比例谐振控制调节器子模块采用预修正的Tustin变换算法。对控制系统的离散化实际就是对PR的离散化，可采用Tustin变换。但一般Tustin变换的高频特性失真严重，不适合谐振频率较高的PR。为保证在控制器频率域s域和z域的线性关系可采用频率预修正的Tustin变换算法。术语“比例谐振控制调节器”由比例环节和谐振环节组成，可以对正弦量实现无静差控制，PR中的积分环节又被成为广义积分器，可以对谐振频率的正弦量实现幅值积分。优选地，所有旋转因子都是量化到Q15，乘法计算的时候，首先是16bit和16bit相乘，然后取高16bit，即除以216，后又将计算结果扩大2倍。需要说明的是，Q15表示小数部分有15位，一个short型数据，占2个字节，最高位是符号位，后面15位是小数位，就假设小数点在第15位左边，表示的范围是：-1＜X＜0.9999695；浮点数据转化为Q15，将数据乘以215；Q15数据转化为浮点数据，将数据除以215。一些基于FPGA实现的实施方式中，由于主流FPGA不能实现浮点数运算，为实现准R控制的高精度数字离散化，需要对差分方程的系数进行量化处理，并对量化后的差分方程进行浮点数运算。一些实施方式，采样数据处理模块基于随机存取存储器实现包括以下步骤：将最新采样信号送入写地址Wr_Addr对应的存储单元中，并输出读地址Rd_Addr对应存储单元中的数据，读地址始终超前1位于写地址；每连续采1024个信号作为一个采样周期，在每个采样周期中：随机存取存储器每次输出的数据为上一个采样信号，用最新采样信号减去上一个采样信号的差为δx；输出每次计算得到的δx，同时输出完成计算信号；对δx进行溢出校验。随机存取存储器实现数据队列的存储。一些实施方式的各次谐波DFT数据存储模块基于四个可读可写的双口随机存取存储器实现；其中，每个可读可写的双口随机存取存储器被配置为：每一个地址对应一个频率单元；第一可读可写的双口随机存取存储器用于存储SDFT计算中的旋转因子经过欧拉变换得到的旋转因子正弦值；第二可读可写的双口随机存取存储器用于存储SDFT计算中的旋转因子经过欧拉变换得到的旋转因子余弦值；第三可读可写的双口随机存取存储器用于存储非迭代DFT计算中的旋转因子经过欧拉变换得到的旋转因子正弦值；第四可读可写的双口随机存取存储器用于存储非迭代DFT计算中的旋转因子经过欧拉变换得到的旋转因子余弦值；每个可读可写的双口随机存取存储器至少设有20个存储单元，为了方便后期扩展，每个可读可写的双口随机存取存储器被配置为设有25个存储单元。下面用更具体的实施方式详细解释本发明。这些实施方式用到了3个相同的谐波提 取与合成模块，分别对应于ABC三相，这里仅以A相为例进行说明。该模块包含若干子模块，功能详见表1：表1.子模块功能以上子模块中的核心模块为DFT主要计算模块，谐波选择补偿模块中K_1～K_20表示的是 选择补偿的20种谐波，将需补偿的谐波次数分别记录在变量K_1～K_20中，需补偿的谐波 种类总数记录在变量Sel_K中。1. SDFT采样控制模块该模块实质是一个脉冲匹配。控制SDFT运算一次的脉冲通知信号是一个宽度为1/100Ms的窄脉冲，但是外部输入的通知信号，宽度可能大于1/100Ms，所以为了避免重复运算，需要进行脉宽匹配。在第一次检测到DFT开始运算信号之后，延时3个时钟，再检测下一次开始信号。2. DFT主要计算模块该模块内包含了两个大模块，实现了三个功能，提取出网侧电流谐波，经PR做闭环调节，合成谐波电流基准。提取出各次谐波之后，作为各次谐波PR的输入，各次PR的输出就是各次谐波的最终谐波电流基准。该模块的结构如图2。需要注意的是，SDFT的实际计算比较灵活，方法多样，上式是在一些实施方式中用到的公式。计算过程包括如图3所示的三个步骤。步骤1的原理为，建立一个1025字节的16位RAM，将最新采样得到的数据送入写地址Wr_Addr对应的存储单元中，并输出读地址Rd_Addr对应存储单元中的数，读地址始终超前1位于写地址，采样1024个数据后，即一周期后，RAM每次输出的值便为上一采样时刻的采样数据，将最新采样得到的数据减去RAM中读取出来的值便得到Δx的值，为了防止数据发生溢出而进行错误的计算，在得到Δx计算结果后加入了一个出错检测模块，若计算结果溢出，则输出16'h4000，否则正常输出。Data_Sub就是新滑进来的采样数据和滑出去的数据之差。图3的步骤2和3的是在旋转指数模块组中实现的。3. 旋转指数模块旋转指数模块中包含了8个子模块，分别为时序控制模块、旋转因子选择模块、各次谐波DFT数据存储模块、DFT主要计算模块、DFT反变换和相角补偿模块、PR模块、PR数据存储模块、谐波合成模块。其中时序控制模块协调各模块之间工作的时序，旋转因子选择模块、各次谐波DFT数据存储模块、DFT主要计算模块实现了SDFT的谐波提取功能，DFT反变换模块、PR模块、PR数据存储模块实现了PR的功能，谐波合成模块对提取出的各次谐波进行合成，各功能模块所实现的功能详见表2。表2. 旋转指数模块组中各模块实现的功能3.1 时序控制模块 主要是用来协调各模块间的工作时序，该模块的输入数据为完成计算DFT新旧采样数据之差的Ready信号以及选择补偿的各次谐波次数，输出信号的相关作用如表3所示，各输出信号间的时序如图4所示。表3. 时序控制模块输出信号含义当外部新旧采样数据准备好后，便开始进行SDFT计算的如图3所示的步骤2和步骤3，下一个时钟周期给出了SDFT数据存储RAM的使能信号，读出上一时刻计算的数据值，Rd_Q随后产生一个时钟的高电平信号，将DFT主要计算模块的RAM中读出的数据锁存，经过两个时钟后，将新计算完成的各次谐波的幅值，存入SDFT数据存储RAM中，同时进行DFT反变换，网侧电流的各次谐波提取完成之后，开始PR运算，先给出PR数据存储模块的读取使能信号，各次谐波PR运算的中间值，PI_Q将读出的数据锁存，4个周期后PR计算完毕，将出来的基准信号送入谐波合成模块，并将最新计算出的PR的中间值数据写入PRRAM中。3.2 旋转因子选择模块旋转因子选择模块用于存储SDFT模块的旋转因子经欧拉公式展开后得到的正弦函数值sin和余弦函数值cos，其中旋转因子的展开公式为： 时序控制模块给出当前要计算的第k次谐波，采样数据处理模块输出当前的计算时刻点为numaddress，这个信号就相当于公式中的n，便得到了旋转因子Rotation_address即，用Rotation_address作为欧拉公式展开后sin和cos值的存储地址，由于三角函数的周期性，一个采样周期的采样次数为1024，因此三角函数查找表的大小可定位1024字节，取Rotation_address的低10位数据作为三角函数查找表的查找地址。 3.3 DFT主要计算模块单用SDFT的计算结果，容易产生不稳定，因此这个模块中还增加了非迭代DFT模块。公式为：其中k取值范围从0至N-1，x表示新进来的采样数据，是旋转因子，其和SDFT计算的旋转因子为同一个旋转因子，X为第k次计算的非迭代DFT计算值，N为1024。 完成一个采样周期的1024个点后，用非迭代DFT计算的频率单元值，更新SDFT相应的频率单元值，同时非迭代DFT的频率单元的值清零，重新开始新一周期的计算，该模块包括两个子模块：DFT_Cal和Cal_Recursive模块。其中DFT_Cal模块用于完成SDFT计算的如图3的步骤2的计算，非迭代DFT计算中的对应的步骤2也在DFT_Cal模块实现，Cal_Recursive模块实现将计算出的当前SDFT计算值和当前非迭代DFT计算值分别与上一次的SDFT计算值和非迭代DFT计算值累加，即完成步骤3对应的计算。DFT_Cal模块中Rotation_Sin和Rotation_Cos由旋转因子选择模块输入，Data_new和Data_Sub由采样数据处理模块输入；Cal_Recursive模块的输出结果送入到各次谐波DFT数据存储模块中。3.4 各次谐波DFT数据存储模块由SDFT的计算公式可知，计算当前时刻的DFT时需要用到上一时刻该次谐波的DFT值，因此需要用存储空间来存储上一时刻计算出来的DFT数据，用作下一次SDFT计算时的迭代数据。非迭代DFT计算也需要存储上一次的值。所以共有两类数据，四种数据，所以需要四个可读可写的双口RAM。RAM中，从地址1开始，一个地址对应一个频率单元，最多同时有20个频率单元，所以需要至少20个存储单元，为方便后续扩展，优选25个存储单元。 3.5 反变换模块反变换模块中包含了两个功能，前半部分模块为DFT反变换，后半部分是加上各次谐波的相位补偿，给各次谐波加上相位补偿的原因是实际过程中补偿的谐波会由于采样、计算上存在延时。3.6 PR模块PR参数共有5组，分别对应下式的A0，A1，A2，B1，B2。G是由PR离散得来，采用的方法是预修正的Tustin变换算法，如下式所示，实际计算过程中发现，离散后，PR对上述系数A0，A1，A2，B1，B2的要求精度都非常高，因此程序中在计算PR调节参数时，都先将上述系数扩大了220倍，在最后的数据输出时再用将220除掉。由式2.6可得当前PR的输出数据的迭代公式为：y＝A0x+A1x+A2x-B1y-B2y各次谐波的系数通过Matlab软件计算得出，Matlab中有自带的将S域转换成Z域的预修正 的Tustin变换算法，将Matlab计算得到的各次谐波对应的系数存入到Grid_PR_Index模块 中，需要注意的是，不同次数的谐波对应的PR的传递函数中的参数并非一样，他们的取值 是根据实际调试过程中的系统稳定性以及补偿效果而给定的，Grid_Current_PR_Re模块输入 数据为Grid_PR_Index模块产生的系数A0，A1，A2，B1，B2，PR数据存储模块提供的前两 个时刻计算出的数值x，x，y，y以及IDFT模块输出的当前谐波次数对应 的幅值，从而计算出当前PR的输出数据。3.7 PR数据存储模块由PR离散后的计算公式可知，计算当前时刻的DFT数据时需要用到前两个时刻的输入信号以及PR的输出信号，因此这里用到了4个RAM存储器RE_DFT_PR_Dual_RAM来存储Grid_Current_PR_Re模块的输入信号。存储的数据位数是45bit，是Q20的数据。3.8 谐波合成模块该模块用于合成所需补偿的各次谐波电流量，产生补偿电流基准信号送到从板，当PR数据计算完毕后，时序控制模块中产生的Xout_Q将产生一个时钟长度的高电平信号，通知谐波合成模块加上该次谐波的电流幅值信号PR_Out，当检测到当前已完成计算的需补偿谐波个数j小于输入的需补偿谐波种类的总数Sel_K时，将PR输出的电流基准信号不断累加；当检测到当前已完成计算的需补偿谐波个数j等于输入的需补偿谐波种类的总数Sel_K时，下一个时钟周期时产生谐波合成完毕信号，将谐波电流基准合成信号输出。 4. 输出数据转换模块主板网侧电流闭环的PR当前的参数和从板谐波电流基准跟踪的PI调节器的相关参数都是默认，网侧电流的电流互感器的匝比是600:5。当外部的电流互感器的匝比发生变化时，PR的参数也应该同比例的变化。输出数据转换模块将谐波电流提取及合成模块输出的谐波电流基准，进行相应的处理。实现时，将PR输出的谐波电流基准进行相应的比例变化。ABC三相谐波电流基准分时共用了该数据转换模块。一些优选的实施方式，为避免开始补偿时补偿谐波的次数较多和APF系统刚开始闭环时，PR饱和而产生电流尖峰和触发过流保护，还设置了SDFT缓起模块。该模块只有在从板的三相直流侧电压稳定之后，也即APF成功并网并且直流侧电压PFC稳定之后，才起作用。若实际补偿谐波种类数为Sel_KK次，Sel_KK每隔100ms加一次，即每隔100ms相比原先补偿电流，多补偿一次谐波，直到达到所需补偿的谐波种类的总数。本说明书中描述的主题的实施方式和功能性操作可以在以下中实施：数字电子电路，有形实施的计算机软件或者固件，计算机硬件，包括本说明书中公开的结构及其结构等同体，或者上述中的一者以上的组合。本说明书中描述的主题的实施方式可以被实施为一个或多个计算机程序，即，一个或多个有形非暂时性程序载体上编码的计算机程序指令的一个或多个模块，用以被数据处理设备执行或者控制数据处理设备的操作。在本说明书中描述的处理和逻辑流程可以由一个或多个可编程计算机执行，该计算机通过运算输入数据并且生成输出而执行一个或多个的计算机程序，以运行函数。在本说明书中描述的处理和逻辑流程还可以由专用逻辑电路例如ASIC执行，并且设备也可以被实施为专用逻辑电路。虽然本说明书包含很多具体的实施细节，但是这些不应当被解释为对任何发明的范围或者对可以要求保护的内容的范围的限制，而是作为可以使特定发明的特定实施方式具体化的特征的说明。在独立的实施方式的语境中的本说明书中描述的特定特征还可以与单个实施方式组合地实施。相反地，在单个实施方式的语境中描述的各种特征还可以独立地在多个实施方式中实施，或者在任何合适的子组合中实施。此外，虽然以上可以将特征描述为组合作用并且甚至最初这样要求，但是来自要求的组合的一个或多个特征在一些情况下可以从该组合去掉，并且要求的组合可以转向子组合或者子组合的变形。在特定情况下，多任务处理和并行处理可以是有利的。此外，上述实施方式中的各种系统模块和组件的分离不应当理解为在所有实施方式中要求这样的分离。已经描述了主题的特定实施方式。其他实施方式在以下权利要求的范围内。例如，在权利要求中记载的活动可以以不同的顺序执行并且仍旧实现期望的结果。作为一个实例，为了实现期望的结果，附图中描述的处理不必须要求示出的特定顺序或者顺序次序。在特定实现中，多任务处理和并行处理可以是有优势的。
