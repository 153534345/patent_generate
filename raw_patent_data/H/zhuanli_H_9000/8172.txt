标题title
针对通信服务质量的流量控制方法、系统及相关设备
摘要abst
本发明公开了针对通信服务质量的流量控制方法、系统及相关设备，其中，上述方法包括：获取待处理报文；基于预先设置的双速双桶流量评估算法获取上述待处理报文的颜色标记；对上述待处理报文进行解析以获取上述待处理报文对应的流量类型，根据上述流量类型获取上述待处理报文的流量类型优先级；根据上述颜色标记和上述流量类型优先级获取上述待处理报文的区分服务优先值；根据上述区分服务优先值对上述待处理报文进行转发控制。与现有技术相比，本发明方案有利于提高流量控制的精细度和效果。
权利要求书clms
1.一种针对通信服务质量的流量控制方法，其特征在于，所述针对通信服务质量的流量控制方法包括：获取待处理报文；基于预先设置的双速双桶流量评估算法获取所述待处理报文的颜色标记；对所述待处理报文进行解析以获取所述待处理报文对应的流量类型，根据所述流量类型获取所述待处理报文的流量类型优先级；根据所述颜色标记和所述流量类型优先级获取所述待处理报文的区分服务优先值；根据所述区分服务优先值对所述待处理报文进行转发控制。2.根据权利要求1所述的针对通信服务质量的流量控制方法，其特征在于，所述获取待处理报文，包括：根据预设交换机的输入端口获取所述待处理报文。3.根据权利要求1所述的针对通信服务质量的流量控制方法，其特征在于，所述获取待处理报文，包括：根据预设交换机的输出端口获取所述待处理报文。4.根据权利要求2或3所述的针对通信服务质量的流量控制方法，其特征在于，所述基于预先设置的双速双桶流量评估算法获取所述待处理报文的颜色标记，包括：根据所述待处理报文的报文字节值和所述预先设置的双速双桶流量评估算法，通过所述预设交换机中数据平面的计量器获取所述待处理报文的颜色标记，其中，所述报文字节值大于P桶令牌数时所述待处理报文的颜色标记为红色，所述报文字节值不大于所述P桶令牌数且所述报文字节值大于C桶令牌数时所述待处理报文的颜色标记为黄色，所述报文字节值不大于所述C桶令牌数时所述待处理报文的颜色标记为绿色。5.根据权利要求4所述的针对通信服务质量的流量控制方法，其特征在于，所述对所述待处理报文进行解析以获取所述待处理报文对应的流量类型，根据所述流量类型获取所述待处理报文的流量类型优先级，包括：对所述待处理报文进行解析并获取所述待处理报文中的目标字段；根据所述待处理报文中的目标字段，通过所述预设交换机对应的控制平面中的控制器基于区分服务模型获取所述待处理报文对应的流量类型；根据所述流量类型获取所述待处理报文的流量类型优先级。6.根据权利要求5所述的针对通信服务质量的流量控制方法，其特征在于，所述目标字段包括IP地址、tcp流量、udp流量、端口号中的至少一种。7.根据权利要求5所述的流量控制方法，其特征在于，所述预设交换机为P4交换机，所述数据平面和所述控制平面基于软件定义网络分离。8.根据权利要求5所述的针对通信服务质量的流量控制方法，其特征在于，所述根据所述流量类型获取所述待处理报文的流量类型优先级，包括：当所述流量类型为不丢包类型时，将所述待处理报文的流量类型优先级设置为最高优先级；当所述流量类型为部分丢包类型时，将所述待处理报文的流量类型优先级设置为中高优先级；当所述流量类型为可丢包重传类型时，将所述待处理报文的流量类型优先级设置为低优先级。9.根据权利要求8所述的针对通信服务质量的流量控制方法，其特征在于，所述根据所述颜色标记和所述流量类型优先级获取所述待处理报文的区分服务优先值，包括：当所述流量类型优先级是最高优先级时，将所述区分服务优先值设置为预设最高优先值；当所述流量类型优先级不是最高优先级时，根据所述流量类型优先级确定所述待处理报文的区分服务优先值区间，并在所述区分服务优先值区间中根据所述颜色标记确定所述待处理报文对应的区分服务优先值，其中，在一个所述区分服务优先值区间中，第一颜色报文的区分服务优先值对应的服务等级高于第二颜色报文，所述第二颜色报文的区分服务优先值对应的服务等级高于第三颜色报文，所述第一颜色报文是颜色标记为绿色的待处理报文，所述第二颜色报文是颜色标记为黄色的待处理报文，所述第三颜色报文是颜色标记为红色的待处理报文。10.根据权利要求9所述的针对通信服务质量的流量控制方法，其特征在于，所述根据所述区分服务优先值对所述待处理报文进行转发控制，包括：根据所述区分服务优先值确定所述待处理报文对应的转发队列，其中，各所述转发队列中包括多个待处理报文，同一转发队列中区分服务优先值对应的服务等级低的待处理报文排在区分服务优先值对应的服务等级高的待处理报文之后；在各所述转发队列中基于所述服务等级对各所述待处理报文依次进行转发控制。11.根据权利要求10所述的针对通信服务质量的流量控制方法，其特征在于，区分服务优先值是所述预设最高优先值的待处理报文对应的转发队列为不丢包队列，所述在各所述转发队列中基于所述服务等级对各所述待处理报文依次进行转发控制，包括：对所述不丢包队列中的所有待处理报文基于所述服务等级依次进行转发；对可丢包队列中未超出队列长度的待处理报文基于所述服务等级依次进行转发，对超出所述队列长度的待处理报文进行队尾丢弃，其中，所述可丢包队列是除所述不丢包队列以外的转发队列。12.一种针对通信服务质量的流量控制系统，其特征在于，所述针对通信服务质量的流量控制系统包括：待处理报文获取模块，用于获取待处理报文；颜色标记获取模块，用于基于预先设置的双速双桶流量评估算法获取所述待处理报文的颜色标记；流量类型优先级获取模块，用于对所述待处理报文进行解析以获取所述待处理报文对应的流量类型，根据所述流量类型获取所述待处理报文的流量类型优先级；区分服务优先值获取模块，用于根据所述颜色标记和所述流量类型优先级获取所述待处理报文的区分服务优先值；转发控制模块，用于根据所述区分服务优先值对所述待处理报文进行转发控制。13.一种智能终端，其特征在于，所述智能终端包括存储器、处理器以及存储在所述存储器上并可在所述处理器上运行的针对通信服务质量的流量控制程序，所述针对通信服务质量的流量控制程序被所述处理器执行时实现如权利要求1-11任意一项所述针对通信服务质量的流量控制方法的步骤。14.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质上存储有针对通信服务质量的流量控制程序，所述针对通信服务质量的流量控制程序被处理器执行时实现如权利要求1-11任意一项所述针对通信服务质量的流量控制方法的步骤。
说明书desc
技术领域本发明涉及通信过程中的流量控制技术领域，尤其涉及的是一种针对通信服务质量的流量控制方法、系统及相关设备。背景技术随着科学技术的发展，通信过程中的流量控制越来越受到重视。在目前的网络环境下，通常需要同时处理不同服务要求的大量数据流，对于网络的服务质量就提出了更高的要求。现有技术中，通常在可能有流量进入的不同端口分别设置各个端口对应的特定规则，对于各个端口，针对该端口对应的特定规则来为进入该端口的数据报文设置优先级。例如，进入相同端口的数据报文优先级相同，进入不同端口的数据报文优先级不同。现有技术的问题在于，仅通过设置在流量入端口的特定规则来设置数据报文的优先级，对于同一端口的数据报文都只能设置相同的优先级，无法对同一端口的不同数据报文进行更精细的优先级区分和控制，不利于提高流量控制的精细度和效果。因此，现有技术还有待改进和发展。发明内容本发明的主要目的在于提供一种针对通信服务质量的流量控制方法、系统及相关设备，旨在解决现有技术中仅通过设置在流量入端口的特定规则来设置数据报文的优先级，对于同一端口的数据报文都只能设置相同的优先级，无法对同一端口的不同数据报文进行更精细的优先级区分和控制，不利于提高流量控制的精细度和效果的问题。为了实现上述目的，本发明第一方面提供一种针对通信服务质量的流量控制方法，其中，上述针对通信服务质量的流量控制方法包括：获取待处理报文；基于预先设置的双速双桶流量评估算法获取上述待处理报文的颜色标记；对上述待处理报文进行解析以获取上述待处理报文对应的流量类型，根据上述流量类型获取上述待处理报文的流量类型优先级；根据上述颜色标记和上述流量类型优先级获取上述待处理报文的区分服务优先值；根据上述区分服务优先值对上述待处理报文进行转发控制。可选的，上述获取待处理报文，包括：根据预设交换机的输入端口获取上述待处理报文。可选的，上述获取待处理报文，包括：根据预设交换机的输出端口获取上述待处理报文。可选的，上述基于预先设置的双速双桶流量评估算法获取上述待处理报文的颜色标记，包括：根据上述待处理报文的报文字节值和上述预先设置的双速双桶流量评估算法，通过上述预设交换机中数据平面的计量器获取上述待处理报文的颜色标记，其中，上述报文字节值大于P桶令牌数时上述待处理报文的颜色标记为红色，上述报文字节值不大于上述P桶令牌数且上述报文字节值大于C桶令牌数时上述待处理报文的颜色标记为黄色，上述报文字节值不大于上述C桶令牌数时上述待处理报文的颜色标记为绿色。可选的，上述对上述待处理报文进行解析以获取上述待处理报文对应的流量类型，根据上述流量类型获取上述待处理报文的流量类型优先级，包括：对上述待处理报文进行解析并获取上述待处理报文中的目标字段；根据上述待处理报文中的目标字段，通过上述预设交换机对应的控制平面中的控制器基于区分服务模型获取上述待处理报文对应的流量类型；根据上述流量类型获取上述待处理报文的流量类型优先级。可选的，上述目标字段包括IP地址、tcp流量、udp流量、端口号中的至少一种。可选的，上述预设交换机为P4交换机，上述数据平面和上述控制平面基于软件定义网络分离。可选的，上述根据上述流量类型获取上述待处理报文的流量类型优先级，包括：当上述流量类型为不丢包类型时，将上述待处理报文的流量类型优先级设置为最高优先级；当上述流量类型为部分丢包类型时，将上述待处理报文的流量类型优先级设置为中高优先级；当上述流量类型为可丢包重传类型时，将上述待处理报文的流量类型优先级设置为低优先级。可选的，上述根据上述颜色标记和上述流量类型优先级获取上述待处理报文的区分服务优先值，包括：当上述流量类型优先级是最高优先级时，将上述区分服务优先值设置为预设最高优先值；当上述流量类型优先级不是最高优先级时，根据上述流量类型优先级确定上述待处理报文的区分服务优先值区间，并在上述区分服务优先值区间中根据上述颜色标记确定上述待处理报文对应的区分服务优先值，其中，在一个上述区分服务优先值区间中，第一颜色报文的区分服务优先值对应的服务等级高于第二颜色报文，上述第二颜色报文的区分服务优先值对应的服务等级高于第三颜色报文，上述第一颜色报文是颜色标记为绿色的待处理报文，上述第二颜色报文是颜色标记为黄色的待处理报文，上述第三颜色报文是颜色标记为红色的待处理报文。可选的，上述根据上述区分服务优先值对上述待处理报文进行转发控制，包括：根据上述区分服务优先值确定上述待处理报文对应的转发队列，其中，各上述转发队列中包括多个待处理报文，同一转发队列中区分服务优先值对应的服务等级低的待处理报文排在区分服务优先值对应的服务等级高的待处理报文之后；在各上述转发队列中基于上述服务等级对各上述待处理报文依次进行转发控制。可选的，区分服务优先值是上述预设最高优先值的待处理报文对应的转发队列为不丢包队列，上述在各上述转发队列中基于上述服务等级对各上述待处理报文依次进行转发控制，包括：对上述不丢包队列中的所有待处理报文基于上述服务等级依次进行转发；对可丢包队列中未超出队列长度的待处理报文基于上述服务等级依次进行转发，对超出上述队列长度的待处理报文进行队尾丢弃，其中，上述可丢包队列是除上述不丢包队列以外的转发队列。本发明第二方面提供一种针对通信服务质量的流量控制系统，其中，上述针对通信服务质量的流量控制系统包括：待处理报文获取模块，用于获取待处理报文；颜色标记获取模块，用于基于预先设置的双速双桶流量评估算法获取上述待处理报文的颜色标记；流量类型优先级获取模块，用于对上述待处理报文进行解析以获取上述待处理报文对应的流量类型，根据上述流量类型获取上述待处理报文的流量类型优先级；区分服务优先值获取模块，用于根据上述颜色标记和上述流量类型优先级获取上述待处理报文的区分服务优先值；转发控制模块，用于根据上述区分服务优先值对上述待处理报文进行转发控制。本发明第三方面提供一种智能终端，上述智能终端包括存储器、处理器以及存储在上述存储器上并可在上述处理器上运行的针对通信服务质量的流量控制程序，上述针对通信服务质量的流量控制程序被上述处理器执行时实现任意一项上述针对通信服务质量的流量控制方法的步骤。本发明第四方面提供一种计算机可读存储介质，上述计算机可读存储介质上存储有针对通信服务质量的流量控制程序，上述针对通信服务质量的流量控制程序被处理器执行时实现任意一项上述针对通信服务质量的流量控制方法的步骤。由上可见，本发明方案中，获取待处理报文；基于预先设置的双速双桶流量评估算法获取上述待处理报文的颜色标记；对上述待处理报文进行解析以获取上述待处理报文对应的流量类型，根据上述流量类型获取上述待处理报文的流量类型优先级；根据上述颜色标记和上述流量类型优先级获取上述待处理报文的区分服务优先值；根据上述区分服务优先值对上述待处理报文进行转发控制。与现有技术相比，本发明方案中不是为进入同一个端口的所有数据报文都设置相同的优先级，而是针对具体的待处理报文，基于其实际特点确定对应的区分服务优先值，并且根据区分服务优先值来进行流量控制。具体的，先根据双速双桶流量评估算法确定待处理报文的颜色标记，并对待处理报文进行解析确定其流量类型，根据流量类型确定其流量类型优先级，然后结合颜色标记和流量类型优先级确定待处理报文的区分服务优先值。如此，即使是同一个端口处的不同待处理报文，也不会被直接设置成相同的区分服务优先值，而是根据不同待处理报文的实际情况进行设置从而进行流量控制。有利于对各个端口处的待处理报文进行更精细的优先级区分和控制，有利于提高流量控制的精细度和效果。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其它的附图。图1是本发明实施例提供的一种针对通信服务质量的流量控制方法的流程示意图；图2是本发明实施例提供的一种双速双桶流量评估算法的流程示意图；图3是本发明实施例提供的一种IP包头格式示意图；图4是本发明实施例提供的一种进行流量控制的具体流程示意图；图5是本发明实施例提供的一种针对通信服务质量的流量控制系统的组成模块示意图；图6是本发明实施例提供的一种智能终端的内部结构原理框图。具体实施方式以下描述中，为了说明而不是为了限定，提出了诸如特定系统结构、技术之类的具体细节，以便透彻理解本发明实施例。然而，本领域的技术人员应当清楚，在没有这些具体细节的其它实施例中也可以实现本发明。在其它情况下，省略对众所周知的系统、装置、电路以及方法的详细说明，以免不必要的细节妨碍本发明的描述。应当理解，当在本说明书和所附权利要求书中使用时，术语“包括”指示所描述特征、整体、步骤、操作、元素和/或组件的存在，但并不排除一个或多个其它特征、整体、步骤、操作、元素、组件和/或其集合的存在或添加。还应当理解，在本发明说明书中所使用的术语仅仅是出于描述特定实施例的目的而并不意在限制本发明。如在本发明说明书和所附权利要求书中所使用的那样，除非上下文清楚地指明其它情况，否则单数形式的“一”、“一个”及“该”意在包括复数形式。还应当进一步理解，在本发明说明书和所附权利要求书中使用的术语“和/或”是指相关联列出的项中的一个或多个的任何组合以及所有可能组合，并且包括这些组合。如在本说明书和所附权利要求书中所使用的那样，术语“如果”可以依据上下文被解释为“当…时”或“一旦”或“响应于确定”或“响应于分类到”。类似的，短语“如果确定”或“如果分类到”可以依据上下文被解释为意指“一旦确定”或“响应于确定”或“一旦分类到”或“响应于分类到”。下面结合本发明实施例的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明的一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其它实施例，都属于本发明保护的范围。在下面的描述中阐述了很多具体细节以便于充分理解本发明，但是本发明还可以采用其它不同于在此描述的其它方式来实施，本领域技术人员可以在不违背本发明内涵的情况下做类似推广，因此本发明不受下面公开的具体实施例的限制。随着科学技术的发展，通信过程中的流量控制越来越受到重视。在目前的网络环境下，通常需要同时处理不同服务要求的大量数据流，对于IP网络的服务质量就提出了更高的要求。现有技术中，通常在可能有流量进入的不同端口分别设置各个端口对应的特定规则，对于各个端口，针对该端口对应的特定规则来为进入该端口的数据报文设置优先级。例如，进入相同端口的数据报文优先级相同，进入不同端口的数据报文优先级不同。现有技术的问题在于，仅通过设置在流量入端口的特定规则来设置数据报文的优先级，对于同一端口的数据报文都只能设置相同的优先级，无法对同一端口的不同数据报文进行更精细的优先级区分和控制，不利于提高流量控制的精细度和效果。具体的，基于现有技术需要在设备上配置多种特定的规则来确定数据流的优先级，即需要设置大量规则，因此需要消耗大量的内存和开销。若流量类型多还需要手动配置多条规则进行处理，管理配置工作也较为繁琐。同时，传统网络基于DiffServ服务模型对业务流的分类不够细化，通常配置在某个流量入端口上，无法很好地对进入同一入端口的不同业务流量进行分类和标记优先级。基于DiffServ服务模型的服务质量在实现端到端的服务需要大量网络元素协同合作。为了解决上述多个问题中的至少一个问题，本发明方案中，获取待处理报文；基于预先设置的双速双桶流量评估算法获取上述待处理报文的颜色标记；对上述待处理报文进行解析以获取上述待处理报文对应的流量类型，根据上述流量类型获取上述待处理报文的流量类型优先级；根据上述颜色标记和上述流量类型优先级获取上述待处理报文的区分服务优先值；根据上述区分服务优先值对上述待处理报文进行转发控制。与现有技术相比，本发明方案中不是为进入同一个端口的所有数据报文都设置相同的优先级，而是针对具体的待处理报文，基于其实际特点确定对应的区分服务优先值，并且根据区分服务优先值来进行流量控制。具体的，先根据双速双桶流量评估算法确定待处理报文的颜色标记，并对待处理报文进行解析确定其流量类型，根据流量类型确定其流量类型优先级，然后结合颜色标记和流量类型优先级确定待处理报文的区分服务优先值。如此，即使是同一个端口处的不同待处理报文，也不会被直接设置成相同的区分服务优先值，而是根据不同待处理报文的实际情况进行设置从而进行流量控制。有利于对各个端口处的待处理报文进行更精细的优先级区分和控制，有利于提高流量控制的精细度和效果。并且本发明方案中优先转发服务等级高的待处理报文，优先丢弃服务等级低的待处理报文，保障关键业务的连续性，有利于提高通信服务质量。同时，本发明方案中可以根据一个总的规则实现对待处理报文进行区分服务优先值的确定，不需要分别设置多种规则，有利于减少内存和开销的消耗。需要说明的是，传统网络是一个分布式的网络，没有中心的控制节点，网路中的各个设备之间通过口口相传的方式学习网络的可达信息，由每台设备自己决定要如何转发，这直接导致了没有整体观念，不能从整个网络的角度对流量进行调控。而本发明方案中结合软件定义网络原理，将控制平面和数据平面分离。对于SDN网络的控制面，不再是口口相传，而是集中智能，从更高的层次看整个网络，通过软件来控制网络行为。并且用于控制的软件可以由用户自行设置和实现，有利于提高用户控制的自由度。SDN网络中唯一标准化的是控制器与转发器的通信接口，不是传统意义上的网络控制协议，只是一个接口，控制器和交换机按接口实现即可。示例性方法如图1所示，本发明实施例提供一种针对通信服务质量的流量控制方法，具体的，上述方法包括如下步骤：步骤S100，获取待处理报文。其中，上述待处理报文是需要进行转发控制从而实现流量控制的数据报文。需要说明的是，基于本实施例中的流量控制方法，既可以针对交换机的输入端口对流入输入端口的待处理报文进行流量控制，也可以针对交换机的输出端口对需要从输出端口发出的待处理报文进行流量控制。即本实施例中，上述待处理报文是经过输入端口的数据报文，或者上述待处理报文是经过输出端口的报文。具体的，在一种应用场景中，上述获取待处理报文，包括：根据预设交换机的输入端口获取上述待处理报文。在另一种应用场景中，上述获取待处理报文，包括：根据预设交换机的输出端口获取上述待处理报文。其中，上述预设交换机是预先设置的交换机，例如，可以是P4交换机，即基于P4语言控制和处理的交换机。需要说明的是，在上述预设交换机的入方向和出方向都可以分别根据本实施例提供的流量控制方法对对应的待处理报文进行颜色标记的获取、流量类型优先级的确定和区分服务优先值的确定，从而分别在入方向和出方向实现流量控制。本实施例中以入方向的控制为例进行具体说明，出方向的控制可以参照入方向执行，在此不再赘述。步骤S200，基于预先设置的双速双桶流量评估算法获取上述待处理报文的颜色标记。其中，上述预先设置的双速双桶流量评估算法是预先设置的用于对数据报文的字节数或包个数进行评估从而确定待处理报文的颜色标记的算法。具体的，根据预先设置的双速双桶流量评估算法和待处理报文对应的字节数，可以获得用于体现网络拥塞程度的颜色标记，例如突发数据过多网络拥塞时对应的颜色标记为红色，网络完全不拥塞时对应的颜色标记为绿色，网络可能存在轻度拥塞时对应的颜色标记为黄色。具体的，上述基于预先设置的双速双桶流量评估算法获取上述待处理报文的颜色标记，包括：根据上述待处理报文的报文字节值和上述预先设置的双速双桶流量评估算法，通过上述预设交换机中数据平面的计量器获取上述待处理报文的颜色标记，其中，上述报文字节值大于P桶令牌数时上述待处理报文的颜色标记为红色，上述报文字节值不大于上述P桶令牌数且上述报文字节值大于C桶令牌数时上述待处理报文的颜色标记为黄色，上述报文字节值不大于上述C桶令牌数时上述待处理报文的颜色标记为绿色。本实施例中，上述预设交换机为P4交换机，即基于P4语言设置和定义的交换机。且上述数据平面和上述控制平面基于软件定义网络分离。需要说明的是，上述数据平面可以设置在P4交换机中，也可以设置在P4交换机之外，在此不作具体限定。具体的，本实施例中的流量控制方法基于P4交换机实现，并且基于SDN原理将控制平面和数据平面分离，在数据平面和控制平面实现对应的功能。进一步的，在预设的P4交换机中，预先定义解析器、计量器、匹配-动作表、转发处理逻辑等来实现数据平面的功能。具体的，在数据平面，定义对报文协议头部字段的解析器，用于对报文进入交换机的端口进行匹配，对报文自下向上逐层解析，用预先自定义的元数据或数组来对协议字段值进行存储。其中，元数据用于携带数据和配置信息，元数据的申明与包头类似，但在实例化时不同，包头和元数据在字段值的约束上存在一定的差别。元数据分为两种，一种用于携带P4程序运行过程中产生的数据的用户自定义元数据，如首部字段的运算结果等。另一种是固有元数据，用于携带交换机自身的配置信息，如数据包进入交换机时的端口号等。在一种应用场景中，对于一个待处理报文，可以先通过上述解析器解析获得其用户自定义元数据，根据用户自定义元数据字段的值在匹配-动作表中匹配获得需要执行的操作。需要说明的是，在执行完一个操作之后，会更新待处理报文中对应字段的值，然后通过解析器对更新后的待处理报文进行解析，根据解析的结果执行下一个需要执行的操作。进一步的，在数据平面中还定义计量器，用于对报文大小或数量进行统计以获取上述待处理报文的颜色标记。具体的，上述计量器可以设置全局属性或静态属性，统计的数据的类型可以分为字节数或包个数，本实施例中以统计字节数为例进行说明，但不作为具体限定。计量器如果设置全局属性，则报文在出入端口可以直接进行统计，且无法在匹配-动作表中更新计量器；而如果设置静态属性，则报文在流表匹配时才会进行统计，且必须在匹配-动作表中调用execute_meter动作更新计量器。计量器对应的全局属性或静态属性可以根据网络实际需求进行设定，例如，如果需要针对某个流表的报文匹配数量，则设置静态属性，需要按全局进行统计则设置全局属性，在此不作具体限定。本实施例中，上述计量器根据预设的双速双通流量评估算法对待处理报文的颜色进行评估，输出红色、黄色或绿色作为对应的颜色标记。图2是本发明实施例提供的一种双速双桶流量评估算法的流程示意图，如图2所示，对于报文字节值B，先将其与P桶令牌数Tp进行比较，如果B大于Tp，则将红色作为颜色标记，反之，则继续将报文字节值B与C桶令牌数Tc进行比较，如果B大于Tc，则将黄色作为颜色标记，反之则将绿色作为颜色标记。具体的，数据包根据自身大小领取一定数量的令牌，图2中峰值信息速率表示向P桶中投放令牌的速率，即P桶允许传输或转发报文的峰值速率；承诺信息速率表示向C桶中投放令牌的速率，即C桶允许传输或转发报文的平均速率；需要说明的是，PIR的值大于CIR的值。峰值突发尺寸表示P桶的容量，即P桶瞬间能够通过的峰值突发流量。承诺突发尺寸表示C桶的容量，即C桶瞬间能够通过的承诺突发流量。在令牌投放过程中，系统按照PIR速率向P桶中投放令牌，存满则不再发放，按照CIR速率向C桶中投放令牌，当Tp＜PBS时，P桶中令牌数增加，否则不增加；当Tc＜CBS时，C桶中令牌数增加，否则不增加；其中Tp为P桶令牌数量，Tc为C桶令牌数量。在令牌投放完毕之后，对待处理报文进行评估和标记颜色，具体的，对于到达的报文，用B表示报文的大小：若B＞Tp，说明报文过多，超过Peak峰值，将报文标记为红色，不允许通过。若Tp≥B＞Tc，报文被标记为黄色，且Tp减少B，允许通过；若Tc≥B，报文被标记为绿色，且Tp和Tc都减少B，允许通过。进一步的，在上述数据平面中定义一个或多个匹配-动作表，用于存储指定的协议字段的值及其对应的操作或功能，需要说明的是，匹配-动作表中存储的不同操作可以与P4交换机的不同功能模块对应。如下表1是本发明实施例提供的一种匹配-动作表，需要说明的是，匹配-动作表也是使用P4语言定义的，它作用于数据平面流水线。基于上述匹配-动作表匹配解析的报文字段，如果匹配命中则执行相应动作，没有命中则执行其他默认操作或跳到下一个流表匹配。不同的流表有不同的功能，互相之间有前后匹配顺序。表1在一种应用场景中，在数据平面中还可以定义转发处理逻辑，例如颜色标记为绿色则默认都转发，黄色则将超出限制速率的流量根据优先级设置选择性丢弃，红色则进行优先级由低到高的丢弃，排在队列后的报文先丢弃，直到队列拥塞缓解。需要说明的是，转发处理逻辑可以按照RFC2698定义的双速三色标记器trTCM算法对流量进行实现，基于P4也可以灵活地调整以上丢包策略。进一步的，上述数据平面中还可以定义校验值重计算和报文重组功能，以根据转发策略对报文进行处理和转发。具体的，数据平面流水线最后会对修改后的报文字段进行重组，并重新计算校验值保证报文的完整，然后根据策略给的出端口将报文转发。需要说明的是，本实施例中，数据平面的功能基于P4语言开发实现。数据平面类似于一个流水线，包括从入端口到解析器、报文匹配和执行、流量管理、报文重组，最后到出端口的整个流程。其中，解析器是定义在交换机的处理逻辑，通过解析器可以对进入交换机的报文进行拆分解析。报文进入交换机按照上述流水线进行拆分解析，然后匹配指定的报文字段，执行对报文字段的修改操作，最后重组报文，从指定的出端口转发。报文解析是在进入交换机之后通过解析器进行解析。如果该报文是第一次进入交换机，则直接将该报文上送至控制器进行解析，后续相同的报文则可直接根据匹配-动作表进行处理，其中，根据报文的头部字段进行匹配，匹配相同的则认为是相同的报文。步骤S300，对上述待处理报文进行解析以获取上述待处理报文对应的流量类型，根据上述流量类型获取上述待处理报文的流量类型优先级。具体的，控制器对收到的待处理报文进行解析，通过对应的目标字段判断流量类型并进行区分，根据流量类型可以设置待处理报文的流量类型优先级。本实施例中，上述步骤S300具体包括：对上述待处理报文进行解析并获取上述待处理报文中的目标字段；根据上述待处理报文中的目标字段，通过上述预设交换机对应的控制平面中的控制器基于区分服务模型获取上述待处理报文对应的流量类型；根据上述流量类型获取上述待处理报文的流量类型优先级。其中，上述目标字段包括IP地址、tcp流量、udp流量、端口号中的至少一种。需要说明的是，上述目标字段具体包括哪些字段还可以由控制器基于目标对象的输入数据灵活确定，以提高流量控制过程的灵活性。具体的，当上述流量类型为不丢包类型时，将上述待处理报文的流量类型优先级设置为最高优先级；当上述流量类型为部分丢包类型时，将上述待处理报文的流量类型优先级设置为中高优先级；当上述流量类型为可丢包重传类型时，将上述待处理报文的流量类型优先级设置为低优先级或者默认优先级，其中，默认优先级是默认的优先级较低的优先级。步骤S400，根据上述颜色标记和上述流量类型优先级获取上述待处理报文的区分服务优先值。其中，上述区分服务优先值是根据颜色表及和流量类型优先级确定的用于体现服务等级的值。本实施例中，上述步骤S400具体包括：当上述流量类型优先级是最高优先级时，将上述区分服务优先值设置为预设最高优先值；当上述流量类型优先级不是最高优先级时，根据上述流量类型优先级确定上述待处理报文的区分服务优先值区间，并在上述区分服务优先值区间中根据上述颜色标记确定上述待处理报文对应的区分服务优先值，其中，在一个上述区分服务优先值区间中，第一颜色报文的区分服务优先值对应的服务等级高于第二颜色报文，上述第二颜色报文的区分服务优先值对应的服务等级高于第三颜色报文，上述第一颜色报文是颜色标记为绿色的待处理报文，上述第二颜色报文是颜色标记为黄色的待处理报文，上述第三颜色报文是颜色标记为红色的待处理报文。在一种应用场景中，在对待处理报文设置流量类型优先级之后，结合颜色标记设置DSCP值，如果报文的流量类型优先级为最高优先级，则统一设置成最高服务等级的值；否则，先判断流量类型优先级再根据颜色标记区分。需要说明的是，可以预先为不同的流量类型优先级设置不同的DSCP值区间，并且中高优先级对应的DSCP值区间中任意一个DSCP值对应的服务等级都高于低优先级对应的DSCP值区间中的每一个DSCP值，其中，服务等级越高对应的优先级越高。进一步的，同一流量类型优先级的报文中，颜色标记为绿色的报文DSCP值对应的服务等级高于颜色标记为黄色的报文，若报文颜色为红色则直接标记为最低服务等级的值。具体的，本实施例中在控制平面也预先定义对应的功能模块。需要说明的是，本实施例中使用grpc与白盒设备进行交互，将数据平面功能加载至白盒设备上，让白盒设备使能基于P4定义的功能流水线。其中，P4Runtime是一套基于Protobuf以及grpc框架上的协议，通过P4Runtime，控制器可以控制能够支持P4的交换机。上述白盒设备为可编程交换机，不具备任何网络功能的交换机，本实施例中基于P4语言定义白盒设备的网络功能，由控制器将网络功能下发至饱和设备上使设备具有网络功能，并用于执行上述针对通信服务质量的流量控制方法的步骤。需要说明的是，数据平面应用于交换机，控制平面作为控制器。在控制平面中，还定义计量器的应用策略，具体的，设置限制速率和突发尺寸进行计量，可应用在端口或匹配-动作表中。进一步的，还定义流量类型优先级和DSCP值的具体划分策略，可以根据报文中的目标字段对报文进行分类，分类后在IP包头中的ToS域中进行DSCP值的赋值。结合颜色标记和流量类型优先级确定最终的DSCP值，从而进行优先级的细粒化分配，进而进行细粒化的流量控制。需要说明的是，在进行流量类型分类时使用的目标字段还可以包括源目mac地址、源目IP地址和传输层端口号，在此不作具体限定。图3是本发明实施例提供的一种IP包头格式示意图，如图2所示，其中，Version代表IP协议的版本，IHL代表报头长度，ToS代表服务类型，TotalLength代表IP数据报文的总长度，DSCP代表差分服务代码点，ECN代表显式拥塞通知。其中，IP报文头的ToS字段有8个bit，其中前3个bit存储DSCP值，用于体现代表IP优先级，取值范围为0～7。RFC2474标准中，重新定义了IP报文头部的ToS域，称之为DS域，其中DSCP优先级用该域的前6位表示，取值范围为0～63，后2位是保留位。本实施例中，DSCP值的范围为0～63，可以定义64个优先级。本实施例中，在同一区分服务优先值区间中值越小对应的服务等级越高，而不同的区分服务优先值区间中值越大服务等级越高。在上述控制平面中，还定义命令行配置工具及前端显示，可以通过命令行实时下发和查询策略。需要说明的是，根据上述步骤S100到步骤S400的步骤可以同时对多个待处理报文进行处理，分别确定各个待处理报文的颜色标记，并确定各个待处理报文的流量类型优先级，从而分别确定各个待处理报文的区分服务优先值。然后针对所有的待处理报文，基于对应的区分服务优先值进行转发控制，实现流量控制。步骤S500，根据上述区分服务优先值对上述待处理报文进行转发控制。具体的，根据上述区分服务优先值确定待处理报文的服务等级，对于多个待处理报文，优先转发服务等级高的待处理报文，并且可以根据实际需求丢弃服务等级低的待处理报文。本实施例中，上述步骤S500包括：根据上述区分服务优先值确定上述待处理报文对应的转发队列，其中，各上述转发队列中包括多个待处理报文，同一转发队列中区分服务优先值对应的服务等级低的待处理报文排在区分服务优先值对应的服务等级高的待处理报文之后；在各上述转发队列中基于上述服务等级对各上述待处理报文依次进行转发控制。控制器在确定各个待处理报文的在区分服务优先值之后，将各个待处理报文对应的执行策略下发到交换机，交换机根据策略以及各个待处理报文的区分服务优先值进行报文调度，划分到不同的队列中，并且按照优先级调度队列中的报文，同一队列中服务等级低的报文会排在队尾，超出队列长度的报文则执行队尾丢弃。如此，通过对每个端口、每个业务流、每个队列的细粒度控制，解决流量突发和拥塞问题，并保证关键业务可以优先传输以降低响应延迟。进一步的，还预先设置不丢包队列，在不丢包队列中的所有报文都不进行丢弃，以保证关键业务的实施。进行队列划分时，区分服务优先值是上述预设最高优先值的待处理报文对应的转发队列为不丢包队列，上述在各上述转发队列中基于上述服务等级对各上述待处理报文依次进行转发控制，包括：对上述不丢包队列中的所有待处理报文基于上述服务等级依次进行转发；对可丢包队列中未超出队列长度的待处理报文基于上述服务等级依次进行转发，对超出上述队列长度的待处理报文进行队尾丢弃，其中，上述可丢包队列是除上述不丢包队列以外的转发队列。需要说明的是，本实施例中，只对颜色标记为红色的待处理报文进行丢弃操作。本实施例中，还基于一种具体应用场景对上述针对通信服务质量的流量控制方法进行描述，图4是本发明实施例提供的一种进行流量控制的具体流程示意图，本实施例中，以SDN网络中视频流量和语音流量突发场景的流量监管与整形过程作为场景，更加详细地进行说明。具体的，如图4所示，video和voice业务报文初次进入P4交换机，数据平面解析器对报文进行解析并上送至控制平面处理。其中，数据平面应用于白盒交换机，而控制平面是控制器。数据平面通过P4语言开发，定义整个处理流水线，包括解析器、匹配-动作表等，然后编译生成相关文件。控制器通过P4Runtime API控制白盒交换机，然后将编译生成的文件加载至白盒交换机，使交换机具有处理报文的流水线。交换机严格按照控制器下发的流表策略对报文进行匹配和操作。控制器根据报文的相关头部字段进行流表策略的下发，并将报文转发回P4交换机。通过控制器配置入方向的接口限速，报文进入交换机端口后，计量器会对报文规格进行评估并输出结果。进一步的，基于DiffServ服务模型对报文进行区分，进行流量类型区分并且进一步确定DSCP值，具体的，匹配ipv4包头中的协议、源地址、目的地址三个字段，匹配命中则将对应的DSCP值进行标记，即匹配之后根据匹配情况来对报文进行操作，若命中则针对IPv4头部中的ToS字段进行DSCP值的赋值。确定颜色标记、流量类型优先级和DSCP值之后，对颜色和DSCP值进行匹配，根据命中情况执行指定操作。具体的，若短时间内业务流量突发，颜色评估都为红色，则根据服务等级进行处理，voice报文优先级高于video报文，优先保障voice报文转发而将超出速率的video报文进行丢弃。若报文未被设置为丢弃处理，最后则匹配转发表执行转发。需要说明的是，在报文的出方向上同样会对报文进行颜色和服务等级的匹配，根据命中情况执行报文丢弃操作。具体的，交换机的流水线上有入端口控制流程和出端口控制流程，两个流程可以有不同的匹配-动作表，入端口可以对流量进行评估，出端口同样也能对流量进行评估，在此不再赘述。本实施例中，如图4所示，只对红色标记的报文进行丢弃操作，报文颜色为红色时则证明链路拥塞，排在队列后的报文则先丢弃。绿色报文直接转发；黄色报文也可以直接转发，但实际使用过程中，如果排在队列后的黄色报文在出端口发生拥塞时也会进行丢弃。如此，本实施例中基于SDN原理，将控制平面和数据平面分离，使用P4定义数据平面处理的流水线，该流水线可以报文进行解析、匹配、处理和转发，定义计量器对所有端口进行流量监管，可以根据报文的个数或报文字节的大小评估颜色。再对解析的报文字段进行匹配，基于DiffServ服务模型对报文进行DSCP值的设定。最后根据颜色和服务等级进行转发、缓存或丢弃处理。而以上对流量颜色的评估和DSCP值的设定等操作均由控制平面来判断执行，第一次进入设备的报文会转发给控制平面进行解析，后续相同的报文可直接匹配流表进行处理。具体的，本实施例中基于P4的方案还具有灵活性和可扩展性。基于P4的方案可以自定义只需要解析的报文头部内容而不需要定义所有协议的头部内容，匹配-动作表可以按照业务流量情况去定义匹配的字段和执行的动作。具体的，传统的报文解析需要由下至上逐层解析，而本实施例中可以只解析所关注的头部字段，例如只解析链路层、网络层的头部字段，而不需要解析传输层以上的头部字段。进一步的，在区分服务的QoS上，本实施例中可以根据计量器输出的颜色和对业务流量的DSCP优先级做灵活的评估，在网络流量突发的情况下做最优的处理。利用控制器来掌控整个网络拓扑，可以实时地了解每台白盒设备的网络资源可用情况，以下发最优的策略。由上可见，本发明方案中针对具体的待处理报文，基于其实际特点确定对应的区分服务优先值，并且根据区分服务优先值来进行流量控制。具体的，先根据双速双桶流量评估算法确定待处理报文的颜色标记，并对待处理报文进行解析确定其流量类型，根据流量类型确定其流量类型优先级，然后结合颜色标记和流量类型优先级确定待处理报文的区分服务优先值。如此，即使是同一个端口处的不同待处理报文，也不会被直接设置成相同的区分服务优先值，而是根据不同待处理报文的实际情况进行设置从而进行流量控制。有利于对各个端口处的待处理报文进行更精细的优先级区分和控制，有利于提高流量控制的精细度和效果。示例性设备如图5中所示，对应于上述针对通信服务质量的流量控制方法，本发明实施例还提供一种针对通信服务质量的流量控制系统，上述针对通信服务质量的流量控制系统包括：待处理报文获取模块610，用于获取待处理报文；颜色标记获取模块620，用于基于预先设置的双速双桶流量评估算法获取上述待处理报文的颜色标记；流量类型优先级获取模块630，用于对上述待处理报文进行解析以获取上述待处理报文对应的流量类型，根据上述流量类型获取上述待处理报文的流量类型优先级；区分服务优先值获取模块640，用于根据上述颜色标记和上述流量类型优先级获取上述待处理报文的区分服务优先值；转发控制模块650，用于根据上述区分服务优先值对上述待处理报文进行转发控制。需要说明的是，上述针对通信服务质量的流量控制系统及其各个模块或单元的具体结构和实现方式可以参照上述方法实施例中的对应描述，在此不再赘述。需要说明的是，上述针对通信服务质量的流量控制系统的各个模块的划分方式并不唯一，在此也不作为具体限定。基于上述实施例，本发明还提供了一种智能终端，其原理框图可以如图6所示。上述智能终端包括通过系统总线连接的处理器、存储器、网络接口以及显示屏。其中，该智能终端的处理器用于提供计算和控制能力。该智能终端的存储器包括非易失性存储介质、内存储器。该非易失性存储介质存储有操作系统和针对通信服务质量的流量控制程序。该内存储器为非易失性存储介质中的操作系统和针对通信服务质量的流量控制程序的运行提供环境。该智能终端的网络接口用于与外部的终端通过网络连接通信。该针对通信服务质量的流量控制程序被处理器执行时实现上述任意一种针对通信服务质量的流量控制方法的步骤。该智能终端的显示屏可以是液晶显示屏或者电子墨水显示屏。本领域技术人员可以理解，图6中示出的原理框图，仅仅是与本发明方案相关的部分结构的框图，并不构成对本发明方案所应用于其上的智能终端的限定，具体的智能终端可以包括比图中所示更多或更少的部件，或者组合某些部件，或者具有不同的部件布置。在一个实施例中，提供了一种智能终端，上述智能终端包括存储器、处理器以及存储在上述存储器上并可在上述处理器上运行的针对通信服务质量的流量控制程序，上述针对通信服务质量的流量控制程序被上述处理器执行时实现本发明实施例提供的任意一种针对通信服务质量的流量控制方法的步骤。本发明实施例还提供一种计算机可读存储介质，上述计算机可读存储介质上存储有针对通信服务质量的流量控制程序，上述针对通信服务质量的流量控制程序被处理器执行时实现本发明实施例提供的任意一种针对通信服务质量的流量控制方法的步骤。应理解，上述实施例中各步骤的序号大小并不意味着执行顺序的先后，各过程的执行顺序应以其功能和内在逻辑确定，而不应对本发明实施例的实施过程构成任何限定。所属领域的技术人员可以清楚地了解到，为了描述的方便和简洁，仅以上述各功能单元、模块的划分进行举例说明，实际应用中，可以根据需要而将上述功能分配由不同的功能单元、模块完成，即将上述装置的内部结构划分成不同的功能单元或模块，以完成以上描述的全部或者部分功能。实施例中的各功能单元、模块可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中，上述集成的单元既可以采用硬件的形式实现，也可以采用软件功能单元的形式实现。另外，各功能单元、模块的具体名称也只是为了便于相互区分，并不用于限制本发明的保护范围。上述装置中单元、模块的具体工作过程，可以参考前述方法实施例中的对应过程，在此不再赘述。在上述实施例中，对各个实施例的描述都各有侧重，某个实施例中没有详述或记载的部分，可以参见其它实施例的相关描述。本领域普通技术人员可以意识到，结合本文中所公开的实施例描述的各实例的单元及算法步骤，能够以电子硬件、或者计算机软件和电子硬件的结合来实现。这些功能究竟是以硬件还是软件方式来执行，取决于技术方案的特定应用和设计约束条件。专业技术人员可以对每个特定的应用来使用不同法来实现所描述的功能，但是这种实现不应认为超出本发明的范围。在本发明所提供的实施例中，应该理解到，所揭露的系统/终端设备和方法，可以通过其它的方式实现。例如，以上所描述的系统/终端设备实施例仅仅是示意性的，例如，上述模块或单元的划分，仅仅为一种逻辑功能划分，实际实现时可以由另外的划分方式，例如多个单元或组件可以结合或者可以集成到另一个系统，或一些特征可以忽略，或不执行。上述集成的模块/单元如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读存储介质中。基于这样的理解，本发明实现上述实施例方法中的全部或部分流程，也可以通过计算机程序来指令相关的硬件来完成，上述计算机程序可存储于一计算机可读存储介质中，该计算机程序在被处理器执行时，可实现上述各个方法实施例的步骤。其中，上述计算机程序包括计算机程序代码，上述计算机程序代码可以为源代码形式、对象代码形式、可执行文件或某些中间形式等。上述计算机可读介质可以包括：能够携带上述计算机程序代码的任何实体或装置、记录介质、U盘、移动硬盘、磁碟、光盘、计算机存储器、只读存储器、随机存取存储器、电载波信号、电信信号以及软件分发介质等。需要说明的是，上述计算机可读存储介质包含的内容可以根据司法管辖区内立法和专利实践的要求进行适当的增减。以上所述实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解；其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不是相应技术方案的本质脱离本发明各实施例技术方案的精神和范围，均应包含在本发明的保护范围之内。
