标题title
一种呼叫转移方法及装置
摘要abst
本说明书提供一种呼叫转移方法及装置，当该呼叫转移方法应用于密钥管理服务KMS服务器，KMS服务器作为第三方终端所属的KMS服务器时，包括：接收第三方终端发起的呼叫转移消息；其中，第三方终端是主叫方呼叫被叫方时预先被指定的呼叫转移方；呼叫转移消息至少携带有呼叫转移类型、主叫方与被叫方通话时使用的票据Ticket和第三方终端的身份标识；在第三方终端通过验证后，依据第三方终端的身份标识、呼叫转移消息携带的呼叫转移类型、Ticket携带的被叫方的身份标识，确定主叫方呼叫被叫方时的呼叫转移关系；在确定出呼叫转移关系通过验证时，则控制第三方终端开启与主叫方之间的通话。通过实施本发明，提高了呼叫转移通话的安全性。
权利要求书clms
1.一种呼叫转移方法，其特征在于，应用于密钥管理服务KMS服务器，所述KMS服务器作为第三方终端所属的KMS服务器，包括如下步骤：接收第三方终端发起的呼叫转移消息；其中，所述第三方终端是主叫方呼叫被叫方时预先被指定的呼叫转移方；所述呼叫转移消息至少携带有呼叫转移类型、所述主叫方与所述被叫方通话时使用的票据Ticket和第三方终端的身份标识；在所述第三方终端通过验证后，依据所述第三方终端的身份标识、所述呼叫转移消息携带的呼叫转移类型、所述Ticket携带的所述被叫方的身份标识，确定所述主叫方呼叫所述被叫方时的呼叫转移关系；在确定出所述呼叫转移关系通过验证时，则控制所述第三方终端开启与所述主叫方之间的通话。2.根据权利要求1所述的方法，其特征在于，所述第三方终端所属的KMS服务器与所述被叫方所属的KMS服务器不同；通过如下步骤对所述呼叫转移关系进行验证：向所述被叫方所属的KMS服务器发送所述呼叫转移关系，以由所述被叫方所属的KMS服务器对所述呼叫转移关系进行验证；接收所述被叫方所属的KMS服务器返回的验证结果，若所述验证结果为通过，则确定所述呼叫转移关系通过验证。3.根据权利要求2所述的方法，其特征在于，所述第三方终端所属的KMS服务器与所述主叫方所属的KMS服务器不同，所述控制所述第三方终端开启与所述主叫方之间的通话，包括：向所述主叫方所属的KMS服务器发送解密请求消息，所述解密请求消息携带有所述第三方终端的身份标识和所述Ticket，以由所述主叫方所属的KMS服务器对所述Ticket进行解密；接收所述主叫方所属的KMS服务器发送的通信密钥；控制所述第三方终端通过所述通信密钥开启与所述主叫方之间的通话。4.根据权利要求1所述的方法，其特征在于，所述第三方终端所属的KMS服务器与所述被叫方所属的KMS服务器相同；通过如下步骤对所述呼叫转移关系进行验证：在已获得的呼叫转移信息表中查询与所述被叫方的身份标识、所述呼叫转移类型相匹配的呼叫转移方身份标识，若所述呼叫转移方身份标识为所述第三方终端的身份标识，则确定所述呼叫转移关系通过验证。5.一种呼叫转移方法，其特征在于，应用于KMS服务器，所述KMS服务器作为被叫方所属的KMS服务器，包括如下步骤：接收呼叫转移方所属的KMS服务器发送的呼叫转移关系，所述呼叫转移关系是所述呼叫转移方所属的KMS服务器依据所述呼叫转移方的身份标识、呼叫转移方发起的呼叫转移消息所携带的呼叫转移类型和所述主叫方与所述被叫方通话时使用的Ticket中携带的被叫方的身份标识确定的；对所述呼叫转移关系进行验证，向所述呼叫转移方所属的KMS服务器返回验证结果，以由所述呼叫转移方所属的KMS服务器基于所述验证结果控制所述呼叫转移方开启与所述主叫方之间的通话。6.根据权利要求5所述的方法，其特征在于，所述呼叫转移消息携带至少两个呼叫转移类型，所述呼叫转移类型的顺序与所述主叫方呼叫的呼叫方的顺序相对应，其中，所述主叫方呼叫的呼叫方的顺序为：所述被叫方、所述主叫方呼叫被叫方时被指定的按顺序进行呼叫转移的至少两个呼叫转移方；所述对所述呼叫转移关系进行验证包括：依据所述被叫方的身份标识和所述被叫方对应的呼叫转移类型，验证所述主叫方针对所述被叫方的呼叫转移的目标呼叫转移方是否为发送所述呼叫转移关系的呼叫转移方；如果是，确定通过验证；如果否，依据所述目标呼叫转移方的身份标识、所述目标呼叫转移方对应的呼叫转移类型、发送所述呼叫转移关系的呼叫转移方的身份标识，构建待验证信息，将所述待验证信息发送给所述目标呼叫转移方所属的KMS服务器，以由所述目标呼叫转移方所属的KMS服务器对所述待验证信息进行验证并返回验证指示至所述被叫方所属的KMS服务器，所述验证指示包括通过验证或者未通过验证；根据所述目标转移方所属的KMS服务器返回的验证指示确定是否通过验证。7.一种呼叫转移装置，其特征在于，应用于密钥管理服务KMS服务器，所述KMS服务器作为第三方终端所属的KMS服务器，包括：呼叫转移消息接收模块，用于接收第三方终端发起的呼叫转移消息；其中，所述第三方终端是主叫方呼叫被叫方时预先被指定的呼叫转移方；所述呼叫转移消息至少携带有呼叫转移类型、票据Ticket和第三方终端的身份标识；呼叫转移关系确定模块，用于在所述第三方终端通过验证后，依据所述第三方终端的身份标识、所述呼叫转移消息携带的呼叫转移类型、所述主叫方与所述被叫方通话时使用的所述Ticket携带的所述被叫方的身份标识，确定所述主叫方呼叫所述被叫方时的呼叫转移关系；控制模块，用于在确定出所述呼叫转移关系通过验证时，则控制所述第三方终端开启与所述主叫方之间的通话。8.根据权利要求7所述的装置，其特征在于，所述第三方终端所属的KMS服务器与所述被叫方所属的KMS服务器不同；所述装置还包括：呼叫转移关系发送模块，用于向所述被叫方所属的KMS服务器发送所述呼叫转移关系，以由所述被叫方所属的KMS服务器对所述呼叫转移关系进行验证；验证结果接收模块，用于接收所述被叫方所属的KMS服务器返回的验证结果，若所述验证结果为通过，则确定所述呼叫转移关系通过验证。9.一种呼叫转移装置，其特征在于，应用于KMS服务器，所述KMS服务器作为被叫方所属的KMS服务器，包括：呼叫转移关系接收模块，用于接收呼叫转移方所属的KMS服务器发送的呼叫转移关系，所述呼叫转移关系是所述呼叫转移方所属的KMS服务器依据所述呼叫转移方的身份标识、呼叫转移方发起的呼叫转移消息所携带的呼叫转移类型和所述主叫方与所述被叫方通话时使用的Ticket中携带的被叫方的身份标识确定的；呼叫转移关系验证模块，用于对所述呼叫转移关系进行验证，向所述呼叫转移方所属的KMS服务器返回验证结果，以由所述呼叫转移方所属的KMS服务器基于所述验证结果控制所述呼叫转移方开启与所述主叫方之间的通话。10.根据权利要求9所述的装置，其特征在于，所述呼叫转移消息携带至少两个呼叫转移类型，所述呼叫转移类型的顺序与所述主叫方呼叫的呼叫方的顺序相对应，其中，所述主叫方呼叫的呼叫方的顺序为：所述被叫方、所述主叫方呼叫被叫方时被指定的按顺序进行呼叫转移的至少两个呼叫转移方；所述呼叫转移关系验证模块具体用于：依据所述被叫方的身份标识和所述被叫方对应的呼叫转移类型，验证所述主叫方针对所述被叫方的呼叫转移的目标呼叫转移方是否为发送所述呼叫转移关系的呼叫转移方；如果是，确定通过验证；如果否，依据所述目标呼叫转移方的身份标识、所述目标呼叫转移方对应的呼叫转移类型、发送所述呼叫转移关系的呼叫转移方的身份标识，构建待验证信息，将所述待验证信息发送给所述目标呼叫转移方所属的KMS服务器，以由所述目标呼叫转移方所属的KMS服务器对所述待验证信息进行验证并返回验证指示至所述被叫方所属的KMS服务器，所述验证指示包括通过验证或者未通过验证；根据所述目标转移方所属的KMS服务器返回的验证指示确定是否通过验证。
说明书desc
技术领域本说明书涉及通信技术领域，尤其涉及一种呼叫转移方法及装置。背景技术随着通讯业务的发展，呼叫转移成为了常用的电信补充业务之一，该业务允许被叫方把来电转移到指定的其他电话上，被叫方使用该指定的其他电话与主叫方进行通话。IMS作为基于SIP的电话系统也提供了呼叫转移业务，为了保证端到端通话的私密性，IMS支持基于KMS的媒体面安全通信技术。相关技术中，KMS服务器需要进行身份验证，一致则验证通过同意接听方解密Ticket中的IMS媒体面密钥的请求，因为呼叫转移业务中最终的接听方身份标识与被叫方的身份标识肯定是不一致的，为了实现呼叫转移时KMS服务器能验证通过，现有技术中，主叫方在向KMS服务器申请IMS媒体面密钥以及票据Ticket时，通常将被叫方的身份标识信息设置为一个通配身份标识，该身份标识携带在Ticket中，KMS服务器会直接验证通过，这样就导致即使目标呼叫转移方不是被叫方签约的呼叫转移方也能通过身份验证，进而导致非签约的呼叫转移方能够去KMS服务器得到IMS媒体面密钥进行通话，导致通话安全性差。发明内容为克服相关技术中存在的问题，本说明书提供了一种呼叫转移方法及装置。根据本说明书实施例的第一方面，提供一种呼叫转移方法，应用于密钥管理服务KMS服务器，所述KMS服务器作为第三方终端所属的KMS服务器，包括如下步骤：接收第三方终端发起的呼叫转移消息；其中，所述第三方终端是主叫方呼叫被叫方时预先被指定的呼叫转移方；所述呼叫转移消息至少携带有呼叫转移类型、所述主叫方与所述被叫方通话时使用的票据Ticket和第三方终端的身份标识；在所述第三方终端通过验证后，依据所述第三方终端的身份标识、所述呼叫转移消息携带的呼叫转移类型、所述Ticket携带的所述被叫方的身份标识，确定所述主叫方呼叫所述被叫方时的呼叫转移关系；在确定出所述呼叫转移关系通过验证时，则控制所述第三方终端开启与所述主叫方之间的通话。可选地，所述第三方终端所属的KMS服务器与所述被叫方所属的KMS服务器不同；通过如下步骤对所述呼叫转移关系进行验证：向所述被叫方所属的KMS服务器发送所述呼叫转移关系，以由所述被叫方所属的KMS服务器对所述呼叫转移关系进行验证；接收所述被叫方所属的KMS服务器返回的验证结果，若所述验证结果为通过，则确定所述呼叫转移关系通过验证。可选地，所述第三方终端所属的KMS服务器与所述主叫方所属的KMS服务器不同，所述控制所述第三方终端开启与所述主叫方之间的通话，包括：向所述主叫方所属的KMS服务器发送解密请求消息，所述解密请求消息携带有所述第三方终端的身份标识和所述Ticket，以由所述主叫方所属的KMS服务器对所述Ticket进行解密；接收所述主叫方所属的KMS服务器发送的通信密钥；控制所述第三方终端通过所述通信密钥开启与所述主叫方之间的通话。可选地，所述第三方终端所属的KMS服务器与所述被叫方所属的KMS服务器相同；通过如下步骤对所述呼叫转移关系进行验证：在已获得的呼叫转移信息表中查询与所述被叫方的身份标识、所述呼叫转移类型相匹配的呼叫转移方身份标识，若所述呼叫转移方身份标识为所述第三方终端的身份标识，则确定所述呼叫转移关系通过验证。根据本说明书实施例的第二方面，提供一种呼叫转移方法，应用于KMS服务器，所述KMS服务器作为被叫方所属的KMS服务器，包括如下步骤：接收呼叫转移方所属的KMS服务器发送的呼叫转移关系，所述呼叫转移关系是所述呼叫转移方所属的KMS服务器依据所述呼叫转移方的身份标识、呼叫转移方发起的呼叫转移消息所携带的呼叫转移类型和所述主叫方与所述被叫方通话时使用的Ticket中携带的被叫方的身份标识确定的；对所述呼叫转移关系进行验证，向所述呼叫转移方所属的KMS服务器返回验证结果，以由所述呼叫转移方所属的KMS服务器基于所述验证结果控制所述呼叫转移方开启与所述主叫方之间的通话。可选地，所述呼叫转移消息携带至少两个呼叫转移类型，所述呼叫转移类型的顺序与所述主叫方呼叫的呼叫方的顺序相对应，其中，所述主叫方呼叫的呼叫方的顺序为：所述被叫方、所述主叫方呼叫被叫方时被指定的按顺序进行呼叫转移的至少两个呼叫转移方；所述对所述呼叫转移关系进行验证包括：依据所述被叫方的身份标识和所述被叫方对应的呼叫转移类型，验证所述主叫方针对所述被叫方的呼叫转移的目标呼叫转移方是否为发送所述呼叫转移关系的呼叫转移方；如果是，确定通过验证；如果否，依据所述目标呼叫转移方的身份标识、所述目标呼叫转移方对应的呼叫转移类型、发送所述呼叫转移关系的呼叫转移方的身份标识，构建待验证信息，将所述待验证信息发送给所述目标呼叫转移方所属的KMS服务器，以由所述目标呼叫转移方所属的KMS服务器对所述待验证信息进行验证并返回验证指示至所述被叫方所属的KMS服务器，所述验证指示包括通过验证或者未通过验证；根据所述目标转移方所属的KMS服务器返回的验证指示确定是否通过验证。根据本说明书实施例的第三方面，提供一种呼叫转移装置，应用于密钥管理服务KMS服务器，所述KMS服务器作为第三方终端所属的KMS服务器，包括：呼叫转移消息接收模块，用于接收第三方终端发起的呼叫转移消息；其中，所述第三方终端是主叫方呼叫被叫方时预先被指定的呼叫转移方；所述呼叫转移消息至少携带有呼叫转移类型、票据Ticket和第三方终端的身份标识；呼叫转移关系确定模块，用于在所述第三方终端通过验证后，依据所述第三方终端的身份标识、所述呼叫转移消息携带的呼叫转移类型、所述主叫方与所述被叫方通话时使用的所述Ticket携带的所述被叫方的身份标识，确定所述主叫方呼叫所述被叫方时的呼叫转移关系；控制模块，用于在确定出所述呼叫转移关系通过验证时，则控制所述第三方终端开启与所述主叫方之间的通话。可选地，所述第三方终端所属的KMS服务器与所述被叫方所属的KMS服务器不同；所述装置还包括：呼叫转移关系发送模块，用于向所述被叫方所属的KMS服务器发送所述呼叫转移关系，以由所述被叫方所属的KMS服务器对所述呼叫转移关系进行验证；验证结果接收模块，用于接收所述被叫方所属的KMS服务器返回的验证结果，若所述验证结果为通过，则确定所述呼叫转移关系通过验证。根据本说明书实施例的第四方面，提供一种呼叫转移装置，应用于KMS服务器，所述KMS服务器作为被叫方所属的KMS服务器，包括：呼叫转移关系接收模块，用于接收呼叫转移方所属的KMS服务器发送的呼叫转移关系，所述呼叫转移关系是所述呼叫转移方所属的KMS服务器依据所述呼叫转移方的身份标识、呼叫转移方发起的呼叫转移消息所携带的呼叫转移类型和所述主叫方与所述被叫方通话时使用的Ticket中携带的被叫方的身份标识确定的；呼叫转移关系验证模块，用于对所述呼叫转移关系进行验证，向所述呼叫转移方所属的KMS服务器返回验证结果，以由所述呼叫转移方所属的KMS服务器基于所述验证结果控制所述呼叫转移方开启与所述主叫方之间的通话。可选地，所述呼叫转移消息携带至少两个呼叫转移类型，所述呼叫转移类型的顺序与所述主叫方呼叫的呼叫方的顺序相对应，其中，所述主叫方呼叫的呼叫方的顺序为：所述被叫方、所述主叫方呼叫被叫方时被指定的按顺序进行呼叫转移的至少两个呼叫转移方；所述呼叫转移关系验证模块具体用于：依据所述被叫方的身份标识和所述被叫方对应的呼叫转移类型，验证所述主叫方针对所述被叫方的呼叫转移的目标呼叫转移方是否为发送所述呼叫转移关系的呼叫转移方；如果是，确定通过验证；如果否，依据所述目标呼叫转移方的身份标识、所述目标呼叫转移方对应的呼叫转移类型、发送所述呼叫转移关系的呼叫转移方的身份标识，构建待验证信息，将所述待验证信息发送给所述目标呼叫转移方所属的KMS服务器，以由所述目标呼叫转移方所属的KMS服务器对所述待验证信息进行验证并返回验证指示至所述被叫方所属的KMS服务器，所述验证指示包括通过验证或者未通过验证；根据所述目标转移方所属的KMS服务器返回的验证指示确定是否通过验证。本说明书的实施例提供的技术方案可以包括以下有益效果：本说明书实施例中，通过接收第三方终端发起的呼叫转移消息，并对依据第三方终端的身份标识、呼叫转移消息携带的呼叫转移类型、Ticket携带的被叫方的身份标识确定的呼叫转移关系进行验证，验证通过后控制第三方终端开启与主叫方之间的通话，确保呼叫转移关系的合法性，提高了呼叫转移通话的安全性。应当理解的是，以上的一般描述和后文的细节描述仅是示例性和解释性的，并不能限制本说明书。附图说明此处的附图被并入说明书中并构成本说明书的一部分，示出了符合本说明书的实施例，并与说明书一起用于解释本说明书的原理。图1是本说明书根据一示例性实施例示出的一种单次呼叫转移的呼叫转移系统的交互流程图。图2是本说明书根据一示例性实施例示出的呼叫转移信息设置的一个具体示例图。图3是本说明书根据一示例性实施例示出的一种多次呼叫转移的呼叫转移系统的交互流程图。图4是本说明书根据一示例性实施例示出的一种呼叫转移方法的流程图。图5是本说明书根据一示例性实施例示出的另一种呼叫转移方法的流程图。图6是本说明书根据一示例性实施例示出的一种呼叫转移装置的框图。图7是本说明书根据一示例性实施例示出的另一种呼叫转移装置的框图。图8是本说明书实施例呼叫转移装置所在计算机设备的一种硬件结构图。具体实施方式这里将详细地对示例性实施例进行说明，其示例表示在附图中。下面的描述涉及附图时，除非另有表示，不同附图中的相同数字表示相同或相似的要素。以下示例性实施例中所描述的实施方式并不代表与本说明书相一致的所有实施方式。相反，它们仅是与如所附权利要求书中所详述的、本说明书的一些方面相一致的装置和方法的例子。在本说明书使用的术语是仅仅出于描述特定实施例的目的，而非旨在限制本说明书。在本说明书和所附权利要求书中所使用的单数形式的“一种”、“所述”和“该”也旨在包括多数形式，除非上下文清楚地表示其他含义。还应当理解，本文中使用的术语“和/或”是指并包含一个或多个相关联的列出项目的任何或所有可能组合。应当理解，尽管在本说明书可能采用术语第一、第二、第三等来描述各种信息，但这些信息不应限于这些术语。这些术语仅用来将同一类型的信息彼此区分开。例如，在不脱离本说明书范围的情况下，第一信息也可以被称为第二信息，类似地，第二信息也可以被称为第一信息。取决于语境，如在此所使用的词语“如果”可以被解释成为“在……时”或“当……时”或“响应于确定”。接下来对本说明书实施例进行详细说明。如图1所示，图1是本说明书根据一示例性实施例示出的一种单次呼叫转移的呼叫转移系统，包括：主叫方、被叫方、第三方终端，IMS，主叫方所属的KMS服务器、被叫方所属的KMS服务器，第三方终端所属的KMS服务器，其中，上述主叫方所属的KMS服务器、被叫方所属的KMS服务器，第三方终端所属的KMS服务器可以是三个不同的服务器，也可以是同一个服务器，还可以是其中2个是同一个服务器，另外一个是单独的服务器，例如，主叫方所属的KMS服务器、被叫方所属的KMS服务器是同一个服务器，第三方终端所属的KMS服务器是单独的服务器。本发明实施例对上述KMS服务器的部署方法不作具体限定，本领域技术人员可以根据实际情况确定。本发明实施例仅以主叫方所属的KMS服务器、被叫方所属的KMS服务器，第三方终端所属的KMS服务器均为单独的服务器为例进行说明。如图1所示，对于一次呼叫过程，主叫方先向主叫方所属的KMS服务器发送请求消息，该请求消息可以携带有主叫方的身份标识和被叫方的身份标识，主叫方所属的KMS服务器根据上述请求消息向主叫方发送反馈消息，该反馈消息携带有通信密钥以及票据Ticket，主叫方通过IMS将接收到的Ticket发送给被叫方以请求进行通话。在本发明实施例中，该Ticket可以包括：被叫方的身份标识、主叫方的身份标识以及加密后的通信密钥，上述被叫方的身份标识为其电话号码或者用户域名，主叫方的身份标识也为其电话号码或者用户域名，本发明实施例对上述主叫方的身份标识和被叫方的身份标识均不作具体限定，本领域技术人员可以根据实际情况确定。上述通信密钥用于主叫方和被叫方进行通信。作为本发明一个可选实施方式，Ticket中的通信密钥通过主叫方所属的KMS服务器的私钥进行加密，对该通信密钥进行了完整性的保护，避免了被篡改和伪造，提高了通话安全性。当被叫方暂时不能接听该通话时，可以将本次通话转移到第三方终端进行接听，该第三方终端可以是用户根据自己的通话习惯提前设置好的。具体地，可以将根据不同的呼叫转移类型设置不同的第三方终端。在本发明实施例中，上述呼叫转移类型可以包括：始终转移、占线时转移、无人接听时转移、无法接通时转移等。对于不同的呼叫转移类型，可以为其设置相同的第三方终端，也可以为其设置不同的第三方终端。本发明实施例对该呼叫转移类型以及不同呼叫类型对应的第三方终端均不作具体限定，本领域技术人员可以根据实际情况确定。具体地，可以提前预设好每一个被叫方的呼叫转移信息，每一条呼叫转移信息由被叫方的身份标识、呼叫转移类型及该呼叫转移类型对应转移的第三方终端的身份标识所组成的呼叫转移关系表示，并根据预设存储格式形成呼叫转移信息表后存储在被叫方所属的KMS服务器中以便于后续对呼叫转移关系进行验证。示例性地，如图2所示，被叫方可以向IMS设置呼叫转移信息后，由IMS将该呼叫转移信息发送到被叫方所属的KMS服务器中；被叫方也可以直接将呼叫转移信息发送到被叫方所属的KMS服务器中进行存储，本发明实施例对该呼叫转移信息的设置方法不作具体限定，本领域技术人员可以根据实际情况确定。在本发明实施例中，上述预设存储格式可以为{被叫方的身份标识：}。其中，表示数组，{：}表示映射关系。如图1所示，当IMS接收到被叫方暂时无法接通的消息时，将呼叫转移类型和Ticket同时发送到被叫方的呼叫转移方，由于Ticket中的通信密钥是利用主叫方所属的KMS服务器的私钥加密的，因此第三方终端向第三方终端所属的KMS服务器发送呼叫转移消息，上述呼叫转移消息中至少携带有呼叫转移类型、票据Ticket和第三方终端的身份标识。第三方终端所属的KMS服务器接收到呼叫转移信息后，先对第三方终端的身份进行验证，验证通过后，解析Ticket得到本次呼叫转移的被叫方的身份标识，可以得知被叫方的身份标识与第三方终端的身份标识不同，但是该呼叫转移消息中携带有呼叫转移类型，应对该第三方终端的呼叫转移身份进行验证，故第三方终端所属的KMS服务器依据第三方终端的身份标识、呼叫转移消息携带的呼叫转移类型、Ticket中携带的被叫方的身份标识，确定主叫方呼叫被叫方时的呼叫转移关系并进行验证。上述呼叫转移关系的验证可以是由被叫方所属的KMS服务器进行验证，也可以是由第三方终端所属的KMS服务器进行验证，本发明实施例对该呼叫转移关系的验证方不作具体限定，本领域技术人员可以根据实际情况确定。当呼叫转移关系由被叫方所属的KMS服务器进行验证时，如图1所示，第三方终端所属的KMS服务器将上述呼叫转移关系发送到被叫方所属的KMS服务器，被叫方所属的KMS服务器在已获得的呼叫转移信息表中查询与被叫方的身份标识、呼叫转移类型相匹配的呼叫转移方身份标识，若呼叫转移方身份标识为第三方终端的身份标识，则确定呼叫转移关系通过验证，若呼叫转移方身份标识不为第三方终端的身份标识，则确定呼叫转移关系未通过验证，向第三方终端所属的KMS服务器反馈验证结果。当呼叫转移关系由第三方终端所属的KMS服务器进行验证时，第三方终端所属的KMS服务器向被叫方所属的KMS服务器发送呼叫转移信息表获取请求，当接收到被叫方所属的KMS服务器发送的呼叫转移信息表时，在已获得的呼叫转移信息表中查询与被叫方的身份标识、呼叫转移类型相匹配的呼叫转移方身份标识，若呼叫转移方身份标识为第三方终端的身份标识，则确定呼叫转移关系通过验证，若呼叫转移方身份标识不为第三方终端的身份标识，则确定呼叫转移关系未通过验证。当确定呼叫转移关系通过验证时，第三方终端所属的KMS服务器将第三方终端的身份标识和Ticket发送到主叫方所属的KMS服务器上进行解密，主叫方所属的KMS服务器对Ticket进行解密后将通信密钥发送到第三方终端所属的KMS服务器，第三方终端通过IMS向主叫方发送响应消息，进而第三方终端根据该通信密钥开启与主叫方之间的通话。当第三方终端也无法接通时，可以将该通话转移到第三方终端对应的呼叫转移方进行接听，第三方终端的呼叫转移方也可以是用户根据呼叫转移类型提前设置好的，具体设置方法与上述被叫方的设置方法一样，在此不再赘述。对于多次呼叫转移的呼叫转移系统，可以包括：主叫方、被叫方、第三方终端、第四方终端……接听方，主叫方所属的KMS服务器、被叫方所属的KMS服务器，第三方终端所属的KMS服务器、第四方终端所属的KMS服务器……接听方所属的KMS服务器。上述主叫方所属的KMS服务器、被叫方所属的KMS服务器，第三方终端所属的KMS服务器、第四方终端所属的KMS服务器……接听方所属的KMS服务器的部署方法与单次呼叫转移的KMS服务器的部署方法一样，既可以单独部署，也可以集中部署，还可以部分集中部署，本发明实施例对该部署方法不作具体限定，本领域技术人员可以根据实际情况确定。需要说明的是，呼叫转移次数可以是提前预设好的，例如，当3次呼叫转移没有接通，IMS就向主叫方反馈呼叫失败的消息。接听方所属KMS服务器接收到呼叫转移消息后，需要对该呼叫转移消息进行验证，对于多次呼叫转移消息，其携带有呼叫转移类型列表，该呼叫转移类型列表包括每一次呼叫转移的呼叫转移类型。具体验证方法如下：呼叫转移关系验证可以按照呼叫转移类型列表中的呼叫类型从前往后进行验证，称为第一呼叫转移类型和第一呼叫转移关系、第二呼叫转移类型和第二呼叫转移关系、第三呼叫转移类型和第三呼叫转移关系，以此类推。具体验证方法可以分为如下两种，本发明实施例对验证方法的选择不作具体限定，本领域技术人员可以根据实际情况确定。验证方法1.接听方所属的KMS服务器进行反复查询：接听方所属的KMS服务器将第一呼叫转移类型、被叫方的身份标识发送给被叫方所属的KMS服务器，被叫方所属的KMS服务器匹配第一呼叫转移类型和被叫方的身份标识可以得到并返回第三方终端身份标识；然后接听方所属的KMS服务器将第二呼叫转移类型、第三方终端的身份标识发送给第三方终端所属的KMS服务器，第三方终端所属的KMS服务器匹配第二呼叫转移类型和第三方终端的身份标识可以得到并返回第四方终端的身份标识；然后接听方所属的KMS服务器将第三呼叫转移类型、第四方终端的身份标识发送给第四方终端所属的KMS服务器，第四方终端所属的KMS服务器匹配第三呼叫转移类型和第四方终端的身份标识可以得到并返回第五方终端的身份标识；以此类推，直到呼叫转移类型列表中的最后一个呼叫转移类型查询返回得到最终的转移方身份标识，用这个最终的转移方身份标识与接听方身份标识进行比对，一致则验证通过，不一致则验证不通过，此外，上述反复查询过程中，每次通过呼叫转移类型和对应的身份标识查询不到转移方时均认为验证不通过。作为本发明实施例一个可选实施方式，接听方所属的KMS服务器还可以一次性将所有的呼叫转移关系发送给对应的KMS服务器。验证方法2.接听方所属的KMS服务器进行链式查询：接听方所属的KMS服务器将呼叫转移类型列表、被叫方的身份标识、接听方的身份标识发送给被叫方所属的KMS服务器，被叫方所属的KMS服务器匹配第一呼叫转移类型和被叫方的身份标识可以得到第三方终端的身份标识；然后被叫方终端所属的KMS服务器将去掉第一呼叫转移类型后的呼叫转移类型列表、第三方终端的身份标识和接听方的身份标识一起发送给第三方终端所属的KMS服务器，第三方终端所属的KMS服务器匹配第二呼叫转移类型和第三方终端的身份标识可以得到第四方终端的身份标识；然后第三方终端对应的KMS服务器将去掉第一呼叫转移类型、第二呼叫转移类型的呼叫转移类型列表、第四方终端的身份标识和接听方的身份标识一起发送给第四方终端所属的KMS服务器，第四方终端所属的KMS服务器匹配第三呼叫转移类型和第四方终端的身份标识可以得到第五方终端的身份标识；以此类推，直到呼叫转移类型列表中的最后一个呼叫转移类型由某个KMS服务器查询得到最终的转移方身份标识，用这个最终的转移方的身份标识与接听方的身份标识进行比对，一致则验证通过，不一致则验证不通过，此外，上述链式验证过程中，每次通过呼叫转移类型和对应的身份标识查询不到转移方时均认为验证不通过。图3仅仅以两次呼叫转移为例进行展示，如图3所示，当IMS在预设时间没有收到反馈信息时，将呼叫转移类型列表和Ticket发送到第三方终端的呼叫转移方，上述呼叫类型转移列表包括2次呼叫转移类型。第四方终端接收到呼叫转移类型列表和Ticket后，将呼叫转移消息发送给第四方终端所属的KMS服务器，上述呼叫转移消息包括：第四方终端的身份标识、呼叫转移类型列表和Ticket。第四方终端所属的KMS服务器对第四方终端的身份进行验证，验证通过后依据第四方终端的身份标识、呼叫转移消息携带的呼叫转移类型列表、Ticket携带的被叫方的身份标识确定第一呼叫转移关系，将该第一呼叫转移关系发送到被叫方所属的KMS服务器，以使得被叫方所属的KMS服务器进行验证。若已获得的呼叫转移信息表中存在与被叫方的身份标识、呼叫转移类型列表中被叫方的呼叫转移类型相匹配的呼叫转移关系，但呼叫转移信息表中的呼叫转移关系对应的呼叫转移方身份标识与第四方终端的身份标识不相同，则确定第一呼叫转移关系未通过验证，依据被叫方的呼叫转移信息表中的呼叫转移关系对应的呼叫转移方身份标识、呼叫转移类型列表中去掉第一个呼叫转移类型后的呼叫转移类型、Ticket携带的被叫方的身份标识，确定对应的第二呼叫转移关系，向第三方终端所属的KMS服务器发送第二呼叫转移关系，以由第三方终端所属的KMS服务器对第二呼叫转移关系进行验证，验证过程与上述第一呼叫转移关系的验证过程一样，在此不再赘述。第三方终端所属的KMS服务器确定验证结果后向被叫方所属的KMS服务器反馈验证结果，进而被叫方所属的KMS服务器根据该验证结果向第四方终端所属的KMS服务器反馈验证结果。当验证结果为通过时，第四方终端所属的KMS服务器向主叫方所属的KMS服务器发送解密请求，以获取通信密钥，当第四方终端所属的KMS服务器收到通信密钥后，将该通信密钥发送给第四方终端，第四方终端向主叫方发送响应消息，进而第四方终端与主叫方依据通信密钥进行通话。本发明实施例提供的呼叫转移系统，对现有的IMS的呼叫流程改动较小，仅仅在多次呼叫转移场景下，将现有的携带最新的呼叫转移类型修改为携带本次呼叫过程中经历的所有呼叫转移类型信息进行验证，而KMS服务器提前存储了呼叫转移信息表，实现了对呼叫转移最终接听方的身份的合法性验证，保证了在呼叫转移过程中只有具备呼叫转移关系的接听方才能进行通话，提高呼叫转移通话的安全性。如图4所示，图4是本说明书根据一示例性实施例示出的一种呼叫转移方法的流程图，应用于密钥管理服务KMS服务器，该KMS服务器可以为集成了主叫方所属的KMS服务器、被叫方所属的KMS服务器以及呼叫转移方所属的KMS服务器的服务器，也可以仅仅为呼叫转移方所属的KMS服务器，本发明实施例对该KMS服务器不作具体限定，本领域技术人员可以根据实际情况确定。该呼叫转移方法包括以下步骤：S11：接收第三方终端发起的呼叫转移消息；其中，第三方终端是主叫方呼叫被叫方时预先被指定的呼叫转移方；呼叫转移消息至少携带有呼叫转移类型、主叫方与被叫方通话时使用的票据Ticket和第三方终端的身份标识。示例性地，对于一次呼叫过程，主叫方先向主叫方所属的KMS服务器发送请求消息，该请求消息可以携带有主叫方的身份标识和被叫方的身份标识，主叫方所属的KMS服务器根据上述请求消息向主叫方反馈通信密钥以及票据Ticket，主叫方将接收到的Ticket发送给被叫方以请求进行通话。当被叫方暂时不能接听该通话时，根据呼叫转移类型将该通话转移到第三终端进行通话。呼叫转移消息至少携带有呼叫转移类型、票据Ticket和第三方终端的身份标识，该第三方终端的身份标识可以为用户电话号码，也可以为用户域名，本发明实施例对该第三方终端的身份标识不作具体限定，本领域技术人员可以根据实际情况确定。第三方终端发起的呼叫转移消息的接收方法可以为通过无线网络接收，也可以通过串口接收，本发明实施例对该呼叫转移消息的接收方法不作具体限定，本领域技术人员可以根据实际情况确定。S12：在第三方终端通过验证后，依据第三方终端的身份标识、呼叫转移消息携带的呼叫转移类型、Ticket携带的被叫方的身份标识，确定主叫方呼叫被叫方时的呼叫转移关系。示例性地，上述对第三方终端的验证指的是对第三方终端的身份进行鉴权，以确定第三方终端是否是合法终端。当第三方终端验证通过后，对Ticket进行解析，得到被叫方的身份标识，同时对呼叫转移消息进行解析，得到呼叫转移类型，进而依据第三方终端的身份标识、呼叫转移消息携带的呼叫转移类型、Ticket携带的被叫方的身份标识，确定对应的呼叫转移关系。S13：在确定出呼叫转移关系通过验证时，则控制第三方终端开启与主叫方之间的通话。示例性地，当确定呼叫转移关系通过验证时，第三方终端所属的KMS服务器可以向第三方终端发送通信密钥，进而控制第三方终端通过该通信密钥开启与主叫方之间的通话。呼叫转移关系的验证过程包括如下几种过程：1.第三方终端所属的KMS服务器与被叫方所属的KMS服务器不同：1.1上述验证过程由被叫方所属的KMS服务器进行验证，具体地，上述确定呼叫转移关系通过验证包括：向被叫方所属的KMS服务器发送呼叫转移关系，以由被叫方所属的KMS服务器对呼叫转移关系进行验证；接收被叫方所属的KMS服务器返回的验证结果，若验证结果为通过，则确定呼叫转移关系通过验证。1.2上述验证过程由第三方终端所属的KMS服务器进行验证，具体地，上述确定呼叫转移关系通过验证包括：向被叫方所属的KMS服务器发送呼叫转移信息表获取请求，呼叫转移信息表用于获取被叫方所属的KMS服务器存储的被叫方的呼叫转移信息表；当接收到呼叫转移信息表后，在已获得的呼叫转移信息表中查询与被叫方的身份标识、呼叫转移类型相匹配的呼叫转移方身份标识，若呼叫转移方身份标识为第三方终端的身份标识，则确定呼叫转移关系通过验证。2.第三方终端所属的KMS服务器与被叫方所属的KMS服务器相同；上述确定呼叫转移关系通过验证包括：在已获得的呼叫转移信息表中查询与被叫方的身份标识、呼叫转移类型相匹配的呼叫转移方身份标识，若呼叫转移方身份标识为第三方终端的身份标识，则确定呼叫转移关系通过验证。示例性地，当第三方终端所属的KMS服务器与被叫方所属的KMS服务器相同时，第三方终端所属的KMS服务器直接从本地调取被叫方的呼叫转移信息表，进而进行验证。本说明书实施例中，通过接收第三方终端发起的呼叫转移消息，并对依据第三方终端的身份标识、呼叫转移消息携带的呼叫转移类型、Ticket携带的被叫方的身份标识确定的呼叫转移关系进行验证，验证通过后控制第三方终端开启与主叫方之间的通话，确保呼叫转移关系的合法性，提高了呼叫转移通话的安全性。作为本发明实施例一个可选实施方式，第三方终端所属的KMS服务器与主叫方所属的KMS服务器不同，上述控制第三方终端开启与主叫方之间的通话，包括：首先，向主叫方所属的KMS服务器发送解密请求消息，解密请求消息携带有第三方终端的身份标识和Ticket，以由主叫方所属的KMS服务器对Ticket进行解密。其次，接收主叫方所属的KMS服务器发送的通信密钥。再次，控制第三方终端通过通信密钥开启与主叫方之间的通话。示例性地，由于Ticket中的通信密钥是由主叫方所属的KMS服务器的私钥加密的，因此，第三方终端所属的KMS服务器将第三方终端的身份标识和Ticket同时发送到主叫方所属的KMS服务器，以便于主叫方所属的KMS服务器对Ticket进行解密。上述解密请求消息和通信密钥均可以通过无线网络发送，也可以通过串口发送。当第三方终端所属的KMS服务器与主叫方所属的KMS服务器相同时，确认呼叫转移关系通过验证后直接进行解密获得通信密钥。具体实施方式和效果参见上述呼叫转移系统的描述，在此不再赘述。如图5所示，图5是本说明书根据一示例性实施例示出的一种呼叫转移方法的流程图，应用于KMS服务器，KMS服务器作为被叫方所属的KMS服务器，包括如下步骤：S21：接收呼叫转移方所属的KMS服务器发送的呼叫转移关系，呼叫转移关系是呼叫转移方所属的KMS服务器依据呼叫转移方的身份标识、呼叫转移方发起的呼叫转移消息所携带的呼叫转移类型和主叫方与被叫方通话时使用的Ticket中携带的被叫方的身份标识确定的。S22：对呼叫转移关系进行验证，向呼叫转移方所属的KMS服务器返回验证结果，以由呼叫转移方所属的KMS服务器基于验证结果控制呼叫转移方开启与主叫方之间的通话。示例性地，上述呼叫转移消息所携带的呼叫转移类型可以为一个，也可以为多个，本发明实施例对该呼叫转移消息所携带的呼叫转移类型的数量不作具体限定，本领域技术人员可以根据实际情况确定。当呼叫转移类型为一个时，对呼叫转移关系进行验证的方法可以参见上述第三方终端所属的KMS服务器与被叫方所属的KMS服务器不同的情况的验证过程，在此不再赘述。当呼叫转移类型为至少两个时，作为本发明实施例一个可选实施方式，呼叫转移消息携带至少两个呼叫转移类型，呼叫转移类型的顺序与主叫方呼叫的呼叫方的顺序相对应，其中，主叫方呼叫的呼叫方的顺序为：被叫方、主叫方呼叫被叫方时被指定的按顺序进行呼叫转移的至少两个呼叫转移方；上述对呼叫转移关系进行验证包括：依据被叫方的身份标识和被叫方对应的呼叫转移类型，验证主叫方针对被叫方的呼叫转移的目标呼叫转移方是否为发送呼叫转移关系的呼叫转移方；如果是，确定通过验证；如果否，依据目标呼叫转移方的身份标识、目标呼叫转移方对应的呼叫转移类型、发送呼叫转移关系的呼叫转移方的身份标识，构建待验证信息，将待验证信息发送给目标呼叫转移方所属的KMS服务器，以由目标呼叫转移方所属的KMS服务器对待验证信息进行验证并返回验证指示至被叫方所属的KMS服务器，验证指示包括通过验证或者未通过验证；根据目标转移方所属的KMS服务器返回的验证指示确定是否通过验证。具体实施方式参见上述接听方所属的KMS服务器进行链式查询的具体过程，在此不再赘述。具体实施方式参见上述呼叫转移系统的相关描述，在此不再赘述。与前述方法的实施例相对应，本说明书还提供了装置及其所应用的终端的实施例。如图6所示，图6是本说明书根据一示例性实施例示出的一种呼叫转移装置的框图，应用于密钥管理服务KMS服务器，KMS服务器作为第三方终端所属的KMS服务器，该呼叫转移装置包括：呼叫转移消息接收模块31，用于接收第三方终端发起的呼叫转移消息；其中，第三方终端是主叫方呼叫被叫方时预先被指定的呼叫转移方；呼叫转移消息至少携带有呼叫转移类型、票据Ticket和第三方终端的身份标识；呼叫转移关系确定模块32，用于在第三方终端通过验证后，依据第三方终端的身份标识、呼叫转移消息携带的呼叫转移类型、主叫方与被叫方通话时使用的Ticket携带的被叫方的身份标识，确定主叫方呼叫被叫方时的呼叫转移关系；控制模块33，用于在确定出呼叫转移关系通过验证时，则控制第三方终端开启与主叫方之间的通话。本说明书实施例中，通过接收第三方终端发起的呼叫转移消息，并对依据第三方终端的身份标识、呼叫转移消息携带的呼叫转移类型、Ticket携带的被叫方的身份标识确定的呼叫转移关系进行验证，验证通过后控制第三方终端开启与主叫方之间的通话，确保呼叫转移关系的合法性，提高了呼叫转移通话的安全性。作为本发明实施例一个可选实施方式，第三方终端所属的KMS服务器与被叫方所属的KMS服务器不同；该呼叫转移装置还包括：呼叫转移关系发送模块，用于向被叫方所属的KMS服务器发送呼叫转移关系，以由被叫方所属的KMS服务器对呼叫转移关系进行验证；验证结果接收模块，用于接收被叫方所属的KMS服务器返回的验证结果，若验证结果为通过，则确定呼叫转移关系通过验证。作为本发明实施例一个可选实施方式，第三方终端所属的KMS服务器与主叫方所属的KMS服务器不同，第一控制模块33具体用于：向主叫方所属的KMS服务器发送解密请求消息，解密请求消息携带有第三方终端的身份标识和Ticket，以由主叫方所属的KMS服务器对Ticket进行解密。接收主叫方所属的KMS服务器发送的通信密钥。控制第三方终端通过通信密钥开启与主叫方之间的通话。作为本发明实施例一个可选实施方式，第三方终端所属的KMS服务器与被叫方所属的KMS服务器相同；该呼叫转移装置还包括：查询模块，用于在已获得的呼叫转移信息表中查询与被叫方的身份标识、呼叫转移类型相匹配的呼叫转移方身份标识，若呼叫转移方身份标识为第三方终端的身份标识，则确定呼叫转移关系通过验证。上述各个模块的具体实施方式和效果参见上述方法实施例的描述，在此不再赘述。如图7所示，图7是本说明书根据一示例性实施例示出的一种呼叫转移装置的框图，应用于KMS服务器，KMS服务器作为被叫方所属的KMS服务器，包括如下步骤：呼叫转移关系接收模块41，用于接收呼叫转移方所属的KMS服务器发送的呼叫转移关系，呼叫转移关系是呼叫转移方所属的KMS服务器依据呼叫转移方的身份标识、呼叫转移方发起的呼叫转移消息所携带的呼叫转移类型和主叫方与被叫方通话时使用的Ticket中携带的被叫方的身份标识确定的；呼叫转移关系验证模块42，用于对呼叫转移关系进行验证，向呼叫转移方所属的KMS服务器返回验证结果，以由呼叫转移方所属的KMS服务器基于验证结果控制呼叫转移方开启与主叫方之间的通话。作为本发明实施例一个可选实施方式，呼叫转移消息携带至少两个呼叫转移类型，呼叫转移类型的顺序与主叫方呼叫的呼叫方的顺序相对应，其中，主叫方呼叫的呼叫方的顺序为：被叫方、主叫方呼叫被叫方时被指定的按顺序进行呼叫转移的至少两个呼叫转移方；呼叫转移关系验证模块42具体用于：依据被叫方的身份标识和被叫方对应的呼叫转移类型，验证主叫方针对被叫方的呼叫转移的目标呼叫转移方是否为发送呼叫转移关系的呼叫转移方；如果是，确定通过验证；如果否，依据目标呼叫转移方的身份标识、目标呼叫转移方对应的呼叫转移类型、发送呼叫转移关系的呼叫转移方的身份标识，构建待验证信息，将待验证信息发送给目标呼叫转移方所属的KMS服务器，以由目标呼叫转移方所属的KMS服务器对待验证信息进行验证并返回验证指示至被叫方所属的KMS服务器，验证指示包括通过验证或者未通过验证；根据目标转移方所属的KMS服务器返回的验证指示确定是否通过验证。上述各个模块的具体实施方式和效果参见上述方法实施例的描述，在此不再赘述。对于装置实施例而言，由于其基本对应于方法实施例，所以相关之处参见方法实施例的部分说明即可。以上所描述的装置实施例仅仅是示意性的，其中所述作为分离部件说明的模块可以是或者也可以不是物理上分开的，作为模块显示的部件可以是或者也可以不是物理模块，即可以位于一个地方，或者也可以分布到多个网络模块上。可以根据实际的需要选择其中的部分或者全部模块来实现本说明书方案的目的。本领域普通技术人员在不付出创造性劳动的情况下，即可以理解并实施。本说明书呼叫转移装置的实施例可以应用在计算机设备上，例如服务器或终端设备。装置实施例可以通过软件实现，也可以通过硬件或者软硬件结合的方式实现。以软件实现为例，作为一个逻辑意义上的装置，是通过其所在呼叫转移装置的处理器将非易失性存储器中对应的计算机程序指令读取到内存中运行形成的。从硬件层面而言，如图8所示，为本说明书实施例呼叫转移装置所在计算机设备的一种硬件结构图，除了图8所示的处理器310、内存330、网络接口320、以及非易失性存储器340之外，实施例中装置331所在的服务器或电子设备，通常根据该计算机设备的实际功能，还可以包括其他硬件，对此不再赘述。本申请还提供一种计算机可读存储介质，其上存储有计算机程序，所述程序被处理器执行时实现本申请提供的任一呼叫转移的方法的步骤。具体的，适合于存储计算机程序指令和数据的计算机可读介质包括所有形式的非易失性存储器、媒介和存储器设备，例如包括半导体存储器设备、磁盘、磁光盘以及CD ROM和DVD-ROM盘。上述对本说明书特定实施例进行了描述。其它实施例在所附权利要求书的范围内。在一些情况下，在权利要求书中记载的动作或步骤可以按照不同于实施例中的顺序来执行并且仍然可以实现期望的结果。另外，在附图中描绘的过程不一定要求示出的特定顺序或者连续顺序才能实现期望的结果。在某些实施方式中，多任务处理和并行处理也是可以的或者可能是有利的。本领域技术人员在考虑说明书及实践这里申请的发明后，将容易想到本说明书的其它实施方案。本说明书旨在涵盖本说明书的任何变型、用途或者适应性变化，这些变型、用途或者适应性变化遵循本说明书的一般性原理并包括本说明书未申请的本技术领域中的公知常识或惯用技术手段。说明书和实施例仅被视为示例性的，本说明书的真正范围和精神由下面的权利要求指出。应当理解的是，本说明书并不局限于上面已经描述并在附图中示出的精确结构，并且可以在不脱离其范围进行各种修改和改变。本说明书的范围仅由所附的权利要求来限制。以上所述仅为本说明书的较佳实施例而已，并不用以限制本说明书，凡在本说明书的精神和原则之内，所做的任何修改、等同替换、改进等，均应包含在本说明书保护的范围之内。
