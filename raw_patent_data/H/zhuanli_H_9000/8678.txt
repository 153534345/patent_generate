标题title
一种短信提交报告和回执报告的处理方法与系统
摘要abst
本发明公开了一种短信提交报告和回执报告的处理方法与系统，包括接收来自运营商的回执报告，获取存储于redis分布式系统中的所有提交报告，将回执报告与所有提交报告进行匹配，若匹配成功则将回执报告返回给对应的客户和内部系统，并删除回执报告对应的提交报告，若匹配不成功则判断匹配次数是否达到预设的最大次数，若匹配次数达到预设的最大次数则结束匹配，若匹配次数未达到预设的最大次数，则根据回执报告生成对应的mq消息并投递到消息队列中进行等待，直至等待时间达到预设的延迟时间后再次将回执报告与所有提交报告进行匹配，通过引入多次匹配机制解决了多次匹配不上的问题，解决了单点问题，节省了内存空间，提高了匹配效率。
权利要求书clms
1.一种短信提交报告和回执报告的处理方法，其特征在于，所述短信提交报告和回执报告的处理方法包括：接收来自运营商的回执报告；获取存储于redis分布式系统中的所有提交报告；将所述回执报告与所述所有提交报告进行匹配；若匹配成功则将所述回执报告返回给对应的客户和内部系统，并删除所述回执报告对应的存储于redis分布式系统中的提交报告；若匹配不成功则判断匹配次数是否达到预设的最大次数，若所述匹配次数达到所述预设的最大次数则结束匹配；若所述匹配次数未达到所述预设的最大次数，则根据所述回执报告生成对应的mq消息，并将所述mq消息投递到消息队列中进行等待，直至等待时间达到预设的延迟时间后再次将所述回执报告与所述所有提交报告进行匹配，依次类推，直至匹配成功或者达到到所述预设的最大次数则结束匹配。2.根据权利要求1所述的一种短信提交报告和回执报告的处理方法，其特征在于，在所述获取存储于redis分布式系统中的所有提交报告之前，包括：接收来自运营商的提交报告；将所述提交报告以key:value形式存储于redis分布式系统中。3.根据权利要求2所述的一种短信提交报告和回执报告的处理方法，其特征在于，在将所述提交报告以key:value形式存储于redis分布式系统中之前，包括：对所述提交报告的value进行无用字段剔除与protobuf压缩。4.根据权利要求3所述的一种短信提交报告和回执报告的处理方法，其特征在于，所述短信提交报告和回执报告的处理方法还包括：若所述提交报告的保存时间达到预先设置的过期时间，则删除所述提交报告。5.一种短信提交报告和回执报告的处理方法，其特征在于，随着匹配次数的增加，对应的预设的延迟时间变长。6.一种短信提交报告和回执报告的处理系统，其特征在于，所述短信提交报告和回执报告的处理系统包括：回执报告接收模块，用于接收来自运营商的回执报告；提交报告获取模块，用于获取存储于redis分布式系统中的所有提交报告；报告匹配模块，用于将所述回执报告与所述所有提交报告进行匹配；报告处理模块，用于若匹配成功则将所述回执报告返回给对应的客户和内部系统，并删除所述回执报告对应的存储于redis分布式系统中的提交报告；若匹配不成功则判断匹配次数是否达到预设的最大次数，若所述匹配次数达到所述预设的最大次数则结束匹配；若所述匹配次数未达到所述预设的最大次数，则根据所述回执报告生成对应的mq消息，并将所述mq消息投递到消息队列中进行等待，直至等待时间达到预设的延迟时间后再次将所述回执报告与所述所有提交报告进行匹配，依次类推，直至匹配成功或者达到到所述预设的最大次数则结束匹配。7.根据权利要求6所述的一种短信提交报告和回执报告的处理系统，其特征在于，所述短信提交报告和回执报告的处理系统还包括：提交报告接收模块，用于接收来自运营商的提交报告；存储模块，用于将所述提交报告以key:value形式存储于redis分布式系统中。8.根据权利要求7所述的一种短信提交报告和回执报告的处理系统，其特征在于，所述短信提交报告和回执报告的处理系统还包括：压缩模块，用于对所述提交报告的value进行无用字段剔除与protobuf压缩。9.一种短信提交报告和回执报告的处理设备，其特征在于，包括至少一个控制处理器和用于与所述至少一个控制处理器通信连接的存储器；所述存储器存储有可被所述至少一个控制处理器执行的指令，所述指令被所述至少一个控制处理器执行，以使所述至少一个控制处理器能够执行如权利要求1至5任一项所述的短信提交报告和回执报告的处理方法。10.一种计算机可读存储介质，其特征在于：所述计算机可读存储介质存储有计算机可执行指令，所述计算机可执行指令用于使计算机执行如权利要求1至5任一项所述的短信提交报告和回执报告的处理方法。
说明书desc
技术领域本发明涉及计算机应用相关技术领域，尤其是涉及一种短信提交报告和回执报告的处理方法与系统。背景技术客户或者内部系统通过短信平台发送短信后，短信平台把短信提交给运营商后，运营商会返回两个报告，一个是提交报告用于反馈短信是否提交到运营商成功，一个是回执报告用于反馈短信是否发送到用户手机成功，两个报告运营商是异步返回，当回执报告返回时，需要跟提交报告进行匹配，匹配成功了才将回执报告返回给对应的客户和内部系统。但目前的方案是提交报告返回后会保存在本地内存库中，回执报告返回时会从内存库中获取提交报告进行匹配，由于提交报告存在本地内存库，回执报告需要返回到对应的节点才能进行匹配，所以存在单点问题；并且提交报告可能会比回执报告返回慢，导致匹配不成功的情况，目前的方案是将回执报告存到内存库，由专门的线程定时扫描存储待匹配回执的表跟保存提交报告的表进行匹配，这样效率低且不能处理多次匹配不上的情况。发明内容本发明旨在至少解决现有技术中存在的技术问题。为此，本发明提出一种短信提交报告和回执报告的处理方法与系统，能够解决多次匹配不上的问题，节省内存空间，提高匹配效率。本发明的第一方面，提供了一种短信提交报告和回执报告的处理方法，包括如下步骤：接收来自运营商的回执报告；获取存储于redis分布式系统中的所有提交报告；将所述回执报告与所述所有提交报告进行匹配；若匹配成功则将所述回执报告返回给对应的客户和内部系统，并删除所述回执报告对应的存储于redis分布式系统中的提交报告；若匹配不成功则判断匹配次数是否达到预设的最大次数，若所述匹配次数达到所述预设的最大次数则结束匹配；若所述匹配次数未达到所述预设的最大次数，则根据所述回执报告生成对应的mq消息，并将所述mq消息投递到消息队列中进行等待，直至等待时间达到预设的延迟时间后再次将所述回执报告与所述所有提交报告进行匹配，依次类推，直至匹配成功或者达到到所述预设的最大次数则结束匹配。根据本发明的实施例，至少具有如下技术效果：本方法通过接收来自运营商的回执报告；获取存储于redis分布式系统中的所有提交报告，解决了单点问题，将回执报告与所有提交报告进行匹配，若匹配成功则将回执报告返回给对应的客户和内部系统，并删除回执报告对应的存储于redis分布式系统中的提交报告，若匹配不成功则判断匹配次数是否达到预设的最大次数，若匹配次数达到预设的最大次数则结束匹配；若匹配次数未达到预设的最大次数，则根据回执报告生成对应的mq消息，并将mq消息投递到消息队列中进行等待，直至等待时间达到预设的延迟时间后再次将回执报告与所有提交报告进行匹配，依次类推，直至匹配成功或者达到到预设的最大次数则结束匹配，通过引入多次匹配机制解决了多次匹配不上的问题，节省了内存空间，提高了匹配效率。根据本发明的一些实施例，在所述获取存储于redis分布式系统中的所有提交报告之前，包括：接收来自运营商的提交报告；将所述提交报告以key:value形式存储于redis分布式系统中。根据本发明的一些实施例，在将所述提交报告以key:value形式存储于redis分布式系统中之前，包括：对所述提交报告的value进行无用字段剔除与protobuf压缩。根据本发明的一些实施例，所述短信提交报告和回执报告的处理方法还包括：若所述提交报告的保存时间达到预先设置的过期时间，则删除所述提交报告。根据本发明的一些实施例，随着匹配次数的增加，对应的预设的延迟时间变长。本发明的第二方面，提供一种短信提交报告和回执报告的处理系统，所述短信提交报告和回执报告的处理系统包括：回执报告接收模块，用于接收来自运营商的回执报告；提交报告获取模块，用于获取存储于redis分布式系统中的所有提交报告；报告匹配模块，用于将所述回执报告与所述所有提交报告进行匹配；报告处理模块，用于若匹配成功则将所述回执报告返回给对应的客户和内部系统，并删除所述回执报告对应的存储于redis分布式系统中的提交报告；若匹配不成功则判断匹配次数是否达到预设的最大次数，若所述匹配次数达到所述预设的最大次数则结束匹配；若所述匹配次数未达到所述预设的最大次数，则根据所述回执报告生成对应的mq消息，并将所述mq消息投递到消息队列中进行等待，直至等待时间达到预设的延迟时间后再次将所述回执报告与所述所有提交报告进行匹配，依次类推，直至匹配成功或者达到到所述预设的最大次数则结束匹配。本系统通过接收来自运营商的回执报告；获取存储于redis分布式系统中的所有提交报告，解决了单点问题，将回执报告与所有提交报告进行匹配，若匹配成功则将回执报告返回给对应的客户和内部系统，并删除回执报告对应的存储于redis分布式系统中的提交报告，若匹配不成功则判断匹配次数是否达到预设的最大次数，若匹配次数达到预设的最大次数则结束匹配；若匹配次数未达到预设的最大次数，则根据回执报告生成对应的mq消息，并将mq消息投递到消息队列中进行等待，直至等待时间达到预设的延迟时间后再次将回执报告与所有提交报告进行匹配，依次类推，直至匹配成功或者达到到预设的最大次数则结束匹配，通过引入多次匹配机制解决了多次匹配不上的问题，节省了内存空间，提高了匹配效率。根据本发明的一些实施例，所述短信提交报告和回执报告的处理系统还包括：提交报告接收模块，用于接收来自运营商的提交报告；存储模块，用于将所述提交报告以key:value形式存储于redis分布式系统中。根据本发明的一些实施例，所述短信提交报告和回执报告的处理系统还包括：压缩模块，用于对所述提交报告的value进行无用字段剔除与protobuf压缩。本发明的第三方面，提供了一种短信提交报告和回执报告的处理电子设备，包括至少一个控制处理器和用于与所述至少一个控制处理器通信连接的存储器；所述存储器存储有可被所述至少一个控制处理器执行的指令，所述指令被所述至少一个控制处理器执行，以使所述至少一个控制处理器能够执行上述的短信提交报告和回执报告的处理方法。本发明的第四方面，提供了一种计算机可读存储介质，所述计算机可读存储介质存储有计算机可执行指令，所述计算机可执行指令用于使计算机执行上述的短信提交报告和回执报告的处理方法。需要注意的是，本发明的第二方面至第四方面与现有技术之间的有益效果与上述的一种短信提交报告和回执报告的处理系统与现有技术之间的有益效果相同，此处不再细述。本发明的附加方面和优点将在下面的描述中部分给出，部分将从下面的描述中变得明显，或通过本发明的实践了解到。附图说明本发明的上述和/或附加的方面和优点从结合下面附图对实施例的描述中将变得明显和容易理解，其中：图1是本发明一实施例的一种短信提交报告和回执报告的处理方法的流程图；图2是本发明一实施例的一种短信提交报告和回执报告的处理方法的整体流程图；图3是本发明一实施例的一种短信提交报告和回执报告的处理方法的提交报告存储方案示意图；图4是本发明一实施例的一种短信提交报告和回执报告的处理系统的流程图。具体实施方式下面详细描述本发明的实施例，所述实施例的示例在附图中示出，其中自始至终相同或类似的标号表示相同或类似的元件或具有相同或类似功能的元件。下面通过参考附图描述的实施例是示例性的，仅用于解释本发明，而不能理解为对本发明的限制。在本发明的描述中，如果有描述到第一、第二等只是用于区分技术特征为目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征的数量或者隐含指明所指示的技术特征的先后关系。在本发明的描述中，需要理解的是，涉及到方位描述，例如上、下等指示的方位或位置关系为基于附图所示的方位或位置关系，仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此不能理解为对本发明的限制。本发明的描述中，需要说明的是，除非另有明确的限定，设置、安装、连接等词语应做广义理解，所属技术领域技术人员可以结合技术方案的具体内容合理确定上述词语在本发明中的具体含义。客户或者内部系统通过短信平台发送短信后，短信平台把短信提交给运营商后，运营商会返回两个报告，一个是提交报告用于反馈短信是否提交到运营商成功，一个是回执报告用于反馈短信是否发送到用户手机成功，两个报告运营商是异步返回，当回执报告返回时，需要跟提交报告进行匹配，匹配成功了才将回执报告返回给对应的客户和内部系统。但目前的方案是提交报告返回后会保存在本地内存库中，回执报告返回时会从内存库中获取提交报告进行匹配，由于提交报告存在本地内存库，回执报告需要返回到对应的节点才能进行匹配，所以存在单点问题；并且提交报告可能会比回执报告返回慢，导致匹配不成功的情况，目前的方案是将回执报告存到内存库，由专门的线程定时扫描存储待匹配回执的表跟保存提交报告的表进行匹配，这样效率低且不能处理多次匹配不上的情况。目前，有一些通过对电脑屏幕进行截图的方式来监控电脑使用情况，但是方法都比较复杂、成本高且容易伪造。为了解决上述技术缺陷，参照图1与图2，本发明还提供了一种短信提交报告和回执报告的处理方法，包括：步骤S101、接收来自运营商的回执报告。步骤S102、获取存储于redis分布式系统中的所有提交报告。步骤S103、将回执报告与所有提交报告进行匹配。步骤S104、若匹配成功则将回执报告返回给对应的客户和内部系统，并删除回执报告对应的存储于redis分布式系统中的提交报告。步骤S105、若匹配不成功则判断匹配次数是否达到预设的最大次数，若匹配次数达到预设的最大次数则结束匹配；若匹配次数未达到预设的最大次数，则根据回执报告生成对应的mq消息，并将mq消息投递到消息队列中进行等待，直至等待时间达到预设的延迟时间后再次将回执报告与所有提交报告进行匹配，依次类推，直至匹配成功或者达到到预设的最大次数则结束匹配。本方法通过接收来自运营商的回执报告；获取存储于redis分布式系统中的所有提交报告，解决了单点问题，将回执报告与所有提交报告进行匹配，若匹配成功则将回执报告返回给对应的客户和内部系统，并删除回执报告对应的存储于redis分布式系统中的提交报告，若匹配不成功则判断匹配次数是否达到预设的最大次数，若匹配次数达到预设的最大次数则结束匹配；若匹配次数未达到预设的最大次数，则根据回执报告生成对应的mq消息，并将mq消息投递到消息队列中进行等待，直至等待时间达到预设的延迟时间后再次将回执报告与所有提交报告进行匹配，依次类推，直至匹配成功或者达到到预设的最大次数则结束匹配，通过引入多次匹配机制解决了多次匹配不上的问题，节省了内存空间，提高了匹配效率。在一些实施例中，在获取存储于redis分布式系统中的所有提交报告之前，包括：接收来自运营商的提交报告。将提交报告以key:value形式存储于redis分布式系统中。原有的系统就有使用redis和mq中间件，因此不需要额外的运维部署工作，并且出现回执报告比提交报告先返回的情况是很少的，引入mq延迟消息的处理不会占用系统资源且不影响到正常的匹配流程。在一些实施例中，在将提交报告以key:value形式存储于redis分布式系统中之前，包括：对提交报告的value进行无用字段剔除与protobuf压缩。使用protobuf压缩value比原来节省存储空间。在一些实施例中，短信提交报告和回执报告的处理方法还包括：若提交报告的保存时间达到预先设置的过期时间，则删除提交报告。具体的，参照图3，在一些实施例中，将提交报告以key:value形式存储到redis分布式系统中，回执报告返回时从redis上获取提交报告进行匹配，这样接收回执报告的模块就能支持集群部署，不受限于本地内存库。对于value是保存了整个提交报告的内容，比较占用内存空间，对value进行无用字段剔除+protobuf的压缩来达到节省内存空间的效果；同时存储在redis的提交报告会设置过期时间，防止redis内存被占满。在一些实施例中，随着匹配次数的增加，对应的预设的延迟时间变长。具体的，在一些实施例中，由于提交报告比回执返回的慢，当回执报告先回到接收模块，就会出现匹配失败的情况，出现匹配失败时，会把待回执的回执生成mq的延迟消息，然后发送到mq上，等待到了延迟的时间才再次进行匹配，如果再次匹配不上就加长延迟时间，随着匹配次数的增加，对应的延迟时间也会增加，最大匹配次数是5次，匹配的延迟时间如表1所示。表1匹配次数延迟时间110s21m35m41h51h另外，参照图4，本发明的一个实施例，提供一种短信提交报告和回执报告的处理系统，包括回执报告接收模块1100、提交报告获取模块1200、报告匹配模块1300以及报告处理模块1400，其中：回执报告接收模块1100用于接收来自运营商的回执报告；提交报告获取模块1200用于获取存储于redis分布式系统中的所有提交报告；报告匹配模块1300用于将回执报告与所有提交报告进行匹配；报告处理模块1400用于若匹配成功则将回执报告返回给对应的客户和内部系统，并删除回执报告对应的存储于redis分布式系统中的提交报告；若匹配不成功则判断匹配次数是否达到预设的最大次数，若匹配次数达到预设的最大次数则结束匹配；若匹配次数未达到预设的最大次数，则根据回执报告生成对应的mq消息，并将mq消息投递到消息队列中进行等待，直至等待时间达到预设的延迟时间后再次将回执报告与所有提交报告进行匹配，依次类推，直至匹配成功或者达到到预设的最大次数则结束匹配。本系统通过接收来自运营商的回执报告；获取存储于redis分布式系统中的所有提交报告，解决了单点问题，将回执报告与所有提交报告进行匹配，若匹配成功则将回执报告返回给对应的客户和内部系统，并删除回执报告对应的存储于redis分布式系统中的提交报告，若匹配不成功则判断匹配次数是否达到预设的最大次数，若匹配次数达到预设的最大次数则结束匹配；若匹配次数未达到预设的最大次数，则根据回执报告生成对应的mq消息，并将mq消息投递到消息队列中进行等待，直至等待时间达到预设的延迟时间后再次将回执报告与所有提交报告进行匹配，依次类推，直至匹配成功或者达到到预设的最大次数则结束匹配，通过引入多次匹配机制解决了多次匹配不上的问题，节省了内存空间，提高了匹配效率。在一些实施例中，短信提交报告和回执报告的处理系统还包括：提交报告接收模块，用于接收来自运营商的提交报告；存储模块，用于将提交报告以key:value形式存储于redis分布式系统中。在一些实施例中，短信提交报告和回执报告的处理系统还包括：压缩模块，用于对提交报告的value进行无用字段剔除与protobuf压缩。需要注意的是，本系统实施例与上述的系统实施例是基于相同的发明构思，因此上述方法实施例的相关内容同样适用于本系统实施例，这里不再赘述。本申请还提供一种短信提交报告和回执报告的处理电子设备，包括：存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，处理器执行计算机程序时实现：如上述的短信提交报告和回执报告的处理方法。处理器和存储器可以通过总线或者其他方式连接。存储器作为一种非暂态计算机可读存储介质，可用于存储非暂态软件程序以及非暂态性计算机可执行程序。此外，存储器可以包括高速随机存取存储器，还可以包括非暂态存储器，例如至少一个磁盘存储器件、闪存器件、或其他非暂态固态存储器件。在一些实施方式中，存储器可选包括相对于处理器远程设置的存储器，这些远程存储器可以通过网络连接至该处理器。上述网络的实例包括但不限于互联网、企业内部网、局域网、移动通信网及其组合。实现上述实施例的短信提交报告和回执报告的处理方法所需的非暂态软件程序以及指令存储在存储器中，当被处理器执行时，执行上述实施例中的短信提交报告和回执报告的处理方法，例如，执行以上描述的图1中的方法步骤S101至步骤S105。本申请还提供一种计算机可读存储介质，存储有计算机可执行指令，计算机可执行指令用于执行：如上述的短信提交报告和回执报告的处理方法。该计算机可读存储介质存储有计算机可执行指令，该计算机可执行指令被一个处理器或控制器执行，例如，被上述电子设备实施例中的一个处理器执行，可使得上述处理器执行上述实施例中的短信提交报告和回执报告的处理方法，例如，执行以上描述的图1中的方法步骤S101至步骤S105。本领域普通技术人员可以理解，上文中所公开方法中的全部或某些步骤、系统可以被实施为软件、固件、硬件及其适当的组合。某些物理组件或所有物理组件可以被实施为由处理器，如中央处理器、数字信号处理器或微处理器执行的软件，或者被实施为硬件，或者被实施为集成电路，如专用集成电路。这样的软件可以分布在计算机可读介质上，计算机可读介质可以包括计算机存储介质和通信介质。如本领域普通技术人员公知的，术语计算机存储介质包括在用于存储信息的任何方法或技术中实施的易失性和非易失性、可移除和不可移除介质。计算机存储介质包括但不限于RAM、ROM、EEPROM、闪存或其他存储器技术、CD-ROM、数字多功能盘或其他光盘存储、磁盒、磁带、磁盘存储或其他磁存储装置、或者可以用于存储期望的信息并且可以被计算机访问的任何其他的介质。此外，本领域普通技术人员公知的是，通信介质通常包含计算机可读指令、数据结构、程序单元或者诸如载波或其他传输机制之类的调制数据信号中的其他数据，并且可包括任何信息递送介质。上面结合附图对本发明实施例作了详细说明，但本发明不限于上述实施例，在所属技术领域普通技术人员所具备的知识范围内，还可以在不脱离本发明宗旨的前提下作出各种变化。
