标题title
基于自适应计数方式的低功耗读出电路
摘要abst
本发明涉及集成电路技术领域，为在保证SS ADC低噪声、高线性度的前提下，显著降低SS ADC的功耗，本发明，基于自适应计数方式的低功耗读出电路，包括：斜坡发生器、全局计数器、低功耗比较器、M‑bit锁存器、逻辑单元、N‑bit U/D DDR计数器；斜波发生器连接到低功耗比较器的反相输入端，低功耗比较器的同相输入端输入像素感光信号，低功耗比较器输出端连接到逻辑单元和全局计数器，全局计数器输出到M‑bit锁存器和逻辑单元，逻辑单元向N‑bit U/D DDR计数器发出控制信号。本发明主要应用于集成电路设计制造场合。
权利要求书clms
1.一种基于自适应计数方式的低功耗读出电路，其特征是，包括两部分全局电路：斜坡发生器和M-bit全局计数器；4部分列级电路：低功耗比较器、M-bit锁存器、逻辑单元、N-bitU/D DDR计数器；斜波发生器连接到低功耗比较器的反相输入端，低功耗比较器的同相输入端输入像素感光信号，低功耗比较器输出端连接到逻辑单元和M-bit全局计数器，M-bit全局计数器输出M-bit计数结果Qglobal＜1:M＞到M-bit锁存器和逻辑单元，每列M-bit锁存器会在下一个行周期将存储的Qglobal＜1:M＞作为每列的高M-bit计数结果Qlocal＜N-M+1:N＞输出至逻辑单元，逻辑单元向N-bit U/D DDR计数器发出控制信号。2.如权利要求1所述的基于自适应计数方式的低功耗读出电路，其特征是，N-bit U/DDDR计数器包括一个DDR计数结构、内建控制单元和一个-bit U/D计数器，-bitDDR计数结构需要保证时钟初始输入状态为已知，通过count_en和count_enb控制计数的开始和停止，其中count_enb为count_en取反，在DDR计数结构中，count_enb和count_en与时钟分别经过一个与非门和或非门，与非门输出的时钟一定以下降沿开始，上升沿结束；或非门输出的时钟一定以上升沿开始，下降沿结束，所以，当输入偶数个触发沿时，或非门和与非门输出上升沿数量相差1，当输入奇数个触发沿时，或非门和与非门输出上升沿数量相差0，与非门和或非门各自连接一个D触发器的时钟控制端将该差异保存，两个D触发器的输出经过后方的异或门判断输入的边沿为奇数还是偶数，异或门后接接内建控制单元的输入端，从而确定最低位输出；在控制单元内部，内建控制单元的输入端接入了或非门输入端，与carry信号一同经D触发器完成最低位量化；D触发器的正负输出端接两输入多路选择器，carry信号和UD信号共同控制该多路选择器的选通，以此控制计数器最低位至次低位的进位；内建控制单元接-bit U/D计数器时钟输入端，控制后面的该计数器完成计数。3.如权利要求1所述的基于自适应计数方式的低功耗读出电路，其特征是，在逻辑单元中：Qglobal＜1:M＞与锁存器中存储的上一个周期的量化结果Qlocal＜N-M+1:N＞经一个数字比较器进行比较，该比较器由同或门和与非门交替串联构成，数字比较器的比较结果成为信号lp_sig。lp_sig为计数起止和计数方向控制信号，该信号传输至一个或非门，作为时钟驱动一个D触发器，D触发器可将lp_sig的上升沿识别并传输至输出端，counter_UD为计数器计数方向控制信号，该信号与上述D触发器的一端输出经异或门，共同控制计数器的计数方向，异或门的输出接传输门，传输门控制信号为比较器输出，传输门输出动态计数方向控制信号UD，如此实现：若实际比较结果比预测结果大，那么异或门输出在比较器跳变之前变化，便使计数方向发生改变；若实际比较结果比预测结果小，那么比较器先发生跳变，那么开关关闭，计数方向不变；如此便可实现计数方向的动态调整，保证计数方向的正确；D触发器的另一端输出与比较器输出comp作为异或门的两个输入端，异或门输出端初始状态为低电平。当异或门的两个输入中一个信号发生改变时，异或门输出变为高电平，当另一个信号也发生改变时，异或门输出变回低电平。异或门输出为高电平时计数器工作，counter_en为控制计数器工作的使能信号，异或门输出与counter_en信号经与门产生计数起止控制信号count_en；另外，将输入的时钟信号连接D触发器，counter_HD为计数器保持信号，输出一个动态保持信号HD，该信号控制D触发器处于锁存状态，无法再计数。
说明书desc
技术领域本发明涉及集成电路技术领域，特别是涉及一种基于自适应计数方式的低功耗读出电路结构。背景技术列并行单斜模数转换器由于其结构简单、线性度高等优点在CMOS图像传感器中得到了较为广泛的应用。但是，随着集成度和工作频率不断提高，传统列并行SS ADC的功耗越来越难以控制和减小，成为限制列并行SS ADC速度和稳定性的主要因素之一。SS ADC的功耗主要来源于两个方面，一方面是来自比较器的静态功耗，另一方面则是来自计数器的动态功耗。静态功耗方面由于不受频率影响，降低比较器电流便可实现极低的功耗；在动态功耗方面，现在主流采用的为DDR计数器，可将工作时钟降低一倍。但是受限于SS ADC的工作方式，随着CIS芯片工作频率的升高，如何实现计数的超低功耗仍是SS ADC发展的关键课题。发明内容为克服现有技术的不足，针对SS ADC动态功耗过高的问题，基于传统4T像素接收到的光信号不会发生突变的原理，本发明旨在提出带有自适应功能的低功耗计数方式及相应的电路结构。在保证SS ADC低噪声、高线性度的前提下，仅改变计数方式，显著降低SSADC的功耗。为此，本发明采取的技术方案是，基于自适应计数方式的低功耗读出电路，包括两部分全局电路：斜坡发生器和M-bit全局计数器；4部分列级电路：低功耗比较器、M-bit锁存器、逻辑单元、N-bit U/D DDR计数器；斜波发生器连接到低功耗比较器的反相输入端，低功耗比较器的同相输入端输入像素感光信号，低功耗比较器输出端连接到逻辑单元和M-bit全局计数器，M-bit全局计数器输出M-bit计数结果Qglobal＜1:M＞到M-bit锁存器和逻辑单元，每列M-bit锁存器会在下一个行周期将存储的Qglobal＜1:M＞作为每列的高M-bit计数结果Qlocal＜N-M+1:N＞输出至逻辑单元，逻辑单元向N-bit U/D DDR计数器发出控制信号。N-bit U/D DDR计数器包括一个DDR计数结构、内建控制单元和一个-bit U/D计数器，-bit DDR计数结构需要保证时钟初始输入状态为已知，通过count_en和count_enb控制计数的开始和停止，其中count_enb为count_en取反，在DDR计数结构中，count_enb和count_en与时钟分别经过一个与非门和或非门，与非门输出的时钟一定以下降沿开始，上升沿结束；或非门输出的时钟一定以上升沿开始，下降沿结束，所以，当输入偶数个触发沿时，或非门和与非门输出上升沿数量相差1，当输入奇数个触发沿时，或非门和与非门输出上升沿数量相差0，与非门和或非门各自连接一个D触发器的时钟控制端将该差异保存，两个D触发器的输出经过后方的异或门判断输入的边沿为奇数还是偶数，异或门后接接内建控制单元的输入端，从而确定最低位输出；在控制单元内部，内建控制单元的输入端接入了或非门输入端，与carry信号一同经D触发器完成最低位量化；D触发器的正负输出端接两输入多路选择器，carry信号和UD信号共同控制该多路选择器的选通，以此控制计数器最低位至次低位的进位；内建控制单元接-bit U/D计数器时钟输入端，控制后面的该计数器完成计数。在逻辑单元中：Qglobal＜1:M＞与锁存器中存储的上一个周期的量化结果Qlocal＜N-M+1:N＞经一个数字比较器进行比较，该比较器由同或门和与非门交替串联构成，数字比较器的比较结果成为信号lp_sig。lp_sig为计数起止和计数方向控制信号，该信号传输至一个或非门，作为时钟驱动一个D触发器，D触发器可将lp_sig的上升沿识别并传输至输出端，counter_UD为计数器计数方向控制信号，该信号与上述D触发器的一端输出经异或门，共同控制计数器的计数方向，异或门的输出接传输门，传输门控制信号为比较器输出，传输门输出动态计数方向控制信号UD，如此实现：若实际比较结果比预测结果大，那么异或门输出在比较器跳变之前变化，便使计数方向发生改变；若实际比较结果比预测结果小，那么比较器先发生跳变，那么开关关闭，计数方向不变；如此便可实现计数方向的动态调整，保证计数方向的正确；D触发器的另一端输出与比较器输出comp作为异或门的两个输入端，异或门输出端初始状态为低电平。当异或门的两个输入中一个信号发生改变时，异或门输出变为高电平，当另一个信号也发生改变时，异或门输出变回低电平。异或门输出为高电平时计数器工作，counter_en为控制计数器工作的使能信号，异或门输出与counter_en信号经与门产生计数起止控制信号count_en；另外，将输入的时钟信号连接D触发器，counter_HD为计数器保持信号，输出一个动态保持信号HD，该信号控制D触发器处于锁存状态，无法再计数。本发明的特点及有益效果是：本发明提出了一种具有自适应计数方式的低功耗SS ADC，通过上一个行周期对计数结果进行预测，仅需量化残差时完成高频计数，大大节省了功耗，尤其适用于动态范围较低的场景下。同时，通过改进DDR计数器结构，仅需计数时驱动计数器工作，可进一步节省来自高频时钟的功耗，最终以极低的动态功耗完成量化。附图说明：图1具有自适应功能计数的低功耗ADC工作原理图。图2具有自适应计数功能的低功耗ADC的结构简图。图3 N-bit U/D DDR计数器原理图。图4逻辑单元原理图。图5具有自适应计数功能的低功耗ADC的计数器部分工作时序图。具体实施方式本发明所述的一种基于自适应计数方式的低功耗读出电路的基本工作原理如图1所示。与传统的SS ADC相比，本设计的核心思路为量化上一个行周期与本行周期之间的残差。如图1所示，在第n个行周期，在列计数器完成量化的同时，通过一个工作频率更慢的全局计数器同步完成量化。在第n+1个行周期，列计数器的初始值为第n个行周期全局计数器的量化结果，只需要在此基础上量化该初始值与第n+1个行周期之间的差值即可完成第n+1个行周期的量化。本发明所述的一种基于自适应计数方式的低功耗读出电路的电路结构如图2所示。整体电路结构由6个主要部分构成，包括斜坡发生器和M-bit全局计数器两部分全局电路和低功耗比较器、M-bit锁存器、逻辑单元、N-bit U/D DDR计数器4部分列级电路组成。本发明核心电路结构中的N-bit U/D DDR计数器的详细原理图如图3所示。该计数器由一个改进的DDR计数结构，内建控制单元和一个传统-bit U/D计数器组成。传统的DDR计数结构需要保证时钟初始输入状态为已知，即开始计数时，计数器输入时钟必须固定的从‘0’开始，否则便会计数错误，这显然难以满足本发明计数方式的需求。本发明中的计数器在传统DDR计数器基础上对最低位的电路结构进行了改进，其主要特点便是可以随机截取一段时钟完成双数据率计数。在该计数器中，通过count_en控制计数的开始和停止，该信号与时钟分别经过一个与非门和或非门。与非门输出的时钟一定以下降沿开始，上升沿结束；或非门输出的时钟一定以上升沿开始，下降沿结束。所以，当输入偶数个触发沿时，或非门和与非门输出上升沿数量相差1，当输入奇数个触发沿时，或非门和与非门输出上升沿数量相差0。与非门和或非门各自连接一个D触发器的时钟控制端将该差异保存。两个D触发器的输出经过后方的异或门可以判断输入的边沿为奇数还是偶数。异或门后接接内建控制单元的输入端，从而确定最低位输出。在控制单元内部，该信号接入了或非门输入端，与carry信号一同经D触发器完成最低位量化。D触发器的正负输出端接两输入多路选择器，carry信号和UD信号共同控制该多路选择器的选通，以此控制计数器最低位至次低位的进位。内建控制单元接-bit U/D计数器时钟输入端，控制后面的异步计数器完成计数。本发明核心电路结构中的逻辑单元的详细原理图如图4所示，该单元用于产生动态计数方向控制信号UD、动态保持信号HD和计数起止信号count_en。Qglobal＜1:M＞与锁存器中存储的上一个周期的量化结果Qlocal＜N-M+1:N＞经一个数字比较器完成比较，该数字比较器由异或门和与非门交替串联构成，输出一个控制信号lp_sig，该信号传输至一个或非门，作为时钟驱动一个D触发器，D触发器可将lp_sig的上升沿识别并传输至输出端。D触发器的一端输出与counter_UD经异或门，共同控制计数器的计数方向。异或门的输出接传输门，传输门控制信号为比较器输出，如此可以实现这样的功能：若实际比较结果比预测结果大，那么异或门输出在比较器跳变之前变化，便可以使计数方向发生改变；若实际比较结果比预测结果大，那么比较器先发生跳变，那么开关关闭，计数方向不变。如此便可实现计数方向的动态调整，保证计数方向的正确。D触发器的另一端输出与比较器输出comp经异或门，两个输入中一个信号发生改变时异或门输出变为高电平，另一个信号也发生改变时异或门输出变回低电平，形成计数区间。异或门输出与counter_en信号经与门产生计数有效信号count_en。另外，对时钟同步计数进行了改进，如图4右下部分电路。将送入的时钟连接D触发器，输出为动态保持信号HD。该改进电路有两个优点，一方面，HD未变为高电平前，计数器处于锁存状态，只有时钟上升沿到来时，才可以计数，可保证时钟同步。另一方面，保证UD发生改变时，计数器仍处于锁存状态，不会由于计数方向切换使计数器发生进位。本发明中列级电路的外部输入控制信号波形如图5所示，信号波形与图2、图3和图4中的同名信号一一对应。本发明利用像素接收到的光信号不会产生突变的特点，通过前一行周期对后一行周期进行预测的方法，提出了一种具有自适应功能的计数方式和电路结构。与现有的计数方式相比，本发明通过预测的方式使计数器翻转数量大幅减少，从而降低了功耗，尤其适用于动态范围较低的成像条件下。本发明在传统DDR计数器的基础上，改进了最低位计数结构，使时钟不必一直工作，可任意截取某段未知初始状态时钟完成正确计数，进一步降低功耗，实现了一种应用于CIS的低功耗SS ADC。由上述技术方案可知，低功耗SS ADC的整体电路结构如图2所示，结合图1，本发明所提出的低功耗SS ADC的工作过程如下：首先，在第n个行周期，当像素信号pixel与斜坡信号ramp相等时，比较器输出comp发生翻转，控制M-bit锁存器由透明状态进入锁存状态，将全局计数结果保存为Qlocal＜N-M+1:N＞；在第n+1个行周期，复位阶段将全局计数器复位为0，而将列计数器高M-bit复位为Qlocal＜N-M+1:N＞，低-bit复位为0。当斜坡开始下降时，全局计数器开始工作，而列计数器的计数过程可以分成两种情况。若comp先发生翻转，如图1中的t1时刻，那么计数器开始向下计数，至t2时刻为止。其中t2时刻即为全局计数器的输出与Qlocal＜N-M+1:N＞相同的时刻，该时刻逻辑单元会向列计数器发送计数截止信号；若comp后发生翻转，如图1中的t3时刻，那么计数器自t2时刻开始向上计数，至t3时刻停止。经过上述步骤，可以保证计数的准确性，实现动态功耗的降低。本发明中N-bit U/D DDR计数器如图3所示，其工作过程如下：行周期开始阶段，逻辑单元通过控制D触发器的Reset信号和Set信号对计数器进行置位，使其等于上周期全局计数器输出结果；量化开始阶段，count_en为低电平，时钟CLK未驱动任何电路，此时功耗极低，且或非门输出一定为‘0’，与非门输出一定为‘1’；计数阶段，count_en变为高电平，时钟开始驱动后面的D触发器开始计数。当count_en变为低电平时，或非门输出变为‘0’，与非门输出变为‘1’。利用这样的特点，当count_en高电平持续时间对应偶数个时钟沿时，与非门和或非门输出的上升沿数相差为1；当count_en高电平持续时间对应奇数个时钟沿时，与非门和或非门输出的上升沿数相差为0。通过一个异或门可将两者差异区分，如此可以完成DDR计数器最低位的计数。其余位计数器正常计数。在计数完成后，由carry控制最低位完成计数和进位，整个计数过程结束。本发明中逻辑单元如图4所示，该部分为计数器提供控制信号，其工作过程如下：复位阶段，将Qlocal＜N-M+2:N＞传输至比较单元，Qlocal＜N-M+1＞恒为‘1’，这可以保证所有情况下比较的延时相同且最短。当Qglobal＜1:M＞与Qlocal＜N-M+1:N＞相同时，lp_sig变为高电平，控制后面的寄存器输出Q由低电平变为高电平。寄存器输出信号与比较器输出信号进行异或，可以得到列计数器所需要的工作区间count_en和计数器计数方向UD。本发明在11-bit SS ADC，6-bit全局计数器，250MHz工作条件下，当计数结果落入预测区间时，最高可将每列动态功耗降至传统SS ADC的10％以下。以上所述，仅为本发明的具体实施方式，但本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明披露的技术范围内，可轻易想到的变化或替换，都应涵盖在本发明的保护范围之内。
