标题title
一种基于云端NAS的离线下载方法及存储介质
摘要abst
本发明提供了一种基于云端NAS的离线下载方法及存储介质，所述方法包括：待认证设备发出离线下载请求指令及离线下载信息，服务器将接收到的离线下载请求指令及离线下载信息并发送到目标云端，目标云端接收离线下载请求指令及离线下载信息，并发送到目标NAS插件，目标NAS插件接收离线下载请求指令及离线下载信息，通过互联网将下载内容离线下载到目标云端，本发明可以直接从云端进行拉取视频等流畅观看，减少了从服务器下载到智能设备的过程，使得用户更快速、流畅的使用网络上的资源。
权利要求书clms
1.一种基于云端NAS的离线下载方法，用于待认证设备通过服务器进行离线下载，其特征在于，所述方法包括如下步骤：S200，待认证设备发出离线下载请求指令及离线下载信息，所述离线下载信息至少包括下载地址；S210，服务器接收离线下载请求指令及离线下载信息，并发送到目标云端，其中，所述目标云端为与所述待认证设备部署位置对应的目标NAS云端；S220，目标云端通过互联网将接收的离线下载请求指令及离线下载信息发送到目标NAS插件，所述目标NAS插件为部署于与待认证设备部署位置对应的智能网关中的NAS插件；S230，目标NAS插件接收离线下载请求指令及离线下载信息，通过互联网将下载内容离线下载到目标云端，所述目标云端和所述目标NAS插件对应。2.根据权利要求1所述的离线下载方法，其特征在于，在离线下载过程中进行加速下载，包括以下步骤：S300，获取4G或5G网络在第二预设时间段内的丢包数量Q1和宽带网络在第二预设时间段内的丢包数量Q2；S310，当Q1-Q2＞Q时，将宽带网络作为目标网络，使用目标网络在离线过程中进行加速下载，其中，Q是预设误差阈值；S320，当Q2-Q1＞Q时，将4G或5G网络作为目标网络，使用目标网络在离线过程中进行加速下载；S330，当|Q2-Q1|＜Q时，基于4G或5G网络在当前时间节点的网络速度C1和宽带网络的在当前时间节点的网络速度C2确定目标网络，使用目标网络在离线过程中进行加速下载。3.根据权利要求2所述的离线下载方法，其特征在于，在S330中，基于4G或5G网络在当前时间节点的网络速度C1和宽带网络的在当前时间节点的网络速度C2确定目标网络包括如下步骤：S3301，当C2＞C1时，将宽带网络作为目标网络；S3302，当C2≤C1，将4G或5G网络作为目标网络。4.根据权利要求2所述的离线下载方法，其特征在于，在S300前还包括：S290，识别用户网络情况，当用户的4G或5G网络和宽带网络均能正常使用时，执行S300。5.根据权利要求2所述的离线下载方法，其特征在于，S300中，获取4G或5G网络在第二预设时间段内的丢包数量Q1包括：获取用户使用4G或5G网络在当前时间节点前30min内的丢包数量Q1。6.根据权利要求2所述的离线下载方法，其特征在于，S300中，获取4G或5G网络在第二预设时间段内的丢包数量Q1包括如下步骤：S301，获取在4G或5G网络状态下，用户在n个历史时间段分别包含的第二预设时间段内的丢包数量列表D={D1，D2，…，Dj，…，Dn}，Dj是用户使用4G或5G在第j个历史时间段包含的第二预设时间段内的丢包数量，j的取值范围是1到n；S302，获取Q1=×∑nj=1 Dj。7.根据权利要求2所述的离线下载方法，其特征在于，S300中，获取宽带网络在第二预设时间段内的丢包数量Q2包括：获取用户使用宽带网络在当前时间节点前30min内的丢包数量Q2。8.根据权利要求2所述的离线下载方法，其特征在于，S300中，获取宽带网络在第二预设时间段内的丢包数量Q2包括如下步骤：S3011，获取在宽带网络状态下，用户在n个历史时间段分别包含的第二预设时间段内丢包数量列表F={F1，F2，…，Fj，…，Fn}，Fj是用户使用宽带在第j个历史时间段包含的第二预设时间段内的丢包数量，j的取值范围是1到n；S3012，获取Q2=×∑nj=1 Fj。9.一种非瞬时性计算机可读存储介质，所述非瞬时性计算机可读存储介质中存储有至少一条指令或至少一段程序，其特征在于，所述至少一条指令或所述至少一段程序由处理器加载并执行以实现如权利要求1-8中任意一项所述的离线下载方法。
说明书desc
技术领域本发明涉及计算机领域，特别是涉及一种基于云端NAS的离线下载方法及存储介质。背景技术离线下载是下载工具的服务器代替电脑用户先行下载，比如，电脑用户的正常下载最大速度能达到200KB/S，但是某个资源是冷门资源，下载速度只能达到10KB/S，电脑用户就得下很久，如果用户使用离线下载技术，就可以让服务商的服务器代替电脑用户下载，电脑用户就可以关掉下载工具或者机器，节约时间和电费，等到离线下好了，电脑用户再从下载工具的服务器上以200KB/S的速度下到自己的电脑上，但离线下载在现有技术仍需要从网上下载到服务器，再从服务器下载到电脑，过程较为繁琐。发明内容针对上述技术问题，本发明采用的技术方案为：一种基于云端NAS的离线下载方法，用于待认证设备通过服务器进行离线下载，所述方法包括如下步骤：S200，待认证设备发出离线下载请求指令及离线下载信息，所述离线下载信息至少包括下载地址。S210，服务器接收离线下载请求指令及离线下载信息，并发送到目标云端。S220，目标云端通过互联网接收离线下载请求指令及离线下载信息，并发送到目标NAS插件，所述目标NAS插件为部署于与待认证设备的位置对应的智能网关中的NAS插件。S230，目标NAS插件接收离线下载请求指令及离线下载信息，通过互联网将下载内容离线下载到目标云端，所述目标云端和所述目标NAS插件对应。本发明的另一方面还公开了一种非瞬时性计算机可读存储介质，所述非瞬时性计算机可读存储介质中存储有至少一条指令或至少一段程序，所述至少一条指令或所述至少一段程序由处理器加载并执行以实现如前所述的方法。本发明至少具有以下有益效果：基于上述，待认证设备发出离线请求指令及离线下载信息，服务器接收离线请求指令及离线下载信息并发送到目标云端，在通过目标云端发送到NAS插件，NAS插件从互联网上下载到目标云端，现有技术中使用离线下载技术，一般是用服务商的服务器代替智能设备用户进行下载，等到下载完成，智能设备再从服务商的服务器上下载到用户的智能设备上，本发明不需要智能设备从服务器进行下载，可以直接从云端进行拉取，在局域网内的网速足够视频等流畅观看，减少了从服务器下载到智能设备的过程，使得用户更快速、流畅的使用网络上的资源。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例1提供的一种基于云端NAS的设备迁移系统执行计算机程序时的流程图；图2为本发明实施例2提供的一种基于云端NAS的离线下载方法的流程图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域技术人员在没有作出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。实施例1本发明实施例提供了一种基于云端NAS的数据迁移系统，所述系统包括第一云端、部署在与第一云端对应的智能网关中的第一NAS插件、存储器和服务器，所述存储器存储有账号使用习惯特征列表集A={A1，A2，…，Aj，…，An}，其中，云端NAS的第j个用户的账号使用习惯特征列表Aj=，j的取值范围为1到n，n为云端NAS用户数量，i的取值范围是1到m，m是云端NAS用户的账号使用习惯特征数量；进一步，所述存储器还存储有计算机程序，当服务器执行计算机程序时，实现如下步骤：S100，获取目标用户发出的数据迁移请求指令及数据迁移信息，所述数据迁移信息至少包括目标迁移位置、目标用户设备ID、目标用户设备ID的云端NAS原始账号。S110，基于目标迁移位置获取目标云端和目标云端对应的目标NAS插件。本申请中，所述目标NAS插件部署在目标迁移位置对应的智能网关中，所述智能网关例如可以是路由器等。所述目标迁移位置为一具体的地理位置信息，例如，某市某行政区某居民区某居民楼某户，在本申请中，所述目标迁移位置、目标云端以及目标NAS插件之间具有一一对应关系，即，可通过给出的目标迁移位置获取与该目标迁移位置对应的目标云端以及目标NAS插件。具体的，该对应关系可以多种形式保存在所述存储器中，其保存方式可以为现有技术中的任何一种，例如表格。S120，基于所述目标NAS插件，获取目标迁移位置对应的宽带ID，并在目标云端上注册临时使用账号，所述临时使用账号用于存储所述目标用户在第一预设时间段内的全部数据。由于目标NAS插件部署在智能网关中，而智能网关和宽带ID之间具有一一对应关系，因此，可以通过目标NAS插件查找到对应的宽带ID。具体的，第一NAS插件和第一云端直接进行数据通讯，不需要经过其他任意一个节点；所述宽带ID是宽带的唯一标识，例如宽带识别码。S130，基于所述目标NAS插件，获取连接宽带ID的待认证设备的设备ID，当待认证设备的设备ID和目标用户设备ID相同时，执行S140。具体的，本领域技术人员知晓，现有技术中任何一种连接宽带ID的设备的方法均属于本发明保护范围，此处不再赘述。具体的，所述待认证设备ID是待认证设备的唯一标识。S140，获取待认证设备在第一预设时间段内的用户使用习惯特征值列表B={B1，B2，…，Bi，…，Bm}，Bi是待认证设备的使用用户的第i个设备使用习惯特征的特征值。具体的，所述设备使用习惯特征至少包括：手机开关机时间、手机开关机频率、使用的APP列表、APP使用时间和频率，当然，本发明中的使用习惯特征并不局限于此，还可以是其他的使用习惯特征。具体的，所述第一预设时间段可根据实际需要输入，在本发明一实施例中，所述第一预设时间段为7天。具体的，在第一预设时间段内，基于账号使用习惯特征列表，对待认证设备的特征进行打分，从而获取特征值列表，可以理解为，特征值用于表征在该使用习惯特征上，待认证设备ID的用户和目标用户的相似程度，当特征值越大，表示待认证设备ID的用户是目标用户的概率越高，当特征值越小，表示待认证设备ID的用户是目标用户的概率越低。进一步的，所述临时使用账号用于在第一预设时间段内进行离线下载，且，在第一预设时间段内，待认证设备不能访问原始账号。S150，获取待认证设备的目标特征值B0=×∑mi=1，其中，与目标用户设备ID的云端NAS原始账号的账号使用习惯特征列表Aj对应的特征权重列表Kj={Kj1，Kj2，…，Kji，…，Kjm}，Kji是Aji对应的权重值。具体的，所述特征权重列表可根据实际情况设置。S160，当B0大于第一预设阈值时，确认待认证设备对应的用户为目标用户，将原始账号及原始账号存储的数据从第一云端迁移到目标云端。具体的，所述第一预设阈值可根据实际需求确定，例如第一预设阈值=0.8×∑mi=1Ki，当B0大于第一预设阈值，将原始账号及原始账号存储的数据从第一云端迁移到目标云端，在迁移过程中，目标用户是无感知的。具体的，在S160后还包括，在确定待认证设备对应的用户为目标用户后，目标用户进行访问迁移后的原始账号，可以理解为，在确定待认证设备ID对应的用户为目标用户之前，待认证设备不能访问原始账号，用于保证目标用户存储在第一云端的数据的安全，在确认待认证设备ID对应的用户为目标用户后，目标用户可以进行访问迁移后的原始账号，保证目标用户对原始账号的正常使用。进一步的，将原始账号及原始账号存储的数据从第一云端迁移到目标云端后还包括以下步骤：S1501，获取临时使用账号存储的数据对应的下载地址列表。S1502，获取原始账号存储的数据对应的下载地址列表。S1503，将临时使用账号的下载地址列表中，和原始账号的下载地址重复的下载地址进行标记。S1504，将临时使用账号中标记的下载地址对应的数据进行删除，并将删除后的临时使用账号的下载地址列表及对应的数据传输到原始账号。具体的，临时使用账号的下载地址列表中存储着第一预设时间段内，待认证设备下载的数据的下载地址，对于同一用户，下载的资源很可能重复，例如用户喜欢某一电影，在第一预设时间段内再次下载了该电影，所以对临时使用账号中的重复的下载地址进行标记，并对标记的下载地址对应的数据进行删除，保证将临时使用账号的数据传输到原始账号时，数据没有重复，实现自动化帮用户节约资源。进一步的，所述目标NAS插件可实现自动挂载功能，包括如下步骤：S001，目标NAS插件获取宽带ID，并向服务器注册请求指令。S002，服务器返回临时使用账号、密码和服务器的第一端口。具体的，所述第一端口用于服务器和外界进行通讯交流，进一步的，所述第一端口为服务器的samba端口。S003，目标NAS插件进行第一端口的转发，将第一端口映射到宽带上的第二端口。具体的，所述第二端口为与第一端口映射到的端口，进一步的，所述第二端口为内网的标准samba服务端口445。S004，目标NAS插件运行设备发现服务和命名指定服务。具体的，所述设备发现服务用于在宽带的局域网内提供待认证设备发现服务，例如设备发现服务可以为wsdd2服务；所述命名指定服务指定“MYNAS”为NETBIOS名，指定“MYNAS”为NETBIOS名可以理解为，让局域网内的待认证设备和目标云端进行数据传输，例如所述命名指定服务为nmbd服务。S005，在待认证设备访问网上邻居时，通过所述设备发现服务获取关联信息。具体的，所述关联信息为MYNAS关联的NETBIOS信息。基于上述，本发明实施例提供了一种基于云端NAS的数据迁移系统，用于在目标用户进行搬家时，目标用户对应的目标云端发生变化，获取目标用户发出的待认证数据迁移请求指令及待认证数据迁移信息，基于NAS插件，获取目标迁移位置对应的宽带ID，并在目标云端上注册临时使用账号，用于在第一预设时间段内存储目标用户的数据，基于NAS插件，获取连接宽带ID的待认证设备ID，当待认证设备ID=目标设备ID时，获取目标用户在第一预设时间段内的特征值列表，并和权重对应相乘，获取目标用户的目标特征值，根据目标特征值判断是否为目标用户，当判断为是目标用户时，将原始账号和原始账号对应的数据进行迁移到目标云端，实现了用户在进行搬家等操作时，云端的原始账号随之进行变化。本发明在云端在认证为同一用户的情况下进行数据的迁移，既保证了待认证设备的使用者为目标用户，又在用户无感知的情况下进行了数据的同步，避免了设备被偷走、设备使用者改变等情况继续访问云端的情况，且在认证为目标用户后，进行了数据的去重、同步，保证了用户的正常使用。实施例2在实施例1的基础上，本发明提出了一种基于云NAS的离线下载方法，用于临时使用账号在第一预设时间段内进行离线下载，如图2所示，实现如下步骤：S200，待认证设备发出离线下载请求指令及离线下载信息，所述离线下载信息至少包括下载地址。S210，服务器接收离线下载请求指令及离线下载信息，并发送到目标云端，其中，所述目标云端为与所述待认证设备部署位置对应的目标NAS云端。S220，目标云端通过互联网将接收的离线下载请求指令及离线下载信息发送到目标NAS插件，所述目标NAS插件为部署于与待认证设备部署位置对应的智能网关中的NAS插件。S230，目标NAS插件接收离线下载请求指令及离线下载信息，通过互联网将下载内容离线下载到目标云端，所述目标云端和所述目标NAS插件对应。。进一步的，临时使用账号在第一预设时间段内进行离线下载初始化包括如下步骤：S190，目标NAS插件向目标云端获取宽带ID及关联信息。具体的，所述关联信息至少包括临时使用账号信息。S191，目标NAS插件挂载并记录临时使用账号和挂载点信息。具体的，本领域技术人员知晓，挂载点信息为临时使用账号存储在目录内存在的位置。S193，目标NAS插件检查生成密钥信息，向目标云端发起认证。S194，当认证通过后，获取下载地址及配置参数，启动运行。具体的，所述配置参数包括文件名、下载路径。基于上述，待认证设备发出离线请求指令及离线下载信息，服务器接收离线请求指令及离线下载信息并发送到目标云端，在通过目标云端发送到NAS插件，NAS插件从互联网上下载到目标云端，现有技术中使用离线下载技术，一般是用服务商的服务器代替智能设备用户进行下载，等到下载完成，智能设备再从服务商的服务器上下载到用户的智能设备上，本发明不需要智能设备从服务器进行下载，可以直接从云端进行拉去，在局域网内的网速，足够视频等流畅观看，减少了从服务器下载到智能设备的过程，使得用户更快速、流畅的使用网络上的资源。实施例3在实施例2的基础上，本发明还在离线下载过程中进行加速下载，包括以下步骤：S300，获取4G或5G网络在第二预设时间段内的丢包数量Q1和宽带网络在第二预设时间段内的丢包数量Q2。具体的，本领域技术人员知晓，现有技术中任何一种获取在预设时间段内的丢包量的方法均属于本发明保护范围，此处不再赘述。S310，当Q1-Q2＞Q时，将宽带网络作为目标网络，使用目标网络在离线过程中进行加速下载，其中，Q是预设误差阈值。S320，当Q2-Q1＞Q时，将4G或5G网络作为目标网络，使用目标网络在离线过程中进行加速下载。S330，当|Q2-Q1|＜Q时，基于4G或5G网络在当前时间节点的网络速度C1和宽带网络的在当前时间节点的网络速度C2确定目标网络，使用目标网络在离线过程中进行加速下载。具体的，在S330中，基于4G或5G网络在当前时间节点的网络速度C1和宽带网络的在当前时间节点的网络速度C2确定目标网络包括如下步骤：S3301，当C2＞C1时，将宽带网络作为目标网络。S3302，当C2≤C1，将4G或5G网络作为目标网络。具体的，在本发明S300前还包括：S290，识别用户网络情况，当用户的4G或5G网络和宽带网络均能正常使用时，执行S300，可以理解为，在S300之前，识别用户网络情况，判断用户是在宽带覆盖范围内还是在宽带覆盖范围外，当用户在宽带覆盖范围外时，只能通过4G或5G网络的方式进行离线下载，当用户在宽带覆盖范围内时，可以4G或5G网络和宽带网络进行切换，找到下载速度快、丢包数量少的网络进行离线下载。具体的，S300中，获取4G或5G网络在第二预设时间段内的丢包数量Q1包括：获取用户使用4G或5G网络在当前时间节点前30min内的丢包数量Q1；其中，所述当前节点前30min可以替换为当前时间节点前任意长度时间，所述当前时间节点前任意长度时间可根据实际需求进行确定。具体的，S300中，获取宽带网络在第二预设时间段内的丢包数量Q2包括：获取用户使用宽带网络在当前时间节点前30min内的丢包数量Q2，Q2=Q3。在本发明另一实施例中，S300中，获取4G或5G网络在第二预设时间段内的丢包数量Q1包括如下步骤：S301，获取在4G或5G网络状态下，用户在n个历史时间段分别包含的第二预设时间段内的丢包数量列表D={D1，D2，…，Dj，…，Dn}，Dj是用户使用4G或5G在第j个历史时间段包含的第二预设时间段内的丢包数量，j的取值范围是1到n。S302，获取Q1=×∑nj=1。在本发明另一实施例中，S300中，获取宽带网络在第二预设时间段内的丢包数量Q2包括如下步骤：S3011，获取在宽带网络状态下，用户在n个历史时间段分别包含的第二预设时间段内丢包数量列表F={F1，F2，…，Fj，…，Fn}，Fj是用户使用宽带在第j个的历史时间段包含的第二预设时间段内的丢包数量，j的取值范围是1到n。S3012，获取Q2=×∑nj=1Fj。基于上述，本发明通过使用过往n天的第二预设时间段内的丢包数量来代替第二预设时间段内的丢包数量，本领域技术人员知晓，4G或5G网络在过往n天的第二预设时间段的丢包数量是有规律的，所以可以使用过往n天的第二预设时间段内的丢包数量来近似代替第二预设时间段内的丢包数量。基于上述，获取4G或5G网络在第二预设时间段内的丢包数量和宽带网络在第二预设时间段内的丢包数量，当4G或5G网络和宽带网络的丢包数量差值超过预设误差阈值内，将丢包数量少对应的网络作为目标网络，当4G或5G网络和宽带网络的丢包数量差值在预设误差阈值，判断4G或5G网络和宽带网络的网速，将网速较快的作为目标网络，通过上述方法找到目标网络，进行速度更快、丢包数量更少的离线下载。本发明的实施例还提供了一种非瞬时性计算机可读存储介质，该存储介质可设置于电子设备之中以保存用于实现方法实施例中一种方法相关的至少一条指令或至少一段程序，该至少一条指令或该至少一段程序由该处理器加载并执行以实现上述实施例提供的方法。虽然已经通过示例对本发明的一些特定实施例进行了详细说明，但是本领域的技术人员应该理解，以上示例仅是为了进行说明，而不是为了限制本发明的范围。本领域的技术人员还应理解，可以对实施例进行多种修改而不脱离本发明的范围和精神。本发明开的范围由所附权利要求来限定。
