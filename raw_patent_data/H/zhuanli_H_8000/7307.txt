标题title
一种基于国产化平台的工业以太网数据包生成方法及装置
摘要abst
本发明公开了一种基于国产化平台的工业以太网数据包生成方法及装置，该方法可覆盖典型工业以太网协议特征数据包持续生成，为工业以太网流量分析研究，工业以太网安全分析、测试验证提供直接支持，具有良好的应用前景。同时，利用时间戳计数器进行高分辨率时间测量来解决操作系统定时精度较低带来的无法精准依据记录给定时间点进行发送的问题。
权利要求书clms
1.一种基于国产化平台的工业以太网数据包生成方法，其特征在于，包括：获取存储于文件系统中的若干数据文件，每个所述数据文件包括一种数据帧类型的待模拟工业以太网数据；将若干所述数据文件中包含的数据帧负载一一对应的存储于若干环形缓冲区内；采用多核并行序列化模型将若干所述环形缓冲区内的数据帧负载一一进行列化获得若干序列化记录，并将若干所述序列化记录推入多生产者多消费者无锁队列；所述多核并行序列化模型包括若干第一并行工作线程，所述序列化记录包括目标序列化格式；采用并行发送模型将所述多生产者多消费者无锁队列中的若干所述序列化记录取出，并采用直接存储器访问的方式通过网卡向外发送；所述并行发送模型包括若干第二并行工作线程。2.根据权利要求1所述的基于国产化平台的工业以太网数据包生成方法，其特征在于，所述目标序列化格式包括从左向右依次排列的length域、timestamp域以及data payload域；所述length域用于表示数据包负载的长度，所述timestamp域用于表示数据包未来发送时刻，所述data payload域用于表示数据包发送时直接发送的数据负载。3.根据权利要求1所述的基于国产化平台的工业以太网数据包生成方法，其特征在于，所述数据文件中存储的内容包括同一数据帧类型的所述待模拟工业以太网数据中OSI七层协议中物理层以上的所有数据帧负载。4.根据权利要求1所述的基于国产化平台的工业以太网数据包生成方法，其特征在于，采用数据创建线程创建获得若干所述环形缓冲区，若干所述环形缓冲区的数量与若干所述数据文件的数量相同，每个所述环形缓冲区包含的节点个数与每个所述数据文件包含的数据个数相同，所述节点的内容包括数据负载内容、数据负载长度、数据发送速度。5.根据权利要求4所述的基于国产化平台的工业以太网数据包生成方法，其特征在于，每个所述第一并行工作线程按所述环形缓冲区链表的串联顺序以多倍于所述多生产者多消费者无锁队列的消费速度，依次将所述环形缓冲区内的数据帧负载取出进行列化获得序列化记录。6.根据权利要求5所述的基于国产化平台的工业以太网数据包生成方法，其特征在于，所述多核并行序列化模型单线程工作方法包括：确定所述多生产者多消费者无锁队列空信号量后，从对应的所述环形缓冲区取出数据、数据长度及发送速度相关信息；从内存池分配内存创建所述序列化记录并将数据长度填入所述序列化记录，所述内存池由所述数据创建线程创建获得。7.根据权利要求6所述的基于国产化平台的工业以太网数据包生成方法，其特征在于，确定所述序列化记录为所述第一并行工作线程生成的首条序列化记录；获取系统时间戳计数器值以及计算首条所述序列化记录的第一发送时间戳并存入全局变量，作为后续生成所有所述序列化记录的基准参考点；根据首条所述序列化记录的数据帧未来发送时间戳、所述系统时间戳计数器值以及第一发送时间戳计算获取首条所述序列化记录的数据帧未来发送时刻，并将所述数据帧未来发送时刻填入所述序列化记录；拷贝数据帧负载内容到所述序列化记录；将所述序列化记录推入多生产者多消费者无锁队列中。8.根据权利要求7所述的基于国产化平台的工业以太网数据包生成方法，其特征在于，所述采用并行发送模型将所述多生产者多消费者无锁队列中的若干所述序列化记录取出，并采用直接存储器访问的方式通过网卡向外发送，包括：确定本次发送为首次发送；记录数据第二发送时间戳，将所述第二发送时间戳以及所述系统时间戳计数器值作为后续所有单线程发送数据的基准参考点。9.根据权利要求8所述的基于国产化平台的工业以太网数据包生成方法，其特征在于，所述文件系统布置于基于国产化的飞腾平台中，所述网卡为基于飞腾平台的DMA网卡。10.一种基于国产化平台的工业以太网数据包生成装置，其特征在于，包括：数据文件获取单元，获取存储于文件系统中的若干数据文件，每个所述数据文件包括一种数据帧类型的待模拟工业以太网数据；缓存单元，用于将若干所述数据文件中包含的数据帧负载一一对应的存储于若干环形缓冲区内；序列化记录单元，用于采用多核并行序列化模型将若干所述环形缓冲区内的数据帧负载一一进行列化获得若干序列化记录，并将若干所述序列化记录推入多生产者多消费者无锁队列；所述多核并行序列化模型包括若干第一并行工作线程，所述序列化记录包括目标序列化格式，发送单元，用于采用并行发送模型将所述多生产者多消费者无锁队列中的若干所述序列化记录取出，并采用直接存储器访问的方式通过网卡向外发送；所述并行发送模型包括若干第二并行工作线程。
说明书desc
技术领域本发明涉及网络测试技术领域，特别是涉及一种可覆盖典型工业以太网协议特征数据包持续生成的基于国产化平台的工业以太网数据包生成方法及装置。背景技术网络安全就是网络上的信息安全，是指网络系统的硬件、软件及其系统中的数据受到保护，不受偶然的或者恶意的原因而遭到破坏、更改、泄露，系统连续可靠正常地运行，网络服务不中断。随着国家信息化和工业化的深度融合，大量信息化、智能化产品及先进技术手段被应用到各类工控系统中，打破了传统工业企业网络原本的物理隔离状态。各类技术被引入的同时信息技术安全风险也随之引入，为工业以太网安全防护带来了极大的挑战。为此，国内大量信息安全厂商也随之加大投入，推出了众多工业以太网安全设备及软件。工业以太网安全设备及软件在研发完成后，需要对其性能进行验证，为了保证性能验证的准确性，通常需要将工业以太网安全设备及软件接入正常运行的相应工业以太网内。然而，由于工业以太网属于高价值网络，任何操作中断都将直接影响企业生产节奏，而常规的安全设备测试验证手段多会对网络数据监听处理后分析，由于安全设备及软件接入正常运行的以太网可能会影响以太网正常的时序，从而带来对工业网络正常数据实时性、时序性影响，对工业设备运转带来不可预期影响，而缺乏验证的工业以太网安全设备又无法体现其有效性。为了解决上述问题，网络数据包生成器被提出，网络数据包生成器通过生成特定的网络数据包，将该网络数据包发往待测网络安全设备中，并接收待测网络设备返回的数据包来实现性能测试、功能测试和网络连通性测试等功能。然而，现有技术中的网络数据包生成器普遍存在功能单一，由于模拟的工业以太网的数据量较大，传统的网络数据包生成器还存在数据包生成速度慢，数据发送存在中断以及卡断的问题。随着国产化技术的不断发展，未来基于国产化平台的网络数据包生成装置也需要深入研究。因此亟需一种基于国产化平台，且能够对工业以太网特征数据全覆盖模拟生成的装置，为工业以太网安全技术发展、工业以太网性能检测提供基础支撑。发明内容鉴于上述问题，本发明提供用于克服上述问题或者至少部分地解决上述问题的一种基于国产化平台的工业以太网数据包生成方法及装置。可覆盖典型工业以太网协议特征数据包持续生成，为工业以太网流量分析研究，工业以太网安全分析、测试验证提供直接支持，具有良好的应用前景。本发明提供了如下方案：一种基于国产化平台的工业以太网数据包生成方法，包括：获取存储于文件系统中的若干数据文件，每个所述数据文件包括一种数据帧类型的待模拟工业以太网数据；将若干所述数据文件中包含的数据帧负载一一对应的存储于若干环形缓冲区内；采用多核并行序列化模型将若干所述环形缓冲区内的数据帧负载一一进行列化获得若干序列化记录，并将若干所述序列化记录推入多生产者多消费者无锁队列；所述多核并行序列化模型包括若干第一并行工作线程，所述序列化记录包括目标序列化格式；采用并行发送模型将所述多生产者多消费者无锁队列中的若干所述序列化记录取出，并采用直接存储器访问的方式通过网卡向外发送；所述并行发送模型包括若干第二并行工作线程。优选地：所述目标序列化格式包括从左向右依次排列的length域、timestamp域以及data payload域；所述length域用于表示数据包负载的长度，所述timestamp域用于表示数据包未来发送时刻，所述data payload域用于表示数据包发送时直接发送的数据负载。优选地：所述数据文件中存储的内容包括同一数据帧类型的所述待模拟工业以太网数据中OSI七层协议中物理层以上的所有数据帧负载。优选地：采用数据创建线程创建获得若干所述环形缓冲区，若干所述环形缓冲区的数量与若干所述数据文件的数量相同，每个所述环形缓冲区包含的节点个数与每个所述数据文件包含的数据个数相同，所述节点的内容包括数据负载内容、数据负载长度、数据发送速度。优选地：每个所述第一并行工作线程按所述环形缓冲区链表的串联顺序以多倍于所述多生产者多消费者无锁队列的消费速度，依次将所述环形缓冲区内的数据帧负载取出进行列化获得序列化记录。优选地：所述多核并行序列化模型单线程工作方法包括：确定所述多生产者多消费者无锁队列空信号量后，从对应的所述环形缓冲区取出数据、数据长度及发送速度相关信息；从内存池分配内存创建所述序列化记录并将数据长度填入所述序列化记录，所述内存池由所述数据创建线程创建获得。优选地：，确定所述序列化记录为所述第一并行工作线程生成的首条序列化记录；获取系统时间戳计数器值以及计算首条所述序列化记录的第一发送时间戳并存入全局变量，作为后续生成所有所述序列化记录的基准参考点；根据首条所述序列化记录的数据帧未来发送时间戳、所述系统时间戳计数器值以及第一发送时间戳计算获取首条所述序列化记录的数据帧未来发送时刻，并将所述数据帧未来发送时刻填入所述序列化记录；拷贝数据帧负载内容到所述序列化记录；将所述序列化记录推入多生产者多消费者无锁队列中。优选地：所述采用并行发送模型将所述多生产者多消费者无锁队列中的若干所述序列化记录取出，并采用直接存储器访问的方式通过网卡向外发送，包括：确定本次发送为首次发送；记录数据第二发送时间戳，将所述第二发送时间戳以及所述系统时间戳计数器值作为后续所有单线程发送数据的基准参考点。优选地：所述文件系统布置于基于国产化的飞腾平台中，所述网卡为基于飞腾平台的DMA网卡。一种基于国产化平台的工业以太网数据包生成装置，包括：数据文件获取单元，获取存储于文件系统中的若干数据文件，每个所述数据文件包括一种数据帧类型的待模拟工业以太网数据；缓存单元，用于将若干所述数据文件中包含的数据帧负载一一对应的存储于若干环形缓冲区内；序列化记录单元，用于采用多核并行序列化模型将若干所述环形缓冲区内的数据帧负载一一进行列化获得若干序列化记录，并将若干所述序列化记录推入多生产者多消费者无锁队列；所述多核并行序列化模型包括若干第一并行工作线程，所述序列化记录包括目标序列化格式，发送单元，用于采用并行发送模型将所述多生产者多消费者无锁队列中的若干所述序列化记录取出，并采用直接存储器访问的方式通过网卡向外发送；所述并行发送模型包括若干第二并行工作线程。根据本发明提供的具体实施例，本发明公开了以下技术效果：本申请实施例提供的一种基于国产化平台的工业以太网数据包生成方法及装置，可覆盖典型工业以太网协议特征数据包持续生成，为工业以太网流量分析研究，工业以太网安全分析、测试验证提供直接支持，具有良好的应用前景。同时，利用时间戳计数器进行高分辨率时间测量来解决操作系统定时精度较低带来的无法精准依据记录给定时间点进行发送的问题。序列化线程使用TSC结合产生的首个发送时间戳Tg作为后续生产记录时间基准，跨多个生产线程以相同的时间基准生成所有发送数据记录，解决了跨多个线程生成记录时间的一致性问题。发送单线程中使用TSC结合首个发送时间戳T0作为后续发送记录时间基准，并将发送时间点以相对量为表示形态，解决了单线程中所有发送记录时间同步的问题，同时解决了以往流量生成器无法持续发送速率可变的网络流量，具有更高的应用价值以及对更广的工业以太网实网流量应用场景的覆盖。通过将生成数据以及发送流量大小以及发送速率存于基于国产化平台文件系统，并采用数据内容全开放为可编辑的模式，使数据包生成器可覆盖基于以太网的全协议、全包长、全数据内容、全数据帧混合比例、全流量大小自定义工业以太网数据帧生成的应用场景。当然，实施本发明的任一产品并不一定需要同时达到以上所述的所有优点。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例中所需要使用的附图作简单地介绍。显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来说，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明实施例提供的一种基于国产化平台的工业以太网数据包生成方法的流程图;图2是本发明实施例提供的数据生成器架构示意图；图3是本发明实施例提供的序列化记录格式示意图；图4是本发明实施例提供的多核并行序列化模型单线程工作流程图；图5是本发明实施例提供的并行发送模型工作流程图；图6是本发明实施例提供的飞腾硬件平台示意图；图7是本发明实施例提供的一种基于国产化平台的工业以太网数据包生成装置的示意图；图8是本发明实施例提供的一种基于国产化平台的工业以太网数据包生成设备的示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述。显然，所描述的实施例仅仅是本发明的一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员所获得的所有其他实施例，都属于本发明保护的范围。参见图1，为本发明实施例提供的一种基于国产化平台的工业以太网数据包生成方法，如图1所示，该方法可以包括：S101：获取存储于文件系统中的若干数据文件，每个所述数据文件包括一种数据帧类型的待模拟工业以太网数据；具体的，所述数据文件中存储的内容包括同一数据帧类型的所述待模拟工业以太网数据中OSI七层协议中物理层以上的所有数据帧负载。S102：将若干所述数据文件中包含的数据帧负载一一对应的存储于若干环形缓冲区内；具体的，采用数据创建线程创建获得若干所述环形缓冲区，若干所述环形缓冲区的数量与若干所述数据文件的数量相同，每个所述环形缓冲区包含的节点个数与每个所述数据文件包含的数据个数相同，所述节点的内容包括数据负载内容、数据负载长度、数据发送速度。S103：采用多核并行序列化模型将若干所述环形缓冲区内的数据帧负载一一进行列化获得若干序列化记录，并将若干所述序列化记录推入多生产者多消费者无锁队列；所述多核并行序列化模型包括若干第一并行工作线程，所述序列化记录包括目标序列化格式；具体的，所述目标序列化格式包括从左向右依次排列的length域、timestamp域以及data payload域；所述length域用于表示数据包负载的长度，所述timestamp域用于表示数据包未来发送时刻，所述data payload域用于表示数据包发送时直接发送的数据负载。在实际应用中，每个所述第一并行工作线程按所述环形缓冲区链表的串联顺序以多倍于所述多生产者多消费者无锁队列的消费速度，依次将所述环形缓冲区内的数据帧负载取出进行列化获得序列化记录。所述多核并行序列化模型单线程工作方法包括：确定所述多生产者多消费者无锁队列空信号量后，从对应的所述环形缓冲区取出数据、数据长度及发送速度相关信息；从内存池分配内存创建所述序列化记录并将数据长度填入所述序列化记录，所述内存池由所述数据创建线程创建获得。确定所述序列化记录为所述第一并行工作线程生成的首条序列化记录；获取系统时间戳计数器值以及计算首条所述序列化记录的第一发送时间戳并存入全局变量，作为后续生成所有所述序列化记录的基准参考点；根据首条所述序列化记录的数据帧未来发送时间戳、所述系统时间戳计数器值以及第一发送时间戳计算获取首条所述序列化记录的数据帧未来发送时刻，并将所述数据帧未来发送时刻填入所述序列化记录；拷贝数据帧负载内容到所述序列化记录；将所述序列化记录推入多生产者多消费者无锁队列中。S104：采用并行发送模型将所述多生产者多消费者无锁队列中的若干所述序列化记录取出，并采用直接存储器访问的方式通过网卡向外发送；所述并行发送模型包括若干第二并行工作线程。具体的，确定本次发送为首次发送；记录数据第二发送时间戳，将所述第二发送时间戳以及所述系统时间戳计数器值作为后续所有单线程发送数据的基准参考点。为了可以使得本申请实施例提供的基于国产化平台的工业以太网数据包生成方法可以基于国产化软件使用，本申请实施例还可以提供所述文件系统布置于基于国产化的飞腾平台中，所述网卡为基于飞腾平台的DMA网卡。本申请实施例提供的基于国产化平台的工业以太网数据包生成方法，能够对工业以太网特征数据全覆盖模拟生成，测试设备时无需将安全设备直接接入已经运行的工业以太网内，通过本申请实施例提供的方法可以快速生成用于模拟相关工业以太网的数据包，在不破坏已经运行工业以太网正常实时性、时序性的前提下，实现对网络安全设备的高仿真度测试。为工业以太网安全技术发展、工业以太网性能检测提供基础支撑。可以理解的是，本申请实施例提供的基于国产化平台的工业以太网数据包生成方法可以用于与网络数据包生成器中，网络数据包生成器通过生成特定的网络数据包，将该网络数据包发往待测网络设备中，并接收待测网络设备返回的数据包来实现性能测试、功能测试和网络连通性测试等功能。数据包生成器在网络研究、开发和运维等方面具有重要的作用。网络研究人员可以利用数据包生成器测试网络原型系统的性能和功能，找到系统瓶颈；网络运维人员可利用数据包调试网络故障，检测网络服务质量。数据包生成器是不可或缺的网络工具，具有重要的社会经济效益和学术研究价值。下面以基于飞腾平台应用本申请实施例提供的方法为例，进行详细说明。本申请实施例可以采用全国产化飞腾硬件平台设计，如图6所示，硬件平台采用的FT-2000/4 通用计算处理器芯片集成4个飞腾自主研发的处理器核心FTC663，兼容64位ARMv8指令集，16nm制程，主频最高3.0GHz，两个72位DDR4-3200存储接口，两路16lane、两路1lane PCIe3.0，最多支持6个PCIe3.0接口两个千兆以太网接口。FCBGA封装，引脚个数1144，封装尺寸35mmx35mm，最大功耗10W。如图2所示为数据包生成器的架构，生成器由数据生产模块、多核并行序列化模型和多核并行序列化模型组成，下面分别对这四个组成部分进行详细介绍。数据生产模块:由数据文件、数据创建线程和环形缓冲区组成。数据文件存储在基于国产化飞腾平台的文件系统的数据文件中，每个数据文件代表了一种工业以太网数据帧类型，数据文件存储的内容为OSI七层协议中物理层以上的所有数据帧负载。当需要生成不同类型工业以太网数据时，将不同帧类型的数据分别存储于不同文件之中。当需要生成同种类型不同长度、不同内容的工业以太网数据帧时，将数据帧负载存储于同一文件之中。数据创建线程负责在生成器初始化时创建内存池供MPMC队列分配内存，此种设计可大大加快MPMC队列节点的创建速度。同时创建环形缓冲区，读取数据文件内容并将其复制到环形缓冲区。环形缓冲区存储从数据文件提取的数据帧负载，由基于双向循环链表的数据块组成。环形缓冲区由数据创建线程创建，数量取决于数据文件个数，每个环形缓冲区的节点数取决于每个数据文件的数据个数，节点内容包括数据负载内容、数据负载长度、数据发送速度。多核并行序列化模型:由多个第一并行工作线程组成，第一并行工作线程的数量取决于环形缓冲区的数量。每个线程按环形缓冲区链表的串联顺序、以多倍于MPMC无锁队列消费速度依次将数据取出后按照图3所示的目标序列化格式将其列化为记录，并将其推入MPMC无锁队列。这里以多倍于发送线程的速度取数据并序列化为记录，可保障MPMC无锁队列的生产速率始终大于消费速率，不会造成发送数据中断或卡顿。其中该目标序列化格式包括从左向右依次排列的length域、timestamp域以及data payload域。length域：2字节，代表数据包负载的长度。timestamp域：8个字节，高四字节为秒，低四字节为微秒，同linux系统下structtimeval结构体兼容，代表数据包未来发送时刻。data payload域:实际上的数据负载，数据包发送时直接发送的数据。多核并行序列化模型单线程工作流程如图4所示:步骤1:全局变量MPMC队列长度清零，等待发送线程完成初始化并通过信号量告知MPMC无锁队列为空，接收到MPMC无锁队列空信号量后，进入步骤2，否则继续执行步骤1。步骤2:从对应的环形缓冲区取出数据、数据长度及发送速度相关信息，从内存池分配内存创建序列化记录并将数据长度填入序列化记录。步骤3:探测记录是否为所有序列化线程生成的首条记录，若是首条记录，则首先执行步骤3-1，再执行步骤3-2，若不是首条记录，则直接执行步骤3-2。步骤3-1:获取时间戳计数器的系统时间戳计数器值TSC 以及计算首条发送时间戳Tg并存入全局变量，作为后续生成所有序列化记录的基准参考点。步骤3-2:根据数据帧未来发送时间戳Tn结合系统时间戳计数器值TSC以及第一发送时间戳Tg计算该数据帧未来发送时刻，发送时刻T=TSC+，并将该发送时刻填入序列化记录。步骤4:拷贝数据帧负载内容到序列化记录。步骤5:将序列化记录推入MPMC无锁队列之中。步骤6:检测此次创建的队列数是否达到最大队列数，若达到最大队列数，则回到步骤1，若未达到最大队列数，则回到步骤2。由序列化线程创建的基于链表的无锁队列，队列的每个节点包含了序列化线程创建的序列化记录。无锁队列的个数由序列化线程数决定，队列最大长度为可配置。无锁数据结构的消费者为发送线程，由发送线程获取并释放。多核并行序列化模型: 由多个第二并行工作线程组成，负责将MPMC队列中的数据取出并采用直接存储器访问的方式通过飞腾平台网卡发送出去,是无锁数据结构的消费者。多核并行序列化模型工作流程如图5所示:步骤1:本轮发送记录数清零，向序列化线程发送无锁队列为空的信号量，通知序列化线程向MPMC无锁队列推送需要发送的数据。步骤2:探测MPMC无锁队列是否为空，若不为空，则执行步骤3，若为空，则休眠10ms，继续执行步骤2。步骤3:取出MPMC无锁队列头中的数据，本轮发送帧计数自增加1。步骤4:探测本轮待发送MPMC无锁队列中的节点是否即将耗尽，耗尽条件为本轮发送记录计数达到最大队列长度数。若耗尽，则执行步骤4-1，若未耗尽，则执行步骤5。步骤4-1:本轮发送记录计数清零，并向序列化线程发送无锁队列为空的信号量，通知序列化线程向MPMC无锁队列推送下一轮需要发送的数据。步骤5:从发送记录提取出需要发送的数据负载以及该数据的未来发送时间戳Tn，并释放该数据记录使用的内存到内存池。步骤6:探测本次发送是否为数据发生器启动后的首次发送，若为首次发送，则执行步骤6-1，若不是首次发送，则执行步骤7。步骤6-1:记录数据发送时间戳为T0，获取并记录系统时间戳计数器值TSC，这两个值作为后续所有单线程发送数据的基准参考点。步骤7:根据步骤5提取的数据未来发送时间戳Tn，并以T0为基准参考点计算出理论发送时间点TSC=Tn-T0，并获取当前主机时间戳计数器值TSC。步骤8:计算当前主机时间戳计数器值Cn与系统时间戳计数器值Ch +计算出理论发送时间点Cd大小关系；若Cn＞Ch +Cd，则执行步骤8-1；若Cn=＞Ch +Cd，则执行步骤8-2；若Cn=Ch +Cd，则执行步骤8-3。步骤8-1:未到发送时间点，跳转至步骤7等待Cn=＞Ch +Cd。步骤8-2:超出发送时间点，数据包违规，将该帧丢弃，跳转至步骤3执行。步骤8-3:发送时间点到，将数据帧发送至基于飞腾平台的DMA网卡。可见，本申请实施例提供的方法，利用时间戳计数器进行高分辨率时间测量来解决操作系统定时精度较低带来的无法精准依据记录给定时间点进行发送的问题。发送单线程中使用TSC结合首个发送时间戳T0作为后续发送记录时间基准，并将发送时间点以相对量为表示形态，解决了单线程中所有发送记录时间同步的问题，同时解决了以往流量生成器无法持续发送速率可变的网络流量，具有更高的应用价值以及对更广的工业以太网实网流量应用场景的覆盖。序列化线程使用TSC结合产生的首个发送时间戳Tg作为后续生产记录时间基准，跨多个生产线程以相同的时间基准生成所有发送数据记录，解决了跨多个线程生成记录时间的一致性问题。通过将生成数据以及发送流量大小以及发送速率存于基于国产化平台文件系统，并采用数据内容全开放为可编辑的模式，使数据包生成器可覆盖基于以太网的全协议、全包长、全数据内容、全数据帧混合比例、全流量大小自定义工业以太网数据帧生成的应用场景。参见图7，本申请实施例还可以提供一种基于国产化平台的工业以太网数据包生成装置，如图7所示，该装置可以包括：数据文件获取单元701，获取存储于文件系统中的若干数据文件，每个所述数据文件包括一种数据帧类型的待模拟工业以太网数据；缓存单元702，用于将若干所述数据文件中包含的数据帧负载一一对应的存储于若干环形缓冲区内；序列化记录单元703，用于采用多核并行序列化模型将若干所述环形缓冲区内的数据帧负载一一进行列化获得若干序列化记录，并将若干所述序列化记录推入多生产者多消费者无锁队列；所述多核并行序列化模型包括若干第一并行工作线程，所述序列化记录包括目标序列化格式，发送单元704，用于采用并行发送模型将所述多生产者多消费者无锁队列中的若干所述序列化记录取出，并采用直接存储器访问的方式通过网卡向外发送；所述并行发送模型包括若干第二并行工作线程。本申请实施例还可以提供一种基于国产化平台的工业以太网数据包生成设备，所述设备包括处理器以及存储器：所述存储器用于存储程序代码，并将所述程序代码传输给所述处理器；所述处理器用于根据所述程序代码中的指令执行上述的基于国产化平台的工业以太网数据包生成方法的步骤。如图8所示，本申请实施例提供的一种基于国产化平台的工业以太网数据包生成设备，该设备可以包括：处理器10、存储器11、通信接口12和通信总线13。处理器10、存储器11、通信接口12均通过通信总线13完成相互间的通信。在本申请实施例中，处理器10可以为中央处理器、特定应用集成电路、数字信号处理器、现场可编程门阵列或者其他可编程逻辑器件等。处理器10可以调用存储器11中存储的程序，具体的，处理器10可以执行基于国产化平台的工业以太网数据包生成方法的实施例中的操作。存储器11中用于存放一个或者一个以上程序，程序可以包括程序代码，程序代码包括计算机操作指令，在本申请实施例中，存储器11中至少存储有用于实现以下功能的程序：获取存储于文件系统中的若干数据文件，每个所述数据文件包括一种数据帧类型的待模拟工业以太网数据；将若干所述数据文件中包含的数据帧负载一一对应的存储于若干环形缓冲区内；采用多核并行序列化模型将若干所述环形缓冲区内的数据帧负载一一进行列化获得若干序列化记录，并将若干所述序列化记录推入多生产者多消费者无锁队列；所述多核并行序列化模型包括若干第一并行工作线程，所述序列化记录包括目标序列化格式；采用并行发送模型将所述多生产者多消费者无锁队列中的若干所述序列化记录取出，并采用直接存储器访问的方式通过网卡向外发送；所述并行发送模型包括若干第二并行工作线程。在一种可能的实现方式中，存储器11可包括存储程序区和存储数据区，其中，存储程序区可存储操作系统，以及至少一个功能所需的应用程序等；存储数据区可存储使用过程中所创建的数据，如初始化数据等。此外，存储器11可以包括高速随机存取存储器，还可以包括非易失性存储器，例如至少一个磁盘存储器件或其他易失性固态存储器件。通信接口12可以为通信模块的接口，用于与其他设备或者系统连接。当然，需要说明的是，图8所示的结构并不构成对本申请实施例中基于国产化平台的工业以太网数据包生成设备的限定，在实际应用中基于国产化平台的工业以太网数据包生成设备可以包括比图8所示的更多或更少的部件，或者组合某些部件。本申请实施例还可以提供一种计算机可读存储介质，所述计算机可读存储介质用于存储程序代码，所述程序代码用于执行上述的基于国产化平台的工业以太网数据包生成方法的步骤。需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括所述要素的过程、方法、物品或者设备中还存在另外的相同要素。通过以上的实施方式的描述可知，本领域的技术人员可以清楚地了解到本申请可借助软件加上必需的通用硬件平台的方式来实现。基于这样的理解，本申请的技术方案本质上或者说对现有技术做出贡献的部分可以以软件产品的形式体现出来，该计算机软件产品可以存储在存储介质中，如ROM/RAM、磁碟、光盘等，包括若干指令用以使得一台计算机设备执行本申请各个实施例或者实施例的某些部分所述的方法。本说明书中的各个实施例均采用递进的方式描述，各个实施例之间相同相似的部分互相参见即可，每个实施例重点说明的都是与其他实施例的不同之处。尤其，对于系统或系统实施例而言，由于其基本相似于方法实施例，所以描述得比较简单，相关之处参见方法实施例的部分说明即可。以上所描述的系统及系统实施例仅仅是示意性的，其中所述作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部模块来实现本实施例方案的目的。本领域普通技术人员在不付出创造性劳动的情况下，即可以理解并实施。以上所述仅为本发明的较佳实施例而已，并非用于限定本发明的保护范围。凡在本发明的精神和原则之内所作的任何修改、等同替换、改进等，均包含在本发明的保护范围内。
