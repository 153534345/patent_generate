标题title
网络流量分域方法、装置、设备和存储介质
摘要abst
本发明实施例提供一种网络流量分域方法、装置、设备和存储介质，该方法包括：接收待处理的网络报文，确定网络报文所对应的目标NUMA域。基于网络接口信息，确定目标NUMA域所对应的收包队列，将网络报文保存至目标NUMA域所对应的收包队列中，以使得网络报文存储至对应的目标NUMA域，并基于目标NUMA域对网络报文进行处理。上述方案中，通过确定网络报文所对应的目标NUMA域，并基于网卡中的网络接口信息，确定目标NUMA域所对应的收包队列，以确保将接收到的网络报文存储至目标NUMA域，实现了对接收到的网络报文的分域处理，可以有效避免流量跨域，消除跨域访问内存和异步操作造成的影响，从而提高网络流量处理性能。
权利要求书clms
1.一种网络流量分域方法，其特征在于，应用于智能网卡，所述智能网卡中包括网络接口，所述方法包括：接收待处理的网络报文；确定所述网络报文所对应的目标NUMA域；基于网络接口信息，确定所述目标NUMA域所对应的收包队列；将所述网络报文保存至目标NUMA域所对应的收包队列中，以使得所述网络报文存储至对应的目标NUMA域，并基于所述目标NUMA域对所述网络报文进行处理。2.根据权利要求1所述的方法，其特征在于，所述方法还包括：获取智能网卡所包括的各个网络接口；分别确定所述各个网络接口所对应的多个收包队列以及所述多个收包队列各自对应的NUMA域。3.根据权利要求1所述的方法，其特征在于，所述网络报文中包括五元组，所述确定所述网络报文所对应的目标NUMA域，包括：获取网络流量分域表，所述网络流量分域表用于确定网络报文所属的NUMA域；基于网络流量分域表和所述五元组，确定所述网络报文所对应的目标NUMA域。4.根据权利要求3所述的方法，其特征在于，所述网络流量分域表中包括多个分域规则；所述基于网络流量分域表和所述五元组，确定所述网络报文所对应的目标NUMA域，包括：基于所述五元组，查询所述网络报文是否命中所述网络流量分域表中的分域规则；若所述网络报文命中网络流量分域表中的分域规则，则基于所述分域规则，确定所述网络报文所对应的目标NUMA域；若所述网络报文未命中网络流量分域表中的分域规则，则获取所述智能网卡所对应的NUMA域，并将所述网卡所对应的NUMA域确定为所述网络报文所对应的目标NUMA域。5.根据权利要求4所述的方法，其特征在于，所述基于所述五元组，查询所述网络报文是否命中所述网络流量分域表中的分域规则，包括：对所述网络报文进行哈希运算，获得所述网络报文所对应的关键字；在网络流量分域表所对应的哈希表中进行查询所述关键字所对应的一组分域规则；若在所述一组分域规则中查询到一个分域规则中的五元组与网络报文中的五元组相同，则确定所述网络报文命中所述网络流量分域表中的分域规则；若所述一组分域规则中未查询到分域规则或未查询到一个分域规则中的五元组与网络报文中的五元组相同，则网络报文未命中所述网络流量分域表中的分域规则。6.根据权利要求5所述的方法，其特征在于，所述分域规则包括五元组以及所述分域规则所对应的NUMA域；所述若所述网络报文命中网络流量分域表中的分域规则，则基于所述分域规则，确定所述网络报文所对应的目标NUMA域，包括：若所述网络报文中的五元组与所述一个分域规则中的五元组相同，则将所述分域规则中的五元组所对应的NUMA域确定为所述网络报文所对应的目标NUMA域。7.根据权利要求1所述的方法，其特征在于，所述基于网络接口信息，确定所述目标NUMA域所对应的收包队列，包括：基于网络接口信息，确定所述目标NUMA域所对应的收包队列；若存在多个收包队列所对应的NUMA域均为目标NUMA域，则基于所述智能网卡队列分发算法，确定所述网络报文所对应的目标收包队列。8.一种网络流量分域装置，其特征在于，包括：接收模块，用于接收待处理的网络报文；第一确定模块，用于确定所述网络报文所对应的目标NUMA域；第二确定模块，用于基于网络接口信息，确定所述目标NUMA域所对应的收包队列；存储模块，用于将所述网络报文保存至目标NUMA域所对应的收包队列中，以使得所述网络报文存储至对应的目标NUMA域，并基于所述目标NUMA域对所述网络报文进行处理。9.一种电子设备，其特征在于，包括：存储器、处理器、通信接口；其中，所述存储器上存储有可执行代码，当所述可执行代码被所述处理器执行时，使所述处理器执行如权利要求1至7中任一项所述的网络流量分域方法。10.一种计算机可读存储介质，其特征在于，所述介质存储有计算机程序，所述计算机程序用于执行上述权利要求1-7任一项所述的网络流量分域方法。
说明书desc
技术领域本发明涉及互联网技术领域，尤其涉及一种网络流量分域方法、装置、设备和存储介质。背景技术为了更好地为客户端提高网络服务，通常网络设备可以采用NUMA架构来处理客户端与服务器之间的流量，并且出于高性能的考虑，将来自同一个连接中的客户端与服务器的流量在相同NUMA域上由某个相同的CPU核来处理。在实际应用中，经常将属于不同NUMA域的多个网络接口做链路聚合，那么网络设备在对客户端或者服务端的网络流量进行处理时经常出现流量跨域问题。现有网络流量跨域方案中，通常采用异步方式，将跨NUMA域的网络报文转发给其所属的NUMA域中，继续在其所属的NUMA域上进行处理。然而，这样将会导致频繁出现跨域访问内存的情况，而且还会增加CPU的额外处理，从而影响了网络设备本身的处理性能。发明内容本发明实施例提供一种网络流量分域方法、装置、设备和存储介质，可以实现对网络流量进行分域，以避免处理流量跨域的问题。第一方面，本发明实施例提供一种网络流量分域方法，该方法包括：接收待处理的网络报文；确定所述网络报文所对应的目标NUMA域；基于网络接口信息，确定所述目标NUMA域所对应的收包队列；将所述网络报文保存至目标NUMA域所对应的收包队列中，以使得所述网络报文存储至对应的目标NUMA域，并基于所述目标NUMA域对所述网络报文进行处理。第二方面，本发明实施例提供一种网络流量分域装置，该装置包括：接收模块，用于接收待处理的网络报文；第一确定模块，用于确定所述网络报文所对应的目标NUMA域；第二确定模块，用于基于网络接口信息，确定所述目标NUMA域所对应的收包队列；存储模块，用于将所述网络报文保存至目标NUMA域所对应的收包队列中，以使得所述网络报文存储至对应的目标NUMA域，并基于所述目标NUMA域对所述网络报文进行处理。第三方面，本发明实施例提供一种电子设备，包括：存储器、处理器；其中，所述存储器上存储有可执行代码，当所述可执行代码被所述处理器执行时，使所述处理器至少可以实现如第一方面所述的网络流量分域方法。第四方面，本发明实施例提供了一种非暂时性机器可读存储介质，所述非暂时性机器可读存储介质上存储有可执行代码，当所述可执行代码被电子设备的处理器执行时，使所述处理器至少可以实现如第一方面所述的网络流量分域方法。本发明实施例提供的网络流量分域技术方案，首先接收待处理的网络报文，网络报文中包括五元组，并确定网络报文所对应的目标NUMA域。接着基于网络接口信息，确定目标NUMA域所对应的收包队列，最后将网络报文保存至目标NUMA域所对应的收包队列中，以使得网络报文存储至对应的目标NUMA域，并基于目标NUMA域对网络报文进行处理。在上述方案中，通过待处理的网络报文，确定该网络报文所对应的目标NUMA域，并基于网卡中的网络接口信息，确定目标NUMA域所对应的收包队列，并将该网络报文保存至目标NUMA域所对应的收包队列中，以确保将接收到的网络报文存储至对应的目标NUMA域，实现了对接收到的各个网络报文进行分域，可以有效避免流量跨域，消除跨域访问内存和异步操作造成的影响，从而提高设备的网络流量处理性能，降低设备成本。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例描述中所需要使用的附图作一简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例提供的一种传统的NUMA架构的应用示意图；图2为本发明实施例提供的多个网络接口形成链路聚合的NUMA结构的应用示意图；图3为本发明实施例提供的一种网络流量分域方法的流程图；图4为本发明实施例提供的一种网络流量分域方法的应用示意图；图5为本发明实施例提供的确定网络报文所对应的目标NUMA域的流程示意图；图6为本发明实施例提供的另一种网络流量分域方法的流程示意图；图7为本发明实施例提供的确定目标NUMA域所对应的收包队列的流程示意图；图8为本发明实施例提供的一种网络流量分域装置的结构示意图；图9为与图8所示实施例提供的网络流量分域装置对应的电子设备的结构示意图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有作出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。在本发明实施例中使用的术语是仅仅出于描述特定实施例的目的，而非旨在限制本发明。在本发明实施例和所附权利要求书中所使用的单数形式的“一种”、“所述”和“该”也旨在包括多数形式，除非上下文清楚地表示其他含义，“多种”一般包含至少两种。另外，下述各方法实施例中的步骤时序仅为一种举例，而非严格限定。术语定义：非统一内存访问是一种用于多处理器的电脑内存体设计，内存访问时间取决于处理器的内存位置。为了便于理解本发明的技术方案，下面对相关技术进行简要说明：为了提高网络设备的处理性能，高性能的网络设备比如应用交付控制器，可以采用NUMA架构来处理客户端与服务端之间的流量。NUMA架构是现代常用的多核多CPU系统架构，如图1所示。在NUMA架构下，一个NUMA域包含一个物理CPU处理器及与其相连的内存，还包含总线系统，如快速外部设备互连总线接口等，各NUMA域的物理CPU处理器之间通过快速通道互联总线相连接。网络设备采用NUMA架构对接收到的网络流量进行处理流程大致包括如下步骤：接收来自客户端或服务器的网络报文，并且在接收到网络报文时，将网络报文存储到网络接口所在NUMA域的内存里，然后在同一个域上进行业务处理。接着对接收到的网络报文进行业务处理，并将处理后的网络报文发送至服务器或客户端。由于NUMA架构中的一个物理CPU处理器中的各CPU核访问本地内存时带宽更大、速度更快，访存性能更好，但是访问其他NUMA域的内存，也就是远程内存时，延迟会变大，访存性能变差。那么出于高性能的考虑，将来自同一个连接中的客户端流量与服务端流量在相同NUMA域上由某个相同的CPU核来处理。在实际应用中，经常将属于不同NUMA域的多个网络接口进行链路聚合。然而，当网络设备中的多个网络接口进行链路聚合后，网络设备对网络流量进行处理时，将会出现流量跨域的问题。如图2所示，网卡1在NUMA域1，网卡2在NUMA域2，将网卡1的网络接口1和网卡2的网络接口2进行链路聚合。基于交换机链路聚合算法将客户端流量会发往某个网络接口，假设将客户端的网络报文发送至网络接口1，客户端的网络报文与服务端的网络报文都由NUMA域1的某个CPU核来处理。由于交换机链路聚合算法基于网络报文协议首部的某些字段进行网络报文转发的，比如基于源IP地址、源端口、目的IP地址、目的端口、协议号等中的一个或几个将网络报文进行转发，这样同一个连接中后续的客户端的网络报文都会选到同一个网络接口。但是，对于服务端的流量来说，由于服务端的报文和客户端的报文协议首部的字段是不一样的，所以同一个连接中所有服务端的网络报文都有可能会被交换机发送至网络接口2，这样服务端流量将会存储到NUMA域2上，就出现了网络流量跨域问题。此外，假设聚合链路中的网络接口1出现了故障，那么交换机会把后续的客户端流量也发到网络接口2，使得客户端的网络报文存储在NUMA域2上，也就出现了网络流量跨域问题。并且这个流量跨域问题通过选择不同的交换机链路聚合算法也是很难避免的。由于这些流量需要在NUMA域1上才能进行处理，那么在对这些跨域的流量进行处理时，需要将存储到NUMA域2的网络报文发送至NUMA域1上再进行处理，即将存储在其他NUMA域的网络报文由所属的NUMA域来处理，但是这样会对网络设备的处理性能造成很大的负面影响。在对网络流量进行处理的过程中，将会频繁使用网络报文，也就是说，会频繁出现跨域访问内存的情况。并且，将网络报文通过异步方式转发至其他NUMA域，增加了CPU的额外处理，从而影响网络报文的处理速度，增加网络处理延迟，降低网络设备的整体处理性能。而在这种条件下，为了满足一定的性能目标，就需要更换性能更好的硬件，如CPU等，导致成本增加。为了解决此技术问题，本实施例提供了一种网络流量分域方法，该技术方案中利用智能网卡的可编程性，对智能网卡进行改进，使得改进后的智能网卡可以基于网络流量分域规则表对接收到的网络报文进行网络流量归属判断，以确定该网络报文所对应的NUMA域，并将该网络报文保存至对应的NUMA域所对应的收包队列中，以实现对接收到的各个网络报文进行分域，确保各个网络报文可以存储至对应的目标NUMA域，避免网络流量出现跨域的问题。下面结合附图，对本发明的一些实施方式作详细说明。在各实施例之间不冲突的情况下，下述的实施例及实施例中的特征可以相互组合。图3为本发明实施例提供的一种网络流量分域方法的流程图。参考附图3所示，本实施例提供了一种网络流量分域方法，应用于智能网卡，具体的，该网络流量分域方法可以包括如下步骤：步骤301、接收待处理的网络报文。步骤302、确定网络报文所对应的目标NUMA域。步骤303、基于网络接口信息，确定目标NUMA域所对应的收包队列。步骤304、将网络报文保存至目标NUMA域所对应的收包队列中，以使得网络报文存储至对应的目标NUMA域，并基于目标NUMA域对所述网络报文进行处理。随着智能网卡的出现与发展，网卡拥有了可编程能力。因此，在本发明实施例中，利用智能网卡的可编程性，对接收到的网络报文进行流量归属问题的确定后，再将该网络报文保存至其所对应的目标NUMA域所对应的收包队列中，以实现对接收到的网络流量进行分域处理，避免出现跨域的问题。其中，智能网卡可以是基于现场可编程门阵列、专用集成电路、片上系统的智能网卡等。在本发明实施例中，智能网卡只要具有可编程性即可，对智能网卡的类型不做限定。其中，每个智能网卡中可以包括多个网络接口，各个网络接口都可以用于接收网络报文，并且各个网络接口可以对应有多个收包队列。为了使得各个网络报文可以精准地保存至其所属的目标NUMA域中，避免出现转发混乱的情况，可以提前对各个智能网卡中的网络接口进行配置，例如为智能网卡中各个网络接口配置其所对应的收包队列数以及每个收包队列所在的NUMA域。具体的，获取智能网卡所包括的各个网络接口，分别确定各个网络接口所对应的多个收包队列以及多个收包队列各自对应的NUMA域。另外，可以根据实际需求为每个网络接口配置一定数量的收包队列，但是基于计算机最大利用率的角度考虑的话，可以根据每个NUMA域中所包括的CPU核数确定网络接口所对应的收包队列数，即使得每个CPU核都要对应有一个收包队列，这样可以使得计算机得到最大化利用。那么在确定出各个网络接口所对应的收包队列后，为各个收包队列确定其所属的NUMA域，以确保通过收包队列可以精准地将接收到的网络报文保存至对应的目标NUMA域中，以避免出现跨域的问题。在实际应用中，当智能网卡中的任意一个网络接口接收到客户端或服务端发送的待处理的网络报文后，为了确保网络报文可以存储在目标NUMA域中，并在目标NUMA域的物理CPU处理器中进行业务处理，以避免出现跨域的问题，那么在本发明实施例中，对智能网卡进行改进，以使得智能网卡可以对接收到待处理的网络报文进行目标NUMA域的确定，再根据目标NUMA后，将该网络报文保存至目标NUMA域所对应的收包队列中，以确保网络报文可以精准地存储在其所对应的目标NUMA域中，避免出现跨域存储的问题。另外，在本发明实施例中，可以通过网络报文中包括的五元组来确定网络报文所对应的目标NUMA域，也可以基于网络报文中包括的其他的字段、不同数量的字段来确定网络报文所对应的目标NUMA域，对此不做限定，可以根据实际需求进行设定。在一可选实施例中，具体的，接收待处理的网络报文，网络报文中包括五元组，并基于网络报文中包括的五元组，确定网络报文所对应的目标NUMA域。其中，待处理的网络报文中包括网络报文所对应的五元组，即源IP地址、源端口、目的IP地址、目的端口、协议号。由于每个网络报文中对应有唯一的五元组，并且网络中大部分业务流量是基于传输控制协议TCP或用户数据报协议UDP协议，那么可以直接基于网络报文中所包括的五元组确定网络报文所对应的目标NUMA域。具体的，基于网络报文中所包括的五元组，确定网络报文所属的目标NUMA域的实现方式可以为：获取网络流量分域表，网络流量分域表用于确定网络报文所属的NUMA域，基于网络流量分域表和五元组，确定网络报文所对应的目标NUMA域。其中，网络流量分域表中包括多个分域规则，可以提前根据实际需求对网络流量分域表进行设置，也可以在使用的过程中动态设置网络流量分域表。例如通过智能网卡驱动程序，在网络流量分域表中添加新的分域规则、删除网络流量分域表中某一个已经存在的分域规则、清空网络流量分域规则表中所有分域规则等。那么当智能网卡接收到待处理的网络报文后，可以获取智能网卡所对应的网络流量分域表，利用网络流量分域表中的分域规则以及待处理的网络报文中包括的五元组，确定该待处理的网络报文所对应的目标NUMA域。另外，在本发明实施例中对获取网络流量分域表的具体实现方式不做限定，可以根据实际使用相关需求进行设定。例如，可以预先将网络流量分域表存储在智能网卡中，通过读取智能网卡中预先存储的网络流量分域表的方式，获取到该智能网卡所对应的网络流量分域表。或者通过智能网卡驱动程序提供的相关接口接收网络设备应用程序动态下发的网卡流量分域表的方式获取该智能网卡所对应的网络流量分域表。在确定待处理的网络报文所对应的目标NUMA域之后，基于网络接口信息，确定目标NUMA域所对应的收包队列。由于提前为智能网卡中的各个网络接口配置了多个收包队列以及为各个收包队列配置了其所对应的NUMA域，那么在确定出待处理的网络报文之后，可以获取智能网卡所对应的网络接口信息，以及接收待处理的网络报文的目标网络接口，并基于目标网络接口以及网络接口信息，确定目标NUMA域所对应的收包队列。即智能网卡中包括有多个网络接口，获取到的智能网卡所对应的网络接口信息中包括多个网络接口所对应的接口信息，那么在获取到智能网卡所对应的网络接口信息后，在网络接口信息中确定目标网络接口所对应的接口信息，接着基于目标网络接口所对应的接口信息，确定目标NUMA域所对应的收包队列。最后，将网络报文保存目标NUMA域所对应的收包队列中，以使得网络报文存储至对应的目标NUMA域，并基于目标NUMA域对网络报文进行处理，以避免出现跨域存储的问题，那么也可以避免对网络报文进行处理时，需要频繁跨域访问内存的现象，从而提高了网络报文的处理性能。在本发明实施例中，通过待处理的网络报文的五元组，确定该网络报文所对应的目标NUMA域，并基于网卡中的网络接口信息，确定目标NUMA域所对应的收包队列，并将该网络报文保存至目标NUMA域所对应的收包队列中，以确保将接收到的网络报文发送至对应的目标NUMA域，实现了对接收到的各个网络报文进行分域，可以有效避免流量跨域，消除跨域访问内存和异步操作造成的影响，从而提高设备的网络流量处理性能，降低设备成本。图4为本发明实施例提供的一种网络流量分域方法的应用示意图；如图4所示，该网络流量分域方案需要使用到网络设备、客户端、服务器端，网络设备与客户端和服务器端通信连接，为客户端与服务器端提供业务服务。为了提高网络设备的处理性能，网络设备采用NUMA架构，用于处理客户端流量和服务器端流量。网络设备中包括多个NUMA域，并且每个NUMA域中由一个物理CPU处理器、以及与物理CPU处理器相连的本地内存以及网卡等组成。其中，各NUMA域的物理CPU处理器之间通过QPI总线相连接，并且每个物理CPU处理器中可以包括多个CPU核，每个CPU核都可以用于处理客户端流量与服务端流量。另外，每个物理CPU处理器都被分配自己的本地内存，并且可以从系统中的其他CPU访问远程内存。本地内存用于存储接收到的各个网络报文以及物理CPU处理器处理后的各自信息。网卡中包括多个网络接口，通过网络接口与客户端以及服务器端进行网络通信，用于接收客户端或服务器端发送的网络报文，或将网络报文发送至客户端或服务器端。那么可以基于智能网卡的可编程性，当智能网卡中的网络接口接收到网络报文后，先对于网络报文进行分域处理后，将网络报文分发至其所对应的目标NUMA域中，然后对网络报文进行业务处理。另外，每个智能网卡中都包含网卡驱动程序，可以通过网卡驱动程序提供的相关接口来完成相关配置以及相关功能的实现。例如，利用网络驱动程序提供的相关接口添加新的网络流量分域规则、删除某一个已存在的网络流量分域规则、读取某一个已存在的网络流量分域规则、查询网络流量分域表中所有分域规则的数量、读取网络流量分域表中的所有规则、清空网络流量分域表、配置智能网卡所在的NUMA域等。网络设备采用NUMA架构，由于NUMA架构中的物理CPU处理器访问它自己的本地内存的速度比非本地内存快一些，那么为了提高网络设备对网络报文的处理性能，网络设备在对客户端或服务器端的网络报文进行业务处理时，需要将同一连接中的服务器端与客户端的网络报文在同一个NUMA域中的物理CPU处理器中进行业务处理。为了确保同一连接中的服务器端与客户端的网络报文在同一个NUMA域中的物理CPU处理器中进行业务处理，那么可以对各个NUMA域中的网卡进行改进，以使得网卡中的各个网络接口接收到待处理的网络报文后，先确定网络报文所属的目标NUMA域，再基于网络接口信息，确定目标NUMA域所对应的收包队列，再将网络报文保存至目标NUMA域所对应的收包队列中，以使得网络报文存储至对应的目标NUMA域，并基于目标NUMA域对网络报文进行处理。其中，待处理的网络报文中包括网络报文所对应的五元组，即源IP地址、源端口、目的IP地址、目的端口、协议号。本发明实施例中提供的网络流量分域方案是基于智能网卡的可编程性，使得网卡中的各个网络接口接收到待处理的网络报文后，可以基于网络报文中所包括的五元组，确定网络报文所属的目标NUMA域。具体的，基于网络报文中所包括的五元组，确定网络报文所属的目标NUMA域的实现方式可以为：获取网络流量分域表，网络流量分域表用于确定网络报文所属的NUMA域，基于网络流量分域表和五元组，确定网络报文所对应的目标NUMA域。其中，网络流量分域表中包括多个分域规则，并且每个分域规则中包括命中条件以及该分域规则所对应的NUMA域两部分内容。其中，分域规则中的命中条件为五元组即源IP地址、源端口、目的IP地址、目的端口、协议号，若接收到的网络报文的五元组与分域规则中的五元组完全相同，则确定该网络报文符合命中条件；若网络报文的五元组与分域规则中的五元组不完全相同，则确定该网络报文不符合命中条件。若确定待处理的网络报文符合某一分域规则中的命中条件，则直接将该分域规则所对应的NUMA域确定为该待处理的网络报文所对应的目标NUMA域。在确定出待处理的网络报文所对应的目标NUMA域之后，获取智能网卡所对应的网络接口信息，并基于该网络接口信息，确定该目标NUMA域所对应的收包队列，并将该网络报文保存至收包队列中，以使得网络报文存储至对应的目标NUMA域，并基于目标NUMA域对网络报文进行处理，以确保将接收到的网络报文存储至对应的目标NUMA域，实现了对接收到的各个网络报文进行分域，可以有效避免流量跨域。图5为本发明实施例提供的确定网络报文所对应的目标NUMA域的流程示意图；在上述实施例的基础上，继续参考附图5所示，网络流量分域表中包括多个分域规则，本实施例提供了一种可以基于网络流量分域表和五元组，确定网络报文所对应的目标NUMA域的实现方式，具体的可以包括：步骤501、基于五元组，查询网络报文是否命中网络流量分域表中的分域规则。步骤502、若网络报文命中网络流量分域表中的分域规则，则基于分域规则，确定网络报文所对应的目标NUMA域。步骤503、若网络报文未命中网络流量分域中的分域规则，则获取网卡所对应的NUMA域，并将网卡所对应的NUMA域确定为网络报文所对应的目标NUMA域。在本发明实施例中，当智能网卡中的网络接口接收到待处理的网络报文之后，需要确定待处理的网络报文的归属后，再将该网络报文进行分域处理。具体的，基于网络报文中包括的五元组，查询网络报文是否命中网络流量分域中的分域规则。若网络报文命中网络流量分域表中的分域规则，则基于分域规则，确定网络报文所对应的目标NUMA域。若网络报文未命中网络流量分域中的分域规则，则获取网卡所对应的NUMA域，并将网卡所对应的NUMA域确定为网络报文所对应的目标NUMA域。例如，当网络接口接收到网络报文时，查询网络接口所在网卡的网络流量分域表，对于IPv4或IPv6流量，当网络报文的源IP地址、源端口、目的IP地址、目的端口、协议号和网络流量分域表中的某个规则中定义的源IP、源端口、目的IP、目的端口、协议号全部相同时，命中该分域规则，将网络报文保存到该分域规则定义的NUMA域中的收包队列；否则，若没有命中网络流量分域表中的任何分域规则，则将网络报文保存到网络接口所在NUMA域的收包队列。其中，网络流量分域表中包括多个分域规则，并且每个分域规则中包括一组五元组以及该分域规则所对应的NUMA域。可以提前根据实际需求对网络流量分域表进行设置，也可以在使用的过程中动态设置网络流量分域表。由于现有的网络流量包括IPv4流量和IPv6流量，那么在对网络流量分域表中的分域规则进行设置时同时考虑了IPv4流量和IPv6流量的区别，以使得网络流量分域表适用于对IPv4流量和IPv6流量所对应的网络报文进行目标NUMA域的确定。例如，网络流量分域表中各个分域规则所对应的伪代码设置如下：struct domain_rule {union {struct ipv4{unsigned int src_ip;unsigned int dst_ip;};struct ipv6{unsigned char src_ip6;unsigned char dst_ip6;};};unsigned short src_port;unsigned short dst_port;unsigned char protocol;unsigned char isipv6;unsigned char domain;};各字段含义如下。src_ip表示IPv4流量所对应的源IP地址，dst_ip表示IPv4流量所对应的目的IP地址，src_ip6表示IPv6流量所对应的源IP地址，dst_ip6表示IPv6流量所对应的目的IP地址。src_port表示源端口，dst_port表示目的端口。protocol表示IPv4流量或IPv6流量首部中的协议号。isipv6表示此分域规则是针对IPv4流量，还是IPv6流量。domain表示该分域规则所对应的NUMA域，表示网络报文中的五元组命中分域规则后将网络流量送至哪个目标NUMA域。那么在智能网卡中的网络接口接收到待处理的网络报文后，获取该智能网卡所对应的网络流量分域表，并基于该网络报文中包括的五元组，依次在该网络流量分域表中查询各个分域规则中是否包含与网络报文中包括的五元组，若网络流量分域表中某个分域规则中的五元组与待处理的网络报文中的五元组相同，则确定该网络报文命中网络流量分域表中的该分域规则；若网络流量分域表中所有分域规则中的五元组都与待处理的网络报文中的五元组不相同，则确定该网络报文未命中网络流量分域表中的该分域规则。另外，为了提高查表性能，可以采用高效的数据结构来存储网络流量分域表，比如以哈希表的格式将网络流量分域表保存在智能网卡中，具体的，比如利用哈希算法，根据网络报文的五元组，使用其中全部五元组或者n元组，进行取位、偏移、与、或、异或等操作获得关键码值进行分域处理，以避免出现跨域存储的问题。上述实施例中通过网络报文中所包括的五元组来确定网络报文所对应的目标NUMA域，也可以通过网络报文中所包括的任意n元组来确定网络报文所对应的目标NUMA域或者通过网络报文中的其他字段来确定网络报文所对应的目标NUMA域。需要注意的是：若基于n元组，来确定目标NUMA域时，同时动态修改网络流量分域表，其网络流量分域表中的分域规则包括n元组以及该分域规则所对应的NUMA域。若基于网络报文中的其他字段来确定网络报文所对应的目标NUMA域时，同时动态修改网络流量分域表，其网络流量分域表中的分域规则包括其他字段以及该分域规则所对应的NUMA域。其具体确定过程可以参考上述实施例，在此不再赘述。具体应用时，可以参考图6所示的网络流量分域处理的流程示意图。当网络接口接收到网络报文时，对网络报文进行哈希运算，确定网络报文所对应的关键字，基于关键字遍历网络接口所在网卡的网络流量分域表，若网络流量分域表中查找到该关键字所对应的分域规则，则查询网络报文的源IP地址、源端口、目的IP地址、目的端口、协议号与网络流量分域表中的分域规则中定义的源IP、源端口、目的IP、目的端口、协议号是否全部相同，若相同，将网络报文保存到该分域规则定义的NUMA域中的收包队列，否则，继续遍历网络流量分域表；若基于关键字在网络流量分域表中没有查找到任何分域规则，则将网络报文保存到网络接口所在NUMA域的收包队列。图7为本发明实施例提供的确定目标NUMA域所对应的收包队列的流程示意图；在上述实施例的基础上，继续参考附图7所示，本实施例中提供了一种可以基于网络接口信息，确定目标NUMA域所对应的收包队列的实现方式，具体可以包括：步骤701、基于网络接口信息，确定目标NUMA域所对应的收包队列。步骤702、若存在多个收包队列所对应的NUMA域均为目标NUMA域，则基于智能网卡队列分发算法，确定网络报文所对应的目标收包队列。为了使得计算机得到最大化利用，在对智能网卡中各个网络接口配置收包队列时，根据网络设备中CPU核数，为网络设备中的每个CPU核都配置有一个收包队列。由于一个NUMA域中的物理CPU处理器中可能包括多个CPU核，那么为每个网络接口所配置的多个收包队列中可能多个收包队列都对应同一NUMA域。那么当待处理的网络报文所确定的目标NUMA域后，并且网络接口中多个收包队列所对应的NUMA域均为目标NUMA域，如何对网络报文进行处理将显得十分重要。为了解决上述问题，本发明实施例中提出了一种解决方案，当基于网络接口信息，确定出目标域所对应的收包队列后，若存在多个收包队列所对应的目标NUMA域均为目标NUMA域，则基于智能网卡队列分发算法，确定网络报文所对应的目标收包队列。也就是说，当网络接口中多个收包队列所对应的NUMA域均为目标NUMA，基于智能网卡自身队列分发算法确定出待处理的网络报文所对应的目标收包队列。本发明实施例中，通过基于网络接口信息，确定目标NUMA域所对应的收包队列，若存在多个收包队列所对应的NUMA域均为目标NUMA域，则基于智能网卡队列分发算法，确定网络报文所对应的目标收包队列，以使得网络设备可以精准地对网络流量进行分域。具体应用时,假设网络流量分域方案中的网络设备采用如图2所示的架构，网卡1在NUMA域1，网卡2在NUMA域2，并且将网卡1的网络接口1和网卡2的网络接口2进行链路聚合。假设客户端端通过网络接口1向网络设备发送待处理的网络报文，当网络设备中的应用程序通过网络接口1接收到客户端流量并进行处理后，，网络设备中的应用程序可动态下发两条分域规则到聚合链路中所有网络接口所在的网卡，即网络接口1所在的网卡1和网络接口2所在的网卡2。其中，分域规则1保存客户端的五元组信息且domain字段设置为1，分域规则2保存服务器端的五元组信息且domain字段也设置为1。当同一个连接中服务端流量被发往网络接口2后，通过查找网卡2的网络流量分域表，会命中分域规则2，将报文保存到分域规则2定义的NUMA域1中的收包队列，这样服务端的网络报文就会存储到NUMA域1上，并可直接在NUMA域1上进行处理。同理，当聚合链路中网络接口1出现故障，交换机把后续客户端流量发送到网络接口2时，通过查找网络流量分域表，会命中分域规则1，这样客户端的报文依然会存储到NUMA域1上，并仍然在NUMA域1上进行处理。这样就避免了跨域访问内存和异步操作导致的性能下降。另外，在本发明实施例中，对于多个网络接口组成的聚合链路，每个网络接口所在的智能网卡都会使用相同的网络流量分域表。其详细的实现过程可以参考上述的相关描述，在此不再赘述。以下将详细描述本发明的一个或多个实施例的网络流量分域装置。本领域技术人员可以理解，这些装置均可使用市售的硬件组件通过本方案所教导的步骤进行配置来构成。图8为本发明实施例提供的一种网络流量分域装置的结构示意图，如图8所示，该装置包括：接收模块11、第一确定模块12、第二确定模块13、发送模块14。接收模块11，用于接收待处理的网络报文；第一确定模块12，用于确定所述网络报文所对应的目标NUMA域；第二确定模块13，用于基于网络接口信息，确定所述目标NUMA域所对应的收包队列；存储模块14，用于将所述网络报文发送至目标NUMA域所对应的收包队列中，以使得所述网络报文存储至对应的目标NUMA域，并基于所述目标NUMA域对所述网络报文进行处理。优选地，所述装置还可以包括获取模块，所述获取模块具体用于：获取所述智能网卡所包括的各个网络接口；分别确定所述各个网络接口所对应的多个收包队列以及所述多个收包队列各自对应的NUMA域。优选地，所述网络报文中包括五元组，所述第一确定模块12具体可以用于：获取网络流量分域表，所述网络流量分域表用于确定网络报文所属的NUMA域；基于网络流量分域表和所述五元组，确定所述网络报文所对应的目标NUMA域。优选地，所述网络流量分域表中包括多个分域规则，所述第一确定模块12具体可以用于：基于所述五元组，查询所述网络报文是否命中所述网络流量分域中的分域规则；若所述网络报文命中网络流量分域表中的分域规则，则基于所述分域规则，确定所述网络报文所对应的目标NUMA域；若所述网络报文未命中网络流量分域中的分域规则，则获取所述网卡所对应的NUMA域，并将所述网卡所对应的NUMA域确定为所述网络报文所对应的目标NUMA域。优选地，所述第一确定模块12具体还可以用于：对所述网络报文进行哈希运算，获得所述网络报文所对应的关键字；在网络流量分域表所对应的哈希表中进行查询所述关键字所对应的一组分域规则；若所述一组分域规则中查询到一个分域规则中的五元组与网络报文中的五元组相同，则确定所述网络报文命中所述网络流量分域表中的分域规则；若所述一组分域规则中未查询到分域规则或未查询到一个分域规则中的五元组与网络报文中的五元组相同，则网络报文未命中所述网络流量分域表中的分域规则。优选地，所述分域规则包括五元组以及所述五元组所对应的NUMA域；所述第一确定模块12具体还可以用于：若所述网络报文中的五元组与所述一个分域规则中的五元组相同，则将所述分域规则中的五元组所对应的NUMA域确定为所述网络报文所对应的目标NUMA域。优选地，第二确定模块13具体可以用于：基于网络接口信息，确定所述目标NUMA域所对应的收包队列；若存在多个收包队列所对应的NUMA域均为目标NUMA域，则基于所述智能网卡队列分发算法，确定所述网络报文所对应的目标收包队列。图8所示装置可以执行前述图1至图7所示实施例中提供的网络流量分域方法，详细的执行过程和技术效果参见前述实施例中的描述，在此不再赘述。在一个可能的设计中，上述图8所示网络流量分域装置的结构可实现为一电子设备，本实施例提供的电子设备，可接收待处理的网络报文；确定所述网络报文所对应的目标NUMA域；基于网络接口信息，确定所述目标NUMA域所对应的收包队列；将所述网络报文保存至目标NUMA域所对应的收包队列中，以使得所述网络报文存储至对应的目标NUMA域，并基于所述目标NUMA域对所述网络报文进行处理，可以有效避免流量跨域，消除跨域访问内存和异步操作的影响，从而提高设备的网络流量处理性能，降低设备成本。如图9所示，该电子设备可以包括：处理器21、存储器22。其中，存储器22上存储有可执行代码，当所述可执行代码被处理器21执行时，使处理器21至少可以实现如前述图1至图7所示实施例中提供的网络流量分域方法。本发明实施例中，存储器22用于存储计算机程序，并可被配置为存储其它各种数据以支持在其所在设备上的操作。其中，处理器21可执行存储器中存储的计算机程序，以实现相应控制逻辑。存储器22可以由任何类型的易失性或非易失性存储设备或者它们的组合实现，如静态随机存取存储器，电可擦除可编程只读存储器，可擦除可编程只读存储器，可编程只读存储器，只读存储器，磁存储器，快闪存储器，磁盘或光盘。可选地，该电子设备中还可以包括通信接口23，用于与其他设备进行通信。通信接口被配置为便于其所在设备和其他设备之间有线或无线方式的通信。通信接口所在设备可以接入基于通信标准的无线网络，如WiFi，2G或3G，4G，5G或它们的组合。在一个示例性实施例中，通信组件经由广播信道接收来自外部广播管理系统的广播信号或广播相关信息。在一个示例性实施例中，所述通信组件还可基于近场通信技术、射频识别技术、红外数据协会技术、超宽带技术、蓝牙技术或其他技术来实现。可选地，该电子设备中还可以包括显示组件，显示组件可以包括液晶显示器和触摸面板。如果显示组件包括触摸面板，显示组件可以被实现为触摸屏，以接收来自用户的输入信号。触摸面板包括一个或多个触摸传感器以感测触摸、滑动和触摸面板上的手势。所述触摸传感器可以不仅感测触摸或滑动动作的边界，而且还检测与所述触摸或滑动操作相关的持续时间和压力。另外，本发明实施例提供了一种非暂时性机器可读存储介质，所述非暂时性机器可读存储介质上存储有可执行代码，当所述可执行代码被电子设备的处理器执行时，使所述处理器至少可以实现如前述图1至图7所示实施例中提供的网络流量分域方法。以上所描述的装置实施例仅仅是示意性的，其中所述作为分离部件说明的单元可以是或者也可以不是物理上分开的。可以根据实际的需要选择其中的部分或者全部模块来实现本实施例方案的目的。通过以上的实施方式的描述，本领域的技术人员可以清楚地了解到各实施方式可借助必需的通用硬件来实现，当然也可以通过硬件和软件结合的方式来实现。基于这样的理解，上述技术方案本质上或者说对现有技术做出贡献的部分可以以计算机产品的形式体现出来，本发明可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。最后应说明的是：以上实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的精神和范围。
