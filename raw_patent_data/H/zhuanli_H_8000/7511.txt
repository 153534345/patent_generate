标题title
终端外联检测方法、装置、电子设备及存储介质
摘要abst
本发明提供一种终端外联检测方法、装置、电子设备及存储介质，该方法包括：发送DNS请求；获取DNS劫持网关返回的外网页面IP地址；其中，所述外网页面IP地址为所述DNS劫持网关对所述DNS请求中访问非内网资源的域名进行劫持和解析后得到；基于所述外网页面IP地址，发送访问请求至对应的外网页面；在接收到所述外网页面基于所述访问请求返回的外联告警页面的情况下，确定与内网连接的本体终端还与外网连接。本发明提供的终端外联检测方法、装置、电子设备及存储介质，可以在不需要安装客户端或者设置内网WEB页面的情况下，检测内网终端是否实现外网连接。
权利要求书clms
1.一种终端外联检测方法，其特征在于，包括：发送DNS请求；获取DNS劫持网关返回的外网页面IP地址；其中，所述外网页面IP地址为所述DNS劫持网关对所述DNS请求中访问非内网资源的域名进行劫持和解析后得到；基于所述外网页面IP地址，发送访问请求至对应的外网页面；在接收到所述外网页面基于所述访问请求返回的外联告警页面的情况下，确定与内网连接的本体终端还与外网连接。2.根据权利要求1所述的终端外联检测方法，其特征在于，所述发送DNS请求，包括：加载用于访问外网资源的网络页面，以发送所述DNS请求至外网服务器和所述内网服务器。3.根据权利要求1所述的终端外联检测方法，其特征在于，所述基于所述外网页面IP地址，发送访问请求至对应的外网页面，包括：基于所述外网页面IP地址，并通过所述本体终端的外网网卡将所述访问请求发送至所述外网页面。4.根据权利要求1-3任一项所述的终端外联检测方法，其特征在于，还包括：基于所述外联告警页面，发送取证指令至内网服务器，以基于所述内网服务器向发送断开指令至身份认证系统，控制所述身份认证系统将本体终端的内网连接断开。5.根据权利要求4所述的终端外联检测方法，其特征在于，所述取证指令还用于控制所述内网服务器执行告警操作。6.根据权利要求4所述的终端外联检测方法，其特征在于，所述基于所述外联告警页面，发送取证指令至内网服务器，包括：加载所述外联告警页面，基于所述外联告警页面中的JS脚本代码向所述内网服务器发送所述取证指令。7.根据权利要求4所述的终端外联检测方法，其特征在于，所述取证指令中包含有指令报文的源IP地址、MAC地址以及报文时间中的至少一种。8.一种终端外联检测装置，其特征在于，包括：第一发送模块，用于发送DNS请求；第一获取模块，用于获取DNS劫持网关返回的外网页面IP地址；其中，所述外网页面IP地址为所述DNS劫持网关对所述DNS请求中访问非内网资源的域名进行劫持和解析后得到；第二发送模块，用于基于所述外网页面IP地址，发送访问请求至对应的外网页面；第二获取模块，用于在接收到所述外网页面基于所述访问请求返回的外联告警页面的情况下，确定与内网连接的本体终端还与外网连接。9.一种电子设备，其特征在于，包括存储器和处理器，其中，所述存储器，用于存储程序；所述处理器，与所述存储器耦合，用于执行所述存储器中存储的所述程序，以实现上述权利要求1至7中任意一项所述的终端外联检测方法中的步骤。10.一种非暂态计算机可读存储介质，其上存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现如权利要求1至7任一项所述的终端外联检测方法。
说明书desc
技术领域本发明涉及网络通信技术领域，具体涉及一种终端外联检测方法、装置、电子设备及存储介质。背景技术一些内网终端出于保密或安全的相关需要，需要防止该终端在接入内网的同时接入互联网。目前为了防止内网终端在接入内网的同时接入互联网，可以使用安装客户端的方法，此方法可以有效检测到终端的外联行为，并能直接定位终端。但由于需要安装客户端，其兼容性和用户接受度较差。另外一种方法是非客户端的方式进行外联检测，此方法主要基于WEB方式进行探测，通过让终端访问指定的内网WEB页面，加载JS脚本，使用JS脚本携带终端特征信息访问外网取证服务器的方式，识别外联行为。但在实践中，绝大部分内部网络并不存在让终端必须访问的内网WEB页面，或对应的WEB页面没有改造条件，导致检测效果无法达到应用要求。另外，原有的方式也可能会对内网业务产生不良影响。因此，目前无法提供一种方法，可以在不需要安装客户端或者设置内网WEB页面的情况下，检测内网终端是否实现外网连接。发明内容有鉴于此，有必要提供一种终端外联检测方法、装置、电子设备及存储介质，用以在不需要安装客户端或者设置内网WEB页面的情况下，检测内网终端是否实现外网连接。为了实现上述目的，本发明提供了一种终端外联检测方法，包括：发送DNS请求；获取DNS劫持网关返回的外网页面IP地址；其中，所述外网页面IP地址为所述DNS劫持网关对所述DNS请求中访问非内网资源的域名进行劫持和解析后得到；基于所述外网页面IP地址，发送访问请求至对应的外网页面；在接收到所述外网页面基于所述访问请求返回的外联告警页面的情况下，确定与内网连接的本体终端还与外网连接。进一步地，所述发送DNS请求，包括：加载用于访问外网资源的网络页面，以发送所述DNS请求至外网服务器和所述内网服务器。进一步地，所述基于所述外网页面IP地址，发送访问请求至对应的外网页面，包括：基于所述外网页面IP地址，并通过所述本体终端的外网网卡将所述访问请求发送至所述外网页面。进一步地，所述的终端外联检测方法，还包括：基于所述外联告警页面，发送取证指令至内网服务器，以基于所述内网服务器向发送断开指令至身份认证系统，控制所述身份认证系统将本体终端的内网连接断开。进一步地，所述取证指令还用于控制所述内网服务器执行告警操作。进一步地，所述基于所述外联告警页面，发送取证指令至内网服务器，包括：加载所述外联告警页面，基于所述外联告警页面中的JS脚本代码向所述内网服务器发送所述取证指令。进一步地，所述取证指令中包含有指令报文的源IP地址、MAC地址以及报文时间中的至少一种。本发明还提供一种终端外联检测装置，包括：第一发送模块，用于发送DNS请求；第一获取模块，用于获取DNS劫持网关返回的外网页面IP地址；其中，所述外网页面IP地址为所述DNS劫持网关对所述DNS请求中访问非内网资源的域名进行劫持和解析后得到；第二发送模块，用于基于所述外网页面IP地址，发送访问请求至对应的外网页面；第二获取模块，用于在接收到所述外网页面基于所述访问请求返回的外联告警页面的情况下，确定与内网连接的本体终端还与外网连接。本发明还提供一种电子设备，包括存储器和处理器，其中，所述存储器，用于存储程序；所述处理器，与所述存储器耦合，用于执行所述存储器中存储的所述程序，以实现上述任意一项所述的终端外联检测方法中的步骤。本发明还提供一种非暂态计算机可读存储介质，其上存储有计算机程序，所述计算机程序被处理器执行时实现如上述任一项所述的终端外联检测方法。采用上述实现方式的有益效果是：本发明提供的终端外联检测方法、装置、电子设备及存储介质，通过DNS劫持网关对本体终端发出的DNS请求进行劫持和解析后，得到外网页面IP地址时，DNS劫持网关将外网页面IP地址返回至本体终端，本体终端在基于该外网页面IP地址访问对应的外网页面后，会获得返回的外联告警页面，表面本体终端真实访问了外网资源，整个过程不需要在本体终端安装客户端资源，也不需要设置内网WEB页面，只需要通过DNS网关对本体终端发送的DNS请求进行劫持和解析，得到外网页面IP地址，再由本体终端基于外网页面IP地址执行访问操作，确定是否真实访问外网资源。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明提供的终端外联检测方法的一实施例的流程示意图；图2为本发明提供的终端外联检测方法的另一实施例的流程示意图；图3为本发明提供的终端外联检测装置的结构示意图；图4为本发明提供的电子设备的一个实施例结构示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述。显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。在本申请实施例的描述中，除非另有说明，“多个”的含义是两个或两个以上。本发明实施例中术语“包括”和“具有”以及他们的任何变形，意图在于覆盖不排他的包含，例如，包含了一系列步骤或模块的过程、方法、装置、产品或设备不必限于清楚地列出的那些步骤或模块，而是可包括没有清楚地列出的或对于这些过程、方法、产品或设备固有的其它步骤或模块。在本发明实施例中出现的对步骤进行的命名或者编号，并不意味着必须按照命名或者编号所指示的时间/逻辑先后顺序执行方法流程中的步骤，已经命名或者编号的流程步骤可以根据要实现的技术目的变更执行次序，只要能达到相同或者相类似的技术效果即可。在本文中提及“实施例”意味着，结合实施例描述的特定特征、结构或特性可以包含在本发明的至少一个实施例中。在说明书中的各个位置出现该短语并不一定均是指相同的实施例，也不是与其它实施例互斥的独立的或备选的实施例。本领域技术人员显式地和隐式地理解的是，本文所描述的实施例可以与其它实施例相结合。如图1所示，本发明提供了一种终端外联检测方法、装置、电子设备及存储介质，以下分别进行说明。本发明提供一种终端外联检测方法，包括：步骤110、发送DNS请求。可以理解的是，本发明提供的终端外联检测方法应用于本体终端，即由本体终端执行本发明提供的方法。本体终端为同时连接内网和外网的终端；本体终端可以同时向内网服务器和外网服务器发送DNS请求。步骤120、获取DNS劫持网关返回的外网页面IP地址；其中，所述外网页面IP地址为所述DNS劫持网关对所述DNS请求中访问非内网资源的域名进行劫持和解析后得到。可以理解的是，本体终端发送内网服务器的被DNS劫持网关劫持后，DNS劫持网关将DNS请求中访问非内网资源的域名解析为外网页面的IP地址，当DNS请求中包含有访问非内网资源的域名时，可以确定内网设备想要访问外网的资源，此时可以通过DNS劫持网关进行劫持。DNS劫持就是通过各种技术手段取得域名的解析控制权，进而修改域名的解析记录，将域名指向的服务器IP地址修改为受控制的IP地址，从而将用户引导至其他网页。步骤130、基于所述外网页面IP地址，发送访问请求至对应的外网页面。可以理解的是，本体终端接收到DNS劫持网关返回的外网页面的IP地址后，本体终端的浏览器所访问域名的IP地址被指向部署在外网的外网页面的IP地址，并根据本体终端的本地路由，将访问请求发送至外网页面。步骤140、在接收到所述外网页面基于所述访问请求返回的外联告警页面的情况下，确定与内网连接的本体终端还与外网连接。可以理解的是，外网页面在收到本体终端发送的访问请求之后，会根据访问请求返回外联告警页面给本体终端，如果本体终端接收到了外联告警页面，则证明本体终端连接有外网，才可以访问外网资源。在一些实施例中，终端外联检测方法，还包括：基于所述外联告警页面，发送取证指令至内网服务器，以基于所述内网服务器向发送断开指令至身份认证系统，控制所述身份认证系统将本体终端的内网连接断开。可以理解的是，本体终端接收到返回的外联告警页面之后，基于外联告警页面向内网服务器发送取证指令，内网服务器收到取证指令后，向身份认证系统发送断开指令，身份认证系统在认证通过之后，将本体终端所连接的内网断开。在一些实施例中，所述本体终端设置有内网网卡和外网网卡，所述内网网卡配置有内网IP地址，所述外网网卡配置有外网IP地址。可以理解的是，本体终端在配置双网卡状态时，其内网网卡和外网网卡均配置相应IP地址及DNS服务器IP地址。具体地，内网网卡配置有内网IP地址、内网DNS服务器IP地址、内网掩码和内网网关，以可以用于访问内网资源；外网网卡配置有外网IP地址、外网DNS服务器IP地址、外网掩码和外网网关，以可以用于访问外网资源。此外，本体终端还根据内外网访问需要设置相应路由以保证本体终端可以同时访问外网和内网资源。在一些实施例中，所述发送DNS请求，包括：加载用于访问外网资源的网络页面，以发送所述DNS请求至外网服务器和所述内网服务器。可以理解的是，用于访问外网资源的网络页面，可以是页面，也可以是HTTPS页面。当本体终端打开任意的HTTP页面或者HTTPS页面访问外网资源时，本体终端同时向内网服务器和外网服务器发送DNS请求。在一些实施例中，所述基于所述外网页面IP地址，发送访问请求至对应的外网页面，包括：基于所述外网页面IP地址，并通过所述本体终端的外网网卡将所述访问请求发送至所述外网页面。可以理解的是，本体终端设置有内网网卡和外网网卡，内网网卡可以用来连接内网，外网网卡可以用来连接互联网，即外网。本体终端的浏览器所访问域名的IP地址被指向部署在外网的外网页面的IP地址，并根据本体终端的本地路由，将访问请求由本体终端的外网网卡向互联网进行路由转发，从而发送至外网页面。在一些实施例中，所述取证指令还用于控制所述内网服务器执行告警操作。可以理解的是，本体终端加载外联告警页面，发送取证指令至内网服务器，内网服务器收到取证指令后，记录取证指令并验证该取证指令，在取证指令验证通过后，由内网服务器向网络运维管理人员进行告警，例如向网络运维管理人员的终端设备发出告警信号。在一些实施例中，所述基于所述外联告警页面，发送取证指令至内网服务器，包括：加载所述外联告警页面，基于所述外联告警页面中的JS脚本代码向所述内网服务器发送所述取证指令。可以理解的是，外联告警页面携带有用于发送取证指令的JS脚本代码，在浏览器加载外联告警页面时，也会同时执行外联告警页面中携带的JS脚本代码，向内网服务器发送取证指令。在一些实施例中，所述取证指令中包含有指令报文的源IP地址、MAC地址以及报文时间中的至少一种。可以理解的是，指令报文的源IP地址也即是发送取证指令的本体终端的IP地址，指令报文的MAC地址也即是发送取证指令的本体终端的MAC地址，报文时间也即是本体终端发送指令报文的时间。内网服务器在接收到取证指令后，根据源IP地址、MAC地址或者报文时间对取证指令进行验证，如果源IP地址、MAC地址或者报文时间满足预设的对比信息，则验证通过，执行告警以及将本体终端的内网断开。在另一些实施例中，本发明提供的终端外联检测方法的流程图如图2所示，先由本体终端的内网卡发送DNS请求，该DNS请求被DNS劫持网关劫持和解析后，返回外网检测页面IP地址。本体终端的外网卡基于外网检测页面IP地址访问外网检测页面，外网检测页面返回告警页面，本体终端的内网卡基于告警页面中的JS脚本代码发送取证指令至内网服务器，内网服务器通过身份认证系统对本体终端断开内网。综上所述，本发明提供一种终端外联检测方法，包括：发送DNS请求；获取DNS劫持网关返回的外网页面IP地址；其中，所述外网页面IP地址为所述DNS劫持网关对所述DNS请求中访问非内网资源的域名进行劫持和解析后得到；基于所述外网页面IP地址，发送访问请求至对应的外网页面；在接收到所述外网页面基于所述访问请求返回的外联告警页面的情况下，确定与内网连接的本体终端还与外网连接。在本发明提供的终端外联检测方法中，通过DNS劫持网关对本体终端发出的DNS请求进行劫持和解析后，得到外网页面IP地址时，DNS劫持网关将外网页面IP地址返回至本体终端，本体终端在基于该外网页面IP地址访问对应的外网页面后，会获得返回的外联告警页面，表面本体终端真实访问了外网资源，整个过程不需要在本体终端安装客户端资源，也不需要设置内网WEB页面，只需要通过DNS网关对本体终端发送的DNS请求进行劫持和解析，得到外网页面IP地址，再由本体终端基于外网页面IP地址执行访问操作，确定是否真实访问外网资源。如图3所示，本发明还提供一种终端外联检测装置300，包括：第一发送模块310，用于发送DNS请求；第一获取模块320，用于获取DNS劫持网关返回的外网页面IP地址；其中，所述外网页面IP地址为所述DNS劫持网关对所述DNS请求中访问非内网资源的域名进行劫持和解析后得到；第二发送模块330，用于基于所述外网页面IP地址，发送访问请求至对应的外网页面；第二获取模块340，用于在接收到所述外网页面基于所述访问请求返回的外联告警页面的情况下，确定与内网连接的本体终端还与外网连接。上述实施例提供的终端外联检测装置可实现上述终端外联检测方法实施例中描述的技术方案，上述各模块或单元具体实现的原理可参见上述终端外联检测方法实施例中的相应内容，此处不再赘述。如图4所示，本发明还相应提供了一种电子设备400。该电子设备400包括处理器401、存储器402及显示器403。图4仅示出了电子设备400的部分组件，但是应理解的是，并不要求实施所有示出的组件，可以替代的实施更多或者更少的组件。存储器402在一些实施例中可以是电子设备400的内部存储单元，例如电子设备400的硬盘或内存。存储器402在另一些实施例中也可以是电子设备400的外部存储设备，例如电子设备400上配备的插接式硬盘，智能存储卡，安全数字卡，闪存卡等。进一步地，存储器402还可既包括电子设备400的内部储存单元也包括外部存储设备。存储器402用于存储安装电子设备400的应用软件及各类数据。处理器401在一些实施例中可以是一中央处理器，微处理器或其他数据处理芯片，用于运行存储器402中存储的程序代码或处理数据，例如本发明中的终端外联检测方法。显示器403在一些实施例中可以是LED显示器、液晶显示器、触控式液晶显示器以及OLED触摸器等。显示器403用于显示在电子设备400的信息以及用于显示可视化的用户界面。电子设备400的部件401-403通过系统总线相互通信。在本发明的一些实施例中，当处理器401执行存储器402中的非客户端式外联检测程序时，可实现以下步骤：发送DNS请求；获取DNS劫持网关返回的外网页面IP地址；其中，所述外网页面IP地址为所述DNS劫持网关对所述DNS请求中访问非内网资源的域名进行劫持和解析后得到；基于所述外网页面IP地址，发送访问请求至对应的外网页面；在接收到所述外网页面基于所述访问请求返回的外联告警页面的情况下，确定与内网连接的本体终端还与外网连接。应当理解的是：处理器401在执行存储器402中的非客户端式外联检测程序时，除了上面的功能之外，还可实现其它功能，具体可参见前面相应方法实施例的描述。进一步地，本发明实施例对提及的电子设备400的类型不做具体限定，电子设备400可以为手机、平板电脑、个人数字助理、可穿戴设备、膝上型计算机等便携式电子设备。便携式电子设备的示例性实施例包括但不限于搭载IOS、android、microsoft或者其他操作系统的便携式电子设备。上述便携式电子设备也可以是其他便携式电子设备，诸如具有触敏表面的膝上型计算机等。还应当理解的是，在本发明其他一些实施例中，电子设备400也可以不是便携式电子设备，而是具有触敏表面的台式计算机。又一方面，本发明还提供一种非暂态计算机可读存储介质，其上存储有计算机程序，该计算机程序被处理器执行时实现以执行上述各方法提供的终端外联检测方法，该方法包括：发送DNS请求；获取DNS劫持网关返回的外网页面IP地址；其中，所述外网页面IP地址为所述DNS劫持网关对所述DNS请求中访问非内网资源的域名进行劫持和解析后得到；基于所述外网页面IP地址，发送访问请求至对应的外网页面；在接收到所述外网页面基于所述访问请求返回的外联告警页面的情况下，确定与内网连接的本体终端还与外网连接。本领域技术人员可以理解，实现上述实施例方法的全部或部分流程，可以通过计算机程序来指令相关的硬件来完成，程序可存储于计算机可读存储介质中。其中，计算机可读存储介质为磁盘、光盘、只读存储记忆体或随机存储记忆体等。以上对本发明所提供的终端外联检测方法、装置、电子设备及存储介质进行了详细介绍，本文中应用了具体个例对本发明的原理及实施方式进行了阐述，以上实施例的说明只是用于帮助理解本发明的方法及其核心思想；同时，对于本领域的技术人员，依据本发明的思想，在具体实施方式及应用范围上均会有改变之处，综上所述，本说明书内容不应理解为对本发明的限制。
