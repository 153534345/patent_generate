标题title
一种多级可编程编辑的报文处理方法
摘要abst
本说明书公开了一种多级可编程编辑的报文处理方法，应用在交换机中，交换机包括：控制单元，交换芯片和数据转发单元，控制单元向交换芯片发送配置信息，以及向数据转发单元发送转发规则，交换芯片根据配置信息生成可编程编辑匹配规则表，按照优先级遍历可编程编辑匹配规则表，确定报文是否命中报文匹配规则，若报文命中报文匹配规则，根据报文匹配规则对应的报文编辑规则对所述报文进行编辑，以完成一次编辑得到编辑后的报文，并将编辑后的报文转发给数据转发单元，数据转发单元将编辑后的报文重新转回交换芯片进行处理，以使交换芯片继续进行报文匹配规则的匹配，从而实现交换机中对报文的多级编辑，提高了交换机的适用性。
权利要求书clms
1.一种多级可编程编辑的报文处理方法，其特征在于，所述方法应用在交换机中，所述交换机包括：控制单元，交换芯片和数据转发单元，包括：所述控制单元向所述交换芯片发送配置信息，以及向所述数据转发单元发送转发规则，所述配置信息至少包括报文匹配规则和报文编辑规则；所述交换芯片接收到所述配置信息，根据所述配置信息生成可编程编辑匹配规则表，所述可编程编辑匹配规则表中的报文匹配规则和报文编辑规则之间一一对应；所述交换芯片接收到报文时，所述交换芯片按照优先级遍历所述可编程编辑匹配规则表，确定所述报文是否命中报文匹配规则，所述优先级表示所述可编程编辑匹配规则表中报文匹配规则对应的优先级；若所述报文命中报文匹配规则，根据所述报文匹配规则对应的报文编辑规则对所述报文进行编辑，以完成一次编辑得到编辑后的报文，并将编辑后的报文转发给数据转发单元，所述数据转发单元接收到编辑后的报文，按照所述转发规则，将所述编辑后的报文返回给所述交换芯片，以使所述交换芯片接收到编辑后的报文，继续确定所述编辑后的报文是否命中报文匹配规则，并在所述编辑后的报文命中报文匹配规则时，进行第二次编辑，直到所述交换芯片接收到的所述数据转发单元返回的编辑后的报文未命中任意报文匹配规则，所述交换芯片将编辑后的报文从指定出口进行转发；若所述报文未命中报文匹配规则，所述交换芯片将所述报文从指定出口进行转发。2.如权利要求1所述的方法，其特征在于，所述报文匹配规则中至少包括：优先级、起始偏移位置、偏移长度以及匹配特征，所述起始偏移位置与所述偏移长度用于定位报文匹配的字段位置，所述匹配特征用于表示报文匹配的字段特征。3.如权利要求2所述的方法，其特征在于，按照优先级遍历所述可编程编辑匹配规则表，确定所述报文是否命中报文匹配规则，具体包括：按优先级遍历可编程编辑匹配规则表，确定报文匹配规则中的启始偏移位置、偏移长度、匹配特征；基于起始偏移位置，按偏移长度进行偏移，以提取出与匹配特征对应的字段相同长度的目标字段；将所述目标字段与匹配特征对应的字段进行按位异或运算，得到运算结果；根据所述运算结果，确定所述报文是否命中报文匹配规则。4.如权利要求1所述的方法，其特征在于，所述报文编辑规则中至少包括：编辑动作以及编辑内容。5.如权利要求4所述的方法，其特征在于，所述编辑动作包括插入、删除、修改中至少一种。6.如权利要求4所述的方法，其特征在于，若所述报文命中报文匹配规则，根据所述报文匹配规则对应的报文编辑规则对所述报文进行编辑，具体包括：若所述报文命中报文匹配规则，确定所述报文匹配规则对应的报文编辑规则中的编辑动作以及编辑内容；按照所述编辑动作，根据所述编辑内容，对所述报文进行编辑，得到编辑后的报文。7.如权利要求1所述的方法，其特征在于，所述配置信息中还包括其他配置信息，所述其他配置信息中包括负责交换芯片与数据转发单元之间连通的端口配置、报文完成编辑后继续重定向到数据转发单元的配置、报文未命中报文匹配规则后指定出口配置、可编程编辑匹配规则表捆绑生效端口配置。8.如权利要求1所述的方法，其特征在于，所述控制单元向所述交换芯片发送信息的方式包括SONiC_CLI、REDIS-CLI、CTC_SHELL中的至少一种。9.如权利要求1所述的方法，其特征在于，所述控制单元向所述数据转发单元发送转发规则的发送方式包括Socket 通信、HTTP 通信、JMS、WebService中的至少一种。10.如权利要求1所述的方法，其特征在于，所述转发规则包括：报文出口、报文入口以及是否保留vid。11.如权利要求10所述的方法，其特征在于，将编辑后的报文转发给数据转发单元，所述数据转发单元接收到编辑后的报文，具体包括：交换芯片将编辑后的报文转发给数据转发单元，以使所述数据转发单元按照所述转发规则通过所述报文入口接收所述编辑后的报文；数据转发单元接收到所述编辑后的报文后，按照所述转发规则将所述编辑后的报文从所述报文出口发出。12.一种交换机，其特征在于，所述交换机包括：控制单元，交换芯片和数据转发单元；所述控制单元向所述交换芯片发送配置信息，以及向所述数据转发单元发送转发规则，所述配置信息至少包括报文匹配规则和报文编辑规则；所述交换芯片接收到所述配置信息，根据所述配置信息生成可编程编辑匹配规则表，所述可编程编辑匹配规则表中的报文匹配规则和报文编辑规则之间一一对应；所述交换芯片接收到报文时，所述交换芯片按照优先级遍历所述可编程编辑匹配规则表，确定所述报文是否命中报文匹配规则，所述优先级表示所述可编程编辑匹配规则表中报文匹配规则对应的优先级；若所述报文命中报文匹配规则，根据所述报文匹配规则对应的报文编辑规则对所述报文进行编辑，以完成一次编辑得到编辑后的报文，并将编辑后的报文转发给数据转发单元，所述数据转发单元接收到编辑后的报文，按照所述转发规则，将所述编辑后的报文返回给所述交换芯片，以使所述交换芯片接收到编辑后的报文，继续确定所述编辑后的报文是否命中报文匹配规则，并在所述编辑后的报文命中报文匹配规则时，进行第二次编辑，直到所述交换芯片接收到的所述数据转发单元返回的编辑后的报文未命中任意报文匹配规则，所述交换芯片将编辑后的报文从指定出口进行转发；若所述报文未命中报文匹配规则，所述交换芯片将所述报文从指定出口进行转发。13.一种计算机可读存储介质，其特征在于，所述存储介质存储有计算机程序，所述计算机程序被处理器执行时实现上述权利要求1~11任一项所述的方法。14.一种电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，其特征在于，所述处理器执行所述程序时实现上述权利要求1~11任一项所述的方法。
说明书desc
技术领域本说明书涉及报文处理技术领域，尤其涉及一种多级可编程编辑的报文处理方法。背景技术交换机是一种在通信系统中完成信息交换功能的设备，交换机可以将从一个设备接收到的报文转发到另一个设备，但是，在某些情况下，交换机需要对报文进行编辑，将编辑后的报文进行转发。由于交换机中的交换芯片的限制，当前传统交换机进行报文编辑只能是一次性的。因此，若是需要针对一个报文进行多次编辑，则由于交换芯片本身的限制难以做到。所以，如何在交换机内部实现对同一个报文的多次编辑，则是一个亟待解决的问题。发明内容本说明书提供一种多级可编程编辑的报文处理方法，以部分的解决现有技术存在的上述问题。本说明书采用下述技术方案：本说明书提供了一种多级可编程编辑的报文处理方法，所述方法应用在交换机中，所述交换机包括：控制单元，交换芯片和数据转发单元，包括：所述控制单元向所述交换芯片发送配置信息，以及向所述数据转发单元发送转发规则，所述配置信息至少包括报文匹配规则和报文编辑规则；所述交换芯片接收到所述配置信息，根据所述配置信息生成可编程编辑匹配规则表，所述可编程编辑匹配规则表中的报文匹配规则和报文编辑规则之间一一对应；所述交换芯片接收到报文时，所述交换芯片按照优先级遍历所述可编程编辑匹配规则表，确定所述报文是否命中报文匹配规则，所述优先级表示所述可编程编辑匹配规则表中报文匹配规则对应的优先级；若所述报文命中报文匹配规则，根据所述报文匹配规则对应的报文编辑规则对所述报文进行编辑，以完成一次编辑得到编辑后的报文，并将编辑后的报文转发给数据转发单元，所述数据转发单元接收到编辑后的报文，按照所述转发规则，将所述编辑后的报文返回给所述交换芯片，以使所述交换芯片接收到编辑后的报文，继续确定所述编辑后的报文是否命中报文匹配规则，并在所述编辑后的报文命中报文匹配规则时，进行第二次编辑，直到所述交换芯片接收到的所述数据转发单元返回的编辑后的报文未命中任意报文匹配规则，所述交换芯片将编辑后的报文从指定出口进行转发；若所述报文未命中报文匹配规则，所述交换芯片将所述报文从指定出口进行转发。可选地，所述报文匹配规则中至少包括：优先级、起始偏移位置、偏移长度以及匹配特征，所述起始偏移位置与所述偏移长度用于定位报文匹配的字段位置，所述匹配特征用于表示报文匹配的字段特征。可选地，按照优先级遍历所述可编程编辑匹配规则表，确定所述报文是否命中报文匹配规则，具体包括：按优先级遍历可编程编辑匹配规则表，确定报文匹配规则中的启始偏移位置、偏移长度、匹配特征；基于起始偏移位置，按偏移长度进行偏移，以提取出与匹配特征对应的字段相同长度的目标字段；将所述目标字段与匹配特征对应的字段进行按位异或运算，得到运算结果；根据所述运算结果，确定所述报文是否命中报文匹配规则。可选地，所述报文编辑规则中至少包括：编辑动作以及编辑内容。可选地，所述编辑动作包括插入、删除、修改中至少一种。可选地，若所述报文命中报文匹配规则，根据所述报文匹配规则对应的报文编辑规则对所述报文进行编辑，具体包括：若所述报文命中报文匹配规则，确定所述报文匹配规则对应的报文编辑规则中的编辑动作以及编辑内容；按照所述编辑动作，根据所述编辑内容，对所述报文进行编辑，得到编辑后的报文。可选地，所述配置信息中还包括其他配置信息，所述其他配置信息中包括负责交换芯片与数据转发单元之间连通的端口配置、报文完成编辑后继续重定向到数据转发单元的配置、报文未命中报文匹配规则后指定出口配置、可编程编辑匹配规则表捆绑生效端口配置。可选地，所述控制单元向所述交换芯片发送信息的方式包括SONiC_CLI、REDIS-CLI、CTC_SHELL中的至少一种。可选地，所述控制单元向所述数据转发单元发送转发规则的发送方式包括Socket通信、HTTP 通信、JMS、WebService中的至少一种。可选地，所述转发规则包括：报文出口、报文入口以及是否保留vid。可选地，将编辑后的报文转发给数据转发单元，所述数据转发单元接收到编辑后的报文，具体包括：交换芯片将编辑后的报文转发给数据转发单元，以使所述数据转发单元按照所述转发规则通过所述报文入口接收所述编辑后的报文；数据转发单元接收到所述编辑后的报文后，按照所述转发规则将所述编辑后的报文从所述报文出口发出。本说明书提供一种交换机，所述交换机包括：控制单元，交换芯片和数据转发单元；所述控制单元向所述交换芯片发送配置信息，以及向所述数据转发单元发送转发规则，所述配置信息至少包括报文匹配规则和报文编辑规则；所述交换芯片接收到所述配置信息，根据所述配置信息生成可编程编辑匹配规则表，所述可编程编辑匹配规则表中的报文匹配规则和报文编辑规则之间一一对应；所述交换芯片接收到报文时，所述交换芯片按照优先级遍历所述可编程编辑匹配规则表，确定所述报文是否命中报文匹配规则，所述优先级表示所述可编程编辑匹配规则表中报文匹配规则对应的优先级；若所述报文命中报文匹配规则，根据所述报文匹配规则对应的报文编辑规则对所述报文进行编辑，以完成一次编辑得到编辑后的报文，并将编辑后的报文转发给数据转发单元，所述数据转发单元接收到编辑后的报文，按照所述转发规则，将所述编辑后的报文返回给所述交换芯片，以使所述交换芯片接收到编辑后的报文，继续确定所述编辑后的报文是否命中报文匹配规则，并在所述编辑后的报文命中报文匹配规则时，进行第二次编辑，直到所述交换芯片接收到的所述数据转发单元返回的编辑后的报文未命中任意报文匹配规则，所述交换芯片将编辑后的报文从指定出口进行转发；若所述报文未命中报文匹配规则，所述交换芯片将所述报文从指定出口进行转发。本说明书提供了一种计算机可读存储介质，所述存储介质存储有计算机程序，所述计算机程序被处理器执行时实现上述多级可编程编辑的报文处理方法。本说明书提供了一种电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，所述处理器执行所述程序时实现上述多级可编程编辑的报文处理方法。本说明书采用的上述至少一个技术方案能够达到以下有益效果：从上述多级可编程编辑的报文处理方法中可以看出，交换机中可以存在有控制单元，交换芯片和数据转发单元，控制单元向交换芯片发送配置信息，以及向数据转发单元发送转发规则，配置信息至少包括报文匹配规则和报文编辑规则，交换芯片接收到配置信息，根据配置信息生成可编程编辑匹配规则表，而后，交换芯片接收到报文时，交换芯片可以按照优先级遍历可编程编辑匹配规则表，确定报文是否命中报文匹配规则，这里提到的优先级表示可编程编辑匹配规则表中报文匹配规则对应的优先级，若报文命中报文匹配规则，根据报文匹配规则对应的报文编辑规则对所述报文进行编辑，以完成一次编辑得到编辑后的报文，并将编辑后的报文转发给数据转发单元，所述数据转发单元接收到编辑后的报文，按照所述转发规则，将所述编辑后的报文返回给所述交换芯片，以使所述交换芯片接收到编辑后的报文，继续确定所述编辑后的报文是否命中报文匹配规则，并在所述编辑后的报文命中报文匹配规则时，进行第二次编辑，直到所述交换芯片接收到的所述数据转发单元返回的编辑后的报文未命中任意报文匹配规则，所述交换芯片将编辑后的报文从指定出口进行转发，而后，若该报文未命中报文匹配规则，则交换芯片可以将报文从指定出口进行转发。从上述内容中可以看出，本说明书提供多级可编程编辑的报文处理方法，通过交换芯片将完成一级及以上编辑的报文转发给数据转发单元，数据转发单元将编辑后的报文重新转回交换芯片进行处理，打破交换芯片原有处理逻辑限制，让交换芯片能够匹配编辑后的报文字段，对编辑后的报文字段进行再次编辑，实现多级可编程编辑操作，提高了交换机的适用性。附图说明此处所说明的附图用来提供对本说明书的进一步理解，构成本说明书的一部分，本说明书的示意性实施例及其说明用于解释本说明书，并不构成对本说明书的不当限定。在附图中：图1为本说明书提供的一种多级可编程编辑的报文处理方法的流程示意图；图2为本说明书提供的一种交换机中交换芯片、控制单元和数据转发单元之间结构的示意图；图3为本说明书中提供的一种可编程编辑匹配规则表的形式示意图；图4为本说明书中提供的一种报文命中报文匹配规则并进行报文编辑的示意图；图5为本说明书中提供的一种两级编辑的示意图；图6为本说明书提供的对应于图1的电子设备示意图。具体实施方式为使本说明书的目的、技术方案和优点更加清楚，下面将结合本说明书具体实施例及相应的附图对本说明书技术方案进行清楚、完整地描述。显然，所描述的实施例仅是本说明书一部分实施例，而不是全部的实施例。基于本说明书中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本说明书保护的范围。以下结合附图，详细说明本说明书各实施例提供的技术方案。图1为本说明书提供的一种多级可编程编辑的报文处理方法的流程示意图，具体包括以下步骤：S100：控制单元向所述交换芯片发送配置信息，以及向所述数据转发单元发送转发规则，所述配置信息至少包括报文匹配规则和报文编辑规则。在实际应用中，交换机可以起到报文转发的作用，例如，可以从一个设备接收到报文，再将该报文转发给另一个设备。在交换机内部，若存在对报文进行编辑的需求，则可以对报文进行编辑后，将编辑后的报文进行转发。本说明书中提供的一种多级可编程编辑的报文处理方法是为了实现在交换机内部对报文的多级编辑，将多级编辑后的报文进行转发。本说明书中的交换机至少由交换芯片、控制单元和数据转发单元构成，另外，交换芯片与控制单元之间存在用于传输配置信息的第一控制通道，控制单元与数据转发单元之间存在用于传输转发规则的第二控制通道，交换芯片与数据转发单元之间存在用于传输报文的两个数据通道，其中，一个数据通道用于交换芯片向数据转发单元传输报文，另一个数据通道用于数据转发单元向交换芯片传输报文，如图2所示。图2为本说明书提供的一种交换机中交换芯片、控制单元和数据转发单元之间结构的示意图。基于此，控制单元可以向交换芯片发送配置信息，以及向数据转发单元发送转发规则，该配置信息至少包括报文匹配规则和报文编辑规则。报文匹配规则和报文编辑规则可以一一对应，即，一个报文匹配规则可以对应一个报文编辑规则，若一个报文符合某一项报文匹配规则，则可以通过这一项报文匹配规则对应的报文编辑规则来对该报文进行编辑。配置信息中还可以包括其他配置信息，其他配置信息中可以包括负责交换芯片与数据转发单元之间连通的端口配置、报文完成编辑后继续重定向到数据转发单元的配置、报文未命中报文匹配规则后指定出口配置中转发出去的出口）、可编程编辑匹配规则表捆绑生效端口配置。本说明书中的交换机中的控制单元可以运行SONiC系统，交换芯片可以是CTC8180交换芯片，数据转发单元可以采用兆芯COMe核心板的中央处理器，并且数据处理单元可以运行Ubuntu系统。其中，控制单元向交换芯片发送信息的方式包括SONiC_CLI、REDIS-CLI、CTC_SHELL中的至少一种，SONiC_CLI为SONiC系统提供的发送方式，REDIS-CLI为通过数据库的发送方式，CTC_SHELL为芯片底层提供的发送方式。控制单元向数据转发单元发送转发规则的发送方式包括但不限于：Socket 通信、HTTP 通信、JMS、WebService。上述转发规则包括但不限于：报文入口，报文出口，是否保留vid。这里提到的报文入口和报文出口可以是指数据转发单元接收报文的报文入口和转发报文的报文出口。在最初，控制单元需要与数据转发单元之间建立连接，具体的，在本实施例中，数据处理单元和控制单元可以使用Python内置的socket库，建立socket连接。其中socket通信是一种基于TCP/UDP 的二进制通讯方式，具有传输数据时间短、性能高、数据安全性强等优点。比如：可以将当数据转发单元的IP设置配置为“0.0.0.0”，对外服务的端口配置为8001，数据转发单元能够与同一局域网下的控制单元确保正常建立socket连接，将对外服务的端口设置为8001。而后，控制单元可以向数据转发单元下发转发规则。在数据转发单元与控制单元建立连接之后，可以通过控制单元与数据转发单元之间的第二控制通道，将转发规则发送给数据转发单元，以使数据转发单元按照该转发规则处理后续接收到的报文。这里提到的转发规则用于使得数据转发单元将接收到的从交换芯片发出的报文返回给交换芯片，并且，为了使得交换芯片将数据转发单元返回的编辑后的报文作为一个新的报文，继续进行报文匹配规则的匹配，数据转发单元可以将编辑后的报文发送到交换芯片的指定入口，该指定入口可以理解为交换芯片从互联的外部设备接收报文的入口。比如：由于数据转发单元与交换芯片之间可以通过端口57、端口58两个内部管理口连接，控制单元可以配置端口57为报文入口，端口58为报文出口，确认保留vid。数据转发单元可以按照该配置，将后续从端口57接收到的报文按照转发规则转发到端口58。另外，在本实施例中，可以使用CTC_SHELL以及SONiC_CLI执行如下操作:1、配置数据转发单元和交换芯片之间的两个内部管理口的预加重，预加重是一种在发送端对输入信号高频分量进行补偿的信号处理方式，可以提高该通道链路信号的稳定性，这两个内部管理口可以为交换芯片上的内部管理口入口和内部管理口出口，内部管理口入口用于交换芯片发送编辑后的报文给数据转发单元，内部管理口出口用于数据转发单元将接收到的报文返回给交换芯片。2、打开上述两个内部管理口的使能，使两个内部管理口处于UP状态，确保交换芯片与数据转发单元之间连通性符合预期。3、按前面板端口数创建面板端口数的VLAN，并将面板端口和两个内部管理口依次加入创建的VLAN中。比如：将面板端口1和两个内部管理口加入VLAN 1001，将面板端口2和两个内部管理口加入VLAN 1002等，确保后续报文转发通道符合配置预期。4、配置报文命中相应报文匹配规则进行编辑后处理动作为重定向该报文到内部管理口入口，确保报文完成编辑后报文可重定向到内部管理口入口，使所述报文正常进入数据转发单元。5、配置数据转发单元通过内部管理口出口转回的报文处理动作为重定向报文原面板端口，确保所述报文能够正常进入原面板端口，该原面板端口可以是指报文的指定入口。6、配置报文未命中相应报文匹配规则后处理动作可以为：修改vid为报文指定出口的VLAN将该报文重定向到指定面板端口，该指定面板端口可以是指报文的指定出口，确保该报文能够从指定面板端口发出。7、交换芯片接收上述配置后，将后续接收到的报文都按照上述配置的规则进行处理。S102：交换芯片接收到所述配置信息，根据所述配置信息生成可编程编辑匹配规则表，所述可编程编辑匹配规则表中的报文匹配规则和报文编辑规则之间一一对应。S104：交换芯片接收到报文时，所述交换芯片按照优先级遍历所述可编程编辑匹配规则表，确定所述报文是否命中报文匹配规则，所述优先级表示所述可编程编辑匹配规则表中报文匹配规则对应的优先级。S106：若所述报文命中报文匹配规则，根据所述报文匹配规则对应的报文编辑规则对所述报文进行编辑，以完成一次编辑得到编辑后的报文，并将编辑后的报文转发给数据转发单元，所述数据转发单元接收到编辑后的报文，按照所述转发规则，将所述编辑后的报文返回给所述交换芯片，以使所述交换芯片接收到编辑后的报文，继续确定所述编辑后的报文是否命中报文匹配规则，并在所述编辑后的报文命中报文匹配规则时，进行第二次编辑，直到所述交换芯片接收到的所述数据转发单元返回的编辑后的报文未命中任意报文匹配规则，所述交换芯片将编辑后的报文从指定出口进行转发。S108：若所述报文未命中报文匹配规则，所述交换芯片将所述报文从指定出口进行转发。交换芯片接收到配置信息后，可以根据该配置信息生成可编程编辑匹配规则表，该可编程匹配规则表中的报文匹配规则和报文编辑规则之间一一对应。其中，可编程编辑匹配规则表的形式具体可以如图3所示。图3为本说明书中提供的一种可编程编辑匹配规则表的形式示意图。可以看出，图3中可编程编辑匹配规则表中部分为报文匹配规则，部分为报文编辑规则，每一行中为一条报文匹配规则及其对应的报文编辑规则。报文匹配规则中包括优先级、起始偏移位置、偏移长度以及匹配特征，报文编辑规则中包括编辑动作和编辑内容。图3中的Bytes指的是偏移长度单位为字节，Bits指的是在按照匹配特征提取目标字段时单位是比特。Insert指的是插入，Modify指的是修改，Delete指的是删除。L2、L3、L4指的是报文类型，一个报文中可以含有L2、L3、L4报文字段。在该交换芯片接收到报文时，该交换芯片可以按照优先级遍历可编程编辑匹配规则表，确定该报文是否命中某个报文匹配规则，若该报文命中某个报文匹配规则，则交换芯片可以按照该报文匹配规则对应的报文编辑规则对该报文进行编辑，得到编辑后的报文将该编辑后的报文转发到数据转发单元。上述优先级表示可编程编辑匹配规则表中报文匹配规则对应的优先级。若该报文未命中任意一个报文匹配规则，则交换芯片可以直接将该报文从交换芯片的指定出口进行转发，即，可以将该报文转发至互联的其他设备。需要说明的是，为了实现多级编辑，数据转发单元接收到编辑后的报文，可以按照转发规则，将编辑后的报文重新返回给交换芯片，即，数据转发单元仅负责中转交换芯片编辑后的报文，不负责将报文转发给其他设备的功能。交换芯片重新接收到编辑后的报文，这个编辑后的报文相当于交换芯片新接收到的一个报文，交换芯片可以继续按照优先级来遍历可编程编辑匹配规则表，来确定该编辑后的报文是否命中下一个报文匹配规则。交换芯片若确定这个编辑后的报文未命中，则该交换芯片可以将该编辑后的报文从指定出口进行转发，若是这个编辑后的报文继续命中了下一个报文匹配规则，则交换芯片可以继续根据命中的报文匹配规则所对应的报文编辑规则，对该编辑后的报文继续进行编辑，以得到第二次编辑后的报文，第二次编辑后的报文依然可以发送给数据转发单元，数据转发单元再返回给交换芯片，以使交换芯片继续遍历可编程编辑匹配规则表，来确定这个第二次编辑后的报文是否命中某个报文匹配规则，直到交换芯片从数据转发单元接收到的编辑后的报文未命中报文匹配规则，则可以将报文从指定出口进行转发。也就是说，上述过程类似一个循环的过程，由于在交换机中加入了数据转发单元，数据转发单元可以将经过交换芯片一次编辑的报文再返回给交换芯片，使交换芯片可以继续对报文进行编辑，若报文不需要继续编辑，则交换芯片可以将报文直接转发出去。上述报文匹配规则中至少包括：优先级、起始偏移位置、偏移长度以及匹配特征，起始偏移位置与偏移长度用于定位报文匹配的字段位置，匹配特征用于表示报文匹配的字段特征，优先级为报文匹配规则的优先级，优先级高的报文匹配规则被优先确定是否与报文匹配。在确定报文是否命中报文匹配规则时，可以按优先级遍历可编程编辑匹配规则表，确定报文匹配规则中的启始偏移位置、偏移长度、匹配特征，并基于起始偏移位置，按偏移长度进行偏移，以提取出与匹配特征对应的字段相同长度的目标字段，进而，将目标字段与匹配特征对应的字段进行按位异或运算，得到运算结果，并根据该运算结果，确定报文是否命中报文匹配规则。由于报文中可以包含有L2、L3以及L4报文字段，则起始偏移位置可以为L2、L3以及L4，表示从L2、L3或L4的报文字段的头部位置开始定位目标字段，而偏移长度指的是从起始偏移位置开始偏移多少以定位到目标字段。其中，由于异或可以表示两个字段是否相同，则若运算结果表示匹配特征对应的字段与目标字段相同，则可以确定报文命中报文匹配规则，若运算结果表示匹配特征对应的字段与目标字段不相同，则可以确定报文未命中报文匹配规则。举一个报文命中报文匹配规则例子，如图4所示。图4为本说明书中提供的一种报文命中报文匹配规则并进行报文编辑的示意图。如：接收到如图4所示的L2报文，遍历到图4中的可编程编辑匹配规则，获取到起始偏移位置为L2，偏移长度为12 Bytes，匹配特征为0x0800。从报文L2头部往后偏移12字节，提取匹配特征相同长度16bits的目标字段，得到0x0800。当然，报文匹配规则中还可以包括匹配特征长度，即，在提取目标字段时，按照起始偏移位置和偏移长度进行在报文中定位后，可以直接根据该匹配特征长度，来确定出报文中该匹配特征长度的字段，作为目标字段。具体的，在本实施例中，可以将目标字段与匹配特征对应的字段均转换成二进制，进行按位异或运算判断目标字段与匹配特征是否完全相同，完全相同时输出结果为0，表示命中报文匹配规则，否则输出结果为非0，表示未命中报文匹配规则。其中按位异或运算为一个比特位只有0和1两个取值，只有参与异或运算的两个位相同时，结果才为0，否则为1。例如1⊕1为0，0⊕0为0，1⊕0为1。比如：匹配特征为0x0800，提取到的目标字段为0x0800，进行按位异或运算后，得到的结果为0，表示命中报文匹配规则，将按照报文匹配规则所对应的报文编辑规则进行编辑。报文编辑规则中至少包括：编辑动作以及编辑内容，其中，编辑动作包括插入、删除和修改中的至少一种。具体的，在本实施例中，当报文命中相应报文匹配规则后，可以按照该报文匹配规则所对应的报文编辑规则中的编辑动作与编辑内容进行报文编辑。当编辑动作为插入时，可以将编辑内容插入到报文中的目标字段前；当编辑动作为删除时，由于编辑内容为null，可以直接将报文中的目标字段删除；当编辑动作为修改时，可以将目标字段替换为编辑内容。按编辑动作进行处理后，即完成一级编辑；如果该报文编辑完成后，再次命中其他报文匹配规则并按照编辑动作进行编辑处理，即可再次完成一次编辑；反复多次，即可完成多级编辑。比如：图4中接收到的L2报文命中报文匹配规则后，该报文匹配规则所对应的编辑动作为Insert，编辑内容为0x81000025。将编辑内容插入到报文匹配特征字段0x0800前面，编辑后见图4中的编辑后的L2报文，完成一级编辑。具体的，在本实施例中，当报文未命中相应报文匹配规则时，表示报文进入交换芯片后从未命中任何报文匹配规则，或者命中过某些报文匹配规则并已经完成一级到多级编辑，编辑后的报文未命中其他的报文匹配规则。此时报文已经无需进行编辑，修改vid为报文的指定出口的VLAN并将该报文重定向到指定面板端口。比如：交换芯片可以根据控制单元下发的转发规则，将所述报文vid修改成1056并重定向到指定面板端口56发出。需要说明的是：多级编辑中的多级数量为上述步骤S106中进行编辑的重复次数，每重复一次累加一级。图5中示出的是两级编辑的示例，若是多级编辑，以此类推，继续叠加编辑次数即可。图5为本说明书中提供的一种两级编辑的示意图。可以看出，在图5中，报文被进行了如图4中所示的一级编辑后，编辑后的报文继续命中了另一条报文匹配规则，因此，可以根据该报文匹配规则对编辑后的报文继续进行二级编辑。这一次的编辑为Modify，将报文中按照匹配规则提取出的目标字段替换为编辑内容。需要说明的是，对报文的一次编辑可以是由于对该报文存在一定的修改需求。例子1：若是需要指定报文的转发出口，有可能需要针对该报文进行编辑，假设报文的VLAN本来是1001，但是想要转发的指定端口在VLAN 1002，则可以将报文的VLAN 字段中的VID修改成1002，然后再将报文重定向到指定端口。例子2：假设设备A是一个交换机，对于通过设备A进行中转的报文，需要添加一个报文字段来表示该报文来到过设备A，那么则可以针对报文进行编辑，添加一个报文字段。接例子2，例子3：假设设备B是另一个与该设备A之间互联的交换机，该设备B接收到设备A添加了的报文字段的报文后，则能够确定该报文经过了设备A，设备A向该报文添加的报文字段可以被删除，则设备B可以针对从设备A接收到的报文进行编辑，将设备A在报文中添加的字段进行删除。上述举出的三个例子分别对应报文编辑的修改、添加和删除，假设若是同时需要对报文进行例子1和例子2中的编辑，则需要对报文进行二级编辑。需要说明的是，上述控制单元用于配置报文匹配规则和报文编辑规则，以及进行其他各种对交换芯片和数据转发单元的配置，可以理解为，交换芯片和数据转发单元对报文的处理逻辑是由控制单元下发的配置得来的。交换芯片用于进行报文的编辑和转发。数据转发单元用于将交换芯片编辑后的报文再转发回交换芯片，使得交换芯片能够进行多次的报文编辑。在交换芯片接收到的报文未命中报文匹配规则后，再将报文转发出交换机。以上所述的一种多级可编程编辑的报文处理方法，通过交换芯片将完成一级及以上编辑的报文转发给数据转发单元，数据转发单元将编辑后的报文重新转回交换芯片进行处理，打破交换芯片原有处理逻辑限制，让交换芯片能够匹配编辑后的报文字段，对编辑后的报文字段进行再次编辑，实现多级可编程编辑操作，提高交换机的适用性。本说明书还提供一种交换机，该交换机中包括上述控制单元，交换芯片和数据转发单元，控制单元，交换芯片和数据转发单元之间的交互逻辑与多级可编程编辑的报文处理方法是相同的，在此就不再赘述了。本说明书还提供了一种计算机可读存储介质，该存储介质存储有计算机程序，计算机程序可用于执行上述多级可编程编辑的报文处理方法。本说明书还提供了图6所示的电子设备的示意结构图。如图6所述，在硬件层面，该电子设备包括处理器、内部总线、网络接口、内存以及非易失性存储器，当然还可能包括其他业务所需要的硬件。处理器从非易失性存储器中读取对应的计算机程序到内存中然后运行，以实现上述多级可编程编辑的报文处理方法。当然，除了软件实现方式之外，本说明书并不排除其他实现方式，比如逻辑器件抑或软硬件结合的方式等等，也就是说以下处理流程的执行主体并不限定于各个逻辑单元，也可以是硬件或逻辑器件。在20世纪90年代，对于一个技术的改进可以很明显地区分是硬件上的改进还是软件上的改进。然而，随着技术的发展，当今的很多方法流程的改进已经可以视为硬件电路结构的直接改进。设计人员几乎都通过将改进的方法流程编程到硬件电路中来得到相应的硬件电路结构。因此，不能说一个方法流程的改进就不能用硬件实体模块来实现。例如，可编程逻辑器件）就是这样一种集成电路，其逻辑功能由用户对器件编程来确定。由设计人员自行编程来把一个数字系统“集成”在一片PLD上，而不需要请芯片制造厂商来设计和制作专用的集成电路芯片。而且，如今，取代手工地制作集成电路芯片，这种编程也多半改用“逻辑编译器”软件来实现，它与程序开发撰写时所用的软件编译器相类似，而要编译之前的原始代码也得用特定的编程语言来撰写，此称之为硬件描述语言，而HDL也并非仅有一种，而是有许多种，如ABEL、AHDL、Confluence、CUPL、HDCal、JHDL、Lava、Lola、MyHDL、PALASM、RHDL等，目前最普遍使用的是VHDL与Verilog。本领域技术人员也应该清楚，只需要将方法流程用上述几种硬件描述语言稍作逻辑编程并编程到集成电路中，就可以很容易得到实现该逻辑方法流程的硬件电路。控制器可以按任何适当的方式实现，例如，控制器可以采取例如微处理器或处理器以及存储可由该处理器执行的计算机可读程序代码的计算机可读介质、逻辑门、开关、专用集成电路、可编程逻辑控制器和嵌入微控制器的形式，控制器的例子包括但不限于以下微控制器：ARC 625D、Atmel AT91SAM、Microchip PIC18F26K20 以及Silicone Labs C8051F320，存储器控制器还可以被实现为存储器的控制逻辑的一部分。本领域技术人员也知道，除了以纯计算机可读程序代码方式实现控制器以外，完全可以通过将方法步骤进行逻辑编程来使得控制器以逻辑门、开关、专用集成电路、可编程逻辑控制器和嵌入微控制器等的形式来实现相同功能。因此这种控制器可以被认为是一种硬件部件，而对其内包括的用于实现各种功能的装置也可以视为硬件部件内的结构。或者甚至，可以将用于实现各种功能的装置视为既可以是实现方法的软件模块又可以是硬件部件内的结构。上述实施例阐明的系统、装置、模块或单元，具体可以由计算机芯片或实体实现，或者由具有某种功能的产品来实现。一种典型的实现设备为计算机。具体的，计算机例如可以为个人计算机、膝上型计算机、蜂窝电话、相机电话、智能电话、个人数字助理、媒体播放器、导航设备、电子邮件设备、游戏控制台、平板计算机、可穿戴设备或者这些设备中的任何设备的组合。为了描述的方便，描述以上装置时以功能分为各种单元分别描述。当然，在实施本说明书时可以把各单元的功能在同一个或多个软件和/或硬件中实现。本领域内的技术人员应明白，本说明书的实施例可提供为方法、系统、或计算机程序产品。因此，本说明书可采用完全硬件实施例、完全软件实施例、或结合软件和硬件方面的实施例的形式。而且，本说明书可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本说明书是参照根据本说明书实施例的方法、设备、和计算机程序产品的流程图和／或方框图来描述的。应理解可由计算机程序指令实现流程图和／或方框图中的每一流程和／或方框、以及流程图和／或方框图中的流程和／或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能的步骤。在一个典型的配置中，计算设备包括一个或多个处理器、输入/输出接口、网络接口和内存。内存可能包括计算机可读介质中的非永久性存储器，随机存取存储器和/或非易失性内存等形式，如只读存储器或闪存。内存是计算机可读介质的示例。计算机可读介质包括永久性和非永久性、可移动和非可移动媒体可以由任何方法或技术来实现信息存储。信息可以是计算机可读指令、数据结构、程序的模块或其他数据。计算机的存储介质的例子包括，但不限于相变内存、静态随机存取存储器、动态随机存取存储器、其他类型的随机存取存储器、只读存储器、电可擦除可编程只读存储器、快闪记忆体或其他内存技术、只读光盘只读存储器、数字多功能光盘或其他光学存储、磁盒式磁带，磁带磁磁盘存储或其他磁性存储设备或任何其他非传输介质，可用于存储可以被计算设备访问的信息。按照本文中的界定，计算机可读介质不包括暂存电脑可读媒体，如调制的数据信号和载波。还需要说明的是，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、商品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、商品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括所述要素的过程、方法、商品或者设备中还存在另外的相同要素。本领域技术人员应明白，本说明书的实施例可提供为方法、系统或计算机程序产品。因此，本说明书可采用完全硬件实施例、完全软件实施例或结合软件和硬件方面的实施例的形式。而且，本说明书可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本说明书可以在由计算机执行的计算机可执行指令的一般上下文中描述，例如程序模块。一般地，程序模块包括执行特定任务或实现特定抽象数据类型的例程、程序、对象、组件、数据结构等等。也可以在分布式计算环境中实践本说明书，在这些分布式计算环境中，由通过通信网络而被连接的远程处理设备来执行任务。在分布式计算环境中，程序模块可以位于包括存储设备在内的本地和远程计算机存储介质中。本说明书中的各个实施例均采用递进的方式描述，各个实施例之间相同相似的部分互相参见即可，每个实施例重点说明的都是与其他实施例的不同之处。尤其，对于系统实施例而言，由于其基本相似于方法实施例，所以描述的比较简单，相关之处参见方法实施例的部分说明即可。以上所述仅为本说明书的实施例而已，并不用于限制本说明书。对于本领域技术人员来说，本说明书可以有各种更改和变化。凡在本说明书的精神和原理之内所作的任何修改、等同替换、改进等，均应包含在本说明书的权利要求范围之内。
