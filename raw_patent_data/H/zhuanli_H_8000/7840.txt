标题title
一种基于马尔可夫矩阵的数据包特征值存储方法
摘要abst
本发明公开了一种基于马尔可夫矩阵的数据包特征值存储方法，包括：对网络传输中的数据包进行捕捉，基于获得的数据包构建数据包集合；遍历提取数据包的特征值，记录数据包集合中每一个数据包的传输方向；对提取到的特征值进行离散化，获得离散化后的特征值；根据离散化后的特征值建立基于马尔科夫链的状态转移矩阵，将得到的马尔可夫矩阵进行拼接，获得所求结果。本发明通过更改数据包特征值的存储方式，用分类技术代替聚合技术，从而保留数据包特征值的更多信息，能够更加有效地分辨恶意流与正常流。
权利要求书clms
1.一种基于马尔可夫矩阵的数据包特征值存储方法，其特征在于，包括：对网络传输中的数据包进行捕捉，基于获得的数据包构建数据包集合，记为，其中，为数据包集合中数据包的个数；从开始，步长为1，直至结束，遍历提取所述数据包的特征值，记录所述数据包集合中每一个数据包的传输方向，记为；其中，为第个数据包的传输方向，取值范围为；对提取到的所述特征值进行离散化，获得离散化后的特征值；根据所述离散化后的特征值建立基于马尔科夫链的状态转移矩阵，将得到的个马尔可夫矩阵进行拼接，获得即为所求。2.根据权利要求1所述的基于马尔可夫矩阵的数据包特征值存储方法，其特征在于，所述从开始，步长为1，直至结束，遍历提取所述数据包的特征值的过程包括，提取所述数据包集合中每一个数据包的特征值，将第个数据包的个特征值分别存储于矩阵至中；其中，，，为特征值的数量，由选取的特征值所决定。3.根据权利要求1所述的基于马尔可夫矩阵的数据包特征值存储方法，其特征在于，所述为第个数据包的传输方向，取值范围为，若，则第个数据包为出站数据包；若，则第个数据包为入站数据包。4.根据权利要求1所述的基于马尔可夫矩阵的数据包特征值存储方法，其特征在于，所述对提取到的所述特征值进行离散化的过程包括，当各个箱子宽度相同时，从开始，步长为1进行遍历，直至结束；过程包括：选取特征值矩阵，定义；从开始，步长为1进行遍历，直至结束：然后根据公式计算箱容量，得到分箱范围：，，…, ；其中，为人为设定的箱数量；将各个数据包按照第个特征值的值，放入对应的箱中，完成第个特征值离散化。5.根据权利要求4所述的基于马尔可夫矩阵的数据包特征值存储方法，其特征在于，所述选取特征值矩阵，定义；从开始，步长为1进行遍历，直至结束的过程包括，计算，当时，令；当时，令特殊的，当时，。6.根据权利要求1所述的基于马尔可夫矩阵的数据包特征值存储方法，其特征在于，所述对提取到的所述特征值进行离散化的过程还包括，当各个箱子容量相同时，确定分位数，得到箱容量；其中，为数据包数量，为向下取整函数，分位数是指将一个随机变量的概率分布范围分为几个等份的数值点；从开始，步长为1进行遍历，直至结束；选取特征值矩阵，定义排序矩阵；从开始，步长为1进行遍历，直至结束：按照特征值排序、箱容量，将各个数据包进行归类，放入不同箱子中，完成离散化装箱。7.根据权利要求6所述的基于马尔可夫矩阵的数据包特征值存储方法，其特征在于，所述从开始，步长为1进行遍历，直至结束的过程包括，将中各个元素的大小进行排序，并记录对应的数据包编号；检索中的特征值，按从小到大的顺序找出第个的特征值，并将所述特征值对应的数据包编号作为的值。8.根据权利要求7所述的基于马尔可夫矩阵的数据包特征值存储方法，其特征在于，根据所述离散化后的特征值建立基于马尔科夫链的状态转移矩阵的过程包括，从开始，步长为1进行遍历，直至结束；根据数据包的五元组化分源地址、源端口、目的地址、目的端口、传输层协议，将属于同一个流的数据包关联起来，获得关联结果；基于所述关联结果，根据每一个流的数据包的传输顺序，依次计算每一个特征值中箱跳转的次数，将计算结果存储于矩阵中；根据所述计算结果计算箱子之间的跳转概率，基于所述跳转概率获得所述状态转移矩阵。9.根据权利要求8所述的基于马尔可夫矩阵的数据包特征值存储方法，其特征在于，所述矩阵的表达式为：；其中，为箱数量，表示从第n个箱子跳转至第1个箱子的次数。10.根据权利要求8所述的基于马尔可夫矩阵的数据包特征值存储方法，其特征在于，所述跳转概率公式为：；所述状态转移矩阵公式为：。
说明书desc
技术领域本发明属于流量分析领域，特别是涉及一种基于马尔可夫矩阵的数据包特征值存储方法。背景技术在目前的流量分析过程中，采用的是基于数据聚合的数据流级特征方案。数据聚合是一个收集原始数据进行汇总，并进行统计分析的过程，是控制数据增长和最小化存储需求的常用工具。而在提取特征值过程中，聚合会使用统计函数得到的一个或者几个的统计结果数据来代替原始值，使用的函数有平均值、标准差等方法。这样会导致信息的丢失，如连续数据包之间的平均到达时间，以及大量的原始行为与时间信息。发明内容为解决上述问题，本发明提供了如下方案：一种基于马尔可夫矩阵的数据包特征值存储方法，包括：对网络传输中的数据包进行捕捉，基于获得的数据包构建数据包集合，记为，其中，为数据包集合中数据包的个数；从开始，步长为1，直至结束，遍历提取所述数据包的特征值，记录所述数据包集合中每一个数据包的传输方向，记为；其中，为第个数据包的传输方向，取值范围为；对提取到的所述特征值进行离散化，获得离散化后的特征值；根据所述离散化后的特征值建立基于马尔科夫链的状态转移矩阵，将得到的个马尔可夫矩阵进行拼接，获得即为所求。优选地，所述从开始，步长为1，直至结束，遍历提取所述数据包的特征值的过程包括，提取所述数据包集合中每一个数据包的特征值，将第个数据包的个特征值分别存储于矩阵至中；其中，，，为特征值的数量，由选取的特征值所决定。优选地，所述为第个数据包的传输方向，取值范围为，若，则第个数据包为出站数据包；若，则第个数据包为入站数据包。优选地，所述对提取到的所述特征值进行离散化的过程包括，当各个箱子宽度相同时，从开始，步长为1进行遍历，直至结束；过程包括：选取特征值矩阵，定义；从开始，步长为1进行遍历，直至结束：然后根据公式计算箱容量，得到分箱范围：，，…, ；其中，为人为设定的箱数量；将各个数据包按照第个特征值的值，放入对应的箱中，完成第个特征值离散化。优选地，所述选取特征值矩阵，定义；从开始，步长为1进行遍历，直至结束的过程包括，计算，当时，令；当时，令特殊的，当时，。优选地，所述对提取到的所述特征值进行离散化的过程还包括，当各个箱子容量相同时，确定分位数，得到箱容量；其中，为数据包数量，为向下取整函数，分位数是指将一个随机变量的概率分布范围分为几个等份的数值点；从开始，步长为1进行遍历，直至结束；选取特征值矩阵，定义排序矩阵；从开始，步长为1进行遍历，直至结束：按照特征值排序、箱容量，将各个数据包进行归类，放入不同箱子中，完成离散化装箱。优选地，所述从开始，步长为1进行遍历，直至结束的过程包括，将中各个元素的大小进行排序，并记录对应的数据包编号；检索中的特征值，按从小到大的顺序找出第个的特征值，并将所述特征值对应的数据包编号作为的值。优选地，根据所述离散化后的特征值建立基于马尔科夫链的状态转移矩阵的过程包括，从开始，步长为1进行遍历，直至结束；根据数据包的五元组化分源地址、源端口、目的地址、目的端口、传输层协议，将属于同一个流的数据包关联起来，获得关联结果；基于所述关联结果，根据每一个流的数据包的传输顺序，依次计算每一个特征值中箱跳转的次数，将计算结果存储于矩阵中；根据所述计算结果计算箱子之间的跳转概率，基于所述跳转概率获得所述状态转移矩阵。优选地，所述矩阵的表达式为：；其中，为箱数量，表示从第n个箱子跳转至第1个箱子的次数。优选地，所述跳转概率公式为：；所述状态转移矩阵公式为：。本发明公开了以下技术效果：本发明提供的一种基于马尔可夫矩阵的数据包特征值存储方法，用分类技术代替主流的聚合技术，将数据包的特征值看作为连续值，采用离散化技术对数据包的特征值进行装箱，并根据网络流的数据包传递顺序计算箱与箱的跳转次数，从而得到马尔可夫矩阵。从而保留原始数据包更多的特征，易于分辨出恶意流量与正常流量。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为本发明实施例的方法流程图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。为使本发明的上述目的、特征和优点能够更加明显易懂，下面结合附图和具体实施方式对本发明作进一步详细的说明。在流量分析领域中，目前是使用较多的方法是聚类分析，在提取特征值过程中使用统计函数得到的结果来代替原始值，使用的函数有平均值、标准差等方法。但是这样的操作会导致丢失大量的信息，如数据包分发的细节，每个数据包的平均到达时间等大量的原始行为信息。针对以上问题，本发明对数据存储过程进行修改，将网络流中的数据包看作是一个随机变量序列，根据TCP协议规范，该序列在一定程度上具有马尔可夫性，可以预测每个数据包特征的统计数据。因此，本发明使用马尔可夫矩阵来表示一个网络流的每个数据包的特征值，能够根据数据包的特征值来预测下一网络流的完整信息。如图1所示，本发明提供了一种基于马尔可夫矩阵的数据包特征值存储方法，包括以下步骤：S1.对网络中传输的数据包进行捕捉，并将获得的数据包用于构建数据包集合，记为；其中，为数据包集合中数据包的个数。S2.提取数据包的特征值。进行遍历，从开始，步长为1，直至结束：S21.提取数据包集合中每一个数据包的特征值。将第个数据包的个特征值分别存储于矩阵至中；其中，，为特征值的数量，由选取的特征值所决定。S3.将数据包集合中每一个数据包的传输方向记录下来，记为；其中，为第个数据包的传输方向，取值范围为。若，则说明第个数据包为出站数据包；若，则说明第个数据包为入站数据包。已知数据包的特征值是连续的，为便于机器学习进行归类，因此对数据包进行离散化。S4.特征值离散化。说明：特征值离散化重点在于箱宽度及容量如何确定，本实施例包括两种方法：1）各个箱子的宽度相同；2）各个箱子的容量相同；S41.当各个箱子宽度相同时：S411.进行遍历，从开始，步长为1，直至结束；S4111.选取特征值矩阵，定义；S4112.进行遍历，从开始，步长为1，直至结束；S41121.计算，当时，令；当时，令；特殊的，当时，；S4113.计算箱容量，；其中，为箱数量，由人为设定。S4114.获取分箱范围：；S4115.将各个数据包按照第个特征值的值，放入对应的箱中，完成第个特征值离散化。S42.当各个箱子容量相同时：S421.确定分位数，得到箱容量；其中，为数据包数量，为向下取整函数说明：分位数是指将一个随机变量的概率分布范围分为几个等份的数值点。假设分位数为20，则说明将所有的特征值分成20等份，若数据包数量为8000，则箱容量为40。S422.进行遍历，从开始，步长为1，直至结束：S4221.选取特征值矩阵，定义排序矩阵；说明：为从小到大的顺序进行排序，长度为S423.进行遍历，从开始，步长为1，直至结束：S4231.检索中的特征值，按从小到大的顺序找出第个的特征值，并将这个特征值对应的数据包编号当作的值；说明：例如目前在检索，按照从小到大的顺序，找到了排序为5的特征值，假设这个特征值是中的，则；将中各个元素的大小进行排序，并记录下对应的数据包编号。S424.按照特征值排序、箱容量，将各个数据包进行归类，放入不同箱子中，完成离散化装箱。S5.获得离散化后的特征值，表现方式为每个矩阵，矩阵中的元素一一对应箱子中存储的特征值；S6.建立基于马尔科夫链的状态转移矩阵S61.进行遍历，从开始，步长为1，直至结束；S611.关联：将属于同一个流的数据包关联起来；S612.次数统计：针对上一步中的关联结果，根据每一个流的数据包的传输顺序，依次计算每一个特征值中箱跳转的次数，并将结果存储于矩阵中。其中，，为箱数量，表示从第n个箱子跳转至第1个箱子的次数。S613.概率计算：针对上一步中的的统计结果，计算箱子之间的跳转概率，具体计算公式如下所示：S614.得到马尔可夫矩阵S7.将S6中得到的个马尔可夫矩阵进行拼接，即令，P即为最后所求。说明：马尔可夫矩阵P不仅保留了以箱为单位的分布，而且保存了以跃迁概率为单位的时间信息。而且，其的维数是固定的，能够较好地应用于机器学习中。本发明通过更改数据包特征值的存储方式，用分类技术代替聚合技术，从而保留数据包特征值的更多信息，能够更加有效地分辨恶意流与正常流。以上所述的实施例仅是对本发明的优选方式进行描述，并非对本发明的范围进行限定，在不脱离本发明设计精神的前提下，本领域普通技术人员对本发明的技术方案做出的各种变形和改进，均应落入本发明权利要求书确定的保护范围内。
