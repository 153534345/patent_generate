标题title
一种时间敏感网络交换机模型及其实现方法
摘要abst
本发明公开了一种时间敏感网络交换机模型及其实现方法，所述交换机模型包括依次连接的多个入端口、交换结构、出口模块和多个出端口；出口模块包括队列分配器、多个队列、多个传输可行性检查模块、时间感知整型查询模块和出端口传输控制模块；当数据帧进入交换机模型之后，队列分配器根据数据帧中的信息将数据帧分配到合适的队列；队列用于数据帧的排队；传输可行性检查模块用于判断数据帧在后续环节的可通过性，如果可通过则向后递交，否则暂时存储在本模块；时间感知整型查询模块用于实现802.1Qbv协议中规定的TAS机制；出端口传输控制模块用于实现严格优先级以及出端口的控制功能。本发明提供了基于软件仿真的交换机模型实现方案。
权利要求书clms
1.一种时间敏感网络交换机模型，其特征在于，所述交换机模型包括依次连接的多个入端口、交换结构、出口模块和多个出端口；其中，所述出口模块包括队列分配器、多个队列、多个传输可行性检查模块、时间感知整型查询模块和出端口传输控制模块；当数据帧进入交换机模型之后，所述队列分配器根据数据帧中的信息将数据帧分配到合适的队列；所述队列用于数据帧的排队；所述传输可行性检查模块用于判断数据帧在后续环节的可通过性，如果可通过则向后递交，否则暂时存储在本模块；所述时间感知整型查询模块用于实现802.1Qbv协议中规定的TAS机制；所述出端口传输控制模块用于实现严格优先级以及出端口的控制功能。2.根据权利要求1所述的时间敏感网络交换机模型，其特征在于，所述交换机模型中各模块间数据交互的方式包括以下两种：数据管道和事件；所述交换机模型实现过程中遵循的基本规则是：如果数据只是逻辑上的交互而不需要时间的流动，采用数据管道的方式；如果数据交互需要或者会导致时间的流动，则采用事件的方式；其中，事件定义为：一个过程中的关键时间点以及其对应的状态信息的集合。3.根据权利要求1所述的时间敏感网络交换机模型，其特征在于，所述交换机模型所在的时间敏感网络中还包含端节点模型和事件表；所述端节点模型分为源节点模型和目的节点模型；所述事件表包含时间敏感网络中所有事件的数据结构以及对应方法，将事件按照时间信息进行排序后存储在链表中，并从链表的头部依次触发事件，有的事件被触发之后会产生新的事件，新的事件也按照时间信息插入到链表中的合适位置；各个模型之间的事件包含：数据帧发送事件、数据帧发送完成事件、数据帧接收完成事件；所述源节点模型是数据帧产生的位置，只接收数据帧发送事件；当数据帧发送事件到达源节点模型的时候，源节点模型会按照数据帧发送事件中的信息产生数据帧并在成功检测链路连通性之后向事件表注册一个数据帧发送事件并通过数据帧发送事件产生一个数据帧发送完成事件用于未来提醒自己数据帧发送完成；所述目的节点模型接收到数据帧接收完成事件之后会得到数据帧的信息并进行统计，包含传输时延抖动的计算以及数据帧在传输过程中状态信息的记录。4.一种时间敏感网络交换机模型的实现方法，其特征在于，包括以下步骤：数据帧从入端口进入交换机模型；交换结构按照MAC表以及交换规则将数据帧交换到对应的出口模块；队列分配器按照优先级将数据帧放入对应队列；数据帧在传输可行性检查模块等待检查；时间感知整型查询模块对数据帧进行是否通过的检查，如果不能通过则给传输可行性检查模块失败反馈，如果能通过则进行后续步骤；出端口传输控制模块对数据帧进行是否通过的检查，如果不能通过则给传输可行性检查模块失败反馈，如果能通过则进行后续步骤；数据帧从出端口传输。5.根据权利要求4所述的时间敏感网络交换机模型的实现方法，其特征在于，所述队列分配器的工作流程如下：初始时队列分配器处于空闲状态，当队列分配器接收到一个数据帧之后会转移到队列分配状态然后根据定义好的分配规则将数据帧转移到对应的数据管道由数据管道将数据帧发送到对应的队列中；之后队列分配器处于反馈等待状态，当队列通过数据管道通知队列分配器分配成功之后，队列分配器会再次进入空闲状态等待下一个数据帧的到达；所述队列的工作流程如下：当队列分配器将数据帧分配到队列后会触发队列开始工作；队列定义了两种工作情况，分别是：1.队列分配器分配数据帧到队列；2.传输可行性检查模块请求数据；针对情况1：当队列通过数据管道接收到队列分配器发送的数据帧之后会通过数据管道查询传输可行性检查模块的状态，如果传输可行性检查模块为空，则将刚才被分配的数据帧通过数据管道传递给传输可行性检查模块，否则存入队列中；不论是存入队列还是传递给传输可行性检查模块，当操作完成之后会通过数据管道给队列分配器反馈；针对情况2：当传输可行性检查模块向队列发送数据请求，如果当前队列中还有正在排队的数据帧会通过数据管道递交一个数据帧，如果此时队列已经为空则会通过数据管道给传输可行性检查模块反馈。6.根据权利要求4所述的时间敏感网络交换机模型的实现方法，其特征在于，所述传输可行性检查模块的工作流程如下：传输可行性检查模块初始处于空闲状态，当其接收到一个数据帧之后，会通过数据管道查询后续的时间感知整型查询模块的状态；如果不对时间感知整型查询模块的具体实现进行考虑的话，当前的数据帧如果希望通过时间感知整型查询模块有四种可能的情况，分别是：1.能成功通过，且知道通过的时间；2.能成功通过，但是不知道通过时间；3.本次不能通过，但是可知下次可能通过的时间；4.本次不能通过，对下次的信息一无所知；但是结合事件表要求时间必须有时间信息的前提，情况2实际上无法作为一个合理的时间放入事件表，所以等同于情况4；最终时间感知整型查询模块检查能提供1、3、4三种情况；如果时间感知整型查询模块检查成功且知道通过时间感知整型查询模块的时间T_send，传输可行性检查模块给自己注册一个事件用于提醒自己当前数据帧发送完成；记为等待状态；当时间感知整型查询模块检查的结果是失败，直到下一次可能的时间，那么时间感知整型查询模块给自己注册一个事件用于提醒自己在下一次可能的时间点再次检查时间感知整型查询模块；记为等待状态；如果时间感知整型查询模块检查的情况是失败且不知道额外信息，那么传输可行性检查模块后续的具体工作状况不能自行判断，需要其他的模块来注册特定的事件来提醒传输可行性检查模块后续该如何工作；记为等待状态；等待状态的流程如下：传输可行性检查模块进入等待状态之后会等待自己注册的提醒事件，当接收到提醒事件之后说明数据帧的发送已经完成，然后清除传输可行性检查模块中的内容并通过数据管道向队列请求新的数据帧，如果队列给出的反馈是队列为空，则返回空闲状态，否则成功请求到数据帧并转入阶段从接收一个数据帧的流程重新开始；等待状态的流程如下：在等待状态的情况下，如果接收到自己的提醒事件则会重新转入门控检查状态；等待状态的流程如下：在等待状态的情况下，传输可行性检查模块无法给自己注册提醒事件，只能依靠其他模块，通常是后面的时间感知整型查询模块或者出端口传输控制模块来注册事件提醒传输可行性检查模块在合适的时间唤醒并进行下一步的工作；当传输可行性检查模块再次被唤醒时存在两种情况：1.之前尝试的检查经过一段时间之后得到了确定失败的结果，那么传输可行性检查模块重新转入门控检查状态；2.之前尝试的检查结果最终确定为成功，那么传输可行性检查模块进入清缓存状态，并继续进行之后的流程。7.根据权利要求4所述的时间敏感网络交换机模型的实现方法，其特征在于，所述时间感知整型查询模块的工作流程如下：时间感知整型查询模块用于实现802.1Qbv中规定的TAS机制，为传输可行性检查模块提供门控检查的接口；当时间感知整型查询模块接收到检查请求之后，会首先根据自身门控配置信息检查数据帧是否能在当前时刻通过门控检查，如果不能通过则给传输可行性检查模块失败且有时间的反馈；如果能通过门控检查还需要进行向后检查，这里向后检查的含义是对本模块之后的模块进行检查；因为实际上，传输可行性检查模块只对检查时间感知整型查询模块的状态然后进行相应的动作，因此传输可行性检查模块对时间感知整型查询模块进行检查的时候就需要时间感知整型查询模块代替传输可行性检查模块对后续模块进行检查，这样才能给传输可行性检查模块提供完整的结果让其作出正确的判断；如果有更多需要检查的模块则也依次进行向后检查并给传输可行性检查模块提供状态；如果时间感知整型查询模块的向后检查通过且已知时间则给传输可行性检查模块成功且已知时间的反馈；其余情况都给传输可行性检查模块失败且未知时间的反馈。8.根据权利要求4所述的时间敏感网络交换机模型的实现方法，其特征在于，所述出端口传输控制模块的工作流程如下：当出端口传输控制模块被触发检查的时候，首先判断是否有数据帧正在被发送，如果有则给传输可行性检查模块失败反馈，并给当前数据发送完成的时间；如果没有数据正在发送则检查是否设定自检查，如未设定则设定并注册自检查事件；设置自检查的原因：一个出端口有一个出端口传输控制模块但是对应多个传输可行性检查模块，在某个时刻T1可能存在多个传输可行性检查模块都在检查出端口传输控制模块，但是从事件表的实现原则上来说即使是同一个时刻的事件在事件表中也是存在先后顺序的，先后顺序的不同会导致对出端口传输控制模块的检查表现出不同的结果，因此必须额外加以检查；自检查从实现上来讲是注册一个未来最小时间单的事件提醒出端口传输控制模块来判断究竟是哪个传输可行性检查模块中的数据可以发送；然后判断数据帧是否是最高优先级，如果是则可以直接发送，给时间感知整型查询模块成功的反馈，给出时间并转入发送状态；如果不是最高优先级则先放入待发送缓存，如果当前发送缓存中的数据优先级低于自己，将其传入待发送缓存并将当前数据转入发送缓存；如果有比自己优先级高的，则什么也不做；当接收到自检查事件的时候，给发送缓存中数据帧对应缓存模块发送发送成功提醒事件，给待发送缓存中的数据对应的缓存模块发送发送失败提醒事件。9.一种电子设备，其特征在于，所述电子设备包括处理器和存储器，所述存储器中存储有至少一条指令，所述至少一条指令由所述处理器加载并执行以实现如权利要求4-8任一项所述的时间敏感网络交换机模型的实现方法。10.一种计算机可读存储介质，所述存储介质中存储有至少一条指令，所述至少一条指令由处理器加载并执行以实现如权利要求4-8中任一项所述的时间敏感网络交换机模型的实现方法。
说明书desc
技术领域本发明涉及网络通信技术领域，特别涉及一种时间敏感网络交换机模型及其实现方法。背景技术时间敏感网络具有确定时延保障和多业务承载能力，解决了工业互联网的中数据在同一网络进行数据传输的难题，成为现在工业现场网络的研究热点。当前的时间敏感网络研究时间触发业务流大都是周期性的，时间感知整形技术可以对周期性时间触发业务流进行预定义的静态配置，对传输的数据流进行定时控制，数据业务流的传输变得可预测和确定的，因此保障端到端时间触发业务流传输的服务质量。然而由于非周期的时间触发业务流到达时间的不确定，导致无法通过资源预留或预配置方式来对交换机资源和门控进行管理。因此，如何动态的对交换机资源和门控进行调度成为非周期时间触发业务流确定性传输的关键。时间敏感网络起源于音视频领域，主要是解决音视频数据传输的不确定性，在2005年建立了AVB任务组，建立了一些标准，在保持完全兼容现有以太网体系的基础上，对层二的数据进行转发、整型等部分进行扩展，使得以太网具有保障带宽、限制延时、精确时钟同步的能力，在标准的以太网架构下为音视频数据业务提供高质量、低时延、时间同步的保障，兼容其它数据业务的传输，提供多业务承载的解决方案。在2012年AVB工作组改名为时间敏感网络工作组，进一步研究工业控制网络中的数据传输，在传统以太网的基础上加入了时间同步、传输调度、路径控制、资源预留、可靠冗余的机制，保障了任务关键数据的服务质量，同时也解决多个数据业务不能统一承载的难题。IEEE 802.1Qbv标准中规定的TAS算法是一种能够严格保障TT流时延确定性的同步时间调度算法。图1展示了802.1Qbv标准定义的典型分组调度结构。它设置八个固定优先级的FIFO队列，用于缓存待调度的分组。IEEE 802.1Q标准规定了如何根据分组头中的PCP和VLAN ID域来定义分组所属的类，类决定了分组的优先级和送往哪个队列进行缓存。一般而言，优先级最高的队列被分配给TT流，优先级次之的若干队列被分配给AVB流，其余队列被分配给BE流。对于AVB流的队列，可以在其队首设置一个CBS门控：只有该队列的信用值为正时，CBS门控才处于开启状态。所有的队列都会连接一个TAS门控，其开关状态由门控列表GCL控制。分组队列Q7用于缓存TT分组，并且在时间段T0到T1，队列Q7的TAS门控处于开启状态而其它队列的门控都处于关闭状态，所以在时间段T0到T1内，只有Q7中的TT流可以独占端口。门控列表的每一项都对应于某段时间各队列的TAS门控状态，被称为一个时间窗口。通过为不同队列分配不同长度的时间窗口，TAS最终实现一种特殊的时分复用。最后，调度器会从所有TAS门控和CBS门控都为开启状态的队列中，选择优先级最高的队列进行调度。通过为TT流离线规划合理的时间窗口，TAS能够保证TT流在每一跳交换机的固定时间段内被调度和转发，从而保证端到端的时延确定性。在TT窗口的开始时刻，正在传输的低优先级流将阻碍高优先级流的传输，从而影响TT流的按时调度。为解决这个问题，802.1Qbv标准提出了保护带机制：在下一个TT窗口开始之前的一个最大以太网帧的传输时间内停止调度器的工作。在此基础上，802.1Qbv提出了改进的保护带机制，即只要调度决策分组可以在下一个TT窗口开始前传输完成，则继续调度；否则，调度停止。通过保护带机制，TAS能够为TT流提供独占的、无干扰的时间窗口。TSN的协议中对TAS只规定了其机制但是没有给出门控的求解方法，因此目前相关领域的很多研究者都在研究门控的求解算法。当算法求解门控过程中或者求解完成之后需要通过某些方法进行验证。一般而言，可以通过软件仿真验证或者直接在实物系统中进行验证。很多时候还是使用仿真而不是实物系统进行机制和算法的研究以及验证，这是因为相比实物系统，仿真系统有如下三个优势：1.与新标准的跟进速度更加可控。各个厂家对标准进行实现的时候会综合考虑很多因素，因此发布的产品和标准中的规定可能存在一定差别。此外，协议中某些部分可能被厂家认为重要性不足导致在很长时间内不会实现。2.成本更低。完全运行一套时间敏感网络的实物系统至少需要几台TSN的交换机，多个能够支持TSN的端设备，整体开销比较大。仿真系统只需要一台普通的计算机即可。3.网络拓扑的设置更加灵活。在仿真系统修改网络拓扑或者增加系统中设备是一件没有额外开销的工作。但在实物系统中上述操作就需要相当的人力物力。目前已有一些基于802.1Qbv规定的TAS机制的仿真方案。有的研究者基于omnet++或者opnet等现有的网络仿真软件搭建TAS的仿真框架。但是，几乎没有人脱离已有仿真软件提供独立的TAS软件仿真方案。发明内容有鉴于此，本发明的目的在于提供一种时间敏感网络交换机模型及其实现方法，针对独立的TAS软件仿真中最为关键的交换机的实现提供一种可行的解决方案。为解决上述技术问题，本发明的实施例提供如下方案：一方面，提供了一种时间敏感网络交换机模型，所述交换机模型包括依次连接的多个入端口、交换结构、出口模块和多个出端口；其中，所述出口模块包括队列分配器、多个队列、多个传输可行性检查模块、时间感知整型查询模块和出端口传输控制模块；当数据帧进入交换机模型之后，所述队列分配器根据数据帧中的信息将数据帧分配到合适的队列；所述队列用于数据帧的排队；所述传输可行性检查模块用于判断数据帧在后续环节的可通过性，如果可通过则向后递交，否则暂时存储在本模块；所述时间感知整型查询模块用于实现802.1Qbv协议中规定的TAS机制；所述出端口传输控制模块用于实现严格优先级以及出端口的控制功能。优选地，所述交换机模型中各模块间数据交互的方式包括以下两种：数据管道和事件；所述交换机模型实现过程中遵循的基本规则是：如果数据只是逻辑上的交互而不需要时间的流动，采用数据管道的方式；如果数据交互需要或者会导致时间的流动，则采用事件的方式；其中，事件定义为：一个过程中的关键时间点以及其对应的状态信息的集合。优选地，所述交换机模型所在的时间敏感网络中还包含端节点模型和事件表；所述端节点模型分为源节点模型和目的节点模型；所述事件表包含时间敏感网络中所有事件的数据结构以及对应方法，将事件按照时间信息进行排序后存储在链表中，并从链表的头部依次触发事件，有的事件被触发之后会产生新的事件，新的事件也按照时间信息插入到链表中的合适位置；各个模型之间的事件包含：数据帧发送事件、数据帧发送完成事件、数据帧接收完成事件；所述源节点模型是数据帧产生的位置，只接收数据帧发送事件；当数据帧发送事件到达源节点模型的时候，源节点模型会按照数据帧发送事件中的信息产生数据帧并在成功检测链路连通性之后向事件表注册一个数据帧发送事件并通过数据帧发送事件产生一个数据帧发送完成事件用于未来提醒自己数据帧发送完成；所述目的节点模型接收到数据帧接收完成事件之后会得到数据帧的信息并进行统计，包含传输时延抖动的计算以及数据帧在传输过程中状态信息的记录。另一方面，提供了一种时间敏感网络交换机模型的实现方法，包括以下步骤：数据帧从入端口进入交换机模型；交换结构按照MAC表以及交换规则将数据帧交换到对应的出口模块；队列分配器按照优先级将数据帧放入对应队列；数据帧在传输可行性检查模块等待检查；时间感知整型查询模块对数据帧进行是否通过的检查，如果不能通过则给传输可行性检查模块失败反馈，如果能通过则进行后续步骤；出端口传输控制模块对数据帧进行是否通过的检查，如果不能通过则给传输可行性检查模块失败反馈，如果能通过则进行后续步骤；数据帧从出端口传输。优选地，所述队列分配器的工作流程如下：初始时队列分配器处于空闲状态，当队列分配器接收到一个数据帧之后会转移到队列分配状态然后根据定义好的分配规则将数据帧转移到对应的数据管道由数据管道将数据帧发送到对应的队列中；之后队列分配器处于反馈等待状态，当队列通过数据管道通知队列分配器分配成功之后，队列分配器会再次进入空闲状态等待下一个数据帧的到达；所述队列的工作流程如下：当队列分配器将数据帧分配到队列后会触发队列开始工作；队列定义了两种工作情况，分别是：1.队列分配器分配数据帧到队列；2.传输可行性检查模块请求数据；针对情况1：当队列通过数据管道接收到队列分配器发送的数据帧之后会通过数据管道查询传输可行性检查模块的状态，如果传输可行性检查模块为空，则将刚才被分配的数据帧通过数据管道传递给传输可行性检查模块，否则存入队列中；不论是存入队列还是传递给传输可行性检查模块，当操作完成之后会通过数据管道给队列分配器反馈；针对情况2：当传输可行性检查模块向队列发送数据请求，如果当前队列中还有正在排队的数据帧会通过数据管道递交一个数据帧，如果此时队列已经为空则会通过数据管道给传输可行性检查模块反馈。优选地，所述传输可行性检查模块的工作流程如下：传输可行性检查模块初始处于空闲状态，当其接收到一个数据帧之后，会通过数据管道查询后续的时间感知整型查询模块的状态；如果不对时间感知整型查询模块的具体实现进行考虑的话，当前的数据帧如果希望通过时间感知整型查询模块有四种可能的情况，分别是：1.能成功通过，且知道通过的时间；2.能成功通过，但是不知道通过时间；3.本次不能通过，但是可知下次可能通过的时间；4.本次不能通过，对下次的信息一无所知；但是结合事件表要求时间必须有时间信息的前提，情况2实际上无法作为一个合理的时间放入事件表，所以等同于情况4；最终时间感知整型查询模块检查能提供1、3、4三种情况；如果时间感知整型查询模块检查成功且知道通过时间感知整型查询模块的时间T_send，传输可行性检查模块给自己注册一个事件用于提醒自己当前数据帧发送完成；记为等待状态；当时间感知整型查询模块检查的结果是失败，直到下一次可能的时间，那么时间感知整型查询模块给自己注册一个事件用于提醒自己在下一次可能的时间点再次检查时间感知整型查询模块；记为等待状态；如果时间感知整型查询模块检查的情况是失败且不知道额外信息，那么传输可行性检查模块后续的具体工作状况不能自行判断，需要其他的模块来注册特定的事件来提醒传输可行性检查模块后续该如何工作；记为等待状态；等待状态的流程如下：传输可行性检查模块进入等待状态之后会等待自己注册的提醒事件，当接收到提醒事件之后说明数据帧的发送已经完成，然后清除传输可行性检查模块中的内容并通过数据管道向队列请求新的数据帧，如果队列给出的反馈是队列为空，则返回空闲状态，否则成功请求到数据帧并转入阶段从接收一个数据帧的流程重新开始；等待状态的流程如下：在等待状态的情况下，如果接收到自己的提醒事件则会重新转入门控检查状态；等待状态的流程如下：在等待状态的情况下，传输可行性检查模块无法给自己注册提醒事件，只能依靠其他模块，通常是后面的时间感知整型查询模块或者出端口传输控制模块来注册事件提醒传输可行性检查模块在合适的时间唤醒并进行下一步的工作；当传输可行性检查模块再次被唤醒时存在两种情况：1.之前尝试的检查经过一段时间之后得到了确定失败的结果，那么传输可行性检查模块重新转入门控检查状态；2.之前尝试的检查结果最终确定为成功，那么传输可行性检查模块进入清缓存状态，并继续进行之后的流程。优选地，所述时间感知整型查询模块的工作流程如下：时间感知整型查询模块用于实现802.1Qbv中规定的TAS机制，为传输可行性检查模块提供门控检查的接口；当时间感知整型查询模块接收到检查请求之后，会首先根据自身门控配置信息检查数据帧是否能在当前时刻通过门控检查，如果不能通过则给传输可行性检查模块失败且有时间的反馈；如果能通过门控检查还需要进行向后检查，这里向后检查的含义是对本模块之后的模块进行检查；因为实际上，传输可行性检查模块只对检查时间感知整型查询模块的状态然后进行相应的动作，因此传输可行性检查模块对时间感知整型查询模块进行检查的时候就需要时间感知整型查询模块代替传输可行性检查模块对后续模块进行检查，这样才能给传输可行性检查模块提供完整的结果让其作出正确的判断；如果有更多需要检查的模块则也依次进行向后检查并给传输可行性检查模块提供状态；如果时间感知整型查询模块的向后检查通过且已知时间则给传输可行性检查模块成功且已知时间的反馈；其余情况都给传输可行性检查模块失败且未知时间的反馈。优选地，所述出端口传输控制模块的工作流程如下：当出端口传输控制模块被触发检查的时候，首先判断是否有数据帧正在被发送，如果有则给传输可行性检查模块失败反馈，并给当前数据发送完成的时间；如果没有数据正在发送则检查是否设定自检查，如未设定则设定并注册自检查事件；设置自检查的原因：一个出端口有一个出端口传输控制模块但是对应多个传输可行性检查模块，在某个时刻T1可能存在多个传输可行性检查模块都在检查出端口传输控制模块，但是从事件表的实现原则上来说即使是同一个时刻的事件在事件表中也是存在先后顺序的，先后顺序的不同会导致对出端口传输控制模块的检查表现出不同的结果，因此必须额外加以检查；自检查从实现上来讲是注册一个未来最小时间单的事件提醒出端口传输控制模块来判断究竟是哪个传输可行性检查模块中的数据可以发送；然后判断数据帧是否是最高优先级，如果是则可以直接发送，给时间感知整型查询模块成功的反馈，给出时间并转入发送状态；如果不是最高优先级则先放入待发送缓存，如果当前发送缓存中的数据优先级低于自己，将其传入待发送缓存并将当前数据转入发送缓存；如果有比自己优先级高的，则什么也不做；当接收到自检查事件的时候，给发送缓存中数据帧对应缓存模块发送发送成功提醒事件，给待发送缓存中的数据对应的缓存模块发送发送失败提醒事件。另一方面，提供了一种电子设备，所述电子设备包括处理器和存储器，所述存储器中存储有至少一条指令，所述至少一条指令由所述处理器加载并执行以实现上述时间敏感网络交换机模型的实现方法。另一方面，提供了一种计算机可读存储介质，所述存储介质中存储有至少一条指令，所述至少一条指令由处理器加载并执行以实现上述时间敏感网络交换机模型的实现方法。本发明实施例提供的技术方案带来的有益效果至少包括：本发明在IEEE 802.1Qbv协议的基础上设计并实现了一种基于独立的TAS软件仿真的交换机模型，用于验证时间敏感网络系统设计的可行性，提供对门控调度算法的验证，能够为各类优化算法提供时间敏感网络的软件支持。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是802.1Qbv标准定义的典型分组调度结构示意图；图2是本发明实施例提供的网络交换机模型的简化结构示意图；图3是本发明实施例提供的出口模块的结构示意图；图4是本发明实施例提供的时间敏感网络交换机模型的实现方法的工作流程图；图5是本发明实施例提供的队列分配器的工作流程图；图6是本发明实施例提供的队列的工作流程图；图7是本发明实施例提供的传输可行性检查模块的工作流程图；图8是本发明实施例提供的等待状态的工作流程图；图9是本发明实施例提供的等待状态的工作流程图；图10是本发明实施例提供的等待状态的工作流程图；图11是本发明实施例提供的传输可行性检查模块的整体状态机示意图；图12是本发明实施例提供的时间感知整型查询模块的工作流程图；图13是本发明实施例提供的出端口传输控制模块的工作流程图。图14是本发明实施例提供的流在源节点的发送时间在时间轴上的位置示意图；图15是本发明实施例提供的门控设置示意图。如图所示，为了能明确实现本发明的实施例的结构，在图中标注了特定的结构和器件，但这仅为示意需要，并非意图将本发明限定在该特定结构、器件和环境中，根据具体需要，本领域的普通技术人员可以将这些器件和环境进行调整或者修改，所进行的调整或者修改仍然包括在本发明的保护范围中。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。交换是按照通信两端传输信息的需要，用人工或设备自动完成的方法，把要传输的信息送到符合要求的相应路由上的技术的统称。交换机根据工作位置的不同，可以分为广域网交换机和局域网交换机。广域的交换机就是一种在通信系统中完成信息交换功能的设备，它应用在数据链路层。交换机有多个端口，每个端口都具有桥接功能，可以连接一个局域网或一台高性能服务器或工作站。实际上，交换机有时被称为多端口网桥。网络交换机，是一个扩大网络的器材，能为子网络中提供更多的连接端口，以便连接更多的计算机。随着通信业的发展以及国民经济信息化的推进，网络交换机市场呈稳步上升态势。它具有性价比高、高度灵活、相对简单和易于实现等特点。以太网技术已成为当今最重要的一种局域网组网技术，网络交换机也就成为了最普及的交换机。Switch是交换机的英文名称，这个产品是由原集线器的升级换代而来，在外观上看和集线器没有很大区别。由于通信两端需要传输信息，而通过设备或者人工来把要传输的信息送到符合要求标准的对应的路由器上的方式，这个技术就是交换机技术。从广义上来分析，在通信系统里对于信息交换功能实现的设备，就是交换机。TSN交换机是指支持时间敏感网络相关协议的交换机。本发明的实施例重点描述如何在普通的计算机上通过软件的方式实现用于仿真的TSN交换机模型。在软件仿真过程中并不容易将仿真时间与现实世界中的时间建立对应关系。因此，交换机模型在实际运行时不直接使用时间触发而是使用事件触发的方式建立与时间的联系。这里举一个例子，一个以太网数据帧从交换机A通过以太网链路传递到交换机B的时候，在软件运行过程中假设不存在数据帧在链路中产生错误的小概率事件的话，整个数据帧的传输过程可以通过为两个事件的集合{传输开始，传输结束}来描述。这样就将整个时间从连续的过程转换为离散的过程，并且在这个离散过程中的中间状态实际上并没有太多的实际意义。这种事件就是本文中的交换机模型与时间建立联系的基本方式。可以将事件定义为：一个过程中的关键时间点以及其对应的状态信息的集合。本发明的重点在于时间敏感网络交换机模型在软件中的实现方式，但是为了能够较为完整的描述整个系统，这里简单的介绍下网络中的其他模型。除了交换机模型之外，时间敏感网络中还包含端节点模型，这里将端节点分为源节点模型以及目的节点模型，此外还包含一个组织所有事件的软件模块事件表。其中，所述事件表包含时间敏感网络中所有事件的数据结构以及对应方法。按照上述对于事件的定义，每个事件都有对应的时间信息。从实际的网络系统中来看，这些事件的运行存在严格的先后顺序以及特定的触发关系。因此，事件表将事件按照时间信息进行排序后存储在链表中，并从链表的头部依次触发事件，有的事件被触发之后会产生新的事件，新的事件也按照时间信息插入到链表中的合适位置。事件表通过这种方式保证事件按照正确顺序的合理触发。各个模型之间的事件包含：数据帧发送事件、数据帧发送完成事件、数据帧接收完成事件。所述源节点模型是数据帧产生的位置，只接收数据帧发送事件。当数据帧发送事件到达源节点模型的时候，源节点模型会按照数据帧发送事件中的信息产生数据帧并在成功检测链路连通性之后向事件表注册一个数据帧发送事件并通过数据帧发送事件产生一个数据帧发送完成事件用于未来提醒自己数据帧发送完成。所述目的节点模型接收到数据帧接收完成事件之后会得到数据帧的信息并进行统计，包含传输时延抖动的计算以及数据帧在传输过程中状态信息的记录等。本发明的核心内容是提供一种时间敏感网络交换机模型及其实现方法，如图2所示，所述交换机模型包括依次连接的多个入端口、交换结构、出口模块和多个出端口；其中，所述出口模块的结构如图3所示，包括队列分配器、多个队列、多个传输可行性检查模块、时间感知整型查询模块和出端口传输控制模块；当数据帧进入交换机模型之后，所述队列分配器根据数据帧中的信息将数据帧分配到合适的队列，一般而言默认的规则是根据数据帧vlan tag中的PCP字段进行分配；所述队列用于数据帧的排队；所述传输可行性检查模块用于判断数据帧在后续环节的可通过性，如果可通过则向后递交，否则暂时存储在本模块；所述时间感知整型查询模块用于实现802.1Qbv协议中规定的TAS机制；所述出端口传输控制模块用于实现严格优先级以及出端口的控制功能。本发明实施例中，所述交换机模型中各模块间数据交互的方式包括以下两种：数据管道和事件。所述交换机模型实现过程中遵循的基本规则是：如果数据只是逻辑上的交互而不需要时间的流动，采用数据管道的方式；如果数据交互需要或者会导致时间的流动，则采用事件的方式。本发明的实施例还提供了一种时间敏感网络交换机模型的实现方法，如图4所示，所述交换机模型的总体工作流程包括以下步骤：数据帧从入端口进入交换机模型；交换结构按照MAC表以及交换规则将数据帧交换到对应的出口模块；队列分配器按照优先级将数据帧放入对应队列；数据帧在传输可行性检查模块等待检查；时间感知整型查询模块对数据帧进行是否通过的检查，如果不能通过则给传输可行性检查模块失败反馈，如果能通过则进行后续步骤；出端口传输控制模块对数据帧进行是否通过的检查，如果不能通过则给传输可行性检查模块失败反馈，如果能通过则进行后续步骤；数据帧从出端口传输。进一步地，如图5所示，所述队列分配器的工作流程如下：初始时队列分配器处于空闲状态，当队列分配器接收到一个数据帧之后会转移到队列分配状态然后根据定义好的分配规则将数据帧转移到对应的数据管道由数据管道将数据帧发送到对应的队列中；之后队列分配器处于反馈等待状态，当队列通过数据管道通知队列分配器分配成功之后，队列分配器会再次进入空闲状态等待下一个数据帧的到达。如图6所示，所述队列的工作流程如下：当队列分配器将数据帧分配到队列后会触发队列开始工作；队列定义了两种工作情况，分别是：1.队列分配器分配数据帧到队列；2.传输可行性检查模块请求数据。针对情况1：当队列通过数据管道接收到队列分配器发送的数据帧之后会通过数据管道查询传输可行性检查模块的状态，如果传输可行性检查模块为空，则将刚才被分配的数据帧通过数据管道传递给传输可行性检查模块，否则存入队列中；不论是存入队列还是传递给传输可行性检查模块，当操作完成之后会通过数据管道给队列分配器反馈。针对情况2：当传输可行性检查模块向队列发送数据请求，如果当前队列中还有正在排队的数据帧会通过数据管道递交一个数据帧，如果此时队列已经为空则会通过数据管道给传输可行性检查模块反馈。进一步地，本发明中所说的传输可行性检查模块是自己定义的抽象结构，在实际交换机中并不一定存在。传输可行性检查模块的设计目的是提供一个特定的位置让数据帧能够检查后续时间感知整型查询模块以及出端口传输控制模块的状态，以及提供数据帧在从出端口发送之前的等待功能。如图7所示，所述传输可行性检查模块的工作流程如下：传输可行性检查模块初始处于空闲状态，当其接收到一个数据帧之后，会通过数据管道查询后续的时间感知整型查询模块的状态；如果不对时间感知整型查询模块的具体实现进行考虑的话，当前的数据帧如果希望通过时间感知整型查询模块有四种可能的情况，分别是：1.能成功通过，且知道通过的时间；2.能成功通过，但是不知道通过时间；3.本次不能通过，但是可知下次可能通过的时间；4.本次不能通过，对下次的信息一无所知；但是结合事件表要求时间必须有时间信息的前提，情况2实际上无法作为一个合理的时间放入事件表，所以等同于情况4；最终时间感知整型查询模块检查能提供1、3、4三种情况。如果时间感知整型查询模块检查成功且知道通过时间感知整型查询模块的时间T_send，传输可行性检查模块给自己注册一个事件用于提醒自己当前数据帧发送完成；记为等待状态；当时间感知整型查询模块检查的结果是失败，直到下一次可能的时间，那么时间感知整型查询模块给自己注册一个事件用于提醒自己在下一次可能的时间点再次检查时间感知整型查询模块；记为等待状态；如果时间感知整型查询模块检查的情况是失败且不知道额外信息，那么传输可行性检查模块后续的具体工作状况不能自行判断，需要其他的模块来注册特定的事件来提醒传输可行性检查模块后续该如何工作；记为等待状态。如图8所示，等待状态的流程如下：传输可行性检查模块进入等待状态之后会等待自己注册的提醒事件，当接收到提醒事件之后说明数据帧的发送已经完成，然后清除传输可行性检查模块中的内容并通过数据管道向队列请求新的数据帧，如果队列给出的反馈是队列为空，则返回空闲状态，否则成功请求到数据帧并转入阶段从接收一个数据帧的流程重新开始。如图9所示，等待状态的流程如下：在等待状态的情况下，如果接收到自己的提醒事件则会重新转入门控检查状态。如图10所示，等待状态的流程如下：在等待状态的情况下，传输可行性检查模块无法给自己注册提醒事件，只能依靠其他模块，通常是后面的时间感知整型查询模块或者出端口传输控制模块来注册事件提醒传输可行性检查模块在合适的时间唤醒并进行下一步的工作；当传输可行性检查模块再次被唤醒时存在两种情况：1.之前尝试的检查经过一段时间之后得到了确定失败的结果，那么传输可行性检查模块重新转入门控检查状态；2.之前尝试的检查结果最终确定为成功，那么传输可行性检查模块进入清缓存状态，并继续进行之后的流程。传输可行性检查模块的整体状态机如图11所示。进一步地，时间感知整型查询模块用于实现802.1Qbv中规定的TAS机制，此模块为传输可行性检查模块提供检查门控的接口。如图12所示，所述时间感知整型查询模块的工作流程如下：当时间感知整型查询模块接收到检查请求之后，会首先根据自身门控配置信息检查数据帧是否能在当前时刻通过门控检查，如果不能通过则给传输可行性检查模块失败且有时间的反馈；如果能通过门控检查还需要进行向后检查，这里向后检查的含义是对本模块之后的模块进行检查；因为实际上，传输可行性检查模块只对检查时间感知整型查询模块的状态然后进行相应的动作，因此传输可行性检查模块对时间感知整型查询模块进行检查的时候就需要时间感知整型查询模块代替传输可行性检查模块对后续模块进行检查，这样才能给传输可行性检查模块提供完整的结果让其作出正确的判断；如果有更多需要检查的模块则也依次进行向后检查并给传输可行性检查模块提供状态；如果时间感知整型查询模块的向后检查通过且已知时间则给传输可行性检查模块成功且已知时间的反馈；其余情况都给传输可行性检查模块失败且未知时间的反馈。进一步地，如图13所示，所述出端口传输控制模块的工作流程如下：当出端口传输控制模块被触发检查的时候，首先判断是否有数据帧正在被发送，如果有则给传输可行性检查模块失败反馈，并给当前数据发送完成的时间；如果没有数据正在发送则检查是否设定自检查，如未设定则设定并注册自检查事件；设置自检查的原因：一个出端口有一个出端口传输控制模块但是对应多个传输可行性检查模块，在某个时刻T1可能存在多个传输可行性检查模块都在检查出端口传输控制模块，但是从事件表的实现原则上来说即使是同一个时刻的事件在事件表中也是存在先后顺序的，先后顺序的不同会导致对出端口传输控制模块的检查表现出不同的结果，因此必须额外加以检查；自检查从实现上来讲是注册一个未来最小时间单的事件提醒出端口传输控制模块来判断究竟是哪个传输可行性检查模块中的数据可以发送；然后判断数据帧是否是最高优先级，如果是则可以直接发送，给时间感知整型查询模块成功的反馈，给出时间并转入发送状态；如果不是最高优先级则先放入待发送缓存，如果当前发送缓存中的数据优先级低于自己，将其传入待发送缓存并将当前数据转入发送缓存；如果有比自己优先级高的，则什么也不做；当接收到自检查事件的时候，给发送缓存中数据帧对应缓存模块发送发送成功提醒事件，给待发送缓存中的数据对应的缓存模块发送发送失败提醒事件。然后转入发送状态。在更具体的实施例中，假设存在如下的网络拓扑结构：三个源节点ES1，ES2，ES3，一个目的节点ES4以及一个交换机0SW1。并且每个源节点各产生一条流，总共产生三条流，每条流的目的都是目的节点ES4。三条流分别表示为S，S，S，链路速率为1000Mbps。每条流的信息通过一个向量表示为F，其中cycle表示流的发送周期，单位为ns，offset表示流发送时间相对于零点的偏移量，单位为ns，length表示数据帧的长度，单位为比特，S表示流的源节点和目的节点，priorty表示数据帧的优先级。流S的流信息向量为F,7)。流S的流信息向量为F,5)。流S的流信息向量为F,1)。三条流的发送在时间轴上的位置如图14所示。设定门控的周期为3000ns，在一个门控周期内流S到达交换机一次，到达时间为512ns；流S到达交换机两次，到达时间为1014ns和2514ns。S到达交换机两次，到达时间为1014ns和2514ns。交换机的门控周期为3000ns，门控设置如图15所示。整体工作流程为：系统初始化的时候会提前初始化流的发送事件，因此初始化之后事件表中存在5个发送事件，分别是三个节点的流的发送事件。在前面也已经提到了流到达交换机的时间，在数据流进入交换机之前不是本发明的重点，因此从流进入交换机开始进行讨论。在512ns，流S从节点ES1向交换机传输完毕，交换结构将数据帧交换到对应的出端口，数据帧进入对应的出口模块。首先经过队列分配器，此流的优先级为7因此进入队列7。队列7发现传输可行性检查模块为空将此流的数据帧转移到传输可行性检查模块中。传输可行性检查模块开始向时间感知整型查询模块查询门控状态，时间感知整型查询模块查询当前此队列的门控状态处于开启状态，然后时间感知整型查询模块向出端口传输控制模块查询当前端口是否能发送数据帧，出端口传输控制模块发现当前端口没有正在发送的任务并且当前数据帧优先级为最高优先级7，因此返回成功状态给时间感知整型查询模块并给出发送时间，此外还将自身设置为发送状态且发送时间为512ns到1024ns，时间感知整型查询模块再返回成功状态给传输可行性检查模块，传输可行性检查模块确定此数据帧在此端口在当前时间是可以进行传输的，然后向事件缓存中注册一个数据帧的发送开始和发送结束的事件。在1014ns，流S和S从节点向交换机传输完毕。S进入队列5，S进入队列1。此时两个队列对应的传输可行性检查模块都为空，因此两个队列都将数据帧转交给对应的传输可行性检查模块。传输可行性检查模块开始向时间感知整型查询模块查询门控状态，发现当前处于slot1，队列5和队列1都不可以发送，向传输可行性检查模块返回失败并给后续可能能够发送的时间：1200ns，即slot2开始的时间。传输可行性检查模块接收到失败的信息之后向事件缓存注册自提醒事件提醒时间为第1200ns。在1024ns，传输可行性检查模块7接收到发送完成的事件，清空自己存储的数据帧，然后向队列请求新的数据帧并发现队列为空则进入空闲状态。在1200ns，假设传输可行性检查模块1先接收到自提醒事件。传输可行性检查模块1向时间感知整型查询模块查询门控状态，时间感知整型查询模块查询当前此队列的门控状态处于开启状态，然后时间感知整型查询模块向出端口传输控制模块查询当前端口是否能发送数据帧，出端口传输控制模块发现当前时刻出端口处于空闲状态但是数据帧并不是最高优先级，因此暂时将此发送请求暂时存储到发送缓存中，并在第1201ns注册一个自检查事件。传输可行性检查模块5也接收到自提醒事件，与上面同样的流程，出端口传输控制模块发现出端口处于空闲状态，并且发送缓存中请求优先级低于此请求，因此将发送缓存中请求放入待发送缓存，将此请求放入发送缓存中，因为自检查事件已经注册就不再重复注册。上述两次操作都会向对应传输可行性检查模块发送失败信息并声明不知道时间让两个模块都进入等待外部事件的状态。在1201ns，出端口传输控制模块接收到自检查事件，传输可行性检查模块5对应的数据帧请求处于发送缓存，传输可行性检查模块1对应数据帧请求待发送缓存中。最终能够确定传输可行性检查模块5的数据可以发送，另一个无法发送。向能够成功发送的模块注册成功发送提醒事件，并给出传输的开始和结束时间为1201ns到1879ns。向不能发送的模块注册失败事件提醒其重新进入门控检查状态，上述两个事件的时间都在1201ns。传输可行性检查模块5确定此数据帧在此端口在当前时间是可以进行传输的然后向事件缓存中注册一个数据帧的发送开始和发送结束的事件。传输可行性检查模块1重新进行发送可行性检查，时间感知整型查询模块能够通过，但是因为出端口传输控制模块正处于发送的占用状态此状态持续到1879ns，因此传输可行性检查模块1在第1879ns注册一个自提醒事件。在1879ns，传输可行性检查模块5接收到发送完成的事件，清空自己存储的数据帧，然后向队列请求新的数据帧并发现队列为空则进入空闲状态。传输可行性检查模块1接收到自提醒事件，时间感知整型查询模块和出端口传输控制模块都可以通过因此注册一个发送和开始的事件，开始时间为1879ns结束时间为2007ns。在2007ns传输可行性检查模块1接收到发送完成的事件，清空自己存储的数据帧，然后向队列请求新的数据帧并发现队列为空则进入空闲状态。2514ns到达的数据帧在交换机内部的流程和上文描述的类似，此处不再赘述。综上所述，本发明在IEEE 802.1Qbv协议的基础上设计并实现了一种基于独立的TAS软件仿真的交换机模型，用于验证时间敏感网络系统设计的可行性，提供对门控调度算法的验证，能够为各类优化算法提供时间敏感网络的软件支持。本发明的实施例还提供一种电子设备，该电子设备可因配置或性能不同而产生比较大的差异，可以包括一个或一个以上处理器和一个或一个以上的存储器，其中，所述存储器中存储有至少一条指令，所述至少一条指令由所述处理器加载并执行以实现上述时间敏感网络交换机模型的实现方法的步骤。在示例性实施例中，还提供了一种计算机可读存储介质，例如包括指令的存储器，上述指令可由终端中的处理器执行以完成上述时间敏感网络交换机模型的实现方法。例如，所述计算机可读存储介质可以是ROM、随机存取存储器、CD-ROM、磁带、软盘和光数据存储设备等。需要说明的是，在本文中，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者终端设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者终端设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括所述要素的过程、方法、物品或者终端设备中还存在另外的相同要素。在说明书中提到“一个实施例”、“实施例”、“示例性实施例”、“一些实施例”等指示所述的实施例可以包括特定特征、结构或特性，但未必每个实施例都包括该特定特征、结构或特性。另外，在结合实施例描述特定特征、结构或特性时，结合其它实施例实现这种特征、结构或特性应在相关领域技术人员的知识范围内。通常，可以至少部分从上下文中的使用来理解术语。例如，至少部分取决于上下文，本文中使用的术语“一个或多个”可以用于描述单数意义的任何特征、结构或特性，或者可以用于描述复数意义的特征、结构或特性的组合。另外，术语“基于”可以被理解为不一定旨在传达一组排他性的因素，而是可以替代地，至少部分地取决于上下文，允许存在不一定明确描述的其他因素。本发明涵盖任何在本发明的精髓和范围上做的替代、修改、等效方法以及方案。为了使公众对本发明有彻底的了解，在以下本发明优选实施例中详细说明了具体的细节，而对本领域技术人员来说没有这些细节的描述也可以完全理解本发明。另外，为了避免对本发明的实质造成不必要的混淆，并没有详细说明众所周知的方法、过程、流程、元件和电路等。以上所述仅为本发明的较佳实施例，并不用以限制本发明，凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
