标题title
数据报文转发方法、设备及电子设备
摘要abst
本发明提供了一种数据报文转发方法、设备及电子设备，该方法包括：与虚拟内网连接的私网VRF以BGP EVPN方式将私网VRF配置的默认路由发布至SDN控制器，由SDN控制器将虚拟内网所部署的虚拟机IP地址发布至私网VRF；建立至少两对相互隔离并与外网连接并成对互联的外网VRF及虚拟路由隔离装置，私网VRF与虚拟路由隔离装置之间基于定向流量规则转发数据报文，虚拟路由隔离装置与外网VRF之间基于成对配置的第一逻辑端口与第二逻辑端口基于NAT规则转发数据报文。通过在本申请，实现了流量重定向并避免了不同虚拟IP地址的虚拟内网与外网之间形成Mesh连接，并实现了多用户访问外网时实现数据报文的隔离性。
权利要求书clms
1.一种数据报文转发方法，其特征在于，包括：与虚拟内网连接的私网VRF以BGP EVPN方式将私网VRF配置的默认路由发布至SDN控制器，由所述SDN控制器将虚拟内网所部署的虚拟机IP地址发布至私网VRF；建立至少两对相互隔离并与外网连接并成对互联的外网VRF及虚拟路由隔离装置，所述私网VRF与虚拟路由隔离装置之间基于定向流量规则转发数据报文，所述虚拟路由隔离装置与外网VRF之间基于成对配置的第一逻辑端口与第二逻辑端口基于NAT规则转发数据报文。2.根据权利要求1所述的数据报文转发方法，其特征在于，还包括：通过所述虚拟路由隔离装置所配置的具第一网络地址转换规则的第一逻辑端口与所述外网VRF所配置的具第二网络地址转换规则并与所述第一逻辑端口成对互联的第二逻辑端口通过所述定向流量规则与NAT规则在虚拟内网与外网之间执行数据报文的转发，其中，所述NAT规则由所述第一网络地址转换规则与所述第二网络地址转换规则共同定义。3.根据权利要求2所述的数据报文转发方法，其特征在于，所述第一网络地址转换规则为：配置数据报文的源地址，根据所述第一网络地址转换规则查找与所述源地址对应的外网中所述数据报文转发后的目标地址；所述第二网络转换规则为：配置数据报文的目的地址，根据所述第二网络地址转换规则查找与所述目的地址对应的虚拟内网中所述数据报文转发前的源地址。4.根据权利要求2所述的数据报文转发方法，其特征在于，所述私网VRF配置至少两条相互隔离且由第一逻辑端口与第二逻辑端口成对连接的内网转发链路，所述私网VRF配置至少两条独立的定向流量规则，并将所述定向流量规则分别重定向至所述虚拟路由隔离装置，且不同内网转发链路中的NAT规则相互隔离并独立配置。5.根据权利要求1至4中任一项所述的数据报文转发方法，其特征在于，所述定向流量规则与所述NAT规则由SDN控制器通过控制面协议予以下发或者修改。6.根据权利要求5所述的数据报文转发方法，其特征在于，所述数据报文转发方法应用于形成至少两个访问外网的出口端并连接计算节点与网络交换设备的转发设备中；所述私网VRF，虚拟路由隔离装置及外网VRF均部署于所述转发设备。7.一种转发设备，部署于计算节点与用于连接外网的网络交换设备之间，其特征在于，所述转发设备包括：私网VRF，至少两对相互隔离并与外网连接并成对互联的外网VRF及虚拟路由隔离装置，所述私网VRF与虚拟路由隔离装置之间基于定向流量规则转发数据报文，所述虚拟路由隔离装置与外网VRF之间基于成对配置的第一逻辑端口与第二逻辑端口基于NAT规则转发数据报文。8.根据权利要求7所述的转发设备，其特征在于，所述虚拟路由隔离装置具配置第一网络地址转换规则的第一逻辑端口，所述外网VRF具配置第二网络地址转换规则并与所述第一逻辑端口成对互联的第二逻辑端口，所述第一网络地址转换规则与所述第二网络地址转换规则共同定义所述NAT规则，以将通过所述定向流量规则与NAT规则在虚拟内网与外网之间执行数据报文的转发。9.根据权利要求8所述的转发设备，其特征在于，所述私网VRF配置至少两条相互隔离且由第一逻辑端口与第二逻辑端口成对连接的内网转发链路，所述私网VRF配置至少两条独立的定向流量规则，并将所述定向流量规则分别重定向至所述虚拟路由隔离装置，以形成至少两条相互隔离的内网转发链路，且不同内网转发链路中的NAT规则相互隔离并独立配置。10.根据权利要求8所述的转发设备，其特征在于，所述转发设备受控于SDN控制器，所述定向流量规则与所述NAT规则由所述SDN控制器通过控制面协议予以下发或者修改。11.一种电子设备，其特征在于，包括：处理器，由至少一个存储单元组成的存储装置，以及在处理器与存储装置之间建立通信连接的通信总线；所述处理器用于执行存储装置中存储的一个或者多个程序，以实现如权利要求1至6中任一项所述的数据报文转发方法。
说明书desc
技术领域本发明涉及计算机网络技术领域，尤其涉及一种数据报文转发方法、设备及电子设备。背景技术软件定义网络正在将传统网络转变为在简化、低成本硬件上运行的软件可编程域，以推动云计算服务、IT和电信市场的融合。基于SDN组建的云平台、云计算系统及大数据平台场景中，虚拟网络通常使用内部网络的地址相互通信，并采用网络地址转换修改数据报文的源地址和目的地址，从而实现数据报文在各个计算节点之间执行转发，计算节点中部署虚拟机或者容器，以通过虚拟机或者容器部署响应用户在客户端发起访问请求的各种应用或者服务。例如，需要访问本计算节点之外的其他计算节点或者外网或者客户端需要访问该计算节点时，通常需要基于NAT或者隧道方式将彼此IP地址进行网络地址转换。以NAT举例，客户端访问计算节点所在的虚拟内网的过程是将内部网络的目的地址由公网地址基于NAT方式转换为私网地址，反之在虚拟机访问客户端所在外网的过程则是将私网源地址通过NAT方式转换为公网的目的地址。由此实现数据报文在虚拟机所在的虚拟内网与客户端所在的公网之间执行转发。在现有技术中，通常在网络节点中执行网络地址转换。若基于网络节点执行网络地址转换，则需要使用虚拟交换机根据流表所制定的转发规则或者iptable对IP地址进行转换，但该技术方案需要依赖网络节点的物理硬件进行数据报文处理后进行转发，从而导致网络节点的资源开销过大，且转发性能受限于网络节点的处理器性能较大。若基于网络设备执行网络地址转换，则通常是依赖交换机或者路由器配置NAT规则，以对数据报文所携带的IP地址进行转换，但该现有技术通常在虚拟内网与外网之间分别配置两个配置NAT规则的逻辑端口，以通过两个逻辑端口之间建立数据链路，但该现有技术由于在虚拟内网与外网之间设置了两个甚至更多的逻辑端口，因此会形成mesh连接。当虚拟内网中的计算节点数量庞大时，必然导致mesh连接所形成的连接数及拓扑结构变得非常复杂且难以维护，并对数据报文在虚拟内网与外网之间执行转发的延时性造成不利影响，且存在计算节点向多个用户转发数据报文所形成的外网流量之间无法予以隔离。因此，前述两种现有技术在多用户访问外网场景中的技术方案均存在前述诸多技术问题。有鉴于此，有必要对现有技术中的多用户访问外网场景中的技术方案予以改进，以解决上述问题。发明内容本发明的目的在于揭示一种数据报文转发方法、设备及电子设备，用以解决前述现有技术中所存在的缺陷，并尤其旨在解决网络地址转换且具有多个外网出口的场景中虚拟内网访问外网时避免建立mesh连接，实现多用户访问外网时实现数据报文的隔离，并简化云平台转发层的拓扑结构。为实现上述目的之一，本发明提供了一种数据报文转发方法，包括：与虚拟内网连接的私网VRF以BGP EVPN方式将私网VRF配置的默认路由发布至SDN控制器，由所述SDN控制器将虚拟内网所部署的虚拟机IP地址发布至私网VRF；建立至少两对相互隔离并与外网连接并成对互联的外网VRF及虚拟路由隔离装置，所述私网VRF与虚拟路由隔离装置之间基于定向流量规则转发数据报文，所述虚拟路由隔离装置与外网VRF之间基于成对配置的第一逻辑端口与第二逻辑端口基于NAT规则转发数据报文。作为本发明的进一步改进，还包括：通过所述虚拟路由隔离装置所配置的具第一网络地址转换规则的第一逻辑端口与所述外网VRF所配置的具第二网络地址转换规则并与所述第一逻辑端口成对互联的第二逻辑端口通过所述定向流量规则与NAT规则在虚拟内网与外网之间执行数据报文的转发，其中，所述NAT规则由所述第一网络地址转换规则与所述第二网络地址转换规则共同定义。作为本发明的进一步改进，所述第一网络地址转换规则为：配置数据报文的源地址，根据所述第一网络地址转换规则查找与所述源地址对应的外网中所述数据报文转发后的目标地址；所述第二网络转换规则为：配置数据报文的目的地址，根据所述第二网络地址转换规则查找与所述目的地址对应的虚拟内网中所述数据报文转发前的源地址。作为本发明的进一步改进，所述私网VRF配置至少两条相互隔离且由第一逻辑端口与第二逻辑端口成对连接的内网转发链路，所述私网VRF配置至少两条独立的定向流量规则，并将所述定向流量规则分别重定向至所述虚拟路由隔离装置，且不同内网转发链路中的NAT规则相互隔离并独立配置。作为本发明的进一步改进，所述定向流量规则与所述NAT规则由SDN控制器通过控制面协议予以下发或者修改。作为本发明的进一步改进，所述数据报文转发方法应用于形成至少两个访问外网的出口端并连接计算节点与网络交换设备的转发设备中；所述私网VRF，虚拟路由隔离装置及外网VRF均部署于所述转发设备。基于相同发明事项，本申请还揭示了一种转发设备，部署于计算节点与用于连接外网的网络交换设备之间，所述转发设备包括：私网VRF，至少两对相互隔离并与外网连接并成对互联的外网VRF及虚拟路由隔离装置，所述私网VRF与虚拟路由隔离装置之间基于定向流量规则转发数据报文，所述虚拟路由隔离装置与外网VRF之间基于成对配置的第一逻辑端口与第二逻辑端口基于NAT规则转发数据报文。作为本发明的进一步改进，所述虚拟路由隔离装置具配置第一网络地址转换规则的第一逻辑端口，所述外网VRF具配置第二网络地址转换规则并与所述第一逻辑端口成对互联的第二逻辑端口，所述第一网络地址转换规则与所述第二网络地址转换规则共同定义所述NAT规则，以将通过所述定向流量规则与NAT规则在虚拟内网与外网之间执行数据报文的转发。作为本发明的进一步改进，所述私网VRF配置至少两条相互隔离且由第一逻辑端口与第二逻辑端口成对连接的内网转发链路，所述私网VRF配置至少两条独立的定向流量规则，并将所述定向流量规则分别重定向至所述虚拟路由隔离装置，以形成至少两条相互隔离的内网转发链路，且不同内网转发链路中的NAT规则相互隔离并独立配置。作为本发明的进一步改进，所述转发设备受控于SDN控制器，所述定向流量规则与所述NAT规则由所述SDN控制器通过控制面协议予以下发或者修改。最后，本申请还揭示了一种电子设备，包括：处理器，由至少一个存储单元组成的存储装置，以及在处理器与存储装置之间建立通信连接的通信总线；所述处理器用于执行存储装置中存储的一个或者多个程序，以实现如前述任一项发明创造所揭示的数据报文转发方法。与现有技术相比，本发明的有益效果是：在本申请中，通过在转发设备中建立与虚拟内网会话的私网VRF、虚拟路由隔离装置及外网VRF，以建立至少两对相互隔离并在虚拟内网与外网之间执行数据报文转发且相互隔离的内网转发链路，从而使得基于不同虚拟IP地址的虚拟内网与外网之间执行网络地址转换过程中私网VRF与虚拟路由隔离装置之间实现流量重定向，并避免了不同虚拟IP地址的虚拟内网与外网之间形成Mesh连接，从而解决了现有技术中基于mesh连接所形成的连接数巨大及拓扑结构过于复杂的技术问题，并实现了多用户访问外网时实现数据报文的隔离性，并简化了云平台转发层的拓扑结构。附图说明图1为本发明一种数据报文转发方法的整体流程图；图2为应用本发明数据报文转发方法的云平台的整体拓扑图，其中，本发明所揭示的一种转发设备部署于云平台的转发层中；图3为虚拟内网中的内部流量通过默认路由指向网关以访问外网的示意图，其中，内部流量为分配给虚拟机的虚拟内网访问外网所形成的流量；图4为私网VRF与虚拟路由隔离装置之间执行流量重定向的示意图；图5为虚拟路由隔离装置与外网VRF之间基于成对互联的第一逻辑端口与第二逻辑端口，以将回程流量通过虚拟机IP地址返回至虚拟内网的示意图；图6为虚拟内网访问多个具有不同IP地址的外网与虚拟内网之间执行数据报文转发操作过程中执行网络地址转换的示意图；图7为本发明一种电子设备的拓扑图。具体实施方式下面结合附图所示的各实施方式对本发明进行详细说明，但应当说明的是，这些实施方式并非对本发明的限制，本领域普通技术人员根据这些实施方式所作的功能、方法、或者结构上的等效变换或替代，均属于本发明的保护范围之内。在详细阐述本申请各个实施例之前，对本申请所涉及术语及英文缩写的予以必要解释及定义，并对本申请所含技术方案的应用场景予以范例性说明，且不构成对本申请所含发明创造的具体限制。术语“NAT”：Network Address Translation，网络地址转换，NAT将自动修改IP报文的源IP地址和目的IP地址，IP地址校验则在NAT处理过程中自动完成。有些应用程序将源IP地址嵌入到IP报文的数据部分中，所以还需要同时对报文的数据部分进行修改，以匹配IP头中已经修改过的源IP地址；否则，在报文数据部分嵌入IP地址的应用程序就不能正常工作。术语“DNAT”：目标地址转换；DNAT是NAT的一种模式，DNAT对数据包的源地址和目的地址进行修改，并且保存修改前后的映射关系，并且根据需要进行还原操作。术语“SNAT”：源地址转换；根据指定条件修改数据包的源IP地址，以将计算计算中的虚拟机的虚拟内网IP地址转换为公网IP地址。术语“VRF”：虚拟路由转发表；同一台路由器上所保存的路由分成不同的分组，然后根据请求的接口，目的地址进行路由的转发；当路由器中存在两个VRF时，则认为该路由器拥有了两台相互隔离的虚拟路由器，且能够通过各自的虚拟路由器独立地执行数据报文的转发操作。术语“BGP”：边界网关协议；BGP运行在AS与AS之间的动态路由协议，主要作用是在AS之间自动交换无环路由信息以此来构建AS的拓扑图，从而消除路由环路并实施用户配置的路由策略。术语“EVPN”：Ethernet Virtual Private Network，以太网虚拟私有网络；EVPN既是一种独立的隧道协议，可以建立端到端L2/L3隧道，也可以作为VxLAN的控制平面，协助VxLAN隧道在多计算节点的数据中心场景中使用。EVPN借用了MP-BGP方法论，在L2VPN地址族下定义新的EVPN子地址族，新增EVPN NLRI字段。术语“BGP EVPN”：基于BGP协议的EVPN，并应用于分布式网关的场景中，控制平面的流程包括VXLAN隧道建立、MAC地址动态学习；转发平面的流程包括同子网已知单播报文转发、同子网BUM报文转发、跨子网报文转发。该方式实现的功能全面，支持主机IP路由通告、主机MAC地址通告、主机ARP通告，可以直接使能ARP广播抑制功能。术语“IBGP”：内部边界网关协议，部署于自治系统内部并连接两个边界路由器，以通过IGBP在自治系统之间交换路由信息。当两个AS需要交换路由信息时，每个AS都必须指定一个运行BGP的节点，来代表AS与其他的AS交换路由信息。参图1至图6所示，本申请首先揭示了一种数据报文转发方法的一种具体实施方式。该转发方法旨在实现虚拟内网k1～kn与外网50之间对数据报文执行转发操作。虚拟内网分配至计算节点30的一个虚拟机或者多个虚拟机，虚拟机在虚拟内网k1～虚拟内网kn与外网50之间通过转发设备20所包含的前述转发方法对用户因访问虚拟机所形成的数据报文在虚拟内网k1～虚拟内网kn中的一个任意一个虚拟内网与外网50之间执行数据报文的转发操作，且流量的转发方向既包括由外网50向虚拟内网k1～kn进行向内转发，也包括由虚拟内网向外网50进行向外转发，或者虚拟内网k1～kn与外网50之间执行双向转发。该数据报文转发方法应用于形成至少两个访问外网50的出口端并连接并部署于计算节点30与网络交换设备40之间的转发设备20中。私网VRF201，虚拟路由隔离装置202及外网VRF203均部署于所述转发设备20。该数据报文转发方法应用并运行于转发设备20中。转发设备20部署于云平台的转发层2中，且转发设备20不视为现有技术中的网络节点或者形成网络节点的服务器。转发设备20连接网络交换设备40连接至外网50，其中，外网VRF203设置物理网卡Eth1，网络交换设备40设置与物理网卡Eth1通过网线或者光纤连接的物理网卡Eth2。网络交换设备40中维护ACL，网络交换设备40可视为物理交换机，包括但不限于核心交换机、汇聚交换机等。转发设备20包括图4至图6所示出的网关20a等逻辑上独立于网络节点的物理设备或者虚拟设备。下述实施例示出了该转发方法的若干优选实施方式。示例性地，该转发方法运行于云平台或者部署云计算服务的计算机系统中。云平台形成一个或者多个计算节点30，每个计算节点30中部署VM1～VMn，其中，一个或者多个虚拟机被分配一个虚拟内网k1～虚拟内网kn，每一个虚拟内网由一个独立的私网路由111予以独立管理，并通过专属的私网路由111访问其对应的虚拟内网k1～虚拟内网kn中的一个或者多个虚拟机。私网路由111被部署于控制层1中的SDN控制器10予以管理。虚拟内网相对于外网50而言，可被视为私网，同一个私网所形成的虚拟机的虚拟IP地址位于同一网段。管理员可登录后台并通过SDN控制器10对定向流量规则及NAT规则进行手动创建修改或者批量创建修改。如图1与图2所示，在本实施例中，一种数据报文转发方法，包括如下步骤S1至步骤S2。首先，执行步骤S1、与虚拟内网连接的私网VRF201以BGP EVPN方式将私网VRF201配置的默认路由发布至SDN控制器10，由SDN控制器10将虚拟内网k1～kn所部署的虚拟机IP地址发布至私网VRF。本实施例中的BGP EVPN方式包括IBGP EVPN方式或者EBGP EVPN方式。其中，EBGP EVPN方式要求私网VRF201与虚拟内网k1～kn之间存在物理连接，EBGP为外部边界网关协议。参图2与图3所示，申请人以计算节点30中包含虚拟内网k1与虚拟内网k2为范例予以示范性说明。虚拟内网k1分配至虚拟机VM1，虚拟内网k2分配至虚拟机VM2。3.3.3.3/32为一个私网路由111的网段，且该网段为虚拟机VM1分配的虚拟IP地址的网段；3.3.3.4/32为另一个私有路由的网段，且该网段为虚拟机VM2分配的虚拟IP地址的网段。3.3.3.3/32与3.3.3.4/32通过动态隧道发布至私网VRF201，以通过SDN控制器10将虚拟内网所分别对应的私网路由下发至网关20a，从网关20a向左箭头表示将网关20a上所保存的默认理由发送至SDN控制器10，并由SDN控制器的控制下将外网50反馈至虚拟内网的回程流量转发至一个或者多个虚拟内网。虚拟内网k1～虚拟内网kn与私网VRF201之间通过BGP EVPN建立双向会话。EVPN作为VxLAN隧道的控制平面的技术效果是：VTEP自动发现、VxLAN隧道自动建立，从而降低网络部署、扩展的难度；EVPN同时发布二层MAC信息和三层IP路由信息；减少网络中的泛洪流量。同时，私网路由111由SDN控制器10统一纳管，以实现多路径路由。SDN控制器10可部署两个或者两个以上的私网路由。然后，执行步骤S2、建立至少两对相互隔离并与外网50连接并成对互联的外网VRF203及虚拟路由隔离装置202，所述私网VRF201与虚拟路由隔离装置202之间基于定向流量规则转发数据报文，所述虚拟路由隔离装置202与外网VRF203之间基于成对配置的第一逻辑端口与第二逻辑端口基于NAT规则转发数据报文。定向流量规则引导数据报文在私网VRF201与指定的虚拟路由隔离装置之间执行重定向。本申请中的重定向是指基于定向流量规则，使得待执行转发操作的数据报文在私网VRF201与指定的虚拟路由隔离装置202之间执行重定向。例如，参图6所示，网关20a连接n个虚拟网络，n个虚拟网络连接一个私网VRF201，第一条定向流量规则仅在私网VRF201与虚拟路由隔离装置202a之间有效，第二条定向流量规则仅在私网VRF201与虚拟路由隔离装置202b之间有效，且前述两条定向流量规则仅针对唯一的一对虚拟路由隔离装置与私网VRF201之间有效。私网VRF201配置至少两条相互隔离且由第一逻辑端口与第二逻辑端口成对连接的内网转发链路，所述私网VRF201配置至少两条独立的定向流量规则，并将所述定向流量规则分别重定向至所述虚拟路由隔离装置202，且不同内网转发链路中的NAT规则相互隔离并独立配置。定向流量规则与NAT规则由SDN控制器10通过控制面协议予以下发或者修改。控制面协议，例如netconf协议。例如，参图4至图6所示，私网VRF201配置两条内网转发链路，一条内网转发链路形成于网关20a左侧且建立于私网201与虚拟路由隔离装置202a及外网VRF203a之间，另一条内网转发链路形成于网关20a右侧且建立于私网201与虚拟路由隔离装置202b及外网VRF203b之间。网关20a中建立两条定向流量规则，两条定向流量规则分别仅适用于左侧的内网转发链路与右侧的内网转发链路。虚拟路由隔离装置202a配置第一逻辑端口1a，外网VRF203a配置第二逻辑端口2a，同理所示，另一条内网转发链路中的虚拟路由隔离装置202b配置第一逻辑端口1b，外网VRF203b配置第二逻辑端口2b。左侧内网转发链路中的NAT规则由作为第一网络地址转换规则NAT rule1与作为第二网络地址转换规则NAT rule2共同定义，右侧内网转发链路中的NAT规则由作为第一网络地址转换规则的NATrule3与作为第二网络地址转换规则的NAT rule4共同定义。外网VRF203a配置物理网卡Eth1，外网VRF203b配置物理网卡Eth3，物理网卡Eth1、Eth3连接网络交换设备40所设置的并与物理网卡Eth1、Eth3物理上隔离的并分别连接的物理网卡。网络交换设备40可通过网线或光纤连接外网50，用户在客户端通过登录外网50，以访问指定的虚拟内网k1～kn中的一个或者多个虚拟机。在本实施例中，引入两条独立的定向流量规则，以在虚拟路由隔离装置202a与虚拟路由隔离装置202b之间发生唯一指定的数据报文重定向转发效果。在图6中，第一条定向流量规则仅在左侧的内网转发链路中生效，第二条定向流量规则仅在右侧的内网转发链路中生效。基于第一条定向流量规则，使得对进入私网VRF201的数据报文流量执行流量匹配，并对进入虚拟路由隔离装置202a的数据报文流量执行流量匹配。通过查找虚拟内网所属的私网路由的网段，将数据报文流量重定向至对应的内网VRF201或者虚拟路由隔离装置202a。具体而言，在本实施例中，基于第一条定向流量规则，使得源地址所对应的流量重定向至虚拟路由隔离装置202a，从而使得进入虚拟路由隔离装置202a并向外转发至外网50的流量只能通过左侧的虚拟路由转发装置202a予以向外转发，并由此根据虚拟路由隔离装置202a与外网VRF203a之间的NAT规则进行网络地址转换。同理所述，对于外网50形成的回程流量也只能通过外网VRF203a与虚拟路由隔离装置202a与外网VRF203a之间的NAT规则进行网络地址转换，并最终使得目的地址重定向至私网VRF201。同理，位于右侧的第二条内网转发链路参比前述过程予以执行，且由于不同内网转发链路之间被配置了不同的定向流量规则，从而使得位于右侧的内网转发链路禁止源地址所对应的流量重定向至虚拟路由隔离装置202a，同理所述，位于左侧的内网转发链路禁止源地址所对应的流量重定向至虚拟路由隔离装置202b。同时，定向流量规则的数量优选为等于内网转发链路的数量，以满足具有多个物理网卡的外网VRF203访问外网50或者接收外网50形成的回程流量，从而实现了不同用户通过不同的虚拟内网访问外网50的过程中实现流量的隔离，或者，通过外网50访问不同的虚拟内网中的多个虚拟机的过程中实现流量的隔离。同时，通过由于在网关20a中配置了成对设置的虚拟路由隔离装置202a与外网VRF203，从而使得网络地址转换操作具有物理上的隔离性，在简化云平台数据报文转发的转发设备拓扑结构的同时，还确保了网络地址转换操作的安全性及可靠性。参图4与图5所示，该转发方法还包括：通过所述虚拟路由隔离装置202所配置的具第一网络地址转换规则的第一逻辑端口与所述外网VRF203所配置的具第二网络地址转换规则并与所述第一逻辑端口成对互联的第二逻辑端口通过所述定向流量规则与NAT规则在虚拟内网与外网50之间执行数据报文的转发，其中，NAT规则由第一网络地址转换规则与第二网络地址转换规则共同定义。具体地，第一网络地址转换规则为：配置数据报文的源地址，根据所述第一网络地址转换规则查找与所述源地址对应的外网50中所述数据报文转发后的目标地址。第二网络转换规则为：配置数据报文的目的地址，根据所述第二网络地址转换规则查找与所述目的地址对应的虚拟内网中所述数据报文转发前的源地址。SNAT是将第一逻辑端口1a所配置的第一网络地址转换规则为从sa3.3.3.3/32所对应的流量转换为前缀的外网地址，以实现流量从虚拟内网k1向外网50的转发。DNAT是将第二逻辑端口2a所配置的第二网络地址转换规则为将目的地址为178.105.199.5/32的转换为前缀为3.3.3.3/32的虚拟内网k1的IP地址，以实现流量从外网50向虚拟内网k1的转发。私网VRF201与虚拟路由隔离装置202b的定向流量规则参前所示。通过在转发设备20中建立与虚拟内网会话的私网VRF201、虚拟路由隔离装置202a及外网VRF203a，以建立至少两对相互隔离并在虚拟内网k1与外网50之间执行数据报文转发且相互隔离的两条逻辑上独立且相互隔离的内网转发链路，从而使得基于不同虚拟IP地址的虚拟内网与外网50之间执行网络地址转换过程中私网VRF201与虚拟路由隔离装置之间实现流量重定向，并避免了不同虚拟IP地址的虚拟内网与外网50之间形成Mesh连接，从而解决了现有技术中基于mesh连接所形成的连接数巨大及拓扑结构过于复杂的技术问题，且本实施例所揭示的转发方法不依赖于云平台的作为网络节点的物理服务器中CPU性能限制，并有利于突破物理服务器的转发数瓶颈的技术限制。基于前述实施例所揭示的数据报文转发方法的一种具体实施方式，本申请还揭示了基于前述转发方法的一种转发设备20，以运行并实施前述转发方法。参图2所示，转发设备20部署于计算节点与用于连接外网50的网络交换设备之间，转发设备20包括：私网VRF201，至少两对相互隔离并与外网50连接并成对互联的外网VRF及虚拟路由隔离装置202a，私网VRF201与虚拟路由隔离装置之间基于定向流量规则转发数据报文，虚拟路由隔离装置与外网VRF203a之间基于成对配置的第一逻辑端口与第二逻辑端口基于NAT规则转发数据报文。示例性地，虚拟路由隔离装置202a具配置第一网络地址转换规则的第一逻辑端口1a，外网VRF203a具配置第二网络地址转换规则并与第一逻辑端口1a成对互联的第二逻辑端口2a，第一网络地址转换规则与第二网络地址转换规则共同定义NAT规则，以将通过定向流量规则与NAT规则在虚拟内网与外网50之间执行数据报文的转发。参图6所示，虚拟路由隔离装置202a配置第一逻辑端口1a，外网VRF203a配置第二逻辑端口2a；虚拟路由隔离装置202b配置第一逻辑端口1b，外网VRF203a配置第二逻辑端口2b。需要说明的是，本实施例中所揭示的虚拟路由隔离装置202a、202b相对于传统的物理网关或者虚拟网关而言，可被视为一个执行流量转发的代理服务，相邻虚拟路由隔离装置之间不仅能够通过创建多张路由表实现数据或业务的隔离，还能实现与唯一的外网VRF之间基于NAT规则执行网络地址转换。私网VRF201配置至少两条相互隔离且由第一逻辑端口与第二逻辑端口成对连接的内网转发链路，私网VRF201配置至少两条独立的定向流量规则，并将定向流量规则分别重定向至虚拟路由隔离装置202a，以形成至少两条相互隔离的内网转发链路，且不同内网转发链路中的NAT规则相互隔离并独立配置。转发设备20受控于SDN控制器10，定向流量规则与NAT规则由SDN控制器10通过控制面协议予以下发或者修改。本实施例所揭示的转发设备20与前述实施例所揭示的转发方法中所含相同的技术方案，参前所述，在此不再赘述。参图7所示，本实施例还揭示了一种电子设备500，其包括：处理器51，由至少一个存储单元组成的存储装置52，以及在处理器51与存储装置52之间建立通信连接的通信总线53。处理器51用于执行存储装置52中存储的一个或者多个程序，以实现如前述实施例所揭示的数据报文转发方法。具体的，该存储装置52可由存储单元521～存储单元52j所组成，其中，参数j取大于或者等于1的正整数。处理器51可为ASIC、FPGA、CPU、MCU或者其他具有指令处理功能的物理硬件或者虚拟设备。通信总线53的形式并不需要予以具体限定，I2C总线、SPI总线、SCI总线、PCI总线、PCI-E总线、ISA总线等，并可根据电子设备500的具体类型及应用场景需求予以合理变更。通信总线53并非本申请发明点，故在本申请中不予展开陈述。存储装置52可基于Ceph或者GlusterFS等分布式文件系统，也可为RAID0～RAID7磁盘阵列，也可被配置为一块或者多块硬盘或者可移动存储装置、数据库服务器、SSD、NAS存储系统或者SAN存储系统组成。该电子设备500可被配置为超融合一体机、计算机、服务器、数据中心、虚拟集群、便携式移动终端、Web系统、金融支付平台或者ERP系统，以及虚拟在线支付平台/系统等；其中，超融合一体机是一种高性能多节点服务器，主要是分布式存储和服务器虚拟化技术，把计算节点、存储资源、网络交换高度集成到一台1U、2U或者4U服务器中，给企业或者终端用户提供超融合基础架构设施，以全面提升企业的IT能力。尤其的，本实施例所揭示的一种电子设备500可基于前述实施例所揭示的数据报文转发方法，对基于用户在客户端，通过有线或者无线接入外网50的方式，向云平台中虚拟机发起的访问请求或者操作所对应的一个任务或者多个并行任务予以可靠响应，尤其是在对实时性及安全性要求非常严苛的场景，例如购物网站的在线支付系统、金融机构的结算系统、电子购票系统等场景中，该电子设备500具有极其重要的技术应用价值。本实施例所揭示的一种电子设备500可被理解为具有物理形态的实体设备，也可被理解为运行有如前述实施例所揭示的数据报文转发方法的软件系统或者一种互联网在线应用，甚至可以通过光纤或者网线互联的两台或者多台组成直连拓扑结构或者树形拓扑结构或者星型拓扑结构的计算机系统/数据中心。本实施例所揭示的电子设备500与前述实施例相同部分的技术方案，请参前述实施例所述，在此不再赘述。上文所列出的一系列的详细说明仅仅是针对本发明的可行性实施方式的具体说明，它们并非用以限制本发明的保护范围，凡未脱离本发明技艺精神所作的等效实施方式或变更均应包含在本发明的保护范围之内。此外，应当理解，虽然本说明书按照实施方式加以描述，但并非每个实施方式仅包含一个独立的技术方案，说明书的这种叙述方式仅仅是为清楚起见，本领域技术人员应当将说明书作为一个整体，各实施例中的技术方案也可以经适当组合，形成本领域技术人员可以理解的其他实施方式。
