标题title
一种建筑自控系统点位配置方法
摘要abst
本发明公开了一种建筑自控系统点位配置方法，包括以下步骤：通过4G网关将末端设备的点位数据采集到服务器端，服务器端将采集到的点位数据进行策略处理；服务器端将4G网关发送过来的点位数据，同步发送到上位机系统；上位机系统发送MQTT协议消息到服务器端，服务器端将点位数据转发给4G网关，4G网关将消息发送到末端设备；上位机系统配置点位名称与展示时间，从数据库中查询原始数据，配置展示维度和显示值；在上位机系统上开放接口配置，通过配置调用的接口获取多样化数据；上位机系统提供末端设备和虚拟随机数据；本方案具有满足用户多样化数据展示的需求，实现用户低成本制作演示系统，方便用户进行统计的特点。
权利要求书clms
1.一种建筑自控系统点位配置方法，其特征在于，包括以下步骤：S1，通过4G网关将末端设备的点位数据通过MQTT协议采集到服务器端，服务器端将采集到的点位数据进行策略处理；S2，服务器端通过MQTT协议将4G网关发送过来的点位数据，同步发送到上位机系统；S3，上位机系统通过主动发送MQTT协议消息到服务器端，服务器端再将点位数据转发给4G网关，4G网关将消息通过Modbus协议发送到末端设备；S4，上位机系统通过配置点位名称与展示时间，从数据库中查询出对应的原始数据，然后配置展示维度和显示值；S5，在上位机系统上开放接口配置，通过配置调用的接口在服务器端调用，获取多样化数据；S6，上位机系统提供末端设备和虚拟随机数据，用于演示。2.根据权利要求1所述的建筑自控系统点位配置方法，其特征在于：所述步骤S1中，服务器端将采集到的数据进行策略处理包括以下几种策略处理：M1，若无需保存，则服务器端将采集到数据后直接展示到上位机系统，不存储在数据库中；M2，若需一直保存，则服务器端将每次采集到的数据均存入到数据库中；M3，若需值变化保存，则服务器端将采集到的数据与上一次保存的数据进行对比，若值发生了变化则保存，若没有变化则不保存。3.根据权利要求1所述的建筑自控系统点位配置方法，其特征在于，所述步骤S4包括步骤：S401，采用分段配置对原始数据进行再处理，并转化为能在上位机系统显示的数据格式；S402，根据用户的配置信息，将查询到的原始数据进行分段，通过遍历原始数据的值，将点位数据插入到每个分段数据中，进行分段处理，生成在前端显示的数据格式。4.根据权利要求1所述的建筑自控系统点位配置方法，其特征在于，所述步骤S6包括：S601，在本地布置末端设备，并将该末端设备与4G网关进行相互关联，并与上位机系统进行交互；S602，将演示界面的数据点位名称与本地真实设备进行关联，并配置4G网关的ID为本地的网关ID；S603，支持虚拟的随机数据模仿设备真实运行情况，并采用分段方式进行实现；S604，本地4G网关开放部分的常量点位，该常量点位数据不随机变化，仅根据用户发送的指令变化。5.根据权利要求4所述的建筑自控系统点位配置方法，其特征在于：所述常量点位是指为每一个用户在4G网关开放10个寄存器地址，对寄存器与用户之间进行关联，寄存器保持用户下发的数据，并将值的变化存入数据库中，同时将数据上报至该用户的上位机系统中。6.根据权利要求1所述的建筑自控系统点位配置方法，其特征在于：所述数据库中仅记录时间、点位名称和点位数据三个字段。7.根据权利要求1所述的建筑自控系统点位配置方法，其特征在于：所述展示维度包括时间维度，配置时间维度的时间间隔包括以分钟为一单位的时间间隔，或以小时为一单位的时间间隔，或以天为一单位的时间间隔。
说明书desc
技术领域本发明涉及建筑领域中智能控制的上位机系统领域，特别涉及一种建筑自控系统点位配置方法。背景技术目前，建筑领域中智能控制的上位机系统只支持单个点位的数据读写，和简单的数据统计，总体功能较为简单。所以在一些特殊的情况下，用户的一些需求则无法满足：原始数据，即点位上报给上位机的点位数据存入数据库后，用户无法查看不同维度下的数据趋势；如：以时间为横坐标去统计各时间段下的温度变化情况，反过来以温度为横坐标去统计该温度下的时长；数据展示描述文本无法自定义；如：A项目中某点位数据大于10表示异常，B项目中该点位数据大于5就表示异常；而且在查询历史数据报表时，也无法具体到对每一条数据的描述文本进行定义；一套末端设备，只能支持一个项目的演示；当有用户需要定制多套演示界面时，需要多套设备支持，在费用增加的同时，定制过程也变的复杂，而且不支持虚拟随机数据，导致在演示时数据过于单一和固定；因此，急需提供一种建筑自控系统点位配置方法以解决上述问题。发明内容为实现上述目的，发明人提供了一种建筑自控系统点位配置方法，包括以下步骤：S1，通过4G网关将末端设备的点位数据通过MQTT协议采集到服务器端，服务器端将采集到的点位数据进行策略处理；S2，服务器端通过MQTT协议将4G网关发送过来的点位数据，同步发送到上位机系统；S3，上位机系统通过主动发送MQTT协议消息到服务器端，服务器端再将点位数据转发给4G网关，4G网关将消息通过Modbus协议发送到末端设备；S4，上位机系统通过配置点位名称与展示时间，从数据库中查询出对应的原始数据，然后配置展示维度和显示值；S5，在上位机系统上开放接口配置，通过配置调用的接口在服务器端调用，获取多样化数据；S6，上位机系统提供末端设备和虚拟随机数据，用于演示。作为本发明的一种优选方式，所述步骤S1中，服务器端将采集到的数据进行策略处理包括以下几种策略处理：M1，若无需保存，则服务器端将采集到数据后直接展示到上位机系统，不存储在数据库中；M2，若需一直保存，则服务器端将每次采集到的数据均存入到数据库中；M3，若需值变化保存，则服务器端将采集到的数据与上一次保存的数据进行对比，若值发生了变化则保存，若没有变化则不保存。作为本发明的一种优选方式，所述步骤S4包括步骤：S401，采用分段配置对原始数据进行再处理，并转化为能在上位机系统显示的数据格式；S402，根据用户的配置信息，将查询到的原始数据进行分段，通过遍历原始数据的值，将点位数据插入到每个分段数据中，进行分段处理，生成在前端显示的数据格式。作为本发明的一种优选方式，所述步骤S6包括：S601，在本地布置末端设备，并将该末端设备与4G网关进行相互关联，并与上位机系统进行交互；S602，将演示界面的数据点位名称与本地真实设备进行关联，并配置4G网关的ID为本地的网关ID；S603，支持虚拟的随机数据模仿设备真实运行情况，并采用分段方式进行实现；S604，本地4G网关开放部分的常量点位，该常量点位数据不随机变化，仅根据用户发送的指令变化。作为本发明的一种优选方式，所述常量点位是指为每一个用户在4G网关开放10个寄存器地址，对寄存器与用户之间进行关联，寄存器保持用户下发的数据，并将值的变化存入数据库中，同时将数据上报至该用户的上位机系统中。作为本发明的一种优选方式，所述数据库中仅记录时间、点位名称和点位数据三个字段。作为本发明的一种优选方式，所述展示维度包括时间维度，配置时间维度的时间间隔包括以分钟为一单位的时间间隔，或以小时为一单位的时间间隔，或以天为一单位的时间间隔。区别于现有技术，上述技术方案所达到的有益效果有：本方法有效的解决了上位机系统定制化较弱，无法满足用户多样化数据展示的需求；且有效的实现了用户多维度查看数据，并且能够显示出用户对于该点位的描述信息，即只要将点位的数据存入到数据库中，那么用户就可以随意的处理这些数据；本方法有效的解决了用户在制作演示系统时，需要布置末端设备，且存在演示设备不够，或者是演示数据单一性的问题；本方法则有效的实现了用户低成本的制作一套演示系统，无需真实设备，无需代码开发，并且可随时使用远端的真实设备，演示系统的数据也全部记录，方便用户进行统计。附图说明图1为具体实施方式所述本方法架构图。图2为具体实施方式所述上位机系统展示末端设备的统计数据图。图3为具体实施方式所述原始数据分段处理示意图。图4为具体实施方式所述原始数据到显示数据的处理流程图。具体实施方式为详细说明技术方案的技术内容、构造特征、所实现目的及效果，以下结合具体实施例并配合附图详予说明。如图1至图4所示，本实施例提供了一种建筑自控系统点位配置方法，包括以下步骤：S1，通过4G网关将末端设备的点位数据通过MQTT协议采集到服务器端，服务器端将采集到的点位数据进行策略处理；S2，服务器端通过MQTT协议将4G网关发送过来的点位数据，同步发送到上位机系统；S3，上位机系统通过主动发送MQTT协议消息到服务器端，服务器端再将点位数据转发给4G网关，4G网关将消息通过Modbus协议发送到末端设备；S4，上位机系统通过配置点位名称与展示时间，从数据库中查询出对应的原始数据，然后配置展示维度和显示值；S5，在上位机系统上开放接口配置，通过配置调用的接口在服务器端调用，获取多样化数据；S6，上位机系统提供末端设备和虚拟随机数据，用于演示。在上述实施例的具体实施过程中，如图1所示，首先，通过4G网关将末端设备的点位数据通过MQTT协议采集到服务器端，服务器端将采集到的点位数据进行策略处理；如：M1，若无需保存，则服务器端将采集到数据后直接展示到上位机系统，不存储在数据库中；M2，若需一直保存，则服务器端将每次采集到的数据均存入到数据库中；M3，若需值变化保存，则服务器端将采集到的数据与上一次保存的数据进行对比，若值发生了变化则保存，若没有变化则不保存。数据库中也只记录时间、点位名称、数据这三个字段；其中，点位名称是对点位的表述，如：该点位名称叫阀门的开关，那么点位数据就是对应的值，如：值为1代表开、值为0代表关。S2，服务器端也通过MQTT协议将4G网关发送过来的点位数据，同步发送到上位机系统；S3，上位机系统也通过主动发送MQTT协议消息到服务器端，服务器端再将点位数据转发给4G网关，4G网关将消息通过Modbus协议发送到末端设备；从而实现末端设备的控制功能。如图1所示，其描述了完整的4G网关采集到末端设备的数据，并通过服务器保存到数据库和传递给上位机软件显示。并且上位机也可通过服务器和4G网关将数据传递给末端设备。在上述实施例中，还包括：在上位机软件中可以配置除普通上位机的数据展示，点位操作等普通功能外的图表展示功能。其主要是通过配置要展示的点位名称、展示的维度、展示的周期来确定展示形式。具体的技术实现为：S4，上位机系统通过配置点位名称与展示时间，从数据库中查询出对应的原始数据，然后配置展示维度和显示值；如：按时间维度，配置时间维度的时间间隔，以分钟为一单位的时间间隔，或者是以小时为一单位的时间间隔，或者是以天为一单位的时间间隔；显示值可通过配置，显示为平均值，或者是总值。如图2、图3和图4所示，其为上位机系统展示末端设备的统计数据，在具体实施过程中，还包括：S401，采用分段配置对原始数据进行再处理，并转化为能在上位机系统显示的数据格式；例如，用户先选择数据维度，配置分段数据：1：data≤0;desc=寒冷；unit=℃；type=total；2：data＞0&amp;&amp;d≤10；desc=较冷；unit=℃；type=average；3：data＞10&amp;&amp;data≤20；desc=舒适；unit=℃；type=median；4：data＞20；desc=较热；unit=℃；type=total；其中data表示末端采集的数据，desc表示符合该分段的描述信息，unit表示采集数据的单位，type表示该数据是以何种方式统计，total表示统计总和，average表示统计平均数，median表示统计的中位数。这个分段处理实现了将原始数据提取出来进行处理，生成对应的展示数据。在本实施例的具体实施过程中，还包括步骤：S402，根据用户的配置信息，将查询到的原始数据进行分段，通过遍历原始数据的值，将点位数据插入到每个分段数据中，进行分段处理，生成在前端显示的数据格式。如图3所示，图3header表示的是图2的表头格式，其中body表示的是数据部分，每条数据的字段需要与header中进行一一对应。如图4所示，其为原始数据到显示数据的处理流程图。在上述实施例的具体实施过程中，如果上述实施例的方法，还无法满足用户的需求，那么在本实施例中，还包括步骤S5，即上位机系统还开放了接口配置，通过配置调用的接口在服务器端调用，来获取更多样化的数据。在本实施例中，只要是满足图3的数据结构，均可以在上位机系统中展示出来。最后，S6，该上位机系统提供真实末端设备和虚拟随机数据，满足多个用户，多个项目的真实演示页面，具体的：S601，在本地布置了一套包含了大部分的暖通设备，即末端设备，并将该末端设备与4G网关相互关联。采用图1的方式与上位机系统进行交互。S602，需要演示的用户，只需要将演示界面的数据点位名称与本地真实设备进行关联，并配置4G网关的ID为本地的网关ID，即可以使用真实设备，大大减轻了开发难度；本地真实设备是指实际设备，如：各类阀门、空调面板、环境传感器等。S603，支持虚拟的随机数据来模仿设备真实运行情况；例如温度、湿度的变化、支持时间段的变化；具体的是采用分段的方式来实现：1：time=0-6；value=0-10；type=float；unit=℃；2：time=6-12；value=10-20；type=float；unit=℃；3：time=12-18；value=20-10；type=float；unit=℃；4：time=18-24；value=10-0；type=float；unit=℃；其中，time表示时间段，例如time=0-6,就表示0点到6点；value表示的是显示值，这里是区分从大到小变化，还是从小到大的变化，更加符合天气的变化趋势；type表示显示的数据精度；float表示单精度的数据；double表示双精度的数据；int表示的是整型数据；unit表示显示的数据单位。S604，本地4G网关开放了一部分的常量点位，该点位的数据不会随机变化，只会根据用户发送的指令变化；这样用户就可以通过常量点位来模拟开关类操作。常量点位：为每一个用户在4G网关开放10个寄存器地址，这个寄存器与用户之间做关联，寄存器的功能是保持用户下发的数据，并将值的变化存入数据库中，方便用户后续统计，同时将数据上报至该用户的上位机系统中；例如用户下发一个0，就代表灯是关的，1表示灯是开的。上述实施例有效的解决了上位机系统定制化较弱，无法满足用户多样化数据展示的需求；且有效的实现了用户多维度查看数据，并且能够显示出用户对于该点位的描述信息，即只要将点位的数据存入到数据库中，那么用户就可以随意的处理这些数据；还有效的解决了用户在制作演示系统时，需要布置末端设备，且存在演示设备不够，或者是演示数据单一性的问题；本方法则有效的实现了用户低成本的制作一套演示系统，无需真实设备，无需代码开发，并且可随时使用远端的真实设备，演示系统的数据也全部记录，方便用户进行统计。需要说明的是，尽管在本文中已经对上述各实施例进行了描述，但并非因此限制本发明的专利保护范围。因此，基于本发明的创新理念，对本文所述实施例进行的变更和修改，或利用本发明说明书及附图内容所作的等效结构或等效流程变换，直接或间接地将以上技术方案运用在其他相关的技术领域，均包括在本发明的专利保护范围之内。
