标题title
一种基于步进LDO校正TDC延迟步进的方法及装置
摘要abst
本发明公开了一种基于步进LDO校正TDC延迟步进的方法及装置，其中方法包括以下步骤：通过通路控制将锁相环电路中的N个时间数字转换器以负反馈方式连接振荡；通过步进LDO电路输出最大的控制电压至时间数字转换器；在预设时间长度内对时间数字转换器的输出进行定时计数，得到当前控制电压下时间数字转换器的计数器值；根据已知的参考时钟周期和计数器值计算得到步进精度；判断步进精度相比于预设值是偏大还是偏小，若偏大则按预设增量升高控制电压，若偏小则当前控制电压即为目标值；恢复默认通路并输出对应的控制电压至时间数字转换器，使其步进精度在预设范围内。本发明可将TDC步进精度的工艺波动的影响降低到允许范围内。
权利要求书clms
1.一种基于步进LDO校正TDC延迟步进的方法，其特征在于，包括以下步骤：S1.通过通路控制将锁相环电路中的N个TDC即时间数字转换器以负反馈方式连接振荡，则所述时间数字转换器的延迟将在应用范围内随电压或电流单调变化；S2.通过步进LDO电路输出最大的控制电压Vcont至所述时间数字转换器；S3.将所述锁相环电路中已知频率的参考时钟作为定时器，在预设时间长度内对所述时间数字转换器的输出进行定时计数，得到当前控制电压Vcont下所述时间数字转换器的计数器值K；S4.通过数据处理和计算电路根据已知的参考时钟周期Tref和所述计数器值K计算得到所述时间数字转换器的步进精度Tstep；S5.通过控制信号生成电路判断所述步进精度Tstep相比于预设值是偏大还是偏小，若偏大，则通过所述步进LDO电路按预设增量升高所述控制电压Vcont，并跳转至步骤S4；若偏小，则当前控制电压Vcont即为目标值；S6.通过通路控制将所述时间数字转换器之间的负反馈连接断开，恢复默认通路，并通过所述步进LDO电路输出对应的控制电压Vcont至所述时间数字转换器，使其步进精度Tstep在预设范围内。2.根据权利要求1所述的基于步进LDO校正TDC延迟步进的方法，其特征在于，所述步进LDO电路包括参考电压产生电路和低压差线性稳压器，所述参考电压产生电路的信号输入端电连接所述控制信号生成电路的信号输出端，所述参考电压产生电路的信号输出端电连接所述低压差线性稳压器的信号输入端，所述低压差线性稳压器的信号输出端电连接所述数字时间转换器的信号输入端。3.根据权利要求2所述的基于步进LDO校正TDC延迟步进的方法，其特征在于，步骤S5中，若通过控制信号生成电路判断出所述步进精度Tstep相比于预设值偏大，则通过所述参考电压产生电路控制所述低压差线性稳压器按预设增量升高所述控制电压Vcont，并跳转至步骤S4；否则，说明当前控制电压Vcont即为目标值，保存所述参考电压产生电路的控制值。4.根据权利要求3所述的基于步进LDO校正TDC延迟步进的方法，其特征在于，步骤S6中，通过通路控制将所述数字时间转换器之间的负反馈连接断开，恢复默认通路后，利用所述参考电压产生电路的控制值控制所述低压差线性稳压器输出对应的控制电压Vcont至所述数字时间转换器，使其步进精度Tstep在预设范围内。5.根据权利要求1-4任一项所述的基于步进LDO校正TDC延迟步进的方法，其特征在于，步骤S4中，所述步进精度Tstep的计算方法包括：Tstep＝M*Tref/其中，M为计数期间的参考时钟周期个数。6.一种基于步进LDO校正TDC延迟步进的装置，其特征在于，包括N个时间数字转换器、定时器、数据处理和计算模块、控制信号生成电路和步进LDO电路，所述时间数字转换器、定时器、数据处理和计算模块、控制信号生成电路和步进LDO电路首尾连接；所述N个TDC即时间数字转换器以负反馈方式连接振荡，其延迟将在应用范围内随电压或电流单调变化；所述步进LDO电路被配置为输出最大的控制电压Vcont至所述时间数字转换器，并能够按预设增量升高所述控制电压Vcont；所述定时器被配置为锁相环电路中已知频率的的参考时钟，并在预设时间长度内对所述时间数字转换器的输出进行定时计数，得到当前控制电压Vcont下所述时间数字转换器的计数器值K；所述数据处理和计算电路被配置为根据已知的参考时钟周期Tref和所述计数器值K计算得到所述时间数字转换器的步进精度Tstep；所述控制信号生成电路被配置为判断所述步进精度Tstep相比于预设值是偏大还是偏小，若偏大，则通过所述步进LDO电路按预设增量升高所述控制电压Vcont；若偏小，则当前控制电压Vcont即为目标值。7.根据权利要求6所述的基于步进LDO校正TDC延迟步进的装置，其特征在于，所述步进LDO电路包括参考电压产生电路和低压差线性稳压器，所述参考电压产生电路的信号输入端电连接所述控制信号生成电路的信号输出端，所述参考电压产生电路的信号输出端电连接所述低压差线性稳压器的信号输入端，所述低压差线性稳压器的信号输出端电连接所述数字时间转换器的信号输入端。8.根据权利要求7所述的基于步进LDO校正TDC延迟步进的装置，其特征在于，步骤S5中，若通过控制信号生成电路判断出所述步进精度Tstep相比于预设值偏大，则通过所述参考电压产生电路控制所述低压差线性稳压器按预设增量升高所述控制电压Vcont，并跳转至步骤S4；否则，说明当前控制电压Vcont即为目标值，保存所述参考电压产生电路的控制值。9.根据权利要求8所述的基于步进LDO校正TDC延迟步进的装置，其特征在于，步骤S6中，通过通路控制将所述数字时间转换器之间的负反馈连接断开，恢复默认通路后，利用所述参考电压产生电路的控制值控制所述低压差线性稳压器输出对应的控制电压Vcont至所述数字时间转换器，使其步进精度Tstep在预设范围内。10.根据权利要求6-9任一项所述的基于步进LDO校正TDC延迟步进的装置，其特征在于，步骤S4中，所述步进精度Tstep的计算方法包括：Tstep＝M*Tref/其中，M为计数期间的参考时钟周期个数。
说明书desc
技术领域本发明涉及集成电路技术领域，尤其涉及一种基于步进LDO校正TDC延迟步进的方法及装置。背景技术在锁相环设计中，特别是数字锁相环设计中，会用到时间数字转换器。公开号为CN110212912B的发明专利公开了一种具有高精度时间数字转换器的倍数延迟锁相环，包含时间数字转换器处理模块、数模转换器、压控振荡器、分频器、数字控制电路和数据选择器，时间数字转换器处理模块设有依次相连的粗调时间数字转换器、数字时间转换器、减法器和脉冲缩小型时间数字转换器。本发明将高精度时间数字转换器模块应用于倍数延迟锁相环中，通过采样的方式，提高时间数字转换器的精度来改善量化噪声；使用脉冲缩小型时间数字转换器可省略时间放大器的使用以及上升和下降沿的撷取，直接将相位差输入至脉冲缩小型时间数字转换器进行第二次采样，不需要额外使用时间放大器将相位差放大，改善时间数字转换模块的线性度以及其输入范围。公开号为CN110069008B的发明专利公开了一种时间数字转换器系统及包含该系统的倍数延迟锁相环，该系统包括：第一级时间数字转换器、第一级数字时间转换器、第一级时间放大器、第二级时间数字转换器、第二级数字时间转换器、第二级时间放大器、第三级逐次逼近寄存器型的模拟数字转换器及数字模拟转换器。本发明所提供的时间数字转换器系统及具有降低带内量化噪声的倍数延迟锁相环，使用类似于Delta Sigma的联级算法，有效提高应用于倍数延迟锁相环中的时间数字转换器精度，从而降低量化噪声的大小，并改善倍数延迟锁相环杂散的产生。公开号为CN105897259B的发明专利公开了一种具有频控振荡器、反馈路径、时间数字转换器和存储器的锁相环。频控振荡器包括用于改变频控振荡器的输出的频率以跟踪参考频率的第一控制输入和用于调制输出信号以产生啁啾的第二控制输入。反馈路径配置为向时间数字转换器提供输入信号，并且包括可操作为从输出信号中移除由第二控制输入得到的频率调制的调制消除模块。存储器存储第二控制输入值，每一个第二控制输入值对应于期望的啁啾频率并补偿频控振荡器对第二控制输入的响应的非线性。锁相环可操作在啁啾模式中，在啁啾模式中，通过基于存储器中存储的第二控制输入值，确定与期望啁啾频率相对应的第二控制输入的值，来产生第二控制输入，并且在啁啾模式中，锁相环配置为基于反馈路径确定第一控制输入。由于TDC的步进精度影响了环路收到的相位差，TDC的分辨率/步进精度直接决定锁相环的最小分辨精度，影响环路锁定和性能。在采用单延迟单元的TDC锁相环路中，延迟大小的绝对值随制造工艺偏差可以达到典型值的±50％，这种偏差可能造成数字锁相环不锁定或者锁定以后的性能变差。发明内容为了解决上述问题，本发明提出一种基于步进LDO校正TDC延迟步进的方法及装置，数字锁相环环路开始之前，提前把TDC的延迟校正到设计值附近5％以内，保证了锁相环的收敛性和性能稳定。本发明采用的技术方案如下：一种基于步进LDO校正TDC延迟步进的方法，包括以下步骤：S1.通过通路控制将锁相环电路中的N个TDC即时间数字转换器以负反馈方式连接振荡，则所述时间数字转换器的延迟将在应用范围内随电压或电流单调变化；S2.通过步进LDO电路输出最大的控制电压Vcont至所述时间数字转换器；S3.将所述锁相环电路中已知频率的参考时钟作为定时器，在预设时间长度内对所述时间数字转换器的输出进行定时计数，得到当前控制电压Vcont下所述时间数字转换器的计数器值K；S4.通过数据处理和计算电路根据已知的参考时钟周期Tref和所述计数器值K计算得到所述时间数字转换器的步进精度Tstep；S5.通过控制信号生成电路判断所述步进精度Tstep相比于预设值是偏大还是偏小，若偏大，则通过所述步进LDO电路按预设增量升高所述控制电压Vcont，并跳转至步骤S4；若偏小，则当前控制电压Vcont即为目标值；S6.通过通路控制将所述时间数字转换器之间的负反馈连接断开，恢复默认通路，并通过所述步进LDO电路输出对应的控制电压Vcont至所述时间数字转换器，使其步进精度Tstep在预设范围内。进一步地，所述步进LDO电路包括参考电压产生电路和低压差线性稳压器，所述参考电压产生电路的信号输入端电连接所述控制信号生成电路的信号输出端，所述参考电压产生电路的信号输出端电连接所述低压差线性稳压器的信号输入端，所述低压差线性稳压器的信号输出端电连接所述数字时间转换器的信号输入端。进一步地，步骤S5中，若通过控制信号生成电路判断出所述步进精度Tstep相比于预设值偏大，则通过所述参考电压产生电路控制所述低压差线性稳压器按预设增量升高所述控制电压Vcont，并跳转至步骤S4；否则，说明当前控制电压Vcont即为目标值，保存所述参考电压产生电路的控制值。进一步地，步骤S6中，通过通路控制将所述数字时间转换器之间的负反馈连接断开，恢复默认通路后，利用所述参考电压产生电路的控制值控制所述低压差线性稳压器输出对应的控制电压Vcont至所述数字时间转换器，使其步进精度Tstep在预设范围内。进一步地，步骤S4中，所述步进精度Tstep的计算方法包括：Tstep＝M*Tref/其中，M为计数期间的参考时钟周期个数。一种基于步进LDO校正TDC延迟步进的装置，包括N个时间数字转换器、定时器、数据处理和计算模块、控制信号生成电路和步进LDO电路，所述时间数字转换器、定时器、数据处理和计算模块、控制信号生成电路和步进LDO电路首尾连接；所述N个TDC即时间数字转换器以负反馈方式连接振荡，其延迟将在应用范围内随电压或电流单调变化；所述步进LDO电路被配置为输出最大的控制电压Vcont至所述时间数字转换器，并能够按预设增量升高所述控制电压Vcont；所述定时器被配置为锁相环电路中已知频率的的参考时钟，并在预设时间长度内对所述时间数字转换器的输出进行定时计数，得到当前控制电压Vcont下所述时间数字转换器的计数器值K；所述数据处理和计算电路被配置为根据已知的参考时钟周期Tref和所述计数器值K计算得到所述时间数字转换器的步进精度Tstep；所述控制信号生成电路被配置为判断所述步进精度Tstep相比于预设值是偏大还是偏小，若偏大，则通过所述步进LDO电路按预设增量升高所述控制电压Vcont；若偏小，则当前控制电压Vcont即为目标值。进一步地，所述步进LDO电路包括参考电压产生电路和低压差线性稳压器，所述参考电压产生电路的信号输入端电连接所述控制信号生成电路的信号输出端，所述参考电压产生电路的信号输出端电连接所述低压差线性稳压器的信号输入端，所述低压差线性稳压器的信号输出端电连接所述数字时间转换器的信号输入端。进一步地，步骤S5中，若通过控制信号生成电路判断出所述步进精度Tstep相比于预设值偏大，则通过所述参考电压产生电路控制所述低压差线性稳压器按预设增量升高所述控制电压Vcont，并跳转至步骤S4；否则，说明当前控制电压Vcont即为目标值，保存所述参考电压产生电路的控制值。进一步地，步骤S6中，通过通路控制将所述数字时间转换器之间的负反馈连接断开，恢复默认通路后，利用所述参考电压产生电路的控制值控制所述低压差线性稳压器输出对应的控制电压Vcont至所述数字时间转换器，使其步进精度Tstep在预设范围内。进一步地，步骤S4中，所述步进精度Tstep的计算方法包括：Tstep＝M*Tref/其中，M为计数期间的参考时钟周期个数。本发明的有益效果在于：本发明可以在锁相环环路工作之前，精确调整TDC的步进精度Tstep，把Tstep值的工艺波动的影响Tstep_max降低到预设范围内。以目前的40nm CMOS工艺来，看这个误差可以从±50％降低到5％。附图说明图1为典型的时间数字转换器工艺波动示意图。图2为典型的电压可控时间数字转换器示意图。图3为在一定范围内单调的VDD与Tstep曲线示意图。图4为本发明的基于步进LDO校正TDC延迟步进的方法流程图。图5为本发明的基于步进LDO校正TDC延迟步进的方法原理图。图6为本发明的时间数字转换器输入输出示意图。图7为本发明中利用参考时钟周期定时计数的示意图。图8为本发明中基于参考周期和振荡频率差计算步进精度示意图。图9为本发明的步进LDO电路框图。图10为本发明的步进过程示意图。图11为本发明的低压差线性稳压器电路原理图。图12为本发明的参考电压产生电路原理图。图13为校正过程中VDD与Tstep曲线示意图。具体实施方式为了对本发明的技术特征、目的和效果有更加清楚的理解，现说明本发明的具体实施方式。应当理解，此处所描述的具体实施例仅用以解释本发明，并不用于限定本发明，即所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明的实施例，本领域技术人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。实施例1如图1所示为典型的时间数字转换器随工艺波动情况，可见在典型情况、缓慢情况和快速情况下的延迟时间并不固定。如图2展示了一种用Vcont电压和电压控制电容组成的多bit TDC延迟单元电路，图3描述了图2的电路在不同电压下TDC延迟步进Tstep的变化情况。基于此，本实施例提供了一种基于步进LDO校正TDC延迟步进的方法，如图4和图5所示，包括以下步骤：S1.通过通路控制将锁相环电路中的N个TDC即时间数字转换器以负反馈方式连接振荡，则时间数字转换器的延迟将在应用范围内随电压或电流单调变化；S2.通过步进LDO电路输出最大的控制电压Vcont至时间数字转换器；S3.将锁相环电路中已知频率的参考时钟作为定时器，在预设时间长度内对时间数字转换器的输出进行定时计数，得到当前控制电压Vcont下时间数字转换器的计数器值K；S4.通过数据处理和计算电路根据已知的参考时钟周期Tref和计数器值K计算得到时间数字转换器的步进精度Tstep；S5.通过控制信号生成电路判断步进精度Tstep相比于预设值是偏大还是偏小，若偏大，则通过步进LDO电路按预设增量升高控制电压Vcont，并跳转至步骤S4；若偏小，则当前控制电压Vcont即为目标值；S6.通过通路控制将时间数字转换器之间的负反馈连接断开，恢复默认通路，并通过步进LDO电路输出对应的控制电压Vcont至时间数字转换器，使其步进精度Tstep在预设范围内。如图6所示，本实施例将N个时间数字转换器首尾相连，负反馈会使其振荡。同时，利用参考时钟周期定时计数，如图7所示。再基于参考周期和振荡频率差获得步进精度Tstep和目标值的信息，如图8所示。最后利用参考时钟和控制电压Vcont校正时间数字转换器的步进精度Tstep。具体地，步进精度Tstep的计算方法包括以下子步骤：S401.获取已知的参考时钟周期Tref，则M个参考时钟周期的时间为M*Tref；S402.N bit的周期Tdelay0＝/K；S403.计算步进精度Tstep＝M*Tref/。如图9所示，步进LDO电路包括参考电压产生电路和低压差线性稳压器，参考电压产生电路的信号输入端电连接控制信号生成电路的信号输出端，参考电压产生电路的信号输出端电连接低压差线性稳压器的信号输入端，低压差线性稳压器的信号输出端电连接数字时间转换器的信号输入端。如图10所示，若通过控制信号生成电路判断出步进精度Tstep相比于预设值偏大，则通过参考电压产生电路控制低压差线性稳压器按预设增量升高控制电压Vcont，并跳转至步骤S4；否则，说明当前控制电压Vcont即为目标值，保存参考电压产生电路的控制值，再通过通路控制将数字时间转换器之间的负反馈连接断开，恢复默认通路，利用参考电压产生电路的控制值控制低压差线性稳压器输出对应的控制电压Vcont至数字时间转换器，使其步进精度Tstep在预设范围内。如图11所示为低压差线性稳压器电路原理图，如图12所示为参考电压产生电路原理图，参考电压产生电路由温度计码控制。如图13所示，校正完成后，步进精度Tstep会由工艺可能的偏差Tstep-max校正到dTstep上，准确度大大提高。实施例2如图5所示，本实施例提供了一种基于步进LDO校正TDC延迟步进的装置，包括N个时间数字转换器、定时器、数据处理和计算模块、控制信号生成电路和步进LDO电路，时间数字转换器、定时器、数据处理和计算模块、控制信号生成电路和步进LDO电路首尾连接，其中：N个TDC即时间数字转换器以负反馈方式连接振荡，其延迟将在应用范围内随电压或电流单调变化。步进LDO电路被配置为输出最大的控制电压Vcont至时间数字转换器，并能够按预设增量升高控制电压Vcont。定时器被配置为锁相环电路中已知频率的的参考时钟，并在预设时间长度内对时间数字转换器的输出进行定时计数，得到当前控制电压Vcont下时间数字转换器的计数器值K。数据处理和计算电路被配置为根据已知的参考时钟周期Tref和计数器值K计算得到时间数字转换器的步进精度Tstep。控制信号生成电路被配置为判断步进精度Tstep相比于预设值是偏大还是偏小，若偏大，则通过步进LDO电路按预设增量升高控制电压Vcont；若偏小，则当前控制电压Vcont即为目标值。如图6所示，本实施例将N个时间数字转换器首尾相连，负反馈会使其振荡。同时，利用参考时钟周期定时计数，如图7所示。再基于参考周期和振荡频率差获得步进精度Tstep和目标值的信息，如图8所示。最后利用参考时钟和控制电压Vcont校正时间数字转换器的步进精度Tstep。具体地，步进精度Tstep的计算方法包括以下子步骤：S401.获取已知的参考时钟周期Tref，则M个参考时钟周期的时间为M*Tref；S402.N bit的周期Tdelay0＝/K；S403.计算步进精度Tstep＝M*Tref/。如图9所示，步进LDO电路包括参考电压产生电路和低压差线性稳压器，参考电压产生电路的信号输入端电连接控制信号生成电路的信号输出端，参考电压产生电路的信号输出端电连接低压差线性稳压器的信号输入端，低压差线性稳压器的信号输出端电连接数字时间转换器的信号输入端。如图10所示，若通过控制信号生成电路判断出步进精度Tstep相比于预设值偏大，则通过参考电压产生电路控制低压差线性稳压器按预设增量升高控制电压Vcont，并跳转至步骤S4；否则，说明当前控制电压Vcont即为目标值，保存参考电压产生电路的控制值，再通过通路控制将数字时间转换器之间的负反馈连接断开，恢复默认通路，利用参考电压产生电路的控制值控制低压差线性稳压器输出对应的控制电压Vcont至数字时间转换器，使其步进精度Tstep在预设范围内。如图11所示为低压差线性稳压器电路原理图，如图12所示为参考电压产生电路原理图，参考电压产生电路由温度计码控制。如图13所示，校正完成后，步进精度Tstep会由工艺可能的偏差Tstep-max校正到dTstep上，准确度大大提高。需要说明的是，对于前述的方法实施例，为了简便描述，故将其表述为一系列的动作组合，但是本领域技术人员应该知悉，本申请并不受所描述的动作顺序的限制，因为依据本申请，某些步骤可以采用其他顺序或者同时进行。其次，本领域技术人员也应该知悉，说明书中所描述的实施例均属于优选实施例，所涉及的动作和模块并不一定是本申请所必须的。
