标题title
一种用于半双工串行通信的物理层
摘要abst
本发明提供一种用于半双工串行通信的物理层，所述物理层包括主物理层和从物理层，所述主物理层包括第一双向接口模块，所述从物理层包括第二双向接口模块，第一双向接口模块和第二双向接口模块通过一对差分信号线连接，通过切换主物理层和从物理层的数据传输方向，主物理层和从物理层交替发送数据包，主物理层和从物理层的数据通信阶段包括链路连接建立阶段和链路连接保持阶段，建立链路连接时主物理层和从物理层分别判断物理层数据通信是否正常，当通信均正常时判断为链路连接建立成功。本申请能够基于一对差分信号线实现两个通信节点间的双向通信，有利于减少通信线对数量、节约布线空间、降低布线成本。
权利要求书clms
1.一种用于半双工串行通信的物理层，其特征在于，所述物理层包括主物理层和从物理层以提供两个通信节点，所述主物理层包括第一双向接口模块，所述从物理层包括第二双向接口模块，第一双向接口模块和第二双向接口模块通过一对差分信号线连接，通过切换主物理层和从物理层的数据传输方向，主物理层和从物理层交替发送数据包以实现主物理层和从物理层的双向数据通信，主物理层和从物理层的数据通信阶段包括链路连接建立阶段和链路连接保持阶段，所述链路连接建立阶段用于判断是否成功建立链路连接，并在成功建立链路连接后进入链路连接保持阶段，建立链路连接时主物理层和从物理层分别判断物理层数据通信是否正常，当通信均正常时判断为链路连接建立成功。2.根据权利要求1所述的用于半双工串行通信的物理层，其特征在于，主物理层包括第一控制模块，从物理层包括第二控制模块，所述第一控制模块和第二控制模块用于分别切换主物理层和从物理层的数据传输方向，以使得在同一时刻下，主物理层和从物理层的其中之一处于数据发送方向，其中另一处于数据接收方向。3.根据权利要求2所述的用于半双工串行通信的物理层，其特征在于，当物理层复位后，主物理层属于数据发送方向，从物理层处于数据接收方向，主物理层向从物理层发送数据包，从物理层接收主物理层发送的数据包，主物理层发送完数据包后切换为数据接收方向，从物理层接收完数据包后切换为数据发送方向；从物理层向主物理层发送数据包，主物理层接收从物理层发送的数据包，从物理层发送完数据包后切换为数据接收方向，主物理层接收完数据包后切换为数据发送方向。4.根据权利要求1所述的用于半双工串行通信的物理层，其特征在于，所述数据包包括握手包和用户包，握手包用于建立主物理层和从物理层的通信链路，用户包用于传输发往通信上层的数据和/或从通信上层接收的数据。5.根据权利要求4所述的用于半双工串行通信的物理层，其特征在于，在链路连接建立阶段，主物理层向从物理层发送预定量的握手包，从物理层接收到握手包后向主物理层反馈握手包，主物理层在接收超时时间内接收到反馈的握手包数量满足要求时，认定主物理层数据通信正常，反之认定异常；从物理层判断连续接收到的数据包数量满足要求时，认定从物理层数据通信正常，反之认定异常。6.根据权利要求1所述的用于半双工串行通信的物理层，其特征在于，在链路连接保持阶段，如果主物理层和从物理层分别在接收超时时间内接收到来自对方的数据包，则刷新链路连接建立成功的状态；反之，则认定为链路连接中断。7.根据权利要求5或6所述的用于半双工串行通信的物理层，其特征在于，当认定为链路连接建立不成功或链路连接中断时，物理层在经过预定时间后重新尝试建立链路连接。
说明书desc
技术领域本发明涉及串行传输通信领域，特别是涉及一种用于半双工串行通信的物理层。背景技术传统的高速串行通信，通信节点之间通过两对差分线作为通信链路，每对差分线负责一个方向的数据传输，进而实现双向通信，而在通信节点布线空间受控的情况下，传统的方式需要占据较多布线空间。发明内容本发明的目的在于提供一种用于半双工串行通信的物理层，以解决传统布线方式占据空间大的问题，本申请通过一对差分线实现两个通信节点之间的数据交互，减少了通信线对数量、降低了通信节点间的布线空间要求、降低了布线成本。为解决上述技术问题，本申请可采用如下技术方案：一种用于半双工串行通信的物理层，所述物理层包括主物理层和从物理层以提供两个通信节点，所述主物理层包括第一双向接口模块，所述从物理层包括第二双向接口模块，第一双向接口模块和第二双向接口模块通过一对差分信号线连接，通过切换主物理层和从物理层的数据传输方向，主物理层和从物理层交替发送数据包以实现主物理层和从物理层的双向数据通信。进一步的，主物理层包括第一控制模块，从物理层包括第二控制模块，所述第一控制模块和第二控制模块用于分别切换主物理层和从物理层的数据传输方向，以使得在同一时刻下，主物理层和从物理层的其中之一处于数据发送方向，其中另一处于数据接收方向。进一步的，当物理层复位后，主物理层属于数据发送方向，从物理层处于数据接收方向，主物理层向从物理层发送数据包，从物理层接收主物理层发送的数据包，主物理层发送完数据包后切换为数据接收方向，从物理层接收完数据包后切换为数据发送方向；从物理层向主物理层发送数据包，主物理层接收从物理层发送的数据包，从物理层发送完数据包后切换为数据接收方向，主物理层接收完数据包后切换为数据发送方向。进一步的，所述数据包包括握手包和用户包，握手包用于建立主物理层和从物理层的通信链路，用户包用于传输发往通信上层的数据和/或从通信上层接收的数据。进一步的，主物理层和从物理层的数据通信阶段包括链路连接建立阶段和链路连接保持阶段，所述链路连接建立阶段用于判断是否成功建立链路连接，并在成功建立链路连接后进入链路连接保持阶段。进一步的，所述判断是否成功建立链路连接包括：主物理层和从物理层分别判断物理层数据通信是否正常，当通信均正常时判断为链路连接建立成功。进一步的，在链路连接建立阶段，主物理层向从物理层发送预定量的握手包，从物理层接收到握手包后向主物理层反馈握手包，主物理层在接收超时时间内接收到反馈的握手包数量满足要求时，认定主物理层数据通信正常，反之认定异常；从物理层判断连续接收到的数据包数量满足要求时，认定从物理层数据通信正常，反之认定异常。进一步的，在链路连接保持阶段，如果主物理层和从物理层分别在接收超时时间内接收到来自对方的数据包，则刷新链路连接建立成功的状态；反之，则认定为链路连接中断。进一步的，当认定为链路连接建立不成功或链路连接中断时，物理层在经过预定时间后重新进入链路连接建立阶段。本申请的实施例提供的技术方案至少带来以下有益效果：定义主物理层和从物理层，主物理层和从物理层分别包括双向接口模块，能够通过切换双向接口模块的数据发送方向和数据接收方向，使得通过一对差分线实现主物理层和从物理层之间的双向数据通信，节省布线空间、降低布线成本；此外，基于一对差分线实现双向通信，针对性的设计了链路连接建立和链路连接保持的方式，使得主物理层和从物理层能够分别校验数据通讯异常状况，保证串行通信的稳定性。应当理解的是，以上的一般描述和后文的细节描述仅是示例性和解释性的，并不能限制本申请。附图说明此处的附图被并入说明书中并构成本说明书的一部分，示出了符合本申请的实施例，并与说明书一起用于解释本申请的原理，并不构成对本申请的不当限定。图1是本发明一个实施例的用于半双工串行通信的物理层框图；图2是本发明另一个实施例的用于半双工串行通信的物理层框图；图3a是现有技术中两个通信节点的双向通信示意图；图3b是发明一个实施例的主物理层和从物理层的双向通信示意图；图4是本发明一个实施例物理层传输方向切换的示意图；图5是本发明一个实施例的主物理层链路连接建立阶段工作流程图；图6是本发明一个实施例的物理层保持链路连接成功状态的工作流程图。具体实施方式为使本发明的技术方案更加清楚明了，下面将结合附图来描述本发明的实施例。应当理解的是，对实施方式的具体说明仅用于示教本领域技术人员如何实施本发明，而不是用于穷举本发明的所有可行方式，更不是用于限制本发明的具体实施范围。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动的前提下所获得的所有其他实施例，都应属于本发明保护的范围。本发明保护一种用于半双工串行通信的物理层，物理层包括主物理层和从物理层以提供两个通信节点，将互联节点的一个通信节点的物理层定义为主物理层，另一个通信节点的物理层定义为从物理层。当物理层完成复位后处于初始状态时，主物理层处于数据发送方向，从物理层处于数据接收方向，从物理层仅当接收到来自主物理层的数据包后方可切换为数据发送方向。主物理层包括第一双向接口模块，从物理层包括第二双向接口模块，所述第一双向接口模块和第二双向接口模块分别具有双向通信的功能，以使得第一双向接口模块和第二双向接口模块分别可处于数据发送方向和数据接收方向，通过一对差分信号线连接第一双向接口模块和第二双向接口模块，通过切换主物理层和从物理层的数据传输方向，主物理层和从物理层能够交替发送数据包以实现主物理层和从物理层的双向通信。具体的，参图1，主物理层包括第一控制模块、第一双向接口模块、第一数据发送/接收模块，对应的，从物理层包括第二控制模块、第二双向接口模块、第二数据发送/接收模块，所述第一双向接口模块和第二双向接口模块分别用于使得主物理层和从物理层可处于数据发送方向和数据接收方向，通过一对差分线能够实现数据的双向传输；所述第一控制模块和第二控制模块分别用于切换主物理层和从物理层的数据传输方向，通过控制第一双向接口模块和第二双向接口模块的数据发送方向和数据接收方向，以使得在同一时刻时，主物理层的第一双向接口模块和从物理层的第二双向接口模块其中之一处于数据发送方向，其中另一处于数据接收方向，进而实现主物理层和从物理层交替发送数据包。现有技术中，参图3a，通过两对差分信号线实现两个通信节点之间的双向通信，每一对差分信号线分别实现一个方向的数据通信，但该种方式占用布线空间较多。本实施例中，参图3b,在相同时间内，主物理层和从物理层其中之一处于数据发送方向，其中另一处于数据接收方向，完成单向的数据发送/接收后，切换第一双向接口模块和第二双向接口模块的数据收发方向，使得通过一根差分线即可实现主物理层和从物理层的双向数据通信，能提供减少通信线对数量，降低通信节点间的布线空间要求以及降低布线成本。具体的，数据包包括握手包和用户包，所述握手包用于建立主物理层和从物理层之间的通信链路，握手包由物理层自主发起传输；用户包是由物理层的通信上层发起传输的，物理层在通信上层发来的数据的前面和后面，分别加上物理层包头字段和物理层包尾字段，组成用户包发出去。对方节点的物理层在接收用户包时，去掉物理层包头字段和物理层包尾字段，提取数据发送给本地的通信上层。其中，参图1，第一数据发送/接收模块示例性的可以形成为一个模块，或者，也可以形成为两个模块，即，第一数据发送模块和第一数据接收模块，示例性的，参图2，所述主物理层包括第一数据发送模块、第一数据接收模块，所述从物理层包括第二数据发送模块、第二数据接收模块，其中，所述第一数据发送模块负责物理层用户包及握手包生成、8b10b编码和数据并串转换等功能，第一数据接收模块负责串行数据接收恢复、8b10b解码和物理层数据包解析等功能。类似的，第二数据发送/接收模块的实现方式和功能与第一数据发送/接收模块类似，此处不再赘述。具体的，通过设置主物理层和从物理层的数据发送/接收方向的切换机制，使得主物理层和从物理层能够交替发送数据包。在一个具体的实施例中，参图4，当物理层复位完成后，两个通信节点处于初始方向，此时主物理层处于数据发送方向，从物理层处于数据接收方向；此时，主物理层向从物理层发送数据包，从物理层接收从主物理层发送的数据包；待主物理层发送完数据包后，第一控制模块将第一双向接口模块切换为数据接收方向，待从物理层接收完毕数据包后，第二控制模块将第二双向接口模块切换为数据发送方向；之后，从物理层向主物理层发送数据包，主物理层接收从物理层发送的数据包；待从物理层发送完数据包后切换至数据接收方向，主物理层接收完数据包之后且切换至数据发送方向。以此循环，实现基于一对差分信号线，主物理层和从物理层的双向数据通信。示例性的，在物理层复位完成后，主物理层向从物理层发送1个物理层数据包，从物理层接收到主物理层发送给的数据包后，向主物理层发送1个反馈数据包，主物理层发送完毕后切换为数据接收方向，从物理层接收完毕后切换为数据发送方向，以此类推，交替进行数据包发送和数据包接收。其中，主物理层和从物理层发送的数据包可以根据实际情况按需确认，此处不做限制。进一步的，主物理层和从物理层的数据通信阶段包括链路连接建立阶段和链路连接保持阶段，所述链路连接建立阶段用于建立主物理层和从物理层之间的通信，并判断是否成功建立主物理层和从物理层之间的链路连接，在链路连接建立成功后进入链路保持阶段。其中，当物理层复位完成后，物理层自动进入链路连接建立阶段。其中，链路连接建立阶段需判断主物理层和从物理层之间是否成功建立链路连接，所述判断主物理层和从物理层之间是否成功建立链路连接包括：主物理层和从物理层分别判断物理层数据通信是否正常，当两者的通信均正常时判断为链路连接建立成功。反之，当其中至少其一的数据通信异常时，确定为链路连接建立不成功。相较于传统采用两对差分信号线建立互联通信节点的数据通信的方式，每对差分信号线采取单向传输数据包的方式，每对差分信号线可以持续传输数据以分别校验传输方向的数据通信是否正常，例如在不发送数据包的阶段，可以持续进行通信线路畅通的空包校验方式；本申请中采用一对差分信号线，采用双向传输数据包的方式，需要基于一对信号线进行双向的通信正常的校验，示例性的，本申请中采用分时校验的方式验证主物理层和从物理层的数据通信正常与否，以保证主物理层和从物理层之间的通信稳定。在链路连接建立阶段，主物理层向从物理层发送预定量的握手包，从物理层接收到主物理层发送的握手包后，向主物理层反馈握手包，如果主物理层在接收超时时间内接收到的反馈握手包数量满足预设要求时，认定主物理层数据通信正常。示例性的，当主物理层在接收超时时间内接收到的反馈数据包数量与主物理层的握手包发送次数一致，则认定为主物理层的通信链路建立成功。进一步的，在链路连接建立阶段，从物理层在连续收到的数据包数量满足要求时，认为从物理层的通信链路建立成功，否则认为通信链路建立不成功。示例性的，从物理层判断连续收到的数据包数量与主物理层发送的数据包的数量相同时，认定为从物理层的通信链路建立成功。当链路连接建立成功后，主物理层和从物理层进入链路连接保持阶段，否则，链路连接建立不成功，物理层在经过预定时间后重新尝试建立链路连接，链路连接建立的方式如前所述。示例性的，在链路连接建立阶段，主物理层连续发送10个握手包且在接收超时时间内成功接收10个从物理层反馈的握手包，则链路连接建立成功；如果主物理层在发送握手包时，出现1次接收超时，则本次链路连接建立结束。等待1ms后，再开始下一次链路连接建立。当主物理层和从物理层进入链路连接保持阶段后，主物理层和从物理层进入数据通信状态，主物理层和从物理层分别在接收超时时间内接收到来自对方的数据包，则刷新链路连接建立成功的状态，反之，则认定为链路连接中断。当链路连接中断时，物理层在经过预定时间后重新尝试建立链路连接，链路连接建立的方式如前所述。也即，在链路连接建立阶段，如果主物理层和从物理层未能成功建立链路连接，则认为主物理层和从物理层链路连接建立不成功；在链路保持阶段，如果主物理层和从物理层未在接收超时时间内接收到来自对方的数据包，则认为链路连接中断。示例性的，参图5，在链路连接建立不成功或链路连接中断时，主物理层每隔1ms尝试一次链路连接建立，也即，物理层重新进入链路连接建立阶段。具体的，在物理层复位完成后，主物理层等待1ms计时完成，之后向从物理层发送10个握手包，如果在接收超时时间内握手包接收成功，且接收到的握手包数量满足要求，即接收到10个握手包，则认为链路连接建立成功；如果在接收超时时间内握手包未能成功接收或接收数量不满足要求，则认定链路连接建立失败，等待1ms后再次进入链路连接建立阶段，以此循环。具体的，在本实施例中，参图6，在链路连接保持阶段，物理层通过接收超时门限RCV_LIMIT和响应超时门限RSP_LIMIT，对链路连接状态进行判断，并根据不同工况开展工作。其中，接收超时门限RCV_LIMIT表示等待接收对方数据包的最长时间，超出该门限则认为链路连接中断；响应超时门限RSP_LIMIT表示等待通信上层发送数据的最长时间，超出该门限则认为通信上层响应超时，所述通信上层示例性的包括传输层或链路层。在正常情况下，主物理层需要定期完成一发一收动作，从物理层对应的需要定期完成一收一发动作，以刷新保持链路连接成功的状态。主物理层和从物理层接收数据包等待时间不应超过各自对应的接收超时门限RCV_LIMIT，主物理层和从物理层发送数据包等待时间不应超过各自对应的响应超时门限RSP_LIMIT。以上本申请的优选实施例，将两个通信节点分为主物理层和从物理层，主物理层和从物理层通过一对差分信号线实现双向数据通信，有利地减小了对布线空间的要求，适合紧凑空间使用；此外，基于分时校验的方式，在主物理层和从物理层交替发送数据包时进行链路连接建立阶段和链路保持阶段的通信异常状况校验，保证主物理层和从物理层的通信稳定。本领域技术人员在考虑说明书及实践这里公开的发明后，将容易想到本申请的其它实施方案。本申请旨在涵盖本申请的任何变型、用途或者适应性变化，这些变型、用途或者适应性变化遵循本申请的一般性原理并包括本申请未公开的本技术领域中的公知常识或惯用技术手段。说明书和实施例仅被视为示例性的，本申请的真正范围和精神由下面的权利要求指出。应当理解的是，本申请并不局限于上面已经描述并在附图中示出的精确结构，并且可以在不脱离其范围进行各种修改和改变。本申请的范围仅由所附的权利要求来限制。
