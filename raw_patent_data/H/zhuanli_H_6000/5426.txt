标题title
一种5G直放站系统的时延自调整方法
摘要abst
本发明公开了一种5G直放站系统的时延自调整方法，属于5G通信技术领域，解决5G直放站系统中，在时分复用TDD模式下，由于空口，10msNR无线帧帧头以及NR数据无法精准对齐，使得NR数据被切，从而影响NR业务速率的问题。首先，计算出近端单元AU上行链路和下行链路的系统固有时延，然后计算AU和RU的光纤时延，然后计算远端单元RU上行链路和下行链路的系统固有时延，然后分别将AU和RU的上下行链路的系统固有时延对齐，然后将10msNR无线帧帧头，延后数值为系统的下行链路固有时延的时间长度。最后，验证特殊时隙中，下行数据和上行数据，是否相互干扰，并据此选择是否触发告警灯。
权利要求书clms
1.一种5G直放站系统的时延自调整方法，其特征在于：包括以下步骤：步骤一、计算AU下行链路的系统固有时延t_au_dl；步骤二、计算AU和RU间的光纤时延t_fiber；步骤三、计算AU上行链路的系统固有时延t_au_ul；步骤四、将AU的上下行链路的系统固有时延对齐；步骤五、计算RU下行链路的系统固有时延t_ru_dl；步骤六、计算RU上行链路的系统固有时延t_ru_ul；步骤七、将RU的上下行链路的系统固有时延对齐；步骤八、在RU中，根据数据相对于空口的位置关系，将10msNR无线帧帧头，调节至和数据的起始位置对齐的位置；步骤九、验证特殊时隙中，下行数据和上行数据，是否相互干扰，并据此选择是否触发告警灯。2.根据权利要求1所述的一种5G直放站系统的时延自调整方法，其特征在于：所述步骤一具体为：由于直放站的前端是基站侧的远端单元RRU，此RRU在发射信号时，空口和10msNR无线帧帧头的起始位置是对齐的，在数据传输的过程中，空口的位置是一定的，即保持不变的，数据相对于空口可能存在提前或者滞后的情况，在直放站侧，数据从AU的天线口进入，之后随着数据链路，产生了时延，而10msNR帧头的位置没有产生变化，统计10msNR无线帧帧头和在通用公共接口cpri侧的下行数据起始位置的时延差值；由于基站侧的RRU下发的数据会存在相对于空口的提前或者滞后的情况，当数据相对于空口提前时，将时延差值加上提前量的绝对值；当数据相对于空口滞后时，将时延差值减去滞后量的绝对值；则得到了AU下行的系统固有时延。3.根据权利要求2所述的一种5G直放站系统的时延自调整方法，其特征在于：在计算AU下行的系统固有时延时，以10msNR无线帧帧头为起始位置，设置计数器，计数到在cpri侧，数据的起始位置处计数器累加的数值，计数的数值乘时钟的单位时间，就是AU下行的系统固有时延，表示数据落后于10msNR无线帧帧头的时间。4.根据权利要求1所述的一种5G直放站系统的时延自调整方法，其特征在于：所述步骤二具体为：10msNR无线帧帧头和数据在光纤中，同时在传输，即产生的时延相同，相对位置保持不变，由于光在真空中传播的速度是，在光纤中的光信号传播速度相对于光速较慢，这是由于光信号在光纤中的传播受到介质折射率的影响，传输速度降低30%不到，按照/＞去计算，则得到每一米光纤，光信号传输需要5ns。5.根据权利要求1所述的一种5G直放站系统的时延自调整方法，其特征在于：所述步骤三具体为：将AU用光纤回环，将AU的10msNR无线帧帧头信号接到FPGA的管脚上，将此管脚所对应的，在硬件上的射频线接到频谱仪上，并以此用作上升沿检测信号trigger，并将AU的发射端天线口出来的信号，通过射频线接到频谱仪的信号输入口，通过用频谱仪去测量AU的上下行链路的系统固有时延，频谱仪显示的时延值toffset就是AU的上下行固有时延，将此值减去步骤一中AU下行的系统固有时延值t_au_dl，再减去步骤二中的光纤时延t_fiber的两倍，则得到了AU上行的系统固有时延t_au_ul。6.根据权利要求1所述的一种5G直放站系统的时延自调整方法，其特征在于：所述步骤五具体为：将AU和RU用光纤直连，将RU的10msNR无线帧帧头信号接到FPGA的管脚上，将此管脚所对应的，在硬件上的射频线接到频谱仪上，并以此用作上升沿检测信号trigger，并将RU的发射端天线口出来的信号，通过射频线接到频谱仪的信号输入口，用频谱仪去测量AU和RU的系统的下行固有时延，频谱仪显示的时延值toffset就是AU加RU的下行的固有时延，同时需要将此值减去步骤一中AU下行的系统固有时延t_au_dl，再减去步骤二中的光纤时延t_fiber，即得到RU下行的系统固有时延t_ru_dl。7.根据权利要求1所述的一种5G直放站系统的时延自调整方法，其特征在于：所述步骤六具体为：将RU用光纤回环，将RU的10msNR无线帧帧头信号接到FPGA的管脚上，将此管脚所对应的，在硬件上的射频线接到频谱仪上，并将RU的发射端天线口出来的信号，并以此用作上升沿检测信号trigger，并将RU的发射端天线口出来的信号，通过射频线接到频谱仪的信号输入口，用频谱仪去测量RU的上下行固有时延，频谱仪显示的时延值toffset就是RU的上下行固有时延，将此值减去步骤五中RU下行的系统固有时延值t_ru_dl，再减去步骤二中的光纤时延的两倍，则得到了RU上行的系统固有时延t_ru_ul。8.根据权利要求1所述的一种5G直放站系统的时延自调整方法，其特征在于：所述步骤八具体为：在RU的射频链路和数字链路中，数据产生了时延，而帧头的位置不变，所以信号从RU的天线口出来时，10msNR无线帧帧头相对于空口落后了光纤时延，数据相对于空口落后了AU和RU下行的系统固有时延和光纤时延的总和，而数据落后于10msNR无线帧帧头，AU和RU下行的系统固有时延，需要将10msNR无线帧帧头延后AU和RU下行的系统固有时延值；当数据相对于空口被提前发射时，则需要将10msNR无线帧帧头延后AU和RU下行的系统固有时延值，加上提前发射的时间长度值；当数据相对于空口被滞后发射时，则需要将10msNR无线帧帧头延后，AU和RU下行的系统固有时延值减去提前发射的时间长度值。9.根据权利要求1所述的一种5G直放站系统的时延自调整方法，其特征在于：所述步骤九具体为：由于手机终端UE发信号是提前空口13.04us发射，所以在时分复用TDD模式下，下行信号的末尾以及上行信号的开头存在重叠可能性，在特殊时隙S时隙中，保护间隔gap的时间长度，决定了直放站系统的光纤时延值和固有时延最大值，需要满足的条件是，13.04us+光纤时延+直放站系统的固有时延＜gap的时间长度，检测此条件，当条件不成立时，输出高电平，触发告警提示灯。
说明书desc
技术领域本发明涉及5G通信系统，解决5G直放站系统中，在时分复用TDD模式下，由于空口，10msNR无线帧帧头以及NR数据无法精准对齐，使得NR数据被切，从而影响NR业务速率的问题。背景技术在5G直放站系统中，由于直放站处于基站的后端，并且由近端单元AU以及远端单元RU组成，10msNR无线帧帧头和数据在传输的过程中，各自的位置相对于空口都在产生变化。这意味着，信号从直放站RU发射端的天线口出去后，空口，数据和帧头的位置并不对齐，使得NR的数据被切，业务速率受到影响。往往在调试的过程，即使是相同的直放站系统，不同的基站系统，也每次都需要借助示波器或者频谱仪，进行各种调试，从而摸索经验值。这会引发，最终结果的精确性得不到保障，系统的性能受到影响，同时效率过低等一系列问题。发明内容针对现有技术中存在的问题，本发明目的在于，提供5G直放站系统的时延自调整方法。解决5G直放站系统中，在时分复用TDD模式下，由于空口，10msNR无线帧帧头以及NR数据无法精准对齐，使得NR数据被切，从而影响NR业务速率的问题。为了实现上述目的，本发明所采用技术方案为：计算出近端单元AU上行链路和下行链路的系统固有时延，然后计算AU和RU的光纤时延，然后计算远端单元RU上行链路和下行链路的系统固有时延，然后分别将AU和RU的上下行链路的系统固有时延对齐，然后将10msNR无线帧帧头，延后数值为系统的下行链路固有时延的时间长度。最后，验证特殊时隙中，下行数据和上行数据，是否相互干扰，并据此选择是否触发告警灯，具体包括以下步骤：步骤一、计算AU下行链路的系统固有时延t_au_dl；步骤二、计算AU和RU间的光纤时延t_fiber；步骤三、计算AU上行链路的系统固有时延t_au_ul；步骤四、将AU的上下行链路的系统固有时延对齐；步骤五、计算RU下行链路的系统固有时延t_ru_dl；步骤六、计算RU上行链路的系统固有时延t_ru_ul；步骤七、将RU的上下行链路的系统固有时延对齐；步骤八、在RU中，根据数据相对于空口的位置关系，将10msNR无线帧帧头，调节至和数据的起始位置对齐的位置；步骤九、验证特殊时隙中，下行数据和上行数据，是否相互干扰。所述步骤一具体为：由于直放站的前端是基站侧的RRU，此RRU在发射信号时，空口和10msNR无线帧帧头的起始位置是对齐的，在数据传输的过程中，空口的位置是一定的，即保持不变的，数据相对于空口可能存在提前或者滞后的情况，在直放站侧，数据从AU的天线口进入，之后随着数据链路，产生了时延，而10msNR帧头的位置没有产生变化，统计10msNR无线帧帧头和在通用公共接口cpri侧的下行数据起始位置的时延差值。由于基站侧的RRU下发的数据会存在相对于空口的提前或者滞后的情况，当数据相对于空口提前时，将时延差值加上提前量的绝对值；当数据相对于空口滞后时，将时延差值减去滞后量的绝对值；则得到了AU下行的系统固有时延。在计算AU下行的系统固有时延时，以10msNR无线帧帧头为起始位置，设置计数器，计数到在cpri侧，数据的起始位置处计数器累加的数值，计数的数值乘时钟的单位时间，就是AU下行的系统固有时延，表示数据落后于10msNR无线帧帧头的时间。所述步骤二具体为：10msNR无线帧帧头和数据在光纤中，同时在传输，即产生的时延相同，相对位置保持不变，由于光在真空中传播的速度是，在光纤中的光信号传播速度相对于光速稍慢，这是由于光信号在光纤中的传播受到介质折射率的影响，传输速度降低约30%不到，按照/＞去计算，则得到每一米光纤，光信号传输需要5ns。所述步骤三具体为：将AU用光纤回环，将AU的10msNR无线帧帧头信号接到现场可编程逻辑门阵列FPGA的管脚上，将此管脚所对应的，在硬件上的射频线接到频谱仪上，并以此用作上升沿检测信号trigger，并将AU的发射端天线口出来的信号，通过射频线接到频谱仪的信号输入口，通过用频谱仪去测量AU的上下行链路的系统固有时延，频谱仪显示的时延值toffset就是AU的上下行固有时延，将此值减去步骤一中AU下行的系统固有时延值t_au_dl，再减去步骤二中的光纤时延t_fiber的两倍，则得到了AU上行的系统固有时延t_au_ul。需要注意的是，在步骤二中算出的光纤时延t_fiber是单程的，由于将AU回环，此时需要将光纤时延值翻倍。所述步骤四具体为：由于AU系统的上下行架构不完全相同，从硬件角度，例如，在上行发射方向有功率放大器器件，在下行接收方向有低噪声放大器器件；从功能角度，在上行发射方向需要实现削峰功能和非线性预失真功能。所以AU的上下行系统的固有时延不相同，发射方向的固有时延一般比接收方向的固有时延要大，为了保持系统上下行时延的一致性，将系统的上下行时延调节对齐。所述步骤五具体为：将AU和RU用光纤直连，将RU的10msNR无线帧帧头信号接到FPGA的管脚上，将此管脚所对应的，在硬件上的射频线接到频谱仪上，并以此用作上升沿检测信号trigger，并将RU的发射端天线口出来的信号，通过射频线接到频谱仪的信号输入口，用频谱仪去测量AU和RU的系统的下行固有时延，频谱仪显示的时延值toffset就是AU加RU的下行的固有时延，同时需要将此值减去步骤一中AU下行的系统固有时延t_au_dl，再减去步骤二中的光纤时延t_fiber，即得到RU下行的系统固有时延t_ru_dl。所述步骤六具体为：将RU用光纤回环，将RU的10msNR无线帧帧头信号接到FPGA的管脚上，将此管脚所对应的，在硬件上的射频线接到频谱仪上，并将RU的发射端天线口出来的信号，并以此用作上升沿检测信号trigger，并将RU的发射端天线口出来的信号，通过射频线接到频谱仪的信号输入口，用频谱仪去测量RU的上下行固有时延，频谱仪显示的时延值toffset就是RU的上下行固有时延，将此值减去步骤五中RU下行的系统固有时延值t_ru_dl，再减去步骤二中的光纤时延的两倍，则得到了RU上行的系统固有时延t_ru_ul。需要注意的是，在步骤二中算出的光纤时延t_fiber是单程的，由于将RU回环，此时需要将光纤时延值翻倍。所述步骤七具体为：由于RU系统的上下行架构不完全相同，从硬件角度，例如在上行接收方向有低噪声放大器器件，在下行发射方向有功率放大器器件；从功能角度，在下行发射方向需要实现削峰功能和非线性预失真功能。所以RUU的上下行系统的固有时延不相同，发射方向的固有时延一般比接收方向的固有时延要大，为了保持系统上下行时延的一致性，将系统的上下行时延调节对齐。所述步骤八具体为：由于在AU和RU的系统中，如果在进AU天线口时，空口，10msNR无线帧和数据是对齐的，10msNR无线帧帧头和数据的位置关系是，在AU的射频链路和数字链路中，数据产生了时延，而帧头的位置不变，在光纤中数据和帧头一起在传输，时延都在发生变化，但是两者的相对位置不产生变化。在RU的射频链路和数字链路中，数据产生了时延，而帧头的位置不变，所以信号从RU的天线口出来时，10msNR无线帧帧头相对于空口，落后了光纤时延，数据相对于空口落后了，AU和RU下行的系统固有时延和光纤时延的总和，而数据落后于10msNR无线帧帧头，AU和RU下行的系统固有时延，需要将10msNR无线帧帧头，延后AU和RU下行的系统固有时延值。当数据相对于空口被提前发射时，则需要将10msNR无线帧帧头，延后AU和RU下行的系统固有时延值，加上提前发射的时间长度值；当数据相对于空口被滞后发射时，则需要将10msNR无线帧帧头，延后AU和RU下行的系统固有时延值，减去提前发射的时间长度值。所述步骤九具体为：由于手机终端UE发信号是提前空口13.04us发射，所以在时分复用TDD模式下，下行信号的末尾以及上行信号的开头存在重叠可能性，在特殊时隙S时隙中，保护间隔gap的时间长度，决定了直放站系统的光纤时延值和固有时延最大值，需要满足的条件是，13.04us+光纤时延+直放站系统的固有时延＜gap的时间长度，检测此条件，当条件不成立时，输出高电平，触发告警提示灯。与现有技术相比，本发明的有益效果在于：1、本发明通过10msNR无线帧以及数据的关系，先计算了5G直放站系统中近端单元AU的接收端的下行链路的固有时延，然后采用光纤回环AU的方式，AU和RU直连的方式以及光纤回环RU的方式，采用频谱仪计算AU发射端上行链路的系统时延，RU的发射端的下行链路的固有时延以及RU的接收端的上行链路的固有时延，提高了系统固有时延计算的精确度；2、本发明将5G直放站系统的AU和RU的上下行链路的系统固有时延对齐，使得系统的上行链路以及下行链路具有对称性；3、本发明针对拉远环境下，长光纤对于系统的影响，判断保护间隔GAP中的下行数据末尾以及上行数据的开头，是否存在重叠的情况，并触发告警灯提示风险，增加了系统的可靠性；4、本发明将5G直放站系统的上下行的系统固有时延固定，只需要知道基站侧10msNR无线帧帧头以及数据的位置关系，可做到自己调整时延，使得NR数据对齐，增加了5G直放站系统调整时延的效率。附图说明图1为本发明5G直放站系统的时延自调整方法流程图。图2为本发明5G直放站系统的时延自调整方法时序图。具体实施方式下面结合说明书附图对本发明实施例中的技术方案进行清楚、完整地描述。参见图1和图2，本发明包括以下步骤：一种5G直放站系统的时延自调整方法，计算出近端单元AU上行链路和下行链路的系统固有时延，然后计算AU和RU的光纤时延，然后计算远端单元RU上行链路和下行链路的系统固有时延，然后分别将AU和RU的上下行链路的系统固有时延对齐，然后将10msNR无线帧帧头，延后数值为系统的下行链路固有时延的时间长度。最后，验证特殊时隙中，下行数据和上行数据，是否相互干扰，并据此选择是否触发告警灯，具体包括以下步骤：步骤一、计算AU下行链路的系统固有时延t_au_dl。由于直放站的前端是基站侧的RRU，此RRU在发射信号时，空口和10msNR无线帧帧头的起始位置是对齐的，在数据传输的过程中，空口的位置是一定的，即保持不变的，数据相对于空口可能存在提前或者滞后的情况，在直放站侧，数据从AU的天线口进入，之后随着数据链路，产生了时延，而10msNR帧头的位置没有产生变化，统计10msNR无线帧帧头和在通用公共接口cpri侧的下行数据起始位置的时延差值。由于基站侧的RRU下发的数据会存在相对于空口的提前或者滞后的情况，当数据相对于空口提前时，将时延差值加上提前量的绝对值；当数据相对于空口滞后时，将时延差值减去滞后量的绝对值；则得到了AU下行的系统固有时延。在计算AU下行的系统固有时延时，以10msNR无线帧帧头为起始位置，设置计数器，计数到在cpri侧，数据的起始位置处计数器累加的数值，计数的数值乘时钟的单位时间，就是AU下行的系统固有时延，表示数据落后于10msNR无线帧帧头的时间。步骤二、计算AU和RU间的光纤时延t_fiber。10msNR无线帧帧头和数据在光纤中，同时在传输，即产生的时延相同，相对位置保持不变，由于光在真空中传播的速度是，在光纤中的光信号传播速度相对于光速稍慢，这是由于光信号在光纤中的传播受到介质折射率的影响，传输速度降低约30%不到，按照/＞去计算，则得到每一米光纤，光信号传输需要5纳秒ns，即每一公里光纤，光信号传输需要5微秒us。步骤三、计算AU上行链路的系统固有时延t_au_ul。将AU用光纤回环，将AU的10msNR无线帧帧头信号接到FPGA的管脚上，将此管脚所对应的，在硬件上的射频线接到频谱仪上，并以此用作上升沿检测信号trigger，并将AU的发射端天线口出来的信号，通过射频线接到频谱仪的信号输入口，通过用频谱仪去测量AU的上下行链路的系统固有时延，频谱仪显示的时延值toffset就是AU的上下行固有时延，将此值减去步骤一中AU下行的系统固有时延值t_au_dl，再减去步骤二中的光纤时延t_fiber的两倍，则得到了AU上行的系统固有时延t_au_ul。需要注意的是，在步骤二中算出的光纤时延t_fiber是单程的，由于将AU回环，此时需要将光纤时延值翻倍。步骤四、将AU的上下行链路的系统固有时延对齐。由于AU系统的上下行架构不完全相同，从硬件角度，例如，在上行发射方向有功率放大器器件，在下行接收方向有低噪声放大器器件；从功能角度，在上行发射方向需要实现削峰功能和非线性预失真功能。所以AU的上下行系统的固有时延不相同，发射方向的固有时延一般比接收方向的固有时延要大，为了保持系统上下行时延的一致性，将系统的上下行时延调节对齐。步骤五、计算RU下行链路的系统固有时延t_ru_dl。将AU和RU用光纤直连，将RU的10msNR无线帧帧头信号接到FPGA的管脚上，将此管脚所对应的，在硬件上的射频线接到频谱仪上，并以此用作上升沿检测信号trigger，并将RU的发射端天线口出来的信号，通过射频线接到频谱仪的信号输入口，用频谱仪去测量AU加RU的系统的下行固有时延，频谱仪显示的时延值toffset就是AU和RU的下行的固有时延，同时需要将此值减去步骤一中AU下行的系统固有时延t_au_dl，再减去步骤二中的光纤时延t_fiber，即得到RU下行的系统固有时延t_ru_dl。步骤六、计算RU上行链路的系统固有时延t_ru_ul。将RU用光纤回环，将RU的10msNR无线帧帧头信号接到FPGA的管脚上，将此管脚所对应的，在硬件上的射频线接到频谱仪上，并将RU的发射端天线口出来的信号，并以此用作上升沿检测信号trigger，并将RU的发射端天线口出来的信号，通过射频线接到频谱仪的信号输入口，用频谱仪去测量RU的上下行固有时延，频谱仪显示的时延值toffset就是RU的上下行固有时延，将此值减去步骤五中RU下行的系统固有时延值t_ru_dl，再减去步骤二中的光纤时延的两倍，则得到了RU上行的系统固有时延t_ru_ul。需要注意的是，在步骤二中算出的光纤时延t_fiber是单程的，由于将RU回环，此时需要将光纤时延值翻倍。步骤七、将RU的上下行链路的系统固有时延对齐。由于RU系统的上下行架构不完全相同，从硬件角度，例如在上行接收方向有低噪声放大器器件，在下行发射方向有功率放大器器件；从功能角度，在下行发射方向需要实现削峰功能和非线性预失真功能。所以RUU的上下行系统的固有时延不相同，发射方向的固有时延一般比接收方向的固有时延要大，为了保持系统上下行时延的一致性，将系统的上下行时延调节对齐。步骤八、在RU中，根据数据相对于空口的位置关系，将10msNR无线帧帧头，调节至和数据的起始位置对齐的位置。由于在AU和RU的系统中，如果在进AU天线口时，空口，10msNR无线帧和数据是对齐的，10msNR无线帧帧头和数据的位置关系是，在AU的射频链路和数字链路中，数据产生了时延，而帧头的位置不变，在光纤中数据和帧头一起在传输，时延都在发生变化，但是两者的相对位置不产生变化。在RU的射频链路和数字链路中，数据产生了时延，而帧头的位置不变，所以信号从RU的天线口出来时，10msNR无线帧帧头相对于空口，落后了光纤时延，数据相对于空口落后了，AU和RU下行的系统固有时延和光纤时延的总和，而数据落后于10msNR无线帧帧头，AU和RU下行的系统固有时延，需要将10msNR无线帧帧头，延后AU和RU下行的系统固有时延值。当数据相对于空口被提前发射时，则需要将10msNR无线帧帧头，延后AU和RU下行的系统固有时延值，加上提前发射的时间长度值；当数据相对于空口被滞后发射时，则需要将10msNR无线帧帧头，延后AU和RU下行的系统固有时延值，减去提前发射的时间长度值。步骤九、验证特殊时隙中，下行数据和上行数据，是否相互干扰。在短光纤情况下，由于手机终端UE发信号是提前空口13.04us发射，所以在时分复用TDD模式下，下行信号的末尾以及上行信号的开头存在重叠可能性，在特殊时隙S时隙中，保护间隔gap的时间长度，决定了直放站系统的光纤时延值和固有时延最大值，需要满足的条件是，13.04us+光纤时延+直放站系统的固有时延＜gap的时间长度，检测此条件，当条件不成立时，输出高电平，触发告警提示灯。在长光纤的情况下，UE需要更加提前于空口把信号发出来，也就是意味着光纤越长，带来的时延也就越大，在gap中的下行信号的末尾以及上行信号的开头越可能存在重叠的现象，同样，需要满足的条件是，13.04us+光纤时延+直放站系统的固有时延＜gap的时间长度，检测此条件，当条件不成立时，输出高电平，触发告警提示灯。以上所述的实施方式，并不构成对该技术方案保护范围的限定。任何在上述实施方式的精神和原则之内所作的修改、等同替换和改进等，均应包含在该技术方案的保护范围之内。
