标题title
一种CAN通讯终端电阻的自动配置方法及其电路
摘要abst
本发明公开了一种CAN通讯终端电阻的自动配置方法及其电路，计算CAN通讯电缆的阻抗Rw，基于所述CAN通讯电缆的阻抗Rw匹配等效终端电阻，其中，所述等效终端电阻＝所述CAN通讯电缆的阻抗Rw或等效终端电阻≈所述CAN通讯电缆的阻抗Rw；本发明有效解决了CAN通讯现场由于终端电阻和线缆阻抗不匹配造成的工程实际问题，提高了CAN通讯的可靠性和稳定性。
权利要求书clms
1.一种CAN通讯终端电阻的自动配置方法，其特征在于，计算CAN通讯电缆的阻抗Rw，基于所述CAN通讯电缆的阻抗Rw匹配等效终端电阻，其中，所述等效终端电阻＝所述CAN通讯电缆的阻抗Rw或等效终端电阻≈所述CAN通讯电缆的阻抗Rw。2.根据权利要求1所述CAN通讯终端电阻的自动配置方法，其特征在于，所述CAN通讯电缆的阻抗Rw的计算方法包括如下操作步骤：S10)、建立CAN通讯电缆和负载阻抗RL的等效电路，在该等效电路中的稳态条件下，其中，Uin为CAN通讯的源端差动输出电压，Uout为CAN通讯的负载端电压，RL为负载阻抗；S20)、在确保CAN通讯总线保持显性状态下,将负载阻抗RL设置为第一数值RL1，由此计算出第一CAN通讯的负载端电压Uout1；S30)、在确保CAN通讯总线保持显性状态下,将负载阻抗RL设置为第二数值RL2，由此计算出第二CAN通讯的负载端电压Uout2；S40)、基于以下公式：计算得到所述CAN通讯电缆的阻抗Rw。3.根据权利要求2所述CAN通讯终端电阻的自动配置方法，其特征在于，所述第二数值RL2大于所述第一数值R1，且所述第二数值RL2是所述第一数值R1的倍数。4.根据权利要求3所述CAN通讯终端电阻的自动配置方法，其特征在于，所述第一数值RL1＝60Ω，且所述第二数值RL2＝120Ω。5.根据权利要求1所述CAN通讯终端电阻的自动配置方法，其特征在于，通过在CAN通讯设置终端电阻矩阵模块，其中，匹配等效终端电阻的过程为：以等效终端电阻＝所述CAN通讯电缆的阻抗Rw或等效终端电阻≈所述CAN通讯电缆的阻抗Rw为配置原则，确定所述等效终端电阻，并由所述终端电阻矩阵模块输出该等效终端电阻。6.一种CAN通讯终端电阻的自动配置电路，其特征在于，采用如权利要求1-5之一所述CAN通讯终端电阻的自动配置方法；其中，所述自动配置电路包括终端电阻矩阵模块、CAN通讯接口模块、电压采样模块和MCU模块；所述终端电阻矩阵模块连接在CAN通讯信号输入端与CAN通讯接口模块之间；所述MCU模块与所述CAN通讯接口模块控制连接；所述电压采样模块连接在所述终端电阻矩阵模块的输出端与所述MCU模块之间，用于采集CAN通讯负载端电压并发送给所述MCU模块。7.根据权利要求6所述CAN通讯终端电阻的自动配置电路，其特征在于，所述终端电阻矩阵模块分别与CAN通讯信号的第一输入端和第二输入端连接；其中，所述终端电阻矩阵模块包括连接在第一输入端和第二输入端之间的多个开关管，各开关管对应连接电阻，通过各开关管对与其对应电阻的选择性接通来实现终端电阻矩阵模块的多种负载电阻状态,进而实现对CAN通讯信号的第一输入端和第二输入端之间电压差信号的动态调节。8.根据权利要求7所述CAN通讯终端电阻的自动配置电路，其特征在于，所述终端电阻矩阵模块包括零号开关管、第一开关管、第二开关管、第三开关管、第四开关管、第五开关管、第六开关管、第七开关管和第八开关管；其中，第一开关管、第二开关管、第三开关管、第四开关管、第五开关管、第六开关管、第七开关管和第八开关管分别对应连接有第一电阻、第二电阻、第三电阻、第四电阻、第五电阻、第六电阻、第七电阻和第八电阻，用于控制对应电阻的选择性接通；所述零号开关管与第二输入端连接；所述第一开关管与第二开关管依次连接在第一输入端与零号开关管之间；所述第三开关管与第四开关管依次连接在第一输入端与零号开关管之间；所述第五开关管与第六开关管依次连接在第一输入端与零号开关管之间；所述第七开关管与第八开关管依次连接在第一输入端与零号开关管之间。9.根据权利要求8所述CAN通讯终端电阻的自动配置电路，其特征在于，第一电阻、第二电阻、第三电阻、第四电阻、第五电阻、第六电阻、第七电阻和第八电阻均为120Ω；通过零号开关管、第一开关管、第二开关管、第三开关管、第四开关管、第五开关管、第六开关管、第七开关管和第八开关管的联动组合，实现240Ω、180Ω、160Ω、150Ω、120Ω、100Ω、90Ω、80Ω、70Ω、60Ω和无负载电阻的11个负载电阻状态。10.根据权利要求6所述CAN通讯终端电阻的自动配置电路，其特征在于，所述CAN通讯接口模块将所述终端电阻矩阵模块输出的CAN通讯信号转换为CAN通讯数据模拟信号，并与所述MCU模块进行双向通信连接。
说明书desc
技术领域本发明属于CAN通讯技术领域，具体涉及一种CAN通讯终端电阻的自动配置方法及其电路。背景技术CAN总线通信是一种具有高可靠性、实时性强、传输距离远的双线串行通信网络，检错能力强，在汽车中控系统、船舶控制系统等领域广泛使用。CAN能够使用多种物理介质，例如双绞线、同轴电缆、光纤等。最常用的是双绞线，信号使用差分电压传送，两条信号线被称为CAN_H与CAN_L，静态时两线之间的差分电平约为0，此时状态表示为逻辑1，称为隐性；用CAN_H比CAN_L高表示逻辑0，称为显性。通常来说，基于传输线理论，当负载端阻抗与传输线阻抗不匹配时，即当RL≠Z0时，一部分信号将在负载端沿着传输线反射回源端。反射的大小可以用负载反射系数ρL来衡量，反射系数定义为该反射节点上的反射电压与入射电压的比值，即下式所示：式中:RL为负载阻抗；Z0为传输线的特性阻抗。从上式中可以看出，要想消除反射，可以通过端接匹配电阻的方法，即保证ρL＝0即可。由于双绞线特征阻抗约为120Ω，即Z0≈120Ω。因此，为了避免信号反射影响，CAN协议约定在总线终端上跨接一个120Ω的终端电阻保持阻抗连续，即RL＝120Ω，使得ρL≈0；理论上认为信号反射几乎被消除。然而本申请人在实际工程应用中，由于CAN通讯线缆的长度、线缆材质等方面均有较大差别，通讯线缆阻抗差异较大，现有技术将其终端电阻简单地固定设置为120Ω，无法确保ρL≠0，导致CAN通讯信号仍然存在较大反射风险，对CAN通讯的可靠性和稳定性带来一定隐患。为此，本申请人希望寻求技术方案对以上技术问题进行改进。发明内容有鉴于此，本发明的目的在于提出一种CAN通讯终端电阻的自动配置方法及其电路，有效解决了CAN通讯现场由于终端电阻和线缆阻抗不匹配造成的工程实际问题，提高了CAN通讯的可靠性和稳定性。为此，本发明采用的技术方案如下：一种CAN通讯终端电阻的自动配置方法，计算CAN通讯电缆的阻抗Rw，基于所述CAN通讯电缆的阻抗Rw匹配等效终端电阻，其中，所述等效终端电阻＝所述CAN通讯电缆的阻抗Rw或等效终端电阻≈所述CAN通讯电缆的阻抗Rw。优选地，所述CAN通讯电缆的阻抗Rw的计算方法包括如下操作步骤：S10)、建立CAN通讯电缆和负载阻抗RL的等效电路，在该等效电路中的稳态条件下，其中，Uin为CAN通讯的源端差动输出电压，Uout为CAN通讯的负载端电压，RL为负载阻抗；S20)、在确保CAN通讯总线保持显性状态下,将负载阻抗RL设置为第一数值RL1，由此计算出第一CAN通讯的负载端电压Uout1；S30)、在确保CAN通讯总线保持显性状态下,将负载阻抗RL设置为第二数值RL2，由此计算出第二CAN通讯的负载端电压Uout2；S40)、基于以下公式：计算得到所述CAN通讯电缆的阻抗Rw。优选地，所述第二数值RL2大于所述第一数值R1，且所述第二数值RL2是所述第一数值R1的倍数。优选地，所述第一数值RL1＝60Ω，且所述第二数值RL2＝120Ω。优选地，通过在CAN通讯设置终端电阻矩阵模块，其中，匹配等效终端电阻的过程为：以等效终端电阻＝所述CAN通讯电缆的阻抗Rw或等效终端电阻≈所述CAN通讯电缆的阻抗Rw为配置原则，确定所述等效终端电阻，并由所述终端电阻矩阵模块输出该等效终端电阻。优选地，一种CAN通讯终端电阻的自动配置电路，采用如上所述CAN通讯终端电阻的自动配置方法；其中，所述自动配置电路包括终端电阻矩阵模块、CAN通讯接口模块、电压采样模块和MCU模块；所述终端电阻矩阵模块连接在CAN通讯信号输入端与CAN通讯接口模块之间；所述MCU模块与所述CAN通讯接口模块控制连接；所述电压采样模块连接在所述终端电阻矩阵模块的输出端与所述MCU模块之间，用于采集CAN通讯负载端电压并发送给所述MCU模块。优选地，所述终端电阻矩阵模块分别与CAN通讯信号的第一输入端和第二输入端连接；其中，所述终端电阻矩阵模块包括连接在第一输入端和第二输入端之间的多个开关管，各开关管对应连接电阻，通过各开关管对与其对应电阻的选择性接通来实现终端电阻矩阵模块的多种负载电阻状态,进而实现对CAN通讯信号的第一输入端和第二输入端之间电压差信号的动态调节。优选地，所述终端电阻矩阵模块包括零号开关管、第一开关管、第二开关管、第三开关管、第四开关管、第五开关管、第六开关管、第七开关管和第八开关管；其中，第一开关管、第二开关管、第三开关管、第四开关管、第五开关管、第六开关管、第七开关管和第八开关管分别对应连接有第一电阻、第二电阻、第三电阻、第四电阻、第五电阻、第六电阻、第七电阻和第八电阻，用于控制对应电阻的选择性接通；所述零号开关管与第二输入端连接；所述第一开关管与第二开关管依次连接在第一输入端与零号开关管之间；所述第三开关管与第四开关管依次连接在第一输入端与零号开关管之间；所述第五开关管与第六开关管依次连接在第一输入端与零号开关管之间；所述第七开关管与第八开关管依次连接在第一输入端与零号开关管之间。优选地，第一电阻、第二电阻、第三电阻、第四电阻、第五电阻、第六电阻、第七电阻和第八电阻均为120Ω；通过零号开关管、第一开关管、第二开关管、第三开关管、第四开关管、第五开关管、第六开关管、第七开关管和第八开关管的联动组合，实现240Ω、180Ω、160Ω、150Ω、120Ω、100Ω、90Ω、80Ω、70Ω、60Ω和无负载电阻的11个负载电阻状态。优选地，所述CAN通讯接口模块将所述终端电阻矩阵模块输出的CAN通讯信号转换为CAN通讯数据模拟信号，并与所述MCU模块进行双向通信连接。本发明通过计算CAN通讯电缆的阻抗Rw，专门开发了自动计算CAN通讯电缆的阻抗Rw的方法，然后根据计算得到的CAN通讯电缆的阻抗Rw匹配等效终端电阻，使得负载反射系数ρL＝0或≈0，可靠保障了消除或基本消除CAN通讯的反射问题，通过本申请提出的创新方案有效解决了CAN通讯现场由于终端电阻和线缆阻抗不匹配造成的工程实际问题，提高了CAN通讯的可靠性和稳定性；本发明还开发了CAN通讯终端电阻的自动配置电路，通过终端电阻矩阵模块来输出多种负载电阻状态,进而实现对CAN通讯信号的第一输入端和第二输入端之间电压差信号的动态调节，保障载反射系数ρL＝0或≈0；且本申请提供的自动配置电路结构简单可靠，非常适合在工程现场中进行规模应用。附图说明图1是本申请具体实施方式下CAN通讯电缆和负载阻抗RL的等效电路图；图2是本申请具体实施方式下CAN通讯终端电阻的自动配置电路图。具体实施方式本发明实施例公开了一种CAN通讯终端电阻的自动配置方法，计算CAN通讯电缆的阻抗Rw，基于CAN通讯电缆的阻抗Rw匹配等效终端电阻，其中，等效终端电阻＝CAN通讯电缆的阻抗Rw或等效终端电阻≈CAN通讯电缆的阻抗Rw。为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明中记载的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。本实施例提出一种CAN通讯终端电阻的自动配置方法，计算CAN通讯电缆的阻抗Rw，基于CAN通讯电缆的阻抗Rw匹配等效终端电阻，其中，等效终端电阻＝CAN通讯电缆的阻抗Rw或等效终端电阻≈CAN通讯电缆的阻抗Rw。优选地，在本实施方式中，CAN通讯电缆的阻抗Rw的计算方法包括如下操作步骤：S10)、请参见图1所示，建立CAN通讯电缆和负载阻抗RL的等效电路，在该等效电路中的稳态条件下，等效电路具有以下公式的推导过程：最终可以得到：其中，CAN_H为CAN通讯信号的第一输入端，CAN_L为CAN通讯信号的第二输入端，Uin为CAN通讯的源端差动输出电压，Uout为CAN通讯的负载端电压，Rin为源端阻抗，RL为负载阻抗，Rw为通讯线缆的阻抗；Uin为CAN通讯源端差动输出电压，Uout为CAN通讯负载端电压；S20)、在确保CAN通讯总线保持显性状态下,将负载阻抗RL设置为第一数值RL1，由此计算出第一CAN通讯的负载端电压Uout1；S30)、在确保CAN通讯总线保持显性状态下,将负载阻抗RL设置为第二数值RL2，由此计算出第二CAN通讯的负载端电压Uout2；进一步优选地，为了提高自动计算效率，在本实施方式中，第二数值RL2大于第一数值R1，且第二数值RL2是第一数值R1的倍数；具体优选地，在本实施方式中，第一数值RL1＝60Ω，且第二数值RL2＝120Ω；S40)、基于以下公式：计算得到CAN通讯电缆的阻抗Rw，本实施例的具体计算过程如下：通过已知测得的Uout1和Uout2，即可计算得到CAN通讯电缆的阻抗Rw。优选地，为了快速精准地匹配等效终端电阻，在本实施方式中，通过在CAN通讯设置终端电阻矩阵模块，其中，匹配等效终端电阻的过程为：以等效终端电阻＝CAN通讯电缆的阻抗Rw或等效终端电阻≈CAN通讯电缆的阻抗Rw为配置原则，确定等效终端电阻，并由终端电阻矩阵模块输出该等效终端电阻。优选地，请参见图2所示，一种CAN通讯终端电阻的自动配置电路，采用如上所述CAN通讯终端电阻的自动配置方法；其中，自动配置电路包括终端电阻矩阵模块1、CAN通讯接口模块2、电压采样模块3和MCU模块4；终端电阻矩阵模块1连接在CAN通讯信号输入端与CAN通讯接口模块2之间；MCU模块4与CAN通讯接口模块2控制连接；电压采样模块3连接在终端电阻矩阵模块1的电压输出端U+,U-与MCU模块4之间，用于采集CAN通讯负载端电压Uout并发送给MCU模块4。优选地，终端电阻矩阵模块1分别与CAN通讯信号的第一输入端CAN_H和第二输入端CAN_L连接；其中，终端电阻矩阵模块1包括连接在第一输入端CAN_H和第二输入端CAN_L之间的多个开关管，各开关管对应连接电阻，通过各开关管对与其对应电阻的选择性接通来实现终端电阻矩阵模块1的多种负载电阻状态,进而实现对CAN通讯信号的第一输入端CAN_H和第二输入端CAN_L之间电压差信号的动态调节。优选地，终端电阻矩阵模块1包括零号开关管Q0、第一开关管Q1、第二开关管Q2、第三开关管Q3、第四开关管Q4、第五开关管Q5、第六开关管Q6、第七开关管Q7和第八开关管Q8；其中，第一开关管Q1、第二开关管Q2、第三开关管Q3、第四开关管Q4、第五开关管Q5、第六开关管Q6、第七开关管Q7和第八开关管Q8分别对应连接有第一电阻RL1、第二电阻RL2、第三电阻RL3、第四电阻RL4、第五电阻RL5、第六电阻RL6、第七电阻RL7和第八电阻RL8，用于控制对应电阻的选择性接通；零号开关管Q0与第二输入端CAN_L连接；第一开关管Q1与第二开关管Q2依次连接在第一输入端CAN_H与零号开关管Q0之间；第三开关管Q3与第四开关管Q4依次连接在第一输入端CAN_H与零号开关管Q0之间；第五开关管Q5与第六开关管Q6依次连接在第一输入端CAN_H与零号开关管Q0之间；第七开关管Q7与第八开关管Q8依次连接在第一输入端CAN_H与零号开关管Q0之间。优选地，第一电阻RL1、第二电阻RL2、第三电阻RL3、第四电阻RL4、第五电阻RL5、第六电阻RL6、第七电阻RL7和第八电阻RL8均为120Ω；通过零号开关管Q0、第一开关管Q1、第二开关管Q2、第三开关管Q3、第四开关管Q4、第五开关管Q5、第六开关管Q6、第七开关管Q7和第八开关管Q8的联动组合，实现240Ω、180Ω、160Ω、150Ω、120Ω、100Ω、90Ω、80Ω、70Ω、60Ω和无负载电阻的11个负载电阻状态。优选地，在本实施方式中，CAN通讯接口模块2将终端电阻矩阵模块1输出的CAN通讯信号转换为CAN通讯数据模拟信号CAN_RXD和CAN_TXD，并与MCU模块4进行双向通信连接，实现双向数据交换。本实施例通过以上实施方案确保将负载反射系数ρL＝0或≈0，可靠保障了消除或基本消除CAN通讯的反射问题，有效解决了CAN通讯现场由于终端电阻和线缆阻抗不匹配造成的工程实际问题，提高了CAN通讯的可靠性和稳定性。对于本领域技术人员而言，显然本发明不限于上述示范性实施例的细节，而且在不背离本发明的精神或基本特征的情况下，能够以其他的具体形式实现本发明。因此，无论从哪一点来看，均应将实施例看作是示范性的，而且是非限制性的，本发明的范围由所附权利要求而不是上述说明限定，因此旨在将落在权利要求的等同要件的含义和范围内的所有变化囊括在本发明内。不应将权利要求中的任何附图标记视为限制所涉及的权利要求。此外，应当理解，虽然本说明书按照实施方式加以描述，但并非每个实施方式仅包含一个独立的技术方案，说明书的这种叙述方式仅仅是为清楚起见，本领域技术人员应当将说明书作为一个整体，各实施例中的技术方案也可以经适当组合，形成本领域技术人员可以理解的其他实施方式。
