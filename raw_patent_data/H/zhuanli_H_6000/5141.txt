标题title
基于Modbus的混合气体自动生成采集系统及方法
摘要abst
本发明公开了一种基于Modbus的混合气体自动生成采集系统及方法，其中，上位机通过总线与流量部和传感部分别连接；流量部包括电源和流量计组，电源为流量计组供电；传感部包括气体传感器和电路采集板；外设部包括气体气缸、混气缸和废气处理装置；气体气缸将若干路气体接入流量计组的进气口，流量计组的出气口接入混气缸的进气口，混气缸的出气口连接气体传感器，气体传感器的输出采集信号给电路采集板，电路采集板的输出连接上位机，经过气体传感器的气体排出到废气处理装置。本发明实现手动和自动双操作，在自动操作时，规避了手动操作的误点，有效的防止了误操作。
权利要求书clms
1.一种基于Modbus的混合气体自动生成采集系统，其特征在于，包括上位机、流量部、传感部和外设部，其中，所述上位机通过总线与流量部和传感部分别连接；所述流量部包括电源和流量计组，电源为流量计组供电；所述传感部包括气体传感器和电路采集板；所述外设部包括气体气缸、混气缸和废气处理装置；其中，气体气缸将若干路气体接入流量计组的进气口，流量计组的出气口接入混气缸的进气口，混气缸的出气口连接气体传感器，气体传感器的输出采集信号给电路采集板，电路采集板的输出连接上位机，经过气体传感器的气体排出到废气处理装置。2.根据权利要求1所述的一种基于Modbus的混合气体自动生成采集系统，其特征在于，所述总线为485总线。3.根据权利要求1所述的一种基于Modbus的混合气体自动生成采集系统，其特征在于，所述气体气缸包括5路。4.根据权利要求1所述的一种基于Modbus的混合气体自动生成采集系统，其特征在于，系统的通信协议采用Modbus的RTU通信。5.根据权利要求4所述的一种基于Modbus的混合气体自动生成采集系统，其特征在于，所述通信协议的通信参数为：波特率9600，从机地址位一个字节，功能码一个字节，寄存器地址两个字节，数据位两个字节，CRC校验位2字节。6.根据权利要求1所述的一种基于Modbus的混合气体自动生成采集系统，其特征在于，所述外设部还包括温控仪。7.根据权利要求1所述的一种基于Modbus的混合气体自动生成采集系统，其特征在于，所述外设部还包括气体温升腔。8.一种基于Modbus的混合气体自动生成采集方法，其特征在于，采用权利要求1-7之一所述的系统，包括以下步骤：S1，上位机通过485总线按照Modbus协议向流量部和传感部发送命令，进行上传下达；S2，气体流向流量计组，流量计组中的各个流量计根据收到上位机发送的流速指令，打开阀门，控制流速，同时流量计也会通过总线返回一个指令给上位机确认是否发送成功，气体再进入混气缸进行充分混合，以达到混合气体效果；S3，混气完成后，气体再流入气体传感器，气体传感器检测到气体后，发生氧化还原反应，产生电流，后经电路采集板的AD电压采集，通过总线传输到上位机；S4，气体流经气体传感器后，再流入废气处理装置进行废气处理。9.根据权利要求8所述的方法，其特征在于，开启工作后，流量计组自动发送500sccm空气。10.根据权利要求8所述的方法，其特征在于，将所需的流量提前写入一个文本文档中，文档中按气体顺序写，每种气体用制表符隔开，结尾和开头无空行。
说明书desc
技术领域本发明属于混气检测控制领域，特别涉及一种基于Modbus的混合气体自动生成采集系统及方法。背景技术近年来，气体传感器阵列检测气体备受关注，特别是在对混合气体的识别。要识别混合气体的成分浓度，需要设计专门的识别算法，无论是何种算法，都需要大量的训练样本进行有监督学习。本发明就是要解决混合气体的生成和测试问题，以便采集大量的测试气体数据用于后继的算法开发，原先这种前期数据准备是采用人工方式通气和记录数据来完成的，而人工采集在通混合气体的时候往往不能达到同步，需要大量的人力成本，且不能保证准确性。现有技术中人工采集与自动化采集相比：现有的人工采集，在对多路混合气体手动设定流量的时间一般都在 30秒以上，由于手工调节的原因，在采集数据时不能保证同时性，而自动化采集设定多路气体只需要1秒，很好地保证了同时性；手动采集一个混气样品需要的时间很难统一，由于人工采集只能通过计时和经验法来判断是否结束采集，这使得每一次采集的数据长短不一，造成了数据不同步，自动采集很好地解决了这一问题，具有定时功能，能保证每一次采集的数据长短一样，时间一样，并且时长可以进行调节设置；手动采集从设定流量-开始采集-结束采集-保存数据这样一个完整的过程需要的时间是3-5分钟，其中在设定流量会占用30秒左右，保存数据会占用15秒左右，这就导致了每一次在采集上的时间都不一样，在后续对采集的数据分析时会出现长短不一，数据不全的情况。但是把这一套流程交给机器来做就极大的避免了这种情况。自动化机器每一次设定流量的时间是1秒，保存文件的时间基本可以忽略不计，并且采集时间还可以通过定时设置，保证了每一个采集都是同时长的。发明内容有鉴于此，本发明为了混合气体成分浓度估计的应用中获取测试数据采集费时费力的痛点，提供了一种基于Modbus的混合气体自动生成采集系统，包括上位机、流量部、传感部和外设部，其中，所述上位机通过总线与流量部和传感部分别连接；所述流量部包括电源和流量计组，电源为流量计组供电；所述传感部包括气体传感器和电路采集板；所述外设部包括气体气缸、混气缸和废气处理装置；其中，气体气缸将若干路气体接入流量计组的进气口，流量计组的出气口接入混气缸的进气口，混气缸的出气口连接气体传感器，气体传感器的输出采集信号给电路采集板，电路采集板的输出连接上位机，经过气体传感器的气体排出到废气处理装置。优选地，所述总线为485总线。优选地，所述气体气缸包括5路。优选地，系统的通信协议采用Modbus的RTU通信。优选地，所述通信协议的通信参数为：波特率9600，从机地址位一个字节，功能码一个字节，寄存器地址两个字节，数据位两个字节，CRC校验位2字节。优选地，所述外设部还包括温控仪。优选地，所述外设部还包括气体温升腔。基于上述目的，本发明还提供了一种基于Modbus的混合气体自动生成采集方法，采用上述的系统，包括以下步骤：S1，上位机通过485总线按照Modbus协议向流量部和传感部发送命令，进行上传下达；S2，气体流向流量计组，流量计组中的各个流量计根据收到上位机发送的流速指令，打开阀门，控制流速，同时流量计也会通过总线返回一个指令给上位机确认是否发送成功，气体再进入混气缸进行充分混合，以达到混合气体效果；S3，混气完成后，气体再流入气体传感器，气体传感器检测到气体后，发生氧化还原反应，产生电流，后经电路采集板的AD电压采集，通过总线传输到上位机；S4，气体流经气体传感器后，再流入废气处理装置进行废气处理。优选地，开启工作后，流量计组自动发送500sccm空气。优选地，将所需的流量提前写入一个文本文档中，文档中按气体顺序写，每种气体用制表符隔开，结尾和开头无空行。有益效果：本发明可以实现手动和自动双操作，在自动操作时，规避了手动操作的误点，有效的防止了误操作。并且本系统具有跨平台性，便携性，准确性，实时性，并且可以根据厂商的不同要求更改配置，以达到厂家要求。在硬件平台搭好后，安装该系统APP，选择正确的串口，打开提前写好的流量文本文档即可实现24小时无人看管自动采集。大大的节约了人力成本，且减少了人工出错率。附图说明图1为本发明实施例基于Modbus的混合气体自动生成采集系统的结构框图；图2为本发明实施例基于Modbus的混合气体自动生成采集系统的上位机界面图；图3为本发明实施例基于Modbus的混合气体自动生成采集方法的流量文本文档规格图。具体实施方式下面将结合附图，对本发明的优选实施例进行详细的描述。系统实施例参见图1，包括上位机10、流量部20、传感部30和外设部40，其中，上位机10通过485总线与流量部20和传感部30分别连接；流量部20包括电源21和流量计组22，电源21为流量计组22供电；传感部30包括气体传感器31和电路采集板32；外设部40包括气体气缸41、混气缸42和废气处理装置43；其中，气体气缸41将若干路气体接入流量计组22的进气口，流量计组22 的出气口接入混气缸42的进气口，混气缸42的出气口连接气体传感器31，气体传感器31的输出采集信号给电路采集板32，电路采集板32的输出连接上位机10，经过气体传感器31的气体排出到废气处理装置43。流量计组22和气体传感器31与外设部40之间的连接均通过气管。系统的通信协议采用Modbus的RTU通信，通信协议的通信参数为：波特率9600，从机地址位一个字节，功能码一个字节，寄存器地址两个字节，数据位两个字节，CRC校验位2字节，具体参见表1。表1通信参数从机地址功能码寄存器地址数据CRC校验1字节1字节2字节2字节2字节 外设部40还包括温控仪或气体温升腔或其他需要的外设。本发明还提供了一种基于Modbus的混合气体自动生成采集方法，采用上述的系统，包括以下步骤：S1，上位机通过485总线按照Modbus协议向流量部和传感部发送命令，进行上传下达；S2，气体流向流量计组，流量计组中的各个流量计根据收到上位机发送的流速指令，打开阀门，控制流速，同时流量计也会通过总线返回一个指令给上位机确认是否发送成功，气体再进入混气缸进行充分混合，以达到混合气体效果；S3，混气完成后，气体再流入气体传感器，气体传感器检测到气体后，发生氧化还原反应，产生电流，后经电路采集板的AD电压采集，通过总线传输到上位机；S4，气体流经气体传感器后，再流入废气处理装置进行废气处理。参见图2，自动采集界面分两部分，左边部分为流量计部分，主要负责对流量计的上传下达，完成对流量的控制。右边部分是传感器部分，负责把AD 采集到的数据进行显示和保存。界面中各字母表示：A：串口选择；B：指示灯；C：设定流量；D：当前流量，上位机会一直监测流量计实时显示；E：单个发送，发送对应气体的设定流量给流量计控制器；F：设定读取，控制器接收到命令返回的数据，验证上位机是否成功发送命令；G:整体发送，一次性将所有气体的设定流量发送；H:文件路径，显示提前写好的流量文本路径，方便后续读取文件；I:自动发送数据框，勾选后才能实现自动发送，方便实现自动和手动两种模式；J:定时，单位为秒，设定定时发送；K:打开文件，从上位机内存中打开提前写好的文本文件；L:自动按钮，点击此按钮，开始自动采集，若没有设置自动发送框，则会弹出提示框提醒勾选，按下此按钮后，单个发送和整体发送按钮失效；M:传感器接收区，传感器采集到数据，通过总线传输到上位机并显示；N:自动保存数据，设置此框，在定时时间到会自动把接收区内容保存到上位机文件中；O:清空按钮，点击清空接收区内容；P:保存文件，在手动情况下，保存接收区内容；在两部分线连接正常的情况下，选择正确的串口A，点击打开串口按钮，如果串口等信息正确，指示灯B亮，如果配置信息错误，会弹出错误窗口提示。打开串口后，流量计部分会自动发送500sccm空气，目的是保证每次在开启时可以经过纯净空气将气路进行洗涤。设置流量C部分是输入流速，为了防止输错，此部分做了限制，只能输入数字，不可以输入字符等不正规输入。当前流量D是界面在实时监测流量计，数字随流量计流量改变而变，这在串口打开的时候就会自动触发，直到软件关闭或者串口关闭。单个发送E只能发送当前气体流速给控制器，相比较整体发送G而言，单个是按需发送气体，整体是全体发送。当对某一种气体没有设置时，默认为0。例如：现在要获取四路气体的混合气体测试数据，则需要5路气体，除了4种待测气体，还有一种零气，用于调配混合气体的比例。比如发送空气200流量，CO、NO2、SO2和甲醛分别100、100、50和50的流量，则在设定流量各自对应的区域分别填上200,100,100,50,50。如需单个发送，则分别点击单个发送按钮，如需整体发送，则只需要点击整体发送按钮。发送后，当前流量显示列会逐渐变成和设定值相同或在设定值附近跳动，如果长时间没有达到设定值，则检查气瓶气体是否打开。设定读取F列会显示和设定值一样，如果不一样，则表示控制器没有收到设定值的命令，此时需要重新发送一遍命令。设定读取F是在设置好流量发送给控制器时，控制器收到了做出的答复。控制器会返回发送设置的流量，用于检验发送的指令是否被正确被执行。设定读取F在气体全部打开的情况下与设定流量相同，若不同则控制器没有接收到命令，需要重新发送命令。文件路径H、自动发送I、定时J、打开文件K、自动按钮L是在自动采集时配套使用的。参见图3，将所需的流量提前写入一个文本文档中，文档中需要按界面上气体顺序写，每种气体用制表符隔开，结尾和开头不可以有空行。若要实行自动采集，一定要设置自动采集框I，否则将不会自动发送流量，设置自动框的目的是为了防止操作误点。打开文件按钮选择需要打开的文本文件，文件路径会显示此文件的保存位置。定时按钮可以设置时间间隔发送一次流量，单位为秒。点击自动按钮，开始自动读取文件内容并且发送。当点击自动按钮后，为了防止在自动情况下出现手动误操作，在此设定了强制逻辑：一旦点击自动按钮，单个发送和整体发送按钮不再生效，这能很好地避免人为更改流量。为了保护自动发送不会受干扰，在此做了规定约束：点击自动发送后，单个发生和整体发送将失效。例如，现在要自动发送如图1的文本中流速：首先打开文件，找到此文本文档的保存位置，确定后文件路径会显示保存路径，再勾选自动发送框，设置定时10秒，最后点击自动按钮，则此时设定流量区域会一次显示264、0、148、 0、88。当前流量区域会在很短时间内达264、0、148、0、88到或在此区间浮动，设定读取也一定是264、0、148、0、88。但是单个发送和整体发送都已失效变灰，即使点击也无用。当定时十秒后，设定区域会变成462、0、0、0、38，当前流量和设定读取区域也会发生相应的变化。当整个文本的内容都发送完成后，会发送一个全0指令，即发送0、0、0、0、0，此时单个发送和整体发送有效，可以点击。流量计自动部分配合传感器部分可以达到自动保存的效果。传感部接收区用于接收AD采集到的数据并显示，此区域在串口打开后就开始自动监测，有数据就显示，直到软件关闭或串口关闭停止。当设置了自动保存数据框时，接收区所收到的数据，会自动保存在默认路径文件中。文件名是所测混合气体中各气体浓度。清空按钮则对接收区进行清空。保存文件按钮是独立于自动化的，可以进行手动保存，在不需要自动发送功能的时候使用。在流量计开启自动功能后，只需要设置传感器部分的自动保存数据框，则接收区就会在预设的时长达到后保存接收的所有数据，并且清空进行下一次的接收保存。如果不设置自动保存则视为手动，可以点击保存文件进行手动保存，并且点击清空可以进行手动清空。以上仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的精神和原则之内所作的任何修改、等同替换和改进等，均应包含在本发明的保护范围之内。
