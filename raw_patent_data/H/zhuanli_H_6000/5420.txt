标题title
O-RU设备电源掉电信息存储与上报方法及系统
摘要abst
本发明提供了O‑RU设备电源掉电信息存储与上报方法及系统，包括：S1、持续进行掉电监控，并定期记录当前工作状态信息；S2、监控到电源掉电时，在内存中暂存电源掉电告警信息；若掉电及时恢复，进入S3，若持续掉电，进入S4；S3、将内存中暂存的电源掉电告警信息写入NORFLASH中，并产生掉电告警产生消息和掉电告警消失消息，上报后进入S1；S4、设备再次上电重启后，获取复位原因并向NORFLASH中，生成掉电告警产生消息和掉电告警消失消息并上报消息，进入S1。本发明在兼容现有Linux文件系统操作情况下，实现所有告警上报功能，无需因增加特殊的掉电信息记录硬件单元及掉电辅助电源而增加硬件成本。
权利要求书clms
1.O-RU设备电源掉电信息存储与上报方法，其特征在于，包括：步骤S1、设备正常工作时，持续进行掉电监控，并定期在NORFLASH文件系统中的掉电信息文件记录当前工作状态信息；步骤S2、监控到电源掉电时，在内存中暂存电源掉电告警信息；若电源掉电情况及时恢复，进入步骤S3，若电源持续掉电，则进入步骤S4；步骤S3、将内存中暂存的电源掉电告警信息写入NORFLASH文件系统中，并产生掉电告警产生消息和掉电告警消失消息，上报后进入步骤S1；步骤S4、设备再次上电重启后，获取复位原因并向NORFLASH文件系统中，生成掉电告警产生消息和掉电告警消失消息并上报消息，进入步骤S1。2.根据权利要求1所述的O-RU设备电源掉电信息存储与上报方法，其特征在于，所述掉电信息文件包括：当前工作状态：包括0和1两个状态以及记录时间，其中0为缺省值，1为正常工作；由设备定期记录；当前复位原因：包括0、1、2、3三个状态，其中0为缺省值，1为上电复位，2为软件复位，3为看门狗复位；由设备软件在重启前记录。3.根据权利要求1或2所述的O-RU设备电源掉电信息存储与上报方法，其特征在于，在O-RU设备设有硬件电路掉电保护，用于保证在设备电源掉电后为设备持续供电。4.根据权利要求1所述的O-RU设备电源掉电信息存储与上报方法，其特征在于，所述步骤S2的具体过程包括：在电源掉电发生时，关闭高功耗设备，并记录电源掉电告警产生信息，写入内存中。5.根据权利要求1所述的O-RU设备电源掉电信息存储与上报方法，其特征在于，所述步骤S2中，采用硬件中断方式触发电源掉电指示。6.根据权利要求1所述的O-RU设备电源掉电信息存储与上报方法，其特征在于，所述步骤S3的具体过程包括：步骤S3.1、将内存中暂存的电源掉电告警产生信息写入NORFLASH文件系统中；步骤S3.2、生成掉电告警产生消息，内容包括掉电告警产生事件和产生时间，并通过O-RU设备的软件Mplane平面接口上报；步骤S3.3、生成掉电告警消失消息，内容包括掉电告警消失事件和消失时间，并通过O-RU设备的软件Mplane平面接口上报；进入步骤S1。7.根据权利要求2所述的O-RU设备电源掉电信息存储与上报方法，其特征在于，所述步骤S4的具体过程包括：步骤S4.1、设备再次上电，重新启动；步骤S4.2、获取复位原因，并判断是否为硬件掉电复位，若是进入步骤S4.3，否则进入步骤S4.6；步骤S4.3、在掉电信息文件中写入当前复位原因；步骤S4.4、读取掉电信息文件中最后一次记录的时间信息，生成掉电告警产生消息，内容包括掉电告警产生事件及产生时间，其中，产生时间即为读取的时间信息；并通过O-RU设备的软件Mplane平面接口上报掉电告警产生消息；步骤S4.5、生成掉电告警产生消息，内容包括掉电告警消失事件及产生时间，其中，产生时间即为当前时间信息；并通过O-RU设备的软件Mplane平面接口上报掉电告警消失消息；进入步骤S1；步骤S4.6、上报其他复位原因，并进入步骤S1。8.根据权利要求7所述的O-RU设备电源掉电信息存储与上报方法，其特征在于，所述步骤S4.2中，复位原因由O-RU设备中CPU硬件复位原因寄存器和掉电信息文件确定。9.O-RU设备电源掉电信息存储与上报系统，其特征在于，包括CPU、输入电压监控模块、NORFLASH、内存；CPU分别与输入电压监控模块、NORFLASH与内存连接，实现权利要求1~8任一项所述的O-RU设备电源掉电信息存储与上报方法；输入电压监控模块，用于监控掉电是否产生；NORLASH，用于存储掉电信息文件以及掉电电源掉电告警信息；内存，用于暂存电源掉电告警信息。
说明书desc
技术领域本发明涉及无线接入网领域，特别涉及一种O-RU设备电源掉电信息存储与上报方法及系统。背景技术ORAN技术是无线通信网路的革命性技术，它推动了4G/5G通信网络设备从自定义、封闭式设计转向通用化、平台化与白盒化设计。O-RU设备是ORAN网路中的射频前端拉远设备，相对其它ORAN网络设备，它具有部署范围广，数量庞大的特点，由此，O-RU设备特别注重硬件平台化和白盒化设计，尽量降低设备器件成本以提高产品市场竞争力；O-RU设备中往往采用单片NORFLASH存储软件、配置、告警及各种记录信息；NORFLASH具有可靠性高、信息记录不易改变的特点，大量用于各类电子设备的程序存储。但NORFLASH芯片的擦除写入速度较慢，一般需要几十ms的时间；O-RU设备功耗较高，为节约电源模块空间和成本，设备掉电保护设计一般都较短，仅设计数毫秒的掉电保护时间。而O-RU设备的软件为追求开发速度和效率，一般采用Linux操作系统以及各种开源软件。操作系统会屏蔽底层硬件驱动, 用纯应用层软件方式操作虚拟化、逻辑化的底层硬件；以的NORFLASH为例，Linux操作系统会把NORFLASH分成若干分区，其中记录各种log信息的分区会变成文件分区。Linux操作系统以文件操作方式实时记录各种必要log信息，以便系统在掉电或重启后仍可以查询相关信息；log信息写入会通过操作系统最终转化成NORFLASH操作，先擦除NORFLASH对应sector，然后再行写入新信息；相关操作时间会大于NORFLASH的擦除写入时间，大约为几十ms。MPLANE是ORAN标准定义的ODU与O-RU之间的管理接口；O-RU软件检查到设备掉电状况后，会尝试通过MPLANE上报“power supply fault”信息，告知O-RU发生了电源故障；这一过程的时间长度为秒级；O-RU设备发生电源掉电时，期望的通用软件处理流程如图1所示，期望处理结果如下：1）掉电发生后，O-RU设备内部及时记录了掉电告警产生相关信息，并可在复位后查询到；2）掉电发生后，O-RU设备由MPLANE平面向网络中的管理者上报电源掉电告警。但该处理流程从软件原理上是可行的，但由于所述硬件条件限制，存在严重不足，基本无法实现设备电源掉电告警记录与上报功能。存在以下缺点：1）O-RU设备电源内部掉电保护时间小于10毫秒，无法支持软件告警处理与上报流程；2）NORFLASH内部sector擦除与写入时间为几十毫秒，无法实现Linux文件系统正常记录操作，本地告警信息无法记录；3）NORFLASH掉电进入异常电压区域仍在进行的擦除写入，容易导致NORFLASH内容异常，甚至丢失，设备无法启动；4）O-RU由MPLANE经网络上报告警信息的处理时间为秒级，无法实现告警正常上报；解决上述问题的通常方法为加大电源掉电保护时间，添加额外快速记录硬件部件，绕过Linux文件系统操作NORFLASH等等；这些方法均无法有效解决电源掉电遇到的上述时间问题。发明内容针对现有技术中存在的问题，提供了O-RU设备电源掉电信息存储与上报方法及系统，通过在NORFLASH文件系统与内存的配合，在兼容现有Linux文件系统操作情况下，实现所有功能，无需因增加特殊的掉电信息记录硬件单元及掉电辅助电源而增加硬件成本。本发明第一方面提出了O-RU设备电源掉电信息存储与上报方法，包括：步骤S1、设备正常工作时，持续进行掉电监控，并定期在NORFLASH文件系统中的掉电信息文件记录工作状态信息；步骤S2、监控到电源掉电时，在内存中暂存电源掉电告警信息；若电源掉电情况及时恢复，进入步骤S3，若电源持续掉电，则进入步骤S4；步骤S3、将内存中暂存的电源掉电告警信息写入NORFLASH文件系统中，并产生掉电告警产生消息和掉电告警消失消息，上报后进入步骤S1；步骤S4、设备再次上电重启后，获取复位原因并向NORFLASH文件系统中，生成掉电告警产生消息和掉电告警消失消息并上报消息，进入步骤S1。进一步的，所述掉电信息文件包括：当前工作状态：包括0和1两个状态以及记录时间，其中0为缺省值，1为正常工作；由设备定期记录；当前复位原因：包括0、1、2、3三个状态，其中0为缺省值，1为上电复位，2为软件复位，3为看门狗复位；由设备软件在重启前记录。进一步的，在O-RU设备设有硬件电路掉电保护，用于保证在设备电源掉电后为设备持续供电。进一步的，所述步骤S2的具体过程包括：在电源掉电发生时，关闭高功耗设备，并记录电源掉电告警产生信息，写入内存中。进一步的，所述步骤S2中，采用硬件中断方式触发电源掉电指示。进一步的，所述步骤S3的具体过程包括：步骤S3.1、将内存中暂存的电源掉电告警产生信息写入NORFLASH文件系统中；步骤S3.2、生成掉电告警产生消息，内容包括掉电告警产生事件和产生时间，并通过O-RU设备的软件Mplane平面接口上报；步骤S3.3、生成掉电告警消失消息，内容包括掉电告警消失事件和消失时间，并通过O-RU设备的软件Mplane平面接口上报；进入步骤S1。进一步的，所述步骤S4的具体过程包括：步骤S4.1、设备再次上电，重新启动；步骤S4.2、获取复位原因，并判断是否为硬件掉电复位，若是进入步骤S4.3，否则进入步骤S4.6；步骤S4.3、在掉电信息文件中写入当前复位原因；步骤S4.4、读取掉电信息文件中最后一次记录的时间信息，生成掉电告警产生消息，内容包括掉电告警产生事件及产生时间，其中，产生时间即为读取的时间信息；并通过O-RU设备的软件Mplane平面接口上报掉电告警产生消息；步骤S4.5、生成掉电告警产生消息，内容包括掉电告警消失事件及产生时间，其中，产生时间即为当前时间信息；并通过O-RU设备的软件Mplane平面接口上报掉电告警消失消息；进入步骤S1；步骤S4.6、上报其他复位原因，并进入步骤S1。进一步的，所述步骤S4.2中，复位原因由O-RU设备中CPU硬件复位原因寄存器和掉电信息文件确定。本发明第二方面提出了O-RU设备电源掉电信息存储与上报系统，包括CPU、输入电压监控模块、NORFLASH、内存；CPU分别与输入电压监控模块、NORFLASH与内存连接，实现上述的O-RU设备电源掉电信息存储与上报方法；输入电压监控模块，用于监控掉电是否产生；NORLASH，用于存储掉电信息文件以及掉电电源掉电告警信息；内存，用于暂存电源掉电告警信息。与现有技术相比，采用上述技术方案的有益效果为：1）无需额外特殊硬件设计，兼容现有低成本通用化O-RU硬件结构；2）兼容Linux现有的NORFLASH文件系统，无需更改底层软件；3）O-RU内部可实现掉电告警相关信息正确记录；4）O-RU内部可实现掉电告警信息由MPLANE正常上报。附图说明图1为理想的掉电处理流程。图2为本发明提出的O-RU设备电源掉电信息存储与上报方法示意图。图3为本发明一实施例的应用场景示意图。图4为本发明一实施例中的电源掉电信息存储与上报方法流程图。具体实施方式下面详细描述本申请的实施例，所述实施例的示例在附图中示出，其中自始至终相同或类似的标号表示相同或类似的模块或具有相同或类似功能的模块。下面通过参考附图描述的实施例是示例性的，仅用于解释本申请，而不能理解为对本申请的限制。相反，本申请的实施例包括落入所附加权利要求书的精神和内涵范围内的所有变化、修改和等同物。请参考图2，本实施例中提出了一种O-RU设备电源掉电信息存储与上报方法，包括：步骤S1、设备正常工作时，持续进行掉电监控，并定期在NORFLASH文件系统中掉电信息文件记录当前工作状态信息；步骤S2、监控到电源掉电时，在内存中暂存电源掉电告警信息；若电源掉电情况及时恢复，进入步骤S3，若电源持续掉电，则进入步骤S4；步骤S3、将内存中暂存的电源掉电告警信息写入NORFLASH文件系统中，并产生掉电告警产生消息和掉电告警消失消息，上报后进入步骤S1；步骤S4、设备再次上电重启后，获取复位原因并向NORFLASH文件系统中，生成掉电告警产生消息和掉电告警消失消息，并上报消息，进入步骤S1。具体的，本实施例中，掉电信息文件构建如下，包括：当前工作状态：包括0和1两个状态以及记录时间，其中0为缺省值，1为电源正常工作；由设备定期记录；当前复位原因：包括0、1、2、3三个状态，其中0为缺省值，1为上电复位，2为软件复位，3为看门狗复位；由设备软件在重启前记录。在一些实施例中，设备软件可以根据自身情况定义更多状态。应当注意的是，O-RU设备中设有硬件掉电保护，在硬件掉电保护的持续时间内，O-RU设备可以继续工作，实际上主要用于重要信息的保存，但无法支撑告警消息的完整上报。具体的，步骤S2的具体过程包括：在电源掉电发生时，设备首先控制关闭高功耗功能，尽量延长设备内部电容存储的少量电能，例如设备内部的PA、数字信号处理模块将被关闭；再记录电源掉电告警产生信息，写入内存中进行暂存，该电源掉电告警产生信息包括电源掉电告警产生事件和当前时间戳。在一个实施例中，为了确保设备快速处理电源掉电，采用硬件中断方式触发电源掉电指示。本实施例中，如果电源在监测的时间内恢复，执行步骤S3所述的步骤进行告警上报，步骤S3的具体过程包括：步骤S3.1、将内存中暂存的电源掉电告警产生信息写入NORFLASH文件系统中；步骤S3.2、生成掉电告警产生消息，内容包括掉电告警产生事件和产生时间，并通过O-RU设备的软件Mplane平面接口上报；步骤S3.3、生成掉电告警消失消息，内容包括掉电告警消失事件和消失时间，并通过O-RU设备的软件Mplane平面接口上报；进入步骤S1。最后，如果持续掉电，执行步骤S4所述的步骤进行告警上报，所述步骤S4的具体过程包括：步骤S4.1、设备再次上电，重新启动；步骤S4.2、获取复位原因，并判断是否为硬件掉电复位，若是进入步骤S4.3，否则进入步骤S4.6；其中，复位原因由硬件电路中自带的硬件复位原因寄存器和掉电信息文件的记录确定；步骤S4.3、在掉电信息文件中写入当前复位原因；步骤S4.4、读取掉电信息文件中最后一次记录的时间信息，生成掉电告警产生消息，内容包括掉电告警产生事件及产生时间，其中，产生时间即为读取的时间信息；并通过O-RU设备的软件Mplane平面接口上报掉电告警产生消息；步骤S4.5、生成掉电告警产生消息，内容包括掉电告警消失事件及产生时间，其中，产生时间即为当前时间信息；并通过O-RU设备的软件Mplane平面接口上报掉电告警消失消息；步骤S4.6、设备进行其它复位原因的判断与处理，并上报其他复位原因，并进入步骤S1。如图3所示为本发明提出的O-RU设备电源掉电信息存储与上报方法应用场景，其中，O-RU设备中的输入电压监控电路实时监控输入电压范围，电压低于的低压阈值后，产生低压告警信号，并通知ORU设备中的CPU；电压超过低压恢复阈值后，产生低压告警消失信号，并通知主CPU；电压监控电路为成熟技术，在此不再详细描述；O-RU设备中CPU上运行的掉电监控模块负责实时监控电压告警产生与消失状态，并通过本专利中的方法将信息记录到DDR内存或NORLASH掉电信息文件中；掉电监控模块在发现电源掉电告警或消失事件后，在设备电源可用的条件下，会将电源掉电告警生产及消失事件发送给Mplane模块；提出的O-RU设备电源掉电信息存储与上报方法由掉电监控模块实现；Mplane模块获知消息后，会将此消息通过标准网络协议发送给远程ODU设备，让远程O-DU设备及时获知O-RU设备工作状态；Mplane接口，协议及消息格式为ORAN标准所定义，在此不再详细描述；下面再结合图3和图4对本发明提出的O-RU设备电源掉电信息存储与上报方法流程进行完整说明。具体如下：Step1、进入掉电监控模块，将掉电信息文件中当前工作状态设置为1，表示处于正常工作状态，并记录当前时间信息。Step2、定期监控是否发生电源掉电情况，为确保设备快速处理电源掉电，本实施例中采用硬件中断方式触发电源掉电指示；若电源发生掉电，转入Step3，否则，转入Step1。Step3、关闭高功耗设备，例如设备内部的PA、数字信号处理模块。Step4、向DDR内存中写入电源掉电告警信息暂存，包含电源掉电告警产生事件和当前时间戳。Step5、持续监控电源掉电指示是否消失，若恢复，转入Step6；若未恢复，设备持续掉电，直至再次重启，转Step10。Step6、将内存中暂存的告警信息写入NORFLASH中；生成掉电告警产生消息，内容包括掉电告警产生事件及产生时间，并发送给Mplane；Step7、生成掉电告警消失消息，内容包括掉电告警消失事件以及消失时间，将其发送给Mplane。本实施例中，消失时间为当前时间。Step8、软件Mplane平面收到掉电告警产生信息后，生成“Power supply fault”产生消息，通过O-RU网络接口中的MPALNE平面接口，将消息上报给O-DU或SMO设备。Step9、软件Mplane平面收到掉电告警产生信息后，生成“Power supply fault”消失消息，通过O-RU网络接口中的MPALNE平面接口，将消息上报给O-DU或SMO设备；继续回到Step2，持续监控。Step10、设备再次上电，重新启动。Step11、设备读取复位信息并分析复位原因。本实施例中复位原因包括：CPU硬件复位原因寄存器，保存在NORFLASH掉电信息文件里当前工作状态和当前复位原因。Step12、判断当前复位是否为硬件掉电复位？掉电复位的判断条件为：当前工作状态=1，当前复位原因=0；硬件复位原因寄存器指示为power-on reset；满足判断条件的为硬件掉电复位，转Step14；否则转Step13。Step13、进行其它复位原因的判断与处理；完成后转入Step18。Step14、将当前复位原因设置为1。Step15、读取掉电告警信息文件中最后一次记录的时间信息，生成掉电告警产生消息，写入NORFLASH，内容包括掉电告警产生事件及读取到的时间信息，并将其发送给Mplane模块；生成掉电告警产生消息，写入NORFLASH，内容包括掉电告警消失事件及当前时间信息，并将其发送给Mplane模块。Step16、软件Mplane平面收到掉电告警产生消息后，生成“Power supply fault”产生消息，通过O-RU上联接口中的MPALNE平面接口，将消息上报给O-DU或SMO设备；Step17、软件Mplane平面收到掉电告警消失事件后，生成“Power supply fault”消失消息，通过O-RU网络接口中的MPALNE平面接口，将消息上报给O-DU或SMO设备；至此软件在掉电复位后重新记录了掉电事件，并通知到网络中的管理设备；Step18、将当前复位原因设置为0，后续将启动新的掉电监控模块，转Step1；特别地，根据本申请的实施例，上文参考流程描述的过程可以被实现为计算机软件程序。例如，本申请的实施例包括一种计算机程序产品，其包括承载在计算机可读介质上的计算机程序，该计算机程序包含用于执行流程图所示的方法的程序代码。需要说明的是，本申请实施例所示的计算机可读介质可以是计算机可读信号介质或者计算机可读存储介质或者是上述两者的任意组合。计算机可读存储介质例如可以是——但不限于——电、磁、光、电磁、红外线、或半导体的系统、装置或器件，或者任意以上的组合。计算机可读存储介质的更具体的例子可以包括但不限于：具有一个或多个导线的电连接、便携式计算机磁盘、硬盘、随机访问存储器、只读存储器、可擦式可编程只读存储器、闪存、光纤、便携式紧凑磁盘只读存储器、光存储器件、磁存储器件、或者上述的任意合适的组合。在本申请中，计算机可读存储介质可以是任何包含或存储程序的有形介质，该程序可以被指令执行系统、装置或者器件使用或者与其结合使用。而在本申请中，计算机可读的信号介质可以包括在基带中或者作为载波一部分传播的数据信号，其中承载了计算机可读的程序代码。这种传播的数据信号可以采用多种形式，包括但不限于电磁信号、光信号或上述的任意合适的组合。计算机可读的信号介质还可以是计算机可读存储介质以外的任何计算机可读介质，该计算机可读介质可以发送、传播或者传输用于由指令执行系统、装置或者器件使用或者与其结合使用的程序。计算机可读介质上包含的程序代码可以用任何适当的介质传输，包括但不限于：无线、有线等等，或者上述的任意合适的组合。附图中的流程图和框图，图示了按照本申请各种实施例的系统、方法和计算机程序产品的可能实现的体系架构、功能和操作。其中，流程图或框图中的每个方框可以代表一个模块、程序段、或代码的一部分，上述模块、程序段、或代码的一部分包含一个或多个用于实现规定的逻辑功能的可执行指令。也应当注意，在有些作为替换的实现中，方框中所标注的功能也可以以不同于附图中所标注的顺序发生。例如，两个接连地表示的方框实际上可以基本并行地执行，它们有时也可以按相反的顺序执行，这依所涉及的功能而定。也要注意的是，框图或流程图中的每个方框、以及框图或流程图中的方框的组合，可以用执行规定的功能或操作的专用的基于硬件的系统来实现，或者可以用专用硬件与计算机指令的组合来实现。描述于本申请实施例中所涉及到的单元可以通过软件的方式实现，也可以通过硬件的方式来实现，所描述的单元也可以设置在处理器中。其中，这些单元的名称在某种情况下并不构成对该单元本身的限定。作为另一方面，本申请还提供了一种计算机程序产品或计算机程序，该计算机程序产品或计算机程序包括计算机指令，该计算机指令存储在计算机可读存储介质中。计算机设备的处理器从计算机可读存储介质读取该计算机指令，处理器执行该计算机指令，使得该计算机设备执行上述实施例中所述的O-RU设备电源掉电信息存储与上报方法。作为另一方面，本申请还提供了一种计算机可读介质，该计算机可读介质可以是上述实施例中描述的电子设备中所包含的；也可以是单独存在，而未装配入该电子设备中。上述计算机可读介质承载有一个或者多个程序，当上述一个或者多个程序被一个该电子设备执行时，使得该电子设备实现上述实施例中所述的O-RU设备电源掉电信息存储与上报方法。应当注意，尽管在上文详细描述中提及了用于动作执行的设备的若干模块或者单元，但是这种划分并非强制性的。实际上，根据本申请的实施方式，上文描述的两个或更多模块或者单元的特征和功能可以在一个模块或者单元中具体化。反之，上文描述的一个模块或者单元的特征和功能可以进一步划分为由多个模块或者单元来具体化。通过以上的实施方式的描述，本领域的技术人员易于理解，这里描述的示例实施方式可以通过软件实现，也可以通过软件结合必要的硬件的方式来实现。因此，根据本申请实施方式的技术方案可以以软件产品的形式体现出来，该软件产品可以存储在一个非易失性存储介质中或网络上，包括若干指令以使得一台计算设备执行根据本申请实施方式的方法。需要说明的是，在本发明实施例的描述中，除非另有明确的规定和限定，术语“设置”、“连接”应做广义理解，例如，可以是固定连接，也可以是可拆卸连接，或一体地连接；可以是直接连接，也可以通过中间媒介间接连接。对于本领域的普通技术人员而言，可以具体情况理解上述术语在本发明中的具体含义；实施例中的附图用以对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。通常在此处附图中描述和示出的本发明实施例的组件可以以各种不同的配置来布置和设计。尽管上面已经示出和描述了本申请的实施例，可以理解的是，上述实施例是示例性的，不能理解为对本申请的限制，本领域的普通技术人员在本申请的范围内可以对上述实施例进行变化、修改、替换和变型。
