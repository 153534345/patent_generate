标题title
网络设备和资源分享的方法
摘要abst
本发明提供了一种网络设备和资源分享的方法，包括：设备发现：本机设备启动P2P连接服务，并准备自身设备信息，同时部署多播DNS和发现服务在整个网络内发布自身设备信息和探测其他网络设备；资源分享：本机设备获取其他网络设备的信息，并根据信息与对应设备建立P2P连接，通过P2P连接通信分享资源信息。本发明无需用户指定设备IP地址，零配置接入，设备和资源状态能实时同步更新，可以运行在所有支持标准IP协议栈的操作系统平台和设备上，不同的操作系统也能直接分享资源信息。
权利要求书clms
1.网络设备和资源分享的方法，其特征在于，包括：设备发现：本机设备启动P2P连接服务，并准备自身设备信息，同时部署多播DNS和发现服务在整个网络内发布自身设备信息和探测其他网络设备；资源分享：本机设备获取其他网络设备的信息，并根据信息与对应设备建立P2P连接，通过P2P连接通信分享资源信息。2.根据权利要求1所述的网络设备和资源分享的方法，其特征在于，准备的自身设备信息包括：①使用TCP或其他可靠IP传输协议绑定一个本机端口；②记录所使用的协议名称；③生成一个随机设备编号；④收集本机设备的网络IP信息。3.根据权利要求1或2所述的网络设备和资源分享的方法，其特征在于，所述多播DNS的具体工作过程包括：步骤A1、本机设备上线后，自动加入一个IP组播，并构建一个DNS响应报文；响应报文构建完成后立即发送至组播地址，网络中的其他网络设备收到响应报文解析出设备信息后开始尝试连接本机设备；步骤A2、查询网络中的其他网络设备，构建一个DNS查询报文，将查询报文发送到目标组播地址，其他网络设备收到查询报文后解析查询类型和域名，域名匹配后构建响应报文发送给查询设备；步骤A3、等待网络中的其他网络设备DNS响应报文，收到报文后解析出设备的P2P服务连接信息，并根据解析出的信息尝试连接设备进行资源分享；步骤A4、持续监测网络中其他网络设备上线DNS报文或下线DNS报文，并验证报文内容以及解析获取对应的设备信息，使用设备编号区分不同设备；本机设备下线时，发送下线DNS报文至组播地址中。4.根据权利要求3所述的网络设备和资源分享的方法，其特征在于，所述步骤A2中，域名匹配规则为：比较服务名和协议名，与本机的服务器名和协议名相同即为匹配成功；名称按照字符串串规则匹配，不区分大小写。5.根据权利要求1或2所述的网络设备和资源分享的方法，其特征在于，发现服务的工作过程包括：步骤B1、使用WebSocket协议绑定服务器地址和端口，监听连接请求并响应；步骤B2、在设备中部署本地DNS服务器或使用当前网络中的DNS服务器，在DNS服务器中添加发现服务的记录，包括域名和发现服务器的IP地址；步骤B3、网络中的其他网络设备通过DNS查询解析发现服务地址；步骤B4、本机设备连接到发现服务器，注册本机设备信息；步骤B5、发现服务器分发注册的设备信息，将已注册设备的信息编列成设备信息表，并将设备信息表发送给每个已连接的设备；步骤B6、本机设备收到设备信息表后解析出其他网络设备的P2P连接信息，尝试发起连接。6.根据权利要求5所述的网络设备和资源分享的方法，其特征在于，在所述步骤B3中，若无法执行步骤B2时，直接配置本机设备DNS缓存记录添加发现服务器的IP地址。7.根据权利要求5所述的网络设备和资源分享的方法，其特征在于，在步骤B5中，当设备信息改变、建立连接或断开连接后，具体的数据管理方式如下：当设备建立连接或信息改变后，使用设备编号作为主键更新到当前设备信息列表中，同时设备编号和当前的连接映射绑定，再将设备信息表发送给其他已连接的设备；当设备断开连接后，通过其设备编号删除设备信息表的对应数据，再将设备信息表发送给其他已连接的设备。8.根据权利要求1所述的网络设备和资源分享的方法，其特征在于，所述根据信息与对应设备建立P2P连接的具体过程包括：步骤C1、通过设备编号整合设备的连接信息生成地址信息表，将编号相同的信息视为同一个设备的信息；步骤C2、遍历信息表，从第一个地址信息开始连接；步骤C3、若连接失败，则尝试连接下一个地址，若过程中信息表有更新则重新进入步骤C2；步骤C4、连接成功，停止遍历，并保持连接；步骤C5、若连接断开，检测信息表是否有更新，若有更新则进入步骤C2，若无更新则停止连接过程，对方设备下线。9.根据权利要求1或8所述的网络设备和资源分享的方法，其特征在于，所述通过P2P连接通信分享资源信息的具体过程包括：在连接建立后，双方设备立即向对方设备发送一次本机分享的资源信息；其中，每个设备的资源信息通过对应的资源编号构建索引，并存入资源信息表中；当整个网络中的设备都互相建立连接交互资源信息后，某一设备资源信息和状态发生变更时，需要将相应的变化同步到网络中的其他网络设备。10.根据权利要求9所述的网络设备和资源分享的方法，其特征在于，所述同步过程为：步骤D1、新增资源信息时，生成一个新的本机唯一的资源编号，并将资源编号与资源信息绑定，更新到资源信息表中；步骤D2、资源信息变化或删除，通过资源编号索引资源信息进行更新；步骤D3、将更新后的资源信息表通过P2P连接发送到当前已连接的所有其他网络设备上；步骤D4、其他网络设备收到后，通过设备编号索引到对应的资源信息表，更新数据。
说明书desc
技术领域本发明涉及资源交互领域，特别涉及一种网络设备和资源分享的方法。背景技术网络设备和资源分享即用户可以在任意一台计算机上访问网络中的其它设备和资源信息，包括文件、音视频媒体流、图片等数字内容。用户在访问网络设备前需要指定设备IP地址和端口，无法直接获得当前网络中有哪些设备和资源，有一些网上邻居协议可以自动发现其它网络设备，但是它们只适用于特定类型资源的分享，无法跨子网运行，设备间没有P2P长连接导致无法在线实时感知设备和资源状态，而且不同的操作系统平台存在无法互通的情况。发明内容针对现有技术中存在的问题，提供了网络设备和资源分享的方法，使用多播DNS和发现服务器相组合，让网络设备间可以互相自动发现，同时能跨子网运行。设备间互相发现后再通过P2P连接组网互相交互资源信息，可以保障设备和资源状态在线实时更新，连接建立后可以传输任意形式的数据，设备间分享的资源不再限于特定类型。本发明采用的技术方案如下：网络设备和资源分享的方法，包括：设备发现：本机设备启动P2P连接服务，并准备自身设备信息，同时部署多播DNS和发现服务在整个网络内发布自身设备信息和探测其他网络设备；资源分享：本机设备获取其他网络设备的信息，并根据信息与对应设备建立P2P连接，通过P2P连接通信分享资源信息。进一步的，准备的自身设备信息包括：①使用TCP或其他可靠IP传输协议绑定一个本机端口；②记录所使用的协议名称；③生成一个随机设备编号；④收集本机设备的网络IP信息。进一步的，所述多播DNS的具体工作过程包括：步骤A1、本机设备上线后，自动加入一个IP组播，并构建一个DNS响应报文；响应报文构建完成后立即发送至组播地址，网络中的其他网络设备收到响应报文解析出设备信息后开始尝试连接本机设备；步骤A2、查询网络中的其他设备，构建一个DNS查询报文，将查询报文发送到目标组播地址，其他网络设备收到查询报文后解析查询类型和域名，域名匹配后构建响应报文发送给查询设备；步骤A3、等待网络中的其他网络设备DNS响应报文，收到报文后解析出设备的P2P服务连接信息，并根据解析出的信息尝试连接设备进行资源分享；步骤A4、持续监测网络中其他设备上线DNS报文或下线DNS报文，并验证报文内容以及解析获取对应的设备信息，使用设备编号区分不同设备；本机设备下线时，发送下线DNS报文至组播地址中。进一步的，所述步骤A2中，域名匹配规则为：比较服务名和协议名，与本机的服务器名和协议名相同即为匹配成功；名称按照字符串串规则匹配，不区分大小写。进一步的，发现服务的工作过程包括：步骤B1、使用WebSocket协议绑定服务器地址和端口，监听连接请求并响应；步骤B2、在设备中部署本地DNS服务器或使用当前网络中的DNS服务器，在DNS服务器中添加发现服务的记录，包括域名和发现服务器的IP地址；步骤B3、网络中的其他设备通过DNS查询解析发现服务地址；步骤B4、本机设备连接到发现服务器，注册本机设备信息；步骤B5、发现服务器分发注册的设备信息，将已注册设备的信息编列成设备信息表，并将设备信息表发送给每个已连接的设备；步骤B6、本机设备收到设备信息表后解析出其他设备的P2P连接信息，尝试发起连接。进一步的，在所述步骤B3中，若无法执行步骤B2时，直接配置本机设备DNS缓存记录添加发现服务器的IP地址。进一步的，在所述步骤B5中，当设备信息改变、建立连接或断开连接后，具体的数据管理方式如下：当设备建立连接或信息改变后，使用设备编号作为主键更新到当前设备信息列表中，同时设备编号和当前的连接映射绑定，再将设备信息表发送给其他已连接的设备；当设备断开连接后，通过其设备编号删除设备信息表的对应数据，再将设备信息表发送给其他已连接的设备。进一步的，所述根据信息与对应设备建立P2P连接的具体过程包括：步骤C1、通过设备编号整合设备的连接信息生成地址信息表，将编号相同的信息视为同一个设备的信息；步骤C2、遍历信息表，从第一个地址信息开始连接；步骤C3、若连接失败，则尝试连接下一个地址，若过程中信息表有更新则重新进入步骤C2；步骤C4、连接成功，停止遍历，并保持连接；步骤C5、若连接断开，检测信息表是否有更新，若有更新则进入步骤C2，若无更新则停止连接过程，对方设备下线。进一步的，所述通过P2P连接通信分享资源信息的具体过程包括：在连接建立后，双方设备立即向对方设备发送一次本机分享的资源信息；其中，每个设备的资源信息通过对应的资源编号构建索引，并存入资源信息表中；当整个网络中的设备都互相建立连接交互资源信息后，某一设备资源信息和状态发生变更时，需要将相应的变化同步到网络中的其他设备。进一步的，所述同步过程为：步骤D1、新增资源信息时，生成一个新的本机唯一的资源编号，并将资源编号与资源信息绑定，更新到资源信息表中；步骤D2、资源信息变化或删除，通过资源编号索引资源信息进行更新；步骤D3、将更新后的资源信息表通过P2P连接发送到当前已连接的所有其他设备上；步骤D4、其他设备收到后，通过设备编号索引到对应的资源信息表，更新数据。与现有技术相比，采用上述技术方案的有益效果为：本发明无需用户指定设备IP地址，零配置接入，设备和资源状态能实时同步更新，可以运行在所有支持标准IP协议栈的操作系统平台和设备上，不同的操作系统也能直接分享资源信息。附图说明图1为本发明提出的网络设备和资源分享的方法流程图。图2为本发明一实施例中设备发现的应用系统示意图。图3为本发明一实施例中建立连接的过程示意图。具体实施方式下面详细描述本申请的实施例，所述实施例的示例在附图中示出，其中自始至终相同或类似的标号表示相同或类似的模块或具有相同或类似功能的模块。下面通过参考附图描述的实施例是示例性的，仅用于解释本申请，而不能理解为对本申请的限制。相反，本申请的实施例包括落入所附加权利要求书的精神和内涵范围内的所有变化、修改和等同物。本发明实施例提出了一种网络设备可以自由分享不同类型的资源信息的方法，同时无需用户指定设备IP地址，零配置接入，设备和资源状态能实时同步更新，可以运行在所有支持标准IP协议栈的操作系统平台和设备上，不同的操作系统也能直接分享资源信息。具体的：请参考图1，该网络设备和资源分享的方法包括设备发现和资源分享两部分。其中，设备发现部分包括：本机设备启动后，首先启动P2P连接服务，用于后续P2P连接建立。服务启动后，准备自身设备信息，在后续设备信息交换中使用。之后开始设备连接信息发现过程，多播DNS和发现服务同时工作可在整个网络范围内发布自身设备信息和探测其它设备，具体系统如图2所示。在一个实施例中，自身设备信息包括绑定的本地端口信息、P2P协议类型、设备编号以及网络IP信息。其获取方法包括：a)使用TCP或可使用其它可靠IP传输协议绑定一个本机端口;b)记录使用的协议名称，例如“tcp”；c)生成一个长度为32比特的随机设备编号；d)收集本机设备的网络IP信息。下面针对设备发现工作中的多播DNS和发现服务进行进一步的说明。多播DNS的工作过程包括：步骤A1、本机设备上线后，自动加入一个IP组播，并构建一个DNS响应报文；响应报文构建完成后立即发送至组播地址，网络中的其他网络设备收到响应报文解析出设备信息后即可开始尝试连接本机设备。应当注意，DNS响应报文中必须包含以下记录：a)一条A类型或是AAAA类型记录数据，域名字段需要符合RFC8533中描述的规则，包含协议名和服务名，服务名默认使用“_nvi”；b)一条SRV类型数据，包含本机设备名称和本地P2P连接服务绑定的端口；c)一条TXT类型扩展数据，数据内容使用“k=v”字典格式，包含设备编号；d)生存时间字段必须大于0。在一个实施例中，IP组播用于接收其他设备的消息，可使用RFC6762中约定的默认地址和端口。步骤A2、查询网络中的其他设备，构建一个DNS查询报文，将构建完成的查询报文发送到目标组播地址，路由器会转发组播报文到其他网络设备上，其他网络设备收到查询报文后解析查询类型和域名，域名匹配后构建响应报文发送给查询设备。本实施例中，DNS查询报文必须包含以下记录：a)一条A类型或是AAAA类型或是SRV类型或是PTR类型的查询数据；b)查询的域名字段需要符合RFC8533中描述的规则，包含协议名和服务名，服务名默认使用“_nvi”。在一个实施例中，域名匹配的规则为：a)比较服务名和协议名，和本机的服务名和协议相同即认为匹配成功；b)名称按照字符串规则匹配，不区分大小写。步骤A3、等待网络中的其他网络设备DNS响应报文，收到报文后解析出设备的P2P服务连接信息，并根据解析出的信息尝试连接设备进行资源分享。本实施例中，DNS响应报文必须包含以下记录：a)一条A类型或是AAAA类型记录，有正确的IP地址；b)一条SRV类型数据，包含设备名称和P2P连接服务绑定的端口；c)一条TXT类型扩展数据，数据内容使用“k=v”字典格式，包含设备编号。步骤A4、持续监测网络中其他设备上线或下线的DNS报文，按照步骤A3中描述的报文内容要求验证收到的报文，解析并获取IP地址、端口、设备编号数据，使用设备编号来区分不同的设备。步骤A5、本机设备下线，向A1步骤中加入的组播地址发送下线DNS报文，该报文中必须包含：a)一条TXT类型扩展数据，数据内容使用“k=v”字典格式，包含设备编号；b)生存时间字段必须设置为0。通过多播DNS交换设备信息完成，整个过程无需用户配置介入，完全系统自动完成。在跨多个子网或是一些禁用多播报文路由的情况下，多播DNS不能发现其他设备，网络管理员通过部署发现服务来帮助设备间信息分享。发现服务可使用WebSocket协议通信，只使用单播报文保证路由正常工作，同时可配置本地DNS解析发现服务器IP地址，设备可通过DNS零配置接入。具体的：发现服务的工作过程包括：步骤B1、部署发现服务，使用WebSocket协议绑定服务器地址和端口，监听连接请求并响应。步骤B2、在DNS服务器中添加发现服务的记录，包括域名和发现服务器的IP地址，其中，域名可使用“sd.nvi”，将记录的IP地址配置为发现服务器IP地址。该DNS服务器可以是部署的一个本地DNS服务器或是使用当前网络中的DNS服务器。步骤B3、网络中的其他设备通过DNS查询解析发现服务地址。如果无法执行步骤B2，就无法通过DNS查询解析发现服务地址，此时可直接配置本机DNS缓存记录添加发现服务器的IP地址。例如，在Windows系统中可在"C:WindowsSystem32driversetchosts"文件中添加一行记录"10.1.1.2 sd.nvi"。步骤B4、本机设备连接到发现服务器，注册本机设备信息。本实施例中，注册信息必须包括表1所示的数据：表1 注册信息表步骤B5、发现服务器分发注册的设备信息，将已注册设备的信息编列成设备信息表，并将设备信息表发送给每个已连接的设备；其中，设备信息表中每行数据包含了完整的设备注册信息。在一个实施例中，当设备信息改变、建立连接和断开连接后具体的数据的管理方式如下：a)当一个设备建立来了解或信息改变后，使用设备编号作为主键更新到当前设备信息列表中，同时设备编号和当前的连接映射绑定，再将设备信息表发送给其它已连接的设备。b)当一个设备断开连接，通过该设备的编号删除信息表中的数据，再将设备信息表发送给其它已连接的设备。步骤B6、本机设备收到设备信息表后解析出其他设备的P2P连接信息，尝试发起连接。通过多播DNS和发现服务能够使得设备分享覆盖整个网络，与整个网络的其他设备建立连接。资源分享部分包括：通过设备发现工作后获取到其他网络设备的IP地址、P2P连接协议类型和端口信息等，使用这些信息就可以开始尝试和网络中的设备建立P2P连接，然后通过P2P连接通信分享资源信息。一个网络设备可能处于多个网络，相应的会具有多个IP地址，需要找到一个可以互相通信的地址建立连接。请参考图3，建立连接的具体过程包括：步骤C1、通过设备编号整合设备的连接信息生成地址信息表，将编号相同的信息视为同一个设备的信息。步骤C2、遍历信息表，从第一个地址信息开始连接。步骤C3、若连接失败，则尝试连接下一个地址，若过程中信息表有更新则重新进入步骤C2。步骤C4、连接成功，停止遍历，并保持连接。步骤C5、若连接断开，检测信息表是否有更新，若有更新则进入步骤C2，若无更新则停止连接过程，对方设备下线。应当注意，连接建立后一直保持，并按周期发送保活数据包，设备离线后自动断开连接。在连接建立后，双方设备立即向对方设备发送一次本机分享的资源信息，这样连接双方就可以获取到对方的资源信息。其中，每个设备的资源信息通过对应的资源编号构建索引，并存入资源信息表中。每个设备中的资源信息的数据字段包含但不限于表2所示内容：表2 资源信息表当整个网络中的设备都互相建立连接交互资源信息后，用户在任意一台设备上都可以获取到其他设备分享的资源信息。应当注意，一旦某一设备资源信息和状态发生变更时，需要将相应的变化同步到网络中的其他设备。具体的同步过程为：步骤D1、新增资源信息时，生成一个新的本机唯一的资源编号，并将资源编号与资源信息绑定，更新到资源信息表中；步骤D2、资源信息变化或删除，通过资源编号索引资源信息进行更新；步骤D3、将更新后的资源信息表通过P2P连接发送到当前已连接的所有其他设备上；步骤D4、其他设备收到后，通过设备编号索引到对应的资源信息表，更新数据。本发明通过多播DNS和发现服务器相组合，让网络设备间可以互相自动发现，同时能跨子网运行。设备间互相发现后再通过P2P连接组网互相交互资源信息，可以保障设备和资源状态在线实时更新，连接建立后可以传输任意形式的数据，设备间分享的资源不再限于特定类型。应当注意，本说明书中涉及到具体步骤的过程，各步骤之间并非完全存在前后依赖关系，也可为并列关系。附图中的流程图和框图，图示了按照本申请各种实施例的系统、方法和计算机程序产品的可能实现的体系架构、功能和操作。其中，流程图或框图中的每个方框可以代表一个模块、程序段、或代码的一部分，上述模块、程序段、或代码的一部分包含一个或多个用于实现规定的逻辑功能的可执行指令。也应当注意，在有些作为替换的实现中，方框中所标注的功能也可以以不同于附图中所标注的顺序发生。例如，两个接连地表示的方框实际上可以基本并行地执行，它们有时也可以按相反的顺序执行，这依所涉及的功能而定。也要注意的是，框图或流程图中的每个方框、以及框图或流程图中的方框的组合，可以用执行规定的功能或操作的专用的基于硬件的系统来实现，或者可以用专用硬件与计算机指令的组合来实现。描述于本申请实施例中所涉及到的单元可以通过软件的方式实现，也可以通过硬件的方式来实现，所描述的单元也可以设置在处理器中。其中，这些单元的名称在某种情况下并不构成对该单元本身的限定。作为另一方面，本申请还提供了一种计算机程序产品或计算机程序，该计算机程序产品或计算机程序包括计算机指令，该计算机指令存储在计算机可读存储介质中。计算机设备的处理器从计算机可读存储介质读取该计算机指令，处理器执行该计算机指令，使得该计算机设备执行上述实施例中所述的网络设备和资源分享的方法。作为另一方面，本申请还提供了一种计算机可读介质，该计算机可读介质可以是上述实施例中描述的电子设备中所包含的；也可以是单独存在，而未装配入该电子设备中。上述计算机可读介质承载有一个或者多个程序，当上述一个或者多个程序被一个该电子设备执行时，使得该电子设备实现上述实施例中所述的网络设备和资源分享的方法。应当注意，尽管在上文详细描述中提及了用于动作执行的设备的若干模块或者单元，但是这种划分并非强制性的。实际上，根据本申请的实施方式，上文描述的两个或更多模块或者单元的特征和功能可以在一个模块或者单元中具体化。反之，上文描述的一个模块或者单元的特征和功能可以进一步划分为由多个模块或者单元来具体化。通过以上的实施方式的描述，本领域的技术人员易于理解，这里描述的示例实施方式可以通过软件实现，也可以通过软件结合必要的硬件的方式来实现。因此，根据本申请实施方式的技术方案可以以软件产品的形式体现出来，该软件产品可以存储在一个非易失性存储介质中或网络上，包括若干指令以使得一台计算设备执行根据本申请实施方式的方法。对于本领域的普通技术人员而言，可以具体情况理解上述术语在本发明中的具体含义；实施例中的附图用以对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。通常在此处附图中描述和示出的本发明实施例的组件可以以各种不同的配置来布置和设计。尽管上面已经示出和描述了本申请的实施例，可以理解的是，上述实施例是示例性的，不能理解为对本申请的限制，本领域的普通技术人员在本申请的范围内可以对上述实施例进行变化、修改、替换和变型。
