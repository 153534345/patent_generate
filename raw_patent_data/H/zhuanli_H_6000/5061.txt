标题title
一种基于可靠AP选择的WIFI室内定位方法
摘要abst
本发明公开了一种基于可靠AP选择的WIFI室内定位方法，包括：离线阶段：采集待定位区域内各参考点的RSSI信号作为指纹信息，构建指纹数据库；检测更新阶段：引入动态投票机制，实时动态观测并判定投票结果，据此检测各AP的可靠性，根据各AP可靠性更新指纹数据库，以保证指纹数据库的有效性；在线阶段：采集待定位点的RSSI信号，与指纹数据库中可靠的指纹信息进行匹配，得到待定位点的位置信息。该方法引入动态投票机制，利用AP缺失率和波动性，实时选取环境当中可靠的AP用于位置估计，提高可靠AP的使用率，降低不可靠的AP对定位造成的误差，从而提高定位精度，有效的降低定位误差，均衡系统开销和定位精度之间的矛盾。
权利要求书clms
1.一种基于可靠AP选择的WIFI室内定位方法，其特征在于，包括：离线阶段：采集待定位区域内各参考点的RSSI信号作为指纹信息，构建指纹数据库；检测更新阶段：将AP的缺失率和波动性引入动态投票机制，实时检测各AP的可靠性并选择可靠的AP，以及根据指纹数据库可靠性更新指纹数据库；在线阶段：采集待定位点的RSSI信号，与指纹数据库中可靠的指纹信息进行匹配，得到待定位点的位置信息。2.根据权利要求1所述的基于可靠AP选择的WIFI室内定位方法，其特征在于，所述指纹数据库包括：各AP的坐标，参考点坐标，RSSI信号，RSSI的波动矩阵，AP的缺失率矩阵。3.根据权利要求2所述的基于可靠AP选择的WIFI室内定位方法，其特征在于，所述离线阶段包括：将待定位区域按照一定的距离划分为若干网格，每一个网格点作为一个参考点，每个参考点的位置以坐标形式表示；在各参考点处采集各AP的RSSI信号，形成初始指纹数据库；拓展初始指纹数据库，构建指纹数据库。4.根据权利要求2所述的基于可靠AP选择的WIFI室内定位方法，其特征在于，所述检测更新阶段包括：计算各参考点处来自各个AP的缺失率，以及计算各AP在不同的参考点处采集到的一组连续RSSI信号的波动性；将AP的缺失率和波动性纳入动态投票机制，对各AP进行投票；根据各AP的投票结果，计算各AP对应的缺失率权值和波动性权值；利用得到的各AP的权值，按照降序排序，选取前K个可靠的AP，K为预设值；根据选取的前K个可靠的AP的缺失率权值和波动性权值，计算前K个可靠的AP的最终权值。5.根据权利要求4所述的基于可靠AP选择的WIFI室内定位方法，其特征在于，所述在线阶段包括：采集待定位点RSSI信号，计算其与指纹数据库中可靠的指纹信息的初始相似度；所述可靠的指纹信息为K个可靠AP的RSSI值构成的指纹；根据K个可靠的AP的最终权值和初始相似度，计算得到待定位点RSSI信号与可靠的指纹信息的指纹相似度；将指纹相似度进行升序排序，选择前T个参考点，并计算前T个参考点的权重；其中，T为预设值；基于T个参考点的坐标及权重计算得到待定位点的坐标。6.根据权利要求2所述的基于可靠AP选择的WIFI室内定位方法，其特征在于，所述AP的缺失率矩阵包括每个参考点处各AP的缺失率；通过在每个参考点处连续扫描各AP相同的次数N并记录接到来自各AP的RSSI值的次数n，确定每个参考点处各AP的缺失率；所述RSSI的波动矩阵包括每个参考点处得到各AP的一组连续RSSI值的波动性；所述波动性用这一组RSSI值的标准差表示。7.根据权利要求4所述的基于可靠AP选择的WIFI室内定位方法，其特征在于，所述将AP的缺失率和波动性纳入动态投票机制，对各AP进行投票，具体包括：基于缺失率对AP进行投票，当参考点处在当前时刻某一AP的缺失率大于预先设定的缺失率阈值，则认为当前时刻该AP在此参考点处不可靠，对该AP自动计入一次投票；基于波动性对AP进行投票，当参考点处当前时刻某一AP的波动性大于设定的波动性阈值，则认为当前时刻该AP在此参考点处不可靠，对该AP自动计入一次投票。8.根据权利要求7所述的基于可靠AP选择的WIFI室内定位方法，其特征在于，所述根据各AP的投票结果，计算各AP对应的缺失率权值和波动性权值，具体包括：各AP的缺失率权值通过下式计算得到：式中，表示第i个AP的缺失率权值，表示第i个AP基于缺失率的得票数；M表示参考点总数；各AP的波动性权值通过下式计算得到：式中，第i个AP的波动性权值，表示第i个AP基于波动性的得票数。9.根据权利要求5所述的基于可靠AP选择的WIFI室内定位方法，其特征在于，初始相似度Dj用待定位点RSSI信号与可靠指纹的欧式距离表示；指纹相似度D′j根据K个可靠的AP的最终权值和初始相似度计算得到：式中，W′i表示第i个AP的最终权值；前T个参考点中第j个参考点的权重w′j计算公式如下：待定位点的坐标计算公式如下：其中，表示选择的前T个参考点中第j个参考点的坐标。10.根据权利要求2至9任一项所述的基于可靠AP选择的WIFI室内定位方法，其特征在于，所述根据指纹数据库可靠性更新指纹数据库，包括：检测机制：利用已有的指纹数据库中指纹计算某个已知的位置坐标，通过多次计算该位置的估计位置与真实位置之间的误差，若该误差大于预设的误差阈值，则指纹数据库不可靠，进入更新机制；更新机制：重新计算AP的缺失率和波动性，进行保存，并返回检测机制步骤；若重新计算得到的误差小于预设的误差阈值，则此次更新有效，保留更新结果到指纹数据库。
说明书desc
技术领域本发明涉及室内定位技术领域，尤其涉及一种基于可靠AP选择的WIFI室内定位方法。背景技术随着科技的发展，各个领域对于定位精度和安全性要求越来越高。可靠的室内定位服务离不开准确的位置信息，而复杂的室内环境，导致室内定位技术受到影响，因此室内定位“厘米级”的需求使得精准的室内位置服务更为迫切。传统指纹的定位过程通常分为两个阶段：离线采样阶段和在线定位阶段。在离线采样阶段采集定位区域内所有参考节点的RSSI值，每个节点有一条特定的信息，形成离线指纹数据库。在线定位阶段，通过实时测量目标用户位置的RSSI值，将实时采集得到的指纹与指纹库中的指纹进行匹配，从而确定用户的实际位置。基于WIFI的室内定位技术主要依赖于AP的可靠性，即指纹的可靠性，指纹具有一定的时效性，只有可靠的指纹信息才能提供可靠的位置服务。使用基于WIFI指纹的室内定位技术存在的最大问题就是接收到的RSSI表现出多变性和复杂性，如室内障碍物对RSSI造成的多径干扰、信号传播距离的增加造成的信号衰减、金属对信号的干扰等。目前，有些研究关注室内定位中的AP的冗余度，主要有通过改进AP选择算法来减少用于定位的指纹，从而降低定位系统的计算开销，但是其会导致不可靠的AP被纳入位置计算，难以兼顾定位精度的提升和降低系统能耗。一些研究旨在对用于定位的AP进行加权，然而忽略掉指纹库本身的时效性对定位结果的影响，因此难以提供高精度的定位。室内环境动态多变，导致在前后相距较短的时间段内，先后采集的指纹信息差异较大，而原始的指纹数据库中保存的信息的价值随着时间降低，导致用于定位的AP的可靠性降低。因此，怎样在突发状况环境当中选择可靠的AP和保证系统时效性，对于位置估计尤为重要。发明内容鉴于上述现有技术的不足之处，本发明提供了一种基于可靠AP选择的WIFI室内定位方法，旨在识别在突发状况下由于外部环境导致损坏的不稳定的AP,选择可靠的AP用于室内定位中指纹库的建立和有效指纹的提取，以便提高可靠指纹利用率和定位精度。一种基于可靠AP选择的WIFI室内定位方法，包括：离线阶段：采集待定位区域内各参考点的RSSI信号作为指纹信息，构建指纹数据库；检测更新阶段：将AP的缺失率和波动性引入动态投票机制，检测各AP的可靠性并选择可靠的AP，以及根据指纹数据库可靠性更新指纹数据库；在线阶段：采集待定位点的RSSI信号，与指纹数据库中可靠的指纹信息进行匹配，得到待定位点的位置信息。进一步地，所述指纹数据库包括：各AP的坐标，参考点坐标，RSSI信号ψ，RSSI的波动矩阵SD，AP的缺失率矩阵LR。进一步地，所述离线阶段包括：将待定位区域按照一定的距离划分为若干网格，每一个网格点作为一个参考点，每个参考点的位置以坐标形式表示；在各参考点处采集各AP的RSSI信号，形成初始指纹数据库；拓展初始指纹数据库，构建指纹数据库。进一步地，所述检测更新阶段包括：计算各参考点处来自各个AP的缺失率，以及计算各AP在不同的参考点处采集到的一组连续RSSI信号的波动性；将AP的缺失率和波动性纳入动态投票机制，对各AP进行投票；根据各AP的投票结果，计算各AP对应的缺失率权值和波动性权值；利用得到的各AP的权值，按照降序排序，选取前K个可靠的AP，K为预设值；根据选取的前K个可靠的AP的缺失率权值和波动性权值，计算前K个可靠的AP的最终权值。进一步地，所述在线阶段包括：采集待定位点RSSI信号，计算其与指纹数据库中可靠的指纹信息的初始相似度；所述可靠的指纹信息为K个可靠AP的RSSI值构成的指纹；根据K个可靠的AP的最终权值和初始相似度，计算得到待定位点RSSI信号与可靠的指纹信息的指纹相似度；将指纹相似度进行升序排序，选择前T个参考点，并计算前T个参考点的权重；其中，T为预设值；基于T个参考点的坐标及权重计算得到待定位点的坐标。进一步地，所述AP的缺失率矩阵包括每个参考点处各AP的缺失率；通过在每个参考点处连续扫描各AP相同的次数N并记录接到来自各AP的RSSI值的次数n，确定每个参考点处各AP的缺失率；所述RSSI的波动矩阵包括每个参考点处得到各AP的一组连续RSSI值的波动性；所述波动性用这一组RSSI值的标准差表示。进一步地，所述将AP的缺失率和波动性纳入动态投票机制，对各AP进行投票，具体包括：基于缺失率对AP进行投票，当参考点处在当前时刻某一AP的缺失率大于预先设定的缺失率阈值，则认为当前时刻该AP在此参考点处不可靠，对该AP自动计入一次投票；基于波动性对AP进行投票，当参考点处当前时刻某一AP的波动性大于设定的波动性阈值，则认为当前时刻该AP在此参考点处不可靠，对该AP自动计入一次投票。进一步地，所述根据各AP的投票结果，计算各AP对应的缺失率权值和波动性权值，具体包括：各AP的缺失率权值通过下式计算得到：式中，表示第i个AP的缺失率权值，表示第i个AP基于缺失率的得票数；M表示参考点总数；各AP的波动性权值通过下式计算得到：式中，第i个AP的波动性权值，表示第i个AP基于波动性的得票数。进一步地，初始相似度Dj用待定位点RSSI信号与可靠指纹的欧式距离表示；指纹相似度D′j根据K个可靠的AP的最终权值和初始相似度计算得到：式中，W′i表示第i个AP的最终权值；前T个参考点中第j个参考点的权重wj计算公式如下：待定位点的坐标计算公式如下：其中，表示选择的前T个参考点中第j个参考点的坐标。进一步地，所述根据指纹数据库可靠性更新指纹数据库包括：检测机制：利用已有的指纹数据库中指纹计算某个已知的位置坐标，通过多次计算该位置的估计位置与真实位置之间的误差δi，若该误差大于预设的误差阈值，则指纹数据库不可靠，进入更新机制；更新机制：重新计算AP的缺失率和波动性，进行保存，并返回检测机制步骤；若重新计算得到的误差小于预设的误差阈值，则此次更新有效，保留更新结果到指纹数据库。有益效果本发明提出了一种基于可靠AP选择的WIFI室内定位方法，在离线阶段，采集待定位区域内各参考点的RSSI信号，将RSSI信号作为位置指纹，构建指纹数据库；在检测更新阶段，将AP的缺失率和波动性引入动态投票机制，根据需求检测AP可靠性；在线阶段，采集待定位点的RSSI信号，与指纹数据库中可靠的指纹信息进行匹配，计算待定位点的位置坐标。该方法引入动态投票机制，利用AP缺失率和波动性，实时选取环境当中可靠的AP用于位置估计，提高可靠AP的使用率，降低不可靠的AP对定位造成的误差，从而提高定位精度，有效的降低定位误差。另一方面，保证系统的有效性，根据动态投票机制控制指纹数据库更新次数，从而解决定位精度和系统的开销之间的均衡矛盾。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明实施例提供的基于可靠AP选择的WIFI室内定位方法的流程图。具体实施方式为使本发明的目的、技术方案和优点更加清楚，下面将对本发明的技术方案进行详细的描述。显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动的前提下所得到的所有其它实施方式，都属于本发明所保护的范围。如图1所示，本发明实施例提供了一种基于可靠AP选择的WIFI室内定位方法，主要包括离线阶段、检测更新阶段和在线阶段，具体如下。离线阶段：采集待定位区域内各参考点的RSSI信号作为指纹信息，构建指纹数据库。S1：将待定位区域按照一定的距离划分为若干网格，每一个网格点作为一个参考点；将待定位区域抽象成一个二维平面，建立坐标系；如将待定位区域划分为M＝m*p个正方形网格，每个参考点的位置以坐标形式表示；设定待定位区域内有L个AP，AP的摆放形式不固定。S2：在每个参考点处采集来自各个AP的RSSI信号，共q次。为了保证信号有效性，本实施例采取了多次采集计算其平均值的方式，由此得到各参考点的RSSI信号的平均值作为对应参考点最终的RSSI信号，形成初始指纹数据库。其中，第j个参考点的第i个AP的RSSI信号的均值rssii,j可通过如下公式计算得到：其中，rssii,j表示在第j个参考点第τ次采集到的第i个AP的RSSI信号。S3：基于采集的数据拓展初始指纹数据库，构建指纹数据库。指纹数据库包括：各AP的坐标，参考点坐标，RSSI信号ψ，RSSI的波动矩阵SD，AP的缺失率矩阵LR，本实施例中，还包括参考点之间的距离矩阵D，波动程度的投票矩阵Vsd，基于缺失率的投票矩阵Vlr，具体表示为：。其中，RSSI信号ψ，具体表示为：AP的缺失率矩阵LR包括每个参考点处各AP的缺失率，具体表示为：式中，lri,j表示在第j个参考点处获取到第i个AP的缺失率。每个参考点处各AP的缺失率通过在每个参考点处连续扫描各AP相同的次数N并记录接到来自各AP的RSSI值的次数n确定；lri,j具体表示为：lri,j＝/N。RSSI的波动矩阵SD包括每个参考点处得到各AP的一组连续RSSI值的波动性；所述波动性用这一组RSSI值的标准差表示。RSSI的波动矩阵SD具体表示为：第j个参考点处获取到第i个AP的一组RSSI信号的波动性为sdi,j，其具体计算公式如下：式中，q表示在参考点处接收到AP的RSSI信号的样本数，φi,j表示在第j个参考点第τ次采集到的第i个AP的RSSI信号样本值，表示在第j个参考点采集到的第i个AP的RSSI信号样本值的平均值。波动程度的投票矩阵Vsd为波动性阈值矩阵，基于缺失率的投票矩阵Vlr为缺失率阈值矩阵。检测更新阶段：将AP的缺失率和波动性引入动态投票机制，检测各AP的可靠性并选择可靠的AP，以及根据指纹数据库可靠性更新指纹数据库。具体包括：S4：实时计算各参考点处来自各个AP的缺失率，以及实时计算各AP在不同的参考点处采集到的一组连续RSSI信号的波动性。S5：将AP的缺失率和波动性纳入动态投票机制，对各AP进行投票。票数越多，说明该AP在该参考点处越不可靠，其信号越不稳定。动态投票机制统计在预设时间周期内，所有时刻的投票情况，由此可得到随时间变化的动态结果。该动态结果还可用于分析前后相关性。具体包括：基于缺失率对AP进行投票，在预设时间周期内，当参考点处在当前时刻某一AP的缺失率大于预先设定的缺失率阈值Δlr，则认为当前时刻该AP在此参考点处不可靠，对该AP自动计入一次投票；其中缺失率阈值Δlr可以人为设定；基于波动性对AP进行投票，在预设时间周期内，当参考点处当前时刻某一AP的波动性大于设定的波动性阈值，则认为当前时刻该AP在此参考点处不可靠，对该AP自动计入一次投票。具体地，当前时刻波动性矩阵SD′具体表示为：若当前时刻第j个参考点采集到的第i个AP的RSSI信号的波动性sd′i,j满足sd′i,j＞sdi,j+Δsd，则认为第i个AP是不可靠的，对第i个AP自动计入一次投票，其中Δsd是信任阈值，可以人为设定。S6：根据各AP的投票结果，计算各AP对应的缺失率权值和波动性权值。即投票结果的判定方式按照权重定量，将得票数转换成权重。具体包括：缺失率权值计算公式如下：其中，表示第i个AP的缺失率权值，即反应可靠程度，表示第i个AP基于缺失率的得票数，M表示参考点总数；波动性权值计算公式如下：其中，表示第i个AP的波动性权值，即反应稳定程度，表示第i个AP基于波动性的得票数。S7：利用得到的各AP的权值，按照降序排序，选取前K个可靠的AP，K为预设值。S8：根据选取的前K个可靠的AP的缺失率权值和波动性权值，计算前K个可靠的AP的最终权值。第i个AP的最终权值W′i计算公式为：在线阶段：采集待定位点的RSSI信号，与指纹数据库中可靠的指纹信息进行匹配，得到待定位点的位置信息。S9：采集待定位点RSSI信号，计算其与指纹数据库中可靠的指纹信息的初始相似度；所述可靠的指纹信息为K个可靠AP的RSSI值构成的指纹。具体地：初始相似度Dj用待定位点RSSI信号与可靠指纹的欧式距离表示。选取待定位点处的K个可靠AP的RSSI信号，表示为；第j个参考点处可靠的指纹信息即K个可靠AP的RSSI信号，表示为；则初始相似度Dj计算公式如下：其中，Dj表示待定位点与第j个参考点的初始相似度。S10：根据K个可靠的AP的最终权值和初始相似度，计算得到待定位点RSSI信号与可靠的指纹信息的指纹相似度。指纹相似度计算公式如下：式中，D′j表示待定位点与第j个参考点的指纹相似度。S11：将指纹相似度进行升序排序，选择前T个参考点，并计算前T个参考点的权重；其中，T为预设值。第j个参考点的权重计算公式如下：其中，wj′表示第j个参考点的权重。S12：基于T个参考点的坐标及权重计算得到待定位点的坐标。具体计算公式如下：其中，表示定位点的坐标，为对应的选取的T个可靠参考点中第j个参考点的坐标。本实施例中，所述根据指纹数据库可靠性更新指纹数据库包括：检测机制：利用已有的指纹数据库中指纹计算某个已知的位置坐标，通过多次计算该位置的估计位置与真实位置之间的误差δi，若该误差δi大于预设的误差阈值T，则指纹数据库不可靠，进入更新机制；其中，误差δi计算公式如下：更新机制：重新计算AP的缺失率和波动性，进行保存，并返回检测机制步骤；若重新计算得到的误差δi小于预设的误差阈值T，则此次更新有效，保留更新结果到指纹数据库。流程图中或在此以其他方式描述的任何过程或方法描述可以被理解为，表示包括一个或更多个用于实现特定逻辑功能或过程的步骤的可执行指令的代码的模块、片段或部分，并且本发明的优选实施方式的范围包括另外的实现，其中可以不按所示出或讨论的顺序，包括根据所涉及的功能按基本同时的方式或按相反的顺序，来执行功能，这应被本发明的实施例所属技术领域的技术人员所理解。尽管上面已经示出和描述了本发明的实施例，可以理解的是，上述实施例是示例性的，不能理解为对本发明的限制，本领域的普通技术人员在本发明的范围内可以对上述实施例进行变化、修改、替换和变型。
