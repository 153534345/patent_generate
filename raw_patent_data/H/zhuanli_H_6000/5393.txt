标题title
动态范围控制方法、电路、音频处理芯片及扬声器系统
摘要abst
本申请涉及一种动态范围控制方法、电路、音频处理芯片及扬声器系统。所述方法包括：设置有效值检测时间的初值；根据有效值检测时间的初值对输入信号进行有效值检测，得到信号有效值；根据信号有效值和预设参数阈值调整有效值检测时间；根据调整后的有效值检测时间继续对输入信号进行有效值检测，得到有效值检测时间调整后的信号有效值；根据有效值检测时间调整后的信号有效值和预设参数阈值进行动态增益调整，根据预设参数启动时间和释放时间对调整后的增益进行平滑，再将平滑后的增益作用于输入信号，得到输出信号。本方法是能动态调整有效检测时间的动态范围控制的方法，采用本方法能发挥出扬声器系统和功放的最大性能。
权利要求书clms
1.一种动态范围控制方法，其特征在于，所述方法包括：设置有效值检测时间的初值；根据有效值检测时间的初值对输入信号进行有效值检测，得到信号有效值；根据所述信号有效值和预设参数阈值调整所述有效值检测时间；根据调整后的有效值检测时间继续对所述输入信号进行有效值检测，得到有效值检测时间调整后的信号有效值；根据有效值检测时间调整后的信号有效值和所述预设参数阈值进行动态增益调整，根据预设的启动时间和释放时间对调整后的增益进行平滑，再将平滑后的增益作用于所述输入信号，得到输出信号。2.根据权利要求1所述的方法，其特征在于，根据所述信号有效值和预设参数阈值调整所述有效值检测时间，包括：设置第一权重系数和第二权重系数；将所述第一权重系数和所述第二权重系数分别与预设参数阈值相乘，得到第一信号值和第二信号值；其中，0≤第一权重系数＜第二权重系数；将所述第一信号值和所述第二信号值与所述信号有效值进行比较，并根据比较结果和三个预设时间参数，得到调整后的有效值检测时间。3.根据权利要求2所述的方法，其特征在于，将所述第一信号值和所述第二信号值与所述信号有效值进行比较，并根据比较结果和三个预设时间参数，得到调整后的有效值检测时间，包括：将所述第一信号值和所述第二信号值与所述信号有效值进行比较；当所述信号有效值小于等于所述第一信号值时，则调整后的所述有效值检测时间为第一预设时间参数；当所述信号有效值大于等于所述第二信号值时，则调整后的所述有效值检测时间为第三预设时间参数；当所述信号有效值大于所述第一信号值并且小于所述第二信号值时，则根据第二预设时间参数和所述信号有效值，确定调整后的所述有效值检测时间。4.根据权利要求3所述的方法，其特征在于，当所述信号有效值大于所述第一信号值并且小于所述第二信号值时，则根据第二预设时间参数和所述信号有效值，确定调整后的所述有效值检测时间，包括：当所述信号有效值大于所述第一信号值并且小于所述第二信号值时，则通过对函数f进行设置，得到调整后的所述有效值检测时间；其中函数f为第二预设时间参数和所述信号有效值的函数，f与信号有效值负相关，f与第二预设时间参数正相关，T2为第二预设时间参数，A为信号有效值。5.一种动态范围控制电路，其特征在于，所述电路包括：有效值检测模块、有效值检测时间控制模块以及动态范围控制模块；所述有效值检测模块，用于根据有效值检测时间的预设初值对输入信号进行有效值检测，得到信号有效值，并将所述信号有效值发送到所述有效值检测时间控制模块；还用于根据调整后的有效值检测时间对所述输入信号进行有效值检测，得到调整有效值检测时间后的信号有效值，并将调整有效值检测时间后的信号有效值发送至所述动态范围控制模块中；所述有效值检测时间控制模块，用于接收所述信号有效值，并根据所述信号有效值和预设参数阈值调整所述有效值检测时间，并将调整后的所述有效值检测时间发送至所述有效值检测模块；所述动态范围控制模块，用于根据接收的有效值检测时间调整后的信号有效值和所述预设参数阈值进行动态增益调整，根据预设的启动时间和释放时间对调整后的增益进行平滑，再将平滑后的增益作用于所述输入信号，得到输出信号。6.根据权利要求5所述的电路，其特征在于，所述有效值检测时间控制模块包括：两个乘法器和一个有效值检测时间计算模块；第一个所述乘法器，用于将第一权重系数和预设参数阈值相乘，得到第一信号值，并将第一信号值传输到所述有效值检测时间计算模块；第二个所述乘法器，用于将第二权重系数和预设参数阈值相乘，得到第二信号值，并将第二信号值传输到所述有效值检测时间计算模块；其中，0≤第一权重系数＜第二权重系数；所述有效值检测时间计算模块，用于将所述第一信号值和所述第二信号值与所述信号有效值进行比较，并根据比较结果和三个预设时间参数，得到调整后的有效值检测时间，并将调整后的有效值检测时间传输至所述有效值检测模块。7.根据权利要求6所述的电路，其特征在于，所述有效值检测时间计算模块，还用于将所述第一信号值和所述第二信号值与所述信号有效值进行比较；当所述信号有效值小于等于所述第一信号值时，则调整后的所述有效值检测时间为第一预设时间参数；当所述信号有效值大于等于所述第二信号值时，则调整后的所述有效值检测时间为第三预设时间参数；当所述信号有效值大于所述第一信号值并且小于所述第二信号值时，则根据第二预设时间参数和所述信号有效值，确定调整后的所述有效值检测时间。8.根据权利要求7所述的电路，其特征在于，所述有效值检测时间计算模块，还用于当所述信号有效值大于所述第一信号值并且小于所述第二信号值时，则通过对函数f进行设置，得到调整后的所述有效值检测时间；其中函数f为第二预设时间参数和所述信号有效值的函数，f与信号有效值负相关，f与第二预设时间参数正相关，T2为第二预设时间参数，A为信号有效值。9.一种音频处理芯片，其特征在于，所述音频处理芯片包括：权利要求5-8任一项所述的动态范围控制电路。10.一种扬声器系统，其特征在于，所述扬声器系统包括：权利要求9所述的音频处理芯片。
说明书desc
技术领域本申请涉及音频信号处理技术领域，特别是涉及一种动态范围控制方法、电路、音频处理芯片及扬声器系统。背景技术不同的扬声器系统所能承受的功率不一，需要音频功放不同的动态范围控制。动态范围控制，通过对输入信号进行有效值检测，根据噪声门限、压缩比和阈值等计算所输入信号的增益，然后根据启动时间和释放时间对增益进行平滑，最后将平滑得到的增益应用于输入信号。传统的有效值检测方法，采用某一固定的检测时间。不管输入信号多大，有效值检测算法在固定的时间内估算出输入信号的有效值，当输入信号的有效值超出所设定的阈值，则对输入信号的幅值进行压缩输出。同一扬声器系统，对不同的输入信号功率，其能保持正常工作时长不一。一般情况下，随着输入信号功率的增大，扬声器系统所能保持正常工作时长会相应的减小。当输入信号的功率大于阈值但小于某一值时，该扬声器系统所能正常工作的时长远超出有效值检测时间，不能完全发挥出该扬声器系统的重放能力。当输入信号的功率超出某一值时，该扬声器系统在有效值检测时间内可能就已经损坏了。功放由于散热等问题，随着工作功率的增大，其能保持正常工作的时长也会相应的减小。发明内容基于此，有必要针对上述技术问题，提供一种动态范围控制方法、电路、音频处理芯片及扬声器系统。一种动态范围控制方法，该方法包括：设置有效值检测时间的初值。根据有效值检测时间的初值对输入信号进行有效值检测，得到信号有效值。根据信号有效值和预设参数阈值调整有效值检测时间。根据调整后的有效值检测时间继续对输入信号进行有效值检测，得到有效值检测时间调整后的信号有效值。根据有效值检测时间调整后的信号有效值和预设参数阈值进行动态增益调整，根据预设的启动时间和释放时间对调整后的增益进行平滑，再将平滑后的增益作用于输入信号，得到输出信号。在其中一个实施例中，根据信号有效值和预设参数阈值调整有效值检测时间，包括：设置第一权重系数和第二权重系数。将第一权重系数和第二权重系数分别与预设参数阈值相乘，得到第一信号值和第二信号值；其中，0≤第一权重系数＜第二权重系数。将第一信号值和第二信号值与信号有效值进行比较，并根据比较结果和三个预设时间参数，得到调整后的有效值检测时间。在其中一个实施例中，将第一信号值和第二信号值与信号有效值进行比较，并根据比较结果和三个预设时间参数，得到调整后的有效值检测时间，包括：将第一信号值和第二信号值与信号有效值进行比较。当信号有效值小于等于第一信号值时，则调整后的有效值检测时间为第一预设时间参数。当信号有效值大于等于第二信号值时，则调整后的有效值检测时间为第三预设时间参数。当信号有效值大于第一信号值并且小于第二信号值时，则根据第二预设时间参数和信号有效值，确定调整后的有效值检测时间。在其中一个实施例中，当信号有效值大于第一信号值并且小于第二信号值时，则根据第二预设时间参数和信号有效值，确定调整后的有效值检测时间，包括：当信号有效值大于第一信号值并且小于第二信号值时，则通过对函数f进行设置，得到调整后的有效值检测时间；其中函数f为第二预设时间参数和信号有效值的函数，f与信号有效值负相关，f与第二预设时间参数正相关，T2为第二预设时间参数，A为信号有效值。一种动态范围控制电路，电路包括：有效值检测模块、有效值检测时间控制模块以及动态范围控制模块。有效值检测模块，用于根据有效值检测时间的预设初值对输入信号进行有效值检测，得到信号有效值，并将信号有效值发送到有效值检测时间控制模块；还用于根据调整后的有效值检测时间对输入信号进行有效值检测，得到调整有效值检测时间后的信号有效值，并将调整有效值检测时间后的信号有效值发送至动态范围控制模块中。有效值检测时间控制模块，用于接收信号有效值，并根据信号有效值和预设参数阈值调整有效值检测时间，并将调整后的有效值检测时间发送至有效值检测模块。动态范围控制模块，用于根据接收的有效值检测时间调整后的信号有效值和预设参数阈值进行动态增益调整，并根据预设的启动时间和释放时间对调整后的增益进行平滑，再将平滑后的增益作用于输入信号，得到输出信号。在其中一个实施例中，有效值检测时间控制模块包括：两个乘法器和一个有效值检测时间计算模块。第一个乘法器，用于将第一权重系数和预设参数阈值相乘，得到第一信号值，并将第一信号值传输到有效值检测时间计算模块。第二个乘法器，用于将第二权重系数和预设参数阈值相乘，得到第二信号值，并将第二信号值传输到有效值检测时间计算模块；其中，0≤第一权重系数＜第二权重系数。有效值检测时间计算模块，用于将第一信号值和第二信号值与信号有效值进行比较，并根据比较结果和三个预设时间参数，得到调整后的有效值检测时间，并将调整后的有效值检测时间传输至有效值检测模块。在其中一个实施例中，有效值检测时间计算模块，还用于将第一信号值和第二信号值与信号有效值进行比较；当信号有效值小于等于第一信号值时，则调整后的有效值检测时间为第一预设时间参数；当信号有效值大于等于第二信号值时，则调整后的有效值检测时间为第三预设时间参数；当信号有效值大于第一信号值并且小于第二信号值时，则根据第二预设时间参数和信号有效值，确定调整后的有效值检测时间。在其中一个实施例中，有效值检测时间计算模块，还用于当信号有效值大于第一信号值并且小于第二信号值时，则通过对函数f进行设置，得到调整后的有效值检测时间；其中函数f为第二预设时间参数和信号有效值的函数，f与信号有效值负相关，f与第二预设时间参数正相关，T2为第二预设时间参数，A为信号有效值。一种音频处理芯片，音频处理芯片包括上述任一动态范围控制电路。一种扬声器系统，扬声器系统包括上述音频处理芯片。上述动态范围控制方法、电路、音频处理芯片及扬声器系统，所述方法包括：设置有效值检测时间的初值；根据有效值检测时间的初值对输入信号进行有效值检测，得到信号有效值；根据信号有效值和预设参数阈值调整有效值检测时间；根据调整后的有效值检测时间继续对输入信号进行有效值检测，得到有效值检测时间调整后的信号有效值；根据有效值检测时间调整后的信号有效值和预设参数阈值进行动态增益调整，根据预设的启动时间和释放时间对调整后的增益进行平滑，再将平滑后的增益作用于输入信号，得到输出信号。本方法是能动态调整有效检测时间的动态范围控制的方法，采用本方法能发挥出扬声器系统和功放的最大性能。附图说明图1为一个实施例中动态范围控制方法的流程示意图；图2为一个实施例中动态范围控制电路原理框图；图3为另一个实施例中动态范围控制电路框图；图4为另一个实施例中输入信号的功率与其触发动态范围控制模块工作所用时间的关系；图5为一个实施例中三个不同输入信号功率所对应的输出信号功率随时间变化的关系，其中为输入信号的功率为Pin1时对应的输出信号功率随时间变化的关系，为输入信号的功率为Pin2时对应的输出信号功率随时间变化的关系，为输入信号的功率为Pin3时对应的输出信号功率随时间变化的关系；图6为一个实施例中传统算法动态范围控制模块三个不同输入信号幅值所对应的输出信号有效值随时间变化的关系，其中为输入信号的功率为Pin11时对应的输出信号功率随时间变化的关系，为输入信号的功率为Pin21时对应的输出信号功率随时间变化的关系，为输入信号的功率为Pin31时对应的输出信号功率随时间变化的关系。具体实施方式为了使本申请的目的、技术方案及优点更加清楚明白，以下结合附图及实施例，对本申请进行进一步详细说明。应当理解，此处描述的具体实施例仅仅用以解释本申请，并不用于限定本申请。在一个实施例中，如图1所示，提供了一种动态范围控制方法，该方法包括以下步骤：步骤100：设置有效值检测时间的初值。步骤102：根据有效值检测时间的初值对输入信号进行有效值检测，得到信号有效值。步骤104：根据信号有效值和预设参数阈值调整有效值检测时间。具体的，预设参数阈值是用户根据实际需求进行设置的。步骤106：根据调整后的有效值检测时间继续对输入信号进行有效值检测，得到有效值检测时间调整后的信号有效值。步骤108：根据有效值检测时间调整后的信号有效值和预设参数阈值进行动态增益调整，根据预设的启动时间和释放时间对调整后的增益进行平滑，再将平滑后的增益作用于输入信号，得到输出信号。上述动态范围控制方法中，所述方法包括：设置有效值检测时间的初值；根据有效值检测时间的初值对输入信号进行有效值检测，得到信号有效值；根据信号有效值和预设参数阈值调整有效值检测时间；根据调整后的有效值检测时间继续对输入信号进行有效值检测，得到有效值检测时间调整后的信号有效值；根据有效值检测时间调整后的信号有效值和预设参数阈值进行动态增益调整，根据预设的启动时间和释放时间对调整后的增益进行平滑，再将平滑后的增益作用于输入信号，得到输出信号。本方法是能动态调整有效检测时间的动态范围控制的方法，采用本方法能发挥出扬声器系统和功放的最大性能。在其中一个实施例中，步骤104包括：设置第一权重系数和第二权重系数；将第一权重系数和第二权重系数分别与预设参数阈值相乘，得到第一信号值和第二信号值；其中，0≤第一权重系数＜第二权重系数；将第一信号值和第二信号值与信号有效值进行比较，并根据比较结果和三个预设时间参数，得到调整后的有效值检测时间。在其中一个实施例中，将第一信号值和第二信号值与信号有效值进行比较，并根据比较结果和三个预设时间参数，得到调整后的有效值检测时间，包括：将第一信号值和第二信号值与信号有效值进行比较；当信号有效值小于等于第一信号值时，则调整后的有效值检测时间为第一预设时间参数；当信号有效值大于等于第二信号值时，则调整后的有效值检测时间为第三预设时间参数；当信号有效值大于第一信号值并且小于第二信号值时，则根据第二预设时间参数和信号有效值，确定调整后的有效值检测时间。在其中一个实施例中，当信号有效值大于第一信号值并且小于第二信号值时，则根据第二预设时间参数和信号有效值，确定调整后的有效值检测时间，包括：当信号有效值大于第一信号值并且小于第二信号值时，则通过对函数f进行设置，得到调整后的有效值检测时间；其中函数f为第二预设时间参数和信号有效值的函数，f与信号有效值负相关，f与第二预设时间参数正相关，T2为第二预设时间参数，A为信号有效值。应该理解的是，虽然图1的流程图中的各个步骤按照箭头的指示依次显示，但是这些步骤并不是必然按照箭头指示的顺序依次执行。除非本文中有明确的说明，这些步骤的执行并没有严格的顺序限制，这些步骤可以以其它的顺序执行。而且，图1中的至少一部分步骤可以包括多个子步骤或者多个阶段，这些子步骤或者阶段并不必然是在同一时刻执行完成，而是可以在不同的时刻执行，这些子步骤或者阶段的执行顺序也不必然是依次进行，而是可以与其它步骤或者其它步骤的子步骤或者阶段的至少一部分轮流或者交替地执行。在一个实施例中，如图2所示，提供了一种动态范围控制电路，电路包括：有效值检测模块20、有效值检测时间控制模块30以及动态范围控制模块40；其中：有效值检测模块20，用于根据有效值检测时间的预设初值对输入信号进行有效值检测，得到信号有效值，并将信号有效值发送到有效值检测时间控制模块30；还用于根据调整后的有效值检测时间对输入信号进行有效值检测，得到调整有效值检测时间后的信号有效值，并将调整有效值检测时间后的信号有效值发送至动态范围控制模块40中。有效值检测时间控制模块30，用于接收信号有效值，并根据信号有效值和预设参数阈值调整有效值检测时间，并将调整后的有效值检测时间发送至有效值检测模块20。动态范围控制模块40，用于根据接收的有效值检测时间调整后的信号有效值和预设参数阈值进行动态增益调整，再根据预设的启动时间和释放时间对调整后的增益进行平滑，将平滑后的增益作用于输入信号，得到输出信号。在其中一个实施例中，如图3所示，有效值检测时间控制模块30包括：两个乘法器301和一个有效值检测时间计算模块302。第一个乘法器301，用于将第一权重系数和预设参数阈值相乘，得到第一信号值，并将第一信号值传输到有效值检测时间计算模块302。第二个乘法器301，用于将第二权重系数和预设参数阈值相乘，得到第二信号值，并将第二信号值传输到有效值检测时间计算模块302；其中，0≤第一权重系数＜第二权重系数。有效值检测时间计算模块302，用于将第一信号值和第二信号值与信号有效值进行比较，并根据比较结果和三个预设时间参数，得到调整后的有效值检测时间，并将调整后的有效值检测时间传输至有效值检测模块20。具体的，图3中有效值检测模块20的输入参数包括：输入信号、有效值检测时间T；有效值检测模块20用于根据输入信号和有效检测时间计算输入信号的有效值A并输出。动态范围控制模块40的输入参数包括：启动时间、释放时间、预设参数阈值、输入信号的有效值A；动态范围控制模块40用于根据输入参数对输入信号的动态增益进行处理并输出。有效值检测时间控制模块30，包括两个乘法器301和一个有效值检测时间计算模块302。第一个乘法器301的输入参数包括：权重系数w1、预设参数阈值，输出值为，其中/＞为预设参数阈值。第二个乘法器301的输入参数包括：权重系数w2、预设参数阈值，输出值为。有效值检测时间计算模块302的输入参数包括：输入信号有效值A、输出值B、输出值C以及三个时间参数T1、T2和T3，通过对输入参数进行如下式的处理并输出调整后的有效值检测时间参数T到有效值检测模块20。调整后的有效值检测时间T的表达式为：；其中，，/＞，/＞，f为T2和A的函数，f与T2正相关，f与A负相关。T1、T2、T3是用户调试参数，为一常数。下面列举三种f与A的关系：关系一：；其中/＞为一常数，且。关系二：。关系三：；其中/＞为一常数，且/＞。参数的具体解释：T1是有效值检测模块初始化的预设初值，也是当输入信号有效值A小于等于输出值B时，赋予有效值检测模块的有效值检测时间值。T2与w1和w2是输入信号的不同功率触发动态范围控制模块工作所用时间的主要决定因素，当f的函数确定之后，通过调整T2与w1和w2的值来调整输入信号的不同功率触发动态范围控制模块工作所用时间。T3是当A大于等于C时赋予有效值检测模块的有效值检测时间值，用户可以通过调整T3和w2的值，来调整动态范围控制器的实际启动时间。在其中一个实施例中，有效值检测时间计算模块302，还用于将第一信号值和第二信号值与信号有效值进行比较；当信号有效值小于等于第一信号值时，则调整后的有效值检测时间为第一预设时间参数；当信号有效值大于等于第二信号值时，则调整后的有效值检测时间为第三预设时间参数；当信号有效值大于第一信号值并且小于第二信号值时，则根据第二预设时间参数和信号有效值，确定调整后的有效值检测时间。在其中一个实施例中，有效值检测时间计算模块302，还用于当信号有效值大于第一信号值并且小于第二信号值时，则通过对函数f进行设置，得到调整后的有效值检测时间；其中函数f为第二预设时间参数和信号有效值的函数，f与信号有效值负相关，f与第二预设时间参数正相关，T2为第二预设时间参数，A为信号有效值。图4为输入信号的功率与其触发动态范围控制模块工作所用时间的关系。当输入信号的功率大于动态范围控制模块阈值所对应的限制功率时，则触发动态范围控制模块对输入信号进行增益控制。随着输入信号的功率的增大，触发动态范围控制模块工作所用的时间越短。触发动态范围控制模块工作所需的时间和输入信号的功率的关系，由图4所示的曲线1、曲线2、曲线3三种常见走势，可以通过设置函数f来实现。走势曲线1对应关系三；走势曲线2对应关系二；走势曲线3对应关系一。图5为三个不同输入信号的功率Pin1、Pin2、Pin3，其对应的动态范围控制模块输出信号的功率Pout1、Pout2、Pout3随时间变化的关系，其中为输入信号的功率为Pin1时对应的输出信号功率随时间变化的关系，为输入信号的功率为Pin2时对应的输出信号功率随时间变化的关系，为输入信号的功率为Pin3时对应的输出信号功率随时间变化的关系。当时间足够大的时候，Pout1=Pout2=Pout3，即输出信号的功率被控制在预设参数阈值所对应的功率。图5中，虚线为输入信号的功率，实线为动态范围控制模块输出信号的功率。随着输入信号功率的增大Pin1＞Pin2＞Pin3，其触发动态范围控制模块工作所用的时间越短。图6为传统算法动态范围控制模块输入信号功率和其对应的输出信号功率随时间变化的关系，其中为输入信号的功率为Pin11时对应的输出信号功率随时间变化的关系，为输入信号的功率为Pin21时对应的输出信号功率随时间变化的关系，为输入信号的功率为Pin31时对应的输出信号功率随时间变化的关系。图6中，虚线为输入信号的功率，实线为动态范围控制模块输出信号的功率。不同功率的输入信号，其触发动态范围控制模块所用的时间相同。在一个实施例中，提供了一种音频处理芯片，音频处理芯片包括上述任一动态范围控制电路。在一个实施例中，提供了一种扬声器系统，扬声器系统包括上述音频处理芯片。以上实施例的各技术特征可以进行任意的组合，为使描述简洁，未对上述实施例中的各个技术特征所有可能的组合都进行描述，然而，只要这些技术特征的组合不存在矛盾，都应当认为是本说明书记载的范围。以上所述实施例仅表达了本申请的几种实施方式，其描述较为具体和详细，但并不能因此而理解为对发明专利范围的限制。应当指出的是，对于本领域的普通技术人员来说，在不脱离本申请构思的前提下，还可以做出若干变形和改进，这些都属于本申请的保护范围。因此，本申请的保护范围应以所附权利要求为准。
