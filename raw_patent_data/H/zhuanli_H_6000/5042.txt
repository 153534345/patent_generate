标题title
一种提高用电信息采集成功率的方法
摘要abst
本发明涉及一种提高用电信息采集成功率的方法，属于信息化领域。本发明中上级节点对下级STA采用批量确认的方式，且批量确认帧中只标记未抄读成功的节点，减少了确认帧的报文数量，进一步减少在大量数据上报时的报文冲突。最后在CCO处，对整个网络进行响应数据接收的确认，保证了所有节点响应数据传输的成功率。本发明采用多种备用手段，首传失败后，采用对备用PCO传输，若仍失败，采取路由修复措施，不仅实现在哪丢包，在哪重传的机制，且可保证为该节点找到与CCO的通路，成功地将数据传输给CCO，相较于原方法，提高了信息采集的成功率。
权利要求书clms
1.一种提高用电信息采集成功率的方法，其特征在于：该方法包括以下步骤：S1：所有节点将响应数据帧发送给上级节点之前都在APP层将其添加至重传列表；上报节点包括下级STA节点和下级PCO节点；S2：上级节点对下级PCO采用点对点的确认方式，即接收到下级PCO的数据帧后立即向其回复ACK帧；其中，ACK帧需要传输到APP层，AAP层需要对重传列表做进一步处理；S3：下级PCO节点若接收到ACK帧，则释放重传列表中相应数据，完成本次传输任务；若未接收到ACK帧，则向备用上级PCO上报本次响应数据；其中，下级PCO节点将响应数据传输给备用上级PCO后，若收到备用上级PCO的ACK帧，则释放重传列表，完成本次传输任务；若未收到备用上级PCO的ACK帧，则启动路由修复流程，即为此节点寻找一条与CCO的通路，通过此路由成功地将相应数据传输到CCO；其中，在网络中每个节点都存在邻居节点，能够获取本节点与邻居节点的通信成功率，邻居节点是CCO或者PCO或者STA；通过通信成功率和路径的因素选择备用上级PCO；S4：上级节点在自身上报时间到时将汇集的数据上报后，构造批量确认报文发送给下级STA节点，批量确认报文中对没有接收到采集响应数据的下级STA节点进行标记，并对标记的下级STA节点的上报数据处于继续接收状态；S5：下级STA节点接收并解析确认帧，若自己没有被标记，则将重传列表中的相应数据转移至备份列表，并释放重传列表中的相应数据；若自己被标记，则重传本次数据；其中，若重传仍然失败，则等待CCO的补点命令；其中，备份列表是为防止在后续的传输中，节点上报的响应数据丢失；以确保CCO补点时还存有原始数据；备份列表中保留近3次的响应数据；S6：CCO将汇集的数据上报给集中器后，对网络中所有节点的响应数据进行完整性的检查；其中，CCO在接收到响应数据后，不对下级直连的STA进行批量确认，直接对全网络未抄读成功的节点进行补点。2.根据权利要求1所述的一种提高用电信息采集成功率的方法，其特征在于：所述上级节点与下级PCO和下级STA的确认方式为：网络中的代理节点PCO，确认自己的数据是否上传成功，对下级节点的数据传输情况进行反馈；对上，PCO将上传的数据添加至重传列表备份，当收到上级节点的确认帧后，再从重传列表中删除；对下，PCO上报完后，构造批量确认报文发送给下级节点，批量确认报文中对没有接收到采集响应数据的下级节点进行标记，并对标记节点的上报数据处于继续接收状态。3.根据权利要求2所述的一种提高用电信息采集成功率的方法，其特征在于：所述PCO将汇集的响应数据上报给上级节点后，与上级PCO的处理流程为：情况1：将汇集的响应数据上报给上级节点后，收到确认帧，则释放重传列表，完成本节点的本次传输任务；情况2：将汇集的响应数据上报给上级节点后，未收到确认帧，并且达到最大重传次数，向备用PCO上报本次响应数据；情况3：将汇集的响应数据上报给备用上级节点后，若收到确认帧，则释放重传列表，完成本次传输任务；若未收到确认帧，则启动路由修复流程，为此节点寻找一条与CCO的通路，通过此路由成功的将相应数据传输到CCO；其中，PCO有一个直连的上级节点，除此之外，在网络中会维护数个备用上级节点，当与直连上级节点的通信失败时，PCO会选择向通信质量最好的备用上级节点进行重传，以确保传输的成功率。4.根据权利要求3所述的一种提高用电信息采集成功率的方法，其特征在于：所述PCO将汇集的响应数据上报给上级节点后的与下级STA的处理流程为：PCO若接收到标记节点的重传报文，继续上报给上级节点；若未接收到标记节点的重传报文，则等待CCO的补点命令再对此下级节点进行抄读。
说明书desc
技术领域本发明属于信息化领域，涉及一种提高用电信息采集成功率的方法。背景技术用户用电信息采集系统是对电力用户的用电信息进行采集、处理和实时监控的系统，可实现计量异地监测、电能质量监测、用电分析和管理、相关信息发布、分布式能源管理、智能用电设备的信息交互等功能，为提高工作效率，为“量价费损、电网改造”等提供基础数据与依据。用户用电信息采集系统的架构如图1所示。用户用电信息采集系统主要由主站、本地通信系统和连接各个设备的通信网络组成，是实现用户用电信息采集的基础。参见图2和图3，本地通信系统通常为树状结构或网状结构，包括一个集中器，多个电能表和通信模块，通信模块分别设置在集中器和各电能表中作为节点，构成用电信息采集系统通信网络。集中器中设置的通信模块为通信网络的中央协调器，在用电信息收集过程中负责启动信息采集业务，发送信息采集条目，接收用电信息数据并发送给集中器。各电能表中设置的通信模块根据在网络中的角色分为通信网络的代理协调器和站点，在用电信息收集过程中，PCO负责接收或转发CCO的信息采集命令，STA将数据发送至电能表，获取该电能表的用电信息并发送给CCO。如图2和图3所示，本地通信系统网络中包括一个CCO和多个STA，STA和CCO之间通过预先设定的路由来进行通信，对于一个具体的STA，其到CCO的路由中的上一级节点即为该STA的PCO，一个PCO下可以有多个STA。最上级的，即第一层STA直接和CCO通信，无需经PCO转发。由于网络拓扑结构的变化，PCO和STA的角色可以互相转换。每个通信模块中又具体包含应用层，数据链路层，物理层。其中数据链路层包含NWK层和MAC层。信息采集的数据是沿着图4所示的虚线方向进行传输的。智能电网中，采集流程为集中器通过CCO向指定的STA发送信息采集命令帧；STA接收到CCO发送的信息采集命令帧后，从该STA对应的电能表依次获取信息采集条目所指定的用电信息数据项，并汇总，构造信息采集响应帧上传给CCO，完成一次数据采集，CCO接收到STA发送的信息采集响应帧后，上报给集中器。通过对电力行业发展与应用的分析，无论是为用电用户提供用电耗能分析、负荷预测预警、电费余额预警等基础服务，还是为电力工作者提供台区异常监测预警、线损治理、设备运维等辅助管理工作，都存在某个时间段内需要采集相同数据项的情况，在此背景下，主站可控制集中器规划一个周期性信息采集任务，CCO和PCO通过信标的方式广播采集任务，所有节点周期性地在自身上报时间到时根据信息采集任务自动上报电能表的相关数据，由PCO汇集下级节点的响应数据后层层上报。这种快速采集方法的示意图如图5所示。为了保证数据采集的可靠性，在通信模块处设置会设置确认与重传机制。传统的确认与重传机制为CCO在接收到集中器的采集命令时，首先由CCO的APP层进行处理，APP层在将传输数据给DATA层之前将构造好的采集命令添加至重传列表并设置一个重传定时器，若在规定时间内接收到指定STA的响应数据，则删除重传定时器和重传列表相应数据；若在规定时间内未接收到指定STA的响应帧，则从APP层重新下发该条命令。若超过最大重传次数后仍未收到指定STA的响应数据，则判定对该节点抄读失败，并放弃本轮对该节点的信息采集。对于通信模块与通信模块之间，DATA层在发送数据之前，会将构造好的数据帧添加至重传列表并设置一个重传定时器，若在规定时间内接收到目的节点发送的确认帧，则删除重传定时器并和重传列表相应数据；若在规定时间内未接收到目的节点的ACK帧，则重传该条数据帧。若超过最大重传次数后都未收到目的节点的ACK帧，则放弃此次传输。由此可见，每相邻两个节点之间的通信就有一次确认机制，若所抄读节点的层级越高，经过PCO转发的次数就越多，每增加1跳，就需要增加4条确认报文，也增加了传输失败的概率，可能导致更多的重传报文，这种重复发送报文的开销就越大，且存在重传仍然失败的情况，并不能保证100％采集成功。因此需要进一步解决重传与确认报文开销大、效率低的问题。发明内容有鉴于此，本发明的目的在于提供一种提高用电信息采集成功率的方法。在节点周期性上报响应数据时，采用批量确认机制及采用主/备中继节点、路由切换和路由修复等方式保证上行报文上传成功。为达到上述目的，本发明提供如下技术方案：一种提高用电信息采集成功率的方法，该方法包括以下步骤：S1：所有节点将响应数据帧发送给上级节点之前都在APP层将其添加至重传列表；上报节点包括下级STA节点和下级PCO节点；S2：上级节点对下级PCO采用点对点的确认方式，即接收到下级PCO的数据帧后立即向其回复ACK帧；其中，ACK帧需要传输到APP层，AAP层需要对重传列表做进一步处理；S3：下级PCO节点若接收到ACK帧，则释放重传列表中相应数据，完成本次传输任务；若未接收到ACK帧，则向备用上级PCO上报本次响应数据；其中，下级PCO节点将响应数据传输给备用上级PCO后，若收到备用上级PCO的ACK帧，则释放重传列表，完成本次传输任务；若未收到备用上级PCO的ACK帧，则启动路由修复流程，即为此节点寻找一条与CCO的通路，通过此路由成功地将相应数据传输到CCO；其中，在网络中每个节点都存在邻居节点，能够获取本节点与邻居节点的通信成功率，邻居节点是CCO或者PCO或者STA；通过通信成功率和路径的因素选择备用上级PCO；S4：上级节点在自身上报时间到时将汇集的数据上报后，构造批量确认报文发送给下级STA节点，批量确认报文中对没有接收到采集响应数据的下级STA节点进行标记，并对标记的下级STA节点的上报数据处于继续接收状态；S5：下级STA节点接收并解析确认帧，若自己没有被标记，则将重传列表中的相应数据转移至备份列表，并释放重传列表中的相应数据；若自己被标记，则重传本次数据；其中，若重传仍然失败，则等待CCO的补点命令；其中，备份列表是为防止在后续的传输中，节点上报的响应数据丢失；以确保CCO补点时还存有原始数据；备份列表中保留近3次的响应数据；S6：CCO将汇集的数据上报给集中器后，对网络中所有节点的响应数据进行完整性的检查；其中，CCO在接收到响应数据后，不对下级直连的STA进行批量确认，直接对全网络未抄读成功的节点进行补点。可选的，所述上级节点与下级PCO和下级STA的确认方式为：网络中的代理节点PCO，确认自己的数据是否上传成功，对下级节点的数据传输情况进行反馈；对上，PCO将上传的数据添加至重传列表备份，当收到上级节点的确认帧后，再从重传列表中删除；对下，PCO上报完后，构造批量确认报文发送给下级节点，批量确认报文中对没有接收到采集响应数据的下级节点进行标记，并对标记节点的上报数据处于继续接收状态。可选的，所述PCO将汇集的响应数据上报给上级节点后，与上级PCO的处理流程为：情况1：将汇集的响应数据上报给上级节点后，收到确认帧，则释放重传列表，完成本节点的本次传输任务；情况2：将汇集的响应数据上报给上级节点后，未收到确认帧，并且达到最大重传次数，向备用PCO上报本次响应数据；情况3：将汇集的响应数据上报给备用上级节点后，若收到确认帧，则释放重传列表，完成本次传输任务；若未收到确认帧，并达到最大重传次数，则启动路由修复流程，即为此节点寻找一条与CCO的通路，通过此路由成功的将相应数据传输到CCO；其中，PCO有一个直连的上级节点，除此之外，在网络中会维护数个备用上级节点，当与直连上级节点的通信失败时，PCO会选择向通信质量最好的备用上级节点进行重传，以确保传输的成功率。可选的，所述PCO将汇集的响应数据上报给上级节点后的与下级STA的处理流程为：PCO若接收到标记节点的重传报文，继续上报给上级节点；若未接收到标记节点的重传报文，则等待CCO的补点命令再对此下级节点进行抄读。本发明的有益效果在于：原有的确认方式，需要点对点的确认，本发明中上级节点对下级STA采用批量确认的方式，且批量确认帧中只标记未抄读成功的节点，减少了确认帧的报文数量，进一步减少在大量数据上报时的报文冲突。最后在CCO处，对整个网络进行响应数据接收的确认，保证了所有节点响应数据传输的成功率。原有的重传机制，重传判断时间长，需要从源头按照原来的路由重传，重传的报文开销和时间开销都很大，且存在重传仍然失败的情况。本发明采用多种备用手段，首传失败后，采用对备用PCO传输，若仍失败，采取路由修复措施，不仅实现在哪丢包，在哪重传的机制，且可保证为该节点找到与CCO的通路，成功地将数据传输给CCO，相较于原方法，提高了信息采集的成功率。本发明的其他优点、目标和特征在某种程度上将在随后的说明书中进行阐述，并且在某种程度上，基于对下文的考察研究对本领域技术人员而言将是显而易见的，或者可以从本发明的实践中得到教导。本发明的目标和其他优点可以通过下面的说明书来实现和获得。附图说明为了使本发明的目的、技术方案和优点更加清楚，下面将结合附图对本发明作优选的详细描述，其中：图1为用电信息采集系统架构；图2为树状网络结构；图3为网状网络结构；图4为信息采集数据传输方向；图5为快速采集方法示意图；图6为确认方式示意图；图7为PCO与上级节点的确认与重传流程；图8为PCO与STA的确认与重传流程；图9为路由修复请求报文传输流程；图10为路由回复报文传输流程；图11为路由回应流程；图12为路由修复链路确认流程。具体实施方式以下通过特定的具体实例说明本发明的实施方式，本领域技术人员可由本说明书所揭露的内容轻易地了解本发明的其他优点与功效。本发明还可以通过另外不同的具体实施方式加以实施或应用，本说明书中的各项细节也可以基于不同观点与应用，在没有背离本发明的精神下进行各种修饰或改变。需要说明的是，以下实施例中所提供的图示仅以示意方式说明本发明的基本构想，在不冲突的情况下，以下实施例及实施例中的特征可以相互组合。其中，附图仅用于示例性说明，表示的仅是示意图，而非实物图，不能理解为对本发明的限制；为了更好地说明本发明的实施例，附图某些部件会有省略、放大或缩小，并不代表实际产品的尺寸；对本领域技术人员来说，附图中某些公知结构及其说明可能省略是可以理解的。本发明实施例的附图中相同或相似的标号对应相同或相似的部件；在本发明的描述中，需要理解的是，若有术语“上”、“下”、“左”、“右”、“前”、“后”等指示的方位或位置关系为基于附图所示的方位或位置关系，仅是为了便于描述本发明和简化描述，而不是指示或暗示所指的装置或元件必须具有特定的方位、以特定的方位构造和操作，因此附图中描述位置关系的用语仅用于示例性说明，不能理解为对本发明的限制，对于本领域的普通技术人员而言，可以根据具体情况理解上述术语的具体含义。请参阅图9～图12，为一种提高用电信息采集成功率的方法。S1：所有节点将响应数据帧发送给上级节点之前都在APP层将其添加至重传列表。其中，上报节点包括STA和PCO，称为下级STA节点和下级PCO节点。S2：上级节点对下级PCO仍然采用点对点的确认方式，即接收到下级PCO的数据帧后立即向其回复ACK帧。与传统方法不同的是，本发明中的ACK帧需要传输到APP层，AAP层需要对重传列表做进一步处理。S3：下级PCO节点若接收到ACK帧，则释放重传列表中相应数据，完成本次传输任务；若未接收到ACK帧，则向备用上级PCO上报本次响应数据。其中，下级PCO节点将响应数据传输给备用上级PCO后，若收到备用上级PCO的ACK帧，则释放重传列表，完成本次传输任务。若未收到备用上级PCO的ACK帧，则启动路由修复流程，即为此节点寻找一条与CCO的通路，通过此路由成功地将相应数据传输到CCO。其中，在网络中每个节点都存在邻居节点，且可获取本节点与邻居节点的通信成功率，邻居节点是CCO，或者是PCO，或者是其他的STA。可通过通信成功率和路径等因素选择备用上级PCO。S4：上级节点在自身上报时间到时将汇集的数据上报后，构造批量确认报文发送给下级STA节点，批量确认报文中对没有接收到采集响应数据的下级STA节点进行标记，并对标记的下级STA节点的上报数据处于继续接收状态。S5：下级STA节点接收并解析确认帧，若自己没有被标记，则将重传列表中的相应数据转移至备份列表，并释放重传列表中的相应数据；若自己被标记，则重传此次数据。其中，若重传仍然失败，则等待CCO的补点命令。其中，备份列表是为了防止在后续的传输中，节点的此次上报的响应数据丢失，确保CCO补点时还存有原始数据。备份列表中只需要保留近3次的响应数据。S6：CCO将汇集的数据上报给集中器后，对网络中所有节点的响应数据进行完整性的检查。其中，CCO是特殊的上级节点，在接收到响应数据后，不需要对下级直连的STA进行批量确认，而是直接对全网络未抄读成功的节点进行补点。上级节点与下级PCO和下级STA的确认方式的示意图如图6所示。网络中的代理节点PCO，不仅需要确认自己的数据是否上传成功，也需要对下级节点的数据传输情况进行反馈。即对上，PCO需要将上传的数据添加至重传列表备份，当收到上级节点的确认帧后，再从重传列表中删除。对下，PCO上报完后，构造批量确认报文发送给下级节点，批量确认报文中对没有接收到采集响应数据的下级节点进行标记，并对标记节点的上报数据处于继续接收状态。PCO将汇集的响应数据上报给上级节点后与上级PCO的处理流程如图7所示。图7中，讨论了PCO的三种情况。将汇集的响应数据上报给上级节点后，收到确认帧，则释放重传列表，完成本节点的本次传输任务。将汇集的响应数据上报给上级节点后，未收到确认帧，并且达到最大重传次数，向备用PCO上报本次响应数据。将汇集的响应数据上报给备用上级节点后，若收到确认帧，则释放重传列表，完成本次传输任务；若未收到确认帧，并达到最大重传次数，则启动路由修复流程，即为此节点寻找一条与CCO的通路，通过此路由成功的将相应数据传输到CCO。其中，PCO有一个直连的上级节点，除此之外，在网络中会维护数个备用上级节点，当与直连上级节点的通信失败时，PCO会选择向通信质量最好的备用上级节点进行重传，以确保传输的成功率。PCO将汇集的响应数据上报给上级节点后的与下级STA的处理流程如图8所示。如图8所示，PCO若接收到标记节点的重传报文，可继续上报给上级节点。若未接收到标记节点的重传报文，则等待CCO的补点命令再对此下级节点进行抄读。实施例1：确认帧格式本发明有两种确认帧，一种是上级节点对下级PCO的点对点确认帧，一种是上级节点对下级STA的批量确认帧。其中上级节点对下级PCO的点对点确认帧格式如表1所示。表1 ACK帧格式前四个字节及最后三个字节为类似帧的统一帧格式，字节4-12为ACK帧的内容。其中，接收结果，表示传输的SOF帧的接收结果，接收结果的取值和解释如表2所示。表2接收结果值值定义0表示SOF帧全部接收成功。1表示SOF帧的物理块存在循环冗余校验失败的情形。其他保留接收状态是一个4比特的字段，用来表示普通模式时，SOF帧的物理块的校验结果。一个SOF帧最多可以携带4个物理块，每一个比特，表示一个物理块是否校验成功，比特0表示序列号为0的物理块的校验结果，比特1表示序列号为1的物理块的校验结果，其余类推，接收状态的比特位为0时，则表示对应的物理块校验失败，比特位为1时，则表示对应的物理块校验成功。源TEI是一个12比特字段，表示为ACK帧的源终端的TEI，其中，TEI为每个节点在入网时CCO为其分配的节点唯一标识。目的TEI是一个12比特字段，表示为ACK帧的目的终端的TEI。接收物理块个数为接收的物理块个数，包括解析错误的物理块个数。信道质量，表示站点在接收本帧所对应的SOF报文时，计算得到的信道质量。信道质量用原始信噪比数据表示。站点负载，表示ACK帧的源站点的负载，取值为该源站点上未发送的缓存报文的数量。扩展帧类型，表示在定界符类型之上，所扩展定义的帧类型，含义如表3所示。表3扩展帧类型值说明0表示为ACK帧。1表示为批量确认帧其他保留其中上级节点对下级STA的批量确认帧在ACK帧的基础上有所变化。目的TEI不再是确定的节点TEI，而是将12个比特全置为1，表示对下级节点广播此条批量确认帧。其扩展帧类型标识为1，表示此帧为批量确认帧。在扩展帧类型字段与帧控制校验序列中间标记未抄读成功的节点信息，如表4所示。表4未抄读成功节点信息抄读失败节点数量n失败节点1的TEI……失败节点n的TEI实施例2：路由修复如果节点在通过备用PCO都无法将响应数据上传成功，则选择路由修复，当即为该节点找到与CCO的通路。当节点确认需要发起路由修复时，以广播的形式发送路由请求报文，对最终目的节点进行搜索。通过对路由请求报文的传输跳数进行限制，减小由于通信报文数量较多导致的冲突、通信延时的影响。路由请求报文传输流程如图9所示。被路由请求报文所搜索的最终站点，在接收到路由请求报文后，需要组织路由回复报文，并将路由回复报文，以单播报文的形式发送至路由请求报文的发起站点。参与路由修复任务的站点应记录接收到的至少一条路由请求报文的信息，对于处理、转发路由回复报文的站点，应根据上述记录的信息确定发路由回复报文的下一跳站点。路由回复报文传输流程如图10所示。发起路由请求的站点在预定时间内收到了相应的路由回复报文，则该站点将向被搜索的最终目的站点发送路由应答报文，通知该最终目的节点。路由应答过程如图11所示。发起路由请求报文的站点，如果在预定时间内未收到相应的路由回复报文，该站点将向触发本次路由请求任务的原始站点发送路由错误报文，以单播报文的形式通知任务的原始站点业务报文转发失败。站点在转发路由回复报文时，可以使用链路确认请求报文，发起链路评估，以便确定路由回复报文的下一个目的站点。站点在收到链路确认请求报文后，在评估本地的相关路由数据后，确定是否发送链路确认回应报文。通过链路回应报文，携带相关的链路信息，回应给链路确认报文的发起站点。链路确认过程如图12所示。链路确认请求报文的发起站点，在接收到链路确认回复报文后，可进行路由下一跳目的站点的选择，确定下一跳后，需要转发出路由回复报文。最后说明的是，以上实施例仅用以说明本发明的技术方案而非限制，尽管参照较佳实施例对本发明进行了详细说明，本领域的普通技术人员应当理解，可以对本发明的技术方案进行修改或者等同替换，而不脱离本技术方案的宗旨和范围，其均应涵盖在本发明的权利要求范围当中。
