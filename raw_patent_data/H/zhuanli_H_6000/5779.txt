标题title
一种AMF过载检测及控制的实现方法
摘要abst
本发明涉及一种AMF过载检测及控制的实现方法。本发明通过将任务繁忙度和消息结点使用率作为AMF实际负荷的量化参数，通过负荷监测和负荷决策过程计算出AMF的负荷状态，通过将AMF负荷状态映射到overload action上并使用OVERLOAD START和OVERLOAD STOP接口调节5G‑AN发出的业务流量，达到过载控制的目的。当AMF从超负荷转变成正常状态后，不会立即停止5G‑AN的UAC，而是在实际负荷远低于过载阈值时才停止，从而能够避免过载控制中的乒乓效应。
权利要求书clms
1.一种AMF过载检测及控制的实现方法，其特征在于：通过将任务繁忙度和消息结点使用率作为AMF实际负荷的量化参数进行实时监测，结合预置的额定容量和过载阈值，通过负荷监测和负荷决策过程计算出AMF的负荷状态，通过将AMF负荷状态映射到overloadaction上并使用OVERLOAD START和OVERLOAD STOP接口调节5G-AN的业务流量，实现过载控制；当AMF从超负荷转变成正常状态后，不会立即停止5G-AN的统一接入控制UAC，而是在实际负荷低于过载阈值时才停止；任务繁忙度中的任务是指AMF中的线程，任务繁忙度为AMF中线程的CPU占用情况；消息结点使用率中的消息结点为AMF中不同线程之间传递消息的载体，消息结点使用率为AMF中消息结点的使用情况。2.根据权利要求1所述的一种AMF过载检测及控制的实现方法，其特征在于：AMF动态调节5G-AN的业务流量的交互流程如下，当5G-AN发送的业务流量激增时会导致AMF超负荷运行，AMF执行过载检测及控制后向5G-AN发送包含overload action的过载开始；5G-AN收到过载开始后根据overload action执行统一接入控制UAC，从而减少发送给AMF的业务流量；当5G-AN发送的业务流量明显下降后会使得AMF负荷状态恢复正常，AMF执行过载检测及控制后向5G-AN发送过载停止，5G-AN收到过载停止后停止执行统一接入控制UAC。3.根据权利要求1所述的一种AMF过载检测及控制的实现方法，其特征在于：由四个部分组成，分别是预置额定容量和阈值、负荷监测、负荷决策和过载控制，AMF过载检测及控制的执行过程，除预置额定容量和阈值外，负荷监测、负荷决策和过载控制三个部分在AMF运行过程中不断重复执行，确保AMF始终在额定的容量下运行；所述预置额定容量和阈值是在AMF启动时从本地配置读取或从网管中获取相关参数；所述负荷监测在AMF启动完成后开始执行，负荷监测分为任务繁忙度的监测和消息结点使用率的监测；所述负荷决策是基于AMF实际负荷参数，使用负荷决策算法得到最大负荷，然后结合预置的过载阈值决定出AMF的负荷状态；所述过载控制是基于负荷决策的结果，结合过载阈值，做出AMF是否要忽略收到的所有业务流量的策略，以及AMF是否要与5G-AN交互，调整5G-AN发送给AMF的业务流量的决策。4.根据权利要求3所述的一种AMF过载检测及控制的实现方法，其特征在于所述相关参数即P1、P2、P3、P4和P5，P1和P2是任务繁忙度的2个细分参数，分别为CPU使用率阈值和CPU连续占用计数最大值；P1用于判断监测单位内CPU使用过高的标准；P2用于指示CPU使用率过高的连续监测次数；P3 为消息结点总数，用于指示进行信息交互的并发量最大值；P4为过载阈值，用于判断AMF超负荷的标准；P5为严重过载阈值，用于判断AMF严重超负荷的标准；P2和P3指示额定容量，P1、P4和P5指示阈值。5.根据权利要求3所述的一种AMF过载检测及控制的实现方法，其特征在于所述负荷监测时所用的参数包括：C1是CPU使用率，C2是CPU连续占用计数，C3是空闲消息结点数量；AMF中存在多个任务用于处理不同的业务请求，每个任务对应AMF中的一个线程，对于每个任务会有一对C1和C2；AMF中有且只有一个C3用于计算消息。6.根据权利要求5所述的一种AMF过载检测及控制的实现方法，其特征在于所述任务繁忙度负荷监测是以每秒为单位进行周期性地执行，具体步骤如下：步骤1-1：计算任务的CPU使用率，即C1；从系统文件中获取本次监测的CPU时间片总量和任务线程CPU时间片数量，然后计算各个任务的C1，C1=任务线程CPU时间片数量/CPU时间片总量；步骤2-1：计算任务的CPU连续占用计数，即C2；根据C1更新C2值；如果任务的CPU使用率大于等于CPU使用率阈值则该任务的CPU连续占用计数增加1，否则设置为0；即，当C1≥P1则C2=C2+1，否则C2=0；步骤3-1：计算任务繁忙度根据C2值更新任务繁忙度，任务繁忙度就是任务的CPU连续占用计数与CPU连续占用计数最大值的百分比，即任务繁忙度=C2/P2。7.根据权利要求5所述的一种AMF过载检测及控制的实现方法，其特征在于所述消息结点使用率的消息结点为AMF中不同线程之间传递消息的载体，在AMF中是一种有限的资源，通过链表的形式进行管理；AMF启动完成后，空闲消息结点链表中结点个数就是预置的消息结点总数；当发送任务需要传递信息时将从该链表中取出一个消息结点，这一过程被称为分配消息结点；当接收任务完成信息处理后应将消息结点放回链表，这一过程被称为释放消息结点；消息结点使用率的监测就是在分配消息结点和释放消息节点时更新空闲消息结点数量；消息节点使用率的计算过程如下：步骤1-i：发送任务分配消息结点，或接收任务释放消息结点；步骤2-ii：计算空闲消息结点总数量分配消息结点时C3=C3-1，释放消息结点时C3=C3+1；步骤3-iii：计算消息结点使用率根据空闲消息结点数量，计算消息结点使用率，消息结点使用率=/P3。8.根据权利要求3所述的一种AMF过载检测及控制的实现方法，其特征在于所述负荷决策所用的参数包括C4、C5、C6、C7，分别对应最大负荷前次值、最大负荷当前值、负荷状态前次值和负荷状态当前值；其中，C4和C5取值范围为0-100；C6和C7取值范围为0-5，0表示负荷正常，1表示过载级别1，2表示过载级别2，3表示过载级别3，4表示过载级别4，5表示严重过载；负荷决策算法执行目的是得到AMF负荷状态，具体计算步骤如下：步骤1：计算最大负荷前次值和负荷状态前次值，即C4和C6；当负荷决策算法在第1次执行时，最大负荷前次值和负荷状态前次值均被初始化为0，即C4=0且C6=0；当负荷决策算法在第n+1次执行时，最大负荷前次值和负荷状态前次值分别被置为第n次执行结果，即C4=C5且C6=C7；步骤2：计算最大负荷当前值，即C5；最大负荷当前值就是从所有任务繁忙度和消息节点使用率中选出最大值，也即C5=max{消息结点使用率，任务1的繁忙度，任务2的繁忙度，……，任务K的繁忙度}；步骤3：计算负荷状态当前值，即C7；结合最大负荷当前值C5、过载阈值P4和严重过载阈值P5，计算负荷状态当前值；步骤3.1：如果最大负荷当前值大于等于严重过载阈值则负荷状态当前值设置为严重过载，即如果C5≥P5则C7=5；否则执行步骤3.2；步骤3.2：如果最大负荷当前值小于过载阈值则负荷状态当前值设置为负荷正常，即C5＜P4则C7=0；否则执行步骤3.3；步骤3.3：最大负荷当前值在过载和严重过载之间，即P4≤C5≤P5，按如下方式决定负荷状态当前值C7：步骤3.3.1：将过载阈值与严重过载阈值之间的距离4等分且记为分级间隔，即分级间隔=/4，继续执行步骤3.3.2；步骤3.3.2：结合C5、P4和分级间隔，计算C7；步骤3.3.2.1：如果最大负荷当前值大于等于过载阈值并且小于过载阈值加1倍分级间隔之和时负荷状态当前值应设置为过载级别1，即C5满足P4≤C5＜，则C7=1，否则执行步骤3.3.2.2；步骤3.3.2.2：如果最大负荷当前值大于等于过载阈值加1倍分级间隔之和并且小于过载阈值加2倍分级间隔之和时负荷状态当前值应设置为过载级别2，即C5满足≤C5＜，则C7=2，否则执行步骤3.3.2.3；步骤3.3.2.3：如果最大负荷当前值大于等于过载阈值加2倍分级间隔之和并且小于过载阈值加3倍分级间隔之和时负荷状态当前值应设置为过载级别3，即C5满足≤C5＜，则C7=3，否则执行步骤3.3.2.4；步骤3.3.2.4：负荷状态当前值设置为过载级别4，即C7=4。9.根据权利要求3所述的一种AMF过载检测及控制的实现方法，其特征在于所述过载控制使用3GPP TS38.413中提供的OVERLOAD START和OVERLOAD STOP两个接口，关键是在AMF超负荷时将负荷状态当前值C7映射至OVERLOAD START的overload action参数，负荷状态当前值C7分为过载级别1、过载级别2、过载级别3、过载级别4、严重过载；过载级别1对应Reject RRC connection establishment for non-emergency MO DT，过载级别2对应Reject RRC connection establishments for Signalling，过载级别3对应PermitEmergency Sessions and mobile terminated service only，过载级别4和严重过载都对应Permit High Priority Sessions and mobile terminated services only；当AMF超负荷时，过载控制决定AMF向5G-AN发送包含overload action的OVERLOADSTART，指示5G-AN按照overload action要求执行统一接入控制UAC；当AMF过载状态得到缓解后，过载控制决定AMF向5G-AN发送OVERLOAD STOP指示5G-AN停止统一接入控制UAC。10.根据权利要求9所述的一种AMF过载检测及控制的实现方法，其特征在于所述过载控制的执行过程如下：步骤1-a：如果负荷状态当前值为严重过载并且负荷状态前次值为过载级别4或严重过载，即C7=5且4≤C6≤5，则忽略收到的所有业务流量但不与5G-AN交互；否则执行步骤2-a；步骤2-a：如果负荷状态当前值为严重过载并且负荷状态前次值小于过载级别4，即C7=5且0≤C6＜4，则忽略收到的所有业务流量并向5G-AN发送OVERLOAD START；否则执行步骤3-a；步骤3-a：如果负荷状态当前值为过载且负荷状态当前值大于负荷状态前次值，即C7＞0且C7＞C6，则向5G-AN发送OVERLOAD START；否则执行步骤4-a；步骤4-a：如果负荷状态当前值为正常且负荷状态前次值为过载且最大负荷当前值小于过载阈值与20的差值，即C7=0且C6≥1且C5＜，则向5G-AN发送OVERLOAD STOP；否则执行步骤5-a；步骤5-a：不做任何特殊处理。
说明书desc
技术领域本发明属于通信领域，具体涉及一种AMF过载检测及控制的实现方法。背景技术接入和移动性管理功能是5G系统的核心网元，它为UE接入5G网络提供身份认证、服务授权和移动性管理等服务。AMF的稳定运行是5GC为UE提供服务的基本前提。当AMF运行超过其额定容量时，则认为AMF处于超负荷状态。AMF过载不仅会影响UE在5G网络中的用户体验，严重时甚至会引起整个5G网络的系统紊乱。在3GPPTS38.413中提供了AMF调节5G-AN的业务流量的接口，但未明确AMF触发调节机制的依据。为了确保AMF能在额定的容量下稳定的运行并为UE提供良好的用户体验，达到AMF动态调节5G-AN的业务流量的目的，本发明提出了一种AMF过载检测及控制的方法。发明内容针对现有技术中存在的问题，本发明的目的在于提供一种AMF过载检测及控制的实现方法的技术方案。所述的一种AMF过载检测及控制的实现方法，其特征在于：通过将任务繁忙度和消息结点使用率作为AMF实际负荷的量化参数进行实时监测，结合预置的额定容量和过载阈值，通过负荷监测和负荷决策过程计算出AMF的负荷状态，通过将AMF负荷状态映射到overload action上并使用OVERLOAD START和OVERLOAD STOP接口调节5G-AN的业务流量，实现过载控制；当AMF从超负荷转变成正常状态后，不会立即停止5G-AN的统一接入控制UAC，而是在实际负荷远低于过载阈值时才停止；任务繁忙度中的任务是指AMF中的线程，任务繁忙度为AMF中线程的CPU占用情况；消息结点使用率中的消息结点为AMF中不同线程之间传递消息的载体，消息结点使用率为AMF中消息结点的使用情况。所述的一种AMF过载检测及控制的实现方法，其特征在于：AMF动态调节5G-AN的业务流量的交互流程如下，当5G-AN发送的业务流量激增时会导致AMF超负荷运行，AMF执行过载检测及控制后向5G-AN发送包含overload action的过载开始；5G-AN收到过载开始后根据overload action执行统一接入控制UAC，从而减少发送给AMF的业务流量；当5G-AN发送的业务流量明显下降后会使得AMF负荷状态恢复正常，AMF执行过载检测及控制后向5G-AN发送过载停止，5G-AN收到过载停止后停止执行统一接入控制UAC。所述的一种AMF过载检测及控制的实现方法，其特征在于：由四个部分组成，分别是预置额定容量和阈值、负荷监测、负荷决策和过载控制，AMF过载检测及控制的执行过程，除预置额定容量和阈值外，负荷监测、负荷决策和过载控制三个部分在AMF运行过程中不断重复执行，确保AMF始终在额定的容量下运行；所述预置额定容量和阈值是在AMF启动时从本地配置读取或从网管中获取相关参数；所述负荷监测在AMF启动完成后开始执行，负荷监测分为任务繁忙度的监测和消息结点使用率的监测；所述负荷决策是基于AMF实际负荷参数，使用负荷决策算法得到最大负荷，然后结合预置的过载阈值决定出AMF的负荷状态；所述过载控制是基于负荷决策的结果，结合过载阈值，做出AMF是否要忽略收到的所有业务流量的策略，以及AMF是否要与5G-AN交互，调整5G-AN发送给AMF的业务流量的决策。所述的一种AMF过载检测及控制的实现方法，其特征在于所述相关参数即P1、P2、P3、P4和P5，P1和P2是任务繁忙度的2个细分参数，分别为CPU使用率阈值和CPU连续占用计数最大值；P1用于判断监测单位内CPU使用过高的标准；P2用于指示CPU使用率过高的连续监测次数；P3 为消息结点总数，用于指示进行信息交互的并发量最大值；P4为过载阈值，用于判断AMF超负荷的标准；P5为严重过载阈值，用于判断AMF严重超负荷的标准；P2和P3指示额定容量，P1、P4和P5指示阈值。所述的一种AMF过载检测及控制的实现方法，其特征在于所述负荷监测时所用的参数包括：C1是CPU使用率，C2是CPU连续占用计数，C3是空闲消息结点数量；AMF中存在多个任务用于处理不同的业务请求，每个任务对应AMF中的一个线程，对于每个任务会有一对C1和C2；AMF中有且只有一个C3用于计算消息。所述的一种AMF过载检测及控制的实现方法，其特征在于所述任务繁忙度负荷监测是以每秒为单位进行周期性地执行，具体步骤如下：步骤1-1：计算任务的CPU使用率，即C1；从系统文件中获取本次监测的CPU时间片总量和任务线程CPU时间片数量，然后计算各个任务的C1，C1=任务线程CPU时间片数量/CPU时间片总量；步骤2-1：计算任务的CPU连续占用计数，即C2；根据C1更新C2值；如果任务的CPU使用率大于等于CPU使用率阈值则该任务的CPU连续占用计数增加1，否则设置为0；即，当C1≥P1则C2=C2+1，否则C2=0；步骤3-1：计算任务繁忙度根据C2值更新任务繁忙度，任务繁忙度就是任务的CPU连续占用计数与CPU连续占用计数最大值的百分比，即任务繁忙度=C2/P2。所述的一种AMF过载检测及控制的实现方法，其特征在于所述消息结点使用率的消息结点为AMF中不同线程之间传递消息的载体，在AMF中是一种有限的资源，通过链表的形式进行管理；AMF启动完成后，空闲消息结点链表中结点个数就是预置的消息结点总数；当发送任务需要传递信息时将从该链表中取出一个消息结点，这一过程被称为分配消息结点；当接收任务完成信息处理后应将消息结点放回链表，这一过程被称为释放消息结点；消息结点使用率的监测就是在分配消息结点和释放消息节点时更新空闲消息结点数量；消息节点使用率的计算过程如下：步骤1-i：发送任务分配消息结点，或接收任务释放消息结点；步骤2-ii：计算空闲消息结点总数量分配消息结点时C3=C3-1，释放消息结点时C3=C3+1；步骤3-iii：计算消息结点使用率根据空闲消息结点数量，计算消息结点使用率，消息结点使用率=/P3。所述的一种AMF过载检测及控制的实现方法，其特征在于所述负荷决策所用的参数包括C4、C5、C6、C7，分别对应最大负荷前次值、最大负荷当前值、负荷状态前次值和负荷状态当前值；其中，C4和C5取值范围为0-100；C6和C7取值范围为0-5，0表示负荷正常，1表示过载级别1，2表示过载级别2，3表示过载级别3，4表示过载级别4，5表示严重过载；负荷决策算法执行目的是得到AMF负荷状态，具体计算步骤如下：步骤1：计算最大负荷前次值和负荷状态前次值，即C4和C6；当负荷决策算法在第1次执行时，最大负荷前次值和负荷状态前次值均被初始化为0，即C4=0且C6=0；当负荷决策算法在第n+1次执行时，最大负荷前次值和负荷状态前次值分别被置为第n次执行结果，即C4=C5且C6=C7；步骤2：计算最大负荷当前值，即C5；最大负荷当前值就是从所有任务繁忙度和消息节点使用率中选出最大值，也即C5=max{消息结点使用率，任务1的繁忙度，任务2的繁忙度，……，任务K的繁忙度}；步骤3：计算负荷状态当前值，即C7；结合最大负荷当前值C5、过载阈值P4和严重过载阈值P5，计算负荷状态当前值；步骤3.1：如果最大负荷当前值大于等于严重过载阈值则负荷状态当前值设置为严重过载，即如果C5≥P5则C7=5；否则执行步骤3.2；步骤3.2：如果最大负荷当前值小于过载阈值则负荷状态当前值设置为负荷正常，即C5＜P4则C7=0；否则执行步骤3.3；步骤3.3：最大负荷当前值在过载和严重过载之间，即P4≤C5≤P5，按如下方式决定负荷状态当前值C7：步骤3.3.1：将过载阈值与严重过载阈值之间的距离4等分且记为分级间隔，即分级间隔=/4，继续执行步骤3.3.2；步骤3.3.2：结合C5、P4和分级间隔，计算C7；步骤3.3.2.1：如果最大负荷当前值大于等于过载阈值并且小于过载阈值加1倍分级间隔之和时负荷状态当前值应设置为过载级别1，即C5满足P4≤C5＜，则C7=1，否则执行步骤3.3.2.2；步骤3.3.2.2：如果最大负荷当前值大于等于过载阈值加1倍分级间隔之和并且小于过载阈值加2倍分级间隔之和时负荷状态当前值应设置为过载级别2，即C5满足≤C5＜，则C7=2，否则执行步骤3.3.2.3；步骤3.3.2.3：如果最大负荷当前值大于等于过载阈值加2倍分级间隔之和并且小于过载阈值加3倍分级间隔之和时负荷状态当前值应设置为过载级别3，即C5满足≤C5＜，则C7=3，否则执行步骤3.3.2.4；步骤3.3.2.4：负荷状态当前值设置为过载级别4，即C7=4。所述的一种AMF过载检测及控制的实现方法，其特征在于所述过载控制使用3GPPTS38.413中提供的OVERLOAD START和OVERLOAD STOP两个接口，关键是在AMF超负荷时将负荷状态当前值C7映射至OVERLOAD START的overload action参数，负荷状态当前值C7分为过载级别1、过载级别2、过载级别3、过载级别4、严重过载；过载级别1对应Reject RRCconnection establishment for non-emergency MO DT，过载级别2对应Reject RRCconnection establishments for Signalling，过载级别3对应Permit EmergencySessions and mobile terminated service only，过载级别4和严重过载都对应PermitHigh Priority Sessions and mobile terminated services only；当AMF超负荷时，过载控制决定AMF向5G-AN发送包含overload action的OVERLOADSTART，指示5G-AN按照overload action要求执行统一接入控制UAC；当AMF过载状态得到较大缓解后，过载控制决定AMF向5G-AN发送OVERLOAD STOP指示5G-AN停止统一接入控制UAC。所述的一种AMF过载检测及控制的实现方法，其特征在于所述过载控制的执行过程如下：步骤1-a：如果负荷状态当前值为严重过载并且负荷状态前次值为过载级别4或严重过载，即C7=5且4≤C6≤5，则忽略收到的所有业务流量但不与5G-AN交互；否则执行步骤2-a；步骤2-a：如果负荷状态当前值为严重过载并且负荷状态前次值小于过载级别4，即C7=5且0≤C6＜4，则忽略收到的所有业务流量并向5G-AN发送OVERLOAD START；否则执行步骤3-a；步骤3-a：如果负荷状态当前值为过载且负荷状态当前值大于负荷状态前次值，即C7＞0且C7＞C6，则向5G-AN发送OVERLOAD START；否则执行步骤4-a；步骤4-a：如果负荷状态当前值为正常且负荷状态前次值为过载且最大负荷当前值小于过载阈值与20的差值，即C7=0且C6≥1且C5＜，则向5G-AN发送OVERLOADSTOP；否则执行步骤5-a；步骤5-a：不做任何特殊处理。本发明通过将任务繁忙度和消息结点使用率作为AMF实际负荷的量化参数，通过负荷监测和负荷决策过程计算出AMF的负荷状态，通过将AMF负荷状态映射到overloadaction上并使用OVERLOAD START和OVERLOAD STOP接口调节5G-AN发出的业务流量，达到过载控制的目的。当AMF从超负荷转变成正常状态后，不会立即停止5G-AN的UAC，而是在实际负荷远低于过载阈值时才停止，从而能够避免过载控制中的乒乓效应。附图说明图1为AMF动态调节5G-AN业务流量的交互流程图；图2为AMF过载检测及控制的执行过程图；图3为任务繁忙度的负荷监测示意图；图4为空闲消息结点链表的动态变化示意图；图5为消息结点使用率的负荷监测示意图；图6为负荷决策算法前后2次执行过程图；图7为过载控制的执行过程图。具体实施方式下面结合说明书附图对本发明作进一步说明：本发明提供了一种AMF过载检测及控制的实现方法，将任务繁忙度和消息结点使用率作为AMF负荷的两个量化参数进行实时监测，结合预置的额定容量和过载阈值，采用负荷决策算法计算负荷状态，之后使用3GPP TS38.413中提供的过载开始/过载停止接口动态地调节5G-AN的业务流量。其中，任务繁忙度中的任务是指AMF中的线程，任务繁忙度为AMF中线程的CPU占用情况；消息结点使用率中的消息结点为AMF中不同任务之间传递消息的载体，消息结点使用率为AMF中消息结点的使用情况。 AMF动态调节5G-AN业务流量的交互流程如图1所示，当5G-AN发送的业务流量激增时会导致AMF超负荷运行，AMF执行过载检测及控制后向5G-AN发送包含overload action的过载开始；5G-AN收到过载开始后根据overload action执行统一接入控制，从而减少发送给AMF的业务流量。当5G-AN发送的业务流量明显下降后会使得AMF负荷状态恢复正常，AMF执行过载检测及控制后向5G-AN发送过载停止，5G-AN收到过载停止后停止执行UAC。本发明AMF过载检测及控制的实现方法由四个部分组成，分别是预置额定容量和阈值、负荷监测、负荷决策和过载控制。图2描述了AMF过载检测及控制的执行过程，除预置额定容量和阈值外，其它三个部分在AMF运行过程中不断重复执行，确保AMF始终在额定的容量下运行。下面将按照执行顺序对不同的部分进行逐一说明。AMF过载检测及控制的第一部分是预置额定容量和阈值。预置额定容量和阈值就是在AMF启动时从本地配置读取或从网管中获取表1中所列参数，即初始化P1、P2、P3、P4和P5。其中，P1和P2是任务繁忙度的2个细分参数，分别为CPU使用率阈值和CPU连续占用计数最大值；P1用于判断监测单位内CPU使用过高的标准，取值为80；P2用于指示CPU使用率过高的连续监测次数，取值为300；P3 为消息结点总数，用于指示进行信息交互的并发量最大值，取值范围为1536-20480；P4为过载阈值，用于判断AMF超负荷的标准，取值为1-80；P5为严重过载阈值，用于判断AMF严重超负荷的标准，取值为80；P2和P3指示额定容量，P1、P4和P5指示阈值。表1额定容量和阈值参数AMF过载检测及控制的第二部分是负荷监测，在AMF启动完成后开始执行。负荷监测分为任务繁忙度的监测和消息结点使用率的监测，表2列出了负荷监测时所用的参数。其中，C1是CPU使用率，取值范围为0-100；C2是CPU连续占用计数，取值范围为0-300；C3是空闲消息结点数量，取值范围为0-P3。AMF中存在多个任务用于处理不同的业务请求，每个任务对应AMF中的一个线程，对于每个任务会有一对C1和C2；AMF中有且只有一个C3用于计算消息结点使用率。表2负荷监测参数在本发明中，任务繁忙度负荷监测是以每秒为单位进行周期性地执行。如图3所示，具体步骤说明如下：步骤1-1：计算任务的CPU使用率，即C1；从系统文件中获取本次监测的CPU时间片总量和任务线程CPU时间片数量，然后计算各个任务的C1，C1=任务线程CPU时间片数量/CPU时间片总量；步骤2-1：计算任务的CPU连续占用计数，即C2；根据C1更新C2值。如果任务的CPU使用率大于等于CPU使用率阈值则该任务的CPU连续占用计数增加1，否则设置为0；即，当C1≥P1则C2=C2+1，否则C2=0；步骤3-1：计算任务繁忙度根据C2值更新任务繁忙度，任务繁忙度就是任务的CPU连续占用计数与CPU连续占用计数最大值的百分比，即任务繁忙度=C2/P2。在本发明中，负荷监测的第二部分是消息结点使用率，其中消息结点为AMF中不同任务之间传递消息的载体，在AMF中是一种有限的资源，通过链表的形式进行管理。AMF启动完成后，空闲消息结点链表中结点个数就是预置的消息结点总数，图4描述了空闲消息结点链表的变化过程。当发送任务需要传递信息时将从该链表中取出一个消息结点，这一过程被称为分配消息结点；当接收任务完成信息处理后应将消息结点放回链表，这一过程被称为释放消息结点。消息结点使用率的监测就是在分配消息结点和释放消息节点时更新空闲消息结点数量。图5描述了消息节点使用率的计算过程，具体步骤说明如下：步骤1-i：发送任务分配消息结点，或接收任务释放消息结点；步骤2-ii：计算空闲消息结点总数量；分配消息结点时C3=C3-1，释放消息结点时C3=C3+1；步骤3-iii：计算消息结点使用率；根据空闲消息结点数量，计算消息结点使用率，消息结点使用率=/P3。负荷监测完成后得到AMF实际负荷参数，接下来进入AMF过载检测及控制的第三部分。负荷决策是基于AMF实际负荷参数，使用负荷决策算法得到最大负荷，然后结合预置的过载阈值决定出AMF的负荷状态。表3列出了负荷决策时所用的参数：C4、C5、C6、C7，分别对应最大负荷前次值、最大负荷当前值、负荷状态前次值和负荷状态当前值。其中，C4和C5取值范围为0-100；C6和C7取值范围为0-5，0表示负荷正常，1表示过载级别1，2表示过载级别2，3表示过载级别3，4表示过载级别4，5表示严重过载。表3负荷决策参数负荷决策算法执行目的是得到AMF负荷状态，图6描述了该算法前后2次执行过程，具体步骤说明如下：步骤1：计算最大负荷前次值和负荷状态前次值，即C4和C6；当负荷决策算法在第1次执行时，最大负荷前次值和负荷状态前次值均被初始化为0，即C4=0且C6=0；当负荷决策算法在第n+1次执行时，最大负荷前次值和负荷状态前次值分别被置为第n次执行结果，即C4=C5且C6=C7；步骤2：计算最大负荷当前值，即C5；最大负荷当前值就是从所有任务繁忙度和消息节点使用率中选出最大值，也即C5=max{消息结点使用率，任务1的繁忙度，任务2的繁忙度，……，任务K的繁忙度}；步骤3：计算负荷状态当前值，即C7；结合最大负荷当前值、过载阈值和严重过载阈值，计算负荷状态当前值；步骤3.1：如果最大负荷当前值大于等于严重过载阈值则负荷状态当前值设置为严重过载，即如果C5≥P5则C7=5；否则执行步骤3.2；步骤3.2：如果最大负荷当前值小于过载阈值则负荷状态当前值设置为负荷正常，即C5＜P4则C7=0；否则执行步骤3.3；步骤3.3：最大负荷当前值在过载和严重过载之间，按如下方式决定负荷状态当前值C7：步骤3.3.1：将过载阈值与严重过载阈值之间的距离4等分且记为分级间隔，即分级间隔=/4，继续执行步骤3.3.2；步骤3.3.2：结合C5、P4和分级间隔，计算C7；步骤3.3.2.1：如果最大负荷当前值大于等于过载阈值并且小于过载阈值加1倍分级间隔之和时负荷状态当前值应设置为过载级别1，即C5满足P4≤C5＜，则C7=1，否则执行步骤3.3.2.2；步骤3.3.2.2：如果最大负荷当前值大于等于过载阈值加1倍分级间隔之和并且小于过载阈值加2倍分级间隔之和时负荷状态当前值应设置为过载级别2，即C5满足≤C5＜，则C7=2，否则执行步骤3.3.2.3；步骤3.3.2.3：如果最大负荷当前值大于等于过载阈值加2倍分级间隔之和并且小于过载阈值加3倍分级间隔之和时负荷状态当前值应设置为过载级别3，即C5满足≤C5＜，则C7=3，否则执行步骤3.3.2.4；步骤3.3.2.4：负荷状态当前值设置为过载级别4，即C7=4。负荷决策结束后就要进入AMF过载检测及控制的第四部分，即过载控制。本发明的过载控制使用3GPP TS38.413中提供的OVERLOAD START和OVERLOAD STOP两个接口，关键是在AMF超负荷时将负荷状态当前值，即C7，映射至OVERLOAD START的overload action参数，表4列出了C7到overload action的映射关系。过载级别1对应Reject RRC connectionestablishment for non-emergency MO DT、过载级别2对应Reject RRC connectionestablishments for Signalling、过载级别3对应Permit Emergency Sessions andmobile terminated service only、过载级别4和严重过载都对应Permit High PrioritySessions and mobile terminated services only。表4负荷状态当前值到overload action的映射过载控制就是基于负荷决策的结果，结合过载阈值，做出AMF是否要忽略收到的所有业务流量的策略，以及AMF是否要与5G-AN交互，调整5G-AN发送给AMF的业务流量的决策。当AMF超负荷时，过载控制决定AMF向5G-AN发送包含overload action的OVERLOADSTART，指示5G-AN按照overload action要求执行UAC；当AMF过载状态得到较大缓解后，过载控制决定AMF向5G-AN发送OVERLOAD STOP指示5G-AN停止UAC。图7描述了过载控制的执行过程，具体步骤说明如下：步骤1-a：如果负荷状态当前值为严重过载并且负荷状态前次值为过载级别4或严重过载，即C7=5且4≤C6≤5，则忽略收到的所有业务流量但不与5G-AN交互；否则执行步骤2-a；步骤2-a：如果负荷状态当前值为严重过载并且负荷状态前次值小于过载级别4，即C7=5且0≤C6＜4，则忽略收到的所有业务流量并向5G-AN发送OVERLOAD START；否则执行步骤3-a；步骤3-a：如果负荷状态当前值为过载且负荷状态当前值大于负荷状态前次值，即C7＞0且C7＞C6，则向5G-AN发送OVERLOAD START；否则执行步骤4-a；步骤4-a：如果负荷状态当前值为正常且负荷状态前次值为过载且最大负荷当前值小于过载阈值与20的差值，即C7=0且C6≥1且C5＜，则向5G-AN发送OVERLOADSTOP；否则执行步骤5-a；步骤5-a：不做任何特殊处理。术语解释5GC：5G Core，第5代移动通信技术核心网5G-AN：5G Access Network，5G接入网络AMF：Access and Mobility Management Function，接入和移动性管理功能CPU：Central Processing Unit，中央处理单元IPv4：Internet Protocol version 4，互联网通信协议第四版NAS：Non-Access Stratum，非接入层NF：Network Function，网络功能NGAP：NG Application Protocol，新一代应用协议NRF：Network Repository Function，网络存储功能UAC：Unified Access Control，统一接入控制UE：User Equipment，用户设备。
