标题title
基于区块链智能合约的网络安全通信系统
摘要abst
本发明公开了基于区块链智能合约的网络安全通信系统，属于数字信息传输技术领域。该系统包括网络隔离模块、自定义配置模块、授权访问模块、智能合约模块、证书管理模块、自动化部署模块、哨兵验证模块；通过网络隔离模块采用ebpf网络防火墙利用微分段技术进行网络隔离；通过自定义配置模块系统管理员在平台上配置自定义资源和授权规则并发起投票；利用授权访问模块使管理员通过区块链上的托管及安全合约，对管理事件进行投票和管理；通过智能合约模块查询合约，获取对应的状态变更；利用证书管理模块生成CA证书；利用自动化部署模块根据CA证书信息注入，自动化部署客户端和服务队哨兵；利用哨兵验证模块对指定接口进行访问。
权利要求书clms
1.基于区块链智能合约的网络安全通信系统，其特征在于：该系统包括网络隔离模块、自定义配置模块、授权访问模块、智能合约模块、证书管理模块、自动化部署模块、哨兵验证模块；所述网络隔离模块用于通过ebpf网络防火墙利用微分段技术进行网络隔离；所述自定义配置模块用于系统管理员在平台上配置自定义资源和授权规则并发起投票；所述授权访问模块用于管理员通过区块链上的托管及安全合约，对管理事件进行投票和管理，授权内外部程序对敏感信息进行访问；所述智能合约模块用于管理平台查询合约，获取对应的状态变更；所述证书管理模块用于管理平台生成CA证书；所述自动化部署模块用于根据CA证书信息注入，并自动化部署客户端和服务队哨兵；所述哨兵验证模块用于外部服务或者人员通过客户端哨兵对指定接口进行访问。2.根据权利要求1所述的基于区块链智能合约的网络安全通信系统，其特征在于：所述网络隔离模块包括：管理员在控制面上配置安全规则和服务安全组，并持久化保存于Mysql中，通过安全规则和服务安全组的绑定，产生微分段的规则定义，控制服务的流量；结合服务的识别号unique_id，组装成cilium的数据格式，通过k8s提供的接口，将微分段的规则定义应用于k8s内部；Cilium-Agent将会对微分段的规则感应，并将规则应用于ebpf网络防火墙规则中，从而实现ebpf微分段安全隔离。3.根据权利要求1所述的基于区块链智能合约的网络安全通信系统，其特征在于：所述自定义配置模块包括：系统管理员通过控制面配置资源定义、授权规则；控制面将授权规则通过区块链的接口发送至链上。4.根据权利要求1所述的基于区块链智能合约的网络安全通信系统，其特征在于：所述授权访问模块包括：区块链合约接收到控制面的授权规则信息后，发起投票事件；管理员通过链上的托管及安全合约，对管理事件进行投票和管理；当投票通过时，会通过合约配置的回调地址通知各个可用区的控制面，并返回相应的投票ID。5.根据权利要求4所述的基于区块链智能合约的网络安全通信系统，其特征在于：所述授权访问模块还包括投票验证子模块；所述投票验证子模块用于验证管理员对管理事件进行投票的合规性；所述验证包括：获取历史管理员投票中token的反馈时间，记为集合；其中分别代表每次管理员投票中token的反馈时间；将集合中以9:1的方式分为训练样本集与测试样本集，并对训练样本集和测试样本集进行归一化，得到归一化训练样本集V和测试样本集T；根据归一化训练样本集V构建LSTM网络：其中，代表遗忘门的输出，决定了上一时刻单元状态保留到当前时刻单元状态的份额；是遗忘门的权重矩阵；表示把两个向量连接成一个更长的向量；是遗忘门的偏置项；代表sigmoid函数；代表输入门的输出，决定当前时刻的输入保留到单元状态的份额；代表输入门的权重矩阵；代表输入门的偏置项；代表输出门的输出，控制当前时刻单元状态输出到LSTM的当前输出值；代表输入门的权重矩阵；代表输入门的偏置项；根据公式：其中，代表点乘；将测试样本集T输入到生成的LSTM网络中，获取预测的管理员投票中token的反馈时间，并根据实际值，计算偏差值：其中，代表偏差值；代表LSTM网络的输出值；代表实际值；对所有偏差值进行平均值求解，作为预测偏差值存在，记为；通过LSTM网络获取当前时刻的管理员投票中token的反馈时间的预测值，记为，则最终输出预测值为；所述验证还包括：获取确认点击方式：所述确认点击方式为管理员投票过程中的点击位置；根据历史数据，获取点击位置的散点图，构建点击区域P；若点击方式不在点击区域内，则进行标记，并获取点击方式与点击区域之间的最小距离；获取管理员IP地址；对当前时刻管理员投票中的管理员IP地址进行查询，并反馈至系统中。6.根据权利要求5所述的基于区块链智能合约的网络安全通信系统，其特征在于：所述验证还包括：构建验证概率值：其中，代表验证概率值；代表管理员投票中token的反馈时间的设置阈值；代表点击方式不在点击区域内时，所有被标记的点击方式与点击区域之间的最小距离的平均值；代表点击方式不在点击区域内的次数；代表常数值，在当前时刻管理员投票中的管理员IP地址不在设置地址时取；其余情况取；均为设置值；、、分别代表权重值；构建验证概率阈值；若超出，则发出警示信息，暂时停止投票工作，待投票发起方确认后，再继续工作。7.根据权利要求1所述的基于区块链智能合约的网络安全通信系统，其特征在于：所述智能合约模块包括：管理平台通过投票ID调用区块链提供的投票接口查询链上的授权规则数据；控制面需要结合自身所在的可用区以及授权规则的可用区，判断自身是部署服务端还是客户端。8.根据权利要求1所述的基于区块链智能合约的网络安全通信系统，其特征在于：所述证书管理模块包括：控制面会封装各端的数据，通过CA中心提供的SDk生成私钥，根据SPIFFE IDG自动生成CSR；此时CA中心根据CSR、客户端哨兵和服务端哨兵连接信息和SNI标识请求CA Server 获取服务端哨兵证书和客户端哨兵的CA证书。9.根据权利要求1所述的基于区块链智能合约的网络安全通信系统，其特征在于：所述自动化部署模块包括：通过Devops的CI功能，发出服务端哨兵和客户端哨兵的镜像构建，并将证书信息打入与之对应镜像的环境变量中，控制面会定时轮循CI服务，查询镜像的构建状态；控制面会通过woker服务提供的部署接口，组装成对应的数据结构，将镜像提交到k8s进行部署。10.根据权利要求1所述的基于区块链智能合约的网络安全通信系统，其特征在于：所述哨兵验证模块包括：外部服务或人员通过访问，客户端哨兵首先与服务端哨兵公网服务进行TLS握手；客户端哨兵向服务端哨兵发送WS请求；服务端哨兵会验证客户端哨兵证书和访问策略验证，验证通过之后，服务端哨兵将自身证书同步响应给客户端哨兵；客户端哨兵验证服务端哨兵证书后，服务端哨兵根据客户端哨兵提供的目标服务信息，访问目标服务。
说明书desc
技术领域本发明涉及数字信息传输技术领域，具体为基于区块链智能合约的网络安全通信系统。背景技术传统的安全模型是以边界模型为基础而逐步完善的，传统的基于边界的网络安全架构通过防火墙、WAF、IPS等边界安全产品/方案对企业网络边界进行重重防护。边界模型专注防御边界，将攻击者尽可能挡在外面，而内部则无任何防护措施。在现有服务架构中，基于边界的网络访问安全模型逐渐失效，无法灵活控制访问权限等缺点。随着业务发展，流量的增加，抵抗外部/内部风险，增加可用性，在安全和可用性之间达到平衡，成为了当前急需解决的问题，如何进一步细分区域内的网络和控制流量的南北以及东西方向的流动，如何利用零信任网络打破网络的边界模式，将网络功能和上层应用机动组合，如何将用户、设备、服务、应用和数据标识细粒度映射到网络会话等多方面安全内容均存在大量问题。发明内容本发明的目的在于提供基于区块链智能合约的网络安全通信系统，以解决上述背景技术中提出的问题。为了解决上述技术问题，本发明提供如下技术方案：基于区块链智能合约的网络安全通信系统，该系统包括网络隔离模块、自定义配置模块、授权访问模块、智能合约模块、证书管理模块、自动化部署模块、哨兵验证模块；所述网络隔离模块用于通过ebpf网络防火墙利用微分段技术进行网络隔离；所述自定义配置模块用于系统管理员在平台上配置自定义资源和授权规则并发起投票；所述授权访问模块用于管理员通过区块链上的托管及安全合约，对管理事件进行投票和管理，授权内外部程序对敏感信息进行访问；所述智能合约模块用于管理平台查询合约，获取对应的状态变更；所述证书管理模块用于管理平台生成CA证书；所述自动化部署模块用于根据CA证书信息注入，并自动化部署客户端和服务队哨兵；所述哨兵验证模块用于外部服务或者人员通过客户端哨兵对指定接口进行访问。根据上述技术方案，所述网络隔离模块包括：管理员在控制面上配置安全规则和服务安全组，并持久化保存于Mysql中，通过安全规则和服务安全组的绑定，产生微分段的规则定义，控制服务的流量；结合服务的识别号unique_id，组装成cilium的数据格式，通过k8s提供的接口，将微分段的规则定义应用于k8s内部；Cilium-Agent将会对微分段的规则感应，并将规则应用于ebpf网络防火墙规则中，从而实现ebpf微分段安全隔离。实现了零信任安全模型，能够缩小受攻击面，防止攻击者以及异常数据在东西向移动，确保内部安全。根据上述技术方案，所述自定义配置模块包括：系统管理员通过控制面配置资源定义、授权规则；控制面将授权规则通过区块链的接口发送至链上。根据上述技术方案，所述授权访问模块包括：区块链合约接收到控制面的授权规则信息后，发起投票事件；管理员通过链上的托管及安全合约，对管理事件进行投票和管理；当投票通过时，会通过合约配置的回调地址通知各个可用区的控制面，并返回相应的投票ID。根据上述技术方案，所述授权访问模块还包括投票验证子模块；所述投票验证子模块用于验证管理员对管理事件进行投票的合规性；所述验证包括：获取历史管理员投票中token的反馈时间，记为集合；其中分别代表每次管理员投票中token的反馈时间；因为在管理员投票中如果出现异常侵入或者管理员受到替换，会对投票结果产生巨大影响，导致信息泄露，因此对反馈时间进行预测和控制，一旦出现异常程序，势必会影响反馈时间。将集合中以9:1的方式分为训练样本集与测试样本集，并对训练样本集和测试样本集进行归一化，得到归一化训练样本集V和测试样本集T；根据归一化训练样本集V构建LSTM网络：其中，代表遗忘门的输出，决定了上一时刻单元状态保留到当前时刻单元状态的份额；是遗忘门的权重矩阵；表示把两个向量连接成一个更长的向量；是遗忘门的偏置项；代表sigmoid函数；代表输入门的输出，决定当前时刻的输入保留到单元状态的份额；代表输入门的权重矩阵；代表输入门的偏置项；代表输出门的输出，控制当前时刻单元状态输出到LSTM的当前输出值；代表输入门的权重矩阵；代表输入门的偏置项；根据公式：其中，代表点乘；将测试样本集T输入到生成的LSTM网络中，获取预测的管理员投票中token的反馈时间，并根据实际值，计算偏差值：其中，代表偏差值；代表LSTM网络的输出值；代表实际值；对所有偏差值进行平均值求解，作为预测偏差值存在，记为；通过LSTM网络获取当前时刻的管理员投票中token的反馈时间的预测值，记为，则最终输出预测值为；所述验证还包括：获取确认点击方式：所述确认点击方式为管理员投票过程中的点击位置；根据历史数据，获取点击位置的散点图，构建点击区域P；若点击方式不在点击区域内，则进行标记，并获取点击方式与点击区域之间的最小距离；获取管理员IP地址；对当前时刻管理员投票中的管理员IP地址进行查询，并反馈至系统中。根据上述技术方案，所述验证还包括：构建验证概率值：其中，代表验证概率值；代表管理员投票中token的反馈时间的设置阈值；代表点击方式不在点击区域内时，所有被标记的点击方式与点击区域之间的最小距离的平均值；代表点击方式不在点击区域内的次数；代表常数值，在当前时刻管理员投票中的管理员IP地址不在设置地址时取；其余情况取；均为设置值；、、分别代表权重值；构建验证概率阈值；若超出，则发出警示信息，暂时停止投票工作，待投票发起方确认后，再继续工作。根据上述技术方案，所述智能合约模块包括：管理平台通过投票ID调用区块链提供的投票接口查询链上的授权规则数据；控制面需要结合自身所在的可用区以及授权规则的可用区，判断自身是部署服务端还是客户端。根据上述技术方案，所述证书管理模块包括：控制面会封装各端的数据，通过CA中心提供的SDk生成私钥，根据SPIFFE IDG自动生成CSR；此时CA中心根据CSR、客户端哨兵和服务端哨兵连接信息和SNI标识请求CAServer 获取服务端哨兵证书和客户端哨兵的CA证书。根据上述技术方案，所述自动化部署模块包括：通过Devops的CI功能，发出服务端哨兵和客户端哨兵的镜像构建，并将证书信息打入与之对应镜像的环境变量中，控制面会定时轮循CI服务，查询镜像的构建状态；控制面会通过woker服务提供的部署接口，组装成对应的数据结构，将镜像提交到k8s进行部署。根据上述技术方案，所述哨兵验证模块包括：外部服务或人员通过访问，客户端哨兵首先与服务端哨兵公网服务进行TLS握手；客户端哨兵向服务端哨兵发送WS请求，包含自身证书，以及其他访问权限信息；服务端哨兵会验证客户端哨兵证书和访问策略验证，验证通过之后，服务端哨兵将自身证书同步响应给客户端哨兵；客户端哨兵验证服务端哨兵证书后，服务端哨兵根据客户端哨兵提供的目标服务信息，访问目标服务。与现有技术相比，本发明所达到的有益效果是：通过使用ebpf微分段技术进行网络隔离，进一步细分区域内的网络，控制流量的南北以及东西方向的流动，增强安全性。利用零信任网络打破网络的边界模式，在网络功能和上层应用将机动组合，用户、设备、服务、应用和数据标识细粒度映射到网络会话，可以灵活地应用底层设备以应对更为丰富的防护策略。零信任安全体系可以保护内部的信息安全，系统关键部位的流量由哨兵代理，只有获得授权才能访问对应的数据。哨兵的流量管理行为受平台调控管理，平台的管理行为由区块链托管及安全理事会合约数据驱动。区块链合约的数据由相关的管理人员通过投票管理，投票过程受到全程管理验证，整体安全性极高。同时将合约以数字化的形式写入区块链中，因区块链的特性，数据将无法删除、修改，只能新增，整个过程透明可跟踪，保证了历史的可追溯性；行为将被永久记录，可极大程度避免恶意行为对合约正常执行的干扰；去中心化，避免了中心化因素的影响，提高智能合约在成本效率方面的优势；当满足合约内容时，将自动启动智能合约的代码，既避免了手动过程，同时又保障了发行者无法违约；由区块链自带的共识算法构建出一套状态机系统，使得智能合约能够高效地运行。零信任网络打破了旧式边界防护思维，旧式思维专注防御边界。对应用程序和数据提供强大的保护，无论它们是在云中还是在本地；缩小业务暴露面；动态调整访问权限，访问行为可控；周期性终端安全检查；通过关闭安全漏洞和控制网络上的横向移动，可以更好地降低风险。通过将数据中心业务单元按照一定规则进行分组，然后在分组间部署策略来实现流量控制；拥有更精细、灵活的安全隔离：微分段可基于离散IP、MAC、VM名称等定义分组，相应的安全域划分更加细致、更灵活；同时微分段通过对业务资源进行分段管理，并采用最低权限原则严格控制业务间互访关系，来实现零信任安全模型，能够缩小受攻击面，防止攻击者以及异常数据在东西向移动，确保内部安全。通过微分段方案实现了分布式的安全控制方案，在接入交换机实现对业务流量就近进行安全过滤，东西向流量不需要集中转发到防火墙后再进行安全隔离，减少了网络带宽的消耗，可以防止集中控制点成为流量瓶颈。通过安全哨兵代理可以保护基础集群关键数据源，哨兵之间通信流量加密、通用型流量承载，同时由主site统一管控客户端哨兵权限。附图说明附图用来提供对本发明的进一步理解，并且构成说明书的一部分，与本发明的实施例一起用于解释本发明，并不构成对本发明的限制。在附图中：图1是本发明基于区块链智能合约的网络安全通信系统的流程示意图；图2是本发明基于区块链智能合约的网络安全通信系统的实施例中网络隔离模块流程示意图；图3是本发明基于区块链智能合约的网络安全通信系统的实施例中授权访问模块流程示意图；图4是本发明基于区块链智能合约的网络安全通信系统的实施例中身份标识示意图；图5是本发明基于区块链智能合约的网络安全通信系统的实施例中证书管理模块流程示意图；图6是本发明基于区块链智能合约的网络安全通信系统的实施例中自动化部署模块流程示意图；图7是本发明基于区块链智能合约的网络安全通信系统的实施例中哨兵验证模块流程示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。请参阅图1-图7，在本实施例中：提出以Redis访问信息作为零信任网络安全通信的案例：由于数据都是通过网络传输的，这就可以在传输的过程中被截获，或者通过非常手段进入数据库，因此数据库安全就显得十分重要。Redis作为服务的数据缓存存储设施，其安全性决定了整个服务的安全性。通过使用本平台及方法，有效地控制Redis服务的安全性。通过管理员在控制配置安全组和服务安全组配置后，利用ebpf网络防火墙利用微分段技术进行服务网络隔离。然后管理员在哨兵模块配置自定义资源和授权规则，调用区块链合约发起投票机制。经过区块链智能合约的授权后回调平台接口，平台根据规则生成以Redis服务为服务端的哨兵和证书。MSP控制面作为客户端，以客户端哨兵携带证书的方式，最后访问到Redis服务端。本方式经过层层加密和规则验证，达到Redis服务的安全通信。以下详细介绍实施案例的详细过程：控制面抽象出安全组以及安全组与服务间绑定功能。用户首先在平台侧通过控制面新建一个适用于自身服务的安全组，安全组包含一系列的出入网策略，包含IP段和基于DNS的访问策略，相关字段如下表1和表2所示：当用户通过控制面添加完某安全组的一些列出入网策略时，控制面会将安全组的数据持久化保存于Mysql中，等待应用于某个服务；用户在服务安全组配置模块添加自身服务的唯一识别号，并选择需要应用的安全组，相关字段如表3所示：控制面接收到用户提交的数据后，首先会校验数据的合法性，包含安全组是否存在、安全组下是否有出入网策略等。控制面会根据提交的安全组ID，查询出所有在该安全组下的出入网策略，并结合服务的识别号unique_id，组装成cilium的数据格式，通过k8s提供的接口，应用在k8s内部；k8s节点的Cilium-Agent将会对规则感应，并将规则应用于ebpf防火墙规则中。通过系统内核和Network控制服务的网络隔离，如图2所示。用户在平台侧首先添加资源，填写资源名称、选择资源类型，以及当前资源的目标地址和端口，参数字段如表4所示：提交Redis服务资源数据至控制面，经过合法性校验之后会返回成功，代表当前资源建立成功，将资源数据持久化在Mysql中。同时，控制面会对此资源生成唯一的uuid，全局标识此资源。资源建立成功之后，用户需要针对资源建立授权规则，声明Redis服务作为服务端可用区，MSP服务作为客户端可用区，同时确定授权的时效、客户端哨兵对接入方暴露的端口，参数字段如表5所示：当用户填写完必要的信息，将数据提交至控制面，控制面经过数据合法性校验之后，将数据持久化在Redis。同时，控制面会将授权规则的所有数据通过区块链的接口发送至链上，等待投票。发起投票请求时调用newVote方法， 创建一个关于“_metadata”的新投票。其中参数_executesIfDecided为决定是否也立即执行新创建的投票，参数_executionScript是EVM交脚在审批时执行，参数_metadata 为实际投票内容，参数_native标记是否为动态执行。区块链合约接收到上述提交的投票请求后，持有组织token的人即有投票权，实际选择支持与否，调用token合约拿到投票权额度。当投票通过时，会通过合约配置的回调地址通知各个可用区的控制面，并返回相应投票ID，如图3所示。控制面接收到投票成功的回调事件后，会通过返回的投票ID调用区块链提供的投票接口查询链上的授权规则数据。控制面结合自身所在的可用区以及授权规则的可用区，判断当前所在可用区为客户端，Redis服务作为服务端。控制面会封装各端的数据，通过CA中心提供的SDK首先生成私钥，根据SPIFFE IDG自动生成 CSR，并根据SPIFFE作为一套服务之间相互进行身份识别的标准定义身份标识。身份标识主要包含以下内容：集群域 ID和服务标识ID，如图4所示。此时CA中心根据CSR、客户端哨兵和服务端哨兵扩展信息和SNI标识请求CAServer 获取服务端哨兵证书和客户端哨兵的 CA 证书 。服务端哨兵证书和客户端哨兵证书产生不同的身份标识和扩展字段。服务端哨兵证书的扩展信息如表6所示，客户端哨兵证书的扩展信息如表7所示：将受信任的 CA 证书挂载在集群内每个服务的 Sidecar 上。作为证书的身份标识等信息，可以根据相关标识信息，验证证书是否为本集群证书，证书是否合法等等，如图5所示。各端证书生成之后，控制面接下来会通过Devops的CI功能，触发服务端哨兵和客户端哨兵的镜像构建，并将证书信息打入与之对应镜像的环境变量中，等待镜像构建成功控制面会定时轮循CI服务，查询镜像的构建状态，当得到构建成功的结果时，代表镜像已经就绪，等待部署，如图6所示。控制面得到需要部署的服务端哨兵或者客户端哨兵镜像时，会通过Worker服务提供的部署接口，组装成对应的数据结构，将镜像提交到k8s进行部署。同时，控制面会轮循部署结果，并实时同步。MSP控制面可用区中的微服务发起和本可用区客户端哨兵的TCP连接请求，经过三次握手后建立TCP连接并发送连接Redis请求，此时客户端哨兵伪装成资源实例，后续原样转发微服务的流量到服务端哨兵，对微服务无感。MSP控制面可用区中的客户端哨兵根据自身证书中存储的服务端哨兵信息同Redis服务端哨兵建立TCP连接。客户端哨兵同服务端哨兵TCP握手阶段完成后，紧接着客户端哨兵同服务端哨兵建立TLS加密隧道，并发送私有协议，告知服务端哨兵需要连接的资源标识信息。Redis服务端哨兵接收到客户端哨兵请求连接的资源标识后进行资源验证：①验证资源是否存在，②验证客户端哨兵身份是否合法。经过服务端哨兵合法性验证成功后，响应客户端哨兵私有协议认证成功协议包。客户端哨兵通过加密隧道转发微服务发送的原始资源连接请求到服务端哨兵。服务端哨兵根据微服务的原始请求数据，伪装成客户端同本可用区内部资源建立连接。Redis数据库响应连接信息到服务端哨兵。服务端哨兵通过加密隧道转发资源响应数据到客户端哨兵，并把原始响应数据转发到微服务，后续客户端哨兵&amp;服务端哨兵互相转发加密后的微服务同资源的交互数据，如图7所示。需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。最后应说明的是：以上所述仅为本发明的优选实施例而已，并不用于限制本发明，尽管参照前述实施例对本发明进行了详细的说明，对于本领域的技术人员来说，其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
