标题title
基于虚拟化的视频编解码系统、设备及方法
摘要abst
本公开提供一种基于虚拟化的视频编解码系统、设备及方法。该系统包括存储单元、主机、至少一个虚拟机和物理编解码单元；主机，被配置为在存储单元中为每个虚拟机分配对应的存储空间；虚拟机，被配置为在接收到编解码任务时，将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中；主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，并将读取的编解码任务的配置信息配置到对应的物理寄存器上；物理编解码单元，被配置为从对应的物理寄存器中读取对应的编解码任务的配置信息，以执行该编解码任务。极大减少了系统调用资源所需的开销且实现了调度算法的简化。
权利要求书clms
1.一种基于虚拟化的视频编解码系统，包括：存储单元、主机、至少一个虚拟机和物理编解码单元；所述主机，被配置为在所述存储单元中为每个虚拟机分配对应的存储空间；所述虚拟机，被配置为在接收到编解码任务时，将所述编解码任务的配置信息存放至所述主机分配给该虚拟机的存储空间中；所述主机，还被配置为在所述虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的所述编解码任务的配置信息，并将读取的所述编解码任务的配置信息配置到对应的物理寄存器上；所述物理编解码单元，被配置为从对应的所述物理寄存器中读取对应的所述编解码任务的配置信息，并根据读取的所述编解码任务的配置信息，执行该编解码任务。2.根据权利要求1所述的基于虚拟化的视频编解码系统，还包括所述虚拟机对应的虚拟寄存器；所述虚拟机，还被配置为将所述编解码任务的配置信息存放至所述主机分配给该虚拟机的存储空间中后，将对应的第一标记写入所述虚拟寄存器；所述主机，还被配置为在所述虚拟机的触发下，访问该虚拟机对应的存储空间，包括：所述主机，还被配置为对所述虚拟寄存器进行监测，在监测到对应的第一标记写入所述虚拟寄存器时，访问对应的所述虚拟机对应的存储空间。3.根据权利要求2所述的基于虚拟化的视频编解码系统，所述主机，还被配置为对所述虚拟寄存器进行监测，在监测到对应的第一标记写入所述虚拟寄存器时，访问对应的所述虚拟机对应的存储空间，包括：所述主机，还被配置为基于所述虚拟机对应的VFIO-mdev驱动对所述虚拟寄存器进行监测，在监测到对应的第一标记写入所述虚拟寄存器时，访问对应的所述虚拟机对应的存储空间。4.根据权利要求2所述的基于虚拟化的视频编解码系统，所述主机，还被配置为对所述虚拟寄存器进行监测，在监测到对应的第一标记写入所述虚拟寄存器时，访问对应的所述虚拟机对应的存储空间，包括：所述主机，还被配置为对所述虚拟寄存器进行监测，在监测到所述虚拟寄存器被写入数据时，对当前写入所述虚拟寄存器中的数据进行判断；在当前写入所述虚拟寄存器中的数据等于对应的第一标记时，访问对应的所述虚拟机对应的存储空间。5.根据权利要求2所述的基于虚拟化的视频编解码系统，所述虚拟机包括：虚拟编解码单元和第一处理单元；所述虚拟编解码单元，被配置为在接收到编解码任务时，将所述编解码任务的配置信息存放至所述主机分配给该虚拟机的存储空间中；所述第一处理单元，被配置为在所述虚拟编解码单元将所述编解码任务的配置信息存放至所述主机分配给该虚拟机的存储空间中后，将对应的第一标记写入所述虚拟寄存器。6.根据权利要求1所述的基于虚拟化的视频编解码系统，所述主机，还被配置为在所述虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的所述编解码任务的配置信息，并将读取的所述编解码任务的配置信息配置到对应的物理寄存器上，包括：所述主机，还被配置为在所述虚拟机的触发下，对该虚拟机对应的所述编解码任务进行调度，并在执行该虚拟机对应的所述编解码任务前，访问该虚拟机对应的存储空间，以读取对应的所述编解码任务的配置信息，并将读取的所述编解码任务的配置信息配置到对应的物理寄存器上。7.根据权利要求1所述的基于虚拟化的视频编解码系统，所述主机，还被配置为在所述虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的所述编解码任务的配置信息，包括：所述主机，还被配置为在所述虚拟机的触发下，访问该虚拟机对应的存储空间，按照先进先出的顺序从其中读取对应的所述编解码任务的配置信息。8.根据权利要求1所述的基于虚拟化的视频编解码系统，所述物理编解码单元，还被配置为在执行完所述编解码任务后，向所述主机发送对应的中断通知。9.根据权利要求1所述的基于虚拟化的视频编解码系统，所述虚拟机，被配置为在接收到编解码任务时，将所述编解码任务的配置信息存放至所述主机分配给该虚拟机的存储空间中，包括：所述虚拟机，被配置为在接收到编解码任务时，将所述编解码任务的配置信息存放至所述主机分配给该虚拟机的存储空间中，并将该虚拟机对应的存储空间中对应的第二标记位的值置为第一数值；所述主机，还被配置为：在所述虚拟机对应的所述编解码任务执行完后，将分配给该虚拟机的存储空间中对应的第二标记位的值置为第二数值；所述虚拟机，还被配置为：对所述主机分配给该虚拟机的存储空间中的第二标记位进行监测，当第二标记位的值由所述第一数值切换为所述第二数值时，确认对应的所述编解码任务已完成。10.一种电子设备，其中，包括权利要求1至9中任一项所述的基于虚拟化的视频编解码系统。11.一种基于虚拟化的视频编解码方法，应用于主机，包括：在存储单元中为每个虚拟机分配对应的存储空间；在所述虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息；其中，所述编解码任务的配置信息为所述虚拟机在接收到所述编解码任务时，存放至对应的存储空间中的；将读取的所述编解码任务的配置信息配置到对应的物理寄存器上，以使得物理编解码单元从对应的所述物理寄存器中读取对应的所述编解码任务的配置信息，从而执行该编解码任务。12.根据权利要求11所述的基于虚拟化的视频编解码方法，在所述虚拟机的触发下，访问该虚拟机对应的存储空间，包括：对所述虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入所述虚拟寄存器时，访问对应的所述虚拟机对应的存储空间；其中，对应的第一标记为所述虚拟机将对应的所述编解码任务的配置信息存放至所述主机分配给该虚拟机的存储空间中后，写入所述虚拟寄存器的。13.根据权利要求12所述的基于虚拟化的视频编解码方法，对所述虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入所述虚拟寄存器时，访问对应的所述虚拟机对应的存储空间，包括：基于所述虚拟机对应的VFIO-mdev驱动对所述虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入所述虚拟寄存器时，访问对应的所述虚拟机对应的存储空间。14.根据权利要求12所述的基于虚拟化的视频编解码方法，对所述虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入所述虚拟寄存器时，访问对应的所述虚拟机对应的存储空间，包括：对应的虚拟寄存器进行监测，在监测到所述虚拟寄存器被写入数据时，对当前写入所述虚拟寄存器中的数据进行判断；在当前写入所述虚拟寄存器中的数据等于对应的第一标记时，访问对应的所述虚拟机对应的存储空间。15.根据权利要求11所述的基于虚拟化的视频编解码方法，在所述虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的所述编解码任务的配置信息，包括：在所述虚拟机的触发下，对该虚拟机对应的所述编解码任务进行调度，并在执行该虚拟机对应的所述编解码任务前，访问该虚拟机对应的存储空间，以读取对应的所述编解码任务的配置信息。
说明书desc
技术领域本公开涉及视频编解码技术领域，尤其涉及一种基于虚拟化的视频编解码系统、设备及方法。背景技术现有的视频编解码软件虚拟化技术主要是用分时复用来共享硬件资源的，在虚拟机中创建虚拟视频编解码卡，在每个虚拟机中创建的虚拟视频编解码卡有对应的虚拟寄存器等，模拟物理视频编解码卡，每个虚拟机认为自己独占硬件资源。现有方案中，物理视频编解码卡通过逐一接收虚拟视频编解码卡的成百上千的寄存器配置，来执行虚拟机的编解码任务，这种方案会极大的占用系统调用的资源，影响主机性能和效率。且当多个虚拟机同时有编解码任务时，物理视频编解码卡逐一接收各个虚拟机中的虚拟视频编解码卡的寄存器配置，会极大的增加主机上调度算法的复杂性，且成本较高。发明内容本公开的目的是提供一种基于虚拟化的视频编解码系统、设备及方法，解决了现有的基于虚拟化的视频编解码技术中出现的主机调度效率差、较复杂和高成本的技术问题。根据本公开的一个方面，提供一种基于虚拟化的视频编解码系统，包括：存储单元、主机、至少一个虚拟机和物理编解码单元；主机，被配置为在存储单元中为每个虚拟机分配对应的存储空间；虚拟机，被配置为在接收到编解码任务时，将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中；主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，并将读取的编解码任务的配置信息配置到对应的物理寄存器上；物理编解码单元，被配置为从对应的物理寄存器中读取对应的编解码任务的配置信息，并根据读取的编解码任务的配置信息，执行该编解码任务。在一些实施例中，上述基于虚拟化的视频编解码系统中，还包括虚拟机对应的虚拟寄存器；虚拟机，还被配置为将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中后，将对应的第一标记写入虚拟寄存器；主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，包括：主机，还被配置为对虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间。在一些实施例中，上述基于虚拟化的视频编解码系统中，主机，还被配置为对虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间，包括：主机，还被配置为基于虚拟机对应的VFIO-mdev驱动对虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间。在一些实施例中，上述基于虚拟化的视频编解码系统中，主机，还被配置为对虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间，包括：主机，还被配置为对虚拟寄存器进行监测，在监测到虚拟寄存器被写入数据时，对当前写入虚拟寄存器中的数据进行判断；在当前写入虚拟寄存器中的数据等于对应的第一标记时，访问对应的虚拟机对应的存储空间。在一些实施例中，上述基于虚拟化的视频编解码系统中，虚拟机包括：虚拟编解码单元和第一处理单元；虚拟编解码单元，被配置为在接收到编解码任务时，将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中；第一处理单元，被配置为在虚拟编解码单元将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中后，将对应的第一标记写入虚拟寄存器。在一些实施例中，上述基于虚拟化的视频编解码系统中，主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，并将读取的编解码任务的配置信息配置到对应的物理寄存器上，包括：主机，还被配置为在虚拟机的触发下，对该虚拟机对应的编解码任务进行调度，并在执行该虚拟机对应的编解码任务前，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，并将读取的编解码任务的配置信息配置到对应的物理寄存器上。在一些实施例中，上述基于虚拟化的视频编解码系统中，主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，包括：主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，按照先进先出的顺序从其中读取对应的编解码任务的配置信息。在一些实施例中，上述基于虚拟化的视频编解码系统中，物理编解码单元，还被配置为在执行完编解码任务后，向主机发送对应的中断通知。在一些实施例中，上述基于虚拟化的视频编解码系统中，虚拟机，被配置为在接收到编解码任务时，将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中，包括：虚拟机，被配置为在接收到编解码任务时，将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中，并将该虚拟机对应的存储空间中对应的第二标记位的值置为第一数值；主机，还被配置为：在虚拟机对应的编解码任务执行完后，将分配给该虚拟机的存储空间中对应的第二标记位的值置为第二数值；虚拟机，还被配置为：对主机分配给该虚拟机的存储空间中的第二标记位进行监测，当第二标记位的值由第一数值切换为第二数值时，确认对应的编解码任务已完成。根据本公开的另一方面，提供一种电子设备，包括上述任一实施例的基于虚拟化的视频编解码系统。根据本公开的另一个方面，提供一种基于虚拟化的视频编解码方法，应用于主机，包括：在存储单元中为每个虚拟机分配对应的存储空间；在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息；其中，编解码任务的配置信息为虚拟机在接收到编解码任务时，存放至对应的存储空间中的；将读取的编解码任务的配置信息配置到对应的物理寄存器上，以使得物理编解码单元从对应的物理寄存器中读取对应的编解码任务的配置信息，从而执行该编解码任务。在一些实施例中，上述基于虚拟化的视频编解码方法中，在虚拟机的触发下，访问该虚拟机对应的存储空间，包括：对虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间；其中，对应的第一标记为虚拟机将对应的编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中后，写入虚拟寄存器的。在一些实施例中，上述基于虚拟化的视频编解码方法中，对虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间，包括：基于虚拟机对应的VFIO-mdev驱动对虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间。在一些实施例中，上述基于虚拟化的视频编解码方法中，对虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间，包括：对应的虚拟寄存器进行监测，在监测到虚拟寄存器被写入数据时，对当前写入虚拟寄存器中的数据进行判断；在当前写入虚拟寄存器中的数据等于对应的第一标记时，访问对应的虚拟机对应的存储空间。在一些实施例中，上述基于虚拟化的视频编解码方法中，在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，包括：在虚拟机的触发下，对该虚拟机对应的编解码任务进行调度，并在执行该虚拟机对应的编解码任务前，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息。附图说明图1为本公开一个实施例提供的基于虚拟化的视频编解码系统的结构示意图；图2为本公开一个实施例提供的基于虚拟化的视频编解码方法的流程示意图。具体实施方式在介绍本公开实施例之前，应当说明的是：本公开部分实施例被描述为处理流程，虽然流程的各个操作步骤可能被冠以顺序的步骤编号，但是其中的操作步骤可以被并行地、并发地或者同时实施。本公开实施例中可能使用了术语“第一”、“第二”等等来描述各个特征，但是这些特征不应当受这些术语限制。使用这些术语仅仅是为了将一个特征与另一个特征进行区分。本公开实施例中可能使用了术语“和/或”，“和/或”包括其中一个或更多所列出的相关联特征的任意和所有组合。应当理解的是，当描述两个部件的连接关系或通信关系时，除非明确指明两个部件之间直接连接或直接通信，否则，两个部件的连接或通信可以理解为直接连接或通信，也可以理解为通过中间部件间接连接或通信。为了使本公开实施例中的技术方案及优点更加清楚明白，以下结合附图对本公开的示例性实施例进行进一步详细的说明，显然，所描述的实施例仅是本公开的一部分实施例，而不是所有实施例的穷举。需要说明的是，在不冲突的情况下，本公开中的实施例及实施例中的特征可以相互组合。本公开的目的是提供一种基于虚拟化的视频编解码系统、设备及方法，该系统包括：存储单元、主机、至少一个虚拟机和物理编解码单元；主机，被配置为在存储单元中为每个虚拟机分配对应的存储空间；虚拟机，被配置为在接收到编解码任务时，将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中；主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，并将读取的编解码任务的配置信息配置到对应的物理寄存器上；物理编解码单元，被配置为从对应的物理寄存器中读取对应的编解码任务的配置信息，并根据读取的编解码任务的配置信息，执行该编解码任务。可以理解为，本公开的技术方案中，虚拟机中待执行的编解码任务的配置信息并未直接发送给主机，而是将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中，主机在需要时，再访问对应的存储空间，读取对应的编解码任务的配置信息，这极大减少了系统调用资源所需的开销，且多个虚拟机有编解码任务时，对主机来说每个虚拟机中只是一个个的任务，调度算法只需要为这些来自不同虚拟机中任务配置先后顺序，而不是主机去接收每个虚拟机成百上千寄存器配置信息后，再进行调度，可实现调度算法的简化。本公开的一个实施例提供一种基于虚拟化的视频编解码系统，如图1所示，该基于虚拟化的视频编解码系统包括存储单元、主机、至少一个虚拟机和物理编解码单元；主机，被配置为在存储单元中为每个虚拟机分配对应的存储空间；虚拟机，被配置为在接收到编解码任务时，将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中；主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，并将读取的编解码任务的配置信息配置到对应的物理寄存器上；物理编解码单元，被配置为从对应的物理寄存器中读取对应的编解码任务的配置信息，并根据读取的编解码任务的配置信息，执行该编解码任务。其中，虚拟机接收到的编解码任务，是对应的虚拟机用户向该虚拟机发出的。对主机而言，每个虚拟机都是其一个进程。编解码任务的配置信息为执行编解码任务所需要的信息，包括视频编解码指令，以及待编解码的数据或待编解码的数据在内存中的存放位置信息。在一些实施例中，存储单元可以为主机的内存，可以理解为，主机的内存可以分配给虚拟机，虚拟机使用主机分配的内存，这部分存储空间就是主机和虚拟机共享的。而主机可以对虚拟机的编解码任务进行调度，对应的，主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，包括：主机，还被配置为在虚拟机的触发下，对该虚拟机对应的编解码任务进行调度，并在执行该虚拟机对应的编解码任务前，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，并将读取的编解码任务的配置信息配置到对应的物理寄存器上。也就是说，主机在需要时，再访问对应的存储空间，读取对应的编解码任务的配置信息，这极大减少了系统调用资源所需的开销，且多个虚拟机有编解码任务时，对主机来说每个虚拟机中只是一个个的任务，调度算法只需要为这些来自不同虚拟机中任务配置先后顺序，实现了调度算法的简化。在一些实施例中，主机包括第二处理单元，被配置为对该虚拟机对应的编解码任务进行调度，并在执行该虚拟机对应的编解码任务前，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，并将读取的编解码任务的配置信息配置到对应的物理寄存器上。其中，第二处理单元可以为中央处理器。也即，主机中的调度、对存储空间进行读取以及对物理寄存器的写入操作，都是主机中的第二处理单元来完成的。在一些实施例中，物理编解码单元和物理寄存器均是主机的物理视频编解码卡的组成部分。也即，主机在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，并将读取的编解码任务的配置信息配置到物理视频编解码卡对应的物理寄存器上。而物理视频编解码卡可以理解为支持视频编解码的显卡。在一些实施例中，物理编解码单元，还被配置为在执行完编解码任务后，向主机发送对应的中断通知，然后主机再通知对应的虚拟机。在一些实施例中，上述系统还包括虚拟机对应的虚拟寄存器；虚拟机，还被配置为将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中后，将对应的第一标记写入虚拟寄存器；主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，包括：主机，还被配置为对虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间。其中，系统中的虚拟机与虚拟寄存器可以是一对一的关系，即每个虚拟机可以分别对应一个虚拟寄存器，主机可以根据监测的虚拟寄存器快速确定对应的虚拟机及其对应的存储空间。上述系统中的虚拟机与虚拟寄存器也可以是多对一的关系，即多个虚拟机可以共用一个虚拟寄存器，但是该虚拟寄存器的多个标记位中，不同的标记位对应不同的虚拟机，对应的，虚拟机，还被配置为将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中后，将对应的第一标记写入虚拟寄存器的对应的标记位上，这样，主机在监测到对应的第一标记写入虚拟寄存器时，访问写入位置对应的虚拟机对应的存储空间。当虚拟机通过第一标记触发主机对对应的存储空间进行访问之后，虚拟机可以将虚拟寄存器的对应的标记位上的数据清零或复位，以便于下一次的触发。在一些实施例中，虚拟机，还被配置为将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中后，将对应的第一标记写入虚拟寄存器，包括：虚拟机，还被配置为将编解码任务的最后一个配置信息存放至主机分配给该虚拟机的存储空间中后，将对应的第一标记写入虚拟寄存器。在一些实施例中，主机，还被配置为对虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间，包括：主机，还被配置为基于虚拟机对应的VFIO-mdev驱动对虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间。基于虚拟化功能I/O的中介设备的设备虚拟化技术基础框架，是Linux系统中实现虚拟机和主机设备之间的信息透传的一种方式，其还可以实现对主机设备资源的管理和调度。可以理解为，当虚拟机和物理视频编解码卡是一对一的关系时，虚拟机和物理视频编解码卡之间可以直通，但是当虚拟机和物理视频编解码卡是多对一的关系时，为了实现多个虚拟机共享硬件资源，虚拟机与物理视频编解码卡之间可以通过VFIO-mdev驱动来实现信息透传，也即主机通过VFIO-mdev驱动拦截虚拟机对物理视频编解码卡的访问，然后主机再对做这些访问进行调度，实现硬件资源的完整虚拟化。其中，主机基于虚拟机对应的VFIO-mdev驱动对虚拟寄存器进行监测，也是虚拟寄存器的状态信息和数据信息发送至VFIO-mdev驱动的过程，也是通过VFIO-mdev驱动对虚拟机寄存器对外指示的状态信息和数据信息进行拦截的过程。在一些实施例中，虚拟寄存器中对应一虚拟机的标记位可以为多bit。在一些实施例中，虚拟寄存器中对应一虚拟机的标记位上被写入的不同数值表示不同的指示，所以为了避免误触发，主机，还被配置为对虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间，包括：主机，还被配置为对虚拟寄存器进行监测，在监测到虚拟寄存器被写入数据时，对当前写入虚拟寄存器中的数据进行判断；在当前写入虚拟寄存器中的数据等于对应的第一标记时，访问对应的虚拟机对应的存储空间。结合主机基于虚拟机对应的VFIO-mdev驱动对虚拟寄存器进行监测的场景下，主机，还被配置为基于虚拟机对应的VFIO-mdev驱动对虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间，包括：主机，还被配置为基于虚拟机对应的VFIO-mdev驱动对虚拟寄存器进行监测；在监测到虚拟寄存器被写入数据时，对当前写入虚拟寄存器中的数据进行判断；在当前写入虚拟寄存器中的数据等于对应的第一标记时，访问对应的虚拟机对应的存储空间。可以理解为，在监测到虚拟寄存器被写入数据时，对当前写入虚拟寄存器中的数据不一定是第一标记，即当前的虚拟寄存器指示的不是虚拟机已将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中。所以，在监测到虚拟寄存器被写入数据时，需要对当前写入虚拟寄存器中的数据进行判断，在当前写入虚拟寄存器中的数据等于对应的第一标记时，再访问对应的虚拟机对应的存储空间。在一些实施例中，虚拟机包括：虚拟编解码单元和第一处理单元；虚拟编解码单元，被配置为在接收到编解码任务时，将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中；第一处理单元，被配置为在虚拟编解码单元将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中后，将对应的第一标记写入虚拟寄存器。其中，虚拟编解码单元为虚拟视频编解码卡，是对物理视频编解码卡的模拟，虚拟机中可以有虚拟视频编解码卡，也可以没有，虚拟视频编解码卡依赖于虚拟机，当虚拟机中没有虚拟视频编解码卡时，虚拟机本身是对物理视频编解码卡的模拟。其中，第一处理单元可以为虚拟中央处理器。也即，虚拟机中向虚拟寄存器中写入数据的操作，是第一处理单元来完成的。在一些实施例中，虚拟机对应的存储空间中，可以同时存储了多个编解码任务的配置信息，该存储空间中，该虚拟机对应的各个编解码任务的配置信息可以根据配置信息携带的标识符进行彼此区分，当主机访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息时，可以根据配置信息携带的标识符选择对应的编解码任务的配置信息，然后将读取的该编解码任务的配置信息配置到对应的物理寄存器上。示例性的，如图1所示，上述系统中包括多个虚拟机，分别为VM0~VMx，其中，虚拟机VM0的编解码任务T1、T2等的配置信息缓存于虚拟机VM0对应的存储空间中，当主机HOST访问该虚拟机对应的存储空间时，可以根据编解码任务T1、T2等的配置信息携带的标识符准确选择编解码任务T1的配置信息、或编解码任务T2的配置信息、或其它某个编解码任务的配置信息进行读取。在一些实施例中，主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息，包括：主机，还被配置为在虚拟机的触发下，访问该虚拟机对应的存储空间，按照先进先出的顺序从其中读取对应的编解码任务的配置信息。可以理解为，为了避免对每个编解码任务的延时的控制，可以按照先进先出的顺序从其中读取对应的编解码任务的配置信息，以实现物理视频编解码卡对该编解码任务的执行。结合主机可以对虚拟机的编解码任务进行调度的实施例，当主机对各个虚拟机的编解码任务的调度结果是，当前先执行虚拟机VMx的编解码任务，那么此时主机访问该虚拟机VMx对应的存储空间，然后按照先进先出的顺序从其中读取排在最前面的编解码任务的配置信息。在一些实施例中，虚拟机，被配置为在接收到编解码任务时，将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中，包括：虚拟机，被配置为在接收到编解码任务时，将编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中，并将该虚拟机对应的存储空间中对应的第二标记位的值置为第一数值；主机，还被配置为：在虚拟机对应的编解码任务执行完后，将分配给该虚拟机的存储空间中对应的第二标记位的值置为第二数值；虚拟机，还被配置为：对主机分配给该虚拟机的存储空间中的第二标记位进行监测，当第二标记位的值由第一数值切换为第二数值时，确认对应的编解码任务已完成。可以理解为，虚拟机对应的存储空间中，设置有各个编解码任务对应的第二标记位，第二标记位可以被对应的虚拟机和主机维护、查询。主机可以通过第二标记位通知对应的虚拟机编解码任务的完成状态。在一虚拟机对应的存储空间中，可以同时存储了多个编解码任务的配置信息的场景下，可以在该虚拟机对应的存储空间中，为其存储的各个编解码任务分配对应的第二标记位，即，当对应的第二标记位值由第一数值切换为第二数值时，确认该第二标记位对应的编解码任务已完成，随后，可以对该第二标记位进行覆盖或清零。在一些实施例中，物理编解码单元，还被配置为在执行完编解码任务后，向主机发送对应的中断通知；主机，还被配置为：在接收到物理编解码单元发送的中断通知时，将分配给对应的虚拟机的存储空间中对应的第二标记位的值置为第二数值。即，结合物理编解码单元在执行完编解码任务后，向主机发送对应的中断通知的场景下，主机将分配给对应的虚拟机的存储空间中对应的第二标记位的值置为第二数值的时机为，接收到物理编解码单元发送的对应的中断通知时。基于相同的发明构思，本公开实施例还提供一种电子设备，该电子设备包括上述任一实施例的基于虚拟化的视频编解码系统。在一些使用场景下，该电子设备的产品形式是便携式电子设备，例如智能手机、平板电脑、VR设备等；在一些使用场景下，该电子设备的产品形式是个人电脑、游戏主机等。基于相同的发明构思，本公开实施例还提供一种基于虚拟化的视频编解码方法，应用于主机，如图2所示，包括：步骤S110：在存储单元中为每个虚拟机分配对应的存储空间；步骤S120：在虚拟机的触发下，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息；其中，编解码任务的配置信息为虚拟机在接收到编解码任务时，存放至对应的存储空间中的；步骤S130：将读取的编解码任务的配置信息配置到对应的物理寄存器上，以使得物理编解码单元从对应的物理寄存器中读取对应的编解码任务的配置信息，从而执行该编解码任务。在一些实施例中，步骤S120中，在虚拟机的触发下，访问该虚拟机对应的存储空间，包括：对虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间；其中，对应的第一标记为虚拟机将对应的编解码任务的配置信息存放至主机分配给该虚拟机的存储空间中后，写入虚拟寄存器的。在一些实施例中，对虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间，包括：基于虚拟机对应的VFIO-mdev驱动对虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间。在一些实施例中，对虚拟机对应的虚拟寄存器进行监测，在监测到对应的第一标记写入虚拟寄存器时，访问对应的虚拟机对应的存储空间，包括：对应的虚拟寄存器进行监测，在监测到虚拟寄存器被写入数据时，对当前写入虚拟寄存器中的数据进行判断；在当前写入虚拟寄存器中的数据等于对应的第一标记时，访问对应的虚拟机对应的存储空间。在一些实施例中，步骤S120，包括：在虚拟机的触发下，对该虚拟机对应的编解码任务进行调度，并在执行该虚拟机对应的编解码任务前，访问该虚拟机对应的存储空间，以读取对应的编解码任务的配置信息。上述各个步骤的具体实施过程可参见上述基于虚拟化的视频编解码系统的任一实施例，此处不再赘述。尽管已描述了本公开的优选实施例，但本领域内的技术人员一旦得知了基本创造性概念，则可对这些实施例作出另外的变更和修改。所以，所附权利要求意欲解释为包括优选实施例以及落入本公开范围的所有变更和修改。显然，本领域的技术人员可以对本公开进行各种改动和变型而不脱离本公开的精神和范围。这样，倘若本公开的这些修改和变型属于本公开权利要求及其等同技术的范围之内，则本公开也意图包含这些改动和变型在内。
