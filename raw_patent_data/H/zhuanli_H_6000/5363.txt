标题title
基于机器视觉的贴装误差实时校正方法及系统
摘要abst
本发明涉及贴片机控制技术领域，具体公开了一种基于机器视觉的贴装误差实时校正方法及系统，所述方法基于贴片机贴装平面坐标误差校正，包括以下步骤：识别待贴装基板图像上的标记点，获取理论坐标；标定贴装平面坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差，根据标记点的所述理论坐标得到消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差后的理论基板贴装坐标；以标记点的理论基板贴装坐标为参照进行贴装。该方案不仅提高了贴装精度，还克服了受每台机器的结构差异和装配差异、或者同一台机器在不同温度条件下运行，贴片机贴装平面坐标误差在不同机器上表现不一致的问题。
权利要求书clms
1.一种基于机器视觉的贴装误差实时校正方法，其特征在于，所述方法基于贴片机贴装平面坐标误差校正，包括以下步骤：识别待贴装基板图像上的标记点，获取理论坐标；标定贴装平面坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差，根据标记点的所述理论坐标得到消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差后的理论基板贴装坐标；以标记点的理论基板贴装坐标为参照进行贴装。2.根据权利要求1所述的方法，其特征在于，所述标定贴装平面坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差，根据标记点的所述理论坐标得到消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差后的实际坐标包括以下过程：标定贴片机平面坐标系X轴和Y轴的夹角；将待贴装基板上标记点的理论坐标转换为X轴和Y轴的夹角为的倾斜平面坐标系坐标；建立消除轴形变误差的坐标与倾斜平面坐标系坐标的转换关系；计算待贴装基板在机器内部的夹持角度，依据所述转换关系，建立消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差的理论基板贴装坐标与所述理论坐标的关系式，根据关系式进行多项式拟合计算出X轴和Y轴形变的具体参数；根据X轴和Y轴形变的具体参数和所述关系式得到所述理论基板贴装坐标。3.根据权利要求2所述的方法，其特征在于，所述标定贴片机平面坐标系X轴和Y轴的夹角具体为：贴片机传送轨道传入玻璃治具并固定；驱动贴装头移动，按照理论坐标依次运动到玻璃治具上的标记点位置，使用贴装头上的基准相机获取玻璃治具图像；基于玻璃治具图像识别并计算出每个标记点的坐标；取各行点阵，每行拟合成直线，所有按行拟合的直线平均斜率记为；取各列点阵，每列拟合成直线，所有按列拟合的直线平均斜率为；得到的计算公式如下：。4.根据权利要求2所述的方法，其特征在于，所述将待贴装基板上标记点的理论坐标转换为X轴和Y轴的夹角为的倾斜平面坐标系坐标的转换公式如下：其中，为理论坐标，/＞为倾斜平面坐标系坐标。5.根据权利要求2所述的方法，其特征在于，所述建立消除轴形变误差的坐标与倾斜平面坐标系坐标的转换关系公式如下：其中，为理论坐标，为消除轴形变误差的坐标，kx1、kx2、ky1、ky2、bx、by均为待求解的所述X轴和Y轴形变的具体参数。6.根据权利要求5所述的方法，其特征在于，所述计算待贴装基板在机器内部的夹持角度具体为：选取待贴装基板上的两个标记点，计算待贴装基板在机器内部的夹持角度，公式如下：=/＞-/＞其中，、分别为待贴装基板上的两个标记点在倾斜坐标系下的理论坐标，/＞为/＞、/＞两点连线和X轴的夹角，/＞分别为两个标记点在倾斜坐标系下的实际识别坐标，/＞为/＞两点连线和X轴的夹角，/＞为所述夹持角度；所述理论基板贴装坐标与所述理论坐标的关系式为：其中，为理论基板贴装坐标，；；；；；。7.根据权利要求6所述的方法，其特征在于，所述根据关系式进行多项式拟合计算出X轴和Y轴形变的具体参数公式如下：。8.根据权利要求5-7中任一所述的方法，其特征在于，所述建立消除轴形变误差的坐标与倾斜平面坐标系坐标的转换关系公式如下：，所述理论基板贴装坐标与所述理论坐标的关系式为：，为理论基板贴装坐标，；；；；；；；；；；；；进而得到X轴和Y轴形变的具体参数公式如下：。9.一种基于机器视觉的贴装误差标定系统，其特征在于，包括：运动控制模块，用于驱动贴装头在贴片机XY坐标系中运动到指定的坐标位置，驱动调宽轴运动至预设的轨道宽度以放入玻璃治具，驱动传送轨道运送治具至指定区域并夹持固定；图像采集模块，包括玻璃治具和基准相机，用于通过基准相机采集玻璃治具图像；图像识别模块，用于识别玻璃治具上标记点的实际识别坐标，获取各标记点的实际识别坐标和理论坐标的偏差；数据存储系统：用于存储图像识别模块得到的玻璃治具各标记点的实际识别坐标和理论坐标的偏差；坐标计算模块：用于根据图像识别模块识别结果和数据存储系统存储的偏差计算贴片机X轴和Y轴形变的具体参数。10.一种基于机器视觉的贴装误差实时校正系统，其特征在于，包括：运动控制模块，用于驱动贴装头在贴片机XY坐标系中运动到指定的坐标位置，驱动调宽轴运动至预设的轨道宽度以放入玻璃治具或待贴装基板，驱动传送轨道运送玻璃治具或待贴装基板至指定区域夹持固定，以及用于根据误差修正模块获取的待贴装基板标记点的理论基板贴装坐标，进行贴装；图像识别模块，用于识别玻璃治具或待贴装基板图像上的标记点，获取理论坐标；误差修正模块，用于标定贴装平面坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差，根据标记点的所述理论坐标得到消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差后的理论基板贴装坐标。
说明书desc
技术领域本发明涉及贴片机控制技术领域，具体地涉及一种基于机器视觉的贴装误差实时校正方法及系统。背景技术贴片机在进行实贴之前，通常先识别已经传入并固定的基板上的两个mark点，计算基板伸缩比、夹持角度，进而按照修正后的坐标作为实际贴装和CPK检测的参考理论坐标。以上校正过程无误的话，可以保证在进行轴摆动补偿校正的贴装位置贴装精度是达标的，但是在其他区域贴装或者在不同温度下贴装，可能出现精度下降情况。因此需要对贴装区域的XY坐标进行校正。目前有以下两种方法来进行理论坐标校正补偿：插值补偿：使用布满点阵圆形点的玻璃治具，按照理论位置运行到每个圆形点，拍摄这些圆形点的图像，计算各点位定位误差，实际贴装时按照具体坐标线性插值补偿。然而缺点是：为了满足使用要求，玻璃治具需要覆盖所有可能的贴装区域，该方法受环境温度变化和治具本身加工精度有限影响，实际补偿效果很有限。动态误差补偿：建立温度变化、运动距离两个变量和坐标误差校正值之间的数学关系，模型拟合度高，能够实现单轴在不同运动距离、温度下动态坐标校正。然而缺点是：需要多点测温再进行计算，且没有考虑X轴和Y轴的耦合，实际使用时难度大，工程意义有限。因此，目前的贴装精度校正方案没有考虑轴形变、坐标系倾斜带来的影响，校正完毕后，存在其他贴装区域贴装精度无法保证的情况。发明内容本发明的目的是克服现有技术存在的问题，提供一种基于机器视觉的贴装误差实时校正方法及系统，提高了贴装精度，还克服了受每台机器的结构差异和装配差异、或者同一台机器在不同温度条件下运行，贴片机贴装平面坐标误差在不同机器上表现不一致的问题。为了实现上述目的，本发明第一方面提供一种基于机器视觉的贴装误差实时校正方法，所述方法基于贴片机贴装平面坐标误差校正，包括以下步骤：识别待贴装基板图像上的标记点，获取理论坐标；标定贴装平面坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差，根据标记点的所述理论坐标得到消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差后的理论基板贴装坐标；以标记点的理论基板贴装坐标为参照进行贴装。优选地，所述标定贴装平面坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差，根据标记点的所述理论坐标得到消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差后的实际坐标包括以下过程：标定贴片机平面坐标系X轴和Y轴的夹角；将待贴装基板上标记点的理论坐标转换为X轴和Y轴的夹角为的倾斜平面坐标系坐标；建立消除轴形变误差的坐标与倾斜平面坐标系坐标的转换关系；计算待贴装基板在机器内部的夹持角度，依据所述转换关系，建立消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差的理论基板贴装坐标与所述理论坐标的关系式，根据关系式进行多项式拟合计算出X轴和Y轴形变的具体参数；根据X轴和Y轴形变的具体参数和所述关系式得到所述理论基板贴装坐标。优选地，所述标定贴片机平面坐标系X轴和Y轴的夹角具体为：贴片机传送轨道传入玻璃治具并固定；驱动贴装头移动，按照理论坐标依次运动到玻璃治具上的标记点位置，使用贴装头上的基准相机获取玻璃治具图像；基于玻璃治具图像识别并计算出每个标记点的坐标；取各行点阵，每行拟合成直线，所有按行拟合的直线平均斜率记为；取各列点阵，每列拟合成直线，所有按列拟合的直线平均斜率为；得到的计算公式如下：。优选地，所述将待贴装基板上标记点的理论坐标转换为X轴和Y轴的夹角为的倾斜平面坐标系坐标的转换公式如下： 其中，/＞为理论坐标，/＞为倾斜平面坐标系坐标。优选地，所述建立消除轴形变误差的坐标与倾斜平面坐标系坐标的转换关系公式如下：其中，为理论坐标，为消除轴形变误差的坐标，kx1、kx2、ky1、ky2、bx、by均为待求解的所述X轴和Y轴形变的具体参数。优选地，所述计算待贴装基板在机器内部的夹持角度具体为：选取待贴装基板上的两个标记点，计算待贴装基板在机器内部的夹持角度，公式如下：=/＞-/＞其中，、分别为待贴装基板上的两个标记点在倾斜坐标系下的理论坐标，/＞为/＞、/＞两点连线和X轴的夹角，分别为两个标记点在倾斜坐标系下的实际识别坐标，/＞为两点连线和X轴的夹角，/＞为所述夹持角度；所述理论基板贴装坐标与所述理论坐标的关系式为：其中，为理论基板贴装坐标，；；；；；。优选地，所述根据关系式进行多项式拟合计算出X轴和Y轴形变的具体参数公式如下：。优选地，所述建立消除轴形变误差的坐标与倾斜平面坐标系坐标的转换关系公式如下：，所述理论基板贴装坐标与所述理论坐标的关系式为：，为理论基板贴装坐标，；；；；；；；；；；；；进而得到X轴和Y轴形变的具体参数公式如下：。本发明第二方面提供一种基于机器视觉的贴装误差标定系统，包括：运动控制模块，用于驱动贴装头在贴片机XY坐标系中运动到指定的坐标位置，驱动调宽轴运动至预设的轨道宽度以放入玻璃治具，驱动传送轨道运送治具至指定区域并夹持固定；图像采集模块，包括玻璃治具和基准相机，用于通过基准相机采集玻璃治具图像；图像识别模块，用于识别玻璃治具上标记点的实际识别坐标，获取各标记点的实际识别坐标和理论坐标的偏差；数据存储系统：用于存储图像识别模块得到的玻璃治具各标记点的实际识别坐标和理论坐标的偏差；坐标计算模块：用于根据图像识别模块识别结果和数据存储系统存储的偏差计算贴片机X轴和Y轴形变的具体参数。本发明第三方面提供一种基于机器视觉的贴装误差实时校正系统，包括：运动控制模块，用于驱动贴装头在贴片机XY坐标系中运动到指定的坐标位置，驱动调宽轴运动至预设的轨道宽度以放入玻璃治具或待贴装基板，驱动传送轨道运送玻璃治具或待贴装基板至指定区域夹持固定，以及用于根据误差修正模块获取的待贴装基板标记点的理论基板贴装坐标，进行贴装；图像识别模块，用于识别玻璃治具或待贴装基板图像上的标记点，获取理论坐标；误差修正模块，用于标定贴装平面坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差，根据标记点的所述理论坐标得到消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差后的理论基板贴装坐标。通过上述技术方案，本发明考虑到轴形变、坐标系倾斜、待贴装基板夹持角度情况造成的误差影响，基于贴片机贴装平面坐标对轴形变、坐标系倾斜、待贴装基板夹持角度造成的误差进行标定，从而得到修正后的理论贴装坐标作为实际贴装和CPK检测的参考理论坐标，不仅提高了贴装精度，还克服了受每台机器的结构差异和装配差异、或者同一台机器在不同温度条件下运行，贴片机贴装平面坐标误差在不同机器上表现不一致的问题。附图说明下面结合附图，对本发明的具体实施方式进行详细描述。图1是本发明实施例玻璃治具黑色圆形点阵示意图；图2是本发明实施例中坐标系倾斜示意图；图3是本发明实施例中校正方法流程图；图4是本发明实施例中实时校正方法流程图；图5是本发明实施例带贴装基板夹持情况示意图；图6是本发明实施例标记点理论坐标和实际坐标示意图。具体实施方式以下结合附图对本发明实施例的具体实施方式进行详细说明。应当理解的是，此处所描述的具体实施方式仅用于说明和解释本发明实施例，并不用于限制本发明实施例。针对目前的贴装精度校正没有考虑轴形变、坐标系倾斜带来的影响，校正完毕后，存在其他贴装区域贴装精度无法保证的情况，同时受每台机器的结构差异和装配差异、或者同一台机器在不同温度条件下运行，贴装精度在不同机器上表现不一致的问题，本发明第一方面提供一种基于机器视觉的贴装误差实时校正方法，所述方法基于贴片机贴装平面坐标误差校正，先做好准备工作：需要准确标定好贴片机基准标记相机的标尺、安装角度、相对偏移量、传送单元基准宽度；准备玻璃治具，如图1所示，玻璃治具上刻有等间距的标记点，示例性地选用黑色圆形点，待准备工作做好后再进行以下步骤，如图4所示：S1、识别待贴装基板图像上的标记点，获取理论坐标；待贴装基板图像上的标记点也是贴装点，理论上各标记点等间距排列。S2、标定贴装平面坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差，根据标记点的所述理论坐标得到消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差后的理论基板贴装坐标。进一步地，如图3所示，步骤S2包括以下过程：S21、标定贴片机平面坐标系X轴和Y轴的夹角；具体包以下步骤：贴片机传送轨道传入玻璃治具并固定；驱动贴装头移动，按照理论坐标依次运动到玻璃治具上的标记点位置，使用贴装头上的基准相机获取玻璃治具图像；基于玻璃治具图像识别并计算出每个标记点的坐标；取各行点阵，每行拟合成直线，所有按行拟合的直线平均斜率记为；取各列点阵，每列拟合成直线，所有按列拟合的直线平均斜率为；得到的计算公式如下：。S22、将待贴装基板上标记点的理论坐标转换为X轴和Y轴的夹角为的倾斜平面坐标系坐标；如图2所示，将待贴装基板上标记点坐标转换到倾斜的坐标系下，记原始理论坐标为，倾斜坐标系下坐标为/＞，/＞单位均为：degree，得出理论坐标和倾斜坐标系下坐标的转换关系：。S23、建立消除轴形变误差的坐标与倾斜平面坐标系坐标的转换关系；考虑轴形变情况下的坐标记为，得到与倾斜坐标系下坐标的转换关系：进而可得，，为消除轴形变误差后的坐标，kx1、kx2、ky1、ky2、bx、by均为待求解的所述X轴和Y轴形变的具体参数。S24、计算待贴装基板在机器内部的夹持角度，依据所述转换关系，建立消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差的理论基板贴装坐标与所述理论坐标的关系式，根据关系式进行多项式拟合计算出X轴和Y轴形变的具体参数；如图5所示，考虑实际贴装的基板在机器内部的夹持角度，待贴装基板上的两个标记点在倾斜坐标系下的理论坐标分别为,/＞,计算两个标记点连线和X轴夹角/＞；/＞分别为两个标记点实际识别坐标。计算/＞为两点连线和X轴的夹角/＞。夹持角度记为/＞。标记点理论坐标和实际坐标如图6所示：=/＞-/＞。计算考虑轴形变、坐标系倾斜、贴装基板夹持角度修正后的理论基板贴装坐标：修正后的理论基板贴装坐标和原始理论坐标的关系如下式：其中，；；；；；；多项式拟合得到、/＞、/＞、/＞、/＞、/＞。根据以上公式，进而得到最终轴形变的各项参数：。S25、根据X轴和Y轴形变的具体参数得到所述实际坐标。此时，即完成了理论贴装坐标到修正后的理论基板贴装坐标的转换。本发明另一实施例中，某一贴片机标定得到X轴和Y轴形变的具体参数后进行保存，后续对不同贴装基板贴装时无需再进行标定，只需要贴装基板在机器内部的夹持角度后，将保存的X轴和Y轴形变的具体参数直接代入计算即可得到该贴装基板上各个贴装点的理论基板贴装坐标，实现实时贴装。本发明另一实施例中，步骤2中可以采用玻璃治具进行标定，从而获得某一贴片机标定X轴和Y轴形变的具体参数。S3、以标记点的理论基板贴装坐标为参照进行贴装。本发明另一实施例中，进一步优选地，实际使用时，可能存在和/＞波动较大的情况，数学建模实际可能不够准确，进而进行二次推导轴形变情况下的坐标/＞，与倾斜坐标系下坐标/＞的转换关系为：进而得到和原始理论坐标/＞的关系：所以，步骤4中，修正后的理论基板贴装坐标和/＞的关系：其中，；；；；；；；；；；；；多项式拟合得到、/＞、/＞、/＞、/＞、/＞、/＞、/＞、/＞。根据以上公式，进而得到最终轴形变的各项参数：此时，即完成了理论贴装坐标到修正后的理论基板贴装坐标的转换。基于与上述基于机器视觉的贴装误差实时校正方法的同一发明构思，本发明实施例第二方面提供一种基于机器视觉的贴装误差标定系统，包括：运动控制模块，用于驱动贴装头在贴片机XY坐标系中运动到指定的坐标位置，驱动调宽轴运动至预设的轨道宽度以放入玻璃治具，驱动传送轨道运送治具至指定区域并夹持固定；图像采集模块，包括玻璃治具和基准相机，用于通过基准相机采集玻璃治具图像；图像识别模块，用于识别玻璃治具上标记点的实际识别坐标，获取各标记点的实际识别坐标和理论坐标的偏差；数据存储系统：用于存储图像识别模块得到的玻璃治具各标记点的实际识别坐标和理论坐标的偏差；坐标计算模块：用于根据图像识别模块识别结果和数据存储系统存储的偏差计算贴片机X轴和Y轴形变的具体参数。基于与上述基于机器视觉的贴装误差实时校正方法的同一发明构思，本发明实施例第三方面提供一种基于机器视觉的贴装误差实时校正系统，包括：运动控制模块，用于驱动贴装头在贴片机XY坐标系中运动到指定的坐标位置，驱动调宽轴运动至预设的轨道宽度以放入玻璃治具或待贴装基板，驱动传送轨道运送玻璃治具或待贴装基板至指定区域夹持固定，以及用于根据误差修正模块获取的待贴装基板标记点的理论基板贴装坐标，进行贴装；图像识别模块，用于识别玻璃治具或待贴装基板图像上的标记点，获取理论坐标；误差修正模块，用于标定贴装平面坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差，根据标记点的所述理论坐标得到消除坐标系倾斜误差、X和Y轴形变误差以及待贴装基板夹持倾斜误差后的理论基板贴装坐标。插值补偿方法生成平面补偿数据，相当于一种静态补偿，实际贴装时按照补偿数据线性插值校正坐标，在机器运行温度变化后，补偿数据可能失效，且单纯基于识别圆形坐标计算误差极易受到治具加工精度影响，另外需要采样的圆的集合尽可能覆盖最大贴装区域。实际使用该方法后发现补偿效果很有限，目前校正系统中已放弃该校正项。动态误差补偿考虑位置坐标、温度变化的影响，建立这两个变量和最终校正值的数学关系，做到实时动态补偿坐标误差。但是该方法没有考虑另一根轴对当前轴的影响，且如果需要实际运用的话，要实时多点测量温度，再带入数学模型中进行计算，如果要运用到贴片机生产运行过程中，操作难度大，作为实际的产品，难以运用该技术。与当前机器系统所使用的上述校正方法相比，本发明所实现的校正方法考虑了实际机器轴变形、XY轴不垂直带来的影响。实测布满圆形点阵的玻璃治具上的点圆心坐标，和本发明技术方案修正后的理论坐标相比，最大差异不超过5μm。综上所述，本发明技术方案考虑到轴形变、坐标系倾斜、待贴装基板夹持角度情况造成的误差影响，基于贴片机贴装平面坐标对轴形变、坐标系倾斜、待贴装基板夹持角度造成的误差进行标定，从而得到修正后的理论贴装坐标作为实际贴装和CPK检测的参考理论坐标，不仅提高了贴装精度，还克服了受每台机器的结构差异和装配差异、或者同一台机器在不同温度条件下运行，贴片机贴装平面坐标误差在不同机器上表现不一致的问题；此外，在贴装生产过程，不改变当前机器动作流程，依然是实时校正的方式，考虑机器变形、XY轴不垂直带来的影响，校正后的理论坐标实测更接近实际情况。以上结合附图详细描述了本发明的优选实施方式，但是，本发明并不限于此。在本发明的技术构思范围内，可以对本发明的技术方案进行多种简单变型包括各个具体技术特征以任何合适的方式进行组合。为了避免不必要的重复，本发明对各种可能的组合方式不再另行说明。但这些简单变型和组合同样应当视为本发明所公开的内容，均属于本发明的保护范围。
