标题title
一种基于物联网的多仪器设备自动测控方法及系统
摘要abst
本发明公开了一种基于物联网的多仪器设备自动测控方法及系统，属于物联网技术领域。所述方法包括以下步骤：控制台模块给适配单元配置工作模式、电源控制参数、采集通道参数和图像故障判别模式；适配单元采集被测DYT产品输出的第一视频，并将第一视频做多路选择得到第二视频并输出到同轴接口，同时适配单元将第二视频输出到VGA接口；控制台模块使用误帧图像生成方法，将待处理视频和第一视频进行逐帧对比得到误帧图像，计算总体误帧率，将误帧图像加上时间戳与待处理视频一起保存并生成测试报表。实现对产品测试的自动化，降低人为因素的误判，提升产品测试效率，反馈优化产品的设计、调试、生产和实验等产品生命周期的重要节点。
权利要求书clms
1.一种基于物联网的多仪器设备自动测控方法，其特征在于：包括以下步骤：S1：控制台模块给适配单元配置工作模式、电源控制参数、采集通道参数和图像故障判别模式；S2：适配单元根据工作模式、电源控制参数、采集通道参数和图像故障判别模式给被测DYT产品提供分配后的电源，同时控制台模块通过适配单元向被测DYT产品发送控制指令和待处理视频，被测DYT产品开始工作并输出第一视频；S3：适配单元采集被测DYT产品输出的第一视频，并将第一视频做多路选择得到第二视频并输出到同轴接口，同时适配单元将第二视频输出到VGA接口；S4：高清录像机模块对第二视频进行存储，同时适配单元根据图像判别模式使用故障判断方法对第二视频进行故障判断，若出现故障，则将第二视频标记为故障视频并将故障信息传输给控制台模块，控制台模块弹出故障提示窗，用户端通过故障提示端打开故障视频；S5：控制台模块使用误帧图像生成方法，将待处理视频和第一视频进行逐帧对比得到误帧图像，计算总体误帧率，将误帧图像加上时间戳与待处理视频一起保存并生成测试报表。2.根据权利要求1所述的基于物联网的多仪器设备自动测控方法，其特征在于：所述的电源控制参数包括：电源输出电压上下限和电流上限；所述的采集通道参数包括：接入通道配置、图像拼接设置和图像上传设置；所述的图像故障判别模式包括：故障种类选择和故障灵敏度设置。3.根据权利要求1所述的基于物联网的多仪器设备自动测控方法，其特征在于：所述的控制台模块通过适配单元向被测DYT产品发送的控制指令为RS422控制指令和RS232控制指令。4.根据权利要求1所述的基于物联网的多仪器设备自动测控方法，其特征在于：每个被测DYT产品输出的第一视频有N路，适配单元生成的第二视频也有N路，适配单元从N路第二视频中选择选1路或将N路第二视频合为1路输出到VGA接口，N小于等于4。5.根据权利要求1所述的基于物联网的多仪器设备自动测控方法，其特征在于：所述的高清录像机模块能将第二视频做画中画显示；控制台模块能通过LAN访问高清录像机模块。6.根据权利要求3所述的基于物联网的多仪器设备自动测控方法，其特征在于：所述的适配单元检测被测DYT产品输出的通断信号，并读取RS422控制指令和RS232控制指令得到控制指令数据，将控制指令数据通过LAN发送给控制台模块，控制台模块将控制指令数据存储于数据库，同时对控制指令数据进行解析后通过数值、图和表进行显示；所述的控制台模块读取温度传感器和加速度传感器的数值，进行温度试验和振动试验。7.根据权利要求1所述的基于物联网的多仪器设备自动测控方法，其特征在于：所述的故障判断方法包括以下步骤：S41：适配单元判断视频解码芯片的视频有效信号引脚的信号是否为有效，若无效则表示出现无视频信号故障，若有效表明视频信号正常，则逐帧获取完整的第二视频图像帧数据包；S42：若视频信号正常，获取第二视频图像帧数据包中的帧号信息，并记录，将当前图像帧号与上一帧图像帧号做差值，若差值大于1，则说明出现掉帧故障；S43：若视频信号正常，获取第二视频图像帧数据包中的分辨率信息，若该分辨率与第一视频的已知分辨率不相等，则该帧图像为分辨率异常故障；S44：若视频信号正常，且获取第二视频图像帧数据包中的分辨率信息为正常分辨率，则获取第二视频图像帧数据包中行数据帧的真实大小，得到图像真实宽度，累计第二视频图像帧数据包中行数据帧的帧数，得到图像真实高度，若分辨率信息的宽、高小于图像真实宽、高，则表示该帧图像为信号不完整故障；S45：若第二视频出现步骤S41~S44中的任一故障，则将该视频标记为故障视频并将故障信息传输给控制台模块。8.根据权利要求1所述的基于物联网的多仪器设备自动测控方法，其特征在于：所述的误帧图像生成方法包括以下步骤：S51：控制台模块将待处理视频和第一视频分别按帧为单位进行读取，得到两帧图像；S52：将获取的两帧图像数据，按图像帧进行隔行抽取，以压缩图像的大小，提高误帧图像识别速率；S53：对两帧图像进行canny边缘检测，判断两帧图像的边沿位置是否重合，若不重合，则此帧图像为错误帧；S54：利用hough算法计算出两帧图像的偏转角度，判断两帧图像偏转角度是否一致，若不一致，则此帧图像为错误帧；S55：若步骤S51~S54中识别该帧为错误帧，则将第一视频的原图像帧保存为误帧图像，并在图像中加入时间戳，同时对错误帧总数进行累加计数；S56：重复步骤S51~S55，生成误帧图像的同时，保存待处理视频的原视频，直到待处理视频检测完成，计算总体误帧率=错误帧总数/视频总帧数，最后根据检测结果生成测试报表。9.根据权利要求1-8任一项所述的基于物联网的多仪器设备自动测控方法，其特征在于：所述的适配单元和被测DYT产品有多个。10.一种基于物联网的多仪器设备自动测控系统，其特征在于：用于实现如权利要求1-9任一项基于物联网的多仪器设备自动测控方法，包括：被测DYT产品、适配单元、直流电源、网络交换机、高清录像机模块、控制台模块、显示器、温度传感器、加速度传感器和UPS电源；UPS电源连接控制台模块、显示器、直流电源、网络交换机，温度传感器和加速度传感器连接控制台模块，控制台模块连接网络交换机和显示器，直流电源连接适配单元，网络交换机连接高清录像机和适配单元，适配单元连接被测DYT产品。
说明书desc
技术领域本发明涉及物联网技术领域，尤其涉及一种基于物联网的多仪器设备自动测控方法及系统。背景技术互联网、大数据、云计算技术的发展推动了测试系统向更有价值的方向发展，这其中的关键就是基于物联网的多仪器设备自动测控。目前的大部分自动测试系统仅将数据从人工记录转变为电子记录，往往缺乏对数据信息化的考虑，未能充分发挥测试数据的价值，如何科学高效的对数据进行挖掘和利用，以此来反馈优化产品的设计、调试、生产和实验等产品生命周期的重要节点，是新一代自动测试平台所着重研究的内容。发明内容本发明的目的在于克服现有技术的不足，提供一种基于物联网的多仪器设备自动测控方法及系统。本发明的目的是通过以下技术方案来实现的：本发明第一方面提供：一种基于物联网的多仪器设备自动测控方法，包括以下步骤：S1：控制台模块给适配单元配置工作模式、电源控制参数、采集通道参数和图像故障判别模式；S2：适配单元根据工作模式、电源控制参数、采集通道参数和图像故障判别模式给被测DYT产品提供分配后的电源，同时控制台模块通过适配单元向被测DYT产品发送控制指令和待处理视频，被测DYT产品开始工作并输出第一视频；S3：适配单元采集被测DYT产品输出的第一视频，并将第一视频做多路选择得到第二视频并输出到同轴接口，同时适配单元将第二视频输出到VGA接口；S4：高清录像机模块对第二视频进行存储，同时适配单元根据图像判别模式使用故障判断方法对第二视频进行故障判断，若出现故障，则将第二视频标记为故障视频并将故障信息传输给控制台模块，控制台模块弹出故障提示窗，用户端通过故障提示端打开故障视频；S5：控制台模块使用误帧图像生成方法，将待处理视频和第一视频进行逐帧对比得到误帧图像，计算总体误帧率，将误帧图像加上时间戳与待处理视频一起保存并生成测试报表。优选的，所述的电源控制参数包括：电源输出电压上下限和电流上限；所述的采集通道参数包括：接入通道配置、图像拼接设置和图像上传设置；所述的图像故障判别模式包括：故障种类选择和故障灵敏度设置。优选的，所述的控制台模块通过适配单元向被测DYT产品发送的控制指令为RS422控制指令和RS232控制指令。优选的，每个被测DYT产品输出的第一视频有N路，适配单元生成的第二视频也有N路，适配单元从N路第二视频中选择选1路或将N路第二视频合为1路输出到VGA接口，N小于等于4。优选的，所述的高清录像机模块能将第二视频做画中画显示；控制台模块能通过LAN访问高清录像机模块。优选的，所述的适配单元检测被测DYT产品输出的通断信号，并读取RS422控制指令和RS232控制指令得到控制指令数据，将控制指令数据通过LAN发送给控制台模块，控制台模块将控制指令数据存储于数据库，同时对控制指令数据进行解析后通过数值、图和表进行显示；所述的控制台模块读取温度传感器和加速度传感器的数值，进行温度试验和振动试验。优选的，所述的故障判断方法包括以下步骤：S41：适配单元判断视频解码芯片的视频有效信号引脚的信号是否为有效，若无效则表示出现无视频信号故障，若有效表明视频信号正常，则逐帧获取完整的第二视频图像帧数据包；S42：若视频信号正常，获取第二视频图像帧数据包中的帧号信息，并记录，将当前图像帧号与上一帧图像帧号做差值，若差值大于1，则说明出现掉帧故障；S43：若视频信号正常，获取第二视频图像帧数据包中的分辨率信息，若该分辨率与第一视频的已知分辨率不相等，则该帧图像为分辨率异常故障；S44：若视频信号正常，且获取第二视频图像帧数据包中的分辨率信息为正常分辨率，则获取第二视频图像帧数据包中行数据帧的真实大小，得到图像真实宽度，累计第二视频图像帧数据包中行数据帧的帧数，得到图像真实高度，若分辨率信息的宽、高小于图像真实宽、高，则表示该帧图像为信号不完整故障；S45：若第二视频出现步骤S41~S44中的任一故障，则将该视频标记为故障视频并将故障信息传输给控制台模块。优选的，所述的误帧图像生成方法包括以下步骤：S51：控制台模块将待处理视频和第一视频分别按帧为单位进行读取，得到两帧图像；S52：将获取的两帧图像数据，按图像帧进行隔行抽取，以压缩图像的大小，提高误帧图像识别速率；S53：对两帧图像进行canny边缘检测，判断两帧图像的边沿位置是否重合，若不重合，则此帧图像为错误帧；S54：利用hough算法计算出两帧图像的偏转角度，判断两帧图像偏转角度是否一致，若不一致，则此帧图像为错误帧；S55：若步骤S51~S54中识别该帧为错误帧，则将第一视频的原图像帧保存为误帧图像，并在图像中加入时间戳，同时对错误帧总数进行累加计数；S56：重复步骤S51~S55，生成误帧图像的同时，保存待处理视频的原视频，直到待处理视频检测完成，计算总体误帧率=错误帧总数/视频总帧数，最后根据检测结果生成测试报表。优选的，所述的适配单元和被测DYT产品有多个。本发明第二方面提供：一种基于物联网的多仪器设备自动测控系统，用于实现如上述任一种基于物联网的多仪器设备自动测控方法，包括：被测DYT产品、适配单元、直流电源、网络交换机、高清录像机模块、控制台模块、显示器、温度传感器、加速度传感器和UPS电源；UPS电源连接控制台模块、显示器、直流电源、网络交换机，温度传感器和加速度传感器连接控制台模块，控制台模块连接网络交换机和显示器，直流电源连接适配单元，网络交换机连接高清录像机和适配单元，适配单元连接被测DYT产品。本发明的有益效果是：1）通过对多测试设备的集成控制，实现对产品测试的自动化，降低人为因素的误判，提升产品测试效率。2）对测试数据进行采、传、存、算，通过大数据自动化分析，以此实现对测试数据科学高效的挖掘和利用，以此来反馈优化产品的设计、调试、生产和实验等产品生命周期的重要节点。附图说明图1为本发明基于物联网的多仪器设备自动测控方法流程图；图2为基于物联网的多仪器设备自动测控系统框图；图3为控制台模块数据传输简图。具体实施方式下面将结合实施例，对本发明的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域技术人员在没有付出创造性劳动的前提下所获得的所有其他实施例，都属于本发明保护的范围。具体测试过程如图1所示，①云平台下发命令，②控制台发送云平台命令到各仪器设备，③被测产品上电，④控制台发送图像到被测产品，⑤控制台接收被测产品发出的图像，⑥控制台发送的图像和接收到的图像在控制台内进行对比，⑦控制台上传图像对比结果。被测产品的测试过程按上面序号顺序执行，完成产品的自动化测试。在整个测试系统中控制台起着至关重要的作用，既连着云平台，又连着测试设备和产品，且在控制台中完成关键的图像对比功能。控制台根据被测产品的功能要求，产生相应格式的图像输出，同时还能够接收相应的格式图像进行逐帧对比。控制台还具有存储功能，能够存储误码图像，在云平台调取误码图像时有序上传。控制台根据各仪器设备的通讯协议，控制着各仪器设备，使整个测试系统能够在控制台的控制下有条不紊的工作。参阅图1-图3，本发明第一方面提供：一种基于物联网的多仪器设备自动测控方法，包括以下步骤：S1：控制台模块给适配单元配置工作模式、电源控制参数、采集通道参数和图像故障判别模式；S2：适配单元根据工作模式、电源控制参数、采集通道参数和图像故障判别模式给被测DYT产品提供分配后的电源，同时控制台模块通过适配单元向被测DYT产品发送控制指令和待处理视频，被测DYT产品开始工作并输出第一视频；S3：适配单元采集被测DYT产品输出的第一视频，并将第一视频做多路选择得到第二视频并输出到同轴接口，同时适配单元将第二视频输出到VGA接口；S4：高清录像机模块对第二视频进行存储，同时适配单元根据图像判别模式使用故障判断方法对第二视频进行故障判断，若出现故障，则将第二视频标记为故障视频并将故障信息传输给控制台模块，控制台模块弹出故障提示窗，用户端通过故障提示端打开故障视频；S5：控制台模块使用误帧图像生成方法，将待处理视频和第一视频进行逐帧对比得到误帧图像，计算总体误帧率，将误帧图像加上时间戳与待处理视频一起保存并生成测试报表。在一些实施例中，所述的电源控制参数包括：电源输出电压上下限和电流上限；所述的采集通道参数包括：接入通道配置、图像拼接设置和图像上传设置；所述的图像故障判别模式包括：故障种类选择和故障灵敏度设置。在一些实施例中，所述的控制台模块通过适配单元向被测DYT产品发送的控制指令为RS422控制指令和RS232控制指令。在一些实施例中，每个被测DYT产品输出的第一视频有N路，适配单元生成的第二视频也有N路，适配单元从N路第二视频中选择选1路或将N路第二视频合为1路输出到VGA接口，N小于等于4。在一些实施例中，所述的高清录像机模块能将第二视频做画中画显示；控制台模块能通过LAN访问高清录像机模块。在一些实施例中，所述的适配单元检测被测DYT产品输出的通断信号，并读取RS422控制指令和RS232控制指令得到控制指令数据，将控制指令数据通过LAN发送给控制台模块，控制台模块将控制指令数据存储于数据库，同时对控制指令数据进行解析后通过数值、图和表进行显示；所述的控制台模块读取温度传感器和加速度传感器的数值，进行温度试验和振动试验。在一些实施例中，所述的故障判断方法包括以下步骤：S41：适配单元判断视频解码芯片的视频有效信号引脚的信号是否为有效，若无效则表示出现无视频信号故障，若有效表明视频信号正常，则逐帧获取完整的第二视频图像帧数据包；S42：若视频信号正常，获取第二视频图像帧数据包中的帧号信息，并记录，将当前图像帧号与上一帧图像帧号做差值，若差值大于1，则说明出现掉帧故障；S43：若视频信号正常，获取第二视频图像帧数据包中的分辨率信息，若该分辨率与第一视频的已知分辨率不相等，则该帧图像为分辨率异常故障；S44：若视频信号正常，且获取第二视频图像帧数据包中的分辨率信息为正常分辨率，则获取第二视频图像帧数据包中行数据帧的真实大小，得到图像真实宽度，累计第二视频图像帧数据包中行数据帧的帧数，得到图像真实高度，若分辨率信息的宽、高小于图像真实宽、高，则表示该帧图像为信号不完整故障；S45：若第二视频出现步骤S41~S44中的任一故障，则将该视频标记为故障视频并将故障信息传输给控制台模块。在一些实施例中，所述的误帧图像生成方法包括以下步骤：S51：控制台模块将待处理视频和第一视频分别按帧为单位进行读取，得到两帧图像；S52：将获取的两帧图像数据，按图像帧进行隔行抽取，以压缩图像的大小，提高误帧图像识别速率；S53：对两帧图像进行canny边缘检测，判断两帧图像的边沿位置是否重合，若不重合，则此帧图像为错误帧；S54：利用hough算法计算出两帧图像的偏转角度，判断两帧图像偏转角度是否一致，若不一致，则此帧图像为错误帧；S55：若步骤S51~S54中识别该帧为错误帧，则将第一视频的原图像帧保存为误帧图像，并在图像中加入时间戳，同时对错误帧总数进行累加计数；S56：重复步骤S51~S55，生成误帧图像的同时，保存待处理视频的原视频，直到待处理视频检测完成，计算总体误帧率=错误帧总数/视频总帧数，最后根据检测结果生成测试报表。在一些实施例中，所述的适配单元和被测DYT产品有多个。控制台通过LAN给每个适配单元设置工作模式、电源控制参数、采集通道参数、图像故障判别模式等；通用适配终端接收到配置数据后，按预设模式工作，给被测DYT产品提供分配后的电源。同时，控制台通过通用适配终端向被测DYT发送RS422和RS232控制指令，DYT开始工作；适配单元采集被测DYT产品输出的视频，并将DYT输出的几路视频做多路选择输出至同轴接口，同时输出至VGA接口，以便外接显示器时显示适配画面；20个适配单元共输出20路同轴视频，采用高清录像机对20路视频进行存储，同时高清录像机还带有画面实时显示功能，可20路视频画面做画中画显示，需要单独切换出某一路视频，还可单独放大显示；控制台还可通过LAN访问高清录像机；同时，视频单元根据预设图像判别模式对每路视频信号进行故障判断，若出现故障，则通知控制台，控制台弹出故障提示窗，用户可根据提示窗打开该段故障视频回放；通用适配终端还检测被测DYT产品输出的通断信号，并读取其RS422和RS232的数据，将获得的所有数据通过LAN转发给控制台，控制台将数据存储于数据库，同时对数据进行解析后通过数值、图、表等方式进行显示；控制台通过USB-RS485分别读取温度传感器和加速度传感器的数值，便于后期做温度试验和振动试验时的试验状态标记，以及试验阶段的控制方式参考；控制台根据测试结果生产测试报表，并提供报表查询等功能；本发明第二方面提供：一种基于物联网的多仪器设备自动测控系统，用于实现如上述任一种基于物联网的多仪器设备自动测控方法，包括：被测DYT产品、适配单元、直流电源、网络交换机、高清录像机模块、控制台模块、显示器、温度传感器、加速度传感器和UPS电源；UPS电源连接控制台模块、显示器、直流电源、网络交换机，温度传感器和加速度传感器连接控制台模块，控制台模块连接网络交换机和显示器，直流电源连接适配单元，网络交换机连接高清录像机和适配单元，适配单元连接被测DYT产品。如图2所示，基于物联网的多仪器设备自动测控系统由控制台、通用适配终端、显示器、网络交换机、高清录像机、直流电源及不间断电源组成。整个测试系统采用分布式架构，通用适配终端内的20个适配单元功能完全一致，通过以太网连接至控制台，由控制台对其工作参数配置，每个适配单元可分别连接1个被测DYT。整个测试系统电源通过UPS提供不间断电源，市电异常断电后，系统仍可继续工作5~10min。本系统是基于物联网实现被测产品与云平台互联，云平台通过网络交换机与多个控制台相连，控制台通过网络交换机与测试设备以及被测产品互联。各控制台负责测试被测产品的图像收发，接收到每帧图像后与原图进行对比，保存误帧图像，并计算总体误帧率。通过网络向云平台上传误帧图像、原图及误帧率。如图3所示，多台控制器通过网络连接到云平台。每个控制台连接20个被测产品。被测产品的测试数据保存在各控制台，出现误帧图像时，控制台会在误帧图像上加上时间戳，并与原图一起保存，方便对比分析问题。测试数据可以在各控制台察看，也可以在云平台上察看。最终测试结果按测试时间、装配批次保存在云平台。以上所述仅是本发明的优选实施方式，应当理解本发明并非局限于本文所披露的形式，不应看作是对其他实施例的排除，而可用于各种其他组合、修改和环境，并能够在本文所述构想范围内，通过上述教导或相关领域的技术或知识进行改动。而本领域人员所进行的改动和变化不脱离本发明的精神和范围，则都应在本发明所附权利要求的保护范围内。
