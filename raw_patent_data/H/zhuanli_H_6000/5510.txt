标题title
一种数据通信方法、电子设备及存储介质
摘要abst
本发明涉及一种数据通信方法、电子设备及存储介质，该方法包括以下步骤：在数据接收端执行数据接收时，根据数据接收端的接收数据对数据传输过程的数据传输速率进行判定；在判定数据传输速率出现下降时，通过数据接收端向数据发送端发送预设数量的测试信用；获取数据传输速率的变化趋势，并在数据传输速率上升时，判定数据传输过程出现信用丢失。实施本发明能够快速识别数据通信中的异常是否为信用丢失所造成，以实现对部分通信异常快速定位。
权利要求书clms
1.一种数据通信方法，其特征在于，包括以下步骤：在数据接收端执行数据接收时，根据所述数据接收端的接收数据对数据传输过程的数据传输速率进行判定；在判定所述数据传输速率出现下降时，通过所述数据接收端向数据发送端发送预设数量的测试信用；获取所述数据传输速率的变化趋势，并在所述数据传输速率上升时，判定所述数据传输过程出现信用丢失。2.根据权利要求1所述的数据通信方法，其特征在于，所述方法还包括：获取所述数据接收端的RSSI值，以根据所述RSSI值获取所述数据传输过程对应的目标数据传输速率；获取所述数据传输速率相对于所述目标数据传输速率的传输速率下降程度，以根据所述传输速率下降程度判定信用丢失个数。3.根据权利要求1所述的数据通信方法，其特征在于，所述根据所述数据接收端的接收数据对数据传输过程的数据传输速率进行判定；包括：使得所述数据接收端的接收数据依次通过设置于所述数据接收端的第一缓存区和第二缓存区，并获取所述接收数据相对于所述第一缓存区的第一数据通过速率和所述第二缓存区的第二数据通过速率；在所述第二数据通过速率大于所述第一数据通过速率，且所述第一数据通过速率相对于所述第二数据通过速率的变化值超过预设门限时，判定所述数据传输速率出现下降。4.根据权利要求1所述的数据通信方法，其特征在于，所述通过所述数据接收端向数据发送端发送预设数量的测试信用；包括：获取当前所述数据接收端向所述数据发送端发送的实际信用个数，在所述实际信用个数的基础上按照预设比例增加信用个数以得到所述测试信用。5.根据权利要求4所述的数据通信方法，其特征在于，所述获取所述数据传输速率的变化趋势；包括：获取一个完整的第一预设时间间隔对应的第一数据传输速率，以根据所述第一数据传输速率判定所述数据传输速率的变化趋势；其中所述第一预设时间间隔为以所述测试信用开始发送时间点为起点、以第一预设时长为间隔形成的时间段。6.根据权利要求5所述的数据通信方法，其特征在于，所述获取所述数据传输速率的变化趋势；还包括：停止所述数据接收端向所述数据发送端的测试信用的发送，并恢复所述数据接收端向所述数据发送端发送所述实际信用个数；获取一个完整的第二预设时间间隔对应的第二数据传输速率，以根据所述第一数据传输速率和所述第二数据传输速率判定所述数据传输速率的变化趋势；其中，所述第二预设时间间隔为以所述测试信用停止发送时间点为起点、以第二预设时长为间隔形成的时间段。7.根据权利要求4所述的数据通信方法，其特征在于，所述获取所述数据传输速率的变化趋势；还包括：重复预设次数的通过所述数据接收端发送预设数量的测试信用的过程，以得到每次对应的数据传输速率变化情况；根据所有的数据传输速率变化情况获取所述数据传输速率的变化趋势。8.根据权利要求7所述的数据通信方法，其特征在于，所述方法还包括：在根据任意一次的数据传输速率变化情况得到的所述数据传输速率的变化趋势不为上升状态时，恢复所述数据接收端向所述数据发送端发送所述实际信用个数。9.一种电子设备，其特征在于，包括存储器和处理器；所述存储器用于存储计算机程序；所述处理器用于执行所述计算机程序实现如权利要求1至8任一项所述的方法。10.一种计算机存储介质，其上存储有计算机程序，其特征在于，所述计算机程序被处理器执行时实现如权利要求1至8中任意一项所述的方法。
说明书desc
技术领域本发明涉及通信技术领域，更具体地说，涉及一种数据通信方法、电子设备及存储介质。背景技术在蓝牙数据传输中，基于RFCOMM协议建立之初，在数据传输前，接收数据者会给到发送数据者一定的信用个数，在进行数据传输时，发送数据者每发送一个数据包就消耗一个信用个数，消耗到一定数量的信用个数后，接收数据者会再给到同样个数的信用个数给到发送数据者。例如：接收数据者会给发送数据授权credit =4。允许发送数据者发送4包，接收数据者每接收一个数据包，就会将可接收的数据包个数-1，当可接收的数据包个数＜=2的时候，接收数据者就会再次给发送数据者信用。由于最大可接收的信用设定为4，所以彼时接收数据者将发送一个授权2个新的信用包到发送数据者，发送数据者便可继续发送数据包，不然就出现数据传输下降。发送数据者一旦将授权的信用个数用完之后，就将处于拥塞状态，等待接收数据者的授权信用来后，才能继续发送。而在实际的蓝牙数据传输时，受到外界环境的干扰，会出现信用包丢失情况，例如，初始时，接收数据者会给发送数据者授权信用4个，发送数据者在数据传输两次后消耗2个信用，需要接收数据者补发信用包给到发送数据者。当出现信用包丢失时，造成发送数据者未收到新授权的2个信用，此时，对于接收数据者来说，还是会认为有4个信用的额度，但对于发送数据者来说，由于授权的信用包丢失，没收到补发2个新信用，剩余可用信用只有2个，因此，当再次出现数据包或信用包丢失情况后，会造成传输速率下降甚至速率为0情况。而实际上，实际蓝牙数据传输过程中，造成数据传输速率降低的情况是多样化的，基于不同的数据传输降低情况其需要的应对对策也不同，因此识别数据降低是否为信用丢失造成的，在数据通信过程中也是至关重要的。发明内容本发明要解决的技术问题在于，针对现有技术的上述部分技术缺陷，提供一种数据通信方法、电子设备及存储介质。本发明解决其技术问题所采用的技术方案是：构造一种数据通信方法，包括以下步骤：在数据接收端执行数据接收时，根据所述数据接收端的接收数据对数据传输过程的数据传输速率进行判定；在判定所述数据传输速率出现下降时，通过所述数据接收端向数据发送端发送预设数量的测试信用；获取所述数据传输速率的变化趋势，并在所述数据传输速率上升时，判定所述数据传输过程出现信用丢失。优选地，在本发明所述的数据通信方法中，还包括：获取所述数据接收端的RSSI值，以根据所述RSSI值获取所述数据传输过程对应的目标数据传输速率；获取所述数据传输速率相对于所述目标数据传输速率的传输速率下降程度，以根据所述传输速率下降程度判定信用丢失个数。优选地，在本发明所述的数据通信方法中，所述根据所述数据接收端的接收数据对数据传输过程的数据传输速率进行判定；包括：使得所述数据接收端的接收数据依次通过设置于所述数据接收端的第一缓存区和第二缓存区，并获取所述接收数据相对于所述第一缓存区的第一数据通过速率和所述第二缓存区的第二数据通过速率；在所述第二数据通过速率大于所述第一数据通过速率，且所述第一数据通过速率相对于所述第二数据通过速率的变化值超过预设门限时，判定所述数据传输速率出现下降。优选地，在本发明所述的数据通信方法中，所述通过所述数据接收端向数据发送端发送预设数量的测试信用；包括：获取当前所述数据接收端向所述数据发送端发送的实际信用个数，在所述实际信用个数的基础上按照预设比例增加信用个数以得到所述测试信用。优选地，在本发明所述的数据通信方法中，所述获取所述数据传输速率的变化趋势；包括：获取一个完整的第一预设时间间隔对应的第一数据传输速率，以根据所述第一数据传输速率判定所述数据传输速率的变化趋势；其中所述第一预设时间间隔为以所述测试信用开始发送时间点为起点、以第一预设时长为间隔形成的时间段。优选地，在本发明所述的数据通信方法中，所述获取所述数据传输速率的变化趋势；还包括：停止所述数据接收端向所述数据发送端的测试信用的发送，并恢复所述数据接收端向所述数据发送端发送所述实际信用个数；获取一个完整的第二预设时间间隔对应的第二数据传输速率，以根据所述第一数据传输速率和所述第二数据传输速率判定所述数据传输速率的变化趋势；其中，所述第二预设时间间隔为以所述测试信用停止发送时间点为起点、以第二预设时长为间隔形成的时间段。优选地，在本发明所述的数据通信方法中，所述获取所述数据传输速率的变化趋势；还包括：重复预设次数的通过所述数据接收端发送预设数量的测试信用的过程，以得到每次对应的数据传输速率变化情况；根据所有的数据传输速率变化情况获取所述数据传输速率的变化趋势。优选地，在本发明所述的数据通信方法中，还包括：在根据任意一次的数据传输速率变化情况得到的所述数据传输速率的变化趋势不为上升状态时，恢复所述数据接收端向所述数据发送端发送所述实际信用个数。本发明还构造一种电子设备，包括存储器和处理器；所述存储器用于存储计算机程序；所述处理器用于执行所述计算机程序实现如上面任一项所述的方法。本发明还构造一种计算机存储介质，其上存储有计算机程序，所述计算机程序被处理器执行时实现如上面任意一项所述的方法。实施本发明的一种数据通信方法、电子设备及存储介质，具有以下有益效果：能够快速识别数据通信中的异常是否为信用丢失所造成，以实现对部分通信异常快速定位。附图说明下面将结合附图及实施例对本发明作进一步说明，附图中：图1是本发明一种数据通信方法一实施例的程序流程图；图2是本发明一种数据通信方法另一实施例的程序流程图；图3是本发明一种数据通信方法另一实施例的程序流程图。具体实施方式为了对本发明的技术特征、目的和效果有更加清楚的理解，现对照附图详细说明本发明的具体实施方式。如图1所示，在本发明的一种数据通信方法第一实施例中，包括以下步骤：S1、在数据接收端执行数据接收时，根据所述数据接收端的接收数据对数据传输过程的数据传输速率进行判定。具体的，通过数据发送端生成通信数据，数据接收端用来接收该通信数据。其中，通信数据可以理解为目标数据。可以在数据接收端接收通信数据时，对数据接收端接收通信数据的过程进行判断，根据数据接收端的数据接收过程对当前数据发送端和数据接收端之间的数据传输速率进行判定。S2、在判定所述数据传输速率出现下降时，通过所述数据接收端向数据发送端发送预设数量的测试信用。具体的，当能够判定当前数据发送端与数据接收端之间的数据传输速率出现下降时，则可以使得数据接收端进入信用测试模式。数据接收端在进入信用测试模式时，会向数据发送端发送预设数量的测试信用。该发送预设数量测试信用的过程可以按照不同的应用场景进行设置，在发送测试信用的同时，数据接收端还是会按照之前的工作场景向数据发送端发送预设的信用即目标信用，使得数据接收端在进行信用测试时，其实际发送的信用数据会增加。S3、获取所述数据传输速率的变化趋势，并在所述数据传输速率上升时，判定所述数据传输过程出现信用丢失。具体的，在正常情况下，若当前数据传输速率的下降是由于丢失了信用造成的，那么通过增加信用，即补充一定数据的信用后，数据传输速率应该会出现上升。基于此，可以根据数据传输速率是否出现上升来判定数据传输速率下降是否是由于信用丢失造成的。最终得到数据传输过程中是否出现信用丢失的判断结果。实现对通信过程中信用异常进行快速定位的目的，同时通过补发信用亦能够实现数据传输速率的自动恢复。如图2所示，可选的，在本发明的数据通信方法中，还包括：S4、获取所述数据接收端的RSSI值，以根据所述RSSI值获取所述数据传输过程对应的目标数据传输速率；S5、获取所述数据传输速率相对于所述目标数据传输速率的传输速率下降程度，以根据所述传输速率下降程度判定信用丢失个数。具体的，由于在信用的数量不同时，数据传输的数据特征也会不同，其中数据特征的不同是指数据发送端在不同的信用个数的情况下，进行数据通信数据传输时，数据接收端接收的数据传输的速率也是不同的。同时在数据传输过程中，受到数据接收端和数据发送端之间的距离影响，传输速率也会随着距离增加而下降。此时通过获取数据接收端和数据发送端之间的RSSI值，判定数据接收端和数据发送端之间的距离。例如，在一实施例中，当数据接收端和数据发送端之间的RSSI值为-45时，数据接收端和数据发送端之间的距离为1m；当数据接收端和数据发送端之间的RSSI值为-90时，数据接收端和数据发送端之间的距离为8m。此时的数据特征对应的速率区间发生变化，即不同的RSSI值所对应的数据特征不同。而在信用未丢失情况下，数据接收端和数据发送端之间的RSSI值为-45时，数据接收端和数据发送端之间数据传输速率为30kB/s，若出现2个信用数据丢失，其数据传输速率可以变为10kB/s左右时，即基于数据特征的对应变化区间为8~12kB/s。在信用未丢失情况下，当数据接收端和数据发送端之间的RSSI值为-90时，数据传输速率为10kB/s，若丢失2个信用数据，则检测到数据传输速率为6kB/s左右，基于数据特征的对应区间为5~7kB/s为。因此，可以建立RSSI值与目标数据传输速率之间的关系，获取当前实际的数据传输速率与目标数据传输速率之间的关系，即得到所述数据传输速率相对于所述目标数据传输速率的传输速率下降程度，以根据所述传输速率下降程度判定信用丢失个数。该判定过程可以为查表过程，即得到每一RSSI值、目标数据传输速率、传输速率下降程度及信用丢失个数之间的关系，基于实际的RSSI值和实际传输速率下降程度进行查表得到实际的信用丢失个数。该过程可以基于不同的应用场景进行试验得到每一场景对应的表格关系。可选的，如图3所示，所述根据所述数据接收端的接收数据对数据传输过程的数据传输速率进行判定；包括：S11、使得所述数据接收端的接收数据依次通过设置于所述数据接收端的第一缓存区和第二缓存区，并获取所述接收数据相对于所述第一缓存区的第一数据通过速率和所述第二缓存区的第二数据通过速率。S12、在所述第二数据通过速率大于所述第一数据通过速率，且所述第一数据通过速率相对于所述第二数据通过速率的变化值超过预设门限时，判定所述数据传输速率出现下降。具体的，对数据通信过程中的数据传输速率的检测过程可以为，在数据接收端接收数据时，构建两个缓存区即第一缓存区和第二缓存区，用于预设数量数据的缓存。例如：第一缓存区能够存储10个速率数据，并计算出数据在第一缓存区的平均传输速率。第二缓存区也存储相同个数的数据，也是10个速率数据，并计算出数据在第二缓存区的平均传输速率。两个缓存区的数据以先进先出的方式滑动更新。第一缓存区的数据会滑动至第二缓存区。当有新产生的速率数据时，丢弃第二缓存区的最早存入的数据即位于最前面的数据，并将后存入的9个数据往前移动，将第一缓存区的最早存入的数据即最前面的数据拷贝到第二缓存区的最后面，第一缓存区丢弃最早存入的数据，并将后存入的9个数据往前移动，将新产生的速率数据存入第一缓存区的最后面，以实时、动态检测速率的变化。比较两个缓存区分别对应的两个数据通过速率的数值，从而得出传输速率是否下降。比如第二缓存区的平均数据通过速率为 30kB/s，第一缓存区的平均数据通过速率为 18kB/s，说明传输速率下降了。需要理解的是，速率检测是实时检测的，在数据传输过程中，速率是会存在波动的，其波动范围在一定区间内时，可以判定为波动在合理范围内。其中，缓存区的数据数量可以为速率数据，即速率指单位时间内数据的总量除以单位时间，通过设置两个计数器，一个计数器计算数据量的总字节，另一个计数器计算时间，以此计算出速率。可选的，在本发明的数据通信方法中，所述通过所述数据接收端向数据发送端发送预设数量的测试信用；包括：获取当前所述数据接收端向所述数据发送端发送的实际信用个数，在所述实际信用个数的基础上按照预设比例增加信用个数以得到所述测试信用。具体的，数据接收端进入信用测试模式时，可以获取当前数据接收端向数据发送端实际发送的信用个数即当前数据通信过程的目标信用个数，根据该目标信用个数设置测试信用的个数。即可以按照一定的比例得到需要增加的信号个数以得到测试信用的个数。例如，补发的测试信用个数为当前数据接收端给到数据发送端的信用总个数的一半，即测试信用个数为原目标信用个数的一半。数据接收端实际发送的信用个数为原目标信号个数的1.5倍。具体实施过程中，如，正常数据通信时，数据接收端给到数据发送端授权4个信用个数。为了检测信用包是否丢失，其数据接收端会再给到2个测试信用，例如一个测试信用包到数据发送端，此时，数据接收端给到数据发送端的实际信用个数为4+2共6个。可选的，在本发明的数据通信方法中，所述获取所述数据传输速率的变化趋势；包括：获取一个完整第一预设时间间隔对应的第一数据传输速率，以根据所述第一数据传输速率判定所述数据传输速率的变化趋势；其中所述第一预设时间间隔为以所述测试信用开始发送时间点为起点、以第一预设时长为间隔形成的时间段。具体的，在发起信用测试之后，获取一个完整的时间段的传输速率判定为当下的测试速率。其中完整的时间段的理解为，以测试信用开始发送的时间点为起点，按照预设时间间隔划分时间段，例如每隔1s划分一个时间段，获取一个完整的时间段，例如获取一个完整的1s时间段的数据传输速率为第一数据传输速率。其可以理解，如果不能获取一个完整的1s时间段的数据传输速率，则丢弃该时间段的剩余数据，获取下一个完整的1s时间段的数据传输速率为第一数据传输速率。可以根据第一数据传输速率相对于信用测试之间的数据传输速率的变化以得到数据传输速率的变化趋势。可选的，在本发明的数据通信方法中，所述获取所述数据传输速率的变化趋势；还包括：停止所述数据接收端向所述数据发送端的测试信用的发送，并恢复所述数据接收端向所述数据发送端发送所述实际信用个数；获取一个完整第二预设时间间隔对应的第二数据传输速率，以根据所述第一数据传输速率和所述第二数据传输速率判定所述数据传输速率的变化趋势；其中，所述第二预设时间间隔为以所述测试信用停止发送时间点为起点、以第二预设时长为间隔形成的时间段。具体的，还可以停止测试信用发送，并恢复为通过数据接收端向数据发送端发送实际信用个数，获取此时一个完整的时间段的传输速率判定为当下的测试速率。其中完整的时间段的理解为，以测试信用停止发送的时间点为起点，按照预设时间间隔划分时间段，例如每隔1s划分一个时间段，获取一个完整的时间段，例如获取一个完整的1s时间段的数据传输速率为第二数据传输速率。其可以理解，如果不能获取一个完整的1s时间段的数据传输速率，则丢弃该时间段的剩余数据，获取下一个完整的1s时间段的数据传输速率为第二数据传输速率。可以将第二数据传输速率与数据特征对比。在时序中，信用测试发出指令的时间不定，可能会存在于任意时间点上，导致测试时，发出指令的时间点到下一秒节点不是一个完整的1s时间段，需要丢弃发出指令的时间点至下一秒节点之间的一部分数据，保证测试时的传输数据为一个完整1s时间段的有效。具有计算速度快、响应快的特点。在得到第二数据传输速率后，可以将第二数据传输速率与第一数据传输速率进行对比，以进一步验证在信用测试的过程中数据传输速率的变化趋势。若为信用丢失，通过补充测试信用，则可以得到第一数据传输速率相对于初始数据传输速率为变大趋势。当恢复至正常信用时，第二数据传输速率相对于第一数据传输速率为减小趋势。此时第二数据传输速率也相当于初始数据传输速率。在一实施例中，也可以采用将上述的第一缓存区数据速率全部更新后的平均测试值作为信用测试中的测试速率和正常的数据通信过程中的得到的数据传输速率。根据具体的应用环境，还有可以在当出现数据接收端检测数据传输速率为0时，才会触发信用机制，以此克服一些其他方面因素导致速率下降而产生的错误触发，提高检测校正准确性。当传输速率为0时，也采用以上同样的方法进行信用测试。可选的，在本发明的数据通信方法中，所述获取所述数据传输速率的变化趋势；还包括：重复预设次数的通过所述数据接收端发送预设数量的测试信用的过程，以得到每次对应的数据传输速率变化情况；根据所有的数据传输速率变化情况获取所述数据传输速率的变化趋势。具体的，可以多次进行信用测试，每次信用测试后均恢复至正常的数据传输过程，得到多次的数据变化趋势以判断数据传输过程中是否出现信用丢失。进一步的，在根据任意一次的数据传输速率变化情况得到的所述数据传输速率的变化趋势不为上升状态时，恢复所述数据接收端向所述数据发送端发送所述实际信用个数。具体的，当有一次不能判定为信用丢失，即数据传输速率变化趋势不是预期的变化趋势，则可以判定当前的数据通信过程不存在信用丢失异常，即判定出现的数据传输速率下降不是信用包丢失导致速率下降，结束信用测试过程，并恢复数据接收端向数据发送端发送目标信用个数。该方法优点在于数据传输一直在进行，不会出现数据传输暂停的情况，且实时进行测试。为确保识别准确性，每一轮信用测试都要识别一次速率上升即发送测试信用的过程和一次速率下降即结束发送测试信用的过程，任何一次实际值与预期值不符合，都要终止信用测试并将信用个数恢复到测试前的个数，以此防止忘记信用回收造成数据溢出。另，本发明的一种电子设备，还可以包括存储器和处理器；所述存储器用于存储计算机程序；所述处理器用于执行所述计算机程序实现上面任一项的方法。具体的，根据本发明的实施例，上文参考流程图描述的过程可以被实现为计算机软件程序。例如，本发明的实施例包括一种计算机程序产品，其包括承载在计算机可读介质上的计算机程序，该计算机程序包含用于执行流程图所示的方法的程序代码。在这样的实施例中，该计算机程序可以通过电子设备下载和安装并且执行时，执行本发明实施例的方法中限定的上述功能。本发明中的电子设备可为笔记本、台式机、平板电脑、智能手机等终端，也可为服务器。另，本发明的一种计算机存储介质，其上存储有计算机程序，计算机程序被处理器执行时实现上面任意一项的方法。具体的，需要说明的是，本发明上述的计算机可读介质可以是计算机可读信号介质或者计算机可读存储介质或者是上述两者的任意组合。计算机可读存储介质例如可以是但不限于是电、磁、光、电磁、红外线、或半导体的系统、装置或器件，或者任意以上的组合。计算机可读存储介质的更具体的例子可以包括但不限于：具有一个或多个导线的电连接、便携式计算机磁盘、硬盘、随机访问存储器、只读存储器、可擦式可编程只读存储器、光纤、便携式紧凑磁盘只读存储器、光存储器件、磁存储器件、或者上述的任意合适的组合。在本发明中，计算机可读存储介质可以是任何包含或存储程序的有形介质，该程序可以被指令执行系统、装置或者器件使用或者与其结合使用。而在本发明中，计算机可读信号介质可以包括在基带中或者作为载波一部分传播的数据信号，其中承载了计算机可读的程序代码。这种传播的数据信号可以采用多种形式，包括但不限于电磁信号、光信号或上述的任意合适的组合。计算机可读信号介质还可以是计算机可读存储介质以外的任何计算机可读介质，该计算机可读信号介质可以发送、传播或者传输用于由指令执行系统、装置或者器件使用或者与其结合使用的程序。计算机可读介质上包含的程序代码可以用任何适当的介质传输，包括但不限于：电线、光缆、RF等等，或者上述的任意合适的组合。上述计算机可读介质可以是上述电子设备中所包含的；也可以是单独存在，而未装配入该电子设备中。可以理解的，以上实施例仅表达了本发明的优选实施方式，其描述较为具体和详细，但并不能因此而理解为对本发明专利范围的限制；应当指出的是，对于本领域的普通技术人员来说，在不脱离本发明构思的前提下，可以对上述技术特点进行自由组合，还可以做出若干变形和改进，这些都属于本发明的保护范围；因此，凡跟本发明权利要求范围所做的等同变换与修饰，均应属于本发明权利要求的涵盖范围。
