标题title
双模采集数据的上传方法、装置、设备及可读存储介质
摘要abst
本发明涉及数据采集技术领域，公开了一种双模采集数据的上传方法、装置、设备及可读存储介质。其中，该方法包括：获取触发信号；基于触发信号生成超声扫描采集模式对应的超声发射信号和回波接收信号、光学扫描采集模式对应的光学数据接收信号、扫描线信息；按照超声发射信号发射超声波波束，并按照回波接收信号接收超声回波数据；按照光学数据接收信号接收光学扫描数据；基于扫描线信息、超声回波数据以及光学扫描数据，生成针对于光学扫描采集模式的光学帧数据以及超声扫描采集模式的超声帧数据；上传光学帧数据和/或超声帧数据。通过实施本发明技术方案，实现了双模数据的同步采集，保证了双模数据的上传实时性。
权利要求书clms
1.一种双模采集数据的上传方法，其特征在于，包括：获取触发信号；基于所述触发信号生成超声扫描采集模式对应的超声发射信号和回波接收信号、光学扫描采集模式对应的光学数据接收信号、扫描线信息；按照所述超声发射信号在所述超声扫描采集模式下发射超声波波束，并按照所述回波接收信号接收所述超声扫描采集模式对应的超声回波数据；按照所述光学数据接收信号接收所述光学扫描采集模式对应的光学扫描数据；基于所述扫描线信息、所述超声回波数据以及所述光学扫描数据，生成针对于所述光学扫描采集模式的光学帧数据以及所述超声扫描采集模式的超声帧数据；上传所述光学帧数据和/或所述超声帧数据。2.根据权利要求1所述的方法，其特征在于，所述基于所述触发信号生成超声扫描采集模式对应的超声发射信号和回波接收信号、所述光学扫描采集模式对应的光学数据接收信号、扫描线信息，包括：基于所述触发信号的触发频率，对所述触发信号进行分频处理；基于所述分频处理的结果，产生周期性的所述超声发射信号、所述回波接收信号以及所述光学数据接收信号；基于所述触发信号，生成针对于所述光学扫描采集模式的扫描线信息，以及针对于所述超声扫描采集模式的扫描线信息。3.根据权利要求2所述的方法，其特征在于，所述基于所述触发信号的触发频率，对所述触发信号进行分频处理，包括：当检测到所述触发信号的触发脉冲时，判断分频计数值是否达到预设值；当所述分频计数值达到所述预设值时，将所述分频计数值清零并生成分频触发脉冲。4.根据权利要求1所述的方法，其特征在于，所述上传所述光学帧数据和/或超声帧数据，包括：响应于对上传模式的选择操作，基于所述选择操作确定目标上传模式；基于所述目标上传模式确定待上传的目标帧数据，所述目标帧数据为所述光学帧数据和/或所述超声帧数据；将所述目标帧数据以直接存储访问方式进行上传。5.根据权利要求4所述的方法，其特征在于，在所述将所述目标帧数据以直接存储访问方式进行上传之后，还包括：生成针对于所述目标帧数据的中断信号；当所述目标帧数据被读取时，清除所述中断信号。6.根据权利要求4所述的方法，其特征在于，在所述将所述目标帧数据进行上传之前，还包括：获取所述目标帧数据的格式；当所述目标帧数据的格式不满足总线传输格式时，将所述目标帧数据的格式转换为所述总线传输格式。7.根据权利要求1所述的方法，其特征在于，还包括：检测是否开启回拉扫描；当开启所述回拉扫描时，分别缓存所述光学帧数据和所述超声帧数据。8.一种双模采集数据的上传装置，其特征在于，包括：获取模块，用于获取触发信号；扫描模块，用于基于所述触发信号生成超声扫描采集模式对应的超声发射信号和回波接收信号、所述光学扫描采集模式对应的光学数据接收信号、扫描线信息；超声发射和接收模块，用于按照所述超声发射信号在所述超声扫描采集模式下发射超声波波束，并按照所述回波接收信号接收所述超声扫描采集模式对应的超声回波数据；光学接收模块，用于按照所述光学数据接收信号接收所述光学扫描采集模式对应的光学扫描数据；生成模块，用于基于所述扫描线信息、所述超声回波数据以及所述光学扫描数据，生成针对于所述光学扫描采集模式的光学帧数据以及所述超声扫描采集模式的超声帧数据；上传模块，用于上传所述光学帧数据和/或所述超声帧数据。9.一种电子设备，其特征在于，包括：存储器和处理器，所述存储器和所述处理器之间互相通信连接，所述存储器中存储有计算机指令，所述处理器通过执行所述计算机指令，从而执行权利要求1-7任一项所述的双模采集数据的上传方法。10.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质存储有计算机指令，所述计算机指令用于使计算机执行权利要求1-7任一项所述的双模采集数据的上传方法。
说明书desc
技术领域本发明涉及数据采集技术领域，具体涉及一种双模采集数据的上传方法、装置、设备及可读存储介质。背景技术血管内超声和光学相干断层扫描的双模采集主要是通过FPGA同时采集两路经过模数转换的扫描数据，并将经过模数转换的数据按照帧缓存至内存DDR4中，继而通过PCIE总线上传至计算机。目前的双模采集系统主要由扫描模块、发射模块、接收模块、缓存模块、上传模块等组成，且IVUS和OCT共用扫描模块。扫描模块产生各自发射、接收等相关的门控信号。IVUS数据采集系统由发送模块和接收模块组成，发射模块实现脉冲发射控制及ADC配置，接收模块实现ADC采集及增益控制。OCT数据采集系统由上位机控制光模块运行，产生数据经ADC送入到FPGA，扫描模块产生OCT接收门控信号控制数据采集，缓存后再通过PCIE总线进行上传。由于IVUS和OCT是背靠背设置的，且两者由电机控制在人体器官中旋转或者移动。对于双路数据的同步采集，双模采集系统并未产生相应的线扫描信息，且其缓存帧中未包含帧信息，这样不便于快速分析数据；同时在回拉模式下双路采集快速产生大量数据，DDR和PCIE难以保证每一帧数据采集后立刻上传，即采集数据的上传实时性难以保证。发明内容有鉴于此，本发明实施例提供了一种双模采集数据的上传方法、装置、设备及可读存储介质，以解决双模采集数据的上传实时性问题。根据第一方面，本发明实施例提供了一种双模采集数据的上传方法，包括：获取触发信号；基于所述触发信号生成超声扫描采集模式对应的超声发射信号和回波接收信号、所述光学扫描采集模式对应的光学数据接收信号、扫描线信息；按照所述超声发射信号在所述超声扫描采集模式下发射超声波波束，并按照所述回波接收信号接收所述超声扫描采集模式对应的超声回波数据；按照所述光学数据接收信号接收所述光学扫描采集模式对应的光学扫描数据；基于所述扫描线信息、所述超声回波数据以及所述光学扫描数据，生成针对于所述光学扫描采集模式的光学帧数据以及所述超声扫描采集模式的超声帧数据；上传所述光学帧数据和/或所述超声帧数据。本发明实施例提供的双模采集数据的上传方法，通过获取到的触发信号以触发生成相应的超声发射信号、回波接收信号、光学数据接收信号以及扫描线信息，以得到相应的超声帧数据和光学帧数据，继而对光学帧数据和/或所述超声帧数据进行上传。该方法能够在双模扫描过程中产生相应的线扫描信息，便于根据线扫描信息进行数据缓存以产生相应的帧数据，由此便于实现双模数据的同步采集，保证双模数据的上传实时性。结合第一方面，在第一方面的第一实施方式中，所述基于所述触发信号生成超声扫描采集模式对应的超声发射信号和回波接收信号、所述光学扫描采集模式对应的光学数据接收信号、扫描线信息，包括：基于所述触发信号的触发频率，对所述触发信号进行分频处理；基于所述分频处理的结果，产生周期性的所述超声发射信号、所述回波接收信号以及所述光学数据接收信号；基于所述超声发射信号、所述回波接收信号以及所述光学数据接收信号，生成针对于所述光学扫描采集模式的扫描线信息，以及针对于所述超声扫描采集模式的扫描线信息。本发明实施例提供的双模采集数据的上传方法，根据触发信号的触发频率进行分频处理，以生成周期性的超声发射信号、回波接收信号以及光学数据接收信号，便于根据触发频率灵活配置双模采集数据的扫描时序。同时，在接收到触发信号后生成针对于双模采集的扫描线信息，便于双模采集数据能够根据该扫描线信息产生相应的帧信息，保证双模采集数据能够根据帧信息进行数据上传。结合第一方面第一实施方式，在第一方面的第二实施方式中，所述基于所述触发信号的触发频率，对所述触发信号进行分频处理，包括：当检测到所述触发信号的触发脉冲时，判断分频计数值是否为预设值；当所述分频计数值为所述预设值时，将所述分频计数值清零并生成分频触发脉冲。本发明实施例提供的双模采集数据的上传方法，通过检测分频计数值以对当前触发信号进行分频处理，以保证进行有效的分频处理。结合第一方面，在第一方面的第三实施方式中，所述上传所述光学帧数据和/或超声帧数据，包括：响应于对上传模式的选择操作，基于所述选择操作确定目标上传模式；基于所述目标上传模式确定待上传的目标帧数据，所述目标帧数据为所述光学帧数据和/或所述超声帧数据；将所述目标帧数据以直接存储访问方式进行上传。本发明实施例提供的双模采集数据的上传方法，支持上传模式的配置，由此能够根据实际需求上传相应的帧数据，保证了帧数据的上传灵活性。结合第一方面第三实施方式，在第一方面的第四实施方式中，在所述将所述目标帧数据以直接存储访问方式进行上传之后，还包括：生成针对于所述目标帧数据的中断信号；当所述目标帧数据被读取时，清除所述中断信号。本发明实施例提供的双模采集数据的上传方法，在目标帧数据完成数据上传后生成中断信号，只有在该目标帧数据被读取时清除对应的中断信号，由此能够实现采集完一帧数据立即上传一帧数据，保证了数据上传的帧连续性以及上传实时性，避免数据上传错乱。结合第一方面第三实施方式，在第一方面的第五实施方式中，在所述将所述目标帧数据进行上传之前，还包括：获取所述目标帧数据的格式；当所述目标帧数据的格式不满足总线传输格式时，将所述目标帧数据的格式转换为所述总线传输格式。本发明实施例提供的双模采集数据的上传方法，在进行上传之前对目标帧数据的格式进行转换，以使其能够满足总线传输格式，便于通过总线进行数据缓存和数据上传，避免格式差异而导致的数据上传失败，最大程度上保证了数据上传准确度和上传效率。结合第一方面，在第一方面的第六实施方式中，所述方法还包括：检测是否开启回拉扫描；当开启所述回拉扫描时，分别缓存所述光学帧数据和所述超声帧数据。本发明实施例提供的双模采集数据的上传方法，由于回拉扫描需要缓存大量数据，因此需要检测是否开启回拉扫描，在开启回拉扫描时，分别缓存光学帧数据和超声帧数据，以保证帧数据能够实现快速缓存。根据第二方面，本发明实施例提供了一种双模采集数据的上传装置，包括：获取模块，用于获取触发信号；扫描模块，用于基于所述触发信号生成超声扫描采集模式对应的超声发射信号和回波接收信号、所述光学扫描采集模式对应的光学数据接收信号、扫描线信息；超声发射和接收模块，用于按照所述超声发射信号在所述超声扫描采集模式下发射超声波波束，并按照所述回波接收信号接收所述超声扫描采集模式对应的超声回波数据；光学接收模块，用于按照所述光学数据接收信号接收所述光学扫描采集模式对应的扫描数据；生成模块，用于基于所述扫描线信息分别生成针对于所述光学扫描采集模式的光学帧数据以及所述超声扫描采集模式的超声帧数据；上传模块，用于上传所述光学帧数据和/或所述超声帧数据。根据第三方面，本发明实施例提供了一种电子设备，包括：存储器和处理器，所述存储器和所述处理器之间互相通信连接，所述存储器中存储有计算机指令，所述处理器通过执行所述计算机指令，从而执行第一方面或第一方面任一实施方式所述的双模采集数据的上传方法。根据第四方面，本发明实施例提供了一种计算机可读存储介质，所述计算机可读存储介质存储有计算机指令，所述计算机指令用于使计算机执行第一方面或第一方面任一实施方式所述的双模采集数据的上传方法。需要说明的是，本发明实施例提供的双模采集数据的上传装置、电子设备以及计算机可读存储介质的相应有益效果，请参见双模采集数据的上传方法中相应内容的描述，在此不再赘述。附图说明为了更清楚地说明本发明具体实施方式或现有技术中的技术方案，下面将对具体实施方式或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施方式，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1示出了本发明实施例的双模采集设备的结构示意图；图2是根据本发明实施例的双模采集数据的上传方法的流程图；图3示出了本发明实施例的扫描时序示意图；图4是根据本发明实施例的双模采集数据的上传方法的另一流程图；图5是根据本发明实施例的双模采集数据的上传装置的结构框图；图6是本发明实施例提供的电子设备的硬件结构示意图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。根据本发明实施例，提供了一种双模采集数据的上传方法的实施例，需要说明的是，在附图的流程图示出的步骤可以在诸如一组计算机可执行指令的计算机系统中执行，并且，虽然在流程图中示出了逻辑顺序，但是在某些情况下，可以以不同于此处的顺序执行所示出或描述的步骤。在本实施例中提供了一种双模采集数据的上传方法，可用于电子设备，如双模采集设备，以IVUS和OCT的双模采集设备为例，如图1所示，该双模采集设备包括：OCT设备、FPGA控制单元以及上位机，其中FPGA控制单元中包括有扫描模块、IVUS发射模块、IVUS接收模块、OCT接收模块、缓存模块、上传模式确定模块以及上传模块。图2是根据本发明实施例的双模采集数据的上传方法的流程图，如图2所示，该流程包括如下步骤：S11，获取触发信号。IVUS和OCT共用一个扫描模块，触发信号用于触发FPGA控制单元产生扫描时序。其中，该触发信号可以为OCT设备启动后所产生的周期性信号，也可以为FPGA接收到上位机下发的扫描指令后所产生的周期性信号。双模采集设备与上位机通信连接，上位机可以向双模采集设备的下发扫描指令。本实施例中，当双模采集设备接收到上位机下发的扫描指令后，双模采集设备中的OCT设备启动光学扫描采集模式，并产生周期性的触发信号，即图1所示的trigger信号。OCT模块将其产生的触发信号发送至FPGA单元，FPGA单元则可以对该触发信号进行接收。S12，基于触发信号生成超声扫描采集模式对应的超声发射信号和回波接收信号、光学扫描采集模式对应的光学数据接收信号、扫描线信息。超声发射信号用于表征超声波波束的发射门控信号ivus_tx_gate，回波接收信号用于表征超声回波数据的接收门控信号ivus_rx_gate，光学数据接收信号为OCT数据接收信号，即用于表征OCT数据的接收门控信号oct_rx_gate。扫描线信息用于表征血管扫描过程中针对每条扫描线的扫描模式、扫描数据量以及当前处于第几条扫描线等信息。当双模采集设备接收到触发信号后，其可以根据触发信号所对应触发脉冲的边沿为参考，在延迟相应时间后产生合适的超声波波束的发射门控信号ivus_tx_gate、超声回波数据的接收门控信号ivus_rx_gate以及OCT数据接收门控信号oct_rx_gate，如图3所示。具体地，可以在延迟第一时间T1后，产生超声波波束的发射门控信号ivus_tx_gate，在延迟第二时间T2后，产生超声回波数据的接收门控信号ivus_rx_gate，并在延迟第三时间T3后，产生OCT数据的接收门控信号ivus_rx_gate。对于第一时间T1、第二时间T2以及第三时间T3，本领域技术人员可以根据实际需要予以设定，此处不作具体限定。在双模采集设备根据触发信号生成超声发射信号、回波接收信号以及光学数据接收信号的同时，产生针对于超声扫描采集模式的扫描线信息，以及针对于光学扫描采集模式的扫描线信息。S13，按照超声发射信号在超声扫描采集模式下发射超声波波束，并按照回波接收信号接收超声扫描采集模式对应的超声回波数据。双模采集设备中的IVUS发射模块按照超声发射信号触发超声探头向血管内发射超声波波束，超声波波束在碰到血管壁或器官后则会反射相应的超声回波数据。此时，双模采集设备中的IVUS接收模块则可以按照回波接收信号接收超声探头所反馈的超声回波数据，由此即可实现超声扫描采集模式下的超声波发射及超声回波接收。S14，按照光学数据接收信号接收光学扫描采集模式对应的光学扫描数据。双模采集设备中的OCT接收模块按照光学数据接收信号对光学扫描采集模式下的光学扫描数据进行接收。S15，基于扫描线信息、超声回波数据以及光学扫描数据，生成针对于光学扫描采集模式的光学帧数据以及超声扫描采集模式的超声帧数据。光学帧数据为生成光学扫描图像的帧数据，超声帧数据为生成超声扫描图像的帧数据。具体地，根据扫描线信息可以确定出每一线的扫描模式、扫描数据量以及当前线为一帧图像中的第几线等。假设一帧图像具有512条扫描线，则当前的扫描线信息=c_mode+2304+100，即当前的扫描线数据line_data= c_mode+ 2304×16bit +100。当扫描模式为光学扫描采集模式时，将光学扫描数据送入相应的打包模块data_pkt进行数据打包处理，结合扫描数据量、起始线扫描线信息、结束线扫描信息产生针对于光学扫描数据的帧信息，得到光学帧数据。在产生针对于光学扫描数据帧信息的同时产生光学扫描的相关控制信号，并将光学扫描数据的帧信息转换成DDR相关总线格式，缓存到DDR中。同理，当扫描模式为超声扫描采集模式时，将超声回波信号缓存至相应的打包模块data_pkt进行数据打包处理，结合扫描数据量、起始线扫描线信息、结束线扫描信息产生针对于超声扫描数据的帧信息，得到超声帧数据。在产生针对于超声扫描数据帧信息的同时产生超声扫描的相关控制信号，并将超声扫描数据的帧信息转换成DDR相关总线格式，缓存到DDR中。S16，上传光学帧数据和/或超声帧数据。双模采集设备与上位机之间通过PCIE总线进行通信连接，在双模采集设备完成光学帧数据和超声帧数据的缓存后，其可以根据当前所设定的上传模式将光学帧数据和/或超声帧数据上传至上位机。具体地，上传模式的设定支持：只上传IVUS扫描得到的超声帧数据、只上传OCT扫描得到光学帧数据、同时上传光学帧数据和超声帧数据。需要说明的是，双模采集设备还可以单独采集某一模式的扫描数据，例如单独采集OCT扫描数据，或单独采集IVUS数据。当然，双模采集设备的采集模式不仅限与IVUS扫描采集与OCT扫描采集，还可以为其他的扫描采集模式，本领域技术人员可以根据实际选择设定所需的扫描采集模式。本实施例提供的双模采集数据的上传方法，通过OCT模块产生触发信号并触发扫描模块生成相应的超声发射信号、回波接收信号、光学数据接收信号以及扫描线信息，以得到相应的超声帧数据和光学帧数据，继而对光学帧数据和/或所述超声帧数据进行上传。该方法能够在双模扫描过程中产生相应的线扫描信息，便于根据线扫描信息进行数据缓存以产生相应的帧数据，由此便于实现双模数据的同步采集，保证双模数据的上传实时性。在本实施例中提供了一种双模采集数据的上传方法，可用于电子设备，如IVUS和OCT的双模采集设备等，图4是根据本发明实施例的双模采集数据的上传方法的流程图，如图4所示，该流程包括如下步骤：S21，获取触发信号。详细说明参见上述实施例对应的相关描述，此处不再赘述。S22，基于触发信号生成超声扫描采集模式对应的超声发射信号和回波接收信号、光学扫描采集模式对应的光学数据接收信号、扫描线信息。具体地，上述步骤S22可以包括：S221，基于触发信号的触发频率，对触发信号进行分频处理。触发频率为单位时间内发出触发脉冲的个数，例如，触发频率为50KHz，则表示1秒内有50K个触发脉冲。双模采集设备则可以根据触发频率以及分频需求，从触发信号中确定出相应的有效脉冲，以通过有效脉冲实现针对于触发信号的分频处理。具体地，上述步骤S221可以包括：当检测到触发信号的触发脉冲时，判断分频计数值是否达到预设值。当分频计数值达到所述预设值时，分频计数值清零并生成分频触发脉冲。其中，分频触发脉冲是触发信号进行分频处理的结果。分频计数值为预先定义的分频计数变量div_cnt。预设值根据预先设定的分频数trigger_div予以确定，具体地，该预设值可以为trigger_div-1。当触发信号的触发脉冲trigger到来时，判断分频计数变量div_cnt是否达到trigger_div-1。若分频计数变量div_cnt达到trigger_div-1，则分频计数变量div_cnt清零，否则分频计数变量div_cnt加1，由此分频计数变量div_cnt在0、1、trigger_div-1之间进行循环计数。当分频计数变量div_cnt为0且触发脉冲再次到来时，则可以生成一个分频触发脉冲re_trigger，由此，trigger_div个触发脉冲则可以产生一个分频触发脉冲re_trigger，实现针对于触发信号的trigger_div分频处理。S222，基于分频处理的结果，产生周期性的超声发射信号、回波接收信号以及光学数据接收信号。根据分频处理结果可以从触发信号所包含的多个触发脉冲中确定出有效脉冲，从而能够以有效脉冲的边沿作为参考，生成周期性的超声发射信号、回波接收信号以及光学数据接收信号。即，每次检测到有效脉冲的上升沿或下降沿时，均延迟相应时间生成超声发射信号、回波接收信号以及光学数据接收信号。S223，基于触发信号，生成针对于光学扫描采集模式的扫描线信息，以及针对超声扫描采集模式的扫描线信息。双模采集设备根据超声发射信号、回波接收信号确定超声发射和回波接收的一个完整周期，该完整周期为超声扫描的扫描线周期。双模采集设备在接收到触发信号后，其可以根据该触发信号触发扫描模块启动超声扫描，并生成针对于超声扫描采集模式的扫描线信息。同理，双模采集设备在接收到触发信号后，其可以根据触发信号的触发频率确定OCT所对应的扫描线周期。双模采集设备可以根据触发信号触发扫描模块启动光学数据扫描，并生成针对于光学扫描采集模式的扫描线信息。S23，按照超声发射信号在超声扫描采集模式下发射超声波波束，并按照回波接收信号接收超声扫描采集模式对应的超声回波数据。详细说明参见上述实施例对应的相关描述，此处不再赘述。S24，按照光学数据接收信号接收光学扫描采集模式对应的扫描数据。详细说明参见上述实施例对应的相关描述，此处不再赘述。S25，基于扫描线信息分别生成针对于光学扫描采集模式的光学帧数据以及超声扫描采集模式的超声帧数据。详细说明参见上述实施例对应的相关描述，此处不再赘述。S26，上传光学帧数据和/或超声帧数据。具体地，上述步骤S26可以包括：S261，响应于对上传模式的选择操作，基于选择操作确定目标上传模式。目标上传模式用于表征上传何种扫描采集模式得到的扫描数据。该目标上传模式包括：上传IVUS扫描得到的超声帧数据，上传OCT扫描得到的光学帧数据，同时上传超声帧数据和光学帧数据。双模采集设备具有相应的交互界面，扫描操作者可以通过该交互界面选择所需的上传模式。相应地，双模采集设备能够响应扫描操作者对于上传模式的选择操作，确定对应于该选择操作的目标上传模式。S262，基于目标上传模式确定待上传的目标帧数据。其中，该目标帧数据为光学帧数据和/或超声帧数据。双模采集设备根据目标上传模式从缓存中调取相应的目标帧数据。具体地，若目标上传模式为上传IVUS扫描得到的超声帧数据，则双模采集设备可以从缓存中调取超声帧数据，该超声帧数据即为待上传的目标帧数据；若目标上传模式为上传OCT扫描得到的光学帧数据，则双模采集设备可以从缓存中调取光学帧数据，该光学帧数据即为待上传的目标帧数据；若目标上传模式为同时上传超声帧数据和光学帧数据，则双模采集设备可以从缓存中调取同一扫描周期的超声帧数据和光学帧数据，该同一扫描周期的超声帧数据和光学帧数据即为待上传的目标帧数据。S263，将目标帧数据以直接存储访问方式进行上传。当双模采集设备检测到目标帧数据的缓存满足一帧后启动上传，将该目标帧数据通过PCIE以直接存储访问方式将该目标帧数据上传至上位机的内存中。本实施例提供的双模采集数据的上传方法，根据触发信号的触发频率进行分频处理，以生成周期性的超声发射信号、回波接收信号以及光学数据接收信号，便于根据触发频率灵活配置双模采集数据的扫描时序。同时，在接收到触发信号后生成针对于双模采集的扫描线信息，便于双模采集数据能够根据该扫描线信息产生相应的帧信息，保证双模采集数据能够根据帧信息进行数据上传。而且，该方法支持上传模式的配置，由此能够根据实际需求上传相应的帧数据，保证了帧数据的上传灵活性。作为一个可选的实施方式，如图4所示，为了保证数据上传过程中的帧连续性，在上传目标帧数据的同时，上述方法还可以包括：生成针对于目标帧数据的中断信号。当双模采集设备检测到目标帧数据的缓存满足一帧后，触发启动DMA上传操作。此时，双模采集设备中的FPGA单元根据目标上传模式以及目标帧数据的帧参数dma_up_dwdata_num DW进行数据上传，并在传输完一帧目标帧数据时，生成中断信号。通过该中断信号告知上位机读取上传的目标帧数据。当目标帧数据被读取时，清除中断信号。上位机在接收到中断信号时，读取中断信号的中断类型寄存器，以获取双模采集设备所上传的目标帧数据，同时下发中断信号的清除指令。相应地，双模采集设备在检测到目标帧数据已被读取且接收到清除指令时，其可以对中断信号进行清除，并继续对新一帧的数据进行上传。本实施例提供的双模采集数据的上传方法，在目标帧数据完成数据上传后生成中断信号，只有在该目标帧数据被读取时进行中断信号，由此能够实现数据采集完一帧立即上传一帧，保证了数据上传的帧连续性以及上传实时性，避免了数据上传错乱。作为一个可选的实施方式，为了保证数据上传的稳定性和准确性，在得到目标帧数据时，可以检测其数据格式是否满足需求。具体地，在进行上传之前，上述方法还可以包括：获取目标帧数据的格式。当目标帧数据的格式不满足总线传输格式时，将目标帧数据的格式转换为总线传输格式。目标帧数据的格式用于表征基于扫描线信息和扫描数据所生成的帧数据的位宽格式；总线传输格式用于表征通过总线传输数据的位宽格式。将目标帧数据的格式与总线传输格式进行对比，以确定两者是否一致。若两者一致，表示目标帧数据的格式满足总线传输格式，可以直接通过总线进行传输。若两者不一致，即目标帧数据的格式不满足总线传输格式，此时需要对目标帧数据进行位宽转换，以使其格式与总线传输格式一致。例如，目标帧数据为位宽16bit的数据，总线传输数据的位宽为512bit，此时则需要将目标帧数据放入FIFO进行位宽转换，使其位宽达到512bit，并对转换后的目标帧数据进行输出。本实施例提供的双模采集数据的上传方法，在进行上传之前对目标帧数据的格式进行转换，以使其能够满足总线传输格式，便于通过总线进行数据缓存和数据上传，避免格式差异而导致的数据上传失败，最大程度上保证了数据上传准确度和上传效率。作为一个可选的实施方式，双模采集过程支持回拉扫描，在启动回拉扫描时，光学扫描模式和超声扫描模式将分别缓存其相应的帧数据，以保证帧数据的缓存效率。具体地，在进行上传之前，上述方法还可以包括：检测是否开启回拉扫描。当开启回拉扫描时，分别缓存光学帧数据和超声帧数据。回拉扫描表示通过一根导管进行一次回拉即可获取两幅同时同位的IVUS回拉图像和OCT回拉图像。双模采集过程支持回拉扫描，由于回拉扫描的速度较快，其需要缓存大量数据，此时则需要电子设备的内存具有一定的容量。具体地，如图1所示，双模采集设备可以针对光学扫描采集模式和超声扫描采集模式分别设置相应的缓存DDR4，即设置两路DDR4以分别缓存光学帧数据和超声帧数据。双模采集设备还可以根据上位机下发的回拉帧数要求，连续上传上位机所要求的帧数据。本实施例提供的双模采集数据的上传方法，由于光学扫描采集模式的回拉扫描需要缓存大量数据，因此需要检测是否开启回拉扫描，在开启回拉扫描时，分别缓存光学帧数据和超声帧数据，以保证帧数据能够实现快速缓存。在本实施例中还提供了一种双模采集数据的上传装置，该装置用于实现上述实施例及优选实施方式，已经进行过说明的不再赘述。如以下所使用的，术语“模块”可以实现预定功能的软件和/或硬件的组合。尽管以下实施例所描述的装置较佳地以软件来实现，但是硬件，或者软件和硬件的组合的实现也是可能并被构想的。本实施例提供一种双模采集数据的上传装置，如图5所示，包括：获取模块31，用于获取触发信号。扫描模块32，用于基于触发信号生成超声扫描采集模式对应的超声发射信号和回波接收信号、光学扫描采集模式对应的光学数据接收信号、扫描线信息。超声发射和接收模块33，用于按照超声发射信号在超声扫描采集模式下发射超声波波束，按照回波接收信号接收超声扫描采集模式对应的超声回波数据。光学接收模块34，用于按照光学数据接收信号接收光学扫描采集模式对应的扫描数据。生成模块35，用于基于扫描线信息、超声回波数据以及光学扫描数据，生成针对于光学扫描采集模式的光学帧数据以及超声扫描采集模式的超声帧数据。上传模块36，用于上传光学帧数据和/或超声帧数据。可选地，上述扫描模块32可以包括：分频子模块，用于基于触发信号的触发频率，对触发信号进行分频处理。扫描时序生成子模块，用于基于分频处理的结果，产生周期性的超声发射信号、回波接收信号以及光学数据接收信号。扫描线生成子模块，用于基于超声发射信号、回波接收信号以及光学数据接收信号，生成针对于光学扫描采集模式的扫描线信息，以及针对超声扫描采集模式的扫描线信息。可选地，上述分频子模块具体用于：检测到触发信号的触发脉冲时，判断分频计数值是否达到预设值；当分频计数值达到所述预设值时，分频计数值清零并生成分频触发脉冲。可选地，上述上传模块36可以包括：选择子模块，用于响应于对上传模式的选择操作，基于选择操作确定目标上传模式。上传数据确定子模块，用于基于目标上传模式确定待上传的目标帧数据，其中，该目标帧数据为光学帧数据和/或超声帧数据。上传子模块，用于将目标帧数据以直接存储访问方式进行上传。可选地，上述双模采集数据的上传装置还可以包括：中断模块，用于生成针对于目标帧数据的中断信号。中断清除模块，用于当目标帧数据被读取时，清除中断信号。可选地，上述双模采集数据的上传装置还可以包括：格式获取模块，用于获取目标帧数据的格式。格式转换模块，用于当目标帧数据的格式不满足总线传输格式时，将目标帧数据的格式转换为总线传输格式。可选地，上述双模采集数据的上传装置还可以包括：检测模块，用于检测是否开启回拉扫描。缓存模块，用于当开启回拉扫描时，分别缓存光学帧数据和超声帧数据。本实施例中的双模采集数据的上传装置是以功能单元的形式来呈现，这里的单元是指ASIC电路，执行一个或多个软件或固定程序的处理器和存储器，和/或其他可以提供上述功能的器件。上述各个模块以及各个子模块的更进一步的功能描述与上述对应实施例相同，在此不再赘述。本发明实施例还提供一种电子设备，具有上述图5所示的双模采集数据的上传装置。请参阅图6，图6是本发明可选实施例提供的一种电子设备的结构示意图，如图6所示，该电子设备可以包括：至少一个处理器401，例如中央处理器，至少一个通信接口403，存储器404，至少一个通信总线402。其中，通信总线402用于实现这些组件之间的连接通信。其中，通信接口403可以包括显示屏、键盘，可选通信接口403还可以包括标准的有线接口、无线接口。存储器404可以是高速易挥发性随机存取存储器，也可以是非不稳定的存储器，例如至少一个磁盘存储器。存储器404可选的还可以是至少一个位于远离前述处理器401的存储装置。其中处理器401可以结合图5所描述的装置，存储器404中存储应用程序，且处理器401调用存储器404中存储的程序代码，以用于执行上述任一方法步骤。其中，通信总线402可以是外设部件互连标准总线或扩展工业标准结构总线等。通信总线402可以分为地址总线、数据总线、控制总线等。为便于表示，图6中仅用一条粗线表示，但并不表示仅有一根总线或一种类型的总线。其中，存储器404可以包括易失性存储器，例如随机存取存储器；存储器也可以包括非易失性存储器，例如快闪存储器，硬盘或固态硬盘；存储器404还可以包括上述种类的存储器的组合。其中，处理器401可以是中央处理器，网络处理器或者CPU和NP的组合。其中，处理器401还可以进一步包括硬件芯片。上述硬件芯片可以是专用集成电路，可编程逻辑器件或其组合。上述PLD可以是复杂可编程逻辑器件，现场可编程逻辑门阵列，通用阵列逻辑或其任意组合。可选地，存储器404还用于存储程序指令。处理器401可以调用程序指令，实现如本申请上述实施例中所示的双模采集数据的上传方法。本发明实施例还提供了一种非暂态计算机存储介质，所述计算机存储介质存储有计算机可执行指令，该计算机可执行指令可执行上述任意方法实施例中的双模采集数据的上传方法。其中，所述存储介质可为磁碟、光盘、只读存储记忆体、随机存储记忆体、快闪存储器、硬盘或固态硬盘（Solid-State Drive，SSD)等；所述存储介质还可以包括上述种类的存储器的组合。虽然结合附图描述了本发明的实施例，但是本领域技术人员可以在不脱离本发明的精神和范围的情况下做出各种修改和变型，这样的修改和变型均落入由所附权利要求所限定的范围之内。
