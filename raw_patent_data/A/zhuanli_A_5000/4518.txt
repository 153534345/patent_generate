标题title
心电图分析系统、心电图分析模型构造、训练方法和介质
摘要abst
本申请提供了一种心电图分析系统、心电图分析模型构造、训练方法和介质，涉及人工智能技术领域。本申请中心电成分分离模型能够从心电图数据中分离出各个心电成分来呈现给医生；基于心电图学配对规则的配对模块能够将分离出的各个心电成分进行配对，得到配对信息；诊断分类模型能够根据心电图数据、心电成分分离数据以及配对信息进行诊断分类，输出诊断结论。本申请的技术方案，既能够输出心电图的可靠诊断结论，还能输出心电图的各个心电成分，有效提升心电图分析系统的可用性，提高医生的诊断效率；通过配对模块为模型分析心电图的内在逻辑提供了可解释性，实现了模型内在分析逻辑的可理解性，从而能够提高医生对模型的接受度。
权利要求书clms
1.一种心电图分析系统，其特征在于，包括：采用语义分割结构构造的心电成分分离模型、基于多分类任务构造的诊断分类模型以及配对模块；所述心电成分分离模型用于：对心电图数据中的不同心电成分进行分离，得到心电成分分离数据；所述配对模块用于：根据预设的心电图学配对规则，将所述心电成分分离数据中具有传导关系的心电成分进行配对，得到配对信息，所述配对信息至少包括：所述心电成分分离数据中存在传导关系的心电成分数量；所述诊断分类模型用于：根据所述心电图数据、所述心电成分分离数据以及所述配对信息，输出诊断结论。2.一种心电图分析模型构造方法，其特征在于，所述心电图分析模型包括心电成分分离模型、诊断分类模型以及配对模块，所述方法包括：以心电图数据为输入、采用类语义分割结构的深度学习网络为主干网络、采用多个特征通道表示不同的心电成分，构造所述心电成分分离模型，所述心电成分分离模型的损失函数用于计算对不同的心电成分进行分离的误差；以所述心电成分分离模型输出的心电成分分离数据为输入、根据预设的心电图学配对规则构造所述配对模块，所述配对模块输出的配对信息用于为所述诊断分类模型提供诊断依据，所述配对信息至少包括：所述心电成分分离数据中存在传导关系的心电成分数量；以所述心电成分分离模型的输出、心电图数据以及所述配对模块的输出作为输入、以多分类任务的交叉熵为损失函数，构造所述诊断分类模型，所述诊断分类模型的损失函数用于计算诊断分类模型所输出诊断结论的误差。3.根据权利要求2所述的心电图分析模型构造方法，其特征在于，所述心电成分分离模型采用U-net语义分割结构，所述多个特征通道至少包括：心电噪声通道、房颤房扑通道、P波通道以及QRS波群通道；所述损失函数中，所述心电噪声通道的权重系数小于其他特征通道；所述心电成分分离模型在分离不同通道的心电成分时满足：所述房颤房扑通道和P波通道的内积恒等于0。4.根据权利要求2所述的心电图分析模型构造方法，其特征在于，所述心电成分分离模型的损失函数由所述多个特征通道各自的损失函数按照预设的权重系数加权组成；所述诊断分类模型所输出诊断结论的维度根据所支持诊断类别的数量预先设置。5.一种用于权利要求2-4任一项所构造的心电图分析模型的训练方法，其特征在于，所述方法包括：S1、将预先根据多个心电成分标注好成分标注信息的第一心电图数据集，输入所述心电成分分离模型，以所述成分标注信息为监督信号，预训练所述心电成分分离模型；S2、将预先标注好诊断结论的第二心电图数据集，输入训练得到的心电成分分离模型，得到第一成分分离数据；S3、将所述第一成分分离数据输入所述配对模块，得到第一配对信息，所述第一配对信息至少包括：第一成分分离数据中存在传导关系的心电成分数量；S4、将所述第二心电图数据集、所述第一成分分离数据和所述第一配对信息输入所述诊断分类模型，以所述预先标注好的诊断结论为监督信号，预训练所述诊断分类模型；S5、基于所述第一心电图数据集、所述第二心电图数据集以及所述配对模块，迭代训练所述预训练得到的心电成分分离模型和预训练得到的诊断分类模型。6.根据权利要求5所述的心电图分析模型的训练方法，其特征在于，所述多个心电成分至少包括：P波成分和QRS波群成分，所述S3包括：S31、以预设的激活阈值和激活概率面积为判定条件，对所述第一成分分离数据中的P波成分数据和QRS波群进行峰值检测，得到所述第一成分分离数据中的P波以及QRS波的位置和数目；S32、根据所述第一成分分离数据中的P波以及QRS波的位置和数目，按照预设的心电图学配对规则，对存在传导关系的P波以及QRS波进行配对，得到独立的P波数目、独立的QRS波数目以及P-R对的数目。7.根据权利要求5所述的心电图分析模型的训练方法，其特征在于，所述S5包括：S51、将所述第一心电图数据集输入所述心电成分分离模型，得到第二心电成分分离数据，将所述第二心电成分分离数据输入所述配对模块，得到第二配对信息；根据所述第二配对信息、所述第一心电图数据集的成分标注信息和所述第二心电成分分离数据，计算心电成分分离模型的通道分离误差和配对误差；S52、将所述第二心电图数据集输入所述心电成分分离模型，得到第三心电成分分离数据，将所述第三心电成分分离数据输入所述配对模块，得到第三配对信息；将所述第二心电图数据集、所述第三心电成分分离数据和所述第三配对信息输入所述诊断分类模型，得到第一诊断结论；计算所述第二心电图数据集的诊断结论和所述第一诊断结论之间的诊断结论误差；S53、根据所述通道分离误差、所述配对误差和所述诊断结论误差，调整所述心电成分分离模型的参数；根据所述诊断结论误差，调整所述诊断分类模型的参数；重复S51-S53直至所述通道分离误差和诊断结论误差达到预设的训练目标。8.根据权利要求5所述的心电图分析模型的训练方法，其特征在于，所述S1包括：以最小化所述心电成分分离模型的损失函数为目标，采用随机梯度下降法调整所述心电成分分离模型的模型参数；所述步骤S1之前，所述方法还包括：步骤A、从给定的动态心电数据库中，选择已标注心电成分的心电图数据片段，对所述心电图数据片段中缺少的房颤、房扑、QRS波群、伪差和/或P波进行成分标注，得到所述第一心电图数据集；步骤B、从给定的静息心电数据库中，截取携带有诊断结论标签的心电图数据，采用文本匹配方法，根据给定的医学术语编码表，将所述诊断结论标签表示为编码值，得到所述第二心电图数据集，所述编码值的范围与所述诊断分类模型所输出诊断结论的维度匹配。9.根据权利要求8所述的心电图分析模型的训练方法，其特征在于，所述步骤A包括：将所述心电图数据片段的张量维度变换为和所述心电成分分离模型匹配的预设维度，按照预设的窗口尺寸和重叠率，对所述动态心电图数据进行滑窗截取操作，得到批次张量；在所述滑窗截取操作过程中：针对在时间上连续的心电噪声成分和房颤房扑成分，根据心电成分的起止位置逐采样点进行标注，将各个采样点的二分类结果序列作为成分标注信息；针对在时间上分离的P波成分和QRS波群成分，对心电成分的特征点进行标注，将以所述特征点为中心的高斯核作为成分标注信息。10.一种计算机可读存储介质，其特征在于，所述存储介质中存储有至少一段程序，所述至少一段程序由处理器执行以实现如权利要求2至4任一项所述的心电图分析模型构造方法或权利要求5至9任一所述的心电图分析模型的训练方法。
说明书desc
技术领域本申请涉及人工智能技术领域，特别涉及一种心电图分析系统、心电图分析模型构造、训练方法和介质。背景技术心电图是临床最常用的无创检查手段之一，对于心血管疾病的诊断具有重要的价值。随着人工智能技术的发展，不少深度学习模型开始逐步应用于心电图的QRS识别、房颤检测、心律失常分类等心电图自动分析领域。然而，目前利用深度学习的方法往往只针对某个特定的问题，或者，只能够对心电图数据分析的某一个步骤进行辅助，可用性不高；并且，目前的方法大多是黑盒系统，不具有可解释性，医生接受度不高。因此，亟需一种技术方案可以提升心电图分析系统的可用性，实现心电图分析系统的可解释性。发明内容本申请提供了一种心电图分析系统、心电图分析模型构造、训练方法和介质，所提供的心电图分析模型既能够输出心电图的可靠诊断结论，还能输出心电图的各个心电成分，提升心电图分析模型的可用性，实现心电图分析系统的可解释性。为了实现上述目的，第一方面，本申请提供了一种心电图分析系统，包括：采用语义分割结构构造的心电成分分离模型、基于多分类任务构造的诊断分类模型以及配对模块；所述心电成分分离模型用于：对心电图数据中的不同心电成分进行分离，得到心电成分分离数据；所述配对模块用于：根据预设的心电图学配对规则，将所述心电成分分离数据中具有传导关系的心电成分进行配对，得到配对信息，所述配对信息至少包括：所述心电成分分离数据中存在传导关系的心电成分数量；所述诊断分类模型用于：根据所述心电图数据、所述心电成分分离数据以及所述配对信息，输出诊断结论。在一种可能实施方式中，所述心电成分分离模型采用类语义分割结构的深度学习网络作为主干网络，采用多个特征通道表示不同的心电成分，所述心电成分分离模型的损失函数由所述多个特征通道各自的损失函数按照预设的权重系数加权组成，所述心电成分分离模型的损失函数用于计算所述通道分离误差；所述诊断分类模型以所述心电成分分离模型的输出以及所述配对模块的输出作为输入，以多分类任务的交叉熵为损失函数，所述诊断分类模型所输出诊断结论的维度根据所支持诊断类别的数量预先设置，所述诊断分类模型的损失函数用于计算所述诊断结论误差。在一种可能实施方式中，所述心电成分分离模型采用U-net语义分割结构，所述多个特征通道至少包括：心电噪声通道、房颤房扑通道、P波通道以及QRS波群通道；所述损失函数中，所述心电噪声通道的权重系数小于其他特征通道；所述心电成分分离模型在分离不同通道的心电成分时满足：所述房颤房扑通道和P波通道的内积恒等于0。第二方面，提供一种心电图分析模型构造方法，所述心电图分析模型包括心电成分分离模型、诊断分类模型以及配对模块，该方法包括：以心电图数据为输入、采用类语义分割结构的深度学习网络为主干网络、采用多个特征通道表示不同的心电成分，构造所述心电成分分离模型，所述心电成分分离模型的损失函数用于计算对不同的心电成分进行分离的误差；以所述心电成分分离模型输出的心电成分分离数据为输入、根据预设的心电图学配对规则构造所述配对模块，所述配对模块输出的配对信息用于为所述诊断分类模型提供诊断依据，所述配对信息至少包括：所述心电成分分离数据中存在传导关系的心电成分数量；以所述心电成分分离模型的输出、心电图数据以及所述配对模块的输出作为输入、以多分类任务的交叉熵为损失函数，构造所述诊断分类模型，所述诊断分类模型的损失函数用于计算诊断分类模型所输出诊断结论的误差。在一种可能实施方式中，所述心电成分分离模型采用U-net语义分割结构，所述多个特征通道至少包括：心电噪声通道、房颤房扑通道、P波通道以及QRS波群通道；所述损失函数中，所述心电噪声通道的权重系数小于其他特征通道；所述心电成分分离模型在分离不同通道的心电成分时满足：所述房颤房扑通道和P波通道的内积恒等于0。在一种可能实施方式中，所述心电成分分离模型的损失函数由所述多个特征通道各自的损失函数按照预设的权重系数加权组成；所述诊断分类模型所输出诊断结论的维度根据所支持诊断类别的数量预先设置。第三方面，提供一种针对第二方面所构造的心电图分析模型的训练方法，该方法包括：S1、将预先根据多个心电成分标注好成分标注信息的第一心电图数据集，输入所述心电成分分离模型，以所述成分标注信息为监督信号，预训练所述心电成分分离模型；S2、将预先标注好诊断结论的第二心电图数据集，输入训练得到的心电成分分离模型，得到第一成分分离数据；S3、将所述第一成分分离数据输入所述配对模块，得到第一配对信息，所述第一配对信息至少包括：第一成分分离数据中存在传导关系的心电成分数量；S4、将所述第二心电图数据集、所述第一成分分离数据和所述第一配对信息输入所述诊断分类模型，以所述预先标注好的诊断结论为监督信号，预训练所述诊断分类模型；S5、基于所述第一心电图数据集、所述第二心电图数据集以及所述配对模块，迭代训练所述预训练得到的心电成分分离模型和预训练得到的诊断分类模型。在一种可能实施方式中，所述多个心电成分至少包括：P波成分和QRS波群成分，所述S3包括：S31、以预设的激活阈值和激活概率面积为判定条件，对所述第一成分分离数据中的P波成分数据和QRS波群进行峰值检测，得到所述第一成分分离数据中的P波以及QRS波的位置和数目；S32、根据所述第一成分分离数据中的P波以及QRS波的位置和数目，按照预设的心电图学配对规则，对存在传导关系的P波以及QRS波进行配对，得到独立的P波数目、独立的QRS波数目以及P-R对的数目。在一种可能实施方式中，所述S5包括：S51、将所述第一心电图数据集输入所述心电成分分离模型，得到第二心电成分分离数据，将所述第二心电成分分离数据输入所述配对模块，得到第二配对信息；根据所述第二配对信息、所述第一心电图数据集的成分标注信息和所述第二心电成分分离数据，计算心电成分分离模型的通道分离误差和配对误差；S52、将所述第二心电图数据集输入所述心电成分分离模型，得到第三心电成分分离数据，将所述第三心电成分分离数据输入所述配对模块，得到第三配对信息；将所述第二心电图数据集、所述第三心电成分分离数据和所述第三配对信息输入所述诊断分类模型，得到第一诊断结论；计算所述第二心电图数据集的诊断结论和所述第一诊断结论之间的诊断结论误差；S53、根据所述通道分离误差、所述配对误差和所述诊断结论误差，调整所述心电成分分离模型的参数；根据所述诊断结论误差，调整所述诊断分类模型的参数；重复S51-S53直至所述通道分离误差和诊断结论误差达到预设的训练目标。在一种可能实施方式中，所述心电成分分离模型的损失函数由所述多个特征通道各自的损失函数按照预设的权重系数加权组成，所述心电成分分离模型的损失函数用于计算所述通道分离误差；所述诊断分类模型所输出诊断结论的维度根据所支持诊断类别的数量预先设置，所述诊断分类模型的损失函数用于计算所述诊断结论误差；所述配对模块输出的配对信息用于计算所述配对误差。在一种可能实施方式中，所述心电成分分离模型采用U-net语义分割结构，所述多个特征通道至少包括：心电噪声通道、房颤房扑通道、P波通道以及QRS波群通道；所述损失函数中，所述心电噪声通道的权重系数小于其他特征通道；所述S1包括：以最小化所述心电成分分离模型的损失函数为目标，采用随机梯度下降法调整所述心电成分分离模型的模型参数；所述心电成分分离模型在分离不同通道的心电成分时满足：所述房颤房扑通道和P波通道的内积恒等于0。在一种可能实施方式中，所述步骤S1之前，所述方法还包括：步骤A、从给定的动态心电数据库中，选择已标注心电成分的心电图数据片段，对所述心电图数据片段中缺少的房颤、房扑、QRS波群、伪差和/或P波进行成分标注，得到所述第一心电图数据集；步骤B、从给定的静息心电数据库中，截取携带有诊断结论标签的心电图数据，采用文本匹配方法，根据给定的医学术语编码表，将所述诊断结论标签表示为编码值，得到所述第二心电图数据集，所述编码值的范围与所述诊断分类模型所输出诊断结论的维度匹配。在一种可能实施方式中，所述步骤A包括：将所述心电图数据片段的张量维度变换为和所述心电成分分离模型匹配的预设维度，按照预设的窗口尺寸和重叠率，对所述动态心电图数据进行滑窗截取操作，得到批次张量；在所述滑窗截取操作过程中：针对在时间上连续的心电噪声成分和房颤房扑成分，根据心电成分的起止位置逐采样点进行标注，将各个采样点的二分类结果序列作为成分标注信息；针对在时间上分离的P波成分和QRS波群成分，对心电成分的特征点进行标注，将以所述特征点为中心的高斯核作为成分标注信息。第四方面，提供一种计算设备，该计算设备包括存储器和处理器，所述存储器存储有至少一段程序，所述至少一段程序由处理器执行以实现如第二方面提供的心电图分析模型构造方法或第三方面提供的心电图分析模型的训练方法。第五方面，提供一种计算机可读存储介质，该存储介质中存储有至少一段程序，至少一段程序由处理器执行以实现如第二方面提供的心电图分析模型构造方法或第三方面提供的心电图分析模型的训练方法。本申请提供的技术方案至少包括如下技术效果：本申请的技术方案，既能够输出心电图的可靠诊断结论，还能输出心电图的各个心电成分，有效提升心电图分析系统的可用性，提高医生的诊断效率；通过配对模块为模型分析心电图的内在逻辑提供了可解释性，实现了模型内在分析逻辑的可理解性，从而能够提高医生对模型的接受度。附图说明图1是本申请实施例提供的一种心电图分析系统的架构图；图2是本申请实施例提供的一种心电图分析模型的构造及训练方法的流程示意图；图3是本申请实施例提供的另一种心电图分析模型的构造及训练方法的流程示意图；图4是本申请实施例提供的一种计算设备的硬件结构示意图。具体实施方式为进一步说明各实施例，本申请提供有附图。这些附图为本申请揭露内容的一部分，其主要用以说明实施例，并可配合说明书的相关描述来解释实施例的运作原理。配合参考这些内容，本领域普通技术人员应能理解其他可能的实施方式以及本申请的优点。图中的组件并未按比例绘制，而类似的组件符号通常用来表示类似的组件。本申请中术语“至少一个”的含义是指一个或多个，本申请中术语“多个”的含义是指两个或两个以上，例如，多个通道是指两个或两个以上的通道。现结合附图和具体实施方式对本申请进一步说明。本申请提供了一种心电图分析系统，既能够输出心电图的可靠诊断结论，还能输出心电图的各个心电成分，提升心电图分析模型的可用性，并实现心电图分析系统的可解释性。本申请实施例中，心电图分析系统基于人工智能模型构造，因此，心电图分析系统也可称为心电图分析模型。图1为本申请提供的一种心电图分析系统的架构图。参见图1，该心电图分析系统包括：采用语义分割结构构造的心电成分分离模型M1、基于多分类任务构造的诊断分类模型M2以及配对模块M3。其中，心电成分分离模型用于：对心电图数据中的不同心电成分进行分离，得到心电成分离数据。配对模块用于：根据预设的心电图学配对规则，将心电成分分离数据中具有传导关系的心电成分进行配对，得到配对信息，配对信息至少包括：心电成分分离数据中存在传导关系的心电成分数量。诊断分类模型用于：根据心电图数据、心电成分分离数据以及配对信息，输出诊断结论。本申请实施例中，心电成分分离模型采用类语义分割结构的深度学习网络作为主干网络，采用多个特征通道表示不同的心电成分，心电成分分离模型的损失函数由多个特征通道各自的损失函数按照预设的权重系数加权组成。在一种可能实施方式中，心电成分分离模型采用U-net语义分割结构，多个特征通道至少包括：心电噪声通道Channel_Noise、房颤房扑通道Channel_AF、P波通道Channel_P以及QRS波群通道Channel_QRS。在这种示例下，心电成分分离模型通过深度主干网络对输入的心电图数据进行特征提取，生成表征空间，再接四条预测支路，分别预测不同的心电成分的存在概率，最后根据存在概率划分各个心电成分。可选地，考虑到心电噪声通道不属于心电的固有成分，损失函数中将心电噪声通道的权重系数设置为小于其他特征通道。可选地，考虑到心电图学中P波和房颤波之间的互斥性，心电成分分离模型在分离不同通道的心电成分时满足：房颤房扑通道和P波通道的内积恒等于0。本申请实施例中，诊断分类模型以心电成分分离模型的输出以及配对模块的输出作为输入，以多分类任务的交叉熵为损失函数，诊断分类模型所输出诊断结论的维度根据所支持诊断列表的数量预先设置。诊断分类模型M2的输入为心电图数据、心电成分分离模型M1输出的多通道心电特征和配对模块M3输出的配对信息，输出为心电图诊断结论。具体地，诊断分类模型M2的架构可以为常见的编码器-解码器结构，例如，transformer或者u-net，输出为多元概率回归。下面对配对模块M3的构造原理进行详细介绍。在本申请实施例中，多个心电成分至少包括：心电噪声成分、房颤房扑成分、P波成分以及QRS波群成分。示例性地，心电图中大多数P波和QRS波之间具有传导关联性。P波与QRS波都是心电图上出现的波形。一般P波代表心房除极，QRS波代表心室除极。通常情况下，P波与QRS波有关。按照正常的传导除极，P波后面会有规律地跟随1个QRS波，也即是，正常情况下两者之间有一定关联。而出现心律失常时，例如，房室传导阻滞时，P波和QRS波之间则无明显相关性。本申请实施例中，在心电图分析系统中引入一个监督性的约束，也即是配对模块M3，来有效利用P波和QRS波之间的关联性。示例性地，配对模块用于对心电成分中的P波和QRS波群进行配对，从而为诊断分类模型的诊断，提供房室对信息。具体地，配对模块将明确具有传导关系的P波和QRS波配成房室对。例如，窦性心搏，房性早搏之前的P波和当前QRS波可以配成一对房室对；室性早搏或者室性逸搏之前的P波和QRS波不存在传导关系，是独立存在的，则无法配对。其中，配对模块M3的输入是心电成分分离模块输出的多个心电成分通道的数据，输出是多维的配对信息，配对信息用于为诊断分类模型提供诊断依据，示例性地，配对信息包括三个整数标量，分别包括配对的P-R数目、独立的P波数目以及独立的QRS波数目。在这种示例下，配对模块利用预设的心电图学配对规则进行配对的过程包括：以预设的激活阈值和激活概率面积为判定条件，对心电成分分离数据中的P波成分数据和QRS波群进行峰值检测，得到心电成分分离数据中的P波以及QRS波的位置和数目；根据心电成分分离数据中的P波以及QRS波的位置和数目，按照预设的心电图学配对规则，对存在传导关系的P波以及QRS波进行配对，得到独立的P波数目、独立的QRS波数目以及P-R对的数目。本申请实施例中，心电图学配对规则也即是判定属于一对的P波和QRS波的规则，本申请采用的心电图学配对规则为：如果P波位于QRS之前120ms到350ms之间，则匹配成一个P-R对，否则则为独立P波或QRS波。基于此，本申请实施例通过在心电图分析系统中设计一个能够对P波和QRS波之间关联性进行检测和配对的模块，即可解决相关技术中，心电图分析系统不具备可解释性的问题，不仅能够提供医生可接受的诊断逻辑，还可以提升模型诊断结论的准确度。进一步地，本申请实施例提供的模型，能够用于静息心电报告和动态心电报告场景；诊断分类模型输出静息心电诊断结论，可提高医生的诊断效率；心电成分分离模型输出各个心电成分通道，可呈现给医生以辅助其理解模型解读心电图的内在逻辑。模型检测出的房颤房扑通道以及各个P波和QRS波群可以直接应用于动态心电图，也可以进一步用户绘制心电梯形图，表达心电激动的传输过程。基于上述对心电图分析系统的介绍，本申请具体提供了心电图分析模型的构造方法及训练方法。下面通过介绍模型的构造方法来说明各个模型部分之间的协作原理，并通过介绍模型的训练方法来帮助理解如何使训练得到的模型可实现相关的技术效果。图2是本申请实施例提供的一种心电图分析模型的构造及训练方法的流程示意图，参考图2，本申请提供的技术方案包括下述步骤S1至步骤S6。S1、构造心电图分析模型，心电图分析模型包括：采用语义分割结构构造的心电成分分离模型、基于多分类任务构造的诊断分类模型以及配对模块，配对模块用于根据预设的心电图学配对规则将具有传导关系的心电成分进行配对。本申请实施例中，心电图分析模型的各个组成部分参考图1以及前述对心电图分析系统的介绍，在此不做赘述。本申请实施例中，S1包括：S11、采用类语义分割结构的深度学习网络作为心电成分分离模型的主干网络，采用多个特征通道表示不同的心电成分，心电成分分离模型的损失函数由多个特征通道各自的损失函数按照预设的权重系数加权组成。其中，心电成分分离模型的损失函数用于计算通道分离误差，通道分离误差也即是心电成分分离模型分离各个心电成分的总误差。在一种可能实施方式中，心电成分分离模型采用U-net语义分割结构，多个特征通道至少包括：心电噪声通道、房颤房扑通道、P波通道以及QRS波群通道。示例性地，M1的损失函数Loss_Channel由上述四个通道的各自损失函数按照预设的权重系数加权而成，表示为：Loss_Channel=W_n*Loss_n+W_f*Loss_f+ W_p*Loss_p+ W_r*Loss_r；其中，W_n是心电噪声通道损失函数Loss_n的权重系数；W_f是房颤房扑通道损失函数Loss_f的权重系数；W_p是P波通道损失函数Loss_p的权重系数；W_r是QRS波通道损失函数Loss_r的权重系数。在本申请实施例中，各个通道的损失函数Loss采用语义分割模型的常用Loss。示例性地，Loss_p和Loss_r的真值GroundTruth是以标注特征点为中心的高斯核。从而允许标注的中心点存在一定误差，提升模型的泛化性。在一种可能实施方式中，损失函数中，心电噪声通道的权重系数小于其他特征通道。例如，考虑到噪声通道不属于心电的固有成分，设置其权重W_n小于其他三个通道的权重。 此外，由于心电图学中P波和房颤波具有互斥性，使得Channel_P和Channel_AF的内积恒等于0，可作为训练心电成分分离模型的一组约束。因此，心电成分分离模型在分离不同通道的心电成分时满足：房颤房扑通道和P波通道的内积恒等于0。示例性地，构造心电成分分离模型M1时，在tensorflow或者pytorch的模型库中选取用于序列分割的1D-Unet模型，设置输入的心电图数据为：的第一张量，输出为大小为的第二张量，最后一层的激活函数为sigmoid。设置M1的损失函数为Loss_channel。Loss_p、Loss_r Loss_f、Loss_n可采用keras模块自定义函数loss_fn,内部实现依次为：Mean_squared_error；Mean_squared_error；Mean_squared_error；Mean_squared_error。其中，Mean_squared_error为均方误差。此外，为了约束P波和AF的互斥关系，添加一个额外项Loss_orth = y_pred* y_pred，用于使相同位置的P波概率和AF概率乘积约接近0越好。示例性地，M1的最终损失函数Loss_channel = 0.5 * Loss_n + 1.0 * Loss_p +1.5 * Loss_r + 1.0 * Loss_f + 0.25 *Loss_orth。式中的权重系数仅为示例性的，并不构成对本申请的限定。S12、以心电成分分离模型的输出以及配对模块的输出作为输入、以多分类任务的交叉熵为损失函数，构造诊断分类模型，诊断分类模型所输出诊断结论的维度根据所支持诊断的问题数量预先设置。其中，诊断分类模型的损失函数用于计算诊断结论误差。诊断结论误差也即是诊断分类模型输出的诊断结论和真实的诊断结论之间的误差。示例性地，构造诊断分类模型时，在tensorflow或者pytorch的模型库中选取用于1D图像分类的VIT模型。设置输入包括两路，第一路维度为，和VIT的编码层连接。具体的，将第一张量和第二张量进行拼接，组成的第三张量，接入VIT的编码层输入。第二路接配对模块M3的输出，其维度为。配对模块M3的输出和VIT的编码器输出进行拼接，再一起送入多层感知机分类头。诊断分类模型M2的输出为的第三张量，诊断分类模型最后一层的激活函数为sigmoid。诊断分类模型M2的损失函数记为Loss_diagnose，可由激活函数和交叉熵损失函数实现。Loss_diagnose是一种多分类交叉熵损失。需要说明的是，上述模型中的张量维度仅为示例性说明，根据实际需求可以修改，本申请不局限于此。S13、根据预设的心电图学配对规则构造配对模块，配对模块输出的配对信息用于计算配对误差。其中，配对模块的输入是心电成分分离模块输出的多个心电成分通道的数据，输出是多维的配对信息，配对信息用于为诊断分类模型提供诊断依据，示例性地，配对信息包括三个整数标量，分别包括配对的P-R数目、独立的P波数目以及独立的QRS波数目。示例性地，配对模块M3的输出张量可表示为：,,]，其中，表示配对的P-R数目，表示独立的P波数目，表示独立的QRS波数目。通过上述步骤S1即可构造得到图1所示的心电图分析系统，下面对训练该心电图分析模型的过程进行介绍。S2、将预先根据多个心电成分标注好成分标注信息的第一心电图数据集，输入心电成分分离模型，以成分标注信息为监督信号，预训练心电成分分离模型。本步骤S2也即是在第一心电图数据集上预训练心电成分分离模型M1。本步骤S2包括：以最小化心电成分分离模型的损失函数为目标，采用随机梯度下降法调整心电成分分离模型的模型参数。具体地，预训练心电成分分离模型M1的过程中，将第一心电图数据集中的心电图数据组合成维度为作为输入参数x，4心电成分通道预先标注好的成分标注信息组合成维度张量作为输入参数y,调用model.fit进行训练，迭代3个回合。其中，n为正整数。S3、将预先标注好诊断结论的第二心电图数据集，输入训练得到的心电成分分离模型，得到第一成分分离数据。具体地，将第二心电图数据集的心电图数据组合成维度为输入心电成分分离模型M1，将心电成分分离模型M1的输出和第二心电图数据集的心电图数据合并为x1，维度为。S4、将第一成分分离数据输入配对模块，得到第一配对信息，第一配对信息至少包括：第一成分分离数据中存在传导关系的心电成分数量。本申请实施例中，多个心电成分至少包括：心电噪声成分、房颤房扑成分、P波成分以及QRS波群成分，S4包括：S41、以预设的激活阈值和激活概率面积为判定条件，对第一成分分离数据中的P波成分数据和QRS波群进行峰值检测，得到第一成分分离数据中的P波以及QRS波的位置和数目。本申请实施例中，配对模块M3用于对P波通道进行峰值检测，以预设的激活阈值0.5，激活概率面积4.5为判定条件，对检出的P波位置和数量，保存在数组temp1。以同理的过程对QRS通道进行峰值检测，对检测出的QRS位置和数量保存在temp2。S42、根据第一成分分离数据中的P波以及QRS波的位置和数目，按照预设的心电图学配对规则，对存在传导关系的P波以及QRS波进行配对，得到独立的P波数目、独立的QRS波数目以及P-R对的数目。本申请实施例中，心电图学配对规则也即是判定属于一对的P波和QRS波的规则，本申请采用的心电图学配对规则为：如果P波位于QRS之前120ms到350ms之间，则匹配成一个P-R对，否则则为独立P波或QRS波。本申请实施例中，扫描temp1和temp2中存储的信息即可完成配对，进而用cnt_pair、 cnt_iso_p和cnt_iso_r分别表示配对的P-R数目，独立的P波数目，独立的QRS波数目，输出配对信息,,]。具体地，将送入心电成分分离模型M1得到的输出送入配对模块M3，将M3输出的第一配对信息记作x3。S5、将第二心电图数据集、第一成分分离数据和第一配对信息输入诊断分类模型，以预先标注好的诊断结论为监督信号，预训练诊断分类模型。本步骤S5相当于在第二心电图数据集上预训练诊断分类模型M2。诊断分类模型M2的训练标签为经过multi-hot编码的诊断结论，诊断分类模型的损失函数可以选用多分类交叉熵损失，记作Loss_Classification，也即是，前述的Loss_diagnose。S6、基于第一心电图数据集、第二心电图数据集以及配对模块，迭代训练预训练得到的心电成分分离模型和预训练得到的诊断分类模型。本步骤S6相当于利用预训练得到的心电成分分离模型M1、诊断分类模型M2和配对模块M3，进行多轮联合微调。本申请实施例中，每一个训练批次，同时从第一心电图数据集和第二心电图数据集中采样，用诊断分类模型M2的损失函数Loss_diagnose对M2进行梯度下降，用诊断分类模型M2的损失函数Loss_diagnose以及心电成分分离模型M1的损失函数Loss_Channel的代数和对M1进行梯度下降。重复多个批次，直到上述Loss_diagnose和Loss_Channel的代数和不再明显下降为止。其中，w1和w2为常数。在一种可能实施方式中，本步骤S6包括：S61、将第一心电图数据集输入心电成分分离模型，得到第二心电成分分离数据，将第二心电成分分离数据输入配对模块，得到第二配对信息；根据第二配对信息、第一心电图数据集的成分标注信息和第二心电成分分离数据，计算心电成分分离模型的通道分离误差和配对误差；具体地，从第一心电图数据集中抽样32个样本，通过心电成分分离模型和配对模块得到第二心电成分分离数据和第二配对信息；使用四通道对应的成分标注信息计算通道分离误差，使用第一心电图数据集对应的正确配对数和第二配对信息，计算配对误差。S62、将第二心电图数据集输入心电成分分离模型，得到第三心电成分分离数据，将第三心电成分分离数据输入配对模块，得到第三配对信息；将第二心电图数据集、第三心电成分分离数据和第三配对信息输入诊断分类模型，得到第一诊断结论；计算第二心电图数据集的诊断结论和第一诊断结论之间的诊断结论误差。具体地，从第二心电图数据集中抽样96个样本，通过心电成分分离模型、诊断分类模型和配对模块，得到第一诊断结论和第三配对信息，使用预先标注的诊断结论标签，计算第二心电图数据集的诊断结论和第一诊断结论之间的诊断结论误差。S63、根据通道分离误差、配对误差和诊断结论误差，调整心电成分分离模型的参数；根据诊断结论误差，调整诊断分类模型的参数。计算梯度：用梯度下降函数计算loss_channel对心电成分分离模型M1模型参数的梯度，记为g1_S1。用gradient函数计算loss_pair对M1参数的梯度，记为g1_S1P。用gradient函数计算loss_diagnose对诊断分类模型M2参数的梯度，记为g2_S2。再用gradient函数计算loss_diagnose对心电成分分离模型M1参数的梯度，记为g1_S2。梯度下降调参：调用apply_gradient函数，以 g2_S2作为梯度值对诊断分类模型M2的参数进行梯度下降操作；以g1_S1 + 0.33 * g1_S1P + 0.33 * g1_S2 作为梯度值，对心电成分分离模型M1的参数进行梯度下降。。重复S61-S63直至通道分离误差和诊断结论误差达到预设的训练目标。示例性地，重复S61-S63直到loss_channel + loss_diagnose的代数和下降速度趋于预设的收敛目标。达到预设的训练目标后，保存心电成分分离模型M1和诊断分类模型M2的模型参数，即可得到能直接用于对心电图数据进行分析的心电图分析模型。在本申请实施例中，在进行模型训练之前，先构造训练所需的数据集。在开始训练模型之前，通过下述步骤A和步骤B来分别得到第一心电图数据集和第二心电图数据集，数据集的构造过程包括数据准备和数据标注。在一种可能实施方式中，首先对心电图数据进行重采样。示例性地，采样250HZ的采样频率对心电图数据进行重采样。进而对采样后的数据按照预设的截取长度进行截取，例如，截取长度为10秒钟，最终可以将心电图数据保存为numpy张量数据，维度为，其中12的含义为心电图标准12导联。其中，numpy是Python的一种开源的数值计算扩展工具，可用来存储和处理大型矩阵。步骤A、从给定的动态心电图数据库中，选择已标注心电成分的心电图数据片段，对心电图数据片段中缺少的房颤、房扑、QRS波群、伪差和/或P波进行成分标注，得到第一心电图数据集。在一种可能实施方式中，第一心电图数据集中的每条心电图数据需要人工标注出上述的4个心电成分。示例性地，第一心电图数据集可以从动态心电数据中选择心律失常片段进行标注。动态心电数据库一般都已经标注好房颤、房扑以及QRS波群，因此只需确认相关标注的正确性并且额外标注伪差和P波，所需工作量较小。具体地，将心电图数据片段的张量维度变换为和心电成分分离模型匹配的预设维度，按照预设的窗口尺寸和重叠率，对动态心电图数据进行滑窗截取操作，得到本批次训练使用的输入张量。在一种可能实施方式中，在上述滑窗截取操作过程中分别对各个心电成分进行标注。具体地，针对在时间上连续的心电噪声成分和房颤房扑成分，根据心电成分的起止位置逐采样点进行标注，将各个采样点的二分类结果序列作为成分标注信息。在一些实施例中，考虑到心电噪声和房颤成分通常是在时间上连续，Channel_Noise和Channel_AF的成分标注信息，可以根据相应成分的起止位置进行逐采样点标注。房颤和噪声是非心搏依赖标签，只需将对应的开始和结束位置标记为1表示房颤房扑阳性或者干扰即可。即可得到维度为的numpy张量格式成分标注信息，成分标注信息的第二维度依次表示心电成分的类型。通过上述处理，即可得到本条心电图数据针对心电噪声和房颤成分的成分标注信息，保存至第一心电图数据集中。在一种可能实施方式中，针对在时间上分离的P波成分和QRS波群成分，对心电成分的特征点进行标注，将以特征点为中心的高斯核作为成分标注信息。在一些实施例中，由于P波和QRS波在时间上是分离的，Channel_P和Channel_QRS采用标注目标中心点的方式进行标注。具体地，采用以特征点为中心的高斯核作为成分标注信息的过程包括：针对任一条重采样得到的心电图数据，如果该条心电图数据存在QRS波的预分析结果，则初始化一个numpy张量数据a，维度为；对于当前心电图数据a中的所有QRS波，在a中每个对应位置pos_i中，以均值为pos_i，方差为10的预设参数，调用scipy.stats.norm.pdf方法，生成包含25个采样点的正态分布曲线，再将a除以a，以归一化到0~1的范围，取值表示分类为对应心电成分的概率。通过上述过程得到的a，即为QRS的成分标注信息。对于P波，则采取同理的标注方法得到成分标注信息并保存至第一心电图数据集。步骤B、从给定的静息心电数据库中，截取携带有诊断结论标签的心电图数据，采用文本匹配方法，根据给定的医学术语编码表，将诊断结论标签表示为编码值，得到第二心电图数据集，编码值的范围与诊断分类模型所输出诊断结论的维度匹配。第二心电图数据集仅需包含人工确认过的心电图诊断结论，第二心电图数据集的获取比较方便，其数目可以远大于第一心电图数据集。示例性地，针对任一条从静息心电数据库中得到的心电图数据，如果该条心电图数据存在诊断结论，则把诊断结论转化为编码值。可选地，采取SNOMED CT诊断术语编码标准进行匹配，然后转化为multi-hot标签。本申请以30类诊断结论为例，则最终的诊断标签格式为一个维度的numpy张量，取值范围为，取值表示诊断为该诊断结论的概率，0为不属于该诊断结论，1为属于该诊断结论。通过上述过程即可将静息心电数据库中的心电图数据和对应的诊断结论以对应格式，保存至第二心电图数据集。为了便于理解上述模型训练流程，本申请根据一示例性实施例提供了另一种心电图分析模型的训练方法的流程示意图。参考图3，心电图分析模型的构造及训练方法从数据集准备到迭代训练完成，包括步骤1-步骤9：步骤1.数据集准备，包括：1.1心电图重采样。1.2对采样后的数据进行截取。步骤2.数据标注，包括：2.1标注心电成分得到第一心电图数据集：针对QRS波和P波，采用以特征点为中心的高斯核作为成分标注信息；针对心电噪声和房颤成分根据起止位置进行逐采样点标注。2.2标注诊断结论得到第二心电图数据集：采取SNOMED CT诊断术语编码标准进行匹配，转化得到multi-hot格式的成分标注信息。步骤3-步骤5.建立心电成分分离模型M1、诊断分类模型M2和配对模块M3。步骤6.利用第一心电图数据集预训练心电成分分离模型M1。步骤7.利用第二心电图数据集预训练诊断分类模型M2，包括：7.1将第二心电图数据集的心电图数据组合成维度为输入M1，将M1的输出和心电数据合并为x1，维度为；7.2将送入M1的输出送入M3，M3的输出记作x3；7.3将数组作为参数x，将第二心电图数据集的诊断标签组合成维度张量作为参数y，调用model.fit进行训练，迭代5个epoch。步骤8.联合训练，包括：8.1从第一心电图数据集中抽样，预测channel4和pair_n，使用对应的各个心电成分通道的成分标注信息计算loss_channel，使用正确的配对数计算loss_pair，然后用gradient函数计算loss_channel对M1参数的梯度g1_S1，用gradient函数计算loss_pair对M1参数的梯度，记为g1_S1P。8.2从第二心电图数据集中抽样96个样本，预测logtis30和pair_n，使用标注的诊断结论标签计算loss_diagnose，用gradient函数计算loss_diagnose对M2参数的梯度g2_S2；用gradient函数计算loss_diagnose对M1参数的梯度g1_S2。8.3调用apply_gradient函数，以 g2_S2作为梯度值对M2参数进行梯度下降操作；以g1_S1 + 0.33 * g1_S1P + 0.33 * g1_S2作为梯度值对M1参数进行梯度下降。8.4重复8.1~8.3直到loss_channel + loss_diagnose下降趋于平缓。步骤9.保存M1和M2模型参数。通过本申请实施例提供的模型构造方法，提供了模型的构造原理及模型各个部分之间的协作原理，基于此，本申请实施例提供的模型训练方法利用各个部分之间的数据交互，对心电图分析模型进行针对性训练，使得模型的各个部分的性能均能得到提升。训练得到的心电图分析模型能够根据心电图数据输出诊断结论，提高医生的诊断效率；还能够从心电图数据中分离出各个心电成分来呈现给医生，提升心电图分析系统的可用性。并且，在机器学习模型的基础上引入基于心电图学配对规则的配对模块，能够将分离出的各个心电成分进行配对，从而为模型分析心电图的内在逻辑提供了可解释性，提升模型内在分析逻辑的可理解程度，提高医生对模型的接受度进一步地，采用本申请实施例提供技术方案所构造、训练得到的心电图分析模型，能够用于静息心电报告和动态心电报告场景；诊断分类模型输出静息心电诊断结论，可提高医生的诊断效率；心电成分分离模型输出各个心电成分通道，可呈现给医生以辅助其理解模型解读心电图的内在逻辑。模型检测出的房颤房扑通道以及各个P波和QRS波群可以直接应用于动态心电图，也可以进一步用户绘制心电梯形图，表达心电激动的传输过程。从而进一步提升模型在各种医疗场景中的适用性。本申请提供的心电图分析模型的构造、训练方法以及心电图分析系统能够在任意计算设备中实现，该计算设备可以为服务器、多个物理服务器构成的服务器集群或者分布式文件系统，又或者是提供云存储以及云服务、云数据库、云计算、云函数、网络服务、云通信、中间件服务、域名服务、安全服务、内容分发网络、大数据和人工智能平台等基础云计算服务的云服务器集群，本申请对此不做限定。本申请提供了一种计算设备，可用于执行上述心电图分析模型的训练方法或执行心电图分析系统中各个功能模块的功能。图4是本申请实施例提供的一种计算设备的硬件结构示意图，如图4所示，该计算设备包括处理器401、存储器402、总线403、以及存储在所述存储器402中并可在所述处理器401上运行的计算机程序，处理器401包括一个或一个以上处理核心，存储器402通过总线403与处理器401相连，存储器402用于存储程序指令，所述处理器执行所述计算机程序时实现本申请提供的上述方法实施例中的全部或部分步骤。进一步地，作为一个可执行方案，上述计算设备可以是计算机单元，该计算机单元可以是桌上型计算机、笔记本、掌上电脑及云端服务器等计算设备。所述计算机单元可包括，但不仅限于，处理器、存储器。本领域技术人员可以理解，上述计算机单元的组成结构仅仅是计算机单元的示例，并不构成对计算机单元的限定，可以包括比上述更多或更少的部件，或者组合某些部件，或者不同的部件。例如所述计算机单元还可以包括输入输出设备、网络接入设备、总线等，本申请实施例对此不做限定。进一步地，作为一个可执行方案，所称处理器可以是中央处理单元，还可以是其他通用处理器、数字信号处理器 、专用集成电路、现成可编程门阵列 或者其他可编程逻辑器件、分立门或者晶体管逻辑器件、分立硬件组件等。通用处理器可以是微处理器或者该处理器也可以是任何常规的处理器等，所述处理器是所述计算机单元的控制中心，利用各种接口和线路连接整个计算机单元的各个部分。所述存储器可用于存储所述计算机程序和/或模块，所述处理器通过运行或执行存储在所述存储器内的计算机程序和/或模块，以及调用存储在存储器内的数据，实现所述计算机单元的各种功能。所述存储器可主要包括存储程序区和存储数据区，其中，存储程序区可存储操作系统、至少一个功能所需的应用程序；存储数据区可存储根据手机的使用所创建的数据等。此外，存储器可以包括高速随机存取存储器，还可以包括非易失性存储器，例如硬盘、内存、插接式硬盘，智能存储卡，安全数字卡，闪存卡、至少一个磁盘存储器件、闪存器件、或其他易失性固态存储器件。本申请还提供一种计算机可读存储介质，所述计算机可读存储介质存储有计算机程序，所述计算机程序被处理器执行时实现本申请实施例上述方法的步骤。所述计算机单元集成的模块/单元如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本申请实现上述实施例方法中的全部或部分流程，也可以通过计算机程序来指令相关的硬件来完成，所述的计算机程序可存储于一计算机可读存储介质中，该计算机程序在被处理器执行时，可实现上述各个方法实施例的步骤。其中，所述计算机程序包括计算机程序代码，所述计算机程序代码可以为源代码形式、对象代码形式、可执行文件或某些中间形式等。所述计算机可读介质可以包括：能够携带所述计算机程序代码的任何实体或装置、记录介质、U盘、移动硬盘、磁碟、光盘、计算机存储器、只读存储器、随机存取存储器以及软件分发介质等。需要说明的是，所述计算机可读介质包含的内容可以根据司法管辖区内立法和专利实践的要求进行适当的增减。尽管结合优选实施方案具体展示和介绍了本申请，但所属领域的技术人员应该明白，在不脱离所附权利要求书所限定的本申请的精神和范围内，在形式上和细节上可以对本申请做出各种变化，均为本申请的保护范围。
