标题title
一种便携式心电监护设备及系统
摘要abst
本发明提供了一种便携式心电监护设备及系统，首先，确定所述便携式心电监护设备所处的状态，所述状态包括实时监测和非实时监测，若是实时监测，则计算事件每次执行的耗时，得到事件对应的平均执行时间和执行次数，并更新所述事件所在任务的数组；所述任务的数组存储的有任务中每个事件的标识位、平均执行时间、执行次数、事件处理程序的指针，所述标识位用于标识事件是否待执行；判断是否满足预设条件，若是，则根据任务ID、事件对应事件表中的元素、待发送心电监护数据确定事件的执行顺序，根据所述执行顺序执行事件；否则，则OSAL进入省电模式。本发明有效地提高了任务执行效率，节省了电量，提高便携式心电监护设备的续航能力。
权利要求书clms
1.一种便携式心电监护设备，其特征在于，所述设备包括以下模块：模式确定模块，用于确定所述便携式心电监护设备所处的状态，所述状态包括实时监测和非实时监测，若是实时监测，则执行时间统计模块；时间统计模块，用于计算事件每次执行的耗时，得到事件对应的平均执行时间和执行次数，并更新所述事件所在任务的数组；所述任务的数组存储的有任务中每个事件的标识位、平均执行时间、执行次数、事件处理程序的指针，所述标识位用于标识事件是否待执行；事件执行模块，用于判断是否满足预设条件，若是，则根据任务ID、事件对应事件表中的元素、待发送心电监护数据确定事件的执行顺序，根据所述执行顺序执行事件；否则，则OSAL进入省电模式。2.如权利要求1所述的便携式心电监护设备，其特征在于，所述根据任务ID、事件对应事件表中的元素、待发送心电监护数据确定事件的执行顺序，具体为：判断心电数据发送事件的待执行标识为是否为待执行，若否，则获取标识位为待执行的事件所属任务的任务ID、事件的所述平均执行时间、事件的所述执行次数，根据所述执行次数对待执行事件分组，在每个分组内，利用任务ID和所述平均执行时间计算权重，根据权重对每个分组内的事件排序；若是，则获取标识位为待执行的非数据发送事件所属任务的任务ID、事件的所述平均执行时间、事件的所述执行次数，根据所述执行次数对待执行事件分组，在每个分组内，利用任务ID和所述平均执行时间计算权重，根据权重对每个分组内的事件排序，根据待发送心电监护数据，在每个分组中插入n个数据发送事件。3.如权利要求2所述的便携式心电监护设备，其特征在于，所述根据待发送心电监护数据，在每个分组中插入n个数据发送事件，具体为：计算心电监护数据的数据量与基准值的比值，根据所述比值将所述心电监护数据划分为比值个数的分块，依次将每个心电监护数据分块分配到每个分组，并在分组内插入与所述分块对应的数据发送事件。4.如权利要求1所述的便携式心电监护设备，其特征在于，所述确定所述便携式心电监护设备所处的状态，具体为：判断所述便携式心电监护设备能够采集到心电数据所持续的时间，当所述持续的时间达到预设值时，则所述便携式心电监护设备为实时监测模式。5.如权利要求1-4任一项所述的便携式心电监护设备，其特征在于，所述判断是否满足预设条件，具体为：计算所述便携式心电监护设备采集的心电信号异常占比，并对所有待执行事件，计算平均执行时间和执行次数的乘积，并求和，得到总值，根据所述占比和所述总值计算得到结果，若所述结果大于阈值，则满足预设条件，否则，不满足预设条件。6.如权利要求1-5所述的便携式心电监护设备，其特征在于，所述任务的数组中每个数组元素存储一个树结构，所述树结构的根节点为所述标识位，所述树结构的三个叶子节点分别为所述平均执行时间、所述执行次数、所述事件处理程序的指针。7.如权利要求1所述的便携式心电监护设备，其特征在于，所述便携式心电监护设备还包括心电传感器、控制器、存储器、电源。8.如权利要求1-7任一项所述的便携式心电监护设备，其特征在于，所述便携式心电监护设备的心电传感器为织物传感器。9.一种便携式心电监护系统，所述系统包括便携式心电监护设备和移动终端，其特征在于，所述便携式心电监护设备采用如权利要求1-9任一项所述的便携式心电监护设备。10.如权利要求9所述的便携式心电监护系统，其特征在于，所述便携式心电监护设备和移动终端通过BLE通信，所述便携式心电监护设备采用OSAL系统。
说明书desc
技术领域本发明涉及心电监护领域，尤其涉及便携式心电监护设备及系统。背景技术心脏疾病已经是严重威胁人们健康的疾病，快节奏的生活给我们带来生活便利的同时，也给生活增加了压力，不健康的生活行为以及暴饮暴食都会增加患心脏疾病的几率，心率失常、心肌梗塞等疾病频繁发生的同时，也呈现越来越年轻化的趋势。心电监护仪是监测心脏的重要设备，其主要是采集人体的生物信号，转换为可视化的信号，进而实现对心电等的监控。心电监护设备有多种款式，比如体检时医院使用的将电极贴服到人体体表的监护设备，也有便携式和可穿戴的心电监护设备，可穿戴的心电监护设备多采用织物传感器等采集心电信号，便携式心电监护设备主要是手持心电监护设备，不同的厂商推出了不同的心电监护设备，有些手持心电监护设备可以粘贴到胸腔等位置，实现实时监测，可穿戴心电监护也可以实时监护，可以看做是便携式心电监护设备的一种。便携式心电监护设备采用电池供电，而便携式心电监护设备和手机等移动终端通信多采用蓝牙技术，但是蓝牙能耗比较高，便携式心电监护设备的续航有较大挑战。BLE是在经典蓝牙的基础上发展而来的能有效降低功耗的蓝牙技术，虽然使用BLE有助于提高心电监护设备的续航能力，避免了用户频繁的更换电池或者充电。但是心电实时监控仍需要频繁和移动设备连接，如何提高心电监护设备续航能力是提高用户体验的关键。发明内容为了提高便携式心电监护设备的续航能力，实现对心电的实时监控，一方面，本发明提供一种便携式心电监护设备，所述设备包括以下模块：模式确定模块，用于确定所述便携式心电监护设备所处的状态，所述状态包括实时监测和非实时监测，若是实时监测，则执行时间统计模块；时间统计模块，用于计算事件每次执行的耗时，得到事件对应的平均执行时间和执行次数，并更新所述事件所在任务的数组；所述任务的数组存储的有任务中每个事件的标识位、平均执行时间、执行次数、事件处理程序的指针，所述标识位用于标识事件是否待执行；事件执行模块，用于判断是否满足预设条件，若是，则根据任务ID、事件对应事件表中的元素、待发送心电监护数据确定事件的执行顺序，根据所述执行顺序执行事件；否则，则OSAL进入省电模式。优选地，所述根据任务ID、事件对应事件表中的元素、待发送心电监护数据确定事件的执行顺序，具体为：判断心电数据发送事件的待执行标识为是否为待执行，若否，则获取标识位为待执行的事件所属任务的任务ID、事件的所述平均执行时间、事件的所述执行次数，根据所述执行次数对待执行事件分组，在每个分组内，利用任务ID和所述平均执行时间计算权重，根据权重对每个分组内的事件排序；若是，则获取标识位为待执行的非数据发送事件所属任务的任务ID、事件的所述平均执行时间、事件的所述执行次数，根据所述执行次数对待执行事件分组，在每个分组内，利用任务ID和所述平均执行时间计算权重，根据权重对每个分组内的事件排序，根据待发送心电监护数据，在每个分组中插入n个数据发送事件。优选地，所述根据待发送心电监护数据，在每个分组中插入n个数据发送事件，具体为：计算心电监护数据的数据量与基准值的比值，根据所述比值将所述心电监护数据划分为比值个数的分块，依次将每个心电监护数据分块分配到每个分组，并在分组内插入与所述分块对应的数据发送事件。优选地，所述确定所述便携式心电监护设备所处的状态，具体为：判断所述便携式心电监护设备能够采集到心电数据所持续的时间，当所述持续的时间达到预设值时，则所述便携式心电监护设备为实时监测模式。优选地，所述判断是否满足预设条件，具体为：计算所述便携式心电监护设备采集的心电信号异常占比，并对所有待执行事件，计算平均执行时间和执行次数的乘积，并求和，得到总值，根据所述占比和所述总值计算得到结果，若所述结果大于阈值，则满足预设条件，否则，不满足预设条件。优选地，所述任务的数组中每个数组元素存储一个树结构，所述树结构的根节点为所述标识位，所述树结构的三个叶子节点分别为所述平均执行时间、所述执行次数、所述事件处理程序的指针。优选地，所述便携式心电监护设备还包括心电传感器、控制器、存储器、电源。优选地，所述便携式心电监护设备的心电传感器为织物传感器。另外，本发明提供了一种便携式心电监护系统，所述系统包括便携式心电监护设备和移动终端，所述便携式心电监护设备采用如上所述的便携式心电监护设备。优选地，所述便携式心电监护设备和移动终端通过BLE通信，所述便携式心电监护设备采用OSAL系统。本发明对便携式心电监护设备使用的BLE中的OSAL进行改进，尤其是对OSAL的事件表以及事件处理做了改进，避免了执行时间长的事件一直占用OSAL资源，导致数据发送不及时，而且通过心电异常数据的判断，确定了便携式心电监护设备是否休眠，节省了便携式心电监护设备的电量，提高了便携式心电监护设备的续航能力。附图说明为了更清楚地说明本发明具体实施方式或现有技术中的技术方案，下面将对具体实施方式或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施方式，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1为实施例二的示意图；图2为OSAL的时间表的示意图；图3为事件表中元素的树结构示意图图4为实施例三流程图。具体实施方式在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括一个……”限定的要素，并不排除在包括所述要素的过程、方法、物品或者设备中还存在另外的相同要素。下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。实施例一本发明提供一种便携式心电监护设备，所述设备包括以下模块：模式确定模块，用于确定所述便携式心电监护设备所处的状态，所述状态包括实时监测和非实时监测，若是实时监测，则执行时间统计模块；便携式心电监护设备分为三类，第一种是利用织物传感器实现心电监护设备，第二种是既可以手持又可以粘贴到皮肤表面的心电监护设备，如图1所示，第三种是只能手持的心电监护设备，所谓手持的心电监护设备是指通过手指捏或者手掌握的方式测量心电监护设备。由于只能手持的心电监护设备无法实时监控心电数据，也就不需要实时和移动终端建立蓝牙连接，如无特殊说明，本发明所指的心电监护设备为第一种和第二种。所述移动终端为手机、Pad或者智能手表或其他智能可穿戴设备，本发明对此不作具体限定。对心电的监护分为实时监控和非实时监控，所谓实时监控是在很低的延时情况下，例如10s，持续获取心电数据，非实时监控是单次或多次测量。实时监控需要便携式心电监护设备持续和移动终端建立蓝牙连接，这对于便携式心电监护设备的续航能力有很大挑战。本发明首先确定便携式心电监护设备是否是实时监控，如果是实时监控，则执行事件统计模块。时间统计模块，用于计算事件每次执行的耗时，得到事件对应的平均执行时间和执行次数，并更新所述事件所在任务的数组；所述任务的数组存储的有任务中每个事件的标识位、平均执行时间、执行次数、事件处理程序的指针，所述标识位用于标识事件是否待执行；OSAL是BLE的运行系统，OSAL是事件驱动型的轮询系统，在OSAL中实现BLE协议栈的内容，OSAL负责任务的调度、内存管理等。在OSAL中包括至少一个任务，每个任务包括至少一个事件，每个事件对应一个事件处理函数，在OSAL中有一个事件表，如图2所示，事件表显示了任务-事件的关系，例如Task 2包括Event 1-Event M，每个任务对应一个数组，数组中存储有对应事件的标识位，所有任务的数组组成了事件表，标识位用于标识事件是否待执行。当事件表中对应位为1，则表明该任务的这个事件待执行，如图1所示，Task 1的Event 2、Task 2的Event 3、Task 3的Event 1的标识位为1，则这些事件等待执行，OSAL会先执行Task 1中所有标识位为1的事件，然后执行Task 2中所有标识位为1是事件，直到所有Task中标识位为1的事件全部执行完毕，然后返回Task1执行Task 1中所有标识位为1的事件，以此类推。在每个事件执行完毕后，相应的标识位将置0。不同事件的处理函数不同，待处理的数据等不同，导致每个事件的用时不同，在本发明中，事件表不仅包括事件的标识位，还包括事件的平均执行时间、执行次数、事件处理程序的指针，通过事件表即可获得事件执行的相关信息。在一个具体实施例中，事件的执行时间通过在事件处理函数的头部和尾部添加时间函数，将尾部的时间函数和头部的时间函数的差值得到事件执行事件。在每次事件执行完毕后，不仅更新标识位，还更新事件的平均执行时间、执行次数。事件执行模块，用于判断是否满足预设条件，若是，则根据任务ID、事件对应事件表中的元素、待发送心电监护数据确定事件的执行顺序，根据所述执行顺序执行事件；否则，则OSAL进入省电模式。虽然OSAL是事件驱动型的执行事件，但是所属任务的ID高或者低的事件会优先执行，例如先执行任务ID小的事件，为了避免平均执行时间长的事件集中，导致一直占用系统，本发明中根据事件所在任务的ID、事件数组中事件对应的元素、待发送心电监护数据确定事件执行顺序。其中，事件所在任务的ID为该事件所在的任务，例如一个事件是Task 2的Event3，则所述任务ID为2；事件对应事件表中的元素是事件在事件表中的元素，本发明中，所述元素为标识位、平均执行时间、执行次数、事件处理程序的指针。为了避免执行时间长的事件集中，导致数据发送不及时，在一个具体实施例中，所述根据任务ID、事件对应事件表中的元素、待发送心电监护数据确定事件的执行顺序，具体为：判断心电数据发送事件的待执行标识为是否为待执行，若否，则获取标识位为待执行的事件所属任务的任务ID、事件的所述平均执行时间、事件的所述执行次数，根据所述执行次数对待执行事件分组，在每个分组内，利用任务ID和所述平均执行时间计算权重，根据权重对每个分组内的事件排序；当没有心电数据要发送时，此时BLE处于接收移动终端数据，或者便携式心电监护设备处于广播或者空闲状态，此时，根据事件的执行次数对事件分组，每个分组中事件执行次数相同或者相近，例如有三个Event，Event 1-3的执行次数分别为5、2、8，则将Event 1、2分为一组，Event 3分为一组，这样每个分组执行次数处于平衡状态。然后，根据事件所在任务的ID和平均执行时间计算权重，在一个具体实施例中，所述权重w＝ID*Tavg，例如，Event 1所在任务的ID为4，平均执行时间为200ms，则w＝800，然后根据权重对分组内的事件排序。在执行完第一个分组的一个事件后，执行第二个分组的一个事件，以此类推。若是，则获取标识位为待执行的非数据发送事件所属任务的任务ID、事件的所述平均执行时间、事件的所述执行次数，根据所述执行次数对待执行事件分组，在每个分组内，利用任务ID和所述平均执行时间计算权重，根据权重对每个分组内的事件排序，根据待发送心电监护数据，在每个分组中插入n个数据发送事件。当有心电数据需要发送时，为了避免数据发送事件一直执行，本发明中，将心电监护数据分块，每个分块对应一个心电数据发送事件，插入到多个分组中，在一个具体实施例中，所述根据待发送心电监护数据，在每个分组中插入n个数据发送事件，具体为：计算心电监护数据的数据量与基准值的比值，根据所述比值将所述心电监护数据划分为比值个数的分块，依次将每个心电监护数据分块分配到每个分组，并在分组内插入与所述分块对应的数据发送事件。在一个具体实施例中，所述确定所述便携式心电监护设备所处的状态，具体为：判断所述便携式心电监护设备能够采集到心电数据所持续的时间，当所述持续的时间达到预设值时，则所述便携式心电监护设备为实时监测模式。在另外一个实施例中，根据用户在移动终端输入的参数确定心电监护设备所处的状态，用户可以在移动终端中APP中输入心电监护模式，若输入的心电监护模式为持续监护或实时监护，则所述便携式心电监护设备为实时监测，否则不是；在另外一个实施例中，在便携式心电监护设备上设置一个按键，根据按键的操作确定是否是实时监护。为了节省便携式心电监护设备的电量，提高续航能力，在一个具体实施例中，所述判断是否满足预设条件，具体为：计算所述便携式心电监护设备采集的心电信号异常占比，并对所有待执行事件，计算平均执行时间和执行次数的乘积，并求和，得到总值，根据所述占比和所述总值计算得到结果，若所述结果大于阈值，则满足预设条件，否则，不满足预设条件。异常占比通过异常数据个数和全部数据个数的比值得到，异常数据的判断将采集的心电数据和正常值对比得到，为了避免误判，在一个实施例中，此处的正常值位于医学推荐的正常值范围内，也即此处的正常值比医学推荐的正常值范围小。在一个具体实施例中，所述任务的数组中每个数组元素存储一个树结构，所述树结构的根节点为所述标识位，所述树结构的三个叶子节点分别为所述平均执行时间、所述执行次数、所述事件处理程序的指针，如图3所示。在一个具体实施例中，所述便携式心电监护设备还包括心电传感器、控制器、存储器、电源。所述便携式心电监护设备的心电传感器为织物传感器。实施例二本发明提供了一种便携式心电监护系统，所述系统包括便携式心电监护设备和移动终端，如图1所示，所述便携式心电监护设备采用如实施例一所述的便携式心电监护设备。在一个具体实施例中，所述便携式心电监护设备和移动终端通过BLE通信，所述便携式心电监护设备采用OSAL系统。实施例三本发明提供了一种便携式心电监护设备控制方法，所述方法应用在所述便携式心电监护设备的BLE芯片中，所述BLE芯片采用OSAL系统，如图4所示，所述方法包括以下步骤：步骤1，确定所述便携式心电监护设备所处的状态，所述状态包括实时监测和非实时监测，若是实时监测，则执行步骤2；在一个具体实施例中，如果监测到非实时监测，则表明便携式心电监护设备处于一次或多次监测中，用户在进行单次测量，则继续检测便携式心电监护设备所处的状态。步骤2，计算事件每次执行的耗时，得到事件对应的平均执行时间和执行次数，并更新所述事件所在任务的数组；所述任务的数组存储的有任务中每个事件的标识位、平均执行时间、执行次数、事件处理程序的指针，所述标识位用于标识事件是否待执行；步骤3，判断是否满足预设条件，若是，则根据任务ID、事件对应事件表中的元素、待发送心电监护数据确定事件的执行顺序，根据所述执行顺序执行事件；否则，则OSAL进入省电模式。在一个具体实施例中，所述根据任务ID、事件对应事件表中的元素、待发送心电监护数据确定事件的执行顺序，具体为：判断心电数据发送事件的待执行标识为是否为待执行，若否，则获取标识位为待执行的事件所属任务的任务ID、事件的所述平均执行时间、事件的所述执行次数，根据所述执行次数对待执行事件分组，在每个分组内，利用任务ID和所述平均执行时间计算权重，根据权重对每个分组内的事件排序；若是，则获取标识位为待执行的非数据发送事件所属任务的任务ID、事件的所述平均执行时间、事件的所述执行次数，根据所述执行次数对待执行事件分组，在每个分组内，利用任务ID和所述平均执行时间计算权重，根据权重对每个分组内的事件排序，根据待发送心电监护数据，在每个分组中插入n个数据发送事件。在一个具体实施例中，所述根据待发送心电监护数据，在每个分组中插入n个数据发送事件，具体为：计算心电监护数据的数据量与基准值的比值，根据所述比值将所述心电监护数据划分为比值个数的分块，依次将每个心电监护数据分块分配到每个分组，并在分组内插入与所述分块对应的数据发送事件。在一个具体实施例中，所述确定所述便携式心电监护设备所处的状态，具体为：判断所述便携式心电监护设备能够采集到心电数据所持续的时间，当所述持续的时间达到预设值时，则所述便携式心电监护设备为实时监测模式。在一个具体实施例中，所述判断是否满足预设条件，具体为：计算所述便携式心电监护设备采集的心电信号异常占比，并对所有待执行事件，计算平均执行时间和执行次数的乘积，并求和，得到总值，根据所述占比和所述总值计算得到结果，若所述结果大于阈值，则满足预设条件，否则，不满足预设条件。在一个具体实施例中，所述任务的数组中每个数组元素存储一个树结构，所述树结构的根节点为所述标识位，所述树结构的三个叶子节点分别为所述平均执行时间、所述执行次数、所述事件处理程序的指针。在一个具体实施例中，所述便携式心电监护设备还包括心电传感器、控制器、存储器、电源。所述便携式心电监护设备的心电传感器为织物传感器。实施例四本发明还提供了一种计算机可读存储介质，用于存储计算机程序指令，所述计算机程序指令在被处理器执行时实现如实施例三所述的方法。最后，本发明提供了一种电子设备，包括存储器和处理器，所述存储器用于存储一条或多条计算机程序指令，其中，所述一条或多条计算机程序指令被所述处理器执行以实现如实施例三所述的方法。通过以上的实施方式的描述，本领域的技术人员可以清楚地了解到各实施方式可借助加必需的通用硬件平台的方式来实现，当然也可以通过硬件和软件结合的方式来实现。基于这样的理解，上述技术方案本质上或者说对现有技术做出贡献的部分可以以计算机产品的形式体现出来，本发明可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。最后应说明的是：以上实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的精神和范围。
