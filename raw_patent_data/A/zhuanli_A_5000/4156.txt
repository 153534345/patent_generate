标题title
基于区块链分布式共识算法的战斗数据处理方法及系统
摘要abst
本发明涉及一种基于区块链分布式共识算法的战斗数据处理方法，包括：S1.游戏服务器采集客户端的战斗数据；S2.游戏服务器将采集的战斗数据依次下发至参与当前战斗的各个客户端；S3.各个客户端基于接收的战斗数据，计算当前战斗的战斗结果；并将战斗结果传输至游戏服务器；S4.游戏服务器将所述各个客户端计算的战斗结果依次下发至参与当前战斗的各个客户端；S5.参与当前战斗的各个客户端将接收的其他客户端的战斗结果依次与自身计算的战斗结果进行比对及统计；判断是否存在客户端其统计的比对结果一致的战斗结果数量大于或等于n/2；若是，则取该客户端计算的战斗结果作为当前战斗的战斗结果，并同步至其他参与当前战斗的客户端。
权利要求书clms
1.基于区块链分布式共识算法的战斗数据处理方法，其特征在于：包括：S1.游戏服务器采集参与当前战斗的各个客户端的战斗数据；S2.游戏服务器将采集的战斗数据进行汇总后依次下发至参与当前战斗的各个客户端；S3.各个客户端基于接收的战斗数据，计算当前战斗的战斗结果；并将所述战斗结果传输至游戏服务器；S4.游戏服务器将所述各个客户端计算的战斗结果依次下发至参与当前战斗的各个客户端；S5.参与当前战斗的各个客户端将接收的其他客户端的战斗结果依次与自身计算的战斗结果进行比对及统计；S6.利用区块链分布式共识算法根据所述比对结果执行如下步骤：判断是否存在客户端其统计的比对结果一致的战斗结果数量大于或等于n/2，其中n为参与当前战斗的客户端的数量；若是，则取该客户端计算的战斗结果作为当前战斗的战斗结果，并同步至其他参与当前战斗的客户端；否则执行步骤S7；S7.游戏服务器汇总的战斗数据下发至第三方客户端进行战斗结果的计算，第三方客户端将计算的战斗结果传输至游戏服务器；S8.游戏服务器将第三方客户端计算的战斗结果传输至参与当前战斗的各个客户端；S9.执行S5后，利用区块链分布式共识算法根据所述比对结果执行如下步骤：判断是否存在客户端其统计的比对结果一致的战斗结果数量大于或等于n/2；若是，则取该客户端计算的战斗结果作为当前战斗的战斗结果，并同步至其他参与战斗的客户端；若否，重复执行步骤S7-S9。2.根据权利要求 1所述的基于区块链分布式共识算法的战斗数据处理方法，其特征在于：执行所述S1之前，游戏服务器收集参与当前战斗的各个客户端的用户行为信息。3.根据权利要求 1所述的基于区块链分布式共识算法的战斗数据处理方法，其特征在于：执行所述S1之前，游戏服务器生成当前战斗的唯一编号，用于记录当前战斗的唯一性，并将所述唯一编号传输至当前战斗的各个客户端。4.根据权利要求 3所述的基于区块链分布式共识算法的战斗数据处理方法，其特征在于：所述游戏服务器生成当前战斗的唯一编号，包括：使用unix毫秒时间戳以及参与战斗的全部用户id的散列哈希值生成。5.根据权利要求 3所述的基于区块链分布式共识算法的战斗数据处理方法，其特征在于：执行所述S1之前，游戏服务器生成随机数种子并将其分发至参与当前战斗的各个客户端，用于后续的战斗数据采集。6.根据权利要求 1-5任一项所述的基于区块链分布式共识算法的战斗数据处理方法，其特征在于：所述S1游戏服务器采集的参与当前战斗的各个客户端的战斗数据包括用户的战斗属性、行为数据。7.根据权利要求 6所述的基于区块链分布式共识算法的战斗数据处理方法，其特征在于：所述S3中，各个客户端计算当前战斗的战斗结果，以及生成相应的校验片段，并将所述战斗结果、校验片段传输至游戏服务器；所述S4中，游戏服务器将所述各个客户端计算的战斗结果、校验片段下发至参与当前战斗的各个客户端；所述S5中，参与当前战斗的各个客户端将接收的战斗结果、校验片段依次与自身计算的战斗结果、校验片段进行比对及统计所述S7中，第三方客户端将计算的战斗结果、生成的校验片段传输至游戏服务器；所述S8中，游戏服务器将第三方客户端计算的战斗结果、生成的校验片段传输至参与当前战斗的各个客户端。8.根据权利要求 7所述的基于区块链分布式共识算法的战斗数据处理方法，其特征在于：所述战斗结果包括当前战斗完毕后，各个客户端的战斗属性、状态。9.根据权利要求 7所述的基于区块链分布式共识算法的战斗数据处理方法，其特征在于：所述n的取值范围为：大于或等于3。10.基于区块链分布式共识算法的战斗数据处理系统，应用权利要求1-9任一项所述的基于区块链分布式共识算法的战斗数据处理方法，其特征在于：包括参与当前战斗的各个客户端、游戏服务器和第三方客户端。
说明书desc
技术领域本发明涉及游戏软件技术领域，更具体地，涉及一种基于区块链分布式共识算法的战斗数据处理方法及系统。背景技术目前，高端的游戏软件其核心的内容在于游戏战斗。对于游戏战斗数据的处理，现有方法大多使用状态同步的方式，即由游戏服务器完成战斗数据的处理以及战斗结果的计算，客户端只负责玩家指令的输入，游戏服务器将战斗结果传输至客户端，客户端进行战斗结果的呈现。然而，上述战斗数据处理方式在游戏玩家增多的情况下，游戏服务器的负载也会同步增加，大大增加游戏服务器负载和成本。并且，游戏服务器无法处理复杂的图形计算逻辑，若战斗涉及到复杂的图形处理逻辑时，游戏服务器需要额外增加GPU图形处理器，增加了游戏服务开发的难度和复杂度。发明内容本发明的第一发明目的在于提供一种基于区块链分布式共识算法的战斗数据处理方法，该方法将区块链分布式共识算法引入到战斗数据处理中，解决客户端不可信的问题，并且通过将战斗结果计算放在客户端，解决现有将战斗结果计算放在游戏服务器导致的游戏服务器负载过大、游戏服务器不具备图形计算能力的问题。本发明的第一发明目的在于提供一种应用上述方法的基于区块链分布式共识算法的战斗数据处理系统为实现第一发明目的，采用的技术方案是：基于区块链分布式共识算法的战斗数据处理方法，包括：S1.游戏服务器采集参与当前战斗的各个客户端的战斗数据；S2.游戏服务器将采集的战斗数据进行汇总后依次下发至参与当前战斗的各个客户端；S3.各个客户端基于接收的战斗数据，计算当前战斗的战斗结果；并将所述战斗结果传输至游戏服务器；S4.游戏服务器将所述各个客户端计算的战斗结果依次下发至参与当前战斗的各个客户端；S5.参与当前战斗的各个客户端将接收的其他客户端的战斗结果依次与自身计算的战斗结果进行比对及统计；S6.利用区块链分布式共识算法根据所述比对结果执行如下步骤：判断是否存在客户端其统计的比对结果一致的战斗结果数量大于或等于n/2，其中n为参与当前战斗的客户端的数量；若是，则取该客户端计算的战斗结果作为当前战斗的战斗结果，并同步至其他参与当前战斗的客户端；否则执行步骤S7；S7.游戏服务器汇总的战斗数据下发至第三方客户端进行战斗结果的计算，第三方客户端将计算的战斗结果传输至游戏服务器；S8.游戏服务器将第三方客户端计算的战斗结果传输至参与当前战斗的各个客户端；S9.执行S5后，利用区块链分布式共识算法根据所述比对结果执行如下步骤：判断是否存在客户端其统计的比对结果一致的战斗结果数量大于或等于n/2；若是，则取该客户端计算的战斗结果作为当前战斗的战斗结果，并同步至其他参与战斗的客户端；若否，重复执行步骤S7-S9。优选地，执行所述S1之前，游戏服务器收集参与当前战斗的各个客户端的用户行为信息。优选地，执行所述S1之前，游戏服务器生成当前战斗的唯一编号，用于记录当前战斗的唯一性，并将所述唯一编号传输至当前战斗的各个客户端。优选地，所述游戏服务器生成当前战斗的唯一编号，包括：使用unix毫秒时间戳以及参与战斗的全部用户id的散列哈希值生成。优选地，执行所述S1之前，游戏服务器生成随机数种子并将其分发至参与当前战斗的各个客户端，用于后续的战斗数据采集。优选地，所述S1游戏服务器采集的参与当前战斗的各个客户端的战斗数据包括用户的战斗属性、行为数据。优选地，所述S3中，各个客户端计算当前战斗的战斗结果，以及生成相应的校验片段，并将所述战斗结果、校验片段传输至游戏服务器；所述S4中，游戏服务器将所述各个客户端计算的战斗结果、校验片段下发至参与当前战斗的各个客户端；所述S5中，参与当前战斗的各个客户端将接收的战斗结果、校验片段依次与自身计算的战斗结果、校验片段进行比对及统计所述S7中，第三方客户端将计算的战斗结果、生成的校验片段传输至游戏服务器；所述S8中，游戏服务器将第三方客户端计算的战斗结果、生成的校验片段传输至参与当前战斗的各个客户端。优选地，所述战斗结果包括当前战斗完毕后，各个客户端的战斗属性、状态。优选地，所述n的取值范围为：大于或等于3。为实现第二发明目的，采用的技术方案是：基于区块链分布式共识算法的战斗数据处理系统，应用权上述的基于区块链分布式共识算法的战斗数据处理方法，包括参与当前战斗的各个客户端、游戏服务器和第三方客户端。与现有技术相比，本发明的有益效果是：本发明提供的基于区块链分布式共识算法的战斗数据处理方法通过将战斗结果计算放在参与当前战斗的各个客户端，节省了游戏服务器的资源消耗，且能够有效利用客户端的图形计算器资源，战斗结果计算支持复杂的图形计算，使游戏支持更加复杂的设计。并且，将区块链分布式共识算法引入到战斗数据处理中，解决客户端不可信的问题。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其它的附图。图1为基于区块链分布式共识算法的战斗数据处理方法的流程示意图。图2为基于区块链分布式共识算法的战斗数据处理系统的结构示意图。具体实施方式为使得本发明的发明目的、特征、优点能够更加的明显和易懂，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，下面所描述的实施例仅仅是本发明一部分实施例，而非全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其它实施例，都属于本发明保护的范围。实施例1图1为本发明提供的基于区块链分布式共识算法的战斗数据处理方法的流程示意图。本实施例中，如图2所示，基于区块链分布式共识算法的战斗数据处理方法主要涉及到参与战斗的各个客户端、游戏服务器和第三方客户端三个主体，其具体的步骤流程如下：战斗开始前游戏服务器收集参与战斗的客户端战斗相关的用户行为信息，以下用n表示参与当前战斗的客户端数量。用户行为信息包括：用户id、昵称、等级、战力、已开启的战斗技能、血量、攻击、防御、命中、闪避、速度、暴击等战斗计算相关属性，具体信息根据游戏设计不同会有所区别。游戏服务器生成当前战斗的唯一编号 ，唯一编号用于记录当前战斗的唯一性。本实施例中，当前战斗唯一编号使用unix毫秒时间戳+参与战斗的全部用户id的散列哈希值生成。客户端从游戏服务器获取当前战斗唯一编号。将战斗顺序从1开始，每次需要客户端参与战斗结果计算时，战斗顺序往上加1，直到战斗结束，最后的战斗顺序为M。游戏服务器生成战斗顺序1所需要的随机数种子。战斗计算过程会涉及到概率性事件，例如A攻击B的时候有50%概率产生暴击效果，为了全部客户端在计算过程中能生成一样的概率，需要一样的随机数种子和算法。客户端获取战斗顺序1所需要的随机数种子。游戏服务器采集参与战斗顺序1的各个客户端的战斗数据，战斗数据包括用户行为数据、用户战斗属性。这里的用户行为数据包括：用户在当前战斗顺序里使用的战斗技能游戏服务器将采集的战斗顺序1的战斗数据进行汇总后依次下发至参与战斗顺序1的各个客户端。为了保证计算结果的一致，所有客户端接收到的战斗数据都是一样的。客户端1~n根据游戏服务器的发送的战斗数据，计算战斗顺序1的战斗结果。客户端根据用户战斗属性、行为数据计算战斗结果。例如：A使用技能攻击B，B使用技能攻击C，C选择防御技能，D使用技能攻击A计算中，先根据所有客户端的速度排列出手顺序，然后根据攻击和受击双方的属性，计算双方的变化属性值，例如A攻击B根据双方的属性计算出来B血量减少10点。客户端1~n将各自计算的战斗结果和生成的校验片段发送到游戏服务器，游戏服务器记录并转发战斗结果给其余的客户端。战斗结果指客户端战斗逻辑计算完后，战斗双方的属性和状态；校验片段，具体例如：A攻击B的计算过程中产生的随机数值、B减少的血量、B攻击C产生的随机数、C减少的血量等数据片段。客户端1~n校验游戏服务器转发过来的其他客户端的战斗结果、校验片段。将游戏服务器转发过来的其他客户端的战斗结果、校验片段数据与本地客户端产生的校验片段、战斗结果做对比。客户端使用区块链分布式共识算法对校验结果进行判断，是否有大于或等于n/2的结果校验一致。因为客户端接收到的其他客户端战斗结果、校验片段不是一次性全部到达的，所以这里引入区块链分布式共识算法，可以理解为：客户端1完成计算后，当接收到客户端2的战斗结果、校验片段校验一致后，客户端1的计数状态加1，后续接收到的其他客户端数据校验一致，客户端1的计数状态加1，直到计数状态大于或等于一半的参与者，则客户端1的战斗结果作为当前战斗顺序1的最终战斗结果，通知其他客户端同步最终战斗结果。假设客户端1是异常客户端。其他客户端是正常的，则会由其他客户端校验出正常的战斗结果，并通知客户端1同步。如果不超过n/2的结果一致，则将战斗数据发送至不参与战斗的第三方客户端进行战斗结果计算。第三方客户端将计算的战斗结果发送给游戏服务器。游戏服务器将第三方客户端计算的战斗结果转发给其他客户端。其他客户端进行的判断，如果还没有超过n/2的结果一致，则重复~；取超过n/2的战斗结果为当前战斗计算结果，同步其他客户端。其他客户端将当前战斗计算结果覆盖本地计算结果。如果战斗没结束，则重复步骤~，直到战斗结束。在本申请所提供的几个实施例中，应该理解到，所揭露的系统，装置和方法，可以通过其它的方式实现。例如，以上所描述的装置实施例仅仅是示意性的，例如，所述单元的划分，仅仅为一种逻辑功能划分，实际实现时可以有另外的划分方式，例如多个单元或组件可以结合或者可以集成到另一个系统，或一些特征可以忽略，或不执行。另一点，所显示或讨论的相互之间的耦合或直接耦合或通信连接可以是通过一些接口，装置或单元的间接耦合或通信连接，可以是电性，机械或其它的形式。所述作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部单元来实现本实施例方案的目的。另外，在本发明各个实施例中的各功能单元可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中。上述集成的单元既可以采用硬件的形式实现，也可以采用软件功能单元的形式实现。所述集成的单元如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储介质中。基于这样的理解，本发明的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的全部或部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储介质中，包括若干指令用以使得一台计算机设备执行本发明各个实施例所述方法的全部或部分步骤。而前述的存储介质包括：U盘、移动硬盘、只读存储器、随机存取存储器、磁碟或者光盘等各种可以存储程序代码的介质。以上所述，以上实施例仅用以说明本发明的技术方案，而非对其限制；尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的精神和范围。
