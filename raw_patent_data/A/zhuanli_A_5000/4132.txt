标题title
一种柔性脑磁头盔及其传感器阵列空间定位方法
摘要abst
本申请适用柔性脑磁头盔技术领域，提供了一种柔性脑磁头盔及其传感器阵列空间定位方法。本申请头盔及定位方法通过将插槽的外形信息输入识别系统，同时在插槽上标记易于识别系统采集的定位点和辅助点，使得附着于柔性盔帽上表面的插槽无论如何改变空间位置，其中插入的传感器的空间位置都可以被识别系统计算出来。以传感器中气室中心点为基础的探头磁场方向即可被准确识别，使得脑磁头盔传感器阵列磁场中心的三维空间分布可以快速的基于三维光学扫描而得到。有助于提高脑磁定位的自动化水平和定位精度，同时也节约大量的人工对插槽进行标号和记录位置的时间，为磁源信号与人脑配准、溯源定位提供更精准的位置信息。
权利要求书clms
1.一种柔性脑磁头盔，其特征在于，包括由柔性材质构成的盔帽、固定在所述盔帽外表面，且阵列排布的若干插槽，以及插入所述插槽的传感器；所述插槽的槽体上表面设置有定位点，用于表征插槽的外形；所述插槽的上表面还设置有辅助点，用于引导所述传感器的插入方向；所述插槽设置为底面为矩形的直四棱柱；所述直四棱柱的侧楞的上顶点为所述定位点；所述直四棱柱的上底面的一侧短边上设置有所述辅助点；所述直四棱柱的下底面为所述插槽的槽底。2.如权利要求1所述的柔性脑磁头盔，其特征在于，所述传感器包括探头和数据线；所述探头的外形与所述插槽匹配设置；所述探头内设置有存放碱金属原子的气室；所述数据线的连接在探头与脑磁图仪之间；所述探头的气室不在所述探头的几何中心，所述传感器插入所述插槽时，按照所述探头最靠近所述辅助点的形式确定所述传感器的探头插入方向。3.一种应用于权利要求1至2任意一项所述柔性脑磁头盔的传感器阵列空间定位方法，其特征在于，所述方法包括下述步骤：s1.将插槽的外形信息输入识别系统；s2.设置面部定位标志点和插槽上的定位点和辅助点；s3.三维光学扫描系统对佩戴了柔性脑磁头盔的受试者头面部进行扫描，输出三维图像数据；s4.所述识别系统根据预设色彩阈值筛选出三维图像数据中的面部定位标志点点云、定位点点云和辅助点点云；s5.分别对所述面部定位标志点点云、所述定位点点云和所述辅助点点云进行聚类、计数、平面拟合；最终得到脑磁头盔传感器阵列磁场中心的三维空间分布；所述外形信息包括：所述插槽上定位点的数量、辅助点的数量、所述定位点之间的位置关系，以及所述定位点与所述辅助点之间的位置关系。4.如权利要求3所述的空间定位方法，其特征在于，所述步骤s2包括以下具体步骤：s21.在受试者鼻根、左耳根和右耳根的皮肤上设置相应的所述面部定位标志点；s22.将所述定位点设置为绿色，所述辅助点设置为红色；有利于所述识别系统对其进行识别和聚类；所述面部定位标志点用于确定所述定位点点云和所述辅助点点云对应受试者的头部位置。5.如权利要求4所述的空间定位方法，其特征在于，所述步骤s5包括以下具体步骤：s51.对所述面部定位标志点点云进行识别及聚类；s52.根据所述外形信息对所述定位点点云进行识别、自动计数及聚类，得到所述定位点的数量；s53.根据所述定位点的数量对所述插槽进行聚类，得到所述插槽的数量、编号和对应的三维坐标；s54.根据所述外形信息对所述辅助点点云进行识别、聚类及归类；s55.根据所述插槽中定位点的三维坐标计算所述插槽的法向量；s56.根据所述插槽的法向量和辅助点与探头所在的气室的位置关系，计算所述传感器的气室中心点。6.如权利要求5所述的空间定位方法，其特征在于，所述步骤s5还包括以下具体步骤s57.将所述传感器的气室中心点与所述三维图像数据拟合，最终得到脑磁头盔传感器阵列磁场中心的三维空间分布。7.如权利要求4所述的空间定位方法，其特征在于，所述步骤s21中，所述面部定位标志点为蓝色贴纸。8.如权利要求7所述的空间定位方法，其特征在于，所述面部定位标志点根据受试者的鼻根、左耳根和右耳根的位置构建对应的三维坐标关系。
说明书desc
技术领域本申请属于柔性脑磁头盔技术领域，尤其涉及一种柔性脑磁头盔及其传感器阵列空间定位方法。背景技术脑磁图是一种无创、实时探测大脑神经元电活动所产生磁场的神经影像学技术，在脑科学研究和神经外科临床诊断方面具有重要的作用和广泛的应用前景。传统商用MEG测量使用的传感器主要是超导量子干涉仪，原子磁力计作为新一代量子弱磁传感技术，与上述SQUID技术相比，具有小型化、无需液氦、室温检测等优势，这些优势使得OPM可以实现运动状态测量，进而发展为新一代可穿戴式脑磁图仪，可在无创条件下实现高时空分辨率的脑内神经活动检测。可穿戴式脑磁图仪在实现轻便、小型化的同时，尽可能地缩短了传感器与神经活动脑区的距离，从而提高脑磁信号信噪比。目前脑磁头盔有刚性、柔性两类，刚性脑磁头盔通过刚性结构将传感器固定在头皮表面，固定效果好，结合三维光学扫描仪仅需要确定头盔少数基准点后即可实现传感器定位。但刚性头盔的不可调节性使其不具有普适性，临床应用需要为每位被试定制符合其头部轮廓的刚性头部支架。例如“一种脑磁测量头盔的设计和标定方法，202010103345.5”，其方案不足在于：1、刚性脑磁头盔定制时间长、成本高；2、手动进行插槽标号耗时长；3、头盔依据个人头部轮廓订制，普适性差；4、无法准确定位传感器探测磁场中心位置。因而不适用于脑磁临床医学场景。而柔性脑磁头盔虽然可与被试头部高度贴合，且适用不同头型，但每次佩戴头盔后，传感器阵列与人脑的相对位置都会发生变化，这使得传感器阵列空间定位难度大大增加。现有技术存在不足。发明内容本申请的目的在于提供一种柔性脑磁头盔及其传感器阵列空间定位方法，旨在结合三维光学扫描仪和识别系统，对扫描所得三维图像数据进行处理，进而实现传感器阵列空间位置的精准定位，为实现OPM测得被试脑磁信号后对该被试脑区的精准溯源提供有力支撑。一方面，本申请提供了一种柔性脑磁头盔，包括由柔性材质构成的盔帽、固定在所述盔帽外表面，且阵列排布的若干插槽，以及插入所述插槽的传感器；所述插槽的槽体上表面设置有定位点，用于表征插槽的外形；所述插槽的上表面还设置有辅助点，用于引导所述传感器的插入方向；所述插槽设置为底面为矩形的直四棱柱；所述直四棱柱的侧楞的上顶点为所述定位点；所述直四棱柱的上底面的一侧短边上设置有所述辅助点；所述直四棱柱的下底面为所述插槽的槽底。另一方面，本申请还提供了一种应用于上述任意一项所述柔性脑磁头盔的传感器阵列空间定位方法，所述方法包括下述步骤：s1.将插槽的外形信息输入识别系统；s2.设置面部定位标志点和插槽上的定位点和辅助点；s3.三维光学扫描系统对佩戴了柔性脑磁头盔的受试者头面部进行扫描，输出三维图像数据；s4.所述识别系统根据预设色彩阈值筛选出三维图像数据中的面部定位标志点点云、定位点点云和辅助点点云；s5.分别对所述面部定位标志点点云、所述定位点点云和所述辅助点点云进行聚类、计数、平面拟合；最终得到脑磁头盔传感器阵列磁场中心的三维空间分布；所述外形信息包括：所述插槽上定位点的数量、辅助点的数量、所述定位点之间的位置关系，以及所述定位点与所述辅助点之间的位置关系。本申请针通过将插槽的外形信息输入识别系统，同时在插槽上标记易于识别系统采集的定位点和辅助点，使得附着于柔性盔帽上表面的插槽无论如何改变空间位置，其中插入的传感器的空间位置都可以被识别系统计算出来。以传感器中气室中心点为基础的探头磁场方向即可被准确识别，使得脑磁头盔传感器阵列磁场中心的三维空间分布可以快速的基于三维光学扫描而得到。有助于提高脑磁定位的自动化水平和定位精度，同时也节约大量的人工对插槽进行标号和记录位置的时间，为磁源信号与人脑配准、溯源定位提供更精准的位置信息。附图说明图1是本申请实施例一提供的柔性脑磁头盔的佩戴示意图；图2是本申请柔性脑磁头盔中插槽和传感器的结构示意；图3是本申请插槽的外形信息示意图；图4是本申请插槽上表面中心点与传感器的气室中心点的空间关系示意图；图5是本申请识别系统识别后的插槽识别效果示意图；图6是本申请实施例二提供的传感器阵列空间定位方法的主要流程图。具体实施方式为了使本申请的目的、技术方案及优点更加清楚明白，以下结合附图及实施例，对本申请进行进一步详细说明。应当理解，此处所描述的具体实施例仅仅用以解释本申请，并不用于限定本申请。以下结合具体实施例对本申请的具体实现进行详细描述：实施例一：图1至图4示出了本申请实施例一提供的柔性脑磁头盔的结构组成，为了便于说明，仅示出了与本申请实施例相关的部分，详述如下：一方面，如附图1-4所示，本申请提供了一种柔性脑磁头盔，包括由柔性材质构成的盔帽、固定在所述盔帽外表面，且阵列排布的若干插槽，以及插入所述插槽的传感器；所述插槽的槽体上表面设置有定位点，用于表征插槽的外形；所述插槽的上表面还设置有辅助点，用于引导所述传感器的插入方向。如图2-4所示，所述插槽设置为底面为矩形的直四棱柱；所述直四棱柱的侧楞的上顶点为所述定位点；所述直四棱柱的上底面的一侧短边上设置有所述辅助点；所述直四棱柱的下底面为所述插槽的槽底。在优选的其他实施例中，插槽还可以根据不同仪器的探头的外形采用不同的结构，如底面为梯形的直四棱柱、底面为多边形的棱柱或者棱台等，其对应的外形信息只要预先输入识别系统，即可便于从相应的点云中识别出来。如图2、图4所示，所述传感器包括探头和数据线；所述探头的外形与所述插槽匹配设置；所述探头内设置有存放碱金属原子的气室；所述数据线连接在探头与脑磁图仪之间；所述碱金属原子所在的气室不在所述探头的几何中心，所述探头的外壳上会以提示点的方式表示所述碱金属原子所在的气室，离外壳最近的方位。所述传感器插入所述插槽时，按照所述探头外壳的提示点最靠近所述辅助点的形式确定所述传感器的探头插入方向。从而可通过探头和插槽的三维结构以及相关的光学扫描定位点实现磁场探测中心点的精确定位。其中，所述探头采用原子磁力计来实现脑磁信号测量。本申请的柔性脑磁头盔，用已知的插槽外形信息作为标定值，头盔及定位方法通过将插槽的外形信息输入识别系统，同时在插槽上标记易于识别系统采集的定位点和辅助点，使得附着于柔性盔帽上表面的插槽无论如何改变空间位置，其中插入的传感器的空间位置都可以被识别系统计算出来。其中，采用了易于识别系统确认空间位置的插槽来接入相应的传感器，进而通过传感器气室中心点与插槽的几何中心点的位置关系可以准确判断每个传感器的磁场方向，使得脑磁头盔传感器阵列磁场中心的三维空间分布可以快速的基于三维光学扫描而得到。有助于提高脑磁定位的自动化水平和定位精度，同时也节约大量的人工对插槽进行标号和记录位置的时间。实施例二：另一方面，如附图6所示，本申请还提供了一种应用于上述任意一项所述柔性脑磁头盔的传感器阵列空间定位方法，所述方法包括下述步骤：s1.将插槽的外形信息输入识别系统；s2.设置面部定位标志点和插槽上的定位点和辅助点；s3.三维光学扫描系统对佩戴了柔性脑磁头盔的受试者头面部进行扫描，输出三维图像数据；s4.所述识别系统根据预设色彩阈值筛选出三维图像数据中的面部定位标志点点云、定位点点云和辅助点点云；s5.分别对所述面部定位标志点点云、所述定位点点云和所述辅助点点云进行聚类、计数、平面拟合；最终得到脑磁头盔传感器阵列磁场中心的三维空间分布；所述外形信息包括：所述插槽上定位点的数量、辅助点的数量、所述定位点之间的位置关系，以及所述定位点与所述辅助点之间的位置关系。进一步的，所述步骤s2包括以下具体步骤：s21.在受试者鼻根、左耳根和右耳根的皮肤上设置相应的所述面部定位标志点；s22.将所述定位点设置为绿色，所述辅助点设置为红色；有利于所述识别系统对其进行识别和聚类；所述面部定位标志点用于确定所述定位点点云和所述辅助点点云对应受试者的头部位置。进一步的，所述步骤s5包括以下具体步骤：s51.对所述面部定位标志点点云进行识别及聚类。在具体实施时，对受试者的面部定位标志点点云进行K均值聚类得到3个聚类点，即为被试面部定位标志点的具体坐标。可选地，点云聚类也可选择K均值聚类以外的其它聚类方法。在定位了鼻根、耳根上的标志点后，可以为后续与MRI图像配准，进而进行脑区精准溯源提供配准信息。s52.根据所述外形信息对所述定位点点云进行识别、自动计数及聚类，得到所述定位点的数量。在识别系统对定位点点云进行计数后聚类，将此步骤多次迭代，最终可得到定位点个数M以及M个定位点坐标。由于各插槽包含4个定位点，因此M必然被4整除。具体算法介绍如下：将定位点点云中的全部点标记为未访问，设定计数器M=0。从定位点点云中未访问的随机点出发，将该点及其直径2*r内的点标记为访问，计数器M加1。定位点点云剩余未访问的点继续执行步骤、，直至定位点点云全部访问，并得到计数器数值M。将定位点点云进行M类K均值聚类得到M个聚类点及其坐标，并将M个聚类点定义为新的定位点点云。判断计数器数值M是否整除4且本次聚类点数M是否与前次点数M’一致，若M整除4且M、M’一致则定位点点数达到收敛，聚类结束；否则继续执行步骤至。其中，柔性脑磁头盔的定位点点云经识别、自动计数及聚类后，得到M个聚类点及其坐标，即为识别到的最终定位点。将M个定位点显示在原三维图像中，各定位点均显示在插槽顶点的中心位置，定位点定位效果良好。因本实施例选用插槽定位点个数是插槽数量的4倍，所以插槽数量N=M/4。本实施例中，过程采用K均值聚类方法，其优点：是解决聚类问题的一种经典算法，简单、快速，对处理大数据集，该算法保持可伸缩性和高效性；缺点：该算法需要不断地进行样本分类调整，不断地计算调整后的新聚类中心，因此当数据量非常大时，算法的时间开销也大。可选地，点云聚类方法也可选择的其它聚类方法。其他聚类方法——层次聚类：优点：聚类速度快，只需要一遍扫描训练集就可以建立CF Tree，CF Tree的增删改都很快，可以识别噪音点，对数据集进行初步分类的预处理；缺点：由于CF Tree对每个节点的CF个数有限制，导致聚类的结果可能和真实的类别分布不同。其他聚类方法——谱聚类算法：优点： 当聚类的类别个数较小的时候，谱聚类的效果好，具有能在任意形状的样本空间上聚类且收敛于全局最优解；缺点：谱聚类更适用于均衡分类问题，若簇之间点个数相差悬殊的聚类问题，谱聚类则不适用。其他聚类方法——DBSCAN算法：优点：可以对任意形状的稠密数据集进行聚类， 对数据集中的异常点不敏感；缺点： 样本集的密度不均匀、聚类间距差相差很大时，聚类质量较差， 样本集较大时，聚类收敛时间较长。点云聚类算法还有很多，在此不一一例举，各类算法均有其优缺点，可根据数据特点选择合适的聚类方法。s53.根据所述定位点的数量对所述插槽进行聚类，得到所述插槽的数量、编号和对应的三维坐标。在步骤s42识别到全部定位点的基础上，需要对全部定位点进行二次聚类，即实现精准探寻全部插槽——每4个定位点复原一个插槽。本申请柔性脑磁头盔插槽自动聚类的实现是利用栈算法及递归算法，具体介绍如下：将步骤2.2最终获得的M个定位点全部标记为未访问，并设定初始计数器Counter=0；随机选择定位点点云中未访问过的某个定位点；依据插槽实际尺寸——如图3所示的插槽短边、长边和对角线的实际长度；在边长误差范围内，从定位点点云中寻找可组成插槽的其余定位点；若成功寻找到插槽其余定位点，将该插槽包含的定位点标记为访问，计数器Counter加一，将该插槽标记为第‘Counter’号，该插槽入栈，递归调用步骤、、、判断是否可以找到剩余插槽；若无法找到剩余插槽，则当前插槽定位点组合有误，该插槽包含的定位点重新标记为未访问，插槽出栈，计数器Counter减一，排除此次定位点组合，递归调用步骤、、。通过上述步骤可以基于计算机程序来实现从定位点点云中复原出全部插槽并自动对各插槽编号，此方法复用性优异。s54.根据所述外形信息对所述辅助点点云进行识别、聚类及归类。在具体实施时，因辅助点个数与插槽数量一致，所以辅助点个数为N。对辅助点点云进行N类K均值聚类得到N个聚类点及其坐标，即为N个辅助点具体坐标。可选地，点云聚类方法也可选择K均值聚类以外的其它聚类方法。各插槽依次遍历N个辅助点，将最贴近插槽短边的辅助点归类为本插槽辅助点。最贴近插槽短边即：首先确定两条插槽短边分别对应的两个定位点，其次计算辅助点到两个定位点的距离之和，然后将距离和减去插槽短边实际长度得到距离差绝对值，最后将最小距离差绝对值对应的辅助点归类于该插槽。s55.根据所述插槽中定位点的三维坐标计算所述插槽的法向量。由步骤s43可获得各插槽定位点坐标信息，各插槽定位点所在平面即为插槽上表面，所在平面由定位点经过最小二乘拟合生成，可求得该拟合平面截距式方程为，其中a，b，c依次为该平面在x，y，z轴上的截距。令A=bc，B=ac，C=ab，D=-abc，可求得该平面一般式方程为Ax+By+Cz+D=0，及其法向量α=，α即为插槽法向量。通过上述步骤，实现仅需插槽上表面相关参数即可得出插槽法向量，无需引入插槽下表面相关参数。为使得下述s46中偏移单位向量的计算更加精准，需对定位点进一步校正，具体方法为：计算定位点P1、P2、P3、P4到拟合平面Ax+By+Cz+D=0的投影点、/＞、/＞和/＞。此步骤实现了基于全部定位点对单个定位点的点校正，使得校正后的定位点均位于拟合平面上。此步骤可减少个别定位点的坐标误差，增强此定位系统的鲁棒性，使得下述s46中偏移单位向量的计算更加精准。得到各插槽修正后的四个定位点、/＞、/＞和/＞后，可计算各插槽表面中心点/＞，各插槽识别效果图、插槽编号效果图及插槽法向量效果图如图5所示。可选地，各插槽平面拟合可选择除最小二乘法以外的其他拟合方式。s56.根据所述插槽的法向量和辅助点与碱金属原子所在的气室的位置关系，计算所述传感器的气室中心点。具体实施时，因传感器以图2所示方式安装在插槽中，因此步骤s45得出的插槽法向量α也是置入该插槽传感器的法向量。由于探头的探测磁场中心位置不在中心区，因此还要计算出偏离单位向量才能最终求得传感器的气室中心点。偏离单位向量计算步骤：由上述步骤s45得到插槽辅助点所在短边的两个修正后定位点、/＞；求得定位点、/＞的定位中点/＞；由上述步骤s45得到插槽表面中心点Q；偏离单位向量，。依据探头和插槽的三维结构、尺寸关系，可以精确测量出探测磁场中心相对于插槽表面中心点Q，在插槽法向量α方向或其反方向上的法向量偏离距离l，以及在偏离单位向量β方向上的方位偏离距离h。探头与插槽组合安装后，若探测磁场中心处于插槽上下表面之间，则实际法向量偏离距离l’=-l；否则，实际法向量偏离距离l’=l。则传感器气室中心点，全部插槽经此方法计算后，即可得到传感器阵列气室中心点，完成传感器阵列快速空间定位。进一步的，如图5所示，所述步骤s4还包括以下具体步骤：s57.将所述传感器的气室中心点与所述三维图像数据拟合，最终得到脑磁头盔传感器阵列磁场中心的三维空间分布。进一步的，所述步骤s21中，所述面部定位标志点为蓝色贴纸。进一步的，所述面部定位标志点根据受试者的鼻根、左耳根和右耳根的位置构建对应的三维坐标关系。综上所述，本申请提出的柔性脑磁头盔及其传感器阵列空间定位方法，基于受试者佩戴了柔性脑磁头盔后的三维图像数据和插槽的外形信息，对三维图像数据中的点云进行识别、聚类和归类。实现柔性头盔中传感器阵列气室中心点的实时精确计算，更有利于后续脑神经活动区域的精准溯源。本申请的有益效果：本申请提出的快速定位方法，特别适用于柔性可穿戴的脑磁头盔形式，柔性可穿戴脑磁头盔与刚性头盔相比，适用人群广泛，可复用，舒适性高，本申请提出的快速定位方法，可进一步提高脑磁定位的自动化水平和定位精度，节约大量的检查时间，因此对临床场景非常友好。脑磁头盔自动识别和定位方法，包括脑磁头盔定位点自动计数及聚类算法，脑磁头盔插槽自动聚类算法。本申请利用各插槽定位点进行平面拟合，得到传感器阵列法向量与其他专利计算法向量的技术构思有着显著不同。本申请可实现传感器阵列气室中心点的精确计算，更有利于后续脑神经活动区域的精准溯源。以上所述仅为本申请的较佳实施例而已，并不用以限制本申请，凡在本申请的精神和原则之内所作的任何修改、等同替换和改进等，均应包含在本申请的保护范围之内。
