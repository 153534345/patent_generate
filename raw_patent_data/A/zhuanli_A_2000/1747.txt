标题title
一种基于能控器状态的神经刺激器控制方法及装置
摘要abst
本申请实施例公开了一种基于能控器状态的神经刺激器控制方法及装置，其中，方法包括：在预设时长内，获取所述射频天线发出射频信号时的第一电压，以及射频天线接收射频信号时的第二电压，获取目标温度；根据所述第一电压和所述第二电压，计算回波损耗值；根据所述目标温度，和/或，所述回波损耗值，调整所述神经刺激器的工作模式，生成所述工作模式对应的刺激指令，并将所述刺激指令发送至所述神经刺激器，以使所述神经刺激器根据所述刺激指令向所述患者的治疗部位输出刺激电流，所述工作模式为主动平衡模式或被动平衡模式。采用本申请实施例，可以根据能控器状态及时调节刺激器的工作模式，从而提高患者的治疗效果。
权利要求书clms
1.一种基于能控器状态的神经刺激器控制方法，其特征在于，应用于置于患者体外的能控器，所述能控器与置于患者体内的神经刺激器连接，所述能控器通过射频天线向所述神经刺激器提供射频电能，所述基于能控器状态的神经刺激器控制方法包括：在预设时长内，获取所述射频天线发出射频信号时的第一电压，以及射频天线接收射频信号时的第二电压，获取目标温度；根据所述第一电压和所述第二电压，计算回波损耗值；根据所述目标温度，和/或，所述回波损耗值，调整所述神经刺激器的工作模式，生成所述工作模式对应的刺激指令，并将所述刺激指令发送至所述神经刺激器，以使所述神经刺激器根据所述刺激指令向所述患者的治疗部位输出刺激电流，所述工作模式为主动平衡模式或被动平衡模式。2.根据权利要求1所述的基于能控器状态的神经刺激器控制方法，其特征在于，所述目标温度包括所述能控器的外部温度和内部温度，所述根据所述目标温度，调整所述神经刺激器的工作模式，包括：判断所述内部温度是否大于第一内部温度阈值，以及判断所述外部温度是否大于第一外部温度阈值；若所述内部温度大于所述第一内部温度阈值，则调整所述神经刺激器的工作模式为被动平衡模式；若所述外部温度大于所述第一外部温度阈值，且，若所述内部温度小于或等于所述第一内部温度阈值，且，所述内部温度大于第二内部温度阈值，则计算所述内部温度与所述外部温度之差，得到目标温差，并根据所述目标温差，调整所述神经刺激器的工作模式，所述第二内部温度阈值小于所述第一内部温度阈值。3.根据权利要求2所述的基于能控器状态的神经刺激器控制方法，其特征在于，所述根据所述目标温差，调整所述神经刺激器的工作模式，包括：判断所述目标温差是否大于温差阈值；若所述目标温差大于所述温差阈值，则根据所述目标温差，增大所述射频天线的输出功率；若所述目标温差小于或等于所述温差阈值，则调整所述神经刺激器的工作模式为被动平衡模式。4.根据权利要求1所述的基于能控器状态的神经刺激器控制方法，其特征在于，所述根据所述回波损耗值，调整所述神经刺激器的工作模式，包括：判断所述回波损耗值是否大于预设损耗值；若所述回波损耗值大于所述预设损耗值，则调整所述神经刺激器的工作模式为被动平衡模式。5.根据权利要求1所述的基于能控器状态的神经刺激器控制方法，其特征在于，所述根据所述第一电压和所述第二电压，计算回波损耗值，包括：将所述第一电压和所述第二电压代入第一预设公式，得到回波损耗值；其中，所述第一预设公式为：式中，Loss表示回波损耗值，A表示预设系数，V1表示第一电压，V2表示第二电压。6.根据权利要求1所述的基于能控器状态的神经刺激器控制方法，其特征在于，所述方法还包括：获取当前的剩余电量，以及电量消耗速率；根据所述剩余电量、所述电量消耗速率、所述目标温度以及所述回波损耗值，调整所述神经刺激器的工作模式。7.根据权利要求6所述的基于能控器状态的神经刺激器控制方法，其特征在于，所述根据所述剩余电量、所述电量消耗速率、所述目标温度以及所述回波损耗值，调整所述神经刺激器的工作模式，包括：将所述所述剩余电量、所述电量消耗速率、所述目标温度以及所述回波损耗值代入第二预设公式，得到目标状态值，所述目标温度包括外部温度和内部温度；若所述目标状态值大于预设状态值，则调整所述神经刺激器的工作模式为被动平衡模式；其中，所述第二预设公式为：式中，W1表示第一权重，W2表示第二权重，W3表示第三权重，P1表示剩余电量，P2表示电量消耗速率，Loss表示回波损耗值，T1表示外部温度，T2表示内部温度，T3表示预设工作温度。8.一种基于能控器状态的神经刺激器控制装置，其特征在于，所述装置包括：电压温度获取模块，用于在预设时长内，获取所述射频天线发出射频信号时的第一电压，以及射频天线接收射频信号时的第二电压，获取目标温度；回波损耗值计算模块，用于根据所述第一电压和所述第二电压，计算回波损耗值；工作模式调整模块，用于根据所述目标温度，和/或，所述回波损耗值，调整所述神经刺激器的工作模式，生成所述工作模式对应的刺激指令，并将所述刺激指令发送至所述神经刺激器，以使所述神经刺激器根据所述刺激指令向所述患者的治疗部位输出刺激电流，所述工作模式为主动平衡模式或被动平衡模式。9.一种能控器，其特征在于，包括处理器、存储器、用户接口及网络接口，所述存储器用于存储指令，所述用户接口和网络接口用于给其他设备通信，所述处理器用于执行所述存储器中存储的指令，以使所述能控器执行如权利要求1-7任意一项所述的方法。10.一种计算机可读存储介质，其特征在于，所述计算机可读存储介质存储有指令，当所述指令被执行时，执行如权利要求1-7任意一项所述的方法。
说明书desc
技术领域本申请涉及医疗设备技术领域，具体涉及一种基于能控器状态的神经刺激器控制方法及装置。背景技术目前，植入式神经刺激系统主要包括置于体内的神经刺激器和置于体外的能控器。能控器与神经刺激器之间可以进行射频通讯和能量传输，能控器向神经刺激器提供射频电能。在此基础上，能控器实时提供刺激脉冲指令来驱动神经刺激器的刺激电极，从而神经刺激器向患者的治疗部位施加刺激电流。在神经刺激器输出刺激电流的过程中，可根据输出方式将神经刺激器的工作模式划分为主动平衡模式和被动平衡模式，处于主动平衡模式下的神经刺激器相比于被动平衡模式，输出刺激电流的频率更高，对患者的刺激感较小。因此，为了有较好的治疗效果，通常采用主动平衡模式进行工作。能控器向神经刺激器提供的射频信号越强，可以为神经刺激器提供的能量就越多。但是，在实际应用中，存在一些因素可能影响射频信号的传输效率。例如，如果能控器的射频天线未能对准刺激器的射频天线，会导致射频信号在传输过程中回波损耗较大。其次，当温度过高时，射频功放的效率会降低。上述因素都可能导致无法持续为神经刺激器提供足够的能量。若神经刺激器此时处于主动平衡模式下，则可能导致其得不到能量的支持，影响患者的治疗效果。发明内容本申请提供了一种基于能控器状态的神经刺激器控制方法及装置，可以根据能控器状态及时调节刺激器的工作模式，从而提高患者的治疗效果。在本申请的第一方面，本申请提供了一种基于能控器状态的神经刺激器控制方法，应用于置于患者体外的能控器，能控器与置于患者体内的神经刺激器连接，能控器通过射频天线向神经刺激器提供射频电能，基于能控器状态的神经刺激器控制方法包括：在预设时长内，获取射频天线发出射频信号时的第一电压，以及射频天线接收射频信号时的第二电压，获取目标温度；根据第一电压和第二电压，计算回波损耗值；根据目标温度，和/或，回波损耗值，调整神经刺激器的工作模式，生成工作模式对应的刺激指令，并将刺激指令发送至神经刺激器，以使神经刺激器根据刺激指令向患者的治疗部位输出刺激电流，工作模式为主动平衡模式或被动平衡模式。通过采用上述技术方案，在预设时长内获取发射电压、接收电压和目标温度，可以计算出发射信号到接收端的平均化、稳定的回波损耗值，避免瞬时误判，回波损耗值可以评估射频信号的传输效率和系统稳定性。与此同时，监测目标温度，因为温度过高会降低功率放大效率。根据回波损耗值和目标温度这两个关键参数，可以判断系统的能量传输和供给是否出现问题。如果回波损耗过大表示植入式神经刺激器端能量不足；如果温度过高表示功率放大效率下降，也会导致能量不足。进而在能控器状况不佳时，调整为刺激频率较低、能量消耗较小的被动平衡模式；在系统能量充足时，选择相对更高频率的主动平衡模式。并相应生成刺激指令发送给植入式神经刺激器。整个系统可以根据温度和信号传输质量，实时评估并适应能控器状况，在保证治疗效果的前提下，提高系统稳定性，避免治疗中断。可选的，判断内部温度是否大于第一内部温度阈值，以及判断外部温度是否大于第一外部温度阈值；若内部温度大于第一内部温度阈值，则调整神经刺激器的工作模式为被动平衡模式；若外部温度大于第一外部温度阈值，且，若内部温度小于或等于第一内部温度阈值，且，内部温度大于第二内部温度阈值，则计算内部温度与外部温度之差，得到目标温差，并根据目标温差，调整神经刺激器的工作模式，第二内部温度阈值小于第一内部温度阈值。通过采用上述技术方案，在外部温度较高而内部温度介于两个阈值之间的情况下，计算内外温差作为目标温差。因为当外部温度升高时，内部温度越低，说明功率放大效率受外部温度的影响越小。此时根据温差的大小，可以选择相应频率更高的刺激模式。最后，温差大于阈值时，效率影响较小，可以选择主动平衡模式；温差越小，效率影响越大，应选择被动平衡模式。从而实现根据内外温度的实时监测，灵活调整刺激模式，在保证治疗效果的前提下，提高系统稳定性和刺激效果。可选的，判断目标温差是否大于温差阈值；若目标温差大于温差阈值，则根据目标温差，增大射频天线的输出功率；若目标温差小于或等于温差阈值，则调整神经刺激器的工作模式为被动平衡模式。通过采用上述技术方案，当目标温差较大时，表示内外温差异较大，功率放大器件效率受外部温度影响较小。此时可以适当提高射频天线的输出功率，为神经刺激器提供更高的工作能量，以保证其在主动平衡模式下能获得更稳定的能量供给。当目标温差较小时，调整为被动平衡模式，以降低能量需求，确保在功率放大效率较低的情况下仍能保证刺激器的正常工作。可选的，根据回波损耗值，调整神经刺激器的工作模式，包括：判断回波损耗值是否大于预设损耗值；若回波损耗值大于预设损耗值，则调整神经刺激器的工作模式为被动平衡模式。通过采用上述技术方案，判断回波损耗值是否超过预设损耗阈值，因为回波损耗值可以反映射频信号从发射到接收端的损耗程度。回波损耗越大，表示信号传输效率越低，植入式神经刺激器端接收到的能量也就越少。当回波损耗超过阈值时，表示神经刺激器端的能量不足以保证当前的工作模式。此时将神经刺激器的工作模式调整为被动平衡模式，该模式下刺激频率较低，能量消耗也较小，可以确保在能量受限的条件下维持刺激输出。可选的，将第一电压和第二电压代入第一预设公式，得到回波损耗值；其中，第一预设公式为：式中，Loss表示回波损耗值，A表示预设系数，V1表示第一电压，V2表示第二电压。通过采用上述技术方案，通过预设公式可以获得回波损耗值，该值越大，表示信号在传输过程中的损耗越严重，传输效率越低。持续计算回波损耗值，可以动态监测系统的工作状态。回波损耗值增加会直接导致植入式神经刺激器端的能量获取不足。因此，计算回波损耗值，可以评估当前的信号传输质量和对刺激器的供能充足性。可选的，方法还包括：获取当前的剩余电量，以及电量消耗速率；根据剩余电量、电量消耗速率、目标温度以及回波损耗值，调整神经刺激器的工作模式。通过采用上述技术方案，获取当前的剩余电量和电量消耗速率，因为这两个参数可以反映出能量控制器自身的能量状态，是评估其能为神经刺激器持续供能的重要依据。将这两个参数与目标温度和回波损耗值一同考虑，可以更全面地判断系统的能量状态。温度和回波损耗反映了能量传输过程中的效率，剩余电量和消耗速率反映了能控器本身的状况。可选的，根据剩余电量、电量消耗速率、目标温度以及回波损耗值，调整神经刺激器的工作模式，包括：将剩余电量、电量消耗速率、目标温度以及回波损耗值代入第二预设公式，得到目标状态值，目标温度包括外部温度和内部温度；若目标状态值大于预设状态值，则调整神经刺激器的工作模式为被动平衡模式；其中，第二预设公式为：式中，W1表示第一权重，W2表示第二权重，W3表示第三权重，P1表示剩余电量，P2表示电量消耗速率，Loss表示回波损耗值，T1表示外部温度，T2表示内部温度，T3表示预设工作温度。通过采用上述技术方案，建立状态评估公式，实时监测多个因素，判断系统能量状况，实现对刺激模式的主动调节。在确保治疗效果的同时，尽可能延长设备工作时间，提高系统稳定性。相比单一因素判断，该方案进行综合评估并设置阈值，可以更精确地反映系统能量状况，及时调整刺激模式参数，在保证治疗效果的前提下，最大程度地提高系统可靠性。在本申请的第二方面提供了一种基于能控器状态的神经刺激器控制装置，其特征在于，所述装置包括：在本申请的第三方面提供了一种计算机存储介质，所述计算机存储介质存储有多条指令，所述指令适于由处理器加载并执行上述的方法步骤。在本申请的第四方面提供了一种能控器，包括：处理器、存储器；其中，所述存储器存储有计算机程序，所述计算机程序适于由所述处理器加载并执行上述的方法步骤。综上所述，本申请实施例中提供的一个或多个技术方案，至少具有如下技术效果或优点：通过采用本申请技术方案，在预设时长内获取发射电压、接收电压和目标温度，可以计算出发射信号到接收端的平均化、稳定的回波损耗值，避免瞬时误判，回波损耗值可以评估射频信号的传输效率和系统稳定性。与此同时，监测目标温度，因为温度过高会降低功率放大效率。根据回波损耗值和目标温度这两个关键参数，可以判断系统的能量传输和供给是否出现问题。如果回波损耗过大表示植入式神经刺激器端能量不足；如果温度过高表示功率放大效率下降，也会导致能量不足。进而在能控器状况不佳时，调整为刺激频率较低、能量消耗较小的被动平衡模式；在系统能量充足时，选择相对更高频率的主动平衡模式。并相应生成刺激指令发送给植入式神经刺激器。整个系统可以根据温度和信号传输质量，实时评估并适应能控器状况，在保证治疗效果的前提下，提高系统稳定性，避免治疗中断。附图说明图1是本申请实施例提供的神经刺激系统的应用场景示意图；图2是本申请实施例提供的一种神经刺激系统架构图；图3是本申请实施例提供的一种基于能控器状态的神经刺激器控制方法的流程示意图；图4是本申请实施例提供的一种神经刺激器的组合模式调节装置的架构图；图5是本申请实施例的公开的一种能控器的结构示意图。附图标记说明：500、能控器；501、处理器；502、存储器；503、用户接口；504、网络接口；505、通信总线。具体实施方式为了使本领域的技术人员更好地理解本说明书中的技术方案，下面将结合本说明书实施例中的附图，对本说明书实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅是本申请一部分实施例，而不是全部的实施例。在本申请实施例的描述中，“例如”或者“举例来说”等词用于表示作例子、例证或说明。本申请实施例中被描述为“例如”或者“举例来说”的任何实施例或设计方案不应被解释为比其他实施例或设计方案更优选或更具优势。确切而言，使用“例如”或者“举例来说”等词旨在以具体方式呈现相关概念。在本申请实施例的描述中，术语“多个”的含义是指两个或两个以上。例如，多个系统是指两个或两个以上的系统，多个屏幕终端是指两个或两个以上的屏幕终端。此外，术语“第一”、“第二”仅用于描述目的，而不能理解为指示或暗示相对重要性或者隐含指明所指示的技术特征。由此，限定有“第一”、“第二”的特征可以明示或者隐含地包括一个或者更多个该特征。术语“包括”、“包含”、“具有”及它们的变形都意味着“包括但不限于”，除非是以其他方式另外特别强调。随着人口老龄化和生活方式的改变，神经系统发病率不断增加，如帕金森病、癫痫、抑郁症、焦虑症等，这些疾病对患者的身心健康和生活质量造成极大影响。而传统的治疗方法存在一定的局限性，如药物治疗、手术治疗等，存在副作用大、效果不稳定、难以控制等情况。因此，需要新的治疗方法来改善患者的症状和生活质量。随着生物医学工程和神经科学等领域的发展，植入式医疗系统不断得到改进和创新，治疗效果和安全性得到了不断提高，成为了治疗神经系统疾病的一种重要手段，植入式电刺激技术作为一种新型的治疗手段，具有广泛的应用前景和重要的临床意义。植入式医疗系统通常包括：植入式神经电刺激系统，植入式脑皮层电刺激系统，植入式脊髓电刺激系统，植入式骶神经电刺激系统、植入式迷走神经电刺激系统以及植入式心脏电刺激系统等，神经刺激器作为上述电刺激系统的核心成分，起着至关重要的作用。在此基础上，本申请实施例提供了一种基于能控器状态的神经刺激器控制方法，请参照图1，其示出了本申请一个实施例提供的神经刺激系统的应用场景示意图，如该神经刺激系统可以包括神经刺激器、能控器、终端以及服务器，神经刺激器通过蓝牙模块与能控器进行无线连接，能控器通过射频天线为神经刺激器输出射频能量，以为其提供工作时的电能，此外能控器还内设有通讯模块，可通过有线或无线网络与终端以及服务器直接或间接地连接。示例性地，如图1所示，神经刺激器置于患者体内的A部位，神经刺激器内设有刺激电极，刺激电极通过导线输出刺激电流至a治疗部位、b治疗部位以及c治疗部位进行电刺激治疗。示例性地，终端可以是安装有神经刺激类目标应用程序的能控器，通常为医生和患者所使用。医生和患者可通过终端控制能控器，从而间接控制神经刺激器的工作，也可以获取能控器采集神经刺激器的实时运行数据，并可视化展示于医生或患者。该终端包括但不限于：安卓系统设备、苹果公司开发的移动操作系统设备、个人计算机、全球局域网设备以及智能穿戴设备等。示例性地，服务器可以是上述神经刺激类目标应用程序的后台服务器，用于为上述能控器和终端提供后台服务。服务器可以接收并存储神经刺激器与能控器在治疗过程中的各方面数据，从而可对患者的病情进行汇总和分析。服务器可以是一台服务器，也可以是由多台服务器组成的服务器集群，或者是一个云计算服务中心，服务器可以通过有线或无线网络与能控器以及终端进行通信。需要说明的是，图1介绍神经刺激器在人体的植入位置，以及其中各个治疗部位的举例的方式仅是示例性地，在可能的实施方式中，神经刺激器具体植入人体的位置，以及刺激电极输出刺激电流对应的治疗位置，需要根据神经刺激器的具体类型以及患者的病情确定。上述实施例对本申请实施例提供的神经刺激系统的应用场景做了相应的介绍，为了使本领域的技术人员更好地理解本申请实施例提供的神经刺激方法的原理，下面对神经刺激器之间的信息传递过程进行说明，请参照图2，图2示出了本申请实施例提供的一种神经刺激系统架构图。如图2所示，能控器中包括第一处理器、加速度计以及陀螺仪。当能控器佩戴在患者身上时，加速度计和陀螺仪用于实时采集用户的活动状态数据，并传输至第一处理器。第一处理器用于根据采集到的活动状态数据，确定患者所处的姿。神经刺激器中的第二处理器，主要用于接收能控器输入的控制指令，并将控制指令转换为对应的参数，并该参数控制刺激电极输出刺激电流。其中，神经刺激器和能控器两者之间的信息交互主要是通过蓝牙模块实现，神经刺激器中的第二处理器通过第一蓝牙模块接收能控器通过第二蓝牙模块发送的刺激指令，第二处理器可通过自带的模数转换器将刺激指令从模拟量转换为数字量，从而对刺激脉冲指令进行数据处理分析，生成刺激波形，并通过自带的数模转换电路将刺激波形从数字电压信号转换为模拟电压信号。当刺激指令为电压参数时，第二处理器将该模拟电压信号输出至比例放大电路，以对其进行电压参数的调整，得到电压刺激波形，并输出至电极控制电路；当刺激指令为电流参数时，第二处理器将该模拟电压信号转换为模拟电流信号，得到电流刺激波形，并输出至电极控制电路。电极控制电路可根据刺激波形配置刺激电极的开关状态以及电极方向，从而控制刺激电极对治疗部位输出刺激电流。进一步地，神经刺激器还设置有检测模块，检测模块可获取刺激电极的运行参数，并将运行参数以第二处理器—第一蓝牙模块—第二蓝牙模块—第一处理器之间的传输路径传输至能控器，能控器可通过外部通讯模块将运行参数传输至终端和/或服务器，进而可通过能控器将神经刺激器的运行信息反馈至终端与服务器。此外，本申请实施例提供的神经刺激系统中的神经刺激器不需要额外安装电池供电，只需要能控器向其输出射频信号，便可满足神经刺激器的工作电能，从而进一步减小神经刺激器的体积。具体的，能控器通过第二射频天线向神经刺激器中的第一射频天线发送射频信号，第一射频天线将接收到的射频信号输入至阻抗匹配电路。阻抗匹配电路用于调整电路中的阻抗，使得射频信号和电路之间的阻抗相匹配，从而降低信号在传输过程中由于信号反射造成的能量损失，进而提高信号传输的效率和质量。射频信号经过阻抗匹配电路后，输入至整流储能电路。整流储能电路用于将射频信号转换为电能并储存，以持续为第二处理器提供电能。上述对本申请实施例提供的神经刺激系统的架构，以及该架构下各端的运行原理进行了说明，在上述实施例的基础上，进一步地，请参考图3，特提出了一种基于能控器状态的神经刺激器控制方法的流程示意图，该方法可依赖于计算机程序实现，可依赖于单片机实现，也可运行于神经刺激系统上，该计算机程序可集成在上述神经刺激器、能控器、终端以及服务器的目标应用程序中，也可作为独立的工具类应用运行，具体的，该方法包括步骤301至步骤303，上述步骤如下：步骤301：在预设时长内，获取射频天线发出射频信号时的第一电压，以及射频天线接收射频信号时的第二电压，获取目标温度。其中，将能控器射频天线发出射频信号过程中的发射电压定义为第一电压，将该射频天线接收射频信号过程中接收电压定义为第二电压。第一电压和第二电压的比值可以反映射频天线的回波损耗。具体的，在能控器通过控制射频天线收发射频信号过程中，第一电压、第二电压以及能控器自身的目标温度都会存在一定的波动，通过设置预设时长可以获取到这些参数在一段时间的平均稳定值，避免瞬时波形带来的误判。步骤302：根据第一电压和第二电压，计算回波损耗值。具体的，可将第一电压和第二电压代入第一预设公式，得到回波损耗值。计算回波损耗值的目的在于评估射频信号从发射到接收过程中的传输效率，判断目前为植入式神经刺激器提供的能量是否充足和稳定，以及检测系统在运行过程中是否存在问题。具体的，回波损耗值越大，表示射频信号在传播过程中的损耗越严重，传输效率越低。回波损耗值越高直接导致刺激器端接收到的能量越少。因此计算回波损耗值可以评估当前的信号传输质量以及对刺激器供能的充足性。另外，通过比较发射信号第一电压和接收信号第二电压的变化，可以得到信号从发射到接收端的衰减程度，反映信号在传输过程中的损失。持续动态计算回波损耗值可以实时监测系统工作状态，一旦回波损耗值过大可以及时发现天线匹配问题等故障。其中，第一预设公式为：式中，Loss表示回波损耗值，A表示预设系数，V1表示第一电压，V2表示第二电压。步骤303：根据目标温度，和/或，回波损耗值，调整神经刺激器的工作模式，生成工作模式对应的刺激指令，并将刺激指令发送至神经刺激器，以使神经刺激器根据刺激指令向患者的治疗部位输出刺激电流，工作模式为主动平衡模式或被动平衡模式。其中，在神经刺激器输出刺激电流的过程中，主要由能控器向神经刺激器发送刺激指令。神经刺激器中的第二处理器可读取该刺激指令中的刺激参数，从而根据刺激参数生成刺激波形，进而可通过控制刺激电极根据该刺激波形向患者的治疗部位输出刺激电流。能控器可每间隔一段时间就获取当前的剩余电量，以及患者的剩余治疗时长，从而根据剩余治疗时长调节控制器输出刺激电流的工作模式。具体的，从刺激波形形状的角度考虑，刺激波形主要由前向波形和后向波形组成，其中，前向波形指的是神经电刺激治疗中，用于产生治疗效果的电信号波形，由于在该过程中会释放电荷，因此需要输出与前向波形相反的后向波形进行电荷中和，从而达到患者体内的电荷平衡。其中，构成刺激波形形状的主要有波形幅度和波形脉宽两个参数，波形幅度指的是刺激电极输出刺激电流的大小，波形脉宽指的是输出刺激电流的时间宽度。在本申请实施例中，将前向波形的参数分别定义为前向波形幅度与前向波形脉宽；对应的，将后向波形的参数分别定义为后向波形幅度与后向波形脉宽。假设一个刺激波形只由一个前向波形和一个后向波形构成，则该刺激波形的刺激周期为前向波形脉宽与后向波形脉宽之和。由于后向波形需要中和前向波形释放的电荷，则可以推断出前向波形脉宽*前向波形幅度＝后向波形脉宽*后向波形幅度。进一步地，通过改变前向波形脉宽和后向波形脉宽，即可改变神经刺激器输出刺激电流的频率，在本申请实施例中根据神经刺激器输出刺激电流的频率，可将神经刺激器的工作模式划分为主动平衡模式和被动平衡模式。在神经刺激器处于主动平衡模式下，其输出刺激电流的频率是可控的，即可通过调整后向波形的后向波形脉宽和后向波形幅度，以中和前向波形产生的电荷；在神经刺激器处于被动平衡模式下，可控制刺激电极组内的电极以电极短接的方式，使得前向波形产生的电荷自动消除。因此，处于被动平衡模式下的神经刺激器输出刺激电流的频率较低且不可控。进一步地，在实际应用中，如果能控器的射频天线未能对准刺激器的射频天线，会导致射频信号在传输过程中回波损耗较大。其次，当温度过高时，射频功放的效率会降低。上述因素都可能导致无法持续为神经刺激器提供足够的能量。若神经刺激器此时处于主动平衡模式下，则可能导致其得不到能量的支持，影响患者的治疗效果。因此，可根据目标温度，和/或，回波损耗值，调整神经刺激器的工作模式。在上述实施例的基础上，作为一种可选的实施例，步骤303中：根据目标温度，和/或，回波损耗值，调整神经刺激器的工作模式这一步骤，还可以包括以下步骤：步骤401：判断内部温度是否大于第一内部温度阈值，以及判断外部温度是否大于第一外部温度阈值。具体的，温度过高会降低射频功率放大器件的效率，从而影响对植入体内的神经刺激器的能量传输。因此需要监测温度参数，以根据温度状况选择合适的神经刺激器工作模式。步骤402：若内部温度大于第一内部温度阈值，则调整神经刺激器的工作模式为被动平衡模式。具体的，内部温度过高会导致功率放大效率下降，无法为神经刺激器持续提供足够的能量。而被动平衡模式下的刺激频率较低，能量需求也较小，因此可以保证在能量不足的情况下仍能维持神经刺激器的刺激输出，避免治疗中断。步骤403：若外部温度大于第一外部温度阈值，且，若内部温度小于或等于第一内部温度阈值，且，内部温度大于第二内部温度阈值，则计算内部温度与外部温度之差，得到目标温差，并根据目标温差，调整神经刺激器的工作模式，第二内部温度阈值小于第一内部温度阈值。具体的，在外部温度高于第一外部温度阈值的前提下，内部温度介于第一内部温度阈值与第二内部温度阈值之间时，计算内外温度差作为目标温差，并根据目标温差调整神经刺激器的工作模式。进行该步骤的目的在于，当外部温度过高而内部温度尚可时，通过调整工作模式可以提高系统的适应能力，在一定程度上补偿外部温度升高带来的不利影响，保证对神经刺激器的稳定供能。内外温差越大，功率放大效率受外部温度的影响就越小，可选择相对更高频率的刺激模式。可以根据温度状况，灵活选择刺激模式，在保证治疗效果的前提下，尽可能提高系统的稳定性。在上述实施例的基础上，作为一种可选的实施例，步骤403中：根据目标温差，调整神经刺激器的工作模式这一步骤，还可以包括以下步骤：步骤501：判断目标温差是否大于温差阈值。步骤502：若目标温差大于温差阈值，则根据目标温差，增大射频天线的输出功率。具体的，目标温差越大，表示内外温度差异越大，功率放大器件受外部温度影响越小。此时可适当提高天线输出功率，为神经刺激器提供更多能量，从而保证神经刺激器处于较高刺激频率的主动平衡模式时仍能获得稳定供能。步骤503：若目标温差小于或等于温差阈值，则调整神经刺激器的工作模式为被动平衡模式。具体的，当目标温差较小时，内外温度接近，功率放大器件易受外部温度影响。在外部温度较高的情况下，能控器的射频功放电路受到影响，无法为神经刺激器提供较高功率。此时将工作模式调整为被动平衡模式，可以减少能量需求，保证刺激器的正常工作。在上述实施例的基础上，作为另一种可选的实施例，步骤303中：根据回波损耗值，调整神经刺激器的工作模式的这一步骤，具体还可以包括以下步骤：步骤601：判断回波损耗值是否大于预设损耗值；步骤602：若回波损耗值大于预设损耗值，则调整神经刺激器的工作模式为被动平衡模式。具体的，若回波损耗值大于预设损耗值，则将神经刺激器的工作模式调整为被动平衡模式。进行该步骤的目的在于，回波损耗过大导致神经刺激器端能量不足时，将工作模式调整为被动平衡模式，可以减小刺激过程的能量消耗，保证在能量受限的情况下仍可维持神经刺激器的刺激输出，避免治疗中断。在保证治疗效果的前提下，选择合适的工作模式提高系统稳定性。在上述实施例的基础上，作为再一种可选的实施例，还可以获取当前的剩余电量，以及电量消耗速率。具体的，剩余电量和电量消耗速率可以反映出能控器自身的能量状况。结合目标温度和回波损耗值，可以更全面地评估系统的能量供给是否充足。进一步地，根据剩余电量、电量消耗速率、目标温度以及回波损耗值，调整神经刺激器的工作模式。综合各个参考指标，对系统的能量状况做出较为准确的判断。在保证治疗效果的前提下，选择一个相对更优的工作模式，使神经刺激器在当前的能量供给条件下可以稳定工作，从而提高系统的可靠性。例如，当剩余电量较低且消耗速率较快时，可以选择较低频率的刺激模式，即使目标温度和回波损耗状况尚可；而当各项指标均显示系统能量充足时，可以选择较高频率的刺激模式。从而可以加强系统的适应能力，保证治疗的持续性。在上述实施例的基础上，作为一种可选的实施例，根据剩余电量、电量消耗速率、目标温度以及回波损耗值，调整神经刺激器的工作模式这一过程，具体还可以包括以下步骤：步骤701：将剩余电量、电量消耗速率、目标温度以及回波损耗值代入第二预设公式，得到目标状态值，目标温度包括外部温度和内部温度。具体的，将剩余电量、电量消耗速率、目标温度以及回波损耗值代入第二预设公式，得到目标状态值。通过该第二预设公式，建立一个综合指标来评估系统的总体能量状态。该公式充分考虑了能控器自身的剩余电量、消耗速率，以及系统在供能过程中的损耗和温度情况，通过系数加权可以调整各因素的重要性。步骤702：若目标状态值大于预设状态值，则调整神经刺激器的工作模式为被动平衡模式。在目标状态值大于预设状态值时，将神经刺激器的工作模式调整为被动平衡模式。因为状态值大于预设值表示系统总体能量供给出现问题，为保证治疗效果，将刺激模式调整为耗能较少的被动平衡模式，以维持系统的正常工作。其中，第二预设公式为：式中，W1表示第一权重，W2表示第二权重，W3表示第三权重，P1表示剩余电量，P2表示电量消耗速率，Loss表示回波损耗值，T1表示外部温度，T2表示内部温度，T3表示预设工作温度。本申请实施例还提供了一种基于能控器状态的神经刺激器控制装置，请参照图4，图4是本申请实施例公开的一种基于能控器状态的神经刺激器控制装置的架构图。其中，装置包括：电压温度获取模块、回波损耗值计算模块以及工作模式调整模块，其中：电压温度获取模块，用于在预设时长内，获取所述射频天线发出射频信号时的第一电压，以及射频天线接收射频信号时的第二电压，获取目标温度；回波损耗值计算模块，用于根据所述第一电压和所述第二电压，计算回波损耗值；工作模式调整模块，用于根据所述目标温度，和/或，所述回波损耗值，调整所述神经刺激器的工作模式，生成所述工作模式对应的刺激指令，并将所述刺激指令发送至所述神经刺激器，以使所述神经刺激器根据所述刺激指令向所述患者的治疗部位输出刺激电流，所述工作模式为主动平衡模式或被动平衡模式。在上述实施例的基础上，作为一种可选的实施例，工作模式调整模块还可以包括：温度判断单元、第一模式切换单元以及目标温差计算单元，其中：温度判断单元，用于判断内部温度是否大于第一内部温度阈值，以及判断外部温度是否大于第一外部温度阈值；模式切换单元，用于若内部温度大于第一内部温度阈值，则调整神经刺激器的工作模式为被动平衡模式；目标温差计算单元，用于若外部温度大于第一外部温度阈值，且，若内部温度小于或等于第一内部温度阈值，且，内部温度大于第二内部温度阈值，则计算内部温度与外部温度之差，得到目标温差，并根据目标温差，调整神经刺激器的工作模式，第二内部温度阈值小于第一内部温度阈值。在上述实施例的基础上，作为一种可选的实施例，目标温差计算单元还可以包括：温差阈值判断子单元，用于判断目标温差是否大于温差阈值；输出功率增大子单元，用于若目标温差大于温差阈值，则根据目标温差，增大射频天线的输出功率；模式切换子单元，用于若目标温差小于或等于温差阈值，则调整神经刺激器的工作模式为被动平衡模式。在上述实施例的基础上，作为一种可选的实施例，作为一种可选的实施例，工作模式调整模块还可以包括：回波损耗值判断单元以及模式切换单元，其中：回波损耗值判断单元，用于判断回波损耗值是否大于预设损耗值；模式切换单元，用于若回波损耗值大于预设损耗值，则调整神经刺激器的工作模式为被动平衡模式。在上述实施例的基础上，作为一种可选的实施例，基于能控器状态的神经刺激器控制装置还可以包括：电量计算模块以及模式切换模块，其中：电量计算模块，用于获取当前的剩余电量，以及电量消耗速率；模式切换模块，用于根据剩余电量、电量消耗速率、目标温度以及回波损耗值，调整神经刺激器的工作模式。在上述实施例的基础上，作为一种可选的实施例，回波损耗值计算模块还可以包括：回波损耗值计算单元，用于将第一电压和第二电压代入第一预设公式，得到回波损耗值；其中，第一预设公式为：式中，Loss表示回波损耗值，A表示预设系数，V1表示第一电压，V2表示第二电压。在上述实施例的基础上，作为一种可选的实施例，模式切换模块还可以包括：目标状态值计算单元以及模式切换单元，其中：目标状态值计算单元，用于将剩余电量、电量消耗速率、目标温度以及回波损耗值代入第二预设公式，得到目标状态值，目标温度包括外部温度和内部温度；模式切换单元，用于若目标状态值大于预设状态值，则调整神经刺激器的工作模式为被动平衡模式；其中，第二预设公式为：式中，W1表示第一权重，W2表示第二权重，W3表示第三权重，P1表示剩余电量，P2表示电量消耗速率，Loss表示回波损耗值，T1表示外部温度，T2表示内部温度，T3表示预设工作温度。需要说明的是：上述实施例提供的装置在实现其功能时，仅以上述各功能模块的划分进行举例说明，实际应用中，可以根据需要而将上述功能分配由不同的功能模块完成，即将设备的内部结构划分成不同的功能模块，以完成以上描述的全部或者部分功能。另外，上述实施例提供的装置和方法实施例属于同一构思，其具体实现过程详见方法实施例，这里不再赘述。本申请还公开一种能控器。参照图5，图5是本申请实施例的公开的一种能控器的结构示意图。该能控器500可以包括：至少一个处理器501，至少一个网络接口504，用户接口503，存储器502，至少一个通信总线505。其中，通信总线505用于实现这些组件之间的连接通信。其中，用户接口503可以包括显示屏、摄像头，可选用户接口503还可以包括标准的有线接口、无线接口。其中，网络接口504可选的可以包括标准的有线接口、无线接口。其中，处理器501可以包括一个或者多个处理核心。处理器501利用各种接口和线路连接整个服务器内的各个部分，通过运行或执行存储在存储器502内的指令、程序、代码集或指令集，以及调用存储在存储器502内的数据，执行服务器的各种功能和处理数据。可选的，处理器501可以采用数字信号处理、现场可编程门阵列、可编程逻辑阵列中的至少一种硬件形式来实现。处理器501可集成中央处理器、图像处理器和调制解调器等中的一种或几种的组合。其中，CPU主要处理操作系统、用户界面图和应用程序等；GPU用于负责显示屏所需要显示的内容的渲染和绘制；调制解调器用于处理无线通信。可以理解的是，上述调制解调器也可以不集成到处理器501中，单独通过一块芯片进行实现。其中，存储器502可以包括随机存储器，也可以包括只读存储器。可选的，该存储器502包括非瞬时性计算机可读介质。存储器502可用于存储指令、程序、代码、代码集或指令集。存储器502可包括存储程序区和存储数据区，其中，存储程序区可存储用于实现操作系统的指令、用于至少一个功能的指令、用于实现上述各个方法实施例的指令等；存储数据区可存储上面各个方法实施例中涉及的数据等。存储器502可选的还可以是至少一个位于远离前述处理器501的存储装置。参照图5，作为一种计算机存储介质的存储器502中可以包括操作系统、网络通信模块、用户接口模块以及一种基于能控器状态的神经刺激器控制方法的应用程序。在图5所示的能控器500中，用户接口503主要用于为用户提供输入的接口，获取用户输入的数据；而处理器501可以用于调用存储器502中存储一种基于能控器状态的神经刺激器控制方法的应用程序，当由一个或多个处理器501执行时，使得能控器500执行如上述实施例中一个或多个所述的方法。需要说明的是，对于前述的各方法实施例，为了简单描述，故将其都表述为一系列的动作组合，但是本领域技术人员应该知悉，本申请并不受所描述的动作顺序的限制，因为依据本申请，某些步骤可以采用其他顺序或者同时进行。其次，本领域技术人员也应该知悉，说明书中所描述的实施例均属于优选实施例，所涉及的动作和模块并不一定是本申请所必需的。在上述实施例中，对各个实施例的描述都各有侧重，某个实施例中没有详述的部分，可以参见其他实施例的相关描述。在本申请所提供的几种实施方式中，应该理解到，所披露的装置，可通过其他的方式实现。例如，以上所描述的装置实施例仅仅是示意性的，例如单元的划分，仅仅为一种逻辑功能划分，实际实现时可以有另外的划分方式，例如多个单元或组件可以结合或者可以集成到另一个系统，或一些特征可以忽略，或不执行。另一点，所显示或讨论的相互之间的耦合或直接耦合或通信连接可以是通过一些服务接口，装置或单元的间接耦合或通信连接，可以是电性或其他的形式。作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部单元来实现本实施例方案的目的。另外，在本申请各个实施例中的各功能单元可以集成在一个处理单元中，也可以是各个单元单独物理存在，也可以两个或两个以上单元集成在一个单元中。上述集成的单元既可以采用硬件的形式实现，也可以采用软件功能单元的形式实现。集成的单元如果以软件功能单元的形式实现并作为独立的产品销售或使用时，可以存储在一个计算机可读取存储器中。基于从而的理解，本申请的技术方案本质上或者说对现有技术做出贡献的部分或者该技术方案的全部或部分可以以软件产品的形式体现出来，该计算机软件产品存储在一个存储器中，包括若干指令用以使得一台计算机设备执行本申请各个实施例方法的全部或部分步骤。而前述的存储器包括：U盘、移动硬盘、磁碟或者光盘等各种可以存储程序代码的介质。以上所述者，仅为本公开的示例性实施例，不能以此限定本公开的范围。即但凡依本公开教导所作的等效变化与修饰，皆仍属本公开涵盖的范围内。本领域技术人员在考虑说明书及实践真理的公开后，将容易想到本公开的其他实施方案。本申请旨在涵盖本公开的任何变型、用途或者适应性变化，这些变型、用途或者适应性变化遵循本公开的一般性原理并包括本公开未记载的本技术领域中的公知常识或惯用技术手段。说明书和实施例仅被视为示例性的，本公开的范围和精神由权利要求限定。
