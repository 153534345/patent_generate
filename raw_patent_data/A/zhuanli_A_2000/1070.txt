标题title
一种植发规划方案生成方法、系统、介质及电子设备
摘要abst
本发明涉及机器视觉辅助毛囊移植技术领域，公开了一种植发规划方案生成方法、系统、介质及电子设备，所述方法包括以下步骤：获取患者头部毛囊图像和患者头部三维表面模型；将所述患者头部三维表面模型进行等面积投影，得到二维表面图像，与所述患者头部毛囊图像进行叠加显示；接收取发区域和植发区域的区域划定，以及接收种植参数；根据种植参数确定取发区域内待取毛囊位置，以及植发区域内预种植毛囊位置，得到规划方案。本发明在获取了患者头部三维表面模型以及头部毛囊图像的基础上，引入地图投影思想，基于等面积投影将三维表面模型在二维平面上展开，实现了更为均匀的取发和植发规划。
权利要求书clms
1.一种植发规划方案生成方法，其特征在于，包括以下步骤：获取患者头部毛囊图像和患者头部三维表面模型；将所述患者头部三维表面模型进行等面积投影，得到二维表面图像，与所述患者头部毛囊图像进行叠加显示；接收取发区域和植发区域的区域划定，以及接收种植参数；根据种植参数确定取发区域内待取毛囊位置，以及植发区域内预种植毛囊位置，得到规划方案。2.如权利要求1所述的植发规划方案生成方法，其特征在于，所述患者头部毛囊图像通过双目视觉显微相机获取，所述患者头部三维表面模型基于结构光3D相机获取的三维点云数据重建得到；所述双目视觉显微相机和结构光3D相机被预先标定至同一坐标系。3.如权利要求1所述的植发规划方案生成方法，其特征在于，获取患者头部毛囊图像具体为获取多幅局部毛囊图像，基于所述多幅局部毛囊图像能够拼接得到患者头部毛囊图像。4.如权利要求1所述的植发规划方案生成方法，其特征在于，将所述患者头部三维表面模型进行等面积投影包括：将所述患者头部三维表面模型视为地球，根据地图的经纬网生成模型经纬网；对所述患者头部三维表面模型进行等面积投影，得到二维表面图像。5.如权利要求1所述的植发规划方案生成方法，其特征在于，所述种植参数包括取发区域内预期保留毛囊密度；所述预期保留毛囊密度确定方法为：对取发区域内的所述患者头部毛囊图像进行毛囊位置识别，并进行计数；接收初始预期保留毛囊密度，根据初始预期保留毛囊密度和取发区域内毛囊数量和取发区域面积，计算取发区域内待取毛囊数量；再将待取毛囊数量作为预种植毛囊数量，结合种植区域面积，计算种植区域内种植后毛囊密度；接收针对初始预期保留毛囊密度的调整，确定预期保留毛囊密度。6.如权利要求5所述的植发规划方案生成方法，其特征在于，根据种植参数确定取发区域内待取毛囊位置包括：在取发区域内，遍历识别到的毛囊位置，将遍历的第一个毛囊位置记为当前毛囊位置，并将其作为第一个待提取毛囊位置；以当前待提取毛囊位置为中心设置禁止区；遍历下一个毛囊位置，并记为当前毛囊位置，并以当前毛囊位置为中心设置缓冲区；判断当前毛囊位置的禁止区是否与已设置的禁止区有交集，若有交集，当前毛囊位置不能作为待提取毛囊位置；若没有交集，将当前毛囊位置作为待提取毛囊位置，将当前毛囊位置的缓冲区记为禁止区；重复步骤-，直至取发区域内毛囊位置被全部遍历；其中，所述禁止区和缓冲区范围相同，均根据预期保留毛囊密度确定。7.如权利要求5所述的植发规划方案生成方法，其特征在于，根据种植参数确定种植区域内预种植毛囊位置包括：根据取发区域内预期保留毛囊密度和取发区域面积，计算取发区域内待取毛囊数量；将待取毛囊数量作为预种植毛囊数量，避开所述种植区域内已有毛囊位置，以种植区域内所有毛囊位置均匀分布为原则，获取种植区域内预种植毛囊位置。8.如权利要求6所述的植发规划方案生成方法，其特征在于，根据种植参数确定取发区域内待取毛囊位置还包括：得到取发区域内待取毛囊位置后，根据所述取发区域内待取毛囊位置，确定取发区域设定单位面积内的待取毛囊数量；基于所述毛囊图像，进行毛囊识别和分类；其中，所述毛囊的类型根据毛囊内头发数量区分；以优先选择头发数量多的毛囊为原则，根据设定单位面积内的待取毛囊数量，对取发区域内待取毛囊的位置进行规划。9.如权利要求8所述的植发规划方案生成方法，其特征在于，将待取毛囊数量作为预种植毛囊数量，对植发区域内预种植毛囊位置进行规划。10.如权利要求1所述的植发规划方案生成方法，其特征在于，所述方法还包括：根据待取毛囊位置和种植毛囊位置，得到规划效果图，并映射至患者头部三维表面模型进行展示。11.一种植发规划方案生成系统，其特征在于，包括：数据获取模块，用于获取患者头部毛囊图像和患者头部三维表面模型；二维投影模块，用于将所述患者头部三维表面模型进行等面积投影，得到二维表面图像，与所述患者头部毛囊图像进行叠加显示；参数设定模块，用于接收取发区域和植发区域的区域划定，以及接收种植参数；移植规划模块，用于根据种植参数确定取发区域内待取毛囊位置，以及植发区域内预种植毛囊位置，得到规划方案。12.如权利要求11所述的植发规划方案生成系统，其特征在于，所述患者头部毛囊图像通过双目视觉显微相机获取，所述患者头部三维表面模型基于结构光3D相机获取的三维点云数据重建得到；所述双目视觉显微相机和结构光3D相机被预先标定至同一坐标系。13.如权利要求11所述的植发规划方案生成系统，其特征在于，获取患者头部毛囊图像具体为获取多幅局部毛囊图像，基于所述多幅局部毛囊图像能够拼接得到患者头部毛囊图像。14.如权利要求11所述的植发规划方案生成系统，其特征在于，将所述患者头部三维表面模型进行等面积投影包括：将所述患者头部三维表面模型视为地球，根据地图的经纬网生成模型经纬网；对所述患者头部三维表面模型进行等面积投影，得到二维表面图像。15.如权利要求11所述的植发规划方案生成系统，其特征在于，所述种植参数包括取发区域内预期保留毛囊密度；所述预期保留毛囊密度确定方法为：对取发区域内的所述患者头部毛囊图像进行毛囊位置识别，并进行计数；接收初始预期保留毛囊密度，根据初始预期保留毛囊密度和取发区域内毛囊数量和取发区域面积，计算取发区域内待取毛囊数量；再将待取毛囊数量作为预种植毛囊数量，结合种植区域面积，计算种植区域内种植后毛囊密度；接收针对初始预期保留毛囊密度的调整，确定预期保留毛囊密度。16.如权利要求15所述的植发规划方案生成系统，其特征在于，根据种植参数确定取发区域内待取毛囊位置包括：在取发区域内，遍历识别到的毛囊位置，将遍历的第一个毛囊位置记为当前毛囊位置，并将其作为第一个待提取毛囊位置；以当前待提取毛囊位置为中心设置禁止区；遍历下一个毛囊位置，并记为当前毛囊位置，并以当前毛囊位置为中心设置缓冲区；判断当前毛囊位置的禁止区是否与已设置的禁止区有交集，若有交集，当前毛囊位置不能作为待提取毛囊位置；若没有交集，将当前毛囊位置作为待提取毛囊位置，将当前毛囊位置的缓冲区记为禁止区；重复步骤-，直至取发区域内毛囊位置被全部遍历；其中，所述禁止区和缓冲区范围相同，均根据预期保留毛囊密度确定。17.如权利要求15所述的植发规划方案生成系统，其特征在于，根据种植参数确定种植区域内预种植毛囊位置包括：根据取发区域内预期保留毛囊密度和取发区域面积，计算取发区域内待取毛囊数量；将待取毛囊数量作为预种植毛囊数量，避开所述种植区域内已有毛囊位置，以种植区域内所有毛囊位置均匀分布为原则，获取种植区域内预种植毛囊位置。18.如权利要求16所述的植发规划方案生成系统，其特征在于，根据种植参数确定取发区域内待取毛囊位置还包括：得到取发区域内待取毛囊位置后，根据所述取发区域内待取毛囊位置，确定取发区域设定单位面积内的待取毛囊数量；基于所述毛囊图像，进行毛囊识别和分类；其中，所述毛囊的类型根据毛囊内头发数量区分；以优先选择头发数量多的毛囊为原则，根据设定单位面积内的待取毛囊数量，对取发区域内待取毛囊的位置进行规划。19.如权利要求18所述的植发规划方案生成系统，其特征在于，将待取毛囊数量作为预种植毛囊数量，对植发区域内预种植毛囊位置进行规划。20.如权利要求19所述的植发规划方案生成系统，其特征在于，所述系统还包括：效果展示模块，用于根据待取毛囊位置和种植毛囊位置，得到规划效果图，并映射至患者头部三维表面模型进行展示。21.如权利要求19所述的植发规划方案生成系统，其特征在于，所述系统还包括：效果展示模块，用于根据待取毛囊位置和种植毛囊位置，得到规划效果图，并映射至患者头部三维表面模型进行展示。22.一种计算机可读存储介质，其上存储有计算机程序，其特征在于，该程序被处理器执行时实现如权利要求1-10任一项所述的植发规划方案生成方法。23.一种植发规划方案生成系统，其特征在于，包括：用于获取患者头部毛囊图像的双目视觉显微相机、用于获取患者头部三维点云数据的结构光3D相机，以及计算机系统；所述双目视觉显微相机和结构光3D相机被预先标定至同一坐标系；所述计算机系统被配置为执行如权利要求1-10任一项所述的植发规划方案生成方法。
说明书desc
技术领域本发明属于机器视觉辅助毛囊移植技术领域，尤其涉及一种植发规划方案生成方法、系统、介质及电子设备。背景技术本部分的陈述仅仅是提供了与本发明相关的背景技术信息，不必然构成在先技术。植发手术的主要过程为首先在取发区域提取2000个以上的毛囊，然后将这些毛囊在需要种植的区域均匀植入，因此，手工进行的植发手术存在依赖医生经验、耗时费力、植发成功率低等诸多问题，其中一个凸显的问题是如何保证提取毛囊以及种植毛囊的均匀性。由于头部为曲面，若要保证提取毛囊以及种植毛囊的均匀性，需要医生具有很强的空间想象能力。为了缓解医生压力，减少手术对于医生经验的依赖等，目前已经研发出辅助植发的机器人，例如ARTAS植发机器人，其可以通过术前三维建模，从而提前预知术后效果，但是，目前仍然存在至少以下问题有待解决：目前为了提高毛囊提取或种植的均匀性，行业内普遍借助术前三维建模的手段，对毛囊提取方案进行规划，提前查看术后效果。但是，目前仍然存在至少以下问题有待解决：受限于建模精度，基于该模型，难以进行精细的手术方案规划，提取和种植的毛囊位置仍然需要医生主观判定，术后取发区域和种植区域的毛囊均匀性无法保证。规划的过程和手术的过程是完全独立的两个过程，即使术前进行了完善的规划，术中仍然很大程度上依赖医生的空间想象能力，才能保证均匀性。整个手术过程需要从取发区域提取2000个以上的毛囊，再种植到植发区域，耗时长，对于医生而言，长时间精细化操作精神压力较大，对于患者而言，由于伤口密集，术中和术后恢复期都需经历长时间痛苦。而目前业内的改进重点主要在于移植的效果，对于如何减轻患者痛苦，未有有效解决方案。发明内容为克服上述现有技术的不足，本发明提供了一种植发规划方案生成方法、系统、介质及电子设备，在获取了患者头部三维表面模型以及头部毛囊图像的基础上，引入地图投影思想，基于等面积投影将三维表面模型在二维平面上展开，实现了更为均匀的取发和植发规划。为实现上述目的，本发明的一个或多个实施例提供了如下技术方案：一种植发规划方案生成方法，包括以下步骤：获取患者头部毛囊图像和患者头部三维表面模型；将所述患者头部三维表面模型进行等面积投影，得到二维表面图像，与所述患者头部毛囊图像进行叠加显示；接收取发区域和植发区域的区域划定，以及接收种植参数；根据种植参数确定取发区域内待取毛囊位置，以及植发区域内预种植毛囊位置，得到规划方案。进一步地，所述患者头部毛囊图像通过双目视觉显微相机获取，所述患者头部三维表面模型基于结构光3D相机获取的三维点云数据重建得到；所述双目视觉显微相机和结构光3D相机被预先标定至同一坐标系。进一步地，获取患者头部毛囊图像具体为获取多幅局部毛囊图像，基于所述多幅局部毛囊图像能够拼接得到患者头部毛囊图像。进一步地，将所述患者头部三维表面模型进行等面积投影包括：将所述患者头部三维表面模型视为地球，根据地图的经纬网生成模型经纬网；对所述患者头部三维表面模型进行等面积投影，得到二维表面图像。进一步地，所述种植参数包括取发区域内预期保留毛囊密度；所述预期保留毛囊密度确定方法为：对取发区域内的所述患者头部毛囊图像进行毛囊位置识别，并进行计数；接收初始预期保留毛囊密度，根据初始预期保留毛囊密度和取发区域内毛囊数量和取发区域面积，计算取发区域内待取毛囊数量；再将待取毛囊数量作为预种植毛囊数量，结合种植区域面积，计算种植区域内种植后毛囊密度；接收针对初始预期保留毛囊密度的调整，确定预期保留毛囊密度。进一步地，根据种植参数确定取发区域内待取毛囊位置包括：在取发区域内，遍历识别到的毛囊位置，将遍历的第一个毛囊位置记为当前毛囊位置，并将其作为第一个待提取毛囊位置；以当前待提取毛囊位置为中心设置禁止区；遍历下一个毛囊位置，并记为当前毛囊位置，并以当前毛囊位置为中心设置缓冲区；判断当前毛囊位置的禁止区是否与已设置的禁止区有交集，若有交集，当前毛囊位置不能作为待提取毛囊位置；若没有交集，将当前毛囊位置作为待提取毛囊位置，将当前毛囊位置的缓冲区记为禁止区；重复步骤-，直至取发区域内毛囊位置被全部遍历；其中，所述禁止区和缓冲区范围相同，均根据预期保留毛囊密度确定。进一步地，根据种植参数确定种植区域内预种植毛囊位置包括：根据取发区域内预期保留毛囊密度和取发区域面积，计算取发区域内待取毛囊数量；将待取毛囊数量作为预种植毛囊数量，避开所述种植区域内已有毛囊位置，以种植区域内所有毛囊位置均匀分布为原则，获取种植区域内预种植毛囊位置。进一步地，根据种植参数确定取发区域内待取毛囊位置还包括：得到取发区域内待取毛囊位置后，根据所述取发区域内待取毛囊位置，确定取发区域设定单位面积内的待取毛囊数量；基于所述毛囊图像，进行毛囊识别和分类；其中，所述毛囊的类型根据毛囊内头发数量区分；以优先选择头发数量多的毛囊为原则，根据设定单位面积内的待取毛囊数量，对取发区域内待取毛囊的位置进行规划。进一步地，将待取毛囊数量作为预种植毛囊数量，对植发区域内预种植毛囊位置进行规划。进一步地，所述方法还包括：根据待取毛囊位置和种植毛囊位置，得到规划效果图，并映射至患者头部三维表面模型进行展示。一个或多个实施例提供了一种植发规划方案生成系统，包括：数据获取模块，用于获取患者头部毛囊图像和患者头部三维表面模型；二维投影模块，用于将所述患者头部三维表面模型进行等面积投影，得到二维表面图像，与所述患者头部毛囊图像进行叠加显示；参数设定模块，用于接收取发区域和植发区域的区域划定，以及接收种植参数；移植规划模块，用于根据种植参数确定取发区域内待取毛囊位置，以及植发区域内预种植毛囊位置，得到规划方案。进一步地，所述患者头部毛囊图像通过双目视觉显微相机获取，所述患者头部三维表面模型基于结构光3D相机获取的三维点云数据重建得到；所述双目视觉显微相机和结构光3D相机被预先标定至同一坐标系。进一步地，获取患者头部毛囊图像具体为获取多幅局部毛囊图像，基于所述多幅局部毛囊图像能够拼接得到患者头部毛囊图像。进一步地，将所述患者头部三维表面模型进行等面积投影包括：将所述患者头部三维表面模型视为地球，根据地图的经纬网生成模型经纬网；对所述患者头部三维表面模型进行等面积投影，得到二维表面图像。进一步地，所述种植参数包括取发区域内预期保留毛囊密度；所述预期保留毛囊密度确定方法为：对取发区域内的所述患者头部毛囊图像进行毛囊位置识别，并进行计数；接收初始预期保留毛囊密度，根据初始预期保留毛囊密度和取发区域内毛囊数量和取发区域面积，计算取发区域内待取毛囊数量；再将待取毛囊数量作为预种植毛囊数量，结合种植区域面积，计算种植区域内种植后毛囊密度；接收针对初始预期保留毛囊密度的调整，确定预期保留毛囊密度。进一步地，根据种植参数确定取发区域内待取毛囊位置包括：在取发区域内，遍历识别到的毛囊位置，将遍历的第一个毛囊位置记为当前毛囊位置，并将其作为第一个待提取毛囊位置；以当前待提取毛囊位置为中心设置禁止区；遍历下一个毛囊位置，并记为当前毛囊位置，并以当前毛囊位置为中心设置缓冲区；判断当前毛囊位置的禁止区是否与已设置的禁止区有交集，若有交集，当前毛囊位置不能作为待提取毛囊位置；若没有交集，将当前毛囊位置作为待提取毛囊位置，将当前毛囊位置的缓冲区记为禁止区；重复步骤-，直至取发区域内毛囊位置被全部遍历；其中，所述禁止区和缓冲区范围相同，均根据预期保留毛囊密度确定。进一步地，根据种植参数确定种植区域内预种植毛囊位置包括：根据取发区域内预期保留毛囊密度和取发区域面积，计算取发区域内待取毛囊数量；将待取毛囊数量作为预种植毛囊数量，避开所述种植区域内已有毛囊位置，以种植区域内所有毛囊位置均匀分布为原则，获取种植区域内预种植毛囊位置。进一步地，根据种植参数确定取发区域内待取毛囊位置还包括：得到取发区域内待取毛囊位置后，根据所述取发区域内待取毛囊位置，确定取发区域设定单位面积内的待取毛囊数量；基于所述毛囊图像，进行毛囊识别和分类；其中，所述毛囊的类型根据毛囊内头发数量区分；以优先选择头发数量多的毛囊为原则，根据设定单位面积内的待取毛囊数量，对取发区域内待取毛囊的位置进行规划。进一步地，将待取毛囊数量作为预种植毛囊数量，对植发区域内预种植毛囊位置进行规划。进一步地，所述系统还包括：效果展示模块，用于根据待取毛囊位置和种植毛囊位置，得到规划效果图，并映射至患者头部三维表面模型进行展示。一个或多个实施例提供了一种电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，所述处理器执行所述程序时实现所述的植发规划方案生成方法。一个或多个实施例提供了一种计算机可读存储介质，其上存储有计算机程序，其特征在于，该程序被处理器执行时实现所述的植发规划方案生成方法。一个或多个实施例提供了一种植发规划方案生成系统，包括：用于获取患者头部毛囊图像的双目视觉显微相机、用于获取患者头部三维点云数据的结构光3D相机，以及计算机系统；所述双目视觉显微相机和结构光3D相机被预先标定至同一坐标系；所述计算机系统被配置为执行所述的植发规划方案生成方法。以上一个或多个技术方案存在以下有益效果：在获取了患者头部三维表面模型以及头部毛囊图像的基础上，引入地图投影思想，基于等面积投影将三维表面模型在二维平面上展开，并与毛囊图像叠加显示，在给定取发区域、植发区域以及种植参数的基础上，实现了更为均匀的取发和植发规划。借助结构光3D相机获取头部点云数据，能够对头部表面进行精确重建，在此基础上，与通过双目视觉显微相机获取的多幅局部小尺度的毛囊图像相结合，能够准确还原患者头部毛囊现状，以及有利于后续规划效果展示的直观真实性。在将头部表面三维模型等面积映射到二维平面的基础上，通过为待提取毛囊位置设置禁止区，避免了提取的毛囊位置过于密集而导致取发区域毛囊分布不均匀。通过对毛囊内头发数量进行分型，在满足取发毛囊分布均匀的基础上制定毛囊分型选取策略，尽可能提取包含头发数量多的毛囊，能够减少移植的毛囊数，缩短手术时长，从而减轻医生压力和患者痛苦。通过对规划效果进行立体展示，能够更为直观地观察种植效果，一方面为医生进一步地方案调整提供参考，另一方面，便于医生与患者进行术前沟通，使得患者能够直观地理解种植规划方案。附图说明构成本发明的一部分的说明书附图用来提供对本发明的进一步理解，本发明的示意性实施例及其说明用于解释本发明，并不构成对本发明的不当限定。图1为本发明一个或多个实施例中所述植发规划方案生成方法流程图；图2为本发明一个或多个实施例中将头部三维表面模型进行等面积投影的示意图；图3为本发明一个或多个实施例中待提取毛囊禁止区设置示意图；图4为本发明一个或多个实施例中保证均匀性和减少毛囊移植数量的规划方法流程图；图5为本发明一个或多个实施例中基于双目视觉显微相机拍摄的毛囊图像示例；图6为本发明一个或多个实施例中毛囊类型划分示意图；图7为本发明一个或多个实施例中毛囊移植效果图。具体实施方式应该指出，以下详细说明都是示例性的，旨在对本发明提供进一步的说明。除非另有指明，本文使用的所有技术和科学术语具有与本发明所属技术领域的普通技术人员通常理解的相同含义。需要注意的是，这里所使用的术语仅是为了描述具体实施方式，而非意图限制根据本发明的示例性实施方式。如在这里所使用的，除非上下文另外明确指出，否则单数形式也意图包括复数形式，此外，还应当理解的是，当在本说明书中使用术语“包含”和/或“包括”时，其指明存在特征、步骤、操作、器件、组件和/或它们的组合。在不冲突的情况下，本发明中的实施例及实施例中的特征可以相互组合。结构光3D扫描：结构光是3D扫描的一个光学方法，它投射出一组用数学方法构造的光图形，按照一定顺序照亮被测量的物体。一个到投影仪的距离已知的摄像头同步捕捉一组被照亮物体的图像。相对于用于校准的平面基准表面，摄像头看到的图形被经扫描物体的表面形状所扭曲。几何三角剖分的原理使得计算被扫描物体表面上每个点的XYZ坐标成为可能。然后，获得的点云数据用于被扫描物体表面详细3D模型的计算构造。3D相机又称之为深度相机，顾名思义，就是通过该相机能检测出拍摄空间的景深距离，这也是与普通摄像头最大的区别。普通的彩色相机拍摄到的图片能看到相机视角内的所有物体并记录下来，但是其所记录的数据不包含这些物体距离相机的距离。仅仅能通过图像的语义分析来判断哪些物体离我们比较远，哪些比较近，但是并没有确切的数据。而3D相机则恰恰解决了该问题，通过3D相机获取到的数据，我们能准确知道图像中每个点离摄像头距离，这样加上该点在2d 图像中的坐标，就能获取图像中每个点的三维空间坐标。通过三维坐标就能还原真实场景，实现场景建模等应用。等面积投影：等面积投影是保持面积不变形的一类地图投影。在等面积投影中无论是微分面积或有限面积都能保持相等。所以等面积投影广泛用于政区图、自然经济图等专题地图。实施例一本实施例公开了一种植发规划方案生成方法，在获取了患者头部三维表面模型以及头部毛囊图像的基础上，实现更为均匀的取发和植发规划，如图1所示，具体包括以下步骤：步骤1：获取患者头部毛囊图像和患者头部三维表面模型。具体地，所述患者头部毛囊图像通过双目视觉显微相机获取；所述患者头部三维表面模型基于结构光3D相机获取的三维点云数据重建得到。并且，为了保证毛囊图像和三维表面模型的匹配，预先将所述双目视觉显微相机和所述结构光3D相机标定至同一坐标系。本实施例中，结构光3D相机的视野范围为80mm×100mm，双目视觉显微相机的视野范围为28mm×17mm且位于结构光3D相机视野中心。本实施例中，所述双目视觉显微相机和结构光3D相机固定在同一机械臂底座上。双目视觉每像素不应大于0.02mm，考虑头发直径0.06-0.09mm，每个头发至少3到4个像素。在3D结构光系统下每像素不应大于0.04mm，单一头发的毛囊也至少对应1个像素。结构光3D相机具有自动对焦和自动扫描功能，投影机会投射十字或其他形式的定位标记，如果对焦位置良好，定位标记会出现在广角摄像头的正中心，机械臂将缓慢前后移动直到对焦完成，对焦完成后执行3D结构光扫描，同时双目视觉显微相机执行拍摄，扫描或拍摄得到的数据均传输至控制工作站。考虑到正常成年人的头颅大小一般在540mm到580mm之间，以距离患者头部160mm作为保护距离，机械臂依照380mm半径携带手术显微镜系统做圆弧运动，直到拍摄完除面部、脖颈部以外的全部有头发的区域，从而得到患者头部完整的三维点云数据，据此即可构建得到所述患者的头部三维表面模型。同时，通过对双目视觉显微相机拍摄的多幅局部毛囊图像进行拼接，得到所述患者的头部毛囊图像。原则上，整个扫描和拍摄的过程中，患者头部应当固定。为了避免因患者头部动作导致的数据偏差，还可以通过在患者头部贴定位标记的方式，控制工作站以定位标记为标准，对获取的数据进行处理，保证了后续获取的头部表面模型以及毛囊图像的准确性。典型的定位标记如ArUco标记。在通过立体显示器显示后，接收医生在扫描的区域上勾画需要种植的区域和需要提取毛囊的区域，控制机械臂携带手术显微镜系统做圆弧运动，使双目视觉系统对种植区域和毛囊提取区域执行高精度分块拍摄。为了保证后续规划得到的提取/种植毛囊位置更为均匀，本实施例还将所述患者头部三维表面模型进行等面积投影，得到二维表面图像，与所述患者头部毛囊图像进行叠加显示。其中，如图2所示，将所述患者头部三维表面模型进行等面积投影具体包括：将所述患者头部三维表面模型视为地球，根据地图的经纬网生成模型经纬网；经度和纬度的起始位置可根据需求任意设置，在此不做限定；对所述患者头部三维表面模型进行等面积投影，得到二维表面图像，本实施例中，采用等面积圆柱投影。通过等面积投影，可以将三维表面投影到二维表面，并且使得投影前后任意两条纬度线和两条纬度线之间的面积不变，为后续毛囊提取位置和种植位置的均匀规划提供了保障。如步骤1中所述，多幅局部毛囊图像经拼接可形成头部完整的毛囊图像。由于拼接的图像较多，拼接后的图像较大，本实施例使用图像处理库VTK中的vtkRenderLargeImage对拼接后的全部毛囊图像进行平铺渲染显示，vtkRenderLargeImage可以设置不同的放大系数以显示图像的不同细节层次。本领域技术人员可以理解，由于双目视觉显微相机视野范围非常小，例如本实施例中仅为28mm×17mm，每一幅局部毛囊图像可近似看做平面图像。将所述多幅局部毛囊图像叠加至所述二维表面上并进行显示，便于医生进一步划定取发或植发区域。由于双目视觉显微相机与3D结构光拍摄的图像在同一坐标系下，医生在二维头部模型图像上所做的规划会自动映射到毛囊图像上。步骤2：接收取发区域和植发区域的区域划定，以及接收种植参数。医生通过在二维表面图像上进行勾画，来划定毛囊移植的取发区域和种植区域，并设定相关的种植参数，所述种植参数包括取发区域内预期保留毛囊密度。确定取发区域后，还对取发区域内的所述患者头部毛囊图像进行毛囊位置识别，并对识别到的毛囊位置进行计数。为了更均匀的在取发区域内提取毛囊，以及在种植区域内种植毛囊，并且保证取发区域内剩余的毛囊不会过于稀疏，种植区域内种植的毛囊数量不会过于密集，取发区域内预期保留毛囊密度的确定方法为：接收医生设定的取发区域内初始预期保留毛囊密度，根据初始预期保留毛囊密度和取发区域内毛囊数量和取发区域面积，计算取发区域内待取毛囊数量；再将待取毛囊数量作为预种植毛囊数量，结合种植区域原有毛囊数量和种植区域面积，计算种植区域内种植后毛囊密度。接收针对初始预期保留毛囊密度的调整，确定合理的预期保留毛囊密度。若设置的预期保留毛囊密度过大，那么将导致提取的毛囊数量过少，种植区域种植后毛囊密度过低，反之，将导致取发区域保留的毛囊密度过小而种植区域种植后密度过高。因此，医生可根据计算得到的待取毛囊数量和种植区域内种植后毛囊密度进行综合考虑，对种植参数，即取发区域内预期保留毛囊密度进行多次调整，寻找能够兼顾取发区域保留毛囊密度和种植区域种植后毛囊密度的种植参数。步骤3：根据种植参数确定取发区域内待取毛囊位置，以及植发区域内预种植毛囊位置，得到规划方案。所述步骤3具体包括：步骤3.1：根据种植参数确定取发区域内待取毛囊位置，包括：在取发区域内，遍历识别到的毛囊位置，将遍历的第一个毛囊位置记为当前毛囊位置，并将其作为第一个待提取毛囊位置；以当前待提取毛囊位置为中心设置禁止区；所述禁止区用于限定该待提取毛囊位置周围一定区域内的毛囊不能再被作为待提取毛囊，即防止取发区域取发后剩余毛囊密度过小；遍历下一个毛囊位置，并记为当前毛囊位置，并以当前毛囊位置为中心设置缓冲区；判断当前毛囊位置的禁止区是否与已设置的禁止区有交集，若有交集，当前毛囊位置不能作为待提取毛囊位置；若没有交集，将当前毛囊位置作为待提取毛囊位置，将当前毛囊位置的缓冲区记为禁止区；重复步骤-，直至取发区域内毛囊位置被全部遍历；其中，所述禁止区和缓冲区范围相同，均根据预期保留毛囊密度确定。本实施例中，所述禁止区和缓冲区设置为以毛囊位置为中心的正方形，当然，也可以设置为圆形等其他图形，在此不做限定。例如，系统从医生选定的取发区域识别出2000个毛囊，医生设置在该区域取1000个毛囊，系统会智能地设置这1000个待取毛囊的位置，以避免取发区被提取毛囊后“变秃”。提取毛囊位置的设置可以采取如下规则：从图像的左上角开始遍历识别到的毛囊位置，以该毛囊位置为中心设置一个2mm边长的正方形，将该区域作为后面设置其他提取毛囊位置的禁止区，寻找下一个待提取毛囊位置时，对后续遍历的毛囊位置也设置的相同大小的正方形区域，暂记为缓冲区，如果与之前已经设置的所有提取毛囊位置的禁止区有交集，则该位置不能作为提取的毛囊，反之，作为待提取毛囊位置，此时，该毛囊位置的缓冲区记为禁止区。例如图3中已经设置区域1、2为待提取毛囊位置的禁止区，在设置区域3时，发现区域3的正方形区域与禁止区1、2有交集，所以区域3中的毛囊位置不能作为提取毛囊的位置。在将头部表面三维模型等面积映射到二维平面的基础上，通过为待提取毛囊位置设置禁止区，避免了提取的毛囊位置过于密集而导致取发区域毛囊分布不均匀。步骤3.2：根据种植参数确定种植区域内预种植毛囊位置，包括：根据取发区域内预期保留毛囊密度和取发区域面积，计算取发区域内待取毛囊数量；将待取毛囊数量作为预种植毛囊数量，避开所述种植区域内已有毛囊位置，以种植区域内所有毛囊位置均匀分布为原则，获取种植区域内预种植毛囊位置。至此，即得到了毛囊规划方案，上述步骤4.1-4.2提供的规划方法，能够得到毛囊分布均匀的种植方案，并且兼顾取发区域保留毛囊密度和种植区域种植后毛囊密度。需要指出的是，上述步骤3.1-3.2主要考虑了毛囊均匀性，保证了种植的效果，在此基础上，本实施例还提供了改进方案，能够在保证取发区域和种植区域内毛囊均匀性的基础上，减少毛囊提取和种植的数量，减轻医生压力和患者痛苦。具体地，如图4所示，包括以下步骤：步骤3.1’：根据种植参数确定取发区域内待取毛囊位置。具体实现方法与上述步骤3.1相同，在此不再赘述。步骤3.2’：根据所述取发区域内待取毛囊位置，确定取发区域设定单位面积内的待取毛囊数量。其中，设定单位面积内的待取毛囊数量≤取发区域内待取毛囊数量/取发区域面积，本实施例中，所述设定单位面积记为100mm2。步骤3.3’：基于所述毛囊图像，进行毛囊识别和分类；其中，所述毛囊的类型根据毛囊内头发数量区分。图5为部分毛囊图像示例，可以看出，每个毛囊中包含的头发数量不同，通常为1-3根，个别包含4根以上，此外，除根数不同外，头发的生长方向也存在差异，同一毛囊内的头发可能方向相同，也可能交叉。本实施例根据毛囊内头发的数量和生长形态划分为六种类型，分别用罗马数字I、II、III、IV、V和X代表。其中，I型对应只包含1根头发的毛囊，II型对应只包含2根头发，且生长方向一致的毛囊，III型对应包含3根及以上头发，且生长方向一致的毛囊，IV型对应包含3根及以上头发，且其中至少2根头发有交叉的毛囊，V型对应包含2根头发，且生长方向从根部交叉的毛囊，X型对应包含2根头发，且生长方向交叉点不在根部的毛囊。具体头发形态及对应类型如图6所示，图6中，横线上方为头发示意图，下方为类型标注。确定毛囊分类原则后，基于毛囊图像获取各类毛囊的局部图像，生成训练数据集，基于深度学习分类器进行训练，得到毛囊分类模型。基于所述毛囊分类模型，即可实现毛囊图像的识别和分类。本实施例采用LeNet-5作为用于训练的深度学习分类器。通过识别毛囊内头发数量，使得医生能够优先选择头发数量多的毛囊进行移植，从而实现移植毛囊数量尽可能少的情况下，保证植发效果。步骤3.4’：以优先选择头发数量多的毛囊为原则，根据设定单位面积内的待取毛囊数量，对取发区域内待取毛囊的位置进行规划。具体地，优先选择III型和IV型，如果不能满足数量要求，次选II和X型。所述步骤3.4’具体包括：将取发区域根据所述设定单位面积进行网格划分，每个网格对应最小取发单元；在每个最小取发单元内，对III型、IV型、II和X型毛囊位置进行定位，并将这些毛囊位置作为待提取的候选毛囊位置，基于步骤3.1’中确定待取毛囊位置的方法，优先从III型和IV型毛囊中进行选择，并对选择的毛囊数量进行计数；若数量小于设定单位面积内的待取毛囊数量，继续从II和X型毛囊位置中进行选择，直至满足数量要求。步骤3.5’：将待取毛囊数量作为预种植毛囊数量，对植发区域内预种植毛囊位置进行规划。所述步骤3.5’在植发区域内的预种植毛囊位置规划，以种植后毛囊在种植区域内均匀分布为原则。具体地，将待取毛囊数量作为预种植毛囊数量，避开所述种植区域内已有毛囊位置，以种植区域内所有毛囊位置均匀分布为原则，获取种植区域内预种植毛囊位置。步骤3.6’：根据待取毛囊位置和预种植毛囊位置，得到规划效果图；接收取发区域设定单位面积内的待取毛囊数量的调整，重复步骤3.4’-3.6’，得到最佳规划方案。其中，所述规划效果图可映射至患者头部三维表面模型进行展示。医生可通过规划效果图查看效果，若种植区域头发密度较大，可进一步减小取发区域设定单位面积内的待取毛囊数量，即减少待取毛囊数量，实现在提取毛囊尽可能少的前提下，保证植发效果。当然，由于毛囊内头发长度都很短，此过程也可通过计算机辅助实现：得到规划效果图的同时，还根据待提取毛囊位置及其包含的头发数量，结合取发区域面积计算取发区域预期保留头发密度；并根据预种植毛囊位置及其包含的头发数量，结合植发区域面积计算植发区域种植后头发密度。医生可根据规划效果图，以及取发区域预期保留头发密度、植发区域种植后头发密度进行综合考虑，调整取发区域设定单位面积内的待取毛囊数量，得到最佳规划方案。上述步骤3.1’-3.6’中，步骤3.2’以保证待取毛囊的均匀性为原则，确定了待取毛囊初始位置分布，基于此，得到单位面积内的毛囊数量，实现了宏观层面的均匀性；在保证宏观层面的均匀性基础上，步骤3.3’-3.4’根据头发数量进行毛囊选择，优选包含头发多的毛囊，以步骤4.3’得到的单位面积内毛囊数量为初始值，根据植发效果，对单位面积内毛囊数量进行调整，得到最优单位面积内毛囊数量，使得能够通过移植尽可能少的毛囊达到较好的植发效果。即，通过两级取发策略，首先在宏观层面上保证取发的均匀性，然后在微观层面上保证一定均匀性的同时，优先选择头发数量多的毛囊，以实现保证宏观均匀性的基础上减少毛囊提取和种植数量。步骤5：根据待取毛囊位置和种植毛囊位置，得到规划效果图，并映射至患者头部三维表面模型进行展示。在计算出取发区提取毛囊位置和种植区种植毛囊的位置后，系统会模拟取发和种植后效果，本实施例中，将取发区域内待提取毛囊位置的毛囊图像擦除，并添加至种植区域内的预种植毛囊位置。在此基础上，系统可以将二维毛囊图像的规划效果映射到三维上进行显示，以模拟出植发后的效果。具体地，将医生选定的种植区域在三维模型上的位置及种植区域内毛发的密度参数输出，与头部三维模型一同输入到Ornatrix毛发插件中，使用Ornatrix毛发插件模拟植发后长出头发后的效果。图7是高比例放大后显示的毛囊图像，为更加直观地模拟显示植发后的效果，可以更改图像的缩放显示比例，以更好地从全貌上观察种植效果。通过对规划效果进行立体展示，能够更为直观地观察种植效果，一方面为医生进一步地方案调整提供参考，另一方面，便于医生与患者进行术前沟通，使得患者能够直观地理解种植规划方案。实施例二本实施例的目的是提供一种植发规划方案生成系统，包括：数据获取模块，用于获取患者头部毛囊图像和患者头部三维表面模型；二维投影模块，用于将所述患者头部三维表面模型进行等面积投影，得到二维表面图像，与所述患者头部毛囊图像进行叠加显示；参数设定模块，用于接收取发区域和植发区域的区域划定，以及接收种植参数；移植规划模块，用于根据种植参数确定取发区域内待取毛囊位置，以及植发区域内预种植毛囊位置，得到规划方案。为了更为直观地观察种植效果，所述系统还包括：效果展示模块，用于根据待取毛囊位置和种植毛囊位置，得到规划效果图，并映射至患者头部三维表面模型进行展示。实施例三本实施例的目的是提供一种电子设备。一种电子设备，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，所述处理器执行所述程序时实现如实施例一中所述的方法。实施例四本实施例的目的是提供一种计算机可读存储介质。一种计算机可读存储介质，其上存储有计算机程序，该程序被处理器执行时实现如实施例一中所述的方法。实施例五本实施例的目的是提供一种植发规划方案生成系统，包括：双目视觉显微相机、结构光3D相机和计算机系统。所述双目视觉显微相机和结构光3D相机均连接至所述计算机系统，所述计算机系统包括显示器、输入输出设备等，只要能够实现图像的显示、人机交互以及分析计算功能即可，在此不做限定。所述双目视觉显微相机包括两个长焦摄像头，每个长焦摄像头周围均设有照明光源，用于对毛囊和头发进行立体成像。所述结构光3D相机包括投影机和广角摄像头，既可以拍摄大范围单目图像，也可以拍摄3D结构光数据，用于对头部表面进行立体成像，所述立体成像方法可采用现有方法实现。本实施例中，所述双目视觉显微相机和结构光3D相机固定在同一底座上。通过对所述双目视觉显微相机和结构光3D相机标定至同一坐标系，即可实现头部三维表面和毛囊、头发三维图像的叠加显示。所述计算机系统被配置为实现如实施例一所述的方法。以上实施例二至五中涉及的各步骤与方法实施例一相对应，具体实施方式可参见实施例一的相关说明部分。以上一个或多个实施例在获取了患者头部三维表面模型以及头部毛囊图像的基础上，引入地图投影思想，基于等面积投影将三维表面模型在二维平面上展开，并与毛囊图像叠加显示，在给定取发区域、植发区域以及种植参数的基础上，实现了更为均匀的取发和植发规划。本领域技术人员应该明白，上述本发明的各模块或各步骤可以用通用的计算机装置来实现，可选地，它们可以用计算装置可执行的程序代码来实现，从而，可以将它们存储在存储装置中由计算装置来执行，或者将它们分别制作成各个集成电路模块，或者将它们中的多个模块或步骤制作成单个集成电路模块来实现。本发明不限制于任何特定的硬件和软件的结合。上述虽然结合附图对本发明的具体实施方式进行了描述，但并非对本发明保护范围的限制，所属领域技术人员应该明白，在本发明的技术方案的基础上，本领域技术人员不需要付出创造性劳动即可做出的各种修改或变形仍在本发明的保护范围以内。
