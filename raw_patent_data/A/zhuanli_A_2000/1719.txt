标题title
恒定功率控制电路及方法、烟杆、电子烟
摘要abst
本发明公开了一种恒定功率控制电路及方法、烟杆、电子烟，恒定功率控制电路包括：功率检测模块，占空比调节模块；功率检测模块将检测得到的表征负载电路上的电压的负载电压信号和表征流过负载的电流的第二检测电压信号进行乘法运算后得到表征负载功率的检测功率信号，检测功率信号输出至所述占空比调节模块，占空比调节模块根据检测功率信号，产生负载电路开关的开启时间和开关周期，控制负载电路开关进行导通和关闭，以恒功率输出。
权利要求书clms
1.一种恒定功率控制电路，其特征在于，所述恒定功率控制电路包括：功率检测模块，占空比调节模块；所述功率检测模块将检测得到的表征负载电路上的电压的负载电压信号和表征流过负载的电流的第二检测电压信号进行乘法运算后得到表征负载功率的检测功率信号，所述检测功率信号输出至所述占空比调节模块，所述占空比调节模块根据所述检测功率信号，产生负载电路开关的开启时间和开关周期，控制负载电路开关进行导通和关闭，以恒功率输出。2.根据权利要求1所述的恒定功率控制电路，其特征在于，所述功率检测模块包括电流采样模块、电压采样模块、乘法器；所述电压采样模块输入端与负载电路电连接，用以检测负载电压以得到负载电压信号，所述电流采样模块输入端与负载电路电连接，用以检测负载电流以得到第二检测电压信号，所述电压采样模块输出端与所述乘法器的一个输入端电连接，所述电流采样模块输出端与所述乘法器的另一个输入端电连接，所述乘法器输出端与所述占空比调节模块的输入端电连接，用以将表征负载功率的检测功率信号输出至所述占空比调节模块。3.根据权利要求1或2所述的恒定功率控制电路，其特征在于，所述占空比调节模块包括误差放大器、PWM比较器、驱动模块；所述误差放大器的其中一个输入端与所述功率检测模块的输出端电连接，所述误差放大器的另一个输入端接收预先设定的基准功率信号，用于比较所述检测功率信号与基准功率信号得到放大后的功率差值；所述PWM比较器的一个输入端与所述误差放大器的输出端电连接，所述PWM比较器的另外一个输入端接收锯齿波信号，所述PWM比较器的输出端与所述驱动模块输入端电连接，所述驱动模块的输出端与所述负载电路开关的控制端电连接，在到达所述开启时间和所述开关周期的时间点时，所述PWM比较器根据所述开启时间信号和所述开关周期信号输出高低电平至所述驱动模块，所述驱动模块控制所述负载电路开关的断开与导通。4.根据权利要求3所述的恒定功率控制电路，其特征在于，所述占空比调节模块还包括RS触发器；所述PWM比较器的输出端与所述RS触发器的R输入端电连接，所述RS触发器的S输入端接收时钟脉冲信号，用于产生所述负载电路开关的开关周期；所述RS触发器的Q输出端与所述驱动模块输入端电连接，所述驱动模块的输出端与所述负载电路开关的控制端电连接，在到达所述开启时间和所述开关周期的时间点时，所述RS触发器根据所述开启时间信号和所述开关周期信号输出高低电平至所述驱动模块，所述驱动模块控制所述负载电路开关的断开与导通。5.根据权利要求3所述的恒定功率控制电路，其特征在于，所述开启时间和所述开关周期的关系为：所述开启时间小于所述开关周期；所述开启时间从所述开关周期的起始时间起算；在所述开启时间内，所述负载电路开关为导通状态；在除所述开启时间之外的所述开关周期时间，所述负载电路开关为断开状态。6.一种恒定功率控制方法，其特征在于，包括：S1：检测负载电压，转换成电信号后经过低通滤波器得到去除噪声的负载电压信号；S2：检测负载电流，转换成电信号后经过低通滤波器得到去除噪声的表征流过负载的电流的第二检测电压信号；S3：将所述负载电压信号和所述第二检测电压信号经过乘法器得到可以表征负载功率的检测功率信号；S4：将所述检测功率信号与预先设定的基准功率电压进行比较得到功率差值；S5：将所述功率差值与锯齿波进行比较，产生负载电路开关的开启时间；S6：产生负载电路开关的开关周期，所述开关周期为固定值；S7：根据所述开启时间和所述开关周期控制负载电路开关的占空比，用以控制所述负载电路的断开与导通。7.根据权利要求6所述的恒定功率控制方法，其特征在于，步骤S1还包括：S11：获得所述检测负载电压时的不同电压采样系数，以得到不同的恒定功率。步骤S2还包括：S21：获得所述检测负载电流的电流采样比例，以得到不同的恒定功率。步骤S4还包括：S41：将所述功率差值经过误差放大器进行放大，获得所述误差放大器的系数来调整所述功率差值精度。8.根据权利要求6所述的恒定功率控制方法，其特征在于，步骤S4还包括：S42：通过调节预先设定的基准功率电压，以得到不同的恒定功率。9.一种烟杆，其特征在于，包括权利要求1-5任意一项所述的恒定功率控制电路。10.一种电子烟，其特征在于，包括权利要求9所述的烟杆。
说明书desc
技术领域本发明涉及电子电路领域，尤其涉及一种电子烟的电路。背景技术电子烟是一种模仿卷烟的电子产品，包括烟杆和烟弹，二者通常是分开的，被消费者购买以后将烟杆和烟弹组装在一起后进行吸食使用。控制电路、电池等通常是设置在烟杆中，雾化器通常是设置在烟弹中，雾化器包括储存烟油的烟油管以及给烟油管加热产生烟雾的发热丝，通过控制发热丝的功率来调节烟雾量。电子烟的烟雾大小和口感与控制电路的输出电压、电流和功率强相关，一般烟雾量会随着输出电压、电流和功率的变化而变化，特别电子烟的电池的电压会随着用户的使用而变化，导致烟雾大小和口感变化，引起用户的体验变差。发明内容本发明所要解决的技术问题在于，提供一种恒定功率控制电路及方法，控制电池输出至发热丝的功率为一个恒定功率，从而使得烟雾量保持稳定，提升口感且避免浪费。所述技术方案如下：一方面，本发明提供一种恒定功率控制电路，包括：功率检测模块，占空比调节模块；功率检测模块将检测得到的表征负载电路上的电压的负载电压信号和表征流过负载的电流的第二检测电压信号进行乘法运算后得到表征负载功率的检测功率信号，检测功率信号输出至占空比调节模块，占空比调节模块根据检测功率信号，产生负载电路开关的开启时间和开关周期，控制负载电路开关进行导通和关闭，以恒功率输出。优选地，功率检测模块包括电流采样模块、电压采样模块、乘法器；电压采样模块输入端与负载电路电连接，用以检测负载电压以得到负载电压信号，电流采样模块输入端与负载电路电连接，用以检测负载电流以得到第二检测电压信号，电压采样模块输出端与乘法器的一个输入端电连接，电流采样模块输出端与乘法器的另一个输入端电连接，乘法器输出端与占空比调节模块的输入端电连接，用以将表征负载功率的检测功率信号输出至占空比调节模块。优选地，占空比调节模块包括误差放大器、PWM比较器、驱动模块；误差放大器的其中一个输入端与功率检测模块的输出端电连接，误差放大器的另一个输入端接收预先设定的基准功率信号，用于比较检测功率信号与基准功率信号得到放大后的功率差值；PWM比较器的一个输入端与误差放大器的输出端电连接，PWM比较器的另外一个输入端接收锯齿波信号，PWM比较器的输出端与驱动模块输入端电连接，驱动模块的输出端与负载电路开关的控制端电连接，在到达开启时间和开关周期的时间点时，PWM比较器根据开启时间信号和开关周期信号输出高低电平至驱动模块，驱动模块控制负载电路开关的断开与导通。优选地，占空比调节模块还包括RS触发器；PWM比较器的输出端与RS触发器的R输入端电连接，RS触发器的S输入端接收时钟脉冲信号，用于产生负载电路开关的开关周期；RS触发器的Q输出端与驱动模块输入端电连接，驱动模块的输出端与负载电路开关的控制端电连接，在到达开启时间和开关周期的时间点时，RS触发器根据开启时间信号和开关周期信号输出高低电平至驱动模块，驱动模块控制负载电路开关的断开与导通。优选地，开启时间和开关周期的关系为：开启时间小于开关周期；开启时间从开关周期的起始时间起算；在开启时间内，负载电路开关为导通状态；在除开启时间之外的开关周期时间，负载电路开关为断开状态。另一方面，本发明提供一种恒定功率控制方法，包括：S1：检测负载电压，转换成电信号后经过低通滤波器得到去除噪声的负载电压信号；S2：检测负载电流，转换成电信号后经过低通滤波器得到去除噪声的表征流过负载的电流的第二检测电压信号；S3：将负载电压信号和第二检测电压信号经过乘法器得到可以表征负载功率的检测功率信号；S4：将检测功率信号与预先设定的基准功率电压进行比较得到功率差值；S5：将功率差值与锯齿波进行比较，产生负载电路开关的开启时间；S6：产生负载电路开关的开关周期，开关周期为固定值；S7：根据开启时间和开关周期控制负载电路开关的占空比，用以控制负载电路的断开与导通。进一步地，步骤S1还包括：S11：获得检测负载电压时的不同电压采样系数，以得到不同的恒定功率。8.根据权利要求6的恒定功率控制方法，其特征在于，步骤S2还包括：S21：获得检测负载电流的电流采样比例，以得到设定不同的恒定功率。9.根据权利要求6的恒定功率控制方法，其特征在于，步骤S4还包括：S41：将功率差值经过误差放大器进行放大，获得误差放大器的系数来调整功率差值精度。10.根据权利要求6的恒定功率控制方法，其特征在于，步骤S4还包括：S42通过调节预先设定的基准功率电压，以得到不同的恒定功率。再一方面，本发明一种烟杆，包括上述的恒定功率控制电路。又一方面，本发明提供一种电子烟，包括上述的烟杆。本发明的有益效果是：利用本发明方案，在电子烟处于点烟发热状态时，实时检测负载的电压和电流，并通过乘法运算得到表征实时功率的检测功率信号，根据检测功率信号产生周期性的占空比信号来控制外接负载的电路开关的导通和断开，实现电子烟的负载功率恒定。附图说明图1为本发明模拟恒定功率控制第一实施例电路示意图；图2为本发明一种负载电压电流检测模块电路示意图；图3为本发明一种基准功率设置模块电路示意图；图4为本发明一种开关duty调节电路示意图；图5为本发明数字恒定功率控制第二实施例电路示意图；图6为本发明一种模数转换ADC模块电路示意图；图7为本发明一种占空比数字处理模块计算开关周期T的波形原理示意图；图8为本发明一种模拟恒定功率控制第三实施例电路示意图；图9A为本发明一种模拟恒定功率控制第四实施例电路示意图；图9B为本发明一种负载电池和电流检测电路示意图；图9C为本发明一种除法器电路示意图；图9D为本发明一种积分器电路示意图；图9E为本发明一种锯齿波发生器电路示意图；图9F为本发明一种PWM比较器电路示意图；图9G为本发明一种RS触发器电路示意图；图10为本发明一种模拟恒定功率控制第五实施例电路示意图。具体实施方式为了便于理解本发明，下面结合附图和具体实施例，对本发明进行更详细的说明。附图中给出了本发明的较佳的实施例。但是，本发明可以以许多不同的形式来实现，并不限于本说明书所描述的实施例。相反地，提供这些实施例的目的是使对本发明的公开内容的理解更加透彻全面。需要说明的是，除非另有定义，本说明书所使用的所有的技术和科学术语与属于本发明的技术领域的技术人员通常理解的含义相同。在本发明的说明书中所使用的术语只是为了描述具体地实施例的目的，不是用于限制本发明。针对本发明要解决的问题，以下提供五种能够解决该技术问题的恒定功率控制电路及方法，其中，实施例一、实施例三、实施例四及实施例五均为模拟恒功率方案，实施例二为数字恒功率方案，针对不同场景，不同方案之间可以进行借鉴和组合，用以达到更优的效果。实施例一如图1-4所示，本实施例公开一种模拟恒定功率控制电路，包括：负载电压电流检测模块11，基准功率设置模块12，占空比调节模块13；负载电压电流检测模块11将检测得到的负载的负载电压信号和与负载电流信号对应的第二检测电压信号输入到占空比调节模块13，基准功率设置模块12将基准功率信号输入到占空比调节模块13，占空比调节模块13根据负载电压信号、第二检测电压信号以及基准功率信号，产生负载电路开关的开启时间和开关周期，控制负载电路开关进行导通和关闭以使输出功率与基准功率成比例关系，在这里比例例如为1∶1、1∶2、1∶3、1∶4、2∶1、3∶1、4∶1等，较佳为1∶1，此时输出功率与基准功率相等。优选地，对于负载电压电流检测模块11，请参考图2，为本发明一种优选的负载电压电流检测模块11电路示意图。负载电压电流检测模块11包括采样MOS管M2、中间MOS管M0、检测电流运算放大器A1、第一分压电阻R1、第二分压电阻R2、第三转换电阻R3；负载电路开关包括Power MOS管M1。具体地，Power MOS管M1的源极与电源电连接，这里的电源可以为电池电压，也可以是电池电压经过转换后的电压，Power MOS管M1的栅极与占空比调节模块13的输出端电连接，Power MOS管M1的漏极与负载电连接，同时也与第一分压电阻R1电连接，第二分压电阻R2的一端与第一分压电阻R1串联，另一端接地，第二分压电阻R2与第一分压电阻R1连接的一端还与占空比调节模块电连接以用于输出负载电压信号；Power MOS管M1的漏极还用于外接负载load，负载load的另一端接地，负载包括电子烟的雾化器等，通过Power MOS管M1导通和关断可以实现负载的通电、断电。具体地，采样MOS管的源极与电源电连接，采样MOS管的栅极与Power MOS管M1的栅极电连接，采样MOS管的漏极与检测电流运算放大器A1的反相输入端电连接，反相输入端还与中间MOS管M0的源极电连接，所述中间MOS管M0的栅极与所述检测电流运算放大器的输出端电连接，所述中间MOS管M0的漏极与所述第三转换电阻电连接，第三转换电阻R3的另一端接地，检测电流运算放大器A1的同相输入端与Power MOS管M1的漏极电连接；第三转换电阻R3与中间MOS管M0连接的一端还与占空比调节模块13电连接以用于输出第二检测电压信号。具体地，第一分压电阻R1和第二分压电阻R2用于采样负载电压的分压，输出负载电压信号Vvsen，第三转换电阻R3用于将采样电流转换成电压，输出第二检测电压信号Visen。将负载电压记为Vload，负载电流记为Iload，下面进一步详细描述负载电压信号Vvsen、第二检测电压信号Visen与负载电压Vloa负载电流Iload的关系。其中，KI：1是Power MOS管M1的沟道的宽长比与采样MOS管M2的沟道的宽长比的比值，则通过该负载电压电流检测模块11电路可以得到实时采样负载电压信号Vvsen和实时采样负载电流转换成的第二检测电压信号Visen，如下所示：这样就得到了负载电压信号Vvsen和第二检测电压信号Visen，从而后续可以计算得到负载功率。进一步地，对负载电压的采样详细说明如下：如图2所示，AT是外接负载load的端子。在AT的右侧虚线框内的电路，就是用于检测负载电压和电流的。Power MOS管M1的源极与电源VDD连接，Power MOS管M1的栅极与输出控制PWM信号的电路连接，Power MOS管M1的漏极分别与负载和分压电路连接，形成负载电路与分压电路的并联关系。因此可以得到：以上即完成了对负载电压的采样。接下来，对电流的采样进行如下说明：电路设计原理：由于第一分压电阻R1和第二分压电阻R2的阻值极大，使得PowerMOS管M1的电流可视为等于负载电流；而Power MOS管M1、采样MOS管M2工作在线性区，且Power MOS管M1、采样MOS管M2的源极、栅极、漏极电压分别相等，使得Power MOS管M1和采样MOS管的电流成正比例关系。具体地，R1和R2的电阻远远大于负载load的电阻，这样使得Power MOS管M1的电流主要是流过并联电路中的负载load，而流过另一条电路即R1和R2的电流相对于负载电流Ilad来说可以忽略不计。因此可以得到如下关系：样流过M1的电流记为IM1，流过M2的电流记为IM2，有IM1＝Iload对于KI：1，这是两个mos管M1和M2的沟道的宽长比。通过两个MOS管的并联，并且两个MOS管都工作在线性区，他们三端的电压都分别相同，这样能够确保流过M1的电流与流过M2的电流形成一个恒定比例关系：IM1＝KI*IM2，具体地，M1是大功率开关管，M2是普通MOS管。这是因为M1还肩负给负载提供电流和控制开关实现功率恒定的功能，这就要求流过M1的电流要远大于流过M2的电流，也就是说上面关系式中的KI也是一个很大的值。另外，由于大功率开关管工作在饱和区，损耗会很大，所以必须要将M1设置为工作在线性区，用以降低MOS管的损耗。因此，为了使得M2与M1的电流匹配，也必须将M2工作在线性区，并且必须保证M1和M2他们三端的电压都相同。其中，M2的源极和M1一样都是连接至VDD，M2的栅极和M1相连，所以M1和M2的源极电压相等，栅极电压相等，只有漏极连接至不同的电阻，所以引入了检测电流运算放大器A1，A1的作用就是保证M2的漏极电压等于M1的漏极电压。结合IM1＝Iload，以及IM1＝KI*IM2，同时还有：从而可以得到Visen与Iload的正比例关系：以上即完成了对负载电流的采样。优选地，请参考图3，为本发明一种优选的基准功率设置模块12电路示意图。其中，基准功率设置模块12包括功率设置运算放大器A3、第三MOS管M3、第四MOS管M4、第四转换电阻R4；功率设置运算放大器A3的同相输入端为恒定功率控制电路内部产生的第二参考电压V2，第三MOS管M3的源极与电源电连接，第三MOS管M3的栅极与功率设置运算放大器A3的输出端电连接，第三MOS管M3的漏极与功率设置运算放大器A3的反相输入端电连接，同时也与外置功率设置电阻Rset电连接，外置功率设置电阻Rset的另一端接地；第四MOS管M4的源极与电源电连接，第四MOS管M4的栅极与第三MOS管M3的栅极电连接，第四MOS管M4的漏极与第四转换电阻R4电连接，第四转换电阻R4的另一端接地；第三MOS管M3、第四MOS管M4工作在饱和区，且源极、栅极电压相等，使得第三MOS管M3和第四MOS管M4的电流成正比例关系；外置功率设置电阻Rset用于设置基准功率，不同阻值的外置功率设置电阻Rset对应不同的基准功率，第四转换电阻R4用于将流过外置功率设置电阻Rset的电流转换成电压，输出第二基准电压信号Vpsen。其中，V1，V2是恒定功率控制电路内部产生的第一参考电压、第二参考电压，Rset是外置功率设置电阻Rset，用来设定基准功率，第四转换电阻的阻值R4与第三转换电阻的阻值R3相等，且在layout布局时，要考虑match，选择型号规格相同的元器件。设置Vref1＝V1，则通过该基准功率设置模块12电路可以得到第二基准电压信号Vpsen与外置功率设置电阻Rset的关系如下：进一步地，对基准功率设置模块12电路中的详细说明如下：V1、V2是电源VDD通过内部电压转换模块转换而来，都是固定值。A2和A3是两个相同的运算放大器，输出的电压等于输入电压。由于检测电流不需要供给外部负载，所以可以设置为很小的值，因此本电路内的两个MOS管都可采用普通MOS管，记为M3，M4，并且都工作在饱和区，这是由于处于饱和区的MOS管只要保证Vgs，也就是MOS管栅极和源极的压差相等，就可以保证流过两个MOS管的电流成一定的正比例关系：IM3＝KP*IM4Pset是外界外置功率设置电阻Rset的端子，有以下关系：从而根据以上三式可以得到：通过采用普通MOS管，并且设置为处于饱和区，并保证栅极和源极的压差相等，就可以实现以上的采样。这样一来，比起电压电流检测模块的电路，节省了一个运算放大器，因为不需要调整漏极的电压使他们相等。优选地，参考图1，占空比调节模块13包括检测功率乘法器1301、开启时间调节模块1303、开关周期调节模块1304、驱动模块1305；检测功率乘法器1301的输入端与负载电压电流检测模块11的输出端电连接，检测功率乘法器1301的输出端与开启时间调节模块1303的输入端电连接，检测功率乘法器1301用于将负载电压信号Vvsen和第二检测电压信号Visen转化为检测功率；开启时间调节模块1303的输出端与驱动模块1305的输入端电连接，用于根据检测功率，计算负载电路开关的开启时间，并输出开启时间信号给驱动模块1305，由驱动模块1305控制负载电路开关断开；开关周期调节模块1304的输入端与基准功率设置模块12的输出端电连接，开关周期调节模块1304的输出端与驱动模块1305的输入端电连接，用于根据基准功率计算负载电路开关的开关周期，并输出开关周期信号给驱动模块1305，由驱动模块1305控制负载电路开关导通；开关周期调节模块1304还与开启时间调节模块1303电连接，开关周期调节模块1304根据开关周期信号输出控制信号，控制开关周期调节模块1304和开启时间调节模块1303在每一周期结束时重置状态；驱动模块1305的输出端与负载电压电流检测模块11的Power MOS管M1栅极电连接，用以实现控制负载电路开关的断开与导通。优选地，参考图3，基准功率设置模块12还包括基准电压运算放大器A2，基准电压运算放大器A2的同相输入端为恒定功率控制电路内部产生的第一参考电压，基准电压运算放大器A2的输出端与反相输入端电连接，用于将第一参考电压转换为基准电压，输出第一基准电压信号Vref1；参考图1、图4，占空比调节模块13还包括基准功率乘法器1302；基准功率乘法器1302的输入端与基准功率设置模块12的输出端电连接，基准功率乘法器1302的输出端与开关周期调节模块1304的输入端电连接；具体地，基准功率乘法器1302与检测功率乘法器1301规格相同，用于将第一基准电压信号和第二基准电压信号转化为调整后的基准功率，抵消检测功率乘法器1301带来的耽搁乘法器放大倍数岁温度和工艺角偏差。以上可以看出，占空比调节模块13主要实现以下功能：将检测功率乘法器1301的输出Multi1，转换成电流，对电容C充电，产生Ton，也就是Power管的开启时间；将基准功率乘法器1302的输出Multi2，转换成电流，对电容C充电，产生T，也就是Power管的开关周期；占空比为开启时间与开关周期之比。驱动模块1305根据以上得到的开启时间和开关周期，来控制Power MOS开关周期为T，开启时间为Ton。优选地，请参考图4，为本发明一种优选的占空比调节电路示意图。其中，开启时间调节模块1303包括检测功率运算放大器A4、第五MOS管M5、第六MOS管M6、第五转换电阻R5、第一转换电容C1、第一开关K1、第二开关K2、第一比较器Comp1、共用RS触发器；检测功率运算放大器A4的同相输入端与检测功率乘法器1301的输出端电连接，第五MOS管M5的源极与电源电连接，第五MOS管M5的栅极与检测功率运算放大器A4的输出端电连接，第五MOS管M5的漏极与检测功率运算放大器A4的反相输入端电连接，同时也与第五转换电阻R5电连接，第五转换电阻R5的另一端接地；第六MOS管M6的源极与电源电连接，第六MOS管M6的栅极与第五MOS管M5的栅极电连接，第六MOS管M6的漏极通过第一开关K1与第一转换电容C1电连接，第一转换电容C1的另一端接地，第二开关K2与第一转换电容C1并联；第一比较器Comp1的同相输入端与第一转换电容C1电连接，第一比较器Comp1的反相输入端为内部第三参考电压，第一比较器Comp1的输出端与共用RS触发器电连接；开启时间调节模块1303通过将检测功率乘法器1301的输出转换成电流给第一转换电容C1充电，结合第一比较器Comp1产生高低电平翻转，向共用RS触发器输入高电平或低电平，从而产生负载电路开关的开启时间。优选地，开关周期调节模块1304包括基准功率运算放大器A5、第七MOS管M7、第八MOS管M8、第六转换电阻R6、第二转换电容C2、第三开关K3、第四开关K4、第二比较器Comp2；基准功率运算放大器A5的同相输入端与基准功率设置模块12的输出端电连接，第七MOS管M7的源极与电源电连接，第七MOS管M7的栅极与基准功率运算放大器A5的输出端电连接，第七MOS管M7的漏极与基准功率运算放大器A5的反相输入端电连接，同时也与第六转换电阻R6电连接，第六转换电阻R6的另一端接地；第八MOS管M8的源极与电源电连接，第八MOS管M8的栅极与第七MOS管M7的栅极电连接，第八MOS管M8的漏极通过第三开关K3与第二转换电容C2电连接，第二转换电容C2的另一端接地，第四开关K4与第二转换电容C2并联；第二比较器Comp2的同相输入端与第二转换电容C2电连接，第二比较器Comp2的反相输入端为内部第三参考电压，第二比较器Comp2的输出端与共用RS触发器电连接；基准功率运算放大器A5与检测功率运算放大器A4规格相同，第二比较器Comp2与第一比较器Comp1规格相同，第六转换电阻R6与第七转换电阻规格相同，第二转换电容C2与第一转换电容C1规格相同；开启时间调节模块1303通过将基准功率乘法器1302的输出转换成电流给第二转换电容C2充电，结合第二比较器Comp2产生高低电平翻转，向共用RS触发器输入高电平或低电平，从而产生负载电路开关的开关周期；第二比较器Comp2的输出端还与第一开关K1、第二开关K2、第三开关K3、第四开关K4电连接，用以根据产生的高低电平翻转信号控制四个开关的断开和导通，从而控制第二转换电容C2与第一转换电容C1的充放电。其中，第一开关K1、第三开关K3同时导通、同时关断，第二开关K2、第四开关K4同时导通、同时关断，第一开关K1、第三开关K3与第二开关K2、第四开关K4不同时导通。优选地，开启时间和开关周期的关系为：开启时间小于开关周期；开启时间从开关周期的起始时间起算；在开启时间内，负载电路开关为导通状态；在除开启时间之外的开关周期时间，负载电路开关为断开状态。下面详细描述占空比相关参数的获取：如图4所示，乘法器1和乘法器2是两个相同的乘法器，放大倍数为A。设置两个相同的乘法器，可以用来抵消单个乘法器放大倍数随温度和工艺角偏差，从而提高整个电路系统的精度。A4和A5是两个相同的运算放大器，comp1和comp2是两个相同的比较器。R5和R6相等且layout match，C1和C2相等且layout match。则通过该占空比调节模块13电路可以得到Driver信号低电平时间Ton以及周期T分别为：其中，通过设置R5＝R6，C1＝C2，则可以得到duty为：而根据前述负载电压电流检测模块11电路和基准功率设置模块12电路中的四种电压信号Vvsen，Visen，Vpsen，Vref1，可以得到占空比duty为：其中，再通过设置R3＝R4，则可以得到功率为：其中，电路在初始设计时，可以设定以上各参数为定值，具体如下：V1，V2为内部参考电压，是固定值；R1，R2是匹配电阻，且设计为比例固定，因此，也是定值；Kp是电流镜比例，也是定值；Rset是外置电阻，一旦设定也是定值；因此，从上述公式可知输出功率P是定值。并且，可通过电连接不同阻值的外置功率设置电阻Rset，就可以得到不同的基准功率，进而得到不同的输出功率P。进一步地，以下对于占空比调节电路开关控制部分如何得到Ton以及周期T作出详细介绍：关于MOS管M5，M6，M7，M8：由于占空比duty调节电路属于内部电路，其电流不需要供给外部负载，所以也可以设置为很小的值，因此本占空比duty调节电路内的4个MOS管都可采用普通MOS管，记为M5，M6，M7，M8，并且都工作在饱和区，这是由于处于饱和区的MOS管只要保证Vgs，也就是MOS管栅极和源极的压差相等，就可以保证流过两个MOS管的电流成一定的正比例关系：IM5＝KP*IM6I M 7＝K P*I M 8而在本占空比调节电路中，KP＝1，因此有：IM5＝IM6IM7＝IM8关于开关K1、K2、K3、K4：由比较器comp2的输出控制四个开关的开启和关闭；其中K1、K3同时导通，给C1、C2充电；K2、K4同时导通，给C1、C2放电，其中放电时是瞬时放电，时间与充电时间相比可以忽略不计。因此有Q＝C*U＝I*t其中C不变，I是恒定值，随着时间t的增加，U会相应增大。C1的充电时长要小于C2，所以每次都是C1连接的比较器comp1先反转。C2充满时，也将导致comp2反转，同时由于comp2的输入电平还进行开关控制，即反转为高电平时控制K1、K3同时断开，K2、K4同时导通，使得充满电的C1、C2同时放电。由于放电是瞬时的，时间相对于充电时长可以忽略不计。因此，放电结束时又将立即使得comp2反转，释放低电平控制K1、K3同时导通，K2、K4同时断开，从而使得C1、C2同时开始充电，下一个周期开始。通过以上的周期性循环往复，C1的充电时长就可以设置为Ton，C2的充电时长设置为T。这两个时间是由共用RS触发器输入到驱动，在本实施例中共用RS触发器是由或非门组成，并由驱动中的反相器进行反转，从而输入到图2中的M1，控制M1的开启导通或者关闭截止。如何得到Ton、T与采样电压电流、以及设置的基准功率的关系，如下：由于Q＝C*U＝I*t以及：IM5＝IM6和IM7＝IM8，则有：因此有：同理，可得到：因此有：另一方面，本发明提供一种恒定功率控制的方法，包括：S1：检测负载电压和负载电流，转换成负载电压信号Vvsen和第二检测电压信号Visn后经过检测功率乘法器1301得到表征实时负载功率的检测功率信号；S2：设置基准功率，转换成电压信号得到表征基准功率的第二基准电压信号Vpsen；S3：将检测功率信号，转换成电流，对电容充电，产生负载电路开关的开启时间；S4：将表征基准功率的第二基准电压信号，转换成电流，对电容充电，产生负载电路开关的开关周期；S5：根据开启时间和开关周期控制负载电路开关的占空比，实现负载电路的断开与导通。进一步地，步骤S2还包括：S21：设置参考电压，转换成电压信号Vref1后，与第二基准电压信号一起经过基准功率乘法器1302得到表征基准功率的基准功率信号。进一步地，步骤S2还包括：S22：设置基准功率步骤包括更换外置功率设置电阻RsetRset，不同的外置功率设置电阻RsetRset代表不同的基准功率。优选地，负载电压信号Vvsen与实时负载电压Vload的关系为：其中，R1、R2为分压电阻。优选地，第二检测电压信号Visen与实时负载电流Iload的关系为：其中R3为用于将负载电流转换成电压信号的转换电阻，KI为电流镜比例。优选地，第二基准电压信号Vpsen与外置功率设置电阻RsetRset的关系为：其中V2是电路内部的参考电压，R4是转换电阻，Kp是电流镜比例。优选地，开启时间为：其中R5为转换电阻，C1为电容，V3为内部参考电压，A为放大系数。优选地，开关周期为：其中R6为转换电阻，C2为电容，V3为内部参考电压，A为放大系数。进一步地，占空比为：根据四种电压信号Vvsen，Visen，Vpsen，Vref1，可以得到duty为：其中，再通过设置R3＝R4，则可以得到功率为：其中，电路在初始设计时，可以设定如下：V1，V2为内部参考电压，是固定值；R1，R2是匹配电阻，且设计为比例固定，因此，也是定值；Kp是电流镜比例，也是定值；Rset是外置电阻，一旦设定也是定值；因此，保证输出功率P是定值，实现恒功率输出。以上方法中参数的获取在前面电路介绍中已经详细描述，在此不再赘述。再一方面，本发明一种烟杆，包括以上任意一项的恒定功率控制电路和外置功率设置电阻，其中，外置功率设置电阻与基准功率设置模块电连接。又一方面，本发明一种电子烟，包括上述的烟杆。由此可见，本实施例的方案可以实现如下功能：电路连接并通电以后，根据前述负载电压电流检测模块11电路和基准功率设置模块12电路中的四种电压信号Vvsen，Visen，Vpsen，Vref1，输入到占空比调节模块13，再通过该占空比调节模块13电路产生控制Driver的连通时间Ton和周期T，最终由驱动Driver模块控制Power MOS开关，保证输出功率P是定值。并且，可通过调节外置功率设置电阻Rset，设置不同的基准功率，简单置换一个外置电阻，就可以满足不同型号的设备对于功率的需求，节省生产和组装成本。以上各电路均采用模拟电路实现，无需进行多次的数模转换或者模数转换，节省元器件，经济实惠。实施例二如图5所示，本实施例公开一种数字恒定功率控制电路，包括：负载电压电流检测模块21，基准功率设置模块22，模数转换模块23，占空比数字处理模块24；负载电压电流检测模块21将检测得到的负载的负载电压信号Vvsen和表征负载电流信号的第二检测电压信号Visen输入到模数转换模块23，基准功率设置模块22将表征基准功率的第二基准电压信号和第一基准电压信号输入到模数转换模块23，模数转换模块23将负载电压信号、第二检测电压信号以及第二基准电压信号、第一基准电压信号转换为数字信号，并输入到占空比数字处理模块24，占空比数字处理模块24产生负载电路开关的开启时间和开关周期，控制负载电路开关导通和关闭，以使输出功率与基准功率成比例关系，在这里比例例如为1∶1、1∶2、1∶3、1∶4、2：1、3∶1、4∶1等，较佳为1∶1，此时输出功率与基准功率相等。其中，参考图2-3，负载电压电流检测模块21和基准功率设置模块22，与实施例一中的模拟电路的控制原理相同，在此不再赘述。优选地，参考图5-6，模数转换模块23包括选择器2301、模数转换器2302；选择器2301的输入端分别与负载电压电流检测模块21、基准功率设置模块22电连接，选择器的控制端与占空比数字处理模块24的输出端电连接，占空比数字处理模块24控制选择器2301分时输出负载电压信号、第二检测电压信号、第二基准电压信号、第一基准电压信号，选择器2301的输出端与模数转换器2302的输入端电连接，用以将负载电压信号、第二检测电压信号以及第二基准电压信号、第一基准电压信号分时采样输出到模数转换器2302；模数转换器2302的输入端与占空比数字处理模块24的输出端电连接，模数转换器2302的输出端与占空比数字处理模块24的输入端电连接，用以将负载电压信号、第二检测电压信号以及第二基准电压信号、第一基准电压信号转换成数字信号输出至占空比数字处理模块24，数字信号的采样量化指数根据占空比数字处理模块24的采样量化指数控制指令进行调整。具体地，对于模数转换器2302，请参考图6，为本发明一种优选的模数转换器ADC电路原理示意图。模数转换器ADC采用逐次逼近的方法，通过将输入信号的采样值Vsh依次与DAC转换网络生成的参考电压值进行比较，逐次产生最高位至最低位的逻辑输出。其中，Vin是MUX的输出，是负载电压信号Vvsen，第二检测电压信号Visen，第二基准电压信号Vpsen，第一基准电压信号Vref1其中之一；Vref是ADC的参考电压，Vvsen，Visen，Vpsen，Vref1的具体获取方式与实施例一中的一样，在此不再赘述。以10位模数转换器ADC为例，10位代表2的10次方，即采样量化指数为1024，Vpsen代表Vpsen经过ADC转换后的量化值，也就是说将Vref分为1024份，每一份的电压值为Vref/1024，Vref的值是固定的，Vpsen占多少份，就是Vpsen的量化值，Vpsen的量化值用Vpsen表示，具体如下所示：同理可以得到Vvsen，Visen，Vref1的量化值，如下所示：优选地，占空比数字处理模块24的输入端与模数转换模块23的输出端电连接，占空比数字处理模块24的输出端还与选择器2301、模数转换器2302电连接；占空比数字处理模块24采用固定的开启时间Ton，开关周期调节模块2401根据采样得到的负载电压信号、第二检测电压信号以及第二基准电压信号、第一基准电压信号的量化值，产生开关周期T，并输出开启时间信号和开关周期信号控制负载电路开关导通和关闭；占空比数字处理模块24还根据开启时间Ton和开关周期T输出选择控制指令，控制选择器2301输出负载电压信号、第二检测电压信号以及第二基准电压信号、第一基准电压信号中的一种至模数转换器2302；优选地，开启时间和开关周期的关系为：开启时间小于开关周期；开启时间从开关周期的起始时间起算；在开启时间内，负载电路开关为导通状态；在除开启时间之外的开关周期时间，负载电路开关为断开状态。具体地，对于开关周期调节模块2401，请参考图7，为本发明一种优选的开关周期调节模块2401获取开关周期T的波形原理示意图。此控制方案采用固定Ton时间，例如512个clk，根据采样到的Vpsen/Vvsen/Visen/Vref1值，去调节T时间。为了复用模数转换器ADC，采用分时采样的方法。如图7中所示，当Adc_ch＝0时，采样Vpsen，且每次使能只采样一次，因为功率只跟Rset有关，一旦Rset设定，功率就恒定，只需采样一次即可。当Adc_ch＝1/2/3时，分别采样Vvsen/Visen/Vref1。具体地，以下为固定设置Ton时间为512个clk时，根据电路设置来得出需要的开关周期T的方法：假设需要的开关周期T为N个clk，则有：同时，还可以反推得到负载的电压和电流值，如下所示：另外，因为功率恒定，可以构建以下关系：其中K4为定值，功率P与外置电阻Rset成反比例关系。则根据Vpsen的量化值可以得到如下关系：另外，根据功率的定义，有以下关系：从而得到：其中，又包含以下关系：则从上面各式可以得到包含Vpsen/Vvsen/Visen/Vref1的N值：上式中，V2，KI，Vref1，Kp，K4，R1，R2均为定值，从而可以根据计算得到的比值，按比例调节N值，最终得到固定的P值，实现恒功率。另一方面，本发明提供一种恒定功率控制方法，包括：S1：检测负载电压Vload和负载电流Iload，转换成负载电压信号Vvsen和第二检测电压信号Visen；S2：设置基准功率和参考电压，转换成电压信号得到表征基准负载功率的第二基准电压信号Vpsen和表征参考电压的第一基准电压信号Vref1；S3：将负载电压信号Vvsen和第二检测电压信号Visen、第二基准电压信号Vpsen和第一基准电压信号Vref1分时采样转换成数字信号；S4：设置固定的开启时间，根据负载电压信号Vvsen和第二检测电压信号Visen、第二基准电压信号Vpsen和第一基准电压信号Vref1转换成的数字信号调整开关周期；S5：根据开启时间和开关周期控制负载电路开关的占空比，实现负载电路的断开与导通。进一步地，负载电压信号Vvsen与负载电压Vload关系为：其中，R1、R2为第一分压电阻、第二分压电阻；当采样的量化指数为1024时，Vvsen的量化值为：其中Vref为模数转换时的参考电压。进一步地，第二检测电压信号Visen与Iload负载电流关系为：其中第三转换电阻R3为用于将负载电流转换成电压信号的转换电阻，KI为电流镜比例；当采样的量化指数为1024时，Visen的量化值为：其中Vref为模数转换时的参考电压。进一步地，第二基准电压信号与外置功率设置电阻关系为：其中V2是电路内部的第二参考电压，R4是第四转换电阻，Kp是电流镜比例；其中，采样量化指数为1024时，Vpsen的量化值为：输出第一基准电压信号Vref1的量化值为：其中Vref为模数转换时的参考电压。进一步地，开启时间设为512个clk，开关周期为N个clk，占空比为：进一步地，将负载功率设为其中K4为定值，Rset为外置功率设置电阻，则可得到开关周期为：其中，V 2为内部第二参考电压，R1，R2为第一分压电阻、第二分压电阻，Kp为电流镜比例，Rset为外置功率设置电阻；因此，V2，KI，Vref1，K p，K4，R1，R2均为定值，从而可以根据计算得到的比值，按比例调节N值，最终得到固定的P值，实现恒功率。以上方法中参数的获取在前面电路介绍中已经详细描述，在此不再赘述。再一方面，本发明一种烟杆，包括以上任意一项的恒定功率控制电路和外置功率设置电阻，其中，外置功率设置电阻与基准功率设置模块电连接。又一方面，本发明一种电子烟，包括上述的烟杆。由此可见，本实施例的方案可以实现如下功能：电路连接并通电以后，根据前述负载电压电流检测模块21电路和基准功率设置模块22电路中的四种电压信号Vvsen，Visen，Vpsen，Vref1，输入到占空比数字处理模块24，再通过该占空比数字处理模块24电路产生开启时间Ton和开关周期T，实时控制负载电路的开启和关闭，保证输出负载功率P是恒定值。并且，可通过调节外置功率设置电阻Rset，设置不同的基准功率，无需修改其他电路参数和配置。这样可以通过简单置换一个外置电阻，就可以满足不同型号的设备对于功率的需求，节省生产和组装成本。其中模数转换模块23占空比数字处理模块24与实施例一的模拟控制电路不同，是使用数字控制电路实现。包括选择器2301MUX、模数转换器2302ADC和Digital。本方案通过控制选择器分时逐一输出采集的电压、电流及功率相关的参数值，共用一个模数转换器2302对这些参数值进行模数转换。这样可以节省模数转换器2302等元器件的数量，降低成本。本方案采用固定Ton时间，例如512个clk，根据采样到的Vpsen/Vvsen/Visen/Vref1值，去调节T时间，通过本方案可以得到较为精确的调节时间，另外还可以修改模数转换器的量化位数和固定Ton时间，可以得到多种调节T时间的方法。本实施例只需要一个选择器和一个模数转换器，不需要设置多个模数转换器，可以降低实现电子烟恒功率的成本。实施例三如图8所示，本实施例公开一种模拟恒定功率控制电路。包括：负载电压电流检测模块31，检测功率乘法器32，占空比调节模块33。负载电压电流检测模块31将检测得到的负载的负载电压信号和与负载电流信号对应的第二检测电压信号输入至检测功率乘法器32，将负载电压信号和第二检测电压信号相乘以后产生检测功率信号并输出至占空比调节模块33，占空比调节模块33根据检测功率信号，产生负载电路开关的开启时间和开关周期，控制负载电路开关进行导通和关闭，以恒功率输出。优选地，负载电压电流检测模块31包括电压采样模块3101、电流采样模块3102；负载电压电流检测模块31和检测功率乘法器32实现方式与实施例一中类似，在此不再赘述。本实施例与实施例一的不同主要在于占空比调节模块33，参考图8，优选地，占空比调节模块33包括开启时间调节模块、开关周期调节模块、驱动模块3305；开启时间调节模块的输入端与检测功率乘法器32的输出端电连接，开启时间调节模块的输出端与驱动模块3305的输入端电连接，开启时间调节模块还与开关周期调节模块电连接，用于根据检测功率信号以及开关周期调节模块的控制信号，计算负载电路开关的开启时间，并输出开启时间信号给驱动模块3305，由驱动模块3305控制负载电路开关断开；开关周期调节模块的输出端与驱动模块3305的输入端电连接，用于计算负载电路开关的开关周期，并输出开关周期信号给驱动模块3305，由驱动模块3305控制负载电路开关导通，开关周期调节模块还根据开关周期信号输出控制信号，控制开关周期调节模块和开启时间调节模块在每一周期结束时重置状态；驱动模块3305的输出端与负载电压电流检测模块31的Power MOS管栅极电连接，用以实现控制负载电路开关的断开与导通。优选地，开启时间调节模块包括第一压控电流源i1、第一转换电容C1、第一开关K1、第一比较器3301、第一RS触发器3303；第一压控电流源i1的控制端与检测功率乘法器32的输出端电连接，第一压控电流源i1的输出电流与检测功率乘法器32的输出电压成正比，第一压控电流源i1的输出端与第一转换电容C1电连接，第一转换电容C1的另一端接地，第一压控电流源i1用以给第一转换电容C1充电，第一开关K1与第一转换电容C1并联，用于控制对第一转换电容C1的充放电；第一比较器3301的同相输入端与第一转换电容C1电连接，第一比较器3301的反相输入端接入第一内部参考电压REF，第一比较器3301的输出端与第一RS触发器3303的R输入端电连接，第一RS触发器3303的Q输出端与驱动模块3305电连接，第一RS触发器3303的Q/输出端与第一开关K1的控制端电连接，第一RS触发器3303的S输入端与开关周期调节模块电连接；开启时间调节模块通过将检测功率乘法器32的输出通过第一压控电流源i1转换成电流给第一转换电容C1充电，结合第一比较器3301产生高低电平翻转，向第一RS触发器3303输入高电平或低电平，从而产生负载电路开关的开启时间；在时间到达开启时间时，第一RS触发器3303的Q输出端向驱动模块3305发出电信号，从而控制负载电路开关的断开；在时间到达开启时间时，第一RS触发器3303的Q/输出端输出信号控制第一开关K1导通，给第一转换电容C1放电，瞬时放电结束后第一比较器3301再次产生高低电平翻转，通过第一RS触发器3303的Q/输出端输出信号控制第一开关K1断开；或者在瞬时放电结束后第一开关K1继续保持导通，直到第一RS触发器3303的S输入端收到信号时，再由第一RS触发器3303的Q/输出端输出信号控制第一开关K1断开。优选地，开关周期调节模块包括基准功率设置模块、第二压控电流源i2、第二转换电容C2、第二开关K2、第二比较器3302、第二RS触发器3304；第二压控电流源i2的控制端与基准功率设置模块的输出端电连接，第二压控电流源i2的输出电流与基准功率设置模块的输出电压成正比，第二压控电流源i2的输出端与第二转换电容C2电连接，第二转换电容C2的另一端接地，用以给第二转换电容C2充电，第二开关K2与第二转换电容C2并联，用于控制对第二转换电容C2的充放电；第二比较器3302的同相输入端与第二转换电容C2电连接，第二比较器3302的反相输入端接入第一内部参考电压REF，第二比较器3302的输出端与第二RS触发器3304的S输入端电连接，第二RS触发器3304的Q输出端与第二开关K2的控制端电连接；第二RS触发器3304的输出端Q输出端同时还与开启时间调节模块的第一RS触发器3303的S输入端电连接，同时还通过一个上升沿触发脉冲发生器与第二RS触发器3304的R输入端电连接；开关周期调节模块通过第二压控电流源i2给第二转换电容C2充电，结合第二比较器3302产生高低电平翻转，向第二RS触发器3304输入高电平或低电平，从而产生负载电路开关的开关周期；在时间到达开关周期时，第二RS触发器3304的Q输出端向第一RS触发器3303的S输入端发出电信号，控制第一RS触发器3303的Q输出端向驱动模块3305发出电信号，从而控制负载电路开关的导通以开启下一个周期；在时间到达开关周期时，第二RS触发器3304的Q输出端输出信号控制第二开关K2导通，给第二转换电容C2放电，瞬时放电结束后第二比较器3302再次产生高低电平翻转，通过第二RS触发器3304的Q输出信号控制第二开关K2断开，或者等待上升沿触发脉冲发生器输出的信号输入至第二RS触发器3304的R输入端，再次触发第二RS触发器3304的Q输出端输出信号控制第二开关K2断开；在时间到达开关周期时，第二RS触发器3304的Q输出端输出信号触发上升沿触发脉冲发生器产生一个触发脉冲，输入至第二RS触发器3304的R输入端，将第二RS触发器3304的状态复位。第二RS触发器3304的复位方式不限于这一种。优选地，第二压控电流源i2与第一压控电流源i1规格相同，第二比较器3302与第二比较器3302规格相同，第二转换电容C2与第一转换电容C1规格相同；优选地，负载电压电流检测模块包括电压采样模块、电流采样模块；电压采样模块输入端与负载电路电连接，用以检测负载电压，电流采样模块输入端与负载电路电连接，用以检测第二检测电压信号，电压采样模块输出端与检测功率乘法器输入端电连接，电流采样模块输出端与检测功率乘法器输入端电连接，用以将检测得到的负载电压信号和第二检测电压信号输入至检测功率乘法器，具体可参考实施例一中的负载电压电流检测模块。优选地，开启时间和开关周期的关系为：开启时间小于开关周期；开启时间从开关周期的起始时间起算；在开启时间内，负载电路开关为导通状态；在除开启时间之外的开关周期时间，负载电路开关为断开状态。下面进行原理和参数的详细说明：在本实施例中，导通阶段，负载电压信号较佳为BAT电压，采样BAT电压和BAT电流，乘积以后通过一个压控电流源产生i1，对C1进行充电，从而产生锯齿波Ramp，通过PWM比较器与第一内部参考电压REF进行比较，然后产生占空比duty来控制连接负载电路的Powermos管。进一步地，根据电路设置，且由于Q＝C*U＝I*t，可以得到以下关系：进一步地，各参数说明如下：其中，Ton是开启时间，T是开关周期，Duty是占空比，P是负载功率；C1/C2是比例量，R2/R1是比例量，REF是内部固定参考电压，REF1是产生i2的压控电流源的输入电压，BAT是负载电压，I是负载电流，K1是检测负载电压的分压系数，K2是检测负载电流转换成电压以后的电流转换系数，采样精度取决于K1和K2。因此，不同的恒功率可以通过修改K1和K2的值来设定。进一步地，以下对电路的运行逻辑进行详细补充说明：下面的RS触发器的输出Q输出端：当Ton时间到了以后，上面的驱动DR断开；负载电流变为0，此时Q/输出端使得C1无论导通还是断开，第一压控电流源i1的输出电流均为0；当到达周期T以后，下面的触发器Q有以下三条输出线路：1、使得电容C2放电；2、触发上升沿触发脉冲发生器延迟一个脉冲时间产生重置脉冲信号，输出给触发器的R输入端，使得触发器的Q输出端又反转，下面的C2开关反转，放电结束，只放电一个脉冲时间；3、信号给第一RS触发器的S输入端，使得驱动模块DR将负载电路的开关导通，开始提供负载电流；同时，第一开关K1也断开。第一开关K1断开时，此时为Ton的起点时刻，也是T的起点时刻。另一方面，本发明提供一种恒定功率控制方法，其特征在于，包括：S1：检测负载电压BAT和负载电流I，转换成负载电压信号和表征负载电流信号的第二检测电压信号后经过检测功率乘法器32得到表征实时负载功率的检测功率信号；S2：将检测功率信号，通过压控电流源转换成电流i1，对电容C1充电，结合比较器与内部固定参考电压REF比较，从而产生负载电路开关的开启时间；S3：通过压控电流源产生电流i2，对电容C2充电，结合比较器与内部固定参考电压REF比较，从而产生负载电路开关的开关周期；S4：根据开启时间和开关周期控制负载电路开关的占空比，实现负载电路的断开与导通。进一步地，步骤S1还包括：S11：修改检测负载电压的分压系数K1和检测负载电流转换成电压以后的电流转换系数K2，从而设定不同的基准功率。进一步地，开启时间Ton计算方法为：其中，C1是电容，R1是压控电流源的电阻，REF是内部固定参考电压，REF 1是产生i2的压控电流源的输入电压，BAT是负载电压，，是负载电流，K1是检测负载电压的分压系数，K2是检测负载电流转换成电压以后的电流转换系数。进一步地，开关周期T计算方法为：其中，C2是电容，R2是压控电流源的电阻，REF是内部固定参考电压，REF 1是产生i2的压控电流源的输入电压。进一步地，占空比Duty计算方法为：负载功率P为：其中，C1/C2是比例量，R2/R1是比例量，REF是内部固定参考电压，REF1是产生i2的压控电流源的输入电压，BAT是负载电压，I是负载电流，K1是检测负载电压的分压系数，K2是检测负载电流转换成电压以后的电流转换系数，采样精度取决于K1和K2。以上方法中参数的获取在前面电路介绍中已经详细描述，在此不再赘述。再一方面，本发明还提供一种烟杆，包括恒定功率控制电路和外置功率设置电阻，其中，外置功率设置电阻与基准功率设置模块电连接。又一方面，本发明一种电子烟，包括上述的烟杆。由此可见，本实施例的方案可以实现如下功能：电路连接并通电以后，根据前述负载电压检测模块、电流采样模块3102、乘法器对负载功率进行一定的采样取值，输入到占空比调节模块33，再通过该占空比调节模块33电路产生控制Driver的连通时间Ton和周期T，最终由驱动Driver模块控制Power MOS开关，保证输出功率P是定值。并且，可通过调节采样系数K1和K2，设置不同的基准功率。以上各电路均采用模拟电路实现，无需进行多次的数模转换或者模数转换，节省元器件，经济实惠。实施例四如图9A-9G所示，一方面，本发明提供一种恒定功率控制电路，包括：负载功率检测模块41、占空比调节模块42，占空比调节模块42包括除法器4103和积分器4104；负载电压检测模块4101全程采样负载电压BAT，负载电压BAT可以为电池电压，也可以为其他电压，负载电流检测模块4102全程采样负载电流CS。优选地，负载功率检测模块41将检测得到的负载电压信号输入给除法器4103，除法器4103的输出端REF与积分器4104的一个输入端电连接，负载功率检测模块41将检测得到的表征负载电流信号的第二检测电压信号输出给积分器4104的另外一个输入端，积分器4104的输出端与占空比调节模块42电连接，占空比调节模块42产生负载电路开关的开启时间和开关周期，控制负载电路开关进行导通和关闭，以恒功率输出。优选地，负载功率检测模块41包括负载电压检测模块4101、负载电流检测模块4102。负载电压检测模块4101输入端与负载电路电连接，用以检测负载电压，负载电流检测模块4102输入端与负载电路电连接，用以得到表征负载电流的第二检测电压信号，负载电压检测模块4101输出端与除法器4103输入端电连接，除法器4103输出端与积分器4104的同相输入端电连接，负载电流检测模块4102输出端与积分器4104的反相输入端电连接，积分器4104的输出端与占空比调节模块42的输入端电连接，用以将检测得到的负载电压信号和与负载电流信号对应的第二检测电压信号进行除法和积分运算，输出至占空比调节模块42。优选地，参考图9C，除法器4103包括第一运算放大器41031、第二电容C2、第三电阻R3、内部乘法器41032；第一运算放大器41031的同相输入端电连接第二内部参考电压V2，其反相输入端通过第三电阻R3与内部乘法器41032的输出端电连接，其反相输入端还与第二电容C2的一端电连接，第二电容C2的另一端与第一运算放大器41031的输出端电连接，第一运算放大器41031的输出端还与内部乘法器41032的其中一个输入端电连接，并作为除法器的输出端；内部乘法器41032的另一个输入端接入负载电压信号；优选地，参考图9D，积分器4104包括第二运算放大器41041、第四电容C4、第六电阻R6、钳位电路41042；第二运算放大器41041的同相输入端与除法器的输出端电连接，第二运算放大器41041的反相输入端通过第六电阻R6接入第二检测电压信号，第二运算放大器41041的反相输入端还与第四电容C4的一端电连接，第四电容C4的另一端与第二运算放大器41041输出端电连接，第二运算放大器41041输出端与钳位电路41042电连接，钳位电路41042的输出端作为积分器的输出端。钳位电路41042用于使第二运算放大器41041的输出电压在一定范围内。优选地，占空比调节模块42还包括锯齿波发生器4201、PWM比较器4202、RS触发器4203；PWM比较器4202的输入端与锯齿波发生器4201的第一输出端电连接，PWM比较器4202的另外一个输入端还与积分器4104的输出端电连接，PWM比较器4202的输出端与RS触发器4203的R输入端电连接，产生负载电路开关的开启时间，输出开启时间信号至RS触发器4203的R输入端；RS触发器4203的S输入端与锯齿波发生器4201的第二输出端电连接，用于产生负载电路开关的开关周期，输出开关周期信号至RS触发器4203的S输入端；RS触发器4203的Q输出端与驱动模块4204输入端电连接，驱动模块4204的输出端与负载电压电流检测模块的Power MOS管栅极电连接，在到达开启时间和开关周期的时间点时，RS触发器4203根据开启时间信号和开关周期信号输出高低电平至驱动模块4204，驱动模块4204控制负载电路开关的断开与导通；锯齿波发生器4201的输入端与驱动模块4204的输出端电连接，用于在周期结束时将锯齿波发生器4201状态重置。优选地，参考图9E，锯齿波发生器4201包括第一脉冲发生器42011、第四比较器S4、第三电容C3、第三比较器S3、第五电阻R5；第一脉冲发生器42011的输入端为锯齿波发生器的输入端，第一脉冲发生器42011的输出端与第四比较器S4的同相输入端电连接，第四比较器S4的反相输入端接地；第四比较器S4的输出端与第三电容C3的一端电连接，第三电容C3的另一端接地，第四比较器S4的输出端为锯齿波发生器的第一输出端；第四比较器S4的输出端还与第三比较器S3的同相输入端电连接，第三比较器S3的反向输入端接入第六内部参考电压，第三比较器S3的输出端与第五电阻R5的一端电连接，第五电阻R5的另一端接地，第三比较器S3的输出端为锯齿波发生器4201的第二输出端；优选地，参考图9F，PWM比较器4202包括第二比较器S2、第四电阻R4、第二脉冲发生器42021；第二比较器S2的同相输入端与锯齿波发生器4201的第一输出端电连接，其反相输入端与积分器4104的输出端电连接；第二比较器S2的输出端通过第四电阻R4接地；第二比较器S2的输出端与第二脉冲发生器42021电连接，第二脉冲发生器42021的输出端为PWM比较器4202的输出端。当第二脉冲发生器42021收到一个高电平信号时，反相器U5会延迟一个脉冲输出，因此，与门会输出高电平，当过了一个脉冲时间，反相器U5输出低电平信号给与门U4，与门U4输出低电平。第一脉冲发生器42011的原理类似，不再赘述。优选地，开启时间和开启周期的关系为：开启时间小于开启周期；开启时间从开启周期的起始时间起算；在开启时间内，负载电路开关为导通状态；在除所述开启时间之外的所述开关周期时间，负载电路开关为断开状态。优选地，RS触发器4203的S输入端与周期脉冲信号发生器电连接，用于产生负载电路开关的开关周期，输出开关周期信号至RS触发器4203的S输入端。由图9C可知，检测到的电池的电压BAT通过一个除法器4103获得REF＝k/bat，其中乘法器的输出值除以乘法器的放大倍数得到定值k，然后将电压信号REF和第二检测电压信号CS转换为电流信号并通过积分器4104对第四电容C4进行积分，得到EAO电压信号。该EAO电压信号和锯齿波发生器4201产生的锯齿波Ramp进行比较，产生占空比duty中的开启时间Ton，用以控制负载电路4205的power mos管的导通和关闭。锯齿波发生器4201的另一个输出端输出CLK信号，用以代表T的周期。不同的恒功率值可以通过修改k和电流采样比例来设定。具体地，图9B示出了适用于本实施例的一种负载电池和电流检测电路。其中，输出BATT为采样负载电压信号，CS为表征采样负载电流相关的电压信号，GATE为驱动输出的控制负载电路4205开关的信号。具体地，图9D示出了适用于本实施例的一种积分器4104电路。其中，同相输入为计算得到的电压信号REF，反相输入为第二检测电压信号CS，通过该积分器4104，可以得到EAO电压信号。进一步地，本积分电路还连接了一个钳位电路41042，将输出电压控制在一个区间范围，图中的范围为0.4V-1.9V。这样可以保证输出电压和后面的锯齿波发生器4201的输出进行比较时，效率更高。其中，在power mos管导通时，CS电压、电压信号REF、电阻R6计算可以得到电流，该电流给电容C4充电，满足以下式子：Ton*/R6＝C4*；在power mos管关断时，CS处的电压为0，电容C4放电，为了达到稳态，满足以下式子：Toff*REF/R6＝C4*；将周期T＝Ton+Toff，REF＝K/BAT,CS＝K1*Iload带入上面两个式子，得到：P＝Iload*BAT*Ton/T＝K/K1，P为输出的恒功率值。具体地，图9E示出了适用于本实施例的一种锯齿波发生器4201的具体电路。其中，该锯齿波发生器4201有两个输出端，一个输出为Ramp输出端，即为第一输出端，另一个输出端为CLK输出端，即为第二输出端。其中Ramp用于输入到PWM比较器4202中，与前面积分器的输出进行比较产生Ton时间和相应的信号；另一个CLK用于输入到RS触发器4203的S输入端，产生T时间和相应的信号，本实施例的周期T由锯齿波发生器4201确定。进一步地，该锯齿波发生器4201还有一个输入端，输入电信号为GATE，如前，GATE为驱动输出的控制负载电路开关4205的信号。这里GATE输入高电平后，非门U2会滞后一个时序脉冲，也即与门的两个输入端在这个时序脉冲时间均为高电平，从而与门U3输出高电平，从而控制开关S4导通，实现给C3进行瞬时放电，在这个时序脉冲过后，非门U2会输出低电平，从而与门U3会输出低电平，控制开关S4关断截止，进而电容C3进行充电，锯齿波从0开始攀升。在这里，非门U2、与门U3共同构成第一脉冲发生器42011。在这里，I1*T＝C3*V6，从而可以得到周期T的值，其中，I1为电流源的输出电流。此后，控制开关S3导通，CLK输出高电平给RS触发器4203。具体地，图9F示出了适用于本实施例的一种PWM比较器4202电路。其中，输入为锯齿波发生器4201输出的Ramp信号和积分电路输出的表征实时功率值的EAO信号。这两种信号通过该PWM比较器4202进行比较，当二者相等时就会产生一个时序的高电平脉冲，表征本周期内的Ton时间已经到达，输入到RS触发器4203的一个输入端，并最终输出给GATE，控制负载电路4205开关进行关闭。在这里，非门U5、与门U4共同构成第二脉冲发生器具体地，图9G示出了适用于本实施例的一种RS触发器4203电路。其中，R输入端接收表征Ton的信号，S输入端接收表征T的信号。输出给GATE，用于控制负载电路4205开关的导通与关闭。另一方面，本发明提供一种恒定功率控制方法，包括：S1：检测负载电压，转换成负载电压信号后经过除法器4103得到与负载电压信号成反比的参考电压信号；S2：检测负载电流，转换成表征负载电流信号的第二检测电压信号；S3将参考电压信号和第二检测电压信号经过积分器4104得到积分信号；S4：将积分功率信号与锯齿波进行比较，产生负载电路开关的开启时间；S5：产生负载电路开关的开关周期，开关周期为固定值；S6：根据开启时间和开关周期控制负载电路开关的占空比，实现负载电路的断开与导通。进一步地，步骤S1还包括：S11：修改除法器4103的系数，从而设定不同的恒定功率。进一步地，步骤S2还包括：S21：修改检测负载电流的电流采样比例，从而设定不同的恒定功率。再一方面，本发明提供一种烟杆，包括上述的恒定功率控制电路。又一方面，本发明提供一种电子烟，包括上述的烟杆。由此可见，本实施例的方案可以实现如下功能：电路连接并通电以后，根据负载电压检测模块4101、负载电流检测模块4102、除法器4103、积分器4104对负载功率进行一定的采样取值，输入到占空比调节模块42，再通过该占空比调节模块4233电路产生控制驱动模块4204Driver的连通时间Ton和周期T，最终由驱动模块4204Driver控制负载电路4205的Power MOS开关的导通与断开，保证输出功率P是定值。并且，可通过调节电流采样系数和除法器4103的系数k，设置不同的基准功率。以上各电路均采用模拟电路实现，无需进行多次的数模转换或者模数转换，节省元器件，经济实惠。实施例五如图10所示，本实施例公开一种模拟恒定功率控制电路。一方面，本发明提供一种恒定功率控制电路，包括：功率检测模块51，占空比调节模块5252。其中，功率检测模块51包括：电流采样模块5101、电压采样模块5102、乘法器5105。占空比调节模块5252包括误差放大器5201、PWM比较器5202、驱动模块5204。功率检测模块51将检测得到的表征负载电路上的电压的负载电压信号和表征流过负载的电流的第二检测电压信号进行乘法运算以后产生可以表征负载功率的检测功率信号输出至占空比调节模块52，占空比调节模块52根据检测功率信号，产生负载电路5205开关的开启时间和开关周期，控制负载电路5205开关进行导通和关闭，保证恒定功率输出。优选地，功率检测模块51包括电流采样模块5101、电压采样模块5102、低通滤波器、乘法器5105；电压采样模块5102输入端与负载电路5205电连接，用以检测负载电压以得到负载电压信号，电流采样模块5101输入端与负载电路5205电连接，用以检测负载电流以得到第二检测电压信号，电压采样模块5102输出端与第一低通滤波器5103输入端电连接，第一低通滤波器5103输出端与乘法器5105输入端电连接，电流采样模块5101输出端与第二低通滤波器5104输入端电连接，第二低通滤波器5104的输出端与乘法器5105输入端电连接，乘法器5105输出端与占空比调节模块52的输入端电连接，用以将检测得到的负载电压信号和第二检测电压信号进行低通滤波去除噪声，再进行乘法运算以后产生可以表征负载功率的检测功率信号，输出至占空比调节模块52。优选地，占空比调节模块52包括误差放大器5201、PWM比较器5202、驱动模块5204；误差放大器5201的负极输入端与功率检测模块51的输出端电连接，误差放大器5201的正极输入端接收预先设定的基准功率电压信号，用于比较检测功率信号与基准功率信号得到功率差值；PWM比较器5202的输入端与误差放大器5201的输出端电连接，PWM比较器5202的另一个输入端接收锯齿波信号，PWM比较器5202的输出端与驱动模块5204输入端电连接，驱动模块5204的输出端与负载电路开关的控制端电连接，在到达开启时间和开关周期的时间点时，PWM比较器5202根据开启时间信号和开关周期信号输出高低电平至驱动模块5204，驱动模块5204控制负载电路开关的断开与导通。优选地，占空比调节模块还包括RS触发器5203；PWM比较器5202的输出端与RS触发器5203的R输入端电连接，RS触发器5203的S输入端接收时钟脉冲信号，用于产生负载电路开关的开关周期；RS触发器5203的Q输出端与驱动5204模块输入端电连接，驱动5204模块的输出端与负载电路5205的Power MOS管栅极电连接，在到达开启时间和开关周期的时间点时，RS触发器5203根据开启时间信号和开关周期信号输出高低电平至驱动5204模块，驱动5204模块控制负载电路5205开关的断开与导通；优选地，开启时间和开关周期的关系为：开启时间小于开关周期；开启时间从开关周期的起始时间起算；在开启时间内，负载电路5205开关为导通状态；在除开启时间之外的开关周期时间，负载电路5205开关为断开状态。优选地，误差放大器5201的输入端的正极为设置要达到的参考基准功率VREF，输入端负极为乘法器5105的输出端。误差放大器5201的输出为：V输出＝K*将误差V输出与锯齿波RAMP相比较，通过PWM比较器5202产生占空比duty，从而最终控制负载电路5205开关MOS管的导通与关闭。其中，CLK为一个周期T，该周期大于PWM比较器5202的输出端控制的Ton时间。因此，本实施例中不同的恒功率可以通过设置误差放大器5201的正极输入端VREF的值来设定。另一方面，本发明提供一种恒定功率控制方法，包括：S1：检测负载电压，转换成电信号后经过低通滤波器得到去除噪声的负载电压信号；S2：检测负载电流，转换成电信号后经过低通滤波器得到去除噪声的第二检测电压信号；S3：将负载电压信号和第二检测电压信号经过乘法器5105得到可以表征负载功率的检测功率信号；S4：将检测功率信号与预先设定的基准功率电压进行比较得到功率差值；S5：将功率差值与锯齿波进行比较，产生负载电路5205开关的开启时间；S6：产生负载电路5205开关的开关周期，开关周期为固定值；S7：根据开启时间和开关周期控制负载电路5205开关的占空比，用以控制负载电路5205的断开与导通。进一步地，步骤S1还包括：S11：获得检测负载电压时的电压采样系数，以得到不同的恒定功率。进一步地，步骤S2还包括：S21：获得检测负载电流的电流采样比例，以得到不同的恒定功率。进一步地，步骤S4还包括：S41：将功率差值经过误差放大器进行放大，获得误差放大器的系数来调整功率差值精度。进一步地，步骤S4还包括：S42：通过调节预先设定的基准功率电压，以得到不同的恒定功率。以上方法中参数的获取在前面电路介绍中已经详细描述，在此不再赘述。再一方面，本发明一种烟杆，包括上述的恒定功率控制电路。又一方面，本发明提供一种电子烟，包括上述的烟杆。由此可见，本实施例的方案可以实现如下功能：电路连接并通电以后，根据电流采样模块5101、电压采样模块5102、低通滤波器、乘法器5105对负载功率进行一定的采样取值，输入到占空比调节模块5252，再通过该占空比调节模块5252电路产生控制Driver的连通时间Ton和周期T，最终由驱动5204Driver模块控制负载电路开关，保证输出功率P是定值。并且，可通过不同的电压、电流采样系数得到不同的恒定功率。以上各电路均采用模拟电路实现，无需进行多次的数模转换或者模数转换，节省元器件，经济实惠。
