标题title
椎弓根螺钉路径自动规划方法、装置、设备及存储介质
摘要abst
本发明提供了一种椎弓根螺钉路径自动规划方法、装置、设备及存储介质，以脊椎CT图像作为输入，通过图像分割，生成脊椎分割结果，根据分割结果建立脊椎坐标系，通过两次脊椎坐标系正位，在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径。在求得的路径上根据约束条件完成椎弓根螺钉路径规划。与现有技术相比较，本发明通过两次脊椎坐标系正位，避免了由于提取到的椎弓根CT数据包含椎体和棘突部分导致计算错误的问题，同时增加了对椎弓根螺钉的推荐设计，实现了对于椎弓根螺钉路径的自动规划。
权利要求书clms
1.一种椎弓根螺钉路径自动规划方法，其特征在于，包括以下步骤：S101，通过质心检测神经网络模型对包含脊椎的CT图像进行检测，获取CT图像中所有脊椎的质心检测结果；S102，以单个指定脊椎的质心为中心，指定尺寸为半径裁剪脊椎图像，以裁剪的图像和指定脊椎的质心点生成的高斯图像为输入，通过分割神经网络实现指定脊椎的自动分割；S103，根据分割结果建立脊椎坐标系，并通过两次脊椎坐标系正位，建立正位后的脊椎坐标系；其中，两次脊椎坐标系正位包括主成分分析坐标正位和表面数据分析坐标正位；S104，在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径；S105，根据规划的路径计算椎弓根螺钉位姿变换，完成椎弓根螺钉路径规划。2.根据权利要求1所述的一种椎弓根螺钉路径自动规划方法，其特征在于，S101中所述通过质心检测神经网络模型对包含脊椎的CT图像进行检测，获取CT图像中所有脊椎的质心检测结果，包括：获取包含脊椎的CT图像；由于输入CT图像包含多个椎骨，尺寸较大，根据CT图像大小裁剪有重叠的多个图像块，并输入到质心检测神经网络模型；质心检测神经网络模型对每个图像块输出对应的用多个通道图像表示的多个类别的质心检测结果；对每个通道按图像块重叠部分预测结果最大值合并，最后取每个通道最大值坐标作为当前类别的质心点，即可得到CT图像中每个脊椎的质心检测结果。3.根据权利要求2所述的一种椎弓根螺钉路径自动规划方法，其特征在于，所述质心检测网络采用空间配置网络模型。4.根据权利要求1所述的一种椎弓根螺钉路径自动规划方法，其特征在于，S102中所述分割神经网络采用U-Net模型，将裁剪的图像和指定脊椎的质心点生成的高斯图像输入到分割神经网络后，对分割神经网络输出的预测结果以0.5为阈值进行二值化得到分割结果，分割结果有两种表示方式，分别是二值图像表示和表面数据表示。5.根据权利要求1所述的一种椎弓根螺钉路径自动规划方法，其特征在于，S103中所述根据分割结果建立脊椎坐标系，包括：定义脊椎坐标系原点为脊椎的中心点，脊椎坐标系的z轴平行于椎体中轴线方向，x轴平行于脊椎两侧横突连线方向，y轴平行于脊椎横断面对称轴。6.根据权利要求1所述的一种椎弓根螺钉路径自动规划方法，其特征在于，S103中所述主成分分析坐标正位，包括：通过指定脊椎分割结果的表面数据的边界计算VOI的中心和三个轴方向上的长度，其中VOI为感兴趣体积；从分割结果的二值图像中裁剪出只包含指定脊椎的二值图像；统计在RAS坐标系下指定脊椎二值图像中体素值为1的所有坐标，并以这些坐标作为PCA算法的输入，计算脊椎点坐标的三个特征向量，其中PCA算法为主成分分析算法；根据三个特征向量与RAS坐标系轴方向角度最小原则确定指定脊椎的新的坐标系以及坐标轴的方向；记指定脊椎新坐标系的单位向量为/＞，在RAS坐标系下脊椎的中心点记为center，坐标为/＞，取VOI的中心点坐标，记VOI的表示为，则center的坐标计算为:；其中，分别为VOI在RAS坐标系下x轴上的最小值和最大值，/＞分别为VOI在RAS坐标系下y轴上的最小值和最大值，/＞分别为VOI在RAS坐标系下z轴上的最小值和最大值；关于脊椎中心的平移变换矩阵和/＞表达式如下：；计算RAS坐标系与指定脊椎新坐标系之间的变换/＞：；其中；变换的计算包含两个平移和一个旋转，其中/＞和/＞分别表示将原RAS坐标系原点平移到目标坐标系原点的变换矩阵和将目标坐标系原点平移到原RAS坐标系原点的变换矩阵；/＞是将原图像的坐标系方向旋转到新坐标系/＞方向的旋转变换矩阵，为指定脊椎新坐标系/＞的单位向量的转置矩阵。7.根据权利要求6所述的一种椎弓根螺钉路径自动规划方法，其特征在于，S103中所述表面数据分析坐标正位，包括：通过RAS坐标系与指定脊椎新坐标系之间的转换得到旋转VOI；通过旋转VOI从原分割结果中裁剪图像，获得新的脊椎分割结果的二值图像，在IJK坐标系下记新的脊椎分割结果的二值图像的数据中心为，图像尺寸为/＞，其中IJK坐标系是像素/体素坐标系，单位为像素/体素；获取新裁剪的脊椎分割结果的二值图像的IJK坐标到RAS坐标的转换矩阵M；通过对新的脊椎分割结果的二值图像的YOZ平面的右侧的数据逐列扫描分析，第一个非零点索引记为/＞，对新分割结果二值图像/＞左侧数据置零，得到脊椎仅包含椎体的图像；对所述椎体图像沿着IJK坐标系的x轴方向提取的切片，并生成所述椎体图像的矢状面梯度图像，结合切片的索引组成三维图像中的IJK坐标/＞，通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为/＞，对/＞的所有点做直线拟合，得到拟合直线/＞和直线方向向量/＞；对所述椎体图像沿着IJK坐标系的y轴方向提取的切片，并生成所述椎体图像的冠状面梯度图像，结合切片的索引组成三维图像中的IJK坐标/＞，通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为/＞，对/＞的所有点做直线拟合，得到拟合直线/＞和方向向量/＞；通过向量叉乘得到垂直于椎体上平面的方向向量，对向量/＞单位化得到法向量/＞：；分别计算脊椎正位坐标系下x轴方向的方向向量和单位向量/＞，以及y轴方向的方向向量/＞和单位向量/＞；建立以指定脊椎的质心为原点，为三个坐标轴方向向量的新坐标系/＞；从原始SAR坐标系到脊椎新坐标系的变换矩阵/＞为：；其中；变换的计算包含两个平移和一个旋转，其中/＞和/＞分别表示将原RAS坐标系原点平移到目标坐标系原点的变换矩阵和将目标坐标系原点平移到原RAS坐标系原点的变换矩阵；/＞是将原图像的坐标系方向旋转到新坐标系/＞方向的旋转变换矩阵，/＞为指定脊椎新坐标系/＞的单位向量的转置矩阵。8.根据权利要求7所述的一种椎弓根螺钉路径自动规划方法，其特征在于，对所述椎体图像沿着IJK坐标系的x轴方向提取的切片，并生成所述椎体图像的矢状面梯度图像，结合切片的索引组成三维图像中的IJK坐标/＞，通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为/＞，对/＞的所有点做直线拟合，得到拟合直线和直线方向向量/＞，包括：对所述椎体图像沿着IJK坐标系的x轴方向提取的切片，得到椎体矢状面二值图像，并对椎体矢状面二值图像计算水平方向的梯度，生成水平方向的矢状面梯度图像，矢状面梯度图像的边缘数值为1；获取所述矢状面梯度图像中值为1的最大连通域，取得其坐标值，并结合切片的索引组成三维图像中的IJK坐标/＞，记获取到的所有点为/＞；通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为；对的所有点做直线拟合，拟合的直线是y轴方向的，所以直线方程以y为基底，直线方程如下：；其中，是直线的参数，通过使用/＞点根据下面的方程计算得到：；其中是/＞中点/＞的坐标，n为点的个数；通过求解上述方程组得到拟合直线和直线方向向量/＞。9.根据权利要求7所述的一种椎弓根螺钉路径自动规划方法，其特征在于，对所述椎体图像沿着IJK坐标系的y轴方向提取的切片，并生成所述椎体图像的冠状面梯度图像，结合切片的索引组成三维图像中的IJK坐标/＞，通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为/＞，对/＞的所有点做直线拟合，得到拟合直线/＞和方向向量/＞，包括：对所述椎体图像沿着IJK坐标系的y轴方向提取的切片，得到椎体冠状面图像，并对椎体冠状面图像计算水平方向的梯度，生成水平方向的冠状面梯度图像，冠状面梯度图像的边缘数值为1；获取所述冠状面梯度图像中值为1的最大连通域，取得其坐标值，并结合切片的索引组成三维图像中的IJK坐标/＞，记获取到的所有的点为/＞；通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为；对中所有的点做直线拟合，拟合的直线是x轴方向，所以直线方程以x为基底，直线方程如下：；其中，是直线的参数，通过使用/＞点根据下面的方程计算得到：；其中是/＞中点/＞的坐标，n为点的个数；通过求解上述方程组得到拟合直线和方向向量/＞。10.根据权利要求7所述的一种椎弓根螺钉路径自动规划方法，其特征在于，分别计算脊椎正位坐标系下x轴方向的方向向量和单位向量/＞，以及y轴方向的方向向量/＞和单位向量/＞，包括：对脊椎按照截取横断面，逐行扫描数据，分别标记每一行中数值为1的起点和终点/＞；定义为横断面上的分割结果中轴线，记录所有的/＞和行数r存储到/＞中，如果一行中不存在数值为1的点则不记录；遍历所有行后中存储的是IJK坐标系下的坐标/＞，添加截取层片的索引可以组成IJK坐标系下的坐标/＞，即/＞；记获取到的所有的点为，通过转换矩阵M将IJK坐标系下的坐标转换成RAS坐标系下的坐标，转换后的坐标记为/＞；对中所有的点做直线拟合，建立以y为基底的直线方程组，代入/＞坐标，求解直线方程组，得到对应的拟合直线的直线方程；记拟合直线的方向向量为，脊椎正位坐标系下x轴方向向量为/＞，对向量/＞单位化，得到脊椎的x轴方向单位向量/＞：；记脊椎正位坐标系下y轴方向向量为，对向量/＞单位化，得到脊椎的y轴方向单位向量/＞：。11.根据权利要求7所述的一种椎弓根螺钉路径自动规划方法，其特征在于，S104中所述在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径，包括：将变换矩阵施加到指定脊椎的旋转VOI上，得到带变换的VOI；通过带变换的VOI裁剪原分割结果的二值图像，得到新的裁剪图像；提取新裁剪图像的中间的矢状面层片，并逐行扫描确定椎孔y轴方向的起始索引和/＞，通过起始索引计算中间索引/＞；获取索引为的冠状面层片，即椎弓根区域的冠状面层片；将所述冠状面层片的右半侧置零，求取左侧椎弓根层片上的质心点，对左椎弓根质心点取中位数索引的点作为左侧椎弓根螺钉路径上的一个点，记为/＞，取脊椎坐标系y轴与脊椎前侧的交点作为左侧椎弓根路径上的另一个点，记为/＞，以/＞和/＞两个点作为左侧椎弓根螺钉路径上的两个点绘制直线/＞；将所述冠状面层片的左半侧置零，求取右侧椎弓根层片上的质心点，对右椎弓根质心点取中位数索引的点作为右侧椎弓根螺钉路径上的一个点，记为/＞，取脊椎坐标系y轴与脊椎前侧的交点作为右侧椎弓根路径上的另一个点，记为/＞，以/＞和/＞两个点作为右侧椎弓根螺钉路径上的两个点绘制直线/＞；根据两条直线的方向确定椎弓根螺钉的放置；其中，左侧椎弓根螺钉路径直线与脊椎表面数据后侧的交点记为/＞，记左侧椎弓根螺钉帽底部中心坐标为/＞，则左侧椎弓根螺钉放置就是将左侧椎弓根螺钉的点/＞移动到位置/＞，并旋转左侧椎弓根螺钉，使左侧椎弓根螺钉的钉头朝向左侧椎弓根螺钉路径指向的一端，将左侧椎弓根螺钉路径负方向表示为/＞，左侧椎弓根螺钉帽豁口方向的设置为与脊椎的x轴和左侧椎弓根螺钉路径方向垂直；右侧椎弓根螺钉路径直线与脊椎表面数据后侧的交点记为/＞，记右侧椎弓根螺钉帽底部中心坐标为/＞，则右侧椎弓根螺钉放置就是将右侧椎弓根螺钉的点/＞移动到位置，并旋转右侧椎弓根螺钉，使右侧椎弓根螺钉的钉头朝向右侧椎弓根螺钉路径指向/＞的一端，将右侧椎弓根螺钉路径负方向表示为/＞，右侧椎弓根螺钉帽豁口方向的设置为与脊椎的x轴和右侧椎弓根螺钉路径方向垂直。12.根据权利要求11所述的一种椎弓根螺钉路径自动规划方法，其特征在于，S105中所述根据规划的路径计算椎弓根螺钉位姿变换，完成椎弓根螺钉路径规划，包括：针对左侧椎弓根螺钉的位姿变换：计算左侧椎弓根螺钉放置时的变换矩阵：；其中为平移变换，平移的值为/＞:；其中，为交点/＞的x轴坐标值，/＞为交点/＞的y轴坐标值，/＞为交点/＞的z轴坐标值；为平移变换，平移的值为/＞；；其中，为/＞的x轴坐标值，/＞为/＞的y轴坐标值，/＞为/＞的z轴坐标值；为将左侧椎弓根螺钉由初始姿态旋转到目标姿态的旋转变换；左侧椎弓根螺钉初始姿态为各个轴与RAS坐标轴相同，其中左侧椎弓根螺钉的钉头为坐标系原点，左侧椎弓根螺钉的钉长为，左侧椎弓根螺钉的钉帽豁口方向为x轴方向，左侧椎弓根螺钉帽底部中心坐标/＞为/＞，左侧椎弓根螺钉的目标姿态为/＞；根据左侧椎弓根螺钉路径方向向量和右侧椎弓根螺钉路径方向向量/＞，计算这两个向量的法向量/＞，记中间法向量/＞，当前路径为左侧时/＞，当前路径为右侧时，记/＞与/＞叉乘得到的向量为/＞；通过下述公式计算左侧椎弓根螺钉的目标姿态和/＞：；同理，计算右侧椎弓根螺钉的位姿变换；椎弓根螺钉长度推荐，根据左右两侧椎弓根螺钉路径与脊椎的交点确定路径长度，推荐合适的椎弓根螺钉模型，完成椎弓根螺钉路径规划。13.一种椎弓根螺钉路径自动规划装置，其特征在于，包括：质心检测模块，通过质心检测神经网络模型对包含脊椎的CT图像进行检测，获取CT图像中所有脊椎的质心检测结果；分割模块，以单个指定脊椎的质心为中心，指定尺寸为半径裁剪脊椎图像，以裁剪的图像和指定脊椎的质心点生成的高斯图像为输入，通过分割神经网络实现指定脊椎的自动分割；建立坐标系模块，根据分割结果建立脊椎坐标系，并通过两次脊椎坐标系正位，建立正位后的脊椎坐标系；生成路径模块，在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径；位姿变换模块，根据规划的路径计算椎弓根螺钉位姿变换，完成椎弓根螺钉路径规划。14.一种椎弓根螺钉路径自动规划设备，其特征在于，所述设备包括：处理器、存储器以及存储在所述存储器中并可在所述处理器上运行的计算机程序指令，其中，所述处理器用于执行存储器中存储的计算机程序指令，以实现权利要求1至12中任意一项椎弓根螺钉路径自动规划方法。15.一种椎弓根螺钉路径自动规划存储介质，其特征在于，所述计算机存储介质上存储有计算机程序指令，所述计算机程序指令被处理器执行时实现权利要求1至12中任意一项椎弓根螺钉路径自动规划方法。
说明书desc
技术领域本发明涉及医学图像处理领域，具体指一种椎弓根螺钉路径自动规划方法、装置、设备及存储介质。背景技术目前，在人体脊柱手术中，椎弓根螺钉内固定技术有着非常重要的地位，被认为是一种最为稳定的脊柱固定方式。此种固定技术要求椎弓根螺钉必须移动在椎弓根内部；一旦穿破椎弓根，极可能引起严重的损害，如脊髓、椎血管的损伤，甚至危害到病人生命安全。因此，确保椎弓根螺钉的准确置钉成为学者们研究的目标。专利CN115689971A提供了一种基于深度学习的椎弓根植钉通道规划方法及装置，通过以下三个流程获取椎弓根植钉通道：提取流程，提取脊柱CT图像中的椎弓根CT图像；分层流程，沿椎弓根横截面对所述椎弓根CT图像进行切片分层处理，确认椎弓根边界，依次得到多层椎弓根二维图像；规划流程，依次获取所述椎弓根二值图像的中心点，拟合所述中心点。上述方法实现了对于植钉通道的自动规划，但是没有考虑脊椎正位问题，导致可能提取到的椎弓根CT数据包含椎体和棘突部分，从而引发计算错误。专利CN115760813A提供了一种螺钉通道生成方法、装置、设备、介质和程序产品，通过对目标医学图像分割处理，获得目标三维图像；在所述三维图像中确定多个符合安全条件的可行性螺钉通道，在可行性通道附近确定优化螺钉通道，从多个优化螺钉通道中确定目标螺钉通道，但是该方法遍历所有的点生成候选可行区域时需要大量计算，降低了运行效率。发明内容本发明的目的在于解决上述背景技术中描述的现有技术方案的缺点，提供一种椎弓根螺钉路径自动规划方法、装置、设备及存储介质，所述方法通过两次脊椎坐标系正位，避免了由于提取到的椎弓根CT数据包含椎体和棘突部分导致计算错误的问题，同时增加了对椎弓根螺钉的推荐设计，实现了对于椎弓根螺钉路径的自动规划。本发明通过以下技术方案予以实现：一种椎弓根螺钉路径自动规划方法，包括以下步骤：S101，通过质心检测神经网络模型对包含脊椎的CT图像进行检测，获取CT图像中所有脊椎的质心检测结果；S102，以单个指定脊椎的质心为中心，指定尺寸为半径裁剪脊椎图像，以裁剪的图像和指定脊椎的质心点生成的高斯图像为输入，通过分割神经网络实现指定脊椎的自动分割；S103，根据分割结果建立脊椎坐标系，并通过两次脊椎坐标系正位，建立正位后的脊椎坐标系；其中，两次脊椎坐标系正位包括主成分分析坐标正位和表面数据分析坐标正位；S104，在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径；S105，根据规划的路径计算椎弓根螺钉位姿变换，完成椎弓根螺钉路径规划。进一步地，S101中所述通过质心检测神经网络模型对包含脊椎的CT图像进行检测，获取CT图像中所有脊椎的质心检测结果，包括：获取包含脊椎的CT图像；由于输入CT图像包含多个椎骨，尺寸较大，根据CT图像大小裁剪有重叠的多个图像块，并输入到质心检测神经网络模型；质心检测神经网络模型对每个图像块输出对应的用多个通道图像表示的多个类别的质心检测结果；对每个通道按图像块重叠部分预测结果最大值合并，最后取每个通道最大值坐标作为当前类别的质心点，即可得到CT图像中每个脊椎的质心检测结果。进一步地，所述质心检测网络采用空间配置网络模型。进一步地，S102中所述分割神经网络采用U-Net模型，将裁剪的图像和指定脊椎的质心点生成的高斯图像输入到分割神经网络后，对分割神经网络输出的预测结果以0.5为阈值进行二值化得到分割结果，分割结果有两种表示方式，分别是二值图像表示和表面数据表示。进一步地，S103中所述根据分割结果建立脊椎坐标系，包括：定义脊椎坐标系原点为脊椎的中心点，脊椎坐标系的z轴平行于椎体中轴线方向，x轴平行于脊椎两侧横突连线方向，y轴平行于脊椎横断面对称轴。进一步地，S103中所述主成分分析坐标正位，包括：通过指定脊椎分割结果的表面数据的边界计算VOI的中心和三个轴方向上的长度，其中VOI为感兴趣体积；从分割结果的二值图像中裁剪出只包含指定脊椎的二值图像；统计在RAS坐标系下指定脊椎二值图像中体素值为1的所有坐标，并以这些坐标作为PCA算法的输入，计算脊椎点坐标的三个特征向量，其中PCA算法为主成分分析算法；根据三个特征向量与RAS坐标系轴方向角度最小原则确定指定脊椎的新的坐标系以及坐标轴的方向；记指定脊椎新坐标系的单位向量为/＞，在RAS坐标系下脊椎的中心点记为center，坐标为/＞，取VOI的中心点坐标，记VOI的表示为，则center的坐标计算为:；其中，分别为VOI在RAS坐标系下x轴上的最小值和最大值，/＞分别为VOI在RAS坐标系下y轴上的最小值和最大值，/＞分别为VOI在RAS坐标系下z轴上的最小值和最大值；关于脊椎中心的平移变换矩阵和/＞表达式如下：；计算RAS坐标系与指定脊椎新坐标系之间的变换/＞：；其中；变换的计算包含两个平移和一个旋转，其中/＞和/＞分别表示将原RAS坐标系原点平移到目标坐标系原点的变换矩阵和将目标坐标系原点平移到原RAS坐标系原点的变换矩阵；/＞是将原图像的坐标系方向旋转到新坐标系/＞方向的旋转变换矩阵，/＞为指定脊椎新坐标系/＞的单位向量的转置矩阵。进一步地，S103中所述表面数据分析坐标正位，包括：通过RAS坐标系与指定脊椎新坐标系之间的转换得到旋转VOI；通过旋转VOI从原分割结果中裁剪图像，获得新的脊椎分割结果的二值图像，在坐标系下记新的脊椎分割结果的二值图像的数据中心为，图像尺寸为/＞，其中IJK坐标系是像素/体素坐标系，单位为像素/体素；获取新裁剪的脊椎分割结果的二值图像IJK坐标到RAS坐标的转换矩阵M；通过对新的脊椎分割结果的二值图像的YOZ平面的右侧的数据逐列扫描分析，第一个非零点索引记为/＞，对新分割结果二值图像/＞左侧数据置零，得到脊椎仅包含椎体的图像；对所述椎体图像沿着IJK坐标系的x轴方向提取的切片，并生成所述椎体图像的矢状面梯度图像，结合切片的索引组成三维图像中的IJK坐标/＞，通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为/＞，对/＞的所有点做直线拟合，得到拟合直线/＞和直线方向向量/＞；对所述椎体图像沿着IJK坐标系的y轴方向提取的切片，并生成所述椎体图像的冠状面梯度图像，结合切片的索引组成三维图像中的IJK坐标/＞，通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为/＞，对/＞的所有点做直线拟合，得到拟合直线/＞和方向向量/＞；通过向量叉乘得到垂直于椎体上平面的方向向量，对向量/＞单位化得到法向量：；分别计算脊椎正位坐标系下x轴方向的方向向量和单位向量/＞，以及y轴方向的方向向量/＞和单位向量/＞；建立以指定脊椎的质心为原点，为三个坐标轴方向向量的新坐标系；从原始SAR坐标系到脊椎新坐标系的变换矩阵/＞为：；其中；变换的计算包含两个平移和一个旋转，其中/＞和/＞分别表示将原RAS坐标系原点平移到目标坐标系原点的变换矩阵和将目标坐标系原点平移到原RAS坐标系原点的变换矩阵；/＞是将原图像的坐标系方向旋转到新坐标系/＞方向的旋转变换矩阵，/＞为指定脊椎新坐标系/＞的单位向量的转置矩阵。进一步地，对所述椎体图像沿着IJK坐标系的x轴方向提取的切片，并生成所述椎体图像的矢状面梯度图像，结合切片的索引组成三维图像中的IJK坐标/＞，通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为/＞，对/＞的所有点做直线拟合，得到拟合直线/＞和直线方向向量/＞，包括：对所述椎体图像沿着IJK坐标系的x轴方向提取的切片，得到椎体矢状面二值图像，并对椎体矢状面二值图像计算水平方向的梯度，生成水平方向的矢状面梯度图像，矢状面梯度图像的边缘数值为1；获取所述矢状面梯度图像中值为1的最大连通域，取得其坐标值，并结合切片的索引组成三维图像中的IJK坐标/＞，记获取到的所有点为/＞；通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为；对的所有点做直线拟合，拟合的直线是y轴方向的，所以直线方程以y为基底，直线方程如下：；其中，是直线的参数，通过使用/＞点根据下面的方程计算得到：；其中是/＞中点/＞的坐标，n为点的个数；通过求解上述方程组得到拟合直线和直线方向向量/＞。进一步地，对所述椎体图像沿着IJK坐标系的y轴方向提取的切片，并生成所述椎体图像的冠状面梯度图像，结合切片的索引组成三维图像中的IJK坐标/＞，通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为/＞，对/＞的所有点做直线拟合，得到拟合直线/＞和方向向量/＞，包括：对所述椎体图像沿着IJK坐标系的y轴方向提取的切片，得到椎体冠状面图像，并对椎体冠状面图像计算水平方向的梯度，生成水平方向的冠状面梯度图像，冠状面梯度图像的边缘数值为1；获取所述冠状面梯度图像中值为1的最大连通域，取得其坐标值，并结合切片的索引组成三维图像中的IJK坐标/＞，记获取到的所有的点为/＞；通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为；对中所有的点做直线拟合，拟合的直线是x轴方向，所以直线方程以x为基底，直线方程如下：；其中，是直线的参数，通过使用/＞点根据下面的方程计算得到：；其中是/＞中点/＞的坐标，n为点的个数；通过求解上述方程组得到拟合直线和方向向量/＞。进一步地，分别计算脊椎正位坐标系下x轴方向的方向向量和单位向量/＞，以及y轴方向的方向向量/＞和单位向量/＞，包括：对脊椎按照截取横断面，逐行扫描数据，分别标记每一行中数值为1的起点和终点/＞；定义为横断面上的分割结果中轴线，记录所有的和行数r存储到中，如果一行中不存在数值为1的点则不记录；遍历所有行后中存储的是IJK坐标系下的坐标/＞，添加截取层片的索引可以组成IJK坐标系下的坐标/＞，即/＞；记获取到的所有的点为，通过转换矩阵M将IJK坐标系下的坐标转换成RAS坐标系下的坐标，转换后的坐标记为/＞；对中所有的点做直线拟合，建立以y为基底的直线方程组，代入/＞坐标，求解直线方程组，得到对应的拟合直线的直线方程；记拟合直线的方向向量为，脊椎正位坐标系下x轴方向向量为/＞，对向量/＞单位化，得到脊椎的x轴方向单位向量/＞：；记脊椎正位坐标系下y轴方向向量为，对向量/＞单位化，得到脊椎的y轴方向单位向量/＞：。进一步地，S104中所述在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径，包括：将变换矩阵施加到指定脊椎的旋转VOI上，得到带变换的VOI；通过带变换的VOI裁剪原分割结果的二值图像，得到新的裁剪图像；提取新裁剪图像的中间的矢状面层片，并逐行扫描确定椎孔y轴方向的起始索引和/＞，通过起始索引计算中间索引/＞；获取索引为的冠状面层片，即椎弓根区域的冠状面层片；将所述冠状面层片的右半侧置零，求取左侧椎弓根层片上的质心点，对左椎弓根质心点取中位数索引的点作为左侧椎弓根螺钉路径上的一个点，记为/＞，取脊椎坐标系y轴与脊椎前侧的交点作为左侧椎弓根路径上的另一个点，记为/＞，以/＞和/＞两个点作为左侧椎弓根螺钉路径上的两个点绘制直线/＞；将所述冠状面层片的左半侧置零，求取右侧椎弓根层片上的质心点，对右椎弓根质心点取中位数索引的点作为右侧椎弓根螺钉路径上的一个点，记为/＞，取脊椎坐标系y轴与脊椎前侧的交点作为右侧椎弓根路径上的另一个点，记为/＞，以/＞和/＞两个点作为右侧椎弓根螺钉路径上的两个点绘制直线/＞；根据两条直线的方向确定椎弓根螺钉的放置；其中，左侧椎弓根螺钉路径直线与脊椎表面数据后侧的交点记为/＞，记左侧椎弓根螺钉帽底部中心坐标为/＞，则左侧椎弓根螺钉放置就是将左侧椎弓根螺钉的点/＞移动到位置/＞，并旋转左侧椎弓根螺钉，使左侧椎弓根螺钉的钉头朝向左侧椎弓根螺钉路径指向/＞的一端，将左侧椎弓根螺钉路径负方向表示为/＞，左侧椎弓根螺钉帽豁口方向的设置为与脊椎的x轴和左侧椎弓根螺钉路径方向垂直；右侧椎弓根螺钉路径直线与脊椎表面数据后侧的交点记为/＞，记右侧椎弓根螺钉帽底部中心坐标为/＞，则右侧椎弓根螺钉放置就是将右侧椎弓根螺钉的点/＞移动到位置/＞，并旋转右侧椎弓根螺钉，使右侧椎弓根螺钉的钉头朝向右侧椎弓根螺钉路径指向/＞的一端，将右侧椎弓根螺钉路径负方向表示为/＞，右侧椎弓根螺钉帽豁口方向的设置为与脊椎的x轴和右侧椎弓根螺钉路径方向垂直；进一步地，S105中所述根据规划的路径计算椎弓根螺钉位姿变换，完成椎弓根螺钉路径规划，包括：针对左侧椎弓根螺钉的位姿变换：计算左侧椎弓根螺钉放置时的变换矩阵：；其中为平移变换，平移的值为/＞:；其中，为交点/＞的x轴坐标值，/＞为交点/＞的y轴坐标值，/＞为交点的z轴坐标值；为平移变换，平移的值为/＞；其中，为/＞的x轴坐标值，/＞为/＞的y轴坐标值，/＞为/＞的z轴坐标值；为将左侧椎弓根螺钉由初始姿态旋转到目标姿态的旋转变换；左侧椎弓根螺钉初始姿态为各个轴与RAS坐标轴相同，其中左侧椎弓根螺钉的钉头为坐标系原点，左侧椎弓根螺钉的钉长为，左侧椎弓根螺钉的钉帽豁口方向为x轴方向，左侧椎弓根螺钉帽底部中心坐标/＞为/＞，左侧椎弓根螺钉的目标姿态为；根据左侧椎弓根螺钉路径方向向量和右侧椎弓根螺钉路径方向向量/＞，计算这两个向量的法向量/＞，记中间法向量/＞，当前路径为左侧时/＞，当前路径为右侧时/＞，记/＞与/＞叉乘得到的向量为/＞；通过下述公式计算左侧椎弓根螺钉的目标姿态和/＞：；同理，计算右侧椎弓根螺钉的位姿变换；椎弓根螺钉长度推荐，根据左右两侧椎弓根螺钉路径与脊椎的交点确定路径长度，推荐合适的椎弓根螺钉模型，完成椎弓根螺钉路径规划。第二方面，本发明提供一种椎弓根螺钉路径自动规划装置，该装置包括：质心检测模块，通过质心检测神经网络模型对包含脊椎的CT图像进行检测，获取CT图像中所有脊椎的质心检测结果；分割模块，以单个指定脊椎的质心为中心，指定尺寸为半径裁剪脊椎图像，以裁剪的图像和指定脊椎的质心点生成的高斯图像为输入，通过分割神经网络实现指定脊椎的自动分割；建立坐标系模块，根据分割结果建立脊椎坐标系，并通过两次脊椎坐标系正位，建立正位后的脊椎坐标系；生成路径模块，在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径；位姿变换模块，根据规划的路径计算椎弓根螺钉位姿变换，完成椎弓根螺钉路径规划。第三方面，本发明提供一种椎弓根螺钉路径自动规划设备，所述设备包括：处理器、存储器以及存储在所述存储器中并可在所述处理器上运行的计算机程序指令，其中，所述处理器用于执行存储器中存储的计算机程序指令，以实现上述所述椎弓根螺钉路径自动规划方法。第四方面，本发明提供一种椎弓根螺钉路径自动规划存储介质所述计算机存储介质上存储有计算机程序指令，所述计算机程序指令被处理器执行时实现上述所述椎弓根螺钉路径自动规划方法。本发明提供了一种椎弓根螺钉路径自动规划方法、装置、设备及存储介质，以脊椎CT图像作为输入，通过图像分割，生成脊椎分割结果，根据分割结果建立脊椎坐标系，通过两次脊椎坐标系正位，在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径。在求得的路径上根据约束条件完成椎弓根螺钉路径规划。与现有技术相比较，本发明通过两次脊椎坐标系正位，避免了由于提取到的椎弓根CT数据包含椎体和棘突部分导致计算错误的问题，同时增加了对椎弓根螺钉的推荐设计，实现了对于椎弓根螺钉路径的自动规划。附图说明下面将参考附图来描述本发明示例性实施例的特征、优点和技术效果。图1是本发明实施例提供的椎弓根螺钉路径自动规划方法流程示意图；图2是本发明实施例提供的建立脊椎坐标系示意图；图3是本发明实施例提供的生成VOI示意图；图4是本发明实施例提供的PCA算法生成坐标系三个主轴方向的示意图；图5是本发明实施例提供的原始VOI与旋转VOI的示意图；图6是本发明实施例提供的通过旋转VOI从原分割结果中裁剪图像的示意图；图7是本发明实施例提供的椎体矢状面二值图像的示意图；图8是本发明实施例提供的椎体矢状面梯度图像的示意图；图9是本发明实施例提供的拟合直线示意图；图10是本发明实施例提供的拟合直线示意图；图11是本发明实施例提供的椎体上平面法向量示意图；图12是本发明实施例提供的脊椎横断面拟合对称轴直线示意图；图13是本发明实施例提供的第二次正位得到的脊椎坐标系的示意图；图14是本发明实施例提供的获取左右椎弓根冠状面层片并计算质心点示意图；图15是本发明实施例提供的椎弓根螺钉路径示意图；图16是本发明实施例提供的椎弓根螺钉放置示意图；图17是本发明实施例提供的椎弓根螺钉路径自动规划装置示意图；图18是本发明实施例提供的一种计算设备的结构示意图。具体实施方式下面将详细描述本公开的各个方面的特征和示例性实施例，为了使本公开 的目的、技术方案及优点更加清楚明白，以下结合附图及具体实施例，对本公开进行进一步详细描述。应理解，此处所描述的具体实施例仅意在解释本公开， 而不是限定本公开。对于本领域技术人员来说，本公开可以在不需要这些具体 细节中的一些细节的情况下实施。下面对实施例的描述仅仅是为了通过示出本 公开的示例来提供对本公开更好的理解。需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将 一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些 实体或操作之间存在任何这种实际的关系或者顺序。而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。在没有更多限制的情况下，由语句“包括……”限定的要素，并不排除在包括所述要素的过程、方法、物品或者设备中还存在另外的相同要素。为了更好地理解本发明，下面结合附图对本发明实施例进行详细描述。图1是本发明实施例提供的椎弓根螺钉路径自动规划方法流程示意图。如图1所示，本发明提供一种椎弓根螺钉路径自动规划方法，包括以下步骤：S101，通过质心检测神经网络模型对包含脊椎的CT图像进行检测，获取CT图像中所有脊椎的质心检测结果；S102，以单个指定脊椎的质心为中心，指定尺寸为半径裁剪脊椎图像，以裁剪的图像和指定脊椎的质心点生成的高斯图像为输入，通过分割神经网络实现指定脊椎的自动分割；S103，根据分割结果建立脊椎坐标系，并通过两次脊椎坐标系正位，建立正位后的脊椎坐标系；其中，两次脊椎坐标系正位包括主成分分析坐标正位和表面数据分析坐标正位；S104，在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径；S105，根据规划的路径计算椎弓根螺钉位姿变换，完成椎弓根螺钉路径规划。作为一种可选的实施方式，S101中所述通过质心检测神经网络模型对包含脊椎的CT图像进行检测，获取CT图像中所有脊椎的质心检测结果，包括：获取包含脊椎的CT图像；由于输入CT图像包含多个椎骨，尺寸较大，根据CT图像大小裁剪有重叠的多个图像块，并输入到质心检测神经网络模型；质心检测神经网络模型对每个图像块输出对应的用多个通道图像表示的多个类别的质心检测结果；对每个通道按图像块重叠部分预测结果最大值合并，最后取每个通道最大值坐标作为当前类别的质心点，即可得到CT图像中每个脊椎的质心检测结果。作为一种可选的实施方式，所述质心检测网络采用空间配置网络模型。作为一种可选的实施方式，所述质心检测网络也可以采用其他任意可行的网络模型结构。作为一种可选的实施方式，S102中所述分割神经网络采用U-Net模型，将裁剪的图像和指定脊椎的质心点生成的高斯图像输入到分割神经网络后，对分割神经网络输出的预测结果以0.5为阈值进行二值化得到分割结果，分割结果有两种表示方式，分别是二值图像表示和表面数据表示。作为一种可选的实施方式，S103中所述根据分割结果建立脊椎坐标系，包括：如图2所示，定义脊椎坐标系原点为脊椎的中心点，脊椎坐标系的z轴平行于椎体中轴线方向，x轴平行于脊椎两侧横突连线方向，y轴平行于脊椎横断面对称轴。作为一种可选的实施方式，S103中所述主成分分析坐标正位，包括：通过指定脊椎分割结果的表面数据的边界计算VOI的中心和三个轴方向上的长度，如图3所示，其中VOI为感兴趣体积；从分割结果的二值图像中裁剪出只包含指定脊椎的二值图像；统计在RAS坐标系下指定脊椎二值图像中体素值为1的所有坐标，并以这些坐标作为PCA算法的输入，计算脊椎点坐标的三个特征向量，其中PCA算法为主成分分析算法；如图4所示，根据三个特征向量与RAS坐标系轴方向角度最小原则确定指定脊椎的新的坐标系以及坐标轴的方向；通过RAS坐标系计算新脊椎坐标系称之为第一次坐标正位，如图5所示，图5显示了原始VOI与变换后的VOI，称之为旋转VOI。其中原始VOI与图3中的VOI为同一个VOI，同时将两者绘制在图5中方便说明二者之间存在旋转关系。记指定脊椎新坐标系的单位向量为/＞，在RAS坐标系下脊椎的中心点记为center，坐标为/＞，取VOI的中心点坐标，记VOI的表示为，则center的坐标计算为:；其中，分别为VOI在RAS坐标系下x轴上的最小值和最大值，/＞分别为VOI在RAS坐标系下y轴上的最小值和最大值，/＞分别为VOI在RAS坐标系下z轴上的最小值和最大值；关于脊椎中心的平移变换矩阵和/＞表达式如下：/＞；计算RAS坐标系与指定脊椎新坐标系之间的变换/＞：；其中；变换的计算包含两个平移和一个旋转，其中/＞和/＞分别表示将原RAS坐标系原点平移到目标坐标系原点的变换矩阵和将目标坐标系原点平移到原RAS坐标系原点的变换矩阵；/＞是将原图像的坐标系方向旋转到新坐标系/＞方向的旋转变换矩阵，/＞为指定脊椎新坐标系/＞的单位向量的转置矩阵。作为一种可选的实施方式，S103中所述表面数据分析坐标正位，包括：通过RAS坐标系与指定脊椎新坐标系之间的转换得到旋转VOI；通过图5所示的旋转VOI从原分割结果中裁剪图像，获得如图6中的所示的新的脊椎分割结果的二值图像；在坐标系下记新的脊椎分割结果的二值图像的数据中心为，图像尺寸为/＞，其中IJK坐标系是像素/体素坐标系，单位为像素/体素；获取图6中新裁剪的脊椎分割结果的二值图像的IJK坐标到RAS坐标的转换矩阵M；通过对新的脊椎分割结果的二值图像的YOZ平面的右侧的数据逐列扫描分析，第一个非零点索引记为/＞，对新分割结果二值图像/＞左侧数据置零，得到脊椎仅包含椎体的图像；对所述椎体图像沿着IJK坐标系的x轴方向提取的切片，得到如图7所示的椎体矢状面二值图像，并对椎体矢状面二值图像计算水平方向的梯度，生成如图8所示的水平方向的矢状面梯度图像，矢状面梯度图像的边缘数值为1；获取所述矢状面梯度图像中值为1的最大连通域，取得其坐标值，并结合切片的索引组成三维图像中的IJK坐标/＞，记获取到的所有点为/＞；通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为；/＞对的所有点做直线拟合，拟合的直线是y轴方向的，所以直线方程以y为基底，直线方程如下：；其中，是直线的参数，通过使用/＞点根据下面的方程计算得到：；其中是/＞中点/＞的坐标，n为点的个数；通过求解上述方程组得到如图9所示的拟合直线和直线方向向量/＞。对所述椎体图像沿着IJK坐标系的y轴方向提取的切片，得到椎体冠状面图像，并对椎体冠状面图像计算水平方向的梯度，生成水平方向的冠状面梯度图像，冠状面梯度图像的边缘数值为1；获取所述冠状面梯度图像中值为1的最大连通域，取得其坐标值，并结合切片的索引组成三维图像中的坐标IJK，记获取到的所有的点为/＞；通过转换矩阵M将三维图像中的IJK坐标转换成RAS坐标，转换后的坐标记为；对中所有的点做直线拟合，拟合的直线是x轴方向，所以直线方程以x为基底，直线方程如下：；其中，是直线的参数，通过使用/＞点根据下面的方程计算得到：；其中是/＞中点/＞的坐标，n为点的个数；通过求解上述方程组得到如图10所示的拟合直线和方向向量/＞。通过向量叉乘得到如图11所示的垂直于椎体上平面的方向向量，对向量/＞单位化得到法向量/＞：；对脊椎按照截取横断面，逐行扫描数据，分别标记每一行中数值为1的起点/＞和终点/＞；定义为横断面上的分割结果中轴线，记录所有的和行数r存储到/＞中，如果一行中不存在数值为1的点则不记录；遍历所有行后中存储的是IJK坐标系下的坐标/＞，添加截取层片的索引可以组成IJK坐标系下的坐标/＞，即/＞；记获取到的所有的点为，通过转换矩阵M将IJK坐标系下的坐标转换成RAS坐标系下的坐标，转换后的坐标记为/＞；对中所有的点做直线拟合，建立以y为基底的直线方程组，代入/＞坐标，求解直线方程组，得到如图12所示的对应的拟合直线的直线方程；记拟合直线的方向向量为，脊椎正位坐标系下x轴方向向量为/＞，对向量/＞单位化，得到脊椎的x轴方向单位向量/＞：；记脊椎正位坐标系下y轴方向向量为，对向量/＞单位化，得到脊椎的y轴方向单位向量/＞：。通过表面数据分析后坐标正位结果如图13中的直线所示，以指定脊椎的质心为原点，为三个坐标轴方向向量的新坐标系/＞；从原始SAR坐标系到脊椎新坐标系的变换矩阵/＞为：；其中；变换的计算包含两个平移和一个旋转，其中/＞和/＞分别表示将原RAS坐标系原点平移到目标坐标系原点的变换矩阵和将目标坐标系原点平移到原RAS坐标系原点的变换矩阵；/＞是将原图像的坐标系方向旋转到新坐标系/＞方向的旋转变换矩阵，/＞为指定脊椎新坐标系/＞的单位向量的转置矩阵。/＞作为一种可选的实施方式，S104中所述在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径，包括：将变换矩阵施加到指定脊椎的旋转VOI上，得到带变换的VOI；通过带变换的VOI裁剪原分割结果的二值图像，得到新的裁剪图像；提取新裁剪图像的中间的矢状面层片，并逐行扫描确定椎孔y轴方向的起始索引和/＞，通过起始索引计算中间索引/＞；获取索引为的冠状面层片，即椎弓根区域的冠状面层片如图14所示；将所述冠状面层片的右半侧置零，求取左侧椎弓根层片上的质心点，对左椎弓根质心点取中位数索引的点作为左侧椎弓根螺钉路径上的一个点，记为/＞，取脊椎坐标系y轴与脊椎前侧的交点作为左侧椎弓根路径上的另一个点，记为/＞，以/＞和/＞两个点作为左侧椎弓根螺钉路径上的两个点绘制直线/＞；将所述冠状面层片的左半侧置零，求取右侧椎弓根层片上的质心点，对右椎弓根质心点取中位数索引的点作为右侧椎弓根螺钉路径上的一个点，记为/＞，取脊椎坐标系y轴与脊椎前侧的交点作为右侧椎弓根路径上的另一个点，记为/＞，以/＞和/＞两个点作为右侧椎弓根螺钉路径上的两个点绘制直线/＞；根据和/＞两条直线的方向确定椎弓根螺钉的放置；其中，左侧椎弓根螺钉路径直线与脊椎表面数据后侧的交点记为/＞，记左侧椎弓根螺钉帽底部中心坐标为/＞，则左侧椎弓根螺钉放置就是将左侧椎弓根螺钉的点/＞移动到位置/＞，并旋转左侧椎弓根螺钉，使左侧椎弓根螺钉的钉头朝向左侧椎弓根螺钉路径指向/＞的一端，将左侧椎弓根螺钉路径负方向表示为/＞，左侧椎弓根螺钉帽豁口方向的设置为与脊椎的x轴和左侧椎弓根螺钉路径方向垂直；右侧椎弓根螺钉路径直线与脊椎表面数据后侧的交点记为/＞，记右侧椎弓根螺钉帽底部中心坐标为/＞，则右侧椎弓根螺钉放置就是将右侧椎弓根螺钉的点/＞移动到位置/＞，并旋转右侧椎弓根螺钉，使右侧椎弓根螺钉的钉头朝向右侧椎弓根螺钉路径指向/＞的一端，将右侧椎弓根螺钉路径负方向表示为/＞，右侧椎弓根螺钉帽豁口方向的设置为与脊椎的x轴和右侧椎弓根螺钉路径方向垂直；作为一种可选的实施方式，S105中所述根据规划的路径计算椎弓根螺钉位姿变换，完成椎弓根螺钉路径规划，包括：针对左侧椎弓根螺钉的位姿变换：计算左侧椎弓根螺钉放置时的变换矩阵：；/＞其中为平移变换，平移的值为/＞:；其中，为交点/＞的x轴坐标值，/＞为交点/＞的y轴坐标值，/＞为交点的z轴坐标值；为平移变换，平移的值为/＞；；其中，为/＞的x轴坐标值，/＞为/＞的y轴坐标值，/＞为/＞的z轴坐标值；为将左侧椎弓根螺钉由初始姿态旋转到目标姿态的旋转变换；左侧椎弓根螺钉初始姿态为各个轴与RAS坐标轴相同，其中左侧椎弓根螺钉的钉头为坐标系原点，左侧椎弓根螺钉的钉长为，左侧椎弓根螺钉的钉帽豁口方向为x轴方向，左侧椎弓根螺钉帽底部中心坐标/＞为/＞，左侧椎弓根螺钉的目标姿态为；根据左侧椎弓根螺钉路径方向向量和右侧椎弓根螺钉路径方向向量/＞，计算这两个向量的法向量/＞，记中间法向量/＞，当前路径为左侧时/＞，当前路径为右侧时/＞，记/＞与/＞叉乘得到的向量为/＞；通过下述公式计算左侧椎弓根螺钉的目标姿态和/＞：/＞；同理，计算右侧椎弓根螺钉的位姿变换。图16是本发明实施例提供的椎弓根螺钉放置示意图。椎弓根螺钉长度推荐，根据左右两侧椎弓根螺钉路径与脊椎的交点确定路径长度，推荐合适的椎弓根螺钉模型，完成椎弓根螺钉路径规划。第二方面，本发明提供一种椎弓根螺钉路径自动规划装置，如图17所示，该装置包括：质心检测模块1701，通过质心检测神经网络模型对包含脊椎的CT图像进行检测，获取CT图像中所有脊椎的质心检测结果；分割模块1702，以单个指定脊椎的质心为中心，指定尺寸为半径裁剪脊椎图像，以裁剪的图像和指定脊椎的质心点生成的高斯图像为输入，通过分割神经网络实现指定脊椎的自动分割；建立坐标系模块1703，根据分割结果建立脊椎坐标系，并通过两次脊椎坐标系正位，建立正位后的脊椎坐标系；生成路径模块1704，在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径；位姿变换模块1705，根据规划的路径计算椎弓根螺钉位姿变换，完成椎弓根螺钉路径规划。图17所示装置中的各个模块/单元具有实现图1中各个步骤的功能，并能达到其相应的技术效果，为简洁描述，在此不再赘述。如图18所示，本发明还提供一种椎弓根螺钉路径自动规划设备，所述设备包括：处理器1801、存储器1802以及存储在所述存储器中并可在所述处理器1801上运行的计算机程序指令，其中，所述处理器1801用于执行存储器1802中存储的计算机程序指令，以实现上述所述椎弓根螺钉路径自动规划方法。具体地，上述处理器1801可以包括中央处理器，或者特定集成电路，或者可以被配置成实施本发明的一个或多个集成电路。存储器1802可以包括用于数据或指令的大容量存储器。举例来说而非限制，存储器可包括硬盘驱动器、软盘驱动器、闪存、光盘、磁光盘、磁带或通用串行总线驱动器或者两个或更多个以上这些的组合。在一个实例中，存储器1802可以包括可移除或不可移除的介质，或者存储器是非易失性固态存储器。存储器可在综合网关容灾设备的内部或外部。在一个实例中，存储器1802可以是只读存储器。在一个实例中，该ROM可以是掩模编程的ROM、可编程ROM、可擦除PROM、电可擦除PROM、电可改写ROM 或闪存或者两个或更多个以上这些的组合。在一个实例中，存储器1802可以包括只读存储器，随机存取存储器，磁盘存储介质设备，光存储介质设备，闪存设备，电气、光学或其他物理/有形的存储器存储设备。因此，通常，存储器包括一个或多个编码有包括计算机可执行指令的软件的有形计算机可读存储介质，并且当该软件被执行时，其可操作来执行参考根据本公开的一方面的方法所描述的操作。处理器1801通过读取并执行存储器1802中存储的计算机程序指令，以实现图1所示实施例中的方法/步骤，并能达到其相应的技术效果，为简洁描述在此不再赘述。在一个实施例中，计算设备还可包括通信接口1803和总线1804。如图18所示，处理器1801、存储器1802、通信接口1803通过总线1804连接并完成相互间的通信。通信接口1803，主要用于实现本发明中各模块、装置、单元和/或设备之间的通信。总线1804包括硬件、软件或两者，将在线数据流量计费设备的部件彼此耦接在一起。举例来说而非限制，总线可包括加速图形端口或其他图形总线、增强工业标准架构总线、前端总线、超传输互连、工业标准架构总线、无限带宽互连、低引脚数总线、存储器总线、微信道架构 总线、外围组件互连总线、PCI-Express总线、串行高级技术附件总线、视频电子标准协会局部总线或其他合适的总线或者两个或更多个以上这些的组合。在合适的情况下，总线可包括一个或多个总线。尽管本发明描述和示出了特定的总线，但本公开考虑任何合适的总线或互连。另外，结合上述实施例中的椎弓根螺钉路径自动规划方法，本发明还提供了一种计算机存储介质来实现。该计算机存储介质上存储有计算机程序指令，所述计算机程序指令被处理器1801执行时实现上述所述的基于SVM的机械臂变导纳控制方法。本发明实施例提供的计算机存储介质，可以采用一个或多个计算机可读的介质的任意组合。计算机可读介质可以是计算机可读信号介质或者计算机可读存储介质。计算机可读存储介质例如可以是但不限于：电、磁、光、电磁、红外线、或半导体的系统、装置或器件，或者任意以上的组合。计算机可读存储介质的更具体的例子包括：具有一个或多个导线的电连接、便携式计算机磁盘、硬盘、随机存取存储器、只读存储器、可擦式可编程只读存储器、光纤、便携式紧凑磁盘只读存储器、光存储器件、磁存储器件、或者上述的任意合适的组合。在本发明中，计算机可读存储介质可以是任何包含或存储程序的有形介质，该程序可以被指令执行系统、装置或者器件使用或者与其结合使用。本发明提供了一种椎弓根螺钉路径自动规划方法、装置、设备及存储介质，以脊椎CT图像作为输入，通过图像分割，生成脊椎分割结果，根据分割结果建立脊椎坐标系，通过两次脊椎坐标系正位，在正位后的脊椎坐标系下计算椎弓根区域中心，并根据椎弓根区域中心与脊椎椎体前侧中心生成椎弓根螺钉路径。在求得的路径上根据约束条件完成椎弓根螺钉路径规划。与现有技术相比较，本发明通过两次脊椎坐标系正位，避免了由于提取到的椎弓根CT数据包含椎体和棘突部分导致计算错误的问题，同时增加了对椎弓根螺钉的推荐设计，实现了对于椎弓根螺钉路径的自动规划。需要明确的是，本公开并不局限于上文所描述并在图中示出的特定配置和 处理。为了简明起见，这里省略了对已知方法的详细描述。在上述实施例中， 描述和示出了若干具体的步骤作为示例。但是，本公开的方法过程并不限于所描述和示出的具体步骤，本领域的技术人员可以在领会本公开的精神后，做出各种改变、修改和添加，或者改变步骤之间的顺序。以上所述的结构框图中所示的功能块可以实现为硬件、软件、固件或者它 们的组合。当以硬件方式实现时，其可以例如是电子电路、专用集成电路 、适当的固件、插件、功能卡等等。当以软件方式实现时，本公开的元素是被用于执行所需任务的程序或者代码段。相关技术人员可以以一种或多种程序设计语言或其组合来编写用于执行本发明操作的计算机程序代码，上述程序设计语言包括面向对象的程序设计语言，诸如Java、Smalltalk、C++，还包括常规的过程式程序设计语言—诸如“C”语言或类似的程序设计语言。另外程序或者代码段可以存储在机器可读介质中，或者通过载波中携带的数据信号在传输介质或者通信链路上传送。机器可读介质可以包括能够存储或传输信息的任何介质。机器可读介质的例子包括电子电路、半导体存储器设备、ROM、闪存、可擦除ROM、软盘、CD-ROM、光盘、硬盘、光纤介质、射频链路，等等。上面参考根据本公开的实施例的方法、装置和计算机程序产品的流程图和/或框图描述了本公开的各方面。应当理解，流程图和/或框图中的每个方框以及流程图和/或框图中各方框的组合可以由计算机程序指令实现。这些计算机程序指令可被提供给通用计算机、专用计算机、或其它可编程数据处理装置的处理器，以产生一种机器，使得经由计算机或其它可编程数据处理装置的处理器执行的这些指令使能对流程图和/或框图的一个或多个方框中指定的功能/动作的实现。这种处理器可以是但不限于是通用处理器、专用处理器、特殊应用处理器或者现场可编程逻辑电路。还可理解，框图和/或流程图中的每个方框以及框图和/或流程图中的方框的组合，也可以由执行指定的功能或动作的专用硬件来实现，或可由专用硬件和计算机指令的组合来实现。以上所述，仅为本公开的具体实施方式，所属领域的技术人员可以清楚地 了解到，为了描述的方便和简洁，上述描述的系统、模块和单元的具体工作过 程，可以参考前述方法实施例中的对应过程，在此不再赘述。应理解，本公开的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本公开揭露的技术范围内，可轻易想到各种等效的修改或替换，这些修改或替换都应涵盖在本公开的保护范围之内。
