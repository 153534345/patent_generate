标题title
一种应用于实景娱乐的定制效果的实现方法
摘要abst
一种应用于实景娱乐的定制效果的实现方法属于数据控制技术领域，尤其涉及一种应用于实景娱乐的定制效果的实现方法。本发明提供一种应用于实景娱乐的定制效果的实现方法。本发明包括终端主板，终端主板与项目相对应，其特征在于终端主板包括一个核心板和多个扩展板，核心板与扩展板通讯，扩展板用于输入或输出信号；主板启动后先运行主进程，主进程会以进程的方式启动主应用程序，主应用程序会读取配置文件并解析，然后以动态库的形式加载所有游戏块，初始化完成后，根据配置文件开始调度执行第一个游戏块程序；核心板自带显示屏与按键。
权利要求书clms
1.一种应用于实景娱乐的定制效果的实现方法，包括终端主板，终端主板与项目相对应，其特征在于终端主板包括一个核心板和多个扩展板，核心板与扩展板通讯，扩展板用于输入或输出信号；主板启动后先运行主进程，主进程会以进程的方式启动主应用程序，主应用程序会读取配置文件并解析，然后以动态库的形式加载所有游戏块，初始化完成后，根据配置文件开始调度执行第一个游戏块程序；核心板自带显示屏与按键，通过显示屏实时的观察当前运行状态与游戏进度或通过按键选择某个游戏强制运行或复位，主应用程序根据用户输入操作来调度对应的游戏程序。2.根据权利要求1所述一种应用于实景娱乐的定制效果的实现方法，其特征在于所述核心板运行linux系统，核心板与扩展板采用I2C通讯方式。3.根据权利要求1所述一种应用于实景娱乐的定制效果的实现方法，其特征在于如果一个项目有多个主板，主应用程序在读取配置文件时知道应该跟哪些主板建立UDP通讯，不停的UDP广播查找同一个项目下的主板，如果中途掉线主板间通讯中断，重新UDP广播查找建立通讯。4.根据权利要求1所述一种应用于实景娱乐的定制效果的实现方法，其特征在于如果通过PC控制软件进行控制，PC端软件登录后从服务器获取用户选择的某个店铺某个主题的配置文件，软件启动后根据配置文件UDP广播查找局域网内的主板并建立通讯，当主板状态发生变化后会主动上报给PC端控制软件，PC端控制软件用户操作后会通过UDP发送命令给对应的主板。5.根据权利要求1所述一种应用于实景娱乐的定制效果的实现方法，其特征在于如果通过微信小程序控制，主板全部通过服务器的MQTT服务器来间接建立通讯，通过MQTT传输的命令。
说明书desc
技术领域本发明属于数据控制技术领域，尤其涉及一种应用于实景娱乐的定制效果的实现方法。背景技术实景娱乐有个特点就是定制化非常严重，且每种定制效果的需求量都很小。按照传统开发方式为每种效果定制一种设备，这样就会有大量的不同款式的设备需要开发，不仅增加研发人员的工作，而且硬件成本也极高。传统方式的定制，每一个定制效果或者每几个相近的定制效果就要单独开发一款硬件电路板，并且电路板都没有扩展功能。比如有定制需求要做200路以上的输入检测的效果，并且这样的需求可能只需要2套，如果按照这样的要求定制，开发成本可能就需要万元以上，但是这样的成本客户是无法承受了。发明内容本发明就是针对上述问题，提供一种应用于实景娱乐的定制效果的实现方法。为实现上述目的，本发明采用如下技术方案，本发明包括终端主板，终端主板与项目相对应，其特征在于终端主板包括一个核心板和多个扩展板，核心板与扩展板通讯，扩展板用于输入或输出信号；主板启动后先运行主进程，主进程会以进程的方式启动主应用程序，主应用程序会读取配置文件并解析，然后以动态库的形式加载所有游戏块，初始化完成后，根据配置文件开始调度执行第一个游戏块程序；核心板自带显示屏与按键，通过显示屏实时的观察当前运行状态与游戏进度或通过按键选择某个游戏强制运行或复位，主应用程序根据用户输入操作来调度对应的游戏程序。作为一种优选方案，本发明所述核心板运行linux系统，核心板与扩展板采用I2C通讯方式。作为另一种优选方案，本发明如果一个项目有多个主板，主应用程序在读取配置文件时知道应该跟哪些主板建立UDP通讯，不停的UDP广播查找同一个项目下的主板，如果中途掉线主板间通讯中断，重新UDP广播查找建立通讯。其次，本发明如果通过PC控制软件进行控制，PC端软件登录后从服务器获取用户选择的某个店铺某个主题的配置文件，软件启动后根据配置文件UDP广播查找局域网内的主板并建立通讯，当主板状态发生变化后会主动上报给PC端控制软件，PC端控制软件用户操作后会通过UDP发送命令给对应的主板。另外，本发明如果通过微信小程序控制，主板全部通过服务器的MQTT服务器来间接建立通讯，通过MQTT传输的命令。本发明有益效果。本发明通过核心板、扩展板即相互之间的数据传输方式设定，可以让用户快速自由的定制所需要的各种智能场景，可以多平台实时监控，可以多主板组网横向扩展更多的输入输出接口，可以随时更换不同场景的运行程序。附图说明下面结合附图和具体实施方式对本发明做进一步说明。本发明保护范围不仅局限于以下内容的表述。图1是本发明基本的架构图。图2是本发明整体流程图。图3是本发明架构简图。图4是本发明功能需求文档示例。具体实施方式如图所示，本发明包括终端主板，终端主板与项目相对应，终端主板包括一个核心板和多个扩展板，核心板与扩展板通讯，扩展板用于输入或输出信号；主板启动后先运行主进程，主进程会以进程的方式启动主应用程序，主应用程序会读取配置文件并解析，然后以动态库的形式加载所有游戏块，初始化完成后，根据配置文件开始调度执行第一个游戏块程序；核心板自带显示屏与按键，通过显示屏实时的观察当前运行状态与游戏进度或通过按键选择某个游戏强制运行或复位，主应用程序根据用户输入操作来调度对应的游戏程序。当遇到新的硬件需要接入系统时，可增加对应的接口模组板来调用新硬件，编写对应的游戏块后就可以使用了。当系统配置不能满足需求所需时，只需要升级核心板硬件，搭建好基础Linux框架就可以兼容以前写的游戏块，避免硬件升级后从新匹配软件耗时耗力。当功能需求比较多或者应用场地比较大的情况下，可以使用多主板联合的方式完成该需求，各个主板组网通讯可采用标准的UDP协议方式进行通讯，及避免了多功能同时运行的卡顿问题，又能节省走线成本。所述功能需求可包括电磁锁的设置、灯光的设置、音效、电话的设置、收音机的设置、烟机的设置等。所述核心板运行linux系统，核心板与扩展板采用I2C通讯方式。如果一个项目有多个主板，主板从服务器下载配置文件与程序文件时，服务器在同一个项目下所有主板的配置文件写入相同项目ID，主板对UDP广播数据以相同的项目ID进行数据加密，处于同一局域网下，具有相同项目ID的主板能解析出UDP广播数据，相关联的主板建立UDP单播通讯。可通过不停的UDP广播查找同一个项目下的主板，如果中途掉线主板间通讯中断，重新UDP广播查找建立通讯。如果通过PC控制软件进行控制，PC端软件登录后从服务器获取用户选择的某个店铺某个主题的配置文件，软件启动后根据配置文件UDP广播查找局域网内的主板并建立通讯，当主板状态发生变化后会主动上报给PC端控制软件，PC端控制软件用户操作后会通过UDP发送命令给对应的主板。如果通过微信小程序控制，主板全部通过服务器的MQTT服务器来间接建立通讯，通讯过程与PC端控制软件一样，只不过是通过MQTT传输的命令。所述微信小程序通过微信扫描主板上绑定模式下的二维码，服务器将微信小程序用户、终端主板、店铺、主题建立关系;不同的店铺用于管理与智控功能的共享，不同的项目按主题归类，项目指的云平台中的项目；多个项目可以分到一个主题中，智控页面显示时是按照主题显示的，一个主题下的多个项目都会被混合显示出来，方便查看和控制。所述微信小程序自己创建店铺，并添加店员，绑定到该店铺下的所有主题的主板共享给店员，方便协作管理。所述微信小程序自己新建主题，将同一个项目下的主板绑定到一起。用户创建主题，方便用户按主题管理智控功能。在连接广域网的情况下，可以通过微信小程序实时控制主板。在连接局域网的情况下可以通过PC端软件实时控制主板。所述智控功能与服务器建立MQTT连接，当选择相应主题的主板联网后，实时监控主板。为防止产品被他人直接复制硬件与软件生产销售，可通过硬件与软件双重加密来提高产品被逆向破解的成本。硬件加密：核心板外置一个加密计算芯片，加密采用HAMC-SHA256，核心板启动后向加密芯片传入随机数，同时主板以同样的方式计算加密结果，对比加密芯片返回的结果与主板计算结果一致则正常启动，否者程序无法启动。软件加密：1.为防止配置文件的私有协议格式泄露，服务器端生成配置文件时对配置文件进行AES256加密，主应用程序启动后对配置文件先解密再解析文件内容，所有操作在内存中完成，掉电即消失。2.为保证网络通讯时被截取消息原始内容与数据格式，所有网络收发的数据全部采用AES256进行加密传输。微信小程序的控制流程为：1、打开智控系统，选择店铺，选择主题。2、小程序从服务器获取当前主题下绑定的主板的配置文件。3、展示出所有主板上的游戏、开关、音频、组合功能，并跟所有主板建立MQTT连接。4、用户手动点击按钮来触发所选功能，通过MQTT传输给主板。5、主板状态发生变化，通过MQTT上传给小程序，小程序对应的按钮状态改变。所述PC控制软件运行于win10系统，在登录的时候联网，对局域网主板进行监控。PC控制软件控制延时小，响应速度快。PC控制软件控制流程为：1. 打开软件，软件联网后展示出登录二维码。2. 微信扫码，跳转至小程序，小程序上确认登录。3. PC端从服务器端读取用户数据，弹出店铺选择界面。4. 选择店铺后在智控页面展示出该店铺下的所有主题。5. 点击主题列表切换主题，包含游戏、开关、音频、组合功能区。6. 切换主题后PC端根据配置自动从局域网通过UDP广播搜索所有主板，并建立通讯，实时的同步主板状态。7. 点击游戏区的按钮，切换游戏的不同状态，包含未激活、运行中、成功状态1、成功状态2。8. 点击开关区的按钮，触发或者复位开关，对应的主板的继电器或者电磁锁状态改变。9. 点击音频区的按钮，对应主板的音频输出板播放相应的音频。10. 点击组合区的按钮，按照云平台上配置的逻辑关系依次触发对应游戏块，主板对应的输出改变。11. 逻辑关系，映射关系通过云平台编辑，云服务器处理后生成配置文件，按照预设的格式解析配置文件。所述PC端云平台的控制方法为：1. 通过浏览器打开云平台。2. 用微信扫码登录，未注册提示用户注册，注册完成后登录。3. 打开项目管理，选择已购买的项目，并进入编辑模式。4. 编辑模式下，查看所有在售卖的游戏块以及基础功能块。5. 拖拽游戏块放置在编辑区，双击编辑区的游戏块，修改游戏块的名称、感应器路数、配件类型、配件对应的端口、播放的音频文件属性参数，配置完成后，硬件示意图按照配置的顺序生成，用户手动调整硬件示意图中的各扩展的排列顺序。6. 硬件示意图手动添加多块主板，游戏块调整运行在所选择的主板上，相应的接口选择是对应的主板，如果没有相应的扩展板，生成扩展板。7. 拖拽逻辑块、接口块、指令块，实现游戏功能，配置方式与游戏块一样。游戏块之间连接线，主板按照连接线的逻辑依次激活游戏；是否在PC端控制软件展示；是否在导出资源文件时展示配置；玩法介绍；上传程序文件；多个配件分组；每组配件可选的路数范围、每组配件的默认配件、端口是否复用、资源是否复用；各分组的联动关系；游戏块的成功状态；自定义属性。属性由管理员配置完成后，用户在使用游戏块过程中，填写或调整相关属性生成对应的扩展板，删除游戏块不删除扩展板，手动清理空闲的扩展板。控制过程为：拖拽出“按键灯-顺序版”配置，填写路数，每路连接的配件，选择每路对应的扩展板端口，填写备注。配置分组2，该分组是音频播放器配置，只填写1路，选择连接配件，选择对用扩展板端口，选择资源，播放器资源可为1～99号文件夹），填写备注。“按键灯-顺序版”游戏块的配置就完成了，系统生成硬件示意图，在导出项目资源文件时生成文档。以上是单个游戏块的配置，需要进行连线配置多个游戏块的运行逻辑。所述扩展板包括输入端口板、音频模组、继电器模组、485模组、遥控器模组，用于输入检测信号和输出控制信号。所述云服务器的HTTP服务用于提供所有需要用到http服务的所有业务场景， 直接表述为web接口；预先编译好的终端主板程序文件，用于在云平台选配，放在主板端运行；云服务器的项目存储服务，用于保存用户项目内容与配置，方便用户随时登陆编辑项目；云服务器的程序下载服务，用于给终端主板传输用户选配的游戏块程序与配置文件；云服务器的终端主板补丁升级服务，用于升级终端主板，扩展新功能。所述微信小程序的智控功能，与服务器MQTT通讯，用于实时监控终端主板；所述微信小程序的消息接收功能，用于接收来自云服务器的系统消息、申请入店、其他消息；所述微信小程序的店员管理功能，用于管理加入的店员，店员可以共享实时监控店铺内绑定的所有主板。所述PC端云平台设置项目编辑功能、下载功能和EXCEL资源文件导出功能。项目编辑功能用于选配定制化的智能场景，所有项目保存在云服务器上。下载功能用于向云服务器发起请求，服务器会自动向联网的主板下载程序。EXCEL资源文件导出功能具有物料清单、组装接口描述、音频文件说明。所述PC端控制软件实时监控功能，用于主板脱机局域网控制使用，按照店铺主题的格式切换想要监控的数据，自由修改文字描述，联网重新登录可自动更新主板上当前运行的最新配置。本发明游戏块可保存在服务器上，需要哪个下载哪个，游戏效果无上限。本发明更换功能需求时，不必更换硬件，重新编辑工程下载即可，节省使用成本。本发明整体流程如下：整理功能需求文档 → 根据需求文档在云平台新建项目 → 以拖拽形式编辑对应的需求功能 → 云平台后台服务器根据编辑内容生成“配置文件”、“游戏块”、“对应的主板拼接结构示意图”、“对应的感应器及连接列表”、“对应的硬件与软件价格表” → 根据主板拼接结构示意图制作主板 → 通过网络将配置文件和游戏块下载到主板中 → 按照感应器及连接列表连接外设感应器 → 接通电源开机启动 → 主板启动后运行主进程 → 主进程以进程的方式加载主应用程序并运行→ 主应用程序读取配置文件并解析 → 按照配置文件顺序或同时以动态库的形式加载并运行游戏块 → 执行游戏过程1 → 执行游戏过程2和3 → 执行游戏过程n → 若下一个游戏不在本主板上，通过网络通知对应的主板继续运行。可以理解的是，以上关于本发明的具体描述，仅用于说明本发明而并非受限于本发明实施例所描述的技术方案，本领域的普通技术人员应当理解，仍然可以对本发明进行修改或等同替换，以达到相同的技术效果；只要满足使用需要，都在本发明的保护范围之内。
