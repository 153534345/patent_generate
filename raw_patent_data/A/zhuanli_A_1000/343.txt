标题title
一种基于图注意力机制与时空图卷积的睡眠分期检测系统
摘要abst
本发明提供了一种基于图注意力机制与时空图卷积的睡眠分期检测系统，属于睡眠健康监测技术领域；本发明基于表征学习与图卷积机制，将非谱域图卷积方法引入睡眠分期，同时提出了T‑GATv2模块捕捉相邻睡眠阶段间的中间阶段，同时提出一种修正函数表征不同阶段特征间的变化趋势，在睡眠分期任务中取得了较好的结果，其中表征学习模块可以使模型从数据中自适应的提取特征，而不需要先验知识，同时采用与数据采集通道匹配的模型结构保证了模型的合理性和可解释性，从而能在睡眠分期任务中取得较好的分期效果。
权利要求书clms
1.一种基于图注意力机制与时空图卷积的睡眠分期检测系统，其特征在于，包括数据预处理模块、表征学习模块、ST-GATv2模块以及分期识别模块；所述数据预处理模块用于对数据进行预处理：采用有向图表示不同脑电电极通道之间的联系；其中表示脑电电极通道的集合；/＞表示集合V中的第c个脑电电极通道，C则表示脑电电极通道总数；/＞表示第c个脑电电极通道输出的脑电数据序列，其中N为每个通道输出的脑电数据序列的睡眠切片总数，/＞表示其中第n个睡眠切片，L为/＞的序列长度；以窗口长度为T、滑动步长为1的滑动窗口对序列进行滑窗处理，从而将脑电数据序列中当前阶段/＞与相邻的下一阶段/＞和上一阶段/＞结合，得到新的睡眠阶段/＞；滑动窗口处理后新信号序列集合表示为/＞；其中， /＞；所述表征学习模块采用6个以Relu激活函数层为主体的1D-CNN，用于对预处理后的数据进行特征提取；所述ST-GATv2模块包括S-GATv2子模块和T-GATv2子模块；所述S-GATv2子模块的输入为表征学习模块所提取的特征，设为，/＞表示第c个脑电电极通道的特征；第i个脑电电极通道和第j个脑电电极通道之间的注意力系数/＞表示为/＞，其中/＞和/＞均为可训练参数，/＞表示拼接操作；/＞表示激活函数；第i个脑电电极通道和第j个脑电电极通道的连接关系表示为：其中，表示第i个脑电电极通道的邻接节点的集合；每个具有sigmoid函数的节点输出特征表示为：其中，表示激活函数；/＞表示特征/＞对应的特征序列；采用拼接或平均操作获得最终输出特征，如公式和所示：其中，H表示由公式在不同初始化参数下执行的独立注意力机制个数；表示第h个独立注意力输出的/＞的特征序列；/＞表示第h个独立注意力输出的/＞的特征序列；所述T-GATv2子模块用于：计算，用以表示当前阶段/＞在第i个脑电电极通道的特征/＞与上个阶段/＞在第j个脑电电极通道上的特征/＞之间的注意力系数/＞，如公式所示：则根据如下公式获得相邻两个阶段之间的中间阶段在第i个脑电电极通道上的特征序列：其中，表示特征/＞对应的特征序列；从而得到特征序列在各个多头注意力输出的特征序列/＞的平均输出/＞；得到中间阶段特征后，所述S-GATv2子模块利用公式-计算中间阶段的各脑电电极通道的特征序列；所述分期识别模块用于：根据ST-GATv2模块输出的各个阶段在各脑电电极通道的特征序列，采用改变维度的方式来融合提取到的特征，通过维度压缩和线性变化的方式将输出维度与睡眠类别维度相匹配，取其中最大值作为最终的睡眠阶段分期结果。2.如权利要求1所述的一种基于图注意力机制与时空图卷积的睡眠分期检测系统，其特征在于，还包括修正函数模块；将ST-GATv2模块输出作为修正函数模块的输入，经修正后的数据输入到分期识别模块进行睡眠分期识别；其中，修正函数模块对中间阶段的特征进行修正，其公式如下、、所示：其中是/＞的一部分， /＞表示/＞和/＞间的差值，/＞是一个可训练参数，tanh是激活函数，用于将值范围压缩到/＞；最终得到修正后的特征表示如公式所示：其中表示多头版本的/＞。3. 如权利要求1或2所述的一种基于图注意力机制与时空图卷积的睡眠分期检测系统，其特征在于，还包括selective kernel layer模块，用于将ST-GATv2模块输出的，或者将修正函数模块输出作为本模块输入，用于在多分支输入中采用软注意力机制融合不同核大小的输出结果。4.如权利要求1所述的一种基于图注意力机制与时空图卷积的睡眠分期检测系统，其特征在于，所述数据预处理模块将睡眠起始阶段和结束阶段中标注为未知阶段的脑电信号移除。5.如权利要求1所述的一种基于图注意力机制与时空图卷积的睡眠分期检测系统，其特征在于，所述数据预处理模块对通道记录重采样，消除采样频率差异影响。6.如权利要求1所述的一种基于图注意力机制与时空图卷积的睡眠分期检测系统，其特征在于，所述表征学习模块，在执行完每一组含2个的1D-CNN层后，使用一个Maxpool层对提取特征进行筛选，即降尺度处理；Relu激活定义为，其中x为输入。
说明书desc
技术领域本发明属于睡眠健康监测技术领域，具体涉及一种基于图注意力机制与时空图卷积的睡眠分期检测系统。背景技术睡眠是对生活的基本调节，多疾病与睡眠充足与否密切相关。睡眠阶段分类是评估睡眠质量的关键。两个常用睡眠标准分别为Rechtschaffen和Kales标准和睡眠医学会标准。多导睡眠图是包含眼电图、脑电图、肌电图和心电图等多种记录，睡眠专家用其识别睡眠阶段。考虑人工视觉睡眠分类的时间成本，且不同专家分类结果缺乏一致性，许多研究关注有效自动睡眠阶段分类器。最初阶段，传统机器学习或深度学习方法的特征提取主要基于时域、频域、时频域或非线性特征，并提出了一些特征选择策略。然而，该类方法性能主要依赖于特征数据预处理和特征工程，需要大量的专家先验知识。深度学习方法在强大表征能力支持下，一类借助深度学习进行特征提取的方法被提出，成功用于多个领域，以解决传统特征工程由于不同学科间异质性导致泛化能力不足的问题。针对睡眠分期任务，多种层数和不同参数的卷积神经网络被广泛用于提取数据中的多尺度特征，获得了较优的分类性能。尽管使用递归神经网络或其他传统深度学习层表示基于CNN的学习可达到相当的精度，上述模型限制在于其对欧几里得数据的有效潜在表示，即，其具有类似CNN的网格结构而无法表征非欧几里得数据。反之，图数据结构更适合捕捉非欧几里得空间的隐藏模式和连接，对于图神经网络，每个脑电信号通道对应图结构的一个节点。目前，图域卷积主要分为非谱域方法和谱域方法。初始谱域图卷积基于计算图拉普拉斯的特征分解并在傅里叶域进行卷积运算，尽管已提出几种简化近似，其计算开销仍较大。此外，谱域方法的另一个限制是，其严重依赖图结构决定的拉普拉斯特征基，这意味着它们对特定结构的训练模型可能无法直接用于其它不同图结构模型。相反，非谱域方法通过对一组相邻空间节点的操作直接在图上定义卷积，因此，相比于谱域方法具有更大的灵活性和直观性，计算成本开销更低。最近，一些研究将图卷积用于睡眠分期，达到了高准确率，然而这些研究皆采用基于谱域方法的图卷积。发明内容有鉴于此，本发明的目的是提供一种基于图注意力机制与时空图卷积的睡眠分期检测系统，可以提高睡眠分期的准确率。一种于图注意力机制与时空图卷积的睡眠分期检测系统，其特征在于，包括数据预处理模块、表征学习模块、ST-GATv2模块以及分期识别模块；所述数据预处理模块用于对数据进行预处理：采用有向图表示不同脑电电极通道之间的联系；其中表示脑电电极通道的集合；/＞表示集合V中的第c个脑电电极通道，C则表示脑电电极通道总数；/＞表示第c个脑电电极通道输出的脑电数据序列，其中N为每个通道输出的脑电数据序列的睡眠切片总数，/＞表示其中第n个睡眠切片，L为/＞的序列长度；以窗口长度为T、滑动步长为1的滑动窗口对序列进行滑窗处理，从而将脑电数据序列中当前阶段/＞与相邻的下一阶段/＞和上一阶段/＞结合，得到新的睡眠阶段/＞；滑动窗口处理后新信号序列集合表示为/＞；其中，/＞；所述表征学习模块采用6个以Relu激活函数层为主体的1D-CNN，用于对预处理后的数据进行特征提取；所述ST-GATv2模块包括S-GATv2子模块和T-GATv2子模块；所述S-GATv2子模块的输入为表征学习模块所提取的特征，设为，/＞表示第c个脑电电极通道的特征；第i个脑电电极通道和第j个脑电电极通道之间的注意力系数/＞表示为/＞，其中/＞和/＞均为可训练参数，/＞表示拼接操作；/＞表示激活函数；第i个脑电电极通道和第j个脑电电极通道的连接关系表示为：其中，表示第i个脑电电极通道的邻接节点的集合；每个具有sigmoid函数的节点输出特征表示为：其中，表示激活函数；/＞表示特征/＞对应的特征序列；采用拼接或平均操作获得最终输出特征，如公式和所示：其中，H表示由公式在不同初始化参数下执行的独立注意力机制个数；表示第h个独立注意力输出的/＞的特征序列；/＞表示第h个独立注意力输出的/＞的特征序列；所述T-GATv2子模块用于：计算，用以表示当前阶段/＞在第i个脑电电极通道的特征/＞与上个阶段/＞在第j个脑电电极通道上的特征之间的注意力系数/＞，如公式所示：则根据如下公式获得相邻两个阶段之间的中间阶段在第i个脑电电极通道上的特征序列：其中，表示特征/＞对应的特征序列；从而得到特征序列在各个多头注意力输出的特征序列/＞的平均输出/＞；得到中间阶段特征后，所述S-GATv2子模块利用公式-计算中间阶段的各脑电电极通道的特征序列；所述分期识别模块用于：根据ST-GATv2模块输出的各个阶段在各脑电电极通道的特征序列，采用改变维度的方式来融合提取到的特征，通过维度压缩和线性变化的方式将输出维度与睡眠类别维度相匹配，取其中最大值作为最终的睡眠阶段分期结果。进一步的，还包括修正函数模块；将ST-GATv2模块输出作为修正函数模块的输入，经修正后的数据输入到分期识别模块进行睡眠分期识别；其中，修正函数模块对中间阶段的特征进行修正，其公式如下、、所示：其中是/＞的一部分，/＞表示/＞和/＞间的差值，/＞是一个可训练参数，tanh是激活函数，用于将值范围压缩到/＞；最终得到修正后的特征表示如公式所示：其中表示多头版本的/＞。进一步的，还包括selective kernel layer模块，用于将ST-GATv2模块输出的，或者将修正函数模块输出作为本模块输入，用于在多分支输入中采用软注意力机制融合不同核大小的输出结果。较佳的，所述数据预处理模块将睡眠起始阶段和结束阶段中标注为未知阶段的脑电信号移除。较佳的，所述数据预处理模块对通道记录重采样，消除采样频率差异影响。较佳的，所述表征学习模块，在执行完每一组含2个的1D-CNN层后，使用一个Maxpool层对提取特征进行筛选，即降尺度处理；Relu激活定义为，其中x为输入。本发明具有如下有益效果：本发明提供了一种于图注意力机制与时空图卷积的睡眠分期检测系统，基于表征学习与图卷积机制，将非谱域图卷积方法引入睡眠分期，同时提出了T-GATv2模块捕捉相邻睡眠阶段间的中间阶段，同时提出一种修正函数表征不同阶段特征间的变化趋势，在睡眠分期任务中取得了较好的结果，其中表征学习模块可以使模型从数据中自适应的提取特征，而不需要先验知识，同时采用与数据采集通道匹配的模型结构保证了模型的合理性和可解释性，从而能在睡眠分期任务中取得较好的分期效果。附图说明图1为本发明的系统工作流程图；图2为本发明的滑动窗口分割示意图；图3为本发明的表征学习模块网络结构和参数；图4为本发明的多头S-GATv2聚合操作示意图；图5为本发明的中间阶段的获取过程；图6为本发明的T-GATv2流程示意图；图7为本发明的融合过程示意图。具体实施方式下面结合附图并举实施例，对本发明进行详细描述。为提高自动睡眠分期模型的正确率，并验证非谱域图卷积在睡眠领域的有效性，本发明提出了一种基于图注意力机制与时空图卷积的睡眠分期检测系统，在MASS中的SS3数据集中获得了高正确率的睡眠分期，本发明的系统框图如图1所示，包括：数据预处理模块、表征学习模块、ST-GATv2模块以及分期识别模块。1、数据预处理模块1)首先，将睡眠起始阶段和结束阶段中标注为未知阶段的脑电信号移除。其次，对通道记录重采样，消除采样频率差异影响，以MASS为例，所有通道采样频率统一为256 Hz。2）将预处理过的脑电信号进行维度上的划分。定义睡眠分期网络为一个有向图，表示不同电极与其间的联系，其中V和E分别表示脑电电极和相邻电极间的连接状态。用邻接矩阵/＞表示不同电极间的连接关系，其中表示电极的集合。/＞表示V集合中的第c电极通道，C则表示电极通道总数。/＞表示第c个电极通道的输出的脑电数据序列，其中N为每个通道输出的脑电数据序列的睡眠epoch总数，/＞表示其中第n个睡眠epoch，L为/＞的序列长度。考虑睡眠动力学的连续性，使用滑动窗口分割每个脑电数据序列，如图2所示。以长度设置为T，滑动步长为1的滑动窗口对序列/＞进行滑窗处理；滑动窗口处理后，以/＞描述新信号序列集合，其中/＞且/＞，睡眠阶段数量/＞与T成反比。为了保证滑动窗口处理后，有充足的睡眠阶段数量/＞，我们将T设置为3从而将脑电数据序列中当前阶段/＞与相邻的下一阶段/＞和上一阶段/＞结合，得到新的睡眠阶段/＞；其中当前阶段为目标阶段。2、表征学习模块表征学习模块采用6个以Relu激活函数层为主体的1D-CNN，用于对预处理后的数据进行特征提取。在执行完每一组含2个的1D-CNN层后，使用一个Maxpool层对提取特征进行筛选，即降尺度处理，去除冗余信息，降低计算开销。Relu激活定义为，其中x是输入。所提出CNNs集成表征学习网络结构与参数如图3所示。3、ST-GATv2模块包括S-GATv2子模块和T-GATv2子模块。为区分传统GATv2与本发明提出的时序GATv2，我们将传统的GATv2重新命名为S-GATv2，用于凸显其对图空间节点的聚合能力。1）、S-GATv2子模块：其输入为表征学习模块所提取的特征，如，/＞表示第c个电极通道的特征；将该模块输出定义为/＞，/＞为输出特征。将第i个通道/＞和第j个通道/＞分别对应和间的注意力系数/＞表示为/＞，其中/＞，均为可训练参数，/＞表示拼接操作。为使不同通道间的注意力系数方便比较，基于softmax函数的定义如公式：其中，表示激活函数；/＞表示第i个电极通道与第j个电极通道之间的关系；/＞表示第i个电极通道的邻接节点的集合。在获取完邻接矩阵后，每个具有sigmoid函数的节点输出特征可表示为公式：其中，表示特征序列；为稳定自注意力机制学习进程，多头注意力方法被引入其中。在定义完多头注意力机制后，采用拼接或平均操作获得最终输出特征，如公式和所示：其中，H表示由公式在不同初始化参数下执行的独立注意力机制个数；表示第h个独立注意力输出的/＞的特征序列；/＞表示第h个独立注意力输出的/＞的特征序列；表示第h个独立注意力的可训练参数。公式或常用来连接或平均这些独立结果，以获得最终输出。多头S-GATv2的聚合操作如图4所示。2）、T-GATv2子模块：受S-GATv2结构启发，本发明将其注意力机制和多头思想引入相邻睡眠序列/阶段，从而构建T-GATv2子模块。为表示睡眠阶段转换过程，引入中间阶段概念。定义为，用以表当前阶段/＞在节点i的特征/＞与上个阶段/＞在节点j上的特征/＞之间的注意力系数/＞，如公式所示：鉴于公式和，如图5所示，本发明提出的T-GATv2模块可获得相邻两个阶段之间的中间阶段在节点i上的特征序列：其中，表示特征/＞对应的特征序列；从而得到特征序列在各个多头上的输出的特征序列/＞的平均多头输出/＞。T-GATv2模块主要流程采用公式计算目标节点相邻节点当前阶段与上一个阶段的归一化注意力系数，后将公式和用于最后阶段的节点特征聚合以获取目标节点的中间阶段特征。如图6所示，通过T-GATv2模块，我们将原来的三阶段集合拓展到五阶段集合。不同阶段中存在不同的可训练参数W，但两个中间阶段间是相同的。得到中间阶段特征后，S-GATv2子模块利用公式-计算中间阶段的节点特征。4、分期识别模块：根据ST-GATv2模块输出的各个阶段在各脑电电极通道的特征序列，采用改变维度的方式来融合提取到的特征，通过维度压缩和线性变化的方式将输出维度与睡眠类别维度相匹配，取其中最大值作为最终的睡眠阶段分期结果。进一步的，本发明还提供了修正函数模块。 将ST-GATv2模块输出作为修正函数模块的输入，经修正后的数据输入到分期识别模块进行睡眠分期识别。尽管T-GATv2模块可以获取相邻节点时间层面的信息，但是它不能捕捉相邻阶段差值的隐藏信息。为了弥补这一点，修正函数模块对中间阶段的特征进行了修正，其公式如下、、所示：其中是/＞的一部分，而/＞表示/＞和/＞间的差值，/＞是一个可训练参数，tanh是一种激活函数，目的是将值范围压缩到/＞。最后，带有修正函数的T-GATv2的集合输出表示如公式所示：其中表示多头版本的/＞。进一步的，本发明还提供了selective kernel layer模块：将ST-GATv2模块输出的，或者将修正函数模块输出作为本模块输入，本模块是Li等人所提出用于在多分支输入中采用软注意力机制融合不同核大小的输出结果。由于适合不同阶段的核大小不同，我们采用四个不同大小的核分支包括,/＞,/＞和/＞进行融合。四个分支选择核的选择融合过程如图7所示：给定输入数据的特征图，其中C表示特征图的数量，H和W表示特征图的高和宽，selective kernel层输入数据拷贝四份分别作为四个不同核大小分支的输入，每个分支皆独立处理各自输入以获取/＞，/＞，/＞和/＞。通过矩阵对应位置元素相加得到。在融合与线性映射部分，全局平均池化操作被用于融合全局信息。/＞中的第n个元素表示如公式所示：在全局平均池化后，通过公式得到紧实特征，其为后续的选择参数提供了权重指导。其中Relu是激活函数，代表批归一化操作，/＞为可训练参数。上述过程包含融合与线性映射操作。在选择步骤中，每个通道的注意力权重采用softmax操作，如公式所示：其中表示/＞的第c行，d,e,f,g分别为/＞,/＞,/＞和/＞的软注意力机制向量。/＞中的第c个/＞如公式所示：其中是/＞中的第c个元素, selective kernel层的最终输出为。本发明已经在MASS数据库中的SS3数据集完成验证，对比基线模型达较高正确率，充分说明该发明在睡眠预测的潜力，结果如下表1所示。表1 本发明与基线模型的对比。综上所述，以上仅为本发明的较佳实施例而已，并非用于限定本发明的保护范围。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
