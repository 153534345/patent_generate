标题title
柔性体表定位装置及穿刺手术导航定位系统
摘要abst
本申请提供一种柔性体表定位装置及穿刺手术导航定位系统，属于体表靶点定位技术领域，装置包括柔性板；至少两组追踪点，设置在柔性板上，第一组追踪点和第二组追踪点，均具有可被捕捉状态和不可被捕捉状态；控制装置，用于控制至少两组追踪点在可被捕捉状态和不可被捕捉状态之间切换。一方面，通过柔性板的设置，使得柔性体表定位装置能够贴合患者的体表，能够随着患者呼吸的起伏运动跟随体表进行运动，从而实时反映体表的运动状态；另一方面，通过设置至少两组追踪点，且至少两组追踪点可以被控制装置独立控制以在可被捕捉状态和不可被捕捉状态之间切换，为实现本申请人提出的新的医学图像配准方法提供了结构基础。
权利要求书clms
1.一种柔性体表定位装置，其特征在于，包括：柔性板；第一组追踪点和第二组追踪点，设置在所述柔性板上，所述第二组追踪点的数量大于所述第一组追踪点的数量，所述第一组追踪点和第二组追踪点均具有可被光学定位装置捕捉的可被捕捉状态和不可被光学定位装置捕捉的不可被捕捉状态；所述第一组追踪点作为粗配准点包括至少3个追踪点，该至少3个追踪点在所述柔性板上形成非对称图形；所述第二组追踪点和所述第一组追踪点，在粗配准后，共同作为精配准点使用；控制装置，连接在所述柔性板上，用于独立控制所述第一组追踪点和第二组追踪点在所述可被捕捉状态和不可被捕捉状态之间切换。2.根据权利要求1所述的柔性体表定位装置，其特征在于，所述第一组追踪点和第二组追踪点组成的所有追踪点均匀分布在所述柔性板上。3.根据权利要求1所述的柔性体表定位装置，其特征在于，所述第一组追踪点和第二组追踪点所包含的追踪点的外形不同。4.根据权利要求1所述的柔性体表定位装置，其特征在于，所述柔性板设置为可弯折的非闭合形状。5.根据权利要求4所述的柔性体表定位装置，其特征在于，所述柔性板设置为圆螺旋线状，多个圆螺旋状的柔性板可相互嵌套拼接在一起。6.根据权利要求1-5中任一项所述的柔性体表定位装置，其特征在于，所述柔性板为柔性电路板，所述控制装置为控制电路，所述追踪点为LED追踪点，所述控制电路用于独立控制第一组LED追踪点和第二组LED追踪点的打开和关闭，所述LED追踪点在打开时处于可被捕捉状态，在关闭时处于不可被捕捉状态。7.一种穿刺手术导航定位系统，其特征在于，包括：光学定位装置、穿刺装置以及光学跟踪装置，所述光学跟踪装置包括权利要求6所述的柔性体表定位装置，所述柔性体表定位装置用于设置在患者体表上；所述穿刺手术导航定位系统用于执行以下医学图像配准方法：获取光学定位装置拍摄的第一图像和第二图像，以及CT图像，其中所述第一图像是在第一组追踪点处于可被捕捉状态下所拍摄的图像、所述第二图像是在所述第一组追踪点和第二组追踪点均处于可被捕捉状态下所拍摄的图像、所述CT图像中存在所述第一组追踪点和所述第二组追踪点的影像；获取所述CT图像中全部追踪点的图像坐标；获取所述第一图像中所述第一组追踪点的真实空间坐标，所述真实空间坐标为光学定位装置对追踪点进行捕捉所提供的坐标；根据所述第一图像中所述第一组追踪点的真实空间坐标以及所述CT图像中全部追踪点的图像坐标，在所述CT图像中确定第一组追踪点影像，并基于第一组追踪点影像的图像坐标和第一组追踪点的真实空间坐标计算粗配准变换数据；利用所述粗配准变换数据对所述第二图像进行处理，得到粗配准后的第二图像；根据粗配准后的第二图像中全部追踪点的真实空间坐标和所述CT图像中相应的追踪点的图像坐标计算精配准变换数据。8.根据权利要求7所述的穿刺手术导航定位系统，其特征在于，在所述医学图像配准方法中，所述计算精配准变换数据，包括：根据所述粗配准后的第二图像和所述CT图像搜索可信的追踪点；利用可信的追踪点的真实空间坐标和图像坐标计算精配准变换数据。9.根据权利要求8所述的穿刺手术导航定位系统，其特征在于，在所述医学图像配准方法中，根据粗配准后的第二图像和所述CT图像搜索可信的追踪点，包括：将所述粗配准后的第二图像与所述CT图像进行对比，将两个图像中共有的追踪点作为可信的追踪点，并对可信的追踪点进行标记。10.根据权利要求7所述的穿刺手术导航定位系统，其特征在于，根据所述第一图像中所述第一组追踪点的真实空间坐标以及所述CT图像中的全部追踪点的图像坐标，在所述CT图像中确定第一组追踪点影像，包括：根据所述第一图像中的所述第一组追踪点的真实空间坐标计算第一组追踪点所组成的图形特征；根据所述图形特征将所述第一图像中的所述第一组追踪点与所述CT图像中的全部追踪点进行匹配，得到CT图像中的第一组追踪点的影像。
说明书desc
技术领域本申请涉及体表靶点定位技术领域，具体而言，涉及一种柔性体表定位装置及穿刺手术导航定位系统。背景技术手术导航定位系统可通过光学跟踪的方式来实现定位，系统中设有配套的光学跟踪装置，该装置中设有反光小球，光学系统通过追踪反光小球来实现对目标的实时跟踪定位。在目前临床使用的手术导航定位系统中，比如在骨科和神经外科领域，会把跟踪装置固定在骨骼或头颅框架上，与手术部位保持贴合，导航定位系统通过追踪对应的跟踪装置来实现对手术部位的定位。对于胸腹部位置，由于人的呼吸运动，体表是实时运动的，这会导致定位产生偏差。对于穿刺术来说，需要先在术前根据CT图像确定穿刺路径，然后在术中按照预定的穿刺路径实施穿刺，但是受到人体呼吸导致体表起伏的影响，实际的穿刺路径可能会与预定穿刺路径不同，这被称之为配准误差。而由于现有技术中跟踪装置的各追踪点之间是刚性连接，无法实时反映体表运动状态，导致配准误差进一步增大，增加了医生实施穿刺术的难度。为此，CN113729945B公开了一种体表定位装置的配准方法、穿刺引导方法及设备，通过使用若干个弹性带将若干定位结构连接形成柔性体表定位装置从而解决无法实时反映体表运动状态的技术问题。然而，该现有技术在实际使用中，若追踪点的数量较少，就不能精细反映出体表形状，而且如果某个追踪点被遮挡，则可能会出现无法识别体表定位装置的问题；若追踪点数量过多，则配准算法会复杂，且实时性会降低。针对上述问题，本申请人提出一种新的医学图像配准方法，将上述现有技术的一次配准法改进为分批次的多次配准法，通过分批次的多次配准法可以同时解决追踪点少导致精细度不够和追踪点多导致配准算法复杂的问题，但是现在还缺少能够为实现此方法而提供结构支持的柔性体表定位装置的结构。发明内容本申请的目的在于提供一种柔性体表定位装置，旨在解决相关技术中缺少能够为实现上述医学图像配准方法提供结构支持的柔性体表定位装置的结构。本申请的额外方面和优点将部分地在下面的描述中阐述，并且部分地将从描述中变得显然，或者可以通过本申请的实践而习得。根据本申请的第一方面，提供一种柔性体表定位装置，包括：柔性板；第一组追踪点和第二组追踪点，设置在所述柔性板上，所述第一组追踪点和第二组追踪点均具有可被光学定位装置捕捉的可被捕捉状态和不可被光学 装置捕捉的不可被捕捉状态；所述第一组追踪点作为粗配准点包括至少3个追踪点，该至少3个追踪点在所述柔性板上形成非对称图形；所述第二组追踪点和所述第一组追踪点，在粗配准后，共同作为精配准点使用；控制装置，连接在所述柔性板上，用于独立控制所述第一组追踪点和第二组追踪点在可被捕捉状态和不可被捕捉状态之间切换。在本申请的一种示例性实施例中，所述第一组追踪点和第二组追踪点组成的所有追踪点均匀分布在所述柔性板上。在本申请的一种示例性实施例中，所述第一组追踪点和第二组追踪点所包含的追踪点的外形不同。在本申请的一种示例性实施例中，所述柔性板设置为可弯折的非闭合形状。在本申请的一种示例性实施例中，所述柔性板设置为圆螺旋线状，多个圆螺旋状的柔性板可相互嵌套拼接在一起。在本申请的一种示例性实施例中，所述柔性板为柔性电路板，所述控制装置为控制电路，所述追踪点为LED追踪点，所述控制电路用于独立控制第一组LED追踪点和第二组LED追踪点的打开和关闭，所述LED追踪点在打开时处于可被捕捉状态，在关闭时处于不可被捕捉状态。在本申请的一种示例性实施例中，所述追踪点设置为两组，所述第二组追踪点的数量大于所述第一组追踪点的数量。根据本申请的第二方面，提供一种穿刺手术导航定位系统，包括：光学定位装置、穿刺装置以及光学跟踪装置，所述光学跟踪装置包括上述的柔性体表定位装置，所述柔性体表定位装置用于设置在患者体表上；所述穿刺手术导航定位系统用于执行以下医学图像配准方法：获取光学定位装置拍摄的第一图像和第二图像，以及CT图像，其中所述第一图像是在第一组追踪点处于可被捕捉状态下所拍摄的图像、所述第二图像是在所述第一组追踪点和第二组追踪点均处于可被捕捉状态下所拍摄的图像、所述CT图像中存在所述第一组追踪点和所述第二组追踪点的影像；获取所述CT图像中全部追踪点的图像坐标；获取所述第一图像中所述第一组追踪点的真实空间坐标，所述真实空间坐标为光学定位装置对追踪点进行捕捉所提供的坐标；根据所述第一图像中所述第一组追踪点的真实空间坐标以及所述CT图像中全部追踪点的图像坐标，在所述CT图像中确定第一组追踪点影像，并基于第一组追踪点影像的图像坐标和第一组追踪点的真实空间坐标计算粗配准变换数据；利用所述粗配准变换数据对所述第二图像进行处理，得到粗配准后的第二图像；根据粗配准后的第二图像中全部追踪点的真实空间坐标和所述CT图像中相应的追踪点的图像坐标计算精配准变换数据。在本申请的一种示例性实施例中，计算精配准变换数据，包括：根据所述粗配准后的第二图像和所述CT图像搜索可信的追踪点；利用可信的追踪点的真实空间坐标和图像坐标计算精配准变换数据。在本申请的一种示例性实施例中，根据粗配准后的第二图像和所述CT图像搜索可信的追踪点，包括：将所述粗配准后的第二图像与所述CT图像进行对比，将两个图像中共有的追踪点作为可信的追踪点，并对可信的追踪点进行标记。在本申请的一种示例性实施例中，根据所述第一图像中所述第一组追踪点的真实空间坐标以及所述CT图像中的全部追踪点的图像坐标，在所述CT图像中确定第一组追踪点影像，包括：根据所述第一图像中的所述第一组追踪点的真实空间坐标计算第一组追踪点所组成的图形特征；根据所述图形特征将所述第一图像中的所述第一组追踪点与所述CT图像中的全部追踪点进行匹配，得到CT图像中的第一组追踪点的影像。在本申请的一种示例性实施例中，根据所述第一图像中的所述第一组追踪点的真实空间坐标计算第一组追踪点所组成的图形特征，包括：根据所述第一追踪点的真实空间坐标对第一组追踪点进行拟合，得到多边形；计算所述多边形的图像特征参数。在本申请的一种示例性实施例中，根据所述图形特征将所述第一图像中所述第一组追踪点与所述CT图像中的全部追踪点进行匹配，得到CT图像中的第一组追踪点的影像，包括：根据所述CT图像中全部追踪点的空间坐标计算每两个追踪点之间的特征参数；将所述图像特征参数与所述特征参数进行匹配；将匹配成功的特征参数对应的追踪点作为CT图像中与第一组追踪点对应的追踪点，得到CT图像中第一组追踪点的影像。在本申请的一种示例性实施例中，利用所述粗配准变换数据对所述第二图像进行处理，得到粗配准后的第二图像，包括：获取所述第二图像嗯全部追踪点的真实空间坐标；利用所述粗配准变换数据将所述第二图像中的全部追踪点进行粗配准变换，得到全部追踪点的粗配准空间坐标；根据全部追踪点的粗配准空间坐标对第二图像中的全部追踪点进行变换，得到粗配准后的第二图像。本申请示例性实施例可以具有以下部分或全部有益效果：1、本申请示例性实施例提供的柔性体表定位装置，包括柔性板；第一组追踪点和第二组追踪点设置在所述柔性板上，第一组追踪点包含至少3个追踪点，该至少3个追踪点在所述柔性板上形成非对称图形；控制装置，连接在所述柔性板上，用于独立控制第一组追踪点和第二组追踪点在可被捕捉状态和不可被捕捉状态之间切换。一方面，通过柔性板的设置，使得柔性体表定位装置能够贴合患者的体表，能够随着患者呼吸的起伏运动跟随体表进行运动，从而实时反映体表的运动状态；另一方面，通过设置两组追踪点，且两组追踪点可以被控制装置独立地控制以在可被捕捉状态和不可被捕捉状态之间切换，为实现本申请人提出的新的医学图像配准方法提供了结构基础。应当理解的是，以上的一般描述和后文的细节描述仅是示例性和解释性的，并不能限制本申请。附图说明此处的附图被并入说明书中并构成本说明书的一部分，示出了符合本申请的实施例，并与说明书一起用于解释本申请的原理。显而易见地，下面描述中的附图仅仅是本申请的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1示出了本申请实施例1中一种柔性体表定位装置的结构示意图；图2示出了本申请实施例1中两个柔性体表定位装置嵌合拼接的结构示意图；图3为本申请实施例2中基于体表定位装置的医学图像配准方法的流程示意图。附图标记说明：1、柔性板；2、第一组追踪点；3、第二组追踪点。具体实施方式现在将参考附图更全面地描述示例实施方式。然而，示例实施方式能够以多种形式实施，且不应被理解为限于在此阐述的实施方式；相反，提供这些实施方式使得本申请将全面和完整，并将示例实施方式的构思全面地传达给本领域的技术人员。图中相同的附图标记表示相同或类似的结构，因而将省略它们的详细描述。此外，附图仅为本申请的示意性图解，并非一定是按比例绘制。虽然本说明书中使用相对性的用语，例如“上”“下”来描述图标的一个组件对于另一组件的相对关系，但是这些术语用于本说明书中仅出于方便，例如根据附图中的示例的方向。能理解的是，如果将图标的装置翻转使其上下颠倒，则所叙述在“上”的组件将会成为在“下”的组件。当某结构在其它结构“上”时，有可能是指某结构一体形成于其它结构上，或指某结构“直接”设置在其它结构上，或指某结构通过另一结构“间接”设置在其它结构上。用语“一个”、“一”、“该”和“至少一个”用以表示存在一个或多个要素/组成部分/等；用语“包括”和“具有”用以表示开放式的包括在内的意思并且是指除了列出的要素/组成部分/等之外还可存在另外的要素/组成部分/等；用语“第一”、“第二”仅作为标记使用，不是对其对象的数量限制。实施例1如图1所示，本申请的一个实施例，提供了一种柔性体表定位装置，包括：柔性板1和设置在柔性板1上的第一组追踪点2和第二组追踪点3，其中，第一组追踪点2和第二组追踪点3均具有可被光学定位装置捕捉的可被捕捉状态和不可被光学定位装置捕捉的不可被捕捉状态；第一组追踪点2作为粗配准包括至少3个追踪点，至少3个追踪点在柔性板1上形成非对称图形，至少3个追踪点中任意两个追踪点之间的距离各不相同，通过对追踪点之间距离的识别，确认各追踪点的位置完成粗配准；在粗配准后，第一组追踪点2和第二组追踪点3共同作为精配准点使用。控制装置连接在柔性板1上，通过控制装置可以独立控制第一组追踪点2和第二组追踪点3在可被捕捉状态和不可被捕捉状态之间进行切换。关于第一组追踪点2和第二组追踪点3的对称性的要求：所述第一组追踪点2作为粗配准点包含至少3个追踪点，在柔性板1上形成非对称图形，即第一组追踪点中两两追踪点的间距不同；在粗配准之后，第一组追踪点2和第二组追踪点3共同作为粗配准点使用，具体使用方法见下方医学图像配准方法。精配准点不要求形成非对称图形，因为精配准并不是依靠贴到人身上会造成任意两点间的距离不同来配准的。对精配准而言，贴到人身上后，即使所有配准点仍然均匀分布，也可以实现精配准；因为经过粗配准和粗配准变换后，CT图像上的所有点和光学定位装置识别的所有追踪点已经大概对齐，可以通过例如寻找每一个追踪点的相邻最近追踪点的方式来确定对应点对，即精配准不再需要通过非对称形状来确定对应点对。因此，第一组追踪点2和第二组追踪点3共同形成的追踪点的图形的形状没有特别的限制。在本实施例中，将柔性板1作为追踪点的载体，是因为在术中，患者呼吸时，柔性板1能够随着患者呼吸的起伏运动跟随体表进行运动，从而实时反映体表的运动状态。第一组追踪点2包含至少3个追踪点，为了进行实时跟踪配准，则需要识别两个空间中各个跟踪点的对应关系，因此在本实施例中第一组追踪点2中的至少3个追踪点在柔性板1上形成非对称图形，换言之，至少3个追踪点任意2个追踪点之间的距离不同，这样通过点间距离的不一致进行匹配，即可确定对应匹配的点。在本实施例中，还包括控制装置，控制装置设置为用于独立控制两组追踪点在可被捕捉状和不可被捕捉状态之间切换。可被捕捉状态指，追踪点能够被光学定位装置例如双目摄像头识别；不可被捕捉状态指，追踪点不能够被光学定位装置例如双目摄像头识别。在本实施例中，柔性板1优选采用柔性电路板，追踪点优选采用LED追踪点，控制装置优选采用控制电路。控制电路位于柔性电路板内部，控制电路与LED追踪点电连接，且通过电路设置使得控制电路能够分别独立地控制每一组追踪点的打开和关闭，例如当追踪点为两组时，通过控制电路可以独立地控制第一组追踪点2全部打开，而第二组追踪点3则全部关闭；反过来，通过控制电路也可以独立控制第一组追踪点2全部关闭，而第一组追踪点2全部打开；另外，通过控制电路也可控制第一组追踪点2和第二组追踪点3也可全部打开或全部关闭。需要指出的是，所述LED追踪点在打开时处于可被捕捉状态，在关闭时处于不可被捕捉状态。但是需要说明的是，以上这些设置都不是限制性的。例如柔性板1也可以设置为不含电路的结构，追踪点也可以选用目前常用的反光小球，而控制装置则只要设置为能够遮挡或打开反光小球的遮蔽装置即可。具体地，拍摄CT图像时，控制电路控制第一组追踪点2和第二组追踪点3中所有追踪点处于可捕捉状态；在进行粗配准阶段时，控制电路先控制第一组追踪点2处于可捕捉状态，此时其余追踪点处于不可被捕捉状态；在精配准阶段，控制电路控制其余追踪点全部处于可捕捉状态。具体地，柔性电路板为PCB电路板。在一些实施例中，第一组追踪点2和第三组追踪点3组成的所有追踪点全部均匀分布在柔性电路板上，可以提高配准精度，同时配准精度在空间中的一致性好，虽然全部的追踪点均匀分布在柔性电路板上，但柔性电路板在贴合到待手术位置时，追踪点会分布在待手术位置的四周，第一组追踪点2中的任意两个追踪点之间的距离各不相同。本实施例中，两组追踪点分别为第一组追踪点2和第二组追踪点3，第二组追踪点3的数量大于第一组追踪点2的数量，第一组追踪点2中的追踪点在柔性板1上形成非对称图形，第二组追踪点3中的追踪点在柔性板1上分布不作限制，可以形成非对称图形，也可以是对称图形。追踪点数量较少的第一组追踪点2用作粗配准，数量较多的第二组追踪点3用于精配准阶段，在粗配准阶段，只需定位大概位置，在精配准阶段，则会定位每个追踪点的位置，分批次进行定位配准，既保证了追踪点的数量能够精细反映出体表形状，又不会使配准算法变得多复杂，实时性也不会降低。并且，第一组追踪点2与第二组追踪点3交错布置，如图1所示，第一组追踪点2设置有3个，第二组追踪点3设置有13个，第一组追踪点2的3个分布在第二组追踪点3之间，并且第一组追踪点2之间的3个中任意两个之间的距离各不相同。在进行配准时，先通过第一组追踪点2中的3个追踪点进行第一次配准，再通过第二组追踪点3中的13个追踪点进行第二次配准，在第一次配准的过程中，需要对准第一组追踪点2中3个追踪点的位置，完成初步配准，再对剩余的第二组追踪点3进行定位配准，完成最终配准。在另一些实施例中，追踪点可以设置为三组、四组甚至更多，分多次配准，每次配准均可校验追踪点的位置坐标，多组追踪点可以使得配准更加精准。其中，只要第一组追踪点1在柔性板上形成非对称图形即可。在一些实施例中，两组的追踪点的外形不同。如图1所示，第一组追踪点2的外形呈圆形，第二组追踪点3的外形呈方形，使得操作人员在追踪点未通电的情况下也可辨别追踪点的组别。也可以分别设置为其他肉眼可辨别的外形，如三角形、棱形等。本实施例中，柔性体表定位装置设置为可弯折的非闭合形状，可以更好地适应体表凹凸不平的曲面上，非闭合的形状可以紧贴人体表面，保证配准精度。具体地，柔性体表定位装置中的柔性板1设置为圆螺旋线状，并且多个圆螺旋线状的柔性体表定位装置可相互嵌套拼接在一起。以两个柔性板1为例，如图2所示，在生产过程中，两个嵌合拼接的圆螺旋线状的体表定位装置一方面使得各追踪点运动更自由，能够精细反映体表起伏形状，另一方面，PCB制板按照最大面积收费，可拼板生产可以降低生产成本。在一些实施例中，柔性体表定位装置中柔性板1还可以根据身体的不同位置设计为三角形、方形、不规则形等。实施例2如图3所示，本申请的一个实施例，提供了一种穿刺手术导航定位系统，包括光学定位装置、穿刺装置以及光学跟踪装置，光学跟踪装置采用实施例1中的柔性体表定位装置进行实施，柔性体表定位装置用于设置在患者体表上，穿刺手术导航定位系统用于执行以下医学图像配准方法：S110，获取光学定位装置拍摄的第一图像和第二图像，以及CT图像，其中第一图像是在第一组追踪点2处于可被捕捉状态下所拍摄的图像、第二图像是在第一组追踪点2和第二组追踪点3均处于可被捕捉状态下所拍摄的图像、CT图像中存在第一组追踪点2和第二组追踪点3的影像。第一图像和第二图像为光学摄像机对佩戴着柔性体表定位装置的人体部位进行拍摄获得的图像。需说明的是，实际应用时拍摄第一图像和第二图像的区别仅在于追踪点的捕捉状态，光学定位装置和柔性定位装置的相对位置和姿态保持不变。CT图像为通过计算机断层扫描对佩戴着柔性体表定位装置的人体部位进行扫描获得。在一个实施例中，获取光学定位装置拍摄的第一图像和第二图像时，柔性体表定位装置具体操作包括：获取第一图像时，控制第一组追踪点2的控制电路以使第一组追踪点2处于打开状态，并控制第二组追踪点3的控制电路以使第二组追踪点3处于关闭状态，此状态下光学摄像机只能捕捉到第一组追踪点2；获取第二图像时，控制第一组追踪点2和第二组追踪点3的控制电路以使两组追踪点处于打开状态，此状态下光学摄像机能够捕捉到全部追踪点。在另一个实施例中，获取光学定位装置拍摄的第一图像和第二图像时，柔性体表定位装置还包括另一种操作：获取第一图像时，控制第一组追踪点2的控制电路以第一预设频次使第一组追踪点2处于打开状态，并控制第二组追踪点3的控制电路以使第二组追踪点3处于关闭状态，此状态下光学摄像机也以第一预设频次捕捉第一组追踪点2；获取第二图像时，控制第一组追踪点2和第二组追踪点3的控制电路以第二预设频次使第一组追踪点2和第二组追踪点3处于打开状态，此状态下光学摄像机也以第二预设频次捕捉第一组追踪点2和第二组追踪点3，第一预设频次和第二预设频次可以相等也可以不相等。S120，获取CT图像中全部追踪点的图像坐标；本实施例中可利用现有技术获取图像中追踪点的坐标，例如在CT图像中建立坐标系，以各个追踪点的坐标。S130，获取第一图像中第一组追踪点2的真实空间坐标，真实空间坐标为光学定位装置对追踪点进行捕捉所提供的坐标。本实施例中第一图像由可利用现有技术获取图像中追踪点的坐标，例如在第一图像中建立坐标系，以获取各个追踪点的真实空间坐标。S140，根据第一图像中第一组追踪点2的真实空间坐标以及CT图像中全部追踪点的图像坐标，在CT图像中确定第一组追踪点2影像，并基于第一组追踪点2影像的图像坐标和第一组追踪点2的真实空间坐标计算粗配准变换数据。本实施例中，在基于第一组追踪点2影像的图像坐标和第一组追踪点2的真实空间坐标计算粗配准变换数据时，可采用三点刚性配准算法和svd配准算法等得到粗配准变换矩阵。在一些实施例中，根据第一图像中第一组追踪点2的真实空间坐标以及CT图像中的全部追踪点的图像坐标，在CT图像中确定第一组追踪点2影像，包括：根据第一图像中的第一组追踪点2的真实空间坐标计算第一组追踪点2所组成的图形特征；根据图形特征将第一图像中的第一组追踪点2与CT图像中的全部追踪点进行匹配，得到CT图像中的第一组追踪点2的影像。在一些实施例中，根据第一图像中的第一组追踪点2的真实空间坐标计算第一组追踪点2所组成的图形特征，包括：根据第一组追踪点2的真实空间坐标对第一组追踪点2进行拟合，得到多边形；计算多边形的图形特征参数。本实施例中，多边形的图形特征参数可以包括边长特征参数和夹角特征参数。在一些实施例中，根据图形特征将第一图像中第一组追踪点2与CT图像中的全部追踪点进行匹配，得到CT图像中的第一组追踪点2的影像，包括：根据所述CT图像中全部追踪点的空间坐标计算每两个追踪点之间的特征参数；将所述图像特征参数与所述特征参数进行匹配；将匹配成功的特征的参数对应的追踪点作为CT图像中与第一组追踪点2对应的追踪点，得到CT图像中第一组追踪点2的影像。本实施例中，在粗配准阶段，由于第一组追踪点2所包含的追踪点个数少，在空间上呈非对称分布，使得采用简单的配准方法即可快速识别出定位装置，但配准精度相对较低，只实现了CT图像空间与真实空间的初步对齐。S150，利用粗配准变换数据对第二图像进行处理，得到粗配准后的第二图像。在一些实施例中，利用粗配准变换数据对第二图像进行处理，得到粗配准后的第二图像，包括：获取第二图像中全部追踪点的真实空间坐标；利用粗配准变换数据将第二图像中的全部追踪点进行配准变换，得到全部追踪点的粗配准空间坐标；根据全部追踪点的粗配准空间坐标对第二图像中的全部追踪点进行变换，得到粗配准后的第二图像。本实施例中，在对第二图像进行处理时，先获取第二图像中所有追踪点的真实空间坐标，利用粗配准变换矩阵将所有追踪点的真实空间坐标进行坐标转换，得到粗配准的追踪点的第二图像，以便于根据粗配准的第二图像进行追踪点搜索。S160，根据粗配准后的第二图像中全部追踪点的真实空间坐标和CT图像中相应的追踪点的图像坐标计算精配准变换数据。在一些实施例中，计算精配准变换数据，包括：根据粗配准后的第二图像和CT图像搜索可信的追踪点，利用可信的追踪点的真实空间坐标和图像坐标计算精配准变换数据。本实施例中，通过搜索可信的追踪点，以排除一些外来因素，提高了图像的质量合格准确性，进而为后续的配准提供更加可靠的数据基础，提高配准的精度。在一些实施例中，根据粗配准后的第二图像和CT图像搜索可信的追踪点，包括：将粗配准后的第二图像与CT图像进行对比，将两个图像中共有的追踪点作为可信的追踪点，并将可信的追踪点进行标记。本实施例中，可信的追踪点搜索为：第一种，将CT图像中未出现的但粗配准后的第二图像中出现的追踪点进行标记，该标记追踪点为LED追踪点的光亮产生的噪点；第二种，将CT图像中出现但粗配准后的第二图像中未出现的追踪点进行标记，该标记追踪点为操作时被遮挡的追踪点，将两种标记的追踪点进行排除，将剩余的追踪点作为可信的追踪点，通过排除噪点和真实空间中被遮挡的追踪点以提高配准的精度。本领域的技术人员应明白，本申请的实施例可提供为方法、系统或计算机程序产品。因此，本申请可采用完全硬件实施例、完全软件实施例或结合软件和硬件方面的实施例的形式。而且，本申请可采用在一个或多个其中包含有计算机可用程序代码的计算机可用存储介质上实施的计算机程序产品的形式。本申请是参照根据本申请实施例的方法、设备、和计算机程序产品的流程图和／或方框图来描述的。应理解可由计算机程序指令实现流程图和／或方框图中的每一流程和／或方框、以及流程图和／或方框图中的流程和／或方框的结合。可提供这些计算机程序指令到通用计算机、专用计算机、嵌入式处理机或其他可编程数据处理设备的处理器以产生一个机器，使得通过计算机或其他可编程数据处理设备的处理器执行的指令产生用于实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能的装置。这些计算机程序指令也可存储在能引导计算机或其他可编程数据处理设备以特定方式工作的计算机可读存储器中，使得存储在该计算机可读存储器中的指令产生包括指令装置的制造品，该指令装置实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能。这些计算机程序指令也可装载到计算机或其他可编程数据处理设备上，使得在计算机或其他可编程设备上执行一系列操作步骤以产生计算机实现的处理，从而在计算机或其他可编程设备上执行的指令提供用于实现在流程图一个流程或多个流程和／或方框图一个方框或多个方框中指定的功能的步骤。本领域技术人员在考虑说明书及实践这里申请的申请后，将容易想到本申请的其它实施方案。本申请旨在涵盖本申请的任何变型、用途或者适应性变化，这些变型、用途或者适应性变化遵循本申请的一般性原理并包括本申请未申请的本技术领域中的公知常识或惯用技术手段。说明书和实施例仅被视为示例性的，本申请的真正范围和精神由所附的权利要求指出。
