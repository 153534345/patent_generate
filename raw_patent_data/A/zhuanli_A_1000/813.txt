标题title
一种基于课程元学习的心律失常检测算法和系统
摘要abst
本发明涉及智能医疗领域，公开了一种基于课程元学习的心律失常检测算法和系统，其中算法包括以下步骤：S1、将现有的神经网络模型在预训练数据集中进行预训练得到预训练模型；S2、再将S1中得到的所述预训练模型迁移到新的目标集中进行微调；本发明通过元学习方法和课程学习方法的结合，对原始的预训练模型进行训练，之后迁移到新的目标集中进行微调，这样可以得到能够快速适应不同个体的参数，并且能够缓解同一个体不同时期数据差异大的问题。
权利要求书clms
1.一种基于课程元学习的心律失常检测算法，其特征在于，包括以下步骤：S1、将现有的神经网络模型在预训练数据集中进行预训练得到预训练模型，所述预训练数据集中，对每个个体进行心率失常检测为元任务Tb，其中所述元任务对应若干个样本，一个所述样本即一个心律检测数据；所述预训练数据集包括预训练训练集和预训练验证集；S2、再将S1中得到的所述预训练模型迁移到新的目标集中进行微调，所述目标集中的每个子集为一个个体，且每个所述子集对应若干个样本，一个所述样本即一个心律检测数据。2.根据权利要求1所述的算法，其特征在于：步骤S1中所述的预训练包括元学习方法和课程学习方法；所述元学习方法用于为所述预训练模型学习可以快速适应新个体的参数，所述课程学习方法用于为所述元学习方法提供“从易到难”的学习顺序。3.根据权利要求2所述的算法，其特征在于，所述预训练的具体步骤包括：S1.1、计算样本的交叉熵损失，并确定每个所述元任务的困难值；所述困难值是衡量每个元任务的复杂性或者模型学习这个元任务的困难程度，只要模型确定，我们能够为每个元任务设置一个固定值作为这些元任务的“困难值”；S1.2、在所述预训练的每一步，挑选若干个所述元任务进行训练；S1.3、为预训练模型的初始权重θ0进行更新，得到更新后的元学习模型参数θ’；其中，用所述元学习方法和所述课程学习方法训练后得到的预训练模型称为元学习模型。4.根据权利要求3所述的算法，其特征在于，步骤S1.1中的计算所述困难值的具体步骤如下：S1.1.1、用每个所述元任务中的K个所述样本进行训练，用每个所述元任务中剩余的所述样本进行测试；S1.1.2、计算出每个所述元任务对应的所有所述样本的平均交叉熵损失lossb，其中N为样本个数，M为心律失常的类别数量，当样本i的类别为c时，真实标签yic为1，否则为0，pic为元学习模型给出的样本i为类别c的概率，则所述元任务Tb的困难值为5.根据权利要求3所述的算法，其特征在于：步骤S1.2中挑选元任务的依据为各个所述元任务的所述困难值，设置一个困难值的阈值，困难值小于所述阈值的所述元任务被等概率选择，而困难值大于所述阈值的元任务则不会被选择。6.根据权利要求3所述的算法，其特征在于：步骤S1.3中预训练模型的初始权重θ0进行更新的具体步骤包括：S1.3.1、将所述预训练数据集中所述样本的集合随机分为样本支持集和样本查询集；S1.3.2、若此时预训练模型参数为θ0，复制θb＝θ0，计算参数θb在所述样本查询集上的交叉熵损失：其中M为心律失常的类别数量，当样本i的类别为c时，真实标签yic为1，否则为0，pic为元学习模型给出的样本i为类别c的概率；S1.3.3、在所述样本支持集上进行一步梯度下降其中α是学习率，为参数为θb的模型在所述查询集上的交叉熵损失，为交叉熵损失对θb的梯度；S1.3.4、用所述样本查询集上的交叉熵损失，对θ0进行更新；S1.3.5、计算参数为θ0的所述预训练模型在所述预训练验证集上的交叉熵损失，若连续若干次预训练验证集交叉熵损失不降低，则停止更新，得到更新的元学习模型参数θ’。7.根据权利要求6所述的算法，其特征在于，步骤S2中的所述微调包括以下步骤：S2.1、将所述目标数据集的所述样本的集合分为目标样本训练集，目标样本测试集和目标样本验证集；S2.2、对θ0进行过渡；其中，所述过渡方法包括以下步骤：S2.2.1、将复制的参数θ0’在所述目标样本训练集T上进行一步梯度下降：S2.2.2、在所述目标样本训练集上计算交叉熵损失；S2.2.3、用计算的交叉熵损失对θ0进行更新；S2.2.4、重复2.2.1-2.2.3步骤S次；S2.2.5、完成过渡。S2.3、在所述目标样本训练集上使用普通的随机梯度下降法进行训练。S2.4、过程中出现的超参数包括学习率α、学习率β以及S，依次尝试每种超参数的组合，并根据训练好的元学习模型中给出的当前样本的所属类别的概率判断当前样本上固有的分类标签的正确与否，计算当前样本在目标样本验证集上的分类准确率，且目标样本验证集上的分类准确率＝分类正确样本数/总样本数，然后选取准确率最高的一组超参数。S.2.5、在所述目标样本测试集上计算模型的性能指标，如ROC曲线下面积、准确率、平均精确率、精确率、召回率、特异度、F1-分数。8.一种计算机可读存储介质，其特征在于：介质上存有计算机程序，计算机程序运行后，执行如权利要求1至7中任一项所述的基于课程元学习的心律失常检测算法。9.一种计算机系统，其特征在于：包括处理器、存储介质，存储介质上存有计算机程序，处理器从存储介质上读取并运行计算机程序以执行如权利要求1至7中任一项所述的基于课程元学习的心律失常检测算法。10.用于权利要求1-7任一所述的一种基于课程元学习的心律失常检测算法的系统，其特征在于：包括数据处理模块和依次与所述数据处理模块电性连接的心率检测模块以及数据存储模块。
说明书desc
技术领域本发明涉及智能医疗领域，特别涉及一种基于课程元学习的心律失常检测算法和系统。背景技术目前深度学习方法被广泛应用于心电信号的分类任务上。尽管深度学习模型能够有着不错的表现，但该方法仍有两个主要局限性：心电信号因人而异。换句话说，从一个人那里学到的模型能否推广到其他人身上是不确定的。这主要是由于一些条件的差异，这限制了临床环境中机器学习模型的可适用性。除了不同个体之间的泛化能力外，深度学习模型在同一个体某一时期可能表现不佳，而在其他时期表现良好。人们在不同的阶段做不同的活动，无疑会影响到包括心律在内的不同心脏活动指标。因此，由某些时期的数据训练的模型在其他阶段可能表现不佳。所以现有的深度学习方法存在上述限制。发明内容为了解决现有深度学习方法的限制问题，本发明提供了一种基于课程元学习的心律失常检测算法和系统，具体方案如下：一种基于课程元学习的心律失常检测算法，包括以下步骤：S1、将现有的神经网络模型在预训练数据集中进行预训练得到预训练模型，所述预训练数据集中，对每个个体进行心率失常检测为元任务Tb，其中所述元任务对应若干个样本，一个所述样本即一个心律检测数据；所述预训练数据集包括预训练训练集和预训练验证集；S2、再将S1中得到的所述预训练模型迁移到新的目标集中进行微调，所述目标集中的每个子集为一个个体，且每个所述子集对应若干个样本，一个所述样本即一个心律检测数据。优选的，步骤S1中所述的预训练包括元学习方法和课程学习方法；所述元学习方法用于为所述预训练模型学习可以快速适应新个体的参数，所述课程学习方法用于为所述元学习方法提供“从易到难”的学习顺序。优选的，所述预训练的具体步骤包括：S1.1、计算样本的交叉熵损失，并确定每个所述元任务的困难值；所述困难值是衡量每个元任务的复杂性或者模型学习这个元任务的困难程度，只要模型确定，我们能够为每个元任务设置一个固定值作为这些元任务的“困难值”；S1.2、在所述预训练的每一步，挑选若干个所述元任务进行训练；S1.3、为预训练模型的初始权重θ0进行更新，得到更新后的元学习模型参数θ’；其中，用所述元学习方法和所述课程学习方法训练后得到的预训练模型称为元学习模型。优选的，步骤S1.1中的计算所述困难值的具体步骤如下：S1.1.1、用每个所述元任务中的K个所述样本进行训练，用每个所述元任务中剩余的所述样本进行测试；S1.1.2、计算出每个所述元任务对应的所有所述样本的平均交叉熵损失lossb，其中N为样本个数，M为心律失常的类别数量，当样本i的类别为c时，真实标签yic为1，否则为0，pic为元学习模型给出的样本i为类别c的概率，则所述元任务Tb的困难值为优选的，步骤S1.2中挑选元任务的依据为各个所述元任务的所述困难值，设置一个困难值的阈值，困难值小于所述阈值的所述元任务被等概率选择，而困难值大于所述阈值的元任务则不会被选择。优选的，步骤S1.3中预训练模型的初始权重θ0进行更新的具体步骤包括：S1.3.1、将所述预训练数据集中所述样本的集合随机分为样本支持集和样本查询集；S1.3.2、若此时预训练模型参数为θ0，复制θb＝θ0，计算参数θb在所述样本查询集上的交叉熵损失：其中M为心律失常的类别数量，当样本i的类别为c时，真实标签yic为1，否则为0，pic为元学习模型给出的样本i为类别c的概率；S1.3.3、在所述样本支持集上进行一步梯度下降其中α是学习率，为参数为θb的模型在所述查询集上的交叉熵损失，为交叉熵损失对θb的梯度；S1.3.4、用所述样本查询集上的交叉熵损失，对θ0进行更新；S1.3.5、计算参数为θ0的所述预训练模型在所述预训练验证集上的交叉熵损失，若连续若干次预训练验证集交叉熵损失不降低，则停止更新，得到更新的元学习模型参数θ’。优选的，步骤S2中的所述微调包括以下步骤：S2.1、将所述目标数据集的所述样本的集合分为目标样本训练集，目标样本验证集和目标样本测试集；S2.2、对θ0进行过渡；其中，所述过渡方法包括以下步骤：S2.2.1、将复制的参数θ0’在所述目标样本训练集T上进行一步梯度下降：S2.2.2、在所述目标样本训练集上计算交叉熵损失；S2.2.3、用计算的交叉熵损失对θ0进行更新；S2.2.4、重复2.2.1-2.2.3步骤S次；S2.2.5、完成过渡。S2.3、在所述目标样本训练集上使用普通的随机梯度下降法进行训练。S2.4、过程中出现的超参数包括学习率α、学习率β以及S，依次尝试每种超参数的组合，并根据训练好的元学习模型中给出的当前样本的所属类别的概率判断当前样本上固有的分类标签的正确与否，计算当前样本在目标样本验证集上的分类准确率，且目标样本验证集上的分类准确率＝分类正确样本数/总样本数，然后选取准确率最高的一组超参数。S.2.5、在所述目标样本测试集上计算模型的性能指标，如ROC曲线下面积、准确率、平均精确率、精确率、召回率、特异度、F1-分数。本发明还揭示了一种计算机可读存储介质，介质上存有计算机程序，计算机程序运行后，执行上述心律失常检测算法。本发明还揭示了一种计算机系统，包括处理器、存储介质，存储介质上存有计算机程序，处理器从存储介质上读取并运行计算机程序以执行上述心律失常检测算法。优选的，一种基于课程元学习的心律失常检测算法的系统，包括数据处理模块和依次与所述数据处理模块电性连接的心率检测模块以及数据存储模块。本发明的有益效果在于：本发明通过元学习方法和课程学习方法的相结合，对原始的预训练模型进行训练，之后迁移到新的目标集中进行微调，这样可以得到能够快速适应不同个体的参数，并且能够缓解同一个体不同时期数据差异大的问题。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作一简单地介绍，显而易见地，下面描述中的附图是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其它的附图。图1为选择不同方法进行性能指标测试时对应的简称列表；图2为选择不同方法对应的性能指标的计算结果对比列表；图3为普通预训练、只采用元学习方法进行训练和采用本发明的算法进行预训练后的交叉熵损失在各区间内对应的个体数量的柱状图；图4为本发明的算法流程图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地说明，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其它实施例，都属于本发明保护的范围。一种基于课程元学习的心律失常检测算法，包括以下步骤：S1、将现有的神经网络模型在预训练数据集中进行预训练得到预训练模型，预训练数据集中，对每个个体进行心率失常检测为元任务Tb，其中元任务对应若干个样本，一个样本即一个心律检测数据；预训练数据集包括预训练训练集和预训练验证集。步骤S1中的预训练包括元学习方法和课程学习方法；元学习方法用于为预训练模型学习可以快速适应新个体的参数，课程学习方法用于为元学习方法提供“从易到难”的学习顺序。其中预训练的具体步骤包括：S1.1、计算样本的交叉熵损失，并确定每个元任务的困难值；困难值是衡量每个元任务的复杂性或者模型学习这个元任务的困难程度，只要模型确定，我们能够为每个元任务设置一个固定值作为这些元任务的“困难值”。步骤S1.1中的计算困难值的具体步骤如下：S1.1.1、用每个元任务中的K个样本进行训练，用每个元任务中剩余的样本进行测试。S1.1.2、计算出每个元任务对应的所有样本的平均交叉熵损失lossb，其中N为样本个数，M为心律失常的类别数量，当样本i的类别为c时，真实标签yic为1，否则为0，pic为元学习模型给出的样本i为类别c的概率，则元任务Tb的困难值为S1.2、在预训练的每一步，挑选若干个元任务进行训练。其中，挑选元任务的依据为各个元任务的困难值，设置一个困难值的阈值，困难值小于阈值的元任务被等概率选择，而困难值大于阈值的元任务则不会被选择。该步骤中体现了课程学习方法的应用，阈值的设置随着预训练步数的增大而增大，预训练步数为对元学习模型参数θ0进行更新的次数。首先设置一个困难值比较低的阈值，这时根据该阈值对各个元任务进行筛选，完成该步预训练后，再设置阈值高于前一次困难值的阈值，这时再对剩下的元任务进行筛选，依次完成若干次的设置阈值和元任务的筛选，每次阈值的设置都比前一次设置的阈值的困难值高，直到完成所有元任务的筛选，这里由步骤S1.1.2中困难值Vb的公式可得出，所有元任务的困难值均小于1。S1.3、为预训练模型的初始权重θ0进行更新，得到更新后的元学习模型参数θ’；其中，用元学习方法和课程学习方法训练后得到的预训练模型称为元学习模型。其中，预训练模型的初始权重θ0进行更新的具体步骤包括：S1.3.1、将预训练数据集中样本的集合随机分为样本支持集和样本查询集。S1.3.2、若此时预训练模型参数为θ0，复制θb＝θ0，计算参数θb在样本查询集上的交叉熵损失：其中M为心律失常的类别数量，当样本i的类别为c时，真实标签yic为1，否则为0，pic为元学习模型给出的样本i为类别c的概率。S1.3.3、在样本支持集上进行一步梯度下降其中α是学习率，为参数为θb的预训练模型在样本查询集上的交叉熵损失，为交叉熵损失对θb的梯度。S1.3.4、用样本查询集上的交叉熵损失，对θ0进行更新。S1.3.5、计算参数为θ0的预训练模型在预训练验证集上的交叉熵损失，若连续若干次预训练验证集交叉熵损失不降低，则停止更新，得到更新的元学习模型参数θ’。S2、再将S1中得到的预训练模型迁移到新的目标集中进行微调，目标集中的每个子集为一个个体，且每个子集对应若干个样本，一个样本即一个心律检测数据。其中，微调包括以下步骤：S2.1、将目标数据集的样本的集合分为目标样本训练集，目标样本测试集和目标样本验证集；S2.2、对θ0进行过渡；其中，过渡方法包括以下步骤：S2.2.1、将复制的参数θ0’在目标样本训练集T上进行一步梯度下降：S2.2.2、在目标样本训练集上计算交叉熵损失；S2.2.3、用计算的交叉熵损失对θ0进行更新；S2.2.4、重复2.2.1-2.2.3步骤S次；S2.2.5、完成过渡。S2.3、在目标样本训练集上使用普通的随机梯度下降法进行训练。S2.4、过程中出现的超参数包括学习率α、学习率β以及S，依次尝试每种超参数的组合，并根据训练好的元学习模型中给出的当前样本的所属类别的概率判断当前样本上固有的分类标签的正确与否，计算当前样本在目标样本验证集上的分类准确率，且目标样本验证集上的分类准确率＝分类正确样本数/总样本数，然后选取准确率最高的一组超参数。S.2.5、在目标样本测试集上计算模型的性能指标，如ROC曲线下面积、准确率、平均精确率、精确率、召回率、特异度、F1-分数。具体实施例一：预训练阶段包括预训练的训练阶段和预训练验证阶段，在预训练的训练阶段，预训练的每步选择的一批次元任务数量设置为9。在预训练验证阶段同样随机选取9个个体作为预训练验证集。预训练的每步均进行一次验证，预训练模型的训练直到验证交叉熵损失出现上升趋势时停止，而验证交叉熵损失最小的参数则保存下来，该参数为θ’。在微调的过程中出现的超参数包括学习率α、学习率β以及S，设置训练步数S∈{50,100,200}、学习率α∈{10-2,5*10-3,10-3}和学习率β∈{10-2,10-3,10-4}依次尝试每种超参数的组合，共27种组合。并根据训练好的元学习模型中给出的当前样本的所属类别的概率判断当前样本上固有的分类标签的正确与否，计算当前样本在目标样本验证集上的分类准确率，且目标样本验证集上的分类准确率＝分类正确样本数/总样本数，然后选取准确率最高的一组超参数。如图1至图3，在目标样本测试集上计算模型的性能指标，如ROC曲线下面积、准确率、平均精确率、精确率、召回率、特异度、F1-分数。图1中，将MAML即元学习方法、课程学习方法以及微调过渡阶段三者进行任意选择后，进行命名，譬如三者都选择命名为“MC+PF”，只选择元学习方法和课程学习方法这两者命名为“MC+F”，只选择元学习方法和微调过渡阶段这两者命名为“M+PF”，只选择课程学习方法这一者命名为“M+F”，三者都不选择命名为“Vanilla”。命名完成后计算测试集上的模型的性能指标，如ROC曲线下面积、准确率、平均精确率、精确率、召回率、特异度以及F1-分数。计算结果如图2。如图3，为预训练训练集上每个个体i计算了当前个体平均交叉熵损失lossi，具体方法是计算当前个体所有样本的交叉熵损失并求均值。之后将lossi用所有lossi中的最大值maxloss进行归一化：其中，lossi是归一化后交叉熵损失，maxloss是交叉熵损失最大值，由公式可得lossi’在0到1之间取值。之后，我们将lossi’划分为10个区间，并统计每个区间对应个体的数量。可以看出，本发明的方法，可以将模型在大多数个体上的交叉熵损失控制在较低的范围内。图中MAML为元学习方法。一种基于课程元学习的心律失常检测算法的系统，包括数据处理模块和依次与数据处理模块电性连接的心率检测模块以及数据存储模块。心率检测模块用于检测个体的心率值，数据存储模块用于存储预训练数据集、心率检测数据以及目标集等，数据处理模块用于从数据存储模块中提取所需信息进行处理。本发明通过元学习方法和课程学习方法的结合，对原始的预训练模型进行训练，之后迁移到新的目标集中进行微调，这样可以得到能够快速适应不同个体的参数，并且能够缓解同一个体不同时期数据差异大的问题。本发明还揭示了一种计算机可读存储介质，介质上存有计算机程序，计算机程序运行后，执行上述心律失常检测算法。本发明还揭示了一种计算机系统，包括处理器、存储介质，存储介质上存有计算机程序，处理器从存储介质上读取并运行计算机程序以执行上述心律失常检测算法。本领域技术人员将进一步领会，结合本文中所公开的实施例来描述的各种解说性逻辑板块、模块、电路、和算法步骤可实现为电子硬件、计算机软件、或这两者的组合。为清楚地解说硬件与软件的这一可互换性，各种解说性组件、框、模块、电路、和步骤在上面是以其功能性的形式作一般化描述的。此类功能性是被实现为硬件还是软件取决于具体应用和施加于整体系统的设计约束。技术人员对于每种特定应用可用不同的方式来实现所描述的功能性，但这样的实现决策不应被解读成导致脱离了本发明的范围。结合本文所公开的实施例描述的各种解说性逻辑板块、模块、和电路可用通用处理器、数字信号处理器、专用集成电路、现场可编程门阵列或其它可编程逻辑器件、分立的门或晶体管逻辑、分立的硬件组件、或其设计成执行本文所描述功能的任何组合来实现或执行。通用处理器可以是微处理器，但在替换方案中，该处理器可以是任何常规的处理器、控制器、微控制器、或状态机。处理器还可以被实现为计算设备的组合，例如DSP与微处理器的组合、多个微处理器、与DSP核心协作的一个或多个微处理器、或任何其他此类配置。结合本文中公开的实施例描述的方法或算法的步骤可直接在硬件中、在由处理器执行的软件模块中或在这两者的组合中体现。软件模块可驻留在RAM存储器、闪存、ROM存储器、EPROM存储器、EEPROM存储器、寄存器、硬盘、可移动盘、CD-ROM、或本领域中所知的任何其他形式的存储介质中。示例性存储介质耦合到处理器以使得该处理器能从/向该存储介质读取和写入信息。在替换方案中，存储介质可以被整合到处理器。处理器和存储介质可驻留在ASIC中。ASIC可驻留在用户终端中。在替换方案中，处理器和存储介质可作为分立组件驻留在用户终端中。在一个或多个示例性实施例中，所描述的功能可在硬件、软件、固件或其任何组合中实现。如果在软件中实现为计算机程序产品，则各功能可以作为一条或更多条指令或代码存储在计算机可读介质上或藉其进行传送。计算机可读介质包括计算机存储介质和通信介质两者，其包括促成计算机程序从一地向另一地转移的任何介质。存储介质可以是能被计算机访问的任何可用介质。作为示例而非限定，这样的计算机可读介质可包括RAM、ROM、EEPROM、CD-ROM或其它光盘存储、磁盘存储或其它磁存储设备、或能被用来携带或存储指令或数据结构形式的合意程序代码且能被计算机访问的任何其它介质。任何连接也被正当地称为计算机可读介质。例如，如果软件是使用同轴电缆、光纤电缆、双绞线、数字订户线、或诸如红外、无线电、以及微波之类的无线技术从web网站、服务器、或其它远程源传送而来，则该同轴电缆、光纤电缆、双绞线、DSL、或诸如红外、无线电、以及微波之类的无线技术就被包括在介质的定义之中。如本文中所使用的盘和碟包括压缩碟、激光碟、光碟、数字多用碟、软盘和蓝光碟，其中盘往往以磁的方式再现数据，而碟用激光以光学方式再现数据。上述的组合也应被包括在计算机可读介质的范围内。尽管参照前述实施例对本发明进行了详细的说明，本领域的普通技术人员应当理解：其依然可以对前述各实施例所记载的技术方案进行修改，或者对其中部分技术特征进行等同替换；而这些修改或者替换，并不使相应技术方案的本质脱离本发明各实施例技术方案的精神和范围。
