标题title
富集癫痫发作间期的癫痫样放电和预测致病灶的方法
摘要abst
本发明公开了富集癫痫发作间期的癫痫样放电和预测致病灶的方法，包括：获取患者癫痫发作间期的立体定向脑电信号；对立体定向脑电信号进行预处理，获取处理后的立体定向脑电信号；将处理后的立体定向脑电信号划分为训练集和测试集，采用滑动窗口将训练集划分为若干个信号片段，基于Transformer编码器模型对信号片段进行自监督重构训练，获取训练好的Transformer编码器模型；将测试集输入训练好的Transformer编码器模型，获取每个信号片段的重构值，将每个信号片段的重构值与立体定向脑电信号值进行比较，获取每个信号片段与背景信号的偏离值；本发明提高患者癫痫发作区的分类准确率。
权利要求书clms
1.富集癫痫发作间期的癫痫样放电和预测致病灶的方法，其特征在于，包括以下步骤：获取患者癫痫发作间期的立体定向脑电信号；对所述立体定向脑电信号进行预处理，获取处理后的立体定向脑电信号；将所述处理后的立体定向脑电信号划分为训练集和测试集，采用滑动窗口将所述训练集划分为若干个信号片段，基于Transformer编码器模型对所述信号片段进行自监督重构训练，获取训练好的Transformer编码器模型；将所述测试集输入所述训练好的Transformer编码器模型，获取每个信号片段的重构值，将所述每个信号片段的重构值与立体定向脑电信号值进行比较，获取每个信号片段与背景信号的偏离值；设置偏离值的阈值，提取出所有超过所述偏离值的阈值的信号片段，基于所述信号片段进行处理，获取平均后的信号片段；将所述平均后的信号片段输入双向长短期记忆递归神经网络模型进行所述立体定向脑电信号分类并评估，完成癫痫发作间期富集癫痫样放电和预测致痫灶。2.如权利要求1所述的富集癫痫发作间期的癫痫样放电和预测致病灶的方法，其特征在于，获取所述患者癫痫发作间期的立体定向脑电信号的方法包括：采用立体定向技术对患者置入立体脑电图电极，设定采样率，获取所述患者癫痫发作间期的立体定向脑电信号。3.如权利要求1所述的富集癫痫发作间期的癫痫样放电和预测致病灶的方法，其特征在于，对所述立体定向脑电信号进行预处理，获取处理后的立体定向脑电信号的方法包括：基于所述立体定向脑电信号，采用双极参考最小化两个相邻通道之间的相关性，接着对所述立体定向脑电信号进行高通滤波，再进行统一重采样，最后对所述立体定向脑电信号进行Z分数标准化处理，获取所述处理后的立体定向脑电信号。4.如权利要求1所述的富集癫痫发作间期的癫痫样放电和预测致病灶的方法，其特征在于，采用滑动窗口之前需要将所述滑动窗口进行遮盖和位置编码，具体包括：将所述滑动窗口中间位置用0进行遮盖；采用正余弦函数进行位置编码。5.如权利要求4所述的富集癫痫发作间期的癫痫样放电和预测致病灶的方法，其特征在于，采用滑动窗口将所述训练集划分为若干个信号片段，基于Transformer编码器模型对所述信号片段进行自监督重构训练，获取训练好的Transformer编码器模型的方法为：其中，PE为位置编码，pos为位置，i为维度，dmodel为维度大小，偶数维度使用正弦函数，奇数维度使用余弦函数；Q为查询向量，K为被查询信息与其他信息的相关性的向量，V为被查询信息的向量，dk为维度大小。6.如权利要求1所述的富集癫痫发作间期的癫痫样放电和预测致病灶的方法，其特征在于，将所述每个信号片段的重构值与立体定向脑电信号值进行比较，获取每个信号片段与背景信号的偏离值的方法为：其中，MSE为均方差函数，n为信号片段内信号点的个数，Yi为第i个真实信号，为第i个预测信号。7.如权利要求1所述的富集癫痫发作间期的癫痫样放电和预测致病灶的方法，其特征在于，基于所述信号片段进行处理，获取平均后的信号片段的方法包括：利用平滑非线性能量算法对所述信号片段进行转换，获取转换后的信号片段；将所述转换后的信号片段进行平均处理，获取所述平均后的信号片段。8.如权利要求1所述的富集癫痫发作间期的癫痫样放电和预测致病灶的方法，其特征在于，将所述平均后的信号片段输入双向长短期记忆递归神经网络模型进行所述立体定向脑电信号分类，其中所述双向长短期记忆递归神经网络模型为在长短期记忆网络的基础上引入双向传播机制和注意力机制，具体包括：ft＝σit＝σg t＝tanhct＝itgt+ftct-1ot＝σht＝ot tanh其中，σ为sigmod函数，xt为第t个时刻的输入，ht-1为上一个时刻的隐藏层向量；ft为遗忘门，Wf为遗忘门学习权重，bf为遗忘门学习权重偏置；it和gt为输入门两条支线，ct为输入门的输出，Wi和Wc为输入门学习权重，bi和bc为输入门学习权重偏置；ot为输出门，Wo为输出门学习权重，bo为输出门学习权重偏置；ht为当前t时刻计算得到的隐藏层向量；和/＞分别为由前向后和由后向前两个方向的隐藏层向量。9.如权利要求1所述的富集癫痫发作间期的癫痫样放电和预测致病灶的方法，其特征在于，对所述立体定向脑电信号进行评估的方法包括：其中，TP为真阳性，TN为真阴性，FP为假阳性，FN为假阴性，Accuracy为准确率，Sensitivity为灵敏度，Specificity为特异性。
说明书desc
技术领域本发明属于医学电生理辅助评估检查技术领域，尤其涉及富集癫痫发作间期的癫痫样放电和预测致病灶的方法。背景技术致痫区的评估是癫痫手术取得成功的关键，但遗憾的是目前并没有可以直接测量致痫区的方法，通常是将癫痫发作区作为致痫区的间接测量。立体脑电图一直是临床医生定位SOZ的重要诊断工具。目前临床的主要使用的生物标记物有：Spikes和高频振荡。识别这些生物标记物一般通过临床医生人工目视的方法来，但是此种方法过于耗时，且主观性太强。传统自动检测方法有很多，但是都会遇到特征选取、特征组合、特征阈值范围选定等一系列的争议性难题。深度学习的方法可以避开人工特征提取的困扰，但直接对SEEG发作间期进行SOZ分类的难度非常大，因为SEEG发作间期的数据信号很长，将数据直接输入一些常见的时序模型时，会出现很严重的“遗忘”，最终预测结果偏向于随机值，而且发作间期的“有效”信号很少，Spikes和高频振荡在信号中的占比非常低，大部分的信号都是冗余的背景信号；SEEG发作间期的数据信号长、有效信号比值低，直接使用深度学习模型对其进行SOZ分类结果很差。因此亟需提出富集癫痫发作间期的癫痫样放电和预测致病灶的方法。发明内容为解决上述技术问题，本发明提出了富集癫痫发作间期的癫痫样放电和预测致病灶的方法，提高癫痫发作区的分类准确率，能够辅助医生对致痫区进行判断。为实现上述目的，本发明提供了富集癫痫发作间期的癫痫样放电和预测致病灶的方法，包括以下步骤：获取患者癫痫发作间期的立体定向脑电信号；对所述立体定向脑电信号进行预处理，获取处理后的立体定向脑电信号；将所述处理后的立体定向脑电信号划分为训练集和测试集，采用滑动窗口将所述训练集划分为若干个信号片段，基于Transformer编码器模型对所述信号片段进行自监督重构训练，获取训练好的Transformer编码器模型；将所述测试集输入所述训练好的Transformer编码器模型，获取每个信号片段的重构值，将所述每个信号片段的重构值与立体定向脑电信号值进行比较，获取每个信号片段与背景信号的偏离值；设置偏离值的阈值，提取出所有超过所述偏离值的阈值的信号片段，基于所述信号片段进行处理，获取平均后的信号片段；将所述平均后的信号片段输入双向长短期记忆递归神经网络模型进行所述立体定向脑电信号分类并评估，完成癫痫发作间期富集癫痫样放电和预测致痫灶。可选的，获取所述患者癫痫发作间期的立体定向脑电信号的方法包括：采用立体定向技术对患者置入立体脑电图电极，设定采样率，获取所述患者癫痫发作间期的立体定向脑电信号。可选的，对所述立体定向脑电信号进行预处理，获取处理后的立体定向脑电信号的方法包括：基于所述立体定向脑电信号，采用双极参考最小化两个相邻通道之间的相关性，接着对所述立体定向脑电信号进行高通滤波，再进行统一重采样，最后对所述立体定向脑电信号进行Z分数标准化处理，获取所述处理后的立体定向脑电信号。可选的，采用滑动窗口之前需要将所述滑动窗口进行遮盖和位置编码，具体包括：将所述滑动窗口中间位置用0进行遮盖；采用正余弦函数进行位置编码。可选的，采用滑动窗口将所述训练集划分为若干个信号片段，基于Transformer编码器模型对所述信号片段进行自监督重构训练，获取训练好的Transformer编码器模型的方法为：其中，PE为位置编码，pos为位置，i为维度，dmodel为维度大小，偶数维度使用正弦函数，奇数维度使用余弦函数；Q为查询向量，K为被查询信息与其他信息的相关性的向量，V为被查询信息的向量，dk为维度大小。可选的，将所述每个信号片段的重构值与立体定向脑电信号值进行比较，获取每个信号片段与背景信号的偏离值的方法为：其中，MSE为均方差函数，n为信号片段内信号点的个数，Yi为第i个真实信号，为第i个预测信号。可选的，基于所述信号片段进行处理，获取平均后的信号片段的方法包括：利用平滑非线性能量算法对所述信号片段进行转换，获取转换后的信号片段；将所述转换后的信号片段进行平均处理，获取所述平均后的信号片段。可选的，将所述平均后的信号片段输入双向长短期记忆递归神经网络模型进行所述立体定向脑电信号分类，其中所述双向长短期记忆递归神经网络模型为在长短期记忆网络的基础上引入双向传播机制和注意力机制，具体包括：ft＝σit＝σg t＝tanhct＝itgt+ftct-1ot＝σht＝ot tanh其中，σ为sigmod函数，xt为第t个时刻的输入，ht-1为上一个时刻的隐藏层向量；ft为遗忘门，Wf为遗忘门学习权重，bf为遗忘门学习权重偏置；it和gt为输入门两条支线，ct为输入门的输出，Wi和Wc为输入门学习权重，bi和bc为输入门学习权重偏置；ot为输出门，Wo为输出门学习权重，bo为输出门学习权重偏置；ht为当前t时刻计算得到的隐藏层向量；和/＞分别为由前向后和由后向前两个方向的隐藏层向量。可选的，对所述立体定向脑电信号进行评估的方法包括：其中，TP为真阳性，TN为真阴性，FP为假阳性，FN为假阴性，Accuracy为准确率，Sensitivity为灵敏度，Specificity为特异性。本发明技术效果：本发明公开了富集癫痫发作间期的癫痫样放电和预测致病灶的方法，解决由于立体脑电图发作间期的数据信号长、有效信号比值低，直接使用深度学习模型对其进行癫痫发作区分类结果差的问题，提升立体脑电图数据信噪比，有效的提高癫痫发作区的分类准确率，辅助医生对致痫区进行判断。附图说明构成本申请的一部分的附图用来提供对本申请的进一步理解，本申请的示意性实施例及其说明用于解释本申请，并不构成对本申请的不当限定。在附图中：图1为本发明实施例富集癫痫发作间期的癫痫样放电和预测致病灶的方法的流程示意图；图2为本发明实施例SEEG窗口数据的遮盖与位置编码示意图；图3为本发明实施例SEEG原始值与偏离值示意图；图4为本发明实施例富集出的癫痫样放电片段；图5为本发明实施例信号片段均值示意图；图6为本发明实施例直接分类结果与提升信噪比后结果示意图。具体实施方式需要说明的是，在不冲突的情况下，本申请中的实施例及实施例中的特征可以相互组合。下面将参考附图并结合实施例来详细说明本申请。需要说明的是，在附图的流程图示出的步骤可以在诸如一组计算机可执行指令的计算机系统中执行，并且，虽然在流程图中示出了逻辑顺序，但是在某些情况下，可以以不同于此处的顺序执行所示出或描述的步骤。如图1所示，本实施例中提供富集癫痫发作间期的癫痫样放电和预测致病灶的方法，包括以下步骤：获取患者癫痫发作间期的立体定向脑电信号；对立体定向脑电信号进行预处理，获取处理后的立体定向脑电信号；将处理后的立体定向脑电信号划分为训练集和测试集，采用滑动窗口将训练集划分为若干个信号片段，基于Transformer编码器模型对信号片段进行自监督重构训练，获取训练好的Transformer编码器模型；将测试集输入训练好的Transformer编码器模型，获取每个信号片段的重构值，将每个信号片段的重构值与立体定向脑电信号值进行比较，获取每个信号片段与背景信号的偏离值；设置偏离值的阈值，提取出所有超过偏离值的阈值的信号片段，基于信号片段进行处理，获取平均后的信号片段；将平均后的信号片段输入双向长短期记忆递归神经网络模型进行立体定向脑电信号分类并评估，完成癫痫发作间期富集癫痫样放电和预测致痫灶。使用立体定向技术对难治性癫痫患者置入SEEG电极，每根电极上有8-18个电极点，采样率为1000或2000Hz。选取较为平稳的3000-5000秒SEEG信号，睡眠期、清醒期的脑电信号均可。立体脑电图数据预处理方法和流程对SEEG信号采用双极参考，以最小化两个相邻通道之间的相关性，接着进行I Hz的高通滤波，然后统一重采样到J Hz，例如进行4Hz的高通滤波，然后统一重采样到1000Hz。在进行训练之前还需要对SEEG数据进行标准化处理，使用Z分数将数据映射到均值为0，标准差为1的正态分布中，Z分数公式如下：其中，x为输入SEEG信号，η代表SEEG信号均值，σ代表SEEG信号标准差。使用自监督模型训练SEEG发作间期数据，具体包括：模型选择与数据加载，截取出A％的SEEG信号作为训练集，剩下的数据作为测试集，测试集用于求取偏离程度值。使用滑动窗口提取数据，窗口长度为W，滑动步数为D。例如截取出20％的SEEG信号作为训练集，剩下的数据作为测试集，测试集用于求取偏离程度值。使用滑动窗口提取数据，窗口长度为256，滑动步数为1。接着本发明使用Transformer编码器对SEEG信号进行自监督重构训练，而Transformer设计之初是用于自然语言处理，因此模型输入参数为单词Embedding。为了让SEEG信号数据和Transformer输入格式对齐，本发明将SEEG信号的滑动窗口长度W定义为句子长度，将单个患者在同一时间点所采集到的信号定义为单词Embedding，即dmodel。由此一来，SEEG信号就能转化成自然语言处理的数据格式，使用Transformer进行训练。训练流程，在SEEG窗口数据在输入模型之前，需要对窗口数据进行遮盖和位置编码PE。遮盖是将窗口数据中间长度为H的部分用0将其覆盖。位置编码选取正余弦函数，位置索引值越小，波长越长，每一个位置对应的位置编码都是唯一的，位置编码公式如下：其中，pos为位置，i为维度，dmodel为维度大小，偶数维度使用正弦函数，奇数维度使用余弦函数。将位置编码与遮盖后的数据相加，相加得到的结果送入N层的Transformer编码器，Transformer内部的自注意力公式为：其中，Q为查询向量，K为被查询信息与其他信息的相关性的向量，V为被查询信息的向量，dk为维度大小。遮盖部分的输出为遮盖的重构值，将其保留，其余位置输出舍弃，将重构值与遮盖之前的原始数据进行比对，采用均方误差求取损失，均方误差公式如下：其中，n为信号片段内信号点的个数，Yi为第i个真实信号，为第i个预测信号。例如遮盖是将窗口数据中间长度为16的部分用0将其覆盖，将遮盖后的数据与位置编码相加，相加得到的结果送入2层的Transformer编码器。设计详情如图2所示。计算偏离值，具体包括：使用与训练集相同的滑动窗口提取测试集的窗口数据，窗口数据经过遮盖和位置编码，输入训练好的模型，模型的输出为重构值。将重构值与遮盖之前的原始数据进行比对，求均方误差。均方误差值越大，说明该滑动窗口的信号与背景信号差异较大，均方误差值越小，说明差异越小。因此，本发明将该均方误差值定义为滑动窗口与背景信号的偏离值。富集癫痫样放电，具体包括：求出偏离值之后，将偏离值平均，使用Z分数对偏离值进行标准化，并标记出平均异常值的所有波峰，设定阈值为3，大于3个标准差的波峰会被定义为偏离异常。以波峰为中点，在SEEG信号上截取出长度为200的信号片段，如图3所示。相比于直接使用SEEG信号进行分类，这种截取信号的方式可以极大提高SEEG数据的信噪比。信号片段进行平均，具体包括：信号片段截取出来后，如图4所示，使用平滑非线性能量算法对其进行转换。直接对SEEG信号片段进行平均会造成部分高频信息丢失，SNE可以有效的保留高频信息。SNE分为两个步骤：非线性能量算子和加窗。NEO是一种用于估计线性振子的能量含量的算子。它可以利用信号的频率和幅度信息，而不仅仅是幅度信息。同时它的输出与输入信号的幅度和频率的乘积成正比，这样可以突出高频成分，抑制低频成分。对于离散信号x，NEO的表达式为：ψ＝x2-xx。为了进一步提高NEO表征非平稳信号的能力，通常会在NEO算法中附加一个窗函数，公式为：ψs＝ω*ψ其中，w是三角窗函数，*表示卷积运算，输出的ψs为SNE值，输入输出的长度相等，皆为M。SNE输入输出的长度相等，皆为200。完成SNE转换后，将单个电极点上的所有SNE信号片段进行平均，最终每个电极点得到一个长度为200的一维SNE信号片段。如图5所示。本发明选取双向长短期记忆递归神经网络对一维SNE信号片段进行分类，双向长短期记忆递归神经网络是在长短期记忆网络的基础上引入双向传播机制。LSTM模块的公式如下：ft＝σit＝σgt＝tanhct＝itgt+ftct-1ot＝σht＝ottanh其中，σ为sigmod函数，xt为第t个时刻的输入，ht-1为上一个时刻的隐藏层向量；ft为遗忘门，Wf为遗忘门学习权重，bf为遗忘门学习权重偏置；it和gt为输入门两条支线，ct为输入门的输出，Wi和Wc为输入门学习权重，bi和bc为输入门学习权重偏置；ot为输出门，Wo为输出门学习权重，bo为输出门学习权重偏置。加入前后双向传播机制，可以更有效的利用时序信号的前后双向信息，公式如下：其中，和/＞分别表示由前向后和由后向前两个方向的隐藏层向量。模型性能的评估详情如下：真阴性是指实际为负类而模型预测为负类的情况，在本发明中是指实际为非SOZ而模型也预测为非SOZ；假阳性是指实际为负类而模型将其预测为正类的情况，在本发明中是指实际为非SOZ而模型却预测为SOZ；假阴性是指实际为正类而模型将其预测为负类的情况，在本发明中是指实际为SOZ而模型却预测为非SOZ；真阳性是指实际为正类且模型预测为正类的情况，在本发明中是指实际为SOZ而模型也预测为SOZ；准确率是指所有被预测为正的样本中实际为正的样本的概率；灵敏度是指在所有病例中，确诊为阳性的比例，也称为真阳性率；特异性是指所有负样本中被分类正确的比例，衡量了分类器对负样本的识别能力，公式如下：其中，TP为真阳性，TN为真阴性，FP为假阳性，FN为假阴性，Accuracy为准确率，Sensitivity为灵敏度，Specificity为特异性。在本发明中，将使用准确率、灵敏度和特异性作为机器学习分类算法的评价指标。将患者随机分为五组，做患者间的5折交叉验证，既四组患者作为训练，其余一组作为测试。然后把测试集和训练集输入双向长短期记忆递归神经网络进行训练、测试、评估。最后将直接分类的结果与提升SEEG的信噪比后的结果进行比较。如图6所示。以上，仅为本申请较佳的具体实施方式，但本申请的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本申请揭露的技术范围内，可轻易想到的变化或替换，都应涵盖在本申请的保护范围之内。因此，本申请的保护范围应该以权利要求的保护范围为准。
