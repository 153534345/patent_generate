标题title
一种加热烟具电路及其控制方法
摘要abst
本发明公开了一种加热烟具电路及其控制方法，本发明通过获取所述采样电阻的压降和所述发热器件的压降并计算压降比值，从预先存储的温度对照表中查表找到所述压降比值所对应的烟具温度，如此减少计算延迟，提高检测精度；进一步地，采用两个0dB增益的差分运算放大器采样技术，既有效抑制电源引起的共模电压干扰，又避免高增益放大引入的误差；提供两种校准方式来对温度对照表进行校准，保证测温的准确性；根据烟具温度变化判断发生一口抽吸，精确判读抽吸参数，可以监测参数优化烟具控制，实现改善抽吸烟气感受，智能匹配使用者抽吸习惯的改进效果，特别是本发明通过查表方式直接确定抽吸容量值，利用找到的抽吸容量值对烟具的温控参数进行优化。
权利要求书clms
1.一种加热烟具电路，其特征在于，包括控制电路和电压采样电路，所述电压采样电路包括采样电阻，所述采样电阻与烟具的发热器件共同串接于加热电源之间；所述控制电路中预存有温度对照表，所述温度对照表中记录了以固定的温度梯度增加的多个温度值以及各个温度值所对应的所述发热器件和采样电阻的压降比值，所述控制电路用于控制所述发热器件发热以及执行测温操作；所述测温操作包括：获取所述采样电阻的压降和所述发热器件的压降并计算压降比值，从预先存储的温度对照表中查表找到所述压降比值所对应的烟具温度。2.根据权利要求1所述的加热烟具电路，其特征在于，所述控制电路包括MCU，所述电压采样电路包括两个0dB增益的差分运算放大器，其中一个所述差分运算放大器的两个输入端连接于所述采样电阻的两端，另一个所述差分运算放大器的两个输入端连接于所述发热器件的两端，两个所述差分运算放大器的输出端分别连接所述MCU的两个ADC引脚。3.根据权利要求2所述的加热烟具电路，其特征在于，还包括分时加热和测温电路，所述分时加热和测温电路包括受控于所述MCU周期性的交替工作的加热开关和测温开关，所述发热器件的第一端连接所述加热电源的正极，所述发热器件的第二端连接所述采样电阻的第一端，所述发热器件的第二端还经由所述加热开关连接所述加热电源的负极，所述采样电阻的第二端经由所述测温开关连接所述加热电源的负极，所述加热开关和测温开关的控制端连接所述MCU。4.根据权利要求3所述的加热烟具电路，其特征在于，所述MCU用于在接收到启动信号时交替进入加热周期和测温周期，在加热周期时发送PWM信号给所述加热开关工作、并断开所述测温开关，在测温周期时断开所述加热开关并导通所述测温开关；所述MCU在每一个测温周期内执行所述测温操作，并在检测出的烟具温度低于设定温度值时降低下一个加热周期的PWM信号的占空比，在检测出的烟具温度高于设定温度值时提高下一个加热周期的PWM信号的占空比，在检测出的烟具温度达到设定温度值时维持下一个加热周期的PWM信号的占空比不变。5.根据权利要求1所述的加热烟具电路，其特征在于，所述控制电路还用于在检测出的烟具温度下降超过预设温度差且持续时间超过预设时间长度范围中的某一预设值时，判定发生了一口抽吸，根据每一口烟所测得所述压降比值的变化极大值，在预存的抽吸容量对照表中查询找到当前口抽吸所对应的抽吸容量，将找到的抽吸容量值对烟具的温控参数进行优化；所述抽吸容量对照表中记录了以固定的容量梯度增加的多个抽吸容量以及各个抽吸容量所对应的所述压降比值的变化极大值。6.一种加热烟具电路控制方法，其特征在于，基于权利要求1-5任一项所述的电路实现，所述方法包括：测温步骤：所述控制电路获取所述采样电阻的压降和所述发热器件的压降并计算压降比值，从预先存储的温度对照表中查表找到所述压降比值所对应的烟具温度。7.根据权利要求6所述的方法，其特征在于，所述方法还包括：所述控制电路接收启动信号时交替进入加热周期和测温周期，在加热周期时发送PWM信号给所述加热开关工作、并断开所述测温开关，在测温周期时断开所述加热开关并导通所述测温开关，且在每一个测温周期内执行所述测温步骤，并在检测出的烟具温度低于设定温度值时降低下一个加热周期的PWM信号的占空比，在检测出的烟具温度高于设定温度值时提高下一个加热周期的PWM信号的占空比，在检测出的烟具温度达到设定温度值时维持下一个加热周期的PWM信号的占空比不变。8.根据权利要求6所述的方法，其特征在于，所述方法还包括如下的校准步骤：电脑端在烟具工作温度范围内以固定的温度梯度为间隔，确定多个温度值，依次取各个温度值作为指定温度执行温度校准操作得到各个温度值对应的压降比值，所述温度校准操作包括：启动红外热成像测温仪实时采集烟具的热像数据,对实时采集的热像数据进行图像处理后测定出所述烟具的温度值，根据实时测得的温度值控制所述烟具加热至实时测得的温度值达到指定温度，当实时测得的温度值稳定在指定温度时，通知所述烟具上报实时测得的所述发热器件和采样电阻的压降比值；利用得到的各个温度值及其对应的压降比值形成温度对照表存储到所述烟具中。9.根据权利要求1所述的方法，其特征在于，所述方法还包括如下的校准步骤：电脑端在烟具工作温度范围内选取若干个温度值，依次取各个温度值作为指定温度执行温度校准操作得到各个温度值对应的压降比值，所述温度校准操作包括：启动红外热成像测温仪实时采集所述烟具的热像数据,对实时采集的热像数据进行图像处理后测定出所述烟具的温度值，根据实时测得的温度值控制所述烟具加热至实时测得的温度值达到指定温度，当实时测得的温度值稳定在指定温度时，通知所述烟具上报实时测得的所述发热器件和采样电阻的压降比值；根据各个温度值对应的压降比值，基于计算式RL=R1*V1/VL计算出各个温度值对应的发热器件的阻值，其中V1/VL表示压降比值，R1表示采样电阻的阻值；根据各个温度值对应的发热器件的阻值，得到发热器件的阻值与温度值在烟具工作温度范围内的拟合方程；在烟具工作温度范围内以固定的温度梯度为间隔确定多个温度值，根据所述拟合方程计算各个温度值对应的发热器件的阻值，根据采样电阻的阻值和各个温度值对应的发热器件的阻值计算得到各个温度值对应的压降比值；利用得到的各个温度值及其对应的压降比值形成温度对照表存储到所述烟具中。10.根据权利要求1所述的方法，其特征在于，所述方法还包括：将烟具接入到吸烟机的抽吸通道中，电脑端启动所述烟具；在预设抽吸容量范围内，以固定的容量梯度改变吸烟机的抽吸容量并均执行如下步骤得到各个抽吸容量与所述压降比值的变化极大值的对应关系：所述烟具加热到预设温度并保持稳定后，发送实时测得的所述压降比值到所述电脑端，电脑端在所述烟具温度达到稳定后，启动吸烟机按预设的抽吸参数完成一口抽吸，所述抽吸参数包括抽吸容量、流量峰型、抽吸时长；在吸烟机完成前述一口的抽吸时间内，烟具向电脑端实时发送所测得的所述压降比值，电脑端记录所述压降比值的变化极大值以及对应的吸烟机当前的抽吸容量；将各抽吸容量及所述压降比值的变化极大值的对应关系形成抽吸容量对照表写入到烟具的可读存储单元中；烟具工作时，在检测出的烟具温度下降超过预设温度差且持续时间超过预设时间长度范围中的某一预设值时，判定发生了一口抽吸，根据每一口烟所测得所述压降比值的变化极大值，在所述抽吸容量对照表中查询找到当前口抽吸所对应的抽吸容量，根据抽吸口数、抽吸持续时间、抽吸间隔时间、抽吸容量值对烟具的温控参数进行优化。
说明书desc
技术领域本发明涉及日用电子产品领域，尤其涉及一种加热烟具电路及其控制方法。背景技术加热烟具的温度控制对消费者的抽吸感受影响很大，温度控制的精度和稳定性是烟具控制的核心。此外，使用者的抽吸口数、抽吸持续时间、抽吸间隔时间、抽吸容量等参数信息，可为烟具的精确控制提供相关参数信息。当前对于烟具加热的温度控制策略多是对发热体电阻阻值变化进行检测，根据发热体的温度电阻关系计算出发热体的温度，再与设定目标温度进行比较，通过控制器对加热单元的输出功率进行相应调节以期达到调控温度的目的。这种温度计算需要进行较为复杂的运算，由于成本规制因素下烟具芯片的算力较差，计算过程存在延迟，因此难以实时检测出精确的温度值，检测精度只能达到±2.5℃。另外，发热体材料的TCR曲线多是非线性的。有些发热体材料温度阻值变化曲线斜率较小，导致在整个加热过程中其阻值变化量很小，很难被检测到，需要应用高增益差分运放大器，但其会引入较大的误差，不适合用在外围环形加热。另外，MCU直接读取加在发热器件的电压值，会引入电源的共模电压干扰，影响MCUADC的采样精度。基于温度检测值的烟具加热温度控制在延迟和误差的双重影响下，温度控制精度存在较大偏离，给烟具使用者带来不良的抽吸体验，严重影响消费者对产品的评价。发明内容本发明要解决的技术问题在于，针对现有技术的温度检测和控温精度存在的上述缺陷，提供一种加热烟具电路及其控制方法。本发明解决其技术问题所采用的技术方案是：构造一种加热烟具电路，包括控制电路和电压采样电路，所述电压采样电路包括采样电阻，所述采样电阻与烟具的发热器件共同串接于加热电源之间；所述控制电路中预存有温度对照表，所述温度对照表中记录了以固定的温度梯度增加的多个温度值以及各个温度值所对应的所述发热器件和采样电阻的压降比值，所述控制电路用于控制所述发热器件发热以及执行测温操作；所述测温操作包括：获取所述采样电阻的压降和所述发热器件的压降并计算压降比值，从预先存储的温度对照表中查表找到所述压降比值所对应的烟具温度。优选地，所述控制电路包括MCU，所述电压采样电路包括两个0dB增益的差分运算放大器，其中一个所述差分运算放大器的两个输入端连接于所述采样电阻的两端，另一个所述差分运算放大器的两个输入端连接于所述发热器件的两端，两个所述差分运算放大器的输出端分别连接所述MCU的两个ADC引脚。优选地，还包括分时加热和测温电路，所述分时加热和测温电路包括受控于所述MCU周期性的交替工作的加热开关和测温开关，所述发热器件的第一端连接所述加热电源的正极，所述发热器件的第二端连接所述采样电阻的第一端，所述发热器件的第二端还经由所述加热开关连接所述加热电源的负极，所述采样电阻的第二端经由所述测温开关连接所述加热电源的负极，所述加热开关和测温开关的控制端连接所述MCU。优选地，所述MCU用于在接收到启动信号时交替进入加热周期和测温周期，在加热周期时发送PWM信号给所述加热开关工作、并断开所述测温开关，在测温周期时断开所述加热开关并导通所述测温开关；所述MCU在每一个测温周期内执行所述测温操作，并在检测出的烟具温度低于设定温度值时降低下一个加热周期的PWM信号的占空比，在检测出的烟具温度高于设定温度值时提高下一个加热周期的PWM信号的占空比，在检测出的烟具温度达到设定温度值时维持下一个加热周期的PWM信号的占空比不变。优选地，所述控制电路还用于在检测出的烟具温度下降超过预设温度差且持续时间超过预设时间长度范围中的某一预设值时，判定发生了一口抽吸，根据每一口烟所测得所述压降比值的变化极大值，在预存的抽吸容量对照表中查询找到当前口抽吸所对应的抽吸容量，将找到的抽吸容量值对烟具的温控参数进行优化；所述抽吸容量对照表中记录了以固定的容量梯度增加的多个抽吸容量以及各个抽吸容量所对应的所述压降比值的变化极大值。本发明另一方面还构造一种加热烟具电路控制方法，基于前述电路实现，所述方法包括：测温步骤：所述控制电路获取所述采样电阻的压降和所述发热器件的压降并计算压降比值，从预先存储的温度对照表中查表找到所述压降比值所对应的烟具温度。优选地，所述方法还包括：所述控制电路接收启动信号时交替进入加热周期和测温周期，在加热周期时发送PWM信号给所述加热开关工作、并断开所述测温开关，在测温周期时断开所述加热开关并导通所述测温开关，且在每一个测温周期内执行所述测温步骤，并在检测出的烟具温度低于设定温度值时降低下一个加热周期的PWM信号的占空比，在检测出的烟具温度高于设定温度值时提高下一个加热周期的PWM信号的占空比，在检测出的烟具温度达到设定温度值时维持下一个加热周期的PWM信号的占空比不变。优选地，所述方法还包括如下的校准步骤：电脑端在烟具工作温度范围内以固定的温度梯度为间隔，确定多个温度值，依次取各个温度值作为指定温度执行温度校准操作得到各个温度值对应的压降比值，所述温度校准操作包括：启动红外热成像测温仪实时采集烟具的热像数据,对实时采集的热像数据进行图像处理后测定出所述烟具的温度值，根据实时测得的温度值控制所述烟具加热至实时测得的温度值达到指定温度，当实时测得的温度值稳定在指定温度时，通知所述烟具上报实时测得的所述发热器件和采样电阻的压降比值；利用得到的各个温度值及其对应的压降比值形成温度对照表存储到所述烟具中。优选地，所述方法还包括如下的校准步骤：电脑端在烟具工作温度范围内选取若干个温度值，依次取各个温度值作为指定温度执行温度校准操作得到各个温度值对应的压降比值，所述温度校准操作包括：启动红外热成像测温仪实时采集所述烟具的热像数据,对实时采集的热像数据进行图像处理后测定出所述烟具的温度值，根据实时测得的温度值控制所述烟具加热至实时测得的温度值达到指定温度，当实时测得的温度值稳定在指定温度时，通知所述烟具上报实时测得的所述发热器件和采样电阻的压降比值；根据各个温度值对应的压降比值，基于计算式RL=R1*V1/VL计算出各个温度值对应的发热器件的阻值，其中V1/VL表示压降比值，R1表示采样电阻的阻值；根据各个温度值对应的发热器件的阻值，得到发热器件的阻值与温度值在烟具工作温度范围内的拟合方程；在烟具工作温度范围内以固定的温度梯度为间隔确定多个温度值，根据所述拟合方程计算各个温度值对应的发热器件的阻值，根据采样电阻的阻值和各个温度值对应的发热器件的阻值计算得到各个温度值对应的压降比值；利用得到的各个温度值及其对应的压降比值形成温度对照表存储到所述烟具中。优选地，所述方法还包括：将烟具接入到吸烟机的抽吸通道中，电脑端启动所述烟具；在预设抽吸容量范围内，以固定的容量梯度改变吸烟机的抽吸容量并均执行如下步骤得到各个抽吸容量与所述压降比值的变化极大值的对应关系：所述烟具加热到预设温度并保持稳定后，发送实时测得的所述压降比值到所述电脑端，电脑端在所述烟具温度达到稳定后，启动吸烟机按预设的抽吸参数完成一口抽吸，所述抽吸参数包括抽吸容量、流量峰型、抽吸时长；在吸烟机完成前述一口的抽吸时间内，烟具向电脑端实时发送所测得的所述压降比值，电脑端记录所述压降比值的变化极大值以及对应的吸烟机当前的抽吸容量；将各抽吸容量及所述压降比值的变化极大值的对应关系形成抽吸容量对照表写入到烟具的可读存储单元中；烟具工作时，在检测出的烟具温度下降超过预设温度差且持续时间超过预设时间长度范围中的某一预设值时，判定发生了一口抽吸，根据每一口烟所测得所述压降比值的变化极大值，在所述抽吸容量对照表中查询找到当前口抽吸所对应的抽吸容量，根据抽吸口数、抽吸持续时间、抽吸间隔时间、抽吸容量值对烟具的温控参数进行优化。本发明的加热烟具电路及其控制方法，具有以下有益效果：本发明获取采样电阻的压降和发热器件的压降，计算压降比值后从预先存储的温度对照表中查表找到压降比值所对应的烟具温度，减少计算延迟，提高检测精度；进一步地，本发明采用两个0dB增益的差分运算放大器采样技术，既可以有效抑制电源引起的共模电压干扰，又避免了高增益放大引入的误差，保证了MCU温度控制精准，可以实现口数的精准检测；进一步地，本发明还提供两种校准方式来对温度对照表进行校准，保证测温的准确性；进一步地，根据烟具温度变化判断发生一口抽吸，精确判读抽吸参数，可以监测参数优化烟具控制，实现改善抽吸烟气感受，智能匹配使用者抽吸习惯的改进效果，特别是本发明通过查表方式直接确定抽吸容量值，利用找到的抽吸容量值对烟具的温控参数进行优化。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据提供的附图获得其他的附图：图1是本发明加热烟具电路的结构示意图；图2是控制信号A的波形图；图3是控制信号B的波形图；图4是采样电阻R1两端V1电压的波形图；图5是发热器件RL两端VL电压的波形图；图6是测温步骤流程图。具体实施方式为了便于理解本发明，下面将参照相关附图对本发明进行更全面的描述。附图中给出了本发明的典型实施例。但是，本发明可以以许多不同的形式来实现，并不限于本文所描述的实施例。相反地，提供这些实施例的目的是使对本发明的公开内容更加透彻全面。除非另有定义，本文所使用的所有的技术和科学术语与属于本发明的技术领域的技术人员通常理解的含义相同。本文中在本发明的说明书中所使用的术语只是为了描述具体的实施例的目的，不是旨在于限制本发明。本说明书中使用的“第一”、“第二”等包含序数的术语可用于说明各种构成要素，但是这些构成要素不受这些术语的限定。使用这些术语的目的仅在于将一个构成要素区别于其他构成要素。例如，在不脱离本发明的权利范围的前提下，第一构成要素可被命名为第二构成要素，类似地，第二构成要素也可以被命名为第一构成要素。本发明总的思路是：设置与烟具的发热器件共同串接于加热电源之间的采样电阻，控制电路中预存有温度对照表，所述温度对照表中记录了以固定的温度梯度增加的多个温度值以及各个温度值所对应的所述发热器件和采样电阻的压降比值，所述控制电路通过获取所述采样电阻的压降和所述发热器件的压降并计算压降比值，从预先存储的温度对照表中查表找到所述压降比值所对应的烟具温度，此种方式可以有效减少计算延迟，提高检测精度。为了更好的理解上述技术方案，下面将结合说明书附图以及具体的实施方式对上述技术方案进行详细的说明，应当理解本发明实施例以及实施例中的具体特征是对本申请技术方案的详细的说明，而不是对本申请技术方案的限定，在不冲突的情况下，本发明实施例以及实施例中的技术特征可以相互组合。实施例一本实施例公开了一种加热烟具电路，包括控制电路、分时加热和测温电路、电压采样电路。所述控制电路包括MCU、复位按键SW，所述电压采样电路包括采样电阻R1、两个0dB增益的差分运算放大器U5和U6，采样电阻R1是精密电阻。分时加热和测温电路包括加热开关和测温开关。本实施例中，一个所述差分运算放大器U6的两个输入端连接于所述采样电阻R1的两端，另一个所述差分运算放大器U5的两个输入端连接于烟具的发热器件RL的两端，两个所述差分运算放大器U5、U6的输出端分别连接所述MCU的两个ADC引脚ADC2和ADC1。加热开关主要是在接收PWM信号时控制发热器件的发热，测温开关主要是在导通时辅助MCU实现测温操作，如果要加热则启用加热开关、禁用测温开关，反之，如果要测温则启用测温开关、禁用加热开关。加热开关、测温开关是电控开关，本实施例中，测温开关是一个电控控制开关U3，加热开关是电控控制开关U4。优选的，加热开关还配置了一个前级开关，具体是一个电控控制开关U2。电控控制开关U2-U4可以采用IGBT或者MOS管等。本实施例中，开关U2为低压小功率PMOS管，U3、U4为低压大功率 NMOS管。具体的，所述发热器件RL的第一端连接所述加热电源的正极，具体是4.2V电池的正极，所述发热器件RL的第二端连接所述采样电阻R1的第一端，所述采样电阻R1的第二端经由所述测温开关连接所述加热电源的负极，具体是4.2V电池的负极，U3的控制端连接MCU的一个IO脚。所述发热器件RL的第二端还经由所述加热开关连接所述加热电源的负极，U4的控制端连接MCU的一个输出PWM信号的PWM引脚，此处U4的控制端并非直接连接MCU的PWM引脚，而是经由U2连接MCU，U2是U4的前级开关，具体的，U4的控制端连接U2的输出端，U4的控制端还经由下拉电阻R2接加热电源的负极，U2的输入端连接MCU的PWM引脚，U2的控制端与U3的控制端共接到MCU的同一个IO脚，当然也可以为U2的控制端另外分配一个MCU的IO脚，这些都是本实施例的简单变形，都在本实施例的保护范围之内，本实施例中将U2和U3共用一个IO脚，不仅可以节省IO脚，而且保证了两个开关的状态切换的同步。本实施例通过两个差分运算放大器直接得到采样电阻的两端电压的差值V1=Va-VL，和加在发热器件上的两端电压的差值VL=Va-V1，减少一次减法运算，差分运算放大器又能有效抑制电源引起的共模电压干扰，极大地提高了采样精度。假设，室温T1时发热丝的电阻RL，其TCR值为TCR，根据公式：V1/R1=VL/RL；T=T1+/ ；将式代入式，则得到：T=T1+/ ；式中，RL、TCR、R1都是已知的，可见T与VL/V1是线性相关的。但是，此公式计算量非常大，比如说假设T1是25℃，TCR=0.003/℃，R1=1Ω，RL=0.7Ω ，代入式，则得到：T=476*-308 ；式运算时476倍的乘法运算会产生运算误差，对MCU的运算能力要求较高，因此为了减少MCU的计算量和计算延迟，提升MCU的处理速度，减少计算误差，本实施例中，所述MCU中预存有温度对照表，所述温度对照表中记录了以固定的温度梯度增加的多个温度值以及各个温度值所对应的所述发热器件和采样电阻的压降比值VL/V1。MCU的测温操作包括：获取所述采样电阻的压降和所述发热器件的压降并计算压降比值VL/V1，从预先存储的温度对照表中查表找到所述压降比值VL/V1所对应的烟具温度。例如，一个具体的示例中，烟具工作温度范围是220℃至260℃，每间隔1℃记录一个VL/V1，见表1，与双差分运算放大器采样技术一起实现精准控制温度，温度测定和控制精度提高到±1℃以内。表1 温度和VL/V1对照表本实施例中，加热开关和测温开关受控于所述MCU周期性的交替工作。所述MCU在接收到启动信号时，交替进入加热周期和测温周期，在加热周期时发送PWM信号给所述加热开关工作、并断开所述测温开关，在测温周期时断开所述加热开关并导通所述测温开关。所述MCU在每一个测温周期内执行测温操作，并在检测出的烟具温度低于设定温度值时降低下一个加热周期的PWM信号的占空比，在检测出的烟具温度高于设定温度值时提高下一个加热周期的PWM信号的占空比，在检测出的烟具温度达到设定温度值时维持下一个加热周期的PWM信号的占空比不变。如图2-5，MCU的一个工作周期长度为t，加热周期长度为t2、测温周期长度为t1，t=t1+ t2，如图2、3示意了在加热周期t2、测温周期t1内的控制信号A、B的波形。1）进入加热周期t2，控制信号A是低电平，因此U3断开而无法测温，U4导通，发热器件加热，U4将输入的PWM信号输出即控制信号B，控制信号B是20Khz的PWM占空比50%的脉冲；2）加热周期t2完毕后进入测温周期t1，控制信号A是高电平，因此U3导通可以测温，U4断开无法加热，t1时间内MCU根据ADC1和ADC2口采集的V1的值和VL的值，如图4-5展示了V1、VL的波形，计算出VL/V1，查询温度对照表，找到VL/V1对应的温度值T，当然可以理解的是，温度对照表中可能没有与当前的VL/V1完全相同的值，此时找到最近接的即可。在t1时间内：如果温度值T与设定温度值相同，则下个加热周期t2可以按照此前加热周期t2中的PWM信号继续控制加热，即控制信号B还是20Khz PWM占空比保持不变进行加热，从而完成温度控制；如果T的值与设定温度值不相同，则需要调整PWM信号占空比变大或变小，然后进行下一个周期加热，具体的，温度低了则提高PWM占空比，温度高了，则降低占空比。重复以上步骤1）和2），最终T的值与设定温度值相同。本实施例中，周期t为10ms，t1为0.2ms，t2为9.8ms。周期t的长短理论上越小越好，这样每个周期t内的闲置时间就会变小，从而使计算得到的温度值更加接近真实值，闲置时间过长，温度会回落，误差增大。经实际测试t的时长要小于25ms才能满足要求。可见，本发明是大电流加热和小电流测温两种模式分时交替进行。在小电流测温时，利用发热器件有一定的热容量，温度变化慢的特性。两种模式的切换频率足够快，发热器件在一个交替周期内，温度变化小于1℃，能够满足电子烟温控的要求。进一步地，当烟具启动并加热到预设的工作温度后，用户可进行烟支的抽吸，抽吸动作发生时，外部空气经烟具的气道流经烟支和发热器件，由于气流的冷却作用，烟支和发热器件的热量被所流经的气体带走，造成发热器件温度降低，发热器件温度降低相应的TCR值发生变化，最终反映为烟具检测到的V1/VL值发生改变。因前面提到，本发明可精确测定温度， MCU在检测出的烟具温度下降超过预设温度差且持续时间超过预设时间长度范围中的某一预设值时，判定发生了一口抽吸。基于烟具精确控温，可分析出用户在使用过程中的行为习惯，获取到用户的抽吸口数、抽吸口序、抽吸持续时间、抽吸间隔时间、抽吸容量等抽吸状态参数信息。所获取到的抽吸状态可用于统计分析和优化烟具控制，以用户习惯为参考的个性化改善等方面。比如，MCU可以对测到的温度值T的变化对时间做积分和求导处理，可进一步分析出使用者的抽吸过程参数，温度值T下降的快慢表征抽吸的气流速度流量，温度值T下降的持续时间表征该口次的抽吸持续时间，温度值T与时间的积分面积表征该口的抽吸气体流量，两口抽吸之间的时间间隔为抽吸间隔时间。所检测和分析到的使用者抽吸过程参数信息，可写入到烟具的可读存取单元中，作为统计分析和烟具优化控制的基础数据。其中，优选地，对于抽吸容量的计算，为了提高计算速率，MCU预存了对照表，抽吸容量对照表中记录了以固定的容量梯度增加的多个抽吸容量以及各个抽吸容量所对应的所述压降比值的变化极大值。MCU在工作过程中，根据每一口烟所测得所述压降比值的变化极大值，在预存的抽吸容量对照表中查询找到当前口抽吸所对应的抽吸容量，将找到的抽吸容量值对烟具的温控参数进行优化。实施例二本实施例是一种加热烟具电路控制方法，基于实施例一的烟具电路实现，所述方法包括：MCU接收启动信号时交替进入加热周期和测温周期，在加热周期时发送PWM信号给所述加热开关工作、并断开所述测温开关，在测温周期时断开所述加热开关并导通所述测温开关，且在每一个测温周期内执行测温步骤，并在检测出的烟具温度低于设定温度值时降低下一个加热周期的PWM信号的占空比，在检测出的烟具温度高于设定温度值时提高下一个加热周期的PWM信号的占空比，在检测出的烟具温度达到设定温度值时维持下一个加热周期的PWM信号的占空比不变。参考图6，测温步骤包括：所述控制电路获取所述采样电阻的压降和所述发热器件的压降并计算压降比值，从预先存储的温度对照表中查表找到所述压降比值所对应的烟具温度。更多内容可以参考实施例一部分，此处不再赘述。由于发热器件材料本身特性决定了其TCR曲线多为非线性的，生产中由于加热元件的TCR值是3000ppm±10%，用标准TCR值3000ppm计算有可能会引入±10%的误差，这也是温度测定误差的来源之一。为了减少这种误差，本实施例还提出对温度对照表进行校准，对TCR值及温度和VL/V1关系进行校准测定，以实测校准结果对温度和VL/V1的表及TCR曲线进行修正，并将修正过的温度对照表写入到该烟具的可读存储单元中。烟具使用时以修正过的温度对照表反馈温度实测值给MCU进行温度控制，从而进一步减少控温误差。下面首先介绍校准系统。校准系统包括电脑端、烟具、红外热成像测温仪，红外热成像测温仪与电脑端是USB通信，烟具与电脑端是串口通信。借助此系统，本实施例提供两种校准方法，第一种校准方法精度相对更高，第二种校准方法工作量相对较小。第一种校准方法包括如下的校准步骤：a1）烟具和红外热成像测温仪固定在工作台上，通过数据线连接到电脑，设备运行环境温湿度保持恒定。a2）电脑端在烟具工作温度范围内以固定的温度梯度为间隔，确定多个温度值，依次取各个温度值作为指定温度执行温度校准操作得到各个温度值对应的压降比值。每一个温度值对应的所述温度校准操作是：启动红外热成像测温仪实时采集烟具的热像数据,对实时采集的热像数据进行图像处理后测定出所述烟具的温度值，根据实时测得的温度值控制所述烟具加热至实时测得的温度值达到指定温度，当实时测得的温度值稳定在指定温度时，通知所述烟具上报实时测得的所述发热器件和采样电阻的压降比值。a3）利用得到的各个温度值及其对应的压降比值形成温度对照表存储到所述烟具中。第二种校准方法包括如下的校准步骤：b1）烟具和红外热成像测温仪固定在工作台上，通过数据线连接到电脑，设备运行环境温湿度保持恒定。b2）电脑端在烟具工作温度范围内选取若干个温度值，比如取10个，依次取各个温度值作为指定温度执行温度校准操作得到各个温度值对应的压降比值；所取的10个温度值中，每一个温度值对应的所述温度校准操作是：启动红外热成像测温仪实时采集所述烟具的热像数据,对实时采集的热像数据进行图像处理后测定出所述烟具的温度值，根据实时测得的温度值控制所述烟具加热至实时测得的温度值达到指定温度，当实时测得的温度值稳定在指定温度时，通知所述烟具上报实时测得的所述发热器件和采样电阻的压降比值；b3）根据各个温度值对应的压降比值，基于计算式RL=R1*V1/VL计算出各个温度值对应的发热器件的阻值；b4）根据各个温度值对应的发热器件的阻值，得到发热器件的阻值与温度值在烟具工作温度范围内的拟合方程；比如说，上面10个温度值对应有了10个数据，我们可以按照温度值大小排序，相邻的两个温度值的数据按照如下TCR的定义式进行一次计算得到一个TCR平均值：TCR=- RL）/*）；上式中，T1、T2是代表两个相邻的温度值；最后将所有得到的TCR平均值中的最小、最大的数据去掉，剩下的再求平均作为我们需要的TCR值。b5）在烟具工作温度范围内以固定的温度梯度为间隔确定多个温度值，根据所述拟合方程即式，计算各个温度值对应的发热器件的阻值，根据采样电阻的阻值和各个温度值对应的发热器件的阻值计算得到各个温度值对应的压降比值；b6）利用得到的各个温度值及其对应的压降比值形成温度对照表存储到所述烟具中。同理，本实施例还对抽吸容量对照表进行校准，校准方法是：c1）将烟具接入到吸烟机的抽吸通道中，电脑端启动所述烟具；c2）在预设抽吸容量范围内，以固定的容量梯度改变吸烟机的抽吸容量并均执行如下步骤得到各个抽吸容量与所述压降比值的变化极大值的对应关系：所述烟具加热到预设温度并保持稳定后，发送实时测得的所述压降比值到所述电脑端，电脑端在所述烟具温度达到稳定后，启动吸烟机按预设的抽吸参数完成一口抽吸，所述抽吸参数包括抽吸容量、流量峰型、抽吸时长；在吸烟机完成前述一口的抽吸时间内，烟具向电脑端实时发送所测得的所述压降比值，电脑端记录所述压降比值的变化极大值以及对应的吸烟机当前的抽吸容量；c3）将各抽吸容量及所述压降比值的变化极大值的对应关系形成抽吸容量对照表写入到烟具的可读存储单元中。烟具工作时，在检测出的烟具温度下降超过预设温度差且持续时间超过预设时间长度范围中的某一预设值时，判定发生了一口抽吸，进而就可以得到抽吸口数、抽吸持续时间、抽吸间隔时间，至于抽吸容量，则是根据每一口烟所测得所述压降比值的变化极大值，在所述抽吸容量对照表中查询找到当前口抽吸所对应的抽吸容量，根据抽吸口数、抽吸持续时间、抽吸间隔时间、抽吸容量值对烟具的温控参数进行优化。上面结合附图对本发明的实施例进行了描述，但是本发明并不局限于上述的具体实施方式，上述的具体实施方式仅仅是示意性的，而不是限制性的，本领域的普通技术人员在本发明的启示下，在不脱离本发明宗旨和权利要求所保护的范围情况下，还可做出很多形式，这些均属于本发明的保护之内。
