标题title
一种基于多视图进行心电信号重点区域检测的方法
摘要abst
本发明公开了一种基于多视图进行心电信号重点区域检测的方法，属于医疗技术与深度学习技术领域，解决现有技术中可视化效果粗糙，无法精确定位的问题。本发明依次包括：1)心电信号的收集；2)提取心电信号的浅层视图；3)构建卷积神经网络；4)基于卷积神经网络获取心电信号的预测结果Y；5)基于预测结果Y训练卷积神经网络；6)基于预测结果Ys和Grad‑CAM技术得到待识别的心电信号的显著图；7)直观显示卷积神经网络重点关注区域的输出图片。本发明用于心电信号重点区域的检测。
权利要求书clms
1.一种基于多视图进行心电信号重点区域检测的方法，其特征在于，包括：步骤1：获取一定量级已有标签标记的心电信号集，心电信号集包括健康人体的心电信号和不同类型的心律不齐的心电信号；步骤2：提取心电信号集中各心电信号的浅层视图，其中，浅层视图的长宽相同；步骤3：构建卷积神经网络，卷积神经网络依次包括卷积模块、拼接层和全连接层；步骤4：基于构建得到的卷积神经网络获取心电信号集中各心电信号的预测结果Y；步骤5：基于预测结果Y与标签标记的真实结果计算误差，使用梯度下降的方法训练卷积神经网络，得到训练好的卷积神经网络。步骤6：将待识别的心电信号输入训练好的神经网络得到预测结果Ys，并基于Grad-CAM技术得到待识别的心电信号的显著图；步骤7：将显著图进行标准化，标准化后以给定的阈值筛选显著图，大于阈值的区域作为重点区域，并与对应的心电信号合并，得到可直观显示卷积神经网络重点关注区域的输出图片。2.根据权利要求1所述的一种基于多视图进行心电信号重点区域检测的方法，其特征在于，步骤1中的一定量级为包含5万段以上的10秒的心电信号。3.根据权利要求2所述的一种基于多视图进行心电信号重点区域检测的方法，其特征在于，所述步骤2的具体步骤为：步骤2.1：将心电信号集中各心电信号按给定长度进行分割，获得多段子心电信号；步骤2.2：基于曼哈顿距离度量各子心电信号之间的距离，得到长宽相同的浅层视图。4.根据权利要求3所述的一种基于多视图进行心电信号重点区域检测的方法，其特征在于，所述步骤3中的卷积模块是在ResNet18的卷积模块的基础上，将二维卷积核修改为一维卷积核；全连接层包括依次设置的参数为W的第一层全连接层，参数为W'的第二层全连接层，参数为W”的第三层全连接层。5.根据权利要求4所述的一种基于多视图进行心电信号重点区域检测的方法，其特征在于，所述步骤4的具体步骤为：步骤4.1：基于卷积神经网络中的卷积模块提取心电信号集中各心电信号的深层视图，其中，深层视图的长宽与浅层视图的长宽相同；步骤4.2：基于卷积神经网络中的拼接层对各心电信号的浅层视图和深层视图在第一维度上进行拼接，并对拼接得到的拼接视图依次进行特征融合；步骤4.3：特征融合后，进行特征提取，提取后将提取得到的各心电信号的特征展开，并以全连接层的形式输出各心电信号的预测结果Y。6.根据权利要求5所述的基于多视图进行心电信号重点区域检测的方法，其特征在于，所述步骤4.1的具体步骤为：将心电信号集中各心电信号输入到卷积模块中，通过控制卷积模块中卷积核的参数，使卷积模块输出h×f的深层特征F，其中，f指经过卷积模块后的特征数量，得到深层特征F后，按照点乘的形式提取深层视图Vdeep，具体公式如下：Vdeep＝FFT其中，FT表示深层特征F的转置，T表示转置，h表示浅层视图的长宽。7.根据权利要求6所述的基于多视图进行心电信号重点区域检测的方法，其特征在于，所述步骤4.2的具体步骤为：基于卷积神经网络中的拼接层拼接各心电信号得到的长宽为h的浅层视图和深层视图，合并成一个长为2h，宽为h的拼接视图。8.根据权利要求7所述的一种基于多视图进行心电信号重点区域检测的方法，其特征在于，所述步骤4.3中的特征提取具体为：以参数为W的第一层全连接层的形式与拼接视图相乘，得到融合特征，其中，参数W的大小为fw×2h，fw表示第一层全连接层的隐藏层神经元数量；将深层特征F与融合特征相结合并通过第二层全连接层获得特征E，具体公式如下：E＝reluFW′)其中，relu表示了非线性函数，W′表示大小为h×fw′的第二层全连接层的参数，Vconcat表示拼接视图；预测结果Y的具体公式如下：Y＝softmaxW)其中，softmax表示softmax函数，心电信号属于某类型的概率，flatten表示将特征E展开为一维向量，W″表示第三层全连接层的参数；softmax函数的形式为：其中，y代表softmax函数的输出，e表示自然指数，xi表示第三层全连接层的第i个输出值，xj表示第三层全连接层的第j个输出值。9.根据权利要求8所述的一种基于多视图进行心电信号重点区域检测的方法，其特征在于，所述步骤6的具体步骤为：将待识别的心电信号输入训练好的神经网络得到预测结果Ys；基于Grad-CAM技术利用预测结果Ys反向传播计算卷积神经网络第一层特征图M的梯度，其中，第一层特征图M指心电信号经过卷积神经网络的第一次卷积计算后的结果；将梯度作为权重与对应的第一层特征图M相乘，相乘后进行缩放操作后获得卷积神经网络针对待识别的心电信号的显著图。10.根据权利要求9所述的一种基于多视图进行心电信号重点区域检测的方法，其特征在于，梯度的具体公式为：显著图的具体公式为：其中，Mc表示第c个第一层特征图M，即指一个心电信号在卷积神经网络中的第c个中间产物，weightc表示第一层特征图Mc的梯度，A表示显著图，Scale表示缩放。
说明书desc
技术领域一种基于多视图进行心电信号重点区域检测的方法，用于心电信号重点区域的检测，属于医疗技术与深度学习技术领域。背景技术心律不齐在医学领域中指的是心跳过快或过慢，并超过了一般心律范围。该现象通常是由于心脏自律性异常或传导障碍引起的心动过速、心动过缓或心律不齐。导致心率不齐的原因通常与不健康的生活习惯有关，如精神紧张、大量吸烟、饮酒、喝浓茶或咖啡、过度疲劳、严重失眠等。因此，及早进行检测，提前防范，可以有效地防止恶性心脏疾病的产生。心律不齐地主要类型包括：窦性心跳过缓、窦性心跳过速、窦性心律不齐、期外收缩、早期收缩、心房颤动、心房扑动、阵发性心室上心跳过速、心室心律过速和心房扑动。目前有大量的医师具备专业的识别能力判断心电信号是否存在心律不齐的情况，但在检测数量过大的情况下，无法有效的检测心电信号是否存在潜在的心律不齐的情况。近些年来，出现了较多计算机辅助判断的技术判断心电信号是否心律不齐，但却存在各自的问题，如传统的机器学习方法虽然具备一定的准确率，但是不具备应对各类复杂心电信号的情况，如噪声干扰与个体差异巨大等。基于目标检测的深度学习方法检测复杂的心电信号时，虽然能够达到相对较高的准确率，但是该方法需要关键位置区域，这需要大量的人力、物力、时间的投入去标记重点区域。综上所述，现有存在如下技术问题：1.需要人为标记关键位置区域，从而需要大量的人力、物力、时间成本的投入；2.现有技术大多对心电信号的噪声敏感，造成在不同设备下预测的正确率差别大；3.现有技术的可视化效果粗糙，无法精确定位重点区域。发明内容针对上述研究的问题，本发明的目的在于提供了一种基于多视图进行心电信号重点区域检测的方法，解决现有技术的可视化效果粗糙，无法精确定位重点区域的问题。为了达到上述目的，本发明采用如下技术方案：一种基于多视图进行心电信号重点区域检测的方法，包括：步骤1：获取一定量级已有标签标记的心电信号集，心电信号集包括健康人体的心电信号和不同类型的心律不齐的心电信号；步骤2：提取心电信号集中各心电信号的浅层视图，其中，浅层视图的长宽相同；步骤3：构建卷积神经网络，卷积神经网络依次包括卷积模块、拼接层和全连接层；步骤4：基于构建得到的卷积神经网络获取心电信号集中各心电信号的预测结果Y；步骤5：基于预测结果Y与标签标记的真实结果计算误差，使用梯度下降的方法训练卷积神经网络，得到训练好的卷积神经网络。步骤6：将待识别的心电信号输入训练好的神经网络得到预测结果Ys，并基于Grad-CAM技术得到待识别的心电信号的显著图；步骤7：将显著图进行标准化，标准化后以给定的阈值筛选显著图，大于阈值的区域作为重点区域，并与对应的心电信号合并，得到可直观显示卷积神经网络重点关注区域的输出图片。进一步，步骤1中的一定量级为包含5万段以上的10秒的心电信号。进一步，所述步骤2的具体步骤为：步骤2.1：将心电信号集中各心电信号按给定长度进行分割，获得多段子心电信号；步骤2.2：基于曼哈顿距离度量各子心电信号之间的距离，得到长宽相同的浅层视图。进一步，所述步骤3中的卷积模块是在ResNet18的卷积模块的基础上，将二维卷积核修改为一维卷积核；全连接层包括依次设置的参数为W的第一层全连接层，参数为W'的第二层全连接层，参数为W”的第三层全连接层。进一步，所述步骤4的具体步骤为：步骤4.1：基于卷积神经网络中的卷积模块提取心电信号集中各心电信号的深层视图，其中，深层视图的长宽与浅层视图的长宽相同；步骤4.2：基于卷积神经网络中的拼接层对各心电信号的浅层视图和深层视图在第一维度上进行拼接，并对拼接得到的拼接视图依次进行特征融合；步骤4.3：特征融合后，进行特征提取，提取后将提取得到的各心电信号的特征展开，并以全连接层的形式输出各心电信号的预测结果Y。进一步，所述步骤4.1的具体步骤为：将心电信号集中各心电信号输入到卷积模块中，通过控制卷积模块中卷积核的参数，使卷积模块输出h×f的深层特征F，其中，f指经过卷积模块后的特征数量，得到深层特征F后，按照点乘的形式提取深层视图Vdeep，具体公式如下：Vdeep＝FFT其中，FT表示深层特征F的转置，T表示转置，h表示浅层视图的长宽。进一步，所述步骤4.2的具体步骤为：基于卷积神经网络中的拼接层拼接各心电信号得到的长宽为h的浅层视图和深层视图，合并成一个长为2h，宽为h的拼接视图。进一步，所述步骤4.3中的特征提取具体为：以参数为W的第一层全连接层的形式与拼接视图相乘，得到融合特征，其中，参数W的大小为fw×2h，fw表示第一层全连接层的隐藏层神经元数量；将深层特征F与融合特征相结合并通过第二层全连接层获得特征E，具体公式如下：E＝reluFW')其中，relu表示了非线性函数，W'表示大小为h×fw'的第二层全连接层的参数，Vconcat表示拼接视图；预测结果Y的具体公式如下：Y＝softmaxW”)其中，softmax表示softmax函数，心电信号属于某类型的概率，flatten表示将特征E展开为一维向量，W”表示第三层全连接层的参数；softmax函数的形式为：其中，y代表softmax函数的输出，e表示自然指数，xi表示第三层全连接层的第i个输出值,xj表示第三层全连接层的第j个输出值。进一步，所述步骤6的具体步骤为：将待识别的心电信号输入训练好的神经网络得到预测结果Ys；基于Grad-CAM技术利用预测结果Ys反向传播计算卷积神经网络第一层特征图M的梯度，其中，第一层特征图M指心电信号经过卷积神经网络的第一次卷积计算后的结果；将梯度作为权重与对应的第一层特征图M相乘，相乘后进行缩放操作后获得卷积神经网络针对待识别的心电信号的显著图。进一步，梯度的具体公式为：显著图的具体公式为:其中，Mc表示第c个第一层特征图M，即指一个心电信号在卷积神经网络中的第c个中间产物，weightc表示第一层特征图Mc的梯度,A表示显著图，Scale表示缩放。本发明同现有技术相比，其有益效果表现在：1.本发明对心电信号从不同角度进行视图提取，即提取了浅层视图与深层视图，浅层特征体现了心电信号的原始形态学信息，包括了不同波段的高度、角度、峰值信息等，深层视图通过卷积神经网络提取，该视图含有丰富的语义信息，能够表达每段心电信号的潜在内容，减轻了以往技术受环境噪声或设备噪声干扰的问题，使最终的技术能够保证较高的准确率；2.本发明对拼接视图依次进行了特征融合和特征提取，通过对不同视图的特征融合，搭建了多视图之间的关联，融和了两种视图之间丰富的信息，之后采用全连接的特征提取，将丰富的信息有效提取以用于进行心律监测。3.本发明基于Grad-CAM技术进行疾病回溯，该技术无需大量的重点区域标记信息，仅需要本段心电信号的类型标签信息，节省了昂贵的成本；4.本发明采用的Grad-CAM技术结合了多视图信息，多视图能够有效为神经网路补充不同角度的信息，可视化精细度高，从而使该方式能够更加精确的定位重点区域，与现有技术相比，定位准确度提高27％，获得更为合理与直观的回溯结果；5.本发明在不同设备下预测的正确率相差较小，对设备的依赖性较低。附图说明图1为本发明的流程图；图2为本发明的输出效果图，上方为心电信号，下方深色区域代表重点区域。具体实施方式下面将结合附图及具体实施方式对本发明作进一步的描述。本发明基于Grad-CAM可视化技术，能够显示卷积神经网络的重点关注区域，Grad-CAM可视化技术已经在大量研究中被用于评估模型效果，可在电泳图像中直观显示模型的判断依据。该方法避免了基于目标检测方法所需要的高昂的标记代价，仅需要电泳图像的疾病类型，同时使模型具备高精度与可解释性的特点。多视图技术可以为模型提供丰富的特征知识，从不同角度挖掘特征潜力，使模型的准确率进一步提升，同时多视图技术在本方法中可以进一步规范可视化效果，使可视化更具备说服力。本发明主要流程包括：1)心电信号的收集；2)提取心电信号的浅层视图；3)构建卷积神经网络；4)基于卷积神经网络获取心电信号的预测结果Y；5)基于预测结果Y训练卷积神经网络；6)基于预测结果Ys和Grad-CAM技术得到待识别的心电信号的显著图；7)直观显示卷积神经网络重点关注区域的输出图片，具体实现步骤如下：一、收集心电信号获取已有标签标记的心电信号构成心电信号集，心电信号主要由健康人体的心电信号和表现有不同类型的心律不齐的心电信号组成，心电信号的数量通常需要达到一定量级，一定量级为包含5万段以上的10秒的心电信号，以保证神经网络在训练过程中能够收敛，以达到较高的准确率；二、提取心电信号的浅层视图将一段数据量为t的心电信号按长度w进行分割，获得t/w段心电信号，之后以曼哈顿距离度量两两信号之间的距离，该距离是以绝对值的形式表示的，通过曼哈顿距离进行两两比较后，可获得长宽均为h的浅层视图Vshallow，其中i行j列的位置代表第i段心电信号与第j段心电信号的曼哈顿距离，由于心律不齐的病症有非常明显的形态学特点，浅层视图充分利用了心律不齐表现的特性，通过曼哈顿距离构建了心电信号段之间的形态学关系，该浅层视图也可表示为形态学视图；三、构建卷积神经网络卷积神经网络依次包括卷积模块、拼接层和全连接层，卷积模块是在ResNet18的卷积模块的基于上，将二维卷积修改为一维卷积核；全连接层包括依次设置的参数为W的第一层全连接层，参数为W'的第二层全连接层，参数为W”的第三层全连接层。四、基于卷积神经网络获取心电信号的预测结果Y提取心电信号的深层视图：将心电信号集中各心电信号输入到卷积模块中，通过控制卷积模块中卷积核的参数，使卷积模块输出h×f的深层特征F，其中，f指经过卷积模块后的特征数量，得到深层特征F后，按照点乘的形式提取深层视图Vdeep，Vdeep的大小与Vshallow一致，具体公式如下：Vdeep＝FFT其中，FT表示深层特征F的转置，T表示转置，h表示浅层视图的长宽；很多情况下，心律不齐的特点不仅仅包含形态特征，还包含时序频率特征和其他抽象信息，该深层视图利用了卷积神经网络强大的特征提取能力，将难以理解的抽象信息表达为深层视图Vdeep，弥补了浅层视图的不足；拼接浅层视图和深层视图：简单拼接浅层视图与深层视图，由于二者的大小一致，均为h×h，可以通过在维度上的简单拼接获得2h×h大小的拼接视图Vconcat，该拼接视图同时包含了两种视图的信息，可为后续过程提取提供丰富的特征；对拼接视图进行特征融合：对上一步骤获得的拼接视图依次进行特征融合与特征提取，即采用全连接层的形式对拼接视图进行特征融合：以参数为W的第一层全连接层的形式与拼接视图相乘，得到融合特征，其中，参数W的大小为fw×2h，fw表示第一层全连接层的隐藏层神经元数量，该步骤可令浅层视图与深层视图之间的信息互相融合。对融合后的特征进行特征提取：利用非线性函数生成更加有效的特征，即将深层特征F与融合特征结合，该步骤利用了卷积神经网络获得的深度特征F，使深层视图、浅层视图、深层特征三者融合，使用第二层全连接层和非线性函数进行特征提取，以使最终特征包含丰富的语义，具体公式如下：E＝reluFW')其中，relu代表了一类数学非线性函数，W'代表了大小为h×fw'的第二层全连接层的参数；将上一步骤获得的特征E展开，展开方式为将多维的矩阵变形为一维的向量形式，并以第三层全连接层的形式输出心电信号的预测Y，该预测代表了心电信号是否出现心律不齐现象，具体公式如下：Y＝softmaxW”)其中，softmax表示了softmax函数，心电信号属于某类型的概率，flatten表示将特征E展开，W”表示第三层全连接层的参数；五、基于预测结果Y训练卷积神经网络基于预测结果Y与标签标记的真实结果计算误差，使用梯度下降的方法训练卷积神经网络，卷积神经网络经过多次迭代，可输出正确率很高的预测结果，此时，卷积神经网络训练完成，训练完成的卷积神经网络用于后续步骤的预测，本步骤使用的训练方法是本领域训练神经网络的普遍方法。六、基于预测结果Ys和Grad-CAM技术得到待识别的心电信号的显著图将待识别的心电信号输入训练好的神经网络得到预测结果Ys；基于Grad-CAM技术利用预测结果Ys反向传播计算卷积神经网络第一层特征图M的梯度，其中，第一层特征图M指心电信号经过卷积神经网络的第一次卷积计算后的结果；将梯度作为权重与对应的第一层特征图M相乘，相乘后进行缩放操作后获得卷积神经网络针对待识别的心电信号的显著图。梯度的具体公式为：显著图的具体公式为:其中，Mc表示第c个第一层特征图M，即指一个心电信号在卷积神经网络中的第c个中间产物，weightc表示第一层特征图Mc的梯度,A表示显著图，Scale表示缩放。七、可视化重点区域显著图A数值越大，代表该数值对应的区域越重要，通过对显著图进行标准化，可以使显著图的数值固定在最小值0和最大值1之间，之后以0.5的阈值筛选显著图，大于阈值的区域代表卷积神经网络认为重要的部分，并将该部分显示在待识别的心电信号上，显示的图片可有效用应在医学辅助过程中。以上仅是本发明众多具体应用范围中的代表性实施例，对本发明的保护范围不构成任何限制。凡采用变换或是等效替换而形成的技术方案，均落在本发明权利保护范围之内。
