标题title
基于扩散模型的即插即用磁粒子成像重建方法、系统
摘要abst
本发明属于生物医学分子影像、磁粒子成像重建领域，具体涉及一种基于扩散模型的即插即用磁粒子成像重建方法、系统，旨在解决现有的MPI图像重建方法在基于系统矩阵重建过程中，存在逆问题不适定且难以求解的问题。本方法包括：获取待MPI成像重建的目标对象的电压信号，作为输入信号；通过预构建的系统矩阵无约束优化方法，获取磁粒子浓度分布的最优解，进而进行磁粒子图像重建，得到重建的MPI图像。本发明解决了逆问题不适定且难以求解的问题，提高了MPI图像重建的质量。
权利要求书clms
1.一种基于扩散模型的即插即用磁粒子成像重建方法，其特征在于，该方法包括：获取待MPI成像重建的目标对象的电压信号，作为输入信号；基于所述输入信号，结合磁粒子成像设备的系统矩阵以及训练好的扩散模型，通过预构建的系统矩阵无约束优化方法，获取磁粒子浓度分布的最优解，进而进行磁粒子图像重建，得到重建的MPI图像；其中，所述扩散模型中的去噪网络为基于多尺度特征互补的图像去噪网络；所述基于多尺度特征互补的图像去噪网络为U型的编码器-解码器网络；所述编码器包括卷积块双域注意力模块、特征提取模块；所述解码器包括特征恢复模块、图像重建模块；所述基于多尺度特征互补的图像去噪网络的输入为预构建的含有噪声的MPI图像，即磁粒子浓度分布；对所述预构建的含有噪声的MPI图像进行不同程度的下采样并提取特征，作为初始特征，将所述初始特征输入对应的编码器；所述卷积块双域注意力模块，配置为对输入的特征依次通过不同的注意力机制进行加权；将加权后的特征输入所述特征提取模块特征提取；所述特征恢复模块，配置为用于对输入的特征进行残差学习；所述图像重建模块，配置为对所述特征恢复模块的输出卷积处理，进行图像重建。2.根据权利要求1所述的基于扩散模型的即插即用磁粒子成像重建方法，其特征在于，在所述电压信号采集之前还包括系统矩阵校准步骤：根据所述磁粒子成像设备设定的采样网格，依次将小样本放置在每个采样网格内进行MPI信号采集；将每个采样网格采集的MPI信号傅里叶变换，作为系统矩阵的一列；遍历完所有的采样网格，系统矩阵校准完毕。3.根据权利要求2所述的基于扩散模型的即插即用磁粒子成像重建方法，其特征在于，所述卷积块双域注意力模块，其结构为：所述卷积块双域注意力模块包括第一卷积层、通道注意力模块、频率注意力模块、空间注意力模块和第二卷积层；将输入的特征输入所述第一卷积层进行卷积处理，将卷积处理的特征作为第一特征；将所述第一特征输入所述通道注意力模块处理后与所述第一特征相乘，作为第二特征；将所述第二特征输入所述频率注意力模块处理后与所述第二特征相乘，作为第三特征；将所述第三特征输入所述空间注意力模块处理后与所述第三特征相乘，相乘后通过所述第二卷积层卷积处理后输出，作为所述卷积块双域注意力模块的输出；所述频率注意力模块用于将输入的第二特征通过全局平均池化层、平均池化层并行处理，得到第四特征、第五特征；将所述第四特征与所述第二特征相减后进行调制；将所述第五特征与所述第二特征相减后进行调制；将所述第四特征进行调制；将所述第五特征进行调制；将所有调制后的特征进行融合，作为所述频率注意力模块的输出；其中，对特征进行调制即对特征进行加权。4.根据权利要求1所述的基于扩散模型的即插即用磁粒子成像重建方法，其特征在于，所述基于多尺度特征互补的图像去噪网络包括四个编码器、四个解码器，分别作为第一编码器、第二编码器、第三编码器、第四编码器、第一解码器、第二解码器、第三解码器和第四解码器；所述第一编码器的输入为所述预构建的含有噪声的MPI图像；所述第二解码器输入为所述第一编码器的输出与所述第二解码器对应的初始特征；所述第三编码器输入为所述第二编码器的输出与所述第三编码器对应的初始特征；所述第四编码器输入为所述第三编码器的输出与所述第四编码器对应的初始特征；所述第一解码器的输入为所述第四编码器的输出；所述第二解码器输入为所述第三编码器的输出与所述第一解码器的输出；所述第三解码器输入为所述第二编码器的输出与所述第二解码器的输出；所述第四解码器输入为所述第一编码器的输出与所述第三解码器的输出；将所述四个解码器的输出进行融合，作为所述基于多尺度特征互补的图像去噪网络的输出。5.根据权利要求1所述的基于扩散模型的即插即用磁粒子成像重建方法，其特征在于，所述特征提取模块基于特征提取网络构建；所述特征恢复模块基于设定个依次连接的ResBlock块构建；所述图像重建模块基于依次连接的卷积层、Relu激活函数、卷积层构建。6.根据权利要求3所述的一种基于扩散模型的即插即用磁粒子成像重建方法，其特征在于，所述基于多尺度特征互补的图像去噪网络，其在训练过程中的损失函数为： ；；；；； ；其中，表示联合损失，/＞表示双域损失，/＞表示结构损失，/＞表示感知损失，/＞、、/＞表示各损失函数对应的权重，/＞表示超参数，/＞、/＞分别表示基于多尺度特征互补的图像去噪网络的输出、输出对应的标签；/＞表示使用预训练的VGG-16的设定层提取的特征映射构建的感知损失项，/＞表示平滑L1损失，/＞表示余弦相似度损失，/＞表示快速傅里叶变换。7.根据权利要求1所述的基于扩散模型的即插即用磁粒子成像重建方法，其特征在于，通过预构建的系统矩阵无约束优化方法，获取磁粒子浓度分布的最优解，其方法为：引入辅助变量来代替正则化项中的x，进而转化为一个约束优化问题：；；其中，表示系统矩阵，/＞表示磁粒子浓度分布，/＞表示电压信号，/＞表示辅助变量，/＞表示假设标准差，/＞表示目标的求解值，/＞表示关于变量 v 的正则化项，/＞表示正则化项的权重；采用增广拉格朗日乘子法进行求解，得到磁粒子浓度分布的最优解。8.一种基于扩散模型的即插即用磁粒子成像重建系统，其特征在于，该系统包括：信号获取模块，配置为获取待MPI成像重建的目标对象的电压信号，作为输入信号；磁粒子图像重建模块，配置为基于输入信号，结合磁粒子成像设备的系统矩阵以及训练好的扩散模型，通过预构建的系统矩阵无约束优化方法，获取磁粒子浓度分布的最优解，进而进行磁粒子图像重建，得到重建的MPI图像；其中，所述扩散模型中的去噪网络为基于多尺度特征互补的图像去噪网络；所述基于多尺度特征互补的图像去噪网络为U型的编码器-解码器网络；所述编码器包括卷积块双域注意力模块、特征提取模块；所述解码器包括特征恢复模块、图像重建模块；所述基于多尺度特征互补的图像去噪网络的输入为预构建的含有噪声的MPI图像，即磁粒子浓度分布；对所述预构建的含有噪声的MPI图像进行不同程度的下采样并提取特征，作为初始特征，将所述初始特征输入对应的编码器；所述卷积块双域注意力模块，配置为对输入的特征依次通过不同的注意力机制进行加权；将加权后的特征输入所述特征提取模块特征提取；所述特征恢复模块，配置为用于对输入的特征进行残差学习；所述图像重建模块，配置为对所述特征恢复模块的输出卷积处理，进行图像重建。
说明书desc
技术领域本发明属于生物医学分子影像、磁粒子成像重建领域，具体涉及一种基于扩散模型的即插即用磁粒子成像重建方法、系统。背景技术磁粒子成像是一种新型的分子影像技术，可用于确定生物体内超顺磁性氧化铁纳米颗粒等磁性材料的三维分布，根据 SPIO 的非线性磁化响应，测量 SPIO在体内的浓度分布情况。体内成像时信号不会被生物组织衰减，具有无深度限制的理想对比度。此外，还具有高空间分辨率、高时间分辨率、高灵敏度、可定量成像、无辐射等优点。经预临床研究表明，在磁热疗法、干细胞示踪、脑功能成像等诸多临床问题上具有应用前景。目前主要的基本重建方法有两种，分别是在频域进行处理的系统矩阵方法和在时域进行处理的x-space方法。SM是系统函数的离散化表示，它描述了空间浓度分布和感应电压的映射关系，包括磁场特性和复杂的粒子特性。在图像重建的过程中，噪声水平的高低直接影响磁粒子成像的质量。目前磁粒子成像的噪声来源主要分为三部分，分别是随机噪声、背景噪声、失真噪声和重建噪声。随机噪声是由器件内部随机过程引起的信号成分，也称为电路中的热噪声。背景噪声是由MPI系统的硬件导致的激励信号非线性表现或外部磁性物质所产生的响应耦合进接收信号引起的。失真噪声是指信号突然发生改变或失真，可能由硬件组件的放电等原因引起。受信号中的噪声的影响，在MPI重建的过程中，重建算法会导致图像出现伪影。三部分主要通过多次求平均、减背景、频率滤波等方法进行优化。受信号噪声的影响，重建过程也会导致图像出现伪影。重建噪声来自于图像重建算法，如降采样恢复、x-space重建的卷积模糊、系统矩阵逆问题求解等过程。对于系统矩阵图像重建，由于存在噪声，逆问题求解本质上是不适定的，因此在图像重建过程中会导致图像信噪比降低。针对基于系统矩阵重建过程中，逆问题不适定且难以求解的问题展开研究，进一步提出一种基于扩散模型的即插即用磁粒子成像重建方法，以提高MPI图像重建的质量。发明内容为了解决现有技术中的上述问题，即为了解决现有的MPI图像重建方法在基于系统矩阵重建过程中，存在逆问题不适定且难以求解的问题，本发明第一方面，提出了一种基于扩散模型的即插即用磁粒子成像重建方法，该方法包括：获取待MPI成像重建的目标对象的电压信号，作为输入信号；基于输入信号，结合磁粒子成像设备的系统矩阵以及训练好的扩散模型，通过预构建的系统矩阵无约束优化方法，获取磁粒子浓度分布的最优解，进而进行磁粒子图像重建，得到重建的MPI图像；其中，所述扩散模型中的去噪网络为基于多尺度特征互补的图像去噪网络；所述基于多尺度特征互补的图像去噪网络为U型的编码器-解码器网络；所述编码器包括卷积块双域注意力模块、特征提取模块；所述解码器包括特征恢复模块、图像重建模块；所述基于多尺度特征互补的图像去噪网络的输入为预构建的含有噪声的MPI图像，即磁粒子浓度分布；对所述预构建的含有噪声的MPI图像进行不同程度的下采样并提取特征，作为初始特征，将所述初始特征输入对应的编码器；所述卷积块双域注意力模块，配置为对输入的特征依次通过不同的注意力机制进行加权；将加权后的特征输入所述特征提取模块特征提取；所述特征恢复模块，配置为用于对输入的特征进行残差学习；所述图像重建模块，配置为对所述特征恢复模块的输出卷积处理，进行图像重建。在一些优选的实施方式中，在所述电压信号采集之前还包括系统矩阵校准步骤：根据所述磁粒子成像设备设定的采样网格，依次将小样本放置在每个采样网格内进行MPI信号采集；将每个采样网格采集的MPI信号傅里叶变换，作为系统矩阵的一列；遍历完所有的采样网格，系统矩阵校准完毕。在一些优选的实施方式中，所述卷积块双域注意力模块，其结构为：所述卷积块双域注意力模块包括第一卷积层、通道注意力模块、频率注意力模块、空间注意力模块和第二卷积层；将输入的特征输入所述第一卷积层进行卷积处理，将卷积处理的特征作为第一特征；将所述第一特征输入所述通道注意力模块处理后与所述第一特征相乘，作为第二特征；将所述第二特征输入所述频率注意力模块处理后与所述第二特征相乘，作为第三特征；将所述第三特征输入所述空间注意力模块处理后与所述第三特征相乘，相乘后通过所述第二卷积层卷积处理后输出，作为所述卷积块双域注意力模块的输出；所述频率注意力模块用于将输入的第二特征通过全局平均池化层、平均池化层并行处理，得到第四特征、第五特征；将所述第四特征与所述第二特征相减后进行调制；将所述第五特征与所述第二特征相减后进行调制；将所述第四特征进行调制；将所述第五特征进行调制；将所有调制后的特征进行融合，作为所述频率注意力模块的输出；其中，对特征进行调制即对特征进行加权。在一些优选的实施方式中，所述基于多尺度特征互补的图像去噪网络包括四个编码器、四个解码器，分别作为第一编码器、第二编码器、第三编码器、第四编码器、第一解码器、第二解码器、第三解码器和第四解码器；所述第一编码器的输入为所述预构建的含有噪声的MPI图像；所述第二解码器输入为所述第一编码器的输出与所述第二解码器对应的初始特征；所述第三编码器输入为所述第二编码器的输出与所述第三编码器对应的初始特征；所述第四编码器输入为所述第三编码器的输出与所述第四编码器对应的初始特征；所述第一解码器的输入为所述第四编码器的输出；所述第二解码器输入为所述第三编码器的输出与所述第一解码器的输出；所述第三解码器输入为所述第二编码器的输出与所述第二解码器的输出；所述第四解码器输入为所述第一编码器的输出与所述第三解码器的输出。在一些优选的实施方式中，所述特征提取模块基于特征提取网络构建；所述特征恢复模块基于设定个依次连接的ResBlock块构建；所述图像重建模块基于依次连接的卷积层、Relu激活函数、卷积层构建。在一些优选的实施方式中，所述基于多尺度特征互补的图像去噪网络，其在训练过程中的损失函数为：其中，表示联合损失，/＞表示双域损失，/＞表示结构损失，/＞表示感知损失，、/＞、/＞表示各损失函数对应的权重，/＞表示超参数，/＞、/＞分别表示基于多尺度特征互补的图像去噪网络的输出、输出对应的标签；/＞表示使用预训练的VGG-16的设定层提取的特征映射构建的感知损失项，/＞表示平滑L1损失，/＞表示余弦相似度损失，/＞表示快速傅里叶变换。在一些优选的实施方式中，通过预构建的系统矩阵无约束优化方法，获取磁粒子浓度分布的最优解，其方法为：首先引入辅助变量来代替正则化项中的x，进而转化为一个约束优化问题：其中，表示系统矩阵，/＞表示磁粒子浓度分布，/＞表示电压信号，/＞表示辅助变量，/＞表示假设标准差，/＞表示目标的求解值，/＞表示正则化项的权重；采用增广拉格朗日乘子法进行求解，得到磁粒子浓度分布的最优解。本发明的第二方面，提出了一种基于扩散模型的即插即用磁粒子成像重建系统，该系统包括：信号获取模块，配置为获取待MPI成像重建的目标对象的电压信号，作为输入信号；磁粒子图像重建模块，配置为基于输入信号，结合磁粒子成像设备的系统矩阵以及训练好的扩散模型，通过预构建的系统矩阵无约束优化方法，获取磁粒子浓度分布的最优解，进而进行磁粒子图像重建，得到重建的MPI图像；其中，所述扩散模型中的去噪网络为基于多尺度特征互补的图像去噪网络；所述基于多尺度特征互补的图像去噪网络为U型的编码器-解码器网络；所述编码器包括卷积块双域注意力模块、特征提取模块；所述解码器包括特征恢复模块、图像重建模块；所述基于多尺度特征互补的图像去噪网络的输入为预构建的含有噪声的MPI图像，即磁粒子浓度分布；对所述预构建的含有噪声的MPI图像进行不同程度的下采样并提取特征，作为初始特征，将所述初始特征输入对应的编码器；所述卷积块双域注意力模块，配置为对输入的特征依次通过不同的注意力机制进行加权；将加权后的特征输入所述特征提取模块特征提取；所述特征恢复模块，配置为用于对输入的特征进行残差学习；所述图像重建模块，配置为对所述特征恢复模块的输出卷积处理，进行图像重建。本发明的有益效果：本发明解决了逆问题不适定且难以求解的问题，提高了MPI图像重建的质量。本发明通过将扩散模型，扩散模型内的去噪网络为基于多尺度特征互补的图像去噪网络和MPI传统图像重建方法结合，相比于现有方法，得到信噪比更高的MPI图像。除此之外，本方法的重建过程符合物理模型，无需人工选择正则化参数，具有可解释性；图像重建的质量不依赖于MPI数据集，具有较好的泛化性；扩散模型的去噪过程不仅可以拟合复杂噪声分布，还可以充分保留图像细节，具有较好的去噪能力；模型无需实时训练，因此可以实时处理MPI信号进而快速获得图像。附图说明通过阅读参照以下附图所做的对非限制性实施例所做的详细描述，本申请的其他特征、目的和优点将会变得更明显。图1是本发明一种实施例的基于扩散模型的即插即用磁粒子成像重建方法的流程示意图；图2是本发明一种实施例的基于扩散模型的即插即用磁粒子成像重建方法的简略示意图；图3是本发明一种实施例的基于多尺度特征互补的图像去噪网络的结构示意图；图4是本发明一种实施例编码器和解码器的示意图；图5是本发明一种实施例的卷积块双域注意力模块的结构示意图；图6是本发明一种实施例的频率注意力模块的结构示意图；图7是本发明一种实施例的系统矩阵无约束优化过程的示意图。具体实施方式为使本发明的目的、技术方案和优点更加清楚，下面将结合附图对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。下面结合附图和实施例对本申请作进一步的详细说明。可以理解的是，此处所描述的具体实施例仅用于解释相关发明，而非对该发明的限定。另外还需要说明的是，为了便于描述，附图中仅示出了与有关发明相关的部分。需要说明的是，在不冲突的情况下，本申请中的实施例及实施例中的特征可以相互组合。本发明的基于扩散模型的即插即用磁粒子成像重建方法，如图1所示，包括以下步骤：获取待MPI成像重建的目标对象的电压信号，作为输入信号；基于输入信号，结合磁粒子成像设备的系统矩阵以及训练好的扩散模型，通过预构建的系统矩阵无约束优化方法，获取磁粒子浓度分布的最优解，进而进行磁粒子图像重建，得到重建的MPI图像；其中，所述扩散模型中的去噪网络为基于多尺度特征互补的图像去噪网络；所述基于多尺度特征互补的图像去噪网络为U型的编码器-解码器网络；所述编码器包括卷积块双域注意力模块、特征提取模块；所述解码器包括特征恢复模块、图像重建模块；对所述预构建的含有噪声的MPI图像进行不同程度的下采样并提取特征，作为初始特征，将所述初始特征输入对应的编码器；所述卷积块双域注意力模块，配置为对输入的特征依次通过不同的注意力机制进行加权；将加权后的特征输入所述特征提取模块特征提取；所述特征恢复模块，配置为用于对输入的特征进行残差学习；所述图像重建模块，配置为对所述特征恢复模块的输出卷积处理，进行图像重建。为了更清晰地对本发明基于扩散模型的即插即用磁粒子成像重建方法进行说明，下面结合附图2，对本发明方法一种实施例中各步骤进行展开详述。在基于测量的系统矩阵方法重建过程中，需要测量多个体素的电压值来组成系统矩阵，这个过程操作繁琐、耗时，导致系统校正效率较低，实际测得的系统矩阵受噪声干扰，导致感应电压与系统矩阵和粒子浓度之间的逆问题不适定且难以求解，容易产生重建噪声。针对这系统矩阵逆问题求解，目前主要有两类解法：首先是传统方法，采用迭代优化求解，利用Kaczmarz等算法迭代求解。但这类方法的前提是模型符合理想情况，人工选择正则化参数，先验信息质量较差。其次是深度学习方法，如深度图像先验、纯数据驱动、深度平衡模型等，但这几个方法都有其弊端，如不适合实时处理，依赖数据集质量，泛化性欠佳。本发明提出了一种基于扩散模型的即插即用磁粒子成像重建方法，以提高MPI图像重建的质量。具体如下：获取待MPI成像重建的目标对象的电压信号，作为输入信号；在本实施例中，先根据设备的设定的采样网格，依次将小样本放置在每个采样网格内进行MPI信号采集，每个位置采集到的电压信号进行傅里叶变换后作为系统矩阵的一列，遍历完所以网格后，系统矩阵校准完毕。此外还需对目标对象的电压信号进行采样。基于输入信号，结合磁粒子成像设备的系统矩阵以及训练好的扩散模型，通过预构建的系统矩阵无约束优化方法，获取磁粒子浓度分布的最优解，进而进行磁粒子图像重建，得到重建的MPI图像；扩散模型是一种生成模型，包括去噪扩散概率模型和去噪分数匹配，以及一系列改进的模型，如去噪扩散隐式模型、潜在扩散模型和无分类器指导扩散模型等。在本实施例中，扩散模型中的去噪网络使用了一种基于多尺度特征互补的图像去噪网络，它是一种u型结构的编码器-解码器网络，编码器对多尺度噪声图像进行特征提取。解码器对编码器和解码器提取的多尺度特征进行补充和融合，实现各尺度特征的重建。在DNN-MFC中，使用了一种具有四个分支的编码器-解码器结构，每个分支用于提取和恢复一个尺度的特征。因此，DNN-MFC以四幅不同尺度的噪声图像作为输入，通过对原始尺寸的噪声图像进行降采样得到四幅不同尺度的噪声图像。编码器包括卷积块双域注意力模块和特征提取模块。解码器包括特征恢复模块和图像重建模块，用于对编码器和解码器的多个尺度特征进行融合。同样，为了保证每个尺度上恢复特征的准确性，给出相应的ground-truth 图像进行下采样，以监督每个分支的输出。充分利用网络提取的多尺度特征来对噪声图像进行去噪。基于多尺度特征互补的图像去噪网络，如图3所示，包括四个编码器、四个解码器，分别作为第一编码器、第二编码器、第三编码器、第四编码器、第一解码器、第二解码器、第三解码器和第四解码器；所述第一编码器的输入为所述预构建的含有噪声的MPI图像；所述第二解码器输入为所述第一编码器的输出与所述第二解码器对应的初始特征；所述第三编码器输入为所述第二编码器的输出与所述第三编码器对应的初始特征；所述第四编码器输入为所述第三编码器的输出与所述第四编码器对应的初始特征；所述第一解码器的输入为所述第四编码器的输出；所述第二解码器输入为所述第三编码器的输出与所述第一解码器的输出；所述第三解码器输入为所述第二编码器的输出与所述第二解码器的输出；所述第四解码器输入为所述第一编码器的输出与所述第三解码器的输出。将所述四个解码器的输出进行融合，作为所述基于多尺度特征互补的图像去噪网络的输出，即去噪后的图像。如图4所示，编码器包括卷积块双域注意力模块、特征提取模块；所述解码器包括特征恢复模块、图像重建模块；所述卷积块双域注意力模块包括第一卷积层、通道注意力模块、频率注意力模块、空间注意力模块和第二卷积层；将输入的特征输入所述第一卷积层进行卷积处理，将卷积处理的特征作为第一特征；将所述第一特征输入所述通道注意力模块处理后与所述第一特征相乘，作为第二特征；将所述第二特征输入所述频率注意力模块处理后与所述第二特征相乘，作为第三特征；将所述第三特征输入所述空间注意力模块处理后与所述第三特征相乘，相乘后通过所述第二卷积层卷积处理后输出，作为所述卷积块双域注意力模块的输出；如图6所示，所述频率注意力模块用于将输入的第二特征通过全局平均池化层、平均池化层并行处理，得到第四特征、第五特征；将所述第四特征与所述第二特征相减后进行调制；将所述第五特征与所述第二特征相减后进行调制；将所述第四特征进行调制；将所述第五特征进行调制；将所有调制后的特征进行融合，作为所述频率注意力模块的输出；其中，对特征进行调制，就是通过对网络的训练，对得到的四个特征的权重参数就行调整。四个特征乘以对应权重后求和得到频率注意力模块的输出。基于多尺度特征互补的图像去噪网络，其在训练过程中的损失函数采用联合损失的混合损失。联合损失函数由以下三项组成，分别是双域损失，结构损失、感知损失。对于两个图像和/＞，其像素损失可以表示为/＞，如果/＞是位于/＞的像素的权重。双域损失是指在空间域和频域采用L1损失函数，如下述公式所示：   本发明优选将超参数λ设置为0.1以平衡双域学习。结构损失用于度量图像之间在亮度、对比度和结构方面的结构相似度，其定义如下： 感知损失：本工作使用预训练的VGG-16的第一层和第二层提取的特征映射构建感知损失项。 其中，表示联合损失，/＞、/＞、/＞表示各损失函数对应的权重，/＞、/＞分别表示基于多尺度特征互补的图像去噪网络的输出、输出对应的标签；/＞表示使用预训练的VGG-16的设定层提取的特征映射构建的感知损失项，/＞表示平滑L1损失，/＞表示余弦相似度损失，/＞表示快速傅里叶变换。另外，基于多尺度特征互补的图像去噪网络，其在训练过程中通过代码随机生成的符合标准正态分布高斯噪声，输入网络然后进行磁粒子图像重建。用训练好的扩散模型对正则化项进行更新，接着是ADMM算法的逐步更新，主要包括用扩散模型对正则化项进行更新）、正则化项的拉格朗日乘子更新、对数据一致项进行更新、数据一致项的拉格朗日乘子更新和MPI图像重建。每更新一次判断是否超过迭代次数，如未超过则继续迭代，如超过则直接输出最终的图像，如图7所示。具体如下：在用系统矩阵方法重建MPI图像时，主要思想是根据已获得的观测值 y 去逆向求解出 x，由于该逆向过程可以求解出无数个 x，因此通常手工设计正则化项作为图像先验，该求解过程可以表达为： 对于系统矩阵无约束优化问题，可以首先引入辅助变量 v 来代替正则化项中的x，进而转化为一个约束优化问题： 目标函数的增广拉格朗日函数为： 因此，对于交替方向乘子法有：  其中，表示系统矩阵，/＞表示磁粒子浓度分布，即含有噪声的MPI图像，/＞表示电压信号，/＞表示辅助变量，/＞表示增广拉格朗日函数，/＞表示数据一致项，/＞表示正则化项，/＞表示目标的求解值，/＞表示假设标准差，/＞表示关于变量 v 的正则化项，/＞表示正则化项的权重，/＞表示拉格朗日乘子，/＞表示缩放系数。即将问题分为两步求解，分别是数据一致项的更新和正则化项/＞的更新。对于正则化项的更新，等价于已知噪声强度的图像去噪任务。本发明第二实施例的一种基于扩散模型的即插即用磁粒子成像重建系统，包括：信号获取模块，配置为获取待MPI成像重建的目标对象的电压信号，作为输入信号；磁粒子图像重建模块，配置为基于输入信号，结合磁粒子成像设备的系统矩阵以及训练好的基于多尺度特征互补的图像去噪网络，通过预构建的系统矩阵无约束优化方法，获取磁粒子浓度分布的最优解，进而进行磁粒子图像重建，得到重建的MPI图像；其中，所述基于多尺度特征互补的图像去噪网络为U型的编码器-解码器网络；所述编码器包括卷积块双域注意力模块、特征提取模块；所述解码器包括特征恢复模块、图像重建模块；所述基于多尺度特征互补的图像去噪网络的输入为预构建的含有噪声的MPI图像，即磁粒子浓度分布；对所述预构建的含有噪声的MPI图像进行不同程度的下采样并提取特征，作为初始特征，将所述初始特征输入对应的编码器；所述卷积块双域注意力模块，配置为对输入的特征依次通过不同的注意力机制进行加权；将加权后的特征输入所述特征提取模块特征提取；所述特征恢复模块，配置为用于对输入的特征进行残差学习；所述图像重建模块，配置为对所述特征恢复模块的输出卷积处理，进行图像重建。所述技术领域的技术人员可以清楚的了解到，为描述的方便和简洁，上述描述的系统的具体的工作过程及有关说明，可以参考前述方法实施例中的对应过程，在此不再赘述。需要说明的是，上述实施例提供的基于扩散模型的即插即用磁粒子成像重建系统，仅以上述各功能模块的划分进行举例说明，在实际应用中，可以根据需要而将上述功能分配由不同的功能模块来完成，即将本发明实施例中的模块或者步骤再分解或者组合，例如，上述实施例的模块可以合并为一个模块，也可以进一步拆分成多个子模块，以完成以上描述的全部或者部分功能。对于本发明实施例中涉及的模块、步骤的名称，仅仅是为了区分各个模块或者步骤，不视为对本发明的不当限定。本发明第三实施例的一种基于扩散模型的即插即用磁粒子成像重建设备，包括；至少一个处理器；以及与至少一个所述处理器通信连接的存储器；其中，所述存储器存储有可被所述处理器执行的指令，所述指令用于被所述处理器执行以实现上述的基于扩散模型的即插即用磁粒子成像重建方法。本发明第四实施例的一种计算机可读存储介质，所述计算机可读存储介质存储有计算机指令，所述计算机指令用于被所述计算机执行以实现上述的基于扩散模型的即插即用磁粒子成像重建方法。所述技术领域的技术人员可以清楚的了解到，为描述的方便和简洁，上述描述的基于扩散模型的即插即用磁粒子成像重建设备、计算机可读存储介质的具体工作过程及有关说明，可以参考前述方法实例中的对应过程，在此不再赘述。本领域技术人员应该能够意识到，结合本文中所公开的实施例描述的各示例的模块、方法步骤，能够以电子硬件、计算机软件或者二者的结合来实现，软件模块、方法步骤对应的程序可以置于随机存储器、内存、只读存储器、电可编程ROM、电可擦除可编程ROM、寄存器、硬盘、可移动磁盘、CD-ROM、或技术领域内所公知的任意其它形式的存储介质中。为了清楚地说明电子硬件和软件的可互换性，在上述说明中已经按照功能一般性地描述了各示例的组成及步骤。这些功能究竟以电子硬件还是软件方式来执行，取决于技术方案的特定应用和设计约束条件。本领域技术人员可以对每个特定的应用来使用不同方法来实现所描述的功能，但是这种实现不应认为超出本发明的范围。术语“第一”、“第二”、“第三”等是用于区别类似的对象，而不是用于描述或表示特定的顺序或先后次序。至此，已经结合附图所示的优选实施方式描述了本发明的技术方案，但是，本领域技术人员容易理解的是，本发明的保护范围显然不局限于这些具体实施方式。在不偏离本发明的原理的前提下，本领域技术人员可以对相关技术特征做出等同的更改或替换，这些更改或替换之后的技术方案都将落入本发明的保护范围之内。
