标题title
X光声成像中造影剂剂量的优化方法、装置及存储介质
摘要abst
本发明公开了一种X光声成像中造影剂剂量的优化方法、装置及存储介质。具体方法是：通过构建生物组织模型，并在感兴趣区域内混入一定剂量的造影剂，计算各个区域的吸收系数值，并结合组织的格留乃森参数和光通量值计算初始声压；然后进行光声成像模拟，并在投影信号中混入噪声，然后进行图像重建和数据分析；量化评价图像质量，并判断所得结果是否达到预设的图像质量目标，如果没有达到，则改变剂量重复以上过程直至达到目标值，从而得到优化剂量值。本发明能够在X光声成像中给出最佳造影剂剂量，并且保证图像质量。本发明有利于减少X光声成像过程中造影剂对生物体产生的损伤。
权利要求书clms
1.一种X光声成像中造影剂剂量的优化方法，其特征在于，包括以下步骤：步骤一：构建待成像的生物组织模型，设定图像质量指标目标值CRmb，并设定造影剂剂量；步骤二：根据生物组织模型及造影剂剂量确定生物组织模型各体素的参数，包括格留乃森参数、吸收系数和光通量；步骤三：基于确定生物组织模型各体素的参数计算生物组织模型各体素的初始声压分布；步骤四：基于生物组织模型各体素的初始声压分布，通过生物组织的光声波动方程数值计算对生物组织模型进行X光声成像模拟，产生投影数据；步骤五：在投影数据中加入噪声；步骤六：对投影数据进行图像重建获得重建图像，计算重建图像的图像质量指标值并与目标值进行比较，若大于等于目标值，则当前设定的造影剂量为最佳剂量，否则重新设定造影剂剂量并重复步骤二至步骤六直至重建图像的图像质量指标值大于等于目标值；其中造影剂剂量的初始值为0，依据重复的次数依次递增。2.根据权利要求1所述的方法，其特征在于，所述生物组织模型是根据待成像区域的组织构建的模型。3.根据权利要求1所述的方法，其特征在于，所述图像质量指标的计算方法包括梯度法、均方差法。4.根据权利要求1所述的方法，其特征在于，所述生物组织模型各体素的吸收系数通过如下方法计算获得： ；式中，E是指X射线能量，μ是指当X射线能量为E时组织的吸收系数值，与造影剂剂量有关，S是指射线源初始能谱，l是指穿过组织层的厚度，与体素位置有关，i, j 表示模型体素的下标。5.根据权利要求1所述的方法，其特征在于，所述光声波动方程表示为：，其中p是表示位置r处、t时刻的声压值，t = 0时刻对应的即为初始声压值p，H是指位置r处、t时刻的能量沉积，c是声速，β是热膨胀系数，cp是等压比热容。6.根据权利要求1所述的方法，其特征在于，所述步骤五中，噪声采用实际噪声采样数据或通过随机生成的噪声数据。7.根据权利要求1所述的方法，其特征在于，所述步骤六中，图像重建的方法包括：滤波反投影、时间反演法、迭代重建法。8.根据权利要求1所述的方法，其特征在于，所述图像质量指标的计算方法如下：首先对重建图像幅值进行归一化；然后基于归一化的重建图像计算图像质量指标值，所述图像质量指标是感兴趣区域的单位像素图像幅值与非感兴趣区域的单位像素图像幅值的差值占与非感兴趣区域的单位像素图像幅值的百分比。9.一种X光声成像中造影剂剂量的优化装置，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，其特征在于，所述处理器执行所述计算机程序时实现如权利要求1-8任一项所述的一种X光声成像中造影剂剂量的优化方法。10.一种包含计算机可执行指令的存储介质，所述计算机可执行指令在由计算机处理器执行时实现如权利要求1-8任一项所述的一种X光声成像中造影剂剂量的优化方法。
说明书desc
技术领域本发明属于生物医学影像、光声成像领域，尤其涉及一种X光声成像中造影剂剂量的优化方法、装置及存储介质，用于提升图像品质的同时，降低造影剂剂量。背景技术医学影像学已经成为当代医学的重要分支之一，各类成像技术在临床诊断和生物研究中的作用越来越重要。X光声成像技术是近年来发展的一种新型成像技术。该技术通过X光照射生物组织时的热胀冷缩效应产生的超声信号进行成像，由于单脉冲即可激发声信号，并且声信号向立体空间传播。因此，该技术在实时三维成像、低剂量成像方面有着明显优势，它与放疗结合可以减少CT成像需要造成的额外辐射损伤，它应用于小动物成像可以实现传统CT和光声的双模态融合。实际成像中受限于患者成像区域的特殊性，须要使用造影剂来提高图像质量。然而，造影剂会对人体造成不良反应，例如造影剂所致脑病、脑膜炎、心肌出血、抽搐、冠状动脉闭塞、急性肾损伤甚至休克死亡等等。因此，医学中使用造影剂的原则是剂量尽量少，但剂量过低又不能得到理想的图像质量。由此可见，造影剂剂量的优化选择问题在医学成像中亟待解决。发明内容为了解决X光声成像中造影剂选择的问题，本发明提出了一种X光声成像中造影剂剂量的优化方法、装置及存储介质。本发明采用的技术方案如下：一种X光声成像中造影剂剂量的优化方法，包括以下步骤：步骤一：构建待成像的生物组织模型，设定图像质量指标目标值CRmb，并设定造影剂剂量；步骤二：根据生物组织模型及造影剂剂量确定生物组织模型各体素的参数，包括格留乃森参数、吸收系数和光通量；步骤三：基于确定生物组织模型各体素的参数计算生物组织模型各体素的初始声压分布：步骤四：基于生物组织模型各体素的初始声压分布，通过生物组织的光声波动方程数值计算对生物组织模型进行X光声成像模拟，产生投影数据；步骤五：在投影数据中加入噪声；步骤六：对投影数据进行图像重建获得重建图像，计算重建图像的图像质量指标值并与目标值进行比较，若大于等于目标值，则当前设定的造影剂量为最佳剂量，否则重新设定造影剂剂量并重复步骤二至步骤六直至重建图像的图像质量指标值大于等于目标值；其中造影剂剂量的初始值为0，依据重复的次数依次递增。进一步地，所述生物组织模型是根据待成像区域的组织构建的模型。进一步地，所述图像质量指标的计算方法包括梯度法、均方差法等能客观反映图像质量的指标。进一步地，所述生物组织模型各体素的吸收系数通过如下方法计算获得：式中，E是指X射线能量，μ是指当X射线能量为E时组织的吸收系数值，与造影剂剂量有关，S是指射线源初始能谱，l是指穿过组织层的厚度，与体素位置有关，i, j 表示模型体素的下标。进一步地，所述光声波动方程表示为：，其中p是表示位置r处、t时刻的声压值，它的离散形式即为p0，H是指位置r处、t时刻的能量沉积，c是声速，β是热膨胀系数，cp是等压比热容。进一步地，所述步骤五中，噪声采用实际噪声采样数据或通过随机生成的噪声数据。进一步地，所述步骤六中，图像重建的方法包括：滤波反投影、时间反演法、迭代重建法。进一步地，所述图像质量指标的计算方法如下：首先对重建图像幅值进行归一化；然后基于归一化的重建图像计算图像质量指标值，所述图像质量指标是感兴趣区域的单位像素图像幅值与非感兴趣区域的单位像素图像幅值的差值占与非感兴趣区域的单位像素图像幅值的百分比。一种X光声成像中造影剂剂量的优化装置，包括存储器、处理器及存储在存储器上并可在处理器上运行的计算机程序，所述处理器执行所述计算机程序时实现上所述的一种X光声成像中造影剂剂量的优化方法。一种包含计算机可执行指令的存储介质，所述计算机可执行指令在由计算机处理器执行时实现如上所述的一种X光声成像中造影剂剂量的优化方法。本发明的有益效果是： 本发明提出了一种X光声成像中造影剂剂量的优化方法、装置及存储介质。本发明能够在X光声成像中给出最佳造影剂剂量，并且保证图像质量。本发明有利于减少X光声成像过程中造影剂对生物体产生的损伤。附图说明为了更清楚地说明本发明实施例中的技术方案，下面将对实施例描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动性的前提下，还可以根据这些附图获得其他的附图。图1为本发明提出的一种X光声成像中造影剂剂量的优化方法的步骤示意图；图2为本发明一实施例提供的仿体-肝组织模型示意图；图3为本发明的方法得到的不同造影剂的剂量-图像质量指标变化曲线；图4为本发明基于验证本发明提出的造影剂剂量的优化方法的结果图；图5为本发明提出的一种X光声成像中造影剂剂量的优化装置的结构示意图；具体实施方式这里将详细地对示例性实施例进行说明，其示例表示在附图中。下面的描述涉及附图时，除非另有表示，不同附图中的相同数字表示相同或相似的要素。以下示例性实施例中所描述的实施方式并不代表与本申请相一致的所有实施方式。相反，它们仅是与如所附权利要求书中所详述的、本申请的一些方面相一致的装置和方法的例子。在本申请使用的术语是仅仅出于描述特定实施例的目的，而非旨在限制本申请。在本申请和所附权利要求书中所使用的单数形式的“一种”、“所述”和“该”也旨在包括多数形式，除非上下文清楚地表示其他含义。还应当理解，本文中使用的术语“和/或”是指并包含一个或多个相关联的列出项目的任何或所有可能组合。应当理解，尽管在本申请可能采用术语第一、第二、第三等来描述各种信息，但这些信息不应限于这些术语。这些术语仅用来将同一类型的信息彼此区分开。例如，在不脱离本申请范围的情况下，第一信息也可以被称为第二信息，类似地，第二信息也可以被称为第一信息。取决于语境，如在此所使用的词语“如果”可以被解释成为“在……时”或“当……时”或“响应于确定”。本发明提出的一种X光声成像中造影剂剂量的优化方法，首先建立生物组织模型仿体，给定图像质量指标目标值，然后根据仿体参数计算吸收系数，结合光通量和格留乃森参数计算初始声压分布，再数值模拟光声成像过程并加入噪声，再然后进行图像重建，最后进行图像质量评价，判断是否满足目标值，如果满足则得到最佳剂量，如果不满足改变剂量并重复以上过程直到满足目标。图1示出为一种X光声成像中造影剂剂量的优化方法的步骤示意图，如图1所示，包括以下步骤：步骤一：构建待成像的生物组织模型，设定图像质量指标目标值CRmb，并设定造影剂剂量；其中，图像质量指标是评价图像质量的，一般情况下，图像质量越好，越能真实反映生物组织情况，但依托于造影剂提升图像质量，会对人体造成不良反应，因此图像质量指标目标值CRmb一般依据实际情况进行设定，以能够符合临床诊断和生物研究即可。步骤二：根据生物组织模型及造影剂剂量确定生物组织模型各体素的参数，包括格留乃森参数、吸收系数和光通量；其中：a) 获取格留乃森参数，以Γ表示，该参数可以通过公开的文献和实验数据获得；b) 计算生物组织模型各体素的吸收系数：式中，E是指X射线能量，μ是指当X射线能量为E时组织的吸收系数值，该数据可以通过公开的数据库和文献查找得到，也可以通过数值计算和实验测得，与造影剂剂量有关，S是指射线源初始能谱，l是指穿过组织层的厚度 ，与体素位置有关，i, j表示模型体素的下标。c) 结合实际射线源的参数给出光通量，以F表示。步骤三：基于确定生物组织模型各体素的参数计算生物组织模型各体素的初始声压分布：，其中i, j表示模型体素的下标。步骤四：基于生物组织模型各体素的初始声压分布，通过生物组织的光声波动方程数值计算对生物组织模型进行X光声成像模拟，产生投影数据；其中生物组织的光声波动方程数值计算如下：，其中p是表示位置r处、t时刻的声压值，t = 0时刻对应的即为初始声压值p，它的离散形式即为p0，H是指位置r处、t时刻的能量沉积，c是声速，β是热膨胀系数，cp是等压比热容。该过程也可基于开源程序开发或者有限元数值计算软件实现。步骤五：在投影数据中加入噪声；噪声形式根据实际情况确定，实现方法可以根据实际噪声数据的采样，也可以通过随机数生成的方法等。步骤六：对投影数据进行图像重建获得重建图像，计算重建图像的图像质量指标值并与目标值进行比较，若大于等于目标值，则当前设定的造影剂量为最佳剂量，否则重新设定造影剂剂量并重复步骤二至步骤六直至重建图像的图像质量指标值大于等于目标值。其中造影剂剂量的初始值为0，依据重复的次数依次递增。其中，图像重建包括但不限于滤波反投影、时间反演法、迭代重建法等。图像质量指标的计算方法包括已有的图像评价方法：梯度法、均方差法等，作为一优选方案，本发明还提出了一种用于造影剂优化的图像质量指标的计算方法：a) 对重建图像幅值进行归一化：，其中是图像归一化后的幅值，是未经归一化的图像幅值，表示求最小值，表示求最大值，i，j表示图像像素下标。b)基于归一化的重建图像计算图像质量指标值，所述图像质量指标是感兴趣区域的单位像素图像幅值与非感兴趣区域的单位像素图像幅值的差值占与非感兴趣区域的单位像素图像幅值的百分比，表示如下：其中Int表示感兴趣区域，NInt表示感兴趣区域的像素数，其中Oth表示除感兴趣区域以外的其他区域，NOth表示其他区域的像素数。该指标反映了图像感兴趣区域与其他区域的相对对比度，数值越大越图像质量越好。下面将结合本发明实施例中的附图，以肝组织和几种造影剂为例对本发明的效果作进一步说明：本实施例中的一种X光声成像中造影剂剂量的优化方法，具体步骤如下：步骤一：根据肝组织和血液建立仿体几何，如图2所示。设定图像质量指标目标值CRmb=0.5，选定造影剂泛影葡胺和纳米金，并设定造影剂剂量初始值为0；以造影剂在感兴趣区域中的质量百分数描述剂量，以DS表示，增加步长step=1%，根据生物组织模型确定各部分的参数：步骤二：根据生物组织模型及造影剂剂量确定生物组织模型各体素的参数：a) 通过公开文献获取格留乃森参数，肝组织为0.19，血液组织为0.2，密度值分别为1.05 g/cm3和1.06 g/cm3；b) 计算各部分的吸收系数：式中，E是指X射线能量，μ是指当X射线能量为E时组织的吸收系数值，本实施例中该参数通过基于开源工具包Geant4开发的程序获得，S是指射线源初始能谱，本实施例中采用的150 keV的电子打钨材料产的能谱，并通过Geant4开发的程序获得，l为0，即位于组织表层；c) 光通量值设定为0.1mJ/cm2。步骤三计算初始声压分布，本实施例中该步骤通过Matlab软件计算得到：。步骤四：进行X光声成像模拟，产生投影数据。本实施例中使用开源软件k-Wave开发的程序实现。步骤五：在投影数据中加入噪声，本实施例中通过随机产生的方法实现，形式为高斯白噪声，幅值标准差为1.5，单位与投影信号一致。步骤六：图像重建，即通过X光声成像模拟的投影数据重建图像。本实施例中使用时间反演法。然后计算重建图像的图像质量指标值CR：。如果CR≥CRmb，则返回DS，即得到最佳剂量；如果CR＜CRmb，则DS = DS +step，并重复步骤二至步骤六直至重建图像的图像质量指标值大于等于目标值。通过计算可以得到，对于泛影葡胺造影剂，要达到CRmb = 0.5剂量为4%，对应的CRm= 0.68；对于纳米金造影剂，要达到CRmb = 0.5,剂量为2%，对应的CRm= 0.67。缩小结果与目标值之间的误差值可以通过减小步长实现。为了更清楚的说明绘制了各造影剂剂量与图像评价指标之间的关系曲线，如图3所示，可以明确的看出造影剂剂量与图像质量之间呈正相关关系。但是当造影剂剂量过高时，图像评价指标并非立竿见影的增大，因此，合理的使用造影剂更加重要，既可以提高图像质量，也可以降低对生物体的损伤。图4展示了在不含造影剂、泛影葡胺剂量4%和纳米金剂量为2%时的重建图像结果。图4中的是没有造影剂的结果，可以看出血管网络完全看不清楚，图4中的是泛影葡胺剂量为4%时的结果，对比图4中的可以看出血管网络清晰可见，图4中的是纳米金剂量为2%时的结果，对比图4中的，可以看出二者图像质量在视觉上差异不明显，这说明本发明提出的图像质量评价指标的有效性。以上所描述的方法实施例仅仅是示意性的，本领域普通技术人员在不付出创造性劳动的情况下，即可以理解并实施。如图2~4是中描述的方法实施例仅仅是示意性的，图中涉及的组织类型、参数等信息都可以不同，也可相同。与前述一种X光声成像中造影剂剂量的优化方法的实施例相对应，本发明还提供了一种X光声成像中造影剂剂量的优化装置的实施例。参见图5，本发明实施例提供的一种X光声成像中造影剂剂量的优化装置，包括一个或多个处理器，用于实现上述实施例中的一种X光声成像中造影剂剂量的优化方法。本发明提出的一种X光声成像中造影剂剂量的优化装置的实施例可以应用在任意具备数据处理能力的设备上，该任意具备数据处理能力的设备可以为诸如计算机等设备或装置。装置实施例可以通过软件实现，也以通过硬件或者软硬件结合的方式实现。以软件实现为例，作为一个逻辑意义上的装置，是通过其所在任意具备数据处理能力的设备的处理器将非易失性存储器中对应的计算机程序指令读取到内存中运行形成的从硬件层面而言，如图5 所示，为本发明一种X光声成像中造影剂剂量的优化装置所在任意具备数据处理能力的设备的一种硬件结构图，除了图5所示的处理器、内存、网络接口、以及非易失性存储器之外，实施例中装置所在的任意具备数据处理能力的设备通常根据该任意具备数据处理能力的设备的实际功能，还可以包括其他硬件，对此不再赘述。上述装置中各个单元的功能和作用的实现过程具体详见上述方法中对应步骤的实现过程，在此不再赘述。对于装置实施例而言，由于其基本对应于方法实施例，所以相关之处参见方法实施例的部分说明即可。以上所描述的装置实施例仅仅是示意性的，其中所述作为分离部件说明的单元可以是或者也可以不是物理上分开的，作为单元显示的部件可以是或者也可以不是物理单元，即可以位于一个地方，或者也可以分布到多个网络单元上。可以根据实际的需要选择其中的部分或者全部模块来实现本发明方案的目的。本领域普通技术人员在不付出创造性劳动的情况下，即可以理解并实施。本发明实施例还提供一种计算机可读存储介质，其上存储有程序，该程序被处理器执行时，实现上述实施例中的一种X光声成像中造影剂剂量的优化方法。所述计算机可读存储介质可以是前述任一实施例所述的任意具备数据处理能力的设备的内部存储单元，例如硬盘或内存。所述计算机可读存储介质也可以是任意具备数据处理能力的设备，例如所述设备上配备的插接式硬盘、智能存储卡 、SD卡、闪存卡等。进一步的，所述计算机可读存储介质还可以既包括任意具备数据处理能力的设备的内部存储单元也包括外部存储设备。所述计算机可读存储介质用于存储所述计算机程序以及所述任意具备数据处理能力的设备所需的其他程序和数据，还可以用于暂时地存储已经输出或者将要输出的数据。以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
