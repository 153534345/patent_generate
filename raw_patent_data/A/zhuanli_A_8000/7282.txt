标题title
一种基于近红外成像的静脉血管识别定位方法和系统
摘要abst
本发明涉及一种基于近红外成像的静脉血管识别定位方法和系统，方法包括通过近红外成像相机分别拍摄在第一红外线波长和第二红外线波长下的红外成像图片，分别为第一红外成像图片和第二红外成像图片；对第一红外成像图片进行预处理，对静脉血管的特征进行增强，得到增强图像；将增强图像输入至第一静脉血管分割网络模型中，进行血管分布识别，得到分割图像；将分割图像输入至第二静脉血管分割网络模型中，进行适宜穿刺的血管标注，得到标注血管；进行连通域位置提取，得到标穿刺点和最佳穿刺角度；根据第一红外成像图片和第二红外成像图片中标注血管处的光强变化，计算标注血管深度信息。与现有技术相比，本发明具有识别精度高、鲁棒性好等优点。
权利要求书clms
1.一种基于近红外成像的静脉血管识别定位方法，其特征在于，包括：S1、通过近红外成像相机分别拍摄在第一红外线波长和第二红外线波长下的红外成像图片，分别为第一红外成像图片和第二红外成像图片；S2、对第一红外成像图片进行预处理，对静脉血管的特征进行增强，得到增强图像；S3、将增强图像输入至第一静脉血管分割网络模型中，进行血管分布识别，得到分割图像；S4、将分割图像输入至第二静脉血管分割网络模型中，进行适宜穿刺的血管标注，得到标注血管；同时，对标注血管进行连通域位置提取，得到标注血管中各个连通域的中心点，以每个中心点为中心旋转存在多条以不同角度穿过连通域的直线，在上述直线中选取出与连通域相交最多的直线，则选取出的直线对应的中心点为目标穿刺点，直线的斜率为最佳穿刺角度；S5、根据第一红外成像图片和第二红外成像图片中标注血管处的光强变化，计算标注血管处的人体体表脂肪层深度，即标注血管的深度信息。2.根据权利要求1所述的一种基于近红外成像的静脉血管识别定位方法，其特征在于，所述的第一静脉血管分割网络模型和第二静脉血管分割网络模型均采用TransUNet神经网络模型。3.根据权利要求1所述的一种基于近红外成像的静脉血管识别定位方法，其特征在于，所述标注血管的深度信息计算表达式为：其中，χ表示形变系数，I1表示第一红外线波长的强度，ΔI1表示第一红外线波长下的脂肪吸收光强，即为第一红外线波长下发射光强与反射光强之差，I2表示第二红外线波长的强度，ΔI2表示第二红外线波长下的脂肪吸收光强，即为第二红外线波长下发射光强与反射光强之差，η为光强吸收修正系数，μ1和μ2表示I1和I2两种光强下的脂肪对于光的吸收系数。4.根据权利要求3所述的一种基于近红外成像的静脉血管识别定位方法，其特征在于，μ1和μ2采用通用式μa表示：其中，k为水的折射率的虚部，为组织中水的体积分数，λ为入射光波长。5.根据权利要求1所述的一种基于近红外成像的静脉血管识别定位方法，其特征在于，所述预处理包括对图像进行灰度处理，然后通过最大类间方差法进行二值化处理，最后采用基于Hessian矩阵的多尺度滤波方法对图像中静脉血管的特征进行增强。6.根据权利要求1所述的一种基于近红外成像的静脉血管识别定位方法，其特征在于，所述第一红外线波长采用850nm，所述第二红外线波长采用940nm。7.根据权利要求1所述的一种基于近红外成像的静脉血管识别定位方法，其特征在于，所述步骤S1中，红外成像相机分别拍摄多张在第一红外线波长和第二红外线波长下的红外成像图片，选取最清晰的图像作为第一红外成像图片和第二红外成像图片。8.一种基于近红外成像的静脉血管识别定位系统，包括处理器和存储器，其特征在于，所述处理器调用所述存储器内的程序执行以下步骤：S1、通过近红外成像相机分别拍摄在第一红外线波长和第二红外线波长下的红外成像图片，分别为第一红外成像图片和第二红外成像图片；S2、对第一红外成像图片进行预处理，对静脉血管的特征进行增强，得到增强图像；S3、将增强图像输入至第一静脉血管分割网络模型中，进行血管分布识别，得到分割图像；S4、将分割图像输入至第二静脉血管分割网络模型中，进行适宜穿刺的血管标注，得到标注血管；同时，对标注血管进行连通域位置提取，得到标注血管中各个连通域的中心点，以每个中心点为中心旋转存在多条以不同角度穿过连通域的直线，在上述直线中选取出与连通域相交最多的直线，则选取出的直线对应的中心点为目标穿刺点，直线的斜率为最佳穿刺角度；S5、根据第一红外成像图片和第二红外成像图片中标注血管处的光强变化，计算标注血管处的人体体表脂肪层深度，即标注血管的深度信息。9.根据权利要求8所述的一种基于近红外成像的静脉血管识别定位系统，其特征在于，所述标注血管的深度信息计算表达式为：其中，χ表示形变系数，i1表示第一红外线波长的强度，Δi1表示第一红外线波长下的脂肪吸收光强，即为第一红外线波长下反射光强与发射光强之差，i2表示第二红外线波长的强度，Δi2表示第二红外线波长下的脂肪吸收光强，即为第二红外线波长下反射光强与发射光强之差，η为光强吸收修正系数，μ1和μ2表示I1和I2两种光强下的脂肪对于光的吸收系数。10.根据权利要求9所述的一种基于近红外成像的静脉血管识别定位系统，其特征在于，μ1和μ2采用通用式μa表示：其中，k为水的折射率的虚部，为组织中水的体积分数，λ为入射光波长。
说明书desc
技术领域本发明涉及静脉血管识别的技术领域，尤其是涉及一种基于近红外成像的静脉血管识别定位方法和系统。背景技术静脉穿刺技术作为一个经常性的医疗手段，现今还处于人工穿刺的技术阶段。人工穿刺由于人眼的限制性，针对BMI较高的肥胖人群以及血管较为细小的婴幼儿，往往会因为穿刺位置错误导致多次穿刺；另外对于穿刺角度以及穿刺位姿很难有持续稳定的准确判断。同时，医院对于培养一个技术成熟的护士所付出的代价也较为高昂。随着智慧医疗的快速发展，市场对于静脉穿刺采血/注射机器人的关注日益增加。对于已有的静脉血管自动识别技术，通常其依托近红外识别2D平面的静脉网络，结合超声进行血管深度的识别。但是现有技术中采用了超声和红外两种传感器数据，两种独立传感器数据将血管的空间信息进行了分裂的描述，后续进行在进行融合处理时，容易导致对血管的位置的识别精度降低，在血管的空间角度识别上，这种误差表现的最为明显。发明内容本发明的目的就是为了克服上述现有技术存在的缺陷而提供一种基于近红外成像的静脉血管识别定位方法和系统。本发明的目的可以通过以下技术方案来实现：一种基于近红外成像的静脉血管识别定位方法，包括：S1、通过近红外成像相机分别拍摄在第一红外线波长和第二红外线波长下的红外成像图片，分别为第一红外成像图片和第二红外成像图片；S2、对第一红外成像图片进行预处理，对静脉血管的特征进行增强，得到增强图像；S3、将增强图像输入至第一静脉血管分割网络模型中，进行血管分布识别，得到分割图像；S4、将分割图像输入至第二静脉血管分割网络模型中，进行适宜穿刺的血管标注，得到标注血管；同时，对标注血管进行连通域位置提取，得到标注血管中各个连通域的中心点，以每个中心点为中心旋转存在多条以不同角度穿过连通域的直线，在上述直线中选取出与连通域相交最多的直线，则选取出的直线对应的中心点为目标穿刺点，直线的斜率为最佳穿刺角度；S5、根据第一红外成像图片和第二红外成像图片中标注血管处的光强变化，计算标注血管处的人体体表脂肪层深度，即标注血管的深度信息。进一步地，所述的第一静脉血管分割网络模型和第二静脉血管分割网络模型均采用TransUNet神经网络模型。进一步地，所述标注血管的深度信息计算表达式为：其中，χ表示形变系数，I1表示第一红外线波长的强度，ΔI1表示第一红外线波长下的脂肪吸收光强，即为第一红外线波长下发射光强与反射光强之差，I2表示第二红外线波长的强度，ΔI2表示第二红外线波长下的脂肪吸收光强，即为第二红外线波长下发射光强与反射光强之差，η为光强吸收修正系数，μ1和μ2表示I1和I2两种光强下的脂肪对于光的吸收系数。进一步地，μ1和μ2采用通用式μa表示：其中，k为水的折射率的虚部，为组织中水的体积分数，λ为入射光波长。进一步地，所述预处理包括对图像进行灰度处理，然后通过最大类间方差法进行二值化处理，最后采用基于Hessian矩阵的多尺度滤波方法对图像中静脉血管的特征进行增强。进一步地，所述第一红外线波长采用850nm，所述第二红外线波长采用940nm。进一步地，所述步骤S1中，红外成像相机分别拍摄多张在第一红外线波长和第二红外线波长下的红外成像图片，选取最清晰的图像作为第一红外成像图片和第二红外成像图片。8.一种基于近红外成像的静脉血管识别定位系统，其特征在于，包括处理器和存储器，所述处理器调用所述存储器内的程序执行以下步骤：S1、通过近红外成像相机分别拍摄在第一红外线波长和第二红外线波长下的红外成像图片，分别为第一红外成像图片和第二红外成像图片；S2、对第一红外成像图片进行预处理，对静脉血管的特征进行增强，得到增强图像；S3、将增强图像输入至第一静脉血管分割网络模型中，进行血管分布识别，得到分割图像；S4、将分割图像输入至第二静脉血管分割网络模型中，进行适宜穿刺的血管标注，得到标注血管；同时，对标注血管进行连通域位置提取，得到标注血管中各个连通域的中心点，以每个中心点为中心旋转存在多条以不同角度穿过连通域的直线，在上述直线中选取出与连通域相交最多的直线，则选取出的直线对应的中心点为目标穿刺点，直线的斜率为最佳穿刺角度；S5、根据第一红外成像图片和第二红外成像图片中标注血管处的光强变化，计算标注血管处的人体体表脂肪层深度，即标注血管的深度信息。9.根据权利要求8所述的一种基于近红外成像的静脉血管识别定位系统，其特征在于，所述标注血管的深度信息计算表达式为：其中，χ表示形变系数，I1表示第一红外线波长的强度，ΔI1表示第一红外线波长下的脂肪吸收光强，即为第一红外线波长下反射光强与发射光强之差，I2表示第二红外线波长的强度，ΔI2表示第二红外线波长下的脂肪吸收光强，即为第二红外线波长下反射光强与发射光强之差，η为光强吸收修正系数，μ1和μ2表示I1和I2两种光强下的脂肪对于光的吸收系数。10.根据权利要求9所述的一种基于近红外成像的静脉血管识别定位系统，其特征在于，μ1和μ2采用通用式μa表示：其中，k为水的折射率的虚部，为组织中水的体积分数，λ为入射光波长。与现有技术相比，本发明具有以下有益效果：1、仅需要采用近红外数据即可实现血管位置和深度的识别，无需额外的超声波设备，同时采用同一相机同一位置的拍摄数据，可以确保深度信息和血管位置的高度统一，显著提高识别的精度和鲁棒性。2、采用两个神经网络模型进行两次识别，第一次用于血管分布识别，第二次用于血管选取，相较于传统采用一个神经网络识别，从实际实验的结果来看，双进双出的网络检测精度远优于单进单出的精度，应用于医学识别上有更高的可靠度和准确度。3、静脉血管分割网络模型采用TransUNet神经网络模型，该模型将CNN与Transformer结合作为编码器，前者关注全局信息后者编码局部细节。另外保留了Unet网络中的skip-connection，通过长连接将编码生成的特征图与对应解码部分还原出的特征图，利用通道拼接在一起，避免了在下采样的构成中由于网络层数加深导致的特征信息损失。附图说明图1为本发明的基于近红外成像的血管图像识别方法的总体流程图。图2为本发明的血管分割网络的训练流程图。图3是本发明血管图像预处理效果展示图。图4是本发明血管分割网络效果展示图。具体实施方式下面结合附图和具体实施例对本发明进行详细说明。本实施例以本发明技术方案为前提进行实施，给出了详细的实施方式和具体的操作过程，但本发明的保护范围不限于下述的实施例。如图1所示，本实施例提供了一种基于近红外成像的静脉血管识别定位方法，包括以下步骤：步骤S1、通过近红外成像相机分别拍摄在第一红外线波长和第二红外线波长下的红外成像图片，分别为第一红外成像图片和第二红外成像图片；步骤S2、对第一红外成像图片进行预处理，对静脉血管的特征进行增强，得到增强图像；步骤S3、将增强图像输入至第一静脉血管分割网络模型中，进行血管分布识别，得到分割图像；步骤S4、将分割图像输入至第二静脉血管分割网络模型中，进行适宜穿刺的血管标注，得到标注血管；步骤S5、根据第一红外成像图片和第二红外成像图片中标注血管处的光强变化，计算标注血管处的人体体表脂肪层深度，即标注血管的深度信息。如图4所示，通过上述五个步骤可以将采集到的红外图像进行具体的训练和信息处理，并最终输出适合的穿刺点、穿刺角度和穿刺位置。以下为具体展开：一、步骤S1近红外成像相机在拍摄图片时，分别拍摄多张在第一红外线波长和第二红外线波长下的红外成像图片，选取清晰度最高的图像作为第一红外成像图片和第二红外成像图片。本实施例中，第一红外线波长采用850nm，第二红外线波长采用940nm；在940nm波长附近有吸收红外光的峰值，而在850nm波长下，吸收红外的作用较小；这两个波长最利于探测脂肪深度。二、步骤S2对第一红外成像图片的预处理如下S21、裁去第一红外成像图片上的黑色区域以及机器信息；S22、对图片进行灰度化处理，如果输入的图像是一张彩色图像，将图像处理成黑白图像，其中灰度值的范围为0～255，表示亮度从深到浅，颜色从黑到白。并将图片像素进行归一化；归一化的具体公式为：其中，g表示图片中每个像素点的像素值；S23、通过OTSU算法，对于S22中得到的灰度图进行二值化处理；S24、利用基于Hessian矩阵的多尺度滤波方法对血管图像进行血管增强处理。通过上述对第一红外成像图片的二值化处理以及滤波，为后续的静脉网络分割提供更清晰的样本输入，达到更好的静脉网络分割效果。三、步骤S3和步骤S4这两个步骤中第一静脉血管分割网络模型和第二静脉血管分割网络模型均采用TransUNet神经网络模型。如图2所示，第一静脉血管分割网络模型，目标是分割出血管的轮廓。其包括数据处理，模型搭建，模型训练，结果输出等。第一静脉血管分割网络模型的构建过程包括：通过近红外成像相机在拍摄一系列图片并经过步骤S2的预处理，得到训练数据集。然后以4：3：3的比例将训练数据集划分目标训练集、目标验证集和目标测试集。为了增加网络中的训练姐个数，避免网络出现过拟合的情况，对于目标训练集进行旋转、平移，随机缩放，遮挡等等操作。另外划分比例只是本实施例中的列举，不做限定；本实施例中数据集交由专业医师进行静脉血管边缘的标注。搭建TransUNet神经网络模型的结构；将目标训练集合输入TransUNet网络，对其进行训练；将目标验证集合以及目标测试集合输入到TransUNet网络，对其进行训练，从而得到该网络的目标分割效果。可选的，该实施实例中采用dice值以及Hausdorff距离对静脉分割的实施效果进行评价。根据目标的实施效果进行进一步修正和改进。本实施例中，TransUNet神经网络模型是一个编码部分和解码部分均为五层的U型网络。具体来说，本模型对于U型网络中改进后的编码器如下：本网络的编码器结合了CNN和transformer，前者关注局部信息，后者编码全局信息；由于Transformer的输入需要是一个序列，因而需要对于输入的图像信息进行序列化处理；假定拍摄得到近红外片P，经过图像预处理灰度化等操作变成单通道灰度图PW×H。则将图片进行切片处理，变成分辨率为A×A的图片，则原图片可以被分解为长度的图片序列在完成对于图片的序列化后，使用一个全连接层将近红外图片切片序列压缩到M维。同时参考VIT中的postion embedding，对于图片的绝对位置进行编码，形成一维的图片位置信息编码，构成Tpos。从而对于具体的第i个图片patch，其编码函数为：在得到输出向量z0后，输入到最后的编码函数中。具体包括L层交互多头注意力模块和多头感知机模块组成，具体的函数如下：y'j＝MSA)+yj-1yj＝MLP)+y'j其中yj表示经过编码的第j层的输出向量，LN代表layer normalization，用于降低因样本变化的高相关性带来的影响；同时采用CNN对应不同层的transformer得出的编码序列，生成对应维度的特征图像，将其进行级联，构成CNN-transformer编码器。在本网络中，针对近红外图片序列进行五次上采样编码。同时本网络保留了Unet结构的skip-connection结构，对应的，进行五次下采样解码、即采用五层解码器逐步得到最终的解码后图像；具体来说，本模型的U型网络解码器如下：在本网络中采用了CUP的级联解码器，其通过多次上采样并将多个解码器进行级联，将隐藏特征的通过级联的上采样块CUP，达到的全分辨率。对于每个具体的上采样块，包括两个上采样算子，3×3的卷积层，损失函数使用ReLU函数：在进过解码后的序列，与之前CNN网络采集的特征图进行长距离连接，从而聚合分辨率下的特征图聚合，保持low level的特征，从而实现更好的血管轮廓识别效果。如图4中，第一静脉血管分割网络模型可以通过标注的血管轮廓数据集进行训练；通过数据预处理后得到的近红外图片，输入到训练后的模型，分割出静脉血管轮廓。如图3所示，第二静脉血管分割网络模型的目标是得到适合穿刺的血管区域，并利用连通域计算选取最优穿刺点和对应的穿刺角度。第二静脉血管分割网络模型的构建过程包括：在完成血管边缘的轮廓识别后，需要对于边缘曲率过高或者过细的血管段进行去除。具体来说对于静脉分叉处、大曲率的静脉段、靠近近红外相机成像边缘的静脉段和短的静脉段等不适合扎针的位置进行手动擦除抹除，人工标注得到适宜扎针的准确位置，作为训练数据集。然后以4：3：3的比例将训练数据集划分目标训练集、目标验证集和目标测试集。为了增加网络中的训练姐个数，避免网络出现过拟合的情况，对于目标训练集进行旋转、平移，随机缩放，遮挡等等操作。另外划分比例只是本实施例中的列举，不做限定；本实施例中数据集交由专业医师进行静脉血管边缘的标注。搭建TransUNet神经网络模型的结构；将目标训练集合输入TransUNet网络，对其进行训练；将目标验证集合以及目标测试集合输入到TransUNet网络，对其进行训练，从而得到该网络的目标分割效果。可选的，该实施实例中采用dice值以及Hausdorff距离对静脉分割的实施效果进行评价。根据目标的实施效果进行进一步修正和改进。如图4，第二静脉血管分割网络模型可以通过标注的适合穿刺的血管数据集进行训练；可以将第一静脉血管分割网络模型的输出结果作为第二静脉血管分割网络模型的输入，识别出适合穿刺的血管区域，并进一步通过连通域算法，计算出最优穿刺点和穿刺角度。将第一静脉血管分割网络模型的结果，输入到第二静脉血管分割网络模型得到适合穿刺的血管区域，设定该输出结果图片为Q。对Q进行连通域位置提取，采用：cv2.findContours函数。在得到各个连通域之后，假设连通域集合为S＝{s1,s2,……,sn}。对于每个连通域，计算其对应的中心点，利用opencv中的图片中心矩计算函数，来求得各个连通域的中心点：cv2.moments假设各个连通域对应的中心点集合为P＝{p1,p2,……,pn}，这些中心点为最佳穿刺点的候选集合。对于各个中心点pi，以其为中心旋转、则有多条以不同角度穿过连通域的直线；在这些直线中选取与连通域si相交最多的直线li，并以li的斜率θi作为该连通域的最佳穿刺角度。经过上述步骤，则可以得到各个联通域对应的li直线。选取l0＝max{li,i∈}，则原图中的目标穿刺点为该直线对应的连通域中心点Po，而该直线对应的角度作为穿刺角度θ0。四、步骤S5本实施例利用了第一红外成像图片和第二红外成像图片进行了标识血管的深度信息获取，其原理如下：由于人体的静脉深度总体由表皮厚度、真皮厚度和覆盖在静脉上的脂肪层厚度决定。人的手臂皮肤表皮层厚度通常为0.15毫米左右，皮肤总厚度一般为2毫米左右，而脂肪层厚度每个个体与部位都不同。所以手臂静脉深度主要由脂肪层厚度决定。由于人体的皮肤表皮层对红外光有很好的透过特性。照射到人体皮肤的近红外光线，大部分都能穿过表皮进入皮下脂肪组织。并且，脂肪的后向散射光大部分能穿过皮肤。光在脂肪中也存在散射和吸收两种作用。但脂肪吸收系数小而且稳定，并且在两种近红外波长下其吸收系数不同。在940nm波长附近有吸收红外光的峰值，而在850nm波长下，吸收红外的作用较小。由于红外图像的输出亮度与输入信号幅度非线性，此处采用伽玛修正计算图像的明度。假设图片某个像素点,其具有R,G,B三个维度的像素，则可以对应的计算其明度为：由于红外光线以波的模式向外均匀向外辐射，此处假设辐射到血管时，光经过的距离为d。由于是均匀发散的，所以明度与图片反射到的光强度应当呈现线性关系。假设图片反射的红外光强为I’，因而可以得出下式：I’＝γL此处的系数γ为线性关系的修正系数，可以通过线性回归得出。上述线性回归可以预先实验进行。由此，可以得到红外图片的反射光强I1’和图片明度之间的关系，然后再利用两波长下吸收红外光能量的差值推算脂肪厚度。由于脂肪细胞尺寸远大于近红外光的波长，脂肪中存在着很强的背向散射。使用可以利用背向散射光差值推测脂肪的厚度。首先，两种光在人体表面脂肪层处，对光的吸收系数为：其中，k为水的折射率的虚部，为组织中水的体积分数，λ为入射光波长。通过两种波长的红外光，对于人体体表脂肪层深度可进行计算，具体为：其中，I1表示波长为850mm的红外光波的初始光强，ΔI1表示脂肪吸收光强，I2表示波长为940mm的红外光波的初始光强，ΔI2表示脂肪吸收光强，I1’表示第一红外成像图片的反射光强，I2’表示第二红外成像图片的反射光强，η为光强吸收修正系数,μ1，μ2表示两种光强下的脂肪对于光的吸收系数。公式中，具体的修正系数可以回归进行确定。以上详细描述了本发明的较佳具体实施例。应当理解，本领域的普通技术人员无需创造性劳动就可以根据本发明的构思作出诸多修改和变化。因此，凡本技术领域中技术人员依本发明的构思在现有技术的基础上通过逻辑分析、推理或者有限的实验可以得到的技术方案，皆应在由权利要求书所确定的保护范围内。
