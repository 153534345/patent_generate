标题title
一种神经外科手术机器人的无创注册方法
摘要abst
本发明提供一种神经外科手术机器人的无创注册方法，包括：将显影定位球与神经外科手术机器人的机械臂刚性连接；将显影定位球移动至已预先固定的患者头部附近，并使显影定位球位于扫描装置的扫描范围内；以显影定位球当前所处位置为标记点；确定标记点在神经外科手术机器人坐标系统中的坐标；对患者头部和显影定位球进行扫描，并根据扫描的结果建立关于患者头部和显影定位球的影像学图像；标定标记点在影像学图像中的坐标；将标记点在影像学图像中的坐标与标记点在神经外科手术机器人坐标系统中的坐标相关联。该技术方案无需设置颅骨标记点，属于无创式注册方法，并可以达到和颅骨标记点注册方法相同的注册精度。
权利要求书clms
1.一种神经外科手术机器人的无创注册方法，其特征在于，包括：建立神经外科手术机器人坐标系统，所述神经外科手术机器人坐标系统用于确定与神经外科手术机器人的机械臂刚性连接的物体在移动到任意位置时的坐标；将显影定位球与神经外科手术机器人的机械臂刚性连接，所述显影定位球是指能在影像学图像中成像的金属球；通过所述机械臂，将所述显影定位球移动至已预先固定的患者头部的外侧，并使所述显影定位球位于扫描装置的扫描范围之内；以所述显影定位球当前所处位置作为标记点；确定所述标记点在神经外科手术机器人坐标系统中的坐标；用所述扫描装置对患者头部和所述显影定位球进行扫描，并根据扫描的结果建立关于患者头部和所述显影定位球的影像学图像；标定所述标记点在影像学图像中的坐标；将所述标记点在影像学图像中的坐标与所述标记点在神经外科手术机器人坐标系统中的坐标相关联，完成所述神经外科手术机器人的无创注册。2.如权利要求1所述的神经外科手术机器人的无创注册方法，其特征在于，所述扫描装置为X光机或CT机。3.如权利要求2所述的神经外科手术机器人的无创注册方法，其特征在于，若所述扫描装置为CT机，则，所述用所述扫描装置对患者头部和所述显影定位球进行扫描，并根据扫描的结果建立关于患者头部和所述显影定位球的影像学图像，具体包括：对患者头部和所述显影定位球进行CT扫描；对CT扫描结果进行三维重建，获得关于患者头部和所述显影定位球的影像学图像。4.如权利要求3所述的神经外科手术机器人的无创注册方法，其特征在于，若所述扫描装置为X光机，则，所述用所述扫描装置对患者头部和所述显影定位球进行扫描，并根据扫描的结果建立关于患者头部和所述显影定位球的影像学图像，具体包括：拍摄关于患者头部的正位X光片和侧位X光片，并使正位X光片和侧位X光片的照射角度之间呈90°夹角；将所述正位X光片、所述侧位X光片与预先获取的不含显影定位球的患者头部CT影像进行匹配，得到关于患者头部和所述显影定位球的影像学图像。5.如权利要求4所述的神经外科手术机器人的无创注册方法，其特征在于，若所述扫描装置为X光机，则在所述将显影定位球与神经外科手术机器人的机械臂刚性连接之前，还包括：对患者头部进行CT扫描，得到不含显影定位球的患者头部CT影像。6.如权利要求1所述的神经外科手术机器人的无创注册方法，其特征在于，在所述将显影定位球与神经外科手术机器人的机械臂刚性连接之前，还包括：选定多个所述显影定位球，并将多个所述显影定位球设置于注册支架上；所述将显影定位球与神经外科手术机器人的机械臂刚性连接，具体包括：将所述注册支架与所述机械臂的夹持端相连接。7.如权利要求5所述的神经外科手术机器人的无创注册方法，其特征在于，在所述将显影定位球与神经外科手术机器人的机械臂刚性连接之前，还包括：将手术床固定设置于所述神经外科手术机器人的侧方；将定位头架固定于手术床上，并使所述定位头架位于所述扫描装置的扫描范围之内；待患者躺在手术床上后，将患者头部与所述定位头架相固定。8.如权利要求6所述的神经外科手术机器人的无创注册方法，其特征在于，所述注册支架和所述定位头架均为X射线可透射材质。9.如权利要求1所述的神经外科手术机器人的无创注册方法，其特征在于，所述将显影定位球与神经外科手术机器人的机械臂刚性连接之后，还包括：将与所述机械臂完成连接的所述显影定位球的位置作为初始位置；根据所述初始位置，确定所述显影定位球在神经外科手术机器人坐标系统中的初始坐标；所述确定所述标记点在神经外科手术机器人坐标系统中的坐标，具体包括：调取所述显影定位球从所述初始位置移动至所述标记点的过程中，所述机械臂沿各自由度的动作数据；根据所述初始坐标及所述动作数据，计算所述标记点在神经外科手术机器人坐标系统中的坐标。10.如权利要求1所述的神经外科手术机器人的无创注册方法，其特征在于，还包括：通过所述机械臂，将所述显影定位球复位到初始位置；从所述机械臂的夹持端拆除所述显影定位球；在所述机械臂的夹持端安装手术器械。
说明书desc
技术领域本发明涉及医疗机器人技术领域，尤其涉及一种神经外科手术机器人的注册方法，更具体的为一种神经外科手术机器人的无创注册方法。背景技术医疗行业作为与人民的生命健康息息相关的行业，是高新技术汇集的一个行业，机器人技术作为高新技术的代表，对现代社会产生着越来越重要的影响。神经外科对医生的要求更高，其手术较之其它学科更加需要精确的定位和精准的操作，因此神经外科中机器人的应用显得尤为重要。目前的手术机器人系统主要有术前规划固定路径的主动型机器人和辅助医生远程或精细操作的被动型机器人两种，其中在神经外科领域中常用的为主动型机器人，应用于脑部的精确定位技术当中。神经外科手术机器人系统是利用计算机技术分析医学影像系统提供的影像信息，发挥手术机器人的技术优势，构建三维立体坐标，实现立体精确定位和精准辅助操作。从而使传统的立体定向技术与机器人的定位准确、灵巧可靠、工作范围大及流程标准化等优势相结合，减少治疗中的人为因素，使手术更为精确、灵巧与安全。手术定位方式有光学定位、机械定位、电磁定位和超声定位等。为保证定位精度，需要将影像学图像的坐标系统与神经外科手术机器人坐标系统进行匹配关联，使神经外科手术机器人能够获取患者头部各部位相对神经外科于手术机器人自身的准确坐标，此过程被称之为“注册”。目前在医疗手术机器人的应用中，注册是至关重要的一步。目前通用的注册方式主要有三种：头皮贴标记点注册、基于激光/触摸笔/结构光的面部轮廓扫描注册、颅骨标记点注册等，上述三种注册方式的注册精度依次增加，其中颅骨标记点注册方式精度最高，因此得到越来越多应用。颅骨标记点注册中需要在患者颅骨上安装固定5个以上的注册标记点，此安装通常是在患者清醒状态下进行，在对安装点局部的头皮进行麻醉后，使用螺丝刀将颅骨钉拧在颅骨上进行固定，之后拍摄患者头部的影像学图像，可以获知患者头部各部位和各注册标记点在影像学图像中的坐标位置，并通过机械臂触碰相应的注册标记点，以此获知各注册标记点在医疗手术机器人坐标系统中的坐标，通过这种方式将两个坐标系统建立关联，完成注册，手术机器人便以此方式获取了患者头部各部位在医疗手术机器人坐标系统中的坐标。该注册方式中，固定的标记点在患者的头部通常固定牢靠不易移动，因此其注册精度高。在实现本发明过程中，发明人发现现有技术中至少存在如下问题：此操作属于有创操作，在进行标记点的安装时，会造成患者头皮及颅骨一定程度的创伤，增加病人疼痛及心理负担，并且该创伤会导致部分患者可能会出现颅内硬膜外出血、伤口及颅内感染等严重并发症，增加了医疗风险。因此，如何实现一种无创且可以达到和颅骨标记点注册方法相同注册精度的注册方法，是需要解决的问题。发明内容本发明实施例提供一种神经外科手术机器人的无创注册方法，用于解决现有的颅骨标记点注册方法中存在的创伤大、医疗风险大的问题。为达上述目的，本发明实施例提供一种神经外科手术机器人的无创注册方法，包括：建立神经外科手术机器人坐标系统；将显影定位球与神经外科手术机器人的机械臂刚性连接，所述显影定位球是指能在影像学图像中成像的金属球；通过所述机械臂，将所述显影定位球移动至已预先固定的患者头部外侧，并使所述显影定位球位于扫描装置的扫描范围之内；以所述显影定位球当前所处位置为标记点；确定所述标记点在神经外科手术机器人坐标系统中的坐标；用所述扫描装置对患者头部和所述显影定位球进行扫描，并根据扫描的结果建立关于患者头部和所述显影定位球的影像学图像；标定所述标记点在影像学图像中的坐标；将所述标记点在影像学图像中的坐标与所述标记点在神经外科手术机器人坐标系统中的坐标相关联，完成所述神经外科手术机器人的无创注册。上述技术方案具有如下有益效果：本技术方案中，无需在患者头部有创安装颅骨标记点，在手术准备阶段只需将装有显影定位球的注册架安装于机械臂夹持端，显影定位球将随着机械臂移动至患者头部附近，通过术中X线或CT成像设备同步扫描患者头部和注册架，使得患者头部与显影定位球位于同一个影像学图像坐标系内，可以确定显影定位球与患者头部各解剖部位的相对位置关系，同时神经外科手术机器人可以直接计算出靠近患者头部的显影定位球在自身坐标系统中的位置，由此实现两个坐标系统的匹配，完成自动注册，即，此时，神经外科手术机器人可以间接地获取患者头部各解剖部位的坐标，以便于后续对患者头部进行手术操作。该无创式注册方式的精度与有创的颅骨标记点注册方式相当，但免去了患者因安置颅骨标记点造成的可能创伤，减少了患者的痛苦，并降低了创伤可能导致的医疗风险。此外，本技术方案还具有如下特点：1）、现有技术的颅骨标记点注册法中，不能直接获知颅骨钉在神经外科手术机器人坐标系统中的位置，而是需要用机械臂夹持端安装的探针等设备来触碰各颅骨钉，之后计算探针与颅骨钉接触时所在的坐标位置，以此方式间接获取颅骨钉在神经外科手术机器人坐标系统中的坐标位置。而本申请中，由于替代颅骨钉的显影球直接连接于机械臂上，所以神经外科手术机器人能直接获取显影球在自身坐标系统中的坐标，免去了配准过程，因而速度更快、工作效率更高。2）、现有技术的颅骨标记点注册法所使用的标记点的价格偏高，一定程度上增加了患者经济负担；本技术方案中自带标记点，免去一次性的颅骨标记点的消耗，节约耗材，节约医疗成本，降低患者费用。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其他的附图。图1是本发明实施例一种神经外科手术机器人的无创注册方法的流程图；图2是本发明实施例一种神经外科手术机器人的无创注册方法的具体应用示例图；图3是本发明实施例中注册支架的结构示意图；图4是本发明实施例中神经外科手术机器人坐标系统与影像学坐标系统相关联的过程示意图；附图标记：10、机械臂；20、注册支架；21、连接杆；22、卡座；30、扫描装置；40、固定头架；50、手术床；60、患者头部；70、显影定位球；80、机械臂接口。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。如图1所示，本发明实施例提供一种神经外科手术机器人的无创注册方法，其特征在于，包括：S101、建立神经外科手术机器人坐标系统，所述神经外科手术机器人坐标系统用于确定与神经外科手术机器人的机械臂刚性连接的物体在移动到任意位置时的坐标；S102、将显影定位球与神经外科手术机器人的机械臂刚性连接，所述显影定位球是指能在影像学图像中成像的金属球；S103、通过所述机械臂，将所述显影定位球移动至已预先固定的患者头部的外侧，并使所述显影定位球位于扫描装置的扫描范围之内；S104、以所述显影定位球当前所处位置作为标记点；S105、确定所述标记点在神经外科手术机器人坐标系统中的坐标；S106、用所述扫描装置对患者头部和所述显影定位球进行扫描，并根据扫描的结果建立关于患者头部和所述显影定位球的影像学图像；S107、标定所述标记点在影像学图像中的坐标；S108、将所述标记点在影像学图像中的坐标与所述标记点在神经外科手术机器人坐标系统中的坐标相关联，完成所述神经外科手术机器人的无创注册。为了减轻病人的痛苦，本发明实施例不再采用颅骨钉，而是采用无创的方式进行注册。现有技术中，普遍认为需要将用作标记点的设备与患者头部固定连接，才能获得二者之间的相对位置关系，而本发明实施例中，则改变了这种方法，不再将用作标记点的设备直接连接于患者头部，而是将显影定位球置于手术机器人的机械臂上，使之不再触碰患者头部、也不需通过其他装置与患者头部建立直接连接，而是只将显影定位球接近患者头部、停止在某个位置时，只要能够通过后续操作判定出二者之间的相对位置关系，即认为患者头部与显影定位球之间形成了固定位置关系；此外，本发明实施例转变了现有技术中放射设备只能用于拍摄患者病患部位的认知，将连接在机械臂末端的显影定位球也纳入了扫描设备的扫描范围内。采用本技术方案后，在手术准备阶段，只需将装有显影定位球的注册支架安装于机械臂夹持端，并将显影定位球随着机械臂移动至患者头部附近后停止，以此时的显影定位球作为标记点，之后通过扫描装置或CT机）同步扫描患者头部和注册支架，并通过计算机进行图像处理，得到影像学图像，使得患者头部与标记点位于同一个影像学图像坐标系内，可以确定标记点与患者头部各解剖部位的相对位置关系，同时神经外科手术机器人的计算机可以计算出标记点在自身坐标系统中的位置，这样一来，标记点在两个坐标系统中均具有明确的坐标，由此实现了两个坐标系统的匹配，完成自动注册，即，通过神经外科手术机器人预置的算法，建立了机械臂运行的真实空间与影像学图像空间的映射关系。此后，神经外科手术机器人可以获取患者头部各解剖部位的坐标，以便于后续对患者头部进行手术操作。该无创式注册方式的精度与有创的颅骨标记点注册方式相当，但免去了患者因安置颅骨标记点造成的可能创伤，减少了患者的痛苦，并降低了创伤可能导致的医疗风险。同时，该过程中，不再需要像现有技术那样进行配准操作，而是通过神经外科手术机器人的计算机来提前确定出显影定位球在神经外科手术机器人坐标系统中的坐标位置，；而现有技术中，由于颅骨钉不与机械臂进行连接，因此神经外科手术机器人并不知道颅骨钉的位置，在注册过程中必须要有配准这一过程，即操作机械臂移动使探针触碰颅骨钉，以这个方式“告知”神经外科手术机器人的计算机，标记点位于当前触碰的这个位置，由此确定标记点在神经外科手术机器人坐标系统中的坐标位置，而该配准过程是一个比较耗时的过程，因而，本技术方案由于提前让神经外科手术机器人确定了显影定位球的位置，可以在注册时省略配准操作，实现了免配准注册过程，使得该技术方案可以大幅提高工作效率。进一步的，在所述步骤S101之前，还包括：所述显影定位球为多个，多个所述显影定位球交错设置于注册支架上；所述将显影定位球与神经外科手术机器人的机械臂刚性连接，具体包括：将所述注册支架与所述机械臂的夹持端相连接。显影定位球为一个球体，难以直接与机械臂连接，为此，本发明实施例特设计一种图3所示的注册支架，其具有一个连接杆21，连接杆21的前端向外侧伸出两个侧架，每个侧架上通过卡座22安装显影定位球，并且两个侧架之间呈一钝角设置，以便于从两侧同时贴近患者头部的头顶，使用时将连接杆21的末端与位于机械臂夹持端的机械臂接口80通过螺栓连接即可。与此同时，为了满足患者不同患病部位的实际需求，该注册支架上同时安装了多个显影定位球70，例如图3所示，在两个侧架上各布置了三个显影定位球70，相当于每个侧架上的三个显影定位球70共面，两个侧架所在平面呈一钝角角设置，并且，左侧的显影定位球70并不与右侧的显影定位球70对称布置，这样一来，可以尽量多的满足不同位置的定位需求。根据手术部位、方式等的不同，需要用到的标记点数量也不同，并且标记点的合理位置也不同，因此，应在注册支架上设置多个显影定位球。在注册过程中，将注册支架靠近患者头部后，可以选取其中一个显影定位球的位置作为标记点，也可以同时选取多个显影定位球的位置作为标记点。进一步的，若所述扫描装置为CT机，则，所述步骤S106具体包括：对患者头部和所述显影定位球进行CT扫描；对CT扫描结果进行三维重建，获得关于患者头部和所述显影定位球的影像学图像；进一步的，若所述扫描装置为X光机，则所述步骤S106具体包括：拍摄关于患者头部的正位X光片和侧位X光片，并使正位X光片和侧位X光片的照射角度之间呈90°；将所述正位X光片、所述侧位X光片与预先获取的不含显影定位球的患者头部CT影像进行匹配，得到关于患者头部和所述显影定位球的影像学图像。并且，若所述扫描装置为X光机，则在所述步骤S102之前还包括：对患者头部进行CT扫描，得到不含显影定位球的患者头部CT影像。本发明实施例中，获取关于患者头部和所述显影定位球的影像学图像的方法有两种：扫描装置为CT机时，由于CT断层扫描后，通过CT机自带的三维重建软件可以生成三维图像，因此可以根据该三维图像直接确定图像内容中各点位的坐标，并且同时根据三维图像确定出手术目标点位置和穿刺路径等，后续通过标记点，将该三维图像的相应坐标系统与神经外科手术机器人坐标系统关联注册即可；而第二种情况，在实际工作中，目前国内术配合神经外科手术机器人的影像设备以X线扫描仪较为普及，因此，为了照顾大部分医院的实际情况，本技术方案还支持以X光机来生成关于患者头部和所述显影定位球的影像学图像，这就需要在手术当天拍摄患者头部和到达标记点位置后的显影定位球的两张X光片，并将两张X光片与预先拍摄的患者头部CT影像一起，通过本发明实施例专用的二维三维配准算法，使两张X光片的图像内容与预先拍摄的CT影像内容相关联，进而得到关于患者头部和所述显影定位球的影像学图像，之后进行注册操作即可。第二种方式与第一种方式相比，增加了术前拍摄CT影像的步骤，以及二维X光片与三维CT图像配准的过程。进一步的，在所述步骤S102之前，还包括：将手术床固定设置于所述神经外科手术机器人的侧方；将定位头架固定于手术床上，并使所述定位头架位于所述扫描装置的扫描范围之内；待患者躺在手术床上后，将患者头部与所述定位头架相固定。在注册过程中，需要保持患者头架与注册支架之间的相对位置固定，因而，为了防止患者头部产生不受控的晃动，可以让患者躺在手术床上，并用固定头架将患者头部固定。进一步的，所述注册支架和所述定位头架均为X射线可透射材质。为了防止无关物体在影像学图像中产生图像、影响后续的注册和手术操作，应将用于固定患者头部的定位头架、以及用于固定显影定位球的注册支架均采用X射线可透射材质制成，而显影定位球本身则采用显影效果较好的金属材质制成。进一步的，综合考虑重量、强度等因素，优选所述注册支架和所述定位头架的材质为碳纤维、或聚醚醚酮。进一步的，在所述步骤S102之后，还包括：将与所述机械臂完成连接的所述显影定位球的位置作为初始位置；根据所述初始位置，确定所述显影定位球在神经外科手术机器人坐标系统中的初始坐标；所述确定所述标记点在神经外科手术机器人坐标系统中的坐标，具体包括：调取所述显影定位球从所述初始位置移动至所述标记点的过程中，所述机械臂沿各自由度的动作数据；根据所述初始坐标及所述动作数据，计算所述标记点在神经外科手术机器人坐标系统中的坐标。神经外科手术机器人自身具有一套坐标系统，可在其机械臂夹持物在每次动作后，均能准确计算出移动后的位置。因此，显影定位球随机械臂移动到标记点后，神经外科手术机器人能够自动确定出标记点在神经外科手术机器人坐标系统中的空间位置。进一步的，所述神经外科手术机器人的无创注册方法还包括：S109、通过所述机械臂，将所述显影定位球复位到初始位置；S110、从所述机械臂的夹持端拆除所述显影定位球；S111、在所述机械臂的夹持端安装手术器械。完成注册操作后，显影定位球便可随注册支架一起拆除，之后机械臂的夹持端安装手术器械，便可以进行手术操作了。由此可以看出，本发明实施例中，除了可循环使用的注册支架外，无需增加额外的部件或消耗品，便可实现神经外科手术机器人的无创式注册。两个坐标系统进行关联的基本原理如图4所示：神经外科机器人的机械臂在移动到任意位置时，其自身的坐标系统都能准确计算出机械臂各点的当前位置，因此，当其夹持端连接一刚性物体时，只要预先确定刚性物体的尺寸，通过简单的坐标换算，神经外科机器人坐标系统也能够计算出刚性物体各部位的尺寸，相当于此时被夹持的刚性物体也可看做机械臂本身的一部分。将显影定位球通过注册支架刚性连接到机械臂的夹持端、并将显影定位球移动到患者头部外侧附近停止后，神经外科机器人可以自动获知该标记点在神经外科机器人坐标系统中的坐标A；而由于患者头部与机械臂并不接触，神经外科机器人无法获知患者头部任一点的坐标。此时，若患者头部的某个点位要进行手术，则通过放射设备扫描患者头部，并将此刻的显影定位球一并扫入图像中，根据扫描结果建立影像学图像，并根据影像学图像确定出影像学坐标系统，此时，两套坐标系统中均含有标记点，也就是说，通过该标记点就可以将两套坐标系统关联起来，完成注册，即，以标记点作为连接两套坐标系统的纽带。两套坐标系统关联之后，神经外科机器人就可以确定要进行手术的点位在神经外科机器人坐标系统中的位置了：在影像学图像的坐标系统中可以确定出B点与A点之间各方向的距离为L1、L2、L3，相应的，B点在神经外科机器人坐标系统中的坐标即为B，这样一来，手术目标点B点的位置也就映射到了神经外科机器人坐标系统中，当机械臂的夹持端换装手术器具后，机器人便可以带动手术器具对手术目标点进行作业了。在建立机械臂运行的真实空间与影像学图像空间的映射关系时，采用了配套的预置算法，该算法的原理参照现有技术神经外科手术机器人的注册算法，即：即存在两组一一对应的三维点坐标的集合{ai}和{bi}，假设其中一组点可以通过通过整体的刚体运动得到另外一组点，即可以通过平移和旋转两种空间变换可以获得另外一组点。两组点集中点的个数相等，而且点与点之间的对应关系已知，其中i = 1；· · · ；N，N为点集中点的个数，可以假设同一下标的亮点ai和bi是相互对应的。算法的目标是寻找{ai}和{bi}之间的映射关系，使得bi = Rai + T，其中R为3乘3的齐次旋转矩阵，而T为3乘1的齐次平移矩阵。使用最小二乘法拟合，可以通过最小化能量函数Σ=ΣNi=1|bi −  | 2，可以得到最优的R和T的值，及得到两组坐标点之间的转换关系。根据该算法，可以通过两套坐标系统共用点的坐标，将两套坐标系统完全关联起来。在本技术方案中，由于不再需要进行配准操作，因此，相应的算法中，也不再涉及现有技术的配准操作相应算法部分，由此大幅降低了运算工作量、提升了系统相应速度。在完成两个坐标系统之间的注册之后，医生确定好的手术目标点的坐标以及规划好的穿刺路径，即可转换为机器人的位姿，从而控制机器人按规划路径到达所需位置，开展手术操作。而手术目标点坐标和穿刺路径的规划，也可以有两种方式：1、若术中扫描装置为CT，则在手术当天的注册过程中，由于通过CT扫描得到的影像学图像本身为三维图像，则可在注册操作进行的过程中，直接根据扫描结果，规划穿刺路径、确定手术目标点坐标。2、若因手术条件限制，术中扫描装置为X光机，由于得到的只有正面、侧面两张二维图像，无法直接从二维图像中确定靶点和穿刺路径的坐标，因此，需要在注册之前对患者头部进行CT扫描，然后根据扫描结果初步规划穿刺路径、初步确定手术目标点位置；在注册时，由于X光片和CT扫描结果均是关于同一患者头部的骨性图像，因此二者之间具有明确的匹配关系，此时根据本申请预先设计的专用算法将两张X光片的影像与提前拍摄的CT三维影像建立关联，同时也将X光片中的显影定位球位置信息导入到CT影像中，由此得到了注册用的三维影像学图像，自然的，也就能够获取到提前确定好的规划穿刺路径、手术目标点在三维影像学图像之间的坐标。在上述过程中，二维影像与三维影像配准算法的基本原理和过程为：１）、术前X光机的校准校准采用在C型臂X光机的接收器处固定模型假体校验得到x-ray图像来修正C型臂X光机的特征值。经过一系列的校准和扭曲修正过程，可以得到参照图像。2）、C型臂X光机的相对位置特征矩阵的估算四个显影定位球在FTRAC算法中的同平面的相对位置的初始值是用图形特征识别中的形态滤波和阈值的方法初步获得。FTRAC算法中定位球的相对位置的矩阵用POSIT算法估算。假设已知3D模型的垂直投影和2D图像有相关点，物体与X光机球管的相对位置用重复循环的方法获得。显影定位球的分布投影图像就可以用相对位置矩阵计算得到，/＞是虚拟垂直光源向显影定位球透射后，于X光接收器处得到的投影图像。X光的图像是/＞,优化计算，求/＞ 和/＞最大相似度即可得到公式中的相对位置的估计值Testimated，即X光机球管到显影定位球的相对位置估计值。 3）、CT数据和x-ray图像的预处理术前CT的体数据可以转换基于下面公式中的线性衰减系数的3D体数据图像，其中，:体数据的X-光线性衰减系数；/＞水的X-光衰减系数假定单一能量的X-光源， 通过公式把HU转换到，HU是对应的CT值单位。术中获得的x光投影图像也是假定对线性衰减值进行公式的线性积分， 沿着x-光源到接收器的一条线进行积分，是接收器的光强值，/＞是x-ray和接收器间无物体的投射光强，/＞是x光不同距离的衰减量。这里假设x-ray是一个点光源，实际光源是有0.5mm的焦点。在2D/3D的配准过程中,的线性积分图像对每一个x-光的图像经的计算而来，而DRR是用线性衰减系数的体量数据用公式计算而来。4）、DRR的生成DRR是基于光强的2D/3D配准的关键部分，因为这个过程需要重复成多次以获得最优结果。在2D/3D的配准过程中，用线性追踪三线插值法来计算DRR，此方法为现有技术，故具体实现方法略。三线插值在3D体量对每个采样点计算光强值，通过沿着特定射线和固定间隔采样。5）、DRR与术中X-光图像配准DRR和x-光图像之间的交互信息，规范化的交互信息和梯度信息，满足公式，用来建立目标函数。其中，GI满足：DRR和x-光图像的梯度向量由公式计算， 其中，为x-光图像的像素光强值，/＞为DRR 图像的像素值，/＞和是图像的梯度值，/＞为加权值。此方法中，对于目标函数进行重复计算找到x-光和DRR图像的最大相似度，也是梯度图像差异最小值。必要时，优化计算需要用户手动调节初始条件和收敛条件。注：本发明实施例中，如无特殊注明，均采用国际单位制单位。至此，DRR与术中X-光图像已建立配准关系。下面以图2所示的具体实施例来说明本发明实施例的具体工作流程：1）、首先，准备注册支架20，并将显影定位球70刚性固定于注册支架20上的卡座22中；注册支架20由X射线可透射材质制成，各显影定位球70在空间呈交错散在分布。2）、若术中扫描装置为X光机，预先对患者头部进行CT扫描，得到不含显影定位球的CT影像；并根据CT影像进行术前手术计划。若术中扫描装置为CT机，则无需此步骤。3）、安装免配准注册装置：将神经外科手术机器人放置于手术床50侧方的合适位置，待患者躺在手术床50后，用固定头架40将患者头部60固定，之后将注册支架20的连接杆21与机械臂接口80相连接，使注册支架20设置于机械臂10的夹持端上，并通过神经外科手术机器人预置的算法识别各显影定位球70的初始位置坐标。4）、根据需要选定用于定位的显影定位球70，将机械臂10移动到患者头部60附近的适当位置后，保持机械臂10静止状态，当前被选定的显影定位球70的位置即为标记点。5）、根据显影定位球70的初始位置坐标，采用神经外科手术机器人预置的算法，计算出标记点在神经外科手术机器人坐标系统中的坐标。6）、通过术中扫描装置30对患者头部60和显影定位球70进行扫描。7）、若术中扫描装置30为CT机，则可得到包含患者头部各部位解剖图像和标记点位置的影像学图像，并由医生规划穿刺路径和确定手术目标点位置。若术中扫描装置30为X光机，则拍摄水平正位、侧位两张X光片，并与步骤2中得到的不含显影定位球的CT影像相配准，得到关于患者头部和显影定位球的影像学图像。8）、标定标记点在关于患者头部和显影定位球的影像学图像中的坐标；9）、将标记点在影像学图像中的坐标与标记点在神经外科手术机器人坐标系统中的坐标相匹配，完成免配准注册。10）、通过神经外科机器人执行手术方案：在机械臂10上装载器械定位模块并运行至手术针道，将手术器械安装到器械定位模块上进行手术操作。为使本领域内的任何技术人员能够实现或者使用本发明，上面对所公开实施例进行了描述。对于本领域技术人员来说；这些实施例的各种修改方式都是显而易见的，并且本申请定义的一般原理也可以在不脱离本公开的精神和保护范围的基础上适用于其它实施例。因此，本公开并不限于本申请给出的实施例，而是与本申请公开的原理和新颖性特征的最广范围相一致。以上所述的具体实施方式，对本发明的目的、技术方案和有益效果进行了进一步详细说明，所应理解的是，以上所述仅为本发明的具体实施方式而已，并不用于限定本发明的保护范围，凡在本发明的精神和原则之内，所做的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。
