标题title
多角度动态检测控制虚拟人物朝向的方法、系统及介质
摘要abst
本发明公开了多角度动态检测控制虚拟人物朝向的方法、系统及介质，属于角色控制技术领域，该方法包括：获取目标人物的朝向向量N和相机视角向量M；对相机视角进行动态检测，记录相机视角开始转动时的方向向量M1以及结束转动时的方向向量M2，计算出转动角度α，检测相机视角停止转动的保持时间t；设置检测时间T和检测角度β1；若t﹤T，或者t≧T且|α|﹤β1，则目标人物的朝向向量N保持不变；若t≧T，且|α|﹥β1，则控制目标人物执行旋转动画使目标人物的朝向向量N与方向向量M2一致，并将执行旋转动画同步给虚拟场景中的其他用户。本发明通过调整目标人物朝向与转动后的相机视角方向一致，便于掌握虚拟人物的实现方向。
权利要求书clms
1.一种多角度动态检测控制虚拟人物朝向的方法，其特征在于，该方法包括以下步骤：获取虚拟场景中目标人物的朝向向量N和相机视角向量M；对相机视角进行动态检测，所述动态检测包括视角转动检测和操作停止检测，所述视角转动检测用于记录相机视角开始转动时的方向向量M1以及结束转动时的方向向量M2，根据M1和M2计算出转动角度α，所述操作停止检测用于检测相机视角停止转动的保持时间t；设置检测时间T和检测角度β1；若t﹤T，则目标人物的朝向向量N保持不变；若t≧T，且|α|﹤β1，则目标人物的朝向向量N保持不变；若t≧T，且|α|≧β1，则控制目标人物执行旋转动画使目标人物的朝向向量N与方向向量M2一致，并将所述执行旋转动画同步给虚拟场景中的其他用户。2.根据权利要求1所述的多角度动态检测控制虚拟人物朝向的方法，其特征在于，设定所述检测时间T在1-2s之间，设定所述检测角度β1在0-1°之间。3.根据权利要求2所述的多角度动态检测控制虚拟人物朝向的方法，其特征在于，该方法还包括设置检测角度β2，且β1﹤β2，所述旋转动画包括第一动画和第二动画，那么：若t≧T，且β1﹤|α|﹤β2，则控制目标人物执行第一动画使目标人物的朝向向量N与方向向量M2一致；若t≧T，|α|≧β2，则控制目标人物执行第二动画使目标人物的朝向向量N与方向向量M2一致。4.根据权利要求3所述的多角度动态检测控制虚拟人物朝向的方法，其特征在于，设定所述检测角度β2在1-10°之间。5.根据权利要求1或3所述的多角度动态检测控制虚拟人物朝向的方法，其特征在于，所述旋转动画通过预先设计的动画模型执行播放，向所述动画模型输入转动角度α，目标人物播放旋转动画后结束时的朝向向量N与方向向量M2一致。6.根据权利要求5所述的多角度动态检测控制虚拟人物朝向的方法，其特征在于，该方法还包括设置以开始转动时的方向向量M1作为基准轴，若结束转动时的方向向量M2位于该基准轴的左半边，则计算出的转动角度α﹤0°；若结束转动时的方向向量M2位于该基准轴的右半边，则计算出的转动角度α﹥0°；若输入动画模型的转动角度α﹤0°，则执行旋转动画向左旋转，若输入动画模型的转动角度α﹥0°，则执行旋转动画向右旋转。7.一种多角度动态检测控制虚拟人物朝向的系统，其特征在于，该系统包括：方向获取单元，用于获取虚拟场景中目标人物的朝向向量N和相机视角向量M；视角检测单元，用于对相机视角进行动态检测，所述动态检测包括视角转动检测和操作停止检测，所述视角转动检测用于记录相机视角开始转动时的方向向量M1以及结束转动时的方向向量M2，根据M1和M2计算出转动角度α，所述操作停止检测用于检测相机视角停止转动的保持时间t；朝向控制单元，用于设置检测时间T和检测角度β1；若t﹤T，则目标人物的朝向向量N保持不变；若t≧T，且|α|﹤β1，则目标人物的朝向向量N保持不变；若t≧T，且|α|≧β1，则控制目标人物执行旋转动画使目标人物的朝向向量N与方向向量M2一致，并将所述执行旋转动画同步给虚拟场景中的其他用户。8.根据权利要求7所述的多角度动态检测控制虚拟人物朝向的系统，其特征在于，所述朝向控制单元还用于设置检测角度β2，且β1﹤β2，所述旋转动画包括第一动画和第二动画，那么：若t≧T，且β1﹤|α|﹤β2，则控制目标人物执行第一动画使目标人物的朝向向量N与方向向量M2一致；若t≧T，|α|≧β2，则控制目标人物执行第二动画使目标人物的朝向向量N与方向向量M2一致。9.根据权利要求8所述的多角度动态检测控制虚拟人物朝向的系统，其特征在于，所述朝向控制单元还用于括设置以开始转动时的方向向量M1作为基准轴，若结束转动时的方向向量M2位于该基准轴的左半边，则计算出的转动角度α﹤0°；若结束转动时的方向向量M2位于该基准轴的右半边，则计算出的转动角度α﹥0°；若输入动画模型的转动角度α﹤0°，则执行旋转动画向左旋转，若输入动画模型的转动角度α﹥0°，则执行旋转动画向右旋转。10.一种介质，其特征在于，其上存储有计算机程序，在所述计算机程序被处理器执行时，实现如权利要求1-6任一项所述的多角度动态检测控制虚拟人物朝向的方法。
说明书desc
技术领域本发明涉及角色控制技术领域，特别涉及多角度动态检测控制虚拟人物朝向的方法、系统及介质。背景技术跟随相机视角调整技术是一种常用于视频制作和游戏开发中的技术。它允许相机根据特定的规则或者用户输入来动态地调整视角，以便更好地跟随特定的目标或者场景。在游戏开发中，跟随相机视角调整技术常用于实现玩家角色的视角控制。例如，在第三人称动作游戏中，摄像机通常会跟随玩家角色的移动，保持角色始终处于画面中心，并根据场景的需要进行适当的调整。这样可以提供更好的游戏体验，并使玩家更容易掌控角色和环境。特别是在第三视角下，为了保证角色前进后退等移动操作都能按照用户当前视角的方向作为参照，所以角色始终需要保持与相机视角方向一致，但是在实际应用中，具有多种多样的使用需求，有时用户只想转动相机视角，而不需要转动角色的朝向，现有的解决方法是通过按下指定按键使相机视角的转动遥控与角色的朝向转动遥控脱离，这样才能自由的转动视角而保证角色的朝向不变，该方式虽然在游戏开发中广泛应用，但是在其他场景下，例如虚拟展览这一场景中，虚拟的导游人物会根据虚拟的参观人物面向的位置进行介绍，而参观人员若是人物朝向与相机视角始终一致，那么参观人员在四处观看时，会出现虚拟人物的面向方向不停的变化，影响导游的判断，若是采用按键方式使相机视角的转动遥控与角色的朝向转动遥控脱离的方式，则在用户使用头显设备或者切换第一人称的情况下无法实现仅转动相机视角，人物朝向不变动的效果。因此现有的虚拟人物朝向控制不能满足各种各样的需求。发明内容本发明的目的就在于为了解决上述人物朝向的控制的问题提出多角度动态检测控制虚拟人物朝向的方法、系统及介质，具有人物朝向的控制满足较多的应用场景，朝向控制精准的优点。第一方面，本发明通过以下技术方案来实现上述目的，一种多角度动态检测控制虚拟人物朝向的方法，该方法包括以下步骤：获取虚拟场景中目标人物的朝向向量N和相机视角向量M；对相机视角进行动态检测，所述动态检测包括视角转动检测和操作停止检测，所述视角转动检测用于记录相机视角开始转动时的方向向量M1以及结束转动时的方向向量M2，根据M1和M2计算出转动角度α，所述操作停止检测用于检测相机视角停止转动的保持时间t；设置检测时间T和检测角度β1；若t﹤T，则目标人物的朝向向量N保持不变；若t≧T，且|α|﹤β1，则目标人物的朝向向量N保持不变；若t≧T，且|α|≧β1，则控制目标人物执行旋转动画使目标人物的朝向向量N与方向向量M2一致，并将所述执行旋转动画同步给虚拟场景中的其他用户。优选的，设定所述检测时间T在1-2s之间，设定所述检测角度β1在0-1°之间。优选的，该方法还包括设置检测角度β2，且β1﹤β2，所述旋转动画包括第一动画和第二动画，那么：若t≧T，且β1﹤|α|﹤β2，则控制目标人物执行第一动画使目标人物的朝向向量N与方向向量M2一致；若t≧T，|α|≧β2，则控制目标人物执行第二动画使目标人物的朝向向量N与方向向量M2一致。优选的，设定所述检测角度β2在1-10°之间。优选的，所述旋转动画通过预先设计的动画模型执行播放，向所述动画模型输入转动角度α，目标人物播放旋转动画后结束时的朝向向量N与方向向量M2一致。优选的，该方法还包括设置以开始转动时的方向向量M1作为基准轴，若结束转动时的方向向量M2位于该基准轴的左半边，则计算出的转动角度α﹤0°；若结束转动时的方向向量M2位于该基准轴的右半边，则计算出的转动角度α﹥0°；若输入动画模型的转动角度α﹤0°，则执行旋转动画向左旋转，若输入动画模型的转动角度α﹥0°，则执行旋转动画向右旋转。第二方面，本发明通过以下技术方案来实现上述目的，一种多角度动态检测控制虚拟人物朝向的系统，该系统包括：方向获取单元，用于获取虚拟场景中目标人物的朝向向量N和相机视角向量M；视角检测单元，用于对相机视角进行动态检测，所述动态检测包括视角转动检测和操作停止检测，所述视角转动检测用于记录相机视角开始转动时的方向向量M1以及结束转动时的方向向量M2，根据M1和M2计算出转动角度α，所述操作停止检测用于检测相机视角停止转动的保持时间t；朝向控制单元，用于设置检测时间T和检测角度β1；若t﹤T，则目标人物的朝向向量N保持不变；若t≧T，且|α|﹤β1，则目标人物的朝向向量N保持不变；若t≧T，且|α|≧β1，则控制目标人物执行旋转动画使目标人物的朝向向量N与方向向量M2一致，并将所述执行旋转动画同步给虚拟场景中的其他用户。优选的，所述朝向控制单元还用于设置检测角度β2，且β1﹤β2，所述旋转动画包括第一动画和第二动画，那么：若t≧T，且β1﹤|α|﹤β2，则控制目标人物执行第一动画使目标人物的朝向向量N与方向向量M2一致；若t≧T，|α|≧β2，则控制目标人物执行第二动画使目标人物的朝向向量N与方向向量M2一致。优选的，所述朝向控制单元还用于括设置以开始转动时的方向向量M1作为基准轴，若结束转动时的方向向量M2位于该基准轴的左半边，则计算出的转动角度α﹤0°；若结束转动时的方向向量M2位于该基准轴的右半边，则计算出的转动角度α﹥0°；若输入动画模型的转动角度α﹤0°，则执行旋转动画向左旋转，若输入动画模型的转动角度α﹥0°，则执行旋转动画向右旋转。第三方面，本发明通过以下技术方案来实现上述目的，一种介质，其上存储有计算机程序，在所述计算机程序被处理器执行时，实现如第一方面所述的多角度动态检测控制虚拟人物朝向的方法。与现有技术相比，本发明的有益效果是：本发明在相机视角停止转动的时间超过检测时间时，控制目标人物的朝向与相机视角方向一致，从而让场景中的其他用户可以看到人物的注视方向，并且在控制人物的朝向之前，通过对转动角度进行判断，在转动角度在未超过设定的检测角度时，虽然相机视角发生转动，但是人物朝向并不转动，只有当转动角度超过设定的检测角度时，目标人物的朝向才会与相机视角方向一致，采用检测时间和检测角度实现是否需要调整目标人物朝向的方式，可以减少误差的产生，使目标人物的朝向调整更加精确。附图说明图1为本发明的多角度动态检测控制虚拟人物朝向的方法流程图。图2为本发明的执行第一动画和执行第二动画的区域范围示意图。图3为本发明的执行左转和右转的区域范围示意图。图4为本发明的多角度动态检测控制虚拟人物朝向的系统组成示意图。具体实施方式下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例仅仅是本发明一部分实施例，而不是全部的实施例。基于本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。实施例1如图1所示，一种多角度动态检测控制虚拟人物朝向的方法，该方法包括以下步骤：步骤S1、获取虚拟场景中目标人物的朝向向量N和相机视角向量M，在虚拟场景中，朝向向量N是虚拟人物的中心点向着正前方的法线向量，而相机视角向量M是相机中心点向着正前方的法线向量。在虚拟场景下，虚拟人物的移动和相机视角的转动是独立控制的，以电脑端为例，键盘可以操控虚拟人物的位移，鼠标可以操控相机视角，随着鼠标的移动，用户所看到的画面在转动，此时相机视角向量M在变化，若虚拟人物也在转动，那边朝向向量N也在变化，通过先获取朝向向量N和相机视角向量M做好人物朝向跟随相机视角的准备。步骤S2、对相机视角进行动态检测，所述动态检测包括视角转动检测和操作停止检测，所述视角转动检测用于记录相机视角开始转动时的方向向量M1以及结束转动时的方向向量M2，根据M1和M2计算出转动角度α，所述操作停止检测用于检测相机视角停止转动的保持时间t；实时对相机视角进行检测，包括视角转动检测和操作停止检测，视角转动检测为了检测用户是否操作视角画面进行偏转，若是出现偏转，该检测不记录偏转的轨迹，而仅记录开始时的方向向量M1和结束时的方向向量M2，这样可以根据两个方向向量得到此次发生偏转的角度，即转动角度α，所述旋转动画通过预先设计的动画模型执行播放，向所述动画模型输入转动角度α，目标人物播放旋转动画后结束时的朝向向量N与方向向量M2一致。转动角度α用来为后续的人物朝向控制做参考，为了保证人物的朝向能和转动后的相机视角方向一致，因此需要靠转动角度α来确定人物需要转动多少度；而操作停止检测是在用户操作视角偏转后，检测停止操作的时间，即保持时间t，利用保持时间t来确定是否需要控制目标人物转动，若是保持时间t太短，则不需要控制目标人物的朝向改变，反之才需要控制，这在实际应用中具有一定的好处，例如用户操作虚拟人物面向一个目标时，此时的视角画面也正对着该目标，但是用户并不想离开目标，只是想看一下目标周围的环境，那么用户可以通过操作视角进行偏转直到回到原位，而且视角在偏转到一片区域时，必然会出现一定的停顿，这个停顿时间则是没有操作时的保持时间t，由于用户只是想观察一下周围的环境，所以不会出现长时间停留的情况，这种短暂的停留，不会使目标人物的朝向跟着转动，从而达到了用户的心理预期，所以通过检测保持时间t，更加符合实际的使用情况。同理转动角度α不仅作为朝向控制一致性的参考，也作为判断是否需要控制目标人物转动，因为在实际应用中，用户通过电脑端或者是头显设备来操控虚拟人物，手指触碰到鼠标，或者头显设备晃动会导致相机视角产生一定的微小偏转，而这种微小偏转，并不是用户真实想要转动相机视角的意图，所以不需要控制目标人物的朝向改变，从而也能让该方法更加符合实际的使用情况步骤S3、设置检测时间T和检测角度β1；检测时间T是用来作为比较使用，上述步骤S2提到了，保持时间t只有到达一定值时，才需要控制目标人物的朝向与相机视角最后的方向一致，因此利用检测时间T来进行时间衡量，通常采用计时器进行计时，在计时器上设置时间阈值，即为检测时间T，相机视角转动停止后计时器开始工作，当计时器超过设定的阈值，那么说明保持时间t是超过检测时间T的，反之，则不超过。检测角度β1是用来检测相机视角转动的角度，上述步骤S2提到了，转动角度α是根据开始时的方向向量M1和结束时的方向向量M2计算得到，而且在转动角度α的值较小的情况下，目标人物的朝向是不需要转动的，因此设置检测角度β1与转动角度α进行比较，只有在超过检测角度β1才说明需要对目标人物的朝向进行控制。利用检测时间T和检测角度β1判断是否需要控制目标人物的朝向转动的方式具体如下：A1、若t﹤T，则目标人物的朝向向量N保持不变，目标人物的朝向控制的前提是在用户停止对相机视角转动到达一定的时间，该步骤仅需判断保持时间t是否到达检测时间T，无需对转动角度α进行判断，在保持时间t没到达检测时间T的标准时，不需要对目标人物的朝向进行控制。A2、若t≧T，且|α|﹤β1，则目标人物的朝向向量N保持不变，该步骤与上一步骤不同之处在于，保持时间t已经到达检测时间T的标准，那么就需要对转动角度α进行判断，转动角度α小于检测角度β1，那么同样不需要对目标人物的朝向进行控制；A3、若t≧T，且|α|≧β1，则控制目标人物执行旋转动画使目标人物的朝向向量N与方向向量M2一致，并将所述执行旋转动画同步给虚拟场景中的其他用户，该步骤与上一步骤相似，都是在保持时间t已经到达检测时间T的标准，再进行转动角度α与检测角度β1之间的判断，在转动角度α不小于检测角度β1时，此时就需要对目标人物的朝向进行控制，因此选择执行旋转动画来使目标人物的朝向向量N与方向向量M2一致，并且将这一动作同步给其他用户，使场景中的所有用户都能看到转动的这一动作，也能看到目标人物的朝向，执行旋转动画是为了用户或者其他用户能看到目标人0物的朝向在调整角度时的过程。值得注意的是，在上述步骤A2和步骤A3中，转动角度α在与检测角度β1进行对比时，采用|α|即为绝对值α与β1进行对比，因为转动角度α不仅可以设置成属于0-360°的范围，也可以设置成属于0-180°的范围内，在第二种情况下，若转动角度α超过180°，那么得到的α的值是小于0的，所以在与β1进行对比时选择|α|。为了使检测时间T和检测角度β1的判断更加符合实际使用情况，因此设定所述检测时间T在1-2s之间，设定所述检测角度β1在0-1°之间，因为1-2s的时间足够用户去停留观察目标的周围环境，只有超过这一时间，才会作出用户想要转动相机视角来改变目标人物的朝向的判断，同样的，0-1°为了提供允许相机视角的晃动范围，只有超过这一角度，才会作出想要转动相机视角来改变目标人物的朝向的判断。旋转动画的播放是一个持续的过程，在设计旋转动画时，设置好完整动作的播放时长，输入转动角度即可实现转动的这一动作，由于播放时长是一定的，那么转动角度越小，则目标人物的转动速度越慢，反之转动角度越大，目标人物的转动速度越快，因此若是仅采用一动作实现目标人物的转动，那么在角度较小时，转动起来的动作很容易使用户观看起来不够协调，所以提出以下方法：如图2所示，该方法还包括设置检测角度β2，且β1﹤β2，所述旋转动画包括第一动画和第二动画，设计第一动画的主要特点是人物的动作幅度小，这样即使在转动角度小的情况下也不容易产生不协调的感观，而设计第二动作的主要特点是人物的动作幅度大，因为在转动角度大的情况下任务的转动速度快，动作幅度大的话不易产生不协调的感观。以下方法是对如何判断目标人物该执行第一动画还是第二动画作出的：若t≧T，且β1﹤|α|﹤β2，则控制目标人物执行第一动画使目标人物的朝向向量N与方向向量M2一致；若t≧T，|α|≧β2，则控制目标人物执行第二动画使目标人物的朝向向量N与方向向量M2一致。设定所述检测角度β2在1-10°之间，在这一区间的转动角度总结为转动角度小的情况，不小于10°的情况下总结为转动角度大的情况。在步骤S2中，已经提到视角转动检测不记录偏转的轨迹，仅记录开始时的方向向量M1和结束时的方向向量M2，而且步骤A2和步骤A3中也提到了转动角度α不仅可以设置成属于0-360°的范围，也可以设置成属于0-180°的范围内，所以为了提高控制目标人物的朝向效率，选择转动角度α属于0-180°的范围最佳，因为转动角度不超过180°，转动起来效率更好，但是选择0-180°这一范围，会出现的问题是若是用户操控相机视角转动超过180°，那么计算出的转动角度α为负值，此时不便于控制目标人物的朝向。因此针对上述问题，还作出以下改进：如图3所示，该方法还包括设置以开始转动时的方向向量M1作为基准轴，若结束转动时的方向向量M2位于该基准轴的左半边，则计算出的转动角度α﹤0°；若结束转动时的方向向量M2位于该基准轴的右半边，则计算出的转动角度α﹥0°；若输入动画模型的转动角度α﹤0°，则执行旋转动画向左旋转，若输入动画模型的转动角度α﹥0°，则执行旋转动画向右旋转，将目标人物的转动区域一分为二，左边区域和右边区域，以相机视角转动前的方向向量M1为中轴线，相机视角向右旋转的角度超过180°，那么会从右边区域到达左边区域，这样将旋转动画设计成左转和右转，可以判断此时控制目标人物的朝向左转最高效。实施例2如图4所示，一种多角度动态检测控制虚拟人物朝向的系统，该系统包括：方向获取单元，用于获取虚拟场景中目标人物的朝向向量N和相机视角向量M；视角检测单元，用于对相机视角进行动态检测，所述动态检测包括视角转动检测和操作停止检测，所述视角转动检测用于记录相机视角开始转动时的方向向量M1以及结束转动时的方向向量M2，根据M1和M2计算出转动角度α，所述操作停止检测用于检测相机视角停止转动的保持时间t；朝向控制单元，用于设置检测时间T和检测角度β1，检测时间T在1-2s之间，所述检测角度β1在0-1°之间；若t﹤T，则目标人物的朝向向量N保持不变；若t≧T，且|α|﹤β1，则目标人物的朝向向量N保持不变；若t≧T，且|α|﹥β1，则控制目标人物执行旋转动画使目标人物的朝向向量N与方向向量M2一致，并将所述执行旋转动画同步给虚拟场景中的其他用户。所述朝向控制单元还用于设置检测角度β2，且β1﹤β2，检测角度β2在1-10°之间，所述旋转动画包括第一动画和第二动画，那么：若t≧T，且β1﹤|α|﹤β2，则控制目标人物执行第一动画使目标人物的朝向向量N与方向向量M2一致；若t≧T，|α|≧β2，则控制目标人物执行第二动画使目标人物的朝向向量N与方向向量M2一致。旋转动画通过预先设计的动画模型执行播放，向所述动画模型输入转动角度α，目标人物播放旋转动画后结束时的朝向向量N与方向向量M2一致。所述朝向控制单元还用于括设置以开始转动时的方向向量M1作为基准轴，若结束转动时的方向向量M2位于该基准轴的左半边，则计算出的转动角度α﹤0°；若结束转动时的方向向量M2位于该基准轴的右半边，则计算出的转动角度α﹥0°；若输入动画模型的转动角度α﹤0°，则执行旋转动画向左旋转，若输入动画模型的转动角度α﹥0°，则执行旋转动画向右旋转。由于实施例2和实施例1本质相同，因此不在赘述实施例2中各个单元的工作原理。实施例3本实施例提出了一种介质，介质包括存储程序区和存储数据区，其中存储程序区可存储操作系统，以及运行即时通讯功能所需的程序等；存储数据区可存储各种即时通讯信息和操作指令集等。计算机程序存储在存储程序区，在所述计算机程序被处理器执行时，实现如实施例1所述的多角度动态检测控制虚拟人物朝向的方法。处理器可以包括一个或多个中央处理单元或者为数字处理单元等等。对于本领域技术人员而言，显然本发明不限于上述示范性实施例的细节，而且在不背离本发明的精神或基本特征的情况下，能够以其他的具体形式实现本发明。因此，无论从哪一点来看，均应将实施例看作是示范性的，而且是非限制性的，本发明的范围由所附权利要求而不是上述说明限定，因此旨在将落在权利要求的等同要件的含义和范围内的所有变化囊括在本发明内。此外，应当理解，虽然本说明书按照实施方式加以描述，但并非每个实施方式仅包含一个独立的技术方案，说明书的这种叙述方式仅仅是为清楚起见，本领域技术人员应当将说明书作为一个整体，各实施例中的技术方案也可以经适当组合，形成本领域技术人员可以理解的其他实施方式。
