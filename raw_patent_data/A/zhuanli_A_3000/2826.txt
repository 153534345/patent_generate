标题title
基于冗余传感器的人体关节位置及角度解算方法
摘要abst
本发明公开了基于冗余传感器的人体关节位置及角度解算方法，涉及测量技术领域。本发明包括以下步骤：在待测关节的两端肢体上分别设置两个惯性传感器，同时设置好红外动作捕捉所需的反光marker点，通过静态校准获得各个传感器的初始四元数，经过计算得到传感器的偏差值，然后通过采集到的运动过程中各个传感器的实时输出的四元数，计算得到各个传感器输出的节点的四元数，再将各节点的四元数与红外捕捉设备所获取的关节点的标准四元数进行多元线性拟合，得到基于冗余信息输出的四元数，最后经过计算得到关节的位置以及角度。本发明利用冗余传感器的信息来消除运动过程中传感器与骨骼位置不匹配而带来的误差，得出更加精准的关节位置以及角度信息。
权利要求书clms
1.基于冗余传感器的人体关节位置及角度解算方法，其特征在于，包括如下步骤：S1：在待测关节O2的两端肢体上分别设置两个惯性传感器，同时设置好红外动作捕捉所需的反光marker点，开始读取惯性传感器的姿态角信息；S2：人体保持直立静止5秒，待测关节O2以及待测关节O2上部临近关节O1均无转动，采集各个传感器的初始四元数q，根据分别计算得到每个传感器的偏差值qbias，完成静态校准，取静态校准过程中偏差值的均值进行下一步计算，式中，qO1为O1关节的初始四元数，为四元数乘法，q*_bias为*传感器的偏差值；S3：人体运动过程中，分别采集四个传感器的实时输出的四元数qs*，并通过计算得到各个传感器输出的关节点的四元数；S4：利用S3步骤求得的各节点的四元数与红外捕捉设备所获取的关节点的标准四元数qsta进行多元线性拟合，求出拟合参数，进而将参数代入拟合方程，得到基于冗余信息输出的四元数qo1、qo2；S5：根据S4步骤得到的qo1、qo2，计算得到待测关节O2的位置为：O1O2＝则根据qo1可求得O2的位置为：PO2＝式中，Len O1O2为肢体O1O2的长度，qO1-1表示O1四元数的逆，Xo2,Yo2,Zo2分别表示O2关节在X轴、Y轴、Z轴上的数值，为关节O2的位置的三维坐标的四元数化表示；S6：根据S4步骤得到的qo2，计算得到待测关节O2下部临近关节O3的位置为O2O3＝)则根据qo2可求得O3的位置为：PO3＝，式中，Len O2O3为肢体O2O3的长度，qO2-1表示O2四元数的逆，Xo3,Yo3,Zo3分别表示O3关节在X轴、Y轴、Z轴上的数值，为关节O3的位置的三维坐标的四元数化表示；S7：由S4步骤计算得出qo1和qo2，计算得到待测关节O2的角度四元数形式为：则O1O2延长线与O2O3之间的夹角：α＝arctan2,1-22+2))式中，q0为实数部分，q1,q2,q3为带着不同虚部的虚数部分，即肢体O1O2与肢体O2O3之间的关节角为：180°-α。2.根据权利要求1所述的基于冗余传感器的人体关节位置及角度解算方法，其特征在于，所述S1步骤中，在设置红外动作捕捉所需的反光marker点时，在所述肢体O1O2与肢体O2O3上分别设置三个不共线的点。3.根据权利要求2所述的基于冗余传感器的人体关节位置及角度解算方法，其特征在于，所述S2步骤中，qO1为O1关节的初始四元数，qO2为O2关节的初始四元数。4.根据权利要求1所述的基于冗余传感器的人体关节位置及角度解算方法，其特征在于，所述S3步骤具体为：令待测关节O2上端肢体即肢体O1O2上设置的传感器分别表示为S1传感器、S2传感器，待测关节O2下端肢体即肢体O2O3上设置的传感器分别表示为S3传感器、S4传感器，在人体运动过程中，分别采集S1传感器、S2传感器、S3传感器、S4传感器的实时输出四元数qs1、qs2、qs3、qs4、计算得到O1关节的四元数为：O2关节的四元数为：式中：为S1传感器、S2传感器、S3传感器、S4传感器的偏差值的均值。5.根据权利要求4所述的基于冗余传感器的人体关节位置及角度解算方法，其特征在于，所述S4步骤利用S3步骤计算得到qs1o1、qs2o1与红外设备获取的O1的标准四元数qsta_o1进行多元线性拟合，拟合方程为：即：a*qs11+b*qs21+c1＝qsta_o11，……，a*qs14+b*qs24+c4＝qsta_o14即求的最小值，取部分数据求出拟合参数a,b,c，其余部分验证参数的正确与否，进而将参数代入拟合方程，得到基于冗余信息输出的四元数qo1，式中，a1，a2表示多元函数的自变量，ysta表示红外动作捕捉设备得到的标准参数也即精确的关节四元数，yi是根据惯性动作捕捉设备得到的参数也即存在误差的关节四元数，i表示共有i组数据。6.根据权利要求4所述的基于冗余传感器的人体关节位置及角度解算方法，其特征在于，所述S4步骤利用S3步骤计算得到qs3o2、qs4o2与红外设备获取的O2的标准四元数qsta_o2进行多元线性拟合，拟合方程为：即：d*qs11+e*qs21+f1＝qsta_o21，……，d*qs14+e*qs24+f4＝qsta_o24即求的最小值，取部分数据求出拟合参数d,e,f，其余部分验证参数的正确与否，进而将参数代入拟合方程，得到基于冗余信息输出的四元数qo2，式中，a1，a2表示多元函数的自变量，ysta表示红外动作捕捉设备得到的标准参数也即精确的关节四元数，yi是根据惯性动作捕捉设备得到的参数也即存在误差的关节四元数，i表示共有i组数据。7.根据权利要求1-6任一权利要求所述的基于冗余传感器的人体关节位置及角度解算方法，其特征在于，所述q*＝*＝式中，q表示普遍性的一般四元数，qv为四元数虚部，qw为四元数实部。
说明书desc
技术领域本发明涉及测量技术领域，尤其涉及基于冗余传感器的人体关节位置及角度解算方法。背景技术随着科学技术的飞速发展，人体的步态信息十分重要，涉及到伤病肢体的康复，体育训练，外骨骼以及主动式假肢的研究等领域。人体的动作捕捉系统的技术主要分为光学式与惯性传感器等方法，其中基于多marker点的红外光学捕捉系统具有极高的准确性，但是由于其技术方案存在对场景大小、光学条件的局限性，且设备昂贵，无法应用到大众场景中。而近年来随着惯性传感器的发展，基于惯性传感器的动作捕捉系统精度也逐年上升，且基于惯性传感器的动作捕捉系统具有对场地要求低，成本相对低廉的优点，本发明针对该类型系统存在的运动过程中传感器与骨骼发生相对位移而产生的误差进行修正。发明内容针对上述问题，本发明的目的在于公开基于冗余传感器的人体关节位置及角度解算方法，利用冗余传感器的信息来消除运动过程中传感器与骨骼位置不匹配而带来的误差，得出更加精准的关节位置以及角度信息。具体的，本发明的基于冗余传感器的人体关节位置及角度解算方法，包括如下步骤：S1：在待测关节O2的两端肢体上分别设置两个惯性传感器，同时设置好红外动作捕捉所需的反光marker点，开始读取惯性传感器的姿态角信息；S2：人体保持直立静止5秒，待测关节O2以及待测关节O2上部临近关节O1均无转动，采集各个传感器的初始四元数q，根据分别计算得到每个传感器的偏差值qbias，完成静态校准，取静态校准过程中偏差值的均值进行下一步计算，式中，qO1为O1关节的初始四元数，为四元数乘法，q*_bias为*传感器的偏差值，；S3：人体运动过程中，分别采集四个传感器的实时输出的四元数qs*，并通过计算得到各个传感器输出的关节点的四元数；S4：利用S3步骤求得的各节点的四元数与红外捕捉设备所获取的关节点的标准四元数qsta进行多元线性拟合，求出拟合参数，进而将参数代入拟合方程，得到基于冗余信息输出的四元数qo1、qo2；S5：根据S4步骤得到的qo1、qo2，计算得到待测关节O2的位置为：O1O2＝则根据qo1可求得O2的位置为：PO2＝式中，Len O1O2为肢体O1O2的长度，qO1-1表示O1四元数的逆，Xo2,Yo2,Zo2分别表示O2关节在X轴、Y轴、Z轴上的数值，为关节O2的位置的三维坐标的四元数化表示；S6：根据S4步骤得到的qo2，计算得到待测关节O2下部临近关节O3的位置为O2O3＝)则根据qo2可求得O3的位置为：PO3＝，式中，Len O2O3为肢体O2O3的长度，qO2-1表示O2四元数的逆，Xo3,Yo3,Zo3分别表示O3关节在X轴、Y轴、Z轴上的数值，为关节O3的位置的三维坐标的四元数化表示；S7：由S4步骤计算得出qo1和qo2，计算得到待测关节O2的角度四元数形式为：则O1O2延长线与O2O3之间的夹角：α＝arctan2,1-22+2))式中，q0为实数部分，q1,q2,q3为带着不同虚部的虚数部分，即肢体O1O2与肢体O2O3之间的关节角为：180°-α。进一步，所述S1步骤中，在设置红外动作捕捉所需的反光marker点时，在所述肢体O1O2与肢体O2O3上分别设置三个不共线的点。进一步，所述S2步骤中，qO1为O1关节的初始四元数，qO2为O2关节的初始四元数。进一步，所述S3步骤具体为：令待测关节O2上端肢体即肢体O1O2上设置的传感器分别表示为S1传感器、S2传感器，待测关节O2下端肢体即肢体O2O3上设置的传感器分别表示为S3传感器、S4传感器，在人体运动过程中，分别采集S1传感器、S2传感器、S3传感器、S4传感器的实时输出四元数qs1、qs2、qs3、qs4、计算得到O1关节的四元数为：O2关节的四元数为：式中：为S1传感器、S2传感器、S3传感器、S4传感器的偏差值的均值。进一步，所述S4步骤利用S3步骤计算得到qs1o1、qs2o1与红外设备获取的O1的标准四元数qsta_o1进行多元线性拟合，拟合方程为：即：a*qs11+b*qs21+c1＝qsta_o11，……，a*qs14+b*qs24+c4＝qsta_o14，即求的最小值，取部分数据求出拟合参数a,b,c，其余部分验证参数的正确与否，进而将参数代入拟合方程，得到基于冗余信息输出的四元数qo1，式中，a1，a2表示多元函数的自变量，ysta表示红外动作捕捉设备得到的标准参数也即精确的关节四元数，yi是根据惯性动作捕捉设备得到的参数也即存在误差的关节四元数，i表示共有i组数据。进一步，所述S4步骤利用S3步骤计算得到qs3o2、qs4o2与红外设备获取的O2的标准四元数qsta_o2进行多元线性拟合，拟合方程为：即：d*qs11+e*qs21+f1＝qsta_o21，……，d*qs14+e*qs24+f4＝qsta_o24即求的最小值，取部分数据求出拟合参数d,e,f，其余部分验证参数的正确与否，进而将参数代入拟合方程，得到基于冗余信息输出的四元数qo2，式中，a1，a2表示多元函数的自变量，ysta表示红外动作捕捉设备得到的标准参数也即精确的关节四元数，yi是根据惯性动作捕捉设备得到的参数也即存在误差的关节四元数，i表示共有i组数据。进一步，所述q*＝*＝式中，q表示普遍性的一般四元数，qv为四元数虚部，qw为四元数实部。本发明的有益效果：本发明公开了一种基于冗余传感器的人体关节位置及角度解算方法，通过多元线性拟合的方法将冗余传感器解算的结果与红外动作捕捉系统的结果进行拟合，得出线性方程的参数来解决运动中惯性传感器与骨骼位置不匹配的误差，得出更加精准的关节位置以及角度信息。附图说明图1本发明的关节模型以及传感器设置示意图；图2本发明计算关节角度说明示意图；图3本发明方法流程图。具体实施方式以下将结合具体实施例对本发明进行详细说明：本发明的基于冗余传感器的人体关节位置及角度解算方法，具体包括如下步骤：S1：如图1所示，在待测关节O2的两端肢体上分别设置两个惯性传感器，令待测关节O2上端肢体即肢体O1O2上设置的传感器分别表示为S1传感器、S2传感器，待测关节O2下端肢体及肢体O2O3上设置的传感器分别表示为S3传感器、S4传感器，同时，在肢体O1O2与肢体O2O3上分别设置三个不共线的红外动作捕捉所需的反光marker点，开始读取惯性传感器的姿态角信息。S2：人体保持直立静止5秒，待测关节O2以及待测关节O2上部临近关节O1均无转动，关节O1及关节O2的初始四元数采集S1传感器、S2传感器、S3传感器、S4传感器的初始四元数qs1、qs2、qs3、qs4，根据计算得到S1传感器的偏差值qS1_bias，式中，为四元数乘法。具体的，由于可以将四元数写成一个四维矢量p＝，q＝，则四元数乘法可表示为：要求得中的qS1_bias，等式左边为已知的初始无转动的四元数，右边第一项为校准期间S1传感器输出的四元数组成的4*4矩阵，即解方程组：由此，可以求得qS1_bias，同理根据可以求出qS2_bias，qS3_bias，qS4_bias完成静态校准，取静态校准过程中偏差值的均值为下一步计算的偏差值。S3：人体运动过程中，分别采集S1传感器、S2传感器、S3传感器、S4传感器的实时输出四元数qs1、qs2、qs3、qs4、计算得到O1关节的四元数为：O2关节的四元数为：式中：为S1传感器、S2传感器、S3传感器、S4传感器的偏差值的均值，为四元数乘法，计算方式与S2步骤相同，直接进行矩阵相乘计算即可。S4：调整红外动作捕捉设备跟惯性动作设备频率相同，即保持两套设备的数据在时间上同步，则在相同的时间内得到的结算角度数据量是相同的，便于将惯性设备有误差的数据拟合到精准的红外动作捕作设备上，求得的各节点的四元数与红外捕捉设备所获取的关节点的标准四元数qsta进行多元线性拟合，求出拟合参数进而将参数代入拟合方程，得到基于冗余信息输出的四元数qo1、qo2，具体的，利用S3步骤计算得到qs1o1、qs2o1与红外设备获取的O1的标准四元数qsta_o1进行多元线性拟合，即：a*qs11+b*qs21+c1＝qsta_o11，……，a*qs14+b*qs24+c4＝qsta_o14即求的最小值，取部分数据求出拟合参数a,b,c，其余部分验证参数的正确与否，进而将参数代入拟合方程，得到基于冗余信息输出的四元数qo1，式中，a1，a2表示多元函数的自变量，ysta表示红外动作捕捉设备得到的标准参数也即精确的关节四元数，yi是根据惯性动作捕捉设备得到的参数也即存在误差的关节四元数，i表示共有i组数据。利用S3步骤计算得到qs3o2、qs4o2与红外设备获取的O2的标准四元数qsta_o2进行多元线性拟合，拟合方程为：即：d*qs11+e*qs21+f1＝qsta_o21，……，d*qs14+e*qs24+f4＝qsta_o24即求的最小值，取部分数据求出拟合参数d,e,f，其余部分验证参数的正确与否，进而将参数代入拟合方程，得到基于冗余信息输出的四元数qo2，式中，a1，a2表示多元函数的自变量，ysta表示红外动作捕捉设备得到的标准参数也即精确的关节四元数，yi是根据惯性动作捕捉设备得到的参数也即存在误差的关节四元数，i表示共有i组数据。S5：根据S4步骤得到的qo1、qo2，计算得到待测关节O2的位置为：O1O2＝则根据qo1可求得O2的位置为：PO2＝式中，Len O1O2为肢体O1O2的长度，qO1-1表示O1四元数的逆，即其中q*＝*＝为四元数的共轭，qv为四元数虚部，qw为四元数实部，Xo2,Yo2,Zo2分别表示O2关节在X轴、Y轴、Z轴上的数值，为关节O2的位置的三维坐标的四元数化表示；S6：根据S4步骤得到的qo2，计算得到待测关节O2下部临近关节O3的位置为O2O3＝)则根据qo2可求得O3的位置为：PO3＝式中，Len O2O3为肢体O2O3的长度，qO2-1表示O2四元数的逆，即其中q*＝*＝为四元数的共轭，qv为四元数虚部，qw为四元数实部，Xo3,Yo3,Zo3分别表示O3关节在X轴、Y轴、Z轴上的数值，为关节O3的位置的三维坐标的四元数化表示；S7：由S4步骤计算得出qo1和qo2，计算得到待测关节O2的角度四元数形式为：则肢体O1O2延长线与肢体O2O3之间的夹角：α＝arctan2,1-22+2))肢体O1O2与肢体O2O3之间的关节角为：180°-α，关节的肢体O1O2延长线与另一肢体O2O3在其余两个方向的欧拉角为：β＝arcsin)，γ＝atan2,1-22+2))式中，q0为实数部分，q1,q2,q3为带着不同虚部的虚数部分。以上实施例仅用以说明本发明的技术方案而非限制，尽管参照较佳实施例对本发明进行了详细说明，本领域的普通技术人员应当理解，可以对本发明的技术方案进行修改或者等同替换，而不脱离本发明技术方案的宗旨和范围，其均应涵盖在本发明的权利要求范围当中。本发明未详细描述的技术、形状、构造部分均为公知技术。
