标题title
一种CT影像自动调整方法
摘要abst
本发明公开了一种CT影像自动调整方法，包括步骤：根据CT影像各体素点的CT值生成直方图，根据目标组织搜索直方图中满足设定条件的峰值位置，并依据所述峰值位置与直方图最右侧区间点确定几何凸性拐点；根据所述几何凸性拐点处对应的CT值得到CT值的最小阈值和最大阈值，并据此对CT影像进行调整。本发明可快速完成影像的阈值/窗位窗宽调整，缩短医生诊断及规划、手术的时间，在骨科相关手术领域中具有广泛的应用场景。
权利要求书clms
1.一种CT影像自动调整方法，其特征在于：包括步骤：根据CT影像各体素点的CT值生成直方图，根据目标组织搜索直方图中满足设定条件的峰值位置，并依据所述峰值位置与直方图最右侧区间点确定几何凸性拐点；根据所述几何凸性拐点处对应的CT值得到CT值的最小阈值和最大阈值，并据此对CT影像进行调整。2.根据权利要求1所述的CT影像自动调整方法，其特征在于：所述依据峰值位置与直方图最右侧区间点之间确定几何凸性拐点具体如下：在直方图上从峰值位置向右侧遍历每个区间点，计算该点到峰值位置与直方图最右侧区间点之间连线的距离；找出到所述连线距离最大的点即为所述几何凸性拐点。3.根据权利要求1所述的CT影像自动调整方法，其特征在于：根据所述几何凸性拐点处对应的CT值得到CT值的最小阈值和最大阈值具体为：以所述几何凸性拐点对应的能量值区间左边界值得到最小阈值；在所述直方图上以凸性拐点为起点向右侧遍历每组直方图，记录第i组直方图的体素点个数及其后m组直方图的的体素点个数，并计算其算术平均值，将得到的算术平均值除以凸性拐点处的体素点个数，结果记为E，判断第i组直方图对应的E是否小于设定阈值；若小于则停止搜索，以第i组直方图对应区间的右边界值作为最大阈值；若不小于则继续向右搜索直至得到对应的E小于设定阈值，并以其对应区间的右边界值作为最大阈值。4.根据权利要求3所述的CT影像自动调整方法，其特征在于：在所述直方图上向右搜索到最后一个区间的前m个区间得到的对应的E不小于设定阈值，则以最后一个区间的右边界值作为最大阈值。5.根据权利要求3所述的CT影像自动调整方法，其特征在于：所述m=9。6.根据权利要求3所述的CT影像自动调整方法，其特征在于：所述设定阈值取0.02。7.根据权利要求1所述的CT影像自动调整方法，其特征在于：所述设定条件如下：Di+1=Ni+1-Ni＜-KDi=Ni-Ni-1＞KNi≥PNi＞Ni-2Ni＞Ni-1Ni＞Ni+1Ni＞Ni+2其中，Ni表示第i组直方图中体素点个数；Di+1、Di分别为第i+1、i个组直方图与前一组直方图之间体素点个数的差值；K为差值阈值；P为临界值，P=2*Nsum/N，Nsum为体素点总数；Ni-2、Ni-1、Ni+1、Ni+2分别为第i-2、i-1、i+1、i+2组直方图中体素点个数。8.根据权利要求1所述的CT影像自动调整方法，其特征在于：所述根据CT影像各体素点的CT值生成直方图具体为：判断CT影像中各体素点的CT值是否存在负数；若不存在负数，则不作处理，直接以各体素点的CT值作为其能量值；若存在负数，则遍历CT影像中所有体素点的CT值得到其中最小值的绝对值，将各体素点的CT值加上该最小值的绝对值得到对应体素点的能量值；以前述得到的各体素点的能量值生成其能量值直方图。9.根据权利要求8所述的CT影像自动调整方法，其特征在于：将各体素点的能量值分布范围进行N等分，遍历所有体素点及其能量值，以能量值表示横轴，以等分后对应能量值区间的体素点个数作为纵轴构建得到能量值直方图。10.根据权利要求1所述的CT影像自动调整方法，其特征在于：在得到所述最小阈值和最大阈值后，计算相应的窗位窗宽，对所述CT影像进行窗位窗宽调整。
说明书desc
技术领域本发明涉及图像处理技术领域，尤其涉及一种CT影像自动调整方法。背景技术CT影像数据是医生进行病理判断的主要使用数据，具有影像数据完整、影像精度高、数据细节丰富的特点，是目前骨科手术导航定位机器人所常用的影像数据。在CT检查中不同密度的正常组织或病变的组织结构或病变具有不同的CT值，因此欲显示某一组织结构细节时，应选择适合观察该组织或病变的CT值范围以获得最佳显示，然而由于拍摄CT的设备多种多样，用以显示CT影像的软件也有很多种类，仅仅通过固定的CT值范围筛选往往无法得到想要观察的组织结构。例如，医生在查看CT影像数据时一般需要手动调整影像阈值以便于看到更清晰的骨骼部分特征。发明内容发明目的：针对上述不足，本发明提供一种基于直方图几何特征的CT影像自动调整方法，可快速完成影像的阈值/窗位窗宽调整，缩短医生诊断及规划、手术的时间，在骨科相关手术领域中具有广泛的应用场景。技术方案：一种CT影像自动调整方法，包括步骤：根据CT影像各体素点的CT值生成直方图，根据目标组织搜索直方图中满足设定条件的峰值位置，并依据所述峰值位置与直方图最右侧区间点确定几何凸性拐点；根据所述几何凸性拐点处对应的CT值得到CT值的最小阈值和最大阈值，并据此对CT影像进行调整。所述依据峰值位置与直方图最右侧区间点之间确定几何凸性拐点具体如下：在直方图上从峰值位置向右侧遍历每个区间点，计算该点到峰值位置与直方图最右侧区间点之间连线的距离；找出到所述连线距离最大的点即为所述几何凸性拐点。根据所述几何凸性拐点处对应的CT值得到CT值的最小阈值和最大阈值具体为：以所述几何凸性拐点对应的能量值区间左边界值得到最小阈值；在所述直方图上以凸性拐点为起点向右侧遍历每组直方图，记录第i组直方图的体素点个数及其后m组直方图的的体素点个数，并计算其算术平均值，将得到的算术平均值除以凸性拐点处的体素点个数，结果记为E，判断第i组直方图对应的E是否小于设定阈值；若小于则停止搜索，以第i组直方图对应区间的右边界值作为最大阈值；若不小于则继续向右搜索直至得到对应的E是否小于设定阈值，并以其对应区间的右边界值作为最大阈值。在所述直方图上向右搜索到最后一个区间的前m+1个区间得到的对应的E不小于设定阈值，则以最后一个区间的右边界值作为最大阈值。所述m=9。所述设定阈值取0.02。所述设定条件如下：Di+1=Ni+1-Ni＜-KDi=Ni-Ni-1＞KNi≥PNi＞Ni-2Ni＞Ni-1Ni＞Ni+1Ni＞Ni+2其中，Ni表示第i组直方图中体素点个数；Di+1、Di分别为第i+1、i个组直方图与前一组直方图之间体素点个数的差值；K为差值阈值；P为临界值，P=2*Nsum/N，Nsum为体素点总数；Ni-2、Ni-1、Ni+1、Ni+2分别为第i-2、i-1、i+1、i+2组直方图中体素点个数。所述根据CT影像各体素点的CT值生成直方图具体为：判断CT影像中各体素点的CT值是否存在负数；若不存在负数，则不作处理，直接以各体素点的CT值作为其能量值；若存在负数，则遍历CT影像中所有体素点的CT值得到其中最小值的绝对值，将各体素点的CT值加上该最小值的绝对值得到对应体素点的能量值；以前述得到的各体素点的能量值生成其能量值直方图。将各体素点的能量值分布范围进行N等分，遍历所有体素点及其能量值，以能量值表示横轴，以等分后对应能量值区间的体素点个数作为纵轴构建得到能量值直方图。在得到所述最小阈值和最大阈值后，计算相应的窗位窗宽，对所述CT影像进行窗位窗宽调整。有益效果：本发明可快速完成影像的阈值/窗位窗宽调整，缩短医生诊断及规划、手术的时间，在骨科相关手术领域中具有广泛的应用场景。附图说明图1为本发明的CT影像自动调整方法的流程图；图2为脊椎CT扫描影像示意图；图3为构建的能量值直方图示意图；图4为刻度放大后的能量值直方图示意图，其中选取与图3不同能量值区间得到对应的直方图；图5为筛选得到的峰值及其右侧部分直方图示意图；图6为直方图凸性拐点的示意图；图7为自动阈值调整后的CT影像的示意图。具体实施方式下面结合附图和具体实施例，进一步阐明本发明。图1为本发明的CT影像自动调整方法的流程图，如图1所示，本发明的CT影像自动调整方法包括如下步骤：获取CT影像中的体素信息；如图2所示为患者脊柱CT扫描影像中的腰椎部分，通过读取该影像CT序列文件，可以获得影像的空间分辨率及影像的体素信息；本发明具体实施例中，影像的空间分辨率为512*512*142，即在影像坐标系的X、Y、Z方向的像素范围分别为0~511、0~511、0~141，X方向为人体右手指向左手方向，Y方向为人体前胸指向后背方向，Z方向为人体脚指向头部方向，均符合DICOM标准；影像的体素信息包括影像中512*512*142个体素点的坐标信息及其能量值，其中能量值是对各体素点的CT值进行重新定标得到，如下：根据DICOM标准，CT影像的CT值标准范围是-1024~3071Hu，不同的人体组织对应的CT值不同。但是不同厂家的螺旋CT设备可能因为其自身或扫描设置的原因导致其扫描出的CT影像的CT值范围并不在上述标准范围内，因此需要将CT值转换为能量值进行处理，具体转换如下；由于CT值可能为正数也可能为负数，如若CT影像中各体素点的CT值均不为负数，则不作处理，直接以各体素点的CT值作为其能量值；如若CT影像中各体素点的CT值存在负数，为便于处理，将所有体素点的CT值转换为能量值进行后续处理，具体转换方法如下：遍历512*512*142个体素点的CT值得到其中的最小值Vmin的绝对值，将其中各体素点的CT值加上最小值Vmin的绝对值得到的值记为对应体素点的能量值，从而得到各体素点的能量值及对应的能量值分布范围。本发明通过能量值进行分析以确定合适的阈值，即确定的能量值分布范围内确定合适的最大和最小能量阈值，从而对影像进行调整获取清晰的病灶部分影像；本发明中，该CT影像中各体素点的能量值分布范围为0~2102。根据CT影像的体素信息生成直方图；根据步骤得到的各体素点的能量值生成其能量值直方图，具体如下：将步骤得到的各体素点的能量值分布范围进行N等分，遍历所有体素点及其能量值，判断每个体素点的能量值属于上述能量值区间中的哪一个并记录，统计所有能量值区间内的体素点个数，以能量值表示横轴，以等分后对应能量值区间的体素点个数作为纵轴构建能量值直方图，如图3所示；由于体素点分布差异较大不易看清，对纵轴的刻度进行放大，如图4所示，可以较为清晰的看到直方图主要分布特征。根据目标组织搜索步骤生成的能量值直方图中峰值位置；要对能量值直方图进行分析，首先要确定能量值直方图中目标组织的峰值位置，根据图4可以看出，能量值直方图可能存在多个峰值，因此需要确定合适的峰值判断条件以挑选合适的峰值位置，本发明具体实施例中设定的具体峰值判断条件如下：在能量值直方图上遍历每组直方图，判断第i组直方图中体素点个数Ni是否满足以下条件：Di+1=Ni+1-Ni＜-KDi=Ni-Ni-1＞KNi≥PNi＞Ni-2Ni＞Ni-1Ni＞Ni+1Ni＞Ni+2其中，Di+1、Di分别为第i+1、i个组直方图与前一组直方图之间体素点个数的差值；K为差值阈值，一般取0~10以内的数值；P为临界值，P=2*Nsum/N，Nsum为体素点总数，本发明中，为512*512*142；Ni-2、Ni-1、Ni+1、Ni+2分别为第i-2、i-1、i+1、i+2组直方图中体素点个数；在本发明具体实施例是针对骨骼进行阈值提取，而骨骼的CT值比较大，因此，在能量值直方图上遍历每组直方图采用从能量值直方图的右侧向左侧依次遍历每组直方图能够更快地找到对应的峰值位置。当遍历到某一组直方图中体素点个数满足上述条件时，即可停止搜索，记下该组直方图所在的区间序号p、能量值区间，即该点的x坐标为区间序号p，y坐标为对应体素点数Np；类似地，将能量值直方图上位于峰值位置右侧的区间点全部转换为对应的二维几何坐标点，则第j个区间点记为Pj，最后一个区间点记为Pe，显然e =1000；如图6所示，能量值直方图近似为图中的虚线，因此图中箭头所示位置的点即为能量值直方图的凸性拐点，图中的点划线为连接点P0和点Pe生成的线段L，则可按照如下方法确定直方图的几何凸性拐点：从峰值位置向右侧遍历每个区间点Pj，计算该点Pj到线段L的距离并记录，找出到线段L距离最大的点Pf即为能量值直方图的几何凸性拐点；如图6所示，本发明具体实施例中，能量值直方图的凸性拐点Pf的坐标为。根据步骤得到的能量值直方图的几何凸性拐点计算影像阈值；根据步骤得到的能量值直方图的几何凸性拐点对应的能量值区间左边界值得到最小能量阈值，在能量值直方图上以凸性拐点Pf为起点向右侧遍历能量值直方图的每组直方图，记录第i组直方图的体素点个数Ni及其后9组直方图的的体素点个数，并计算其算术平均值，将得到的算术平均值除以凸性拐点Pf处的体素点个数，结果记为E，判断第i组直方图对应的E小于设定阈值是否成立，如成立则停止搜索，记录此时第i组直方图对应的能量区间右边界值，即为最大能量阈值；如不成立则继续向右搜索，如向右搜索到第991个能量区间仍未停止搜索，则最大能量阈值为最后一个能量区间的右边界，即2102。根据得到的最小能量阈值和最大能量阈值对CT影像进行影像调整，包括进行窗位窗宽调整。本发明具体实施例中，几何凸性拐点为第556个能量值区间，即其左边界值即为最小能量阈值，为1168.712，从该能量值区间向直方图右侧搜索，搜索至第828个能量区间时停止，可确定最大能量阈值为1742.558，图7所示即为使用最大最小阈值调整后的影像，可较为清晰的看到脊椎骨骼部分特征。本发明可快速完成影像的阈值/窗位窗宽调整，缩短医生诊断及规划、手术的时间，在骨科相关手术领域中具有广泛的应用场景。以上详细描述了本发明的优选实施方式，但是本发明并不限于上述实施方式中的具体细节，在本发明的技术构思范围内，可以对本发明的技术方案进行多种等同变换，这些等同变换均属于本发明的保护范围。
