标题title
一种基于神经网络的计算机辅助术前肺癌患者N2期淋巴结预测系统
摘要abst
本发明公开了本发明提供了一种基于神经网络的计算机辅助术前肺癌患者N2期淋巴结预测系统。该预测系统包括：第一部分：数据输入部分；第二部分：数据预处理部分；第三部分：模型构建部分；第四部分：模型训练部分；第五部分：预测部分，输入待预测肺癌患者CT特征和临床特征预处理后的数据，利用训练后的模型进行预测，输出预测结果：待预测肺癌患者是N2分期或N0/N1分期。本发明的预测系统能够准确的预测T1N0M0非小细胞肺癌患者的淋巴结是处于N0/N1状态，还是处于N2状态，预测结果的曲线下面积高达0.7847，敏感度高达89.80％，特异度高达54.50％。本发明的预测系统对医生预测患者的生存期、选择最佳治疗策略、以及预后评估具有非常重要的作用，应用前景广阔。
权利要求书clms
1.一种基于神经网络的肺癌患者N2期淋巴结预测系统，其特征在于：所述肺癌患者的淋巴结N分期情况为N2分期或N0/N1分期，所述系统包括以下五个部分：第一部分：数据输入部分；用于输入肺癌患者的CT特征和临床特征；第二部分：数据预处理部分；用于对第一部分输入的CT特征和临床特征进行预处理，其中，对CT特征和临床特征中的连续性数据进行归一化处理，对CT特征和临床特征中的离散数据进行独热编码；第三部分：模型构建部分；构建全连接网络模型；第四部分：模型训练部分；用已知淋巴结N分期情况的肺癌患者的信息训练模型，具体是将肺癌患者中淋巴结N分期为N2分期的标记为X，淋巴结N分期为N0/N1分期的标记为Y，X与Y不同；将肺癌患者的CT特征和临床特征利用第二部分预处理后的数据对第三部分构建的全连接网络模型进行训练；第五部分：预测部分；将待预测肺癌患者的CT特征和临床特征按照第二部分的方式进行预处理后，利用第四部分训练后的模型进行预测，输出预测结果：若输出的预测结果为X，则该待预测肺癌患者是N2分期，若输出的预测结果为Y，则该待预测肺癌患者是N0/N1分期。2.根据权利要求1所述的预测系统，其特征在于：第一部分中，所述肺癌患者为非小细胞肺癌患者，优选为T1N0M0非小细胞肺癌患者，更优选为系统性淋巴结清扫术前T1N0M0非小细胞肺癌患者。3.根据权利要求1所述的预测系统，其特征在于：第一部分中，所述CT特征和临床特征包括以下特征中的一种或多种：性别；体检时CT筛查发现结节；吸烟史；主要病变大小，单位为厘米；主要病变位置；淋巴结肿大；淋巴结肿大为无、单站或多站；空泡征；分叶征；边界不清晰；胸膜牵拉；磨玻璃；毛刺征；强化征；其它CT特征。4.根据权利要求3所述的预测系统，其特征在于：第二部分中，所述CT特征和临床特征进行预处理后的结果分别为：性别：若为男，预处理后结果为1，若为女，预处理后结果为0；体检时CT筛查发现结节：若为是，预处理后结果为1，若为否，预处理后结果为0；吸烟史：若为是，预处理后结果为1，若为否，预处理后结果为0；主要病变大小：为0到1之间的数值；主要病变位置：若为中央型，预处理后结果为1，若为周围型，预处理后结果为0；淋巴结肿大：若为是，预处理后结果为1，若为否，预处理后结果为0；淋巴结肿大为无、单站或多站：若为无，预处理后结果为0，若为单站，预处理后结果为0.5，若为多站，预处理后结果为1；空泡征：：若为是，预处理后结果为1，若为否，预处理后结果为0；分叶征：若为是，预处理后结果为1，若为否，预处理后结果为0；边界不清晰：若为是，预处理后结果为1，若为否，预处理后结果为0；胸膜牵拉：若为是，预处理后结果为1，若为否，预处理后结果为0；磨玻璃：若为是，预处理后结果为1，若为否，预处理后结果为0；毛刺征：若为是，预处理后结果为1，若为否，预处理后结果为0；强化征：若为是，预处理后结果为1，若为否，预处理后结果为0；其它CT特征：若为是，预处理后结果为1，若为否，预处理后结果为0。5.根据权利要求1～4任一项所述的预测系统，其特征在于：第三部分中，所述全连接网络模型为5层的全连接神经网络模型；优选的，所述5层的全连接神经网络模型的组成为：第1层、第2层、第3层分别包含一个block块，每一个block块包含一个全连接层、一个batchnorm层和一个ReLU层；第4层为linear层；第5层为Sigmoid层。6.根据权利要求5所述的预测系统，其特征在于：所述全连接网络模型每层的输入信息和输出信息如下所示：-输入信息输出信息第1层N×15N×30第2层N×30N×15第3层N×15N×7第4层N×7N×1第5层N×1N×1其中，N为每批次的数量，数字15、30、15、7、1为特征向量长度。7.根据权利要求1～4任一项所述的预测系统，其特征在于：第四部分中，所述训练是采用基于二分类交叉熵的目标函数进行训练。8.根据权利要求1～4任一项所述的预测系统，其特征在于：第五部分中，所述待预测肺癌患者为非小细胞肺癌患者，优选为T1N0M0非小细胞肺癌患者，更优选为系统性淋巴结清扫术前T1N0M0非小细胞肺癌患者。9.权利要求1～8任一项所述的预测系统在制备预测肺癌患者淋巴结分期的设备中的用途，所述设备能够预测出肺癌患者为N2分期或N0/N1分期。10.根据权利要求9所述的用途，其特征在于：所述肺癌患者为非小细胞肺癌患者，优选为T1N0M0非小细胞肺癌患者，更优选为系统性淋巴结清扫术前T1N0M0非小细胞肺癌患者。
说明书desc
技术领域本发明涉及术前肺癌患者N分期预测领域，特别是涉及一种基于神经网络的计算机辅助术前肺癌患者N2期淋巴结预测系统。背景技术肺癌是全球癌症死亡率最高的一种恶性肿瘤疾病，在一项2018年的全球性研究中，据统计在1810万新发癌症中，肺癌占据了11.6％，且在960万的因癌症死亡病例中占据了18.4％。其中，非小细胞肺癌约占所有肺癌的80％，约75％的患者发现时已处于中晚期，5年生存率很低，非小细胞肺癌相比其癌细胞生长分裂较慢，扩散转移相对较晚。低剂量螺旋计算机断层扫描可以筛查出可治愈的早期肺癌，因此CT也成为目前最主要的肺癌筛查手段。目前，手术切除是治疗早期非小细胞肺癌的最佳治疗手段。但是，一些研究证实，部分临床Ⅰ期的非小细胞肺癌术后病理证实存在纵隔淋巴结转移，对于此类患者，直接行手术治疗并没有比术前新辅助治疗效果更好。因此，准确判断区域淋巴结状态，进行更准确的术前分期，对非小细胞肺癌患者最佳治疗策略的选择以及预后评估具有非常重要的意义。增强CT是评价NSCLC淋巴结状态及N分期最常用的无创检查方法，主要以淋巴结形态学特征及体积大小作为判断依据。但是，由于不同部位正常淋巴结大小不一，炎性或反应性增生可造成淋巴结增大，以及正常大小的淋巴结内也可存在转移灶等原因常造成淋巴结转移的诊断错误，并可能使N分期欠准确。Sioris等对49例NSCLC患者的术前CT与系统淋巴结清扫术后病理分期相比较，发现CT确定的N分期准确性仅55％。因此，CT确定的N分期准确性较低，无法为临床提供可靠依据。近年来，正电子发射断层成像术在非小细胞肺癌纵隔淋巴结的分期中应用逐渐广泛，但一些研究显示PET/CT对于纵隔淋巴结转移的判断存在一定比例的假阴性。在小于1cm的淋巴结里，PET/CT对淋巴结转移的敏感性仅有32.4％：440-445)。N0/N1期和N2期纵隔淋巴结患者的治疗策略不同。为了更加准确的预测术前非小细胞肺癌患者的淋巴结状态及N分期，人们建立了相关的数学预测模型。Shirin等953–959)通过使用多因素逻辑回归预测N2期纵隔淋巴结转移得到了AUC为0.70，95％置信区间为0.66-0.75的效果；Yang Zhang等1360–1364)通过使用多因素逻辑回归预测T1期非小细胞肺癌患者是否含有N2期淋巴结，得到了AUC为0.726，95％置信区间为0.669-0.784的效果。N0/N1期和N2期纵隔淋巴结患者的治疗策略不同，而目前已经报道的预测模型对N2期纵隔淋巴结患者的预测准确度还有待提高。因此，亟需开发出一种够更快速、更准确的对术前非小细胞肺癌患者N2期纵隔淋巴结情况进行预测的系统。发明内容针对上述问题，本发明的目的在于针对术前T1N0M0肺癌患者，提供一种基于神经网络的计算机辅助预测系统，准确预测该患者为N0/N1期还是N2期。本发明提供了一种基于神经网络的肺癌患者N2期淋巴结预测系统，所述肺癌患者的淋巴结N分期情况为N2分期或N0/N1分期，所述系统包括以下五个部分：第一部分：数据输入部分；用于输入肺癌患者的CT特征和临床特征；第二部分：数据预处理部分；用于对第一部分输入的CT特征和临床特征进行预处理，其中，对CT特征和临床特征中的连续性数据进行归一化处理，对CT特征和临床特征中的离散数据进行独热编码；第三部分：模型构建部分；构建全连接网络模型；第四部分：模型训练部分；用已知淋巴结N分期情况的肺癌患者的信息训练模型，具体是将肺癌患者中淋巴结N分期为N2分期的标记为X，淋巴结N分期为N0/N1分期的标记为Y，X与Y不同；将肺癌患者的CT特征和临床特征利用第二部分预处理后的数据对第三部分构建的全连接网络模型进行训练；第五部分：预测部分；将待预测肺癌患者的CT特征和临床特征按照第二部分的方式进行预处理后，利用第四部分训练后的模型进行预测，输出预测结果：若输出的预测结果为X，则该待预测肺癌患者是N2分期，若输出的预测结果为Y，则该待预测肺癌患者是N0/N1分期。进一步地，第一部分中，所述肺癌患者为非小细胞肺癌患者，优选为T1N0M0非小细胞肺癌患者，更优选为系统性淋巴结清扫术前T1N0M0非小细胞肺癌患者。进一步地，第一部分中，所述CT特征和临床特征包括以下特征中的一种或多种：性别；体检时CT筛查发现结节；吸烟史；主要病变大小，单位为厘米；主要病变位置；淋巴结肿大；淋巴结肿大为无、单站或多站；空泡征；分叶征；边界不清晰；胸膜牵拉；磨玻璃；毛刺征；强化征；其它CT特征。“其它CT特征”指除前述特征之外的其它CT特征，例如血管集束征，支气管影等。进一步地，第二部分中，所述CT特征和临床特征进行预处理后的结果分别为：性别：若为男，预处理后结果为1，若为女，预处理后结果为0；体检时CT筛查发现结节：若为是，预处理后结果为1，若为否，预处理后结果为0；吸烟史：若为是，预处理后结果为1，若为否，预处理后结果为0；主要病变大小：为0到1之间的数值；主要病变位置：若为中央型，预处理后结果为1，若为周围型，预处理后结果为0；淋巴结肿大：若为是，预处理后结果为1，若为否，预处理后结果为0；淋巴结肿大为无、单站或多站：若为无，预处理后结果为0，若为单站，预处理后结果为0.5，若为多站，预处理后结果为1；空泡征：：若为是，预处理后结果为1，若为否，预处理后结果为0；分叶征：若为是，预处理后结果为1，若为否，预处理后结果为0；边界不清晰：若为是，预处理后结果为1，若为否，预处理后结果为0；胸膜牵拉：若为是，预处理后结果为1，若为否，预处理后结果为0；磨玻璃：若为是，预处理后结果为1，若为否，预处理后结果为0；毛刺征：若为是，预处理后结果为1，若为否，预处理后结果为0；强化征：若为是，预处理后结果为1，若为否，预处理后结果为0；其它CT特征：若为是，预处理后结果为1，若为否，预处理后结果为0。进一步地，第三部分中，所述全连接网络模型为5层的全连接神经网络模型；优选的，所述5层的全连接神经网络模型的组成为：第1层、第2层、第3层分别包含一个block块，每一个block块包含一个全连接层、一个batchnorm层和一个ReLU层；第4层为linear层；第5层为Sigmoid层。进一步地，所述全连接网络模型每层的输入信息和输出信息如下所示：-输入信息输出信息第1层N×15N×30第2层N×30N×15第3层N×15N×7第4层N×7N×1第5层N×1N×1其中，N为每批次的数量，数字15、30、15、7、1为特征向量长度。进一步地，第四部分中，所述训练是采用基于二分类交叉熵的目标函数进行训练。进一步地，第五部分中，所述待预测肺癌患者为非小细胞肺癌患者，优选为T1N0M0非小细胞肺癌患者，更优选为系统性淋巴结清扫术前T1N0M0非小细胞肺癌患者。本发明还提供了上述的预测系统在制备预测肺癌患者淋巴结分期的设备中的用途，所述设备能够预测出肺癌患者为N2分期或N0/N1分期。进一步地，所述肺癌患者为非小细胞肺癌患者，优选为T1N0M0非小细胞肺癌患者，更优选为系统性淋巴结清扫术前T1N0M0非小细胞肺癌患者。肺癌患者已知的淋巴结N分期情况是按照传统的金标准进行分期得到的结果，金标准为：术中根据解剖位置对纵隔内淋巴结进行整块切除后进行病理检测，确认其中有无肿瘤细胞转移：根据第八版肺癌TNM分期，未发生淋巴结转移时，分类为N0；发生淋巴结转移时，受累淋巴结主要位于肿瘤周围，分类为N1；受累淋巴结包含中央区域，则分类为N2。“N2期淋巴结预测系统”指能够用来预测患者淋巴结是处于N0/N1状态，还是处于N2状态的系统。“特征向量长度”是全连接网络模型中各层输入、输出的维度。本发明提供了一种基于全连接网络的网络模型结构，采用基于二分类交叉熵为损失函数作为网络训练的优化目标，对术前评估为T1N0M0期非小细胞肺癌的患者进行淋巴结N分期预测，判断患者淋巴结是处于N0/N1状态，还是处于N2状态。与现有的非小细胞肺癌N分期预测系统相比，本发明的预测系统具有以下优势：考虑到与N2分期相关的特征可能不只是蕴含了线性关系或者简单的非线性关系，本发明收集相关术前CT特征和临床特征，采取全连接神经网络模型来预测术前医生评估为T1N0M0分期患者的淋巴结N分期，使得网络能够处理各种特征之间的复杂关系；本发明采用基于二分类交叉熵的目标函数对网络模型进行训练，优化网络评价的指标，使得模型可以得到更加充分的训练；本发明的预测系统可以实现无人值守批量操作，且速度快速，硬件需求低；本发明的预测系统对术前T1N0M0非小细胞肺癌患者的淋巴结转移情况及N2分期预测准确率高，敏感度高，特异度高。实验证明，本发明的预测系统能够准确的预测术前T1N0M0非小细胞肺癌患者的淋巴结转移情况，预测患者为N0/N1期还是N2期，预测结果的曲线下面积高达0.7847，敏感度高达89.80％，特异度高达54.50％。本发明的预测系统对医生预测患者的生存期、选择最佳治疗策略、以及预后评估具有非常重要的作用，应用前景广阔。显然，根据本发明的上述内容，按照本领域的普通技术知识和惯用手段，在不脱离本发明上述基本技术思想前提下，还可以做出其它多种形式的修改、替换或变更。以下通过实施例形式的具体实施方式，对本发明的上述内容再作进一步的详细说明。但不应将此理解为本发明上述主题的范围仅限于以下的实例。凡基于本发明上述内容所实现的技术均属于本发明的范围。附图说明图1为利用本发明预测系统对术前评估为T1N0M0非小细胞肺癌的患者进行N2期淋巴结预测的流程示意图。图2为本发明5层的全连接神经网络模型的结构示意图。具体实施方式本发明所用原料与设备均为已知产品，通过购买市售产品所得。实施例1：本发明的基于神经网络的计算机辅助术前非小细胞肺癌患者N2期淋巴结预测系统本实施例所用的患者数据均为四川大学华西医院胸外科进行了系统性淋巴结清扫的术前T1N0M0、术后纵隔淋巴结N分期为N0/N1期或N2期的非小细胞肺癌患者数据，一共获取包含有3105次手术的数据。本实施例使用患者数据中，所有的术后N分期都经过了病理学检验，并附有病理学结果，将该病理学结果作为标签结果。本实施例将上述3105个患者数据利用5折交叉验证法在本发明构建的预测系统下进行了预测。该预测系统由以下五个部分组成：第一部分：数据输入部分在该部分输入肺癌患者的CT特征和临床特征。从术前T1N0M0患者数据中得到以下相关术前CT特征和临床特征：性别：男或女；体检时CT筛查发现结节：是或否；吸烟史：是或否；主要病变大小：单位厘米；主要病变类型：中央型或周围型；淋巴结肿大：是或否；淋巴结肿大：无、单站或多站；空泡征：是或否；分叶征：是或否；边界不清晰：是或否；胸膜牵拉：是或否；磨玻璃：是或否；毛刺征：是或否：强化征：是或否；其它CT特征：是或否。“其它CT特征”指除前述特征之外的其它CT特征，例如血管集束征，支气管影等。第二部分：数据预处理部分。对第一部分输入的CT特征和临床特征进行预处理：其中，主要病变大小为连续性数据，在期值域上进行归一化；其它数据为离散数据，进行独热编码。性别：若为男，预处理后结果为1，若为女，预处理后结果为0；体检时CT筛查发现结节：若为是，预处理后结果为1，若为否，预处理后结果为0；吸烟史：若为是，预处理后结果为1，若为否，预处理后结果为0；主要病变大小：为0到1之间的数值；主要病变位置：若为中央型，预处理后结果为1，若为周围型，预处理后结果为0；淋巴结肿大：若为是，预处理后结果为1，若为否，预处理后结果为0；淋巴结肿大：若为无，预处理后结果为0，若为单站，预处理后结果为0.5，若为多站，预处理后结果为1；空泡征：若为是，预处理后结果为1，若为否，预处理后结果为0；分叶征：若为是，预处理后结果为1，若为否，预处理后结果为0；边界不清晰：若为是，预处理后结果为1，若为否，预处理后结果为0；胸膜牵拉：若为是，预处理后结果为1，若为否，预处理后结果为0；磨玻璃：若为是，预处理后结果为1，若为否，预处理后结果为0；毛刺征：若为是，预处理后结果为1，若为否，预处理后结果为0；强化征：若为是，预处理后结果为1，若为否，预处理后结果为0；其它CT特征：若为是，预处理后结果为1，若为否，预处理后结果为0。第三部分：N2期淋巴结全连接网络模型构建部分本部分构建的全连接网络模型是5层的全连接神经网络模型，具体来说，该全连接网络模型的组成为：第1层、第2层、第3层分别包含一个block块，每个block块包含一个全连接层、一个batchnorm层和一个ReLU层。第4层：linear层；第5层：Sigmoid层。全连接网络模型中，第1至第5层输入的特征向量长度分别为15，30，15，7和1；且每层输入、输出的详细信息如表1所示，其中N代表训练时每批次输入的样本数量，符号“×”代表乘号，其后面的数值代表该层的特征向量长度。表1全连接网络模型每层输入、输出的详细信息-输入输出第1层N×15N×30第2层N×30N×15第3层N×15N×7第4层N×7N×1第5层N×1N×1第四部分：N2期淋巴结全连接网络模型训练部分本部分对第三部分构建的N2期淋巴结全连接网络模型进行训练。网络模型的训练主要分为以下几个步骤：①网络输入。网络模型的训练数据为第二部分预处理后得到的数据作为网络输入的特征向量，直接向第三部分构建的全连接网络模型中输入特征向量开始训练。②基于二分类交叉熵的目标函数。学习误差会影响着模型的训练好坏。在标注时，处于N2状态的病例样本被标记为1，处于N0/N1状态的病例样本的被标记为0。二分类交叉熵是一种广泛使用的分类损失函数，其定义为：l＝L＝{l1，…，lN}T，ln＝-wn其中，l表示损失函数，N表示训练时批的大小，wn表示每批次的权重参数向量，当yn为1时，其值为当前批次中标记为0的样本所占比例，为0时，其值为当前批次中标签为1的样本所占比例。以此可以来评价医生给定的标签结果和模型的预测结果的一致性。③网络训练。网络设置初始学习率为0.01，优化器设置为Adam优化器。全连接网络权值使用高斯分布初始化。一次训练批次设置12，学习迭代次数为200。网络学习针对每个批次更新一次参数。每一次迭代学习之后，模型判断预测结果的总误差大小，如果当前误差小于上一个迭代的误差，就保存当前模型，然后继续训练，直到达到最大迭代次数。模型在梯度反向传播时，从最后的损失计算层，然后反向传播到传到网络的之前的层中。对于模型的某一个输出Oj，ri为输出层上一个隐藏层的输出，其与上一层的所有连接的权重值为Wij，表示输出层上一个隐藏层第i个神经元与输出层的第j个神经元的连接权值，其关系为：其中，f为sigmoid激活函数。Wij按照以下规则进行更新Wij＝Wij+ΔWij其中，η为训练设置的学习率。第五部分：预测部分a.收集来自四川大学华西医院胸外科的术前评估为T1N0M0的非小细胞癌患者的相关术前CT特征和临床特征，并输入系统。b.按照第二部分的方法对步骤a输入的数据进行预处理，得到预处理后的数据。c.以步骤b预处理后的数据作为输入数据，利用第四部分训练后的模型进行预测，输出系统对患者淋巴结N分期预测的结果：是处于N0/N1状态，还是处于N2状态。若处于N0/N1状态，模型输出为0；若处于N2状态模型输出为1。最后将步骤c的预测结果与标签结果比较，判断本发明预测系统的预测准确度。预测结果如表3所示，表格中的值为5折交叉验证的平均值及其方差：表2 3105例术前医生评估为T1N0M0的患者信息患者人数N0/N1期人数N2期人数30152882223表3预测结果AUC敏感度特异度0.78470.89800.5450可以看出，在3015例术前T1N0M0非小细胞癌患者中，本发明的预测系统对患者N2期淋巴结预测结果的曲线下面积达到了0.7847，并且有着高达0.8980的敏感度和高达0.5450的特异度。综上，本发明提供了一种基于神经网络的计算机辅助术前肺癌患者N2期淋巴结预测系统。该预测系统能够准确的预测术前T1N0M0非小细胞肺癌患者的N2期淋巴结转移情况，预测结果的AUC高达0.7847，敏感度高达89.80％，特异度高达54.50％％。本发明的预测系统对医生预测患者的生存期、选择最佳治疗策略、以及预后评估具有非常重要的作用，应用前景广阔。
