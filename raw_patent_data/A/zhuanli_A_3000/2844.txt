标题title
导管控制方向与影像动作方向的一致性校准方法及系统
摘要abst
本发明公开一种导管控制方向与影像动作方向的一致性校准方法及系统，涉及一般的控制或调节系统技术领域，包括：接收校准开始指令；根据导管弯曲前后钢丝牵拉长度增量值，确定影像中导管的当前弯曲深度，根据当前弯曲深度和弯曲深度目标值确定弯曲深度增量值，以控制导管弯曲至弯曲深度目标值；设定每周期的弯曲方向增量旋转角，在弯曲深度目标值下，根据弯曲方向增量旋转角进行弯曲方向的变化，直至接收到校准结束指令；确定校准完成后弯曲方向的角度值，根据弯曲方向的角度值确定校准偏移角度，以在下一次控制导管弯曲方向时，将控制方向的角度值和校准偏移角度相加作为最终的控制方向。保证控制方向与影像中运动方向的一致。
权利要求书clms
1.导管控制方向与影像动作方向的一致性校准方法，其特征在于，包括：接收校准开始指令；根据导管弯曲前后钢丝牵拉长度增量值，确定影像中导管的当前弯曲深度，根据当前弯曲深度和弯曲深度目标值确定弯曲深度增量值，以此控制导管弯曲至弯曲深度目标值；设定每周期的弯曲方向增量旋转角，在弯曲深度目标值下，根据弯曲方向增量旋转角，进行弯曲方向的变化，直至接收到校准结束指令后，完成校准；确定校准完成后弯曲方向的角度值，根据弯曲方向的角度值确定校准偏移角度，以在下一次控制导管弯曲方向时，将控制方向的角度值和校准偏移角度相加作为最终的控制方向。2.如权利要求1所述的导管控制方向与影像动作方向的一致性校准方法，其特征在于，所述钢丝牵拉长度增量值为：根据控制导管弯曲的电机尾部编码器值与钢丝牵拉长度增量值的比例关系，得到钢丝牵拉长度增量值。3.如权利要求2所述的导管控制方向与影像动作方向的一致性校准方法，其特征在于，所述钢丝牵拉长度增量值为：=K*；其中，K为电机尾部编码器值与钢丝牵拉长度增量值的换算比例；Valuecoder为电机尾部当前编码器值；InitValuecoder为电机尾部初始编码器值。4.如权利要求2所述的导管控制方向与影像动作方向的一致性校准方法，其特征在于，所述当前弯曲深度为：；其中，/＞为当前弯曲深度；/＞为当前的弯曲方向角度值；/＞为第一钢丝牵拉长度增量值；/＞为导管半径。5.如权利要求1所述的导管控制方向与影像动作方向的一致性校准方法，其特征在于，通过弯曲方向增量旋转角，控制导管沿顺时针执行弯曲方向在0到360°间的变化，直至在影像中的导管在前进方向的右侧呈现最大弯曲，此时校准结束。6.如权利要求1所述的导管控制方向与影像动作方向的一致性校准方法，其特征在于，所述弯曲方向的角度值为：；其中，/＞为第一钢丝牵拉长度增量值，/＞为第二钢丝牵拉长度增量值。7.如权利要求1所述的导管控制方向与影像动作方向的一致性校准方法，其特征在于，所述校准偏移角度为弯曲方向的角度值除以360后取余数。8.导管控制方向与影像动作方向的一致性校准系统，其特征在于，包括：指令接收模块，被配置为接收校准开始指令；弯曲深度控制模块，被配置为根据导管弯曲前后钢丝牵拉长度增量值，确定影像中导管的当前弯曲深度，根据当前弯曲深度和弯曲深度目标值确定弯曲深度增量值，以此控制导管弯曲至弯曲深度目标值；弯曲方向控制模块，被配置为设定每周期的弯曲方向增量旋转角，在弯曲深度目标值下，根据弯曲方向增量旋转角，进行弯曲方向的变化，直至接收到校准结束指令后，完成校准；校准模块，被配置为确定校准完成后弯曲方向的角度值，根据弯曲方向的角度值确定校准偏移角度，以在下一次控制导管弯曲方向时，将控制方向的角度值和校准偏移角度相加作为最终的控制方向。9.一种电子设备，其特征在于，包括存储器和处理器以及存储在存储器上并在处理器上运行的计算机指令，所述计算机指令被处理器运行时，完成权利要求1-7任一项所述的方法。10.一种计算机可读存储介质，其特征在于，用于存储计算机指令，所述计算机指令被处理器执行时，完成权利要求1-7任一项所述的方法。
说明书desc
技术领域本发明涉及一般的控制或调节系统技术领域，特别是涉及一种导管控制方向与影像动作方向的一致性校准方法及系统。背景技术支持可调弯导管的血管介入机器人在DSA实时透视影像的指导下进行血管介入手术，它支持使用摇杆控制使得导管末端弯曲，且在DSA影像中呈现出沿对应方向弯曲的效果。由于术中造影的体位随着手术的进程存在多次切换，如果不及时进行摇杆控制方向与DSA影像中呈现的运动方向的校准，会产生手眼不协调的问题，影响医生的控制判断，进而不方便于手术的进行。也就是，存在摇杆控制导管的实际运动方向与影像中呈现的导管运动方向不一致的问题；即，当摇杆向前推进时，影像中的导管向其他方向移动，即便一开始在切换造影体位之前，摇杆推进方向和影像保持一致，但如果在切换造影体位后不进行校准，摇杆推进方向和影像中的导管推进方向仍存在偏差。发明内容为了解决上述问题，本发明提出了一种导管控制方向与影像动作方向的一致性校准方法及系统，当切换造影体位后，准确计算校准偏移角度，保证摇杆控制方向与影像平面中运动方向的一致。为了实现上述目的，本发明采用如下技术方案：第一方面，本发明提供一种导管控制方向与影像动作方向的一致性校准方法，包括：接收校准开始指令；根据导管弯曲前后钢丝牵拉长度增量值，确定影像中导管的当前弯曲深度，根据当前弯曲深度和弯曲深度目标值确定弯曲深度增量值，以此控制导管弯曲至弯曲深度目标值；设定每周期的弯曲方向增量旋转角，在弯曲深度目标值下，根据弯曲方向增量旋转角，进行弯曲方向的变化，直至接收到校准结束指令后，完成校准；确定校准完成后弯曲方向的角度值，根据弯曲方向的角度值确定校准偏移角度，以在下一次控制导管弯曲方向时，将控制方向的角度值和校准偏移角度相加作为最终的控制方向。作为可选择的实施方式，所述钢丝牵拉长度增量值为：根据控制导管弯曲的电机尾部编码器值与钢丝牵拉长度增量值的比例关系，得到钢丝牵拉长度增量值。作为可选择的实施方式，所述钢丝牵拉长度增量值为：=K*；其中，K为电机尾部编码器值与钢丝牵拉长度增量值的换算比例；Valuecoder为电机尾部当前编码器值；InitValuecoder为电机尾部初始编码器值。作为可选择的实施方式，所述当前弯曲深度为：；其中，/＞为当前弯曲深度；/＞为当前的弯曲方向角度值；/＞为第一钢丝牵拉长度增量值；/＞为导管半径。作为可选择的实施方式，通过弯曲方向增量旋转角，控制导管沿顺时针执行弯曲方向在0到360°间的变化，直至在影像中的导管在前进方向的右侧呈现最大弯曲，此时校准结束。作为可选择的实施方式，所述弯曲方向的角度值为：；其中，/＞为第一钢丝牵拉长度增量值，为第二钢丝牵拉长度增量值。作为可选择的实施方式，所述校准偏移角度为在影像中观察到在右侧呈现最大弯曲时的弯曲方向的角度值除以360取余数。第二方面，本发明提供一种导管控制方向与影像动作方向的一致性校准系统，包括：指令接收模块，被配置为接收校准开始指令；弯曲深度控制模块，被配置为根据导管弯曲前后钢丝牵拉长度增量值，确定影像中导管的当前弯曲深度，根据当前弯曲深度和弯曲深度目标值确定弯曲深度增量值，以此控制导管弯曲至弯曲深度目标值；弯曲方向控制模块，被配置为设定每周期的弯曲方向增量旋转角，在弯曲深度目标值下，根据弯曲方向增量旋转角，进行弯曲方向的变化，直至接收到校准结束指令后，完成校准；校准模块，被配置为确定校准完成后弯曲方向的角度值，根据弯曲方向的角度值确定校准偏移角度，以在下一次控制导管弯曲方向时，将控制方向的角度值和校准偏移角度相加作为最终的控制方向。第三方面，本发明提供一种电子设备，包括存储器和处理器以及存储在存储器上并在处理器上运行的计算机指令，所述计算机指令被处理器运行时，完成第一方面所述的方法。第四方面，本发明提供一种计算机可读存储介质，用于存储计算机指令，所述计算机指令被处理器执行时，完成第一方面所述的方法。与现有技术相比，本发明的有益效果为：本发明提出一种导管控制方向与影像动作方向的一致性校准方法及系统，增加平面校准功能，当切换造影体位后，执行校准流程，当在影像中观察到导管末端在前进方向的右侧呈现最大弯曲时，结束校准流程，记录校准偏移角度，参与到后续摇杆控制方向与影像平面中运动方向保证一致的运动控制过程中，准确计算校准偏移角度，实现在切换投影平面后，保证操作的手眼协调。本发明附加方面的优点将在下面的描述中部分给出，部分将从下面的描述中变得明显，或通过本发明的实践了解到。附图说明构成本发明的一部分的说明书附图用来提供对本发明的进一步理解，本发明的示意性实施例及其说明用于解释本发明，并不构成对本发明的不当限定。图1为本发明实施例1提供的万向摇杆的动作范围示意图；图2为本发明实施例1提供的导管控制方向与影像动作方向的一致性校准方法流程示意图；图3为本发明实施例1提供的导管在前进方向的右侧呈现最大弯曲的示意图。具体实施方式下面结合附图与实施例对本发明做进一步说明。应该指出，以下详细说明都是示例性的，旨在对本发明提供进一步的说明。除非另有指明，本文使用的所有技术和科学术语具有与本发明所属技术领域的普通技术人员通常理解的相同含义。需要注意的是，这里所使用的术语仅是为了描述具体实施方式，而非意图限制根据本发明的示例性实施方式。如在这里所使用的，除非上下文另外明确指出，否则单数形式也意图包括复数形式，此外，还应当理解的是，术语“包括”和“具有”以及他们的任何变形，意图在于覆盖不排他的包含，例如，包含了一系列步骤或单元的过程、方法、系统、产品或设备不必限于清楚地列出的那些步骤或单元，而是可包括没有清楚地列出的或对于这些过程、方法、产品或设备固有的其它步骤或单元。在不冲突的情况下，本发明中的实施例及实施例中的特征可以相互组合。实施例1本实施例提供一种导管控制方向与影像动作方向的一致性校准方法，包括：接收校准开始指令；根据导管弯曲前后钢丝牵拉长度增量值，确定影像中导管的当前弯曲深度，根据当前弯曲深度和弯曲深度目标值确定弯曲深度增量值，以此控制导管弯曲至弯曲深度目标值；设定每周期的弯曲方向增量旋转角，在弯曲深度目标值下，根据弯曲方向增量旋转角，进行弯曲方向的变化，直至接收到校准结束指令后，完成校准；确定校准完成后弯曲方向的角度值，根据弯曲方向的角度值确定校准偏移角度，以在下一次控制导管弯曲方向时，将控制方向的角度值和校准偏移角度相加作为最终的控制方向。在本实施例中，采用万向摇杆控制导管弯曲，万向摇杆的动作范围如图1中所示的圆，其中，对应X轴正方向为弯曲方向0°位置；当万向摇杆往0°方向控制时，导管末端在透视影像平面内沿着前进方向的右侧弯曲；当万向摇杆往180°方向弯曲时，导管末端在透视影像平面内沿着前进方向的左侧弯曲；当万向摇杆往90°方向弯曲时，导管末端在垂直于透视影像平面的平面上沿着前进方向的右侧弯曲；当万向摇杆往270°方向弯曲时，导管末端在垂直于透视影像平面的平面上沿着前进方向的左侧弯曲；其他以此类推。因此，在切换透视影像平面后，不能满足上述条件时，可以在原本下发的摇杆控制信号的基础上，加上校准偏移角度即可得到上述响应结果。在本实施例中，导管内均匀分布三根钢丝，三者呈120°夹角，对应有三个电机牵拉三根钢丝呈现不同的长度，从而形成末端不同的弯曲效果。当每切换一个投影平面后，发送校准指令，自动执行校准程序，也可设定循环周期。如图2所示，导管控制方向与影像动作方向的一致性校准方法流程具体如下：步骤1：监测校准指令信号；根据校准指令信号的变化，执行对应的步骤；步骤2：判断校准指令信号是否是由0-＞1；当校准指令信号发生0-＞1的变化时，执行以下步骤：步骤2.1：令校准偏移角度为0°；清除之前记录的校准偏移角度，用以重新计算。步骤2.2：计算当前弯曲深度；因为如果要在透视影像中观察到导管末端的弯曲方向，则需要导管末端呈现一定的弯曲深度，而不是保持竖直状态，因此需要计算当前的弯曲深度；具体为：首先，根据控制导管弯曲的电机尾部编码器值与钢丝牵拉后长度的比例关系，得到其中两根钢丝牵拉长度增量值：=K*；=K*；其中，L1、L2为相对于初始状态钢丝牵拉长度增量值，单位mm；K为电机尾部编码器值与钢丝牵拉长度增量值的换算比例，Valuecoder为电机尾部当前编码器值，InitValuecoder为电机尾部初始编码器值，初始位置即校准开始前导管保持垂直伸展状态时每根钢丝的电机所在的编码器值。然后，根据钢丝牵拉长度增量值得到导管末端当前的弯曲方向角度值和当前弯曲深度；；；其中，为当前的弯曲方向角度值，在正右侧是0度的情况下；/＞为当前的弯曲深度；/＞为第一钢丝牵拉长度增量值，/＞为第二钢丝牵拉长度增量值，且由于三根钢丝呈现120度均匀分布，在已知两根钢丝牵拉长度情况下可推导出第三根钢丝的牵拉长度情况；为导管半径。步骤2.3：根据当前弯曲深度和弯曲深度目标值确定弯曲深度增量值；在校准过程中，需要将导管末端弯曲至90°，以便于观察弯曲方向的情况，因此本实施例将弯曲深度目标值设为90°，则弯曲深度增量值=90°-当前弯曲深度。步骤2.4：根据钢丝牵拉导管末端弯曲模型进行倒推，将弯曲深度增量值转化为三个电机所需变化的目标位置下发给相应电机，执行动作，以达到导管末端弯曲深度达到90°的目的。步骤2.5：将校准状态设为第一阶段；其中，校准状态有三种状态；具体为：第一阶段是在接收到校准指令时；第二阶段是在执行完弯曲深度为90°的目标，用于标识校准程序进入弯曲方向360°循环改变的运动状态；未校准阶段是在校准结束时。步骤3：若校准指令信号不是由0-＞1的变化，则判断校准信号为1且本周期没有发生0到1的变化，若满足该条件，执行以下步骤：步骤3.1：校准状态是否是第一阶段；因为导管弯曲到90°是需要时间的，因此在校准指令信号等于1的情况下，要确认校准执行的情况，用于判断当前应该继续改变弯曲深度还是弯曲方向。步骤3.2：如果校准状态是第一阶段，则说明导管还未弯曲到90°，需继续计算当前弯曲深度，过程同步骤2.2；若校准状态为第二阶段，则执行步骤3.5；步骤3.3：判断当前弯曲深度是否在90°±1°范围内；如果不是的话，则需继续执行步骤3.2，直至导管弯曲到90°；步骤3.4：若满足步骤3.3，则令校准状态为第二阶段，代表弯曲深度已达到校准程序所需的90°附近，执行步骤3.5；步骤3.5：设定每周期的弯曲方向增量旋转角；本步骤的目的是让耗材末端在保持可清晰观察的弯曲深度的情况下，沿着顺时针执行弯曲方向在0到360°之间的变化，直到在透视影像平面中观察到导管在前进方向的右侧呈现最大弯曲，如图3所示，此时便于使用者观察，结束校准，校准结束后得出校准偏移角度。作为可选择的一种实施方式，每个周期的弯曲方向增量旋转角可设为：360°/=0.24°。步骤3.6：将弯曲方向增量旋转角转化为三个电机所需变化的目标位置下发给相应电机，执行动作；其中，需要下发给电机执行的弯曲方向为当前弯曲方向与弯曲方向增量旋转角的和，弯曲深度为弯曲深度目标值。步骤4：当校准指令信号由1-＞0时，执行以下步骤：步骤4.1：采用步骤2.2的方法计算执行完步骤3.6后的弯曲方向角度值；步骤4.2：校准指令信号发生1-＞0的跳变，表示操作者在透视影像导管的前进方向的右侧观察到最大弯曲，此时校准结束，将步骤4.1计算得到的弯曲方向角度值%360作为校准偏移角度。步骤4.3：令校准状态为未校准；更新校准状态标识，便于下次执行校准。步骤4.4：在下一次控制导管弯曲方向时，将控制方向的角度值和校准偏移角度相加作为最终的控制方向，实现摇杆的控制方向和透视影像下的动作方向保持一致。实施例2本实施例提供一种导管控制方向与影像动作方向的一致性校准系统，包括：指令接收模块，被配置为接收校准开始指令；弯曲深度控制模块，被配置为根据导管弯曲前后钢丝牵拉长度增量值，确定影像中导管的当前弯曲深度，根据当前弯曲深度和弯曲深度目标值确定弯曲深度增量值，以此控制导管弯曲至弯曲深度目标值；弯曲方向控制模块，被配置为设定每周期的弯曲方向增量旋转角，在弯曲深度目标值下，根据弯曲方向增量旋转角，进行弯曲方向的变化，直至接收到校准结束指令后，完成校准；校准模块，被配置为确定校准完成后弯曲方向的角度值，根据弯曲方向的角度值确定校准偏移角度，以在下一次控制导管弯曲方向时，将控制方向的角度值和校准偏移角度相加作为最终的控制方向。此处需要说明的是，上述模块对应于实施例1中所述的步骤，上述模块与对应的步骤所实现的示例和应用场景相同，但不限于上述实施例1所公开的内容。需要说明的是，上述模块作为系统的一部分可以在诸如一组计算机可执行指令的计算机系统中执行。在更多实施例中，还提供：一种电子设备，包括存储器和处理器以及存储在存储器上并在处理器上运行的计算机指令，所述计算机指令被处理器运行时，完成实施例1中所述的方法。为了简洁，在此不再赘述。应理解，本实施例中，处理器可以是中央处理单元CPU，处理器还可以是其他通用处理器、数字信号处理器DSP、专用集成电路ASIC，现成可编程门阵列FPGA或者其他可编程逻辑器件、分立门或者晶体管逻辑器件、分立硬件组件等。通用处理器可以是微处理器或者该处理器也可以是任何常规的处理器等。存储器可以包括只读存储器和随机存取存储器，并向处理器提供指令和数据、存储器的一部分还可以包括非易失性随机存储器。例如，存储器还可以存储设备类型的信息。一种计算机可读存储介质，用于存储计算机指令，所述计算机指令被处理器执行时，完成实施例1中所述的方法。实施例1中的方法可以直接体现为硬件处理器执行完成，或者用处理器中的硬件及软件模块组合执行完成。软件模块可以位于随机存储器、闪存、只读存储器、可编程只读存储器或者电可擦写可编程存储器、寄存器等本领域成熟的存储介质中。该存储介质位于存储器，处理器读取存储器中的信息，结合其硬件完成上述方法的步骤。为避免重复，这里不再详细描述。本领域普通技术人员可以意识到，结合本实施例描述的各示例的单元即算法步骤，能够以电子硬件或者计算机软件和电子硬件的结合来实现。这些功能究竟以硬件还是软件方式来执行，取决于技术方案的特定应用和设计约束条件。专业技术人员可以对每个特定的应用来使用不同方法来实现所描述的功能，但是这种实现不应认为超出本申请的范围。上述虽然结合附图对本发明的具体实施方式进行了描述，但并非对本发明保护范围的限制，所属领域技术人员应该明白，在本发明的技术方案的基础上，本领域技术人员不需要付出创造性劳动即可做出的各种修改或变形仍在本发明的保护范围以内。
