标题title
一种基于时间窗的COPD急性加重预测方法
摘要abst
本发明公开了一种基于时间窗的COPD急性加重预测方法，S1、利用小肺仪，电子听诊器等设备收集患者每日两次的肺部指标；S2、为了支持的模型可以预测T+1，T+2，T+3天，且为了保持模型的易用性；S3、根据上述特征提取更多特征，这些特征能够反映患者的肺部监控指标的变化情况；S4、将一次病情加重作为一个正样本；S5、对特征进行显著性检验；S6、使用上述235个显著性特征作为模型输入其参数，预测T+d日是否加重，使用一个时间窗的肺部监测数据对患者是否有COPD急性加重风险进行预测，患者可以居家就能自我监控，对COPD患者居家照顾有重要意义。
权利要求书clms
1.一种基于时间窗的COPD急性加重预测方法，其特征在于，该预测方法包括如下步骤：S1、利用小肺仪，电子听诊器等设备收集患者每日两次的肺部指标，如FVC，FEV1，听诊器收集的肺部震动的能量最大值，所述FVC采用仪器“小肺仪”，获取用力肺活量，是指尽力最大吸气后，尽力尽快呼气所能呼出的最大气量；所述FEV1采用仪器“小肺仪”，获取最大深吸气后做最大呼气，最大呼气第一秒呼出的气量的容积；所述PEF采用仪器“小肺仪”，获取指用力肺活量测定过程中，呼气流量最快时的瞬间流速；S2、为了支持的模型可以预测T+1，T+2，T+3天，且为了保持模型的易用性，使用固定的时间窗口的患者肺部监控指标进行预测，通过电子设备收集患者每日早晨和晚上的32种指标，将五日时间窗的这些指标区分日期和是否早晨，则特征数量为32×7×2＝448个；S3、根据上述特征提取更多特征，这些特征能够反映患者的肺部监控指标的变化情况；数据扩充包括：指标滑窗统计量；隔日指标差值；S4、将一次病情加重作为一个正样本；对于负样本，规定时间窗不能包括急性发作时期的前后30天，以防止病情对监控指标造成影响；负样本由数据中采样所有能够连续观测的7天的数据生成；S5、对特征进行显著性检验，发现有235个特征对T+d日是否加重有显著相关性；S6、使用上述235个显著性特征作为模型输入其参数，预测T+d日是否加重；所述模型采用基于决策树的集成模型：xgboost、lightgbm以及catboost，并采用5折交叉验证对模型效果进行评估。2.根据权利要求1所述的一种基于时间窗的COPD急性加重预测方法，其特征在于：所述XGBoost模型的解释方法，包括以下步骤：对XGBoost模型进行树模型元结构解析，以解析出每个单棵树的树结构；对所述XGBoost模型输入测试样本，根据树结构获取所述测试样本对应的有效叶子节点以及有效叶子节点的树的有效路径；根据有效路径计算出特征的贡献值，并根据获取到的贡献值对所述XGBoost模型进行解释。3.根据权利要求1所述的一种基于时间窗的COPD急性加重预测方法，其特征在于：所述XGBoost利用的是Boosting集成方法，大量用于数据挖掘，XGBoost可对缺失值进行处理、将特征正则化，从而实现对代价函数二阶加速优化的功能。4.根据权利要求1所述的一种基于时间窗的COPD急性加重预测方法，其特征在于：所述LightGBM是一种新的梯度提升树框架，支持GBDT、GBRT、GBM以及MART的算法，所述LightGBM是基于DMTK框架的分布式培训的完整解决方案。5.根据权利要求1所述的一种基于时间窗的COPD急性加重预测方法，其特征在于：所述Catboost算法包括：在感知周期内，次用户把感知到的信道中能量值发送到融合中心作为特征能量向量，主用户间断性发送占用频谱资源与否的信息给融合中心作为标签，这样完成了训练数据集的构建。在融合中心中用Catboost算法训练模型。6.根据权利要求1所述的一种基于时间窗的COPD急性加重预测方法，其特征在于：所述Catboost算法由Yandex提出，Catboost算法优化了类别特征的处理，并且是在训练阶段处理而不是数据预处理阶段，在选择树模型的时候计算叶子节点值，减少过拟合。7.根据权利要求1所述的一种基于时间窗的COPD急性加重预测方法，其特征在于：预测期时长以八天为一个时间窗截取正样本，这八天记为，对于正样本，第T天为急性加重发作开始日期；对于负样本，规定时间窗不能包括急性发作时期的前后7天。8.根据权利要求7所述的一种基于时间窗的COPD急性加重预测方法，其特征在于：所述预测期为了达到提前预警的作用，提前设置3组预测任务：Task_1，采用T-5天到T-1天的观察值，预测第T天是否急性加重；Task_2，采用T-6天到T-2天的观察值，预测第T天是否急性加重；Task_3，采用T-7天到T-3天的观察值，预测第T天是否急性加重。9.根据权利要求1所述的一种基于时间窗的COPD急性加重预测方法，其特征在于：为减少特征数量，对特征做Kolmogorov-Smirnov检验，该检验可以比较两个分布是否相同，再将每个特征在正样本上的分布和负样本上的分布做检验，取置信度0.05。
说明书desc
技术领域本发明涉及COPD急性加重预测技术领域，具体涉及一种基于时间窗的COPD急性加重预测方法。背景技术慢性阻塞性肺疾病是一种慢性支气管炎、引起肺泡结构损伤的疾病的肺气肿、或者两者出现的混合并且从支气管到肺泡的气道关闭的疾病；这种疾病的症状包括：长期咳嗽带痰、由于气道阻塞引起的空气流速下降而导致的呼吸困难以及常见的呼吸道感染；这种疾病在全球造成了高死亡率，并且由于吸烟、空气污染等迅速增加；COPD的病因是肺对有毒分子或气体以及复杂地参与了COPD的各种因素的异常的慢性炎症反应。临床参数的组合已经被用于预测患者的COPD急性加重；但是，这些临床参数不足以准确适用于各个病例的预测；此外，尽管COPD患者由于上述因素在去医院后可能会出现急性加重的可能性，但是COPD患者无法预测他们自己的急性加重的可能性；因此，COPD患者在COPD急性加重发生后去医院可能会导致不良结果。目前虽然已有文献使用统计学或机器学习手段对COPD急性加重事件进行预测，但是目前本领域文献的缺陷如下：1、现有研究主要还是横截面数据，未能使用时间序列数据对患者的COPD急性加重事件进行实时预警；2、目前的研究没有进行系统的特征挖掘，提升模型的预测能力；3、目前的研究无法做出T+1，T+2，T+3的预测，现有模型只能预测患者未来加重的风险概率。发明内容本发明的目的在于提供一种基于时间窗的COPD急性加重预测方法，使用一个时间窗的肺部监测数据对患者是否有COPD急性加重风险进行T+d日预测，患者可以居家就能自我监控，自我预警，操作简单，这对COPD患者居家照顾有重要意义，以解决上述背景技术中提出的问题。为实现上述目的，本发明提供如下技术方案：一种基于时间窗的COPD急性加重预测方法，包括如下步骤：S1、利用小肺仪，电子听诊器等设备收集患者每日两次的肺部指标，如FVC，FEV1，听诊器收集的肺部震动的能量最大值，所述FVC采用仪器“小肺仪”，获取用力肺活量，是指尽力最大吸气后，尽力尽快呼气所能呼出的最大气量；所述FEV1采用仪器“小肺仪”，获取最大深吸气后做最大呼气，最大呼气第一秒呼出的气量的容积；所述PEF采用仪器“小肺仪”，获取指用力肺活量测定过程中，呼气流量最快时的瞬间流速；S2、为了支持的模型可以预测T+1，T+2，T+3天，且为了保持模型的易用性，使用固定的时间窗口的患者肺部监控指标进行预测，通过电子设备收集患者每日早晨和晚上的32种指标，将五日时间窗的这些指标区分日期和是否早晨，则特征数量为32×7×2＝448个；S3、根据上述特征提取更多特征，这些特征能够反映患者的肺部监控指标的变化情况；数据扩充包括：指标滑窗统计量，如3日均值/方差，5日均值/方差；隔日指标差值；扩充后特征数有1744个；S4、将一次病情加重作为一个正样本；对于负样本，规定时间窗不能包括急性发作时期的前后30天，以防止病情对监控指标造成影响；负样本由数据中采样所有能够连续观测的7天的数据生成；S5、对特征进行显著性检验，发现有235个特征对T+d日是否加重有显著相关性；S6、使用上述235个显著性特征作为模型输入其参数，预测T+d日是否加重；所述模型采用基于决策树的集成模型：xgboost、lightgbm以及catboost，并采用5折交叉验证对模型效果进行评估。优选的，所述XGBoost模型的解释方法，包括以下步骤：对XGBoost模型进行树模型元结构解析，以解析出每个单棵树的树结构；对所述XGBoost模型输入测试样本，根据树结构获取所述测试样本对应的有效叶子节点以及有效叶子节点的树的有效路径；根据有效路径计算出特征的贡献值，并根据获取到的贡献值对所述XGBoost模型进行解释。优选的，所述XGBoost利用的是Boosting集成方法，大量用于数据挖掘，XGBoost可对缺失值进行处理、将特征正则化，从而实现对代价函数二阶加速优化的功能。优选的，所述LightGBM是一种新的梯度提升树框架，支持GBDT、GBRT、GBM以及MART的算法，所述LightGBM是基于DMTK框架的分布式培训的完整解决方案。优选的，所述Catboost算法包括：在感知周期内，次用户把感知到的信道中能量值发送到融合中心作为特征能量向量，主用户间断性发送占用频谱资源与否的信息给融合中心作为标签，这样完成了训练数据集的构建。在融合中心中用Catboost算法训练模型。优选的，所述Catboost算法由Yandex提出，Catboost算法优化了类别特征的处理，并且是在训练阶段处理而不是数据预处理阶段，在选择树模型的时候计算叶子节点值，减少过拟合。优选的，预测期时长以八天为一个时间窗截取正样本，这八天记为，对于正样本，第T天为急性加重发作开始日期；对于负样本，规定时间窗不能包括急性发作时期的前后7天。优选的，所述预测期为了达到提前预警的作用，提前设置3组预测任务：Task_1，采用T-5天到T-1天的观察值，预测第T天是否急性加重；Task_2，采用T-6天到T-2天的观察值，预测第T天是否急性加重；Task_3，采用T-7天到T-3天的观察值，预测第T天是否急性加重。优选的，为减少特征数量，对特征做Kolmogorov-Smirnov检验，该检验可以比较两个分布是否相同，再将每个特征在正样本上的分布和负样本上的分布做检验，取置信度0.05。综上所述，由于采用了上述技术，本发明的有益效果是：1.本发明可以对T+d日是否有copd急性加重进行预测预警，使用一个时间窗的肺部监测数据对患者是否有COPD急性加重风险进行T+d日预测；2.本发明通过特征工程，相对于只使用原检测指标值，数据构造方法：正负样本的选取，结合了数据采样与医学知识，模型效果有显著提升；3.本发明的模型实用性高，患者可以居家就能自我监控，自我预警，操作简单，这对COPD患者居家照顾有重要意义。附图说明图1为本发明的模型构建流程图；图2为本发明的Task_1设定下基于LightGBM的五个模型的ROC曲线；图3为本发明的Task_2设定下基于LightGBM的五个模型的ROC曲线。具体实施方式为使本发明实施方式的目的、技术方案和优点更加清楚，下面将结合本发明实施方式中的附图，对本发明实施方式中的技术方案进行清楚、完整地描述，显然，所描述的实施方式是本发明一部分实施方式，而不是全部的实施方式；基于本发明中的实施方式，本领域普通技术人员在没有作出创造性劳动前提下所获得的所有其他实施方式，都属于本发明保护的范围；因此，以下对在附图中提供的本发明的实施方式的详细描述并非旨在限制要求保护的本发明的范围，而是仅仅表示本发明的选定实施方式；基于本发明中的实施方式，本领域普通技术人员在没有作出创造性劳动前提下所获得的所有其他实施方式，都属于本发明保护的范围；本发明提供了如图1-3所示的一种基于时间窗的COPD急性加重预测方法，包括如下步骤：S1、利用小肺仪，电子听诊器等设备收集患者每日两次的肺部指标，如FVC，FEV1，听诊器收集的肺部震动的能量最大值，所述FVC采用仪器“小肺仪”，获取用力肺活量，是指尽力最大吸气后，尽力尽快呼气所能呼出的最大气量；所述FEV1采用仪器“小肺仪”，获取最大深吸气后做最大呼气，最大呼气第一秒呼出的气量的容积；所述PEF采用仪器“小肺仪”，获取指用力肺活量测定过程中，呼气流量最快时的瞬间流速，；S2、为了支持的模型可以预测T+1，T+2，T+3天，且为了保持模型的易用性，使用固定的时间窗口的患者肺部监控指标进行预测，通过电子设备收集患者每日早晨和晚上的32种指标，将五日时间窗的这些指标区分日期和是否早晨，则特征数量为32×7×2＝448个；S3、根据上述特征提取更多特征，这些特征能够反映患者的肺部监控指标的变化情况；数据扩充包括：指标滑窗统计量，如3日均值/方差，5日均值/方差；隔日指标差值；扩充后特征数有1744个；S4、将一次病情加重作为一个正样本；对于负样本，规定时间窗不能包括急性发作时期的前后30天，以防止病情对监控指标造成影响；负样本由数据中采样所有能够连续观测的7天的数据生成；S5、对特征进行显著性检验，发现有235个特征对T+d日是否加重有显著相关性；S6、使用上述235个显著性特征作为模型输入其参数，预测T+d日是否加重；所述模型采用基于决策树的集成模型：xgboost、lightgbm以及catboost，并采用5折交叉验证对模型效果进行评估。具体的，所述XGBoost模型的解释方法，包括以下步骤：对XGBoost模型进行树模型元结构解析，以解析出每个单棵树的树结构；对所述XGBoost模型输入测试样本，根据树结构获取所述测试样本对应的有效叶子节点以及有效叶子节点的树的有效路径；根据有效路径计算出特征的贡献值，并根据获取到的贡献值对所述XGBoost模型进行解释。具体的，所述XGBoost利用的是Boosting集成方法，大量用于数据挖掘，XGBoost可对缺失值进行处理、将特征正则化，从而实现对代价函数二阶加速优化的功能。具体的，所述LightGBM是一种新的梯度提升树框架，支持GBDT、GBRT、GBM以及MART的算法，由于其完全贪婪的树木生长方法和基于直方图的内存和计算优化，LightGBM比现有的梯度增强树实现要快几倍，所述LightGBM是基于DMTK框架的分布式培训的完整解决方案，在LightGBM出现后，迅速成为了数据挖掘竞赛选手的常用工具。具体的，所述Catboost算法包括：在感知周期内，次用户把感知到的信道中能量值发送到融合中心作为特征能量向量，主用户间断性发送占用频谱资源与否的信息给融合中心作为标签，这样完成了训练数据集的构建。在融合中心中用Catboost算法训练模型。具体的，所述Catboost算法由Yandex提出，Catboost算法优化了类别特征的处理，并且是在训练阶段处理而不是数据预处理阶段，在选择树模型的时候计算叶子节点值，减少过拟合。具体的，预测期时长以八天为一个时间窗截取正样本，这八天记为，对于正样本，第T天为急性加重发作开始日期；对于负样本，规定时间窗不能包括急性发作时期的前后7天。具体的，所述预测期为了达到提前预警的作用，提前设置3组预测任务：Task_1，采用T-5天到T-1天的观察值，预测第T天是否急性加重；Task_2，采用T-6天到T-2天的观察值，预测第T天是否急性加重；Task_3，采用T-7天到T-3天的观察值，预测第T天是否急性加重。具体的，为减少特征数量，对特征做Kolmogorov-Smirnov检验，该检验可以比较两个分布是否相同，再将每个特征在正样本上的分布和负样本上的分布做检验，取置信度0.05。表1：观察值特征名称及其解释；表2.通过显著性检验的前五十个特征及其P值打分；使用k折层次交叉验证，将数据分为5折，每次按8：2划分为训练集和测试集对模型进行训练与测试。验证指示评价指标为敏感性、特异性和AUC，其中阈值是使得敏感性超过0.9的最小阈值，特异性为当前阈值下的特异性。使用的模型为catboost、xgboost和lightgbm，其他超参数采用交叉验证进行超参数搜索得到；设定三种任务：Task_1，Task_2，Task_3，在每一种任务下，设置5种模型：M_all，采用所有特征进行训练；M_sig，采用所有通过显著性检验的特征；M_sigSTE，采用通过显著性检验的电子听诊器相关特征；M_sigLSI，采用通过显著性检验的小肺仪特征；M_sig50，采用本任务设定下通过显著性检验的p值最低的前50个特征；M_sig25，采用通过显著性检验的前25特征；M_orig，采用所有原始观测指标进行训练。Task_1Task_2Task_3M_all0.81350.81350.8135M_sig0.92680.90450.8887M_sigSTE0.90200.88450.8302M_sigLSI0.82790.71580.6617M_sig500.88260.80000.8631M_sig250.81730.80750.8816M_orig0.73610.74340.5782表3.交叉验证的AUC平均分数；Task_1设定下，显著特征为123个，其中通过显著性检验的小肺仪特征有31个，电子听诊器有92个。Task_2设定下，显著特征为134个，其中通过显著性检验的小肺仪特征有33个，电子听诊器有101个。Task_3设定下，显著特征为131个，其中通过显著性检验的小肺仪特征有28个，电子听诊器有103个。表3报告交叉验证的AUC平均分，其中采用的模型是LightGBM。Task_1能够得到更高的分数，这与直观理解一致；只是用小肺仪产生的特征，分数下降很明显，而只用听诊器产生的特征仍然有较好的表现，说明电子听诊器观测数据具有更强的判别预测作用；采用显著性检验筛选特征，比直接使用原始观测值或者全部特征都要有明显提升；采用显著性前50的特征或者前25的特征，模型得分会有一定的下降，说明减少特征个数后模型拟合能力下降。如图1所示的Task_1设定下基于LightGBM的五个模型的ROC曲线；表3报告交叉验证的AUC平均分，其中采用的模型是LightGBM。为了验证在其他模型下的表现，下面我们给出在xgboost或catboost模型下的效果：Task_1Task_2Task_3M_all0.87720.86730.8142M_sig0.91810.89460.8233M_sigSTE0.90360.87920.8110M_sigLSI0.82790.76100.7000M_sig500.83720.78310.8184M_sig250.81770.80470.8203M_orig0.78120.78810.6659表3-1.交叉验证的AUC平均分数。采用模型是xgboost。表3-2.交叉验证的AUC平均分数。采用模型是catboost。敏感性特异性概率阈值Task_1M_sig500.90430.73450.0113Task_2M_sig500.90430.70980.0091Task_3M_sig500.90430.66230.0042表4.每个任务设定下最优模型M_sig的敏感性与特异性值。为了验证不同的决策树模型对我们预测任务的表现的影响，下表汇报了三种任务设定下，采用显著特征的模型表现，我们对比了Xgboost、Lightgbm和Catboost，这三种最强大的基于决策树模型的梯度提升算法，根据实验结果，Lightgbm在我们的三种任务设定下都是表现最好的。LightgbmCatboostXgboostTask_1M_sig0.92680.88520.9181Task_2M_sig0.90450.85050.8946Task_3M_sig0.88870.87220.8233表5.每个任务设定下以最有特征组合M_sig为基础的，三类决策树集成模型Catboost，Lightgbm，Xgboost的交叉验证平均AUC。实施例2在task1上，使用Lightgbm模型，进行五折交叉验证，每折上的AUC表现如下:在task2上，使用Lightgbm模型，进行五折交叉验证，每折上的AUC表现如下:在task3上，使用Lightgbm模型，进行五折交叉验证，每折上的AUC表现如下:实施例3在task1上，使用Lightgbm模型，进行五折交叉验证，平均的ACC，precision，recall，f1，auc等分数如下:表5.task1上交叉验证的各种指标平均分数。在task2上，使用Lightgbm模型，进行五折交叉验证，平均的ACC，precision，recall，f1，auc等分数如下:AUCACCprecisionrecallF1M_all0.81350.86940.54150.71420.5475M_sig0.90450.86650.53650.91420.6441M_sigSTE0.88450.91080.67580.57140.6112M_sigLSI0.71580.75090.29690.74280.4028M_sig500.80000.88070.49880.62430.5275M_sig250.80750.89500.49020.65710.5322M_orig0.74340.84230.71070.60.5572表6.Task2上交叉验证的各种指标平均分数。在task3上，使用Lightgbm模型，进行五折交叉验证，平均的ACC，precision，recall，f1，auc等分数如下:表7.Task3上交叉验证的各种指标平均分数。以上所述，仅为本发明较佳的具体实施方式，但本发明的保护范围并不局限于此，任何熟悉本技术领域的技术人员在本发明揭露的技术范围内，根据本发明的技术方案及其发明构思加以等同替换或改变，都应涵盖在本发明的保护范围之内。需要说明的是，在本文中，诸如第一和第二等之类的关系术语仅仅用来将一个实体或者操作与另一个实体或操作区分开来，而不一定要求或者暗示这些实体或操作之间存在任何这种实际的关系或者顺序；而且，术语“包括”、“包含”或者其任何其他变体意在涵盖非排他性的包含，从而使得包括一系列要素的过程、方法、物品或者设备不仅包括那些要素，而且还包括没有明确列出的其他要素，或者是还包括为这种过程、方法、物品或者设备所固有的要素。
