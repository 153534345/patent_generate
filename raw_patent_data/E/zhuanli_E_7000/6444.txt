标题title
一种矿井下主斜坡道信号灯控制方法
摘要abst
本发明公开了一种矿井下主斜坡道信号灯控制方法，其利用UWB定位技术通过基于地图上绘制电子围栏的方式对矿井下主斜坡道信号灯进行控制。采用该方法，可以很方便地对矿井下主斜坡道信号灯进行自动控制，大大降低矿井下主斜坡道交通堵塞发生的概率，有效提高了运矿车通行效率，从而提升了矿山企业生产效益。
权利要求书clms
1.一种矿井下主斜坡道信号灯控制方法，其特征在于：配置有矿井交通控制器、围栏缓存、灯面状态缓存、灯面序号缓存、序号信号灯对应缓存、灯下待行车辆缓存、锁定信号灯缓存、运矿车辆缓存、车辆经过上次信号灯缓存以及锁灯个数缓存；所述矿井交通控制器在判断车辆是运矿车且判断车辆是下行进入电子围栏情况下，从围栏缓存中查找当前进入围栏对应的灯面信息并根据灯面序号缓存得到灯面的序号，执行车辆下行变灯步骤S1021；所述车辆下行变灯步骤S1021分为车辆下行锁灯步骤S10211和车辆下行解灯步骤S10212；所述车辆下行锁灯步骤S10211由灯面的序号根据序号信号灯对应缓存得到欲锁信号灯IP，由欲锁信号灯IP根据锁定信号灯缓存判断该欲锁信号灯是否被锁定，如果该欲锁信号灯没有锁定，执行车辆下行信号灯未锁定处理步骤S102111，如果该欲锁信号灯被锁定，执行车辆下行信号灯已锁定处理步骤S102112；所述车辆下行信号灯未锁定处理步骤S102111为将当前车辆定位信标号加入到欲锁信号灯的灯下待行车辆缓存中，将欲锁信号灯IP记录进锁定信号灯缓存中，同时将欲锁信号灯的A面置绿闪烁，B面置红灯，同时执行车辆下行循环锁灯处理步骤S102113；车辆下行信号灯已锁定处理步骤S102112为进一步判断已锁定方向是否和当前车辆行驶方向一致，如果欲锁信号灯的已锁定方向和当前车辆行驶方向一致，将当前车辆定位信标号加入到该欲锁信号灯的灯下待行车辆缓存中，同时执行车辆下行循环锁灯处理步骤S102113；如果欲锁信号灯的锁定方向和当前车辆行驶方向不一致，进一步判断锁定面和当前车辆进入围栏对应的灯面是否一致，如果锁定面和当前车辆进入围栏对应的灯面一致，并且如果锁定车辆为当前车辆时，则判断车辆发生了正常掉头，遍历所有信号灯，将当前车辆锁定的所有信号灯解锁，同时执行车辆下行循环锁灯处理步骤S102113；如果锁定车辆不是当前车辆，则判断车辆发生了违规掉头，信号灯为掉头之前后方车辆锁住，则车辆应进入岔路口等候对向车辆通过，同时遍历所有信号灯，将当前车辆锁定的所有信号灯解锁，同时执行车辆下行循环锁灯处理步骤S102113；所述车辆下行循环锁灯处理步骤S102113为根据当前车辆所在的灯面序号，通过下列公式计算得到欲锁信号灯的灯面序号：当前车辆在奇数面时：Num＝CurrentNum+n×2，当前车辆在偶数面时：Num＝CurrentNum+1+2×；Num为欲锁信号灯的灯面序号，CurrentNum为当前车辆所在的灯面序号，n为循环因子，循环次数为从锁灯个数缓存中得到的锁灯个数减1；根据每次计算得到欲锁信号灯的灯面序号再循环执行车辆下行锁灯步骤S10211；所述车辆下行解灯步骤S10213为根据车辆当前进入电子围栏，从围栏缓存中找到当前电子围栏对应灯面，从灯面序号缓存中得到当前灯面对应的序号，如果序号是奇数面，用当前序号减去1得到上一次经过灯面的序号；如果当前面偶数面，用当前序号减去2得到上一次经过灯面的序号；如果序号信号灯对应缓存中存在上次经过灯面的序号，则从已锁定信号灯缓存中查找上一次通行信号灯是否已被解锁，如果已被解锁，则不用处理，否则执行下行信号灯解锁步骤S102131；所述下行信号灯解锁步骤S102131为将车辆定位信标号从需要解锁的灯下待行车辆缓存中进行移除，然后判断信号灯下是否还存在待行车辆，如果还有待行车辆，则不用处理；否则将需要解锁的信号灯IP从锁定信号灯缓存中进行移除，置需要解锁的信号灯两面为绿灯。2.根据权利要求1所述的矿井下主斜坡道信号灯控制方法，其特征在于，所述矿井交通控制器在判断车辆在上行进入电子围栏的情况下，从围栏缓存中查找当前进入围栏对应的灯面信息并根据灯面序号缓存得到灯面的序号，执行车辆上行变灯步骤S1022；所述车辆上行变灯步骤S1022分为车辆上行锁灯步骤S10221和车辆上行解灯步骤S10222；所述车辆上行锁灯步骤S10221为由灯面的序号根据序号信号灯对应缓存得到欲锁信号灯IP，由欲锁信号灯IP根据锁定信号灯缓存判断该欲锁信号灯是否被锁定，如果该欲锁信号灯没有锁定，执行车辆上行信号灯未锁定处理步骤S102211，如果该欲锁信号灯被锁定，执行车辆上行信号灯已锁定处理步骤S102212；所述车辆上行信号灯未锁定处理步骤S102211为将当前车辆定位信标号加入到欲锁信号灯的灯下待行车辆缓存中，将欲锁信号灯IP记录进锁定信号灯缓存中，同时将欲锁信号灯的A面置红灯，B面置绿闪烁，同时执行车辆上行循环锁灯处理步骤S102213；所述车辆上行信号灯已锁定处理步骤S102212为进一步判断已锁定方向是否和当前车辆行驶方向一致。如果欲锁信号灯的已锁定方向和当前车辆行驶方向一致，将当前车辆定位信标号加入到该欲锁信号灯的灯下待行车辆缓存中，同时执行车辆下行循环锁灯处理步骤S102113；如果欲锁信号灯的锁定方向和当前车辆行驶方向不一致，进一步判断锁定面和当前车辆进入围栏对应的灯面是否一致，如果锁定面和当前车辆进入围栏对应的灯面一致，并且如果锁定车辆为当前车辆时，则判断车辆发生了正常掉头，遍历所有信号灯，将当前车辆锁定的所有信号灯进行解锁，同时执行车辆上行循环锁灯处理步骤S102213；如果锁定车辆不是当前车辆，则判断车辆发生了违规掉头，信号灯为掉头之前后方车辆锁住，则车辆应进入岔路口等候对向车辆通过，同时遍历所有信号灯，将当前车辆锁定的所有信号灯进行解锁，同时执行车辆上行循环锁灯处理步骤S102213；所述车辆上行循环锁灯处理步骤S102213为根据当前车辆所在的灯面序号，通过下列公式计算得到欲锁信号灯的灯面序号：当前车辆在偶数面时：Num＝CurrentNum-n×2，当前车辆在奇数面时：Num＝CurrentNum-1-2×；根据每次计算得到欲锁信号灯的灯面序号再执行车辆上行锁灯步骤S10221；所述车辆上行解灯步骤S10223为根据车辆当前进入电子围栏，从围栏缓存中找到当前电子围栏对应灯面，从灯面序号缓存中得到当前灯面对应的序号，如果序号是偶数面，用当前序号加上1得到上一次经过灯面的序号，如果当前面奇数面，用当前序号加上2得到上一次经过灯面的序号，如果序号信号灯对应缓存中存在上次经过灯面的序号，则从已锁定信号灯缓存中查找上一次通行信号灯是否已被解锁，如果已被解锁，则不用处理，否则执行上行信号灯解锁步骤S102231；所述上行信号灯解锁步骤S102231为将车辆信息从需要解锁的灯下待行车辆缓存中进行移除，然后判断信号灯下是否还存在待行车辆，如果还有待行车辆，则不用处理；否则将需要解锁的信号灯IP从锁定信号灯缓存中进行移除，置需要解锁的信号灯两面为绿灯。3.根据权利要求1或2所述的矿井下主斜坡道信号灯控制方法，其特征在于：当车辆进入电子围栏后，根据进入车辆定位信标号与运矿车辆缓存中的运矿车定位信标号逐个比对以判断当前车辆是不是运矿车。4.根据权利要求3所述的矿井下主斜坡道信号灯控制方法，其特征在于：如果是运矿车，所述矿井交通控制器执行运矿车处理步骤S100，所述运矿车处理步骤S100为运矿车进入电子围栏后，从围栏缓存中查找当前进入围栏对应的灯面信息，如果灯面信息为空，说明车辆进入了0号围栏或无穷大号围栏，执行运矿车无红绿灯围栏处理步骤S101，否则执行运矿车红绿灯围栏处理步骤S102。5.根据权利要求4所述的矿井下主斜坡道信号灯控制方法，其特征在于：所述运矿车无红绿灯围栏处理步骤S101为如果当前车辆进入的是0号围栏，将当前车辆的车辆上次经过灯面缓存中记入0，如果当前车辆进入的是无穷大号围栏，将当前车辆的车辆上次通过灯面缓存中记入无穷大。6.根据权利要求4所述的矿井下主斜坡道信号灯控制方法，其特征在于：所述运矿车红绿灯围栏处理步骤S102为从当前车辆的车辆上次经过灯面缓存中得到车辆上次经过的灯面，如果车辆上次经过灯面和当前进入围栏对应的灯面不是同一灯面，根据车辆上次经过灯面的标识号从灯面序号缓存中得到车辆上次经过灯面对应的序号；然后再根据当前灯面的标识号从灯面序号缓存中得到车辆当前灯面对应的序号，如果车辆上次经过灯面对应的序号小于车辆当前灯面对应的序号则判断为车辆下行；如果车辆上次经过灯面对应的序号大于车辆当前灯面对应的序号则判断为车辆上行。7.根据权利要求6所述的矿井下主斜坡道信号灯控制方法，其特征在于：所述运矿车红绿灯围栏处理步骤S102还包括如果当前进入围栏对应的灯面和当前车辆上次经过灯面是同一灯面，判断车辆在倒车，不处理。
说明书desc
技术领域本发明属于矿井交通技术领域，尤其涉及一种矿井下主斜坡道信号灯控制方法。背景技术近年来,随着我国矿山无轨采掘设备迅猛发展和广泛应用，地下开采使用斜坡道开拓越来越普遍。采用斜坡道开拓及其以斜坡道为主的采矿方法,与采用斜井或竖井开拓与传统的采矿方法相比,其生产工艺简化,生产能力大幅提高,可以有效地节省工程量和投资、加快矿山建设速度、缩短矿山建设时间、提高矿山开采安全性等,真正实现了技术上先进、经济上合理、安全上可靠的办矿原则。如图1所示，为降低井口11到井底12的坡度，使得适合各种车辆的行使，斜坡道10必须设计成来回弯曲，会有很多弯道13。行于斜坡道内的主要无轨设备有各种型号的铲运机、卡车、钻车、人车等。多种类型的车辆在井下同时行驶。卡车作为运矿车，是斜坡道主要生产车辆。其它车辆都属于辅助、保障生产车辆。所以运矿车在斜坡道拥有最高通行权，其余车辆见到运矿车时应当提前进岔路躲避。为了提高生产运输效率，一般运矿车为大卡车，该类型车体积较大，在斜坡道弯道区域，同一时刻只能通过一辆运矿车。如果该时刻有其它车辆进入弯道，则会发生交通堵塞。一旦堵塞，在车辆较多的时候，疏通交通需要较长时间，有时达到几个小时，严重影响生产效率。如何提升运矿车通行效率已经变成斜坡道运输的一大难题。一是如何让其它车辆知道弯道13里边有没有运矿车行驶？如果有运矿车在弯道行驶，则其它车辆不进入弯道，保证弯道正常通行；二是如何让其它车辆能尽早识别到有运矿车靠近，其它车辆尽早进行躲避，避免运矿车停车起步或减速，从而提升运矿车运行效率。目前使用手段是在弯道区域两端安装信号灯，运矿车司机进入弯道前，通过手工控制信号灯变为红灯，告知其它车辆有运矿车通过。予以避让。这种手工控制方式，由于斜坡道较长，弯道很多。经常因为运矿车司机忘记解锁红绿灯而导致交通瘫痪。还有时候，运矿车司机为了提高自己的通行效率，在运矿车装车时，将信号灯锁住，导致斜坡道上车辆通行效率较低。另一个不足是，使用手工控制信号灯，每次只能控制一个信号灯。每次运矿车进入弯道前，司机控制当前弯道信号灯变红灯。有时，其它车辆在运矿车司机变信号灯前已经进入了弯道。这个时候，就算运矿车司机变了灯也无法避免堵塞交通，导致运输效率降低。发明内容本发明所要解决的技术问题是提供一种能有效避免交通堵塞的矿井下主斜坡道信号灯控制方法，以克服现有技术存在的不足。为解决上述技术问题，本发明采用如下技术方案：一种矿井下主斜坡道信号灯控制方法，配置有矿井交通控制器、围栏缓存、灯面状态缓存、灯面序号缓存、序号信号灯对应缓存、灯下待行车辆缓存、锁定信号灯缓存、运矿车辆缓存、车辆经过上次信号灯缓存以及锁灯个数缓存；所述矿井交通控制器在判断车辆是运矿车且判断车辆是下行进入电子围栏情况下，从围栏缓存中查找当前进入围栏对应的灯面信息并根据灯面序号缓存得到灯面的序号，执行车辆下行变灯步骤S1021；所述车辆下行变灯步骤S1021分为车辆下行锁灯步骤S10211和车辆下行解灯步骤S10212；所述车辆下行锁灯步骤S10211由灯面的序号根据序号信号灯对应缓存得到欲锁信号灯IP，由欲锁信号灯IP根据锁定信号灯缓存判断该欲锁信号灯是否被锁定，如果该欲锁信号灯没有锁定，执行车辆下行信号灯未锁定处理步骤S102111，如果该欲锁信号灯被锁定，执行车辆下行信号灯已锁定处理步骤S102112；所述车辆下行信号灯未锁定处理步骤S102111为将当前车辆定位信标号加入到欲锁信号灯的灯下待行车辆缓存中，将欲锁信号灯IP记录进锁定信号灯缓存中，同时将欲锁信号灯的A面置绿闪烁，B面置红灯，同时执行车辆下行循环锁灯处理步骤S102113；车辆下行信号灯已锁定处理步骤S102112为进一步判断已锁定方向是否和当前车辆行驶方向一致，如果欲锁信号灯的已锁定方向和当前车辆行驶方向一致，将当前车辆定位信标号加入到该欲锁信号灯的灯下待行车辆缓存中，同时执行车辆下行循环锁灯处理步骤S102113；如果欲锁信号灯的锁定方向和当前车辆行驶方向不一致，进一步判断锁定面和当前车辆进入围栏对应的灯面是否一致，如果锁定面和当前车辆进入围栏对应的灯面一致，并且如果锁定车辆为当前车辆时，则判断车辆发生了正常掉头，遍历所有信号灯，将当前车辆锁定的所有信号灯进行解锁，同时执行车辆下行循环锁灯处理步骤S102113；如果锁定车辆不是当前车辆，则判断车辆发生了违规掉头，信号灯为掉头之前后方车辆锁住，则车辆应进入岔路口等候对向车辆通过，同时遍历所有信号灯，将当前车辆锁定的所有信号灯进行解锁，同时执行车辆下行循环锁灯处理步骤S102113；所述车辆下行循环锁灯处理步骤S102113为根据当前车辆所在的灯面序号，通过下列公式计算得到欲锁信号灯的灯面序号：当前车辆在奇数面时：Num＝CurrentNum+n×2，当前车辆在偶数面时：Num＝CurrentNum+1+2×；Num为欲锁信号灯的灯面序号，CurrentNum为当前车辆所在的灯面序号，n为循环因子，循环次数为从锁灯个数缓存中得到的锁灯个数减1；根据每次计算得到欲锁信号灯的灯面序号再循环执行车辆下行锁灯步骤S10211；所述车辆下行解灯步骤S10213为根据车辆当前进入电子围栏，从围栏缓存中找到当前电子围栏对应灯面，从灯面序号缓存中得到当前灯面对应的序号，如果序号是奇数面，用当前序号减去1得到上一次经过灯面的序号；如果当前面偶数面，用当前序号减去2得到上一次经过灯面的序号；如果序号信号灯对应缓存中存在上次经过灯面的序号，则从已锁定信号灯缓存中查找上一次通行信号灯是否已被解锁，如果已被解锁，则不用处理，否则执行下行信号灯解锁步骤S102131；所述下行信号灯解锁步骤S102131为将车辆信息从需要解锁的灯下待行车辆缓存中进行移除，然后判断信号灯下是否还存在待行车辆，如果还有待行车辆，则不用处理；否则将需要解锁的信号灯IP从锁定信号灯缓存中进行移除，置需要解锁的信号灯两面为绿灯。上述步骤实现了矿井下斜坡道中车辆下行变灯控制。另外，在本发明中，还包括对矿井下斜坡道的中中车辆上行变灯控制，即矿井交通控制器在判断车辆在上行进入电子围栏的情况下，从围栏缓存中查找当前进入围栏对应的灯面信息并根据灯面序号缓存得到灯面的序号，执行车辆上行变灯步骤S1022；所述车辆上行变灯步骤S1022分为车辆上行锁灯步骤S10221和车辆上行解灯步骤S10222；所述车辆上行锁灯步骤S10221为由灯面的序号根据序号信号灯对应缓存得到欲锁信号灯IP，由欲锁信号灯IP根据锁定信号灯缓存判断该欲锁信号灯是否被锁定，如果该欲锁信号灯没有锁定，执行车辆上行信号灯未锁定处理步骤S102211，如果该欲锁信号灯被锁定，执行车辆上行信号灯已锁定处理步骤S102212；所述车辆上行信号灯未锁定处理步骤S102211为将当前车辆定位信标号加入到欲锁信号灯的灯下待行车辆缓存中，将欲锁信号灯IP记录进锁定信号灯缓存中，同时将欲锁信号灯的A面置红灯，B面置绿闪烁，同时执行车辆上行循环锁灯处理步骤S102213；所述车辆上行信号灯已锁定处理步骤S102212为进一步判断已锁定方向是否和当前车辆行驶方向一致。如果欲锁信号灯的已锁定方向和当前车辆行驶方向一致，将当前车辆定位信标号加入到该欲锁信号灯的灯下待行车辆缓存中，同时执行车辆下行循环锁灯处理步骤S102113；如果欲锁信号灯的锁定方向和当前车辆行驶方向不一致，进一步判断锁定面和当前车辆进入围栏对应的灯面是否一致，如果锁定面和当前车辆进入围栏对应的灯面一致，并且如果锁定车辆为当前车辆时，则判断车辆发生了正常掉头，遍历所有信号灯，将当前车辆锁定的所有信号灯进行解锁，同时执行车辆上行循环锁灯处理步骤S102213；如果锁定车辆不是当前车辆，则判断车辆发生了违规掉头，信号灯为掉头之前后方车辆锁住，则车辆应进入岔路口等候对向车辆通过，同时遍历所有信号灯，将当前车辆锁定的所有信号灯进行解锁，同时执行车辆上行循环锁灯处理步骤S102213；所述车辆上行循环锁灯处理步骤S102213为根据当前车辆所在的灯面序号，通过下列公式计算得到欲锁信号灯的灯面序号：当前车辆在偶数面时：Num＝CurrentNum-n×2 ，当前车辆在奇数面时：Num＝CurrentNum-1-2×；根据每次计算得到欲锁信号灯的灯面序号再执行车辆上行锁灯步骤S10221；所述车辆上行解灯步骤S10223为根据车辆当前进入电子围栏，从围栏缓存中找到当前电子围栏对应灯面，从灯面序号缓存中得到当前灯面对应的序号，如果序号是偶数面，用当前序号加上1得到上一次经过灯面的序号，如果当前面奇数面，用当前序号加上2得到上一次经过灯面的序号，如果序号信号灯对应缓存中存在上次经过灯面的序号，则从已锁定信号灯缓存中查找上一次通行信号灯是否已被解锁，如果已被解锁，则不用处理，否则执行上行信号灯解锁步骤S102231；所述上行信号灯解锁步骤S102231为将车辆信息从需要解锁的灯下待行车辆缓存中进行移除，然后判断信号灯下是否还存在待行车辆，如果还有待行车辆，则不用处理；否则将需要解锁的信号灯IP从锁定信号灯缓存中进行移除，置需要解锁的信号灯两面为绿灯。在本发明的具体实施方式中，当车辆进入电子围栏后，根据进入车辆定位信标号与运矿车辆缓存中的运矿车定位信标号逐个比对以判断当前车辆是不是运矿车。该步骤实现了对车辆是否是运矿车的判断，从而为本发明通过运矿灯来触发信号灯控制奠定基础。如果是运矿车，所述矿井交通控制器执行运矿车处理步骤S100，所述运矿车处理步骤S100为运矿车进入电子围栏后，从围栏缓存中查找当前进入围栏对应的灯面信息，如果灯面信息为空，说明车辆进入了0号围栏或无穷大号围栏，执行运矿车无红绿灯围栏处理步骤S101，否则执行运矿车红绿灯围栏处理步骤S102。在本发明中，引入0号围栏或无穷大号围栏，从而为在井口和井底的车辆判断行驶方向提供了可能。在本发明具体实施方式中，所述运矿车无红绿灯围栏处理步骤S101为如果当前车辆进入的是0号围栏，将当前车辆的车辆上次经过灯面缓存中记入0，如果当前车辆进入的是无穷大号围栏，将当前车辆的车辆上次通过灯面缓存中记入无穷大。在本发明具体实施方式中，所述运矿车红绿灯围栏处理步骤S102为从当前车辆的车辆上次经过灯面缓存中得到车辆上次经过的灯面，如果车辆上次经过灯面和当前进入围栏对应的灯面不是同一灯面，根据车辆上次经过灯面的标识号从灯面序号缓存中得到车辆上次经过灯面对应的序号；然后再根据当前灯面的标识号从灯面序号缓存中得到车辆当前灯面对应的序号，如果车辆上次经过灯面对应的序号小于车辆当前灯面对应的序号则判断为车辆下行；如果车辆上次经过灯面对应的序号大于车辆当前灯面对应的序号则判断为车辆上行。该步骤实现了能够判断出车辆的行使方向，即车辆是上行还是下行。在本发明具体实施方式中，所述运矿车红绿灯围栏处理步骤S102还包括如果当前进入围栏对应的灯面和当前车辆上次经过灯面是同一灯面，判断车辆在倒车，不处理。该步骤实现了还能够判断车辆是否在倒车。采用上述技术方案，本发明利用UWB定位技术通过基于地图上绘制电子围栏的方式对矿井下主斜坡道信号灯进行控制以实现能够很方便地对矿井下主斜坡道信号灯进行自动控制，大大降低矿井下主斜坡道交通堵塞发生的概率，有效提高了运矿车通行效率，从而提升了矿山企业生产效益。附图说明图1为矿井下主斜坡道示意图；图2为矿井下主斜坡道中信号灯设置示意图；图3为本发明采用的系统的结构原理框图。具体实施方式如图2所示，本发明涉及的矿井下主斜坡道的各弯道区域两端均设置有信号灯，每个信号灯均具有两个灯面，一侧的灯面朝向坡顶的井口，称之为A面，另一侧的灯面朝向坡底的井底，称之为B面，每一灯面均能择一地进行绿灯、红灯、绿闪烁三种状态切换。对各个信号灯的灯面按次序编号，即从井口到井底以从小到大的顺序依次编号，例如#1信号灯的A面的序号为1，B面的序号为2、#2信号灯的A面的序号为3、B面的序号为4，#3信号灯的A面的序号为5、B面的序号为6,……，一直编号到坡底的最后一个信号灯的B面。另外，在每个灯面的外侧均设置电子围栏，用于感知车辆的进入，实现车辆的定位。电子围栏是基于UWB的定位技术，在矿山领域使用越来越普遍，其定位精度高，定位精度不大于0.3m，已经广泛使用于矿山井下人员和车辆的考勤、定位、报警、轨迹等信息的实时监测、历史追溯与查询分析，由于该定位技术是现有技术，这里不再累述。为实现本发明的矿井下主斜坡道信号灯控制方法，需要配置如下信息：电子围栏信息：在地图上信号灯各灯面的外侧附近配置一定大小的电子围栏，用于触发信号灯。信号灯信息：在实现信号灯控制算法前，需要将所有信号灯信息录入数据库进行保存，包括信号灯的灯面的序号、信号灯IP、信号灯坐标、信号灯状态、灯面对应围栏信息等车辆信息：包括车牌号码、车辆类型、车辆定位信标号等信息。包括运矿车在内，所有车辆在矿井下主斜坡道中行使遵循的交通规则是：司机发现前方对向灯面是绿灯或绿闪烁，才能进入对向灯面下方对应的电子围栏，否则当看到前方对向灯面是红灯时，说明对向有运矿车过来，司机应驾驶车辆进入岔路等候对向运矿车通过后才能进入电子围栏。本发明的矿井下主斜坡道信号灯控制方法，采用如图3所示的系统，该系统配置有矿井交通控制器100、围栏缓存101、灯面状态缓存102、灯面序号缓存103、序号信号灯对应缓存104、灯下待行车辆缓存105、锁定信号灯缓存106、运矿车辆缓存107、车辆经过上次信号灯缓存108以及锁灯个数缓存109。其中，围栏缓存101用于缓存每个电子围栏对应的灯面，即可以根据电子围栏确定对应的灯面。灯面状态缓存102用于缓存每个灯面的当前状态。灯面序号缓存103用于缓存每个灯面对应的序号信息，可以方便地得到某个灯面对应的序号。序号信号灯对应缓存104用于缓存每个灯面的序号对应的信号灯信息，可以通过某个灯面的序号方便得到对应的信号灯信息以确定信号灯，例如可以根据某个灯面的序号得到该灯面所在信号灯的信号灯IP以确定信号灯。灯下待行车辆缓存105用于缓存各个信号灯下待行车辆，即当运矿车驶入未锁定信号灯或同方向已锁定信号灯对应围栏时，将车辆定位信标号加入到该信号灯的灯下待行车辆缓存，直到车辆驶入下一个信号灯对应围栏时，从上个信号灯的灯下待行车辆缓存中移除车辆定位信标号。锁定信号灯缓存106用于缓存锁定信号灯，即当锁定信号灯时，将锁定信号灯IP及锁定方向加入到锁定信号灯缓存中。在本发明中，锁定信号灯是指当运矿车进入信号灯对应电子围栏时，开始将信号灯对着自己的一面置为绿闪烁状态，另一面置为红灯状态的过程。运矿车辆缓存107用于缓存运矿车定位信标号，当一车辆进入电子围栏时，根据其定位信标号可以在运矿车辆缓存107查找以快速知道该车是不是运矿车。车辆上次经过灯面缓存108，每个运矿车均配置有车辆上次经过灯面缓存，用于记录车辆最近一次通过的灯面标识号，用来判断车辆行驶方向使用。锁灯个数缓存109用于缓存锁灯个数，即在每次系统启动的时候，将设置的每次运矿车同时需要锁灯的信号灯个数加入到锁灯个数缓存中。在系统启动的时候，矿井交通控制器100设置所有信号灯的灯面为绿灯状态。另外，为了在车辆进入第一个围栏或井下最后一个围栏就能知道车辆是上行或者下行，需要在井口位置的第一个灯面对应电子围栏的靠井口方向配置一个无对应信号灯的电子围栏，标识为0号围栏，在井底靠近采场的方向配置一个无对应信号灯的电子围栏，标识为无穷大围栏。本发明的矿井交通控制器100通过下列步骤对进入电子围栏的车辆进行信号灯控制：当车辆进入电子围栏后，根据进入车辆定位信标号与运矿车辆缓存中的运矿车定位信标号逐个比对以判断当前车辆是不是运矿车，如果不是运矿车，直接跳过；如果是运矿车，执行运矿车处理步骤S100。这里需要说明的是：在斜坡道中，由于运矿车的车体较宽，当有运矿车经过时，其它对向上来车，无论是运矿车还是非运矿车均无法错车，因此必须要用信号灯进行控制以避免堵塞，而如果仅是非运矿车，由于非运矿车通常车体较窄，即使两车交会，也可以相互错过，因此无需信号灯进行控制；另外，在斜坡道交通规则中，为提高运矿车的通行效率，要求非运矿车要避让运矿车。故在本发明中是通过在斜坡道中行使的运矿车来触发信号灯变灯，不需要非运矿车触发信号灯变灯。运矿车处理步骤S100运矿车进入电子围栏后，从围栏缓存中查找当前进入围栏对应的灯面信息，如果灯面信息为空，说明车辆进入了0号围栏或无穷大号围栏，执行运矿车无红绿灯围栏处理步骤S101，否则执行运矿车红绿灯围栏处理步骤S102。运矿车无红绿灯围栏处理步骤S101如果当前车辆进入的是0号围栏，将当前车辆的车辆上次经过灯面缓存中记入0，如果当前车辆进入的是无穷大号围栏，将当前车辆的车辆上次经过灯面缓存中记入无穷大。运矿车红绿灯围栏处理步骤S102从当前车辆的车辆上次经过灯面缓存中得到车辆上次经过的灯面，如果当前进入围栏对应的灯面和当前车辆上次经过灯面是同一灯面，说明车辆在倒车，不处理。如果车辆上次经过灯面和当前进入围栏对应的灯面不是同一灯面，根据车辆上次经过灯面的标识号从灯面序号缓存中得到车辆上次经过灯面对应的序号。然后再根据当前灯面的标识号从灯面序号缓存中得到车辆当前灯面对应的序号。如果车辆上次经过灯面对应的序号小于车辆当前灯面对应的序号，判断车辆下行，执行车辆下行变灯步骤S1021；如果车辆上次经过灯面对应的序号大于车辆当前灯面对应的序号，判断车辆上行，执行车辆上行变灯步骤S1022。车辆下行变灯步骤S1021车辆下行变灯步骤S1021分为车辆下行锁灯步骤S10211和车辆下行解灯步骤S10212。车辆下行锁灯步骤S10211由灯面的序号根据序号信号灯对应缓存得到欲锁信号灯IP，由欲锁信号灯IP根据锁定信号灯缓存判断该欲锁信号灯是否被锁定，如果该欲锁信号灯没有锁定，执行车辆下行信号灯未锁定处理步骤S102111，如果该欲锁信号灯被锁定，执行车辆下行信号灯已锁定处理步骤S102112。车辆下行信号灯未锁定处理步骤S102111如果欲锁信号灯未锁定，将当前车辆定位信标号加入到欲锁信号灯的灯下待行车辆缓存中，锁定该欲锁信号灯，即将欲锁信号灯IP记录进锁定信号灯缓存中，同时将欲锁信号灯的A面置绿闪烁，B面置红灯；同时执行车辆下行循环锁灯处理步骤S102113。车辆下行信号灯已锁定处理步骤S102112该处理步骤中，在欲锁信号灯已锁定的情况下，分下列情形处理：进一步判断已锁定方向是否和当前车辆行驶方向一致。如果欲锁信号灯的已锁定方向和当前车辆行驶方向一致，将当前车辆定位信标号加入到该欲锁信号灯的灯下待行车辆缓存中，同时执行车辆下行循环锁灯处理步骤S102113。如果欲锁信号灯的锁定方向和当前车辆行驶方向不一致，进一步判断锁定面和当前车辆进入围栏对应的灯面是否一致，如果锁定面和当前车辆进入围栏对应的灯面一致，并且如果锁定车辆为当前车辆时，则判断车辆发生了正常掉头，遍历所有信号灯，将当前车辆锁定的所有信号灯解锁，同时执行车辆下行循环锁灯处理步骤S102113；如果锁定车辆不是当前车辆，则判断车辆发生了违规掉头，则车辆应进入岔路口等候对向车辆通过，同时遍历所有信号灯，将当前车辆锁定的所有信号灯解锁，同时执行车辆下行循环锁灯处理步骤S102113。信号灯解锁是指将当前车辆定位信标号从欲解锁信号灯的灯下待行车辆缓存中移除，然后判断欲解锁信号灯的灯下待行车辆缓存中是否还有待行车辆，如果还有待行车辆，则不用处理，如果没有待行车辆，则将欲解锁信号灯的信号灯IP从锁定信号灯缓存中移除，将欲解锁信号灯的两个灯面均置为绿灯。实施例1：如图2所示，车辆A下行进入#2信号灯A面围栏，#2信号灯已经锁定，并且是锁定方向是A面绿闪烁B面红灯，锁定方向与车辆A进入围栏方向一致，则将该车辆A加入#2信号灯的灯下待行车辆缓存中，同时执行车辆下行循环锁灯处理步骤S102113。又如图2所示，车辆A下行进入#2信号灯B面围栏，#2信号灯已经锁定，并且是锁定方向是B面绿闪烁A面红灯，锁定方向与车辆A进入围栏方向不一致，但是锁定面是B面，与车辆A进入围栏对应的B面一致，并且锁定车辆为当前车辆，则判断车辆A发生掉头，则遍历所有信号灯，将当前车辆锁定的所有信号灯解锁，同时执行车辆下行循环锁灯处理步骤S102113。如果锁定车辆不是当前车辆，则判断车辆A发生违规掉头，车辆应进入岔路口等候对向车辆通过，同时遍历所有信号灯，将当前车辆锁定的所有信号灯进行解锁，同时执行车辆下行循环锁灯处理步骤S102113。车辆下行循环锁灯处理步骤S102113根据当前车辆进入围栏对应的灯面，从灯面序号缓存中得到当前车辆所在的灯面序号，通过下列公式计算得到欲锁信号灯的灯面序号：当前车辆在奇数面时：Num＝CurrentNum+n×2 ，当前车辆在偶数面时：Num＝CurrentNum+1+2×；Num为欲锁信号灯的灯面序号，CurrentNum为当前车辆所在的灯面序号，n为循环因子，循环次数为从锁灯个数缓存中得到的锁灯个数减1；根据每次计算得到欲锁信号灯的灯面序号再执行车辆下行锁灯步骤S10211。实施例2在本例中，锁灯个数缓存中设置的锁灯个数为3。如图2所示，当车辆下行进入#1信号灯的A面，该A面的序号1，即车辆当前在奇数面，则由公式第一次循环计算出下一个欲锁信号灯的灯面序号是3，则根据灯面序号3再执行一次车辆下行锁灯步骤S10211，由公式第二次循环计算出再下一个欲锁信号灯的灯面序号为5，则根据灯面序号5再执行一次车辆下行锁灯步骤S10211。如此这样，3个信号灯均被锁定。又如图2所示，当车辆下行进入#1信号灯的B,该B面的序号为2，即车辆当前在偶数面，则由公式第一次循环计算出下一个欲锁信号灯的灯面序号是3，则根据灯面序号3再执行一次车辆下行锁灯步骤S10211，由公式第二次计算出再下一个欲锁信号灯的灯面序号为5，则根据灯面序号5再执行一次车辆下行锁灯步骤S10211。如此这样，3个信号灯均被锁定。车辆下行解灯步骤S10213根据车辆当前进入电子围栏，从围栏缓存中找到当前电子围栏对应灯面，从灯面序号缓存中得到当前灯面对应的序号，如果序号是奇数面，用当前序号减去1得到上一次经过灯面的序号；如果当前面偶数面，用当前序号减去2得到上一次经过灯面的序号。如果序号信号灯对应缓存中存在上次经过灯面的序号，说明当前车辆经过的不是第一个灯面，后方存在需要解锁的信号灯，则从锁定信号灯缓存中查找上一次通行信号灯是否已被解锁。如果已被解锁，则不用处理，否则执行下行信号灯解锁步骤S102131。实施例3如图2所示，当车辆A下行进入#2信号灯的A面围栏，该A面围栏对应的灯面序号是3，即车辆当前在奇数面，则当前序号减去1得到上一次经过灯面的序号，即上一次经过灯面的序号为2。由于序号信号灯对应缓存中存在上次经过灯面的该序号2，说明当前车辆A经过的不是第一个灯面，后方存在需要解锁的信号灯，从锁定信号灯缓存中查找到该序号2对应的上一次经过的#1信号灯是否已被解除。如果已被解锁，则不用处理。否则执行下行信号灯解锁步骤S102131。又如图2所示，当车辆A下行进入#2信号灯B围栏，该B面围栏对应的灯面序号是4，即车辆当前在偶数面，则当前序号减去2得到上一次经过灯面的序号，即上一次经过灯面的序号为2。由于序号信号灯对应缓存中存在上次经过灯面的该序号2，说明当前车辆A经过的不是第一个灯面，后方存在需要解锁的信号灯，从已锁定信号灯缓存中查找到该序号2对应的上一次经过的#1信号灯是否已被解除。如果已被解锁，则不用处理。否则执行下行信号灯解锁步骤S102131。再如图3所示，当车辆A下行进入#1信号灯A面围栏，该A面围栏对应的灯面序号是1，即车辆当前在奇数面，则当前序号减去1得到上一次经过的序号，即上一次经过灯面的序号为0。由于序号信号灯对应缓存中不存在灯面序号0，说明当前车辆经过的是第一个灯面，后方不存在需要解锁的信号灯。同样如图3所示，当车辆A下行进入进入#1信号灯B面围栏，该B面对应的灯面序号是2，即车辆当前在偶数面，则当前序号减去2得到上一次经过的序号，即上一次经过灯面的序号为0。由于序号信号灯对应缓存中不存在灯面序号0，说明当前车辆经过的是第一个灯面，后方不存在需要解锁的信号灯。下行信号灯解锁步骤S102131将车辆定位信标号从需要解锁的灯下待行车辆缓存中移除。然后判断信号灯下是否还存在待行车辆，如果还有待行车辆，则不用处理；如果没有待行车辆，则将需要解锁的信号灯IP从锁定信号灯缓存中进行移除，置信号灯两面为绿灯。车辆上行变灯步骤S1022车辆上行变灯步骤S1022分为车辆上行锁灯步骤S10221和车辆上行解灯步骤S10222。车辆上行锁灯步骤S10221由灯面的序号根据序号信号灯对应缓存得到欲锁信号灯IP，由欲锁信号灯IP根据锁定信号灯缓存判断该欲锁信号灯是否被锁定，如果该欲锁信号灯没有锁定，执行车辆上行信号灯未锁定处理步骤S102211，如果该欲锁信号灯被锁定，执行车辆上行信号灯已锁定处理步骤S102212。车辆上行信号灯未锁定处理步骤S102211如果欲锁信号灯未锁定，将当前车辆定位信标号加入到欲锁信号灯的灯下待行车辆缓存中，锁定该欲锁信号灯，即将欲锁信号灯IP记录进锁定信号灯缓存中，同时将欲锁信号灯的A面置红灯，B面置绿闪烁；同时执行车辆上行循环锁灯处理步骤S102213。车辆上行信号灯已锁定处理步骤S102212该处理步骤中，在欲锁信号灯已锁定的情况下，分下列情形处理：进一步判断已锁定方向是否和当前车辆行驶方向一致。如果欲锁信号灯的已锁定方向和当前车辆行驶方向一致，将当前车辆定位信标号加入到该欲锁信号灯的灯下待行车辆缓存中，同时执行车辆上行循环锁灯处理步骤S102213。如果欲锁信号灯的锁定方向和当前车辆行驶方向不一致，进一步判断锁定面和当前车辆进入围栏对应的灯面是否一致，如果锁定面和当前车辆进入围栏对应的灯面一致，并且如果锁定车辆为当前车辆时，则判断车辆发生了正常掉头，遍历所有信号灯，将当前车辆锁定的所有信号灯进行解锁，同时执行车辆上行循环锁灯处理步骤S102213；如果锁定车辆不是当前车辆，则判断车辆发生了违规掉头，信号灯为掉头之前后方车辆锁住，则车辆应进入岔路口等候对向车辆通过，同时遍历所有信号灯，将当前车辆锁定的所有信号灯进行解锁，同时执行车辆上行循环锁灯处理步骤S102213。实施例4：如图2所示，车辆A上行进入#2信号灯B面围栏，#2信号灯已经锁定，并且是锁定方向是B面绿闪烁A面红灯，锁定方向与车辆B进入围栏方向一致，则将该车辆A加入#2信号灯的灯下待行车辆缓存中，同时执行车辆上行循环锁灯处理步骤S102213。又如图3所示，车辆A上行进入#2信号灯A面围栏，#2信号灯已经锁定，并且是锁定方向是A面绿闪烁B面红灯，锁定方向与车辆A进入围栏方向不一致，但是锁定面是A面，与车辆A进入围栏对应的A面一致，并且锁定车辆为当前车辆，则判断车辆A发生正常掉头，则遍历所有信号灯，将当前车辆锁定的所有信号灯进行解锁，同时执行车辆上行循环锁灯处理步骤S102213。如果锁定车辆不是当前车辆，则判断车辆A发生违规掉头，车辆应进入岔路口等候对向车辆通过，同时遍历所有信号灯，将当前车辆锁定的所有信号灯进行解锁，同时执行车辆上行循环锁灯处理步骤S102213。车辆上行循环锁灯处理步骤S102213根据当前车辆进入围栏对应的灯面，从灯面序号缓存中得到当前车辆所在的灯面序号，通过下列公式计算得到欲锁信号灯的灯面序号：当前车辆在偶数面时：Num＝CurrentNum-n×2，当前车辆在奇数面时：Num＝CurrentNum-1-2×；Num为欲锁信号灯的灯面序号，CurrentNum为当前车辆所在的灯面序号，n为循环因子，循环次数为从锁灯个数缓存中得到的锁灯个数减1；根据每次计算得到欲锁信号灯的灯面序号再执行车辆上行锁灯步骤S10221。实施例5在本例中，锁灯个数缓存中设置的锁灯个数为3。如图3所示，当车辆上行进入#3信号灯的B面，该B面的序号6，即车辆当前在偶数面，则由公式第一次循环计算出下一个欲锁信号灯的灯面序号是4，则根据灯面序号4再执行一次车辆上行锁灯步骤S10221，由公式第二次循环计算出再下一个欲锁信号灯的灯面序号为2，则根据灯面序号2再执行一次车辆上行锁灯步骤S10221。如此这样，3个信号灯均被锁定。又如图3所示，当车辆上行进入#3信号灯的A,该A面的序号为5，即车辆当前在奇数面，则由公式第一次循环计算出下一个欲锁信号灯的灯面序号是4，则根据灯面序号4再执行一次车辆上行锁灯步骤S10221，由公式第二次循环计算出再下一个欲锁信号灯的灯面序号为2，则根据灯面序号2再执行一次车辆上行锁灯步骤S10221。如此这样，3个信号灯均被锁定。车辆上行解灯步骤S10223根据车辆当前进入电子围栏，从围栏缓存中找到当前电子围栏对应灯面，从灯面序号缓存中得到当前灯面对应的序号，如果序号是偶数面，用当前序号加上1得到上一次经过灯面的序号；如果当前面奇数面，用当前序号加上2得到上一次经过灯面的序号。如果序号信号灯对应缓存中存在上次经过灯面的序号，说明当前车辆经过的不是第一个灯面，后方存在需要解锁的信号灯，则从已锁定信号灯缓存中查找上一次通行信号灯是否已被解锁。如果已被解锁，则不用处理，否则执行上行信号灯解锁步骤S102231。实施例6如图3所示，当车辆A上行进入#2信号灯的B面围栏，该B面围栏对应的灯面序号是4，即车辆当前在偶数面，则当前序号加上1得到上一次经过灯面的序号，即上一次经过灯面的序号为5。由于序号信号灯对应缓存中存在上次经过灯面的该序号5，说明当前车辆A经过的不是第一个灯面，后方存在需要解锁的信号灯，从锁定信号灯缓存中查找到该序号5对应的上一次经过的#3信号灯是否已被解除。如果已被解锁，则不用处理。否则执行上行信号灯解锁步骤S102231。又如图3所示，当车辆A上行进入#2信号灯的A面围栏，该A面围栏对应的灯面序号是3，即车辆当前在奇数面，则当前序号加上2得到上一次经过灯面的序号，即上一次经过灯面的序号为5。由于序号信号灯对应缓存中存在上次经过灯面的该序号5，说明当前车辆A经过的不是第一个灯面，后方存在需要解锁的信号灯，从已锁定信号灯缓存中查找到该序号5对应的上一次经过的#3信号灯是否已被解除。如果已被解锁，则不用处理。否则执行上行信号灯解锁步骤S102231。当车辆A上行进入坡底最后一个信号灯的B面围栏，该B面围栏对应的灯面是偶数面，已经是所有灯面的灯面序号中最大数字，则当前序号加上1得到上一次经过的灯面序号，但该上一次经过的灯面序号在序号信号灯对应缓存中不存在，说明当前车辆经过的是第一个灯面，后方不存在需要解锁的信号灯。同样当车辆A上行进入坡底最后一个信号灯的A面围栏，该A面围栏对应的灯面是奇数面，是所有灯面的灯面序号中倒数第二大数字，则当前序号加上2得到上一次经过的灯面序号，但该上一次经过的灯面序号同样在序号信号灯对应缓存中不存在，说明当前车辆经过的是第一个灯面，后方不存在需要解锁的信号灯。上行信号灯解锁步骤S102231将车辆定位信标号从需要解锁的灯下待行车辆缓存中进行移除。然后判断信号灯下是否还存在待行车辆，如果还有待行车辆，则不用处理；如果没有待行车辆，则将需要解锁的信号灯IP从锁定信号灯缓存中进行移除，置信号灯两面为绿灯。
