标题title
一种基于两阶段学习的钻井异常工况诊断方法及系统
摘要abst
本发明公开了一种基于两阶段学习的钻井异常工况诊断方法及系统，该方法包括如下步骤：S1：处理随钻录井参数，对每个特征通道采用滑动窗口进行多尺度划分，得到分块；S2：采用异常检测模型进行第一阶段的异常检测：学习分块之间和分块内部两种数据表示，并计算两者之间的差异，给出异常判断；S3：将判断结果重新整理到新的数据集中；S4：采用不均衡多分类模型进行第二阶段的不均衡多分类：结合标签分布相关边界损失函数和延迟重赋权训练，达到对异常结果的识别。本发明利用两阶段学习的思想可解决实际的钻井样本不均衡导致的异常识别准确率低的问题。
权利要求书clms
1.一种基于两阶段学习的钻井异常工况诊断方法，其特征在于，包括如下步骤：S1：处理随钻录井参数，对每个特征通道采用滑动窗口进行多尺度划分，得到分块；S2：采用异常检测模型进行第一阶段的异常检测：学习分块之间和分块内部两种数据表示，并计算两者之间的差异，给出异常判断；S3：将判断结果重新整理到新的数据集中；S4：采用不均衡多分类模型进行第二阶段的不均衡多分类：结合标签分布相关边界损失函数和延迟重赋权训练，达到对异常结果的识别。2.如权利要求1所述的一种基于两阶段学习的钻井异常工况诊断方法，其特征在于，步骤S1包括如下子步骤：S11：采用三次样条插值将不同钻井采样点的原始数据时间间隔统一，并进行归一化处理；S12：设置不同的滑动窗口大小，即为读取数据的长度，每个长度的滑动窗口所采样的数据记为一个分块；每一个分块由多个特征通道组成，组成分块的所有特征通道记为分块内。3.如权利要求1所述的一种基于两阶段学习的钻井异常工况诊断方法，其特征在于，步骤S2包括如下子步骤：S21：通过多头自注意力网络对分块之间的关系进行建模，得到分块间的数据表示，记为：，其中，/＞表示连接，/＞为一个可学习参数矩阵，/＞为分块的注意力权重；S22：通过多头自注意力网络对分块内的数据之间的关系进行建模，得到分块内的数据表示，记为：，其中，/＞为一个可学习参数矩阵，/＞为分块的注意力权重；S23：将不同尺度下的分块的数据表示映射到原始时间序列的形状中，对于分块间分支，使用重复分块的方式进行上采样，得到分块间最终的数据表示，记为：，对于分块内分支，使用重复分块内的点的方式进行上采样，得到分块内最终的数据表示，记为：，其中，/＞表示上采样，/＞表示分块集合，/＞表示分块内的数据表示，/＞表示分块间的数据表示。4.如权利要求3所述的一种基于两阶段学习的钻井异常工况诊断方法，其特征在于，步骤S2还包括如下子步骤：S24：使用基于库尔贝克-莱布勒散度的损失函数来衡量分块间数据表示和分块内数据表示的相似性；S25：反复上述步骤，使用梯度下降法和梯度停止法异步更新双注意力对比网络，通过优化器最小化损失函数，进行模型训练。5.如权利要求4所述的一种基于两阶段学习的钻井异常工况诊断方法，其特征在于，步骤S2还包括如下子步骤：S26：定义原始随钻录井数据，异常得分记为/＞，计算公式如下：，其中，/＞为实数集，/＞为随钻录井数据的长度，/＞为随钻录井数据的维度，/＞表示输入的时间序列，/＞为分快内的数据表示，/＞为分块间的数据表示，/＞表示两个输出向量/＞和/＞的相似性度量，计算公式如下：，S27：基于逐个数据点的异常得分，记为/＞，设置一个超参数/＞用来决定一个点是否是异常：/＞。6.如权利要求1所述的一种基于两阶段学习的钻井异常工况诊断方法，其特征在于，步骤S3具体为：将第一阶段识别的异常数据重新组合为数据集，将第一阶段识别为正常的数据重新组合为数据集/＞，对于任意录井参数/＞，其中/＞表示特征向量，/＞表示标签：如果，则将样本加入集合/＞，即/＞；如果，则将样本加入集合/＞，即/＞。7.如权利要求1所述的一种基于两阶段学习的钻井异常工况诊断方法，其特征在于，步骤S4包括如下子步骤：S41：在训练轮次1到指定训练轮次，使用标签分布相关边界损失函数/＞训练多分类模型/＞，使用随机梯度下降来进行反向传播并更新模型网络参数；S42：在训练轮次到训练轮次/＞，使用样本数量对损失函数进行重赋权，使用在归一化的学习率的随机梯度下降优化器优化多分类模型/＞；S43：通过多分类模型输出结果：，其中，/＞是一个k维向量，诊断的类别/＞，其中k表示样本的类别数量，置信度/＞最高的类别为最终诊断类别。8.一种基于两阶段学习的钻井异常工况诊断系统，用以实现权利要求1~7任意一项所述的一种基于两阶段学习的钻井异常工况诊断方法，其特征在于，包括数据处理模块、异常检测模型和不均衡多分类模型，其中，数据处理模块，用以处理随钻录井参数，对每个特征通道采用滑动窗口进行多尺度划分，得到分块；常检测模型，用以进行第一阶段的异常检测，学习分块之间和分块内部两种数据表示，并计算两者之间的差异，给出异常判断；不均衡多分类模型，用以进行第二阶段的不均衡多分类，结合标签分布相关边界损失函数和延迟重赋权训练，达到对异常结果的识别。9.一种计算机程序产品，包括计算机程序，其特征在于，该计算机程序被处理器执行时，实现权利要求1~7任意一项所述的一种基于两阶段学习的钻井异常工况诊断方法。10.一种计算机可读存储介质，所述存储介质存储有计算机程序，其特征在于，所述计算机程序被处理器执行时，实现权利要求1~7任意一项所述的一种基于两阶段学习的钻井异常工况诊断方法。
说明书desc
技术领域本发明涉及钻井开发技术领域，尤其涉及一种基于两阶段学习的钻井异常工况诊断方法及系统。背景技术气体欠平衡钻井技术是近年来为适应油气开发而提出的及时发现、保护油气层和增产、提高产能的新型工艺技术。与钻井液钻井技术相比，气体钻井具有较低的综合成本、能有效克服传统钻井液钻井的漏失情况和提高钻井的机械钻速等优点。同时由于气体钻井低密度与高流速的特殊性，在进行气体钻井大面积推广应用同时，也暴露出了一些安全隐患与风险。比如钻井过程中发生的地层产气不仅容易造成人员伤亡和经济损失，对环境也造成污染，地层产水、卡钻、接立柱等安全事故的发生也会对大家的生命有威胁。近年来，随着人工智能技术在全球范围内迅猛发展，油气勘探开发智能化成为全球油气行业发展的热点，也成为保障中国能源战略安全的变革性技术。各界人士对于气体钻井安全问题也有了更高的期望，随着对钻井安全风险研究的深入，专家从研究气体钻井过程中发生安全问题的主要影响因素与对应参数变化的关系模型到提出采用钻井模型与专家系统相结合，不断总结挖掘判断安全风险的方法。钻井技术正由传统模式向机器学习与人工智能相结合的方向发展。发明内容本发明的目的是提供一种基于两阶段学习的钻井异常工况诊断方法及系统，以解决实际的钻井样本不均衡导致异常识别准确率低的技术问题。本发明是采用以下技术方案实现的：一种基于两阶段学习的钻井异常工况诊断方法，包括如下步骤：S1：处理随钻录井参数，对每个特征通道采用滑动窗口进行多尺度划分，得到分块；S2：采用异常检测模型进行第一阶段的异常检测：学习分块之间和分块内部两种数据表示，并计算两者之间的差异，给出异常判断；S3：将判断结果重新整理到新的数据集中；S4：采用不均衡多分类模型进行第二阶段的不均衡多分类：结合标签分布相关边界损失函数和延迟重赋权训练，达到对异常结果的识别。进一步的，步骤S1包括如下子步骤：S11：采用三次样条插值将不同钻井采样点的原始数据时间间隔统一，并进行归一化处理；S12：设置不同的滑动窗口大小，即为读取数据的长度，每个长度的滑动窗口所采样的数据记为一个分块；每一个分块由多个特征通道组成，组成分块的所有特征通道记为分块内。进一步的，步骤S2包括如下子步骤：S21：通过多头自注意力网络对分块之间的关系进行建模，得到分块间的数据表示，记为：，其中，/＞表示连接，/＞为一个可学习参数矩阵，/＞为网络层的维度，/＞表示实数集，/＞为分块的注意力权重；S22：通过多头自注意力网络对分块内的数据之间的关系进行建模，得到分块内的数据表示，记为：，其中，/＞为一个可学习参数矩阵，/＞为分块的注意力权重；S23：将不同尺度下的分块的数据表示映射到原始时间序列的形状中，对于分块间分支，使用重复分块的方式进行上采样，得到分块间最终的数据表示，记为：，对于分块内分支，使用重复分块内的点的方式进行上采样，得到分块内最终的数据表示，记为：，其中，/＞表示上采样，/＞表示分块集合，/＞表示分块内的数据表示，/＞表示分块间的数据表示。进一步的，步骤S2还包括如下子步骤：S24：使用基于库尔贝克-莱布勒散度的损失函数来衡量分块间数据表示和分块内数据表示的相似性；S25：反复上述步骤，使用梯度下降法和梯度停止法异步更新双注意力对比网络，通过优化器最小化损失函数，进行模型训练。进一步的，步骤S2还包括如下子步骤：S26：定义原始随钻录井数据，异常得分记为/＞，计算公式如下：，其中，/＞为实数集，/＞为随钻录井数据的长度，/＞为随钻录井数据的维度，/＞表示输入的时间序列，/＞为分快内的数据表示，/＞为分块间的数据表示，/＞表示两个输出向量/＞和/＞的相似性度量，计算公式如下：，S27：基于逐个数据点的异常得分，记为/＞，设置一个超参数用来决定一个点是否是异常：/＞。进一步的，步骤S3具体为：将第一阶段识别的异常数据重新组合为数据集，将第一阶段识别为正常的数据重新组合为数据集/＞，对于任意录井参数/＞，其中/＞表示特征向量，/＞表示标签：如果，则将样本加入集合/＞，即/＞；如果，则将样本加入集合/＞，即/＞。进一步的，步骤S4包括如下子步骤：S41：在训练轮次1到指定训练轮次，使用标签分布相关边界损失函数/＞训练多分类模型/＞，使用随机梯度下降来进行反向传播并更新模型网络参数；S42：在训练轮次到训练轮次/＞，使用样本数量对损失函数进行重赋权，使用在归一化的学习率的随机梯度下降优化器优化多分类模型/＞；S43：通过多分类模型输出结果：，其中，/＞是一个k维向量，诊断的类别/＞，其中k表示样本的类别数量，置信度/＞最高的类别为最终诊断类别。一种基于两阶段学习的钻井异常工况诊断系统，用以实现上述所述的一种基于两阶段学习的钻井异常工况诊断方法，包括数据处理模块、异常检测模型和不均衡多分类模型，其中，数据处理模块，用以处理随钻录井参数，对每个特征通道采用滑动窗口进行多尺度划分，得到分块；常检测模型，用以进行第一阶段的异常检测，学习分块之间和分块内部两种数据表示，并计算两者之间的差异，给出异常判断；不均衡多分类模型，用以进行第二阶段的不均衡多分类，结合标签分布相关边界损失函数和延迟重赋权训练，达到对异常结果的识别。一种计算机程序产品，包括计算机程序，该计算机程序被处理器执行时，实现上述所述的一种基于两阶段学习的钻井异常工况诊断方法。一种计算机可读存储介质，所述存储介质存储有计算机程序，所述计算机程序被处理器执行时，实现上述所述的一种基于两阶段学习的钻井异常工况诊断方法。本发明的有益效果在于：本发明利用两阶段学习的思想解决实际的钻井样本不均衡导致的异常识别准确率低的问题。首先对已经获取的钻井工况进行数据预处理包括特征筛选、时序数据插值、钻井工况编码；然后使用滑动窗口将时序数据划分成固定长度的小序列，用于捕捉时序序列的局部信息。将固定长度的小序列输入到两个具有相同注意力的网络分支。这两个分支共享网络权重，但是计算过程不共享，一个分支学习不同固定长度的小序列之间的关系，得到一种表示，另一个网络学习固定长度小序列内部的关系，得到另一种表示。通过对比两种不同视角的表示，正常点两种表示接近，异常点两种表示差异大，从而进行有效的钻井工况检测。实现一阶段的异常检测，对于第二阶段将标签分布相关边界损失函数替换原来的交叉熵损失函数，使得模型更加偏向于小样本数据，在使用延迟重赋权训练用于诊断不均衡钻井异常数据的多分类模型ResNet32，从而达到对异常结果的准确识别。根据识别模型的判断及时有效的采取措施可以有效的防止事故的发生。附图说明为了更清楚地说明本发明实施例或现有技术中的技术方案，下面将对实施例或现有技术描述中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本发明的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图示出的结构获得其他的附图。图1为本发明流程图；图2为双头注意力对比表示学习网络结构图；图3为多分类模型网络结构图。具体实施方式为使本发明实施例的目的、技术方案和优点更加清楚，下面将结合本发明实施例中的附图，对本发明实施例中的技术方案进行清楚、完整地描述，显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。通常在此处附图中描述和示出的本发明实施例的组件可以以各种不同的配置来布置和设计。应注意到：相似的标号和字母在下面的附图中表示类似项，因此，一旦某一项在一个附图中被定义，则在随后的附图中不需要对其进行进一步定义和解释。下面结合附图，对本发明的一些实施方式作详细说明。在不冲突的情况下，下述的实施例及实施例中的特征可以相互组合。参见图1至图3，一种基于两阶段学习的钻井异常工况诊断方法，包括如下步骤：S1：处理随钻录井参数，对每个特征通道采用滑动窗口进行多尺度划分，划分得到的数据属于整个数据的一部分，定义为分块。分块用于获取不同粒度的局部信息。S2：用双分支注意力网络,分别学习分块之间和分块内部两种数据表示。S3：计算分块之间的数据表示和分块内部的数据表示之间的差异。S4：计算异常数据，并给出异常判断。S5：将判断出的异常钻井数据和正常钻井数据重新整理到新的数据集中。S6：在训练轮次1到指定训练轮次使用标签分布相关边界损失函数训练多分类模型/＞，使用随机梯度下降来进行反向传播并更新模型网络参数。S7：在训练轮次到训练轮次/＞使用样本数量对损失函数进行重赋权，使用在归一化的学习率的随机梯度下降优化器优化模型。S8：通过多分类模型计算得出异常类别向量。需要说明的是，附图2中，K表示键，Q表示查询，HX表示注意力网络层，分块i表示将原数据分成i块；附图3中，*5表示有五层，*4表示有四层。在本实施例当中，步骤S1包括以下子步骤：S11：采用三次样条插值将不同钻井采样点的原始数据时间间隔统一，并进行归一化处理。S12：记原始的随钻录井数据为，其中/＞表示实数集，/＞为随钻录井数据的长度，/＞为随钻录井数据的维度，滑动窗口的大小，即为读取数据的长度，分别设置为2,3,5,每个长度的滑动窗口所采样的数据记为一个分块,提供给步骤S2计算分块间之间的数据表示；每一个分块由多个特征通道组成，组成分块的所有特征通道记为分块内，提供给步骤S2计算每一个分块内部的数据表示。S13：步骤S12将随钻录井数据原始数据处理为，其中/＞表示实数集，/＞为分块的尺寸，/＞为分块的个数，/＞为特征通道数。特征通道信息与分块的维度进行融合，将输入的随钻录井数据变为/＞。在本实施例当中，步骤S2包括以下子步骤：S21：将每一个分块视为一个单元，通过多头自注意力网络对分块之间的关系进行建模。具体的，将原维度为的分块嵌入一个形状为/＞的维度，其中/＞表示实数集，/＞表示网络层的维度，/＞表示分块的个数。通过多头注意力网络的参数权重来计算分块间的数据表示。首先，初始化查询和键，公式如下：，其中表示第i个分块，/＞为查询，/＞为键，为/＞的可学习参数矩阵，/＞为/＞的可学习参数矩阵，/＞表示实数集，/＞表示注意力网络的头数，/＞为分块的个数，/＞为网络层的维度。计算注意力权重，公式如下：，其中表示用来归一化注意力权重的函数，/＞为第i个分块的注意力权重，/＞为查询，/＞为键的转置，/＞为网络层的维度，/＞表示实数集，/＞表示注意力网络的头数，/＞为分块的个数，最后将多头注意力网络得到的注意力权重结合起来得到分块间的数据表示，记为/＞，公式如下：，其中表示连接，/＞为一个可学习参数矩阵，/＞为网络层的维度，/＞表示实数集。S22：通过多头自注意力网络对分块内的数据之间的关系进行建模。具体的，将原维度为N的分块内嵌入一个形状为的维度。其中/＞表示实数集，/＞表示网络层的维度，/＞表示分块的尺寸。通过多头注意力网络的参数权重来计算分块内的数据表示。首先，初始化查询和键，计算公式如下：,其中表示第i个分块内，/＞为查询，/＞为键，为/＞的可学习参数矩阵，/＞为/＞的可学习参数矩阵，表示实数集，/＞表示注意力网络的头数，/＞为分块的个数，/＞为网络层的维度。然后计算注意力权重，计算公式如下：，其中表示用来归一化注意力权重的函数，/＞为第i个分块的注意力权重，/＞为查询，/＞为键的转置，/＞为网络层的维度，/＞表示实数集，/＞表示注意力网络的头数，/＞为分块尺寸，最后将多头注意力网络得到的注意力权重结合起来得到分块内的数据表示，记为/＞，公式如下：，其中表示连接，/＞为一个可学习参数矩阵，/＞为网络层的维度，/＞表示实数集。对于分块间自注意力表示网络和分块内自注意力表示网络，他们共享权重/＞。S23：将不同尺度下的分块的数据表示映射到原始时间序列的形状中，对于分块间分支，使用重复分块的方式进行上采样，对于分块内分支，使用重复分块内的点的方式进行上采样。将分块间分支的数据表示求和得到分块间最终的数据表示，记为N，将分块内分支的数据表示求和得到分块内最终的数据表示，记为，计算公式如下：，/＞，其中表示上采样，/＞表示分块集合，/＞表示分块内的数据表示，/＞表示分块间的数据表示。在本实施例当中，步骤S3包括以下子步骤：S31：使用一个基于库尔贝克-莱布勒散度的损失函数来衡量这两种表示的相似性。损失函数的形式如下：，其中X表示输入的时间序列，为分快内的数据表示，N为分块间的数据表示，表示在自注意力网络中实行梯度停止的策略，/＞表示两个输出向量/＞和N的相似性度量，计算公式如下：，S32：反复执行步骤S2和步骤S3，使用梯度下降法和梯度停止法异步更新双注意力对比网络，通过优化器最小化损失函数，进行模型训练。在本实施例当中，步骤S4包括以下子步骤：S41：定义原始随钻录井数据，异常得分记为/＞，计算公式如下：，为实数集，/＞为随钻录井数据的长度，/＞为随钻录井数据的维度，/＞表示输入的时间序列，/＞为分快内的数据表示，/＞为分块间的数据表示，/＞表示两个输出向量/＞和/＞的相似性度量，计算公式如下：，S42：基于逐个数据点的异常得分，记为/＞，设置一个超参数用来决定一个点是否是异常，即一个点的异常得到超过/＞表示异常，记为1，否则为正常点，记为0，详情如下：。在本实施例当中，步骤S5具体为： 将第一阶段识别的异常数据重新组合为数据集D1，将第一阶段识别为正常的数据重新组合为数据集D2，具体的如下：对于任意录井参数，其中x表示特征向量，y表示标签：如果，则将该样本加入集合/＞，即/＞；如果，则将该样本加入集合/＞，即/＞。在本实施例当中，步骤S6包括以下子步骤：S61：将异常钻井数据用大小为100的滑动窗口取值存为新的数据，记为D。S62：初始化多分类模型的权重参数/＞。S63：在训练轮次1到指定训练轮次重复执行步骤。S64: 随机从数据集D中抽取m个样本，组成小批次数据B。S65: 计算标签分布相关边界损失函数，计算公式如下：，其中表示多分类模型/＞对于数据属于第j类的置信度。/＞表示输入的样本集合，/＞代指置信度函数，/＞代指类别为y的置信度，其中/＞，C是常量，k表示样本的类别数量，/＞为类别y的样本数量。S66：更新损失函数，更新公式如下：，其中m表示样本数量，B表示从数据集中抽取的m个数据集合，表示第y类样本的数量，/＞表示多分类模型/＞的权重参数。S67：使用随机梯度下降优化更新模型，更新模型参数的公式如下：，其中表示学习率，/＞表示损失函数/＞相对于权重参数/＞的梯度。S68：更新学习率，公式如下：，其中是一个常数。在本实施例当中，步骤S7包括以下子步骤：S71：在训练轮次到训练轮次/＞重复执行S72、S73、S74、S75步骤。S72：随机从数据集D中抽取m个样本，组成小批次数据集B。S73：计算标签分布相关边界损失函数，计算公式如下：，其中表示多分类模型/＞对于数据属于第j类的置信度。/＞表示输入的样本集合，其中/＞，C是常量。S74：使用频率对损失函数重新加权更新，更新公式如下：，其中m表示样本数量，B表示从数据集中抽取的m个数据集合，表示第y类样本的数量，/＞表示多分类模型/＞的权重参数。S75：更新多分类模型参数，公式如下：，其中表示学习率，/＞表示损失函数/＞相对于权重参数/＞的梯度，/＞表示第y类样本的数量，/＞表示输入的样本集合，B表示从数据集中抽取的m个数据集合。在本实施例当中，步骤S8具体为： 结合标签分布相关边界损失函数和延迟重赋权训练用于诊断不均衡钻井异常数据的多分类模型，其输出/＞，其中，/＞是一个k维向量，诊断的类别/＞，其中k表示样本的类别数量，也就是说置信度Z最高的类别为最终诊断类别。本发明还提供了一种基于两阶段学习的钻井异常工况诊断系统，用以实现上述所述的一种基于两阶段学习的钻井异常工况诊断方法，包括数据处理模块、异常检测模型和不均衡多分类模型，其中，数据处理模块，用以处理随钻录井参数，对每个特征通道采用滑动窗口进行多尺度划分，得到分块；常检测模型，用以进行第一阶段的异常检测，学习分块之间和分块内部两种数据表示，并计算两者之间的差异，给出异常判断；不均衡多分类模型，用以进行第二阶段的不均衡多分类，结合标签分布相关边界损失函数和延迟重赋权训练，达到对异常结果的识别。本发明还提供了一种计算机程序产品，包括计算机程序，该计算机程序被处理器执行时，实现上述所述的一种基于两阶段学习的钻井异常工况诊断方法。本发明还提供了一种计算机可读存储介质，所述存储介质存储有计算机程序，所述计算机程序被处理器执行时，实现上述所述的一种基于两阶段学习的钻井异常工况诊断方法。本发明将异常检测和不均衡多分类共同用于钻井异常工况诊断，将已有的交叉熵损失函数修改为标签分布相关边界损失函数，增强与少数类有关的分类器，并使用延迟在赋权的训练方式，使模型在分类结果上面表现的更好。对于前述的实施例，为了简单描述，故将其都表述为一系列的动作组合，但是本领域技术人员应该知悉，本申请并不受所描述的动作顺序的限制，因为依据本申请，某一些步骤可以采用其他顺序或者同时进行。其次，本领域技术人员也应该知悉，说明书中所描述的实施例属于优选实施例，所涉及的动作并不一定是本申请所必须的。上述实施例中，描述了本发明的基本原理和主要特征和本发明的优点。本行业的技术人员应该了解，本发明不受上述实施例的限制，上述实施例和说明书中描述的只是说明本发明的原理，在不脱离本发明精神和范围的前提下，本领域人员所进行的改动和变化不脱离本发明的精神和范围，则都应在本发明所附权利要求的保护范围内。
