标题title
一种防夹模块升降系统阻力自学习方法
摘要abst
本发明公开了一种高效可靠的电动车窗玻璃上升下降阻力参数自学习方法，属于车载电子技术领域，包括进行阻力更新的条件设定，考虑了车窗玻璃电机的运动状态与运动方向，车窗玻璃的启动位置，防夹范围的覆盖情况，更加合理的进行阻力更新，从而可以使得车窗防夹功能更好的实现；设定了初始化过程和初始化完成后的阻力更新，当阻力的波动达到了数个条件才进行阻力的更新。本发明的触发条件及阻力值更新条件可靠有效，能够满足车辆使用时对于电动车窗防夹功能的要求。
权利要求书clms
1.一种防夹模块升降系统阻力自学习方法，其特征在于，包括：步骤1：判断电机的电压波动是否超过了当前所在的范围，若是则进入步骤2，若否则进入步骤3；步骤2：清除初始化过程完成标志；步骤3：对于电机的电压设定数个电压范围，为各电压范围赋予第一阈值和第二阈值；步骤4：判断开关给予的是否是上升信号且车窗初始位置是否在防夹范围以下，或者，判断开关给予的是否是下降信号且车窗初始位置是否在防夹范围以上，若开关给予的是上升信号且车窗初始位置在防夹范围以下，或者，开关给予的是下降信号且车窗初始位置在防夹范围以上，则进入步骤5，若否则进入步骤11；步骤5：判断在防夹范围内的开关是否给予了停止命令或者车窗是否遇到障碍，若在防夹范围内的开关给予了停止命令或者车窗遇到障碍，则进入步骤11，若否则进入步骤6；步骤6：判断走完了防夹范围后电机是否过热，若是则进入步骤11，若否则进入步骤7；步骤7：判断初始化过程是否完成，若是则进入步骤9，若否则进入步骤8；步骤8：将此次过程记录的阻力值存储到自学习数据中，发送初始化过程完成标志；步骤9：将此次过程的阻力值与自学习基值作数据处理后的值与第一阈值作比较；步骤10：判断步骤9的结果大于阈值的次数是否超过了第二阈值，若是则进入步骤8，若否则进入步骤11；步骤11：退出。2.根据权利要求1所述的方法，其特征在于，步骤9包括：将此次过程的阻力值与自学习基值作差后与自学习基值作比值，乘N后取绝对值，把得到的结果值中最大的若干个数用一个数组存储，并求这若干个数的平均值，将平均值与第一阈值进行比较。3.根据权利要求1或2所述的方法，其特征在于，步骤9和步骤10中所设阈值根据车窗电机电压的波动而改变。4.根据权利要求3所述的方法，其特征在于，步骤4、步骤5和步骤6为进行自学习初始化过程和阻力值更新的前提。
说明书desc
技术领域本发明属于车载电子技术领域，更具体地，涉及一种防夹模块升降系统阻力自学习方法。背景技术目前的家用汽车车窗是电动的，即通过车窗按钮控制车窗电机的旋转，从而带动车窗玻璃上升或下降。通常电动车窗也都具有一键上升下降及防夹功能。防夹功能的实现方法有很多，但条件都是车窗玻璃在上升过程中遇到障碍物，导致电机堵转，从而引发其他相关变量发生变化。考虑到车辆在使用过程中，车窗部位参数会随着橡胶老化、结构件磨损、温度湿度等状况的影响而发生改变，诸如此类的变化会引起车窗玻璃上升下降的阻力发生变化，因此车辆出厂时的防夹参数显然不能是一成不变的，需要实时的根据车辆现状更新相关的防夹参数。发明内容为了解决车辆在使用过程中，车窗部位参数会随着橡胶老化、结构件磨损、温度湿度等状况的影响而发生改变，而诸如此类的变化会引起车窗玻璃上升下降的阻力发生变化，从而影响电动车窗防夹功能的实现问题，本发明提供了一种防夹模块升降系统阻力自学习方法，可以对车窗升降阻力进行实时更新，并且考虑到车窗电机的电压波动产生的影响，可以为相应的防夹方法提供准确的阻力基值，提高电动车窗防夹功能的可靠性。为实现上述目的，本发明提供了一种防夹模块升降系统阻力自学习方法，包括：步骤1：判断电机的电压波动是否超过了当前所在的范围，若是则进入步骤2，若否则进入步骤3；步骤2：清除初始化过程完成标志；步骤3：对于电机的电压设定数个电压范围，为各电压范围赋予第一阈值和第二阈值；步骤4：判断开关给予的是否是上升信号且车窗初始位置是否在防夹范围以下，或者，判断开关给予的是否是下降信号且车窗初始位置是否在防夹范围以上，若开关给予的是上升信号且车窗初始位置在防夹范围以下，或者，开关给予的是下降信号且车窗初始位置在防夹范围以上，则进入步骤5，若否则进入步骤11；步骤5：判断在防夹范围内的开关是否给予了停止命令或者车窗是否遇到障碍，若在防夹范围内的开关给予了停止命令或者车窗遇到障碍，则进入步骤11，若否则进入步骤6；步骤6：判断走完了防夹范围后电机是否过热，若是则进入步骤11，若否则进入步骤7；步骤7：判断初始化过程是否完成，若是则进入步骤9，若否则进入步骤8；步骤8：将此次过程记录的阻力值存储到自学习数据中，发送初始化过程完成标志；步骤9：将此次过程的阻力值与自学习基值作数据处理后的值与第一阈值作比较；步骤10：判断步骤9的结果大于阈值的次数是否超过了第二阈值，若是则进入步骤8，若否则进入步骤11；步骤11：退出。在一些可选的实施方案中，步骤9包括：将此次过程的阻力值与自学习基值作差后与自学习基值作比值，乘N后取绝对值，把得到的结果值中最大的若干个数用一个数组存储，并求这若干个数的平均值，将平均值与第一阈值进行比较。在一些可选的实施方案中，步骤9和步骤10中所设阈值根据车窗电机电压的波动而改变。在一些可选的实施方案中，步骤4、步骤5和步骤6为进行自学习初始化过程和阻力值更新的前提。总体而言，通过本发明所构思的以上技术方案与现有技术相比，能够取得下列有益效果：因为车辆的工况是随时变化的，因此车窗电机的电压是波动的，对电机外特性会产生影响，从而影响电机所受阻力值的输出，本发明考虑到了此状况，设定了相应的更新初始化过程。本发明中的自学习阻力值的更新可以做到针对性的对那些诸如玻璃橡胶老化、结构件磨损等对车窗玻璃上升下降产生持续性影响的情况，进行升降阻力的更新，从而在保证车窗玻璃升降阻力的实时性同时，避免因为一些偶然性的特殊情况使得自学习数据错误的情况。本发明适用于各类基于电机驱动力实现防夹功能的算法，包括波纹防夹、霍尔防夹等算法。附图说明图1是本发明实施例提供的一种防夹模块升降系统阻力自学习方法的实现示意图；图2是本发明实施例提供的一种防夹模块升降系统阻力自学习方法的流程示意图；其中，1-车门；2-门框；3-车门玻璃；①-初始化过程；②-阻力更新过程。具体实施方式为了使本发明的目的、技术方案及优点更加清楚明白，以下结合附图及实施例，对本发明进行进一步详细说明。应当理解，此处所描述的具体实施例仅仅用以解释本发明，并不用于限定本发明。此外，下面所描述的本发明各个实施方式中所涉及到的技术特征只要彼此之间未构成冲突就可以相互组合。在本发明实例中，“第一”、“第二”等是用于区别不同的对象，而不是用于描述特定的顺序或先后次序。本发明的基本原理如下：在车窗电机中安装有霍尔传感器，霍尔传感器会随着电机运转实时的发出霍尔脉冲信号，霍尔脉冲数与电机的运转正相关，电机每转一圈会产生数量一定的脉冲数。同时脉冲的脉宽值与电机受力正相关。因此可以用脉冲数获取车窗位置信息，用脉宽值获取车窗阻力信息。如图1及图2所示，本发明的防夹模块升降系统阻力自学习方法，进入条件考虑了车窗电机的电压波动，对于电机的电压设定了数个电压范围，每个电压范围对应不同的阈值；使用第1级阻力更新条件：将当前阻力与自学习基值作数据处理后的值与所设阈值作比较，只有其大于阈值才进入下一级的阻力更新判断，处理方法见下述步骤9；使用第2级阻力更新条件：当第1级条件满足，则开始累计次数，当累计次数达到所设阈值，则进行自学习阻力基值的更新。具体可以通过以下步骤实现：步骤1：判断电机的电压波动是否超过了当前所在的范围，若是则进入步骤2，若否则进入步骤3；在步骤1中，当前所在的范围根据电机外特性确定，不同电压范围的电机外特性有一定差异，会导致正常脉宽值有差异。步骤2：清除初始化过程完成标志；步骤3：对于电机的电压设定数个电压范围，为各电压范围赋予第一阈值和第二阈值；其中，第一阈值和第二阈值大小不同，其是根据车门开发中，通过建模实现，通过模型仿真及之后的车门实物测试，通过分析各种工况及场景的测试结果，考虑灵敏性及稳定性来设定这两个阈值。步骤4：判断开关给予的是否是上升信号且车窗初始位置是否在防夹范围以下，或者，判断开关给予的是否是下降信号且车窗初始位置是否在防夹范围以上，若开关给予的是上升信号且车窗初始位置在防夹范围以下，或者，开关给予的是下降信号且车窗初始位置在防夹范围以上，则进入步骤5，若否则进入步骤11；步骤5：判断在防夹范围内的开关是否给予了停止命令或者车窗是否遇到障碍，若在防夹范围内的开关给予了停止命令或者车窗遇到障碍，则进入步骤11，若否则进入步骤6；步骤6：判断走完了防夹范围后电机是否过热，若过热则进入步骤11，若否则进入步骤7；其中，步骤1、3、4、5、6即图1示意图中的S1、S3、S4、S5、S6，即‘条件’。步骤7：判断初始化过程是否完成，若是则进入步骤9，若否则进入步骤8；步骤8：将此次过程记录的阻力值存储到自学习数据中，发送初始化过程完成标志；其中，步骤8即S8，上述步骤即图1中的①，即初始化过程。步骤9：将此次过程的阻力值与各对应位置的自学习基值作差后与自学习基值作比值，乘100后取绝对值，把得到的结果值中最大的10个数用一个数组存储，并求这10个数的平均值，将平均值与第一阈值进行比较；其中，自学习基值表示上一次更新存储的自学习值。其中，车窗电机运转过程中，每产生一个脉冲，则更新一次数组，同时计算一次平均值，只有累积阻力变化才会触发算法，因此在防夹范围内的数据处理是一个动态过程，随着车窗的运动而不断进行着阻力更新条件的判断和累计，因此可以避免一些偶然性的阻力变化使得自学习阻力数据错误的情况，保证了算法的可靠性。步骤10：判断步骤9的结果大于阈值的次数是否超过了第二阈值，若是则进入步骤8，若否则进入步骤11；其中，说明：步骤9、10即S9、S10，如图1中②所示，步骤9、10、8在满足条件的前提下完成阻力更新过程。步骤11：退出本算法。其中，步骤9和步骤10中所设阈值根据车窗电机电压的波动而改变，从而保证阻力基值更新的准确性。其中，步骤4、步骤5和步骤6为进行自学习初始化过程和阻力值更新的前提，条件的设定能够保证所获得的阻力值是正确合理的，从而保证算法的稳定性。需要指出，根据实施的需要，可将本申请中描述的各个步骤/部件拆分为更多步骤/部件，也可将两个或多个步骤/部件或者步骤/部件的部分操作组合成新的步骤/部件，以实现本发明的目的。本领域的技术人员容易理解，以上所述仅为本发明的较佳实施例而已，并不用以限制本发明，凡在本发明的精神和原则之内所作的任何修改、等同替换和改进等，均应包含在本发明的保护范围之内。
