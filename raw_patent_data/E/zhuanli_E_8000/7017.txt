标题title
一种基于软件滤波的电动车窗电流纹波防夹控制方法
摘要abst
本发明公开了一种基于软件滤波的电动车窗电流纹波防夹控制方法，所述方法包括如下步骤：步骤一：系统参数的确定；步骤二：参数自适应学习；步骤三：车窗位置识别；步骤四：车窗位置补偿；步骤五：根据车窗位置与滤波后的电机电流确定并实施防夹方案。该方法无需安装霍尔传感器及其相关电路，采用软件滤波提取纹波信号，识别车窗位置，可灵活匹配不同的车窗机构和电机，并能够自适应调整滤波器参数，实现低成本、高精度的车窗位置信号提取；进一步，在电流纹波提取的基础上，计算车窗电机电流的直流分量，用电机电流的直流分量作为防夹控制系统的输入，有效降低了车窗误防夹的概率。
权利要求书clms
1.一种基于软件滤波的电动车窗电流纹波防夹控制方法，其特征在于所述方法包括如下步骤：步骤一：系统参数的确定系统参数包括电机旋转一周产生的纹波个数N、电机参数、采样频率ωs、车窗行程；电机参数包括电机电阻R、电机反电动势系数ke和电机电感L；步骤二：参数自适应学习步骤二一、车窗电机电流信号滤波处理使用滤波器将电流信号分解为低频信号与高频信号，其中低频信号为稳定电流信号，高频信号为纹波电流信号；步骤二二、车窗电机电阻自学习使车窗电机堵转，根据欧姆定律即可得到更新的电机电阻R；步骤二三、车窗电机纹波幅值自学习根据步骤二一中获得的纹波电流信号，统计纹波电流信号在完整行程内的累计上升值Nup和累计下降值Ndown，再根据纹波个数得到平均的纹波幅值ia；步骤三：车窗位置识别步骤三一、在车窗上升的过程中，使用分段软件滤波的方式得到纹波电流信号，即每X个电流采样点进行一次软件滤波，在电流信号中提取出纹波电流信号；步骤三一、累计统计纹波电流信号的上升值和下降值，当累计的上升值和下降值均高于n*ia时，纹波统计个数加一，n为系数，0＜n＜1，用于调控纹波幅值进行纹波个数计数；步骤四：车窗位置补偿步骤四一、当车窗电机稳定运行时，根据测量的电压、电流值与步骤一中确定的电机电阻、反电动势系数估计出电机转速；步骤四二、根据电机转速，即可估计得到理论上的纹波持续时间Te，当两纹波计数相距时间过短，小于a*Te时，认为因电流波动统计了假纹波，纹波计数减一；当两纹波计数相距时间过长，大于b*Te时，认为两纹波中有一纹波未被统计，纹波计数加一，其中，a、b均为系数，0＜a＜1，1＜b＜2；步骤五：根据车窗位置与滤波后的电机电流确定并实施防夹方案在车窗上升的过程中，根据纹波确定的位置判断车窗是否处于防夹区域，根据滤波后电机电流判断车窗是否发生夹持；当车窗上升至防夹区域发生夹持时，启动防夹方案使车窗下降。2.根据权利要求1所述的基于软件滤波的电动车窗电流纹波防夹控制方法，其特征在于所述电机旋转一周产生的纹波个数N由电机参数直接获取或通过以下公式得到：N＝ω1/ω；其中，ω1为电机纹波电流频率。3.根据权利要求1所述的基于软件滤波的电动车窗电流纹波防夹控制方法，其特征在于所述电机反电动系数ke的计算公式为：ke＝/ω。4.根据权利要求1所述的基于软件滤波的电动车窗电流纹波防夹控制方法，其特征在于所述电机电感L的计算公式为：L＝∫U-Ri-keωdt/i。5.根据权利要求1所述的基于软件滤波的电动车窗电流纹波防夹控制方法，其特征在于所述采样频率ωs＞2ω1，ω1为电机纹波电流频率。6.根据权利要求1所述的基于软件滤波的电动车窗电流纹波防夹控制方法，其特征在于所述纹波幅值ia的计算公式为：ia＝/；其中，Nr为一次完整行程车窗电机应产生的电流纹波个数。7.根据权利要求6所述的基于软件滤波的电动车窗电流纹波防夹控制方法，其特征在于所述电流纹波个数Nr的计算公式为：Nr＝Nm*N；其中，Nm为电机旋转圈数。8.根据权利要求1、2或3所述的基于软件滤波的电动车窗电流纹波防夹控制方法，其特征在于所述电机转速ω的计算公式如下：ω＝/ke。9.根据权利要求1所述的基于软件滤波的电动车窗电流纹波防夹控制方法，其特征在于所述理论上的纹波持续时间Te的计算公式如下：Te＝2π/。10.根据权利要求1所述的基于软件滤波的电动车窗电流纹波防夹控制方法，其特征在于所述车窗防夹区域在距离底部200mm至距离顶部4mm的范围内。
说明书desc
技术领域本发明属于汽车车身域控制技术领域，涉及一种电动车窗电流纹波防夹控制方法，具体涉及一种基于软件滤波的电动车窗电流纹波防夹控制方法。背景技术随着近年来人们对汽车安全的要求越来越高，电动车窗防夹功能已经成为汽车的基本功能之一。目前，车窗防夹控制系统的实现方式主要有非接触式与接触式两种。非接触式车窗防夹控制系统主要使用红外传感器来实现车窗防夹判断，其优点是不受车窗振动和空气动力学变化等因素的影响。然而，其要求有集成的传感器以及相关的电路模块和线路，这在增加了成本的同时也限制了车门的样式。此外，在恶劣的气候条件下，红外系统很难保证正常工作，不适于汽车苛刻性的可靠要求。接触式车窗防夹控制系统主要使用霍尔元件来实现车窗防夹的位置判断，是目前主流的车窗防夹控制系统。相比于非接触式车窗防夹系统，此方案的成本较低，然而其也需要安装霍尔传感器及其相关电路来获取车窗的位置信号，且增加的传感器和电路也会给系统的可靠性带来问题。在接触式车窗防夹控制系统的基础上，为了进一步降低成本并简化传感器的安装，无霍尔传感器车窗防夹控制系统被提出。目前的无霍尔传感器车窗防夹控制系统主要是通过硬件电路滤波得到纹波信号，再跟据车窗电机纹波信号来实现防夹判断。该方案的主要缺点是硬件滤波电路与电机的具体特性和参数相关，且同一电机处于不同阶段时的特性均不尽相同，硬件滤波方法无法灵活调整滤波参数，影响滤波效果，进而影响防夹性能。此外，现有的接触式车窗防夹控制技术主要使用电机电流判断夹紧力的大小。由于电机电流纹波的存在，现有车窗防夹控制技术对于夹紧力的判断一致性较差，如果再叠加其他干扰因素，防夹误判断的概率增大。发明内容为解决上述技术存在的不足，本发明提供了一种基于软件滤波的电动车窗电流纹波防夹控制方法，该方法无需安装霍尔传感器及其相关电路，采用软件滤波提取纹波信号，识别车窗位置，可灵活匹配不同的车窗机构和电机，并能够自适应调整滤波器参数，实现低成本、高精度的车窗位置信号提取；进一步，在电流纹波提取的基础上，计算车窗电机电流的直流分量，用电机电流的直流分量作为防夹控制系统的输入，有效降低了车窗误防夹的概率。本发明的目的是通过以下技术方案实现的：一种基于软件滤波的电动车窗电流纹波防夹控制方法，包括如下步骤：步骤一：系统参数的确定系统参数包括电机旋转一周产生的纹波个数N、电机参数、采样频率ωs、车窗行程；电机参数包括电机电阻R、电机反电动势系数ke和电机电感L；系统参数用于步骤三、步骤四中的车窗位置识别和位置补偿；步骤二：参数自适应学习步骤二一、车窗电机电流信号滤波处理使用滤波器将电流信号分解为低频信号与高频信号，其中低频信号为稳定电流信号，高频信号为纹波电流信号；步骤二二、车窗电机电阻自学习使车窗电机堵转，根据欧姆定律即可得到更新的电机电阻R；步骤二三、车窗电机纹波幅值自学习根据步骤二一中获得的纹波电流信号，统计纹波电流信号在完整行程内的累计上升值Nup和累计下降值Ndown，再根据纹波个数得到平均的纹波幅值ia为：ia＝/；其中，Nr为一次完整行程车窗电机应产生的电流纹波个数；自适应学习的参数用于步骤三、步骤四中的车窗位置识别和位置补偿，在系统初次运行以及由于环境变化运行精度不再满足要求时需进行参数自学习操作；步骤三：车窗位置识别在车窗上升的过程中，使用分段软件滤波的方式得到纹波电流信号，即每X个电流采样点进行一次软件滤波，在电流信号中提取出纹波电流信号累计统计纹波电流信号的上升值和下降值，当累计的上升值和下降值均高于n*ia时，纹波统计个数加一，n为系数，0＜n＜1，用于调控纹波幅值进行纹波个数计数；车窗运动距离与纹波个数呈正比例关系，依据此方法即可得到车窗运行的大致距离，根据步骤四中的补偿机制可以得到较为精确的车窗运动距离；步骤四：车窗位置补偿步骤四一、当车窗电机稳定运行时，根据测量的电压、电流值与步骤一中确定的电机电阻、反电动势系数估计出电机转速ω，其计算公式如下：ω＝/ke；步骤四二、根据电机转速ω，即可估计得到理论上的纹波持续时间：Te＝2π/；其中，Te代表理论上的纹波持续时间，当两纹波计数相距时间过短，小于a*Te时，认为因电流波动统计了假纹波，纹波计数减一；当两纹波计数相距时间过长，大于b*Te时，认为两纹波中有一纹波未被统计，纹波计数加一，其中，a、b均为系数，0＜a＜1，1＜b＜2；此补偿机制在步骤三的基础上引入了基于时间的纹波补偿，可以得到相较步骤三更为精确的纹波个数，进而得到更精确的车窗运行距离，根据车窗初始位置和运动距离即可确定车窗的位置；步骤五：根据车窗位置与滤波后的电机电流确定并实施防夹方案在车窗上升的过程中，根据纹波个数确定车窗位置，进而判断车窗是否处于防夹区域，根据滤波后电机电流判断车窗是否发生夹持，当车窗上升至防夹区域发生夹持时，启动防夹方案使车窗下降至底部。相比于现有技术，本发明具有如下优点：无霍尔传感器车窗防夹控制系统节省了霍尔传感器及其相关电路，降低了硬件成本；采用软件滤波方法，使得系统的滤波参数可以灵活调整，可灵活匹配不同的车窗机构和电机，并能够自适应调整滤波器参数，增强了系统的普适性；使用滤波后的电机电流判断是否发生夹持，使防夹判断更加稳定，有效降低了车窗误防夹的概率。附图说明图1是本发明基于软件滤波的电动车窗电流纹波防夹控制方法的流程框图；图2是高频电机电流频谱；图3是一个上升行程内车窗电机电流图；图4是小波滤波的纹波电流图；图5是小波滤波的直流电流图。具体实施方式下面结合附图对本发明的技术方案作进一步的说明，但并不局限于此，凡是对本发明技术方案进行修改或者等同替换，而不脱离本发明技术方案的精神和范围，均应涵盖在本发明的保护范围中。本发明提供了一种基于软件滤波的电动车窗电流纹波防夹控制方法，如图1所示，所述方法包括如下步骤：步骤一：系统参数的确定系统开发前需进行此步骤，系统参数的确定具体包括：1)电机旋转一周产生的纹波个数电机旋转一周产生的纹波个数可以由电机参数直接获取，也可以通过实验的方法确定。采用实验方法，需要一个电机位置的传感器如霍尔传感器、编码器等来记录电机转速，再对电机纹波电流进行频谱分析，将两组频率进行比较，即可获得电机旋转一周产生的纹波个数，其具体关系为：N＝ω1/ω；其中，N为电机旋转一周产生的纹波个数，ω1为电机纹波电流频率，ω为电机转速。2)电机内部参数车窗电机通常可以描述为：其中，U表示电机电压，R表示电机电阻，i表示电机电流，L表示电机电感，ke表示电机反电动势系数。当电机稳定运行或堵转时，电流变化率可近似为0，则上式可表示为：U＝Ri+keω；堵转时，电机转速为零，可通过电机电压电流计算得知电机电阻R：R＝U/i；再根据稳定运行期间的电压、电流计算得到的电机电阻和传感器测得的电机转速即可得到电机反电动系数ke，具体计算公式为：ke＝/ω；其他参数均已确定，即可计算出电机电感值：L＝∫U-Ri-keωdt/i。3)采样频率根据香农采样定律，采样频率需大于信号频率的二倍，故对于采样频率ωs有：ωs＞2ω1。4)车窗行程车窗电机进行一次完整行程，以上升为例，即让车窗从下堵转处上升至上堵转处，通过霍尔传感器或者编码器记录完整行程内电机旋转圈数Nm。则进行一次完整行程时，车窗电机应产生的电流纹波个数为：Nr＝Nm*N；其中，Nr为一次完整行程车窗电机应产生的电流纹波个数。步骤二：参数自适应学习当系统第一次运行或系统运行环境发生较大变化时需要进行此步骤，参数自适应学习包括：步骤二一、车窗电机电流信号滤波处理使用滤波器将电流信号分解为低频信号与高频信号，其中低频信号为稳定电流信号，高频信号为纹波电流信号，纹波电流信号用于车窗电机纹波幅值自学习。步骤二二、车窗电机电阻自学习受到电机温度与电机老化的影响，车窗电机的电阻值可能会偏离标定值，此时需要对电机电阻值进行自适应更新，具体方法为：使车窗电机堵转，根据欧姆定律即可得到更新的电机电阻R：R＝U/i；步骤二三、车窗电机纹波幅值自学习根据步骤二一中获得的纹波电流信号，统计纹波电流信号在完整行程内的累计上升值Nup和累计下降值Ndown，再根据纹波个数可以得到平均的纹波幅值ia为：ia＝/；得到平均的纹波幅值ia被用于步骤三中的纹波判定。步骤三：车窗位置识别在车窗上升的过程中，考虑到单片机有限的存储空间、车窗位置实时性的需求以及计算能力的限制，使用分段软件滤波的方式得到纹波电流信号，即每X个电流采样点进行一次软件滤波，在电流信号中提取出纹波电流信号，X应根据软件滤波要求与系统实时性要求选取。随后，累计统计纹波电流信号的上升值和下降值，当累计的上升值和下降值均高于n*ia时，纹波统计个数加一。纹波个数与电机旋转角度正相关，可以根据电机初始位置和旋转方向确定电机位置。步骤四：车窗位置补偿由于干扰的存在，单纯根据纹波幅值统计纹波个数并不精确，因此可以引入基于时间的补偿机制使纹波个数统计更加精确。当车窗电机稳定运行时，可以根据测量的电压、电流值与步骤一中估计的电机电阻、反电动势系数估计出电机转速，其计算公式如下：ω＝/ke；得到电机转速，即可估计得到理论上的纹波持续时间：Te＝2π/；其中，Te代表理论上的纹波持续时间，当两纹波计数相距时间过短，小于a*Te时，认为因电流波动统计了假纹波，纹波计数减一；当两纹波计数相距时间过长，大于b*Te时，认为两纹波中有一纹波未被统计，纹波计数加一。其中，a、b均为系数，0＜a＜1，1＜b＜2。步骤五：根据车窗位置与滤波后的电机电流确定并实施防夹方案在车窗上升的过程中，车窗电机产生的纹波个数与车窗运动距离成正比，故可以根据纹波个数确定车窗位置，进而判断车窗是否处于防夹区域，车窗防夹区域一般在距离底部200mm至距离顶部4mm的范围内。由于车窗电机发生夹持时会导致其电流快速升高，故可以根据滤波后电机电流来判断车窗是否发生夹持。当车窗上升至防夹区域发生夹持时，启动防夹方案使车窗下降至底部。实施例本实施例基于实际带霍尔传感器的车门进行数据验证，控制芯片选择STM32F103，电机驱动芯片选择DRV8305，通过采样电阻将电流信号转化为电压信号再由MCU的AD模块读出。测试电机一个完整行程产生hall信号个数如表1所示。高通滤波后，电机电流频谱图如图2所示，其频率约为800Hz。根据hall传感器可知电机转速约为81.27r/s。由于电机旋转一周会产生偶数个纹波信号，故根据实验的方法可以得知电机旋转一周会产生10个纹波信号，故根据表1，一个完整行程产生的纹波信号约为2415左右。表1完整行程产生hall信号个数在参数自适应过程中测量一个行程内车窗电机电流图如图3所示，采用合适的小波滤波系数对电流进行滤波，小波滤波具体方式如下：使用合适的小波基与合适的小波分解层数对电机电流信号进行低频分解，再对其进行重构。当小波基与小波分解层数合适时，可以认为重构后的信号是去除纹波信号的电机电流信号，原信号与重构后信号的差值为纹波信号，由此达到滤波效果。小波计算基本公式如下所示：Vi＝Lo_D*↓Vi-1；Wi＝Hi_D*↓Vi-1；Vi-1＝Lo_R*↑Vi；Wi-1＝Hi_R*↑Vi；其中，Vi表示小波第i层分解的低频系数，Wi表示小波第i层分解的高频系数，Lo_D、Hi_D、Lo_Ri、Hi_R分别代表某一小波基对应的低频分解系数、高频分解系数、低频重构系数、高频重构系数。本实施例选取db2小波基，4层小波分解层数，得到小波滤波的纹波电流图与直流电流图分别如图4、图5所示，根据步骤一、步骤二中的描述可分别得到电机电阻R与平均纹波幅值ia分别为0.73和1.0978。采用上述小波滤波方法对电流进行分段滤波，由于小波滤波的特殊性，滤波数据个数需选择2的幂数，且其指数不小于分解层数。为了获得更好的实时性，将滤波点的个数选取为16。为了使分段小波滤波与直接小波滤波达到相同的效果，需要根据小波滤波器的系数个数，记录下上组数据小波分解的若干个值，在每次进行小波分解时根据上组数据小波分解记录值对数据进行延拓，在进行小波变换。在本实施例中，由于选取的db2小波基的滤波器有4个系数，故每次进行小波分解时，需将上组数据小波分解的两值置于本次小波分解数据之前作为延拓，如此即可保证分段小波滤波与直接小波滤波的一致性。根据实验，本实施例中纹波幅值系数n被确定为0.5，纹波时间系数a、b分别被确定为0.68和1.48。根据上述步骤四、步骤五对纹波个数进行统计、补偿即可得到较为准确的车窗位置。最后，根据滤波后电流值即可较好地判断出是否需要启动车窗防夹。根据测试，全行程电机位置误差约在0.6％。比对图3与图5，由于图3中未滤波的电机电流信号中有纹波信号的存在，为防止误防夹，需将夹持判断电流设置稍大，本实施例中取7A。而图5中的电机电流信号已滤去纹波信号，夹持判断电流可设置偏小，本实施例中取6A，则使用滤波后电流信号判断防夹约比使用未滤波电流信号判断防夹提前了7毫秒。由于滤波后降低了电流的震荡，选取相同的夹持判断电流时，电机发生误防夹次数也有明显降低。
