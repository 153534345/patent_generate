标题title
一种基于深度学习的油井增产措施优选及效果预测方法
摘要abst
本发明公开了一种基于深度学习的油井增产措施优选及效果预测方法，属于石油工程技术领域，包括如下步骤：收集待预测油井的历史措施数据；筛选得到措施增产数据集；进行相关性分析，选取特征参数；数据预处理；分别构建基于LightGBM的措施预测模型和基于CatBoost的措施预测模型；分别构建基于LightGBM的回归模型和基于CatBoost的回归模型；将当前待测油井的地质参数和井况数据同时输入到最终的措施预测模型，预测最优增产措施；再将待测井相关参数以及预测的措施输入最终的效果预测模型，预测实施优选措施后的效果。本发明通过深度学习算法构建模型，实现增产措施的优选及措施后效果预测。
权利要求书clms
1.一种基于深度学习的油井增产措施优选及效果预测方法，其特征在于，采用了LightGBM和CatBoost两种深度学习方法进行措施优选和效果预测，具体包括如下步骤：步骤1、收集待预测油井的历史措施数据；步骤2、采用Mini Batch K-Means聚类算法对历史措施数据进行聚类，筛选得到措施增产数据集；步骤3、对措施增产数据集进行相关性分析，选取特征参数；步骤4、对选取特征参数后的措施增产数据集进行一系列数据预处理，并将处理后的数据按比例划分测试集和验证集；步骤5、分别构建基于LightGBM的措施预测模型和基于CatBoost的措施预测模型；对每个模型均进行训练及优化，得到训练完成的两个模型，并计算两个模型的准确率，将准确率高的模型作为最终的措施预测模型；步骤6、分别构建基于LightGBM的回归模型和基于CatBoost的回归模型并进行训练评估；选择评估指标中拟合优度高的回归模型作为最终的效果预测模型；步骤7、将当前待测油井的地质参数和井况数据同时输入到最终的措施预测模型，预测最优增产措施；再将待测井相关参数以及预测的措施输入最终的效果预测模型，预测实施优选措施后的效果。2.根据权利要求1所述基于深度学习的油井增产措施优选及效果预测方法，其特征在于，所述步骤1中，收集的历史措施数据包括井况数据、地质参数、措施数据、增产措施实施效果及生产状态数据。3.根据权利要求1所述基于深度学习的油井增产措施优选及效果预测方法，其特征在于，所述步骤2中，筛选得到措施增产数据集的具体过程为：步骤2.1、将措施增产作为筛选的唯一指标，首先抽取历史措施数据中的部分数据集，使用Mini Batch K-Means聚类算法构建出K个聚簇点的模型；步骤2.2、再次抽取历史措施数据中的部分数据集，并将其添加到模型中，分配给距离最近的聚簇中心点；步骤2.3、更新聚簇的中心点值，每次更新都只用抽取出来的部分数据集；步骤2.3、循环迭代步骤2.2和步骤2.3，直到中心点稳定或者达到迭代次数，停止循环，此时输出得到所需的措施增产井数据集。4.根据权利要求1所述基于深度学习的油井增产措施优选及效果预测方法，其特征在于，所述步骤3中，采用斯皮尔曼相关性分析进行特征参数选取，针对措施增产数据集中的每种措施，均通过斯皮尔曼相关性分析，选取与对应措施相关性高的特征参数，删除完全不相关和相关性低的特征参数，将相关性高的特征参数作为预测模型的输入参数。5.根据权利要求1所述基于深度学习的油井增产措施优选及效果预测方法，其特征在于，所述步骤4的具体过程如下：步骤4.1、采用删除和填充相结合的方式进行缺失值处理；一条数据中，若缺失值超过5个，则直接删除整条数据；否则，采用随机森林算法预测缺失值，将预测值作为默认的正确值填充到此条数据中；步骤4.2、根据数据集维度情况，使用孤立森林算法或者DBScan聚类算法进行数据异常值处理；高维数据采用孤立森林算法进行数据异常值删除；低维数据采用DBScan聚类算法进行数据异常值删除；步骤4.3、使用LDA线性判别分析法对数据进行降维处理；步骤4.4、对数据进行定性特征二值化；步骤4.5、对数据进行定性特征编码，将表示类别的字符串信息编码后转化为可计入模型的数值信息；步骤4.6、对数据进行无量纲化处理，将所有不同格式数据转换到统一格式；步骤4.7、对数据添加增产措施效果标签，对措施数据添加类别标签；步骤4.8、将预处理后的增产措施数据集以8：2的比例划分为训练集和测试集。6.根据权利要求1所述基于深度学习的油井增产措施优选及效果预测方法，其特征在于，所述步骤5中，两种措施预测模型的输入均为井况数据、地质参数以及措施数据，输出均为措施类型；数据输入模型前需要进行归一化处理，归一化方法为： ；式中，为归一化处理后的数值，取值范围在之间；/＞为预处理后的措施增产数据集中每个参数的最小值；/＞为预处理后的措施增产数据集中每个参数的最大值；两个模型均采用训练集进行模型训练，采用测试集验证模型；采用测试集进行测试时，将测试集输入训练完成的模型得到预测结果，与实际的措施进行比对，计算预测准确率，当准确率高于80%，输出预测模型；否则，调整模型参数后重新训练优化模型；选择准确率更高的模型进行措施预测；然后将训练好的模型先针对一部分急需进行措施优选的油井进行预测，将模型优选出的措施进行实施并记录效果预测效果，将实际的效果预测效果与模型预测的效果进行比对，将满足生产需求的油井数据与措施实施数据重新放入训练集中进行训练，继续优化模型；基于LightGBM的措施预测模型训练时，采用贝叶斯调参法进行模型调参，寻找进行措施优选分类预测结果的最优参数组合；基于CatBoost的措施预测模型训练时，无需调参，采用默认参数；两个措施预测模型的训练过程均基于python语言实现，导入相应的模型包后通过python语言自动训练完成，但定义的超参数不同；LightGBM定义的模型超参数包括学习率、弱学习器的类型、叶子个数、树的最大深度，CatBoost定义的模型超参数包括习率、树深、L2正则参数、特征包含不同值的最大数目。7.根据权利要求1所述基于深度学习的油井增产措施优选及效果预测方法，其特征在于，所述步骤6中，基于LightGBM的回归模型和基于CatBoost的回归模型的模型输入相较于措施预测模型多一个实施措施特征参数，其余相同；回归模型的输出为实施优选措施后的效果，效果具体为增油百分比或者增油量；模型评估时，选择拟合优度、均方误差、平均绝对误差、可解释方差值作为四个评估指标；当拟合优度达到80%时，输出预测模型；否则，调整模型参数后重新训练优化模型；选择拟合度更高的模型进行效果预测；其中，拟合优度的计算公式为： ；其中，为拟合优度计算结果，/＞表示残差平方和，/＞表示总离差平方和。
说明书desc
技术领域本发明属于石油工程技术领域，具体涉及一种基于深度学习的油井增产措施优选及效果预测方法。背景技术油田开发已经步入中后期，大部分油田已经出现产量下降、含水率过高等问题，为了提高油井生产能力以及产油量，采取行之有效的油井增产措施是有必要的。增产措施方法有很多，不同的措施所对应的措施成本、维护成本以及效益也都不同，如何找到成本最低效益最高的增产措施即是关键。目前油田实际生产现场对油井的增产措施的选择存在一定程度的主观性，没有对其进行全面的综合的考量，只以短期内增产效果作为增产措施的选取依据。部分情况下，只从单一方面的指标进行评价与选择，忽略成本和效益之间的关系。油田增产措施优选及效果预测主要问题在于现场问题需要根据现场生产井的升产数据以及井况进行分析，且措施选择大多依靠专家判断，主观能动性较大，并且没有后续措施效果预测。目前并没有一套成熟的措施优选体系用于增产措施的选择，因此现有的油田增产措施手段已经无法满足高效增产的需求。发明内容为了解决上述问题，本发明提出了一种基于深度学习的油井增产措施优选及效果预测方法，采用LightGBM和CatBoost相结合的深度学习方法，对油井增产措施进行科学、准确的选择。本发明的技术方案如下：一种基于深度学习的油井增产措施优选及效果预测方法，采用了LightGBM和CatBoost两种深度学习方法进行措施优选和效果预测，具体包括如下步骤：步骤1、收集待预测油井的历史措施数据；步骤2、采用Mini Batch K-Means聚类算法对历史措施数据进行聚类，筛选得到措施增产数据集；步骤3、对措施增产数据集进行相关性分析，选取特征参数；步骤4、对选取特征参数后的措施增产数据集进行一系列数据预处理，并将处理后的数据按比例划分测试集和验证集；步骤5、分别构建基于LightGBM的措施预测模型和基于CatBoost的措施预测模型；对每个模型均进行训练及优化，得到训练完成的两个模型，并计算两个模型的准确率，将准确率高的模型作为最终的措施预测模型；步骤6、分别构建基于LightGBM的回归模型和基于CatBoost的回归模型并进行训练评估；选择评估指标中拟合优度高的回归模型作为最终的效果预测模型；步骤7、将当前待测油井的地质参数和井况数据同时输入到最终的措施预测模型，预测最优增产措施；再将待测井相关参数以及预测的措施输入最终的效果预测模型，预测实施优选措施后的效果。进一步地，步骤1中，收集的历史措施数据包括井况数据、地质参数、措施数据、增产措施实施效果及生产状态数据。进一步地，步骤2中，筛选得到措施增产数据集的具体过程为：步骤2.1、将措施增产作为筛选的唯一指标，首先抽取历史措施数据中的部分数据集，使用Mini Batch K-Means聚类算法构建出K个聚簇点的模型；步骤2.2、再次抽取历史措施数据中的部分数据集，并将其添加到模型中，分配给距离最近的聚簇中心点；步骤2.3、更新聚簇的中心点值，每次更新都只用抽取出来的部分数据集；步骤2.3、循环迭代步骤2.2和步骤2.3，直到中心点稳定或者达到迭代次数，停止循环，此时输出得到所需的措施增产井数据集。进一步地，步骤3中，采用斯皮尔曼相关性分析进行特征参数选取，针对措施增产数据集中的每种措施，均通过斯皮尔曼相关性分析，选取与对应措施相关性高的特征参数，删除完全不相关和相关性低的特征参数，将相关性高的特征参数作为预测模型的输入参数。进一步地，步骤4的具体过程如下：步骤4.1、采用删除和填充相结合的方式进行缺失值处理；一条数据中，若缺失值超过5个，则直接删除整条数据；否则，采用随机森林算法预测缺失值，将预测值作为默认的正确值填充到此条数据中；步骤4.2、根据数据集维度情况，使用孤立森林算法或者DBScan聚类算法进行数据异常值处理；高维数据采用孤立森林算法进行数据异常值删除；低维数据采用DBScan聚类算法进行数据异常值删除；步骤4.3、使用LDA线性判别分析法对数据进行降维处理；步骤4.4、对数据进行定性特征二值化；步骤4.5、对数据进行定性特征编码，将表示类别的字符串信息编码后转化为可计入模型的数值信息；步骤4.6、对数据进行无量纲化处理，将所有不同格式数据转换到统一格式；步骤4.7、对数据添加增产措施效果标签，对措施数据添加类别标签；步骤4.8、将预处理后的增产措施数据集以8：2的比例划分为训练集和测试集。进一步地，步骤5中，两种措施预测模型的输入均为井况数据、地质参数以及措施数据，输出均为措施类型；数据输入模型前需要进行归一化处理，归一化方法为： ；式中，为归一化处理后的数值，取值范围在之间；/＞为预处理后的措施增产数据集中每个参数的最小值；/＞为预处理后的措施增产数据集中每个参数的最大值；两个模型均采用训练集进行模型训练，采用测试集验证模型；采用测试集进行测试时，将测试集输入训练完成的模型得到预测结果，与实际的措施进行比对，计算预测准确率，当准确率高于80%，输出预测模型；否则，调整模型参数后重新训练优化模型；选择准确率更高的模型进行措施预测；然后将训练好的模型先针对一部分急需进行措施优选的油井进行预测，将模型优选出的措施进行实施并记录效果预测效果，将实际的效果预测效果与模型预测的效果进行比对，将满足生产需求的油井数据与措施实施数据重新放入训练集中进行训练，继续优化模型；基于LightGBM的措施预测模型训练时，采用贝叶斯调参法进行模型调参，寻找进行措施优选分类预测结果的最优参数组合；基于CatBoost的措施预测模型训练时，无需调参，采用默认参数；两个措施预测模型的训练过程均基于python语言实现，导入相应的模型包后通过python语言自动训练完成，但定义的超参数不同；LightGBM定义的模型超参数包括学习率、弱学习器的类型、叶子个数、树的最大深度，CatBoost定义的模型超参数包括习率、树深、L2正则参数、特征包含不同值的最大数目。进一步地，步骤6中，基于LightGBM的回归模型和基于CatBoost的回归模型的模型输入相较于措施预测模型多一个实施措施特征参数，其余相同；回归模型的输出为实施优选措施后的效果，效果具体为增油百分比或者增油量；模型评估时，选择拟合优度、均方误差、平均绝对误差、可解释方差值作为四个评估指标；当拟合优度达到80%时，输出预测模型；否则，调整模型参数后重新训练优化模型；选择拟合度更高的模型进行效果预测；其中，拟合优度的计算公式为： ；其中，为拟合优度计算结果，/＞表示残差平方和，/＞表示总离差平方和。本发明所带来的有益技术效果：为了对油井增产措施进行科学智能的选择，利用大量的现场油井生产数据，对其进行数据分析，分析各影响因素与油井产量之间隐藏的关系。本发明方法充分利用已有井的生产数据以及措施数据，通过深度学习算法构建模型，形成增产措施优选及效果预测系统，实现增产措施的优选及措施后效果预测。附图说明图1为本发明基于深度学习的油井增产措施优选及效果预测方法的流程图。具体实施方式下面结合附图以及具体实施方式对本发明作进一步详细说明：目前还没有形成一套完整的针对油井增产措施的理论体系，大多都是根据客户的要求完成相应的独立的操作系统，应用并不广泛。常用的预测方法有一定的局限性，很多看似无关的参数变化都会引起油井产量的变化。获取的油井数据也是多维度的，数据之间也存在相关性，无法直观的看出来油井产量变化。因此本发明方法采用模型优选决策出最适合的增产措施，具有重要意义。本发明采用LightGBM和CatBoost相结合的深度学习方法，首先对这两种方法进行简单介绍。LightGBM算法是梯度提升树算法的优化。GBDT算法在很多深度学习的任务中有着很高的效率和准确率，常用于搜索、排序、预测等各种任务。但是GBDT算法在每次迭代时都需要对整个数据集进行多次遍历，若是数据量巨大的话则需要花费大量时间。所以计算效率与数据量大小和维度高低成正比，处理海量数据花费的时间很多。提出 LightGBM的目的就是为了解决GBDT所遇到的问题。 LightGBM采用了直方图算法将遍历样本转换为遍历直方图，极大的减少了时间且降低了内存消耗；此外LightGBM对缓存进行了优化，增加了缓存命中率并且在训练过程中采用互斥特征捆绑算法减少了特征数量，降低了需要消耗的内存。CatBoost是自适应族算法的一种，其基学习器为GBDT框架，主要用于处理类别型特征不好处理的问题。与 LightGBM相比CatBoost会自动将类别型特征处理为数值，即对类别型特征做统计计算某个类别特征出现频率后再加上超参数生成新的数值型特征。如图1所示，一种基于深度学习的油井增产措施优选及效果预测方法，采用了LightGBM和CatBoost相结合的深度学习方法，具体包括如下步骤：步骤1、收集油井的历史措施数据。收集的历史措施数据，是从油井多年积累的丰富数据和经验中挖掘和获取隐含其中且可行的数据。收集的历史措施数据包括井况数据、地质参数、措施数据以及增产措施实施效果数据。井况数据包括日产液、含水率、累产液、累产油等；地质参数包括孔隙度、渗透率、有效厚度、原油温度等；措施数据包括泵功率、生产天数、排量、泵深等。增产措施实施效果包括增产措施实施集以及措施后效果集，增产措施实施集中包括井号、日产油、累产油、所实施措施等数据；措施后效果集中包括井号、措施类型、措施前后产液量、产油量等数据。步骤2、采用Mini Batch K-Means聚类算法对历史措施数据进行聚类，筛选得到措施增产数据集。历史措施数据中，既包括措施增产数据，又包括措施减产数据，且油井数据具有量大、重复性高、数据缺失等特点，因此本发明通过K-means聚类算法中的Mini Batch K-Means聚类算法进行措施增产数据选取。Mini Batch K-Means聚类算法是K-Means聚类算法的一种优化变种，采用小规模数据子集减少计算时间，同时试图优化目标函数，每次训练使用的数据集是在训练算法的时候随机抽取的数据子集；Mini Batch K-Means聚类算法可以减少K-Means聚类算法的收敛时间。将措施增产作为筛选的唯一指标进行聚类，最终筛选得到措施增产数据；采用Mini Batch K-Means聚类算法选取措施增产数据的具体步骤如下：步骤2.1、首先抽取历史措施数据中的部分数据集，使用Mini Batch K-Means聚类算法构建出K个聚簇点的模型；步骤2.2、再次抽取历史措施数据中的部分数据集，并将其添加到模型中，分配给距离最近的聚簇中心点；步骤2.3、更新聚簇的中心点值，每次更新都只用抽取出来的部分数据集；步骤2.3、循环迭代步骤2.2和步骤2.3，直到中心点稳定或者达到迭代次数，停止循环，此时输出得到所需的措施增产数据集。Mini Batch K-Means聚类算法主要包括如下参数：n_clusters：即k值。max_iter：最大的迭代次数。n_init：采用不同的初始化质心运行算法的次数，每次采用不一样的采样数据集来得到不同的初始化质心运行算法。batch_size：即Mini Batch K-Means聚类算法的采样集大小，默认是100。如果发现数据集的类别较多或者噪音点较多，需要增加这个值以达到较好的聚类效果。init：即初始值选择的方式。init_size：用来做质心初始值候选的样本个数，默认是batch_size的3倍。reassignment_ratio：某个类别质心被重新赋值的最大次数比例，与max_iter作用相同，用于控制算法运行时间。具体计算方式为：占样本总数的比例乘以样本总数，则得到每个类别质心可以重新赋值的次数。如果取值较高的话算法收敛时间可能会增加，尤其是那些暂时拥有样本数较少的质心。默认是0.01。max_no_improvement：即当连续若干个小批量没有改善聚类效果，就停止算法，用于控制算法运行时间。默认是10，一般使用默认。步骤3、对措施增产数据集进行相关性分析，选取特征参数。为了降低噪声干扰带来的预测难度，提高模型性能，本发明通过斯皮尔曼相关性分析进行特征参数选取。针对措施增产数据集中的每种措施，通过斯皮尔曼相关性分析，选取与对应措施相关性高的特征参数，删除完全不相关和相关性低的特征参数，将相关性高的特征参数作为预测模型的输入参数。通过特征参数的选取，使得预测模型与目标匹配度高，拟合效果好，从而达到更优性能。步骤4、对选取特征参数后的措施增产数据集进行一系列数据预处理，并将处理后的数据按比例划分测试集和验证集。数据预处理过程包括缺失值处理、异常值处理缺失值处理、降维处理、定性特征二值化、定性特征编码、无量纲化、添加增产措施效果标签。具体过程如下：步骤4.1、采用删除和填充相结合的方式进行缺失值处理。缺失值是指某些数据的某些参数存在丢失的现象，这类数据会导致模型在预测时报错，甚至影响预测效果，因此无法应用于模型。针对缺失值处理一般有两种方法：删除和填充。删除即删除所缺失参数的整条数据，对于数据量小的样本可能影响较大；填充即使用随机森林将缺失参数的值预测出来，将其默认为正确值并放回样本。本发明采用删除和填充相结合的处理方式，对于一条数据中，若缺失值超过5个，则直接删除整条数据；否则，采用随机森林算法预测缺失值，将预测值作为默认的正确值填充到该条数据中。随机森林算法预测缺失值的过程为：对每一列的缺失值数量进行排序，对缺失值进行从少到多填充；然后循环构建新特征矩阵和新标签，新特征矩阵无需填充特征和原标签，新标签需要填充特征；在新特征矩阵中对含有缺失值的列将其填充为0；将所有需要填充的特征中存在的值定义为Y训练集，将不存在的值定义为Y测试集；将新特征矩阵上需填充的特征非空值对应的记录定义为X训练集，将空值对应的记录定义为X测试集；最后依次进行类实例化、训练X训练集和Y训练集、结果预测，预测的结果即为预测的缺失值，进行相应填充即可。步骤4.2、根据数据集维度情况，使用孤立森林算法或者DBScan聚类算法进行异常值处理；异常值指原始数据中无法解释或与其他值相差巨大的值，其产生原因多为收集、读取、传输工程中出现错误导致。本发明的油井样本数据集包括高维、低维两种数据集，孤立森林算法适用于高维数据，DBScan聚类算法对于低维数据具有较高的精度。因此本发明分别采用孤立森林算法以及DBScan聚类算法来对高维、低维两种样本进行数据异常值处理。孤立森林算法对高维样本进行数据异常值处理过程为：从油井样本数据集中随机选择t个样本点作为子样本，放入树的根节点；随机指定一个属性，在当前节点数据中随机产生一个切割点，切割点产生于当前节指定属性的最大值和最小值之间；以此切割点生成了一个超平面，然后将当前节点数据空间划分为2个子空间：把指定属性里小于切割点的数据放在当前节点的左孩子，把大于等于切割点的数据放在当前节点的右孩子；在孩子节点中递归过程和，不断构造新的孩子节点，直到孩子节点中只有一个数据或孩子节点已到达限定高度；获得t个孤立森林模型中的树之后，孤立森林模型训练结束，然后用生成的孤立森林模型来评估测试数据。对于一个测试数据，令其遍历每一棵iTree，然后计算测试数据最终落在每个树第几层。然后可以得出测试数据在每棵树的高度平均值，即平均路径长度，通过平均路径长度可以得到每个实测试数据分数，分数为1时，该条数据为正常值，分数为-1时，该条数据为异常值，直接删除该条数据。DBScan聚类算法最核心的思想就是基于密度。DBSCAN聚类算法可以找到样本点的全部密集区域，并把这些密集区域当做一个一个的聚类簇。DBScan聚类算法包括邻域半径R、最少点数目MinPoints两个参数，以及核心点、边界点、噪声点三种点的类别。DBScan聚类算法对低维样本进行数据异常值处理过程为：找到每个样本的邻域内的样本个数，若个数大于等于MinPoints，则该样本为核心点；找到每个核心样本密度直达和密度可达的样本，且该样本亦为核心样本，忽略所有的非核心样本；若非核心样本在核心样本的邻域内，则非核心样本为边界样本，反之为异常值，对异常值进行删除处理。步骤4.3、使用LDA线性判别分析法对数据进行降维处理；针对于样本维数过高的问题使用LDA线性判别分析法进行降维。相较于主成分分析法而言，LDA更适用于对于分类特征的提取。LDA降维的方法已经较为常见因此不详细展开。Python中可以直接导入数据并调用LDA调整参数进行降维。步骤4.4、对数据进行定性特征二值化；定量特征二值化的目的是为了对定量特征进行好与坏的划分，以剔除冗余信息。例如将效果后日平均增油量或者百分比增油量定一个阈值，高于这个阈值的措施数据即为有效数据，低于这个阈值的数据说明增油量没有达到要求，此时做删除处理。步骤4.5、对数据进行定性特征编码；定性特征编码为将表示类别的字符串信息编码后转化为可计入模型的数值信息。步骤4.6、对数据进行无量纲化处理；无量纲化为将所有不同格式数据转换到统一格式。步骤4.7、对数据添加增产措施效果标签；添加增产措施效果标签为使用Python语言将导入的每种措施添上类别标签。步骤4.8、将预处理后的措施增产数据集以8：2的比例划分为训练集和测试集。步骤5、分别构建基于LightGBM和CatBoost的措施预测模型以及基于LightGBM和CatBoost的措施效果预测模型，对每个模型均进行训练及优化，并计算每个模型的准确率或拟合优度，将准确率更高或拟合优度的模型作为最终的措施预测模型和效果预测模型。本发明选取两种分类学习算法，分别为LightGBM和CatBoost。将预处理后的措施增产数据集中的井况数据、地质参数以及措施数据作为模型的输入，模型的输出为措施类型，将两种算法分别建立深度学习模型，并拟合检验精度。数据输入模型前需要进行归一化处理提高学习的准确率以及效率，归一化方法为： ；式中，为归一化处理后的数值，取值范围在之间；/＞为预处理后的措施增产数据集中每个参数的最小值；/＞为预处理后的措施增产数据集中每个参数的最大值。由于LightGBM算法与CatBoost算法的本质均为实现梯度提升树算法的框架，因此LightGBM算法与CatBoost算法的预测过程均为以下GBDT算法的预测过程：步骤5.1、初始化弱学习器： ；式中，表示单个样本；/＞表示是的目标函数取最小值时的变量值；/＞表示最终输出值；/＞表示样本的序号，/＞；/＞表示样本总数；/＞表示损失函数；/＞表示样本/＞所属类别；步骤5.2、更新迭代过程中的强学习器；具体过程如下：步骤5.2.1、 建立棵分类回归树，对于每个样本计算第/＞棵分类回归树对应的响应值/＞，响应值为随时函数的负梯度，即伪残差，计算公式如下：；式中，表示序号为/＞的样本，/＞表示样本为/＞的回归树；/＞表示回归树；表示第/＞棵新的回归树，/＞；步骤5.2.2、对于每个样本利用CART回归树拟合数据得到第/＞棵分类回归树，第/＞棵分类回归树对应的叶子节点区域为/＞，其中/＞，且/＞为第棵分类回归树叶子节点的总个数，/＞表示回归树的叶子节点个数。步骤5.2.3、对于个叶子节点区域，计算出最佳拟合值/＞：；式中，表示第/＞棵新的回归树；步骤5.2.4、更新迭代过程中的强学习器：；式中，表示损失函数；步骤5.3、计算最终的强学习器，最终的强学习器对应的结果即为模型最终的预测结果，最终的强学习器计算公式如下：；式中，表示初始学习器。LightGBM是一种轻量梯度提升机，与XGBoost算法类似，其基本思想都是对所有特征都按照特征的数值进行排序，找到一个特征上的最好分割点，将数据分裂成左右子节点。LightGBM相较于XGBoost还有几个方面的优化：通过Leaf-wise策略选择分裂收益最大的节点进行分裂，如此递归进行，但也易过拟合，需限制树的深度。引入Hitogram算法，通过遍历直方图就行了，减少了分裂点数量，减少了计算量，也降低了内存的占用。通过GOSS、EFB等算法，减少样本的数量和特征的数量等。直接支持类别特征，在对离散特征分裂时，每个取值都当作一个桶，分裂时的增益算的是判断是否属于某个分类的gain。在使用 LightGBM模型之前需要先进行模型调参，寻找进行措施优选分类的预测结果的最好参数组合。常用的机械学习调参方法有贝叶斯调参法和网格搜索法，常用的方法为网格搜索法，但是网格搜索法有个很大的缺点就是很费时间，而且油井的数据量众多，将会非常耗时。使用贝叶斯调参的迭代次数比较少且速度快，因此综合考虑后使用贝叶斯调参法。在此分类模型中，LightGBM模型的输入为地质参数、井况参数和措施参数等一系列特征，输出为措施类别。由于python有现成的库可以使用，因此本发明软件系统只要在python中将训练数据导入并调用 LightGBM，随后将参数输入即可生成分类模型。模型采用贝叶斯调参算法进行参数优化。贝叶斯调参算法参数优化基本思想是基于数据使用贝叶斯定理估计目标函数的后验分布，然后再根据分布选择下一个采样的超参数组合。它充分利用了前一个采样点的信息，其优化的工作方式是通过对目标函数形状的学习，并找到使结果向全局最大提升的参数。贝叶斯调参算法采取单种子十折进行遍历，迭代轮数为100轮，评价标准设为MAE，经过100轮迭代后最终得到最优参数组合。CatBoost算法是gradient boosting算法中的一种。CatBoost提供了两种Boosting模式，Ordered和Plain。Plain就是在标准的GBDT算法上内置了排序TS操作。而Ordered模式则是则排序提升算法上做出了改进。在Ordered模式学习过程中具体为以下步骤：1）训练一个模型，其中表示在序列中前个样本学习得到的模型对于第个样本的预测。2）在每一次迭代中，算法从中抽样一个序列，并基于此构建第n步的学习树。3）基于计算对应梯度。4）使用余弦相似来近似梯度，对于每个样本取梯度。5）在评估候选分裂节点过程中，第n个样本的叶子节点值由与同属第一个叶子的所有样本的前个样本的梯度值求平均得到。6）当第n步迭代的树结构确定以后，便可用其来提升所有模型。由于CatBoost的重要参数与 LightGBM基本保持一致。CatBoost模型无需调参即可获得较为高质量的模型，因此采用默认参数即可获得较为理想的结果。CatBoost调参前后对结果影响较小，因此可以将调参步骤省略。CatBoost的建模步骤也与 LightGBM类似因此不再详讲，调用+输入参数即可。在此分类模型中，CatBoost模型的输入为地质参数、井况参数和措施参数等一系列特征，输出为措施类别。两个模型均采用训练集进行模型训练，采用测试集验证模型。当模型验证后的准确率达到80%之后结束模型训练，同时，从2个模型中选取准确率最高的预测模型作为最终的措施预测模型。采用测试集进行测试，将测试集输入训练完成的模型得到预测结果，与实际的措施进行比对，当模型预测测试集措施准确率达到80%以上即为满足效果，模型可以投入使用。若准确率不足80%，则模型准确率不足不能投入使用，需调整参数优化模型后使得模型测试集准确率达到80%再投入使用。将训练好的模型先针对一部分急需进行措施的油井进行预测，对油井实施优选后的措施并记录措施效果，经人工鉴定后将满足要求的油井增产措施数据重新放入训练集中对模型进行训练，优化模型。具体为：将模型优选出的措施进行实施并记录措施实施效果，将措施效果与预测效果进行对比。措施效果与预测效果相近即为满足要求，并将该油井数据与措施实施数据重新放入训练集。若措施效果与预测效果相差较大即为不满足要求，将其放入模型中重新进行措施优选和效果预测，直至措施效果与预测相差不大为止。步骤6、分别构建基于LightGBM的回归模型和基于CatBoost的回归模型并进行训练评估。回归模型的输入相较于措施预测模型多一个实施措施特征参数，其余相同；回归模型的输出为实施优选措施后的效果，效果具体为增油百分比或者增油量等具体增油指标。模型评估时，选择拟合优度、均方误差、平均绝对误差、可解释方差值作为四个评估指标；选择评估指标中拟合优度高且达到80%的回归模型作为最终的效果预测模型。其中，拟合优度的计算公式为： ；其中，为拟合优度计算结果，/＞表示残差平方和，/＞表示总离差平方和。拟合优度的取值范围为。当拟合优度为1时，表示回归方程完全拟合数据；当拟合优度为0时，表示回归方程不能解释数据的任何变异。步骤7、将当前待测油井的地质参数和井况数据同时输入到最终的措施预测模型，预测最优增产措施；再将待测井相关参数以及预测的措施输入最终的效果预测模型，预测实施优选措施后的效果。为了证明本发明的可行性与优越性，给出如下实施例。本实施例以涠洲油田26口油井为例，按照下面的步骤进行数据分析对26口油井的增产措施优选与效果预测进行展示。步骤1、本实施例收集了涠洲油田26口油井的历史措施数据，涠洲油田的历史措施数据中只包括了地质参数、井况数据、措施数据。其中，地质参数、井况数据及措施数据共包括砂比、压裂层数、携沙液量、前置液量、孔隙度、含油饱和度、渗透率、油层厚度等二十多种。措施包括调剖和酸化两种。步骤2、由于所收集的历史措施数据杂乱无章、数据量较为庞大，既包括措施增产数据，又包括减产数据。因此首先使用Mini Batch K-Means聚类方法对历史措施数据进行聚类筛选措施增产数据。本发明依据增产这一指标，将措施增产作为筛选的唯一指标进行聚类，最终筛选得到措施增产数据。其中，初始化的三个中心点为,,]，batch_size默认为100，其余采用默认值。基本步骤为从机器学习库sklearn中导入Mini Batch K-Means包以及所需聚类的数据，初始化中心，设置默认参数，基于Mini BatchK-Means算法进行聚类得到所需的措施增产数据集。步骤3、收集到的历史油井增产措施数据并不是高维数据，没有造成维数灾难，因此该实施例不需要进行降维处理，直接对数据集进行相关性分析。对措施增产数据集进行斯皮尔曼相关性分析，保留与调剖和酸化两种措施相关性较高的特征参数，相关性较低的特征参数对于措施选择并没有很大的帮助。本发明实施例的措施增产数据集中，首先对酸化措施相关联的所有地质参数、井况数据和措施数据进行斯皮尔曼相关性分析，可以得出只有孔隙度与渗透率两种特征与酸化措施相关系数大于0，呈正相关关系，因此选取孔隙度与渗透率作为酸化措施的特征参数。然后，对调剖措施相关联的地质参数、井况数据和措施数据同样进行斯皮尔曼相关性分析，可以得出渗透率、孔隙度、垂厚和温度与调剖措施呈正相关，因此最后选取渗透率、孔隙度、垂厚与温度作为调剖措施的特征参数。筛选完特征参数后对样本数据集进行无量纲化、添加措施效果标签等处理。将酸化措施标签为0，调剖措施标签为1。步骤4、对相关性分析后的措施增产数据集进行一系列数据预处理。缺失值处理：数据集中很可能会出现缺失值的情况，一条数据中若缺失值较多则将其删去，缺失值较少则使用随机森林算法预测缺失值，将其填补。基本步骤为首先从机器学习库sklearn中导入随机森林包、交叉验证包以及其他所需要的包。首先使用Python基本函数np.argsort对每一列的缺失值数量进行排序，对缺失值进行从少到多填充。随后使用for循环构建新特征矩阵和新标签，新特征矩阵无需填充特征和原标签，新标签需要填充特征。定义fillc为新标签以及df为新特征矩阵并将其变为DataForme数据类型。在新特征矩阵中使用SimpleImputer函数对含有缺失值的列将其填充为0。再将所有需要填充的特征中存在的值定义为Y训练集，将不存在的值定义为Y测试集。将新特征矩阵上需填充的特征非空值对应的记录定义为X训练集，将空值对应的记录定义为X测试集。随后使用RandomForestRegressor类实例化，fit函数训练Xtrain和Ytrain，predict函数预测结果等一系列步骤，最后将预测的结果Ypredict返回到原始特征矩阵中。上述过程中，fillc和df为自定义，其余均可从sklearn库中直接调用。异常值处理：根据收集的历史数据维数大小选择使用DBScan聚类算法或者孤立森林算法对样本异常值进行处理。Python里在导入数据后，可以将两种方法直接进行调用，微调参数即可。针对于高维数据可以使用孤立森林方法，低维数据使用DBScan方法。本实施例选用孤立森林方法进行异常值处理。具体步骤为首先安装基于Python语言的机器学习库sklearn库，从中导入孤立森林包。其次导入数据，将样本数据Excel表导入。随后建立孤立森林模型，设置模型参数：n_estimators=100，max_samples=auto，contamination=float，max_features=1.0，n_estimators代表孤立树的数量，默认为100；max_samples代表训练每颗孤立树的采样数；contamination代表着数据集中异常值的比例，用于定义决策函数的阈值，默认值是0.1；max_features代表着用于训练每个孤立树的特征数，默认值是1。使用fit函数训练模型，接着使用sklearn库中的decision_function函数可以得出异常评分，使用predict函数可以得出模型是否异常的判断。在该过程中，当对单个特征进行分析时，孤立森林会分析该特征下所有数据的异常情况，并在最后以分数的形式展示出来；当分析特征为全部特征时，孤立森林会综合所有特征数据，分析综合情况下某一条数据的异常情况并以分数形式展示出来。可以根据现场油田需要选择其中一种或几种方法进行异常值处理。若只包含低维数据，可以只采用DBScan聚类算法进行异常值处理。若同时包含高维、低维两种数据集，则同时采用孤立森林算法、DBScan聚类算法分别对高维、低维进行异常值处理。以上函数均可以从sklearn库中直接调用。降维处理：使用LDA线性判别分析法进行降维。Python中可以直接导入数据并调用LDA线性判别分析法调整参数进行降维。最后对数据进行定性特征二值化、定性特征编码、无量纲化、添加增产措施效果标签。将上述处理后的措施增产数据集以8：2的比例划分为训练集和测试集，训练集用于训练模型，测试集用于测试。步骤5、使用LightGBM与CatBoost两种模型对处理好的样本数据进行训练。使用的语言为Python，首先使用CatBoost分类模型的具体步骤为：首先安装CatBoost包并从中导出分类模型CatBoostClassifier，导入其余所需要的包，其次将样本库以Excel表格的形式将数据导入并尝试输出，输出结果为4种特征数据以及一种措施数据。随后使用drop函数定义自变量以及因变量，将所有特征参数定义为X，则剩余措施数据定义为Y。随后设置测试样本占总样本比重为0.2，即设置测试大小test_size=0.2，random_state=42。尝试将X_train输出可以得到占比总样本0.8倍的包含特征参数的训练数据。之后使用pool函数将训练数据转化为CatBoost模型可以处理的数据类型，将训练数据定义为train_pool，测试数据定义为test_pool。随后定义模型，设置学习率为0.03，任务类型task_type为CPU。接着使用fit函数训练模型，令cat_features=0处理离散值。随后设置最优loss以及准确率，使用test_pool检验模型精度。接着使用for循环比较各特征向量对于最后措施选择的重要度。将训练集导入模型进行测试可以得到模型针对测试集的预测结果，通过sklearn库中的accuracy_score函数可以计算出预测值与测试集原数据的准确率分数，这里分数达到了0.9。使用sklearn库中的precision_score、recall_score、f1_score等函数可以计算出训练模型的主要评估指标，具体包括查准率为0.95、查全率为0.92、f1分数为0.93，这三者都是越接近1说明模型越准确，三者分数都满足准确率要求。使用sklearn库中的model_score函数可以计算出测试集与训练集分数，由此可检查出模型是否过拟合，此过程中训练集分数为0.97，测试集分数为0.95，两者相近，没有过拟合。从导出的训练集训练结果来看，20例数据中预测错误的为第5例、第12例，准确率为90%，满足模型预测准确率要求。最后保存模型用于后续预测。使用LightGBM分类模型的具体步骤为：首先安装LightGBM包并从中导出分类模型LGBMClassifier，导入其余所需要的包。将样本库以Excel表格的形式将数据导入并尝试输出，输出结果为4种特征数据以及一种措施数据。将四种特征数据定义为X，标签数据定义为Y。随后将数据拆分为训练集和数据集，训练集占比为0.8，random_state=0。接着将所有超参数设置为以下数值：learning_rate=0.1，boosting_type=‘gbdt’，num_leaves=31，max_depth=-1。其中learning_rate为学习率，默认为0.1；boosting_type用于指定弱学习器的类型，默认为gbdt；num_leaves用于指定叶子的个数，默认值为31；max_depth为指定树的最大深度，默认值为-1。最后使用LGBMClassifier模型及fit函数对模型进行训练，输出X_test的预测结果定义为y_pred。使用sklearn库中corr函数可以计算出输入输出特征自相关性，本实施例中孔隙度与渗透率与措施类型的相关系数较大，其余两特征与措施类型相关性较小，事实也确实如此。将训练集导入模型进行测试可以得到模型针对测试集的预测结果。通过sklearn库中的accuracy_score函数可以计算出预测值与测试集原数据的准确率分数，这里分数达到了0.96。使用sklearn库中的precision_score、recall_score、f1_score等函数可以计算出训练模型的主要评估指标包括查准率为0.93、查全率为0.92、f1分数为0.92，这三者都是越接近1说明模型越准确，三者分数都满足准确率要求。使用sklearn库中的model_score函数可以计算出测试集与训练集分数，由此可检查出模型是否过拟合，此过程中训练集分数为1，测试集分数为1，两者相当，没有过拟合。从导出的训练集训练结果来看，20例数据中预测错误的为第12例、第18例，准确率为90%，满足模型预测准确率要求。最后保存模型用于后续预测。根据现场的数据情况选择准确率更高的模型作为最终的分类模型。随后保存模型用于预测。步骤6、针对效果预测模型，从LightGBM和CatBoost中导入相应的回归模块，将因变量y改为增油百分比或者增油量，其余步骤基本不变。且，回归模型的模型输入相较于措施预测模型多一个实施措施特征参数，其余相同。需要注意的是：回归思路和分类相差不大，但是一部分函数回归和分类不能通用，需要修改部分函数代码。以CatBoost模型为例，将测试集导入可以得出测试集的测试结果。使用sklearn库中的metrics.r2_score、metrics.mean_squared_error、metrics.mean_absolute_error、metrics.explained_variance_score四个函数可以计算出模型主要评估指标：拟合优度、均方误差、平均绝对误差、可解释方差值，分别为0.93、0.03、0.18、0.93，表明回归模型比较优秀，效果较好。使用sklearn库中的model_score函数可以计算出测试集与训练集分数，由此可检查出模型是否过拟合，此过程中训练集分数为0.22，测试集分数为0.22，两者相当，没有过拟合。根据现场的数据情况选择拟合优度更高且达到80%的模型作为最终的回归模型。本发明还通过软件编程开发了增产措施选择与效果预测系统软件，该系统软件主要包括如下功能模块：数据查询与修改模块；低产低效井判别模块；增产措施推荐模块；措施效果预测模块。其中，数据查询与修改模块主要用于对油井各项参数的查询和修改设置。该模块中，采用直接导入Excel文件的数据传输形式，该数据传输形式能够保证数据良好衔接。通过导入的Excel文件可以直接进行计算，避免连接Access数据库，无需预先进行数据导入保存等工作，数据操作更加方便透明。添加弹出框引导操作流程添加模型训练相关信息。低产低效井判别模块中，将井况产能等数据上传后通过使用Mini Batch K-Means聚类算法，将低产低效作为聚类筛选的唯一指标，产能相似的油井会聚为一类，通过聚类能够认定输入的井况参数的油井是否为低产低效井，并给出低产低效井序号。该模块需展示：低产低效井序号及其井况参数和地质参数。增产措施推荐模块中，将累计增油量、措施增液量、措施投入、投资回收期、净现值、投入产出比、措施含水率等井况数据以及地质参数作为影响措施效果的相关参数，将其作为输入变量进行分类归类、归一化处理等并将相关参数数据化，将措施类型作为输出变量，系统自动选择准确率高的措施预测模型进行措施选择。该模块需展示：自动优化模型超参数的结果展示、措施工艺推荐结果展示。措施效果预测模块中，将待实施措施、累计增油量、措施增液量、措施投入、投资回收期、净现值、投入产出比、措施含水率等井况数据以及地质参数作为影响措施效果的相关参数，将其作为输入变量进行分类归类、归一化处理等并将相关参数数据化，将措施效果作为输出变量，系统自动选择拟合优度高的回归模型进行效果预测。该模块需展示：预测井况措施效果，措施效果为增油百分比或者增油量。当然，上述说明并非是对本发明的限制，本发明也并不仅限于上述举例，本技术领域的技术人员在本发明的实质范围内所做出的变化、改型、添加或替换，也应属于本发明的保护范围。
