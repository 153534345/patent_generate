标题title
一种欧拉角姿态解算方法及系统
摘要abst
本发明公开了一种欧拉角姿态解算方法及系统，解算方法包括：获取在搜索区间内钻具的工具面的旋转粗略角度ΔT；根据旋转粗略角度ΔT计算得到工具面的变化范围RangeT；在所述变化范围RangeT内设置多个粒子，所述粒子位置坐标对应欧拉角取值，随机生成粒子初始速度，计算每个粒子的适应性函数，选取适应性函数值最小的粒子为最优粒子；更新各粒子的速度和位置，采用迭代法将粒子逐渐向最优位置的方向靠拢；经过n次迭代后，直到当最优粒子的适应性函数精度达到阈值时，即该粒子位置为最优位置，停止迭代，此时第一粒子的位置作为钻具的真实姿态参数。本发明的欧拉角姿态解算方法只需要磁通门三分量仪的测量数据，即可对钻具的三维姿态参数进行解算。
权利要求书clms
1.一种欧拉角姿态解算方法，其特征在于，包括：获取在搜索区间内钻具的工具面的旋转粗略角度ΔT；根据旋转粗略角度ΔT计算得到工具面的变化范围RangeT；在所述变化范围RangeT内设置多个粒子，所述粒子位置坐标对应欧拉角取值，随机生成粒子初始速度，计算每个粒子的适应性函数，选取适应性函数值最小的粒子为最优粒子；更新各粒子的速度和位置，采用迭代法将粒子逐渐向最优位置的方向靠拢；经过n次迭代后，直到当最优粒子的适应性函数精度达到阈值时，即该粒子位置为最优位置，停止迭代，此时第一粒子的位置作为钻具的真实姿态参数；其中，所述最优位置为适应性函数取值小于所述阈值的位置。2.根据权利要求1所述的欧拉角姿态解算方法，其特征在于，所述粒子包括固定粒子和随机粒子；所述固定粒子设置在搜索区间的中心以及端点；所述随机粒子在搜索区间内随机生成。3.根据权利要求1所述的欧拉角姿态解算方法，其特征在于，所述获取在搜索区间内钻具的工具面的旋转粗略角度ΔT包括：根据钻具转速v获取旋转粗略角度ΔT；具体公式为：其中，f为采样频率。4.根据权利要求1所述的欧拉角姿态解算方法，其特征在于，所述根据旋转粗略角度ΔT计算得到工具面的变化范围RangeT包括：根据旋转粗略角度ΔT和旋转前的角度Tf计算得到工具面的变化范围RangeT。5.根据权利要求4所述的欧拉角姿态解算方法，其特征在于，计算公式包括：6.根据权利要求1所述的欧拉角姿态解算方法，其特征在于，所述适应性函数为：其中，A为方位角，I为井斜角，T为工具面角，bx，by，bz为磁通门三分量仪测出的三轴数据；Bs为地磁场竖直向上向的分量，Bn为地磁场朝向地理北方向的分量，Bw为地磁场朝向地理西方向的分量；fx、fy、fz为子适应函数，在特定情况下，只需要求解其中之一即可完成解算；abs为绝对值函数，用于计算理论值与实测值之间的误差；当有一组欧拉角组合使得各子适应性函数的取值均为0时，认定该组欧拉角即钻具真实姿态。7.根据权利要求1所述的欧拉角姿态解算方法，其特征在于，所述更新各粒子的速度和位置，采用迭代法将粒子逐渐向最优位置的方向靠拢包括：计算个初始粒子的适应性函数；当前位置为粒子个体历史最佳位置pb，将适应性函数最小的粒子的位置作为群体历史最优位置gb；在后续迭代中根据粒子当前速度v，当前位置x与pb、gb的距离综合调整搜索速度与方向，速度变化公式为：v＝wv+c1r1+c2r2位置更新公式为：x＝x+v其中，式中v为粒子的个体速度，w,c1,c2均为取值为0-2的权值参数。8.一种欧拉角姿态解算系统，其特征在于，包括：获取单元，所述获取单元用于获取在搜索区间内钻具的工具面的旋转粗略角度ΔT；计算单元，所述计算单元用于根据旋转粗略角度ΔT计算得到工具面的变化范围RangeT；所述计算单元还用于在所述变化范围RangeT内设置多个粒子，所述粒子位置坐标对应欧拉角取值，随机生成粒子初始速度，计算每个粒子的适应性函数，选取适应性函数值最小的粒子为最优粒子；更新各粒子的速度和位置，采用迭代法将粒子逐渐向最优位置的方向靠拢；经过n次迭代后，直到当最优粒子的适应性函数精度达到阈值时，即该粒子位置为最优位置，停止迭代，此时第一粒子的位置作为钻具的真实姿态参数；其中，所述最优位置为适应性函数取值小于所述阈值的位置。9.一种计算机可读存储介质，其上存储有计算机程序，其特征在于，所述程序被处理器执行时实现如权利要求1至7中任一项所述的方法。10.一种电子设备，其特征在于，包括：一个或多个处理器；存储装置，用于存储一个或多个程序，当所述一个或多个程序被所述一个或多个处理器执行时，使得所述一个或多个处理器实现如权利要求1至7中任一项所述的方法。
说明书desc
技术领域本发明属于结构试验技术领域，尤其涉及一种欧拉角姿态解算方法及系统。背景技术旋转导向钻井系统是一项尖端自动化钻井新技术，可以随钻实时完成导向功能，在资源勘探上发挥了重大作用。其中，钻具姿态参数的求解是旋转导向钻井技术的关键部分,关系到井下工具姿态控制和井眼轨迹跟踪控制问题。常见的姿态计算方法有：欧拉角法、方向余弦法、四元数法和等效旋转矢量法等。欧拉角法，也称为三参数法，即若载体在初始时间位于参考坐标系中，则可以通过三个方向余弦矩阵来描述载体以一定顺序执行三次旋转动作的过程，其姿态信息可由沿不同坐标轴旋转三次不同的角度表示，这三个角度被称为欧拉角。上述方案测量和解算钻井工具的井斜角和工具面角以及方位角，但它仅适用于随钻技术进行的测量，即在姿态测量过程中停止钻进，因为在钻进时会造成剧烈震动，使加速度计的测量数据不可用。这种姿态测量方法时间效率低，钻井成本高，很难实现对钻具姿态参数的连续、动态、实时测量。发明内容发明目的本发明的目的是提供一种欧拉角姿态解算方法及系统以解决上述问题。技术方案为解决上述问题，本发明的第一方面提供了一种欧拉角姿态解算方法，包括：获取在搜索区间内钻具的工具面的旋转粗略角度ΔT；根据旋转粗略角度ΔT计算得到工具面的变化范围RangeT；在所述变化范围RangeT内设置多个粒子，所述粒子位置坐标对应欧拉角取值，随机生成粒子初始速度，计算每个粒子的适应性函数，选取适应性函数值最小的粒子为最优粒子；更新各粒子的速度和位置，采用迭代法将粒子逐渐向最优位置的方向靠拢；经过n次迭代后，直到当最优粒子的适应性函数精度达到阈值时，即该粒子位置为最优位置，停止迭代，此时第一粒子的位置作为钻具的真实姿态参数；其中，所述最优位置为适应性函数取值小于所述阈值的位置。进一步地，所述粒子包括固定粒子和随机粒子；所述固定粒子设置在搜索区间的中心以及端点；所述随机粒子在搜索区间内随机生成。进一步地，所述获取在搜索区间内钻具的工具面的旋转粗略角度ΔT包括：根据钻具转速v获取旋转粗略角度ΔT；具体公式为：其中，f为采样频率。进一步地，所述根据旋转粗略角度ΔT计算得到工具面的变化范围RangeT包括：根据旋转粗略角度ΔT和旋转前的角度Tf计算得到工具面的变化范围RangeT。进一步地，计算公式包括：：其中，Tf为工具面角基点。进一步地，所述适应性函数为：其中，A为方位角，I为井斜角，T为工具面角，bx，by，bz为磁通门三分量仪测出的三轴数据；Bs为地磁场竖直向上向的分量，Bn为地磁场朝向地理北方向的分量，Bw为地磁场朝向地理西方向的分量；fx、fy、fz为子适应函数，在特定情况下，只需要求解其中之一即可完成解算；abs为绝对值函数，用于计算理论值与实测值之间的误差；当有一组欧拉角组合使得各子适应性函数的取值均为0时，认定该组欧拉角即钻具真实姿态。进一步地，所述更新各粒子的速度和位置，采用迭代法将粒子逐渐向最优位置的方向靠拢包括：计算个初始粒子的适应性函数；当前位置为粒子个体历史最佳位置pb，将适应性函数最小的粒子的位置作为群体历史最优位置gb；在后续迭代中根据粒子当前速度V，当前位置x与pb、gb的距离综合调整搜索速度与方向，速度变化公式为：v＝wv+c1r1+c2r2位置更新公式为：x＝x+v其中，式中v为粒子的个体速度，w，c1，c2均为取值为0-2的权值参数。根据本发明的另一个方面，提供一种欧拉角姿态解算系统，包括：获取单元，所述获取单元用于获取在搜索区间内钻具的工具面的旋转粗略角度ΔT；计算单元，所述计算单元用于根据旋转粗略角度ΔT计算得到工具面的变化范围RangeT；所述计算单元还用于在所述变化范围RangeT内设置多个粒子，所述粒子位置坐标对应欧拉角取值，随机生成粒子初始速度，计算每个粒子的适应性函数，选取适应性函数值最小的粒子为最优粒子；更新各粒子的速度和位置，采用迭代法将粒子逐渐向最优位置的方向靠拢；经过n次迭代后，直到当最优粒子的适应性函数精度达到阈值时，即该粒子位置为最优位置，停止迭代，此时第一粒子的位置作为钻具的真实姿态参数；其中，所述最优位置为适应性函数取值小于所述阈值的位置。根据本发明的又一个方面，提供一种计算机可读存储介质，其上存储有计算机程序，所述程序被处理器执行时实现如上述技术方案中任一项所述的方法。根据本发明的又一个方面，提供一种电子设备，包括：一个或多个处理器；存储装置，用于存储一个或多个程序，当所述一个或多个程序被所述一个或多个处理器执行时，使得所述一个或多个处理器实现如上述技术方案中任一项所述的方法。有益效果本发明的上述技术方案具有如下有益的技术效果：本发明的欧拉角姿态解算方法只需要磁通门三分量仪的测量数据，即可对钻具的三维姿态参数进行解算。在最优数值解的搜索过程中，本算法的搜索速度与方向可以依据历史搜索信息自动调整，更加迅速的收敛至极值点。解算计算量不会随着解算精度指数型增长，可以满足高精度、高效率的双重需求。附图说明图1是根据本发明一实施方式的欧拉角姿态解算方法流程图。具体实施方式为使本发明的目的、技术方案和优点更加清楚明了，下面结合具体实施方式并参照附图，对本发明进一步详细说明。应该理解，这些描述只是示例性的，而并非要限制本发明的范围。此外，在以下说明中，省略了对公知结构和技术的描述，以避免不必要地混淆本发明的概念。在附图中示出了根据本发明实施例的层结构示意图。这些图并非是按比例绘制的，其中为了清楚的目的，放大了某些细节，并且可能省略了某些细节。图中所示出的各种区域、层的形状以及它们之间的相对大小、位置关系仅是示例性的，实际中可能由于制造公差或技术限制而有所偏差，并且本领域技术人员根据实际所需可以另外设计具有不同形状、大小、相对位置的区域/层。显然，所描述的实施例是本发明一部分实施例，而不是全部的实施例。本发明中的实施例，本领域普通技术人员在没有做出创造性劳动前提下所获得的所有其他实施例，都属于本发明保护的范围。此外，下面所描述的本发明不同实施方式中所涉及的技术特征只要彼此之间未构成冲突就可以相互结合。以下将参照附图更详细地描述本发明。在各个附图中，相同的元件采用类似的附图标记来表示。为了清楚起见，附图中的各个部分没有按比例绘制。图1是根据本发明一实施方式的欧拉角姿态解算方法流程图。如图1所示，在本发明一实施例中，提供了一种欧拉角姿态解算方法，包括：获取在搜索区间内钻具的工具面的旋转粗略角度ΔT；根据旋转粗略角度ΔT计算得到工具面的变化范围RangeT；在所述变化范围RangeT内设置多个粒子，所述粒子位置坐标对应欧拉角取值，随机生成粒子初始速度，计算每个粒子的适应性函数，选取适应性函数值最小的粒子为最优粒子；更新各粒子的速度和位置，采用迭代法将粒子逐渐向最优位置的方向靠拢；经过n次迭代后，直到当最优粒子的适应性函数精度达到阈值时，即该粒子位置为最优位置，停止迭代，此时第一粒子的位置作为钻具的真实姿态参数；其中，所述最优位置为适应性函数取值小于所述阈值的位置。本发明的欧拉角姿态解算方法只需要磁通门三分量仪的测量数据，即可对钻具的三维姿态参数进行解算。在最优数值解的搜索过程中，本算法的搜索速度与方向可以依据历史搜索信息自动调整，更加迅速的收敛至极值点。解算计算量不会随着解算精度指数型增长，可以满足高精度、高效率的双重需求。需要说明的是，所述位置坐标即钻具姿态参数，即欧拉角AIT，为载体坐标。在一可选实施例中，所述粒子包括固定粒子和随机粒子；所述固定粒子设置在搜索区间的中心以及端点；所述随机粒子在搜索区间内随机生成。在一可选实施例中，所述获取在搜索区间内钻具的工具面的旋转粗略角度ΔT包括：根据钻具转速v获取旋转粗略角度ΔT；具体公式为：其中，f为采样频率。在一可选实施例中，所述根据旋转粗略角度ΔT计算得到工具面的变化范围RangeT包括：根据旋转粗略角度ΔT和旋转前的角度Tf计算得到工具面的变化范围RangeT。在一可选实施例中，计算公式可以包括：其中，Tf为工具面角基点，即上一采样点工具角的解算结果。在一可选实施例中，所述适应性函数为：其中，A为方位角，I为井斜角，T为工具面角，bx，by，bz为磁通门三分量仪测出的三轴数据；Bs为地磁场竖直向上向的分量，Bn为地磁场朝向地理北方向的分量，Bw为地磁场朝向地理西方向的分量；fx、fy、fz为子适应函数，在特定情况下，只需要求解其中之一即可完成解算；abs为绝对值函数,用于计算理论值与实测值之间的误差；当有一组欧拉角组合使得各子适应性函数的取值均为0时，认定该组欧拉角即钻具真实姿态。此适应性函数评估了在搜索区间内任意一组欧拉角组合下，地磁三分量理论值与实测值之间的差距。若有一组欧拉角组合使得各子适应性函数的取值均为0时，可以认为该组欧拉角即钻具真实姿态。在一可选实施例中，所述所述更新各粒子的速度和位置，采用迭代法将粒子逐渐向最优位置的方向靠拢包括：计算个初始粒子的适应性函数；当前位置为粒子个体历史最佳位置pb，将适应性函数最小的粒子的位置作为群体历史最优位置gb；然后根据粒子当前速度v，当前位置x与pb、gb的距离综合调整搜索速度与方向，速度变化公式为：v＝wv+c1r1+c2r2位置更新公式为：x＝x+v其中，式中v为粒子的个体速度，w，c1，c2均为取值为0-2的权值参数。在本申请中，将对钻具姿态参数的测量分成三种状态，状态一为动态测量，此时钻具处于未知的运动状态，A、I、T都有可能发生变化，因此需要同时对三个角度进行解算，解算结果为欧拉角基点，作为其他状态解算的参考值。状态二也为动态测量，但是已知A、I其中的一个参数，即钻具此时正在进行转向或者造斜工作，根据状态一提供的欧拉角基点，在新的搜索范围内对A-T或者I-T欧拉角组合进行解算，并更新基点。状态三为对处于稳态的钻具进行测量，钻具处于稳态时，A、I保持不变，故只需要对T进行解算并更新工具面角基点。为了减少各状态下的搜索范围，可以根据钻具转速v、旋转方向、工具面角基点Tf、采样频率f等信息得出在搜索区间内工具面可以转过的大致角度ΔT，进而可以得出测样点T可能存在的区间范围RangeT。钻具在井下工作时，绝大多数时间处于状态三下，即使钻具在进行转向或者造斜作业，由于井斜角和方位角在采样间隔内发生的变化极其微小，所以在短时间内可以认为它处于直行状态，故状态一和状态二不需要每次采样都进行解算，因为状态一与状态二中需要用到的A、T的搜索范围RangeA以及RangeT取决于钻具的造斜能力以及测算时间间隔，通常以基点为中心向两端拓展一定角度，拓宽的角度依据钻具造斜能力强弱而定。本申请中，基于粒子群算法对上述数值解法中查表搜索的过程进行优化。我们首先设置了一个适应性函数组。通过调整A、I、T参数并计算适应性函数，当结果越接近于0时说明该组参数越逼近钻具真实姿态参数。对于状态三，A、I已知，我们只需要调整参数T以满足适应性函数fx或者fy逼近于0；对于状态二，有两种解决方案，一是采用降维的方式，通过适应性函数fz和已知的A寻找到最优的I,此时可以将状态二转化为状态一，二是直接在RangeA-RangeT平面上找出一组最优的；对于状态一，我们需要充分考虑适应性函数组的所有函数，即需要在搜索范围内找出一组能满足所有式子的欧拉角。根据不同的测量状态、基点、各角度搜索范围构建解算空间。然后初始化设置若干个粒子，粒子在搜索空间内的位置为欧拉角组合。在以往对粒子群算法的应用中，粒子的位置为随机的，当出现粒子集中某个区域的情况时，会导致粒子搜索不全面而收敛于局部极值，因此我们设计了“固定-随机”的粒子组合，将粒子分成两类，一类是固定粒子，位于搜索区域的中心以及端点，当搜索空间较大时，可以先将搜索空间等分为若干个子空间，在子空间的中心以及端点设置粒子，保证搜索的全面性；另一类为随机粒子，在搜索区域内随机生成欧拉角组合，作为该类粒子的初始位置x，保证了搜索的混沌性。针对粒子群算法后期速度收敛过慢的问题，我们依据对参数解算的精度要求，设置粒子了移动速度上下限vlimit，在移动区间内随机生成粒子的个体初始移动速度v。第三步，计算个初始粒子的适应性函数，并记录当前位置为粒子个体历史最佳位置pb，同时将适应性函数最小的粒子的位置作为群体历史最优位置gb。然后根据粒子当前位置x与pb、gb的距离综合调整搜索速度与方向，得到速度变化数据和位置数据。在迭代初期，粒子较为分散，粒子位置与群体历史最优位置距离远，此时速度大，有助于快速搜索；迭代后期粒子逐渐收敛，粒子速度放慢直至速度下限，提高搜索精度。依次进行迭代，更新粒子个体历史最优位置以及群体历史最优位置，各粒子逐渐向群体历史最优位置靠拢，搜索区域不断缩小，经过n次迭代后，各粒子收敛于钻具真实姿态处，直到当某一粒子的适应性函数达到精度要求时搜索中止，将该粒子的位置作为钻具的真实姿态参数。为了测试基于粒子群搜索算法的计算效率与精度，我们将它与传统等步长的查表方式在不同状态下做了对比测试，以下所有测试使用MATLAB编写程序并在同一个电脑上运行。首先是状态一工况下的测试，钻具转速为200rpm,采样频率为100Hz，基点为A＝30°，I＝30°，T＝45°,设钻具为顺时针旋转，因此当前的T的存在区间RangeT＝，在此区间内随机生成1000个角度值作为钻具的真实姿态，以下的测试中均采用类似的取值方式。我们统计了采用两种算法对这1000处工具面角进行解算验证，并统计了不同精度要求下的解算时间对比，结果见下表：表一：不同精度下状态一解算时间对比表精度小数点后一位小数点后两位更高精度PSO搜索算法0.008044s0.023337s0.035023s等步长遍历算法0.010497s0.082004s0.161605s比例0.770.280.21我们又对不同转速下，两种算法的解算时间做了对比测试，采样频率为100Hz，精度要求为精确到小数点后两位，对比结果见下表：表二：不同转速下状态一解算时间对比表转速100rpm200rpm300rpmPSO搜索算法0.001550s0.023337s0.002545s等步长遍历算法0.006281s0.082004s0.014712s比例0.260.280.17从以上两表格可见，不管在高精度还是高转速情况下，采样PSO优化的搜索算法均比等步长查表方法更具效率。在等步长遍历中，解算的时间会随着精度提高或者搜索范围增大的比例而增长相应的比例，而PSO搜索算法只需要控制粒子的搜索范围和最小移动速度，保证在搜索后期将速度降低至精度要求，不影响前期的高速搜索。因此，越高精度、越大范围的搜索中，PSO搜索算法更具优势。增加了数值解法的实用性。此外，我们还对状态二和状态三工况下，做了对比测试了。在状态二的测试中，我们设置A不变，I的变化范围为2°，采样频率为100Hz，改变转速以及测量精度，对比结果如下，PSO搜索算法优势极大，尤其是精度要求达到小数点后两位时，传统算法耗时巨大，平均每步计算时长达到0.07s，已经超出采样间隔,无法在实际成产中发挥作用，而PSO搜索算法平均每步计算时长为0.0007s，计算效率提高了两个数量级，即使在转速为200rpm的情况下，依旧有很好的计算效率。表三：不同参数下状态二解算时间对比表在状态三中，我们在测试中设置A、I的搜索范围均为2°，转速为100rpm，精度要求为整数位，采样频率为100Hz。测试中PSO搜索算法平均每步计算时长为0.00057s，而传统遍历算法每步需耗时0.016s，已经不能满足搜索的效率要求。在更高转速下，搜索空间变大，搜索区域内适应性函数存在多个极值点，导致了搜索精度的下降，不再适合使用数值解的方法进行搜索。从以上的测试中可见，PSO搜索方法大大提高的数值解答的计算效率，可以在采样区间内完成高精度的数值解算。在本发明另一实施例中，提供了一种欧拉角姿态解算系统，可以包括：获取单元，所述获取单元用于获取在搜索区间内钻具的工具面的旋转粗略角度ΔT；计算单元，所述计算单元用于根据旋转粗略角度ΔT计算得到工具面的变化范围RangeT；所述计算单元还用于在所述变化范围RangeT内设置多个粒子，所述粒子位置坐标对应欧拉角取值，随机生成粒子初始速度，计算每个粒子的适应性函数，选取适应性函数值最小的粒子为最优粒子；更新各粒子的速度和位置，采用迭代法将粒子逐渐向最优位置的方向靠拢；经过n次迭代后，直到当最优粒子的适应性函数精度达到阈值时，即该粒子位置为最优位置，停止迭代，此时第一粒子的位置作为钻具的真实姿态参数；其中，所述最优位置为适应性函数取值小于所述阈值的位置。在本发明又一实施例中，提供了一种计算机可读存储介质，其上存储有计算机程序，所述程序被处理器执行时实现如上述技术方案中任一项所述的方法。在本发明又一实施例中，提供了一种电子设备，包括：一个或多个处理器；存储装置，用于存储一个或多个程序，当所述一个或多个程序被所述一个或多个处理器执行时，使得所述一个或多个处理器实现如上述技术方案中任一项所述的方法。本发明旨在保护一种欧拉角姿态解算方法及系统，所述欧拉角姿态解算方法可以包括：获取在搜索区间内钻具的工具面的旋转粗略角度ΔT；根据旋转粗略角度ΔT计算得到工具面的变化范围RangeT；在所述变化范围RangeT内设置多个粒子，所述粒子位置坐标对应欧拉角取值，随机生成粒子初始速度，计算每个粒子的适应性函数，选取适应性函数值最小的粒子为最优粒子；更新各粒子的速度和位置，采用迭代法将粒子逐渐向最优位置的方向靠拢；经过n次迭代后，直到当最优粒子的适应性函数精度达到阈值时，即该粒子位置为最优位置，停止迭代，此时第一粒子的位置作为钻具的真实姿态参数；其中，所述最优位置为适应性函数取值小于所述阈值的位置。本发明的欧拉角姿态解算方法只需要磁通门三分量仪的测量数据，即可对钻具的三维姿态参数进行解算。在最优数值解的搜索过程中，本算法的搜索速度与方向可以依据历史搜索信息自动调整，更加迅速的收敛至极值点。解算计算量不会随着解算精度指数型增长，可以满足高精度、高效率的双重需求。应当理解的是，本发明的上述具体实施方式仅仅用于示例性说明或解释本发明的原理，而不构成对本发明的限制。因此，在不偏离本发明的精神和范围的情况下所做的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。此外，本发明所附权利要求旨在涵盖落入所附权利要求范围和边界、或者这种范围和边界的等同形式内的全部变化和修改例。
